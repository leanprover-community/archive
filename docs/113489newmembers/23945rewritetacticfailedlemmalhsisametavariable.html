---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/113489newmembers/23945rewritetacticfailedlemmalhsisametavariable.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113489newmembers/index.html">new members</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113489newmembers/23945rewritetacticfailedlemmalhsisametavariable.html">rewrite tactic failed, lemma lhs is a metavariable</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="192156408"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/192156408" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/23945rewritetacticfailedlemmalhsisametavariable.html#192156408">Jiekai (Mar 29 2020 at 04:46)</a>:</h4>
<p>Why is <code>rw ← b_ih_h,</code> here failing? </p>
<div class="codehilite"><pre><span></span>rewrite tactic failed, lemma lhs is a metavariable
state:
a b_n b_ih_w : mynat,
b_ih_h : b_n + succ b_ih_w = a
⊢ a = succ b_n + b_ih_w
</pre></div>

<a name="192156420"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/192156420" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/23945rewritetacticfailedlemmalhsisametavariable.html#192156420">Mario Carneiro (Mar 29 2020 at 04:47)</a>:</h4>
<p>because rw is stupid</p>

<a name="192156421"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/192156421" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/23945rewritetacticfailedlemmalhsisametavariable.html#192156421">Mario Carneiro (Mar 29 2020 at 04:47)</a>:</h4>
<p>try <code>rw b_ih_h.symm</code></p>

<a name="192156477"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/192156477" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/23945rewritetacticfailedlemmalhsisametavariable.html#192156477">Jiekai (Mar 29 2020 at 04:49)</a>:</h4>
<p>Worked! so many tricks</p>

<a name="192156568"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/192156568" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/23945rewritetacticfailedlemmalhsisametavariable.html#192156568">Jiekai (Mar 29 2020 at 04:52)</a>:</h4>
<p>What's the difference between <code>symm</code> and <code> ← </code>?</p>

<a name="192164938"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/192164938" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/23945rewritetacticfailedlemmalhsisametavariable.html#192164938">Kevin Buzzard (Mar 29 2020 at 09:21)</a>:</h4>
<p>In theory, nothing</p>

<a name="192164943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/192164943" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/23945rewritetacticfailedlemmalhsisametavariable.html#192164943">Kevin Buzzard (Mar 29 2020 at 09:21)</a>:</h4>
<p>I am surprised the arrow didn't work</p>

<a name="192168915"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/192168915" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/23945rewritetacticfailedlemmalhsisametavariable.html#192168915">Mario Carneiro (Mar 29 2020 at 11:12)</a>:</h4>
<p>The reason is because the rewrite tactic is explicitly checking that the lhs is not a variable. The idea here is that if you rewrite with something that matches any term, you will not get a useful result. This check is wrong for two reasons: (1) the variable is not a metavariable, and even if it was that might still be a reasonable thing to do if the type of the variable is constraining enough; and (2) it's always the lhs, not the rhs, even if you use <code>&lt;-</code>.</p>

<a name="192168937"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/192168937" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/23945rewritetacticfailedlemmalhsisametavariable.html#192168937">Patrick Massot (Mar 29 2020 at 11:13)</a>:</h4>
<p>Isn't at least point 2) something that could change in Lean 3.8?</p>

<a name="192169657"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/192169657" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/23945rewritetacticfailedlemmalhsisametavariable.html#192169657">Mario Carneiro (Mar 29 2020 at 11:31)</a>:</h4>
<p>both could be fixed in lean 3.8</p>

<a name="192169676"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/192169676" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/23945rewritetacticfailedlemmalhsisametavariable.html#192169676">Mario Carneiro (Mar 29 2020 at 11:32)</a>:</h4>
<p>There is nothing wrong with the algorithm, there is just a check that throws an exception. Delete the check and everything else should work</p>

<a name="192169714"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/192169714" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/23945rewritetacticfailedlemmalhsisametavariable.html#192169714">Patrick Massot (Mar 29 2020 at 11:32)</a>:</h4>
<p>I meant that point 2) sounds like a plain <em>bug</em>, whereas point 1) is debatable.</p>

<a name="192170139"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/192170139" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/23945rewritetacticfailedlemmalhsisametavariable.html#192170139">Mario Carneiro (Mar 29 2020 at 11:43)</a>:</h4>
<p>I think that the part of 1) about not matching variables that are not metavariables / universally quantified variables is also a bug. For example in the example above, we are rewriting with an equality in the context, which can only match <code>a</code>, not anything else with the same type as <code>a</code></p>

<a name="192170192"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/192170192" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/23945rewritetacticfailedlemmalhsisametavariable.html#192170192">Mario Carneiro (Mar 29 2020 at 11:44)</a>:</h4>
<p>The only time the error is reasonable is if you are rewriting with <code>\forall x, x = ...</code>, so that the pattern can match any term</p>


{% endraw %}

{% include archive_update.html %}