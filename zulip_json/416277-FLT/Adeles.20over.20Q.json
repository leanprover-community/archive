[
    {
        "content": "<p>(This is related to some of the previous discussion in <a class=\"stream-topic\" data-stream-id=\"416277\" href=\"/#narrow/channel/416277-FLT/topic/miniproject.3A.20adeles/with/534601000\">#FLT &gt; miniproject: adeles</a> but I'm starting a new thread as that thread already seems overloaded)</p>\n<p>Proving the cocompactness of the principal adeles of Q (<a href=\"https://github.com/ImperialCollegeLondon/FLT/pull/258\">FLT#258</a>) turned out to be surprisingly more painful than I initially expected, because we don't have good ways to relate the <code>FiniteAdeleRing</code> API, in the case of <code>K=‚Ñö</code>, to the more 'down-to-earth' API for <code>‚Ñ§,‚Ñö</code>, etc. However it turns out that one of the main results of chapter 5 of the blueprint, <code>QHat.rat_join_zHat</code>, is precisely the essential mathematical content we need for the proof of cocompactness. Therefore I wonder if we should relate <code>QHat</code> and <code>FiniteAdeleRing</code>, i.e. something like </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- The equivalence between `FiniteAdeleRing (ùìû ‚Ñö) ‚Ñö` and `QHat`. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">finiteAdeleRing_equiv_qHat</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùìû</span><span class=\"w\"> </span><span class=\"n\">‚Ñö</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">‚Ñö</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ+</span><span class=\"w\"> </span><span class=\"n\">QHat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">principalSubgroup_equiv_ratsub</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">finiteAdeleRing_equiv_qHat</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FiniteAdeleRing</span><span class=\"bp\">.</span><span class=\"n\">principalSubgroup</span><span class=\"w\"> </span><span class=\"n\">‚Ñö</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">QHat</span><span class=\"bp\">.</span><span class=\"n\">ratsub</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">finiteIntegralAdeles_equiv_zHatsub</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">finiteAdeleRing_equiv_qHat</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FiniteAdeleRing</span><span class=\"bp\">.</span><span class=\"n\">finiteIntegralAdeles</span><span class=\"w\"> </span><span class=\"n\">‚Ñö</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">QHat</span><span class=\"bp\">.</span><span class=\"n\">zHatsub</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>Of course, this is not exactly completely straightforward either, but it somehow seems to me to be a 'morally right' addition to the theory developed in chapter 5. With this, the proof of cocompactness becomes much more streamlined (the relevant PR is <a href=\"https://github.com/ImperialCollegeLondon/FLT/pull/705\">FLT#705</a>).</p>",
        "id": 536721695,
        "sender_full_name": "Bryan Wang",
        "timestamp": 1756446238
    },
    {
        "content": "<p>I should also mention that a proof of such a statement is given in the <a href=\"https://en.wikipedia.org/wiki/Adele_ring#Alternative_definition_for_number_fields\">wikipedia</a> page for adele ring - albeit with the usual abuse of =!</p>",
        "id": 536723636,
        "sender_full_name": "Bryan Wang",
        "timestamp": 1756447606
    },
    {
        "content": "<p>It does seem like having some API about <code>FiniteAdeleRing</code> in the specific case of Rat/Int would be useful. <code>Rat.AdeleRing.zero_discrete</code> looks like it's trying to push through this lack of API, for example. But if the other equivalence is more useful to you right now, it'd also make sense to work on that</p>",
        "id": 536732835,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1756452627
    },
    {
        "content": "<p>Basically there is a design decision to be made here. For results like discreteness and cocompactness of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span> in <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"double-struck\">A</mi><mi>K</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathbb{A}_K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8389em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">A</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">K</span></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> you can either just prove it directly for all <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span> using standard facts about integer rings or you can prove it for <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">Q</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Q}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8556em;vertical-align:-0.1667em;\"></span><span class=\"mord mathbb\">Q</span></span></span></span> using essentially nothing mathematically and then deduce it for general <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span> by using the fact that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"double-struck\">A</mi><mi>K</mi></msub><mo>=</mo><msub><mi mathvariant=\"double-struck\">A</mi><mi mathvariant=\"double-struck\">Q</mi></msub><mo>‚äó</mo><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{A}_K=\\mathbb{A}_{\\mathbb{Q}}\\otimes K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8389em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">A</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">K</span></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9556em;vertical-align:-0.2667em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">A</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3322em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathbb mtight\">Q</span></span></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2667em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">‚äó</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span> algebraically and topologically. I went for the latter because I felt like it was an important result (for example it reduces the Langlands conjectures over a general number field to the Langlands conjectures for <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">Q</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Q}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8556em;vertical-align:-0.1667em;\"></span><span class=\"mord mathbb\">Q</span></span></span></span> via restriction of scalars) and...well, here we are :-)</p>",
        "id": 536743073,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1756456835
    },
    {
        "content": "<p>I agree with the choice to reduce to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">Q</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Q}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8556em;vertical-align:-0.1667em;\"></span><span class=\"mord mathbb\">Q</span></span></span></span>, but then I was surprised at how much effort the proof was taking relative to its mathematical content, and it's probably because we're missing some API here. (For example we ideally want statements like the one <a href=\"https://github.com/mariainesdff/LocalClassFieldTheory/blob/2b0994f595ab9d2daaef0bfbc04c6d1368f60df5/LocalClassFieldTheory/PadicCompare.lean#L275\">here</a> relating <code>adicCompletion</code>, which is used in <code>FiniteAdeleRing</code>, to <code>Padic</code>, but apparently this is not in mathlib yet.) However I then realised that we have an exactly mathematically equivalent statement <code>QHat.rat_join_zHat</code> proved in chapter 5 of the blueprint for <code>QHat</code>, and so now I think we should also try to relate <code>QHat</code> and <code>FiniteAdeleRing</code>.</p>",
        "id": 536897828,
        "sender_full_name": "Bryan Wang",
        "timestamp": 1756539932
    },
    {
        "content": "<p>Yeah chapter 5 was an experiment to see if this definition was more fun. One question is whether mathlib should have a bespoke ZHat type; the last time I asked it just degenerated into a conversation of how to define it without ever really deciding whether it should be there or not</p>",
        "id": 536908356,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1756553800
    },
    {
        "content": "<p>The holiday season is over as far as I am concerned, and I am now finally back to spending several hours a day on FLT, so things are going to start moving again after a very slow 6 weeks or so. </p>\n<p>It seems to me that this approach (define <code>ZHat</code> in a totally concrete way as is done in FLT, define <code>QHat</code> as Q tensor ZHat, prove stuff about QHat using fun concrete calculations, deduce things about <code>FiniteAdeleRing (ùìû ‚Ñö) ‚Ñö</code> via the isomorphism) is definitely one approach; I suspect that in some sense we are doing exactly the same thing for the infinite adele ring; the infinite adele ring of <code>Rat</code> is some product over a one-element set of a completion which is not at all defeq to <code>Real</code>, but is uniquely isomorphic to <code>Real</code>.</p>",
        "id": 537087669,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1756725531
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"934803\">Bryan Wang</span> <a href=\"#narrow/channel/416277-FLT/topic/Adeles.20over.20Q/near/536897828\">said</a>:</p>\n<blockquote>\n<p>we ideally want statements like the one <a href=\"https://github.com/mariainesdff/LocalClassFieldTheory/blob/2b0994f595ab9d2daaef0bfbc04c6d1368f60df5/LocalClassFieldTheory/PadicCompare.lean#L275\">here</a> relating <code>adicCompletion</code>, which is used in <code>FiniteAdeleRing</code>, to <code>Padic</code>, but apparently this is not in mathlib yet.</p>\n</blockquote>\n<p>This is in mathlib as of last week: <a href=\"https://github.com/leanprover-community/mathlib4/pull/27696\">#27696</a> -- should help streamline the <code>Rat</code> proofs!</p>",
        "id": 537239761,
        "sender_full_name": "Salvatore Mercuri",
        "timestamp": 1756803606
    },
    {
        "content": "<p>Yes, and I plan on adding a similar equiv showing Z_p iso to the corresponding Completion (WithVal v_p)</p>",
        "id": 537255058,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1756808954
    },
    {
        "content": "<p>I guess we also need something linking the Completion (WithVal v_p) to adicCompletion pAsIdeal</p>",
        "id": 537256294,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1756809321
    }
]