[
    {
        "content": "<p>I didn't update Lean on my local copy of PFR for a while, and when I tried to do so recently, I got this error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"ss\">`c</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">teort</span><span class=\"bp\">\\.</span><span class=\"n\">elan</span><span class=\"bp\">\\</span><span class=\"n\">toolchains</span><span class=\"bp\">\\</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.13.0\\bin\\lake.exe setup-file C:/Users/teort/Dropbox/Lean/pfr/PFR/MoreRuzsaDist.lean Init Mathlib.Algebra.Group.Fin.Basic PFR.Mathlib.Probability.ConditionalProbability PFR.ForMathlib.Entropy.RuzsaDist` failed:</span>\n\n<span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"n\">trace</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">.\\.\\.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">mathlib</span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">fetch</span><span class=\"w\"> </span><span class=\"c1\">--tags --force origin</span>\n<span class=\"n\">trace</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"n\">From</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span>\n<span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">branch</span><span class=\"o\">]</span><span class=\"w\">              </span><span class=\"n\">AffineLocalToPretop</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">origin</span><span class=\"bp\">/</span><span class=\"n\">AffineLocalToPretop</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">updating</span><span class=\"w\"> </span><span class=\"n\">repository</span><span class=\"w\"> </span><span class=\"bp\">'.\\.\\.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">mathlib'</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">revision</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">df174a8a32fb9b7661ec4faa48a6a6a6bb4cf0d5'</span>\n<span class=\"n\">trace</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">.\\.\\.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">mathlib</span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">checkout</span><span class=\"w\"> </span><span class=\"c1\">--detach df174a8a32fb9b7661ec4faa48a6a6a6bb4cf0d5 --</span>\n<span class=\"n\">trace</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">The</span><span class=\"w\"> </span><span class=\"n\">following</span><span class=\"w\"> </span><span class=\"n\">untracked</span><span class=\"w\"> </span><span class=\"n\">working</span><span class=\"w\"> </span><span class=\"n\">tree</span><span class=\"w\"> </span><span class=\"n\">files</span><span class=\"w\"> </span><span class=\"n\">would</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">overwritten</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">checkout</span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">Int</span><span class=\"bp\">/</span><span class=\"n\">Order</span><span class=\"bp\">/</span><span class=\"n\">Basic</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"w\">    </span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">Nat</span><span class=\"bp\">/</span><span class=\"n\">Sqrt</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"w\">    </span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">GroupTheory</span><span class=\"bp\">/</span><span class=\"n\">GroupAction</span><span class=\"bp\">/</span><span class=\"n\">Defs</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"n\">Please</span><span class=\"w\"> </span><span class=\"n\">move</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">remove</span><span class=\"w\"> </span><span class=\"n\">them</span><span class=\"w\"> </span><span class=\"n\">before</span><span class=\"w\"> </span><span class=\"n\">you</span><span class=\"w\"> </span><span class=\"n\">switch</span><span class=\"w\"> </span><span class=\"n\">branches</span><span class=\"bp\">.</span>\n<span class=\"n\">Aborting</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">external</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">git'</span><span class=\"w\"> </span><span class=\"n\">exited</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"n\">Invalid</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">configuration</span><span class=\"bp\">.</span><span class=\"w\">  </span><span class=\"n\">Please</span><span class=\"w\"> </span><span class=\"n\">restart</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">server</span><span class=\"w\"> </span><span class=\"n\">after</span><span class=\"w\"> </span><span class=\"n\">fixing</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">configuration</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"bp\">.</span>\n</code></pre></div>\n<p>I assume this has something to do with the Mathlib upstreaming.  I cannot find these untracked files; I have run <code>git clean -fd</code> and <code>git reset --hard origin/master</code> to no avail.  Is there any option short of nuking my personal repository and starting over?</p>",
        "id": 480487390,
        "sender_full_name": "Terence Tao",
        "timestamp": 1730739444
    },
    {
        "content": "<p>It looks like you edited certain files and you're being warned that the edits are going to be overwritten. When I'm in this situation I fire up VS Code and see what the git thing on the left has to say, usually there is some blue number informing me how many files I've messed with and I just use VS Code to revert all the edits I made.</p>",
        "id": 480491012,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1730740666
    },
    {
        "content": "<p>Lake puts dependents such as Mathlib under the directory <code>.lake</code> in your repository. Here it is calling <code>git</code> to update Mathlib in <code>.lake/packages/mathlib</code>. <code>git</code> detects there are local changes to files in <code>.lake/packages/mathlib</code> (i.e. you have edited some files there), and refuses to update. The easiest thing to do is to delete <code>.lake</code> directory and let lake update again, which will automatically repopulate <code>.lake</code></p>",
        "id": 480500082,
        "sender_full_name": "Thomas Zhu",
        "timestamp": 1730743843
    },
    {
        "content": "<p>The reason commands such as <code>git ...</code> don't work is because the project in the current directory is in a separate git environment than <code>.lake/packages/mathlib</code>. If you go to <code>.lake/packages/mathlib</code> and run e.g. <code>git reset --hard origin/master</code>, it will probably also fix the error</p>",
        "id": 480500373,
        "sender_full_name": "Thomas Zhu",
        "timestamp": 1730743955
    },
    {
        "content": "<p>OK I see now that the files it was complaining about were not in the PFR repository but in the mathlib repository.  Deleting those made everything else work (well, I'm still building the local PFR files, but at least the Mathlib cache got downloaded).  Thanks for the help!</p>",
        "id": 480500984,
        "sender_full_name": "Terence Tao",
        "timestamp": 1730744195
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"657719\">Terence Tao</span> has marked this topic as resolved.</p>",
        "id": 480500997,
        "sender_full_name": "Notification Bot",
        "timestamp": 1730744198
    },
    {
        "content": "<p>Remark: In more recent versions of the Lean VSCode extension, Mathlib files opened within a project are opened in read-only mode, so it will be much more unlikely to run into this issue in the future.</p>",
        "id": 480992574,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1730923891
    },
    {
        "content": "<p>Oh, interesting. Can you say more about when/where? I'm on... <code>v0.0.184</code> it looks like, and if I open a file in <code>.lake/packages/mathlib</code> VSCode seems happy to let me modify and save it.</p>",
        "id": 481003405,
        "sender_full_name": "Julian Berman",
        "timestamp": 1730928342
    },
    {
        "content": "<p>Is this for mathlib or dependencies in general?</p>",
        "id": 481113044,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730983837
    },
    {
        "content": "<p>Oh, this seems to be a setting enabled in Mathlib, not in the extension.<br>\nThe relevant lines seem to be in <code>.vscode/settings.json</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"s2\">\"files.readonlyInclude\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"s2\">\"**/.elan/**\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"s2\">\"**/.lake/**\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"w\">  </span><span class=\"o\">}</span>\n</code></pre></div>\n<p>Should we include these lines by default when creating a new project with <code>lake new</code> (<span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span>) and in <code>LeanProject</code> (<span class=\"user-mention\" data-user-id=\"556875\">@Pietro Monticone</span>)?</p>",
        "id": 481118068,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1730985293
    },
    {
        "content": "<p>(note that VSCode will give you a gentle warning, and you can turn off the read-only mode with a single click, so it shouldn't be obtrusive even if people want to edit their dependencies for some reason.)</p>",
        "id": 481118416,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1730985400
    },
    {
        "content": "<p>Oh, didn’t know about that. I’ll add it to the LeanProject template later. </p>\n<p>Thank you, Floris!</p>",
        "id": 481134390,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730990174
    },
    {
        "content": "<p>I've also just stolen that default <a href=\"https://github.com/Julian/lean.nvim/blob/07c9dc1279b63fe500bcb16329e91a30854f3ce0/lua/lean/config.lua#L53-L57\">for <code>lean.nvim</code></a>.</p>",
        "id": 481187086,
        "sender_full_name": "Julian Berman",
        "timestamp": 1731008069
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321696\">@Julian Berman</span> the setting seems more appropriate for specific project templates than forcing it down every user</p>",
        "id": 481195751,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731011654
    },
    {
        "content": "<p>Through the editor</p>",
        "id": 481195768,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731011660
    },
    {
        "content": "<p>Especially in vim where files don't open in append mode by default</p>",
        "id": 481195789,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731011676
    },
    {
        "content": "<p>What do you mean by append mode? (To me it's not obvious why one project should be different from another for this, and it's equally easy to override in neovim as in VSCode, which is why it seemed fine to add.)</p>",
        "id": 481201532,
        "sender_full_name": "Julian Berman",
        "timestamp": 1731014235
    },
    {
        "content": "<p>I am not strong on vim lingo but there is edit mode/insert mode/append mode and there is the mode where one gives commands</p>",
        "id": 481203211,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731015072
    },
    {
        "content": "<p>Vscode isn't modal so no extra steps are needed to start editing</p>",
        "id": 481203261,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731015094
    },
    {
        "content": "<p>Also, text editor preferences should be upto users</p>",
        "id": 481203298,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731015112
    },
    {
        "content": "<p>Got it, you were referring to insert mode.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/412902-Polynomial-Freiman-Ruzsa-conjecture/topic/.E2.9C.94.20Local.20build.20issue/near/481203261\">said</a>:</p>\n<blockquote>\n<p>Vscode isn't modal so no extra steps are needed to start editing</p>\n</blockquote>\n<p>One doesn't need to be in insert mode to edit text in vim either (in fact that's at least partially why it's not wise to be in insert mode most of the time). You can hit <code>x</code> and accidentally delete a character.</p>\n<p>But if anything isn't the argument you're making worse for projects? Yes, a user should have control of this setting, and it seems surprising to me as a user if on one project I'm protected from accidentally modifying a toolchain and on another I'm not. But in either case the user can override the setting.</p>",
        "id": 481206374,
        "sender_full_name": "Julian Berman",
        "timestamp": 1731016546
    },
    {
        "content": "<p>The setting in VSCode seemed like it's meant to be used for \"this project has some additional files that are autogenerated, not \"it never makes sense to edit these files in this programming language\" (again with an option to turn it off)</p>",
        "id": 481206620,
        "sender_full_name": "Julian Berman",
        "timestamp": 1731016664
    }
]