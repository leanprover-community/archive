[
    {
        "content": "<p>Hi all! When working on this project, I've kept running into issues with cache files, which tends to be rather annoying since the only workaround I've found is to delete everything and build manually, and even this doesn't work systematically. </p>\n<p>I usually work on a fork, which I create by using the Lean \"Download Project\" tool on VS code, and run <code>lake exe cache get</code>. This seems to have issues with getting the cache for certain files (e.g. whenever I open <code>ruzsa_distance.lean</code>, Lean tells me that the imports of that file are out of date and I end up having to recompile most of those manually). Is there something I am doing wrong here?</p>\n<p>I've also noticed that things seem to get even worse when I try to do git manipulations. For instance yesterday I ran <code>git merge https://github.com/teorth/pfr</code> on my fork to get the upstream changes, and for some reason Lean then wanted to recompile most of Mathlib.</p>",
        "id": 403921071,
        "sender_full_name": "Paul Lezeau",
        "timestamp": 1700814402
    },
    {
        "content": "<p>Instead of clicking <code>Rebuild imports</code>, you should run <code>lake exe cache get</code>. The fact that you have a choice here is why rebuilding is not automatic anymore.</p>",
        "id": 403921226,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1700814472
    },
    {
        "content": "<p>... or well that can also mean you changed one upstream file, in which case <code>Rebuild imports</code> will only rebuild that one file.</p>",
        "id": 403921421,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1700814546
    },
    {
        "content": "<p>Ok fair enough. I just ran that, and the output I got was </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">Attempting</span> <span class=\"n\">to</span> <span class=\"n\">download</span> <span class=\"mi\">9</span> <span class=\"n\">file</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span>\n<span class=\"n\">Downloaded</span><span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"n\">file</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">attempted</span> <span class=\"mi\">9</span><span class=\"bp\">/</span><span class=\"mi\">9</span> <span class=\"bp\">=</span> <span class=\"mi\">100</span><span class=\"bp\">%</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"bp\">%</span> <span class=\"n\">success</span><span class=\"o\">)</span>\n<span class=\"n\">Warning</span><span class=\"o\">:</span> <span class=\"n\">some</span> <span class=\"n\">files</span> <span class=\"n\">were</span> <span class=\"n\">not</span> <span class=\"n\">found</span> <span class=\"k\">in</span> <span class=\"n\">the</span> <span class=\"n\">cache.</span>\n<span class=\"n\">This</span> <span class=\"n\">usually</span> <span class=\"n\">means</span> <span class=\"n\">that</span> <span class=\"n\">your</span> <span class=\"kn\">local</span> <span class=\"n\">checkout</span> <span class=\"n\">of</span> <span class=\"n\">mathlib4</span> <span class=\"n\">has</span> <span class=\"n\">diverged</span> <span class=\"k\">from</span> <span class=\"n\">upstream.</span>\n<span class=\"n\">If</span> <span class=\"n\">you</span> <span class=\"n\">push</span> <span class=\"n\">your</span> <span class=\"n\">commits</span> <span class=\"n\">to</span> <span class=\"n\">a</span> <span class=\"n\">branch</span> <span class=\"n\">of</span> <span class=\"n\">the</span> <span class=\"n\">mathlib4</span> <span class=\"n\">repository</span><span class=\"o\">,</span> <span class=\"n\">CI</span> <span class=\"n\">will</span> <span class=\"n\">build</span> <span class=\"n\">the</span> <span class=\"n\">oleans</span> <span class=\"n\">and</span> <span class=\"n\">they</span> <span class=\"n\">will</span> <span class=\"n\">be</span> <span class=\"n\">available</span> <span class=\"n\">later.</span>\n<span class=\"n\">Decompressing</span> <span class=\"mi\">3922</span> <span class=\"n\">file</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span>\n<span class=\"n\">unpacked</span> <span class=\"k\">in</span> <span class=\"mi\">72</span> <span class=\"n\">ms</span>\n</code></pre></div>",
        "id": 403921425,
        "sender_full_name": "Paul Lezeau",
        "timestamp": 1700814548
    },
    {
        "content": "<p>Yep, that's completely expected. We're not caching PFR.</p>",
        "id": 403921464,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1700814566
    },
    {
        "content": "<p>Right ok that makes sense! I thought this was a problem with my installation so I was desperately trying to figure out what was going on</p>",
        "id": 403921686,
        "sender_full_name": "Paul Lezeau",
        "timestamp": 1700814656
    },
    {
        "content": "<p>I restarted the Lean server on the same file <code>ruzsa_distance.lean</code> after following what you said, and this is what I got</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">`</span><span class=\"n\">c</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">paull</span><span class=\"bp\">\\.</span><span class=\"n\">elan</span><span class=\"bp\">\\</span><span class=\"n\">toolchains</span><span class=\"bp\">\\</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.3.0-rc2\\bin\\lake.exe print-paths Init Mathlib.Probability.Notation Mathlib.Probability.ConditionalProbability Mathlib.Probability.IdentDistrib PFR.Entropy.KernelRuzsa PFR.entropy_basic PFR.ForMathlib.FiniteMeasureComponent PFR.f2_vec` failed:</span>\n\n<span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"o\">[</span><span class=\"mi\">623</span><span class=\"bp\">/</span><span class=\"mi\">1985</span><span class=\"o\">]</span> <span class=\"n\">Building</span> <span class=\"n\">ProofWidgets.Compat</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"o\">[</span><span class=\"mi\">1502</span><span class=\"bp\">/</span><span class=\"mi\">1985</span><span class=\"o\">]</span> <span class=\"n\">Building</span> <span class=\"n\">PFR.ForMathlib.Jensen</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"o\">[</span><span class=\"mi\">1771</span><span class=\"bp\">/</span><span class=\"mi\">1985</span><span class=\"o\">]</span> <span class=\"n\">Building</span> <span class=\"n\">PFR.ForMathlib.Finiteness</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"o\">[</span><span class=\"mi\">1953</span><span class=\"bp\">/</span><span class=\"mi\">1985</span><span class=\"o\">]</span> <span class=\"n\">Building</span> <span class=\"n\">PFR.ForMathlib.Miscellaneous</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"o\">[</span><span class=\"mi\">1953</span><span class=\"bp\">/</span><span class=\"mi\">1985</span><span class=\"o\">]</span> <span class=\"n\">Building</span> <span class=\"n\">PFR.ForMathlib.Independence</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"bp\">&gt;</span>\n<span class=\"n\">LEAN_PATH</span><span class=\"bp\">=.\\.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">std</span><span class=\"bp\">\\.</span><span class=\"n\">lake</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">;.\\.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">Qq</span><span class=\"bp\">\\.</span><span class=\"n\">lake</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">;.\\.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">aesop</span><span class=\"bp\">\\.</span><span class=\"n\">lake</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">;.\\.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">Cli</span><span class=\"bp\">\\.</span><span class=\"n\">lake</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">;.\\.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">proofwidgets</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">;.\\.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">mathlib</span><span class=\"bp\">\\.</span><span class=\"n\">lake</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">;.\\.</span><span class=\"n\">lake</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span> <span class=\"n\">PATH</span> <span class=\"n\">c</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">paull</span><span class=\"bp\">\\.</span><span class=\"n\">elan</span><span class=\"bp\">\\</span><span class=\"n\">toolchains</span><span class=\"bp\">\\</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.3.0-rc2\\bin\\lean.exe .\\.lake/packages\\proofwidgets\\.\\.\\ProofWidgets\\Compat.lean -R .\\.lake/packages\\proofwidgets\\.\\. -o .\\.lake/packages\\proofwidgets\\build\\lib\\ProofWidgets\\Compat.olean -i .\\.lake/packages\\proofwidgets\\build\\lib\\ProofWidgets\\Compat.ilean -c .\\.lake/packages\\proofwidgets\\build\\ir\\ProofWidgets\\Compat.c</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">stdout</span><span class=\"o\">:</span>\n<span class=\"bp\">.\\.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">proofwidgets</span><span class=\"bp\">\\.\\.\\</span><span class=\"n\">ProofWidgets</span><span class=\"bp\">\\</span><span class=\"n\">Compat.lean</span><span class=\"o\">:</span><span class=\"mi\">174</span><span class=\"o\">:</span><span class=\"mi\">16</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">no</span> <span class=\"n\">such</span> <span class=\"n\">file</span> <span class=\"n\">or</span> <span class=\"n\">directory</span> <span class=\"o\">(</span><span class=\"n\">error</span> <span class=\"n\">code</span><span class=\"o\">:</span> <span class=\"mi\">2</span><span class=\"o\">)</span>\n<span class=\"n\">file</span><span class=\"o\">:</span> <span class=\"bp\">.\\.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">proofwidgets</span><span class=\"bp\">\\.\\.\\</span><span class=\"n\">ProofWidgets</span><span class=\"bp\">\\..\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">js</span><span class=\"bp\">\\</span><span class=\"n\">compat.js</span>\n<span class=\"bp\">.\\.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">proofwidgets</span><span class=\"bp\">\\.\\.\\</span><span class=\"n\">ProofWidgets</span><span class=\"bp\">\\</span><span class=\"n\">Compat.lean</span><span class=\"o\">:</span><span class=\"mi\">170</span><span class=\"o\">:</span><span class=\"mi\">2</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">cannot</span> <span class=\"n\">evaluate</span> <span class=\"n\">code</span> <span class=\"n\">because</span> <span class=\"bp\">'</span><span class=\"n\">sorryAx'</span> <span class=\"n\">uses</span> <span class=\"bp\">'</span><span class=\"gr\">sorry</span><span class=\"bp\">'</span> <span class=\"n\">and</span><span class=\"bp\">/</span><span class=\"n\">or</span> <span class=\"n\">contains</span> <span class=\"n\">errors</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">external</span> <span class=\"n\">command</span> <span class=\"bp\">`</span><span class=\"n\">c</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">paull</span><span class=\"bp\">\\.</span><span class=\"n\">elan</span><span class=\"bp\">\\</span><span class=\"n\">toolchains</span><span class=\"bp\">\\</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.3.0-rc2\\bin\\lean.exe` exited with code 1</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"o\">[</span><span class=\"mi\">1954</span><span class=\"bp\">/</span><span class=\"mi\">1985</span><span class=\"o\">]</span> <span class=\"n\">Building</span> <span class=\"n\">PFR.MeasureReal</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"o\">[</span><span class=\"mi\">1958</span><span class=\"bp\">/</span><span class=\"mi\">1985</span><span class=\"o\">]</span> <span class=\"n\">Building</span> <span class=\"n\">PFR.neg_xlogx</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"o\">[</span><span class=\"mi\">1959</span><span class=\"bp\">/</span><span class=\"mi\">1985</span><span class=\"o\">]</span> <span class=\"n\">Building</span> <span class=\"n\">PFR.Entropy.Measure</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"o\">[</span><span class=\"mi\">1960</span><span class=\"bp\">/</span><span class=\"mi\">1985</span><span class=\"o\">]</span> <span class=\"n\">Building</span> <span class=\"n\">PFR.Entropy.MeasureCompProd</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"o\">[</span><span class=\"mi\">1961</span><span class=\"bp\">/</span><span class=\"mi\">1985</span><span class=\"o\">]</span> <span class=\"n\">Building</span> <span class=\"n\">PFR.Entropy.Disintegration</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"o\">[</span><span class=\"mi\">1962</span><span class=\"bp\">/</span><span class=\"mi\">1985</span><span class=\"o\">]</span> <span class=\"n\">Building</span> <span class=\"n\">PFR.Entropy.Kernel</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"o\">[</span><span class=\"mi\">1963</span><span class=\"bp\">/</span><span class=\"mi\">1985</span><span class=\"o\">]</span> <span class=\"n\">Building</span> <span class=\"n\">PFR.Entropy.KernelMutualInformation</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"o\">[</span><span class=\"mi\">1964</span><span class=\"bp\">/</span><span class=\"mi\">1985</span><span class=\"o\">]</span> <span class=\"n\">Building</span> <span class=\"n\">PFR.Entropy.Group</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"o\">[</span><span class=\"mi\">1964</span><span class=\"bp\">/</span><span class=\"mi\">1985</span><span class=\"o\">]</span> <span class=\"n\">Building</span> <span class=\"n\">PFR.entropy_basic</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"o\">[</span><span class=\"mi\">1965</span><span class=\"bp\">/</span><span class=\"mi\">1985</span><span class=\"o\">]</span> <span class=\"n\">Building</span> <span class=\"n\">PFR.Entropy.KernelRuzsa</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">stdout</span><span class=\"o\">:</span>\n<span class=\"bp\">.\\.\\.\\</span><span class=\"n\">PFR</span><span class=\"bp\">\\</span><span class=\"n\">entropy_basic.lean</span><span class=\"o\">:</span><span class=\"mi\">157</span><span class=\"o\">:</span><span class=\"mi\">6</span><span class=\"o\">:</span> <span class=\"n\">warning</span><span class=\"o\">:</span> <span class=\"n\">declaration</span> <span class=\"n\">uses</span> <span class=\"bp\">'</span><span class=\"gr\">sorry</span><span class=\"bp\">'</span>\n<span class=\"bp\">.\\.\\.\\</span><span class=\"n\">PFR</span><span class=\"bp\">\\</span><span class=\"n\">entropy_basic.lean</span><span class=\"o\">:</span><span class=\"mi\">162</span><span class=\"o\">:</span><span class=\"mi\">6</span><span class=\"o\">:</span> <span class=\"n\">warning</span><span class=\"o\">:</span> <span class=\"n\">declaration</span> <span class=\"n\">uses</span> <span class=\"bp\">'</span><span class=\"gr\">sorry</span><span class=\"bp\">'</span>\n<span class=\"bp\">.\\.\\.\\</span><span class=\"n\">PFR</span><span class=\"bp\">\\</span><span class=\"n\">entropy_basic.lean</span><span class=\"o\">:</span><span class=\"mi\">224</span><span class=\"o\">:</span><span class=\"mi\">6</span><span class=\"o\">:</span> <span class=\"n\">warning</span><span class=\"o\">:</span> <span class=\"n\">declaration</span> <span class=\"n\">uses</span> <span class=\"bp\">'</span><span class=\"gr\">sorry</span><span class=\"bp\">'</span>\n<span class=\"bp\">.\\.\\.\\</span><span class=\"n\">PFR</span><span class=\"bp\">\\</span><span class=\"n\">entropy_basic.lean</span><span class=\"o\">:</span><span class=\"mi\">243</span><span class=\"o\">:</span><span class=\"mi\">6</span><span class=\"o\">:</span> <span class=\"n\">warning</span><span class=\"o\">:</span> <span class=\"n\">declaration</span> <span class=\"n\">uses</span> <span class=\"bp\">'</span><span class=\"gr\">sorry</span><span class=\"bp\">'</span>\n<span class=\"bp\">.\\.\\.\\</span><span class=\"n\">PFR</span><span class=\"bp\">\\</span><span class=\"n\">entropy_basic.lean</span><span class=\"o\">:</span><span class=\"mi\">741</span><span class=\"o\">:</span><span class=\"mi\">4</span><span class=\"o\">:</span> <span class=\"n\">warning</span><span class=\"o\">:</span> <span class=\"n\">declaration</span> <span class=\"n\">uses</span> <span class=\"bp\">'</span><span class=\"gr\">sorry</span><span class=\"bp\">'</span>\n<span class=\"bp\">.\\.\\.\\</span><span class=\"n\">PFR</span><span class=\"bp\">\\</span><span class=\"n\">entropy_basic.lean</span><span class=\"o\">:</span><span class=\"mi\">744</span><span class=\"o\">:</span><span class=\"mi\">6</span><span class=\"o\">:</span> <span class=\"n\">warning</span><span class=\"o\">:</span> <span class=\"n\">declaration</span> <span class=\"n\">uses</span> <span class=\"bp\">'</span><span class=\"gr\">sorry</span><span class=\"bp\">'</span>\n<span class=\"bp\">.\\.\\.\\</span><span class=\"n\">PFR</span><span class=\"bp\">\\</span><span class=\"n\">entropy_basic.lean</span><span class=\"o\">:</span><span class=\"mi\">961</span><span class=\"o\">:</span><span class=\"mi\">6</span><span class=\"o\">:</span> <span class=\"n\">warning</span><span class=\"o\">:</span> <span class=\"n\">declaration</span> <span class=\"n\">uses</span> <span class=\"bp\">'</span><span class=\"gr\">sorry</span><span class=\"bp\">'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">stdout</span><span class=\"o\">:</span>\n<span class=\"bp\">.\\.\\.\\</span><span class=\"n\">PFR</span><span class=\"bp\">\\</span><span class=\"n\">Entropy</span><span class=\"bp\">\\</span><span class=\"n\">KernelRuzsa.lean</span><span class=\"o\">:</span><span class=\"mi\">214</span><span class=\"o\">:</span><span class=\"mi\">6</span><span class=\"o\">:</span> <span class=\"n\">warning</span><span class=\"o\">:</span> <span class=\"n\">declaration</span> <span class=\"n\">uses</span> <span class=\"bp\">'</span><span class=\"gr\">sorry</span><span class=\"bp\">'</span>\n</code></pre></div>",
        "id": 403922120,
        "sender_full_name": "Paul Lezeau",
        "timestamp": 1700814864
    },
    {
        "content": "<p>This was at the top of the file, with a bunch of red everywhere :(</p>",
        "id": 403922267,
        "sender_full_name": "Paul Lezeau",
        "timestamp": 1700814935
    },
    {
        "content": "<p>The latter messages are expected. The ones about ProofWidgets not so much (but it might not be our fault because there's a caching problem right for ProofWidgets).</p>",
        "id": 403922500,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1700815031
    },
    {
        "content": "<p>Right ok. So this possibly is a problem with my installation?</p>",
        "id": 403922795,
        "sender_full_name": "Paul Lezeau",
        "timestamp": 1700815160
    },
    {
        "content": "<p>I can't reproduce, so yes maybe.</p>",
        "id": 403923367,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1700815384
    },
    {
        "content": "<p>Try wiping <code>.lake</code> entirely and rerun <code>lake exe cache get</code>.</p>",
        "id": 403923430,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1700815410
    },
    {
        "content": "<p>Ok this seems to work now, thanks a lot for the help!</p>",
        "id": 403926502,
        "sender_full_name": "Paul Lezeau",
        "timestamp": 1700816630
    },
    {
        "content": "<p>I'm not sure how exactly this problem with the <code>.lake</code> file arose - I've had it on every branch I made for this project, and also when I tried to use a Codespace online</p>",
        "id": 403927115,
        "sender_full_name": "Paul Lezeau",
        "timestamp": 1700816835
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 403927357,
        "sender_full_name": "Paul Lezeau",
        "timestamp": 1700816934
    }
]