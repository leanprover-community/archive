[
    {
        "content": "<p>Hello, is there a way to convert a Hamiltonian path to a bijection with <code>Fin n</code>?<br>\nSomething like the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"bp\">.</span><span class=\"n\">IsHamiltonian</span><span class=\"bp\">.</span><span class=\"n\">equivFin</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">≃</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">support</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>and maybe even more specifically that <code>p.getVert</code> is that bijection, and an instance of <code>Fintype</code>.<br>\nThanks!</p>",
        "id": 538529855,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1757450842
    },
    {
        "content": "<p>I was searching for something like that for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=SimpleGraph.Walk.IsCycle#doc\">docs#SimpleGraph.Walk.IsCycle</a> and couldn't find anything.</p>",
        "id": 538612971,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1757499252
    },
    {
        "content": "<p>apply? followed by two exact?s proves the given statement (+ Hamiltonian hypothesis)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"bp\">.</span><span class=\"n\">IsHamiltonian</span><span class=\"bp\">.</span><span class=\"n\">equivFin</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">IsHamiltonian</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">≃</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">support</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">Nodup</span><span class=\"bp\">.</span><span class=\"n\">getEquivOfForallMemList</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">support</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">nodup_iff_count_eq_one</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a_1</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">a_1</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">mem_support</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div>",
        "id": 538645221,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1757509140
    },
    {
        "content": "<p>Wow, thanks! Do you think Mathlib will accept something like this?</p>",
        "id": 538645711,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1757509253
    },
    {
        "content": "<p>There is already <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Combinatorics/SimpleGraph/Hamiltonian.html#SimpleGraph.Walk.IsHamiltonian.length_eq\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/Combinatorics/SimpleGraph/Hamiltonian.html#SimpleGraph.Walk.IsHamiltonian.length_eq</a> for the case of <code>Fintype \\a</code>, does that work?</p>",
        "id": 538647164,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1757509643
    },
    {
        "content": "<p>As a side note, I would suggest making <code>(p : G.Walk a b)</code> argument implicit. It can be deduced from <code>(h : p.IsHamiltonian)</code>.</p>",
        "id": 538647634,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1757509770
    },
    {
        "content": "<p>This instance seems fairly nice to have:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"bp\">.</span><span class=\"n\">IsHamiltonian</span><span class=\"bp\">.</span><span class=\"n\">finite</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">IsHamiltonian</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finite</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">finite_iff_exists_equiv_fin</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">support</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">⟨?_⟩⟩</span>\n<span class=\"w\">  </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">Nodup</span><span class=\"bp\">.</span><span class=\"n\">getEquivOfForallMemList</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">support</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">nodup_iff_count_eq_one</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a_1</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">a_1</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">mem_support</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div>\n<p>I'll clean it up and submit it</p>",
        "id": 538650609,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1757510565
    },
    {
        "content": "<p>What's the use case for <code>SimpleGraph.Walk.IsHamiltonian.finite</code>?</p>",
        "id": 538655017,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1757511621
    },
    {
        "content": "<p>Ah, it's an <code>instance</code>. Yeah, it does sound useful.</p>",
        "id": 538655803,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1757511824
    },
    {
        "content": "<p>I think, you could also do <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Fintype#doc\">docs#Fintype</a> ?</p>",
        "id": 538656408,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1757511987
    },
    {
        "content": "<p>Or even only <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Fintype#doc\">docs#Fintype</a>, as <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Finite#doc\">docs#Finite</a> follows from <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Fintype#doc\">docs#Fintype</a>.</p>",
        "id": 538656639,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1757512040
    },
    {
        "content": "<p>I’m not sure if that instance will ever be synthesized, since it takes a proof (AFAIK instances only get synthesized from other instances). I wouldn’t add a Fintype instance for sure, because it’s data, you will get diamonds. You only want to add such an instance if it’s canonical.</p>",
        "id": 538659560,
        "sender_full_name": "Lawrence Wu (llllvvuu)",
        "timestamp": 1757512781
    },
    {
        "content": "<p>Is the proper procedure in cases like this to leave it as a def then? It seems useful to be able to able to get a Finite instance, and though I doubt there's many people working with SimpleGraph constructively, Fintype as well I suppose</p>",
        "id": 538660782,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1757513042
    },
    {
        "content": "<p>I don't think it's possible to make this into an instance (even if <code>IsHamiltonian</code> would be a class) since instance search always goes backwards and there no way to determine <code>h</code>, <code>p</code>, <code>u</code>, <code>v</code> or <code>G</code> from <code>Finite V</code></p>",
        "id": 538662298,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1757513413
    },
    {
        "content": "<p>You can keep this as a theorem and then use <code>have := h.finite</code> at the use site though</p>",
        "id": 538662427,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1757513444
    },
    {
        "content": "<p>If it's def, and not instance, than wouldn't adding Fintype be fine?</p>",
        "id": 538662967,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1757513570
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/29502\">#29502</a></p>",
        "id": 538664948,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1757514049
    },
    {
        "content": "<p>The name's a bit ambiguous in my opinion. Maybe <code>IsHamiltonian.finiteVerts</code> or <code>IsHamiltonian.finiteVertex</code>? Not sure which one.</p>",
        "id": 538670348,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1757515345
    },
    {
        "content": "<p>Plural makes more sense grammatically to me. But e.g. <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Combinatorics/SimpleGraph/Connectivity/WalkCounting.html#SimpleGraph.instFiniteConnectedComponent\">SimpleGraph.instFiniteConnectedComponent</a> uses singular.</p>",
        "id": 538671463,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1757515568
    },
    {
        "content": "<p>FWIW there's also <a href=\"https://github.com/leanprover-community/mathlib4/pull/30149\">#30149</a> <a href=\"https://github.com/leanprover-community/mathlib4/pull/30206\">#30206</a> <a href=\"https://github.com/leanprover-community/mathlib4/pull/30224\">#30224</a></p>",
        "id": 546508486,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1761152496
    }
]