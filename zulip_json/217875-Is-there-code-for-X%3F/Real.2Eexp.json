[
    {
        "content": "<p>Given that the theorem <code>Real.summable_pow_div_factorial</code> is in the library, it was surprising to me that the theorem <code>Real.exp_eq_tsum</code> below was so tricky to prove. Could I have done it without having to deal with <code>NormedSpace.exp</code>?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">SpecialFunctions</span><span class=\"bp\">.</span><span class=\"n\">ContinuousFunctionalCalculus</span><span class=\"bp\">.</span><span class=\"n\">ExpLog</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">summable_pow_div_factorial</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">HasSum_pow_div_factorial</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">HasSum</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">^</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"bp\">↑</span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">factorial</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">exp_eq_exp_ℝ</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">convert</span><span class=\"w\"> </span><span class=\"n\">NormedSpace</span><span class=\"bp\">.</span><span class=\"n\">exp_series_hasSum_exp'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"n\">field_simp</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">exp_eq_tsum</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">∑'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">^</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"bp\">↑</span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">factorial</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">HasSum</span><span class=\"bp\">.</span><span class=\"n\">tsum_eq</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">HasSum_pow_div_factorial</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">symm</span>\n</code></pre></div>\n<p>BTW, the complex versions go through the same way.</p>",
        "id": 489140002,
        "sender_full_name": "Jeremy Avigad",
        "timestamp": 1734319156
    },
    {
        "content": "<p>There's an open issue somewhere about merging the three exps</p>",
        "id": 489145992,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1734324184
    },
    {
        "content": "<p>But going via NormedSpace.exp feels like the right approach to me</p>",
        "id": 489146105,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1734324288
    },
    {
        "content": "<p>I thought the reason we didn't want to merge them was due to import hierarchy reasons. Am I wrong?</p>",
        "id": 489146909,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1734324992
    },
    {
        "content": "<p>Maybe, but <code>NormedSpace.exp</code> doesn't actually mention a norm at all, so it could be moved to a much earlier file</p>",
        "id": 489147050,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1734325124
    },
    {
        "content": "<p>Also, there's a much shorter proof since we have the <code>tsum</code> result for <code>NormedSpace.exp</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">SpecialFunctions</span><span class=\"bp\">.</span><span class=\"n\">ContinuousFunctionalCalculus</span><span class=\"bp\">.</span><span class=\"n\">ExpLog</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">exp_eq_tsum</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">∑'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">^</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"bp\">↑</span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">factorial</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">exp_eq_exp_ℝ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">NormedSpace</span><span class=\"bp\">.</span><span class=\"n\">exp_eq_tsum_div</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 489147334,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1734325281
    },
    {
        "content": "<p>Found with guessing or <span class=\"user-mention\" data-user-id=\"644391\">@loogle</span> NormedSpace.exp, tsum</p>",
        "id": 489147592,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1734325435
    },
    {
        "content": "<p><span aria-label=\"search\" class=\"emoji emoji-1f50d\" role=\"img\" title=\"search\">:search:</span> <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Analysis/Normed/Algebra/Exponential.html#NormedSpace.exp_eq_tsum_div\">NormedSpace.exp_eq_tsum_div</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Analysis/Normed/Algebra/Exponential.html#NormedSpace.exp_eq_tsum\">NormedSpace.exp_eq_tsum</a></p>",
        "id": 489147593,
        "sender_full_name": "loogle",
        "timestamp": 1734325436
    },
    {
        "content": "<p>Thanks, Eric and Jireh. Even with loogle and leansearch, it took me an embarrassingly long time to figure out how to do it. Once you know that the canonical way to do it is to go through <code>NormedSpace.exp</code>, it's straightforward.</p>",
        "id": 489270870,
        "sender_full_name": "Jeremy Avigad",
        "timestamp": 1734363901
    },
    {
        "content": "<p>I'm not entirely sure that it is the canonical way, but there's certainly room for API development</p>",
        "id": 489281780,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1734366469
    },
    {
        "content": "<p>I would consider <code>NormedSpace.exp</code> the canonical way. If Eric is right and we can unify all these without increasing imports much, then we should do that (although I'm not going to do it at the moment).</p>",
        "id": 489296510,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1734370277
    },
    {
        "content": "<p>If we can, then we can also drop the stupid namespace <span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span></p>",
        "id": 489296658,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1734370317
    }
]