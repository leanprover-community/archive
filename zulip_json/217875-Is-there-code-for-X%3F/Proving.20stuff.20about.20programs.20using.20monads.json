[
    {
        "content": "<p>In a project I have, I'd like to rewrite a purely functionnal program without monads to use mondas (mainly to allow for logging).</p>\n<p>My problem is that in the current version, I can prove things about the behavior of my function (because it does not have monads). With monads I can't find a way to prove the correctness of my function, as it depends on the behavior of my monad.</p>\n<p>As an example, let's take <a href=\"https://leanprover.github.io/functional_programming_in_lean/monads/arithmetic.html\">https://leanprover.github.io/functional_programming_in_lean/monads/arithmetic.html</a>.</p>\n<p>And let's say that my goal is to prove that if my evaluation function returns a number, then I am sure that no division by zero happened.</p>",
        "id": 463971139,
        "sender_full_name": "Thomas Vigouroux",
        "timestamp": 1724226195
    },
    {
        "content": "<p>Is there a easy way to do that ?</p>",
        "id": 463971159,
        "sender_full_name": "Thomas Vigouroux",
        "timestamp": 1724226203
    },
    {
        "content": "<p>Put differently, I'd like to have a function the logs something when it is called, and I'd very much like that to be done without too much hassle in terms of types.</p>",
        "id": 463971473,
        "sender_full_name": "Thomas Vigouroux",
        "timestamp": 1724226291
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">dbg_trace</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"{n}\"</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">*</span><span class=\"n\">n</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 463977229,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724227697
    },
    {
        "content": "<p>Oh god so it's that simple <span aria-label=\"sad\" class=\"emoji emoji-2639\" role=\"img\" title=\"sad\">:sad:</span></p>",
        "id": 463978110,
        "sender_full_name": "Thomas Vigouroux",
        "timestamp": 1724227868
    },
    {
        "content": "<p>Thank you <em>soooo</em> much<br>\nThis was bugging me for days !</p>",
        "id": 463978221,
        "sender_full_name": "Thomas Vigouroux",
        "timestamp": 1724227890
    },
    {
        "content": "<p>As the name suggests, this is for debugging only, not production code. :-)</p>",
        "id": 463981169,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724228727
    },
    {
        "content": "<p>I think it is fine <span aria-label=\"wink\" class=\"emoji emoji-1f609\" role=\"img\" title=\"wink\">:wink:</span> <br>\nThe changes in the code to have proper logging seem a little too much for me, and I am not familiar enough (yet) with functionnal programming to get it right</p>",
        "id": 463981343,
        "sender_full_name": "Thomas Vigouroux",
        "timestamp": 1724228788
    },
    {
        "content": "<p>Oooh, is <code>dbg</code> standing for \"debug\"? TIL</p>",
        "id": 463981386,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1724228807
    },
    {
        "content": "<p>If you want to add non-debug logging, you could write your function to be Monad-polymorphic using a <code>HasLog</code> typeclass; for proving, you use a monad that has a no-op log, but for execution you use a monad that uses <code>IO.println</code></p>",
        "id": 463996251,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1724232898
    },
    {
        "content": "<p>Indeed</p>",
        "id": 463996466,
        "sender_full_name": "Thomas Vigouroux",
        "timestamp": 1724232941
    },
    {
        "content": "<p>I'll try to do that later on then !</p>",
        "id": 463996505,
        "sender_full_name": "Thomas Vigouroux",
        "timestamp": 1724232948
    },
    {
        "content": "<p>This also lets you pick a middle ground where for proving you use a state monad that collects the log messages, so that you can also prove it logs if you really care!</p>",
        "id": 463996543,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1724232957
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/stream/217875-Is-there-code-for-X.3F/topic/Proving.20stuff.20about.20programs.20using.20monads/near/463981386\">said</a>:</p>\n<blockquote>\n<p>Oooh, is <code>dbg</code> standing for \"debug\"? TIL</p>\n</blockquote>\n<p>Is it missing a docstring that explains that?</p>",
        "id": 463996778,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1724233004
    }
]