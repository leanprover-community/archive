[
    {
        "content": "<p>Is there an existing definition for sorting a Multiset by some mapping like <code>def sort_by (r' : β → β → Prop) (f : α → β) (s : Multiset α) : List α :=</code>such that <code>r'</code> is transitive, total, and antisymmetric but <code>f</code> doesn't have any constraints? I can't find anything with Loogle or Moogle, but this feels like something that would be common.</p>\n<p>I also thought it would be a theorem as when I tried to naively pair each term in the multiset with its transformation by <code>f</code> using a Prod (<code>s.map fun x ↦ (x, f x)</code>) then sort it, I run into issues with formalizing IsAntisymm.</p>",
        "id": 491385749,
        "sender_full_name": "Tristan Figueroa-Reid",
        "timestamp": 1735637928
    },
    {
        "content": "<p>I don't think you can do it without constraints on <code>f</code>.</p>",
        "id": 491417616,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1735661696
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Multiset</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsTrans</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsTrans</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsTotal</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsTotal</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">total</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">total</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsAntisymm</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsAntisymm</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">antisymm</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">hab</span><span class=\"w\"> </span><span class=\"n\">hba</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"c1\">-- one has to prove f a = f b → a = b</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">sortBy</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsTrans</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsTotal</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsAntisymm</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableRel</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">sort</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 491417690,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1735661745
    },
    {
        "content": "<p>You could have very particular constraints, saying that precisely on the domain of the multiset <code>f</code> has <code>IsAntisymm</code></p>",
        "id": 491417789,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1735661790
    },
    {
        "content": "<p>But the issue is for <code>f</code> such that you have a clash -- if you had <code>f 0 = f 1 = X</code>, then how should <code>{(f 0, 0), (f 1, 1)}</code> sort?</p>",
        "id": 491417871,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1735661855
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"308899\">Yakov Pechersky</span> <a href=\"#narrow/stream/217875-Is-there-code-for-X.3F/topic/Sort.20a.20multiset.20by.20a.20function/near/491417871\">said</a>:</p>\n<blockquote>\n<p>But the issue is for <code>f</code> such that you have a clash -- if you had <code>f 0 = f 1 = X</code>, then how should <code>{(f 0, 0), (f 1, 1)}</code> sort?</p>\n</blockquote>\n<p>That's what I was thinking too for a constant <code>f</code>, but how is that any different from 'sorting' a multiset of constant values?</p>",
        "id": 491441504,
        "sender_full_name": "Tristan Figueroa-Reid",
        "timestamp": 1735678698
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"767695\">Tristan Figueroa-Reid</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Sort.20a.20multiset.20by.20a.20function/near/491441504\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"308899\">Yakov Pechersky</span> <a href=\"#narrow/stream/217875-Is-there-code-for-X.3F/topic/Sort.20a.20multiset.20by.20a.20function/near/491417871\">said</a>:</p>\n<blockquote>\n<p>But the issue is for <code>f</code> such that you have a clash -- if you had <code>f 0 = f 1 = X</code>, then how should <code>{(f 0, 0), (f 1, 1)}</code> sort?</p>\n</blockquote>\n<p>That's what I was thinking too for a constant <code>f</code>, but how is that any different from 'sorting' a multiset of constant values?</p>\n</blockquote>\n<p>To clarify, I do understand that you can't construct an <code>AntisymmRel</code> for such a sorting function, but from a higher-up look at sorting, surely this is still possible, right? Just not with <code>sort</code>.</p>",
        "id": 491443460,
        "sender_full_name": "Tristan Figueroa-Reid",
        "timestamp": 1735680467
    },
    {
        "content": "<p>it is certainly possible to define such a function:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">sortBy</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableRel</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">out</span><span class=\"bp\">.</span><span class=\"n\">mergeSort</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">))</span>\n\n<span class=\"n\">unsafe</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">sortBy'</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableRel</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">]:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">unquot</span><span class=\"bp\">.</span><span class=\"n\">mergeSort</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>note that it is not computable, since the choice of output is dependent on the ordering of <code>s.out</code>. alternatively, you can do this in a computable but unsafe way</p>",
        "id": 491444934,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1735681695
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Sort.20a.20multiset.20by.20a.20function/near/491444934\">said</a>:</p>\n<blockquote>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">sortBy</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableRel</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">out</span><span class=\"bp\">.</span><span class=\"n\">mergeSort</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">))</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Alright - that makes sense. Is the fact that its noncomputable also one of the reasons why it isn't already present in Mathlib?</p>",
        "id": 491445267,
        "sender_full_name": "Tristan Figueroa-Reid",
        "timestamp": 1735682003
    },
    {
        "content": "<p>likely, yes</p>",
        "id": 491445626,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1735682338
    },
    {
        "content": "<p><code>s.out</code> is giving you the underlying list. If you're going to sort anyway, carry/construct a list in the first place. The issue is</p>\n<blockquote>\n<p>sorting, surely this is still possible,</p>\n</blockquote>\n<p>Yes, but not in a sort-stably way -- since a multiset has no inherent order, it's not well defined for that <code>f0 f1</code> case what order the <code>0 1</code> should come out in. That's why if you don't care about their sort order, you also might not care that you have a list with some whatever order. Then you can use <code>List.mergeSort (r on f)</code></p>",
        "id": 491446282,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1735682926
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"767695\">Tristan Figueroa-Reid</span> has marked this topic as resolved.</p>",
        "id": 491446562,
        "sender_full_name": "Notification Bot",
        "timestamp": 1735683190
    }
]