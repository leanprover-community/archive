[
    {
        "content": "<p>I have a function defined on a subset Finset s and I would like to compute define ∑ i ∈ s; how can I use the hypothesis hi that i is in S inside ∑ i ∈ s, f i?</p>",
        "id": 509547028,
        "sender_full_name": "Isaia Nisoli",
        "timestamp": 1743541302
    },
    {
        "content": "<p>If I follow your question,</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"bp\">∑</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">attach</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div>",
        "id": 509547501,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1743541499
    },
    {
        "content": "<p>An alternative is </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"bp\">∑</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div>\n<p>which is more verbose, but often a lot easier to prove things about</p>",
        "id": 509550049,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1743542596
    },
    {
        "content": "<p>I've never seen that last option. I can imagine why that would be useful sometimes, though it feels cumbersome... <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 509550806,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1743542897
    },
    {
        "content": "<p>i imagine this might also have lemmas...</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"bp\">∑</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div>",
        "id": 509550945,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1743542964
    },
    {
        "content": "<p>I think there's a lemma that converts between the two</p>",
        "id": 509550946,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1743542964
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/hypothesis.20inside.20sum/near/509550945\">said</a>:</p>\n<blockquote>\n<p>i imagine this might also have lemmas...</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"bp\">∑</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>This is defeq to <code>∑ x ∈ s.attach, f x</code>!</p>",
        "id": 509550986,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1743542982
    },
    {
        "content": "<p>it is???</p>",
        "id": 509551004,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1743542990
    },
    {
        "content": "<p>nice</p>",
        "id": 509551014,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1743542996
    },
    {
        "content": "<p>yes, because <code>(Finset.univ : Finset s)</code> is defined as <code>s.attach</code></p>",
        "id": 509551148,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1743543030
    },
    {
        "content": "<p>oooooh</p>",
        "id": 509551257,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1743543078
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"246273\">Bhavik Mehta</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/hypothesis.20inside.20sum/near/509550049\">said</a>:</p>\n<blockquote>\n<p>An alternative is </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"bp\">∑</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div>\n<p>which is more verbose, but often a lot easier to prove things about</p>\n</blockquote>\n<p>this worked for me: I had a function <code>f (x: ℕ) (hx: x ∈ s) : ℕ</code> and <code>#check ∑ i ∈ s, if hi : i ∈ s then f i hi else 0</code> worked...</p>",
        "id": 509553478,
        "sender_full_name": "Isaia Nisoli",
        "timestamp": 1743544046
    },
    {
        "content": "<p>Using the other approach, you could use <code>∑ x ∈ s.attach, f x.1 x.2</code></p>",
        "id": 509554755,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1743544635
    },
    {
        "content": "<p>(reminder to post a <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a> when asking your question, then we would have learned that your <code>f</code> has two arguments)</p>",
        "id": 509554782,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1743544649
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"111080\">Floris van Doorn</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/hypothesis.20inside.20sum/near/509550806\">said</a>:</p>\n<blockquote>\n<p>I've never seen that last option. I can imagine why that would be useful sometimes, though it feels cumbersome... <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>\n</blockquote>\n<p>Right, it makes it much easier to avoid DTT hell, and also suggests that changing <code>f</code> to take junk values might be a useful thing to do!</p>",
        "id": 509555823,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1743545126
    }
]