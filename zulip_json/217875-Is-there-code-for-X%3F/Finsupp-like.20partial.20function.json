[
    {
        "content": "<p>Do we have a notion of functions <code>f : α → Option M</code> such that <code>f x = none</code> for all but finitely many <code>x</code> in Mathlib?</p>",
        "id": 476411456,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1728660493
    },
    {
        "content": "<p>You can use Finsupp with <code>WithZero</code> (which is Option, but writing <code>none</code> as <code>0</code>)</p>",
        "id": 476412339,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1728660769
    },
    {
        "content": "<p>I need to work with the actual <code>0</code> in this setting. Can I use <code>none</code> with <code>Finsupp</code> somehow?</p>",
        "id": 476413082,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1728661002
    },
    {
        "content": "<p>I guess custom notation will save the day:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"∅\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithZero</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"O\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithZero</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 476414215,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1728661377
    },
    {
        "content": "<p>Also, do we have the notion of <em>extension</em> of a partial function? I mean something that maps everything [that the original function maps to <code>some x</code>] to the same element, but potentially mapping other elements.</p>",
        "id": 476414830,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1728661575
    },
    {
        "content": "<p>There is a long-wished refactor here. cc <span class=\"user-mention\" data-user-id=\"492774\">@Sky Wilshaw</span></p>",
        "id": 476415946,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1728661967
    },
    {
        "content": "<p>Previous discussion: <a href=\"#narrow/stream/217875-Is-there-code-for-X.3F/topic/Finsupp.20generalisations\">https://leanprover.zulipchat.com/#narrow/stream/217875-Is-there-code-for-X.3F/topic/Finsupp.20generalisations</a></p>",
        "id": 476417240,
        "sender_full_name": "Yuyang Zhao",
        "timestamp": 1728662398
    },
    {
        "content": "<p>When we are at it, what is the best way to eliminate on a <code>Finsupp</code> constant built using <code>single</code> and <code>update</code>s?</p>",
        "id": 476417569,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1728662479
    },
    {
        "content": "<p>I also need <a href=\"https://fr-vdash-bot.github.io/Algorithm/Algorithm/Data/DFinsupp'/Defs.html\">this generalization in my own repository</a>, which basically copies the API of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=DFinsupp#doc\">docs#DFinsupp</a>.</p>",
        "id": 476418268,
        "sender_full_name": "Yuyang Zhao",
        "timestamp": 1728662723
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"417654\">Martin Dvořák</span> <a href=\"#narrow/stream/217875-Is-there-code-for-X.3F/topic/Finsupp-like.20partial.20function/near/476417569\">said</a>:</p>\n<blockquote>\n<p>When we are at it, what is the best way to eliminate on a <code>Finsupp</code> constant built using <code>single</code> and <code>update</code>s?</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"644391\">@loogle</span> Finsupp, \"ind\"</p>",
        "id": 476418441,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1728662779
    },
    {
        "content": "<p><span aria-label=\"search\" class=\"emoji emoji-1f50d\" role=\"img\" title=\"search\">:search:</span> <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Finsupp/Defs.html#Finsupp.single_eq_set_indicator\">Finsupp.single_eq_set_indicator</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Finsupp/Defs.html#Finsupp.induction_linear\">Finsupp.induction_linear</a>, and <a href=\"https://loogle.lean-lang.org/?q=Finsupp%2C%20%22ind%22\">111 more</a></p>",
        "id": 476418444,
        "sender_full_name": "loogle",
        "timestamp": 1728662780
    },
    {
        "content": "<p>The spelling is with <code>+ single</code> not <code>update</code></p>",
        "id": 476418607,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1728662844
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"417654\">Martin Dvořák</span> <a href=\"#narrow/stream/217875-Is-there-code-for-X.3F/topic/Finsupp-like.20partial.20function/near/476417569\">said</a>:</p>\n<blockquote>\n<p>When we are at it, what is the best way to eliminate on a <code>Finsupp</code> constant built using <code>single</code> and <code>update</code>s?</p>\n</blockquote>\n<p>-&gt; <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/stream/287929-mathlib4/topic/Finsupp.20and.20FreeAbelianGroup\">#mathlib4 &gt; Finsupp and FreeAbelianGroup</a></p>",
        "id": 476422515,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1728664372
    },
    {
        "content": "<p>Oh, I thought you meant \"eliminate\" as in \"induct\"</p>",
        "id": 476427564,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1728666305
    },
    {
        "content": "<p>I'm searching for a tactic or lemma such that</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→₀</span><span class=\"w\"> </span><span class=\"n\">WithZero</span><span class=\"w\"> </span><span class=\"n\">Char</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">fun₀</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">x'</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">y'</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Char</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hnc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">the_tactic</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hnc</span>\n</code></pre></div>\n<p>will give me three cases :<br>\n<code>n=5</code> and <code>c='x'</code><br>\n<code>n=7</code> and <code>c='y'</code><br>\n<code>n≠5 ∧ n≠7</code> and <code>c=0</code></p>",
        "id": 476428199,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1728666547
    },
    {
        "content": "<p>[updated above]</p>",
        "id": 476428784,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1728666786
    },
    {
        "content": "<p>Anything smarter (such that for given concrete <code>n</code> it will eliminate impossible cases) is a plus.</p>",
        "id": 476429296,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1728666996
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Finsupp-like.20partial.20function/near/476415946\">said</a>:</p>\n<blockquote>\n<p>There is a long-wished refactor here. cc <span class=\"user-mention silent\" data-user-id=\"492774\">Sky Wilshaw</span></p>\n</blockquote>\n<p>I think you've motivated me to get this done for mathlib4. It turns out I also need these more general <code>Finsupp</code>s for something I'm working on.</p>",
        "id": 483667889,
        "sender_full_name": "Sky Wilshaw",
        "timestamp": 1732186931
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/tree/zeramorphic/finsupp-refactor\">https://github.com/leanprover-community/mathlib4/tree/zeramorphic/finsupp-refactor</a></p>",
        "id": 483674175,
        "sender_full_name": "Sky Wilshaw",
        "timestamp": 1732189105
    },
    {
        "content": "<p>Code structure and naming suggestions are welcome.</p>",
        "id": 483674212,
        "sender_full_name": "Sky Wilshaw",
        "timestamp": 1732189119
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/19337\">#19337</a> (pinging <span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span> for a review)</p>",
        "id": 483725799,
        "sender_full_name": "Sky Wilshaw",
        "timestamp": 1732203110
    },
    {
        "content": "<p>Will take a while to get to it. Just like the UK, I'm rained under</p>",
        "id": 483725933,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1732203137
    },
    {
        "content": "<p>Instead of replacing <code>Finsupp</code>, should we replace <code>DFinsupp</code>?</p>",
        "id": 483727022,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1732203444
    },
    {
        "content": "<p>I thought that we were going to unify them both eventually, but that has far reaching implications. I just wanted to get some initial code in to avoid bikeshedding.</p>",
        "id": 483727227,
        "sender_full_name": "Sky Wilshaw",
        "timestamp": 1732203499
    },
    {
        "content": "<p>My use case closely matches <code>Finsupp</code> API and computability, as well, so I'm biased in that sense.</p>",
        "id": 483727320,
        "sender_full_name": "Sky Wilshaw",
        "timestamp": 1732203526
    }
]