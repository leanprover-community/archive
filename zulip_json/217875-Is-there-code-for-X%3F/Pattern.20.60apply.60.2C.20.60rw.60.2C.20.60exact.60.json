[
    {
        "content": "<p>I often find myself using the pattern</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">X</span>\n<span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Y</span><span class=\"o\">]</span>\n<span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Z</span>\n</code></pre></div>\n<p>where <code>X</code>, <code>Y</code> and <code>Z</code> are some lemmas. If <code>rw [Y]</code> wasn't there then I could just do <code>exact X Z</code> instead. Is there a one-liner that I can use instead of the pattern above?</p>\n<p>For an extremely contrived example, how to prove the following in one line without using <code>trans</code>?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h1</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">h2</span>\n</code></pre></div>\n<p>More realistic example: <a href=\"https://github.com/leanprover-community/mathlib4/pull/19896/files#diff-5e556054cca885f8e6c6f4f0c7ba9767fafaf4c7481c0cfb84e3f38d56685d32R356-R358\">here</a></p>",
        "id": 491435147,
        "sender_full_name": "Vasily Ilin",
        "timestamp": 1735673399
    },
    {
        "content": "<p>I believe you can use rewrite on its own in the lemma you showed:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 491435800,
        "sender_full_name": "Marco Campos",
        "timestamp": 1735673871
    },
    {
        "content": "<p>Okay, I think my contrived example is too contrived. Take a look at the realistic example I linked (also pasted below).</p>",
        "id": 491436315,
        "sender_full_name": "Vasily Ilin",
        "timestamp": 1735674277
    },
    {
        "content": "<p>Here it is</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">SpecialFunctions</span><span class=\"bp\">.</span><span class=\"n\">Gaussian</span><span class=\"bp\">.</span><span class=\"n\">GaussianIntegral</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Probability</span><span class=\"bp\">.</span><span class=\"n\">Moments</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Measurable</span><span class=\"w\"> </span><span class=\"n\">Real</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Ω</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">mΩ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MeasurableSpace</span><span class=\"w\"> </span><span class=\"n\">Ω</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Measure</span><span class=\"w\"> </span><span class=\"n\">Ω</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"bp\">≥</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ω</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">mgf_dirac</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hX</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">dirac</span><span class=\"w\"> </span><span class=\"n\">μ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mgf</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">mgf_id_map</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mgf</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hX</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">integral_dirac</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_comm</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">AEMeasurable</span><span class=\"bp\">.</span><span class=\"n\">of_map_ne_zero</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hX</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">IsProbabilityMeasure</span><span class=\"bp\">.</span><span class=\"n\">ne_zero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">dirac</span><span class=\"w\"> </span><span class=\"n\">μ</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 491436436,
        "sender_full_name": "Vasily Ilin",
        "timestamp": 1735674366
    },
    {
        "content": "<p>Maybe with the triangle <code>\\t</code>, but that's usually a sign you're condensing your code too much</p>",
        "id": 491437041,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1735674901
    },
    {
        "content": "<p>Do you know about <code>simpa</code>?</p>",
        "id": 491437532,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1735675301
    },
    {
        "content": "<p>Also I am pretty sure I suggested you a golf for those specific lines on the PR</p>",
        "id": 491437593,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1735675327
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Pattern.20.60apply.60.2C.20.60rw.60.2C.20.60exact.60/near/491437593\">said</a>:</p>\n<blockquote>\n<p>Also I am pretty sure I suggested you a golf for those specific lines on the PR</p>\n</blockquote>\n<p>I dont' think so. I have applied all suggestions you have given me so far. I think you suggested removing <code>AEMeasurable</code> and switching <code>apply</code> to <code>refine</code> but it's still 3 lines.</p>",
        "id": 491437813,
        "sender_full_name": "Vasily Ilin",
        "timestamp": 1735675536
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Pattern.20.60apply.60.2C.20.60rw.60.2C.20.60exact.60/near/491437532\">said</a>:</p>\n<blockquote>\n<p>Do you know about <code>simpa</code>?</p>\n</blockquote>\n<p>No, but I am looking it up now!</p>",
        "id": 491437969,
        "sender_full_name": "Vasily Ilin",
        "timestamp": 1735675661
    },
    {
        "content": "<p>I read the <code>docstring</code> of <code>simpa</code> but didn't really understand it.</p>",
        "id": 491438115,
        "sender_full_name": "Vasily Ilin",
        "timestamp": 1735675787
    },
    {
        "content": "<p><code>simpa [my, lemmas, here] using term</code> means apply the lemmas in the list to both the goal and the term such after some application, the term will solve the goal. So in your case, it'll be <code>simpa [hx] using IsProbabilityMeasure.ne_zero (.dirac μ)</code>, perhaps</p>",
        "id": 491444945,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1735681707
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"308899\">Yakov Pechersky</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Pattern.20.60apply.60.2C.20.60rw.60.2C.20.60exact.60/near/491444945\">said</a>:</p>\n<blockquote>\n<p><code>simpa [my, lemmas, here] using term</code> means apply the lemmas in the list to both the goal and the term such after some application, the term will solve the goal. So in your case, it'll be <code>simpa [hx] using IsProbabilityMeasure.ne_zero (.dirac μ)</code>, perhaps</p>\n</blockquote>\n<p>This does not work.</p>",
        "id": 491532172,
        "sender_full_name": "Vasily Ilin",
        "timestamp": 1735769221
    }
]