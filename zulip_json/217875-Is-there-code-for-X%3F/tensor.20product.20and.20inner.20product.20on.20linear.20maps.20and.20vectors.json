[
    {
        "content": "<p>Hi, I am trying to define a property on the inner product of tensor products of vectors and linear maps but I am struggling a bit</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c\">/-</span>\n<span class=\"cm\">This lemma shows the `Tensor` product property `(âŸ¨Ï†â‚|â¨‚âŸ¨Ï†â‚‚|)(Aâ‚ â¨‚ Aâ‚‚)(|Ï†â‚âŸ©â¨‚|Ï†â‚‚âŸ©) = (âŸ¨Ï†â‚|Aâ‚|Ï†â‚âŸ©)Â·(âŸ¨Ï†â‚‚|Aâ‚‚|Ï†â‚‚âŸ©)`</span>\n<span class=\"cm\">-/</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">tensor_product</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">Ï†â‚</span><span class=\"w\"> </span><span class=\"n\">Ï†â‚‚</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">Aâ‚</span><span class=\"w\"> </span><span class=\"n\">Aâ‚‚</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"bp\">â†’â‚—</span><span class=\"o\">[</span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">isPositiveSemiDefinite</span><span class=\"w\"> </span><span class=\"n\">Aâ‚</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">isPositiveSemiDefinite</span><span class=\"w\"> </span><span class=\"n\">Aâ‚‚</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">âˆ€</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">x'</span><span class=\"w\"> </span><span class=\"n\">y'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">inner</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âŠ—â‚œ</span><span class=\"o\">[</span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x'</span><span class=\"w\"> </span><span class=\"bp\">âŠ—â‚œ</span><span class=\"o\">[</span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">y'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">inner</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">x'</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">inner</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">y'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">inner</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Ï†â‚</span><span class=\"w\"> </span><span class=\"bp\">âŠ—â‚œ</span><span class=\"o\">[</span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Ï†â‚‚</span><span class=\"o\">)</span>\n<span class=\"w\">          </span><span class=\"o\">((</span><span class=\"n\">TensorProduct</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">Aâ‚</span><span class=\"w\"> </span><span class=\"n\">Aâ‚‚</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Ï†â‚</span><span class=\"w\"> </span><span class=\"bp\">âŠ—â‚œ</span><span class=\"o\">[</span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Ï†â‚‚</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">    </span><span class=\"n\">inner</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">Ï†â‚</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Aâ‚</span><span class=\"w\"> </span><span class=\"n\">Ï†â‚</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">inner</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">Ï†â‚‚</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Aâ‚‚</span><span class=\"w\"> </span><span class=\"n\">Ï†â‚‚</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>it is not working properly, and I am getting the following errors:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">synthesize</span>\n<span class=\"w\">  </span><span class=\"n\">Inner</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>would appreciate any help if there is some relevant code in mathlib or whether i am misusing the tensor product! thank you!</p>",
        "id": 516477532,
        "sender_full_name": "Jam Kabeer Ali Khan",
        "timestamp": 1746546236
    },
    {
        "content": "<p>This means Lean does not know how to take the inner product of the tensor, probably because you need to add an <code>InnerProductSpace</code> argument to your lemma.</p>",
        "id": 516478025,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1746546365
    },
    {
        "content": "<p>Can you post a <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a>?</p>",
        "id": 516478342,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1746546454
    },
    {
        "content": "<p>sure! here a minimum example i could get</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">LinearAlgebra</span><span class=\"bp\">.</span><span class=\"n\">TensorProduct</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">InnerProductSpace</span><span class=\"bp\">.</span><span class=\"n\">Positive</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">InnerProductSpace</span><span class=\"bp\">.</span><span class=\"n\">Projection</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">LinearAlgebra</span><span class=\"bp\">.</span><span class=\"n\">Trace</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">RCLike</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span>\n<span class=\"c1\">-- notation:100 T \"âŠ—â‚—\" N:100 =&gt; TensorProduct.map T N</span>\n\n<span class=\"kn\">variable</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">HilbertSpace</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">InnerProductSpace</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CompleteSpace</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">FiniteDimensional</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n<span class=\"n\">omit</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CompleteSpace</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span>\n\n<span class=\"sd\">/-- Positive semidefinite operators. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">isPositiveSemiDefinite</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"bp\">â†’â‚—</span><span class=\"o\">[</span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">IsSelfAdjoint</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"bp\">âˆ€</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"n\">RCLike</span><span class=\"bp\">.</span><span class=\"n\">re</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">inner</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">tensor_product</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">Ï†â‚</span><span class=\"w\"> </span><span class=\"n\">Ï†â‚‚</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">Aâ‚</span><span class=\"w\"> </span><span class=\"n\">Aâ‚‚</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"bp\">â†’â‚—</span><span class=\"o\">[</span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">isPositiveSemiDefinite</span><span class=\"w\"> </span><span class=\"n\">Aâ‚</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">isPositiveSemiDefinite</span><span class=\"w\"> </span><span class=\"n\">Aâ‚‚</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">âˆ€</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">x'</span><span class=\"w\"> </span><span class=\"n\">y'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">inner</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âŠ—â‚œ</span><span class=\"o\">[</span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x'</span><span class=\"w\"> </span><span class=\"bp\">âŠ—â‚œ</span><span class=\"o\">[</span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">y'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">inner</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">x'</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">inner</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">y'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">inner</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Ï†â‚</span><span class=\"w\"> </span><span class=\"bp\">âŠ—â‚œ</span><span class=\"o\">[</span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Ï†â‚‚</span><span class=\"o\">)</span>\n<span class=\"w\">          </span><span class=\"o\">((</span><span class=\"n\">TensorProduct</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">Aâ‚</span><span class=\"w\"> </span><span class=\"n\">Aâ‚‚</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Ï†â‚</span><span class=\"w\"> </span><span class=\"bp\">âŠ—â‚œ</span><span class=\"o\">[</span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Ï†â‚‚</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">    </span><span class=\"n\">inner</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">Ï†â‚</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Aâ‚</span><span class=\"w\"> </span><span class=\"n\">Ï†â‚</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">inner</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">Ï†â‚‚</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Aâ‚‚</span><span class=\"w\"> </span><span class=\"n\">Ï†â‚‚</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>please let me know if this is not good, i will try to get a better one, i am still new to lean</p>",
        "id": 516479329,
        "sender_full_name": "Jam Kabeer Ali Khan",
        "timestamp": 1746546722
    },
    {
        "content": "<p>The problem is that the inner product on tensor products has not been defined</p>",
        "id": 516480416,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1746547029
    },
    {
        "content": "<p>I don't see it in mathlib anywhere...</p>",
        "id": 516480459,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1746547040
    },
    {
        "content": "<p>I see in that case I would need to define it myself? I am a bit new to lean, any word of advice on how should I go about this?</p>",
        "id": 516480668,
        "sender_full_name": "Jam Kabeer Ali Khan",
        "timestamp": 1746547093
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/tensor.20product.20and.20inner.20product.20on.20linear.20maps.20and.20vectors/near/516480416\">said</a>:</p>\n<blockquote>\n<p>The problem is that the inner product on tensor products has not been defined</p>\n</blockquote>\n<p>Indeed we don't have it. See <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/Semilinearizing/with/513544245\">#mathlib4 &gt; Semilinearizing</a></p>",
        "id": 516481205,
        "sender_full_name": "Anatole Dedecker",
        "timestamp": 1746547223
    },
    {
        "content": "<p>Or <a href=\"https://github.com/leanprover-community/mathlib4/pull/6020\">#6020</a></p>",
        "id": 516485454,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1746548473
    },
    {
        "content": "<p>Hi<br>\nI saw the links in <a href=\"https://github.com/leanprover-community/mathlib4/pull/6020\">#6020</a>, but I see that the definitions are for the reals instead of for RCLike.<br>\nThey work using bilinearity and lifting, but I think that does not work for RCLike because the complex conjugate is not linear, and that makes the inner not lineal. Do you have any idea of how it could be done for RCLike?</p>",
        "id": 526099428,
        "sender_full_name": "IvÃ¡n Renison",
        "timestamp": 1751035287
    },
    {
        "content": "<p>I think it shouldn't be too hard to generalize <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=TensorProduct.lift#doc\">docs#TensorProduct.lift</a> to the semilinear case, and then follow the same strategy.</p>",
        "id": 526103373,
        "sender_full_name": "FrÃ©dÃ©ric Dupuis",
        "timestamp": 1751036468
    },
    {
        "content": "<p>Ok, thanks for the hint</p>",
        "id": 526104034,
        "sender_full_name": "IvÃ¡n Renison",
        "timestamp": 1751036657
    }
]