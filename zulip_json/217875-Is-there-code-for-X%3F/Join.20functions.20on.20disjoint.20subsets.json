[
    {
        "content": "<p>Is there something like this?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">combineSetFuncs</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Disjoint</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">union</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>I can't Loogle anything. The closest thing is <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Set.Sum.elim_range#doc\">docs#Set.Sum.elim_range</a>, but then I need something to between (s.union t) and (Sum s t).</p>",
        "id": 477514837,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1729195031
    },
    {
        "content": "<p>Of course the <code>Disjoint</code> is actually needed to define the function -- you can make a function like this anyway, giving preference to one of f or g -- but it makes it much better behaved.</p>",
        "id": 477514992,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1729195093
    },
    {
        "content": "<p>Like I guess this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">combineSetFuncs</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidablePred</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">union</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"n\">hx</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">h₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h₂</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Or</span><span class=\"bp\">.</span><span class=\"n\">resolve_left</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"n\">h₂</span><span class=\"bp\">⟩</span>\n</code></pre></div>",
        "id": 477516189,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1729195578
    },
    {
        "content": "<p>Do you really want to work with <code>f</code> and <code>g</code> whose domains are <em>sets</em> (coerced to types)?</p>",
        "id": 477516295,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1729195636
    },
    {
        "content": "<p>That's what makes sense to me! Isn't that kind of the whole point of Sets being coercible to types? That you can write this kind of thing down?<br>\nI've got two partial functions and want to join them together. The alternative I see would be writing them as <code>{x : α // x ∈ s } → β</code> directly, which is defeq I guess. Is there a better way?</p>",
        "id": 477516571,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1729195740
    },
    {
        "content": "<p>It's possible, but it turns out it's often inconvenient</p>",
        "id": 477517022,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1729195922
    },
    {
        "content": "<p>If you have functions defined on the entire type, then you can use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Set.piecewise#doc\">docs#Set.piecewise</a>, but this won't work if your functions have domains on the subtype.</p>",
        "id": 477517688,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1729196226
    },
    {
        "content": "<p>They're only defined on the subtype. (I can of course extend it with junk values and re-restrict, but that definitely seems like a much bigger mess.)</p>",
        "id": 477517742,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1729196268
    },
    {
        "content": "<p>Can you give some more insight? What function do you have whose domain is a set?</p>",
        "id": 477517875,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1729196320
    },
    {
        "content": "<p>I'm working on code for the Equational project (<a class=\"stream-topic\" data-stream-id=\"458659\" href=\"/#narrow/channel/458659-Equational/topic/Obelix.3A.20joining.20two.20approaches\">#Equational &gt; Obelix: joining two approaches</a> ). I'm constructing a Magma that obeys certain properties. The way I do this is by starting with a partial function, and then progressively expanding the domain while keeping those properties, eventually adding everything to the domain. I have something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">PartialSolution</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"c1\">--A partial solution is a function f : A → A satisfying certain invariants, with support Supp.</span>\n<span class=\"w\">  </span><span class=\"n\">Supp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">A</span>\n<span class=\"w\">  </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Supp</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">A</span>\n<span class=\"w\">  </span><span class=\"c1\">--invariants snipped out</span>\n</code></pre></div>\n<p>and then I construct another partial function that will extend it (and keep the invariants true). So I want to add this new set to Supp, and build the new <code>f</code>. It looks like I'll end up having to prove the basic facts, like that (since the two sets are disjoint) the new function agrees with both of the earlier ones on their domains.</p>",
        "id": 477518607,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1729196625
    },
    {
        "content": "<p>You could have Supp and f : A -&gt; A and just remember that f is junk outside Supp (or even make it the identity outside Supp). I'm only suggesting this because this is how we do eg division; we allow division by 0 and just remember that it's nonsense.</p>",
        "id": 477519526,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1729197016
    },
    {
        "content": "<p>alternatively (although I think it's likely harder), you could use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=PFun#doc\">docs#PFun</a></p>",
        "id": 477520395,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1729197404
    },
    {
        "content": "<p>It looks like we don't have a <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Alternative#doc\">docs#Alternative</a> instance for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Part#doc\">docs#Part</a></p>",
        "id": 477524769,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1729199443
    },
    {
        "content": "<p>For the original request, see <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Equiv.Set.union#doc\">docs#Equiv.Set.union</a></p>",
        "id": 477526267,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1729200218
    },
    {
        "content": "<p>TODO: rewrite it to assume <code>Disjoint</code>.</p>",
        "id": 477526290,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1729200237
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/17880\">#17880</a></p>",
        "id": 477527407,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1729200736
    }
]