[
    {
        "content": "<p>I'm working on formalizing some convex geometry and have reached a point where I need to prove that <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/AddTorsor/Defs.html#AddTorsor\"><code>AddTorsor</code></a> structures are unique. Specifically:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddGroup</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Subsingleton</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">AddTorsor</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>The problem is that after decomposing with <code>cases</code> and <code>congr</code>, I need to prove two equalities:</p>\n<ol>\n<li>the <code>vadd</code> operations are equal</li>\n<li>the <code>vsub</code> operations are equal</li>\n</ol>\n<p>I'm stuck because I appear to be in circular dependency loop:</p>\n<ul>\n<li>to prove <code>vsub</code> equality, I'd use <code>(p₁ -ᵥ p₂) +ᵥ p₂ = p₁</code>, but each instance uses its own <code>+ᵥ</code></li>\n<li>to prove <code>vadd</code> equality, I'd use the axiom <code>(g +ᵥ p) -ᵥ p = g</code>, but each instance uses its own <code>-ᵥ</code></li>\n</ul>\n<p>This comes up because I'm proving that translation in an affine subspace (more specifically, reducing an affine space to a vector subspace) is a homeomorphism, and the proof I've got uses <code>subsingleton</code> tactic, which requires the aforementioned instance.</p>\n<p>Is there an existing instance I'm missing? I've gone hunting but haven't uncovered anything yet. If not, what's a good approach for proving typeclass uniqueness when operations are mutually dependent?</p>",
        "id": 544729849,
        "sender_full_name": "Jesse Alama",
        "timestamp": 1760443362
    },
    {
        "content": "<p>This topic was moved here from <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/How.20to.20prove.20.60Subsingleton.20.28AddTorsor.20G.20P.29.60.20for.20.3F\">#Is there code for X? &gt; How to prove &#96;Subsingleton (AddTorsor G P)&#96; for ?</a> by <span class=\"user-mention silent\" data-user-id=\"754512\">Jesse Alama</span>.</p>",
        "id": 544730015,
        "sender_full_name": "Notification Bot",
        "timestamp": 1760443407
    },
    {
        "content": "<p>I don't think these are unique?</p>",
        "id": 544730373,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760443505
    },
    {
        "content": "<p>what kind of uniqueness are you looking for?</p>",
        "id": 544730466,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760443528
    },
    {
        "content": "<p>maybe you want some sort of extensionality like \"if the <code>AddAction</code>s are the same then the <code>AddTorsor</code>s are also the same\"?</p>",
        "id": 544731012,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760443682
    },
    {
        "content": "<p>The theorem I'm reaching for is this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">affineSubspace_translation_homeomorph</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AffineSubspace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MetricSpace</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">p₀</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">≃ₜ</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">.</span><span class=\"n\">direction</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-ᵥ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p₀</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>I'm trying to translate an affine space to the origin and work with the result as a vector (sub)space rather than trying to do everything in the affine space. I got stuck in some type tetris and the (possibly unsound) principle above emerged.</p>",
        "id": 544731215,
        "sender_full_name": "Jesse Alama",
        "timestamp": 1760443747
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"754512\">Jesse Alama</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Subsingleton.20.28AddTorsor.20G.20P.29/near/544731215\">said</a>:</p>\n<blockquote>\n<p>The theorem I'm reaching for is this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">affineSubspace_translation_homeomorph</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AffineSubspace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MetricSpace</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">p₀</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">≃ₜ</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">.</span><span class=\"n\">direction</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-ᵥ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p₀</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>I'm trying to translate an affine space to the origin and work with the result as a vector (sub)space rather than trying to do everything in the affine space. I got stuck in some type tetris and the (possibly unsound) principle above emerged.</p>\n</blockquote>\n<p>Why are you putting a metric space on <code>A</code>?</p>",
        "id": 544731488,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760443833
    },
    {
        "content": "<p>Ah, oops, the metric space doesn't need to be there, sorry.</p>",
        "id": 544731737,
        "sender_full_name": "Jesse Alama",
        "timestamp": 1760443901
    },
    {
        "content": "<p>this theorem looks very false, why do you think it should be true</p>",
        "id": 544731758,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760443907
    },
    {
        "content": "<p>oh no I got the quantifiers mixed up</p>",
        "id": 544731864,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760443940
    },
    {
        "content": "<p>this should be fine yeah</p>",
        "id": 544731877,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760443945
    },
    {
        "content": "<p>if you drop <code>[MetricSpace A]</code> then it should be fine</p>",
        "id": 544731984,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760443971
    },
    {
        "content": "<p>Yeah I think this should be sound. I've dropped the <code>[MetricSpace A]</code> but the issue remains.</p>",
        "id": 544732353,
        "sender_full_name": "Jesse Alama",
        "timestamp": 1760444081
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Homeomorph.vaddConst#doc\">docs#Homeomorph.vaddConst</a> is what you're looking for</p>",
        "id": 544732355,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760444081
    },
    {
        "content": "<p>I found that by doing <span class=\"user-mention\" data-user-id=\"644391\">@loogle</span> Homeomorph, AddTorsor</p>",
        "id": 544733442,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760444373
    },
    {
        "content": "<p><span aria-label=\"search\" class=\"emoji emoji-1f50d\" role=\"img\" title=\"search\">:search:</span> <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Topology/Algebra/Group/AddTorsor.html#Homeomorph.vaddConst\">Homeomorph.vaddConst</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Topology/Algebra/Group/AddTorsor.html#Homeomorph.vaddConst_symm_apply\">Homeomorph.vaddConst_symm_apply</a>, and <a href=\"https://loogle.lean-lang.org/?q=Homeomorph%2C%20AddTorsor\">4 more</a></p>",
        "id": 544733450,
        "sender_full_name": "loogle",
        "timestamp": 1760444375
    },
    {
        "content": "<p><code>Homeomorph.vaddConst</code> and <code>Homeomorph.vaddConst_symm_apply</code> did the job -- thank you!! Sorry for the noise. I somehow convinced myself that that weird subsingleton was true.</p>",
        "id": 544734210,
        "sender_full_name": "Jesse Alama",
        "timestamp": 1760444613
    }
]