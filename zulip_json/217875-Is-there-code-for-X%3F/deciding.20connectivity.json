[
    {
        "content": "<p>Hi, what is the easiest way to prove that a fixed finite simple graph is connected? For instance, the following complains about not being decidable:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">e1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Sym2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Sym2</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">e2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Sym2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Sym2</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">fromEdgeSet</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">e1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">e2</span><span class=\"o\">}</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">Connected</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">decide</span>\n</code></pre></div>\n<p>Is there code for finite graphs / relations somewhere?</p>",
        "id": 489338492,
        "sender_full_name": "Noah G. Singer",
        "timestamp": 1734381765
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=SimpleGraph.instDecidableConnected#doc\">docs#SimpleGraph.instDecidableConnected</a> exists, though no guarantees it's anything like a good algorithm</p>",
        "id": 489338940,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1734381905
    },
    {
        "content": "<p>If you satisfy its hypotheses, then <code>decide</code> might work.</p>",
        "id": 489338978,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1734381917
    },
    {
        "content": "<p>Oh wow, nice. I tried searching for Decidable on the SimpleGraph page itself and that didn't find anything, but I guess this is in a subpage. No worries on the good algorithm, I just need it to check that some small graph (whose edges correspond to certain lemmas) is connected :)</p>",
        "id": 489339225,
        "sender_full_name": "Noah G. Singer",
        "timestamp": 1734381999
    },
    {
        "content": "<p>It's worth taking a look at <code>Archive/Wiedijk100Theorems/Konigsberg.lean</code> to see an example of a concrete graph with a computation done with it.</p>",
        "id": 489339341,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1734382039
    },
    {
        "content": "<p>Here's a start. However, <code>decide</code> fails because the instances aren't written correctly.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">G_edges</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Sym2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">s</span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">G_adj</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">G_edges</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">Adj</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">G_adj</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">w</span>\n<span class=\"w\">  </span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">dsimp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Symmetric</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">G_adj</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">decide</span>\n<span class=\"w\">  </span><span class=\"n\">loopless</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">dsimp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Irreflexive</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">G_adj</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">decide</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DecidableRel</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Adj</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">inferInstanceAs</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G_adj</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">Connected</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">decide</span>\n<span class=\"c\">/-</span><span class=\"cm\"> error</span>\n<span class=\"cm\">...</span>\n<span class=\"cm\">After unfolding the instance 'SimpleGraph.instDecidableConnected', reduction got stuck at the</span>\n<span class=\"cm\">'Decidable' instance</span>\n<span class=\"cm\">  ⋯ ▸ ⋯.mpr inferInstance</span>\n<span class=\"cm\">...</span>\n<span class=\"cm\">-/</span>\n</code></pre></div>",
        "id": 489340109,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1734382272
    },
    {
        "content": "<p>It's fixable though:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Connected</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">decidable_of_iff</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Preconnected</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">connected_iff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">univ_nonempty_iff</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">Connected</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">decide</span>\n</code></pre></div>",
        "id": 489340396,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1734382357
    },
    {
        "content": "<p>Would you be interested in making a mathlib PR to fix this <code>Decidable G.Connected</code> instance like so?</p>",
        "id": 489340507,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1734382395
    },
    {
        "content": "<p>It needs to use <code>decidable_of_iff</code> rather than rewriting the type.</p>",
        "id": 489340551,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1734382410
    },
    {
        "content": "<p>Let me take a stab... I am new :)</p>",
        "id": 489340727,
        "sender_full_name": "Noah G. Singer",
        "timestamp": 1734382461
    },
    {
        "content": "<p>it's still complaining that Preconnected isn't decidable :) should I try and fix that too?</p>",
        "id": 489342127,
        "sender_full_name": "Noah G. Singer",
        "timestamp": 1734382918
    },
    {
        "content": "<p>I think this is the replacement for the instance in Connectivity/WalkCounting.lean:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Connected</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">decidable_of_iff</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Preconnected</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">Nonempty</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">connected_iff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">univ_nonempty_iff</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 489342581,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1734383071
    },
    {
        "content": "<p>OK awesome yeah. I didn't realize I had to fix it in the Mathlib file directly. Can do the PR</p>",
        "id": 489343302,
        "sender_full_name": "Noah G. Singer",
        "timestamp": 1734383295
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/20013\">https://github.com/leanprover-community/mathlib4/pull/20013</a></p>",
        "id": 489344136,
        "sender_full_name": "Noah G. Singer",
        "timestamp": 1734383595
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> ! Fwiw, I am working with <span class=\"user-mention\" data-user-id=\"424407\">@Cayden Codel</span> and some other folks on formalizing some group theory I have been doing recently. Hopefully we will be contributing to Mathlib some more in the future!</p>",
        "id": 489345993,
        "sender_full_name": "Noah G. Singer",
        "timestamp": 1734384253
    },
    {
        "content": "<p>I just sent you a mathlib invite <span class=\"user-mention\" data-user-id=\"813211\">@Noah G. Singer</span>. The CI expects every PR to originate from a branch in the mathlib project itself (I tried overriding it with some button clicking as a maintainer, but that didn't seem to work). Would you mind creating a new PR?</p>",
        "id": 489346614,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1734384469
    },
    {
        "content": "<p>done</p>",
        "id": 489347982,
        "sender_full_name": "Noah G. Singer",
        "timestamp": 1734384957
    }
]