[
    {
        "content": "<p>Is there a way to get the version of Mathlib that is being used within the code? I was thinking of adding it to <a href=\"https://github.com/Seasawher/mathlib4-tactics/issues/73#issuecomment-2314405272\">the mathlib4-tactics page</a> but didn't find any way to do it.</p>\n<p>Is there something analogous to <code>Lean.versionString</code>?</p>\n<p>I guess one very often uses versions of Mathlib without tags and they do not have a semantic version-string at all. Maybe having access to the git-sha1, date of commit, output of a suitable call to<code>git describe</code>?</p>",
        "id": 466287811,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1725030039
    },
    {
        "content": "<p>The <code>lakefile.lean</code> in the that repository contains the mathlib version, right? So, could you extract that information instead?</p>",
        "id": 466313083,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1725038437
    },
    {
        "content": "<p>I think parsing <code>lake-manifest.json</code> might be the most plausible approach right now.</p>",
        "id": 466385653,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725062020
    },
    {
        "content": "<p>How should one find the path of this file in the most robust way? Does it make sense to add this as a definition to Mathlib?</p>",
        "id": 466606474,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1725138089
    },
    {
        "content": "<p>I could also do something like this, not sure if parsing the manifest is more robust or not...</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"bp\">.</span><span class=\"n\">Util</span><span class=\"bp\">.</span><span class=\"n\">Git</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lake</span>\n<span class=\"c1\">-- could use better way to get to the directory</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">repo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GitRepo</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"s2\">\"./.lake/packages/mathlib\"</span><span class=\"bp\">⟩</span>\n\n\n<span class=\"c\">/-</span>\n<span class=\"cm\">some \"v4.11.0-rc1-389-gf904bf86ab\"</span>\n<span class=\"cm\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">captureProc?</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">  </span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"git\"</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">args</span><span class=\"o\">:=</span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"s2\">\"describe\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"--always\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"--tags\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"--dirty\"</span><span class=\"o\">],</span><span class=\"w\"> </span><span class=\"n\">cwd</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">repo</span><span class=\"bp\">.</span><span class=\"n\">dir</span>\n<span class=\"o\">}</span>\n</code></pre></div>",
        "id": 466688937,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1725190257
    },
    {
        "content": "<p>I'm also looking at doing something like this (though using the CLI is probably not a good idea)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">tmp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CliM</span><span class=\"w\"> </span><span class=\"n\">PUnit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">config</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">mkLoadConfig</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getThe</span><span class=\"w\"> </span><span class=\"n\">LakeOptions</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">loadWorkspace</span><span class=\"w\"> </span><span class=\"n\">config</span>\n<span class=\"w\">  </span><span class=\"n\">dbg_trace</span><span class=\"w\"> </span><span class=\"s2\">\"{workspace.root.dir}\"</span>\n<span class=\"w\">  </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"o\">()</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">Lean server printed an error:</span>\n<span class=\"sd\">libc++abi: terminating due to uncaught exception of type lean::exception:</span>\n<span class=\"sd\">Could not find native implementation of external declaration</span>\n<span class=\"sd\">'_private.Lake.Load.Lean.Elab.0.Lake.addToEnv'</span>\n<span class=\"sd\">(symbols 'l___private_Lake_Load_Lean_Elab_0__Lake_addToEnv___boxed'</span>\n<span class=\"sd\">or</span>\n<span class=\"sd\">'l___private_Lake_Load_Lean_Elab_0__Lake_addToEnv').</span>\n\n<span class=\"sd\">For declarations from `Init`, `Std`, or `Lean`, you need to set `supportInterpreter := true`</span>\n<span class=\"sd\">in the relevant `lean_exe` statement in your `lakefile.lean`.</span>\n<span class=\"sd\">-/</span>\n<span class=\"c1\">-- #eval CliM.run tmp []</span>\n</code></pre></div>",
        "id": 466691718,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1725191425
    }
]