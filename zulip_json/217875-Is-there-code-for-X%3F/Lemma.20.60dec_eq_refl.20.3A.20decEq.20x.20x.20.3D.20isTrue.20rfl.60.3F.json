[
    {
        "content": "<p>I am very new to Lean4 (though I have experience in both Coq and Agda). I figured out that I can <code>cases decEq x x; contradiction</code> to do the rewrite I want, but it does not feel quite right. However, I looked into the file <code>Prelude.lean</code> and did not find any lemma for <code>decEq</code> itself, only for <code>decide</code>. This also makes me wonder if using <code>decEq</code> directly is idiomatic at all? Should I use something based on <code>decide</code> instead?</p>",
        "id": 547235517,
        "sender_full_name": "Ruifeng Xie",
        "timestamp": 1761559491
    },
    {
        "content": "<p>Can you make a <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a>?</p>",
        "id": 547237731,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1761560162
    },
    {
        "content": "<p>Can you get rid of the part where you <code>cases decEq x x</code> and just <code>contradiction</code> directly?</p>",
        "id": 547238346,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761560353
    },
    {
        "content": "<p>out of curiosity, let me <a href=\"https://en.wikipedia.org/wiki/XY_problem\">#xy</a> <code>decEq</code> is showing up in your goal?</p>",
        "id": 547239678,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1761560779
    },
    {
        "content": "<p>(also, note that your <code>dec_eq_refl</code> can be proven as <code>Subsingleton.elim (decEq x x) (isTrue rfl)</code> since <code>Decidable p</code> is subsingleton)</p>",
        "id": 547240139,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1761560906
    },
    {
        "content": "<p>this also feels like <a href=\"https://en.wikipedia.org/wiki/XY_problem\">#xy</a> to me</p>",
        "id": 547240765,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761561085
    },
    {
        "content": "<p>It might actually be an X-Y problem, because I do not really know what is the best way to achieve my goal. To answer the questions:</p>\n<ul>\n<li><code>decEq x x</code> shows up in the goal (after I <code>unfold</code> the recursive function)</li>\n<li>it appears as the scrutinee of a <code>match</code> expression, so I cannot proceed without rewriting it to <code>isTrue _</code></li>\n<li>using <code>cases decEq x x</code>, the goal splits into two, one of them proceeds with the <code>match</code> simplified, the other is left with a <code>not (x = x)</code> in the premise, which I managed to eliminate with <code>contradiction</code></li>\n</ul>\n<p>I will try to make an MWE right now.</p>",
        "id": 547242312,
        "sender_full_name": "Ruifeng Xie",
        "timestamp": 1761561518
    },
    {
        "content": "<p>Why have you set this as your goal</p>",
        "id": 547242377,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761561539
    },
    {
        "content": "<p>What recursive function does this show up in</p>",
        "id": 547242585,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761561599
    },
    {
        "content": "<p>Consider this example, just pretend that 42 and 0 somehow need to access the proofs <code>x_eq_y</code> and <code>x_neq_y</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">decEq</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"n\">x_eq_y</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">42</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"n\">x_neq_y</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">test_x_x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">42</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">test</span>\n<span class=\"w\">  </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">decEq</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">contradiction</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n</code></pre></div>",
        "id": 547243126,
        "sender_full_name": "Ruifeng Xie",
        "timestamp": 1761561708
    },
    {
        "content": "<p>The preferred way to spell this is usually</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">  </span><span class=\"mi\">42</span>\n<span class=\"k\">else</span>\n<span class=\"w\">  </span><span class=\"mi\">0</span>\n</code></pre></div>",
        "id": 547243341,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1761561766
    },
    {
        "content": "<p>Then <code>cases decEq x x</code> becomes <code>split</code></p>",
        "id": 547243418,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1761561791
    },
    {
        "content": "<p>Oh, thanks. I did not know this syntax for <code>if</code>.</p>",
        "id": 547243628,
        "sender_full_name": "Ruifeng Xie",
        "timestamp": 1761561843
    },
    {
        "content": "<p>But does this actually simplify the proof? After <code>split</code> I seem to still get two goals, one of which to be eliminated by <code>contradiction</code>.</p>",
        "id": 547243739,
        "sender_full_name": "Ruifeng Xie",
        "timestamp": 1761561877
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">decEq</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"n\">x_eq_y</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">42</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"n\">x_neq_y</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">dec_eq_refl</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">decEq</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">decEq</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">contradiction</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">test_x_x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">42</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">test</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"n\">dec_eq_refl</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 547244405,
        "sender_full_name": "Ruifeng Xie",
        "timestamp": 1761562053
    },
    {
        "content": "<p>This version works, so I was wondering if this lemma is present somewhere in the stdlib.</p>",
        "id": 547244619,
        "sender_full_name": "Ruifeng Xie",
        "timestamp": 1761562118
    },
    {
        "content": "<p>Probably not, because no one uses <code>decEq</code>. :-)</p>",
        "id": 547245241,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761562276
    },
    {
        "content": "<p>I see. Should I write in the following way instead?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">y</span>\n<span class=\"w\">  </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"mi\">42</span>\n<span class=\"w\">  </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">test_x_x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">42</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">test</span>\n<span class=\"w\">  </span><span class=\"n\">split</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">contradiction</span>\n</code></pre></div>",
        "id": 547245402,
        "sender_full_name": "Ruifeng Xie",
        "timestamp": 1761562321
    },
    {
        "content": "<p>I can see that the function definition should probably be written this way, but can the proof also be improved?</p>",
        "id": 547245636,
        "sender_full_name": "Ruifeng Xie",
        "timestamp": 1761562380
    },
    {
        "content": "<p>Don't use <code>split</code> if you know which branch of the <code>if</code> is true:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">y</span>\n<span class=\"w\">  </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"mi\">42</span>\n<span class=\"w\">  </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">test_x_x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">42</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">test</span><span class=\"o\">]</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">test_x_x'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">42</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">test</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">test_x_x''</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">42</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">test</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">dif_pos</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"o\">]</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">test_x_x'''</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">42</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">test</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">dif_pos</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n</code></pre></div>",
        "id": 547245710,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1761562399
    },
    {
        "content": "<p>Oh, wow.</p>",
        "id": 547245850,
        "sender_full_name": "Ruifeng Xie",
        "timestamp": 1761562437
    },
    {
        "content": "<p>I did not know <code>simp</code> is this powerful.</p>",
        "id": 547245949,
        "sender_full_name": "Ruifeng Xie",
        "timestamp": 1761562463
    },
    {
        "content": "<p>Where can I learn about the capabilities of these tactics (ideally with some examples)? I am most familiar with Agda and tactics are not a thing there, so I was learning with trial and error.</p>",
        "id": 547246272,
        "sender_full_name": "Ruifeng Xie",
        "timestamp": 1761562571
    },
    {
        "content": "<p>Theorem Proving in Lean has a chapter on tactics that might be a good start:  <a href=\"https://lean-lang.org/theorem_proving_in_lean4/Tactics/#Theorem-Proving-in-Lean-4--Tactics\">https://lean-lang.org/theorem_proving_in_lean4/Tactics/#Theorem-Proving-in-Lean-4--Tactics</a></p>",
        "id": 547249521,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1761563598
    },
    {
        "content": "<p>Thanks for all your kind help.</p>",
        "id": 547249826,
        "sender_full_name": "Ruifeng Xie",
        "timestamp": 1761563700
    },
    {
        "content": "<p>One last question, I guess. With <code>match</code>, I can split on multiple conditions at the same time (copied from my code, please ignore the details):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">is_bound</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">is_bound</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">app‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">app‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"k\">fun</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">app‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"n\">u</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">app‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"n\">v</span>\n</code></pre></div>\n<p>Can I also do the same thing with that dependent if?</p>",
        "id": 547250476,
        "sender_full_name": "Ruifeng Xie",
        "timestamp": 1761563894
    },
    {
        "content": "<p>Also, I noticed that I cannot seem to use dependent if on the <code>Decidable</code> instance being defined. I presume a <code>match</code> is then necessary?</p>",
        "id": 547251073,
        "sender_full_name": "Ruifeng Xie",
        "timestamp": 1761564098
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"982539\">Ruifeng Xie</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Lemma.20.60dec_eq_refl.20.3A.20decEq.20x.20x.20.3D.20isTrue.20rfl.60.3F/near/547250476\">said</a>:</p>\n<blockquote>\n<p>Can I also do the same thing with that dependent if?</p>\n</blockquote>\n<p>just write two <code>if</code>s, it isn't like you aren't doing that in the code already</p>",
        "id": 547259082,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761566508
    },
    {
        "content": "<p>but no this is another <a href=\"https://en.wikipedia.org/wiki/XY_problem\">#xy</a></p>",
        "id": 547259164,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761566528
    },
    {
        "content": "<p>from your code i infer that you're trying to prove that something is decidable, and you shouldn't use the <code>isTrue</code> and <code>isFalse</code> things directly, but rather you should use standard lemmas to help you, in this case you should prove an <code>\\iff</code> statement in <code>Prop</code> land, and then use <a href=\"https://leanprover-community.github.io/mathlib4_docs/Init/Core.html#decidable_of_decidable_of_iff\">decidable_of_decidable_of_iff</a></p>",
        "id": 547259350,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761566584
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"982539\">Ruifeng Xie</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Lemma.20.60dec_eq_refl.20.3A.20decEq.20x.20x.20.3D.20isTrue.20rfl.60.3F/near/547242312\">said</a>:</p>\n<blockquote>\n<ul>\n<li>after I <code>unfold</code> the recursive function</li>\n</ul>\n</blockquote>\n<p>basically this is a common beginner's trap, which is to rely a lot on the underlying definitions, where the better thing to do is to use the standard lemmas to relate definitions to other things</p>",
        "id": 547259507,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761566631
    },
    {
        "content": "<p>basically, let's just say this, if you ever have <code>isTrue</code> and <code>isFalse</code> in your code, you're doing something wrong</p>",
        "id": 547259741,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761566697
    },
    {
        "content": "<p>see <a class=\"message-link\" href=\"/#narrow/channel/113489-new-members/topic/Decidable.20instance/near/546995270\">#new members &gt; Decidable instance @ üí¨</a>  for an example</p>",
        "id": 547259895,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761566744
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"260921\">@Markus Himmel</span> this is the second time (as can be seen by the fact that my previous message is a link), is this covered in TPIL somewhere?</p>",
        "id": 547260049,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761566790
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Lemma.20.60dec_eq_refl.20.3A.20decEq.20x.20x.20.3D.20isTrue.20rfl.60.3F/near/547259741\">said</a>:</p>\n<blockquote>\n<p>basically, let's just say this, if you ever have <code>isTrue</code> and <code>isFalse</code> in your code, you're doing something wrong</p>\n</blockquote>\n<p>I‚Äôm glad to know this before I make even further progress in my proof. It is a habit I carry from Agda, where it does not cause a hassle.</p>",
        "id": 547261151,
        "sender_full_name": "Ruifeng Xie",
        "timestamp": 1761567139
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Lemma.20.60dec_eq_refl.20.3A.20decEq.20x.20x.20.3D.20isTrue.20rfl.60.3F/near/547259350\">said</a>:</p>\n<blockquote>\n<p>from your code i infer that you're trying to prove that something is decidable, and you shouldn't use the <code>isTrue</code> and <code>isFalse</code> things directly, but rather you should use standard lemmas to help you, in this case you should prove an <code>\\iff</code> statement in <code>Prop</code> land, and then use <a href=\"https://leanprover-community.github.io/mathlib4_docs/Init/Core.html#decidable_of_decidable_of_iff\">decidable_of_decidable_of_iff</a></p>\n</blockquote>\n<p>Thanks for the pointer. I‚Äôll check the documentation and see if I can massage these lemmas into the correct shape for the proof. If there is also an induction lemma for decidables, then I should be able to replace all my proof accordingly.</p>\n<p>I have a question, though. What is the benefit of using these lemmas instead of <code>isTrue</code> and <code>isFalse</code>?</p>",
        "id": 547261833,
        "sender_full_name": "Ruifeng Xie",
        "timestamp": 1761567325
    },
    {
        "content": "<p>Prop is generally easier to work with than objects</p>",
        "id": 547262005,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761567377
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/b12LvxzmBWo9axPccV1-QO2H/image.png\">The predicative hierarchy of Prop</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/b12LvxzmBWo9axPccV1-QO2H/image.png\" title=\"The predicative hierarchy of Prop\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"903x280\" src=\"/user_uploads/thumbnail/3121/b12LvxzmBWo9axPccV1-QO2H/image.png/840x560.webp\"></a></div><p>source: <a href=\"https://agda.readthedocs.io/en/v2.6.0/language/prop.html\">https://agda.readthedocs.io/en/v2.6.0/language/prop.html</a></p>",
        "id": 547262303,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761567468
    },
    {
        "content": "<p>Prop in Lean also differs from Prop in Agda in a very significant way: in Lean there is only <code>Prop</code></p>",
        "id": 547262353,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761567483
    },
    {
        "content": "<p>Okay, I see. Then I‚Äôll assume that the benefit of Prop is proof irrelevance. Actually, I had the impression that Prop in Agda is not very pleasant to work with, and I have been using <code>Data.Irrelevance</code> instead.</p>",
        "id": 547263070,
        "sender_full_name": "Ruifeng Xie",
        "timestamp": 1761567678
    },
    {
        "content": "<p>I really wish there is something similar to PLFA for Lean, so that I can work with something familiar and focus on the formalisation and proof techniques.</p>",
        "id": 547263577,
        "sender_full_name": "Ruifeng Xie",
        "timestamp": 1761567855
    },
    {
        "content": "<p>what's PLFA?</p>",
        "id": 547263971,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761567990
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"982539\">Ruifeng Xie</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Lemma.20.60dec_eq_refl.20.3A.20decEq.20x.20x.20.3D.20isTrue.20rfl.60.3F/near/547263070\">said</a>:</p>\n<blockquote>\n<p>Then I‚Äôll assume that the benefit of Prop is proof irrelevance.</p>\n</blockquote>\n<p>I thought Prop in Agda also has proof irrelevance</p>",
        "id": 547264034,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761568012
    },
    {
        "content": "<p>It does. It is just that Agda also has irrelevance notations for any data type at all (without a separate sort), which is exposed in the <code>Data.Irrelevance</code> module from stdlib.</p>",
        "id": 547264427,
        "sender_full_name": "Ruifeng Xie",
        "timestamp": 1761568127
    },
    {
        "content": "<p>PLFA is <em>Programming Language Foundations in Agda</em>, a textbook written by Philip Wadler et al.</p>",
        "id": 547264501,
        "sender_full_name": "Ruifeng Xie",
        "timestamp": 1761568157
    },
    {
        "content": "<p>It is available online at <a href=\"https://plfa.github.io\">https://plfa.github.io</a></p>",
        "id": 547264568,
        "sender_full_name": "Ruifeng Xie",
        "timestamp": 1761568182
    },
    {
        "content": "<p>does <a href=\"https://leanprover.github.io/theorem_proving_in_lean4/\">#tpil</a> suffice?</p>",
        "id": 547265155,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761568369
    },
    {
        "content": "<p>I have not finished reading through it yet, but it has been very helpful. I brought up PLFA mainly because it is driven by examples (formalisation of lambda calculus, modeling semantics, implementing type-checking, etc.), and in each step you learn just enough to accomplish the goal.</p>",
        "id": 547265711,
        "sender_full_name": "Ruifeng Xie",
        "timestamp": 1761568554
    },
    {
        "content": "<p>I must have missed something. I checked the function <code>decidable_of_decidable_of_iff</code>, but I do not see how it is easier to work with then <code>isTrue</code> and <code>isFalse</code>. Below is part of the proof I was working on:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">const</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">var</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">abs</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"o\">)</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"n\">public</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Free</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">var</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Free</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">var</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">app‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Free</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Free</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">app‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Free</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Free</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">abs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚â†</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Free</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Free</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">abs</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"o\">)</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">isFree</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DecidablePred</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Free</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">const</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"n\">nofun</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">var</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">y</span>\n<span class=\"w\">    </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">‚ñ∏</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">var</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">var</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">isFree</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">isFree</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\">  </span><span class=\"bp\">_</span><span class=\"w\">         </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">app‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\">  </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">app‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"k\">fun</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">app‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"n\">u</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">app‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"n\">v</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">abs</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">y</span>\n<span class=\"w\">    </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">abs</span><span class=\"w\"> </span><span class=\"n\">x_neq_y</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">x_neq_y</span>\n<span class=\"w\">    </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">isFree</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">abs</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"n\">u</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\">  </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">abs</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Take the first case (<code>const</code>) of <code>isFree</code> for example, <code>isFalse nofun</code> looks short enough for me, while using <code>decidable_of_decidable_of_iff</code> I only managed to end up with <code>@decidable_of_decidable_of_iff False _ _ ‚ü®nofun, nofun‚ü©</code>.</p>",
        "id": 547268860,
        "sender_full_name": "Ruifeng Xie",
        "timestamp": 1761569548
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"982539\">@Ruifeng Xie</span> that is indeed a little bit tricker. I think in that case I would keep <code>Free</code>, but then below that I would construct <code>freeBool : Expr -&gt; Bool</code> that acts as the \"decision program\", and then below that prove a theorem <code>freeBool_iff_free</code>, and then finally use decidable...iff</p>",
        "id": 547269948,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761569829
    },
    {
        "content": "<p>See <a href=\"https://github.com/leanprover/lean4/blob/744f98064b056ee27fc8c97f524797c8cc96f436/src/Init/Data/List/Basic.lean#L845-L846\">(a : Œ±) (as : List Œ±) : Decidable (a ‚àà as)</a> for an example</p>",
        "id": 547270476,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761569985
    },
    {
        "content": "<p>(the corresponding function to Bool is <a href=\"https://github.com/leanprover/lean4/blob/744f98064b056ee27fc8c97f524797c8cc96f436/src/Init/Data/List/Basic.lean#L780\">elem</a>)</p>",
        "id": 547270528,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761569999
    },
    {
        "content": "<p>I see. I actually tried this approach before switching back to the current version.</p>\n<p>This must be a philosophical thing, then. I try very hard to avoid separating the proof and the algorithm, and I learned this style from Wouter Swierstra (<a href=\"https://webspace.science.uu.nl/~swier004/talks/2024-ifl.pdf\">his IFL24 talk</a> and <a href=\"https://webspace.science.uu.nl/~swier004/publications/2023-jfp.pdf\">his JFP Pearl paper</a>, for example). One of the benefits is that we have a single source of truth, and we do not need to update multiple places when the definition changes. Perhaps it is not a top concern in Lean due to the tactics.</p>",
        "id": 547272768,
        "sender_full_name": "Ruifeng Xie",
        "timestamp": 1761570590
    },
    {
        "content": "<p>You are correct there is a different design tendency to separate \"data\" and proofs. As an example, consider <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Vector#doc\">docs#Vector</a>, which is a structure with an array and a proof about length as opposed to the standard example you might see in Agda or Rocq.</p>",
        "id": 547273319,
        "sender_full_name": "Chris Henson",
        "timestamp": 1761570737
    },
    {
        "content": "<p>I see. It makes sense considering that Lean also needs good runtime performance.</p>",
        "id": 547273590,
        "sender_full_name": "Ruifeng Xie",
        "timestamp": 1761570811
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"982539\">Ruifeng Xie</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Lemma.20.60dec_eq_refl.20.3A.20decEq.20x.20x.20.3D.20isTrue.20rfl.60.3F/near/547272768\">said</a>:</p>\n<blockquote>\n<p>when the definition changes</p>\n</blockquote>\n<p>well, the definition of List.mem actually changed, but that doesn't affect the List -&gt; Bool \"decision program\", so maybe that's one benefit of separating out the algorithm</p>",
        "id": 547274380,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761571046
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"982539\">Ruifeng Xie</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Lemma.20.60dec_eq_refl.20.3A.20decEq.20x.20x.20.3D.20isTrue.20rfl.60.3F/near/547263577\">said</a>:</p>\n<blockquote>\n<p>I really wish there is something similar to PLFA for Lean, so that I can work with something familiar and focus on the formalisation and proof techniques.</p>\n</blockquote>\n<p>maybe <a href=\"http://github.com/rami3l/PLFaLean\">https://github.com/rami3l/PLFaLean</a>?</p>",
        "id": 547616962,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1761703740
    },
    {
        "content": "<p>Wow, thanks.</p>",
        "id": 547626158,
        "sender_full_name": "Ruifeng Xie",
        "timestamp": 1761711422
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"982539\">Ruifeng Xie</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Lemma.20.60dec_eq_refl.20.3A.20decEq.20x.20x.20.3D.20isTrue.20rfl.60.3F/near/547272768\">said</a>:</p>\n<blockquote>\n<p>This must be a philosophical thing, then. I try very hard to avoid separating the proof and the algorithm, [...] One of the benefits is that we have a single source of truth, [...]</p>\n</blockquote>\n<p>I've actually been thinking more about this, and in Mathlib we actually separate the definition and the proof a lot; in fact we tend to (and we encourage people to) make definitions be as general as possible and assume as few things as possible, and as a result the function would take on junk values outside the actual domain of interest. One famous example is how we <strong><em>require</em></strong> fields to satisfy the axiom 1/0 = 0, because we want to make division a total function, because we don't want to be supplying proofs in the theorem <strong><em>statements</em></strong> all of the time.</p>",
        "id": 556795604,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1763376158
    },
    {
        "content": "<p>That makes sense. I think the proof is easier to write and maintain if written at the same place as the definition, but the UX of a separate proof might be better in some scenarios.</p>",
        "id": 556871456,
        "sender_full_name": "Ruifeng Xie",
        "timestamp": 1763395644
    }
]