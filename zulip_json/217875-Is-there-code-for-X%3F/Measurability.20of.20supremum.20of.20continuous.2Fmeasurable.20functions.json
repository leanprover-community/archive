[
    {
        "content": "<p>This is low-priority, but do we have the result in <a href=\"https://math.stackexchange.com/a/4685735/357390\">https://math.stackexchange.com/a/4685735/357390</a> that shows that the supremum of a measurable function over any set (even uncountable) is measurable <strong>as long as</strong> the function is also continuous over the set of the supremum?</p>",
        "id": 526122248,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1751043339
    },
    {
        "content": "<p>(Can somebody move this to <a class=\"stream\" data-stream-id=\"217875\" href=\"/#narrow/channel/217875-Is-there-code-for-X.3F\">#Is there code for X?</a> I sent this from my mobile phone web browser and the UI is somewhat buggy)</p>",
        "id": 526124118,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1751044079
    },
    {
        "content": "<p>This topic was moved here from <a class=\"stream-topic\" data-stream-id=\"113488\" href=\"/#narrow/channel/113488-general/topic/Measurability.20of.20supremum.20of.20continuous.2Fmeasurable.20functions\">#general &gt; Measurability of supremum of continuous/measurable functions</a> by <span class=\"user-mention silent\" data-user-id=\"246273\">Bhavik Mehta</span>.</p>",
        "id": 526163735,
        "sender_full_name": "Notification Bot",
        "timestamp": 1751068854
    },
    {
        "content": "<p>I've got a first version working:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">Constructions</span><span class=\"bp\">.</span><span class=\"n\">BorelSpace</span><span class=\"bp\">.</span><span class=\"n\">Order</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">ENNReal</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">PseudoEMetricSpace</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SeparableSpace</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MeasurableSpace</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">]</span>\n\n<span class=\"sd\">/-- Given `T : Set ι` over a separable pseudometric space `ι`, let `f : ι → X → ℝ≥0∞` be</span>\n<span class=\"sd\">* measurable in `x` for all `t ∈ T`</span>\n<span class=\"sd\">* **continuous** on `T` for all `x`</span>\n\n<span class=\"sd\">Then the supremum of `f` over `T` is measurable. -/</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">measurable_biSup_of_continuousOn</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"bp\">≥</span><span class=\"mi\">0</span><span class=\"bp\">∞</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">mf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Measurable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">cf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ContinuousOn</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Measurable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">⨆</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">measurable_of_Ioi</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">?_</span>\n<span class=\"w\">  </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">J</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sJ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">cJ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">dJ</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">IsSeparable</span><span class=\"bp\">.</span><span class=\"n\">of_separableSpace</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">exists_countable_dense_subset</span>\n<span class=\"w\">  </span><span class=\"n\">suffices</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">⨆</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">⁻¹'</span><span class=\"w\"> </span><span class=\"n\">Ioi</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">⋃</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">J</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">this</span><span class=\"o\">]</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">MeasurableSet</span><span class=\"bp\">.</span><span class=\"n\">biUnion</span><span class=\"w\"> </span><span class=\"n\">cJ</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"n\">mj</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">?_</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">measurableSet_lt</span><span class=\"w\"> </span><span class=\"n\">measurable_const</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mf</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sJ</span><span class=\"w\"> </span><span class=\"n\">mj</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mem_preimage</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mem_Ioi</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">iSup_apply</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">lt_biSup_iff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mem_iUnion₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mem_setOf_eq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">exists_prop</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">constructor</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">rintro</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">t</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mt</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ht</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">continuousOn_iff</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">cf</span>\n<span class=\"w\">    </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ou</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mu</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hu</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">cf</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">mt</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">isOpen_Ioi</span><span class=\"w\"> </span><span class=\"n\">ht</span>\n<span class=\"w\">    </span><span class=\"n\">specialize</span><span class=\"w\"> </span><span class=\"n\">dJ</span><span class=\"w\"> </span><span class=\"n\">mt</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mem_closure_iff</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">dJ</span>\n<span class=\"w\">    </span><span class=\"n\">specialize</span><span class=\"w\"> </span><span class=\"n\">dJ</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">ou</span><span class=\"w\"> </span><span class=\"n\">mu</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">j</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mj</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">dJ</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mj</span><span class=\"bp\">.</span><span class=\"m\">2</span>\n<span class=\"w\">    </span><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">inter_subset_inter</span><span class=\"w\"> </span><span class=\"n\">subset_rfl</span><span class=\"w\"> </span><span class=\"n\">sJ</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"n\">hu</span><span class=\"w\"> </span><span class=\"n\">mj</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sJ</span><span class=\"w\"> </span><span class=\"n\">mt</span>\n</code></pre></div>",
        "id": 527097373,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1751595918
    },
    {
        "content": "<p>Now I want to generalise it to the following, but I don't know how to prove <code>xxx</code>. How do I prove <code>xxx</code>?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">Constructions</span><span class=\"bp\">.</span><span class=\"n\">BorelSpace</span><span class=\"bp\">.</span><span class=\"n\">Order</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">ENNReal</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">PseudoEMetricSpace</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SeparableSpace</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MeasurableSpace</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">]</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">xxx</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">J</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sJ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">J</span><span class=\"w\"> </span><span class=\"bp\">⊆</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">dJ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">⊆</span><span class=\"w\"> </span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"n\">J</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sU</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"bp\">⊆</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"bp\">⊆</span><span class=\"w\"> </span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"bp\">∩</span><span class=\"w\"> </span><span class=\"n\">J</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n\n<span class=\"sd\">/-- Given `T : Set ι` over a separable pseudometric space `ι`, let `f : ι → X → ℝ≥0∞` be</span>\n<span class=\"sd\">* measurable in `x` for all `t ∈ T`</span>\n<span class=\"sd\">* **continuous** on `T` for all `x`</span>\n\n<span class=\"sd\">Then the supremum of `f` over `T` is measurable. -/</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">measurable_biSup_of_continuousOn</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"bp\">≥</span><span class=\"mi\">0</span><span class=\"bp\">∞</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Measurable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">cf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"bp\">⊆</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">ContinuousWithinAt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Measurable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">⨆</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">measurable_of_Ioi</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">?_</span>\n<span class=\"w\">  </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">J</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sJ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">cJ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">dJ</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">IsSeparable</span><span class=\"bp\">.</span><span class=\"n\">of_separableSpace</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">exists_countable_dense_subset</span>\n<span class=\"w\">  </span><span class=\"n\">suffices</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">⨆</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">⁻¹'</span><span class=\"w\"> </span><span class=\"n\">Ioi</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">⋃</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">J</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">this</span><span class=\"o\">]</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">MeasurableSet</span><span class=\"bp\">.</span><span class=\"n\">biUnion</span><span class=\"w\"> </span><span class=\"n\">cJ</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"n\">mj</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">?_</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">measurableSet_lt</span><span class=\"w\"> </span><span class=\"n\">measurable_const</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mf</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sJ</span><span class=\"w\"> </span><span class=\"n\">mj</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mem_preimage</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mem_Ioi</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">iSup_apply</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">lt_biSup_iff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mem_iUnion₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mem_setOf_eq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">exists_prop</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">constructor</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">rintro</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">t</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mt</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ht</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">specialize</span><span class=\"w\"> </span><span class=\"n\">cf</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">mt</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">U</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sU</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mU</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hU</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">cf</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">key</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"bp\">⊆</span><span class=\"w\"> </span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"bp\">∩</span><span class=\"w\"> </span><span class=\"n\">J</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">xxx</span><span class=\"w\"> </span><span class=\"n\">sJ</span><span class=\"w\"> </span><span class=\"n\">dJ</span><span class=\"w\"> </span><span class=\"n\">sU</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ContinuousWithinAt</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">tendsto_nhds</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hU</span>\n<span class=\"w\">    </span><span class=\"n\">specialize</span><span class=\"w\"> </span><span class=\"n\">hU</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">isOpen_Ioi</span><span class=\"w\"> </span><span class=\"n\">ht</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mem_nhdsWithin</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hU</span>\n<span class=\"w\">    </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">V</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">oV</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mV</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hV</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">hU</span>\n<span class=\"w\">    </span><span class=\"n\">specialize</span><span class=\"w\"> </span><span class=\"n\">key</span><span class=\"w\"> </span><span class=\"n\">mU</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mem_closure_iff</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">key</span>\n<span class=\"w\">    </span><span class=\"n\">specialize</span><span class=\"w\"> </span><span class=\"n\">key</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"n\">oV</span><span class=\"w\"> </span><span class=\"n\">mV</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">j</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mj</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">key</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mj</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"m\">2</span>\n<span class=\"w\">    </span><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">hV</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">mj</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mj</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sJ</span><span class=\"w\"> </span><span class=\"n\">mt</span>\n</code></pre></div>",
        "id": 527097438,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1751596007
    },
    {
        "content": "<p>In my use case for Carleson <code>T = {R : ℝ × ℝ | (2 ^ n)⁻¹ &lt; R.1 ∧ R.1 &lt; R.2 ∧ R.2 &lt; 2 ^ n}</code> and <code>U = {R : ℝ × ℝ | t.1 ≤ R.1 ∧ R.1 &lt; R.2 ∧ R.2 ≤ t.2}</code>, so <code>xxx</code> should hold</p>",
        "id": 527097740,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1751596350
    },
    {
        "content": "<p>It's false and I have a counterexample</p>",
        "id": 527097878,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751596521
    },
    {
        "content": "<p>For <code>xxx</code>, I mean</p>",
        "id": 527097900,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751596539
    },
    {
        "content": "<p>Then what assumptions should I have to prove the generalisation?</p>",
        "id": 527097943,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1751596577
    },
    {
        "content": "<p>I don't know</p>",
        "id": 527097954,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751596587
    },
    {
        "content": "<p>My counterexample is let <code>T</code> be the rationals, let <code>J</code> be the dyadics, and let <code>U</code> be the singleton <code>{1 / 3}</code></p>",
        "id": 527098009,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751596649
    },
    {
        "content": "<p>Perhaps ask that U is a subset of its limit points?</p>",
        "id": 527098881,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1751597675
    },
    {
        "content": "<p>No, this also doesn't work for <code>xxx</code> by the same example of Aaron, but having <code>U</code> be the rationals that are not dyadic.</p>",
        "id": 527099464,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1751598233
    },
    {
        "content": "<p>What about the specific instance I mentioned above?</p>",
        "id": 527099846,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1751598514
    },
    {
        "content": "<p>I'm not sure what <code>t</code> is in your example, but can't you just assume that <code>U</code> is open?</p>",
        "id": 527099985,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1751598645
    },
    {
        "content": "<p>by having it be strict <code>t.1 &lt; R.1 ∧ R.1 &lt; R.2 ∧ R.2 &lt; t.2</code></p>",
        "id": 527100034,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1751598700
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"571941\">Lua Viana Reis</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Measurability.20of.20supremum.20of.20continuous.2Fmeasurable.20functions/near/527099985\">said</a>:</p>\n<blockquote>\n<p>I'm not sure what <code>t</code> is in your example, but can't you just assume that <code>U</code> is open?</p>\n</blockquote>\n<p><code>t</code> is some point in <code>T</code>. And no, I can't assume <code>U</code> is open, because I also need <code>t ∈ U</code></p>",
        "id": 527100099,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1751598767
    },
    {
        "content": "<p>(The specific PR is <a href=\"https://github.com/fpvandoorn/carleson/pull/429\">fpvandoorn/carleson#429</a>)</p>",
        "id": 527100141,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1751598817
    },
    {
        "content": "<p>But <span class=\"user-mention\" data-user-id=\"598052\">@Jeremy Tan</span>, I'm a bit confused, if it's continuous in your <code>U(t)</code> for all <code>t</code> in <code>T</code>, then it's continuous in <code>T</code>, no?</p>",
        "id": 527100804,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1751599532
    },
    {
        "content": "<p>Oh, sorry,  the continuity point itself is changing with t, this is probably not true</p>",
        "id": 527100921,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1751599640
    },
    {
        "content": "<p>The blueprint in the Carleson project has these lemmas:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">rightContinuous_carlesonOperatorIntegrand</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Measurable</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">ContinuousWithinAt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">carlesonOperatorIntegrand</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">θ</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">R₂</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Ici</span><span class=\"w\"> </span><span class=\"n\">R₁</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">R₁</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">leftContinuous_carlesonOperatorIntegrand</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Measurable</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">ContinuousWithinAt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">carlesonOperatorIntegrand</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">θ</span><span class=\"w\"> </span><span class=\"n\">R₁</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Iic</span><span class=\"w\"> </span><span class=\"n\">R₂</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">R₂</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>where <code>carlesonOperatorIntegrand</code> is an integral over an annulus whose radii are <code>R₁, R₂</code>.</p>\n<p>With these lemmas alone all I can prove is that with <code>T,U</code> as stated above, the function <code>f := carlesonOperatorIntegrand K θ R.1 R.2 f x</code> is <code>ContinuousWithinAt</code> over <code>U</code>. I'm starting to think that in fact the function is bidirectionally continuous, which would allow me to use the <code>ContinuousOn</code> version directly… but I've probably digressed too much. (Pinging <span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span> as the maintainer of Carleson)</p>",
        "id": 527101062,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1751599810
    },
    {
        "content": "<p>I'm now trying explicitly setting <code>J</code> to be the set of rational-number pairs in <code>T</code></p>",
        "id": 527101117,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1751599862
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"598052\">Jeremy Tan</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Measurability.20of.20supremum.20of.20continuous.2Fmeasurable.20functions/near/527101062\">said</a>:</p>\n<blockquote>\n<p>With these lemmas alone all I can prove is that with <code>T,U</code> as stated above, the function <code>f := carlesonOperatorIntegrand K θ R.1 R.2 f x</code> is <code>ContinuousWithinAt</code> over <code>U</code>.</p>\n</blockquote>\n<p>how can you prove that it's continuous at <code>t</code> on the whole <code>U(t)</code> without extra assumptions? a priori it's only continuous on the union of two segments extending from <code>t</code>, no? (the lemmas only show the limit along those two curves exist)</p>",
        "id": 527102907,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1751601667
    },
    {
        "content": "<p>which would make the original question harder, because now there isn't a countable set that is dense in every <code>U(t)</code></p>",
        "id": 527103322,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1751601967
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"598052\">Jeremy Tan</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Measurability.20of.20supremum.20of.20continuous.2Fmeasurable.20functions/near/527101117\">said</a>:</p>\n<blockquote>\n<p>I'm now trying explicitly setting <code>J</code> to be the set of rational-number pairs in <code>T</code></p>\n</blockquote>\n<p>I've proven the original thing I wanted <code>measurable_lcoConvergent</code> in this way, reducing it to two Theorem 3.0.1 sublemmas. It has been pushed to <a href=\"https://github.com/fpvandoorn/carleson/pull/429\">fpvandoorn/carleson#429</a></p>",
        "id": 527108145,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1751605778
    }
]