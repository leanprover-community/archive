[
    {
        "content": "<p>I am looking for a way to represent the following Rocq code in Lean4.</p>\n<div class=\"codehilite\" data-code-language=\"Coq\"><pre><span></span><code><span class=\"kn\">Local</span> <span class=\"kn\">Open</span> <span class=\"kn\">Scope</span> <span class=\"n\">positive_scope</span><span class=\"o\">.</span>\n\n<span class=\"kn\">Local</span> <span class=\"kn\">Notation</span> <span class=\"s2\">\"P ~ 0\"</span> <span class=\"o\">:=</span> <span class=\"o\">(λ</span> <span class=\"n\">p</span><span class=\"o\">,</span> <span class=\"n\">P</span> <span class=\"n\">p</span><span class=\"o\">~</span><span class=\"mi\">0</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">function_scope</span><span class=\"o\">.</span>\n<span class=\"kn\">Local</span> <span class=\"kn\">Notation</span> <span class=\"s2\">\"P ~ 1\"</span> <span class=\"o\">:=</span> <span class=\"o\">(λ</span> <span class=\"n\">p</span><span class=\"o\">,</span> <span class=\"n\">P</span> <span class=\"n\">p</span><span class=\"o\">~</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">function_scope</span><span class=\"o\">.</span>\n\n<span class=\"kn\">Inductive</span> <span class=\"n\">gmap_dep_ne</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">P</span> <span class=\"o\">:</span> <span class=\"n\">positive</span> <span class=\"o\">→</span> <span class=\"kt\">Prop</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n  <span class=\"o\">|</span> <span class=\"n\">GNode001</span> <span class=\"o\">:</span> <span class=\"n\">gmap_dep_ne</span> <span class=\"n\">A</span> <span class=\"n\">P</span><span class=\"o\">~</span><span class=\"mi\">1</span> <span class=\"o\">→</span> <span class=\"n\">gmap_dep_ne</span> <span class=\"n\">A</span> <span class=\"n\">P</span>\n  <span class=\"o\">|</span> <span class=\"n\">GNode010</span> <span class=\"o\">:</span> <span class=\"n\">P</span> <span class=\"mi\">1</span> <span class=\"o\">→</span> <span class=\"n\">A</span> <span class=\"o\">→</span> <span class=\"n\">gmap_dep_ne</span> <span class=\"n\">A</span> <span class=\"n\">P</span>\n  <span class=\"o\">|</span> <span class=\"n\">GNode011</span> <span class=\"o\">:</span> <span class=\"n\">P</span> <span class=\"mi\">1</span> <span class=\"o\">→</span> <span class=\"n\">A</span> <span class=\"o\">→</span> <span class=\"n\">gmap_dep_ne</span> <span class=\"n\">A</span> <span class=\"n\">P</span><span class=\"o\">~</span><span class=\"mi\">1</span> <span class=\"o\">→</span> <span class=\"n\">gmap_dep_ne</span> <span class=\"n\">A</span> <span class=\"n\">P</span>\n  <span class=\"o\">|</span> <span class=\"n\">GNode100</span> <span class=\"o\">:</span> <span class=\"n\">gmap_dep_ne</span> <span class=\"n\">A</span> <span class=\"n\">P</span><span class=\"o\">~</span><span class=\"mi\">0</span> <span class=\"o\">→</span> <span class=\"n\">gmap_dep_ne</span> <span class=\"n\">A</span> <span class=\"n\">P</span>\n  <span class=\"o\">|</span> <span class=\"n\">GNode101</span> <span class=\"o\">:</span> <span class=\"n\">gmap_dep_ne</span> <span class=\"n\">A</span> <span class=\"n\">P</span><span class=\"o\">~</span><span class=\"mi\">0</span> <span class=\"o\">→</span> <span class=\"n\">gmap_dep_ne</span> <span class=\"n\">A</span> <span class=\"n\">P</span><span class=\"o\">~</span><span class=\"mi\">1</span> <span class=\"o\">→</span> <span class=\"n\">gmap_dep_ne</span> <span class=\"n\">A</span> <span class=\"n\">P</span>\n  <span class=\"o\">|</span> <span class=\"n\">GNode110</span> <span class=\"o\">:</span> <span class=\"n\">gmap_dep_ne</span> <span class=\"n\">A</span> <span class=\"n\">P</span><span class=\"o\">~</span><span class=\"mi\">0</span> <span class=\"o\">→</span> <span class=\"n\">P</span> <span class=\"mi\">1</span> <span class=\"o\">→</span> <span class=\"n\">A</span> <span class=\"o\">→</span> <span class=\"n\">gmap_dep_ne</span> <span class=\"n\">A</span> <span class=\"n\">P</span>\n  <span class=\"o\">|</span> <span class=\"n\">GNode111</span> <span class=\"o\">:</span> <span class=\"n\">gmap_dep_ne</span> <span class=\"n\">A</span> <span class=\"n\">P</span><span class=\"o\">~</span><span class=\"mi\">0</span> <span class=\"o\">→</span> <span class=\"n\">P</span> <span class=\"mi\">1</span> <span class=\"o\">→</span> <span class=\"n\">A</span> <span class=\"o\">→</span> <span class=\"n\">gmap_dep_ne</span> <span class=\"n\">A</span> <span class=\"n\">P</span><span class=\"o\">~</span><span class=\"mi\">1</span> <span class=\"o\">→</span> <span class=\"n\">gmap_dep_ne</span> <span class=\"n\">A</span> <span class=\"n\">P</span><span class=\"o\">.</span>\n\n<span class=\"kn\">Variant</span> <span class=\"n\">gmap_dep</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">P</span> <span class=\"o\">:</span> <span class=\"n\">positive</span> <span class=\"o\">→</span> <span class=\"kt\">Prop</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n  <span class=\"o\">|</span> <span class=\"n\">GEmpty</span> <span class=\"o\">:</span> <span class=\"n\">gmap_dep</span> <span class=\"n\">A</span> <span class=\"n\">P</span>\n  <span class=\"o\">|</span> <span class=\"n\">GNodes</span> <span class=\"o\">:</span> <span class=\"n\">gmap_dep_ne</span> <span class=\"n\">A</span> <span class=\"n\">P</span> <span class=\"o\">→</span> <span class=\"n\">gmap_dep</span> <span class=\"n\">A</span> <span class=\"n\">P</span><span class=\"o\">.</span>\n</code></pre></div>",
        "id": 566649260,
        "sender_full_name": "Ka Wing Li",
        "timestamp": 1767751479
    },
    {
        "content": "<p>I tried the following</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">postfix</span><span class=\"o\">:</span><span class=\"n\">arg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">priority</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">high</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"~0\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">PosNum</span><span class=\"bp\">.</span><span class=\"n\">bit0</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span>\n<span class=\"kn\">postfix</span><span class=\"o\">:</span><span class=\"n\">arg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">priority</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">high</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"~1\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">PosNum</span><span class=\"bp\">.</span><span class=\"n\">bit1</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">gmap_dep_ne</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PosNum</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">GNode001</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">gmap_dep_ne</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"bp\">~</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">gmap_dep_ne</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">P</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">GNode010</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">gmap_dep_ne</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">P</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">GNode011</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">gmap_dep_ne</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"bp\">~</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">gmap_dep_ne</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">P</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">GNode100</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">gmap_dep_ne</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"bp\">~</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">gmap_dep_ne</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">P</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">GNode101</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">gmap_dep_ne</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"bp\">~</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">gmap_dep_ne</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"bp\">~</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">gmap_dep_ne</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">P</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">GNode110</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">gmap_dep_ne</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"bp\">~</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">gmap_dep_ne</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">P</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">GNode111</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">gmap_dep_ne</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"bp\">~</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">gmap_dep_ne</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"bp\">~</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">gmap_dep_ne</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">P</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">gmap_dep</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PosNum</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">GEmpty</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">gmap_dep</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">P</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">GNodes</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">gmap_dep_ne</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">gmap_dep</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">P</span>\n</code></pre></div>",
        "id": 566649298,
        "sender_full_name": "Ka Wing Li",
        "timestamp": 1767751508
    },
    {
        "content": "<p>Yet get some cryptic error</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>Mismatched inductive type parameter in\n  gmap_dep_ne A ((fun P p ↦ P p.bit1) P)\nThe provided argument\n  (fun P p ↦ P p.bit1) P\nis not definitionally equal to the expected parameter\n  P\n</code></pre></div>",
        "id": 566649363,
        "sender_full_name": "Ka Wing Li",
        "timestamp": 1767751554
    },
    {
        "content": "<p>it works when you make it</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">gmap_dep_ne</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PosNum</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n</code></pre></div>",
        "id": 566649397,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767751576
    },
    {
        "content": "<p>I tried that, but encounter problem when writing a recursive function traversing the gmap.</p>",
        "id": 566649494,
        "sender_full_name": "Ka Wing Li",
        "timestamp": 1767751638
    },
    {
        "content": "<p>can you show the problem</p>",
        "id": 566649574,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767751679
    },
    {
        "content": "<p>Yep, I am extracting the code of the problem</p>",
        "id": 566649608,
        "sender_full_name": "Ka Wing Li",
        "timestamp": 1767751697
    },
    {
        "content": "<p>I am not sure if this is okay</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">gmap_dep_ne</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">DecidableEq</span>\n<span class=\"w\">  </span><span class=\"n\">intros</span><span class=\"w\"> </span><span class=\"n\">t₁</span><span class=\"w\"> </span><span class=\"n\">t₂</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">rec</span><span class=\"w\"> </span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t₁</span><span class=\"w\"> </span><span class=\"n\">t₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">gmap_dep_ne</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t₁</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">t₂</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">t₁</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">t₂</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">GNode001</span><span class=\"w\"> </span><span class=\"n\">r1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">GNode001</span><span class=\"w\"> </span><span class=\"n\">r2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"n\">r1</span><span class=\"w\"> </span><span class=\"n\">r2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">GNode010</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">GNode010</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">GNode011</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"n\">r1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">GNode011</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"n\">r2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">GNode100</span><span class=\"w\"> </span><span class=\"n\">l1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">GNode100</span><span class=\"w\"> </span><span class=\"n\">l2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">GNode101</span><span class=\"w\"> </span><span class=\"n\">l1</span><span class=\"w\"> </span><span class=\"n\">r1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">GNode101</span><span class=\"w\"> </span><span class=\"n\">l2</span><span class=\"w\"> </span><span class=\"n\">r2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">GNode110</span><span class=\"w\"> </span><span class=\"n\">l1</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">GNode110</span><span class=\"w\"> </span><span class=\"n\">l2</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">GNode111</span><span class=\"w\"> </span><span class=\"n\">l1</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"n\">r1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">GNode111</span><span class=\"w\"> </span><span class=\"n\">l2</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"n\">r2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n</code></pre></div>",
        "id": 566650145,
        "sender_full_name": "Ka Wing Li",
        "timestamp": 1767752116
    },
    {
        "content": "<p>error at <code>(go r1 r2)</code></p>",
        "id": 566650224,
        "sender_full_name": "Ka Wing Li",
        "timestamp": 1767752167
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>Application type mismatch: The argument\n  r1\nhas type\n  gmap_dep_ne A ((fun P p ↦ P p.bit1) P)\nbut is expected to have type\n  gmap_dep_ne A P\nin the application\n  go r1\n</code></pre></div>",
        "id": 566650249,
        "sender_full_name": "Ka Wing Li",
        "timestamp": 1767752186
    },
    {
        "content": "<p><code>(∀ i (x y : P i), x = y)</code> is weird</p>",
        "id": 566650257,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767752189
    },
    {
        "content": "<p>I can fill it in with <code>fun _ _ _ =&gt; rfl</code></p>",
        "id": 566650267,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767752197
    },
    {
        "content": "<p>It is from Rocq <code>(∀ i, ProofIrrel (P i))</code>, probably should not be used here.</p>",
        "id": 566650353,
        "sender_full_name": "Ka Wing Li",
        "timestamp": 1767752252
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"939203\">Ka Wing Li</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Dependent.20inductive.20parameter/near/566650249\">said</a>:</p>\n<blockquote>\n<p><div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>Application type mismatch: The argument\n  r1\nhas type\n  gmap_dep_ne A ((fun P p ↦ P p.bit1) P)\nbut is expected to have type\n  gmap_dep_ne A P\nin the application\n  go r1\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>isn't <code>go</code> just the original function again</p>",
        "id": 566650369,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767752262
    },
    {
        "content": "<p>if you give the instance a name you can call it recursively</p>",
        "id": 566650386,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767752273
    },
    {
        "content": "<p>what do you mean?</p>",
        "id": 566650420,
        "sender_full_name": "Ka Wing Li",
        "timestamp": 1767752310
    },
    {
        "content": "<p><code>instance decEq [DecidableEq A] : DecidableEq (gmap_dep_ne A P) := fun t₁ t₂ =&gt;</code></p>",
        "id": 566650436,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767752326
    },
    {
        "content": "<p>and then you call <code>decEq</code> recursively</p>",
        "id": 566650448,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767752341
    },
    {
        "content": "<p>You mean the following?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">dec</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">gmap_dep_ne</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">t₁</span><span class=\"w\"> </span><span class=\"n\">t₂</span><span class=\"w\"> </span><span class=\"bp\">↦</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">t₁</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">t₂</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">GNode001</span><span class=\"w\"> </span><span class=\"n\">r1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">GNode001</span><span class=\"w\"> </span><span class=\"n\">r2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">dec</span><span class=\"w\"> </span><span class=\"n\">r1</span><span class=\"w\"> </span><span class=\"n\">r2</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">decide</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 566650709,
        "sender_full_name": "Ka Wing Li",
        "timestamp": 1767752554
    },
    {
        "content": "<p>let me try</p>",
        "id": 566650714,
        "sender_full_name": "Ka Wing Li",
        "timestamp": 1767752559
    },
    {
        "content": "<p>It's working! Thanks.</p>",
        "id": 566651097,
        "sender_full_name": "Ka Wing Li",
        "timestamp": 1767752843
    },
    {
        "content": "<p>Sometimes helper functions cause weird problems and inlining works.</p>",
        "id": 566651131,
        "sender_full_name": "Ka Wing Li",
        "timestamp": 1767752873
    },
    {
        "content": "<p>That's another story.</p>",
        "id": 566651147,
        "sender_full_name": "Ka Wing Li",
        "timestamp": 1767752890
    },
    {
        "content": "<p>by the way you can <code>deriving DecidableEq</code> for your <code>gmap_dep_ne</code></p>",
        "id": 566651199,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767752916
    },
    {
        "content": "<p>... why I am doing this</p>",
        "id": 566651428,
        "sender_full_name": "Ka Wing Li",
        "timestamp": 1767753095
    },
    {
        "content": "<p>Excuse me, another similar question:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">GNode</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ml</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">gmap_dep</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"bp\">~</span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">gmap_dep</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"bp\">~</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">gmap_dep</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">ml</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mx</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mr</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">GNodes</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">GNodes</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">GNodes</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">GNode111</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>I got problem for <code>P 1</code> in type. </p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>Type mismatch\n  P 1\nhas type\n  Prop\nof sort `Type` but is expected to have type\n  Type ?u.27678\nof sort `Type (?u.27678 + 1)`\n</code></pre></div>",
        "id": 566656215,
        "sender_full_name": "Ka Wing Li",
        "timestamp": 1767756962
    },
    {
        "content": "<p>Tried to change <code>P 1</code> to <code>Prop</code> or <code>Type</code> will result in <code>p</code> being <code>P 1</code> instead of others.</p>",
        "id": 566656277,
        "sender_full_name": "Ka Wing Li",
        "timestamp": 1767757015
    },
    {
        "content": "<p>you can make it <code>(mx : Option (P 1 ×' A))</code></p>",
        "id": 566657063,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767757600
    },
    {
        "content": "<p>? What’s that?</p>",
        "id": 566657263,
        "sender_full_name": "Ka Wing Li",
        "timestamp": 1767757698
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=PProd#doc\">docs#PProd</a></p>",
        "id": 566657282,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767757708
    },
    {
        "content": "<p>Ahh, interesting</p>",
        "id": 566657413,
        "sender_full_name": "Ka Wing Li",
        "timestamp": 1767757784
    },
    {
        "content": "<p>and then the pattern will be <code>| .GNodes l, some ⟨p, x⟩, .GNodes r =&gt; .GNodes (.GNode111 l p x r)</code>, with the angle brackets <code>⟨⟩</code> instead of parentheses <code>()</code></p>",
        "id": 566657424,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767757794
    },
    {
        "content": "<p>?!</p>",
        "id": 566657499,
        "sender_full_name": "Ka Wing Li",
        "timestamp": 1767757855
    },
    {
        "content": "<p>the <code>(a, b)</code> notation gives you <code>Prod.mk a b</code>, so it's specific to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Prod#doc\">docs#Prod</a></p>",
        "id": 566657537,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767757881
    },
    {
        "content": "<p>so if you use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=PProd#doc\">docs#PProd</a> that won't work</p>",
        "id": 566657552,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767757896
    },
    {
        "content": "<p>instead you need to do <code>PProd.mk a b</code> explicitly, or you can use the anonymous constructor notation <code>⟨a, b⟩</code> which works on any inductive type with only one constructor</p>",
        "id": 566657588,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767757938
    },
    {
        "content": "<p>Angle bracket is building record, right?</p>",
        "id": 566657591,
        "sender_full_name": "Ka Wing Li",
        "timestamp": 1767757941
    },
    {
        "content": "<p>Okay, that make sense now</p>",
        "id": 566657648,
        "sender_full_name": "Ka Wing Li",
        "timestamp": 1767757985
    },
    {
        "content": "<p>One day I’m going to understand the universe in Lean</p>",
        "id": 566657786,
        "sender_full_name": "Ka Wing Li",
        "timestamp": 1767758117
    },
    {
        "content": "<p>I need some doc about the similarities and differences of universe in lean and rocq</p>",
        "id": 566657863,
        "sender_full_name": "Ka Wing Li",
        "timestamp": 1767758172
    },
    {
        "content": "<p>Thanks for the help btw!</p>",
        "id": 566658007,
        "sender_full_name": "Ka Wing Li",
        "timestamp": 1767758277
    }
]