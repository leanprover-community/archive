[
    {
        "content": "<p>Hi, I am having trouble proving even the most basic properties of edges in a SimpleGraph. Basically I would expect there to be some method that takes <code>(e : Sym2)</code> and <code>(he : e ∈ G.edgeSet)</code> and returns a Finset with two distinct vertices that are adjacent or at least two vertices that are members of <code>e</code> and that are <code>Mem.other</code> of each other, but I was unable to find anything and am struggling with how to handle Sym2. The only thing I managed is <code>obtain ⟨v, w⟩ := e</code> and <code>have : G.Adj v w := by aesop</code>, but <code>v ∈ e</code> and <code>w ∈ e</code>I cannot obtain.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Combinatorics</span><span class=\"bp\">.</span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">Sym</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Aesop</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableRel</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Adj</span><span class=\"o\">]</span>\n\n<span class=\"c1\">-- Should follow by definition of Sym2</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">t1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Sym2</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">card</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"c1\">-- Should follow by definition of Sym2 by simply picking one element out of it</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">t2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Sym2</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">card</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"c1\">-- Should follow by irreflexivity of the edge relation in SimpleGraph</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">t3</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Sym2</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">he</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">edgeSet</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">card</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">v</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">e</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Adj</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">aesop</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">Adj</span><span class=\"bp\">.</span><span class=\"n\">ne'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">adj_symm</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Sym2</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">he</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">edgeSet</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">card</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">le_antisymm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t3</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"n\">he</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t1</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"o\">))</span>\n</code></pre></div>",
        "id": 475520098,
        "sender_full_name": "Christoph Spiegel",
        "timestamp": 1728380156
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Combinatorics</span><span class=\"bp\">.</span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">Sym</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableRel</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Adj</span><span class=\"o\">]</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Finset</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Sym2</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">he</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">edgeSet</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">card</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">v</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">e</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hvw</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Adj</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">mem_edgeSet</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">he</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">card_eq_two</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hvw</span><span class=\"bp\">.</span><span class=\"n\">ne</span>\n<span class=\"w\">  </span><span class=\"n\">ext</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n</code></pre></div>",
        "id": 475521745,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1728380654
    },
    {
        "content": "<p>I think <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Finset.card_eq_two#doc\">docs#Finset.card_eq_two</a> was your main missing ingredient.</p>",
        "id": 475521834,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1728380687
    },
    {
        "content": "<p>I was actually aware of this bit didn't try to apply it this because it did not occur to me that simp could resolve this if it isn't able to resolve <code>v ∈ e</code>, <code>w ∈ e</code>, and <code>s(v,w) = e</code>. I think obtain works differently than I expected since it replaces <code>e</code> with <code>s(v,w)</code> in the objective, but does keep <code>e</code> around in the assumptions (now seemingly disjoint from anything else)?</p>",
        "id": 475524568,
        "sender_full_name": "Christoph Spiegel",
        "timestamp": 1728381579
    },
    {
        "content": "<p><code>induction e with | h v w =&gt;</code> is probably a better spelling of <code>obtain ⟨v, w⟩ := e</code>. The former removes <code>e</code> from the context and uses the nicer notation <code>s(v, w)</code>.</p>",
        "id": 475525207,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1728381781
    },
    {
        "content": "<p>Maybe more of a meta question: what is the motivation behind defining graphs through an adjacency relationship. Deriving the set notion from this still feels clumsy and once one moves to hypergraphs, multi-edges, and directed graphs the adjacency notion seems to me the less natural one. Defining it based on (multi)sets with cardinality conditions if one enforces uniformity / loop-lessnes and deriving an adjacency relationship only for the particular case of loopless simple graphs through membership of two distinct vertices in some edge is what I would have expected to be the underlying notion. But I might be missing something here.</p>",
        "id": 475525278,
        "sender_full_name": "Christoph Spiegel",
        "timestamp": 1728381804
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span> yeah, that makes sense. Wanting to prove <code>v ∈ e</code> is nonsensical since <code>e</code> basically doesn't exist anymore and has been replaced by <code>s(v,w)</code>, so membership is taken care of by <code>Sym2.mem_mk_left</code> and <code>Sym2.mem_mk_right</code> as expected.</p>",
        "id": 475525774,
        "sender_full_name": "Christoph Spiegel",
        "timestamp": 1728381959
    },
    {
        "content": "<p>There are lots of ways to write a foundation for graph theory, and it might well be one of those situations where you can't please all of the people all of the time. It seems to me that the word \"graph\" is used in many different ways in the literature, and this only compounds the problem -- people come along who are used to their kind of graphs, and find that mathlib's is different, and this is already a source of frustration.</p>",
        "id": 475525905,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1728381992
    },
    {
        "content": "<p>For a long time we didn't have any graph theory library, because we weren't sure in what generality we should set it up (multigraphs, (un)directed graphs, ...). At some point <span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> and others decided to just go ahead defining simple graphs and we got a graph library based on that.<br>\nNote that a multigraph is just an element of <code>V → V → Type*</code>, which you can find under <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Quiver#doc\">docs#Quiver</a></p>",
        "id": 475525936,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1728382001
    },
    {
        "content": "<p>I understand that. The adjacency notion feels more like the CS / DO / OR point of view and closer to how graphs were \"originally\" defined. Papers from the early 20th century will always talk about points with a relationship, rather than a set of edges that is a subset of the powerset. The set notion (which perhaps generalizes more easily to hypergraphs) seems to be more popular with the Extremal Combinatorics crowd and started somewhat later.</p>",
        "id": 475527467,
        "sender_full_name": "Christoph Spiegel",
        "timestamp": 1728382533
    },
    {
        "content": "<p>How difficult is it to maintain competing notions with a translation / bijection layer? One could define them both ways and then have a statement that converts from one into the other, which would allow one to pull results established for either notion to the other one. I am not sure how neatly this can be done in LEAN though and if this still aligns with the mathlib principles (probably not).</p>",
        "id": 475527746,
        "sender_full_name": "Christoph Spiegel",
        "timestamp": 1728382627
    },
    {
        "content": "<p>The formalization of the Sensitivity conjecture also went its own way and just picked one view of the hypercube that worked best for the linear algebra proof, i.e., vertices as 0-1-vectors as opposed to the poset lattice. Graphs seem to be particularly messy like that and people just freely switch between several different but isomorphic definitions in their papers based on what happens to be cleaner... seems to be a challenge to find a common ground for that in some general library like mathlib.</p>",
        "id": 475528622,
        "sender_full_name": "Christoph Spiegel",
        "timestamp": 1728382929
    },
    {
        "content": "<p>One could define a <code>GraphLike</code> typeclass covering several implementations, with a chosen short-list of features constituting the API (and then prove things on the abstract version whenever it is possible). But it is not clear how possible it is to abstract away the basic definitions.</p>",
        "id": 475528795,
        "sender_full_name": "Vincent Beffara",
        "timestamp": 1728382993
    },
    {
        "content": "<p>Back to the original question, using the suggestion of <span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span> one can at least make the proof somewhat less obscure and more compact as follows:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">card_eq_two</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">aesop</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">ext</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n</code></pre></div>\n<p>This still seems too much work for \"an edge contains two distinct vertices\" but given the current notion of SimpleGraph this is perhaps the cleanest way to establish that.</p>",
        "id": 475531407,
        "sender_full_name": "Christoph Spiegel",
        "timestamp": 1728383995
    },
    {
        "content": "<p>Counting is hard in a formal system. I thought that group theory would be easy and then I looked at what we were teaching the undergraduates and it was all about finite groups, which made things much more fiddly.</p>",
        "id": 475638126,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1728412273
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"695413\">@Christoph Spiegel</span> Think about <code>SimpleGraph</code> as being the abstract interface for simple graphs, it's not <em>the</em> definition of a graph. Any particular concrete example can be worked with by creating a function from the data of the graph to the SimpleGraph and then proving things about it there.</p>\n<p>For example, <a href=\"https://github.com/leanprover-community/mathlib4/blob/master/Archive/Wiedijk100Theorems/Konigsberg.lean\">https://github.com/leanprover-community/mathlib4/blob/master/Archive/Wiedijk100Theorems/Konigsberg.lean</a> creates some inductive types with the graph data, it's linked up to <code>SimpleGraph</code> with the <code>graph</code> definition, and then there are lemmas doing some computations.</p>",
        "id": 475649770,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1728415418
    },
    {
        "content": "<p>Here's another version of Floris's proof:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Sym2</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">he</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">edgeSet</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">card</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">card_eq_two</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">he</span><span class=\"bp\">.</span><span class=\"n\">ne</span>\n<span class=\"w\">  </span><span class=\"n\">ext</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n</code></pre></div>\n<p>The definition of <code>G.edgeSet</code> is set up so that <code>s(x, y) ∈ G.edgeSet</code> is definitionally equal to <code>G.Adj x y</code>.</p>",
        "id": 475651216,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1728415818
    },
    {
        "content": "<p>Can you say a bit about what you are working on <span class=\"user-mention\" data-user-id=\"695413\">@Christoph Spiegel</span>, where you need to know the cardinality of edges as sets?</p>",
        "id": 475652012,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1728416010
    },
    {
        "content": "<p>You might also like to know about <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=SimpleGraph.fromEdgeSet#doc\">docs#SimpleGraph.fromEdgeSet</a>, which is a different constructor for SimpleGraph that gives the set-of-edges point of view.</p>\n<p>One of the reasons SimpleGraph is an adjacency relation rather than a set-of-edges is that it's much easier writing proofs about an adjacency relation. Working with <code>Sym2</code> is a bit of a pain in comparison, though it's doable.</p>",
        "id": 475652729,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1728416171
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> So very concretely I wanted to type up the Cauchy-Schwarz proof of Mantel's Theorem, for which I first wanted (mostly as an exercise to get familiar with mathlib's notion of SimpleGraph) to prove the Handshake Lemma. I know it is already implemented, but I wanted to see a version that more closely mimics what you would see in the first week of any graph theory course instead of something that abstracts a lot of things away; I had never heard about darts in the context of graph theory prior to seeing it in mathlib.</p>",
        "id": 475835354,
        "sender_full_name": "Christoph Spiegel",
        "timestamp": 1728473735
    },
    {
        "content": "<p>This is currently the cleanest I could come up with and it requires the proof that an edge contains two vertices:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Combinatorics</span><span class=\"bp\">.</span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">Finite</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">BigOperators</span><span class=\"bp\">.</span><span class=\"n\">Ring</span><span class=\"bp\">.</span><span class=\"n\">Finset</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Combinatorics</span><span class=\"bp\">.</span><span class=\"n\">Enumerative</span><span class=\"bp\">.</span><span class=\"n\">DoubleCounting</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableRel</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Adj</span><span class=\"o\">]</span>\n\n<span class=\"kn\">prefix</span><span class=\"o\">:</span><span class=\"mi\">100</span><span class=\"w\"> </span><span class=\"s2\">\"#\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">card</span>\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"E\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">edgeFinset</span>\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"d(\"</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"s2\">\")\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">degree</span><span class=\"w\"> </span><span class=\"n\">v</span>\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"I(\"</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"s2\">\")\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">incidenceFinset</span><span class=\"w\"> </span><span class=\"n\">v</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">edge_card_eq_two</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Sym2</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">he</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">card_eq_two</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">aesop</span><span class=\"o\">)</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">ext</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n\n<span class=\"c1\">-- Proof through direct calculation</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">handshaking</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∑</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">calc</span><span class=\"w\">  </span><span class=\"bp\">∑</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">∑</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">I</span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\">                </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">card_incidenceFinset_eq_degree</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">∑</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">{</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"o\">}</span><span class=\"w\">     </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">incidenceFinset_eq_filter</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">∑</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"o\">}</span><span class=\"w\">     </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">sum_card_bipartiteAbove_eq_sum_card_bipartiteBelow</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">    </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">∑</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\">                </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">sum_congr</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"n\">he</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">edge_card_eq_two</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"n\">he</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">∑</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\">            </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">mul_sum</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n<span class=\"w\">    </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">E</span><span class=\"w\">                    </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">card_eq_sum_ones</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 475835785,
        "sender_full_name": "Christoph Spiegel",
        "timestamp": 1728473825
    },
    {
        "content": "<p>I'm not sure what you mean by \"instead of something that abstracts something away\" (the mathlib version tries to make the proof be very combinatorial: both sides of the equality count darts in a different way, where a dart is just an ordered pair of adjacent vertices instead of a non-ordered pair), but your proof is nice.</p>\n<p>Lots of times with formalization you have to rethink how to prove something cleanly, so I was worried you were trying to force some edges-as-sets argument, but sums-and-indicator-functions-style arguments are a good justification for it.</p>",
        "id": 475878740,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1728483979
    },
    {
        "content": "<p>These edge-cardinality theorems are clearly missing from mathlib. They're not there just because they haven't been needed yet.</p>",
        "id": 475880052,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1728484257
    },
    {
        "content": "<p>That's good to know, then I'll PR at least <code>edge_card_eq_two</code> when I have a moment!</p>",
        "id": 475884418,
        "sender_full_name": "Christoph Spiegel",
        "timestamp": 1728485133
    },
    {
        "content": "<p>I started collecting some theory here: <a href=\"https://github.com/leanprover-community/mathlib4/pull/17587\">https://github.com/leanprover-community/mathlib4/pull/17587</a></p>\n<p>I'd like <code>edge_card_eq_two</code> to be an immediate consequence of things from <code>Sym2</code></p>",
        "id": 475887064,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1728485735
    },
    {
        "content": "<p>Re abstracting away: mathlib in my (admittedly very limited) experience tends to abstract, dissect, and generalize as much as possible; this is absolutely the right thing to do, but can also make connecting ones math knowledge to what's in the library difficult. I am (perhaps misguidedly) therefore currently trying to write up some simple proofs as closely as possible to what one would find on paper in some lecture notes without introducing additional more abstract notions but still basing it on mathlib. This is partially for my own amusement and partially with the hopes that it might eventually make a good resource to make lean and mathlib more approachable for others. Think of it sort of half-way between The Natural Number Game and full on mathlib-level coding.</p>",
        "id": 475887767,
        "sender_full_name": "Christoph Spiegel",
        "timestamp": 1728485909
    },
    {
        "content": "<p>I think what you are doing is valuable, since that's how we find missing material. The main way new stuff gets added to the library is when someone tries to do something and runs into the inevitable gaps.</p>",
        "id": 475888093,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1728485999
    },
    {
        "content": "<p>(Feel free to push <code>edge_card_eq_two</code> to that branch <span class=\"user-mention\" data-user-id=\"695413\">@Christoph Spiegel</span>, we can refactor later)</p>",
        "id": 475890759,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1728486456
    },
    {
        "content": "<p>Done, also defined <code>Sym2.card</code> as <code>Sym2.toFinset.card</code>. Hope that makes sense!</p>",
        "id": 475905518,
        "sender_full_name": "Christoph Spiegel",
        "timestamp": 1728489322
    },
    {
        "content": "<p>Or is there a more natural way to have <em>any</em> <code>Finset</code> definition apply to <code>Sym2</code> by simply first applying <code>toFinset</code>?</p>",
        "id": 475908689,
        "sender_full_name": "Christoph Spiegel",
        "timestamp": 1728490203
    }
]