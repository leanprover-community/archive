[
    {
        "content": "<p>I think it is a very basic feature, but it seems that we don't have this in mathlib. Any hints?</p>",
        "id": 502937293,
        "sender_full_name": "Jz Pan",
        "timestamp": 1740975635
    },
    {
        "content": "<p>I have <a href=\"https://github.com/leanprover-community/mathlib4/pull/13964\">#13964</a> and <a href=\"https://github.com/leanprover-community/mathlib4/pull/13965\">#13965</a> for base n expansions of reals, as well as <a href=\"https://github.com/leanprover-community/mathlib4/pull/22231\">#22231</a> and others for pi-adic expansions</p>",
        "id": 503020255,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1741006821
    },
    {
        "content": "<p>The module docstring for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Int.log#doc\">docs#Int.log</a> shows how to compute this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">digits</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">⌊</span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">))</span><span class=\"bp\">⌋₊</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">b</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">digits</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">7</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">↑</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span>\n<span class=\"c1\">-- ![1, 4, 2, 8, 5, 7, 1, 4]</span>\n</code></pre></div>",
        "id": 503026733,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741008646
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"308899\">Yakov Pechersky</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Base.20n.20expansion.20of.20real.20numbers.3F/near/503020255\">said</a>:</p>\n<blockquote>\n<p>I have <a href=\"https://github.com/leanprover-community/mathlib4/pull/13964\">#13964</a> and <a href=\"https://github.com/leanprover-community/mathlib4/pull/13965\">#13965</a> for base n expansions of reals, as well as <a href=\"https://github.com/leanprover-community/mathlib4/pull/22231\">#22231</a> and others for pi-adic expansions</p>\n</blockquote>\n<p>Seems a big project. For now maybe I just stick to <code>Real.digits (b : N) (x : R) : Z -&gt; N</code>.</p>",
        "id": 503041627,
        "sender_full_name": "Jz Pan",
        "timestamp": 1741012443
    },
    {
        "content": "<p>It depends on what you want to prove about that expansion. Injectivity? Surjectivity? Evaluation? Completeness? Even in your defn, how do you handle negative reals?</p>",
        "id": 503071629,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1741019431
    },
    {
        "content": "<p>The forward map, inverse map, their relationships, the forward map being injective, the description of its image. Criterion of a real number being rational by its digits.</p>\n<p>For simplicity maybe just define <code>Real.digitsOfFrac (b : N) (x : R) : N -&gt; N</code> for now, just calculating the digit expansion of fractional part of <code>x</code> which is in <code>[0, 1)</code>.</p>\n<p>Background: a student finds a proof of <code>#(N -&gt; R) = #R</code> from an obscured textbook and asks if it can be formalized in Lean. The student complains that Lean does not have digit expansion API.</p>\n<p>Of course my solution is just use general API for <code>#(X -&gt; Y)</code>. But I think it's not so friendly to students who just starts learning basic calculus.</p>",
        "id": 503166824,
        "sender_full_name": "Jz Pan",
        "timestamp": 1741056267
    },
    {
        "content": "<p>The forward map would be a little annoying to develop because you need to discuss completeness of N -&gt; R over the \"evaluation\" topology. You could do a type synonym like I have for adic expansions, or via the topology that I think has been PRed for (Mv)PowerSeries. The adic expansion PRs I have are much more in that simpler direction than the de Bruijn expansion. </p>\n<p>That's because the de Bruijn expansion is about setting up the whole conditionally complete and ring properties, and I don't think you're asking for the forward or inverse maps to be ring homs.</p>",
        "id": 503169240,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1741057596
    },
    {
        "content": "<p>Oh I mean <code>Real.digitsOfFrac</code> is the forward map and <code>Real.ofDigits</code> is the inverse map. The topology is ignored at all.</p>",
        "id": 503169641,
        "sender_full_name": "Jz Pan",
        "timestamp": 1741057835
    },
    {
        "content": "<p>As for the student's question, the textbook first replace <code>R</code> by <code>[0, 1)</code>, then constructs a bijection from <code>N -&gt; [0, 1)</code> to <code>[0, 1)</code> by rearranging digits in digit expansion (clearly this may have problems on corner cases <code>.9999999...</code>).</p>",
        "id": 503169825,
        "sender_full_name": "Jz Pan",
        "timestamp": 1741057948
    },
    {
        "content": "<p>I agree that it is nicer to treat the problems of finding a base n expansion for an integer, and for a real between 0 and 1, separately</p>",
        "id": 503188177,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1741068546
    },
    {
        "content": "<p>Regarding <span class=\"user-mention\" data-user-id=\"308899\">@Yakov Pechersky</span>'s PRs and the API in this thread; what is the expected value of <code>Real.digits 2 0.125</code>? Is it <code>Pi.single 3 1</code> or <code>Pi.single (-3) 1</code>?</p>",
        "id": 503233633,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741085027
    },
    {
        "content": "<p>For simplicity I will set it to <code>Pi.single 2 1</code>... and <code>Real.ofDigits (b : N) (f : N -&gt; N)</code> is in fact <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>n</mi><mo>=</mo><mn>0</mn></mrow><mi mathvariant=\"normal\">∞</mi></msubsup><msup><mi>b</mi><mrow><mo>−</mo><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msup><mi>f</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\sum_{n=0}^\\infty b^{-n-1}f(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1138em;vertical-align:-0.2997em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8043em;\"><span style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">0</span></span></span></span><span style=\"top:-3.2029em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">∞</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2997em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mathnormal mtight\">n</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span>. Hope this will not cause confusion.</p>",
        "id": 503256041,
        "sender_full_name": "Jz Pan",
        "timestamp": 1741091830
    },
    {
        "content": "<p>That sounds pretty confusing to me</p>",
        "id": 503257202,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741092178
    },
    {
        "content": "<p>The APIs that <span class=\"user-mention\" data-user-id=\"366779\">@Jz Pan</span> wants have now been developed in <a href=\"https://github.com/leanprover-community/mathlib4/pull/26021\">#26021</a> except for the rationality criterion, and indeed they're done for real numbers in [0,1).</p>",
        "id": 525226332,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1750615650
    }
]