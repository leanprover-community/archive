[
    {
        "content": "<p>If I have <code>a b : Real</code>, <code>x y : Set.Icc a b</code>, and <code>s : unitInterval</code>, what is the colloquial way to say <code>s * x + (1 - s) * y</code> as a term in <code>Set.Icc a b</code>?</p>",
        "id": 555005474,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1762901676
    },
    {
        "content": "<p>Is it meaningful to say <code>x y : Set.ICC a b</code>?</p>",
        "id": 555010533,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1762905714
    },
    {
        "content": "<p>I just checked Icc and it seems to be  a <code>Set</code></p>",
        "id": 555010615,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1762905789
    },
    {
        "content": "<p>Does this help?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Icc</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unitInterval</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Icc</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">wlog</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">val</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Icc_subset</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">.</span><span class=\"n\">prop</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">prop</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span>\n<span class=\"w\">    </span><span class=\"n\">segment_eq_Icc</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">▸</span><span class=\"w\"> </span><span class=\"n\">segment_eq_image</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">▸</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">prop</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"bp\">⟩</span>\n</code></pre></div>",
        "id": 555014015,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1762908687
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=segment_eq_image#doc\">docs#segment_eq_image</a></p>",
        "id": 555014113,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1762908757
    },
    {
        "content": "<p>I've written what I need, I'll link here with a PR number when it's up.</p>",
        "id": 555052940,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1762934627
    },
    {
        "content": "<p>This would have come for free if the convexity refactor had been done</p>",
        "id": 555053803,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1762934914
    },
    {
        "content": "<p>I think we need to figure out a way to do the convexity refactor incrementally (define abstract affine combination spaces in mathlib - convex combinations being the case where all the scalars in the semiring are nonnegative - and gradually generalize existing lemmas / definitions to them) rather than expecting to refactor everything in the affine spaces and convexity parts of mathlib at once.</p>",
        "id": 555171082,
        "sender_full_name": "Joseph Myers",
        "timestamp": 1762966057
    },
    {
        "content": "<p>What is the obstacle to working incrementally?</p>",
        "id": 555243854,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1762991746
    },
    {
        "content": "<p>I don't know an obstacle, beyond the general principle that it's hard to know if you have a good, usable formal definition until you've set up enough material on the basis of that definition.</p>",
        "id": 555244459,
        "sender_full_name": "Joseph Myers",
        "timestamp": 1762992093
    },
    {
        "content": "<p>The things I wanted are now in <a href=\"https://github.com/leanprover-community/mathlib4/pull/31525\">#31525</a>, just in the special case for <code>unitInterval</code>. I hope we can merge something like this, and someone will make it obsolete soon. :-)</p>",
        "id": 555262507,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1763005847
    },
    {
        "content": "<blockquote>\n<p>feat: proposed definition of <code>ConvexSpace</code> <a href=\"https://github.com/leanprover-community/mathlib4/pull/31984\">#31984</a></p>\n</blockquote>",
        "id": 558863074,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1763870252
    },
    {
        "content": "<p>Here is a fun thing that just happened to me while thinking about this:</p>\n<p>I've had in mind for a while that there should be a further generalization of this which would allow more notions of convexity (I was thinking at the time about the \"convexity\" in non-archimedean analysis, but it could also be convex cones, ...). Prompted by this PR (and in particular <a href=\"https://github.com/leanprover-community/mathlib4/pull/31984/files#r2553760923\">this comment</a> by <span class=\"user-mention\" data-user-id=\"816344\">@Aaron Liu</span>) I decided to write down precisely the axioms that I would impose for my \"convexity model\" which would be used to define this generalization of convex spaces. </p>\n<p>I spent 45 minutes thinking about it and cleaning the axiomatization... and then burst out laughing when I realized I had just landed on the axioms of a monad <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span> </p>\n<p>So I am now almost seriously considering defining \"X is a convex space\" as \"X is an algebra over the Finite Probability Measure/Standard Simplex monad\" <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span> </p>\n<p>(This will all sound very normal to people used to monads, but for me it was a lot of fun landing back on this!)</p>",
        "id": 558889217,
        "sender_full_name": "Anatole Dedecker",
        "timestamp": 1763898914
    },
    {
        "content": "<p>I just pushed a new definition, which I agree is nicer.</p>",
        "id": 558989218,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1763976473
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/--</span>\n<span class=\"sd\">A set equipped with an operation of finite convex combinations,</span>\n<span class=\"sd\">where the coefficients must be non-negative and sum to 1.</span>\n<span class=\"sd\">-/</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">ConvexSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">PartialOrder</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsStrictOrderedRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- Take a convex combination with the given probability distribution over points. -/</span>\n<span class=\"w\">  </span><span class=\"n\">convexCombination</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">StdSimplex</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- Associativity of convex combination (monadic join law). -/</span>\n<span class=\"w\">  </span><span class=\"n\">assoc</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">StdSimplex</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">StdSimplex</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">convexCombination</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">convexCombination</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">convexCombination</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">join</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- A convex combination of a single point is that point. -/</span>\n<span class=\"w\">  </span><span class=\"n\">single</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">convexCombination</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">single</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div>",
        "id": 558990019,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1763976688
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"268315\">@Anatole Dedecker</span>, any further comments on this? Can we proceed?</p>",
        "id": 563957490,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1765853948
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 563963200,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1765858894
    },
    {
        "content": "<p>I propose we merge / delegate <a href=\"https://github.com/leanprover-community/mathlib4/pull/31984\">#31984</a> (which contains the above definition). If I hear no objections within the next ~12 hours I will do so.</p>",
        "id": 564679072,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1766145288
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"240862\">@Oliver Nash</span> the PR description needs updating, as the names no longer match. I'm on mobile so can't do it easily.</p>",
        "id": 564728231,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1766159762
    },
    {
        "content": "<p>I've updated the description.</p>",
        "id": 564776465,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1766178850
    }
]