[
    {
        "content": "<p>Newbie here.</p>\n<p>I am getting into premise selection, the task of automatically determining useful premises. From what I read so far on premise selection in lean, it mostly comes down to comparison between lemma definitions and current proof state. </p>\n<p>For Isabelle, there are successful premise selection approaches extracting where lemmas are used and recommending these lemmas for similar proof states (i.e. comparing proof states as opposed to comparing lemma and proof state definition). Now I am wondering whether there is a nice way to get lemmas from a given tactic to do something similar in Lean?</p>\n<p>Say I have </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">add_assoc</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>is there code to extract <code>add_assoc</code>?</p>",
        "id": 479768911,
        "sender_full_name": "Simon Sorg",
        "timestamp": 1730324451
    },
    {
        "content": "<p>With enough effort (and metaprogramming) anything is possible. But for better help you should specify what you mean when you say that you want to \"extract\" <code>add_assoc</code>, and that you are \"given\" a tactic.</p>",
        "id": 479769277,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1730324656
    },
    {
        "content": "<p>Fair point, sorry about that and thank you very much for the quick response!</p>\n<p>Thanks to the Lean Repl, I am able to parse tactics quite conveniently. My current workflow involves globbing lean files and parsing them using the Repl to receive the single tactics. So \"given\" a tactic comes down to an arbitrary lean file from which I receive a list of parsed tactics. Now, I would like to modify this a bit (or a bit much) to also receive the exact lemmas used as part of the json output - what I called \"extract\" earlier.</p>",
        "id": 479769858,
        "sender_full_name": "Simon Sorg",
        "timestamp": 1730324969
    },
    {
        "content": "<p>I see. By the lean repl I assume you mean <a href=\"https://github.com/leanprover-community/repl\">this</a>? And by parsing, I assume you mean that you're following the \"file mode\" mentioned in the readme. Is that right?</p>",
        "id": 479770351,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1730325262
    },
    {
        "content": "<p>Yes, Thanks for clarifying! The \"file mode\" run with <code>\"allTactics\": true</code></p>",
        "id": 479770419,
        "sender_full_name": "Simon Sorg",
        "timestamp": 1730325313
    },
    {
        "content": "<p>I modified <code>repl</code> in a fork: <a href=\"https://github.com/adamtopaz/repl\">https://github.com/adamtopaz/repl</a> <br>\nThis should now emit the used constants for the tactic steps. Note that it doesn't just emit the lemmas explicitly used in a rewrite, or a simp, etc., but rather <em>all</em> constants that were used (so rewrites will include <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Eq.subst#doc\">docs#Eq.subst</a> or something similar)</p>",
        "id": 479772447,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1730326522
    },
    {
        "content": "<p>If <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> thinks this is a worthwhile addition, I would be happy to PR it to the main <code>repl</code> package.</p>",
        "id": 479772694,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1730326658
    },
    {
        "content": "<p>Wow. This is exactly what I was looking for. <br>\nThank you so much!</p>",
        "id": 479774379,
        "sender_full_name": "Simon Sorg",
        "timestamp": 1730327612
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"766274\">Simon Sorg</span> has marked this topic as resolved.</p>",
        "id": 479774384,
        "sender_full_name": "Notification Bot",
        "timestamp": 1730327620
    },
    {
        "content": "<p>Sounds great, <span class=\"user-mention\" data-user-id=\"243562\">@Adam Topaz</span>, yes!</p>\n<p>My apologies that the repl has seen little development recently. I'm very happy to see PRs adding functionality.</p>",
        "id": 479783168,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1730333142
    },
    {
        "content": "<p>We really should replace it entirely at some point, but I haven't had the time to do this.</p>",
        "id": 479783186,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1730333156
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/repl/pull/59\">https://github.com/leanprover-community/repl/pull/59</a></p>",
        "id": 479911281,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1730390618
    }
]