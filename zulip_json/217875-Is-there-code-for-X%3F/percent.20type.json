[
    {
        "content": "<p>Hi, I was wondering what would be the best way to define a percent, I'm a beginner and wondering if there is a better way of the usual private constructor and default constructors/parser that should respect that a percent is between 0 and 100. Could I embed that rule in the definition of a percent directly instead of having a comment (using subtypes ?)<br>\nI haven't touched proof yet but I hope I can start soon</p>",
        "id": 543450266,
        "sender_full_name": "Roman",
        "timestamp": 1759817217
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"934852\">@Roman</span> what are you using it for?</p>",
        "id": 543453655,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759819112
    },
    {
        "content": "<p>in some applications i have in mind, the best way would be to write some meta code so that <code>$n:num %</code> elaborates to a term in a char-zero field (default <code>Rat</code>)</p>",
        "id": 543453807,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759819199
    },
    {
        "content": "<p>note how e.g. you can already type:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mf\">3.24</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 543454333,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759819462
    },
    {
        "content": "<p>which is secretly calling <a href=\"https://leanprover-community.github.io/mathlib4_docs/Init/Data/Rat/Basic.html#Rat.ofScientific\">Rat.ofScientific</a></p>",
        "id": 543454377,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759819485
    },
    {
        "content": "<p>Do you really want a type? I would rather have it as a notation.</p>",
        "id": 543454929,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1759819756
    },
    {
        "content": "<p>If you just want numbers between 0 and 100, you can do it easily with a subtype. Do you want them to be integers?</p>",
        "id": 543455139,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1759819833
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"s2\">\"%\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">100</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mf\">30.2</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Actually my idea is easier to implement than I thought</p>",
        "id": 543455393,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759819936
    },
    {
        "content": "<p>I can have a 300% increase in productivity -- who says percentages are between 0 and 100?</p>",
        "id": 543475896,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1759827029
    },
    {
        "content": "<p>and 100% is actually 0 in Z/2Z!</p>",
        "id": 543486722,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759830213
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"s2\">\"%\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">100</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">100</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ZMod</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">norm_num</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>",
        "id": 543486935,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759830281
    },
    {
        "content": "<p>(why do i need two tactics?)</p>",
        "id": 543486960,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759830286
    },
    {
        "content": "<p>(grind works by itself, also i should probably stay on topic)</p>",
        "id": 543487128,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759830330
    },
    {
        "content": "<p>Hello, thank you everyone for your input, it is quite interesting to see all the different view point, I do indeed thought a percent was limited to 100 but saying 300% is obviously valid ! I do not know the recommend approach to my use-case then as I have to take a percentage of an open/close position of a motor to drive it to that position, and ideally the percentage value that it take should reflect that it can't overrun it's max course in it's API if possible so that other moving/filling/measuring systems could use the same standard in my application.<br>\nI haven't been able to use subtypes properly, from my understanding it require the user of the api to provide a proof that the number given is between 0 and 100 but it induce a lot of boilerplate from what I've been able to do?</p>",
        "id": 544020003,
        "sender_full_name": "Roman",
        "timestamp": 1760032721
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"s2\">\"%\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">101</span><span class=\"o\">)</span>\n\n<span class=\"c1\">-- this is magic, ignore it</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Qq</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">PrettyPrinter</span><span class=\"w\"> </span><span class=\"n\">Delaborator</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kd\">@[</span><span class=\"n\">app_delab</span><span class=\"w\"> </span><span class=\"n\">OfNat</span><span class=\"bp\">.</span><span class=\"n\">ofNat</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">delabPercent</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Delab</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">whenPPOption</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">getPPNotation</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"n\">α</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">SubExpr</span><span class=\"bp\">.</span><span class=\"n\">getExpr</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">getAppArgs</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">failure</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">isDefEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">101</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">failure</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">rawNatLit?</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">failure</span>\n<span class=\"w\">  </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"o\">(</span><span class=\"n\">quote</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"bp\">%</span><span class=\"o\">)</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">36</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">decide</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">100</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">decide</span>\n</code></pre></div>",
        "id": 544021349,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760033274
    },
    {
        "content": "<blockquote>\n<p>I have to take a percentage of an open/close position of a motor to drive it to that position</p>\n</blockquote>\n<p>Does it take integer positions? Decimal positions with fixed precision? Does your model of it let you set it to an position of precisely <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>π</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">\\pi^{-1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span>?</p>",
        "id": 544022377,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1760033693
    },
    {
        "content": "<p>Using Fin is tempting and I could get away with it honestly but ideally it should take a Decimal position</p>",
        "id": 544090288,
        "sender_full_name": "Roman",
        "timestamp": 1760074692
    },
    {
        "content": "<p>can you give us a full specification of what the \"percent type\" should contain?</p>",
        "id": 544119552,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760086929
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/percent.20type/near/544119552\">said</a>:</p>\n<blockquote>\n<p>can you give us a full specification of what the \"percent type\" should contain?</p>\n</blockquote>\n<p>Well I'm interested in having the \"most truthful\" models in my application, having things defined after well accepted standards, conventions etc. The solution would just boil down to subtypes, having a constructor returning an Option (subtype percent), and passing that percent along with the proof (which serve as a token of validity in that case if I understand correctly) to any function requiring a subtype.<br>\nIt was just that I did not want a private constructor holding the strings in making a valid, in range percent type, subtypes can be constructed by different means and each must abide by validating one proposition, the boilerplate can be hidden behind constructors and not touched by the developer when interacting with it so it's all good, I just need to spend more time on the language. Thank you for taking the time for me by the way !</p>",
        "id": 544384637,
        "sender_full_name": "Roman",
        "timestamp": 1760260392
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"934852\">@Roman</span> you have not answered my question at all. what we were trying to ask you, with those \"ridiculous questions\" (such as pi^-1), is what type of <strong>values</strong> are allowed in your percent type, whether it's any rational number, or any real number, or something in between</p>",
        "id": 544384714,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760260503
    },
    {
        "content": "<p>\"subtype\" doesn't answer the question because the follow-up question is, subtype of what?</p>",
        "id": 544384739,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760260537
    },
    {
        "content": "<p>Well I'm not well versed in math so I can't give the answer you probably expect but I believe it should be any Real number ?</p>",
        "id": 544385388,
        "sender_full_name": "Roman",
        "timestamp": 1760261265
    },
    {
        "content": "<p>I mean I could go with integer for my use but for a real definition of \"a percent\" you guys would probably be more up to the task than me haha</p>",
        "id": 544385467,
        "sender_full_name": "Roman",
        "timestamp": 1760261365
    },
    {
        "content": "<p>Lean's philosophy is not to put guardrails in the definitions or notations, but in the theorems about them. Did you know that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mi mathvariant=\"normal\">/</mi><mn>0</mn><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">1/0=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1/0</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span> in Lean, for example? I attempt to explain why <a href=\"https://xenaproject.wordpress.com/2020/07/05/division-by-zero-in-type-theory-a-faq/\">here</a>. There are no guardrails about using the division symbol, and so an idiomatic percentage formalization in Lean should probably have no guardrails for the same reasons as explained in the blog post.</p>",
        "id": 544390632,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1760266390
    }
]