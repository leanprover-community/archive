[
    {
        "content": "<p>Is there a way to make <code>norm_cast &lt;$&gt; omega</code> resolve this lemma?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">WithTopENat</span><span class=\"bp\">.</span><span class=\"n\">sub_add_le</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithTop</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"bp\">∞</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">norm_cast</span><span class=\"w\">  </span><span class=\"c1\">-- Doesn't do anything</span>\n<span class=\"w\">  </span><span class=\"n\">omega</span><span class=\"w\">  </span><span class=\"c1\">-- Doesn't work, since still over WithTop ℕ∞</span>\n</code></pre></div>",
        "id": 543618380,
        "sender_full_name": "Geoffrey Irving",
        "timestamp": 1759869804
    },
    {
        "content": "<p>It seems that</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">WithTop</span><span class=\"bp\">.</span><span class=\"n\">coe_one</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>is \"missing\".</p>",
        "id": 543624330,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1759872381
    },
    {
        "content": "<p>I think the issue is that <code>norm_cast</code> can't work with the coercion from <code>ℕ</code> to <code>WithTop ℕ∞</code> very well. The trick <span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> suggests is to split up the coercion by letting it go via the intermediate type <code>ℕ∞</code>.</p>",
        "id": 543926880,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1760006848
    },
    {
        "content": "<p>I don’t think I fully understood <span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span>’s comment: is it “there’s no way norm_cast can do this so we need to help it”? My initial reading was that adding that kind of lemma would help norm_cast be more automated. (I should clarify that I do have plenty of manual ways to help norm_cast already.)</p>",
        "id": 543927338,
        "sender_full_name": "Geoffrey Irving",
        "timestamp": 1760006987
    },
    {
        "content": "<p><code>set_option trace.Tactic.norm_cast true</code> helps see what is happening</p>",
        "id": 543930690,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1760008120
    },
    {
        "content": "<p>Yes, he means that you can add the extra <code>rw</code> tactic to help <code>norm_cast</code></p>",
        "id": 543930803,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1760008155
    },
    {
        "content": "<p>This also works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">norm_cast</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">WithTop</span><span class=\"bp\">.</span><span class=\"n\">some_natCast</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddMonoidWithOne</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithTop</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">WithTopENat</span><span class=\"bp\">.</span><span class=\"n\">sub_add_le</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithTop</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"bp\">∞</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">WithTop</span><span class=\"bp\">.</span><span class=\"n\">some_natCast</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">norm_cast</span>\n<span class=\"w\">  </span><span class=\"n\">omega</span>\n</code></pre></div>",
        "id": 543936551,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1760010126
    }
]