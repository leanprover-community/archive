[
    {
        "content": "<p>We (Bath/Coventry) note that the definition for log (for example) in <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Analysis/SpecialFunctions/Complex/Log.html\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/Analysis/SpecialFunctions/Complex/Log.html</a> defines log with an imaginary part in (-π,π]. While this works, there is no lemma that we see for log(x*y) outside the principal branch, or other results that require branch cut negotiations. Conversely, there don’t seem to be any definitions for the multivalued functions (i.e. with a “+2kiπ” term) which would be another way to state these results.</p>\n<p>Are we missing something?</p>",
        "id": 481767135,
        "sender_full_name": "James Davenport",
        "timestamp": 1731344087
    },
    {
        "content": "<p>There are no multivalued functions in type theory. If you want to have the multivalued logarithm, its natural target type is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">C</mi><mi mathvariant=\"normal\">/</mi><mn>2</mn><mi>π</mi><mi>i</mi><mi mathvariant=\"bold\">Z</mi></mrow><annotation encoding=\"application/x-tex\"> \\mathbf C / 2\\pi i \\mathbf Z</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathbf\">C</span><span class=\"mord\">/2</span><span class=\"mord mathnormal\">πi</span><span class=\"mord mathbf\">Z</span></span></span></span>, and then it's the inverse of the natural map induced by exponential after passing to quotient. On the other hand, other determinations of the logarithm would be definitely useful for some computations, for example the one that has an argument in <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mn>0</mn><mo separator=\"true\">;</mo><mn>2</mn><mi>π</mi><mo stretchy=\"false\" lspace=\"0em\" rspace=\"0em\">[</mo></mrow><annotation encoding=\"application/x-tex\">[0;2\\pi\\mathclose[</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">0</span><span class=\"mpunct\">;</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"mclose\"><span class=\"mopen\">[</span></span></span></span></span>.</p>",
        "id": 481768776,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1731344585
    },
    {
        "content": "<p>I could envisage having a <code>Complex.log'</code> with argument in <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>2</mn><mi>π</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">[0,2\\pi)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"mclose\">)</span></span></span></span> if an argument were made saying that it really is useful for something and using <code>log</code> was somehow more painful.</p>",
        "id": 481769529,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1731344792
    },
    {
        "content": "<p>Note also <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Complex.log_exp_exists#doc\">docs#Complex.log_exp_exists</a> which might help in your application</p>",
        "id": 481770504,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1731345099
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Multivalued.20functions.2Fbranch.20cuts.2E/near/481769529\">said</a>:</p>\n<blockquote>\n<p>I could envisage having a <code>Complex.log'</code> with argument in <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>2</mn><mi>π</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">[0,2\\pi)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"mclose\">)</span></span></span></span> if an argument were made saying that it really is useful for something and using <code>log</code> was somehow more painful.</p>\n</blockquote>\n<p>Standard applications are computations of real integrals from <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span> to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>+</mo><mi mathvariant=\"normal\">∞</mi></mrow><annotation encoding=\"application/x-tex\">+\\infty</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord\">+</span><span class=\"mord\">∞</span></span></span></span> using contour integrals where that determination is useful (the idea is to multiply the function to be integrated by <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mrow><mi>log</mi><mo>⁡</mo></mrow><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo stretchy=\"false\">(</mo><mi>z</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\log&#x27;(z)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0862em;vertical-align:-0.25em;\"></span><span class=\"mop\"><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8362em;\"><span style=\"top:-3.1473em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span><span class=\"mclose\">)</span></span></span></span> and have a contour that goes from <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>+</mo><mi mathvariant=\"normal\">∞</mi><mo>−</mo><mi>i</mi><mi>ε</mi></mrow><annotation encoding=\"application/x-tex\">+\\infty-i\\varepsilon</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord\">+</span><span class=\"mord\">∞</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">ε</span></span></span></span> to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ε</mi><mo>−</mo><mi>i</mi><mi>ε</mi></mrow><annotation encoding=\"application/x-tex\">\\varepsilon-i\\varepsilon</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">ε</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">ε</span></span></span></span>, circles clockwise to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ε</mi><mo>+</mo><mi>i</mi><mi>ε</mi></mrow><annotation encoding=\"application/x-tex\">\\varepsilon+i\\varepsilon</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">ε</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">ε</span></span></span></span> and goes to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>+</mo><mi mathvariant=\"normal\">∞</mi><mo>+</mo><mi>i</mi><mi>ε</mi></mrow><annotation encoding=\"application/x-tex\">+\\infty+i\\varepsilon</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord\">+</span><span class=\"mord\">∞</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">ε</span></span></span></span>, using the fact that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mrow><mi>log</mi><mo>⁡</mo></mrow><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo stretchy=\"false\">(</mo><mi>x</mi><mo>+</mo><mi>i</mi><mi>ε</mi><mo stretchy=\"false\">)</mo><mo>≈</mo><mi>log</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\log&#x27;(x+i\\varepsilon)\\approx \\log(x)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0862em;vertical-align:-0.25em;\"></span><span class=\"mop\"><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8362em;\"><span style=\"top:-3.1473em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">ε</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span></span>, while <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mrow><mi>log</mi><mo>⁡</mo></mrow><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo stretchy=\"false\">(</mo><mi>x</mi><mo>−</mo><mi>i</mi><mi>ε</mi><mo stretchy=\"false\">)</mo><mo>≈</mo><mi>log</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mn>2</mn><mi>i</mi><mi>π</mi></mrow><annotation encoding=\"application/x-tex\">\\log&#x27;(x-i\\varepsilon)\\approx \\log(x)+2i\\pi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0862em;vertical-align:-0.25em;\"></span><span class=\"mop\"><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8362em;\"><span style=\"top:-3.1473em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">ε</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">iπ</span></span></span></span>.</p>\n<p>But in fear of missing yet other determinations, I'd rather have a variant of log that prescribes the angle of along which half line it is not continuous.</p>",
        "id": 481774273,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1731346373
    },
    {
        "content": "<p>By a \"multi-valued function\" a meant a function whose values are in the powerset of <strong>C</strong>, except these are rather special subsets of <strong>C</strong>, typically {v+2ki\\pi: k\\in <strong>Z</strong>} or some such.  One can regard this, as you suggest, as a value in <strong>C</strong>/2πi<strong>Z</strong>,  but then the problem is tracking correlations.</p>",
        "id": 481778737,
        "sender_full_name": "James Davenport",
        "timestamp": 1731347905
    },
    {
        "content": "<p>The problem with a multivalued function <code>multiLog : ℂ  → Set ℂ</code> that you describe is that working with the resulting sets you get is tedious, and it's hard to \"get out of the <code>Set</code> monad\", in the sense, that if you want to apply a function <code>ℂ → ℂ</code> afterwards, then you actually have to apply it to images. In other words: <code>(Complex.exp '' · ) ∘ multiLog : ℂ → Set ℂ</code>, and this is the map <code>x ↦ {x}</code> (except for <code>x = 0</code>), which is \"single-valued\" in some sense, but isn't a function <code>ℂ → ℂ</code>. You can extract such a function, but it's painful.</p>",
        "id": 481781013,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1731348738
    },
    {
        "content": "<p>I guess a key question is: what do you want to do with the branch cuts?</p>",
        "id": 481781313,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1731348869
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>\n</code></pre></div>\n\n<p>Various things:<br>\n1)     Know where they are (which humans can do) and what they do to functions, e.g. log(z) drops by 2i π when crossing arg(z)= π.<br>\n2)     Work out how <strong>C</strong> is partitioned by them (probably outsource this to an algebra system’s cylindrical algebraic decomposition).<br>\n3)     Be able to state and prove statements like arg(x)&gt; π/2 &amp; arg(y)&gt; π/2 =&gt; log(x*y)=log(x)+log(y)-2 πi.<br>\nBy hand/unverified computer algebra I have done this by<br>\na.      Log(xy)=Log(x)+Log(y)  (set-valued function identity)<br>\nb.      (from 2 above) there are no branch cuts involved in this region<br>\nc.      From a sample point, -2 πi is the correct conversion to single-valued.</p>",
        "id": 481913480,
        "sender_full_name": "James Davenport",
        "timestamp": 1731407592
    },
    {
        "content": "<p>I think the question was \"what, not directly about branch cuts, do you want to do with such knowledge about branch cuts\"?</p>",
        "id": 482032018,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731442740
    },
    {
        "content": "<p>The function <code>Complex.arg</code>, coerced to <code>Real.Angle</code> (i.e. eliminating the branch cut and continuous everywhere except 0), is a much better behaved function and much nicer to work with than <code>Complex.arg</code> itself.</p>",
        "id": 482088358,
        "sender_full_name": "Joseph Myers",
        "timestamp": 1731472989
    }
]