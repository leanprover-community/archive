[
    {
        "content": "<p>I am updating an old PR which I haven't touched in a while. In there I use <code>apply subset_comp_self</code>. I see that</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"ss\">`subset_comp_self</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">been</span><span class=\"w\"> </span><span class=\"n\">deprecated</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Use</span><span class=\"w\"> </span><span class=\"ss\">`SetRel.left_subset_comp</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">instead</span>\n\n<span class=\"n\">Note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">The</span><span class=\"w\"> </span><span class=\"n\">updated</span><span class=\"w\"> </span><span class=\"n\">constant</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">different</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_2</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SetRel</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SetRel</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">S</span><span class=\"bp\">.</span><span class=\"n\">IsRefl</span><span class=\"o\">],</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">⊆</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">○</span><span class=\"w\"> </span><span class=\"n\">S</span>\n<span class=\"n\">instead</span><span class=\"w\"> </span><span class=\"n\">of</span>\n<span class=\"w\">  </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">ua</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SetRel</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">idRel</span><span class=\"w\"> </span><span class=\"bp\">⊆</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">⊆</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">○</span><span class=\"w\"> </span><span class=\"n\">s</span>\n</code></pre></div>\n<p>so I do <code>have : o₂.choose.IsRefl := sorry</code> and <code>exact SetRel.left_subset_comp</code> instead.</p>\n<p>Then I need to fill in the <code>sorry</code>. I can't find any lemmas mentioning both <code>uniformity</code> and <code>SetRel.IsRefl</code>. So basically I need</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">SetRel</span><span class=\"bp\">.</span><span class=\"n\">IsRefl</span><span class=\"bp\">.</span><span class=\"n\">of_mem_uniformity</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">ua</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">UniformSpace</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SetRel</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">uniformity</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">IsRefl</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">refl_mem_uniformity</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>",
        "id": 560056010,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764037417
    },
    {
        "content": "<p>More generally, how am I supposed to interact with <code>SetRel.IsRefl</code> and <code>SetRel.IsSymm</code>?</p>",
        "id": 560057052,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764038280
    },
    {
        "content": "<p>Here's the typical fix: <a href=\"https://github.com/leanprover-community/mathlib4/pull/23181/files#diff-fdbc173f0c400ff3a4b371e3766122d99266ef7f7bb8fbeac6a87b38fe372e7dR71\">https://github.com/leanprover-community/mathlib4/pull/23181/files#diff-fdbc173f0c400ff3a4b371e3766122d99266ef7f7bb8fbeac6a87b38fe372e7dR71</a></p>",
        "id": 560112054,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1764065155
    },
    {
        "content": "<p>You could add a direct lemma if you want</p>",
        "id": 560112279,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1764065210
    },
    {
        "content": "<p>yes that's great but I have another one</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SetRel</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"bp\">.</span><span class=\"n\">IsSymm</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">IsSymm</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">IsSymm</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"c1\">-- this proof doesn't work anymore</span>\n<span class=\"w\">  </span><span class=\"c1\">-- simp [IsSymm, compRel_assoc, prodSwap_preimage_compRel,</span>\n<span class=\"w\">  </span><span class=\"c1\">--   hr.eq, hs.eq]</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 560126799,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764069464
    },
    {
        "content": "<p>Maybe just do this one by hand? Your current proof is fiddly rewrites, and tauto should be your friend</p>",
        "id": 560140792,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1764073740
    },
    {
        "content": "<p>It's using that <code>IsSymmetricRel s</code> is defined as <code>Prod.swap ⁻¹' s = s</code> and then push the <code>Prod.swap ⁻¹'</code> through the comp</p>",
        "id": 560150982,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764076486
    },
    {
        "content": "<p>I wouldn't really say it's \"fiddly\"</p>",
        "id": 560151068,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764076510
    },
    {
        "content": "<p>Oh I just found <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=SetRel.inv_eq_self_iff#doc\">docs#SetRel.inv_eq_self_iff</a></p>",
        "id": 560151536,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764076629
    },
    {
        "content": "<p>ok I can probably do this proof the same way then</p>",
        "id": 560151615,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764076652
    }
]