[
    {
        "content": "<p>I recently had need of the following trivial lemma:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">LinearEquiv</span><span class=\"bp\">.</span><span class=\"n\">inv_eq_symm</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">E</span><span class=\"o\">:</span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SeminormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚Çó</span><span class=\"o\">[</span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"bp\">‚Åª¬π</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>For some reason this lemma was outside the capacity of <code>simp</code> to resolve.  Should one add it as a <code>simp</code> lemma?  I guess there has to be a decision which of <code>S‚Åª¬π</code> and <code>S.symm</code> gets to be in simp normal form, as there are plenty of nice simp lemmas for both, but it was a speed bump for me to see <code>simp</code> get stuck because it could not equate the two here.</p>\n<p>(I guess one would also need <code>Perm.inv_eq_symm</code>, etc.)</p>",
        "id": 510770229,
        "sender_full_name": "Terence Tao",
        "timestamp": 1744061340
    },
    {
        "content": "<p>It depends on whether you are working on them in group expressions like <code>S * S‚Åª¬π</code>, projection expressions like <code>S‚Åª¬π.comp S</code>, or application expressions  like <code>S‚Åª¬π x</code>. For the latter two, the <code>.symm</code> syntax will likely be more effective in further simplifying.</p>",
        "id": 510771056,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1744061691
    },
    {
        "content": "<p>I think it should be a lemma, but not a <code>simp</code> lemma. When you want to work with the group structure of the linear automorphisms, you want to use <code>S‚Åª¬π</code>, probably not <code>S.symm</code>. (e.g., imagine if you had <code>(S‚Åª¬π) ^ n</code> and is simplified it to <code>S.symm ^ n</code>). <em>Potentially</em> it could go the other way, but I don't think that would be ideal either.</p>",
        "id": 510771126,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1744061720
    },
    {
        "content": "<p>Probably the right answer here is to have an <code>apply</code> lemma marked <code>@[simp]</code> which performs the simplification (<code>‚Åª¬π</code> to <code>.symm</code>), but only if the linear  map is applied to a vector. So I think <code>S‚Åª¬π x = S.symm x</code> makes sense as a <code>simp</code> lemma.</p>",
        "id": 510771442,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1744061877
    },
    {
        "content": "<p>But we should also have the lemma you wrote.</p>",
        "id": 510771724,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1744061946
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"657719\">Terence Tao</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Should.20.22Inverse.20equals.20symm.22.20be.20a.20simp.20lemma.3F/near/510770229\">said</a>:</p>\n<blockquote>\n<p>(I guess one would also need <code>Perm.inv_eq_symm</code>, etc.)</p>\n</blockquote>\n<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Equiv.Perm.inv_def#doc\">docs#Equiv.Perm.inv_def</a> already exists :)</p>",
        "id": 510772196,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744062128
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"197836\">Jireh Loreaux</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Should.20.22Inverse.20equals.20symm.22.20be.20a.20simp.20lemma.3F/near/510771126\">said</a>:</p>\n<blockquote>\n<p>I think it should be a lemma, but not a <code>simp</code> lemma. When you want to work with the group structure of the linear automorphisms, you want to use <code>S‚Åª¬π</code>, probably not <code>S.symm</code>. (e.g., imagine if you had <code>(S‚Åª¬π) ^ n</code> and is simplified it to <code>S.symm ^ n</code>). <em>Potentially</em> it could go the other way, but I don't think that would be ideal either.</p>\n</blockquote>\n<p>if this is your context, doesn't the use of a type alias prevent the simp lemma from applying?</p>",
        "id": 510773408,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1744062699
    },
    {
        "content": "<p>What type alias?</p>",
        "id": 510773591,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1744062774
    },
    {
        "content": "<p>there <em>should</em> be one... but i'm looking and it indeed looks to not exist</p>",
        "id": 510773651,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1744062802
    },
    {
        "content": "<p>I'm not sure why you think there should be one.</p>",
        "id": 510773672,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1744062817
    },
    {
        "content": "<p>we have <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MulAut#doc\">docs#MulAut</a> for the same reason</p>",
        "id": 510773710,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1744062842
    },
    {
        "content": "<p>That's an <code>abbrev</code>.</p>",
        "id": 510773804,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1744062876
    },
    {
        "content": "<p>There is no abstraction boundary here.</p>",
        "id": 510773815,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1744062883
    },
    {
        "content": "<p>ah, you're right</p>",
        "id": 510773825,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1744062888
    },
    {
        "content": "<p>drat</p>",
        "id": 510773833,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1744062890
    },
    {
        "content": "<p>(and I'm not sure why you would want one)</p>",
        "id": 510773873,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1744062915
    },
    {
        "content": "<p>recently, an example came up where we would need this... you can also define multiplication pointwise</p>",
        "id": 510773929,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1744062949
    },
    {
        "content": "<p>sometimes</p>",
        "id": 510773935,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1744062952
    },
    {
        "content": "<p>so it's not like we don't need type aliases ever in these kinds of cases</p>",
        "id": 510774029,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1744062986
    },
    {
        "content": "<p>So, presumably you're talking about e.g., the type <code>M ‚âÉ‚Çú M</code> where <code>M</code> is a topological monoid? Sure, it's possible to define <code>*</code> pointwise there, but I don't think we have any instances like that. I would believe that the pointwise instances are only defined for the one-way morphisms (but perhaps I'm wrong).</p>",
        "id": 510774880,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1744063357
    },
    {
        "content": "<p>i'm talking about things like <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/.60Mul.60.20instance.20on.20algebra.20homomorphisms.20from.20monoid.20algebra\">#Is there code for X? &gt; &#96;Mul&#96; instance on algebra homomorphisms from monoid algebra</a></p>",
        "id": 510775338,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1744063576
    },
    {
        "content": "<p>See also <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/.60Mul.60.20instance.20on.20algebra.20homomorphisms.20from.20monoid.20algebra/near/509698228\">#Is there code for X? &gt; &#96;Mul&#96; instance on algebra homomorphisms from monoid algebra @ üí¨</a></p>",
        "id": 510775381,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1744063601
    },
    {
        "content": "<p>in particular, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MonoidHom.instCommMonoid#doc\">docs#MonoidHom.instCommMonoid</a> is a concrete example</p>",
        "id": 510775855,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1744063842
    },
    {
        "content": "<p><code>Monoid.End</code> <em>is</em> an abstraction boundary, unlike all the others</p>",
        "id": 510781240,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744066885
    },
    {
        "content": "<p><del>No? It's also an <code>abbrev</code></del> (misread)</p>",
        "id": 510781931,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1744067261
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 510782044,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1744067309
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"197836\">Jireh Loreaux</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Should.20.22Inverse.20equals.20symm.22.20be.20a.20simp.20lemma.3F/near/510781931\">said</a>:</p>\n<blockquote>\n<p>No? It's also an <code>abbrev</code></p>\n</blockquote>\n<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Monoid.End#src\">src#Monoid.End</a> disagrees with you.</p>",
        "id": 510782621,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744067636
    },
    {
        "content": "<p>oops, sorry, I misread as <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Module.End#doc\">docs#Module.End</a>, my apologies.</p>",
        "id": 510784130,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1744068418
    },
    {
        "content": "<p>It is a little surprising that <code>Monoid</code> is different to all the others, but I think pragmatically it's the right choice.</p>",
        "id": 510784384,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744068548
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/23705\">#23705</a> is a first step towards having <code>Module.End</code> not be an <code>abbrev</code> anymore if we want to (and if we don't want to I still think we should merge <a href=\"https://github.com/leanprover-community/mathlib4/pull/23705\">#23705</a>)</p>",
        "id": 510864838,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1744099373
    },
    {
        "content": "<p>Reminds me of:<br>\n<a href=\"https://github.com/Ivan-Sergeyev/seymour/blob/b8ae62db083db99cdd94d9bccedf3f45fde03d78/Seymour/Matrix/OfLinearMaps.lean#L4\">https://github.com/Ivan-Sergeyev/seymour/blob/b8ae62db083db99cdd94d9bccedf3f45fde03d78/Seymour/Matrix/OfLinearMaps.lean#L4</a><br>\nShould it be a <code>simp</code> lemma? If so, in which direction?</p>",
        "id": 511464227,
        "sender_full_name": "Martin Dvo≈ô√°k",
        "timestamp": 1744304865
    }
]