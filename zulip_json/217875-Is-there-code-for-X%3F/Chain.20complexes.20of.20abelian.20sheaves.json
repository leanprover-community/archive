[
    {
        "content": "<p>A student of mine (<span class=\"user-mention\" data-user-id=\"920473\">@Mingjie Wang</span>) is working on a project involving chain complexes of abelian sheaves, and we got stuck with satisfying the typeclass hypotheses for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ChainComplex#doc\">docs#ChainComplex</a>. After defining <code>Zero</code> for for the hom sets between abelian sheaves and <code>Limits.HasZeroMorphisms</code> for <code>AbSheaf</code> itself we could get the last definition to go through, but we were wondering if there was another way?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TopCat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TopCat</span><span class=\"o\">)</span>\n\n<span class=\"c1\">-- Abelian sheaf</span>\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">AbSheaf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">base</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TopCat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">TopCat</span><span class=\"bp\">.</span><span class=\"n\">Sheaf</span><span class=\"w\"> </span><span class=\"n\">Ab</span><span class=\"w\"> </span><span class=\"n\">base</span>\n\n<span class=\"c1\">-- Is this missing from Mathlib?</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AbSheaf</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Zero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">⟶</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨⟨</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"bp\">⟩⟩</span>\n\n<span class=\"c1\">-- Is this missing from Mathlib?</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Limits</span><span class=\"bp\">.</span><span class=\"n\">HasZeroMorphisms</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">AbSheaf</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">comp_zero</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intros</span>\n<span class=\"w\">    </span><span class=\"n\">rfl</span>\n<span class=\"w\">  </span><span class=\"n\">zero_comp</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intros</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Sheaf</span><span class=\"bp\">.</span><span class=\"n\">hom_ext</span>\n<span class=\"w\">    </span><span class=\"n\">ext</span>\n<span class=\"w\">    </span><span class=\"c1\">-- How to do directly?</span>\n<span class=\"w\">    </span><span class=\"n\">unfold_projs</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">map_zero</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TopCat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ChainComplex</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">AbSheaf</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">ℤ</span>\n</code></pre></div>",
        "id": 520948676,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1748455607
    },
    {
        "content": "<p>Does <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CategoryTheory.instPreadditiveSheaf#doc\">docs#CategoryTheory.instPreadditiveSheaf</a> not fire automatically?</p>",
        "id": 520950013,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1748456159
    },
    {
        "content": "<p>Ah, thanks, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=TopCat.Sheaf#doc\">docs#TopCat.Sheaf</a> is a <code>def</code> and not an <code>abbrev</code> so that wasn't being found.</p>",
        "id": 520950413,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1748456317
    },
    {
        "content": "<p>At least this is a workaround:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TopCat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TopCat</span><span class=\"o\">)</span>\n\n<span class=\"c1\">-- Abelian sheaf</span>\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">AbSheaf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">base</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TopCat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">TopCat</span><span class=\"bp\">.</span><span class=\"n\">Sheaf</span><span class=\"w\"> </span><span class=\"n\">Ab</span><span class=\"w\"> </span><span class=\"n\">base</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Preadditive</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">AbSheaf</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">instPreadditiveSheaf</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TopCat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ChainComplex</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">AbSheaf</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">ℤ</span>\n</code></pre></div>",
        "id": 520950561,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1748456399
    }
]