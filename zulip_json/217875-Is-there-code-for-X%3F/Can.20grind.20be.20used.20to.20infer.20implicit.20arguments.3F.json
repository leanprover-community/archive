[
    {
        "content": "<p>Is there an easy way (without metaprogramming) to let grind (or other tactic) synthesize typeclass parameters instead of <code>infer_instance</code> for certain classes?</p>\n<p>In our project we use a data structure and a well-formedness (WF) predicate (we intentionally decided not to merge WF and data in the same structure - to separate code from proofs). We pass the <code>[x.WF]</code> as argument to many theorems, where <code>x</code> is a term of our data structure. However, in many cases, typeclass inference is not enough to synthesize the arguments, so we usually do:</p>\n<div class=\"codehilite\" data-code-language=\"txt\"><pre><span></span><code>have : x.WF := by grind\nhave : y.WF := by grind\nhave : z.WF := by grind\napply my_theorem\n</code></pre></div>\n<p>where <code>my_theorem</code> is something like <code>theorem my_theorem {x y z : MyStruct} [x.WF] [y.WF] [z.WF] : someResult x y z</code>. Is there a way to avoid explicitly stating necessary typeclass instances in the proof context and let grind infer them implicitly based on the theorem we applied or the rewriting rule we invoked?</p>",
        "id": 573069651,
        "sender_full_name": "Shubakur Mitra",
        "timestamp": 1770736437
    },
    {
        "content": "<p>We have tried</p>\n<div class=\"codehilite\" data-code-language=\"txt\"><pre><span></span><code>theorem my_theorem {x y z : MyStruct} (_ : x.WF := by grind)\n    (_ : y.WF := by grind) (_ : z.WF := by grind) : someResult x y z\n</code></pre></div>\n<p>but it is very unpleasant to work with.</p>",
        "id": 573069799,
        "sender_full_name": "Shubakur Mitra",
        "timestamp": 1770736470
    },
    {
        "content": "<p>The intended way is indeed</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">my_theorem</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MyStruct</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">WF</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">grind</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">.</span><span class=\"n\">WF</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">grind</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"bp\">.</span><span class=\"n\">WF</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">grind</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">someResult</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">z</span>\n</code></pre></div>\n<p>There is an undesired interaction between certain tactics (<code>apply</code>, <code>rw</code>, <code>simp</code>) and these \"auto-params\": <a href=\"https://github.com/leanprover/lean4/pull/3475\">lean#3475</a></p>",
        "id": 573086885,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1770740364
    }
]