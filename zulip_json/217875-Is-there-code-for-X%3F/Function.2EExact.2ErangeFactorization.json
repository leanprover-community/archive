[
    {
        "content": "<p>If <code>M → N → P</code> is exact, then <code>M' → N → P'</code> is also exact, where <code>M'</code> and <code>P'</code> are images of <code>M → N</code> and <code>N → P</code>, respectively. The converse is also true.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib.Algebra.Exact</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Function.Exact</span>\n\n<span class=\"kd\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span>\n\n<span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">Set</span>\n\n<span class=\"kd\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Zero</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">}</span>\n\n<span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"n\">iff_rangeFactorization</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hg</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">Set.range</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">letI</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Zero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set.range</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">⟨⟨</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hg</span><span class=\"o\">⟩⟩</span>\n<span class=\"w\">    </span><span class=\"n\">Exact</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">Exact</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">↑</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set.range</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set.rangeFactorization</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Exact</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Exact</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Subtype.range_coe</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">congr</span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Set.rangeFactorization</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"n\">rwa</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Subtype.ext_iff</span><span class=\"o\">],</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"n\">rwa</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Subtype.ext_iff</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">⟩</span>\n\n<span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"n\">rangeFactorization</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Exact</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hg</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">Set.range</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">letI</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Zero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set.range</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">⟨⟨</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hg</span><span class=\"o\">⟩⟩</span>\n<span class=\"w\">    </span><span class=\"n\">Exact</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">↑</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set.range</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set.rangeFactorization</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">iff_rangeFactorization</span><span class=\"w\"> </span><span class=\"n\">hg</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">H</span>\n\n<span class=\"kd\">end</span><span class=\"w\"> </span><span class=\"n\">Set</span>\n\n<span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">AddMonoidHom</span>\n\n<span class=\"kd\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddGroup</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddGroup</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddGroup</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">→+</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"bp\">→+</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">}</span>\n\n<span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"n\">iff_addMonoidHom_rangeRestrict</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Exact</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">Exact</span><span class=\"w\"> </span><span class=\"n\">f.range.subtype</span><span class=\"w\"> </span><span class=\"n\">g.rangeRestrict</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">iff_rangeFactorization</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">zero_mem</span><span class=\"w\"> </span><span class=\"n\">g.range</span><span class=\"o\">)</span>\n\n<span class=\"n\">alias</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">addMonoidHom_rangeRestrict</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"o\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">iff_addMonoidHom_rangeRestrict</span>\n\n<span class=\"kd\">end</span><span class=\"w\"> </span><span class=\"n\">AddMonoidHom</span>\n\n<span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span>\n\n<span class=\"kd\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">→ₗ</span><span class=\"o\">[</span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"bp\">→ₗ</span><span class=\"o\">[</span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">}</span>\n\n<span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"n\">iff_linearMap_rangeRestrict</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Exact</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">Exact</span><span class=\"w\"> </span><span class=\"n\">f.range.subtype</span><span class=\"w\"> </span><span class=\"n\">g.rangeRestrict</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">iff_rangeFactorization</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">zero_mem</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">LinearMap.range</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">))</span>\n\n<span class=\"n\">alias</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">linearMap_rangeRestrict</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"o\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">iff_linearMap_rangeRestrict</span>\n\n<span class=\"kd\">end</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span>\n\n<span class=\"kd\">end</span><span class=\"w\"> </span><span class=\"n\">Function.Exact</span>\n</code></pre></div>\n<p>I think this result is used in homological algebra and commutative algebra extensively. Is it already stated in mathlib? If not, should it be added to mathlib?</p>",
        "id": 508894354,
        "sender_full_name": "Jz Pan",
        "timestamp": 1743230448
    },
    {
        "content": "<p>In the categorical context, I formalized the lemma <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CategoryTheory.ShortComplex.exact_iff_of_epi_of_isIso_of_mono#doc\">docs#CategoryTheory.ShortComplex.exact_iff_of_epi_of_isIso_of_mono</a> and its seems yours can be obtained by applying it twice. In the unbundled situation, I also formalized <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AddMonoidHom.exact_iff_of_surjective_of_bijective_of_injective#doc\">docs#AddMonoidHom.exact_iff_of_surjective_of_bijective_of_injective</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearMap.exact_iff_of_surjective_of_bijective_of_injective#doc\">docs#LinearMap.exact_iff_of_surjective_of_bijective_of_injective</a></p>",
        "id": 508961210,
        "sender_full_name": "Joël Riou",
        "timestamp": 1743285303
    },
    {
        "content": "<p>Thanks!</p>\n<p><span class=\"user-mention silent\" data-user-id=\"459699\">Joël Riou</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Function.2EExact.2ErangeFactorization/near/508961210\">said</a>:</p>\n<blockquote>\n<p>its seems yours can be obtained by applying it twice</p>\n</blockquote>\n<p>Yes it seems that it needs to apply twice, which is a little bit unfortunate:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>M  → N → P\n↓    ॥   ॥\nM' → N → P\n॥    ॥   ↑\nM' → N → P'\n</code></pre></div>\n<p>So I prefer add this specialized version to mathlib. What's your opinion?</p>",
        "id": 508991052,
        "sender_full_name": "Jz Pan",
        "timestamp": 1743311023
    },
    {
        "content": "<p>PR created as <a href=\"https://github.com/leanprover-community/mathlib4/pull/23446\">#23446</a>.</p>",
        "id": 508997211,
        "sender_full_name": "Jz Pan",
        "timestamp": 1743317161
    }
]