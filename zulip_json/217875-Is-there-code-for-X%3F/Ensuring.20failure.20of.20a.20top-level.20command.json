[
    {
        "content": "<p>For some sanity check and documentation purpose, I would like to have some commands that ensures some top-level command fails, like <code>#fail</code> in the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- fails and aborts compilation</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- does not fail</span>\n<span class=\"bp\">#</span><span class=\"n\">fail</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"c1\">-- does not fail</span>\n<span class=\"bp\">#</span><span class=\"n\">fail</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"c1\">-- fails and aborts compilation</span>\n</code></pre></div>\n<p>would there be a command for this in Lean4?</p>",
        "id": 493428532,
        "sender_full_name": "Youngju Song",
        "timestamp": 1736795741
    },
    {
        "content": "<p>There is a <em>tactic</em> <code>success_if_fail_with_msg</code></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">info: Found 1 use among 2002 syntax declarations</span>\n<span class=\"sd\">---</span>\n\n<span class=\"sd\">Mathlib.Tactic.successIfFailWithMsg:</span>\n<span class=\"sd\">  'success_if_fail_with_msg'</span>\n<span class=\"sd\">---</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">find_syntax</span><span class=\"w\"> </span><span class=\"s2\">\"success_if\"</span>\n</code></pre></div>\n<p>but I do not think that there is exactly the command that you want.  You can always do </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/--</span>\n<span class=\"sd\">error: failed to synthesize</span>\n<span class=\"sd\">  Neg â„•</span>\n<span class=\"sd\">Additional diagnostic information may be available using the `set_option diagnostics true` command.</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span>\n\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"o\">(</span><span class=\"n\">drop</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>though.</p>",
        "id": 493449149,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736802383
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> Thank you for the information!</p>",
        "id": 493497497,
        "sender_full_name": "Youngju Song",
        "timestamp": 1736822524
    },
    {
        "content": "<p>For top-level commands, maybe I should look into the definition of <code>guard_msgs</code> and do some hack.<br>\nFor tactics, it seems the <code>success_if</code> tactic you mentioned and its variant <code>fail_if_success</code> will do the job. Thanks!</p>",
        "id": 493497792,
        "sender_full_name": "Youngju Song",
        "timestamp": 1736822706
    },
    {
        "content": "<p>I found <code>check_failure</code> command that corresponds to <code>#fail (#check _)</code> in my original question. I should start playing with this</p>",
        "id": 493637245,
        "sender_full_name": "Youngju Song",
        "timestamp": 1736876641
    }
]