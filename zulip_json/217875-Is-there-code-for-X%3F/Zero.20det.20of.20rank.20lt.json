[
    {
        "content": "<p>When a square matrix has nonmaximal rank, its determinant is 0.</p>\n<p>Direct lemma does not exist.<br>\nShould I search for it through a notion of a singular matrix?<br>\nWhat is the definition I need?<br>\nI know <code>IsUnit</code> exists.</p>",
        "id": 486111825,
        "sender_full_name": "Martin Dvo≈ô√°k",
        "timestamp": 1733324257
    },
    {
        "content": "<p>Together <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix.rank_of_isUnit#doc\">docs#Matrix.rank_of_isUnit</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix.isUnit_iff_isUnit_det#doc\">docs#Matrix.isUnit_iff_isUnit_det</a> will show that if a matrix has nonmaximal rank, then the determinant is not a unit. If you want to get that the determinant is zero, you'll need to consider matrices over a field to use something like <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=isUnit_iff_ne_zero#doc\">docs#isUnit_iff_ne_zero</a>.</p>",
        "id": 486114664,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1733324963
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">]</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hA</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">.</span><span class=\"n\">rank</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">Fintype</span><span class=\"bp\">.</span><span class=\"n\">card</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">.</span><span class=\"n\">det</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">contrapose</span><span class=\"w\"> </span><span class=\"n\">hA</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">ne_eq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">isUnit_iff_ne_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">isUnit_iff_isUnit_det</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hA</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">.</span><span class=\"n\">rank_of_isUnit</span><span class=\"w\"> </span><span class=\"n\">hA</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">not_lt</span>\n</code></pre></div>",
        "id": 486115660,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1733325216
    },
    {
        "content": "<p>As for how to find this. Note that you already had the first bit: <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsUnit#doc\">docs#IsUnit</a>, and you can use Loogle to find the rest for you.</p>\n<p>First we link the rank to <code>IsUnit</code>: <span class=\"user-mention\" data-user-id=\"644391\">@loogle</span> Matrix.rank, IsUnit</p>",
        "id": 486116689,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1733325484
    },
    {
        "content": "<p><span aria-label=\"search\" class=\"emoji emoji-1f50d\" role=\"img\" title=\"search\">:search:</span> <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Matrix/Rank.html#Matrix.rank_of_isUnit\">Matrix.rank_of_isUnit</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Matrix/Rank.html#Matrix.rank_mul_eq_left_of_isUnit_det\">Matrix.rank_mul_eq_left_of_isUnit_det</a>, and <a href=\"https://loogle.lean-lang.org/?q=Matrix.rank%2C%20IsUnit\">1 more</a></p>",
        "id": 486116693,
        "sender_full_name": "loogle",
        "timestamp": 1733325485
    },
    {
        "content": "<p>Then we link the determinant to <code>IsUnit</code>: <span class=\"user-mention\" data-user-id=\"644391\">@loogle</span> Matrix.det, IsUnit</p>",
        "id": 486116798,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1733325520
    },
    {
        "content": "<p><span aria-label=\"search\" class=\"emoji emoji-1f50d\" role=\"img\" title=\"search\">:search:</span> <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/LinearAlgebra/Matrix/NonsingularInverse.html#Matrix.isUnit_det_transpose\">Matrix.isUnit_det_transpose</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/LinearAlgebra/Matrix/NonsingularInverse.html#Matrix.nonsingInvUnit\">Matrix.nonsingInvUnit</a>, and <a href=\"https://loogle.lean-lang.org/?q=Matrix.det%2C%20IsUnit\">59 more</a></p>",
        "id": 486116800,
        "sender_full_name": "loogle",
        "timestamp": 1733325521
    },
    {
        "content": "<p>Then we link the determinant being a unit to the nonzero condition: <span class=\"user-mention\" data-user-id=\"644391\">@loogle</span> IsUnit, ?a ‚â† 0</p>",
        "id": 486116814,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1733325526
    },
    {
        "content": "<p><span aria-label=\"search\" class=\"emoji emoji-1f50d\" role=\"img\" title=\"search\">:search:</span> <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/GroupWithZero/Units/Basic.html#IsUnit.ne_zero\">IsUnit.ne_zero</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/GroupWithZero/Units/Basic.html#IsUnit.mk0\">IsUnit.mk0</a>, and <a href=\"https://loogle.lean-lang.org/?q=IsUnit%2C%20%3Fa%20%E2%89%A0%200\">75 more</a></p>",
        "id": 486116818,
        "sender_full_name": "loogle",
        "timestamp": 1733325527
    },
    {
        "content": "<p>Should I PR your lemma so that future users don't have to go through the search?</p>",
        "id": 486118130,
        "sender_full_name": "Martin Dvo≈ô√°k",
        "timestamp": 1733325889
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">]</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hA</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">.</span><span class=\"n\">rank</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">Fintype</span><span class=\"bp\">.</span><span class=\"n\">card</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">.</span><span class=\"n\">det</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div>\n<p>This should still be true if ùïú is a domain because e.g. we can map the matrix into the FractionRing. The map is injective so if you get zero det over the field it's also zero over the domain. To see that this preserves the rank I see no easier way than to 1) consider the associated linear map, whose range has the same rank as the matrix; 2) use the existing results that the base change of the range is the range of the base-changed linear map (<a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Module/LocalizedModule/Submodule.html#LinearMap.range_localizedMap_eq_localized%E2%82%80_range\">LinearMap.range_localizedMap_eq_localized‚ÇÄ_range</a>), and that rank is preserved under (<a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/LinearAlgebra/Dimension/Localization.html#IsLocalizedModule.lift_rank_eq\">IsLocalizedModule.lift_rank_eq</a>).</p>",
        "id": 486122325,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1733326913
    },
    {
        "content": "<p>Indeed, I will have to look into the generalization; ideally, I want to have the lemma for matrices over integers.</p>",
        "id": 486131039,
        "sender_full_name": "Martin Dvo≈ô√°k",
        "timestamp": 1733329190
    },
    {
        "content": "<p>Let's postpone the potential PR until we have the most general version.</p>",
        "id": 486131308,
        "sender_full_name": "Martin Dvo≈ô√°k",
        "timestamp": 1733329254
    },
    {
        "content": "<p>Can <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix.rank_of_isUnit#doc\">docs#Matrix.rank_of_isUnit</a> (and the new lemma) be upgraded to an iff?</p>",
        "id": 486181786,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1733347531
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix.rank_of_isUnit#doc\">docs#Matrix.rank_of_isUnit</a> cannot; consider the 1x1 matrix with the single entry <code>2 : ‚Ñ§</code>. Its rank is 1 because the range of the associated linear map is <code>2‚Ñ§</code> which is isomorphic to <code>‚Ñ§</code> and of rank 1, but its determinant is 2, which isn't a unit.</p>",
        "id": 486183723,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1733348376
    },
    {
        "content": "<p>I have the impression that if the rank is not maximal then the determinant must be nilpotent, but I may be wrong.</p>",
        "id": 486185246,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1733349092
    },
    {
        "content": "<p>There are criteria for surjectivity involving the ideal generated by all the minors iirc</p>",
        "id": 486186033,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1733349424
    },
    {
        "content": "<p>Is it sufficient for the determinant to satisfy <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsRegular#doc\">docs#IsRegular</a>  ?</p>",
        "id": 486192932,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733352890
    },
    {
        "content": "<p>I don't even know what \"rank\" means if you're not over a field.</p>",
        "id": 486245024,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733385447
    },
    {
        "content": "<p>It's defined to be the Module.rank of the range of the associated linear map. It especially makes sense over a PID, where every submodule of a finite free module is also free.</p>",
        "id": 486263416,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1733392027
    },
    {
        "content": "<p>This is just the sort of daft thing we end up with in mathlib because people write definitions in the max generality for which it compiles. So the open questions in this thread (assuming the base is a commutative ring, my sanity won't let me go any lower) are: does det regular (ie not a zero divisor) imply full rank and does not-full rank imply nilpotent det? These can't both be right because in K[X,Y]/(XY) the element X is neither regular nor nilpotent but I'm about to get on a plane so can't think about this online any more. Is the 1*1 matrix (X) \"full rank\" or not? :-/</p>",
        "id": 486268660,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733393734
    },
    {
        "content": "<p>The geometric answer (ie the sensible answer) is \"yes on one component of the scheme, no on the other\"</p>",
        "id": 486269054,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733393857
    },
    {
        "content": "<p>There is a determinantal criterion for injectivity‚Äî a square matrix is injective iff its determinant is regular. Is it in mathlib? <br>\nThat will imply full rank.<br>\nBut it is not a necessary assumption, in a product ring A x B, multiplication by (1, 0) has rank one (for A nonzero) but is neither injective nor surjective.</p>",
        "id": 486291831,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1733401097
    },
    {
        "content": "<p>The absolute rank of a module is not a good invariant, what makes more sense is the function on the spectrum, ranks of the tensor products with the various residual fields</p>",
        "id": 486292063,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1733401197
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130609\">Antoine Chambert-Loir</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Zero.20det.20of.20rank.20lt/near/486291831\">said</a>:</p>\n<blockquote>\n<p>There is a determinantal criterion for injectivity‚Äî a square matrix is injective iff its determinant is regular. Is it in mathlib? <br>\nThat will imply full rank.</p>\n</blockquote>\n<p>To formalize <a href=\"https://math.stackexchange.com/a/162749/12932\">this proof</a> it looks like we will need <a href=\"https://github.com/leanprover-community/mathlib4/pull/18771\">#18771</a>.</p>\n<blockquote>\n<p>in a product ring A x B, multiplication by (1, 0) has rank one (for A nonzero) but is neither injective nor surjective.</p>\n</blockquote>\n<p>I don't think it has rank one (according to Mathlib definition)? The only (A x B)-linearly independent subset contained in the range A x 0 is the empty set.</p>",
        "id": 486321079,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1733409802
    },
    {
        "content": "<p>I am a computer scientist, hence I naturally think about rank in terms of the Gaussian elimination.<br>\nIt prevents me from seeing the more general things that could be there.</p>",
        "id": 486350732,
        "sender_full_name": "Martin Dvo≈ô√°k",
        "timestamp": 1733417370
    },
    {
        "content": "<p>What's going on is that the Gaussian elimination algorithm involves division and all the discussion above is trying to make it work for rings, where division isn't in general defined.</p>",
        "id": 486407851,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733439351
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Zero.20det.20of.20rank.20lt/near/486268660\">said</a>:</p>\n<blockquote>\n<p>assuming the base is a commutative ring, my sanity won't let me go any lower</p>\n</blockquote>\n<p>Avery your eyes from <a href=\"https://github.com/leanprover-community/mathlib4/pull/19581\">#19581</a> then!</p>",
        "id": 486413406,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733442330
    }
]