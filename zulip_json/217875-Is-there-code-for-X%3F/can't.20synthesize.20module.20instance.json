[
    {
        "content": "<p>Why would the first work and the second doesn't? Should we change the instance so that it's about actual <code>Module</code>s and not <code>ModuleCat</code> since it has nothing to do with category theory?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R₀</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommSemiring</span><span class=\"w\"> </span><span class=\"n\">R₀</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">R₀</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ModuleCat</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">ModuleCat</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span>\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R₀</span><span class=\"w\"> </span><span class=\"n\">M'</span><span class=\"w\"> </span><span class=\"c1\">-- works</span>\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R₀</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"c1\">-- don't work</span>\n</code></pre></div>",
        "id": 556605201,
        "sender_full_name": "Edison Xie",
        "timestamp": 1763212789
    },
    {
        "content": "<p>but changing the instance to module gives:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">cannot</span><span class=\"w\"> </span><span class=\"n\">find</span><span class=\"w\"> </span><span class=\"n\">synthesization</span><span class=\"w\"> </span><span class=\"n\">order</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">instModule</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"o\">(</span><span class=\"n\">R₀</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"o\">[</span><span class=\"n\">inst</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CommSemiring</span><span class=\"w\"> </span><span class=\"n\">R₀</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"o\">[</span><span class=\"n\">inst_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">R₀</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">inst_3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R₀</span><span class=\"w\"> </span><span class=\"n\">M</span>\n<span class=\"n\">all</span><span class=\"w\"> </span><span class=\"n\">remaining</span><span class=\"w\"> </span><span class=\"n\">arguments</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">metavariables</span><span class=\"o\">:</span>\n<span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">R</span>\n<span class=\"bp\">@</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">R₀</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">inst</span><span class=\"bp\">✝⁴</span><span class=\"w\"> </span><span class=\"n\">Ring</span><span class=\"bp\">.</span><span class=\"n\">toSemiring</span>\n<span class=\"bp\">@</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"n\">Ring</span><span class=\"bp\">.</span><span class=\"n\">toSemiring</span><span class=\"w\"> </span><span class=\"n\">inst</span><span class=\"bp\">✝¹.</span><span class=\"n\">toAddCommMonoid</span>\n</code></pre></div>\n<p>Is there just no good ways to do this? Should I always do <code>letI := ...</code>?</p>",
        "id": 556605238,
        "sender_full_name": "Edison Xie",
        "timestamp": 1763212838
    },
    {
        "content": "<p>This topic was moved here from <a class=\"stream-topic\" data-stream-id=\"217875\" href=\"/#narrow/channel/217875-Is-there-code-for-X.3F/topic/can.27t.20synthesize.20instance\">#Is there code for X? &gt; can't synthesize instance</a> by <span class=\"user-mention silent\" data-user-id=\"699016\">Edison Xie</span>.</p>",
        "id": 556605429,
        "sender_full_name": "Notification Bot",
        "timestamp": 1763213072
    },
    {
        "content": "<p>To solve this typeclass problem Lean would have to guess and fill in <code>R</code>, but since <code>R</code> doesn't appear in the typeclass goal or any <code>outParam</code> or <code>semiOutParam</code> of any of the typeclass arguments, then Lean has no way of doing that</p>",
        "id": 556605864,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1763213545
    },
    {
        "content": "<p>If <code>R₀</code> is acting on <code>M</code> in the statement of a lemma or in the body of a definition, then you should additionally assume <code>[Module R₀ M] [IsScalarTower R₀ R M]</code>, but if it's in the body of a proof then proof irrelevance means we don't care about it so you can just <code>letI := ...</code>.</p>",
        "id": 556606134,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1763213826
    },
    {
        "content": "<p>It works with <code>M'</code> instead of <code>M</code> because <code>M'</code> appears in the goal and <code>R</code> appears in the type of <code>M'</code>, so Lean doesn't have to guess what <code>R</code> could be since it (transitively) appears in the goal</p>",
        "id": 556606452,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1763214173
    },
    {
        "content": "<p>thanks aaron :-)</p>",
        "id": 556606490,
        "sender_full_name": "Edison Xie",
        "timestamp": 1763214219
    }
]