[
    {
        "content": "<p>What would be the standard way to define the <a href=\"https://en.wikipedia.org/wiki/Total_variation_distance_of_probability_measures\">total variation distance</a> between two PMFs <code>p : PMF Œ±</code> and <code>q : PMF Œ±</code>?<br>\nAccording to <a href=\"https://en.wikipedia.org/wiki/Total_variation#Total_variation_of_probability_measures\">this</a>, it can be defined using the <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/MeasureTheory/VectorMeasure/Decomposition/Jordan.html#MeasureTheory.SignedMeasure.totalVariation\">total variation of signed measures</a>, but I'm not familiar enough with measure theory to figure it out how to turn <code>p.toMeasure - q.toMeasure</code> into a signed measure...</p>",
        "id": 566412246,
        "sender_full_name": "Yannick Seurin",
        "timestamp": 1767636406
    },
    {
        "content": "<p>You can use <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/MeasureTheory/VectorMeasure/Basic.html#MeasureTheory.Measure.toSignedMeasure\">MeasureTheory.Measure.toSignedMeasure</a></p>",
        "id": 566416087,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1767637947
    },
    {
        "content": "<p>Thanks! I searched for <code>toSignedMeasure</code> but it actually appears pretty low in the search results...<br>\nSo <code>totalVariation (p.toMeasure.toSignedMeasure - q.toMeasure.toSignedMeasure)</code> gives us a measure on <code>Œ±</code>, but how do we translate it to the TV distance?</p>\n<p>I also found <a href=\"https://stephentu.github.io/blog/probability-theory/2017/10/09/total-variation-distance-identity.html\">this blog post</a> which suggests another definition based on the L1 distance between the Radon-Nikodym derivatives of <code>p.toMeasure</code> and <code>q.toMeasure</code>. But again, I'm not qualified enough to express it in Lean...</p>",
        "id": 566438457,
        "sender_full_name": "Yannick Seurin",
        "timestamp": 1767647127
    },
    {
        "content": "<p>You get the the total variation distance by evaluating <code>totalVariation (p.toMeasure.toSignedMeasure - q.toMeasure.toSignedMeasure)</code> on the univ.</p>",
        "id": 566444736,
        "sender_full_name": "Yongxi Lin (Aaron)",
        "timestamp": 1767650163
    },
    {
        "content": "<p>Thanks! Would it make sense to have it (and other distances) defined in Mathlib? For someone like me who's not versed in measure theory but wants to work on \"basic\" probability results with PMFs, it would be quite handy :)</p>",
        "id": 566532213,
        "sender_full_name": "Yannick Seurin",
        "timestamp": 1767701506
    },
    {
        "content": "<p>The first step would be to add the total variation distance of two arbitrary measures.</p>",
        "id": 566534088,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1767702277
    },
    {
        "content": "<p>Note that there's <a href=\"https://github.com/leanprover-community/mathlib4/pull/26156\">#26156</a> which defines total variation for any vector measures</p>",
        "id": 566536555,
        "sender_full_name": "Kexing Ying",
        "timestamp": 1767703275
    },
    {
        "content": "<p>Like this?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">Measure</span><span class=\"w\"> </span><span class=\"n\">Set</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">Measure</span><span class=\"bp\">.</span><span class=\"n\">totalVariationDistance</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MeasurableSpace</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Œº</span><span class=\"w\"> </span><span class=\"n\">ŒΩ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Measure</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hŒº</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsFiniteMeasure</span><span class=\"w\"> </span><span class=\"n\">Œº</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hŒΩ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsFiniteMeasure</span><span class=\"w\"> </span><span class=\"n\">ŒΩ</span><span class=\"w\"> </span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">Œº</span><span class=\"bp\">.</span><span class=\"n\">toSignedMeasure</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">ŒΩ</span><span class=\"bp\">.</span><span class=\"n\">toSignedMeasure</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">univ</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">PMF</span><span class=\"bp\">.</span><span class=\"n\">totalVariationDistance</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MeasurableSpace</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PMF</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">Measure</span><span class=\"bp\">.</span><span class=\"n\">totalVariationDistance</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">toMeasure</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">toMeasure</span>\n</code></pre></div>\n<p>Would that make a good start to then prove equality with other definitions, such as the supremum one, the L1 distance between the Radon-Nikodym derivatives of <code>Œº</code> and <code>ŒΩ</code>, or the PMF tsum form for <code>Fintype Œ±</code>?</p>",
        "id": 566537341,
        "sender_full_name": "Yannick Seurin",
        "timestamp": 1767703573
    },
    {
        "content": "<p>In <a href=\"https://github.com/leanprover-community/mathlib4/pull/27579\">#27579</a> I wrote a definition of a TV distance between two <code>Measure</code>. The (somewhat obscure) definition is line 117 of this file: <a href=\"https://github.com/leanprover-community/mathlib4/pull/27579/changes#diff-73a759938aafd3b48c0176b0baaeec1ef494f0feeb6b08bdcc3d6bd81d16ed84R117\">https://github.com/leanprover-community/mathlib4/pull/27579/changes#diff-73a759938aafd3b48c0176b0baaeec1ef494f0feeb6b08bdcc3d6bd81d16ed84R117</a> . The lemmas below show equality to several more familiar expressions.</p>",
        "id": 566538185,
        "sender_full_name": "R√©my Degenne",
        "timestamp": 1767703971
    },
    {
        "content": "<p>This is a big PR that I did not work on much recently, so unless I start being more active with the PR that definition is sadly not going to end up in Mathlib soon.</p>",
        "id": 566538777,
        "sender_full_name": "R√©my Degenne",
        "timestamp": 1767704224
    },
    {
        "content": "<p>Oh, I see, thanks. Out of curiosity, why choose this definition rather than the one based on signed measures, which seems standard as far as I can tell?</p>",
        "id": 566539290,
        "sender_full_name": "Yannick Seurin",
        "timestamp": 1767704440
    },
    {
        "content": "<p>I was doing work that used the DeGroot statistical information, so I coded that. And that's a family of divergences that includes TV, so I thought I might as well introduce that important special case.</p>",
        "id": 566539677,
        "sender_full_name": "R√©my Degenne",
        "timestamp": 1767704610
    },
    {
        "content": "<p>And to be clear: I'm not saying anybody should wait for my PR to land (which might be long). If you want to PR another, more direct definition, do it.</p>",
        "id": 566541635,
        "sender_full_name": "R√©my Degenne",
        "timestamp": 1767705419
    },
    {
        "content": "<p>I'll see what I can come with, might be a good way to get more familiar with measure theory...</p>",
        "id": 566547297,
        "sender_full_name": "Yannick Seurin",
        "timestamp": 1767707550
    },
    {
        "content": "<p>If you aren't inclined to learn measure theory for the sake of this, then I don't see anything wrong with providing the definition in terms of discrete math. For example, Arklib has <a href=\"https://github.com/Verified-zkEVM/ArkLib/blob/7f3728eb5d414f9611d3ccf9db23560abb386dbc/ArkLib/Data/Classes/Serde.lean#L37\">this definition</a>.</p>",
        "id": 566595172,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1767722371
    },
    {
        "content": "<p>In fact, I don't think we need either the <code>Fintype</code> or <code>MeasurableSpace</code> typeclass arguments to provide this definition </p>\n<p>See this prior discussion here: <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Statistical.20distance.20for.20.60PMF.60s.3F/near/525234190\">#Is there code for X? &gt; Statistical distance for &#96;PMF&#96;s? @ üí¨</a></p>",
        "id": 566597538,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1767723243
    },
    {
        "content": "<p>(Unfortunately, I don't think I ever tried to clean up or PR the code in that thread, probably because I got sidetracked by the return type issue.)</p>",
        "id": 566599866,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1767724260
    },
    {
        "content": "<p>Courtesy of claude, here is a cleaned up and sorry free version of the definition from that thread</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Probability</span><span class=\"bp\">.</span><span class=\"n\">ProbabilityMassFunction</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">PMF</span><span class=\"bp\">.</span><span class=\"n\">summable_toReal_abs</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PMF</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Summable</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toReal</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">abs_of_nonneg</span><span class=\"w\"> </span><span class=\"n\">ENNReal</span><span class=\"bp\">.</span><span class=\"n\">toReal_nonneg</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">ENNReal</span><span class=\"bp\">.</span><span class=\"n\">summable_toReal</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">tsum_coe_ne_top</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">PMF</span><span class=\"bp\">.</span><span class=\"n\">dist_summable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PMF</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Summable</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">dist</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toReal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toReal</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Summable</span><span class=\"bp\">.</span><span class=\"n\">of_nonneg_of_le</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toReal</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"o\">(</span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toReal</span><span class=\"bp\">|</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"n\">abs_nonneg</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Summable</span><span class=\"bp\">.</span><span class=\"n\">add</span>\n<span class=\"w\">    </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">PMF</span><span class=\"bp\">.</span><span class=\"n\">summable_toReal_abs</span>\n<span class=\"w\">    </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">PMF</span><span class=\"bp\">.</span><span class=\"n\">summable_toReal_abs</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"n\">abs_sub</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toReal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toReal</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">StatisticalDistance</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Œ±</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PseudoMetricSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">PMF</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">dist</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">‚àë'</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">dist</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toReal</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toReal</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">dist_self</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"n\">dist_comm</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">congr</span>\n<span class=\"w\">    </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">i</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">PseudoMetricSpace</span><span class=\"bp\">.</span><span class=\"n\">dist_comm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toReal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toReal</span>\n<span class=\"w\">  </span><span class=\"n\">dist_triangle</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">&lt;-</span><span class=\"n\">mul_add</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">&lt;-</span><span class=\"n\">Summable</span><span class=\"bp\">.</span><span class=\"n\">tsum_add</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">PMF</span><span class=\"bp\">.</span><span class=\"n\">dist_summable</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">PMF</span><span class=\"bp\">.</span><span class=\"n\">dist_summable</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">)]</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">one_div</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">inv_pos</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">ofNat_pos</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_le_mul_iff_right‚ÇÄ</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span>\n<span class=\"w\">      </span><span class=\"n\">Summable</span><span class=\"bp\">.</span><span class=\"n\">tsum_mono</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">PMF</span><span class=\"bp\">.</span><span class=\"n\">dist_summable</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"n\">Summable</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">PMF</span><span class=\"bp\">.</span><span class=\"n\">dist_summable</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">PMF</span><span class=\"bp\">.</span><span class=\"n\">dist_summable</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">))</span>\n<span class=\"w\">        </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"n\">PseudoMetricSpace</span><span class=\"bp\">.</span><span class=\"n\">dist_triangle</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toReal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toReal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toReal</span>\n</code></pre></div>",
        "id": 566606837,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1767727116
    },
    {
        "content": "<blockquote>\n<p>I don't see anything wrong with providing the definition in terms of discrete math</p>\n</blockquote>\n<p>Indeed, and for <code>Fintype Œ±</code> it's pretty straightforward as done in Arklib. For arbitrary <code>Œ±</code>, I was tempted to use the supremum definition and let</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">TVD</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PMF</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">‚®Ü</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"o\">(</span><span class=\"bp\">‚àë'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toReal</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">‚àë'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toReal</span><span class=\"bp\">|</span>\n</code></pre></div>\n<p>but I wasn't sure this was correct, hence my question about a measure-based definition that follows the textbooks.</p>\n<blockquote>\n<p>See this prior discussion here: <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Statistical.20distance.20for.20.60PMF.60s.3F/near/525234190\">#Is there code for X? &gt; Statistical distance for <code>PMF</code>s? @ üí¨</a></p>\n</blockquote>\n<p>Nice! It would be interesting to check whether these definitions coincide...</p>",
        "id": 566635261,
        "sender_full_name": "Yannick Seurin",
        "timestamp": 1767741148
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"756493\">Yannick Seurin</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/total.20variation.20distance.20between.20two.20PMFs/near/566635261\">said</a>:</p>\n<blockquote>\n<p>Nice! It would be interesting to check whether these definitions coincide...</p>\n</blockquote>\n<p>I think so! You could also make a few other variants (the absolute value sign shouldn't be necessary in what you've written, or you could just choose s to be the set for which <code>p &gt; q</code>). Whatever we do, we should try to produce proofs of the equivalences to other forms of the definition, etc and encapsulate the definition itself.</p>\n<p>I have been working on a PR here <a href=\"https://github.com/leanprover-community/mathlib4/pull/33680\">#33680</a>, you can contribute to that or make a PR of your own, I would be happy to review it if so.</p>",
        "id": 566810511,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1767814992
    }
]