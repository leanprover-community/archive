[
    {
        "content": "<p>In my code I want to define a norm in the form AA<em>+BB</em>+CC*+...</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Octonion</span><span class=\"bp\">.</span><span class=\"n\">norm</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"o\">](</span><span class=\"n\">p</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ğ•†</span><span class=\"o\">[</span><span class=\"n\">Î±</span><span class=\"o\">])</span><span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">re</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">re</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e1</span><span class=\"bp\">*</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e2</span><span class=\"bp\">*</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e3</span><span class=\"bp\">*</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e3</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e4</span><span class=\"bp\">*</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e4</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e5</span><span class=\"bp\">*</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e5</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e6</span><span class=\"bp\">*</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e6</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e7</span><span class=\"bp\">*</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e7</span>\n</code></pre></div>\n<p>I want to change it so that it reads <code>p.re*(star p.re)+ ...</code><br>\nbut it won't allow this. Is there a way to specify it accepts fields with the star operation defined?</p>\n<p>Alternatively I would have something like <code>p.re.norm + p.e1.norm + ....</code> if the norm (squared magnitude) was defined for each field.</p>",
        "id": 445029293,
        "sender_full_name": "Mr Proof",
        "timestamp": 1718578131
    },
    {
        "content": "<p>you want to add <code>[StarRing Î±]</code> most likely (after the existing <code>Field Î±</code> that you have)</p>",
        "id": 445029320,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1718578170
    },
    {
        "content": "<p>You could of course just add <code>[Star Î±]</code>, but that allows a nonsensical definition</p>",
        "id": 445029406,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1718578247
    },
    {
        "content": "<p>Hmm... it's still saying \"failed to synthesize\" when it gets to (star..) Not sure why..</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"c\">/-</span>\n\n<span class=\"cm\">An definition of the Octonion Algebra over field F denoted by ğ•†[F]</span>\n\n<span class=\"cm\">-/</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Octonion</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">re</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span>\n<span class=\"w\">  </span><span class=\"n\">e1</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span>\n<span class=\"w\">  </span><span class=\"n\">e2</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span>\n<span class=\"w\">  </span><span class=\"n\">e3</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span>\n<span class=\"w\">  </span><span class=\"n\">e4</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span>\n<span class=\"w\">  </span><span class=\"n\">e5</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span>\n<span class=\"w\">  </span><span class=\"n\">e6</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span>\n<span class=\"w\">  </span><span class=\"n\">e7</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span>\n\n<span class=\"c\">/-</span><span class=\"cm\"> Notation and output -/</span>\n\n<span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"ğ•†\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Octonion</span><span class=\"w\"> </span><span class=\"n\">â„</span>\n\n<span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"ğ•†[\"</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"s2\">\"]\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Octonion</span><span class=\"w\"> </span><span class=\"n\">F</span>\n\n\n\n<span class=\"c\">/-</span><span class=\"cm\"> conjugation-/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Octonion</span><span class=\"bp\">.</span><span class=\"n\">star</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ğ•†</span><span class=\"o\">[</span><span class=\"n\">Î±</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Octonion</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"o\">:={</span>\n<span class=\"w\">    </span><span class=\"n\">re</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">re</span>\n<span class=\"w\">    </span><span class=\"n\">e1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e1</span>\n<span class=\"w\">    </span><span class=\"n\">e2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e2</span>\n<span class=\"w\">    </span><span class=\"n\">e3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e3</span>\n<span class=\"w\">    </span><span class=\"n\">e4</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e4</span>\n<span class=\"w\">    </span><span class=\"n\">e5</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e5</span>\n<span class=\"w\">    </span><span class=\"n\">e6</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e6</span>\n<span class=\"w\">    </span><span class=\"n\">e7</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e7</span>\n<span class=\"o\">}</span>\n\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Octonion</span><span class=\"bp\">.</span><span class=\"n\">norm</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">StarRing</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ğ•†</span><span class=\"o\">[</span><span class=\"n\">Î±</span><span class=\"o\">])</span><span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">re</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">star</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">re</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e1</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">star</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e2</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">star</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e3</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">star</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e4</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">star</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e4</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e5</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">star</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e5</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e6</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">star</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e6</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e7</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">star</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">e7</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 445029523,
        "sender_full_name": "Mr Proof",
        "timestamp": 1718578341
    },
    {
        "content": "<p>Can you make a <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a>, or at least paste the full message?</p>",
        "id": 445029532,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1718578368
    },
    {
        "content": "<p>(See above). I see the problem. My definition of <a href=\"http://Octonion.star\">Octonion.star</a> is somehow interfering with that star . If I delete the <a href=\"http://Octonion.star\">Octonion.star</a> definition then it works. Is it a scoping issue?</p>\n<p>If I swap the order of those two definitions then it works. But that doesn't seem the best solution.</p>",
        "id": 445030051,
        "sender_full_name": "Mr Proof",
        "timestamp": 1718578827
    },
    {
        "content": "<p>You should mark <code>Octonion.star</code> as <code>protected</code></p>",
        "id": 445030466,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1718579259
    },
    {
        "content": "<p>Or eliminate it entirely, and inline the definition into <code>instance : Star (Octonion _) where star o := sorry</code></p>",
        "id": 445030514,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1718579289
    },
    {
        "content": "<p>Perhaps its confusing itself because if I did ğ•†[ğ•†] then I better make sure ğ•† is also a star ring. But your solution works.</p>",
        "id": 445030637,
        "sender_full_name": "Mr Proof",
        "timestamp": 1718579413
    },
    {
        "content": "<p>Independent of your confusion, you will definitely want to show <code>StarRing ğ•†</code> later anyway, assuming it's true!</p>",
        "id": 445031325,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1718580170
    }
]