[
    {
        "content": "<p>Is there anything related to Diffeology currently in MathLib? If not, would there be interest in a project to formalise aspects of it?</p>\n<p>My motivation for asking is that diffeology appears in some aspects of physics, and in general is more well-behaved than the theory of manifolds (e.g. diffeological spaces form a Cartesian closed category unlike manifolds).</p>",
        "id": 437977471,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1715345661
    },
    {
        "content": "<p>Pretty sure we don't have anything. I guess your \"e.g.\" is a reasonable first target. But where would it go in Mathlib after that?</p>",
        "id": 437978257,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1715346005
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> ,  if I have interpreted your question correctly (sorry if I haven't), then other targets would be:</p>\n<ol>\n<li>Showing the relations between manifolds and diffeological spaces. Summarised by saying that there is a fully-faithful functor from the category of manifolds to the category of diffeological spaces. </li>\n<li>Showing that the mapping space between manifolds has the structure of a diffeolocial space (follows from 1 and my \"e.g.\").</li>\n<li>Showing that diffeolocial spaces are precisely  the concrete objects of the topos of sheafs on the site of cartesian spaces (this is where one connection to physics comes in through topological field theories).  </li>\n<li>The definition of subductions and inductions between diffeoloical spaces, and their relation to surjective submersion and injective immersions of manifolds. </li>\n</ol>\n<p>That said, maybe I am over-estimating the usefulness of this for the Mathematicians.</p>",
        "id": 437981336,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1715347318
    },
    {
        "content": "<p>All sounds fun, and certainly it's \"in scope\" for mathlib. I think it's always good when considering a slightly-off-the-beaten-track topic whether there would be other people around (or that you could recruit!) who would also work on it, or at least be able to give useful reviews. (The existing Mathlib maintainer/reviewer team doesn't need to contain someone who knows about this stuff: but we need reviews from someone!)</p>",
        "id": 437981924,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1715347572
    },
    {
        "content": "<p>Makes sense :). I'll wait and see if anyone pops up here expressing an interest.</p>",
        "id": 437983186,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1715348063
    },
    {
        "content": "<p>I’m not an expert but I certainly find this stuff interesting!</p>",
        "id": 437984719,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1715348661
    },
    {
        "content": "<p>I think it would be extremely difficult to find reviewer for this. Developing it in an independent project would probably be a lot less frustrating.</p>",
        "id": 438016004,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1715360618
    },
    {
        "content": "<p>There was someone interested in diffeology on Xena. Was it you?</p>",
        "id": 438024513,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1715364026
    },
    {
        "content": "<p>FWIW I would be happy to review diffeology material but I am no easy reviewer to satisfy <span aria-label=\"smiling devil\" class=\"emoji emoji-1f608\" role=\"img\" title=\"smiling devil\">:smiling_devil:</span></p>",
        "id": 438024663,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1715364093
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span>  No that wasn't me. Seems like the best plan, is to follow <span class=\"user-mention\" data-user-id=\"110031\">@Patrick Massot</span>'s advice, and  start it in an independent project.  Then it could be slowly move it to MathLib, when and if the time is right.</p>",
        "id": 438025383,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1715364356
    },
    {
        "content": "<p>Was it <span class=\"user-mention\" data-user-id=\"646363\">@Ben Eltschig</span>? (Is a diffeology the same as a diffeological space? I never thought about this at all.)</p>",
        "id": 438052665,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1715378730
    },
    {
        "content": "<p>Yep, I'm currently working on some code related to diffeology too. So far it's sitting at <a href=\"https://github.com/peabrainiac/lean-orbifolds\">https://github.com/peabrainiac/lean-orbifolds</a></p>",
        "id": 438086724,
        "sender_full_name": "Ben Eltschig",
        "timestamp": 1715411865
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"346070\">@Tomas Skrivan</span> might also be interested</p>",
        "id": 438086906,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1715412046
    },
    {
        "content": "<p>My main goal with this is to be eventually able to state the definition of orbifolds as special diffeological spaces; after that I would probably shift to working on Lie groupoids to try and get that definition of orbifolds formalised too. If you want to further develop diffeology I wouldn't mind adding you to that repo, though if you want you can of course also start your own</p>",
        "id": 438086944,
        "sender_full_name": "Ben Eltschig",
        "timestamp": 1715412108
    },
    {
        "content": "<p>(Also, it sounds from this conversation that if/when there's material you'd like to send to mathlib, there are enough reviewers around! It's super helpful when people review other PRs in their field, making it much easier for the official reviewers/maintainers to do a quick check and then merge.)</p>",
        "id": 438087396,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1715412597
    },
    {
        "content": "<p>Yes, I would be very much interested in having a formalization of diffeology. I think it is the right abstraction for formalizing automatic differentiation. One thing I'm not sure about is which notion of tangent space should be used as there are few different definitions.</p>\n<p>Also I would like to have formalization of convenient vector spaces which are effectively a flat version of diffeology.</p>",
        "id": 438087827,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1715413056
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"646363\">@Ben Eltschig</span> Nice! What you've got so far looks like a great start :). I would like to develop aspects of it further.  If <span class=\"user-mention\" data-user-id=\"346070\">@Tomas Skrivan</span>  is interested we could create a repo dedicated to diffeology with the three of us, and then move it over to MathLib when ready.</p>",
        "id": 438105981,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1715430249
    },
    {
        "content": "<p>(or also just happy to add to your existing repo <span class=\"user-mention\" data-user-id=\"646363\">@Ben Eltschig</span>)</p>",
        "id": 438107277,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1715431702
    },
    {
        "content": "<p>I imagine splitting the code for diffeologies and orbifolds (which I don't have yet, but hope to get to soon) up into two different repos is going to make it quite inconvenient to work on the latter, so I'd be more in favor of keeping both in the same repo. I am open to renaming or moving the repository though if the amount of things on diffeology in it becomes large enough for that to make sense <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 438108593,
        "sender_full_name": "Ben Eltschig",
        "timestamp": 1715433055
    },
    {
        "content": "<p>Fyi, the current situation is that I have a definition of diffeologies and the D-topology in terms of maps <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi mathvariant=\"double-struck\">R</mi><mi>n</mi></msup><mo>→</mo><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">\\R^n\\to X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span>, but haven't yet shown that those agree with the usual definitions in terms of maps <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>U</mi><mo>→</mo><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">U\\to X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span> for <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>U</mi><mo>⊆</mo><msup><mi mathvariant=\"double-struck\">R</mi><mi>n</mi></msup></mrow><annotation encoding=\"application/x-tex\">U\\subseteq\\R^n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">⊆</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span></span></span></span></span></span></span> open. That's what I'm currently working towards</p>",
        "id": 438108840,
        "sender_full_name": "Ben Eltschig",
        "timestamp": 1715433273
    },
    {
        "content": "<p>The D-topology has also been giving me trouble because it is in many cases different from the usual topology on a space, so I haven't been able to register it as an instance. Since mathlib doesn't really support non-standard topologies on a space, this means that it's currently a bit hard to work with</p>",
        "id": 438109052,
        "sender_full_name": "Ben Eltschig",
        "timestamp": 1715433500
    },
    {
        "content": "<p>I think things should be ready though to do some more abstract things like defining the category of diffeological spaces or the space of all smooth maps and the diffeology on it - so if that's something you want to go for, feel free to do so</p>",
        "id": 438109172,
        "sender_full_name": "Ben Eltschig",
        "timestamp": 1715433612
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"646363\">@Ben Eltschig</span> All sounds good - thanks for adding me to the repository :) .  When I get round to it, I will create my own branch and see what I can add - but yes most likely focusing on the abstract nonsense side of things (at least for now).</p>",
        "id": 438111545,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1715436106
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"646363\">Ben Eltschig</span> <a href=\"#narrow/stream/217875-Is-there-code-for-X.3F/topic/Diffeology/near/438109052\">said</a>:</p>\n<blockquote>\n<p>Since mathlib doesn't really support non-standard topologies on a space, this means that it's currently a bit hard to work with</p>\n</blockquote>\n<p>Presumably you should just define <code>Diffeological X := X</code>, and then put the D-topology on <code>Diffeological X</code> instead. Type synonyms are the usual approach here.</p>",
        "id": 438161207,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1715494301
    },
    {
        "content": "<p>I probably will also put the D-topology on a type synonym eventually, yes. I'm not sure if that completely solves the problem though - I also want to talk about nice spaces like <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi mathvariant=\"double-struck\">R</mi><mi>n</mi></msup></mrow><annotation encoding=\"application/x-tex\">\\R^n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span></span></span></span></span></span></span> as diffeological spaces after all, preferably without passing to a type synonym each time. My hope is that it will be possible to set things up in such a way that theorems involving the D-topology apply to both, or at least can be easily set up to have a variant for spaces on which the D-topology and the usual topology agree.</p>",
        "id": 438181551,
        "sender_full_name": "Ben Eltschig",
        "timestamp": 1715516879
    },
    {
        "content": "<p>You can have a typeclass <code>HasDTopology</code>, saying that the topology is equal to the D-topology (whatever the D-topology is). In lemmas, don't work with the type synonym, just with a generic type alpha with assumptions <code>[TopologicalSpace α] [HasDTopology α]</code>. And register instances that \\R^n or nice spaces satisfy <code>HasDTopology</code>, to make sure that your lemmas apply directly to these spaces. And define your type synonym in general, put the D-topology on it, and register the instance <code>HasDTopology</code> for the type synonym. In this way, everything should work smoothly.</p>",
        "id": 438185370,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1715521085
    },
    {
        "content": "<p>yep, that's the approach I'm currently going for <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 438185500,
        "sender_full_name": "Ben Eltschig",
        "timestamp": 1715521227
    },
    {
        "content": "<p>there's a few small annoyances still, like that I can't register <code>HasDTopology</code> on open subsets because openness is not information that's available to typeclass inference - but ultimately it's the most promising approach I've seen so far</p>",
        "id": 438185619,
        "sender_full_name": "Ben Eltschig",
        "timestamp": 1715521341
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Fact#doc\">docs#Fact</a> is useful here</p>",
        "id": 438187215,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1715522892
    },
    {
        "content": "<p>Instead of using a subset and the fact that it's open, you can use <code>U : Opens X</code>, which is open by definition, so typeclass inference can be used here.</p>",
        "id": 438191184,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1715526699
    },
    {
        "content": "<p>Over the past two weeks I got interested in diffeology for formalizing automatic differentiation. The problem is that types like <code>Option X</code>, <code>Array X</code> or <code>Sum X Y</code> are not vector spaces and <code>Array X</code> can't even be turned into a manifold. Therefore there is a need for something as general as diffeology.</p>\n<p>I have managed to write definition of diffeology, differentiable maps, tangent space, derivative and prove chain rule. For example I proved that <a href=\"https://github.com/lecopivo/SciLean/blob/74bec18145565a555490100354dd0a0dc31b5181/SciLean/Analysis/Diffeology/Sum.lean#L190\"><code>Sum.elim f g x</code></a> is differentiable. With arrays I still have few sorry but I have differentiability of <a href=\"https://github.com/lecopivo/SciLean/blob/74bec18145565a555490100354dd0a0dc31b5181/SciLean/Analysis/Diffeology/Array.lean#L232\"><code>get?</code></a>, <a href=\"https://github.com/lecopivo/SciLean/blob/74bec18145565a555490100354dd0a0dc31b5181/SciLean/Analysis/Diffeology/Array.lean#L407\"><code>setD</code></a> and <a href=\"https://github.com/lecopivo/SciLean/blob/74bec18145565a555490100354dd0a0dc31b5181/SciLean/Analysis/Diffeology/Array.lean#L315\"><code>append</code></a>.</p>\n<hr>\n<p>My main definition of <code>Diffelogy</code> is</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Diffeology</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">class</span><span class=\"w\"> </span><span class=\"n\">Diffeology</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">Plot</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span>\n<span class=\"w\">  </span><span class=\"n\">plotEval</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Plot</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"bp\">^</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">X</span>\n<span class=\"w\">  </span><span class=\"n\">plot_ext</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Plot</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">plotEval</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">plotEval</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">q</span>\n<span class=\"w\">  </span><span class=\"n\">plotComp</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Plot</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"bp\">^</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"bp\">^</span><span class=\"n\">n</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ContDiff</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">⊤</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Plot</span><span class=\"w\"> </span><span class=\"n\">m</span>\n<span class=\"w\">  </span><span class=\"n\">plotComp_eval</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Plot</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"bp\">^</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"bp\">^</span><span class=\"n\">n</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ContDiff</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">⊤</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"bp\">^</span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">plotEval</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">plotComp</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">plotEval</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">constPlot</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Plot</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"n\">constPlot_eval</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">plotEval</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">constPlot</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div>\n</div></div>\n<p>Few notes on this definition</p>\n<ul>\n<li>Most importantly it is missing the <a href=\"https://en.wikipedia.org/wiki/Diffeology#Formal_definition\">locality axiom</a>. So far I didn't need it so I didn't bother with it.</li>\n<li>Plots are maps from the whole ℝⁿ, again I didn't need them to be maps from open subsets of ℝⁿ so I didn't bother.</li>\n<li>I started with plots as a set i.e. <code>Set (ℝⁿ → X)</code>. I found this to be very difficult to work with. So <code>Diffeology</code> has to provide a type <code>Plot X n</code>, evaluation map <code>plotEval : Plot X n → (ℝⁿ → X)</code> and proof that this map is injective <code>plot_ext</code>.</li>\n</ul>\n<hr>\n<p>Definition of smooth map <code>DSmooth</code></p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>DSmooth</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">structure</span><span class=\"w\"> </span><span class=\"n\">DSmooth</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">ex_map_plot</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Plot</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Plot</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span>\n</code></pre></div>\n</div></div>\n<p>This is completely standard, smooth map is a map that maps plots to plots. It is formulated using <code>∃</code> so <code>DSmooth</code> lives in <code>Prop</code>.</p>\n<hr>\n<p>Definition of tangent space <code>TangentSpace</code></p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>TangentSpace</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">class</span><span class=\"w\"> </span><span class=\"n\">TangentSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Diffeology</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TX</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">outParam</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">))</span>\n<span class=\"w\">      </span><span class=\"o\">[</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TX</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TX</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"n\">where</span>\n\n<span class=\"w\">  </span><span class=\"n\">tangentMap</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Plot</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"bp\">^</span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ℝ</span><span class=\"bp\">^</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→ₗ</span><span class=\"o\">[</span><span class=\"n\">ℝ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">TX</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">Σ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">TX</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Plot</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"w\">  </span><span class=\"n\">tangentMap_const</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tangentMap</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">constPlot</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">⟩</span>\n<span class=\"w\">  </span><span class=\"n\">tangentMap_fst</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Plot</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"bp\">^</span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">tangentMap</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">u</span>\n<span class=\"w\">  </span><span class=\"n\">exp_at_zero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">xdx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">Σ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">TX</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"n\">xdx</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">xdx</span><span class=\"bp\">.</span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"n\">tangentMap_exp_at_zero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">xdx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">Σ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">TX</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tangentMap</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"n\">xdx</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">duality</span><span class=\"w\"> </span><span class=\"n\">xdx</span>\n</code></pre></div>\n</div></div>\n<p>As far as I'm aware there is no go to definition of tangent space, I skimmed through the paper <a href=\"https://arxiv.org/abs/1411.5425\">Tangent spaces and tangent bundles for diffeological spaces</a> and then just rolled my own definition of a tangent space that works for my purposes. (I'm not sure if it aligns with the definition from that paper)</p>\n<p>Keys points</p>\n<ul>\n<li>There are two pieces of data: <code>tangentMap</code> which compute the tangent for a plot and <code>exp</code> which for a given tangent vector provides a curve that passes through that tangent vector.</li>\n<li>This definition won't work well with taking subsets and quotients of <code>X</code> and I'm not sure how to remedy that.</li>\n</ul>\n<hr>\n<p>The normal definition of smooth map does not seem to be sufficient when working with this tangent space. Therefore I defined <code>TSSmooth</code> which is a map that preserves plots <strong>and</strong> <code>tangentMap</code> does not depend on the particular plot(which is effectively saying that the chain rule holds)</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>TSSmooth</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">structure</span><span class=\"w\"> </span><span class=\"n\">TSSmooth</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kd\">extends</span><span class=\"w\"> </span><span class=\"n\">DSmooth</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">plot_independence</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Plot</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"bp\">^</span><span class=\"n\">n</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tangentMap</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">tangentMap</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">tangentMap</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">=</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">tangentMap</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span>\n</code></pre></div>\n</div></div>\n<hr>\n<p>What I would like to do next:</p>\n<ul>\n<li>Provide more theorems for all the basic types like <code>Option</code>, <code>Array</code>, <code>Prod</code>, <code>Sum</code> and figure out how to make all the proofs less painful.</li>\n<li>Prove that types with <code>Diffeology</code> form Cartesian closed category with <code>DSmooth</code> morphisms. Does the same hold for types with <code>TangentSpace</code> and <code>TSSmooth</code> morphisms?  </li>\n<li>Define connection which would allow to talk about dependently typed smooth function. This seems to be necessary when we want to talk about cartesian closedness of types with <code>TangentSpace</code>.  I have some experiments in this direction, I tried to define something like <a href=\"https://en.wikipedia.org/wiki/Ehresmann_connection\"><code>Ehresmann connection</code></a> in this <a href=\"https://github.com/lecopivo/SciLean/blob/74bec18145565a555490100354dd0a0dc31b5181/SciLean/Analysis/Diffeology/Connection.lean#L11\">file</a> but I got lost in the smoothness requirements of the lifting function.</li>\n</ul>\n<p>Any feedback is welcome. Also I would be happy to guide anyone who would be interested in working on this as I should probably focus on other thing in the near future.</p>",
        "id": 481511267,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1731201082
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"646363\">@Ben Eltschig</span>, how far did you get in the definitions?</p>",
        "id": 481546197,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1731232430
    },
    {
        "content": "<p>I checked Ben's GitHub and he is much much further in terms of diffeology itself. But I didn't find anything on tangent spaces so I worked with a simplified definition of diffeology to see if I can proof stuff I need for automatic differentiation. I should probably redo it and build it on top of Ben's work.</p>",
        "id": 481552555,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1731237606
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"346070\">@Tomas Skrivan</span> thank you Tomas, this is something I'll be using as you develop it. P.S. take a look at the diffeology synopsis <a href=\"https://arxiv.org/pdf/2312.16301\">here</a>.</p>",
        "id": 481824123,
        "sender_full_name": "Dean Young",
        "timestamp": 1731365878
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"346070\">Tomas Skrivan</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Diffeology/near/481552555\">said</a>:</p>\n<blockquote>\n<p>I checked Ben's GitHub and he is much much further in terms of diffeology itself. But I didn't find anything on tangent spaces so I worked with a simplified definition of diffeology to see if I can proof stuff I need for automatic differentiation. I should probably redo it and build it on top of Ben's work.</p>\n</blockquote>\n<p>I indeed haven't done anything with tangent spaces yet, in part because I so far didn't need them and in part because the many different definitions left me a bit unsure about which definition to pick. The internal tangent space seems promising though, so I might give formalising that a try soon.</p>",
        "id": 481973106,
        "sender_full_name": "Ben Eltschig",
        "timestamp": 1731424690
    },
    {
        "content": "<p>I'm also not sure I understand your current approach to tangent spaces correctly - given a family <code>TX : X → Type w</code> of real vector spaces on a diffeological space, you define a tangent space structure on them as a choice of tangent map for each plot and curve for each tangent vector, satisfying some conditions? This seems very non-canonical, in that (even the choices of curves aside) there are probably many such structures for each <code>TX</code>, and also many different <code>TX</code> for which such structures can be found - for example, letting all tangent spaces be trivial works for any <code>X</code>. So there is a lot of data being carried around, which I assume would lead to both bad categorical properties and potentially instance diamonds.</p>",
        "id": 481984104,
        "sender_full_name": "Ben Eltschig",
        "timestamp": 1731427470
    },
    {
        "content": "<p>For the use cases you have in mind, is it important that you can pick a specific family of vector spaces as the tangent spaces, rather than working with uniformly defined ones? I can see that for example having the tangent spaces of a vector space  <code>V</code> be equal to <code>V</code> instead of just isomorphic to it would be convenient - but if you add that as an instance, you already can't add tangent space instances for finite products anymore without causing there to be two different tangent space structures on a product <code>V ⨯ W</code> of vector spaces.</p>",
        "id": 481985857,
        "sender_full_name": "Ben Eltschig",
        "timestamp": 1731427937
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"646363\">Ben Eltschig</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Diffeology/near/481984104\">said</a>:</p>\n<blockquote>\n<p>I'm also not sure I understand your current approach to tangent spaces correctly - given a family <code>TX : X → Type w</code> of real vector spaces on a diffeological space, you define a tangent space structure on them as a choice of tangent map for each plot and curve for each tangent vector, satisfying some conditions? This seems very non-canonical, in that (even the choices of curves aside) there are probably many such structures for each <code>TX</code>, and also many different <code>TX</code> for which such structures can be found - for example, letting all tangent spaces be trivial works for any <code>X</code>. So there is a lot of data being carried around, which I assume would lead to both bad categorical properties and potentially instance diamonds.</p>\n</blockquote>\n<p>I just wrote down the minimal definition that allowed me to to the calculus I want without worrying too much about canonicity. All the instances I added were tangent spaces for unions of manifolds where I want the tangent space be just the tangent space of the individual manifolds. I have no idea happens for quotients and subsets and my definition is probably does not work.</p>",
        "id": 482243167,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1731525473
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"646363\">Ben Eltschig</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Diffeology/near/481985857\">said</a>:</p>\n<blockquote>\n<p>For the use cases you have in mind, is it important that you can pick a specific family of vector spaces as the tangent spaces, rather than working with uniformly defined ones? I can see that for example having the tangent spaces of a vector space  <code>V</code> be equal to <code>V</code> instead of just isomorphic to it would be convenient - but if you add that as an instance, you already can't add tangent space instances for finite products anymore without causing there to be two different tangent space structures on a product <code>V ⨯ W</code> of vector spaces.</p>\n</blockquote>\n<p>This is already problem for diffeology itself, right? So not specific to a tangent spaces. I would do the same thing as you did and define analogues for yours <code>euclideanDiffeology</code> and <code>ContDiffCompatible</code> that talk about tangent spaces. This is a fundamental issue that does not really depend on a particular definition of the tangent spaces, no?</p>",
        "id": 482245025,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1731526152
    },
    {
        "content": "<p>Right, the diffeology instances already run into trouble like that.</p>",
        "id": 482245381,
        "sender_full_name": "Ben Eltschig",
        "timestamp": 1731526273
    },
    {
        "content": "<p>My hope was to keep the need for classes like <code>ContDiffCompatible</code> and <code>DTopCompatible</code> to a minimum - having to rewrite the topology from time to time using the <code>DTopCompatible</code> instance is already cumbersome, and I imagine it gets worse when the thing you're rewriting is types like the tangent spaces rather than just terms like topologies</p>",
        "id": 482245908,
        "sender_full_name": "Ben Eltschig",
        "timestamp": 1731526478
    },
    {
        "content": "<p>I did try implementing the internal tangent space from <a href=\"https://arxiv.org/abs/1411.5425\">Tangent spaces and tangent bundles for diffeological spaces</a> by the way, and it went better than I expected - it's not on github yet because I'm not yet done constructing the tangent maps, but I'm optimistic tangent spaces could be implemented for all diffeological spaces in that way without any extra instances. I don't know how workable this would be for practical computations, but it does seem like the right way to go about this mathematically at least</p>",
        "id": 482247374,
        "sender_full_name": "Ben Eltschig",
        "timestamp": 1731526994
    },
    {
        "content": "<p>I would be interested in having a look at that code! </p>\n<p>How would you state Cartesian Closedness for diffeological spaces with tangent spaces? </p>\n<p>What is the tangent space of <code>DSmoothMap X Y</code> at <code>f</code>? It should be a subset of <code>(x : X) → TX (f x)</code> but also a smooth map in some sense.</p>",
        "id": 482248143,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1731527302
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 482248201,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1731527329
    },
    {
        "content": "<p>I wouldn't consider diffeological spaces with tangent spaces as a new category at all, since the internal tangent space can be defined for all diffeological spaces and without any extra data. I haven't thought about the case of mapping spaces yet, but the linked paper for example mentions that the tangent space of the diffeomorphism group of a manifold <code>M</code> at the identity turns out to be the set of smooth vector fields on <code>M</code>, so it does seem to give a reasonable result in that case at least</p>",
        "id": 482249943,
        "sender_full_name": "Ben Eltschig",
        "timestamp": 1731527998
    },
    {
        "content": "<p>This is the code I have so far - it's all still relatively abstract, but should be a concrete way of writing the colimit that the internal tangent spaces are defined as. I'm guessing the hardest part will be to show that in the case of vector spaces this actually gives the space itself; after that, showing that it gives the right space for manifolds shouldn't be too hard<br>\n<a href=\"https://github.com/peabrainiac/lean-orbifolds/blob/main/Orbifolds/Diffeology/TangentSpace.lean\">https://github.com/peabrainiac/lean-orbifolds/blob/main/Orbifolds/Diffeology/TangentSpace.lean</a></p>",
        "id": 482251667,
        "sender_full_name": "Ben Eltschig",
        "timestamp": 1731528572
    },
    {
        "content": "<p>I see, for my purposes I need a good type for the tangent space such that I get reasonable code to run. But I can solve this by adding a new typeclass that allows me to have a control over the precise type of the tangent space</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">TangentSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DiffeologicalSpace</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TX</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">outParam</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TX</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TX</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">tequiv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TX</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">≃ₗ</span><span class=\"o\">[</span><span class=\"n\">ℝ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">internalTangentSpace</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div>",
        "id": 482253409,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1731529168
    },
    {
        "content": "<p>Yep, that's pretty much what I was thinking too <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 482253666,
        "sender_full_name": "Ben Eltschig",
        "timestamp": 1731529251
    },
    {
        "content": "<p>I like this!</p>",
        "id": 482253698,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1731529264
    },
    {
        "content": "<p>I think the first two PRs upstreaming bits of diffeology from my repo to mathlib should be more or less ready for review now - <a href=\"https://github.com/leanprover-community/mathlib4/pull/21969\">#21969</a> adds very basic definitions (diffeologies, plots, smooth maps etc.) while <a href=\"https://github.com/leanprover-community/mathlib4/pull/22724\">#22724</a> defines the diffeology generated from a set of plots and uses it to construct a <code>CompleteLattice</code>-instance on <code>DiffeologicalSpace X</code>. I say more or less because I've hesitated on PRing this for a while now out of fear it still isn't good enough, but figured it probably won't get much better either without external feedback, so here we are <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 504349581,
        "sender_full_name": "Ben Eltschig",
        "timestamp": 1741492834
    },
    {
        "content": "<p>Since we have multiple people interested in diffeology in this thread, maybe someone wants to leave a review? I'm relatively confident about the general API design by now, but less so about specifics like naming and which arguments of lemmas should be made explicit/implicit. Of course, if you have some opinions about the general API design too though I'm also curious about hearing those - that's probably where the really interesting conversation happens.</p>",
        "id": 504350603,
        "sender_full_name": "Ben Eltschig",
        "timestamp": 1741493683
    }
]