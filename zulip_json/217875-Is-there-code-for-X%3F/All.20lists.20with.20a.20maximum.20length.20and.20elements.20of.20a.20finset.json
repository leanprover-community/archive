[
    {
        "content": "<p>Hi,<br>\nI am looking for a function of the form <code>def generateAll (X : Finset A) (n : ℕ) : Finset (List A) </code> that fulfills the following property </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">generateAll_def</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l'</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">):</span>\n<span class=\"w\">    </span><span class=\"n\">l'</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">generateAllX</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">l'</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">l'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>It would also be fine if X is a list instead of a finite set. Do we have anything like that?</p>",
        "id": 519194373,
        "sender_full_name": "Johannes Tantow",
        "timestamp": 1747680252
    },
    {
        "content": "<p>is this almost <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Finset.powersetCard#doc\">docs#Finset.powersetCard</a> ?</p>",
        "id": 519201211,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747682216
    },
    {
        "content": "<p>Kind of.  The powerset can be larger, which I can filter out,but the lists are allowed to contain duplicates in my case.</p>",
        "id": 519201536,
        "sender_full_name": "Johannes Tantow",
        "timestamp": 1747682308
    },
    {
        "content": "<p>How's this, via <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Vector.fintype#doc\">docs#Vector.fintype</a> ?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">generateAll</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">Vector</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span>\n<span class=\"w\">    </span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">subtype</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">⟨_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">map_injective_iff</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">val_injective</span><span class=\"bp\">⟩</span>\n</code></pre></div>",
        "id": 519202262,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747682525
    },
    {
        "content": "<p>Ah, I guess that's only the ones of fixed length</p>",
        "id": 519202356,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747682562
    },
    {
        "content": "<p>But you could take the <code>disjiUnion</code> over all <code>i &lt;= n</code></p>",
        "id": 519202421,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747682583
    },
    {
        "content": "<p>The normal union should suffice as well for this as A is decidable. I'll build Mathlib and test that. Thanks</p>",
        "id": 519203742,
        "sender_full_name": "Johannes Tantow",
        "timestamp": 1747682966
    },
    {
        "content": "<p>disjiUnion will be much faster to execute and kernel reduce</p>",
        "id": 519206362,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747683688
    },
    {
        "content": "<p>But also it might be easier to implement this from scratch rather than via my suggestion above!</p>",
        "id": 519206568,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747683739
    },
    {
        "content": "<p>I don't really want to execute this and only need this to show decidability. disjUnion wants me to prove disjointness</p>",
        "id": 519206649,
        "sender_full_name": "Johannes Tantow",
        "timestamp": 1747683762
    },
    {
        "content": "<p>I tried this before from scratch by recursion, but didn't find a good way to combine the elements of the lists with the finset of lists with length le m-1.</p>",
        "id": 519206827,
        "sender_full_name": "Johannes Tantow",
        "timestamp": 1747683818
    },
    {
        "content": "<p>Either you prove the disjointness now, or you'll find you probably need it later</p>",
        "id": 519206873,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747683832
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"619540\">Johannes Tantow</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/All.20lists.20with.20a.20maximum.20length.20and.20elements.20of.20a.20finset/near/519206827\">said</a>:</p>\n<blockquote>\n<p>I tried this before from scratch by recursion, but didn't find a good way to combine the elements of the lists with the finset of lists with length le m-1.</p>\n</blockquote>\n<p>Probably you should start with lists:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">generateAll</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">[[]]</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">last</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">generateAll</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">    </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"bp\">.</span><span class=\"n\">flatMap</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">last</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">ls</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">ls</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">generateAll</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">```</span>\n<span class=\"n\">and</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"o\">:</span>\n<span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">permuting</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">input</span><span class=\"w\"> </span><span class=\"n\">permutes</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">output</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">multisets</span><span class=\"o\">)</span>\n<span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">input</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">duplicate</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">nor</span><span class=\"w\"> </span><span class=\"n\">does</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">output</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">finsets</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 519207834,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747684106
    },
    {
        "content": "<p>I can also work with lists directly, but I thought the other form might be more general</p>",
        "id": 519208151,
        "sender_full_name": "Johannes Tantow",
        "timestamp": 1747684198
    },
    {
        "content": "<p>so that it would exist already somewhere</p>",
        "id": 519208242,
        "sender_full_name": "Johannes Tantow",
        "timestamp": 1747684213
    },
    {
        "content": "<p><del>Unfortunately my code above doesn't actually work, it creates duplicates!</del> fixed</p>",
        "id": 519208253,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747684216
    },
    {
        "content": "<p>But usually the pattern with these combinatorial constructions is to build them for Lists, then Multiset, then Finset</p>",
        "id": 519208316,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747684236
    },
    {
        "content": "<p>Since often it actually is useful to have the \"less general\" version</p>",
        "id": 519208359,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747684250
    },
    {
        "content": "<p>eg <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.sublists#doc\">docs#List.sublists</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Multiset.powerset#doc\">docs#Multiset.powerset</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Finset.powerset#doc\">docs#Finset.powerset</a></p>",
        "id": 519208445,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747684279
    },
    {
        "content": "<p>For instance, with my definition above, you could prove that if <code>l</code> is sorted then <code>generateAll  l 2</code> is sorted lexicographically</p>",
        "id": 519208943,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747684422
    },
    {
        "content": "<p>Thanks, I managed to prove my result now.</p>",
        "id": 519212103,
        "sender_full_name": "Johannes Tantow",
        "timestamp": 1747685323
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"619540\">Johannes Tantow</span> <a href=\"#narrow/stream/217875-Is-there-code-for-X.3F/topic/All.20lists.20with.20a.20maximum.20length.20and.20elements.20of.20a.20finset/near/519203742\">said</a>:</p>\n<blockquote>\n<p>The normal union should suffice as well for this as A is decidable. I'll build Mathlib and test that. Thanks</p>\n</blockquote>\n<p>Just to check -- you didn't mean \"I'll spend at least an hour building mathlib on my computer because I don't know about <code>lake exe cache get</code> which downloads compiled binaries\" do you?</p>",
        "id": 519290817,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1747716895
    },
    {
        "content": "<p>I theoretically know that, but didn't think of that in the moment and just pressed reload files and started the process</p>",
        "id": 519291363,
        "sender_full_name": "Johannes Tantow",
        "timestamp": 1747717225
    }
]