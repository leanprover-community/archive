[
    {
        "content": "<p>In the effort to avoid both non-terminal simps and messy/fragile long <code>simp only [...]</code>s, it'd be cool to be able to say in one command \"<code>simp at h; simp [h]</code>\" with <code>h</code> specifically. I know <code>simp_all</code> can do that, but afaik it tries _all_ hypotheses which is often not desired. Is there a config or secret tactic that already does this?</p>",
        "id": 502677694,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1740781646
    },
    {
        "content": "<p><code>simp [by simpa using h]</code>?</p>",
        "id": 502677802,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1740781689
    },
    {
        "content": "<p>.... Guess that counts. Thanks!</p>",
        "id": 502677830,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1740781702
    },
    {
        "content": "<p>Hmm, that's clever, but I'm not sure this counts as avoiding a non-terminal simp!</p>",
        "id": 502682437,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1740784121
    },
    {
        "content": "<p>It's still fragile since there's not a checkpoint for the simplified type.</p>\n<p>Best would be</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">theType</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">this</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>but my opinion is that <code>simp at h; simp [h]</code> isn't any worse than <code>simp_all</code>.</p>",
        "id": 502682728,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1740784321
    },
    {
        "content": "<p><code>simp [show theType by simpa using h]</code></p>",
        "id": 502750623,
        "sender_full_name": "Jz Pan",
        "timestamp": 1740838741
    },
    {
        "content": "<p>In my opinion, I want to use <code>simp at h; simp [h]</code> quite often as a finishing tactic, and it seems pretty innocent to me. It's pretty maintainable, since most things that simplify <code>h</code> also simplify the goal. <br>\nIt's often more useful than <code>simpa using h</code>, since it can use <code>h</code> to rewrite subterms of the goal. And unlike <code>simpa using h</code>, it doesn't do an assumption up to defeq, which itself is very brittle, and can break proofs by adding more simp-lemmas.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"c1\">-- simpa brittleness</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"c1\">-- works</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo_iff</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">â†”</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"c1\">-- fails</span>\n</code></pre></div>",
        "id": 503194342,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1741071681
    },
    {
        "content": "<p>Maybe <code>simp_all</code>?</p>",
        "id": 503204168,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1741075998
    }
]