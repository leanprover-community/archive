[
    {
        "content": "<p>For pedagogical reasons, I'd like to show what term has been created by a call of <code>fun_prop</code>, in the same vein as one could do <code>continuity?</code>, but <code>fun_prop?</code> does not exist (and <code>show_term{fun_prop}</code> does not work). Is there a workaround?</p>",
        "id": 543961974,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1760016877
    },
    {
        "content": "<p>do you have a mwe for \"<code>show_term fun_prop</code> doesn't work\"?</p>",
        "id": 543962632,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760017037
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Topology</span><span class=\"bp\">.</span><span class=\"n\">Continuous</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">SpecialFunctions</span><span class=\"bp\">.</span><span class=\"n\">Trigonometric</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Continuous</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">sin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">show_term</span><span class=\"o\">{</span><span class=\"n\">fun_prop</span><span class=\"o\">}</span>\n</code></pre></div>",
        "id": 543962837,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1760017089
    },
    {
        "content": "<p>I get</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">found</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">corresponding</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">expose_names</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Continuous</span><span class=\"bp\">.</span><span class=\"n\">comp'</span><span class=\"w\"> </span><span class=\"n\">continuous_sin</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Continuous</span><span class=\"bp\">.</span><span class=\"n\">comp'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Continuous</span><span class=\"bp\">.</span><span class=\"n\">mul</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Continuous</span><span class=\"bp\">.</span><span class=\"n\">fst</span><span class=\"w\"> </span><span class=\"n\">continuous_id'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Continuous</span><span class=\"bp\">.</span><span class=\"n\">snd</span><span class=\"w\"> </span><span class=\"n\">continuous_id'</span><span class=\"o\">))</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">Continuous</span><span class=\"bp\">.</span><span class=\"n\">prodMk</span><span class=\"w\"> </span><span class=\"n\">continuous_const</span><span class=\"w\"> </span><span class=\"n\">continuous_id'</span><span class=\"o\">)))</span>\n\n<span class=\"n\">It</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">possible</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">correct</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">adding</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">annotations</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">explicitly</span><span class=\"w\"> </span><span class=\"n\">specifying</span><span class=\"w\"> </span><span class=\"n\">implicit</span><span class=\"w\"> </span><span class=\"n\">arguments</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">eliminating</span><span class=\"w\"> </span><span class=\"n\">unnecessary</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">abstractions</span><span class=\"bp\">.</span>\n</code></pre></div>",
        "id": 543962919,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1760017110
    },
    {
        "content": "<p>you might say that the term is somewhat hidden there, but not in a nice, clickable form</p>",
        "id": 543963015,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1760017136
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Topology</span><span class=\"bp\">.</span><span class=\"n\">Continuous</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">SpecialFunctions</span><span class=\"bp\">.</span><span class=\"n\">Trigonometric</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Real</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Continuous</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">sin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"bp\">?</span>\n<span class=\"w\">  </span><span class=\"n\">fun_prop</span>\n</code></pre></div>",
        "id": 543963118,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760017163
    },
    {
        "content": "<p>WOWOW, the <code>by?</code> was totally unknown to me. Thanks!</p>",
        "id": 543963241,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1760017196
    },
    {
        "content": "<p>Is it documented somewhere?</p>",
        "id": 543963304,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1760017208
    },
    {
        "content": "<p>... it still doesn't work, it just doesn't tell you beforehand</p>",
        "id": 543963360,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1760017222
    },
    {
        "content": "<p>Try <code>set_option pp.analyze true</code></p>",
        "id": 543963383,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1760017228
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Topology</span><span class=\"bp\">.</span><span class=\"n\">Continuous</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">SpecialFunctions</span><span class=\"bp\">.</span><span class=\"n\">Trigonometric</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Real</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Continuous</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">sin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">pp</span><span class=\"bp\">.</span><span class=\"n\">analyze</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"w\">  </span><span class=\"n\">show_term</span><span class=\"w\"> </span><span class=\"n\">fun_prop</span>\n</code></pre></div>\n<p>works</p>",
        "id": 543963632,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1760017300
    },
    {
        "content": "<p>that sounds like an implementation detail that shouldn't appear...</p>",
        "id": 543963639,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760017301
    },
    {
        "content": "<p>Yes, with this it indeed works because it adds the type annotation of the identity function</p>",
        "id": 543963655,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1760017306
    },
    {
        "content": "<p>can we toggle this option on by default when calling <code>by?</code> or <code>show_term</code>?</p>",
        "id": 543963744,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760017329
    },
    {
        "content": "<p>This would be great, yes.</p>",
        "id": 543963818,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1760017349
    },
    {
        "content": "<p>(for my class, I can just hide the <code>set_option</code> at the very beginning of the file and mumble something about it being \" like an import\", but it is suboptimal)</p>",
        "id": 543963988,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1760017397
    },
    {
        "content": "<p><code>set_option trace.Meta.Tactic.fun_prop true</code></p>\n<p>allows you to follow what is used</p>",
        "id": 543966485,
        "sender_full_name": "ZhiKai Pong",
        "timestamp": 1760017977
    },
    {
        "content": "<p>You can do</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Topology</span><span class=\"bp\">.</span><span class=\"n\">Continuous</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">SpecialFunctions</span><span class=\"bp\">.</span><span class=\"n\">Trigonometric</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Real</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Continuous</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">sin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">fun_prop</span>\n\n<span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n</code></pre></div>",
        "id": 543969662,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1760018687
    },
    {
        "content": "<p>Hmm, copying/pasting the proof doesn't work, it's probably the same output as <code>by?</code></p>",
        "id": 543969888,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1760018742
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"890057\">ZhiKai Pong</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/fun_prop.3F/near/543966485\">said</a>:</p>\n<blockquote>\n<p>set_option trace.Meta.Tactic.fun_prop true</p>\n</blockquote>\n<p>Yes, this I knew, but it is way less efficient than <code>by?</code> ( with the right option), because you cannot click. Thanks anyway!</p>",
        "id": 543976253,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1760020133
    },
    {
        "content": "<p>Yeah, I think those are all the same thing</p>",
        "id": 543985412,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1760022320
    }
]