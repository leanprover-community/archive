[
    {
        "content": "<p>Is there an <code>instance [Preorder α] : Preorder (List α)</code> where <code>xs ≤ ys</code> iff <code>xs.length = ys.length</code> and where <code>xs[i] ≤ ys[i]</code> for all <code>0 ≤ i &lt; xs.length</code>?</p>\n<p>I have found <a href=\"https://leanprover-community.github.io/mathlib4_docs/Batteries/Data/List/Basic.html#List.Forall%E2%82%82\">List.Forall₂</a>, which can be used to define ≤ for this preorder, as follows:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LE</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LE</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">le</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Forall₂</span><span class=\"w\"> </span><span class=\"n\">LE</span><span class=\"bp\">.</span><span class=\"n\">le</span>\n</code></pre></div>\n<p>In order to extend this to a preorder on <code>List α</code>, we need to show reflexivity and transitivity. Reflexivity can be obtained by <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/List/Forall2.html#List.forall%E2%82%82_refl\">List.forall₂_refl</a>, but I can't seem to find a corresponding result <code>List.forall₂_trans</code> for transitivity. Should this be added to Mathlib?</p>\n<p>It should be noted that this preorder on <code>List α</code> is a very natural one, since it it makes <code>List α</code> exactly the free monoid generated by <code>α</code> in the category of preorders and monotone functions.</p>",
        "id": 498303899,
        "sender_full_name": "Albus Dompeldorius",
        "timestamp": 1738923125
    },
    {
        "content": "<p>The appropriate preorder already exists on <code>Fin n → α</code>. If  <code>xs : List α</code> then <code>xs.get</code> has type <code>Fin xs.length → α</code> so I guess some rewriting would be required to compare <code>xs.get</code> to <code>ys.get</code>. On the other hand if you work with <code>xs : Vector α n</code> then <code>xs.get : Fin n → α</code> and you don't have the problem.<br>\n.</p>",
        "id": 498327939,
        "sender_full_name": "A.",
        "timestamp": 1738930868
    },
    {
        "content": "<p>It looks like Lean is going to default to lexicographic order on <code>List</code> itself. <a href=\"https://github.com/leanprover/lean4/blob/1248a55d32f5fc64c7a26cd606fdf4c2908ce09c/src/Init/Data/List/Basic.lean#L163\">https://github.com/leanprover/lean4/blob/1248a55d32f5fc64c7a26cd606fdf4c2908ce09c/src/Init/Data/List/Basic.lean#L163</a></p>",
        "id": 498329378,
        "sender_full_name": "A.",
        "timestamp": 1738931321
    },
    {
        "content": "<p>Thanks! That seems like what I'm looking for. I have an idea, it should be possible to define an isomorphism between <code>List α</code> and the disjoint sum of <code>Fin n → α</code> for all <code>n ∈ ℕ</code>. (A sigma type, I think). Then we can use <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Sigma/Order.html#Sigma.preorder\">Sigma.preorder</a>, to give the latter a preorder structure, which can be pulled back to <code>List α</code>. Does that make sense?</p>",
        "id": 498331321,
        "sender_full_name": "Albus Dompeldorius",
        "timestamp": 1738931937
    },
    {
        "content": "<p>Oh, I found this: <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/List/OfFn.html#List.equivSigmaTuple\">List.equivSigmaTuple</a>. This seems promising!</p>",
        "id": 498333610,
        "sender_full_name": "Albus Dompeldorius",
        "timestamp": 1738932687
    },
    {
        "content": "<p>Update: I managed to define the preorder as follows:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">OfFn</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Sigma</span><span class=\"bp\">.</span><span class=\"n\">Order</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">PointwisePreorder</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Preorder</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Preorder</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Preorder</span><span class=\"bp\">.</span><span class=\"n\">lift</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">equivSigmaTuple</span><span class=\"bp\">.</span><span class=\"n\">toFun</span>\n</code></pre></div>",
        "id": 498340993,
        "sender_full_name": "Albus Dompeldorius",
        "timestamp": 1738934967
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816999\">Albus Dompeldorius</span> <a href=\"#narrow/stream/217875-Is-there-code-for-X.3F/topic/Is.20there.20an.20element-wise.20instance.20of.20Preorder.20.28List.20.CE.B1.29.3F/near/498303899\">said</a>:</p>\n<blockquote>\n<p>but I can't seem to find a corresponding result <code>List.forall₂_trans</code> for transitivity. Should this be added to Mathlib?</p>\n</blockquote>\n<p>Yes, I think this ought to exist</p>",
        "id": 498359810,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1738940465
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Is.20there.20an.20element-wise.20instance.20of.20Preorder.20.28List.20.CE.B1.29.3F/near/498359810\">said</a>:</p>\n<blockquote>\n<p>Yes, I think this ought to exist</p>\n</blockquote>\n<p>Here is my attempt. It seems to work.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">forall₂_trans</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsTrans</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">Forall₂</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Forall₂</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Forall₂</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">c</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Forall₂</span><span class=\"bp\">.</span><span class=\"n\">nil</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Forall₂</span><span class=\"bp\">.</span><span class=\"n\">nil</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Forall₂</span><span class=\"bp\">.</span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"n\">ha0</span><span class=\"w\"> </span><span class=\"n\">h0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Forall₂</span><span class=\"bp\">.</span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"n\">ha1</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">constructor</span>\n<span class=\"w\">    </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">IsTrans</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">ha0</span><span class=\"w\"> </span><span class=\"n\">ha1</span>\n<span class=\"w\">    </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">forall₂_trans</span><span class=\"w\"> </span><span class=\"n\">h0</span><span class=\"w\"> </span><span class=\"n\">h1</span>\n</code></pre></div>",
        "id": 498367550,
        "sender_full_name": "Albus Dompeldorius",
        "timestamp": 1738942542
    }
]