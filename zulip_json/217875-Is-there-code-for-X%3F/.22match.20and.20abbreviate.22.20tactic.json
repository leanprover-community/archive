[
    {
        "content": "<p>I want a tactic for abbreviation. I am aware of the \"let\" and \"set ... with\" tactics, but they are not as easy to use as I expected. The main difficulty is that we need to write a term by hand. However, in the case that there are implicit parameters in the goal, it is not easy to write out the whole term precisely. </p>\n<p>Ideally, I would like some tactic called \"match_abbrev\", which does the following:</p>\n<p>If the goal looks like:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">assums</span>\n<span class=\"bp\">|-</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>We are able to write <code>match_abbrev  (P a)</code>,</p>\n<p>It will automatically match the variable name <code>a</code> to the term <code>f x</code>, and put in the assumption that <code>a = f x</code>, with an annotation of the type of <code>a</code>.</p>\n<p>Is there such a thing? (The thing exists in HOL4, so I do not think this is unrealistic. But if it is indeed is, then I would like to know the reason...)</p>",
        "id": 525142154,
        "sender_full_name": "Yiming Xu",
        "timestamp": 1750494981
    },
    {
        "content": "<p>Recent changes to <code>change</code> make this technically possible, if somewhat ugly; in your example, we can write</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">change</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">?</span><span class=\"n\">fx</span><span class=\"o\">)</span>\n<span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">fx</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">fx</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">hfx</span>\n</code></pre></div>\n<p>and this will work as long as the <code>change</code> statement itself elaborates properly. (In cases where there are many implicit/typeclass arguments like you suggest, this sometimes fails or requires more explicit values, but often that can be avoided by just going 'up' in the expression tree a couple of nodes to something less parameterized.)</p>",
        "id": 525142920,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1750495981
    },
    {
        "content": "<p>Isn't there a tactic called something like <code>generalize</code>? Maybe this is what you want?</p>",
        "id": 525155397,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1750508152
    },
    {
        "content": "<p>In your example, is <code>a</code> already in the context or is <code>a</code> supposed to be a fresh variable?</p>",
        "id": 525155483,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1750508261
    },
    {
        "content": "<p>Thanks to all of you!</p>",
        "id": 525160371,
        "sender_full_name": "Yiming Xu",
        "timestamp": 1750514080
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"359992\">Robert Maxton</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/.22match.20and.20abbreviate.22.20tactic/near/525142920\">said</a>:</p>\n<blockquote>\n<p>Recent changes to <code>change</code> make this technically possible, if somewhat ugly; in your example, we can write</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">change</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">?</span><span class=\"n\">fx</span><span class=\"o\">)</span>\n<span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">fx</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">fx</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">hfx</span>\n</code></pre></div>\n<p>and this will work as long as the <code>change</code> statement itself elaborates properly. (In cases where there are many implicit/typeclass arguments like you suggest, this sometimes fails or requires more explicit values, but often that can be avoided by just going 'up' in the expression tree a couple of nodes to something less parameterized.)</p>\n</blockquote>\n<p>This seems to be what I am looking for. Now I have a scary question: How recent is the change...? I would like to figure out if I have to update Lean to use it.</p>",
        "id": 525160429,
        "sender_full_name": "Yiming Xu",
        "timestamp": 1750514127
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/.22match.20and.20abbreviate.22.20tactic/near/525155397\">said</a>:</p>\n<blockquote>\n<p>Isn't there a tactic called something like <code>generalize</code>? Maybe this is what you want?</p>\n</blockquote>\n<p>Thanks! I think this is not what I want because I do not want to generalize a big term into a variable. So I am not proving a stronger statement. Just want a syntactic abbreviation.</p>",
        "id": 525160511,
        "sender_full_name": "Yiming Xu",
        "timestamp": 1750514222
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/.22match.20and.20abbreviate.22.20tactic/near/525155483\">said</a>:</p>\n<blockquote>\n<p>In your example, is <code>a</code> already in the context or is <code>a</code> supposed to be a fresh variable?</p>\n</blockquote>\n<p>It should be a fresh variable. It should not apply if <code>a</code> is already in the context because it aims to use a fresh variable to abbreviate the current term.</p>",
        "id": 525160555,
        "sender_full_name": "Yiming Xu",
        "timestamp": 1750514271
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"776892\">Yiming Xu</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/.22match.20and.20abbreviate.22.20tactic/near/525160511\">said</a>:</p>\n<blockquote>\n<p>So I am not proving a stronger statement.</p>\n</blockquote>\n<p>The <code>generalize h : f x = a</code> tactic in this context would add <code>h : f x = a</code> to the local context, so you wouldn't be proving a stronger statement. It might even work writing <code>generalize h : f _  = a</code>.</p>",
        "id": 525167200,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1750521829
    },
    {
        "content": "<p>There's a tactic that was under development (<code>setm</code>, <a href=\"https://github.com/leanprover-community/mathlib4/pull/7890\">#7890</a>) that would do something slightly different. With it, if you were to write <code>setm P ?a</code>, you would get <code>a := f x</code> in the local context.</p>",
        "id": 525167338,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1750522008
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"776892\">Yiming Xu</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/.22match.20and.20abbreviate.22.20tactic/near/525160429\">said</a>:</p>\n<blockquote>\n<p>Now I have a scary question: How recent is the change...?</p>\n</blockquote>\n<p>The <code>change</code> change is from mid-november, <a href=\"https://github.com/leanprover/lean4/pull/6022\">lean4#6022</a>.</p>",
        "id": 525167404,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1750522091
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/.22match.20and.20abbreviate.22.20tactic/near/525167200\">said</a>:</p>\n<blockquote>\n<p>generalize h : f x = a</p>\n</blockquote>\n<p>Thanks! I want to try this but it is not clear to me how it works.</p>\n<p>I tried to write <br>\n<code>generalize h: a_big_term = a</code>, with <code>a</code> a fresh variable that is not in the context. Unsurprisingly, it complains <br>\n<code>unknown identifier 'a'</code><br>\n.</p>",
        "id": 525199438,
        "sender_full_name": "Yiming Xu",
        "timestamp": 1750577361
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/.22match.20and.20abbreviate.22.20tactic/near/525167338\">said</a>:</p>\n<blockquote>\n<p>There's a tactic that was under development (<code>setm</code>, <a href=\"https://github.com/leanprover-community/mathlib4/pull/7890\">#7890</a>) that would do something slightly different. With it, if you were to write <code>setm P ?a</code>, you would get <code>a := f x</code> in the local context.</p>\n</blockquote>\n<p>I indeed want to throw a fresh variable into the context and define it to be a big term.</p>",
        "id": 525199455,
        "sender_full_name": "Yiming Xu",
        "timestamp": 1750577400
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"776892\">Yiming Xu</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/.22match.20and.20abbreviate.22.20tactic/near/525199438\">said</a>:</p>\n<blockquote>\n<p>Unsurprisingly, it complains<br>\n<code>unknown identifier 'a'</code></p>\n</blockquote>\n<p>Why do you say \"unsurprisingly\"? This is the purpose of the <code>generalize</code> tactic.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">generalize</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">d</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span>\n<span class=\"cm\">  a b c d : Nat</span>\n<span class=\"cm\">  h : a + b = d</span>\n<span class=\"cm\">  ‚ä¢ d = c</span>\n<span class=\"cm\">  -/</span>\n</code></pre></div>",
        "id": 525199524,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1750577484
    },
    {
        "content": "<p>Oh, sorry for my unfamiliarity with this tactic. It seems to be what I want then! So it is indeed surprising. May I please ask for possible reasons?</p>",
        "id": 525203903,
        "sender_full_name": "Yiming Xu",
        "timestamp": 1750584854
    },
    {
        "content": "<p>I see.</p>",
        "id": 525203987,
        "sender_full_name": "Yiming Xu",
        "timestamp": 1750584974
    },
    {
        "content": "<p>I copied the thing in my goal incorrectly. There is a pair of brackets that are missing.</p>",
        "id": 525204006,
        "sender_full_name": "Yiming Xu",
        "timestamp": 1750585014
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/.22match.20and.20abbreviate.22.20tactic/near/525155397\">said</a>:</p>\n<blockquote>\n<p>Isn't there a tactic called something like <code>generalize</code>? Maybe this is what you want?</p>\n</blockquote>\n<p>Many thanks!  All my bad, I confirm that this is what I want. My confusion is due to my lack of familiarity with it. I regret that I did not ask about it earlier...</p>",
        "id": 525204052,
        "sender_full_name": "Yiming Xu",
        "timestamp": 1750585092
    }
]