[
    {
        "content": "<p>While doing <a href=\"https://github.com/leanprover-community/mathlib4/pull/14756\">#14756</a>, I need some basic theorems on <code>fmod</code>, namely</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">lt_fmod_of_pos</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">fmod</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>and</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">fmod_nonpos</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">fmod</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>Did I miss to find them somewhere? I was also looking for anything that has <code>a.fmod -b</code> for a positive or nonnegative b, but didn't find anything. Maybe they even follow trivially from stuff in the library and I'm missing it.<br>\nIf we don't have this, where would be a good place to put those facts on <code>fmod</code>?</p>",
        "id": 451666562,
        "sender_full_name": "Moritz Firsching",
        "timestamp": 1721096579
    },
    {
        "content": "<p>Could you <a href=\"https://en.wikipedia.org/wiki/XY_problem\">#xy</a> and explain why <code>fmod</code> is relevant here in the first place? We otherwise don't touch it in Mathlib.</p>",
        "id": 451671258,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721099073
    },
    {
        "content": "<p>Sure, the reason why I was looking at <code>fmod</code> is because this theorem</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">fract_div_intCast_eq_div_intCast_mod</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">fract</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n</code></pre></div>\n<p>can be generalized to have an integer <code>{n : ℤ}</code> instead of the <code>{n : ℕ}</code> for the second argument. <br>\nBut then <code>m % n</code> needs to be replaced by <code>m.fmod n</code>, at least this was suggested in a todo. Assuming this generalization makes sense, then I started proving it and found myself needing those two lemmas above. <br>\nThis could really be a case of <a href=\"https://en.wikipedia.org/wiki/XY_problem\">#xy</a>, perhaps the generalization should use something other than <code>Int.fmod</code>?</p>",
        "id": 451672139,
        "sender_full_name": "Moritz Firsching",
        "timestamp": 1721099585
    },
    {
        "content": "<p>Why not use <code>emod</code>, like the rest of Mathlib?</p>",
        "id": 451674641,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721101152
    },
    {
        "content": "<p>Because you want the numerator to be negative, if <code>n</code> is negative.</p>",
        "id": 451677536,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1721102668
    },
    {
        "content": "<p>yes, I think the definition of <code>fract</code> seems to be more compatible with <code>fmod</code>, I haven't managed to come up with a generalization using <code>emod</code>.</p>",
        "id": 451683378,
        "sender_full_name": "Moritz Firsching",
        "timestamp": 1721107458
    },
    {
        "content": "<p>I might wonder if the generalisation is worth it in that case</p>",
        "id": 451685406,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1721108825
    },
    {
        "content": "<p>Perhaps not then</p>",
        "id": 451685679,
        "sender_full_name": "Moritz Firsching",
        "timestamp": 1721109010
    },
    {
        "content": "<p>If we the generalization is not worth it, then I think might want to delete the TODO<br>\n<a href=\"https://github.com/leanprover-community/mathlib4/blob/496527772ac807ef3d1ddd4868f2048f9ea478e1/Mathlib/Algebra/Order/Floor.lean#L1047\">https://github.com/leanprover-community/mathlib4/blob/496527772ac807ef3d1ddd4868f2048f9ea478e1/Mathlib/Algebra/Order/Floor.lean#L1047</a><br>\n. This was added by <span class=\"user-mention\" data-user-id=\"240862\">@Oliver Nash</span> . <br>\nWhat do you think: delete TODO or generalize? The work to generalize it is pretty much done in <a href=\"https://github.com/leanprover-community/mathlib4/pull/14756\">#14756</a>, except for a little cleanup and golf and finding better places for intermediate results.</p>",
        "id": 485101192,
        "sender_full_name": "Moritz Firsching",
        "timestamp": 1732887566
    },
    {
        "content": "<p>I'm sorry for writing that TODO, and for the fact that you have invested non-trivial time implementing it. I agree with the comments above that we should not be building API for <code>Int.fmod</code> in Mathlib and should just excise the remark.</p>",
        "id": 485247393,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1732987912
    },
    {
        "content": "<p>No problem at all, I'll make the PR simply removing the todo later</p>",
        "id": 485249108,
        "sender_full_name": "Moritz Firsching",
        "timestamp": 1732989350
    },
    {
        "content": "<p>done, opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/19652\">#19652</a>, closing  <a href=\"https://github.com/leanprover-community/mathlib4/pull/14756\">#14756</a></p>",
        "id": 485466887,
        "sender_full_name": "Moritz Firsching",
        "timestamp": 1733046246
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"240862\">Oliver Nash</span> <a href=\"#narrow/stream/217875-Is-there-code-for-X.3F/topic/basic.20facts.20for.20.60fmod.60.20for.20negative.20second.20argument/near/485247393\">said</a>:</p>\n<blockquote>\n<p>we should not be building API for <code>Int.fmod</code> in Mathlib and should just excise the remark.</p>\n</blockquote>\n<p>I think it's sensible to build as much API as is needed to translate to the preferred spelling that uses <code>floor</code>, so since Moritz already seemingly did the work, I think we should try to merge the generalized version.</p>",
        "id": 485477667,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733056259
    },
    {
        "content": "<p>Unless I mistake, we currently have no use of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Int.fmod#doc\">docs#Int.fmod</a> in Mathlib and can use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Int.floor#doc\">docs#Int.floor</a> anywhere we might want to express it. Surely we should just avoid supporting what is essentially a redundant spelling?</p>",
        "id": 485481022,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1733059290
    },
    {
        "content": "<p>The argument would be that if we have some algorithm written in Lean (core) using <code>fmod</code>, it would be nice to be able to prove things about it using Mathlib. We don't need a large API for <code>fmod</code> for that, but we do need lemmas to turn <code>fmod</code> into something we have API for.</p>",
        "id": 485484653,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733061835
    },
    {
        "content": "<p>Or phrased another way; our mechanisms for redundant spellings are:</p>\n<ol>\n<li>Delete the spellling (not possible here)</li>\n<li>Create a (simp) lemma that turns the unwanted spellling into the preferred one</li>\n</ol>",
        "id": 485484824,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733061908
    },
    {
        "content": "<p>I agree with these remarks at a logical level but this seems to me like quite a theoretical benefit. I feel like our bandwidth is better spent reviewing and maintaining the many definitely-valuable additions to Mathlib.</p>\n<p>Notwithstanding the above, I don't have especially strong feelings and I certainly won't object if someone else does.</p>",
        "id": 485492101,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1733068302
    },
    {
        "content": "<p>My preference is that Mathlib avoids mentioning <code>fmod</code> entirely. None of its business. :-)</p>",
        "id": 485544536,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733114350
    },
    {
        "content": "<p>If a definition like <code>fmod</code> exists in lean+batteries+mathlib, I want to see enough characterizing lemmas for it in lean+batteries+mathlib. I don't care where it is, but it should exist</p>",
        "id": 485565363,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733126879
    },
    {
        "content": "<p>Yes, I agree. But please not Mathlib for things like <code>fmod</code>. I would happily merge PRs to Batteries with any reasonable material about <code>fmod</code>, and PRs to Lean that increase the uniformity of the treatment of emod/fmod/tmod/bmod.</p>",
        "id": 485579630,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733131740
    },
    {
        "content": "<p>If we want a lemma that translates fmod to Int.floor, it has to live in Mathlib. The helper lemmas to get there could probably survive in Batteries.</p>",
        "id": 485579965,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733131837
    }
]