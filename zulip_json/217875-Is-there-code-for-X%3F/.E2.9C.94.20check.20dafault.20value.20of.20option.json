[
    {
        "content": "<p>how to get default value of an <code>option</code>?</p>\n<p>The only way I know is see the definition of the option. I want to do it without leaving the current file</p>",
        "id": 475377438,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1728329508
    },
    {
        "content": "<p><del>(wait... I could have asked a same question here...)</del></p>\n<p>I cannot find it.</p>",
        "id": 475377586,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1728329550
    },
    {
        "content": "<p>If you use the <code>#where</code> command, it tells you all the currently set options. It only shows a <code>set_option</code> line if the option is currently not set to its default value.</p>",
        "id": 475379227,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1728330067
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">set_option</span><span class=\"w\"> </span><span class=\"n\">autoImplicit</span><span class=\"w\"> </span><span class=\"n\">false</span>\n\n<span class=\"n\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"#peek_autoimp\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">scope</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getScope</span>\n<span class=\"w\">  </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">val</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">scope.opts</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"ss\">`autoImplicit</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"bp\">!</span><span class=\"s2\">\"autoImplicit is set to {val}\"</span>\n<span class=\"w\">      </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"o\">()</span>\n<span class=\"w\">  </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"bp\">!</span><span class=\"s2\">\"autoImplicit is set to its default value\"</span>\n\n<span class=\"c\">/-</span>\n<span class=\"cm\">autoImplicit is set to false</span>\n<span class=\"cm\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">peek_autoimp</span>\n</code></pre></div>",
        "id": 475385300,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1728331595
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> Nice!!</p>",
        "id": 475385317,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1728331603
    },
    {
        "content": "<p>↑ here is my code to get default value of option.  I would like to modify it to take option names as arguments, but I'm a bit unsure how to do it.</p>",
        "id": 475385416,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1728331630
    },
    {
        "content": "<p>For instance, you could do this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Command</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">autoImplicit</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">unusedVariables</span><span class=\"w\"> </span><span class=\"n\">false</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Command</span>\n\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"#peek_autoimp\"</span><span class=\"w\"> </span><span class=\"n\">str</span><span class=\"o\">:(</span><span class=\"n\">str</span><span class=\"o\">)</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">str</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">str</span><span class=\"bp\">.</span><span class=\"n\">getD</span><span class=\"w\"> </span><span class=\"n\">default</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">getString</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">scope</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getScope</span>\n<span class=\"w\">  </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">val</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">scope</span><span class=\"bp\">.</span><span class=\"n\">opts</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">str</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span><span class=\"w\"> </span><span class=\"bp\">||</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"bp\">.</span><span class=\"n\">toString</span><span class=\"bp\">.</span><span class=\"n\">splitOn</span><span class=\"w\"> </span><span class=\"n\">str</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"'{name}' is set to '{val}'\"</span>\n<span class=\"w\">      </span><span class=\"c1\">--return ()</span>\n<span class=\"w\">  </span><span class=\"c1\">--logInfo m!\"autoImplicit is set to its default value\"</span>\n\n<span class=\"bp\">#</span><span class=\"n\">peek_autoimp</span>\n\n<span class=\"bp\">#</span><span class=\"n\">peek_autoimp</span><span class=\"w\"> </span><span class=\"s2\">\"unu\"</span>\n\n<span class=\"bp\">#</span><span class=\"n\">peek_autoimp</span><span class=\"w\"> </span><span class=\"s2\">\"toI\"</span>\n</code></pre></div>\n<p>There are lots of options, depending on what exactly you want to achieve, though.</p>",
        "id": 475387509,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1728332353
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> Thank you. I made it too. I enjoy seeing your code.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Command</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">getDefaultValue</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">opt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Name</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CommandElabM</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">decls</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getOptionDecls</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">decls.find</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"n\">opt</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">decl</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"bp\">!</span><span class=\"s2\">\"{opt}'s default value is {decl.defValue}\"</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"bp\">!</span><span class=\"s2\">\"{opt} is unknown\"</span>\n\n<span class=\"k\">#eval</span><span class=\"w\"> </span><span class=\"n\">getDefaultValue</span><span class=\"w\"> </span><span class=\"ss\">`autoImplicit</span>\n<span class=\"k\">#eval</span><span class=\"w\"> </span><span class=\"n\">getDefaultValue</span><span class=\"w\"> </span><span class=\"ss\">`relaxedAutoImplicit</span>\n<span class=\"k\">#eval</span><span class=\"w\"> </span><span class=\"n\">getDefaultValue</span><span class=\"w\"> </span><span class=\"ss\">`linter.flexible</span>\n</code></pre></div>",
        "id": 475387802,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1728332452
    },
    {
        "content": "<p>You could turn your version into an actual command by merging in what you can see in my code.  I went for a <code>String</code> input, but you can equally well go for an <code>ident</code> input, given your application.</p>",
        "id": 475388271,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1728332613
    },
    {
        "content": "<p><code>#help option</code> also shows the default value of all options</p>",
        "id": 475519490,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1728379954
    },
    {
        "content": "<p><code>#help option autoImplicit</code> gives it for just that option.</p>",
        "id": 475519585,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1728379989
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"626349\">Asei Inoue</span> has marked this topic as resolved.</p>",
        "id": 475576484,
        "sender_full_name": "Notification Bot",
        "timestamp": 1728397344
    }
]