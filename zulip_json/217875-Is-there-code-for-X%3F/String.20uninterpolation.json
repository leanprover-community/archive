[
    {
        "content": "<p>Is there a function which undoes string interpolation?</p>\n<p>For example, suppose I want to test a string <code>(12, 14)</code> is of the form <code>({a}, {b})</code> and a + 2 = b. I need to extract <code>a</code> and <code>b</code> and test the equality <code>a + 2 = b</code>.</p>",
        "id": 493406960,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1736789360
    },
    {
        "content": "<p>Is the string intended to be valid lean syntax?</p>",
        "id": 493407869,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736789650
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/String.20uninterpolation/near/493407869\">said</a>:</p>\n<blockquote>\n<p>Is the string intended to be valid lean syntax?</p>\n</blockquote>\n<p>No</p>",
        "id": 493407950,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1736789680
    },
    {
        "content": "<p>Isn't that just parsing? It sounds like you need to write a small parser for the strings relevant to you.</p>",
        "id": 493413525,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1736791313
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"197836\">Jireh Loreaux</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/String.20uninterpolation/near/493413525\">said</a>:</p>\n<blockquote>\n<p>Isn't that just parsing? It sounds like you need to write a small parser for the strings relevant to you.</p>\n</blockquote>\n<p>is there not something similar to scanf?</p>",
        "id": 493414082,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1736791451
    },
    {
        "content": "<p>There's Parsec:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">Parsec</span><span class=\"bp\">.</span><span class=\"n\">String</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">Parsec</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">Parsec</span><span class=\"bp\">.</span><span class=\"n\">String</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Unrepr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">parse</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"n\">α</span>\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Unrepr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">parse</span><span class=\"o\">)</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Unrepr</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">parse</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">digits</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">parsePair</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">skipChar</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"o\">(</span><span class=\"bp\">'</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">parse</span>\n<span class=\"w\">  </span><span class=\"n\">skipChar</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"o\">,</span><span class=\"bp\">'</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">parse</span>\n<span class=\"w\">  </span><span class=\"n\">skipChar</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"o\">)</span><span class=\"bp\">'</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">parseString</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Except</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">&lt;*</span><span class=\"w\"> </span><span class=\"n\">eof</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">mkIterator</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">success</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">ok</span><span class=\"w\"> </span><span class=\"n\">res</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">msg</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">msg</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">parseString</span><span class=\"w\"> </span><span class=\"n\">parsePair</span><span class=\"w\"> </span><span class=\"s2\">\"(1,2)\"</span>\n<span class=\"c1\">-- Except.ok (1, 2)</span>\n</code></pre></div>",
        "id": 493431091,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1736796609
    },
    {
        "content": "<p>It shouldn't be too hard of a project to make \"parsec strings\" like <code>p!\"({Nat},{Nat})\"</code> that return a tuple with all the parsed values.</p>",
        "id": 493431233,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1736796666
    },
    {
        "content": "<p>Or maybe <code>p!\"({a},{b})\"</code> could be a <code>doElem</code> that defines <code>a</code> and <code>b</code>.</p>",
        "id": 493431291,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1736796691
    },
    {
        "content": "<p>I forgot to generalize <code>parsePair</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">parsePair</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Unrepr</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Unrepr</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">skipChar</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"o\">(</span><span class=\"bp\">'</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">parse</span>\n<span class=\"w\">  </span><span class=\"n\">skipChar</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"o\">,</span><span class=\"bp\">'</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">parse</span>\n<span class=\"w\">  </span><span class=\"n\">skipChar</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"o\">)</span><span class=\"bp\">'</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 493431408,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1736796727
    }
]