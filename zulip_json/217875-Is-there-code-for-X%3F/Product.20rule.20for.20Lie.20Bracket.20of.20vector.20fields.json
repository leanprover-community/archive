[
    {
        "content": "<p>I'm currently reading through the API for Lie brackets of vector fields on vector spaces and on manifolds. Both seem to lack statements about  <code>[X, f*Y] = df(X) * Y + f * [X, Y]</code> (aka product rule).</p>\n<p>Is this missing? And if so, worth adding?</p>\n<p>On vector spaces, it should follow more or less directly from the definition and the product rule for the Fr√©chet derivative.</p>\n<p>Further I wonder whether it is proven that the definition of the Lie bracket on manifolds is actually well-defined and how one would formalize it. The Lie bracket on manifolds is defined in terms of a chart - but if we have two charts at a point - who guarantees that the result is the same?</p>",
        "id": 516280064,
        "sender_full_name": "Jens Lindekamp",
        "timestamp": 1746473410
    },
    {
        "content": "<p>Can you state this a little more explicitly with the types of f, X, and Y?</p>",
        "id": 516297135,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1746479539
    },
    {
        "content": "<p>Product rule: that definitely seems worth adding (if it is indeed missing; I didn't search hard)</p>",
        "id": 516302254,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1746481488
    },
    {
        "content": "<p>Well-definedness is actually not an issue --- mathlib's definition is slightly different from how you describe it.</p>\n<p>In textbooks, manifolds are usually defined as \"there is a compatible atlas\"; around each point, there is a manifold chart around this point (and in proofs, you choose some charts, and need to argue your result is independent of the choice of charts).<br>\nMathlib's definition is slightly different. As part of the data of a manifold, there is a preferred chart <em>at each point</em>. The Lie bracket on manifolds is defined point-wise using these preferred charts. There is thus no arbitrary choice and no need to check anything about well-definedness.</p>",
        "id": 516302812,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1746481700
    },
    {
        "content": "<p>Granted, this definition may be a bit unexpected (coming from textbook mathematics) --- but this has all the usual properties, it is (for instance) alternating, anti-symmetric and satisfies the Leibniz identity.</p>",
        "id": 516303167,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1746481831
    },
    {
        "content": "<p>Agree to the preferred chart and being well-defined, but what happens when you move from one point to another point with different preferred charts? ‚ÄúSuddenly‚Äù / ‚Äúsomewhere in between‚Äù you have a different chart and one would need to prove that the lie bracket is well behaved at this point. Which it is, because of smooth coordinate changes and compatibility with pullbacks.</p>\n<p>But how is this hidden in Mathlib?</p>",
        "id": 516306700,
        "sender_full_name": "Jens Lindekamp",
        "timestamp": 1746483330
    },
    {
        "content": "<p>Concerning the product rule: I will try to formalize the statement in a mwe tomorrow.</p>",
        "id": 516306843,
        "sender_full_name": "Jens Lindekamp",
        "timestamp": 1746483389
    },
    {
        "content": "<p>You're absolutely right that, to prove anything nontrivial on the Lie bracket of vector fields on manifolds, for instance its smoothness, we need to know that it is canonical, i.e., it does not depend on the chart. An equivalent way to say it is to say that the Lie bracket is invariant under local diffeomorphisms (because then applying this invariance to the composition of two charts says that using one chart or the other will end up with the same result). </p>\n<p>The invariance of the Lie bracket of vector fields in vector spaces is <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=VectorField.pullback_lieBracket#doc\">docs#VectorField.pullback_lieBracket</a> . This one is then leveraged to get invariance in manifolds, in <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=VectorField.mpullback_mlieBracket#doc\">docs#VectorField.mpullback_mlieBracket</a> . Which in turn is used to show that the Lie bracket of two smooth vector fields is smooth, in <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ContMDiffAt.mlieBracket_vectorField#doc\">docs#ContMDiffAt.mlieBracket_vectorField</a> .</p>",
        "id": 516350492,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1746509098
    },
    {
        "content": "<p>(You can have a look at the comment at the beginning of the proof of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ContMDiffWithinAt.mlieBracketWithin_vectorField#doc\">docs#ContMDiffWithinAt.mlieBracketWithin_vectorField</a>, which repeats exactly what you were saying)</p>",
        "id": 516350690,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1746509232
    },
    {
        "content": "<p>This is my idea to formalize the product rule; there would also be variants of it. Probably we could also relax the hypothesis for the vector fields and the function.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Geometry</span><span class=\"bp\">.</span><span class=\"n\">Manifold</span><span class=\"bp\">.</span><span class=\"n\">IsManifold</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Geometry</span><span class=\"bp\">.</span><span class=\"n\">Manifold</span><span class=\"bp\">.</span><span class=\"n\">VectorField</span><span class=\"bp\">.</span><span class=\"n\">LieBracket</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Manifold</span><span class=\"w\"> </span><span class=\"n\">VectorField</span><span class=\"w\"> </span><span class=\"n\">Bundle</span>\n\n<span class=\"kn\">variable</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithTop</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"bp\">‚àû</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NontriviallyNormedField</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedSpace</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ModelWithCorners</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ChartedSpace</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsManifold</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">Product rule for Lie Brackets:Given two differentiable vector fields `V W : Œ† (x:M), TangentSpace I x` and a diffentiable function `f:M ‚Üí ùïú`, we have `[V, f ‚Ä¢ W] = (df V) ‚Ä¢ W + f ‚Ä¢ [V, W]`</span>\n<span class=\"sd\">-/</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">mlieBracketWithinAt_fmul_right</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">Œ†</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"n\">M</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">TangentSpace</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x‚ÇÄ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">hV</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ContMDiffWithinAt</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"bp\">.</span><span class=\"n\">tangent</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">minSmoothness</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TangentBundle</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">x‚ÇÄ</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">hW</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ContMDiffWithinAt</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"bp\">.</span><span class=\"n\">tangent</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">minSmoothness</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TangentBundle</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">x‚ÇÄ</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ContMDiffWithinAt</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">ùìò</span><span class=\"o\">(</span><span class=\"n\">ùïú</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">minSmoothness</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">x‚ÇÄ</span><span class=\"o\">):</span>\n<span class=\"w\">  </span><span class=\"n\">mlieBracketWithin</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">x‚ÇÄ</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mfderivWithin</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">ùìò</span><span class=\"o\">(</span><span class=\"n\">ùïú</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">x‚ÇÄ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"n\">x‚ÇÄ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"n\">x‚ÇÄ</span><span class=\"o\">)</span><span class=\"w\">  </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">mlieBracketWithin</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x‚ÇÄ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 516379188,
        "sender_full_name": "Jens Lindekamp",
        "timestamp": 1746519312
    },
    {
        "content": "<p>That's definitely the right kind of statement. You will probably need an additional uniqueDiffAt assumption on <code>s</code>, and you can probably weaken the assumption on <code>f</code> to differentiability.</p>\n<p>If you want to try your hands on a proof, my advice would be to first prove it in vector spaces (where everything is more concrete, therefore easier) and then pull it back to the manifold using the chart and invariance of the Lie bracket under diffeos.</p>",
        "id": 516383437,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1746520520
    },
    {
        "content": "<blockquote>\n<p>first prove it in vector spaces (where everything is more concrete</p>\n</blockquote>\n<p>I thought so.</p>",
        "id": 516384319,
        "sender_full_name": "Jens Lindekamp",
        "timestamp": 1746520787
    },
    {
        "content": "<p>Actually, the proofs on vector spaces are done. Could you me write access to the repo so that I could push my branch (jkanschik on github)?</p>",
        "id": 516460015,
        "sender_full_name": "Jens Lindekamp",
        "timestamp": 1746541732
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"900335\">@Jens Lindekamp</span> you may view your invitation here: <a href=\"https://github.com/leanprover-community/mathlib4/invitations\">https://github.com/leanprover-community/mathlib4/invitations</a></p>",
        "id": 517491442,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1747044586
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"900335\">@Jens Lindekamp</span> Thanks again for your pull request <a href=\"https://github.com/leanprover-community/mathlib4/pull/24932\">#24932</a>. Patrick Massot and I are working on covariant derivatives right now, and will have the Levi-Civita connection defined soon. Completing all the sorries requires <a href=\"https://github.com/leanprover-community/mathlib4/pull/24932\">#24932</a> and its manifold version, so your work is really valuable! I'm wondering:</p>\n<ul>\n<li>Do you mind if I push your PR to completion? I'd like to have it in mathlib soon, so I can build on it.</li>\n<li>Can you share what you had for the manifold version? I could develop it on my own, but I'd much rather credit you and build on your work, if that's reasonable. A link to a branch is totally fine (no need to worry about collaboration access or anything like that).</li>\n</ul>",
        "id": 526950678,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1751533829
    },
    {
        "content": "<p>Wow, Levi-Civita, that's awesome! Did the Riemannian manifold definition work well for you, or did you have to tweak the definition somehow to make it better?</p>",
        "id": 527003280,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1751551030
    },
    {
        "content": "<p>We're not at that stage yet, but it's coming soon - and we will report back to you!</p>",
        "id": 527011363,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1751552964
    }
]