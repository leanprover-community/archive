[
    {
        "content": "<p>I'd like to write some code generic over all of Lists / Arrays / Streams. The only operation I need on these types is destructuring: <code>match foo with | [] =&gt; sorry | head :: tail =&gt; sorry</code>, essentially. </p>\n<p>Is there any existing typeclass infrastructure around this?</p>",
        "id": 565410524,
        "sender_full_name": "JJ",
        "timestamp": 1766726935
    },
    {
        "content": "<p>Are you familiar with Monads? You might want to match on pure and bind.</p>",
        "id": 565420855,
        "sender_full_name": "Yan Yablonovskiy ðŸ‡ºðŸ‡¦",
        "timestamp": 1766737163
    },
    {
        "content": "<p>I am not very familiar with monads, no. This is for a project whose goal is to familiarize me with monads and monad transformers actually!</p>",
        "id": 565421058,
        "sender_full_name": "JJ",
        "timestamp": 1766737401
    },
    {
        "content": "<p>(I've made operational use of monads for years c.f. Option and Result but haven't ever grown the Haskell sense for them)</p>",
        "id": 565421102,
        "sender_full_name": "JJ",
        "timestamp": 1766737445
    },
    {
        "content": "<p>I have heard that List is the free monad. So I guess Array and Stream are also monads, given their similarity? I'm not quite sure how that ties into an interface around <code>nil</code> and <code>cons</code>, though, hrm. I'll think about it.</p>",
        "id": 565421210,
        "sender_full_name": "JJ",
        "timestamp": 1766737561
    },
    {
        "content": "<p>List has an instance of LawfulMonad, the situation with Array and Stream are more complicated. For proofs rather than computation, Array has toList. Stream can be even more complicated in general, but if you have non-empty sequences you have <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Stream%27.Seq1#doc\">docs#Stream'.Seq1</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Stream%27.Seq1.lawfulMonad#doc\">docs#Stream'.Seq1.lawfulMonad</a></p>",
        "id": 565421484,
        "sender_full_name": "Yan Yablonovskiy ðŸ‡ºðŸ‡¦",
        "timestamp": 1766737800
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634325\">JJ</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/being.20generic.20over.20List.20.2F.20Array.20.2F.20Stream.3F/near/565421210\">said</a>:</p>\n<blockquote>\n<p>I have heard that List is the free monad. So I guess Array and Stream are also monads, given their similarity? I'm not quite sure how that ties into an interface around <code>nil</code> and <code>cons</code>, though, hrm. I'll think about it.</p>\n</blockquote>\n<p>You would create an interface for LawfulMonad instead, which then can be applied on a List and more generally since it has such an instance (avoiding reference directly to List specific nil and cons).</p>",
        "id": 565421746,
        "sender_full_name": "Yan Yablonovskiy ðŸ‡ºðŸ‡¦",
        "timestamp": 1766738007
    },
    {
        "content": "<p>I'm not sure I see what Monad/LawfulMonad (I'm not concerned about proof here, so there shouldn't be a difference?) give me in exchange for <code>nil</code> and <code>cons</code>.</p>\n<p>Could you explain why Stream is not a monad (when empty) but List is?</p>",
        "id": 565423078,
        "sender_full_name": "JJ",
        "timestamp": 1766739284
    },
    {
        "content": "<p>Oh, this is interesting. <a class=\"stream-topic\" data-stream-id=\"113488\" href=\"/#narrow/channel/113488-general/topic/question.3A.20why.20List.20is.20nolonger.20Monad.3F/with/436560999\">#general &gt; question: why List is nolonger Monad?</a></p>",
        "id": 565423161,
        "sender_full_name": "JJ",
        "timestamp": 1766739360
    },
    {
        "content": "<p>You have <code>ForIn</code> that should work to iterate in a generic way (so only destructuring current folded item), for example :</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">printAll</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î±</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ToString</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ForIn</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">toString</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n\n\n<span class=\"c1\">-- List</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">printAll</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">3</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"c1\">-- 1\\n2\\n3</span>\n<span class=\"c1\">-- Array</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">printAll</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">3</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"c1\">-- 1\\n2\\n3]</span>\n<span class=\"c1\">-- Stream</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">printAll</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">ToStream</span><span class=\"bp\">.</span><span class=\"n\">toStream</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">3</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"c1\">-- 1\\n2\\n3</span>\n</code></pre></div>",
        "id": 565429267,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1766744396
    },
    {
        "content": "<p>I think the new iterator library is meant to help with your problem. A list/Array can be turned into an iterator, and then the iterator can be passed to your \"generic\" function.</p>",
        "id": 565557474,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1766913031
    }
]