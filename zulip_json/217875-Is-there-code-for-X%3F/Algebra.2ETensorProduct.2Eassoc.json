[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">TensorProduct</span><span class=\"bp\">.</span><span class=\"n\">assoc'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">R'</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommSemiring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommSemiring</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">CommSemiring</span><span class=\"w\"> </span><span class=\"n\">R'</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">R'</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">R'</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">R'</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">IsScalarTower</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">R'</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsScalarTower</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">R'</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">R'</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">IsScalarTower</span><span class=\"w\"> </span><span class=\"n\">R'</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsScalarTower</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">⊗</span><span class=\"o\">[</span><span class=\"n\">R'</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">⊗</span><span class=\"o\">[</span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">≃ₐ</span><span class=\"o\">[</span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">⊗</span><span class=\"o\">[</span><span class=\"n\">R'</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">⊗</span><span class=\"o\">[</span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">AlgEquiv</span><span class=\"bp\">.</span><span class=\"n\">ofLinearEquiv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TensorProduct</span><span class=\"bp\">.</span><span class=\"n\">AlgebraTensorModule</span><span class=\"bp\">.</span><span class=\"n\">assoc</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">map_mul_iff</span><span class=\"w\"> </span><span class=\"bp\">_|&gt;.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">ext</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Do we have this in mathlib? If not should I PR this?</p>",
        "id": 535805966,
        "sender_full_name": "Edison Xie",
        "timestamp": 1755954821
    },
    {
        "content": "<p>What about <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=TensorProduct.AlgebraTensorModule.assoc#doc\">docs#TensorProduct.AlgebraTensorModule.assoc</a> ?</p>",
        "id": 535811195,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1755961169
    },
    {
        "content": "<p>That’s the linear version right :-)</p>",
        "id": 535811505,
        "sender_full_name": "Edison Xie",
        "timestamp": 1755961510
    },
    {
        "content": "<p>Right, sorry… You want an heteromachinchose version of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Algebra.TensorProduct.assoc#doc\">docs#Algebra.TensorProduct.assoc</a>.<br>\n(This afternoon, I spent two much time defining an analogous trivial map <code>S' ⊗[R'] R' ⊗[R] M ≃ₗ[S'] S' ⊗[R] M</code>…)</p>",
        "id": 535812233,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1755962305
    },
    {
        "content": "<p>Since the advent of heterobasic tensor product, the whole situation is a mess <span aria-label=\"sad\" class=\"emoji emoji-2639\" role=\"img\" title=\"sad\">:sad:</span> We need to</p>\n<ol>\n<li>Remove the homobasic version in favour of the heterobasic one</li>\n<li>Find naming schemes for the different kinds of tensor products and the different kinds of maps they have</li>\n</ol>",
        "id": 535812474,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1755962545
    },
    {
        "content": "<p>I think for the algebra ones we just tried to make all the results heterobasic?</p>",
        "id": 535814447,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755964488
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Algebra.2ETensorProduct.2Eassoc/near/535812474\">said</a>:</p>\n<blockquote>\n<p>Since the advent of heterobasic tensor product, the whole situation is a mess <span aria-label=\"sad\" class=\"emoji emoji-2639\" role=\"img\" title=\"sad\">:sad:</span> We need to</p>\n<ol>\n<li>Remove the homobasic version in favour of the heterobasic one</li>\n<li>Find naming schemes for the different kinds of tensor products and the different kinds of maps they have</li>\n</ol>\n</blockquote>\n<p>So… the answer is yes and no? It’s just this lemma has been sitting inside my repo for four months and I think it’s useful to have it in mathlib <span aria-label=\"joy\" class=\"emoji emoji-1f602\" role=\"img\" title=\"joy\">:joy:</span></p>",
        "id": 535858850,
        "sender_full_name": "Edison Xie",
        "timestamp": 1755976531
    },
    {
        "content": "<p>I have no idea whether this is in mathlib or not, but at this point I would rather see a big refactor that gets what's there right before committing to new stuff</p>",
        "id": 535859041,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1755976803
    },
    {
        "content": "<p>This is not really a helpful comment unless it's followed by \"...and I'm going to start that refactor right now\" and in particular a clarification of what it means to get things \"right\" in your view. You're saying \"I don't like how things are\" but are not offering a path to make it more like how you want it, whilst simultaneously blocking progress. I would rather see this lemma merged than a nebulous complaint.</p>",
        "id": 535865361,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1755985606
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Algebra.2ETensorProduct.2Eassoc/near/535812474\">said</a>:</p>\n<blockquote>\n<p>Since the advent of heterobasic tensor product, the whole situation is a mess <span aria-label=\"sad\" class=\"emoji emoji-2639\" role=\"img\" title=\"sad\">:sad:</span> We need to</p>\n<ol>\n<li>Remove the homobasic version in favour of the heterobasic one</li>\n<li>Find naming schemes for the different kinds of tensor products and the different kinds of maps they have</li>\n</ol>\n</blockquote>\n<p>Is this not exactly the path forward I suggested?</p>",
        "id": 535884351,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1756016480
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Algebra.2ETensorProduct.2Eassoc/near/535814447\">said</a>:</p>\n<blockquote>\n<p>I think for the algebra ones we just tried to make all the results heterobasic?</p>\n</blockquote>\n<p>Indeed, it looks like what's left as homobasic duplication is the <code>TensorProduct</code> vs <code>AlgebraTensorModule</code> stuff.</p>",
        "id": 535885096,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1756017728
    },
    {
        "content": "<p>In total I can find:</p>\n<ul>\n<li><code>TensorProduct</code>: Homobasic tensor product of modules</li>\n<li><code>TensorProduct.AlgebraTensorModule</code>: Heterobasic tensor product of modules</li>\n<li><code>Algebra.TensorProduct</code>: Heterobasic tensor product of algebras</li>\n<li><code>Coalgebra.TensorProduct</code>: Heterobasic tensor product of coalgebras</li>\n<li><code>Bialgebra.TensorProduct</code>: Heterobasic tensor product of bialgebras/Hopf algebras</li>\n</ul>",
        "id": 535885257,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1756017956
    },
    {
        "content": "<p>Therefore I would suggest that:</p>\n<ol>\n<li>We deprecate all the <code>TensorProduct</code> material in favour of the <code>TensorProduct.AlgebraTensorModule</code> one.</li>\n<li>We find a naming scheme for the material that's left.</li>\n</ol>",
        "id": 535885447,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1756018295
    },
    {
        "content": "<p>My experience working with these is that one often needs eg the module and algebra versions simultaneously. meaning that it should be possible to open namespaces and still have the different version easily distinguishable</p>",
        "id": 535885824,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1756018871
    },
    {
        "content": "<p>I see a few options for that. Taking the representative series <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=TensorProduct.AlgebraTensorModule.map#doc\">docs#TensorProduct.AlgebraTensorModule.map</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Algebra.TensorProduct.map#doc\">docs#Algebra.TensorProduct.map</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Coalgebra.TensorProduct.map#doc\">docs#Coalgebra.TensorProduct.map</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Bialgebra.TensorProduct.map#doc\">docs#Bialgebra.TensorProduct.map</a>, we could have</p>\n<ol>\n<li>Statu quo: <code>Module.TensorProduct.map</code>, <code>Algebra.TensorProduct.map</code>, <code>Coalgebra.TensorProduct.map</code>, <code>Bialgebra.TensorProduct.map</code>. Is a more conventional use of namespaces, but then no two of <code>Module</code>, <code>Algebra</code>, <code>Coalgebra</code>, <code>Bialgebra</code> can be opened simultaneously.</li>\n<li>Statu quo with namespaces inverted: <code>TensorProduct.Module.map</code>, <code>TensorProduct.Algebra.map</code>, <code>TensorProduct.Coalgebra.map</code>, <code>TensorProduct.Bialgebra.map</code>. This way one can <code>open TensorProduct</code> and work with <code>Module.map</code> and <code>Algebra.map</code> simultaneously, which an improvement over the statu quo but not great still.</li>\n<li>Single namespace with types of maps appended: <code>TensorProduct.mapLinearMap</code> (or maybe just <code>TensorProduct.map</code>), <code>TensorProduct.mapAlgHom</code>, <code>TensorProduct.mapCoalgHom</code>, <code>TensorProduct.mapBialgHom</code>. This is the actual convention that we use elsewhere. Makes it a bit lengthy when talking about a single kind of tensor products/maps, but overall pretty good.</li>\n<li>Single namespace with types of maps appended as a single letter: <code>TensorProduct.mapL</code>,<code>TensorProduct.mapA</code>, <code>TensorProduct.mapC</code>, <code>TensorProduct.mapB</code>. Pushes the abbreviations to their limit, but is still discoverable, learnable, and is definitely the most concise when talking about several kinds of tensor products simultaneously.</li>\n</ol>",
        "id": 535886325,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1756019677
    },
    {
        "content": "<p>/poll Which of the above options strikes the best balance of readability/conciseness when using both a single and several tensor products?<br>\nStatu quo<br>\nStatu quo with namespaces inverted<br>\nSingle namespace with types of maps appended<br>\nSingle namespace with types of maps appended as a single letter</p>",
        "id": 535886399,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1756019802
    },
    {
        "content": "<p>I don't think this is relevant to Edison's problem, where the answer is just \"generalize the existing definition in-place\"?</p>",
        "id": 535887793,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1756021944
    },
    {
        "content": "<p>(and so I'd suggest splitting the thread)</p>",
        "id": 535887811,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1756021969
    },
    {
        "content": "<p>I think there's also a danger here of the module ones becoming semilinearized, which might not be compatible with heterogeneity</p>",
        "id": 535887877,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1756022059
    },
    {
        "content": "<p>Just a remark about the mess for heterobasic situations that I observed yesterday. Imagine you havet wo commutative semirings <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi></mrow><annotation encoding=\"application/x-tex\">R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi></mrow><annotation encoding=\"application/x-tex\">S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span></span></span></span>  and three modules <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi></mrow><annotation encoding=\"application/x-tex\">P</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span> that allow to build the tensor product <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi><msub><mo>⊗</mo><mi>R</mi></msub><mo>⊗</mo><mi>N</mi><msub><mo>⊗</mo><mi>S</mi></msub><mi>P</mi></mrow><annotation encoding=\"application/x-tex\">M \\otimes_R \\otimes N \\otimes_S P</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\"><span class=\"mbin\">⊗</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.00773em;\">R</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\">⊗</span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\"><span class=\"mbin\">⊗</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span>. There are two (symmetric) sets of hypotheses that allow mathlib to recognize this expression as legit.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">exists_multiset_eq_sum_tmul_tmul</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">CommSemiring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">CommSemiring</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsScalarTower</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">⊗</span><span class=\"o\">[</span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"bp\">⊗</span><span class=\"o\">[</span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ξ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Multiset</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">)),</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ξ</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">⊗ₜ</span><span class=\"o\">[</span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">⊗ₜ</span><span class=\"o\">[</span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>and its symmetric variant</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">exists_multiset_eq_sum_tmul_tmul'</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">CommSemiring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommSemiring</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsScalarTower</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">⊗</span><span class=\"o\">[</span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"bp\">⊗</span><span class=\"o\">[</span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ξ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Multiset</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">)),</span><span class=\"w\">  </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ξ</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">⊗ₜ</span><span class=\"o\">[</span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">⊗ₜ</span><span class=\"o\">[</span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 536032427,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1756130626
    },
    {
        "content": "<p>(I put as a challenge to establish the analogues with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Finset#doc\">docs#Finset</a>, I'm not sure they hold.)</p>",
        "id": 536032833,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1756130746
    },
    {
        "content": "<p>Surely in practice you only have one of <code>Algebra R S</code> and <code>Algebra S R</code>, and never both?</p>",
        "id": 536032956,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1756130782
    },
    {
        "content": "<p>Except when <code>R = S</code>, you mean?</p>",
        "id": 536033098,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1756130824
    },
    {
        "content": "<p>All of this would be clearer with bimodules, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span> would be a right <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi></mrow><annotation encoding=\"application/x-tex\">R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span></span>-module, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span></span> an <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>R</mi><mo separator=\"true\">,</mo><mi>S</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(R,S)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mclose\">)</span></span></span></span>-bimodule and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi></mrow><annotation encoding=\"application/x-tex\">P</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span> a left <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi></mrow><annotation encoding=\"application/x-tex\">S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span></span></span></span>-module.</p>",
        "id": 536033343,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1756130886
    },
    {
        "content": "<p>By the way, the code above suggests the interest of a notation for summation over a <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Multiset#doc\">docs#Multiset</a>.</p>",
        "id": 536033517,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1756130932
    },
    {
        "content": "<p>Such notation hasn't been added to encourage you to use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Finset.sum#doc\">docs#Finset.sum</a> instead</p>",
        "id": 536033815,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1756131016
    },
    {
        "content": "<p>ie something like <code>∃ (ι : Type) (_ : Fintype ι) (m : ι → M) (n : ι → N) (p : ι → P), x = ∑ i, m i ⊗ₜ[R] n i ⊗ₜ[S] p i</code>. This is more composable than your statement</p>",
        "id": 536034126,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1756131115
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130609\">Antoine Chambert-Loir</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Algebra.2ETensorProduct.2Eassoc/near/536033098\">said</a>:</p>\n<blockquote>\n<p>Except when <code>R = S</code>, you mean?</p>\n</blockquote>\n<p>When <code>R = S</code>, the assumptions are equivalent, so I am not sure what your point is</p>",
        "id": 536034439,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1756131195
    },
    {
        "content": "<p>Assuming that Kevin is not around, I have to confess that I tried such a thing but couldn't guess the adequate universe in which the type <code>ι</code> would live. And the obvious definition does not furnish <code>Type 0</code>.</p>",
        "id": 536034941,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1756131354
    },
    {
        "content": "<p>Anyway, I'll adjust as you suggest.</p>",
        "id": 536034979,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1756131365
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130609\">Antoine Chambert-Loir</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Algebra.2ETensorProduct.2Eassoc/near/536034941\">said</a>:</p>\n<blockquote>\n<p>Assuming that Kevin is not around, I have to confess that I tried such a thing but couldn't guess the adequate universe in which the type <code>ι</code> would live. And the obvious definition does not furnish <code>Type 0</code>.</p>\n</blockquote>\n<p>I know of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Module.equiv_free_prod_directSum#doc\">docs#Module.equiv_free_prod_directSum</a> which uses the universe the ring is in and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CommGroup.equiv_prod_multiplicative_zmod_of_finite#doc\">docs#CommGroup.equiv_prod_multiplicative_zmod_of_finite</a> which uses <code>Type 0</code> (the universe that <code>ℤ</code> is in). They should all still be (noncomputably) equivalent since finite types can be shrunk down to any universe.</p>",
        "id": 536041732,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1756133087
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/stream/217875-Is-there-code-for-X.3F/topic/Algebra.2ETensorProduct.2Eassoc/near/536032956\">said</a>:</p>\n<blockquote>\n<p>Surely in practice you only have one of <code>Algebra R S</code> and <code>Algebra S R</code>, and never both?</p>\n</blockquote>\n<p>I think you need neither?</p>",
        "id": 536111062,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1756156811
    },
    {
        "content": "<p>I suspect so too, but I would need to play with the proof to convince myself</p>",
        "id": 536161244,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1756187030
    },
    {
        "content": "<p>I thought the claim was about the statement only</p>",
        "id": 536171318,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1756191557
    },
    {
        "content": "<p>Ah maybe!</p>",
        "id": 536172151,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1756191902
    },
    {
        "content": "<p>Well, the present proof uses the hypothesis, just because the mathlib statement needs it, but the bimodule version indicates that it shouldn't be needed.</p>",
        "id": 536175410,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1756193351
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Algebra.2ETensorProduct.2Eassoc/near/535887877\">said</a>:</p>\n<blockquote>\n<p>I think there's also a danger here of the module ones becoming semilinearized, which might not be compatible with heterogeneity</p>\n</blockquote>\n<p>Can you expand on exactly how it would be incompatible?</p>",
        "id": 536260979,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1756221621
    },
    {
        "content": "<p>We have a number of bundled linear maps for linear map composition which exist in both variants without a common generalization</p>",
        "id": 536300877,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1756237095
    },
    {
        "content": "<p>If you can generalize those I will be less concerned</p>",
        "id": 536300902,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1756237108
    },
    {
        "content": "<p>Do you have an example pair? Is one of the maps merely semi-linear, or are they both linear?</p>",
        "id": 536349758,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1756272856
    }
]