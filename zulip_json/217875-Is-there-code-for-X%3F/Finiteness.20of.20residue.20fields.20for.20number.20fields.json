[
    {
        "content": "<p>We have finiteness of the class group of a number field but I can't find finiteness of the residue fields, which is much easier! Furthermore I am not entirely sure whether I should be just proving it for the ring of integers (approach 2) or more generally (approach 1). Do we have any of these?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"c1\">-- approach 1</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">IsDedekindDomain</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsDedekindDomain</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NumberField</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">IsFractionRing</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ideal</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hI</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"bp\">‚â†</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finite</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚ß∏</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"c1\">-- weaker statement which is all I need</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HeightOneSpectrum</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finite</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚ß∏</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"bp\">.</span><span class=\"n\">asIdeal</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"c1\">-- approach 2</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">NumberField</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NumberField</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HeightOneSpectrum</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùìû</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">))</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ideal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùìû</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hI</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"bp\">‚â†</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finite</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">ùìû</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚ß∏</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"c1\">-- weaker statement which is all I need</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finite</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">ùìû</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚ß∏</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">asIdeal</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 515159940,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1745961693
    },
    {
        "content": "<p>The first approach looks like more of a kerfuffle but it applies more generally (e.g. for S-integers) and also means that for <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">Q</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Q}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8556em;vertical-align:-0.1667em;\"></span><span class=\"mord mathbb\">Q</span></span></span></span> you're able to use <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">Z</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Z}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">Z</span></span></span></span>. However I don't need either of these for my current work.</p>",
        "id": 515161059,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1745962145
    },
    {
        "content": "<p>The bottom is usually done via <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsLocalRing.ResidueField#doc\">docs#IsLocalRing.ResidueField</a></p>",
        "id": 515161610,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1745962391
    },
    {
        "content": "<p>So you have to show that w.asIdeal is equal to IsLocalRing.maximalIdeal</p>",
        "id": 515161776,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1745962457
    },
    {
        "content": "<p>But this is global not local; <code>ùìû L</code> is far from local (an example would be the integers).</p>",
        "id": 515161805,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1745962471
    },
    {
        "content": "<p>Ah, apologies.</p>",
        "id": 515161856,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1745962503
    },
    {
        "content": "<p>In fact I also want to relate the residue field to the residue field of the completion, that's the next question. I'd like to prove that the residue field of <code>v.adicCompletionIntegers</code> is finite in the number field case, and I figured I'd do it by identifying it with the global residue field and then using the results above.</p>",
        "id": 515162012,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1745962575
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/RingTheory/Ideal/Norm/AbsNorm.html#Ideal.absNorm\">Ideal.absNorm</a> (and some of the following results) are probably what you want</p>",
        "id": 515162334,
        "sender_full_name": "Matthew Jasper",
        "timestamp": 1745962731
    },
    {
        "content": "<p>Interestingly that doesn't look general enough for the first approach; it asks that the ring is free as a Z-module, which is not true for e.g. Z[1/p].</p>",
        "id": 515162534,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1745962827
    },
    {
        "content": "<p>The first approach is missing an assumption on A or K though</p>",
        "id": 515162645,
        "sender_full_name": "Matthew Jasper",
        "timestamp": 1745962900
    },
    {
        "content": "<p>Oh sorry! You're absolutely right! I've edited to add the missing <code>NumberField</code> assumption. You're exactly right that it's nonsense without that assumption.</p>",
        "id": 515162752,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1745962951
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Ideal.fintypeQuotientOfFreeOfNeBot#doc\">docs#Ideal.fintypeQuotientOfFreeOfNeBot</a></p>",
        "id": 515162763,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1745962956
    },
    {
        "content": "<p>That also assumes that A is Z-free so doesn't apply to S-integers, but it will apply to the second approach.</p>",
        "id": 515162855,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1745963003
    },
    {
        "content": "<p>I thought finite char 0 domain over Z is free because of PID things?</p>",
        "id": 515163061,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1745963097
    },
    {
        "content": "<p>For the first approach, note that A is not remotely uniquely determined by K; indeed even if K is the rationals there are uncountably many choices for A up to isomorphism! For any set of primes you can let A be the rationals whose denominators only have prime factors in this set. So you can't reduce to the second approach. But I personally don't care about the generality of the first approach; the only advantage of it is that I might have to deal with <code>\\MCO \\Q</code>, but I've had to deal with this before and it's not too bad (it's known to be isomorphic to \\Z in mathlib and this is usually enough)</p>",
        "id": 515163076,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1745963103
    },
    {
        "content": "<p>Oh you are taking the localization so its not finite I see.</p>",
        "id": 515163114,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1745963125
    },
    {
        "content": "<p>I mean, in practice I'm not, it's just that I am slightly wary of tying myself down to the ring of integers because of this Z vs O_Q thing, and it's true for any localization which is why I asked.</p>",
        "id": 515163385,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1745963264
    },
    {
        "content": "<p>Our definition of finite adeles was refactored to allow a general A whose field of fractions was K so everything works in this generality, although I've never needed it because the one time I wanted to do calculations with the adeles of Q and was so scared of its integer ring that I made the refactor, I then discovered that working with the integers of Q was fine.</p>",
        "id": 515163539,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1745963331
    },
    {
        "content": "<p>Maybe I'll just stick to approach 2 for now, especially given that we have everything already to deal with that situation.</p>",
        "id": 515163943,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1745963533
    },
    {
        "content": "<p>Related: I guess we may then not have finiteness of class groups for S-integers?</p>",
        "id": 515164387,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1745963773
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Finiteness.20of.20residue.20fields.20for.20number.20fields/near/515164387\">said</a>:</p>\n<blockquote>\n<p>Related: I guess we may then not have finiteness of class groups for S-integers?</p>\n</blockquote>\n<p>Prove that it's a quotient of the usual class group so it's also finite?</p>",
        "id": 515509546,
        "sender_full_name": "Jz Pan",
        "timestamp": 1746107815
    },
    {
        "content": "<p>I think your approach 2 should imply approach 1. To prove approach 1 you only need to prove it for all maximal ideal thanks to unique factorization of ideals. Then any such <code>A</code> is automatically a localization of <code>ùìû K</code>. So if suffices to prove the result for <code>ùìû K</code>.</p>",
        "id": 515510124,
        "sender_full_name": "Jz Pan",
        "timestamp": 1746108005
    },
    {
        "content": "<p>The ring of integers <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi></mrow><annotation encoding=\"application/x-tex\">R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span></span> of a number field is a free $$\\mathbf Z$$$-module of finite rank, and if an ideal <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>I</mi></mrow><annotation encoding=\"application/x-tex\">I</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span></span></span></span> is nonzero, then it contains a nonzero integer <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> (the norm of any nonzero element) , which implies that the quotient <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi><mi mathvariant=\"normal\">/</mi><mi>I</mi></mrow><annotation encoding=\"application/x-tex\">R/I</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mord\">/</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span></span></span></span> is a quotient of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi><mi mathvariant=\"normal\">/</mi><mi>n</mi><mi>R</mi></mrow><annotation encoding=\"application/x-tex\">R/nR</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mord\">/</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span></span>, which is finite.</p>",
        "id": 515537925,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1746116681
    }
]