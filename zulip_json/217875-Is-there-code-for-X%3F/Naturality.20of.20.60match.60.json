[
    {
        "content": "<p>Continuation of <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Naturality.20of.20.60ite.60.2E\">#Is there code for X? &gt; Naturality of &#96;ite&#96;.</a>, but asking a different question.</p>\n<p>Basically, is there an <code>apply_match</code> in the same way there is an <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=apply_ite%3F#doc\">docs#apply_ite?</a></p>",
        "id": 501806128,
        "sender_full_name": "Ayhon",
        "timestamp": 1740490088
    },
    {
        "content": "<p>Every matcher is different, what would the statement be? You can use <code>split</code> to split matches. What's your use case?</p>",
        "id": 501806442,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1740490198
    },
    {
        "content": "<p><em>I'm guessing this may be a bit more complicated, since <code>match</code> works on arbitrary inductive data types, and not just boolean expressions like <code>ite</code>. I know that for every inductive data type some special functions are defined like <code>rec</code>, although I'm not sure if <code>match</code> is implemented in terms of those.</em></p>",
        "id": 501806531,
        "sender_full_name": "Ayhon",
        "timestamp": 1740490211
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">isZero</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Bool</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">false</span>\n\n<span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">isZero</span><span class=\"bp\">.</span><span class=\"n\">match_1</span>\n\n<span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">pow</span><span class=\"bp\">.</span><span class=\"n\">match_1</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">isZero</span><span class=\"bp\">.</span><span class=\"n\">match_1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">pow</span><span class=\"bp\">.</span><span class=\"n\">match_1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">isSucc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Bool</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">true</span>\n\n<span class=\"c1\">-- uses Nat.isZero.match_1</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">pp</span><span class=\"bp\">.</span><span class=\"n\">explicit</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">isSucc</span>\n</code></pre></div>",
        "id": 501807311,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1740490439
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Naturality.20of.20.60match.60/near/501806442\">said</a>:</p>\n<blockquote>\n<p>Every matcher is different, what would the statement be? You can use <code>split</code> to split matches. What's your use case?</p>\n</blockquote>\n<p>I have a function <code>toSet</code> which transforms binary search trees into the sets they represent. As an example, consider <a href=\"https://live.lean-lang.org/#codez=JYWwDg9gTgLgBAWQIYwBYBtgCMBQPgB2AJgK4DGMwAbgKZwBCAygCpQ00BcczAnmHQHdUNNjgA+cAHLB0cLk1btxUiEToAKAB5dJKAJTr0NAGbwowAOaoY8lmxp7bimnjXGGd9gDoYERjRsPZzgAWgA+OH94XRhlaVkAXgjAUCI4ONU6TTgjUzhzK3gkuABvTQBfOEAqImyTGB8/AKq8y2t6qNcTIPsvMjYUTikUUIiFe2UABjgpovjlVABqAEY4GYy4VDh1Ue9emn71vU3tmh6+mDpUPTwcGk0kcCN1VB19HC4tzxPd/cu2xoTNgAxQgAZwCXigSAIFguej+sQ4AKwPBwUxIBGMEHQRC6OzOLimINAYFRcBB0CgKKAA\">this code</a></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">BSTree</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Nil</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BSTree</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Node</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)(</span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BSTree</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">BSTree</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">BSTree</span><span class=\"bp\">.</span><span class=\"n\">toSet</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BSTree</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Nil</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">∅</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Node</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">∪</span><span class=\"w\"> </span><span class=\"n\">left</span><span class=\"bp\">.</span><span class=\"n\">toSet</span><span class=\"w\"> </span><span class=\"bp\">∪</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"bp\">.</span><span class=\"n\">toSet</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">BSTree</span><span class=\"bp\">.</span><span class=\"n\">create</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">BSTree</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\">   </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Nil</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Node</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">BSTree</span><span class=\"bp\">.</span><span class=\"n\">create</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">BSTree</span><span class=\"bp\">.</span><span class=\"n\">create</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">)</span>\n\n\n<span class=\"kn\">example</span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span>\n<span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">BSTree</span><span class=\"bp\">.</span><span class=\"n\">create</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toSet</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toSet</span>\n<span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">BSTree</span><span class=\"bp\">.</span><span class=\"n\">create</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>Admittedly, in this example the gains are not substantial since I'd need to destruct <code>h</code> in any case. Some of the proofs I've been doing, however, try to show the equivalence of two operations, and I've found myself wanting <code>match</code> to work this way to simplify expressions a bit (because the operation is the identity unless some specific conditions apply, for instance)</p>",
        "id": 501809081,
        "sender_full_name": "Ayhon",
        "timestamp": 1740490945
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Naturality.20of.20.60match.60/near/501806442\">said</a>:</p>\n<blockquote>\n<p>Every matcher is different, what would the statement be? You can use <code>split</code> to split matches. What's your use case?</p>\n</blockquote>\n<p>Maybe there can be a tactic to do this.</p>",
        "id": 501834755,
        "sender_full_name": "Jz Pan",
        "timestamp": 1740497519
    },
    {
        "content": "<p>A simproc would work too</p>",
        "id": 501835435,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1740497683
    },
    {
        "content": "<p>I worked in that direction in <a href=\"https://github.com/leanprover/lean4/pull/5923\">https://github.com/leanprover/lean4/pull/5923</a>. Unclear when I’ll pick it up again, but I think it has merit.</p>",
        "id": 502023226,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1740569238
    }
]