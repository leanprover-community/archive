[
    {
        "content": "<p>I'm sure someone has done this (indeed various nontrivial class groups have been computed in Lean), but what's the easiest way to produce an example with what we have in mathlib?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsDedekindDomain</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ideal</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"bp\">.</span><span class=\"n\">IsPrincipal</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>Context: I need it for <a href=\"https://math.stackexchange.com/a/5090562/12932\">this counterexample</a>.</p>",
        "id": 536114529,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1756158459
    },
    {
        "content": "<p>It's a bit ridiculous, but the API of cyclotomic fields and of the norm is well developed, so I think the usual proof for the 23-th cyclotomic field should be doable.</p>",
        "id": 536135178,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1756170950
    },
    {
        "content": "<p>The only reason I am proposing cyclotomic fields rather than quadratic fields is that the API is probably better.</p>",
        "id": 536135227,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1756170984
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130384\">Riccardo Brasca</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Non-principal.20ideal.20in.20Dedekind.20domain/near/536135227\">said</a>:</p>\n<blockquote>\n<p>The only reason I am proposing cyclotomic fields rather than quadratic fields is that the API is probably better.</p>\n</blockquote>\n<p>This will be fixed by the series of PR on  quadratic algebra I’m currently doing! :-)</p>",
        "id": 536137893,
        "sender_full_name": "Edison Xie",
        "timestamp": 1756172931
    },
    {
        "content": "<p>It's not hard to prove that there's no solution to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>a</mi><mn>2</mn></msup><mo>+</mo><mn>5</mn><msup><mi>b</mi><mn>2</mn></msup><mo>=</mo><mo>±</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">a^2+5b^2=\\pm2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\">5</span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">±</span><span class=\"mord\">2</span></span></span></span> in integers so I would be tempted to try <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">Z</mi><mo stretchy=\"false\">[</mo><msqrt><mrow><mo>−</mo><mn>5</mn></mrow></msqrt><mo stretchy=\"false\">]</mo><mo>⊇</mo><mo stretchy=\"false\">(</mo><mn>2</mn><mo separator=\"true\">,</mo><mn>1</mn><mo>+</mo><msqrt><mrow><mo>−</mo><mn>5</mn></mrow></msqrt><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\Z[\\sqrt{-5}]\\supseteq(2,1+\\sqrt{-5})</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1156em;vertical-align:-0.25em;\"></span><span class=\"mord mathbb\">Z</span><span class=\"mopen\">[</span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8656em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord\">−</span><span class=\"mord\">5</span></span></span><span style=\"top:-2.8256em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.08em\" viewBox=\"0 0 400000 1080\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z\"/></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1744em;\"><span></span></span></span></span></span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">⊇</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1156em;vertical-align:-0.25em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8656em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord\">−</span><span class=\"mord\">5</span></span></span><span style=\"top:-2.8256em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.08em\" viewBox=\"0 0 400000 1080\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z\"/></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1744em;\"><span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> despite these API claims.</p>",
        "id": 536198854,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1756201432
    },
    {
        "content": "<p>Yeah, I think that's probably the easiest. We could use <code>Zsqrtd (-5)</code> to do the computations (with <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/RingTheory/Ideal/Norm/AbsNorm.html#Ideal.absNorm_span_singleton\">Ideal.absNorm_span_singleton</a>) and show it's isomorphic to <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/NumberTheory/NumberField/Basic.html#NumberField.RingOfIntegers\">NumberField.RingOfIntegers</a> in ℚ(√-5) to show it's a Dedekind domain.</p>",
        "id": 536200538,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1756202037
    },
    {
        "content": "<p>Okay <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/RingTheory/DedekindDomain/IntegralClosure.html#IsIntegralClosure.isDedekindDomain\">IsIntegralClosure.isDedekindDomain</a> should make our life a lot easier. We could do <a href=\"https://math.stackexchange.com/a/556292/12932\">this</a> <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">R</mi><mo stretchy=\"false\">[</mo><mi>X</mi><mo separator=\"true\">,</mo><mi>Y</mi><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">/</mi><mo stretchy=\"false\">(</mo><msup><mi>X</mi><mn>2</mn></msup><mo>+</mo><msup><mi>Y</mi><mn>2</mn></msup><mo>−</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\mathbb{R}[X,Y]/(X^2+Y^2-1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord mathbb\">R</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mclose\">]</span><span class=\"mord\">/</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span> example as well. Or the coordinate ring of an elliptic curve, which we already showed to contain non-principal ideals.</p>",
        "id": 536204047,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1756203401
    },
    {
        "content": "<p>I've worked out a proof to show the <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/AlgebraicGeometry/EllipticCurve/Affine/Point.html#WeierstrassCurve.Affine.CoordinateRing\">CoordinateRing</a> of an elliptic curve is integrally closed. It works as follows: rather than using <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/AlgebraicGeometry/EllipticCurve/Affine/Point.html#WeierstrassCurve.Affine.FunctionField\">FunctionField</a> it would be more convenient to use K(X)[Y]/W(X,Y) as a model of the fraction ring of the coordinate ring K[X][Y]/W(X,Y). An arbitrary element of the function field can be written as p+qY with p,q in K(X). (Probably we should use QuadraticAlgebra for this and CoordinateRing.) We want to show that if p+qY is integral over the coordinate ring (equivalently, over K[X]) then p and q are actually in K[X]. p+qY being integral <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/FieldTheory/Minpoly/IsIntegrallyClosed.html#minpoly.isIntegrallyClosed_eq_field_fractions\">implies</a> that the minimal polynomial over K(X) has coefficients in K[X], i.e. the trace and norm of p+qY are in K[X]. The discriminant of the minpoly is Tr²-4N which must also be in K[X] and can be computed to equal <code>q² * W.twoTorsionPolynomial</code>, so if <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/AlgebraicGeometry/EllipticCurve/Weierstrass.html#WeierstrassCurve.twoTorsionPolynomial\">twoTorsionPolynomial</a> has no double root then q must be in K[X], then the norm being in K[X] means that p satisfies a monic quadratic equation with coefficients in K[X], which implies that p is integral too. (We have Tr(p+qY)=2p-(a₁X+a₃)q; See <a href=\"https://github.com/leanprover-community/mathlib4/blob/9ec894fd866b12105089f14d0b26d63dab51d63a/Mathlib/AlgebraicGeometry/EllipticCurve/Affine/Point.lean#L393-L400\">norm_smul_basis</a> for N(p+qY).) Since the discriminant of twoTorsionPolynomial is 16 times the discriminant of the elliptic curve, if the characteristic is not 2 then we're done.</p>\n<p>In characteristic 2 we have Tr(p+qY)=(a₁X+a₃)q so if a₁=0 then a₃≠0 (since Δ ≠ 0) therefore q ∈ K[X] and we are done. In the a₁≠0 case, it's most convenient to make a coordinate change so that the Weierstrass equation becomes Y²+XY=X³+a₂X²+a₆ (first replace X by (X+a₃)/a₁, then replace Y by Y+a₄; this is the ordinary (non-supersingular) case in char 2, see Silverman A1.1(c)). Then a₆ = Δ ≠ 0, Xq = Tr(p+qY) ∈ K[X] and p² + Xpq + (X³+a₂X²+a₆)q² = N(p+qY) ∈ K[X]. Multiplying the latter expression by X² we see that (Xp)² + X(Xq)(Xp) + (X³+a₂X²+a₆)(Xq)² ∈ X²K[X], so Xp satisfies a monic quadratic equation with coefficients in K[X] and thus Xp ∈ K[X]. Write Xp = p₀ + p₁X and Xq = q₀ + q₁X in K[X]/X²K[X] with p₀,p₁,q₀,q₁ ∈ K, then we get p₀² + Xp₀q₀ + a₆q₀² = 0 in K[X]/X²K[X], i.e. p₀q₀ = 0 and p₀² + a₆q₀² = 0, so p₀ = q₀ = 0, i.e. X divides both Xp and Xq in K[X], so p and q are in fact in K[X].</p>\n<p>I'll probably make this a project in an upcoming workshop. If anyone has code that helps towards this please let me know.</p>",
        "id": 538662428,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1757513444
    }
]