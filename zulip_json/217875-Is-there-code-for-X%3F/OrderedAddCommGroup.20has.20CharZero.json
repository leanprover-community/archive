[
    {
        "content": "<p>If an ordered group satisfies <code>0 &lt; 1</code>, then <code>NatCast</code> should be injective, right? Do we have something like this?</p>",
        "id": 506295250,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1742259575
    },
    {
        "content": "<p>We have <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=StrictOrderedSemiring.toCharZero#doc\">docs#StrictOrderedSemiring.toCharZero</a></p>",
        "id": 506295736,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1742259770
    },
    {
        "content": "<p>That's stronger than what I have, unfortunately, since my structure has no multiplication.</p>",
        "id": 506295814,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1742259804
    },
    {
        "content": "<p>Whatever you mean by \"group\" it won't have both a 0 and a 1</p>",
        "id": 506295844,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1742259822
    },
    {
        "content": "<p>Can you formalise the question?</p>",
        "id": 506295925,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1742259848
    },
    {
        "content": "<p>Its proof doesn't need multiplication, so we could generalize this?</p>",
        "id": 506296015,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1742259891
    },
    {
        "content": "<p>Do we have some kind of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AddMonoidWithOne#doc\">docs#AddMonoidWithOne</a></p>",
        "id": 506296037,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1742259903
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AddCommGroupWithOne#doc\">docs#AddCommGroupWithOne</a> is my relevant structure</p>",
        "id": 506296038,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1742259904
    },
    {
        "content": "<p>Though it might even work for non-commutative groups or monoids, I'm not sure</p>",
        "id": 506296070,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1742259923
    },
    {
        "content": "<p>You'll need the order to be compatible with the addition so it's not over yet</p>",
        "id": 506296113,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1742259946
    },
    {
        "content": "<p><code>AddMonoidWithOne</code> does seem too weak since the order doesn't interact with the structure</p>",
        "id": 506296265,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1742260003
    },
    {
        "content": "<p>But perhaps <code>AddMonoidWithOne</code> + <code>AddRightStrictMono</code> + <code>0 &lt; 1</code> is enough?</p>",
        "id": 506296324,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1742260030
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddMonoidWithOne</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">PartialOrder</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ZeroLEOneClass</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">NeZero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddLeftStrictMono</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CharZero</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">cast_injective</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">strictMono_nat_of_lt_succ</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">cast_succ</span><span class=\"o\">]</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">lt_add_one</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">injective</span>\n</code></pre></div>",
        "id": 506296353,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1742260047
    },
    {
        "content": "<p>That works for me!</p>",
        "id": 506296479,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1742260102
    },
    {
        "content": "<p>Does this generalize <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=StrictOrderedSemiring.toCharZero#doc\">docs#StrictOrderedSemiring.toCharZero</a>, or is it an incomparable set of assumptions?</p>",
        "id": 506296847,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1742260287
    },
    {
        "content": "<p>95% sure its strictly more general but I'll check</p>",
        "id": 506297217,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1742260467
    },
    {
        "content": "<p>It generalizes!</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddMonoidWithOne</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">PartialOrder</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ZeroLEOneClass</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NeZero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddLeftStrictMono</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CharZero</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">cast_injective</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">strictMono_nat_of_lt_succ</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">cast_succ</span><span class=\"o\">]</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">lt_add_one</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">injective</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">StrictOrderedSemiring</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CharZero</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n</code></pre></div>",
        "id": 506297220,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1742260468
    },
    {
        "content": "<p>Would you like to go ahead and PR this?</p>",
        "id": 506297332,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1742260516
    },
    {
        "content": "<p>Sure</p>",
        "id": 506297346,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1742260528
    },
    {
        "content": "<p>Should I keep the name?</p>",
        "id": 506298290,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1742260956
    },
    {
        "content": "<p>I think the deprecation policy generally doesn't apply to instance names</p>",
        "id": 506298330,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1742260979
    },
    {
        "content": "<p>You could call the new instance something like <code>AddMonoidWithOne.toCharZero</code> and just remove the old one</p>",
        "id": 506298367,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1742261001
    },
    {
        "content": "<p>It feels weird having an <code>AddMonoidWithOne</code> class in the middle of all the <code>StrictOrderedSemiring</code> classes</p>",
        "id": 506298681,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1742261148
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/23034\">#23034</a></p>",
        "id": 506299719,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1742261560
    },
    {
        "content": "<p>Can that instance perhaps be moved to some earlier file?</p>",
        "id": 506300011,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1742261699
    },
    {
        "content": "<p>What does <code>#find_home AddMonoidWithOne.toCharZero</code> give you?</p>",
        "id": 506300040,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1742261715
    },
    {
        "content": "<p>It gave me <code>Mathlib/Algebra/Order/Ring/Defs</code> (the same file)</p>",
        "id": 506300289,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1742261843
    },
    {
        "content": "<p>I'm fairly sure I already made this generalization somewhere, but I think I scoped the instance for performance reasons. I'll try to find it tomorrow.</p>",
        "id": 506303350,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1742263209
    },
    {
        "content": "<p><code>MathlibTest.linarith</code> failed with timeout at <code>whnf</code></p>",
        "id": 506305340,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1742264104
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"459227\">@Violeta Hernández</span> Do you still need this?</p>",
        "id": 512144323,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1744654139
    }
]