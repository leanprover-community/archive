[
    {
        "content": "<p>I need, in particular, this fact:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">ker_range_antitone</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">hA</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">.</span><span class=\"n\">IsHermitian</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hB</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"bp\">.</span><span class=\"n\">IsHermitian</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">.</span><span class=\"n\">toLin'</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"bp\">.</span><span class=\"n\">toLin'</span><span class=\"w\"> </span><span class=\"bp\">‚Üî</span>\n<span class=\"w\">    </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">ker</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"bp\">.</span><span class=\"n\">toLin'</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">ker</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">.</span><span class=\"n\">toLin'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>and I've got a number of other places where I'm running into similar facts I need. Two questions:</p>\n<ul>\n<li>Tips to go about proving this? I'm not very comfortable with some of the pretty general linear algebra in mathlib. (I'm so used to just thinking about real/complex matrices that I start to stumble when I go beyond that.) I thought there would be at least some facts in Mathlib relating <code>LinearMap.ker</code> and LinearMap.range`, but I can't find basically any! I expected at <em>least</em> the fact that they're complementary subspaces, but I couldn't find that anywhere.</li>\n<li>The theorem statement above is, of course, really just about the 0-eigenspace of a Hermitian operator. All I \"really\" am saying is that \"[nonzero eigenspace of A] &lt;= [nonzero eigenspace of B] iff [zero eigenspace of B] &lt;= [zero eigenspace of A]\", which is maybe easier to do. There is <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Module.End.eigenspace#doc\">docs#Module.End.eigenspace</a>, but I similarly have a hard time eliciting useful stuff from that.</li>\n</ul>",
        "id": 521587161,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1748803485
    },
    {
        "content": "<p>My instinct would be to write down the proof for Hermitian linear maps and deduce the result for matrices. Here's one direction: if <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>A</mi><mi>V</mi><mo>‚äÜ</mo><mi>B</mi><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">AV\\subseteq BV</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">‚äÜ</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>v</mi><mo>‚àà</mo><mi>k</mi><mi>e</mi><mi>r</mi><mo stretchy=\"false\">(</mo><mi>B</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">v\\in ker(B)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">‚àà</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">er</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mclose\">)</span></span></span></span> then for all <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>w</mi></mrow><annotation encoding=\"application/x-tex\">w</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span></span></span></span> we have <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>B</mi><mi>v</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">Bv=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span> so for all w we have <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>B</mi><mi>w</mi><mo separator=\"true\">,</mo><mi>v</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mo stretchy=\"false\">(</mo><mi>w</mi><mo separator=\"true\">,</mo><mi>B</mi><mi>v</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">(Bw,v)=(w,Bv)=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">Bw</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>, and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>A</mi><mi>V</mi><mo>‚äÜ</mo><mi>B</mi><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">AV\\subseteq BV</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">‚äÜ</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span> means that for all <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> we have <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>A</mi><mi>x</mi><mo separator=\"true\">,</mo><mi>v</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">(Ax,v)=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span> meaning <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>A</mi><mi>v</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">(x,Av)=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span> and hence <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>A</mi><mi>v</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">Av=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span> (no finite-dimensionality hypotheses needed).</p>",
        "id": 521598950,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748810554
    },
    {
        "content": "<p>Hmm, I guess I hadn't actually thought about trying to do that 'directly', I thought I would need to appeal to something more powerful. Well, here's that first half then:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">ker_range_antitone</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">RCLike</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">InnerProductSpace</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚Çó</span><span class=\"o\">[</span><span class=\"n\">ùïú</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">hA</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">.</span><span class=\"n\">IsSymmetric</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hB</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"bp\">.</span><span class=\"n\">IsSymmetric</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">‚Üî</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">ker</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">ker</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">constructor</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">hv</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">mem_ker</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hv</span><span class=\"w\"> </span><span class=\"bp\">‚ä¢</span>\n<span class=\"w\">    </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">y</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"bp\">‚ü©</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÉ</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">inner_self_eq_zero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">hA</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hB</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hv</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">inner_zero_right</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>so that's progress. But then applying to Matrices seems like some sort of instance hell, which means I'm probably doing something wrong.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">ker_range_antitone</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">hA</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">.</span><span class=\"n\">IsHermitian</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hB</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"bp\">.</span><span class=\"n\">IsHermitian</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">.</span><span class=\"n\">toLin'</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"bp\">.</span><span class=\"n\">toLin'</span><span class=\"w\"> </span><span class=\"bp\">‚Üî</span>\n<span class=\"w\">    </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">ker</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"bp\">.</span><span class=\"n\">toLin'</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">ker</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">.</span><span class=\"n\">toLin'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">InnerProductSpace</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"c1\">--PiLp.innerProductSpace (ùïú := ‚ÑÇ) (fun (i : d) ‚Ü¶ ‚ÑÇ)</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">ker_range_antitone</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">.</span><span class=\"n\">toLin'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"bp\">.</span><span class=\"n\">toLin'</span><span class=\"o\">)</span>\n<span class=\"c\">/-</span>\n<span class=\"cm\">application type mismatch</span>\n<span class=\"cm\">  @LinearMap.ker_range_antitone (d ‚Üí ‚ÑÇ) ‚ÑÇ ?m.61525 ?m.61526 ?m.61527 (toLin' A)</span>\n<span class=\"cm\">argument</span>\n<span class=\"cm\">  toLin' A</span>\n<span class=\"cm\">has type</span>\n<span class=\"cm\">  @LinearMap ‚ÑÇ ‚ÑÇ CommSemiring.toSemiring CommSemiring.toSemiring (RingHom.id ‚ÑÇ) (d ‚Üí ‚ÑÇ) (d ‚Üí ‚ÑÇ) Pi.addCommMonoid</span>\n<span class=\"cm\">    Pi.addCommMonoid (Pi.Function.module d ‚ÑÇ ‚ÑÇ) (Pi.Function.module d ‚ÑÇ ‚ÑÇ) : Type u_1</span>\n<span class=\"cm\">but is expected to have type</span>\n<span class=\"cm\">  @LinearMap ‚ÑÇ ‚ÑÇ DivisionSemiring.toSemiring DivisionSemiring.toSemiring (RingHom.id ‚ÑÇ) (d ‚Üí ‚ÑÇ) (d ‚Üí ‚ÑÇ)</span>\n<span class=\"cm\">    ENormedAddCommMonoid.toAddCommMonoid ENormedAddCommMonoid.toAddCommMonoid NormedSpace.toModule</span>\n<span class=\"cm\">    NormedSpace.toModule : Type u_1Lean 4</span>\n<span class=\"cm\">  -/</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>:(</p>",
        "id": 521607936,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1748816419
    },
    {
        "content": "<p>which makes me wonder, again, if this is a sign I should be stating this differently to start with. :/</p>",
        "id": 521607962,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1748816441
    },
    {
        "content": "<p>You maybe want <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix.toEuclideanLin#doc\">docs#Matrix.toEuclideanLin</a></p>",
        "id": 521608351,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748816727
    },
    {
        "content": "<p>That is, you need to first move to euclidean space (by mapping / comapping through WithLp.linearEquiv), then you should be able to apply the lemma</p>",
        "id": 521608469,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748816793
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"448405\">@Alex Meiburg</span> here is the steps I took to debug (which resulted in the same conclusion as Eric):</p>\n<ol>\n<li>I first noted that the error started at <code>A.toLin'</code>, so I replaced it with <code>by convert A.toLin'</code> to see what the conflicting instance was, and it gave me <code>NormedSpace.toModule = Pi.Function.module d ‚ÑÇ ‚ÑÇ</code>.</li>\n<li>I tried to trace that a bit to no avail, so this step was not fruitful.</li>\n<li>Then I think about what the main connection between the two lemmas are: it's the fact that symmetric matrices are supposed to correspond to Hermitian matrices (i.e. the main difference between the two lemmas).</li>\n<li>Then I went to the <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/LinearAlgebra/Matrix/Hermitian.html#Matrix.IsHermitian\">docs for Hermitian</a>, where this equivalence is likely defined.</li>\n<li>Then I searched (Ctrl+F) for \"symmetric\", and finally found the lemma <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/LinearAlgebra/Matrix/Hermitian.html#Matrix.isHermitian_iff_isSymmetric\">Matrix.isHermitian_iff_isSymmetric</a>: <code>A.IsHermitian ‚Üî (toEuclideanLin A).IsSymmetric</code>.</li>\n<li>This suggests that <code>toEuclideanLin</code> is actually the idiomatic way to convert between matrices and linear maps (under the context of inner product), and this lemma gives you exactly the key you needed to translate between the two objects.</li>\n</ol>",
        "id": 521609031,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1748817169
    },
    {
        "content": "<p>Really you got in trouble as soon as you wrote <code>have _ : InnerProductSpace ‚ÑÇ (d ‚Üí ‚ÑÇ) :=</code></p>",
        "id": 521609384,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748817421
    },
    {
        "content": "<p>oh wow I don't know how I missed that line</p>",
        "id": 521609449,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1748817478
    },
    {
        "content": "<p>Ending with <code>PiLp.innerProductSpace</code> is obviously a bad idea because it defeats the type synonym, ending with <code>sorry</code> is just as bad but less obviously so</p>",
        "id": 521609535,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748817526
    },
    {
        "content": "<p>Alright thanks guys! Yeah the PiLp stuff is still a bit confusing to me and I haven't sat down and learned how to work with it properly. And I hadn't ever seen toEuclideanLin.</p>",
        "id": 521615563,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1748821746
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span> thanks especially for showing me your thinking/debugging process, that was very helpful</p>",
        "id": 521615616,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1748821777
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"448405\">Alex Meiburg</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/More.20stuff.20about.20kernels.2Franges.20of.20matrices/near/521615563\">said</a>:</p>\n<blockquote>\n<p>Yeah the PiLp stuff is still a bit confusing to me and I haven't sat down and learned how to work with it properly.</p>\n</blockquote>\n<p>Since it hasn't been spelled out to you explicitly yet, instances contain data (e.g. how to add stuff together), and <code>have</code> destroys data (at least in my understanding, I could be wrong here). If you're stuck because of instances, it isn't a good idea to provide them using <code>have</code>. <code>let</code> is preferred over <code>have</code>, but it is still not preferred. It is usually caused by an entirely different problem that cannot be solved locally just by using <code>let</code>.</p>\n<blockquote>\n<p>And I hadn't ever seen toEuclideanLin.</p>\n</blockquote>\n<p>And neither have I, and that's why loogle and the docs etc. exist, so that you can find idiomatic ways to do the things you want, in this case to convert between <code>IsHermitian</code> and <code>IsSymmetric</code>.</p>",
        "id": 521616004,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1748822025
    },
    {
        "content": "<p>Yeah, that <code>have</code> was just while I was trying to debug it myself, I know it's trouble <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span><br>\nAnd I used loogle -- plenty! And the docs. But I think I still need practice picking the right \"culprits\" to home in on</p>",
        "id": 521616262,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1748822203
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/stream/217875-Is-there-code-for-X.3F/topic/More.20stuff.20about.20kernels.2Franges.20of.20matrices/near/521616004\">said</a>:</p>\n<blockquote>\n<p>Since it hasn't been spelled out to you explicitly yet, instances contain data (e.g. how to add stuff together), and <code>have</code> destroys data (at least in my understanding,</p>\n</blockquote>\n<p>This is morally close enough, but in this particular case the data was <code>sorry</code> so you're already hosed whether the data is forgotten or not.</p>",
        "id": 521618405,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748823510
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"376152\">@Paul Lezeau</span> was working towards a refactor that would make WithLp harder to trip over, but has been busy and this reviewer hasn't been very prompt either</p>",
        "id": 521618503,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748823594
    },
    {
        "content": "<p>The PR for that refactor is <a href=\"https://github.com/leanprover-community/mathlib4/pull/24261\">#24261</a>. If this is blocking other people I can make this a priority:)</p>",
        "id": 521735786,
        "sender_full_name": "Paul Lezeau",
        "timestamp": 1748868062
    },
    {
        "content": "<p>Got back to this now, got it <a href=\"https://live.lean-lang.org/#codez=JYWwDg9gTgLgBAWQIYwBYBtgCMBQOC0+AIhAKYDOAdgOTxSkCOArsPXANoBiwlwMpRUKUrlgESknQBdOOQhw+1cnHEKYyiAHdKONKWikQcADI9SSKMjAA6ANakoAfXSlH9pxABmjqEkoBzVz8YPnFSOABvADU4QFYNwB1duAAuOAAVAE8wUgAqAF8OACUAYVN7OPiZdgA5aBBSABMAQXr6oogQEABxKAgmMDgoyoBJSkoHAAUe+qYAYxgAZTAkGfCEgakcOC3IxrgAIWSBuEAkwkB0gnYEmSj8gApUXZTG6yHyefSO0hgoYBmASjg7gcUntnq93nUvj9/ndDr4AuFdoATIjgcMC+3+SU223c+zgyJxDwAvHAsOksTwvvIAG5wVBUrFQTQcOogNwOGQoWk0wBFRFiIFgYEgeHBABfk6QANLT0oBL8kOgGAiOAS3HpODE3Y3XZUjHE0myUBLOBMUQBOAAAVQAPVmt+vwZTPYgATCBSjByOcikdDeRiOABeDnkNzWSWJCV+kqd93DUslqD2Mapkp4Yycfp6PmA/lQMA2ulQ+noRlMYwsVjsrtRQUoIRgYUiMSDaUyOXy7GKpVWFQ4NSgdSaLTaHW6vX6gw4I2Tkwg0zmi2WHfWWK4PD4AiEIjEEnQ5XWO1xKRiZwuneuAPuhyeLzeH0hf1PQP2oKvEO+t8x2xRfjRSI/8NxgBTCOAcQOfEHDgIkSTJLYjXCdxnFcWCvB8T9K2rWsz1jBkKR6Wk4B9UUlSgTx0GlLEXHgLBkmJWNrFIDNhCpUg5mgPYkFEZRCPQLFUCQBjaUAIIJKLgAB5WBUHEWpJBYtjrHIJhWXoMAoGoElLUVW0tlEcAfHtCNdkcRUo24ERPhkuTHCQFo3TMmZ2jALcbmUYNIgUOAAB9aRBWjAkoKlJCYCgUSIlziQABjgXJfg5eBUD4rEbJ8uBORi1UAD4sS2YR+CgDgAEYNnfeL/CgdK4AAdpRHS4CM90YFM1kUEFGZUHy984Ey0D2AAJkTFr30YJhJGUMLCTS1rtn5QVhRFYAY2AWUnOAEr31kzxPB+AKDhuCjgH+UKIL1cAOHIMSmXVbbdrgMLPB6IwLTQYByF61rNP6cR0BVJdjNqllHDW9AsslaqTJ+pheATOAvn88zKHqKLaUWsaNP1DgsFmp7ysZDggdqmzwHQX7gH+hxDJ4Gq6vMmBGotG5sesP6srgfTHEipa2qrDruoUSVOqejLmEGu8aLony/ICjiXJSUNAG8CABOuBACICXEtoUXbRsRiahUoUUZvh+biQRxHMfYaikDAOz0kcLz6MYmsoCkh7Aq3HWeCpN0QCYfHyHd9BAACCXnthepBDWNfx4axF6VEod6sdJkzZNZeLyBgX1/UlL2Pbdj3JVTCBzJaKMi3MSxTaKdBWPIawQFNzP0CjKuwCskA4ZirFSAAD2WeARUcGM+JI3N80MRAUG+NuyycCtodQsZInqbcUgyLI8kKEpgDKS4Y6rJs4FhjgiEY4B6iQLAXAAUQYHeZAiXZ72QSE253x+ElyLE7geMDQQACQcEA+GAPxoSxkOCCF438ex/wAckEqhcSym2sBWD+NZT6zEwPUcwlAix4hMGYWBNgEEgiQSgw+6DMF/mgTg4uNggLWEITMVBJDhTIhgZQ8eiCIDILocQvwmDgxYmYaWWCk9gihBnjcB6YDf4hD8I4YAq0ZFgmvC+Su/R7jQnET/CBlAZFyIek+T4SjDqxl+EAA\">done</a>. (The reverse direction was definitely uglier, maybe there's a better way.)</p>\n<p>I'm still surprised though, to me this is an \"early undergrad fact\" so it's weird that it's missing, and that's what maxes me wonder if I \"should\" be doing it an entirely different way.</p>\n<p>The undergrad proof I'm familiar with is: kernel and range are orthogonal complements, and orthogonal complements reverse containment of subspaces. One liner! I thought.</p>\n<p>When I try to write down <em>this</em> proof, I'm confounded with what the right kind of \"orthogonal complement\" to use. There's <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/LinearAlgebra/BilinearForm.html#BilinForm.orthogonal\">BilinForm.orthogonal</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/LinearAlgebra/SesquilinearForm.html#Submodule.orthogonalBilin\">Submodule.orthogonalBilin</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Analysis/InnerProductSpace/Projection.html#HasOrthogonalProjection\">HasOrthogonalProjection</a>, and <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Analysis/InnerProductSpace/Orthogonal.html#Submodule.orthogonal\">Submodule.orthogonal</a>.</p>\n<p>I try looking for things that relate one of these to range/kernel or the submodule ordering, and have little luck, e.g.</p>\n<p><span class=\"user-mention\" data-user-id=\"644391\">@loogle</span> _ ‚â§ _, Submodule.HasOrthogonalProjection</p>\n<p><span class=\"user-mention\" data-user-id=\"644391\">@loogle</span> LinearMap.range, Submodule.orthogonal</p>\n<p>and none of those look relevant. :(</p>\n<p>Is this just a 'gap' in mathlib? Is this an example of, the undergrad approach not matching the 'mature' approach to the topic? Am I doing something wrong?</p>",
        "id": 521793942,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1748882233
    },
    {
        "content": "<p><span aria-label=\"search\" class=\"emoji emoji-1f50d\" role=\"img\" title=\"search\">:search:</span> <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Analysis/InnerProductSpace/Projection.html#Submodule.sup_orthogonal_inf_of_completeSpace\">Submodule.sup_orthogonal_inf_of_completeSpace</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Analysis/InnerProductSpace/Projection.html#Submodule.orthogonalProjection_norm_le\">Submodule.orthogonalProjection_norm_le</a>, and <a href=\"https://loogle.lean-lang.org/?q=_%20%E2%89%A4%20_%2C%20Submodule.HasOrthogonalProjection\">4 more</a></p>",
        "id": 521793947,
        "sender_full_name": "loogle",
        "timestamp": 1748882234
    }
]