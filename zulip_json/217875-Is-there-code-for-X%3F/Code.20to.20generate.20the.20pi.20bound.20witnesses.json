[
    {
        "content": "<p>I want <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=pi_lt_3141593#doc\">docs#pi_lt_3141593</a>, but accurate to a bit over 20 decimal digits. However, <a href=\"https://github.com/leanprover-community/mathlib4/blob/1ea941a98905b2166146b60739226f3953fd5290/Mathlib/Data/Real/Pi/Bounds.lean#L122-L130\">the file in question</a> seems to lack the code to generate the witnesses to pass to <code>pi_upper_bound</code> and <code>pi_lower_bound</code>. Is that code somewhere else?</p>",
        "id": 470184223,
        "sender_full_name": "Geoffrey Irving",
        "timestamp": 1726326666
    },
    {
        "content": "<p>Dates back to <a href=\"https://github.com/leanprover-community/mathlib3/pull/2641\">https://github.com/leanprover-community/mathlib3/pull/2641</a>. Cc <span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> <span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span> </p>\n<p>(Fun fact: in 2021, data.real.pi was the last file to finish compiling in mathlib)</p>",
        "id": 470193773,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1726330367
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"kn\">from</span> <span class=\"nn\">sympy</span> <span class=\"kn\">import</span> <span class=\"o\">*</span>\n\n<span class=\"n\">a</span> <span class=\"o\">=</span> <span class=\"n\">ceiling</span><span class=\"p\">(</span><span class=\"n\">pi</span> <span class=\"o\">*</span> <span class=\"mi\">10</span><span class=\"o\">**</span><span class=\"mi\">20</span><span class=\"p\">)</span> <span class=\"o\">/</span> <span class=\"mi\">10</span><span class=\"o\">**</span><span class=\"mi\">20</span>\n\n<span class=\"n\">v</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n<span class=\"n\">n</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n<span class=\"k\">while</span> <span class=\"kc\">True</span><span class=\"p\">:</span>\n    <span class=\"n\">ov</span> <span class=\"o\">=</span> <span class=\"n\">sqrt</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"o\">+</span><span class=\"n\">v</span><span class=\"p\">)</span>\n    <span class=\"n\">v</span> <span class=\"o\">=</span> <span class=\"n\">Rational</span><span class=\"p\">(</span><span class=\"n\">N</span><span class=\"p\">(</span><span class=\"n\">sqrt</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"o\">+</span><span class=\"n\">v</span><span class=\"p\">)</span> <span class=\"o\">-</span> <span class=\"n\">Integer</span><span class=\"p\">(</span><span class=\"mi\">10</span><span class=\"p\">)</span><span class=\"o\">**-</span><span class=\"mi\">50</span><span class=\"p\">,</span> <span class=\"mi\">200</span><span class=\"p\">))</span><span class=\"o\">.</span><span class=\"n\">limit_denominator</span><span class=\"p\">(</span><span class=\"mi\">10</span><span class=\"o\">**</span><span class=\"mi\">30</span><span class=\"p\">)</span>\n    <span class=\"k\">assert</span> <span class=\"n\">v</span> <span class=\"o\">&lt;</span> <span class=\"n\">ov</span>\n    <span class=\"n\">n</span> <span class=\"o\">+=</span> <span class=\"mi\">1</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">v</span><span class=\"p\">,</span> <span class=\"n\">end</span><span class=\"o\">=</span><span class=\"s1\">', '</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"n\">sqrt</span><span class=\"p\">(</span><span class=\"mi\">2</span> <span class=\"o\">-</span> <span class=\"n\">v</span><span class=\"p\">)</span> <span class=\"o\">&lt;=</span> <span class=\"p\">(</span><span class=\"n\">a</span> <span class=\"o\">-</span> <span class=\"mi\">1</span> <span class=\"o\">/</span> <span class=\"mi\">4</span><span class=\"o\">**</span><span class=\"n\">Integer</span><span class=\"p\">(</span><span class=\"n\">n</span><span class=\"p\">))</span> <span class=\"o\">/</span> <span class=\"mi\">2</span> <span class=\"o\">**</span> <span class=\"p\">(</span><span class=\"n\">n</span> <span class=\"o\">+</span> <span class=\"mi\">1</span><span class=\"p\">):</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">'Found'</span><span class=\"p\">,</span> <span class=\"n\">n</span><span class=\"p\">)</span>\n        <span class=\"n\">exit</span><span class=\"p\">()</span>\n</code></pre></div>\n<p>Works, and gives</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">Pi</span><span class=\"bp\">.</span><span class=\"n\">Bounds</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Real</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">pi_lt_314159265358979323847</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">π</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mf\">3.14159265358979323847</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">pi_upper_bound</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">996006945974988813196889220419</span><span class=\"bp\">/</span><span class=\"mi\">704283265607817876268342353805</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1528727289839560965204682778132</span><span class=\"bp\">/</span><span class=\"mi\">827341247448235339825115450685</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">913292375055240730430733739016</span><span class=\"bp\">/</span><span class=\"mi\">465592415232699379941083095141</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1645499627344295663165371448860</span><span class=\"bp\">/</span><span class=\"mi\">826730748193197246562598642091</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1843770496365204984304341838590</span><span class=\"bp\">/</span><span class=\"mi\">922997038538017719302356904659</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1801550067486787619910104613255</span><span class=\"bp\">/</span><span class=\"mi\">901046412076563538906954658887</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1033174046160017800474497982984</span><span class=\"bp\">/</span><span class=\"mi\">516625924061941016458668416829</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1974620922996075539636083349702</span><span class=\"bp\">/</span><span class=\"mi\">987329047688340185766875596479</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1703055998465468187256469972669</span><span class=\"bp\">/</span><span class=\"mi\">851532006704509629847652593643</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1872204633070305500751814237511</span><span class=\"bp\">/</span><span class=\"mi\">936103417906035924020944339290</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">417873193942459288085664389516</span><span class=\"bp\">/</span><span class=\"mi\">208936658427256152595763823075</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">682652985453241103432668703344</span><span class=\"bp\">/</span><span class=\"mi\">341326517825821018406534464423</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">133449833823779055074913079027</span><span class=\"bp\">/</span><span class=\"mi\">66724918138531778002005419822</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1802627778656345399470040951302</span><span class=\"bp\">/</span><span class=\"mi\">901313893470514631525924232247</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1703298290358005799669120926811</span><span class=\"bp\">/</span><span class=\"mi\">851649146157524921098712387678</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1165765145162534233095510819562</span><span class=\"bp\">/</span><span class=\"mi\">582882572748696226264176946563</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">171409596335374790028974750983</span><span class=\"bp\">/</span><span class=\"mi\">85704798173841927131273528183</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1916415282813016720770367166539</span><span class=\"bp\">/</span><span class=\"mi\">958207641423710780288743319187</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">331175835363368698627932147613</span><span class=\"bp\">/</span><span class=\"mi\">165587917682427537107454982177</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1842175040313531583912899759640</span><span class=\"bp\">/</span><span class=\"mi\">921087520157799292786850855883</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">493760775740610311406049235446</span><span class=\"bp\">/</span><span class=\"mi\">246880387870374408374537871617</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1639492360311230529633260363591</span><span class=\"bp\">/</span><span class=\"mi\">819746180155672751777652349511</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1743864522386087812132460629377</span><span class=\"bp\">/</span><span class=\"mi\">871932261193059192729689867963</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">24351885390057283142606021981</span><span class=\"bp\">/</span><span class=\"mi\">12175942695028694938275012643</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1393660753917060167524729859317</span><span class=\"bp\">/</span><span class=\"mi\">696830376958530847311606012861</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1199992079080594763280056747597</span><span class=\"bp\">/</span><span class=\"mi\">599996039540297546000874209594</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">356242218080878554415612856627</span><span class=\"bp\">/</span><span class=\"mi\">178121109040439289406277007189</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1258407911404392877131542115857</span><span class=\"bp\">/</span><span class=\"mi\">629203955702196449338393661579</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1928835914023314404795982456526</span><span class=\"bp\">/</span><span class=\"mi\">964417957011657206525949495577</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1182695499413497707067870088277</span><span class=\"bp\">/</span><span class=\"mi\">591347749706748854166715368922</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1909465313407151114552936023714</span><span class=\"bp\">/</span><span class=\"mi\">954732656703575557531874429185</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1961572162124030319678167149025</span><span class=\"bp\">/</span><span class=\"mi\">980786081062015159904677606876</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">931266043180727152209784389970</span><span class=\"bp\">/</span><span class=\"mi\">465633021590363576112677467451</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1670978975783135072358731367231</span><span class=\"bp\">/</span><span class=\"mi\">835489487891567536182857979589</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>For lower bounds you can use </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">sympy</span><span class=\"w\"> </span><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"bp\">*</span>\n\n<span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">floor</span><span class=\"o\">(</span><span class=\"n\">pi</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"bp\">**</span><span class=\"mi\">20</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"bp\">**</span><span class=\"mi\">20</span>\n\n<span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">while</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">ov</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">sqrt</span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"bp\">+</span><span class=\"n\">v</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Rational</span><span class=\"o\">(</span><span class=\"n\">N</span><span class=\"o\">(</span><span class=\"n\">sqrt</span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"bp\">+</span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">Integer</span><span class=\"o\">(</span><span class=\"mi\">10</span><span class=\"o\">)</span><span class=\"bp\">**-</span><span class=\"mi\">50</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">200</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">limit_denominator</span><span class=\"o\">(</span><span class=\"mi\">10</span><span class=\"bp\">**</span><span class=\"mi\">30</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">assert</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">ov</span>\n<span class=\"w\">    </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">    </span><span class=\"n\">print</span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"kn\">end</span><span class=\"bp\">='</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">sqrt</span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">&gt;=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">**</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">):</span>\n<span class=\"w\">        </span><span class=\"n\">print</span><span class=\"o\">(</span><span class=\"bp\">'</span><span class=\"n\">Found'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"n\">exit</span><span class=\"o\">()</span>\n</code></pre></div>",
        "id": 470194616,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1726330660
    },
    {
        "content": "<p>Thank you!</p>",
        "id": 470196244,
        "sender_full_name": "Geoffrey Irving",
        "timestamp": 1726331840
    },
    {
        "content": "<p>Hmm, is there a typo in the docstring for <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Real/Pi/Bounds.html#Real.%C2%ABtacticPi_upper_bound[_,,]%C2%BB\"><code>Real.«tacticPi_upper_bound[_,,]»</code></a>? I feel like that last ≥ should be ≤.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Create</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">π</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">fixed</span><span class=\"w\"> </span><span class=\"n\">rational</span><span class=\"w\"> </span><span class=\"n\">number</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">given</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">witness</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">sequence</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">rational</span><span class=\"w\"> </span><span class=\"n\">numbers</span><span class=\"w\"> </span><span class=\"bp\">√</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"bp\">...</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"n\">satisfying</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">property</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"bp\">√</span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"kn\">where</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"bp\">√</span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"bp\">^</span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">^</span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"bp\">.</span>\n</code></pre></div>",
        "id": 470224612,
        "sender_full_name": "Geoffrey Irving",
        "timestamp": 1726344340
    },
    {
        "content": "<p>Would it be better to use a series that converges to <code>π</code> faster? E.g., there are various expressions with <code>atan</code>s, some of them converge pretty fast.</p>",
        "id": 470264738,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1726370867
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"514145\">Geoffrey Irving</span> <a href=\"#narrow/stream/217875-Is-there-code-for-X.3F/topic/Code.20to.20generate.20the.20pi.20bound.20witnesses/near/470184223\">said</a>:</p>\n<blockquote>\n<p>I want <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=pi_lt_3141593#doc\">docs#pi_lt_3141593</a>, but accurate to a bit over 20 decimal digits. However, <a href=\"https://github.com/leanprover-community/mathlib4/blob/1ea941a98905b2166146b60739226f3953fd5290/Mathlib/Data/Real/Pi/Bounds.lean#L122-L130\">the file in question</a> seems to lack the code to generate the witnesses to pass to <code>pi_upper_bound</code> and <code>pi_lower_bound</code>. Is that code somewhere else?</p>\n</blockquote>\n<p>I wrote some adhoc code in mathematica to optimize the witnesses back in the day. I doubt I still have it but I can try to reconstruct it</p>",
        "id": 470317140,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1726396359
    },
    {
        "content": "<p>Daniel’s code above works fine for my purposes (and the resulting proof is still fast). So quite low priority!</p>",
        "id": 470320543,
        "sender_full_name": "Geoffrey Irving",
        "timestamp": 1726398004
    },
    {
        "content": "<p>If you pr that bound, can you add the script in a comment?</p>",
        "id": 470321393,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1726398290
    },
    {
        "content": "<p>What's the obstruction in translating <span class=\"user-mention\" data-user-id=\"690858\">@Daniel Weber</span>'s example to lean; is it just the <code>limit_denominator</code>?</p>",
        "id": 470321641,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1726398392
    },
    {
        "content": "<p>N and sqrt are obstacles as well.</p>",
        "id": 470331088,
        "sender_full_name": "Geoffrey Irving",
        "timestamp": 1726404092
    },
    {
        "content": "<p>And pi, of course: one would need a separate (unverified) series for pi, though that’s easy.</p>",
        "id": 470331163,
        "sender_full_name": "Geoffrey Irving",
        "timestamp": 1726404125
    },
    {
        "content": "<p>For Lean it would probably be better to replace <code>limit_denominator</code> by <a href=\"https://en.wikipedia.org/wiki/Stern%E2%80%93Brocot_tree#Mediants_and_binary_search\">Stern–Brocot tree</a> search, and then you only need to compare to the square root</p>",
        "id": 470331377,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1726404295
    },
    {
        "content": "<p>Here's an optimization of the proof in this case, containing a few new tricks:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">pi_lt_3141593'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">π</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mf\">3.14159265358979323847</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">pi_upper_bound</span><span class=\"w\"> </span><span class=\"o\">[</span>\n<span class=\"w\">    </span><span class=\"mi\">215157040700</span><span class=\"bp\">/</span><span class=\"mi\">152139002499</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">936715022285</span><span class=\"bp\">/</span><span class=\"mi\">506946517009</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1760670193473</span><span class=\"bp\">/</span><span class=\"mi\">897581880893</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">6049918861</span><span class=\"bp\">/</span><span class=\"mi\">628200981455</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">8543385003</span><span class=\"bp\">/</span><span class=\"mi\">3546315642356</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">2687504973</span><span class=\"bp\">/</span><span class=\"mi\">4461606579043</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">1443277808</span><span class=\"bp\">/</span><span class=\"mi\">9583752057175</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">546886849</span><span class=\"bp\">/</span><span class=\"mi\">14525765179168</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">650597193</span><span class=\"bp\">/</span><span class=\"mi\">69121426717657</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">199969519</span><span class=\"bp\">/</span><span class=\"mi\">84981432264454</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">226282901</span><span class=\"bp\">/</span><span class=\"mi\">384655467333100</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">60729699</span><span class=\"bp\">/</span><span class=\"mi\">412934601558121</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">25101251</span><span class=\"bp\">/</span><span class=\"mi\">682708800188252</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">7156464</span><span class=\"bp\">/</span><span class=\"mi\">778571703825145</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">7524725</span><span class=\"bp\">/</span><span class=\"mi\">3274543383827551</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">4663362</span><span class=\"bp\">/</span><span class=\"mi\">8117442793616861</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">1913009</span><span class=\"bp\">/</span><span class=\"mi\">13319781840326041</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">115805</span><span class=\"bp\">/</span><span class=\"mi\">3225279830894912</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">708749</span><span class=\"bp\">/</span><span class=\"mi\">78957345705688293</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">131255</span><span class=\"bp\">/</span><span class=\"mi\">58489233342660393</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">101921</span><span class=\"bp\">/</span><span class=\"mi\">181670219085488669</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">44784</span><span class=\"bp\">/</span><span class=\"mi\">319302953916238627</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">82141</span><span class=\"bp\">/</span><span class=\"mi\">2342610212364552264</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">4609</span><span class=\"bp\">/</span><span class=\"mi\">525783249231842696</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">4567</span><span class=\"bp\">/</span><span class=\"mi\">2083967975041722089</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">2273</span><span class=\"bp\">/</span><span class=\"mi\">4148770928197796067</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">563</span><span class=\"bp\">/</span><span class=\"mi\">4110440884426500846</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">784</span><span class=\"bp\">/</span><span class=\"mi\">22895812812720260289</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">1717</span><span class=\"bp\">/</span><span class=\"mi\">200571992854289218531</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">368</span><span class=\"bp\">/</span><span class=\"mi\">171952226838388893139</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">149</span><span class=\"bp\">/</span><span class=\"mi\">278487845640434185590</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">207</span><span class=\"bp\">/</span><span class=\"mi\">1547570041545500037992</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">20</span><span class=\"bp\">/</span><span class=\"mi\">598094702046570062987</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"mi\">7</span><span class=\"bp\">/</span><span class=\"mi\">837332582865198088180</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 470388683,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1726435101
    },
    {
        "content": "<p>Here's the Mathematica code that produced it, after some cleanup:</p>\n<div class=\"codehilite\" data-code-language=\"Mathematica\"><pre><span></span><code><span class=\"n\">calc</span><span class=\"p\">[</span><span class=\"nv\">a_</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Iters</span><span class=\"w\"> </span><span class=\"o\">-&gt;</span><span class=\"w\"> </span><span class=\"nv\">n_</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Rounding</span><span class=\"w\"> </span><span class=\"o\">-&gt;</span><span class=\"w\"> </span><span class=\"nv\">extra_</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Precision</span><span class=\"w\"> </span><span class=\"o\">-&gt;</span><span class=\"w\"> </span><span class=\"nv\">prec_</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Module</span><span class=\"p\">[{</span><span class=\"n\">r0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">r2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">diff</span><span class=\"p\">},</span>\n<span class=\"w\">   </span><span class=\"n\">On</span><span class=\"p\">[</span><span class=\"n\">Assert</span><span class=\"p\">];</span>\n<span class=\"w\">   </span><span class=\"n\">r0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"p\">((</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">/</span><span class=\"mi\">4</span><span class=\"o\">^</span><span class=\"n\">n</span><span class=\"p\">)</span><span class=\"o\">/</span><span class=\"mi\">2</span><span class=\"o\">^</span><span class=\"p\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">))</span><span class=\"o\">^</span><span class=\"mi\">2</span><span class=\"p\">;</span>\n<span class=\"w\">   </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Log</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">NestList</span><span class=\"p\">[((</span><span class=\"nv\">#</span><span class=\"p\">)</span><span class=\"o\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"p\">[</span><span class=\"n\">r0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">prec</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">]];</span>\n<span class=\"w\">   </span><span class=\"n\">If</span><span class=\"p\">[</span><span class=\"n\">r</span><span class=\"p\">[[</span><span class=\"mi\">-1</span><span class=\"p\">]]</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">Log</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">Sqrt</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">]],</span><span class=\"w\"> </span><span class=\"n\">Return</span><span class=\"p\">[</span><span class=\"s\">\"insufficient iterations\"</span><span class=\"p\">]];</span>\n<span class=\"w\">   </span><span class=\"n\">diff</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">[[</span><span class=\"mi\">-1</span><span class=\"p\">]]</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">Log</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">Sqrt</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">]])</span><span class=\"o\">/</span><span class=\"p\">(</span><span class=\"n\">Length</span><span class=\"p\">[</span><span class=\"n\">r</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">);</span>\n<span class=\"w\">   </span><span class=\"n\">r2</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Log</span><span class=\"p\">[</span>\n<span class=\"w\">     </span><span class=\"n\">Rationalize</span><span class=\"p\">[</span><span class=\"n\">Exp</span><span class=\"p\">[</span><span class=\"nv\">#</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">extra</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">Exp</span><span class=\"p\">[</span><span class=\"nv\">#</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">diff</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">Exp</span><span class=\"p\">[</span><span class=\"nv\">#</span><span class=\"p\">])]</span><span class=\"w\"> </span><span class=\"o\">&amp;</span>\n<span class=\"w\">        </span><span class=\"o\">/@</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">diff</span><span class=\"w\"> </span><span class=\"n\">Range</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Length</span><span class=\"p\">[</span><span class=\"n\">r</span><span class=\"p\">]])];</span>\n<span class=\"w\">   </span><span class=\"n\">Assert</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">Exp</span><span class=\"o\">@</span><span class=\"n\">r2</span><span class=\"p\">[[</span><span class=\"mi\">1</span><span class=\"p\">]]</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"n\">r0</span><span class=\"p\">];</span>\n<span class=\"w\">   </span><span class=\"n\">Assert</span><span class=\"p\">[</span>\n<span class=\"w\">    </span><span class=\"n\">And</span><span class=\"w\"> </span><span class=\"o\">@@</span><span class=\"w\"> </span><span class=\"n\">Table</span><span class=\"p\">[</span>\n<span class=\"w\">      </span><span class=\"n\">Sqrt</span><span class=\"o\">@</span><span class=\"p\">(</span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">Exp</span><span class=\"o\">@</span><span class=\"n\">r2</span><span class=\"p\">[[</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">]])</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">Exp</span><span class=\"o\">@</span><span class=\"n\">r2</span><span class=\"p\">[[</span><span class=\"n\">i</span><span class=\"p\">]]),</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"n\">i</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">,</span>\n<span class=\"w\">       </span><span class=\"n\">Length</span><span class=\"p\">[</span><span class=\"n\">r2</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">}]];</span>\n<span class=\"w\">   </span><span class=\"n\">Assert</span><span class=\"p\">[</span><span class=\"n\">Exp</span><span class=\"o\">@</span><span class=\"n\">r2</span><span class=\"p\">[[</span><span class=\"mi\">-1</span><span class=\"p\">]]</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">Sqrt</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">]];</span>\n<span class=\"w\">   </span><span class=\"n\">With</span><span class=\"p\">[{</span><span class=\"n\">s1</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ToString</span><span class=\"o\">@</span><span class=\"n\">InputForm</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"nv\">#</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">s2</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ToString</span><span class=\"o\">@</span><span class=\"n\">InputForm</span><span class=\"p\">[</span><span class=\"nv\">#</span><span class=\"p\">]},</span>\n<span class=\"w\">      </span><span class=\"n\">If</span><span class=\"p\">[</span><span class=\"n\">StringLength</span><span class=\"p\">[</span><span class=\"n\">s1</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">&lt;=</span><span class=\"w\"> </span><span class=\"n\">StringLength</span><span class=\"p\">[</span><span class=\"n\">s2</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">s1</span><span class=\"p\">,</span>\n<span class=\"w\">       </span><span class=\"s\">\"2-\"</span><span class=\"w\"> </span><span class=\"o\">&lt;&gt;</span><span class=\"w\"> </span><span class=\"n\">s2</span><span class=\"p\">]]</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"o\">/@</span><span class=\"w\"> </span><span class=\"n\">Exp</span><span class=\"o\">@</span><span class=\"n\">Reverse</span><span class=\"o\">@</span><span class=\"n\">r2</span><span class=\"p\">];</span>\n<span class=\"n\">calc</span><span class=\"p\">[</span><span class=\"mi\">314159265358979323847</span><span class=\"o\">/</span><span class=\"mi\">100000000000000000000</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Iters</span><span class=\"w\"> </span><span class=\"o\">-&gt;</span><span class=\"w\"> </span><span class=\"mi\">34</span><span class=\"p\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Rounding</span><span class=\"w\"> </span><span class=\"o\">-&gt;</span><span class=\"w\"> </span><span class=\"mf\">.5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Precision</span><span class=\"w\"> </span><span class=\"o\">-&gt;</span><span class=\"w\"> </span><span class=\"mi\">46</span><span class=\"p\">]</span>\n</code></pre></div>",
        "id": 470390043,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1726436306
    },
    {
        "content": "<p>I also had to slightly modify <code>pi_upper_bound</code> to allow rational expressions:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- Create a proof of `π &lt; a` for a fixed rational number `a`, given a witness, which is a</span>\n<span class=\"sd\">sequence of rational numbers `√2 &lt; r 1 &lt; r 2 &lt; ... &lt; r n &lt; 2` satisfying the property that</span>\n<span class=\"sd\">`√(2 + r i) ≥ r(i+1)`, where `r 0 = 0` and `√(2 - r n) ≥ (a - 1/4^n) / 2^(n+1)`. -/</span>\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"pi_upper_bound \"</span><span class=\"w\"> </span><span class=\"s2\">\"[\"</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"o\">,</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"s2\">\"]\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">els</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"bp\">.</span><span class=\"n\">getElems</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">quote</span><span class=\"w\"> </span><span class=\"n\">els</span><span class=\"bp\">.</span><span class=\"n\">size</span>\n<span class=\"w\">  </span><span class=\"n\">evalTactic</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">pi_upper_bound_start</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">n</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">els</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">const</span><span class=\"w\"> </span><span class=\"ss\">``_root_.Rat</span><span class=\"w\"> </span><span class=\"o\">[]</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">num</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">den</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">..</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">unsafe</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">evalExpr</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Term</span><span class=\"bp\">.</span><span class=\"n\">elabTermAndSynthesize</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"n\">evalTactic</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">sqrtTwoAddSeries_step_down</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"o\">(</span><span class=\"n\">quote</span><span class=\"w\"> </span><span class=\"n\">num</span><span class=\"bp\">.</span><span class=\"n\">toNat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"o\">(</span><span class=\"n\">quote</span><span class=\"w\"> </span><span class=\"n\">den</span><span class=\"o\">)))</span>\n<span class=\"w\">  </span><span class=\"n\">evalTactic</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">sqrtTwoAddSeries</span><span class=\"o\">]))</span>\n<span class=\"w\">  </span><span class=\"n\">allGoals</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"n\">evalTactic</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">first</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">norm_num1</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">done</span><span class=\"o\">)))</span>\n</code></pre></div>",
        "id": 470390090,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1726436363
    },
    {
        "content": "<p>Could <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Real.sqrtTwoAddSeries_step_down#doc\">docs#Real.sqrtTwoAddSeries_step_down</a> just take the <code>Rat</code> directly?</p>",
        "id": 470390453,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1726436677
    },
    {
        "content": "<p>the Rat processing is done at compile time here, the resulting proof uses only nats</p>",
        "id": 470390518,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1726436738
    },
    {
        "content": "<p>and the reason for this is so that it can get cross multiplied away in the subgoal which is proven by kernel computation</p>",
        "id": 470390604,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1726436774
    },
    {
        "content": "<p>Where's that kernel computation happening in your <code>elab</code> above?</p>",
        "id": 470390651,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1726436824
    },
    {
        "content": "<p>well, this is not a very high performance implementation, it got dumbed down a bit during the port. But it's still doing kernel computation via <code>norm_num1</code></p>",
        "id": 470390686,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1726436871
    },
    {
        "content": "<p>Oh, I thought that <code>norm_num</code> avoided kernel computation and just dutifully chained a lot of lemmas together</p>",
        "id": 470391198,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1726437337
    },
    {
        "content": "<p><code>norm_num</code> uses <code>rfl</code> to prove various steps.</p>",
        "id": 470395582,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1726441131
    },
    {
        "content": "<p>It tries to replace some heavy <code>rfl</code>s with something easier to check, but there are kernel computations involved anyway.</p>",
        "id": 470395625,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1726441189
    },
    {
        "content": "<p>in lean 3 it was just lemma application, but lean 4 norm_num knows about kernel accelerated nat ops and uses them whenever possible</p>",
        "id": 470395726,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1726441226
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/16930\">#16930</a> adds all of the above to the pi bounds file. <span class=\"user-mention\" data-user-id=\"514145\">@Geoffrey Irving</span> can you clarify if the bounds are good enough for your application, since you said \"a bit over 20 decimal digits\"?</p>",
        "id": 471332054,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1726687411
    },
    {
        "content": "<p>Confirmed, those bounds are good enough for me. When I said \"a bit over 20 decimal digits\", I had forgotten that it is not the case that <code>π &lt; 1</code> (I needed relative error).</p>",
        "id": 471338144,
        "sender_full_name": "Geoffrey Irving",
        "timestamp": 1726689517
    },
    {
        "content": "<p>And you don't even need 20 digits to know that!</p>",
        "id": 471338181,
        "sender_full_name": "Geoffrey Irving",
        "timestamp": 1726689533
    }
]