[
    {
        "content": "<p>In the quest for formalizing the Mordell-Weil Theorem for elliptic curves over number fields, I have now reduced the proof of the Northcott property for a number field <code>K</code> (i.e., there are only finitely many elements of <code>K</code> whose height is below any given bound) to the following two statements (whose informal proofs are clear to me, but I don't feel at home yet with the relevant API).</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">NumberTheory</span><span class=\"bp\">.</span><span class=\"n\">NumberField</span><span class=\"bp\">.</span><span class=\"n\">FinitePlaces</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">NumberField</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NumberField</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">absNorm_mul_finprod_nonarchAbsVal_eq_one</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Œπ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Finite</span><span class=\"w\"> </span><span class=\"n\">Œπ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œπ</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">ùìû</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚â†</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Ideal</span><span class=\"bp\">.</span><span class=\"n\">span</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">absNorm</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">‚àè·∂†</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FinitePlace</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"bp\">‚®Ü</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">exists_nat_ne_zero_exists_integer_mul_eq_and_absNorm_span_eq_pow</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">‚àÉ</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚â†</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">‚àß</span><span class=\"w\"> </span><span class=\"bp\">‚àÉ</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ùìû</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">‚àß</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">Ideal</span><span class=\"bp\">.</span><span class=\"n\">span</span><span class=\"w\"> </span><span class=\"o\">{(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ùìû</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">})</span><span class=\"bp\">.</span><span class=\"n\">absNorm</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">finrank</span><span class=\"w\"> </span><span class=\"n\">‚Ñö</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>What would be a good way to approach this? (In the second lemma, <code>n</code> is supposed to be the absolute norm of the \"denominator ideal\" of <code>x</code>. Is this ideal defined somewhere?)<br>\n<span class=\"user-mention\" data-user-id=\"626233\">@Fabrizio Barroero</span></p>",
        "id": 574559330,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1771434031
    },
    {
        "content": "<p>In the last few months I have been working on linking heights and Mahler Measures, for which we have Northcott already. This was the motivation for the definition of <code>intMinpoly</code> (see <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/intMinpoly/with/569338788\">#mathlib4 &gt; intMinpoly</a>).  One piece I am still missing, but I am working towards, would be the following</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">leadingCoeff_eq_finprod</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hpol</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">intMinpoly</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">algebraMap</span><span class=\"w\"> </span><span class=\"n\">‚Ñ§</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">Splits</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">intMinpoly</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">leadingCoeff</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\">  </span><span class=\"bp\">‚àè·∂†</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FinitePlace</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>(there might be some exponent <code>finrank ‚Ñö K</code> missing) which is probably very much related to your <code>absNorm_mul_finprod_nonarchAbsVal_eq_one</code>. Another thing needed is the invariance of the height with respect to finite extensions, but I guess you dealt with that already.</p>\n<p>Unfortunately, because of personal and work reasons, this is proceeding very slowly.</p>\n<p>In any case, for some other project I need what you call \"denominator ideal\" of¬†<code>x</code>. I looked briefly in Mathlib but couldn't find anything.</p>",
        "id": 574576863,
        "sender_full_name": "Fabrizio Barroero",
        "timestamp": 1771439094
    },
    {
        "content": "<p>To do it via Mahler measure, I think the cleanest way is to show that the height (<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Height.mulHeight%E2%82%81#doc\">docs#Height.mulHeight‚ÇÅ</a>) is the same as the Mahler measure of the integral <em>characteristic polynomial</em>; otherwise one needs to jump through additional hoops for elements that live in a smaller field.</p>\n<p>Of course, this can be dealt with when the relation between heights in extensions is available. I'm planning to add this (for general fields with an admissible family of absolute values) eventually, but decided to pivot to getting the basic stuff in first (you are welcome to review the relevant PRs; see <a class=\"stream-topic\" data-stream-id=\"144837\" href=\"/#narrow/channel/144837-PR-reviews/topic/Heights/with/574126354\">#PR reviews &gt; Heights</a>). So for now, this is not yet available.</p>",
        "id": 574580483,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1771440335
    },
    {
        "content": "<p>I probably will have a have a look at your PRs on the weekend. I took a glance and it looks exciting. <span aria-label=\"grinning\" class=\"emoji emoji-1f600\" role=\"img\" title=\"grinning\">:grinning:</span></p>",
        "id": 574586582,
        "sender_full_name": "Fabrizio Barroero",
        "timestamp": 1771442442
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"626233\">Fabrizio Barroero</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Results.20on.20elements.20of.20number.20fields.20and.20ideals/near/574576863\">said</a>:</p>\n<blockquote>\n<p>which is probably very much related to your <code>absNorm_mul_finprod_nonarchAbsVal_eq_one</code>.</p>\n</blockquote>\n<p>Yes, I think these are essentially the same (for the characteristic polynomial).</p>",
        "id": 574588598,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1771443148
    },
    {
        "content": "<p>You don't need an exact comparison with the Mahler measure. It would suffice, given an element of degree d and height &lt;= H to bound the height of the d elementary symmetric functions of their conjugates, aka the height of the coefficient of its minimal polynomial. Those bounds follow from the general bounds for sums and products. Then one is reduced to rational numbers.</p>",
        "id": 574594448,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1771445270
    },
    {
        "content": "<p>But note that this will still require the compatibility of the heights on <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">Q</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8556em;vertical-align:-0.1667em;\"></span><span class=\"mord mathbb\">Q</span></span></span></span> and the number field in question.</p>",
        "id": 574605154,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1771449392
    },
    {
        "content": "<p>... and also, to be able to write the coefficients as sums of products, one needs the field to be Galois, and one needs that the height is invariant under the Galois action. So one first has to extend to the Galois closure and also needs the compatibility of heights in finite extensions in general. It is not clear to me which path offers less resistance.</p>",
        "id": 574674190,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1771490756
    },
    {
        "content": "<p>My impression is that algebraic number theory, involving level of ring of integers etc., is an additional burden to this story which is intrinsically ‚Äúadelic‚Äù.</p>",
        "id": 574703446,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1771500083
    },
    {
        "content": "<p>I've been researching Mathlib for a bit today to figure out how to best set up a proof of the first of the two lemmas in the initial post. I learned that there are at least seven ways of expressing the multiplicity of a prime ideal <code>p</code> in the factorization of  another (nonzero) ideal <code>I</code> in a Dedkind domain:</p>\n<ul>\n<li><code>factorization I p</code></li>\n<li><code>emultiplicity p I</code> (but this is an <code>ENat</code>)</li>\n<li><code>multiplicity p I</code></li>\n<li><code>(UniqueFactorizationMonoid.normalizedFactors I).count p</code></li>\n<li><code>(UniqueFactorizationMonoid.normalizedFactors I).count (normalize p)</code></li>\n<li><code>(UniqueFactorizationMonoid.factors I).count p</code></li>\n<li><code>(UniqueFactorizationMonoid.factors I).count (normalize p)</code></li>\n</ul>\n<p>The APIs for these are a bit disparate. There are lemmas relating some of these: <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=factorization_eq_count#doc\">docs#factorization_eq_count</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=UniqueFactorizationMonoid.emultiplicity_eq_count_normalizedFactors#doc\">docs#UniqueFactorizationMonoid.emultiplicity_eq_count_normalizedFactors</a> (and, of course, one can relate <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=emultiplicity#doc\">docs#emultiplicity</a> with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=multiplicity#doc\">docs#multiplicity</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=UniqueFactorizationMonoid.normalizedFactors#doc\">docs#UniqueFactorizationMonoid.normalizedFactors</a> with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=UniqueFactorizationMonoid.factors#doc\">docs#UniqueFactorizationMonoid.factors</a>).</p>\n<p>My feeling is that it would be good to standardize; my preference would be to use  <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=factorization#doc\">docs#factorization</a>.</p>\n<p>Any thoughts?</p>",
        "id": 574739650,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1771510747
    },
    {
        "content": "<p>Side question: why do we have both <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=UniqueFactorizationMonoid.normalizedFactors#doc\">docs#UniqueFactorizationMonoid.normalizedFactors</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=UniqueFactorizationMonoid.factors%3F#doc\">docs#UniqueFactorizationMonoid.factors?</a> The latter is defined using choice, so we could as well also define a normalization map using choice and then use normalized factors. As it stands, there seems to be a lot of duplication.</p>",
        "id": 574739665,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1771510752
    },
    {
        "content": "<p>Yeah, I noticed too that there were many ways to express that multiplicity even though I didn't know about <code>factorization</code>. It would really be nice to standardize things as you suggested. My choices would go to <code>multiplicity</code>, but <code>factorization</code> would be okay too.</p>",
        "id": 574757015,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1771514868
    },
    {
        "content": "<p>Note that there has been a refactor around <code>multiplicity</code>/<code>emultiplicity</code> and it is very likely not all declaration have been aligned to one style.</p>",
        "id": 574757459,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1771514976
    },
    {
        "content": "<p>I can live with <code>multiplicity</code> (it is even one character shorter); <code>emultiplicity</code> is likely to cause pain from converting between <code>ENat</code> and <code>Nat</code>.</p>\n<p>We should then have <code>simp</code> lemmas that convert the other ways of expressing this into <code>multiplicity p I</code> and extend the API for <code>multiplicity</code> suitably. I can try out this approach while working on my two lemmas.</p>",
        "id": 574769347,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1771518120
    }
]