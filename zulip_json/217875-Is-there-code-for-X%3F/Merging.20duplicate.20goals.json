[
    {
        "content": "<p>Is there a goal-management tactic that can be used to recognise that two (or more) of the goals in the current goal list are identical, and merge them together, so you don't have to give two copies of the same sub-proof?</p>\n<p>(I know about \"all_goals\", \"any_goal\" etc, which would allow you to only <em>write</em> the goal once; but it would still be getting <em>processed</em> multiple times. I want something which would halve the tactic compilation time, as well as the writing time.)</p>",
        "id": 484850790,
        "sender_full_name": "David Loeffler",
        "timestamp": 1732776751
    },
    {
        "content": "<p>I remember this being asked before, and then the answer was no, iirc</p>",
        "id": 484855785,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732779389
    },
    {
        "content": "<p>Are your goals \"identical\"?  I.e. same local variables and same types?</p>",
        "id": 484856565,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732779734
    },
    {
        "content": "<p>(Internally, they will not be <em>identical</em> since, for instance, each metavariable has a new name, but I am wondering if they are identical for a human, at least.)</p>",
        "id": 484856684,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732779792
    },
    {
        "content": "<p>The goals are literally identical up to naming of bound variables. (But they are quite lengthy to type, so I want to avoid <code>have</code>-ing them beforehand.)</p>",
        "id": 484858220,
        "sender_full_name": "David Loeffler",
        "timestamp": 1732780485
    },
    {
        "content": "<p>Ok, I wonder if a tactic could create a new metavariable that is defeq to the current goal, use that to close all goals that it can and leave just the \"new\" metavariable as a remaining goal (plus whatever goals it was not able to solve automatically).</p>",
        "id": 484858579,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732780656
    },
    {
        "content": "<p>(I won't have time to actually think about this for a while, but it seems like a good metaprogramming task.)</p>",
        "id": 484858665,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732780684
    },
    {
        "content": "<p>In lean 3 there was a hack resembling <code>have foo := ?_; rotate</code> that could push a goal whose type was an unconstrained meta variable, which you could use to close multiple proof branches; but that is not legal lean 4 syntax.</p>",
        "id": 484858847,
        "sender_full_name": "David Loeffler",
        "timestamp": 1732780773
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Merging.20duplicate.20goals/near/484858579\">said</a>:</p>\n<blockquote>\n<p>Ok, I wonder if a tactic could create a new metavariable that is defeq to the current goal, use that to close all goals that it can and leave just the \"new\" metavariable as a remaining goal (plus whatever goals it was not able to solve automatically).</p>\n</blockquote>\n<p>Possibly easier would be to take a list of goals as an argument - <code>merge_goals 3 5</code> or something – rather than automating the search. I’m concerned about it taking a long time to fail on some goals that aren’t defeq.</p>",
        "id": 484859363,
        "sender_full_name": "David Loeffler",
        "timestamp": 1732780954
    },
    {
        "content": "<p>Still possible in Lean 4, just make the type a metavariable too:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">?_</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">this</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">trivial</span>\n</code></pre></div>",
        "id": 484900282,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1732793604
    }
]