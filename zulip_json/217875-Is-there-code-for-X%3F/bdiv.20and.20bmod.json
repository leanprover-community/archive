[
    {
        "content": "<p>The definition of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Int.bdiv#doc\">docs#Int.bdiv</a> has this docstring:</p>\n<blockquote>\n<p>Balanced division.  This returns the unique integer so that<br>\n<code>b * (Int.bdiv a b) + Int.bmod a b = a</code>.</p>\n</blockquote>\n<p>However, I can't see where the equation <code>b * (Int.bdiv a b) + Int.bmod a b = a</code> is actually proved. Is there something I am missing?</p>",
        "id": 488562485,
        "sender_full_name": "Mitchell Lee",
        "timestamp": 1733985847
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"644391\">@loogle</span> Int.bdiv, Int.bmod</p>",
        "id": 488563538,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1733986444
    },
    {
        "content": "<p><span aria-label=\"shrug\" class=\"emoji emoji-1f937\" role=\"img\" title=\"shrug\">:shrug:</span> nothing found</p>",
        "id": 488563543,
        "sender_full_name": "loogle",
        "timestamp": 1733986446
    },
    {
        "content": "<p>Apparently not</p>",
        "id": 488563566,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1733986462
    },
    {
        "content": "<p>Here's a low-powered proof (only requiring <code>Mathlib.Init</code>). I'm sure it can be improved.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Init</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Int</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">bdiv_add_bmod</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">bdiv</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">bmod</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">bdiv</span><span class=\"w\"> </span><span class=\"n\">bmod</span>\n<span class=\"w\">  </span><span class=\"n\">split</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp_all</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">cast_ofNat_Int</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">mul_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">emod_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">zero_add</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">sub_zero</span><span class=\"o\">,</span>\n<span class=\"w\">      </span><span class=\"n\">ite_self</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">dsimp</span><span class=\"w\"> </span><span class=\"n\">only</span>\n<span class=\"w\">    </span><span class=\"n\">split</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">ediv_add_emod</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">mul_add</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">mul_one</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">add_assoc</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">add_comm</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">sub_add_cancel</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">ediv_add_emod</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">bmod_eq</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">bmod</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">bdiv</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">occs</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">pos</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">bdiv_add_bmod</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">add_comm</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">add_sub_cancel</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>Where would be the best place for a theorem like this to go? One possibility is <code>Mathlib.Data.Int.DivMod</code> (<a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Int/DivMod.html\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Int/DivMod.html</a>) but I am slightly concerned about putting an inessential theorem so early in the import hierarchy.</p>",
        "id": 488565369,
        "sender_full_name": "Mitchell Lee",
        "timestamp": 1733987454
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> Should it go to Mathlib or Lean?</p>",
        "id": 488566009,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1733987778
    },
    {
        "content": "<p>Looks like a basic fact about a definition from core which is never used in Mathlib.</p>",
        "id": 488566161,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1733987857
    },
    {
        "content": "<p>I'm guessing mathlib doesn't care much, so put it in batteries for Kim to upstream into core at their leisure</p>",
        "id": 488567179,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1733988339
    },
    {
        "content": "<p>Yes, either PR to Batteries or Lean. I can collect it from Batteries when I next return to Int/Nat.</p>",
        "id": 488572175,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733990720
    },
    {
        "content": "<p>yes, this should go in <code>Data.Int.DivMod</code>. I think <code>bdiv</code> did not exist when I wrote most of the theorems in that file (which is now in <code>Init</code>)</p>",
        "id": 488609584,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1734002562
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/6494\">https://github.com/leanprover/lean4/pull/6494</a></p>",
        "id": 491527577,
        "sender_full_name": "Mitchell Lee",
        "timestamp": 1735764434
    }
]