[
    {
        "content": "<p>Is there a heterogenous version of LE? (One that takes elements from two different types)</p>",
        "id": 565228580,
        "sender_full_name": "Alex Zani",
        "timestamp": 1766536589
    },
    {
        "content": "<p>Such a thing couldn't satisfy any of the usual axioms for LE because they won't typecheck. Are you asking if there's a notation typeclass with type <code>A -&gt; B -&gt; Prop</code>? What exactly are you looking for?</p>",
        "id": 565229032,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1766537089
    },
    {
        "content": "<p>AFAIK the question \"<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Mul#doc\">docs#Mul</a> is to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=HMul#doc\">docs#HMul</a> as <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LE#doc\">docs#LE</a> is to ??\" doesn't have an answer in core Lean at least (but all these are are notation typeclasses).</p>",
        "id": 565229104,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1766537158
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Heterogenous.20LE.3F/near/565229032\">said</a>:</p>\n<blockquote>\n<p>Such a thing couldn't satisfy any of the usual axioms for LE because they won't typecheck. Are you asking if there's a notation typeclass with type <code>A -&gt; B -&gt; Prop</code>? What exactly are you looking for?</p>\n</blockquote>\n<p>Yes, I am looking for a notation typeclass.</p>\n<p>Specifically I want to be able to do a &lt;= b where a and b are instances of two different subtypes of the same type.</p>",
        "id": 565229458,
        "sender_full_name": "Alex Zani",
        "timestamp": 1766537598
    },
    {
        "content": "<p>I guess to avoid the XY problem, I am defining orders (preorders, partial orders, etc) as part of a pedagogical exercise and I've settled on using subtypes to represent suborders. So it would be nice if I could still talk about comparisons of elements of various subsets.</p>",
        "id": 565229814,
        "sender_full_name": "Alex Zani",
        "timestamp": 1766537993
    },
    {
        "content": "<p>Have you considered coercing the elements to the original order before comparing them? Something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Even</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">}}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Odd</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">}}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">\\</span><span class=\"n\">le</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 565252308,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1766561163
    },
    {
        "content": "<p>I've wondered about whether arithmetic binary operators and relations should automatically cast subtypes to the base type. This seems to occasionally come up as an issue, right? And if you want to have a subtype with arithmetic operations, you may as well create a custom <code>structure</code>, to avoid accidentally putting the operations globally on <code>Subtype</code> itself.</p>",
        "id": 565292474,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1766588661
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Heterogenous.20LE.3F/near/565292474\">said</a>:</p>\n<blockquote>\n<p>I've wondered about whether arithmetic binary operators and relations should automatically cast subtypes to the base type. This seems to occasionally come up as an issue, right? And if you want to have a subtype with arithmetic operations, you may as well create a custom <code>structure</code>, to avoid accidentally putting the operations globally on <code>Subtype</code> itself.</p>\n</blockquote>\n<p>I don't think that works for operators because what's the output type?</p>",
        "id": 565293672,
        "sender_full_name": "Alex Zani",
        "timestamp": 1766589630
    },
    {
        "content": "<p>E.g. if you have</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Even</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">}}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Odd</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">}}</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span>\n</code></pre></div>\n<p>what I'm proposing is that this elaborates to <code>(a.val + b.val : Nat)</code>.</p>",
        "id": 565297131,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1766592172
    },
    {
        "content": "<p>(The broader context is that arithmetic operators/relations have a special elaborator that computes a type that everything coerces to, then inserts coercions where necessary. I tweak this elaborator every once in a while, and this is something I've had in the back of my head, since I only ever see subtypes cause problems for it.)</p>",
        "id": 565297288,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1766592292
    },
    {
        "content": "<p>I personally find implicit coercion of subtypes already confusing sometimes. I don't think I would like it if we add another special elaborator rule. I would need to constantly check InfoView to ensure it goes to the right type I expect</p>",
        "id": 565298044,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1766592924
    },
    {
        "content": "<p>For arithmetic though, do you ever expect it to stay in the <code>Subtype</code> <span class=\"user-mention\" data-user-id=\"873350\">@Weiyi Wang</span>? Right now arithmetic sometimes triggers the coercion but not always, and having a clean rule that it will <em>always</em> coerce seems easier to reason about. The observation here is that it's questionable adding any arithmetic typeclass instances to <code>Subtype</code>.</p>",
        "id": 565299535,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1766594159
    },
    {
        "content": "<p>I think I would sometimes want to stay in the subtype. As long as I can override the behavior so I can stay in N/2 for instance, that's fine.</p>",
        "id": 565299763,
        "sender_full_name": "Alex Zani",
        "timestamp": 1766594332
    },
    {
        "content": "<p>Hmm, I don't know. How does this behave if I have <code>a b : s</code> where <code>s : Subgroup G</code>? I think I want <code>a * b</code> to stay in the subgroup. Does <code>s</code> count as a subtype?</p>",
        "id": 565299770,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1766594341
    },
    {
        "content": "<p>Somehow I thought the <code>Subgroup</code> coercion used a custom type rather than giving <code>Subtype</code> itself a <code>Mul</code> instance. I think there's some talk elsewhere about making SetLike coercions use a custom type, but in any case <code>Subgroup</code> kills the idea for now.</p>",
        "id": 565302926,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1766596527
    },
    {
        "content": "<p>In the other thread, <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> suggests that we block <code>simp</code>'s unwanted behavior by using <code>simproc</code>s instead of introducing a new type.</p>",
        "id": 565304111,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1766597498
    },
    {
        "content": "<p><a href=\"#narrow/channel/287929-mathlib4/topic/Coercion.20of.20SetLike.20to.20Type*\">#mathlib4 &gt; Coercion of SetLike to Type&#42;</a></p>",
        "id": 565304146,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1766597524
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Heterogenous.20LE.3F/near/565302926\">said</a>:</p>\n<blockquote>\n<p>Somehow I thought the <code>Subgroup</code> coercion used a custom type rather than giving <code>Subtype</code> itself a <code>Mul</code> instance. I think there's some talk elsewhere about making SetLike coercions use a custom type, but in any case <code>Subgroup</code> kills the idea for now.</p>\n</blockquote>\n<p>Should I be using Set or SetLike as the basis for my orders then?</p>",
        "id": 565304155,
        "sender_full_name": "Alex Zani",
        "timestamp": 1766597530
    }
]