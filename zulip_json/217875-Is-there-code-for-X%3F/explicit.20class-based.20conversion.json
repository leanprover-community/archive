[
    {
        "content": "<p>lean offers implicit class-based coersion: <a href=\"https://leanprover-community.github.io/mathlib4_docs/Init/Coe.html\">https://leanprover-community.github.io/mathlib4_docs/Init/Coe.html</a></p>\n<p>does explicit class-based <em>conversion</em> exist? i have found myself writing a considerable amount of helper methods like the below for type conversion and it seems like there simply must be a better way. does something akin to rust's <code>From</code>/<code>Into</code> traits exist?</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">BitVec</span>\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">ofUInt8</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt8</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BitVec</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">BitVec.ofNat</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">UInt8.toNat</span><span class=\"w\"> </span><span class=\"n\">i</span>\n<span class=\"kd\">end</span><span class=\"w\"> </span><span class=\"n\">BitVec</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Array</span>\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">ofUInt32</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">long</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt32</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Byte</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"n\">UInt8.ofNat</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">UInt32.toNat</span><span class=\"w\"> </span><span class=\"n\">long</span><span class=\"w\"> </span><span class=\"bp\">&gt;&gt;&gt;</span><span class=\"w\"> </span><span class=\"mi\">24</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">UInt8.ofNat</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">UInt32.toNat</span><span class=\"w\"> </span><span class=\"n\">long</span><span class=\"w\"> </span><span class=\"bp\">&gt;&gt;&gt;</span><span class=\"w\"> </span><span class=\"mi\">16</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">UInt8.ofNat</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">UInt32.toNat</span><span class=\"w\"> </span><span class=\"n\">long</span><span class=\"w\"> </span><span class=\"bp\">&gt;&gt;&gt;</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">UInt8.ofNat</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">UInt32.toNat</span><span class=\"w\"> </span><span class=\"n\">long</span><span class=\"o\">]</span>\n<span class=\"kd\">end</span><span class=\"w\"> </span><span class=\"n\">Array</span>\n</code></pre></div>",
        "id": 465812972,
        "sender_full_name": "JJ",
        "timestamp": 1724863729
    },
    {
        "content": "<p>i.e. i'm looking for the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">class</span><span class=\"w\"> </span><span class=\"n\">Convert</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span>\n</code></pre></div>",
        "id": 465813109,
        "sender_full_name": "JJ",
        "timestamp": 1724863797
    },
    {
        "content": "<p>Lean3 had <a href=\"https://leanprover-community.github.io/mathlib_docs/find/lift\">docs3#lift</a> / <a href=\"https://leanprover-community.github.io/mathlib_docs/find/has_lift\">docs3#has_lift</a> for this</p>",
        "id": 465813950,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1724864117
    },
    {
        "content": "<p><del>isn't this just <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Coe#doc\">docs#Coe</a> ?</del></p>",
        "id": 465816471,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1724865038
    },
    {
        "content": "<p><del>(see also <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CoeOut#doc\">docs#CoeOut</a> )</del><br>\ni now see you already found that...</p>",
        "id": 465816829,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1724865226
    },
    {
        "content": "<p>i'm mostly looking for a way to not need to explicitly say <code>FromType.toNewType foo</code> every time i want to convert types</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">a.to</span><span class=\"w\">  </span><span class=\"c1\">-- when the type is known, no need to re-specify in method name</span>\n<span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">a.to</span><span class=\"o\">[</span><span class=\"n\">γ</span><span class=\"o\">]</span><span class=\"w\">   </span><span class=\"c1\">-- when the type is unknown, specify as a generic</span>\n</code></pre></div>\n<p>it would also be cool if this would resolve things transitively, i.e. if there is an instance of <code>Convert</code> for <code>α → β</code> and an instance from <code>β → γ</code>, <code>((a : α).to : γ)</code> would Just Work</p>",
        "id": 465817755,
        "sender_full_name": "JJ",
        "timestamp": 1724865664
    },
    {
        "content": "<p>looking at it, i'd say you could do some adapting to use the existing <code>Coe</code> infrastructure... however, i don't know you can get the dot-notation to work... <br>\nthe following might help:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">coeTo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CoeTC</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">CoeTC</span><span class=\"bp\">.</span><span class=\"n\">coe</span>\n</code></pre></div>",
        "id": 465819376,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1724866401
    },
    {
        "content": "<p>which allows <code>coeTo α b</code> assuming <code>[CoeTC β α]</code> exists (rather than the notation of <code>b.coeTo α</code> you suggested)</p>",
        "id": 465820291,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1724866785
    },
    {
        "content": "<p>hmm, but my impression is that <code>Coe</code> is for implicit coersion, and implementing <code>Coe</code> or any related classes for some types will add them to that system. i don't want implicit coersion b/c i don't want ex. <code>UInt32</code> to be <em>implicitly</em> coerced to an <code>Array UInt8</code>, but i would like explicit <code>((foo : UInt32).to : Array UInt8)</code> to work</p>",
        "id": 465820646,
        "sender_full_name": "JJ",
        "timestamp": 1724866899
    },
    {
        "content": "<p>the following might work?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">universe</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Convert</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\">  </span><span class=\"n\">semiOutParam</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">convert</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"bp\">.</span><span class=\"n\">toConvert</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Convert</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"kn\">where</span><span class=\"w\"> </span><span class=\"n\">convert</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"bp\">.</span><span class=\"n\">coe</span>\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">toConvert</span><span class=\"o\">)</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">ConvertTC</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\">  </span><span class=\"n\">semiOutParam</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">convert</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">ConvertTC</span><span class=\"bp\">.</span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Convert</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ConvertTC</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ConvertTC</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">convert</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Convert</span><span class=\"bp\">.</span><span class=\"n\">convert</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ConvertTC</span><span class=\"bp\">.</span><span class=\"n\">convert</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">ConvertTC</span><span class=\"bp\">.</span><span class=\"n\">single</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Convert</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ConvertTC</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">convert</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Convert</span><span class=\"bp\">.</span><span class=\"n\">convert</span><span class=\"w\"> </span><span class=\"n\">a</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">ConvertTC</span><span class=\"bp\">.</span><span class=\"n\">id</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ConvertTC</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"kn\">where</span><span class=\"w\"> </span><span class=\"n\">convert</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">a</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">convertTo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ConvertTC</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ConvertTC</span><span class=\"bp\">.</span><span class=\"n\">convert</span>\n</code></pre></div>\n<p>this adds the existing <code>Coe</code> classes to the new <code>Convert</code> system, but since these aren't marked with the <code>@[coe]</code> attribute i'd guess that new <code>Convert</code> instances don't get implicitly inserted?</p>",
        "id": 465823698,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1724868051
    },
    {
        "content": "<p>btw, the <code>TC</code> stands for Transitive Closure, if someone didn't make that connection before</p>",
        "id": 465824442,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1724868359
    },
    {
        "content": "<p>I have never understood how the coercion system works in lean 4 with all this CoeTC etc. I wonder if you can just use the coercion system as is but you just have to be an expert to implement it</p>",
        "id": 465834216,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1724872594
    },
    {
        "content": "<p>Just did a dive into the file defining these coe-classes, and i have to say it is quite enlightening.</p>\n<p>the issue with extending the existing infra is that the top class in the hierarchy automatically gets tied into the system: if you add only to classes the bottom, you don't get to add new coercions; if you add only to the top of the hierarchy, everything you do gets tied into the system; if you add a separate hierarchy, you don't get to leverage existing coercions.</p>\n<p>there may be a solution using attributes/options/other magic i dont know about. particularly i don't know how how the <code>coe_decl</code> attribute is handled/what it gets used for, which may be significant. <br>\nThe only solution to this that i can think of would be to add a second layer to the hierarchy which runs parallel on top of the existing one, but is connected per (base) class. This leads to duplicating quite some code, unfortunately...</p>",
        "id": 465847975,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1724878356
    },
    {
        "content": "<p>A way to avoid duplication would be to change <code>Coe X Y : Type</code> to <code>Coe X Y isImplicit</code></p>",
        "id": 465856647,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1724882482
    },
    {
        "content": "<p>(where <code>isImplicit : Bool</code> or belongs to some enum type)</p>",
        "id": 465856687,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1724882510
    },
    {
        "content": "<p>This would need an RFC, since obviously this is a nontrivial change to core</p>",
        "id": 465856790,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1724882560
    },
    {
        "content": "<p>okay, cool. i might make an RFC to extend <code>Coe</code> when i am more familiar with the language. for now, i think i'll play around with implementing my own local <code>Conv</code> class in my projects.</p>",
        "id": 466110626,
        "sender_full_name": "JJ",
        "timestamp": 1724964617
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/217875-Is-there-code-for-X.3F/topic/explicit.20class-based.20conversion/near/465856647\">said</a>:</p>\n<blockquote>\n<p>A way to avoid duplication would be to change <code>Coe X Y : Type</code> to <code>Coe X Y isImplicit</code></p>\n</blockquote>\n<p>that avoids duplicating the classes, sure. however, i think that might double/triple the instances necessary to make the transitive synthesis work?</p>",
        "id": 466181589,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1725002687
    },
    {
        "content": "<p>because you'd need something like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"n\">NotImplicit</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CoeTC</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CoeTC</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"n\">NotImplicit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CoeTC</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">NotImplicit</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CoeTC</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"n\">NotImplicit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"n\">IsImplicit</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CoeTC</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">IsImplicit</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CoeTC</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"n\">IsImplicit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n</code></pre></div>",
        "id": 466182677,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1725002909
    },
    {
        "content": "<p>at least, i think something like this might not work because of transparency issues?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CoeTC</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CoeTC</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n</code></pre></div>",
        "id": 466184873,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1725003777
    },
    {
        "content": "<p>or free variable issues?</p>",
        "id": 466186356,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1725004250
    },
    {
        "content": "<p>having a bit of a try, it requires 4(!) (not factorial) instances due to the free variable issue.</p>",
        "id": 466188968,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1725004929
    }
]