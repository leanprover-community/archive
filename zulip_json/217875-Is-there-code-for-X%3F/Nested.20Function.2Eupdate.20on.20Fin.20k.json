[
    {
        "content": "<p>In my proofs, I have a lot of of expressions of the form</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">update</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">update</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">update</span><span class=\"w\"> </span><span class=\"n\">f</span>\n<span class=\"w\">    </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span>\n<span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">z</span>\n</code></pre></div>\n<p>(often nested much deeper), where <code>f : Fin k → α</code>, <code>k : ℕ</code>. The lemmas I want to prove usually in the end simplify to equality of permutations of such update structures or equality of update structures with some <code>if-then-else</code> expressions strewn at different places. Sometimes it happens that (in the example above) <code>a = c</code>, i.e. the innermost update is redundant.</p>\n<p>Using <code>simp</code> and <code>grind</code> together with <code>split_ifs</code> often solves the goal, but not always and I'm wondering if there is some other data structure I could use here. I also tried adding a lemma that \"sorts\" the updates (because adjacent redundant updates are eliminated by simp), but usually the <code>&lt;</code>-requirement is not automatically established, but even if it is, it takes a long time (both via simp and via grind).</p>\n<p>Any help is greatly appreciated!</p>",
        "id": 576289160,
        "sender_full_name": "chris477",
        "timestamp": 1772206341
    },
    {
        "content": "<p>I'd also recommend <code>aesop</code> for goals like these.</p>",
        "id": 576364212,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1772234050
    },
    {
        "content": "<p>Not sure if there's much to be done, most things on <code>Function.update</code> are necessarily very case-heavy arguments that one just handwaves in pen and paper maths.</p>",
        "id": 576364266,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1772234086
    },
    {
        "content": "<p>Maybe a simproc could help with this in the case where you've got a sequence of <code>update</code> calls and you can combine multiple non-adjacent calls</p>",
        "id": 576366909,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1772235923
    },
    {
        "content": "<p>Ah, these are good ideas! Will look into writing a simproc to sort, followed by aesop!</p>",
        "id": 576414761,
        "sender_full_name": "chris477",
        "timestamp": 1772277311
    }
]