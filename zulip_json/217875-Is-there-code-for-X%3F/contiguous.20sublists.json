[
    {
        "content": "<p>Hi, I'm looking to see if the following might be hiding in mathlib before I implement it: </p>\n<p>Say I have a list <code>L</code>, and if a certain contiguous sublist <code>b</code> (so basically substring) is in it, I'd like lean to return <code>some (a, b, c)</code>  where <code>L = a ++ b ++ c</code>, and otherwise return <code>none</code>. (The goal is to re-write <code>b</code> to something else, but that's a bit down the road)</p>\n<p>It looks like <code>List.sublist</code> is non-contiguous; <code>List.find</code> only looks at a single element. Is there anything that looks for \"substrings\" in a list?</p>",
        "id": 484194802,
        "sender_full_name": "Hannah Fechtner",
        "timestamp": 1732497202
    },
    {
        "content": "<p>Are you aware of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Substring.findSubstr%3F#doc\">docs#Substring.findSubstr?</a>, if strings are actually your motivation?</p>",
        "id": 484198683,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1732500675
    },
    {
        "content": "<p>I think <code>infix</code> is what you are looking for. Try <a href=\"https://leanprover-community.github.io/mathlib4_docs/Init/Data/List/Basic.html#List.IsInfix\">List.IsInfix</a>. Just like  the definition of prefix and suffix of a List. Infix means that <code>l₁</code> is a contiguous substring of <code>l₂</code>.</p>",
        "id": 484201248,
        "sender_full_name": "Edward Zhang",
        "timestamp": 1732502971
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/contiguous.20sublists/near/484198683\">said</a>:</p>\n<blockquote>\n<p>Are you aware of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Substring.findSubstr%3F#doc\">docs#Substring.findSubstr?</a>, if strings are actually your motivation?</p>\n</blockquote>\n<p>I was not aware of that, thanks! I'll have a look at how that was implemented. </p>\n<p>Alas, I do not think strings will work out :(   I'm working on an algorithm which solves the braid word problem, and so I have a list of braid generators. It needs a more general alphabet that <code>Char</code> (currently each \"letter\" is of type <code>Option \\N \\times Bool</code>)</p>",
        "id": 484204168,
        "sender_full_name": "Hannah Fechtner",
        "timestamp": 1732505399
    },
    {
        "content": "<p>Does List.inInfix help? Perhaps we should add something that returns the actual three lists.</p>",
        "id": 484204392,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732505553
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"782274\">Edward Zhuang</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/contiguous.20sublists/near/484201248\">said</a>:</p>\n<blockquote>\n<p>I think <code>infix</code> is what you are looking for. Try <a href=\"https://leanprover-community.github.io/mathlib4_docs/Init/Data/List/Basic.html#List.IsInfix\">List.IsInfix</a>. Just like  the definition of prefix and suffix of a List. Infix means that <code>l₁</code> is a contiguous substring of <code>l₂</code>.</p>\n</blockquote>\n<p>Yes, thank you, that's the word I'm looking for!  It looks like it's defined, but there's nothing which returns the 3 parts if it is satisfied? That's okay, I'm only looking for infixes of length two, so it's not bad to code up myself</p>",
        "id": 484204402,
        "sender_full_name": "Hannah Fechtner",
        "timestamp": 1732505563
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/contiguous.20sublists/near/484204392\">said</a>:</p>\n<blockquote>\n<p>Does List.inInfix help? Perhaps we should add something that returns the actual three lists.</p>\n</blockquote>\n<p>That would be nice, but it needn't  be made on my account. I'll need something more general (I'm not trying to match an exact infix, but rather see if there is an infix of a specific form - i.e. <code>[(some i, true), (none, false)]</code> for any natural number <code>i</code>), and my guess it's going to be a bear to code up for the case of an n-length infix. Much less gross for an infix of length 2 and just customizing it off the bat for my use case</p>",
        "id": 484204775,
        "sender_full_name": "Hannah Fechtner",
        "timestamp": 1732505838
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/contiguous.20sublists/near/484204392\">said</a>:</p>\n<blockquote>\n<p>Does List.inInfix help? Perhaps we should add something that returns the actual three lists.</p>\n</blockquote>\n<p>I'm not sure that adding a function to List that returns a list of 3 is general enough. Seems like expand the infix in return (if I'm not mistaken about what you're saying). I'd like to help with it.</p>",
        "id": 484206616,
        "sender_full_name": "Edward Zhang",
        "timestamp": 1732507270
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"622371\">Hannah Fechtner</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/contiguous.20sublists/near/484204775\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/contiguous.20sublists/near/484204392\">said</a>:</p>\n<blockquote>\n<p>Does List.inInfix help? Perhaps we should add something that returns the actual three lists.</p>\n</blockquote>\n<p>That would be nice, but it needn't  be made on my account. I'll need something more general (I'm not trying to match an exact infix, but rather see if there is an infix of a specific form - i.e. <code>[(some i, true), (none, false)]</code> for any natural number <code>i</code>), and my guess it's going to be a bear to code up for the case of an n-length infix. Much less gross for an infix of length 2 and just customizing it off the bat for my use case</p>\n</blockquote>\n<p>Could you give a <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a> about the general idea? Confuse about what you mean by <code>[(some i, true), (none, false)]</code>. Personnally I think returning a 3-length (infix with customized prefixes and suffixes) make sense. And if you wanna a n-length in other form. You may need to code in Monad.</p>",
        "id": 484207432,
        "sender_full_name": "Edward Zhang",
        "timestamp": 1732507711
    },
    {
        "content": "<p>I will add something, this is an obvious gap.</p>",
        "id": 484208626,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732508526
    },
    {
        "content": "<p>You may also want to use <span class=\"user-mention\" data-user-id=\"119741\">@François G. Dorais</span>'s implementation of the KMP matcher, available in <code>Batteries.Data.Array.Match</code>, although it only seems to have a friendly frontend specialized for <code>String</code>.</p>",
        "id": 484217490,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732515289
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> <span class=\"user-mention\" data-user-id=\"622371\">@Hannah Fechtner</span> The <code>Stream</code> frontend for KMP should work well for this task.</p>\n<p><a href=\"https://github.com/leanprover-community/batteries/blob/44e2d2e643fd2618b01f9a0592d7dcbd3ffa22de/Batteries/Data/Array/Match.lean#L93\">https://github.com/leanprover-community/batteries/blob/44e2d2e643fd2618b01f9a0592d7dcbd3ffa22de/Batteries/Data/Array/Match.lean#L93</a></p>",
        "id": 484223222,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1732519046
    },
    {
        "content": "<p>Could we also just have <code>Array</code> and <code>List</code> interfaces for finding the first match?</p>",
        "id": 484223695,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732519296
    },
    {
        "content": "<p>I'm writing a slow-but-with-lemmas function for finding an infix list.</p>",
        "id": 484223826,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732519355
    },
    {
        "content": "<p>I think the right spec is</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">dropInfix?_eq_some_iff</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">BEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">dropInfix?</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↔</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">i'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">i'</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">i'</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">∧</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">p'</span><span class=\"w\"> </span><span class=\"n\">i'</span><span class=\"w\"> </span><span class=\"n\">s'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">p'</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">i'</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">s'</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">i'</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">p'</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 484223903,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732519417
    },
    {
        "content": "<p>(We're missing <code>List.dropPrefix?</code> and <code>List.dropSuffix?</code> as well, despite having them for <code>String</code>, so I'll add those at the same time.)</p>",
        "id": 484223997,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732519450
    },
    {
        "content": "<p>Yes, I was just putting that on my todo list, but if you want to work on it then I won't stop you :-)</p>",
        "id": 484226278,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1732520513
    },
    {
        "content": "<p>That theorem?</p>",
        "id": 484226362,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732520539
    },
    {
        "content": "<p>Or friendler Array and List frontends for KMP?</p>",
        "id": 484226380,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732520550
    },
    {
        "content": "<p>The friendly frontends.</p>",
        "id": 484226408,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1732520565
    },
    {
        "content": "<p>I'll do the theorem, but if you wanted to do KMP frontends that would be nice.</p>",
        "id": 484226410,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732520565
    },
    {
        "content": "<p>Sounds good. I think I have time in the next couple of days.</p>",
        "id": 484226506,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1732520614
    },
    {
        "content": "<p>It's not at all urgent, just nice to have.</p>",
        "id": 484226539,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732520636
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/batteries/pull/1065\">batteries#1065</a></p>",
        "id": 484241095,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1732525280
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/batteries/pull/1066\">batteries#1066</a> (and all that!) now contains: <code>dropInfix? l i</code>, which returns the prefix and suffix for the first time <code>i</code> appears as a contiguous sublist of <code>l</code>, and a specification theorem</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">dropInfix?_eq_some_iff</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">BEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">dropInfix?</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↔</span>\n<span class=\"w\">      </span><span class=\"c1\">-- `i` is an infix up to `==`</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">i'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">i'</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">i'</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">∧</span>\n<span class=\"w\">        </span><span class=\"c1\">-- and there is no shorter prefix for which that is the case</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">p'</span><span class=\"w\"> </span><span class=\"n\">i'</span><span class=\"w\"> </span><span class=\"n\">s'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">p'</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">i'</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">s'</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">i'</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">p'</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>It also fills in <code>dropPrefix?</code> and <code>dropSuffix?</code>.</p>\n<p>There's a note explaining that if you want computation, you need to use KMP; the point of these is they are verified.</p>",
        "id": 484278149,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732535402
    },
    {
        "content": "<p>Could we consider adding an implicit parameter e.g. <code>useKmp</code> to <code>dropInfix</code>/ <code>dropPrefix</code>/ <code>dropSuffix</code>, for not using kmp as default. If there are performance requirements, users can enable it.</p>",
        "id": 484339592,
        "sender_full_name": "Edward Zhang",
        "timestamp": 1732550693
    },
    {
        "content": "<p>that sounds strictly worse than just using KMP always</p>",
        "id": 484346498,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1732552734
    },
    {
        "content": "<p>We need a verification of KMP. I was planning on having some students work on that but we never got around to it.</p>",
        "id": 484352059,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1732554389
    },
    {
        "content": "<p>Yes, the problem is that KMP is currently all <code>partial</code>, so no proofs are possible without a rewrite. The point of <code>dropInfix?</code> is to give a function for people who are \"merely proving\".</p>",
        "id": 484401246,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732574083
    },
    {
        "content": "<p>Once a verified KMP is available we can swap out the implementation, keeping the lemmas.</p>",
        "id": 484401316,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732574115
    },
    {
        "content": "<p>To avoid partial we need something like well-founded streams.</p>",
        "id": 484409742,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1732578527
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/batteries/pull/127\">batteries#127</a></p>",
        "id": 484410124,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1732578765
    },
    {
        "content": "<p>Or just implement it on <code>Array</code>...</p>",
        "id": 484419776,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732585272
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"622371\">@Hannah Fechtner</span>, this function <code>List.dropInfix?</code> should now be available on Mathlib <code>master</code>.</p>",
        "id": 484801885,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732742866
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/batteries/pull/994\">batteries#994</a> seems quite similar in spirit to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.dropInfix%3F#doc\">docs#List.dropInfix?</a></p>",
        "id": 484811374,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1732748081
    },
    {
        "content": "<p>Also, regarding <code>dropInfix</code> it seems to me like <code>dropInfix? l i = some (p, i', s) </code> might be more useful, if we're opening the <code>BEq</code> equivalence relation can of worms</p>",
        "id": 484811623,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1732748272
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/contiguous.20sublists/near/484811374\">said</a>:</p>\n<blockquote>\n<p><a href=\"https://github.com/leanprover-community/batteries/pull/994\">batteries#994</a> seems quite similar in spirit to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.dropInfix%3F#doc\">docs#List.dropInfix?</a></p>\n</blockquote>\n<p>Yes, it is a pity that hasn't seen follow-up from the author.</p>",
        "id": 484820758,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732754835
    }
]