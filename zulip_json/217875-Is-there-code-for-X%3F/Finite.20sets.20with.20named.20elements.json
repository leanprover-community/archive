[
    {
        "content": "<p>Is there a way to create a finite set along with an identifier for each element?</p>\n<p>My use case is creating examples for chemical reaction networks and related things. The goal is to have a nice neat syntax for examples, so that I can introduce example networks and then prove things about them.</p>\n<p>Here's some code to show what I mean:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"w\"> </span><span class=\"c1\">-- for `deriving Fintype`</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">ReactionNetwork</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">species</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">species_finite</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">species</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">reactions</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">Multiset</span><span class=\"w\"> </span><span class=\"n\">species</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiset</span><span class=\"w\"> </span><span class=\"n\">species</span><span class=\"o\">))</span>\n\n<span class=\"kn\">section</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">exampleSpecies</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">H₂</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">O₂</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">H₂O</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">CH₄</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">CO₂</span>\n<span class=\"w\">  </span><span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">DecidableEq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Fintype</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">exampleSpecies</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">exampleNetwork</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ReactionNetwork</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">species</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">exampleSpecies</span>\n<span class=\"w\">  </span><span class=\"n\">reactions</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"bp\">⟨</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">H₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">H₂</span><span class=\"w\"> </span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">O₂</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">H₂O</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">H₂O</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">⟩</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"bp\">⟨</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">CH₄</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">O₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">O₂</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">CO₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">H₂O</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">H₂O</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"o\">}</span>\n\n<span class=\"kn\">end</span>\n</code></pre></div>\n<p>It shouldn't be hard to improve the way reactions are presented, but it's cumbersome to introduce a name for the set of species, <code>exampleSpecies</code> in this case. It would be much nicer if the example would look more like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">exampleNetwork</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ReactionNetwork</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">species</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">FiniteSet</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">H₂</span><span class=\"w\"> </span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">O₂</span><span class=\"w\"> </span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">H₂O</span><span class=\"w\"> </span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">CH₄</span><span class=\"w\"> </span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">CO₂</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"n\">reactions</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"bp\">⟨</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">H₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">H₂</span><span class=\"w\"> </span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">O₂</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">H₂O</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">H₂O</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">⟩</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"bp\">⟨</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">CH₄</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">O₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">O₂</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">CO₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">H₂O</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">H₂O</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"o\">}</span>\n</code></pre></div>\n<p>where the species type is introduced anonymously, along with identifiers for all of its elements. Is something like this possible to achieve? I don't mind if it means making the type of <code>species</code> different, as long as I'll be able to reason about it as a finite set.</p>",
        "id": 572129993,
        "sender_full_name": "Nathaniel Virgo",
        "timestamp": 1770293078
    },
    {
        "content": "<p>You are probably looking for <a href=\"https://lean-lang.org/theorem_proving_in_lean4/Inductive-Types/#enumerated-types\">enumerated types</a>.</p>",
        "id": 572135764,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1770294878
    },
    {
        "content": "<p>Isn't that what I already have in the example?</p>",
        "id": 572135915,
        "sender_full_name": "Nathaniel Virgo",
        "timestamp": 1770294928
    },
    {
        "content": "<p>Oh sorry, admittedly I only read the first sentence.</p>",
        "id": 572136340,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1770295042
    },
    {
        "content": "<p>By <code>FiniteSet</code> you mean <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Finset%3F#doc\">docs#Finset?</a> That might be <a href=\"https://en.wikipedia.org/wiki/XY_problem\">#xy</a> problem. What's wrong with your first code, why do you need <code>FiniteSet</code>? You can use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Finset.univ#doc\">docs#Finset.univ</a> to obtain elements of <code>exampleSpecies</code> as a <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Finset#doc\">docs#Finset</a>.</p>",
        "id": 572348510,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1770375874
    },
    {
        "content": "<p>I don't mean <code>Finset</code>, since that's a finite subset of a type. I just mean a finite type, so <code>Fin n</code> for some n, or anything equivalent to it.</p>\n<p>The problem with my first code example is that the syntax is cumbersome. I have to introduce a name, <code>exampleSpecies</code>, just to define the set of species. I'd rather write code that looks like the second example.</p>\n<p>There's nothing wrong with the first example semantically, but I don't like the syntax, because it forces me to define a separate type for the set of species when logically it's part of the reaction network, not an independent type. This is boilerplate that needs to be copied for each example, and I'd rather avoid that.</p>\n<p>It's not really a big issue, but I figured it might be possible, because Lean's syntax is so flexible.</p>",
        "id": 572350794,
        "sender_full_name": "Nathaniel Virgo",
        "timestamp": 1770376615
    },
    {
        "content": "<p>The second example could be written as</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">exampleNetwork</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ReactionNetwork</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">species</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">5</span>\n<span class=\"w\">  </span><span class=\"n\">reactions</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"bp\">⟨</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">⟩</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"bp\">⟨</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"mi\">4</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"o\">}</span>\n</code></pre></div>\n<p>I'm asking for code that works exactly like that, except that you can give the elements names to make it more readable.</p>",
        "id": 572352131,
        "sender_full_name": "Nathaniel Virgo",
        "timestamp": 1770377086
    },
    {
        "content": "<p>If you use <code>Fin 5</code> that you could also do <code>H₂ + H₂</code>, which you probably wouldn't want to.</p>",
        "id": 572354929,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1770378010
    },
    {
        "content": "<p>Fair enough - that's another reason to want a finite set where the elements aren't numbers.</p>",
        "id": 572355046,
        "sender_full_name": "Nathaniel Virgo",
        "timestamp": 1770378049
    },
    {
        "content": "<p>So a new type is exactly what you want. And afaik Lean doesn't have syntax for anonymous enums (nor for anonymous structs), so you need to name this enum. You can name it <code>exampleNetwork_species</code> to make the relation more obvious.</p>",
        "id": 572355438,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1770378190
    },
    {
        "content": "<p>Sure - my original question could be phrased as \"does Lean have anonymous enums?\" - my examples were just meant to demonstrate a use case for them.</p>",
        "id": 572355609,
        "sender_full_name": "Nathaniel Virgo",
        "timestamp": 1770378245
    },
    {
        "content": "<p>Something like this?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"w\"> </span><span class=\"c1\">-- for `deriving Fintype`</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">ReactionNetwork</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">species</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">species_finite</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">species</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">reactions</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">Multiset</span><span class=\"w\"> </span><span class=\"n\">species</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiset</span><span class=\"w\"> </span><span class=\"n\">species</span><span class=\"o\">))</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Term</span><span class=\"w\"> </span><span class=\"n\">Command</span>\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"declare_enum% \"</span><span class=\"w\"> </span><span class=\"s2\">\"{\"</span><span class=\"w\"> </span><span class=\"n\">names</span><span class=\"o\">:</span><span class=\"n\">ident</span><span class=\"o\">,</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"s2\">\"}\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">mkAuxDeclName</span><span class=\"w\"> </span><span class=\"ss\">`enum</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ident</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mkIdent</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"ss\">`_root_</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Syntax</span><span class=\"bp\">.</span><span class=\"n\">Command</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">name</span><span class=\"o\">:</span><span class=\"n\">ident</span><span class=\"w\"> </span><span class=\"kn\">where</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"o\">[</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">names</span><span class=\"o\">:</span><span class=\"n\">ident</span><span class=\"o\">]</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">DecidableEq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Fintype</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">liftCommandElabM</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">elabCommand</span><span class=\"w\"> </span><span class=\"n\">cmd</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">elabTerm</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"n\">none</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">exampleNetwork</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ReactionNetwork</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">species</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">declare_enum</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">H₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">O₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">H₂O</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">CH₄</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">CO₂</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"n\">reactions</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"bp\">⟨</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"bp\">.</span><span class=\"n\">H₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">H₂</span><span class=\"w\"> </span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">O₂</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"bp\">.</span><span class=\"n\">H₂O</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">H₂O</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">⟩</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"bp\">⟨</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"bp\">.</span><span class=\"n\">CH₄</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">O₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">O₂</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"bp\">.</span><span class=\"n\">CO₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">H₂O</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">H₂O</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"o\">}</span>\n</code></pre></div>",
        "id": 572613258,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1770549443
    },
    {
        "content": "<p>That seems to do it! I'll try using it.</p>",
        "id": 572613576,
        "sender_full_name": "Nathaniel Virgo",
        "timestamp": 1770549711
    }
]