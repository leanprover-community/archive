[
    {
        "content": "<p>Is the following true? What counterexample am I missing if not?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fact</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CharP</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">natCast_iff_of_charP</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsUnit</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">∣</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 503900213,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741298914
    },
    {
        "content": "<p>Answer: Yes, but my proof in <a href=\"https://github.com/leanprover-community/mathlib4/pull/22237\">#22237</a> is super ugly</p>",
        "id": 503903060,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741299975
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fact</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CharP</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">]</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">natCast_iff_of_charP</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsUnit</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">∣</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">constructor</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rintro</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"bp\">⟩</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">CharP</span><span class=\"bp\">.</span><span class=\"n\">cast_eq_zero_iff</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">CharP</span><span class=\"bp\">.</span><span class=\"n\">nontrivial_of_char_ne_one</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"bp\">.</span><span class=\"n\">ne_one</span><span class=\"w\"> </span><span class=\"n\">Fact</span><span class=\"bp\">.</span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">ne_zero</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">ZMod</span><span class=\"bp\">.</span><span class=\"n\">cast_natCast'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)]</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ZMod</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"bp\">ˣ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">mk0</span><span class=\"w\"> </span><span class=\"bp\">↑</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ZMod</span><span class=\"bp\">.</span><span class=\"n\">natCast_zmod_eq_zero_iff_dvd</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">not</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">u'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ZMod</span><span class=\"bp\">.</span><span class=\"n\">castHom</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">dvd_refl</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toMonoidHom</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">u'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"bp\">⟩</span>\n</code></pre></div>",
        "id": 503903812,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741300294
    },
    {
        "content": "<p>Going through <code>ZMod.cast</code> feels a little silly</p>",
        "id": 503903903,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741300323
    },
    {
        "content": "<p>I would have done it the same way</p>",
        "id": 503904296,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1741300452
    },
    {
        "content": "<p>Maybe the resolution I want here is \"generalize the approach used to build the inverse on zmod\"</p>",
        "id": 503906388,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741301339
    },
    {
        "content": "<p>The inverse is <code>p.gcdB n</code> if that's any help</p>",
        "id": 503906509,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1741301397
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"bp\">.</span><span class=\"n\">coprime_iff_not_dvd</span><span class=\"w\"> </span><span class=\"n\">Fact</span><span class=\"bp\">.</span><span class=\"n\">out</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">▸</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">gcd_eq_gcd_ab</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">    </span><span class=\"c1\">-- this : ↑1 = ↑p * p.gcdA n + ↑n * p.gcdB n</span>\n</code></pre></div>",
        "id": 503906708,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1741301480
    },
    {
        "content": "<p>I would except a lemma like <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CharTwo.two_zsmul#doc\">docs#CharTwo.two_zsmul</a> to exist but for smul and arbitrary CharP.</p>",
        "id": 503911270,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1741303373
    },
    {
        "content": "<p>Why wouldn't ZMod be the right thing to go through?</p>",
        "id": 503911507,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1741303470
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/22669\">#22669</a></p>",
        "id": 503921773,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741308180
    },
    {
        "content": "<p>Is this stronger result true?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CharP</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">]</span>\n<span class=\"c1\">-- I already have the other direction</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">CharP</span><span class=\"bp\">.</span><span class=\"n\">coprime_of_isUnit</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsUnit</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">Coprime</span><span class=\"w\"> </span><span class=\"n\">p</span>\n</code></pre></div>",
        "id": 503922303,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741308437
    },
    {
        "content": "<p>Yes</p>",
        "id": 503923455,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1741309075
    },
    {
        "content": "<p>I assume we have the characterization of units in ZMod? <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ZMod.isUnit_iff_coprime#doc\">docs#ZMod.isUnit_iff_coprime</a></p>",
        "id": 503923781,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1741309222
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ZMod.isUnit_iff_coprime#doc\">docs#ZMod.isUnit_iff_coprime</a> indeed exists</p>",
        "id": 503923813,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741309240
    },
    {
        "content": "<p>I don't see how to ensure that there aren't some \"surprise\" units in <code>R</code> for things that weren't units in <code>ZMod p</code></p>",
        "id": 503923899,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741309288
    },
    {
        "content": "<p>I guess one needs to know something about the localizations of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">Z</mi><mi mathvariant=\"normal\">/</mi><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Z}/n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathbb\">Z</span><span class=\"mord\">/</span><span class=\"mord mathnormal\">n</span></span></span></span>, but I'm trying to think of a more elementary proof...</p>",
        "id": 503924811,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1741309757
    },
    {
        "content": "<p>The non-units in <code>ZMod p</code> are zero-divisors</p>",
        "id": 503924859,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1741309795
    },
    {
        "content": "<p>I'm thinking of the elements of <code>R</code> which live outside the range of <code>ZMod.cast</code></p>",
        "id": 503924930,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741309818
    },
    {
        "content": "<p>Zero divisors can't be units, and that property is preserved by ring homomorphisms.</p>",
        "id": 503925024,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1741309883
    },
    {
        "content": "<p>Right, exactly.</p>",
        "id": 503925047,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1741309897
    },
    {
        "content": "<p>Well, they're preserved by \\emph{injective} ring hom :)</p>",
        "id": 503925065,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1741309915
    },
    {
        "content": "<p>I'm guessing I can't avoid <code>ZMod</code> so easily for this case?</p>",
        "id": 503925142,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741309949
    },
    {
        "content": "<p>I don't think so :)</p>",
        "id": 503925174,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1741309974
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"243562\">Adam Topaz</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/IsUnit.20and.20CharP/near/503925065\">said</a>:</p>\n<blockquote>\n<p>Well, they're preserved by \\emph{injective} ring hom :)</p>\n</blockquote>\n<p>(forgot about 0)</p>",
        "id": 503925291,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1741310036
    },
    {
        "content": "<p>What about the zero ring?</p>",
        "id": 505887328,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1742074215
    },
    {
        "content": "<p>In any case, if a prime p is nilpotent in R, say p ^ m = 0, and n is prime to p, then there are natural integers such that a * n = b * p ^ m + 1, and this implies that n is invertible in R.</p>",
        "id": 505887439,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1742074317
    }
]