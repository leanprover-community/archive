[
    {
        "content": "<p>Say I have a <code>SMul</code> with <code>C</code> acting on <code>B</code>. Should Lean know automatically how to extend that action to one on functions <code>A → B</code>? The following fails:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">HSMul</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"c1\">-- failed to synthesize HSMul C (A → B) ?m.32063</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>But with a little help, it works</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">HSMul</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HSMul</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"n\">hSMul</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">HSMul</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n<span class=\"c1\">-- works</span>\n</code></pre></div>\n<p>Why does it need that help?</p>",
        "id": 484606305,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1732659744
    },
    {
        "content": "<p>If you replace <code>HSMul C B B</code> with <code>SMul C B</code> then everything works as expected.</p>",
        "id": 484606821,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1732660000
    },
    {
        "content": "<p>Is there a particular reason you want <code>HSMul</code>?</p>",
        "id": 484606838,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1732660011
    },
    {
        "content": "<p>Ah that's what's wrong. Thanks!</p>",
        "id": 484606865,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1732660027
    },
    {
        "content": "<p>Out of curiosity, what does the <code>H</code> in <code>HSmul</code> stand for? (Maybe that would've helped me notice the distinction...)</p>",
        "id": 484607031,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1732660117
    },
    {
        "content": "<p>\"Heterogeneous\" :)</p>",
        "id": 484607039,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1732660126
    },
    {
        "content": "<p><code>HSMul A B C</code> means <code>A</code> acts on <code>B</code> but this action takes values in <code>C</code></p>",
        "id": 484607059,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1732660142
    },
    {
        "content": "<p>Yep, got it; thanks!!</p>",
        "id": 484607076,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1732660153
    },
    {
        "content": "<p>(modulo some permutation of the variables :))</p>",
        "id": 484607084,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1732660160
    },
    {
        "content": "<p>We have other heterogenous operations like <code>HMul</code>, <code>HDiv</code>, etc. but I don't think they're used much in mathlib.</p>",
        "id": 484607181,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1732660205
    },
    {
        "content": "<p>The most common heterogeneous operation is natural/integer exponentiation.</p>",
        "id": 484607282,
        "sender_full_name": "Sky Wilshaw",
        "timestamp": 1732660267
    },
    {
        "content": "<p>there might be some of these used in the <code>Pointwise</code> namespace, for their respective pointwise actions on <code>Set</code>s, iirc</p>",
        "id": 484608414,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732660881
    },
    {
        "content": "<p>Ok wait, so say we have a heterogeneous action. Why wouldn't Lean know to infer the action on functions? Example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">HSMul</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"c1\">-- failed to synthesize HSMul C (A → B) ?m.32913</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>What else could I possibly mean? On the left, <code>f a</code> has type <code>B</code> and I'm bubbing it with <code>c</code>, so I must have in mind a term of type <code>D</code>. So the right must be a function which takes <code>a : A</code> and returns something of type <code>D</code>. Is there a reason that it doesn't automatically do the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">HSMul</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HSMul</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"n\">hSMul</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">HSMul</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n<span class=\"c1\">-- works</span>\n</code></pre></div>\n<p>? Thanks!</p>",
        "id": 484609725,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1732661633
    },
    {
        "content": "<p>I think it's just because such an instance was never added anywhere!</p>",
        "id": 484609862,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1732661718
    },
    {
        "content": "<p>Here is the SMul instance: <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Group/Pi/Basic.html#Pi.instSMul\">Pi.instSMul</a></p>",
        "id": 484609980,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1732661771
    },
    {
        "content": "<p>Oh ok. So I guess that's what I'm asking - should such an instance exist? (Seems useful to me... Came up in something <span class=\"user-mention\" data-user-id=\"749862\">@Madison Crim</span> was doing...)</p>",
        "id": 484610003,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1732661785
    },
    {
        "content": "<p>But <code>Pi.instHSMul</code> doesn't exist</p>",
        "id": 484610008,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1732661788
    },
    {
        "content": "<p>This is even a <code>Pi</code> version; I just have a single function -- even that doesn't seem to exist?</p>",
        "id": 484610080,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1732661836
    },
    {
        "content": "<p>Worth a PR perhaps?</p>",
        "id": 484610102,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1732661854
    },
    {
        "content": "<p>I think we're very timid about adding heterogeneous instances in mathlib.</p>",
        "id": 484610106,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1732661863
    },
    {
        "content": "<p>I would continue this discussion at <a class=\"stream\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4\">#mathlib4</a></p>",
        "id": 484610183,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1732661895
    },
    {
        "content": "<p>Ah. Because there could be some other context where you'd want a different action, right?</p>",
        "id": 484610196,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1732661905
    },
    {
        "content": "<p>2 messages were moved from this topic to <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/Should.20.02klzzwxh.3A0000.03.20exist.20in.20Mathlib.3F\">#mathlib4 &gt; Should <code>Pi.instHSMul</code> exist in Mathlib?</a> by <span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span>.</p>",
        "id": 484616884,
        "sender_full_name": "Notification Bot",
        "timestamp": 1732666130
    },
    {
        "content": "<p>For those who want to find the new location of the topic... it's here <a href=\"#narrow/channel/287929-mathlib4/topic/Should.20.60Pi.2EinstHSMul.60.20exist.20in.20Mathlib.3F\">#mathlib4&gt;Should &#96;Pi.instHSMul&#96; exist in Mathlib?</a></p>",
        "id": 484664074,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732696344
    },
    {
        "content": "<p>8 messages were moved from this topic to <a class=\"stream-topic\" data-stream-id=\"236604\" href=\"/#narrow/channel/236604-Zulip-meta/topic/Broken.20thread.20links.20after.20moving\">#Zulip meta &gt; Broken thread links after moving</a> by <span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span>.</p>",
        "id": 487325529,
        "sender_full_name": "Notification Bot",
        "timestamp": 1733858607
    },
    {
        "content": "<p>(to avoid saddling <span class=\"user-mention\" data-user-id=\"439115\">@Alya Abbott</span> with having to sift through this non-zulip-meta channel to re-find this thread)</p>",
        "id": 487325717,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733858675
    }
]