[
    {
        "content": "<p>Should we have a definition like this? Or what would be the way to prove a theorem like \"a linear map is diagonalizable iff its minpoly splits and is squarefree\"?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">IsDiagonalizable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">End</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">Basis</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">HasEigenvector</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 539132798,
        "sender_full_name": "Lawrence Wu (llllvvuu)",
        "timestamp": 1757697495
    },
    {
        "content": "<p>That looks like a good definition of diagonalizable to me</p>",
        "id": 539143728,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1757702006
    },
    {
        "content": "<p>I think <code>Diagonalization</code> should be a structure.</p>",
        "id": 539160612,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1757710079
    },
    {
        "content": "<p>Like this?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">Diagonalization</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">End</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">Basis</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">R</span>\n<span class=\"w\">  </span><span class=\"n\">hasEigenVector_μ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">HasEigenvector</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">toBasis</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 539163222,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757711441
    },
    {
        "content": "<p>We can also have a sorted version on <code>Fin</code> (I don’t need it, but it’s what we have for <code>LinearMap.IsSymmetric</code>)</p>",
        "id": 539163928,
        "sender_full_name": "Lawrence Wu (llllvvuu)",
        "timestamp": 1757711824
    },
    {
        "content": "<p>On <code>Fin</code> you can also have <code>UpperTriangularization</code></p>",
        "id": 539166975,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1757713630
    },
    {
        "content": "<p>we would need to think about whether we want to make <code>μ</code> computable</p>",
        "id": 539167097,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757713689
    },
    {
        "content": "<p>What do you mean by that?</p>",
        "id": 539167848,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757714092
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">Diagonalization</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">End</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">Basis</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">exists_hasEigenVector</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">μ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">HasEigenvector</span><span class=\"w\"> </span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">toBasis</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 539168034,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757714184
    },
    {
        "content": "<p>I think the only reason to prefer that spelling is it saves us proving the <code>ext</code> theorem that it suffices for the <code>basis</code> part to agree</p>",
        "id": 539168227,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757714281
    },
    {
        "content": "<p>.. assuming that property is actually true in that level of generality;</p>",
        "id": 539168428,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757714361
    },
    {
        "content": "<p>they are both extensional (i think)</p>",
        "id": 539168761,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757714496
    },
    {
        "content": "<p>oh wait, it's a ring not a field</p>",
        "id": 539168827,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757714535
    },
    {
        "content": "<p>yeah i think they're still equivalent</p>",
        "id": 539168848,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757714550
    },
    {
        "content": "<p>if μ1 v = μ2 v then (μ1-μ2) v = 0 but basis -&gt; linearly independent -&gt; μ1-μ2=0</p>",
        "id": 539168900,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757714574
    },
    {
        "content": "<p>So let's write the version with a mu field so that you can write that theorem to prove it :)</p>",
        "id": 539168934,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757714588
    },
    {
        "content": "<p>I think my comment came from our awful definition of <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/AlgebraicGeometry/Cover/MorphismProperty.html#AlgebraicGeometry.Scheme.Cover\">AlgebraicGeometry.Scheme.Cover</a> which is very much not extensional because of the extra data <code>f</code> but which I was told that this is a nofix because it's being deprecated soon <span aria-label=\"tm\" class=\"emoji emoji-2122\" role=\"img\" title=\"tm\">:tm:</span></p>",
        "id": 539169153,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757714677
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/diagonalizable.20linear.20maps/near/539168900\">said</a>:</p>\n<blockquote>\n<p>if μ1 v = μ2 v then (μ1-μ2) v = 0 but basis -&gt; linearly independent -&gt; μ1-μ2=0</p>\n</blockquote>\n<p>Can you change basis and change the eigenvalues for some non-reduced ring? e.g mod 8 the matrices diag(1,7) and diag(3,5) have the same char poly, but they don't seem to be conjugate in GL_2(Z/8).</p>",
        "id": 539171850,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1757716014
    },
    {
        "content": "<p>(pari)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"bp\">;</span><span class=\"n\">c</span><span class=\"o\">,</span><span class=\"n\">d</span><span class=\"o\">]</span><span class=\"bp\">*</span><span class=\"o\">[</span><span class=\"n\">Mod</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">8</span><span class=\"o\">),</span><span class=\"mi\">0</span><span class=\"bp\">;</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"n\">Mod</span><span class=\"o\">(</span><span class=\"mi\">7</span><span class=\"o\">,</span><span class=\"mi\">8</span><span class=\"o\">)]</span><span class=\"bp\">-</span><span class=\"o\">[</span><span class=\"n\">Mod</span><span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"mi\">8</span><span class=\"o\">),</span><span class=\"mi\">0</span><span class=\"bp\">;</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"n\">Mod</span><span class=\"o\">(</span><span class=\"mi\">5</span><span class=\"o\">,</span><span class=\"mi\">8</span><span class=\"o\">)]</span><span class=\"bp\">*</span><span class=\"o\">[</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"bp\">;</span><span class=\"n\">c</span><span class=\"o\">,</span><span class=\"n\">d</span><span class=\"o\">]</span>\n<span class=\"bp\">%</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"o\">[</span><span class=\"n\">Mod</span><span class=\"o\">(</span><span class=\"mi\">6</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">Mod</span><span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">b</span><span class=\"o\">]</span>\n\n<span class=\"o\">[</span><span class=\"n\">Mod</span><span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">Mod</span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">d</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>so a,b,c,d would all have to be even to make this the zero matrix, which would mean ad-bc can't be a unit.</p>",
        "id": 539171990,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1757716091
    },
    {
        "content": "<p>oh, i haven't thought about <em>that</em> extensionality...</p>",
        "id": 539172753,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757716519
    },
    {
        "content": "<p>i was just thinking about \"mu is extra data (given the basis of eigenvectors)\", and it seems like you are additionally thinking about \"mu is unique up to ordering\"</p>",
        "id": 539172834,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757716572
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"816344\">@Aaron Liu</span> do you think this is true?</p>",
        "id": 539173737,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757717116
    },
    {
        "content": "<p>what's going on</p>",
        "id": 539173768,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757717136
    },
    {
        "content": "<p>what's the problem</p>",
        "id": 539173827,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757717167
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/diagonalizable.20linear.20maps/near/539173768\">said</a>:</p>\n<blockquote>\n<p>what's going on</p>\n</blockquote>\n<p>let f:R^n -&gt; R^n be a linear map, R is a ring,<br>\nlet {v1, ..., vn} be a basis of eigenvectors,<br>\nlet {w1, ..., wn} be another basis of eigenvectors,<br>\nthen their eigenvalues are the same up to ordering</p>",
        "id": 539173850,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757717179
    },
    {
        "content": "<p>i think it's true</p>",
        "id": 539173881,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757717207
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> because like for simplicity pretend v1 .... vn all have distinct eigenvalues,<br>\nthen write w1 = sum ai vi<br>\nthen f(wi) = sum ai λi vi = sum ai λ1' vi<br>\nby invertibility stuff, (a1, ..., an) = (1) so we should be able to conclude λ1' = one of the λi</p>",
        "id": 539174083,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757717347
    },
    {
        "content": "<p>hmm ok i'm not convinced by my argument</p>",
        "id": 539174179,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757717405
    },
    {
        "content": "<p>n is finite?</p>",
        "id": 539174198,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757717417
    },
    {
        "content": "<p>all i can conclude is that ai (λ1' - λi) = 0 for all i,<br>\nand in the classical case: (you use the fact that it's a field to conclude that ai=0 or λ1'=λi, and by invertibility there must be a non-zero ai)</p>",
        "id": 539174254,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757717455
    },
    {
        "content": "<p>can I use a weird ring</p>",
        "id": 539174321,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757717503
    },
    {
        "content": "<p>of course</p>",
        "id": 539174330,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757717513
    },
    {
        "content": "<p>i think i want to use Z/6Z with (ai) = (2,3) and λ1' = 0 and (λi) = (3,2)</p>",
        "id": 539174412,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757717561
    },
    {
        "content": "<p>which means... consider diag(3,2) with coeffs in Z/6Z,<br>\nthen (2,3) is an eigenvector with eigenvalue 0<br>\nand its complement... (3,2) has eigenvalue -1</p>",
        "id": 539174518,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757717621
    },
    {
        "content": "<p>oh god</p>",
        "id": 539174521,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757717623
    },
    {
        "content": "<p>is the ring has to be comm</p>",
        "id": 539174637,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757717699
    },
    {
        "content": "<p>so, mu is not unique up to ordering, but it's still derivable from the basis</p>",
        "id": 539174638,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757717700
    },
    {
        "content": "<p>well my ring is comm and it already fails</p>",
        "id": 539174676,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757717716
    },
    {
        "content": "<p>what's the counterexample</p>",
        "id": 539174869,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757717832
    },
    {
        "content": "<p>diag(3,2),<br>\nstandard basis has eigenvalues (3, 2)<br>\nthe cursed basis ((2,3), (3,2)) has eigenvalues (0, -1)</p>",
        "id": 539174956,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757717867
    },
    {
        "content": "<p>what is a diag(3,2)</p>",
        "id": 539174993,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757717882
    },
    {
        "content": "<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo fence=\"true\">(</mo><mtable rowspacing=\"0.16em\" columnalign=\"center center\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>3</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>2</mn></mstyle></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\begin{pmatrix}3&amp;0\\\\0&amp;2\\end{pmatrix}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.4em;vertical-align:-0.95em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">(</span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">3</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.95em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">0</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.95em;\"><span></span></span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">)</span></span></span></span></span></span></p>",
        "id": 539175044,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757717900
    },
    {
        "content": "<p>oh makes sense</p>",
        "id": 539175056,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757717905
    },
    {
        "content": "<p>somewhat cursed basis has weird eigenvalues</p>",
        "id": 539175293,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757718054
    },
    {
        "content": "<p>i'm sure <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> will be overjoyed to hear about this counterexample</p>",
        "id": 539175405,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757718132
    },
    {
        "content": "<p>actually we should formalise it in <code>Counterexample/</code></p>",
        "id": 539175417,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757718145
    },
    {
        "content": "<p>(right after <code>Diagonalization</code> gets merged)</p>",
        "id": 539175447,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757718158
    },
    {
        "content": "<p>oh (Z/6Z)[X] doesn't have unique factorization</p>",
        "id": 539175591,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757718251
    },
    {
        "content": "<p>is that because <code>2*2 = -1*2</code></p>",
        "id": 539175781,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757718361
    },
    {
        "content": "<p>wait, then that means <code>2</code> is not irreducible</p>",
        "id": 539175828,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757718389
    },
    {
        "content": "<p>well look at <code>X*(X+1) = (X+3)*(X+4)</code></p>",
        "id": 539175832,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757718393
    },
    {
        "content": "<p>oh, missed the [X]</p>",
        "id": 539175859,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757718406
    },
    {
        "content": "<p>well i think <code>3 = 3 * 3</code> is still a big problem even inside (Z/6Z)[X]</p>",
        "id": 539176004,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757718500
    },
    {
        "content": "<p>is X irreducible?</p>",
        "id": 539176100,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757718579
    },
    {
        "content": "<p>uh, <code>X = (2X+3) * (3X+2)</code></p>",
        "id": 539176289,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757718678
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/diagonalizable.20linear.20maps/near/539175591\">said</a>:</p>\n<blockquote>\n<p>oh (Z/6Z)[X] doesn't have unique factorization</p>\n</blockquote>\n<p>I think you have a way bigger problem here... I don't think <em>anything</em> is irreducible, so how can you factorise anything into irreducibles</p>",
        "id": 539176334,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757718714
    },
    {
        "content": "<p>so you end up with this degree 2 polynomial having 4 roots</p>",
        "id": 539176371,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757718731
    },
    {
        "content": "<p>maybe it works better in integral domains</p>",
        "id": 539176450,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757718794
    },
    {
        "content": "<p>The concept of factorization is kind of dead in the water if you have zero divisors.</p>",
        "id": 539176717,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1757718986
    },
    {
        "content": "<p>An exercise which totally stumped me for a while as an undergraduate was: \"Figure out all the ideals of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">Z</mi><mi mathvariant=\"normal\">/</mi><mn>6</mn><mi mathvariant=\"double-struck\">Z</mi></mrow><annotation encoding=\"application/x-tex\">\\Z/6\\Z</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathbb\">Z</span><span class=\"mord\">/6</span><span class=\"mord mathbb\">Z</span></span></span></span>. Is it a PID?\".  The ideals are all principal, so obviously it was a PID, but then that would mean it was a UFD and it clearly wasn't because you can't have <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mo>×</mo><mn>3</mn><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">2\\times 3=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span> in a UFD. Took a while for the penny to drop that it wasn't a PID because although it was a PI, it wasn't a D.</p>",
        "id": 539179172,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1757720759
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/diagonalizable.20linear.20maps/near/539179172\">said</a>:</p>\n<blockquote>\n<p>although it was a PI, it wasn't a D.</p>\n</blockquote>\n<p>that was an end of term exam question for me as a year two student and I thought it was a PID at that time <span aria-label=\"joy\" class=\"emoji emoji-1f602\" role=\"img\" title=\"joy\">:joy:</span></p>",
        "id": 539185255,
        "sender_full_name": "Edison Xie",
        "timestamp": 1757724470
    },
    {
        "content": "<p>OK, I'm cooking it up: <a href=\"https://github.com/leanprover-community/mathlib4/pull/29610\">#29610</a> if there is API people think should be added let me know.</p>\n<p>Should I try to cover simultaneous diagonalizability in the same definition or nah? Something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">Diagonalization</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">End</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">Basis</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">R</span>\n<span class=\"w\">  </span><span class=\"n\">hasEigenVector_μ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">HasEigenvector</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">toBasis</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Or maybe it would make some of the single diagonalizable map stuff too awkward?</p>",
        "id": 539195567,
        "sender_full_name": "Lawrence Wu (llllvvuu)",
        "timestamp": 1757732427
    },
    {
        "content": "<p>Seems to work so far:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">SimultaneousDiagonalization</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">End</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">Basis</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">R</span>\n<span class=\"w\">  </span><span class=\"n\">hasEigenVector_μ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">HasEigenvector</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">toBasis</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span>\n\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">Diagonalization</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">End</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">SimultaneousDiagonalization</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">f</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Diagonalization</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">End</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Basis</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">HasEigenvector</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">Diagonalization</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">toBasis</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">μ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hasEigenVector_μ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">}</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Diagonalization</span><span class=\"bp\">.</span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">End</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">self</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">Diagonalization</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">SimultaneousDiagonalization</span><span class=\"bp\">.</span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"n\">self</span><span class=\"w\"> </span><span class=\"o\">()</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Diagonalization</span><span class=\"bp\">.</span><span class=\"n\">hasEigenVector_μ</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">End</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">self</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">Diagonalization</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">HasEigenvector</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">self</span><span class=\"bp\">.</span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">self</span><span class=\"bp\">.</span><span class=\"n\">toBasis</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">SimultaneousDiagonalization</span><span class=\"bp\">.</span><span class=\"n\">hasEigenVector_μ</span><span class=\"w\"> </span><span class=\"n\">self</span><span class=\"w\"> </span><span class=\"o\">()</span><span class=\"w\"> </span><span class=\"n\">i</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">SimultaneousDiagonalization</span><span class=\"bp\">.</span><span class=\"n\">diagonalization</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">End</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SimultaneousDiagonalization</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">Diagonalization</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Diagonalization</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"bp\">.</span><span class=\"n\">hasEigenVector_μ</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">ext</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">SimultaneousDiagonalization</span><span class=\"bp\">.</span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">End</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">D₁</span><span class=\"w\"> </span><span class=\"n\">D₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SimultaneousDiagonalization</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">D₁</span><span class=\"bp\">.</span><span class=\"n\">toBasis</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">D₂</span><span class=\"bp\">.</span><span class=\"n\">toBasis</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">D₁</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">D₂</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">suffices</span><span class=\"w\"> </span><span class=\"n\">D₁</span><span class=\"bp\">.</span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">D₂</span><span class=\"bp\">.</span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">D₁</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">D₂</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">simp_all</span><span class=\"w\"> </span><span class=\"n\">only</span>\n<span class=\"w\">  </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">i</span>\n<span class=\"w\">  </span><span class=\"n\">suffices</span><span class=\"w\"> </span><span class=\"n\">D₁</span><span class=\"bp\">.</span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">D₁</span><span class=\"bp\">.</span><span class=\"n\">toBasis</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">D₂</span><span class=\"bp\">.</span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">D₁</span><span class=\"bp\">.</span><span class=\"n\">toBasis</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">congr</span><span class=\"o\">(</span><span class=\"n\">D₁</span><span class=\"bp\">.</span><span class=\"n\">toBasis</span><span class=\"bp\">.</span><span class=\"n\">repr</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D₁</span><span class=\"bp\">.</span><span class=\"n\">hasEigenVector_μ</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">apply_eq_smul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D₂</span><span class=\"bp\">.</span><span class=\"n\">hasEigenVector_μ</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">apply_eq_smul</span><span class=\"o\">]</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ι</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">End</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">D₁</span><span class=\"w\"> </span><span class=\"n\">D₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">Diagonalization</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">D₁</span><span class=\"bp\">.</span><span class=\"n\">toBasis</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">D₂</span><span class=\"bp\">.</span><span class=\"n\">toBasis</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">D₁</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">D₂</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">h</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">Diagonalization</span><span class=\"bp\">.</span><span class=\"n\">toMatrix_eq_diagonal</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">End</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">Diagonalization</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">toMatrix</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"bp\">.</span><span class=\"n\">toBasis</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"bp\">.</span><span class=\"n\">toBasis</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">diagonal</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"bp\">.</span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">j</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">toMatrix_apply</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"bp\">.</span><span class=\"n\">hasEigenVector_μ</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">apply_eq_smul</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">grind</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Finsupp</span><span class=\"bp\">.</span><span class=\"n\">single_apply</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">diagonal_apply</span><span class=\"o\">]</span>\n\n<span class=\"c1\">-- note: Nontrivial R golfed in #29420</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">Diagonalization</span><span class=\"bp\">.</span><span class=\"n\">charpoly_eq</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nontrivial</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Free</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">Finite</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">End</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">Diagonalization</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">charpoly</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">∏</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"bp\">.</span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">charpoly_toMatrix</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"bp\">.</span><span class=\"n\">toBasis</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"bp\">.</span><span class=\"n\">toMatrix_eq_diagonal</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">charpoly_diagonal</span><span class=\"o\">]</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span>\n</code></pre></div>",
        "id": 539215113,
        "sender_full_name": "Lawrence Wu (llllvvuu)",
        "timestamp": 1757742289
    },
    {
        "content": "<p>Is a simultaneous diagonalization just a diagonalization of the block diagonal map?</p>",
        "id": 539257675,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757755910
    },
    {
        "content": "<p>It is diagonalization of block diagonal by “block scalar” (meaning block diagonal with identical blocks).</p>",
        "id": 539258518,
        "sender_full_name": "Scott Carnahan",
        "timestamp": 1757756951
    },
    {
        "content": "<p>Ah, and I guess because the basis is bundled you can't just instantiate with Module.Basis.pi</p>",
        "id": 539260414,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757759365
    },
    {
        "content": "<blockquote>\n<p>maybe it works better in integral domains</p>\n</blockquote>\n<p>That's enough to fix the statement. The following is true:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">Diagonalization</span><span class=\"bp\">.</span><span class=\"n\">μ_unique</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">ι'</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsDomain</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">End</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">D₁</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">Diagonalization</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">D₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">Diagonalization</span><span class=\"w\"> </span><span class=\"n\">ι'</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"bp\">≃</span><span class=\"w\"> </span><span class=\"n\">ι'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">D₁</span><span class=\"bp\">.</span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">D₂</span><span class=\"bp\">.</span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>I was too small-brained to immediately see why, so I asked Aristotle to prove it: <a href=\"https://gist.github.com/llllvvuu/b4fd97595ca34cfa1623355a6815254d\">https://gist.github.com/llllvvuu/b4fd97595ca34cfa1623355a6815254d</a></p>\n<p>Seems like the reason is that if you take an eigenvector <code>(mu, v)</code> in its repr <code>c</code> in any diagonalization <code>D</code>, then we have <code>∀ j ∈ c.support → c j • D.μ j = c j • mu</code>, and only in integral domains can we cancel <code>c j</code> and conclude that <code>D</code> includes a basis of every eigenspace.</p>\n<p>(EDIT: just realized there's an easier route that goes through <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Polynomial.roots_prod#doc\">docs#Polynomial.roots_prod</a> and <a href=\"https://github.com/leanprover-community/mathlib4/pull/29526\">#29526</a>.)</p>",
        "id": 539282397,
        "sender_full_name": "Lawrence Wu (llllvvuu)",
        "timestamp": 1757780495
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/29610\">#29610</a> is ready for review (dependency on <a href=\"https://github.com/leanprover-community/mathlib4/pull/29420\">#29420</a> is minor)</p>",
        "id": 539471407,
        "sender_full_name": "Lawrence Wu (llllvvuu)",
        "timestamp": 1757917556
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"607118\">@Lawrence Wu (llllvvuu)</span> Consider the following counterexample: <code>R=ℕ, M=ℕ, N=3*ℕ-{3}</code></p>",
        "id": 539536240,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757937387
    },
    {
        "content": "<p>actually there is no need for 3, consider <code>N=ℕ-{1}</code> instead</p>",
        "id": 539536464,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757937457
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"607118\">@Lawrence Wu (llllvvuu)</span> out of curiosity, how much of the code is yours and how much is aristotle's?</p>",
        "id": 539581838,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757948149
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/diagonalizable.20linear.20maps/near/539581838\">said</a>:</p>\n<blockquote>\n<p>out of curiosity, how much of the code is yours and how much is aristotle's?</p>\n</blockquote>\n<p>I chuck every theorem into Aristotle and then I golf it. I guess my golfing touches close to 100% line-of-code-wise but is a minority of the effort. The only ones I don't do are the ones where I can write the one liner in a few seconds (which is not all one-liners), and sometimes when I'm experimenting, e.g. <code>exists_diagonalization_iff_directSum</code> I was experimenting with the PID stuff.</p>",
        "id": 539585847,
        "sender_full_name": "Lawrence Wu (llllvvuu)",
        "timestamp": 1757949205
    },
    {
        "content": "<p>thanks for the information!</p>",
        "id": 539585944,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757949233
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"607118\">Lawrence Wu (llllvvuu)</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/diagonalizable.20linear.20maps/near/539585847\">said</a>:</p>\n<blockquote>\n<p>theorem</p>\n</blockquote>\n<p>so i assume the initial definitions (and also subsequent <code>def</code>s) are 0% aristotle? and also, does aristotle have access to the mathlib theorems?</p>",
        "id": 539586309,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757949328
    },
    {
        "content": "<blockquote>\n<p>so i assume the initial definitions (and also subsequent <code>def</code>s) are 0% aristotle? and also, does aristotle have access to the mathlib theorems?</p>\n</blockquote>\n<p>It can make its own <code>def</code>s and API, but if I know the end goal is a mathlib PR then I will write the <code>def</code>s and API (signatures) myself. Or for example, in this case: <a href=\"https://gist.github.com/lawrence-harmonic/5f37baa0eecab2ccfca3cf3a7af3bbd5\">https://gist.github.com/lawrence-harmonic/5f37baa0eecab2ccfca3cf3a7af3bbd5</a> Aristotle generated two helper lemmas but I changed the API to be more idiomatic for <a href=\"https://github.com/leanprover-community/mathlib4/pull/29478\">#29478</a> . In that example it can also be seen that yes, it does use, even abuse, mathlib definitions and theorems (this was an extreme case of an unoptimized proof that I golfed a lot, but it was helpful to have the key manipulations written there and the golfing is always pretty low-effort).</p>",
        "id": 539589072,
        "sender_full_name": "Lawrence Wu (llllvvuu)",
        "timestamp": 1757950014
    },
    {
        "content": "<p>small bikeshed, are the names  here (<code>SimultaneousDiagonalization</code>/<code>Diagonalization</code>) good or should I do like <code>CommonEigenbasis</code>/<code>Eigenbasis</code>?</p>",
        "id": 539790342,
        "sender_full_name": "Lawrence Wu (llllvvuu)",
        "timestamp": 1758034053
    },
    {
        "content": "<p><code>Eigenbasis</code> sounds better to me</p>",
        "id": 539792364,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1758034601
    },
    {
        "content": "<p>/poll Name?<br>\nDiagonalization/SimultaneousDiagonalization<br>\nEigenbasis/CommonEigenbasis<br>\nother</p>",
        "id": 539793167,
        "sender_full_name": "Lawrence Wu (llllvvuu)",
        "timestamp": 1758034822
    },
    {
        "content": "<p>I would suggest <code>Eigenbasis</code> but also make sure that the docstring mentions \"diagonalization\" so that it can be discovered with leanexplore</p>",
        "id": 539793618,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1758034928
    },
    {
        "content": "<p>I think we really have a problem with our naming scheme</p>",
        "id": 539793658,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1758034939
    },
    {
        "content": "<p>In what sense?</p>",
        "id": 539804213,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1758037575
    },
    {
        "content": "<p>there's no good way to refer to one thing by two names (or rather we have decided not to). e.g. the whole <code>VectorSpace</code> business we had, which makes Lean less beginner-friendly (when it already is very much not)</p>",
        "id": 539804360,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1758037619
    },
    {
        "content": "<p>I feel like <code>notation \"VectorSpace\" =&gt; Module</code> might work</p>",
        "id": 539804595,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1758037689
    },
    {
        "content": "<p><code>VectorSpace</code> may yet make a comeback, hold on to your hats. <span aria-label=\"wink\" class=\"emoji emoji-1f609\" role=\"img\" title=\"wink\">:wink:</span> (there's some work going on about making collections of classes usable in practice, to the point that having <code>VectorSpace</code> as a kind of abbreviation for <code>[AddCommGroup V] [Field 𝕜] [Module 𝕜 V]</code> would be not just doable, but probably even standard; this is not yet ironed out though.)</p>",
        "id": 539804611,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1758037696
    },
    {
        "content": "<p>who is \"we\"?</p>",
        "id": 539805535,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1758037946
    },
    {
        "content": "<p>I didn't say \"we\". But see <a href=\"https://github.com/leanprover/lean4/pull/8279\">lean4#8279</a>.</p>",
        "id": 539809615,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1758039029
    },
    {
        "content": "<p>I think the implementation of <code>abbrev</code> is not sufficient for the type of aliasing that I want in my head that I suggested with <code>notation</code></p>",
        "id": 539809881,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1758039115
    },
    {
        "content": "<p>obviously <code>notation</code> is morally the wrong thing to choose, but it works the best</p>",
        "id": 539809915,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1758039126
    },
    {
        "content": "<p>(maybe that was the point of the issue that you linked to)</p>",
        "id": 539810016,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1758039164
    },
    {
        "content": "<p>note that the <em>existing</em> <code>class abbrev</code> is even different from <code>class Foo .... attribute [reducible, inline] Foo</code>.</p>",
        "id": 539810346,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1758039261
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/diagonalizable.20linear.20maps/near/539581838\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"607118\">Lawrence Wu (llllvvuu)</span> out of curiosity, how much of the code is yours and how much is aristotle's?</p>\n</blockquote>\n<p>Is Aristotle publicly available for lean work? I saw something on their website about ios but that doesn't seem relevant. Gauss looks like it has a form to request access. Are there any other publicly announced and available assistants?</p>",
        "id": 540316957,
        "sender_full_name": "Ryan Smith",
        "timestamp": 1758228259
    }
]