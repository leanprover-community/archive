[
    {
        "content": "<p>I don't suppose anyone has a proof of this lying around:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">Mathlib.RingTheory.Nilpotent</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.LinearAlgebra.Matrix.Charpoly.Coeff</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.LinearAlgebra.Matrix.Charpoly.Minpoly</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.LinearAlgebra.Trace</span>\n\n<span class=\"c1\">-- Fairly sure `IsReduced` suffices (at least in commutative case) but I'll settle for a proof</span>\n<span class=\"c1\">-- over a field.</span>\n<span class=\"kd\">lemma</span> <span class=\"n\">Matrix.trace_eq_zero_of_isNilpotent</span>\n    <span class=\"o\">(</span><span class=\"n\">R</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">_</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">CommRing</span> <span class=\"n\">R</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">IsReduced</span> <span class=\"n\">R</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">ι</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">_</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">DecidableEq</span> <span class=\"n\">ι</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">Fintype</span> <span class=\"n\">ι</span><span class=\"o\">]</span>\n    <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">Matrix</span> <span class=\"n\">ι</span> <span class=\"n\">ι</span> <span class=\"n\">R</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">IsNilpotent</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">A.trace</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>The informal proofs I know actually require stronger assumptions on <code>R</code> but I expect the above is true.</p>",
        "id": 381540803,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1691079140
    },
    {
        "content": "<p>(Reduced is necessary, as the case of a 1x1 matrix shows.)</p>",
        "id": 381682889,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1691128587
    },
    {
        "content": "<p>(It also suffices: then the intersection of all prime ideals P is zero, it suffices to check mod such P, but R/P is a domain, hence we're back to the classic case of fields. )</p>",
        "id": 381683612,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1691128794
    },
    {
        "content": "<p>(The case of a companion matrix is already nice: if P is a monic polynomial and M is the corresponding companion matrix, then M is nilpotent iff there exists n such that P divides X^n. Write X^n=P·Q and consider the reverted polynomials P*=P(1/X) X^p, Q*=Q(1/X) X^q, with p, q the degrees of P, Q  and n=p+q. Then 1=P<em>· Q</em>. Then all coefficients of P* are nilpotent,  but the constant one which is 1. On a reduced ring, you get P=X^p.)</p>",
        "id": 381688938,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1691130044
    },
    {
        "content": "<p>(Unfortunately,  I know his to use this over fields to get the result you need, but not directly over a reduced field)</p>",
        "id": 381689366,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1691130140
    },
    {
        "content": "<p>I wonder if you could use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Polynomial.isUnit_iff#doc\">docs#Polynomial.isUnit_iff</a> to show that all the coefficients of the characteristic polynomial of a nilpotent matrix are nilpotent, except for the leading one.</p>\n<p>This would probably make the assumption <code>IsReduced</code> only appear when you go from \"trace is nilpotent\" to \"trace is zero\".</p>",
        "id": 381750864,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1691140833
    },
    {
        "content": "<p>I guess you mean <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Polynomial.isUnit_iff_coeff_isUnit_isNilpotent#doc\">docs#Polynomial.isUnit_iff_coeff_isUnit_isNilpotent</a></p>",
        "id": 381752857,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1691141169
    },
    {
        "content": "<p>Yes, that is probably a better form!  Btw, I do not <em>know</em> that the characteristic polynomial <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>χ</mi></mrow><annotation encoding=\"application/x-tex\">\\chi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">χ</span></span></span></span> of a nilpotent matrix satisfies <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>χ</mi><mi>N</mi></msup><mo>=</mo><msup><mi>X</mi><mi>M</mi></msup></mrow><annotation encoding=\"application/x-tex\">\\chi ^ N = X ^ M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0358em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">χ</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8413em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span></span></span></span></span></span></span>, for some <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>N</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">N &gt; 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7224em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&gt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>.  However, if true, then it would be a fun fact that I learn thanks to Lean!</p>",
        "id": 381754864,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1691141474
    },
    {
        "content": "<p>Hmm, indeed over a general ring looks like a nontrivial question</p>",
        "id": 381758227,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1691141980
    },
    {
        "content": "<p>Maybe you could still argue \"the wrong way\": quotient by the radical of the ring, do the reduction to domains, deduce that the characteristic polynomial is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>X</mi><mi>M</mi></msup></mrow><annotation encoding=\"application/x-tex\">X^M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8413em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span></span></span></span></span></span></span> up to radical and conclude.</p>\n<p>My hope was that there might be a direct way to argue this, without doing the various reduction steps.  <span aria-label=\"shrug\" class=\"emoji emoji-1f937\" role=\"img\" title=\"shrug\">:shrug:</span></p>",
        "id": 381760051,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1691142257
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/stream/217875-Is-there-code-for-X.3F/topic/Nilpotent.20implies.20trace.20zero/near/381754864\">said</a>:</p>\n<blockquote>\n<p>Yes, that is probably a better form!  Btw, I do not <em>know</em> that the characteristic polynomial <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>χ</mi></mrow><annotation encoding=\"application/x-tex\">\\chi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">χ</span></span></span></span> of a nilpotent matrix satisfies <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>χ</mi><mi>N</mi></msup><mo>=</mo><msup><mi>X</mi><mi>M</mi></msup></mrow><annotation encoding=\"application/x-tex\">\\chi ^ N = X ^ M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0358em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">χ</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8413em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">M</span></span></span></span></span></span></span></span></span></span></span>, for some <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>N</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">N &gt; 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7224em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&gt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>.  However, if true, then it would be a fun fact that I learn thanks to Lean!</p>\n</blockquote>\n<p>This could only hold for R reduced, right? Consider <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi><mo>=</mo><mi mathvariant=\"double-struck\">Q</mi><mo stretchy=\"false\">[</mo><mi>ϵ</mi><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">/</mi><mo stretchy=\"false\">(</mo><msup><mi>ϵ</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">R=\\mathbb{Q}[\\epsilon]/(\\epsilon^2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord mathbb\">Q</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">ϵ</span><span class=\"mclose\">]</span><span class=\"mord\">/</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">ϵ</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> with 1x1 matrix <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ϵ</mi></mrow><annotation encoding=\"application/x-tex\">\\epsilon</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">ϵ</span></span></span></span>. Then <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>χ</mi><mi>N</mi></msup><mo>=</mo><msup><mi>X</mi><mi>N</mi></msup><mo>−</mo><mi>N</mi><mi>ϵ</mi><msup><mi>X</mi><mrow><mi>N</mi><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">\\chi^N=X^N-N\\epsilon X^{N-1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0358em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">χ</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9247em;vertical-align:-0.0833em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8413em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mord mathnormal\">ϵ</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span>.</p>",
        "id": 381896773,
        "sender_full_name": "Arend Mellendijk",
        "timestamp": 1691163631
    },
    {
        "content": "<p>Arend, yes, that statement is not true.  I still wonder whether the statement that the characteristic polynomial has all its coefficients nilpotent, except for the leading one.</p>",
        "id": 381900040,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1691164226
    },
    {
        "content": "<p>How about this?</p>\n<p>Start with <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>I</mi><mo>=</mo><mi>I</mi><mo>−</mo><mo stretchy=\"false\">(</mo><mi>t</mi><mi>A</mi><msup><mo stretchy=\"false\">)</mo><mrow><mi>N</mi><mo>+</mo><mn>1</mn></mrow></msup><mo>=</mo><mo stretchy=\"false\">(</mo><mi>I</mi><mo>−</mo><mi>t</mi><mi>A</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">(</mo><mi>I</mi><mo>+</mo><mi>t</mi><mi>A</mi><mo>+</mo><mo>⋯</mo><mo>+</mo><mo stretchy=\"false\">(</mo><mi>t</mi><mi>A</mi><msup><mo stretchy=\"false\">)</mo><mi>N</mi></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">I = I - (tA)^{N+1} = (I - tA)(I + tA + \\cdots + (tA)^N)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0913em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">A</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">A</span><span class=\"mclose\">)</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">A</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"minner\">⋯</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0913em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">A</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>.</p>\n<p>Compute determinants on both sides and use that the determinant of a product is the product of the determinants.</p>\n<p>Deduce that the determinant of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>I</mi><mo>−</mo><mi>t</mi><mi>A</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(I - tA)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">A</span><span class=\"mclose\">)</span></span></span></span> is an invertible polynomial.  Therefore all its coefficients of positive degree are nilpotents.</p>\n<p>Is this right?  If only I had a proof assistant at hand...</p>",
        "id": 381966091,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1691179654
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130384\">Riccardo Brasca</span> <a href=\"#narrow/stream/217875-Is-there-code-for-X.3F/topic/Nilpotent.20implies.20trace.20zero/near/381758227\">said</a>:</p>\n<blockquote>\n<p>Hmm, indeed over a general ring looks like a nontrivial question</p>\n</blockquote>\n<p>Over a general ring, it is true. If <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\"> a </annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span> is a nilpotent element, then the characteristic polynomial of the matrix <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mi>a</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\"> [a] </annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">a</span><span class=\"mclose\">]</span></span></span></span> is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi><mo>−</mo><mi>a</mi></mrow><annotation encoding=\"application/x-tex\"> T - a </annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span>.<br>\nIt holds over a reduced ring by the arguments I gave above.</p>",
        "id": 381970883,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1691181327
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/stream/217875-Is-there-code-for-X.3F/topic/Nilpotent.20implies.20trace.20zero/near/381966091\">said</a>:</p>\n<blockquote>\n<p>How about this?</p>\n<p>Start with <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>I</mi><mo>=</mo><mi>I</mi><mo>−</mo><mo stretchy=\"false\">(</mo><mi>t</mi><mi>A</mi><msup><mo stretchy=\"false\">)</mo><mrow><mi>N</mi><mo>+</mo><mn>1</mn></mrow></msup><mo>=</mo><mo stretchy=\"false\">(</mo><mi>I</mi><mo>−</mo><mi>t</mi><mi>A</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">(</mo><mi>I</mi><mo>+</mo><mi>t</mi><mi>A</mi><mo>+</mo><mo>⋯</mo><mo>+</mo><mo stretchy=\"false\">(</mo><mi>t</mi><mi>A</mi><msup><mo stretchy=\"false\">)</mo><mi>N</mi></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">I = I - (tA)^{N+1} = (I - tA)(I + tA + \\cdots + (tA)^N)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0913em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">A</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">A</span><span class=\"mclose\">)</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">A</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"minner\">⋯</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0913em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">A</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>.</p>\n<p>Compute determinants on both sides and use that the determinant of a product is the product of the determinants.</p>\n<p>Deduce that the determinant of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>I</mi><mo>−</mo><mi>t</mi><mi>A</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(I - tA)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">A</span><span class=\"mclose\">)</span></span></span></span> is an invertible polynomial.  Therefore all its coefficients of positive degree are nilpotents.</p>\n<p>Is this right?  If only I had a proof assistant at hand...</p>\n</blockquote>\n<p>This is a cool proof.</p>",
        "id": 381971101,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1691181380
    },
    {
        "content": "<p>Thanks to the work of Riccardo's students, that should make a nice proof in mathlib.</p>",
        "id": 381971453,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1691181500
    },
    {
        "content": "<p>On the other hand, proving that if a polynomial <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi></mrow><annotation encoding=\"application/x-tex\"> P </annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span> is a unit then its constant coefficient is a unit and all other are nilpotents can be done right away once one has the characterization of nilpotent elements: mod out a prime ideal <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\"> p </annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">p</span></span></span></span>, the polynomial <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi></mrow><annotation encoding=\"application/x-tex\"> P </annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span> is a unit, but since <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi><mi mathvariant=\"normal\">/</mi><mi>p</mi></mrow><annotation encoding=\"application/x-tex\"> R / p </annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mord\">/</span><span class=\"mord mathnormal\">p</span></span></span></span> is a domain, this implies that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi></mrow><annotation encoding=\"application/x-tex\"> P </annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span> has degree <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\"> 0 </annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span> mod <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\"> p </annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">p</span></span></span></span>, so all of its nonconstant coefficients belong to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\"> p </annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">p</span></span></span></span>. Then all nonconstant coefficients of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi></mrow><annotation encoding=\"application/x-tex\"> P </annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span> are nilpotent.</p>",
        "id": 381971845,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1691181655
    },
    {
        "content": "<p>I agree: the hardest part is the fact about invertible polynomials, which I find is a very elegant result.</p>",
        "id": 381971865,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1691181662
    },
    {
        "content": "<p>I couldn't help myself and I formalized the proof that, for a nilpotent matrix, the \"<code>revcharpoly</code>\" is a unit!</p>\n<p>The proof is simply a transliteration of the proof above: I have made no effort to simplify it.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">Mathlib.Data.Polynomial.Basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.LinearAlgebra.Matrix.Determinant</span>\n\n<span class=\"c1\">--  I could only find the commutative version of this lemma, though it likely is already in mathlib</span>\n<span class=\"kd\">theorem</span> <span class=\"n\">_root_.Commute.sub_dvd_pow_dvd_pow_of</span> <span class=\"o\">[</span><span class=\"n\">Ring</span> <span class=\"n\">R</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">R</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">Commute</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">}</span> <span class=\"o\">:</span>\n    <span class=\"n\">a</span> <span class=\"bp\">-</span> <span class=\"n\">b</span> <span class=\"bp\">∣</span> <span class=\"n\">a</span> <span class=\"bp\">^</span> <span class=\"n\">n</span> <span class=\"bp\">-</span> <span class=\"n\">b</span> <span class=\"bp\">^</span> <span class=\"n\">n</span> <span class=\"o\">:=</span>\n<span class=\"n\">Dvd.intro</span> <span class=\"n\">_</span> <span class=\"o\">(</span><span class=\"n\">h.mul_geom_sum₂</span> <span class=\"n\">_</span><span class=\"o\">)</span>\n\n<span class=\"kd\">variable</span> <span class=\"o\">{</span><span class=\"n\">R</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">CommRing</span> <span class=\"n\">R</span><span class=\"o\">]</span>\n\n<span class=\"kd\">variable</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">v</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">DecidableEq</span> <span class=\"n\">n</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">Fintype</span> <span class=\"n\">n</span><span class=\"o\">]</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">Matrix</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">Polynomial</span>\n\n<span class=\"kd\">variable</span> <span class=\"o\">(</span><span class=\"n\">M</span> <span class=\"o\">:</span> <span class=\"n\">Matrix</span> <span class=\"n\">n</span> <span class=\"n\">n</span> <span class=\"n\">R</span><span class=\"o\">)</span>\n\n<span class=\"kd\">noncomputable</span> <span class=\"kn\">section</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">revcharmatrix</span> <span class=\"o\">:</span> <span class=\"n\">Matrix</span> <span class=\"n\">n</span> <span class=\"n\">n</span> <span class=\"n\">R</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span> <span class=\"o\">:=</span>\n  <span class=\"mi\">1</span> <span class=\"bp\">-</span> <span class=\"n\">Matrix.scalar</span> <span class=\"n\">n</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"n\">R</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">C</span> <span class=\"o\">:</span> <span class=\"n\">R</span> <span class=\"bp\">→+*</span> <span class=\"n\">R</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"bp\">.</span><span class=\"n\">mapMatrix</span> <span class=\"n\">M</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">revcharpoly</span> <span class=\"o\">:</span> <span class=\"n\">R</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span> <span class=\"o\">:=</span> <span class=\"n\">det</span> <span class=\"o\">(</span><span class=\"n\">revcharmatrix</span> <span class=\"n\">M</span><span class=\"o\">)</span>\n\n<span class=\"c1\">--  why did I not find this lemma already?</span>\n<span class=\"kd\">theorem</span> <span class=\"n\">map_pow</span> <span class=\"o\">(</span><span class=\"n\">N</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">map</span> <span class=\"o\">(</span><span class=\"n\">M</span> <span class=\"bp\">^</span> <span class=\"n\">N</span><span class=\"o\">)</span> <span class=\"n\">C</span> <span class=\"bp\">=</span> <span class=\"n\">map</span> <span class=\"n\">M</span> <span class=\"n\">C</span> <span class=\"bp\">^</span> <span class=\"n\">N</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"n\">induction</span> <span class=\"n\">N</span> <span class=\"k\">with</span>\n    <span class=\"bp\">|</span> <span class=\"n\">zero</span> <span class=\"bp\">=&gt;</span> <span class=\"n\">simp</span>\n    <span class=\"bp\">|</span> <span class=\"n\">succ</span> <span class=\"n\">N</span> <span class=\"bp\">=&gt;</span> <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">pow_succ</span><span class=\"o\">,</span> <span class=\"bp\">*</span><span class=\"o\">]</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">IsUnit_revcharpoly_of_IsNilpotent</span> <span class=\"o\">(</span><span class=\"n\">hM</span> <span class=\"o\">:</span> <span class=\"n\">IsNilpotent</span> <span class=\"n\">M</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">IsUnit</span> <span class=\"o\">(</span><span class=\"n\">revcharpoly</span> <span class=\"n\">M</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"n\">rcases</span> <span class=\"n\">hM</span> <span class=\"k\">with</span> <span class=\"o\">⟨</span><span class=\"n\">N</span><span class=\"o\">,</span> <span class=\"n\">hM</span><span class=\"o\">⟩</span>\n  <span class=\"n\">apply</span> <span class=\"n\">isUnit_of_dvd_one</span>\n  <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"mi\">1</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span> <span class=\"bp\">-</span> <span class=\"o\">(</span><span class=\"n\">scalar</span> <span class=\"n\">n</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"n\">R</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">C</span> <span class=\"o\">:</span> <span class=\"n\">R</span> <span class=\"bp\">→+*</span> <span class=\"n\">R</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"bp\">.</span><span class=\"n\">mapMatrix</span> <span class=\"n\">M</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"n\">N</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n    <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"bp\">←</span> <span class=\"n\">map_pow</span><span class=\"o\">,</span> <span class=\"n\">hM</span><span class=\"o\">,</span> <span class=\"n\">smul_pow</span><span class=\"o\">]</span>\n  <span class=\"n\">apply_fun</span> <span class=\"n\">det</span> <span class=\"n\">at</span> <span class=\"n\">this</span>\n  <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">det_one</span><span class=\"o\">]</span> <span class=\"n\">at</span> <span class=\"n\">this</span>\n  <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">this</span><span class=\"o\">]</span>\n  <span class=\"n\">obtain</span> <span class=\"o\">⟨</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">h</span><span class=\"o\">⟩</span> <span class=\"o\">:</span> <span class=\"n\">revcharmatrix</span> <span class=\"n\">M</span> <span class=\"bp\">∣</span> <span class=\"mi\">1</span> <span class=\"bp\">-</span> <span class=\"o\">((</span><span class=\"n\">scalar</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"n\">X</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">RingHom.mapMatrix</span> <span class=\"n\">C</span><span class=\"o\">)</span> <span class=\"n\">M</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"n\">N</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"bp\">←</span> <span class=\"n\">one_pow</span> <span class=\"n\">N</span><span class=\"o\">]</span>\n    <span class=\"n\">exact</span> <span class=\"n\">Commute.sub_dvd_pow_dvd_pow_of</span> <span class=\"o\">(</span><span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">)</span>\n  <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">h</span><span class=\"o\">]</span>\n  <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">revcharpoly</span><span class=\"o\">,</span> <span class=\"n\">revcharmatrix</span><span class=\"o\">]</span>\n\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">end</span> <span class=\"n\">Matrix</span>\n</code></pre></div>",
        "id": 382065101,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1691223750
    },
    {
        "content": "<p>To get the statement that Oliver wants, one possible strategy would be to connect <code>revcharpoly</code> and <code>charpoly</code> (probably via <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Polynomial.reverse#doc\">docs#Polynomial.reverse</a>) and finally that the trace of a matrix is a coefficient (I think that this is <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix.trace_eq_neg_charpoly_coeff#doc\">docs#Matrix.trace_eq_neg_charpoly_coeff</a>).</p>",
        "id": 382065113,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1691223754
    },
    {
        "content": "<p>I've been travelling for most of the last two days so I'm only properly catching up with this thread now. I'm amazed how fruitful this nerd sniping effort turned out to be, and also extremely grateful especially to <span class=\"user-mention\" data-user-id=\"130609\">@Antoine Chambert-Loir</span> and <span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> . I'll PR a proof of this next week unless someone beats me to it.</p>",
        "id": 382130573,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1691238660
    },
    {
        "content": "<p>I only care about the commutative case but of course there's still the non-commutative case: there's no characteristic polynomial but there is still a trace! I wonder what's true there?</p>",
        "id": 382131217,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1691238816
    },
    {
        "content": "<p>It seems it works. <a href=\"https://arxiv.org/abs/2002.01538\">https://arxiv.org/abs/2002.01538</a></p>",
        "id": 382140137,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1691241033
    },
    {
        "content": "<p>I just realized that the argument above can be split as</p>\n<ul>\n<li>the sum of a unit and a nilpotent element that commute is a unit (<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Commute.IsNilpotent.add_isUnit#doc\">docs#Commute.IsNilpotent.add_isUnit</a>);</li>\n<li>the image under a multiplicative homomorphism of a unit is a unit (<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsUnit.map#doc\">docs#IsUnit.map</a>).</li>\n</ul>\n<p>This may shorten the proof quite a bit.</p>",
        "id": 382218321,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1691265550
    },
    {
        "content": "<p>Trying to simplify the above, I ran into this issue.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">Mathlib.RingTheory.Nilpotent</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.Data.Matrix.Basic</span>\n\n<span class=\"kd\">variable</span> <span class=\"o\">{</span><span class=\"n\">R</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">CommRing</span> <span class=\"n\">R</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">v</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">CommRing</span> <span class=\"n\">S</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">Algebra</span> <span class=\"n\">R</span> <span class=\"n\">S</span><span class=\"o\">]</span>\n\n<span class=\"kd\">variable</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">w</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">DecidableEq</span> <span class=\"n\">n</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">Fintype</span> <span class=\"n\">n</span><span class=\"o\">]</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">Matrix</span>\n\n<span class=\"kd\">example</span> <span class=\"o\">{</span><span class=\"n\">M</span> <span class=\"o\">:</span> <span class=\"n\">Matrix</span> <span class=\"n\">n</span> <span class=\"n\">n</span> <span class=\"n\">R</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">hM</span> <span class=\"o\">:</span> <span class=\"n\">IsNilpotent</span> <span class=\"n\">M</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n    <span class=\"n\">IsNilpotent</span> <span class=\"o\">((</span><span class=\"n\">RingHom.mapMatrix</span> <span class=\"o\">(</span><span class=\"n\">algebraMap</span> <span class=\"n\">R</span> <span class=\"n\">S</span><span class=\"o\">))</span> <span class=\"n\">M</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"n\">convert</span> <span class=\"n\">IsNilpotent.map</span> <span class=\"n\">hM</span> <span class=\"o\">((</span><span class=\"n\">RingHom.mapMatrix</span> <span class=\"o\">(</span><span class=\"n\">m</span> <span class=\"o\">:=</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">algebraMap</span> <span class=\"n\">R</span> <span class=\"n\">S</span><span class=\"o\">)))</span>\n  <span class=\"c1\">-- ⊢ IsNilpotent (↑(RingHom.mapMatrix (algebraMap R S)) M) ↔</span>\n  <span class=\"c1\">--   IsNilpotent (↑(RingHom.mapMatrix (algebraMap R S)) M)</span>\n  <span class=\"gr\">sorry</span>\n  <span class=\"c1\">-- 3 more goals</span>\n<span class=\"c1\">-- I could not get `apply/refine IsNilpotent.map` to work either</span>\n</code></pre></div>\n<p>Am I missing something?  I do not understand even if an instance is missing or whether I am doing something that is not expected to work.</p>",
        "id": 382260053,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1691288887
    },
    {
        "content": "<p>I have not gotten there yet, but I am getting closer!</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">Mathlib.Data.Polynomial.Laurent</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.LinearAlgebra.Matrix.Charpoly.Coeff</span>\n\n<span class=\"kn\">local</span> <span class=\"kd\">notation</span><span class=\"o\">:</span><span class=\"mi\">9000</span> <span class=\"n\">R</span> <span class=\"s2\">\"[T;T⁻¹]\"</span> <span class=\"bp\">=&gt;</span> <span class=\"n\">LaurentPolynomial</span> <span class=\"n\">R</span>\n<span class=\"kd\">universe</span> <span class=\"n\">u</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">LaurentPolynomial</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">Polynomial</span>\n\n<span class=\"kd\">variable</span> <span class=\"o\">{</span><span class=\"n\">R</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">Semiring</span> <span class=\"n\">R</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">z</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">f</span> <span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">R</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]}</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">T_eq_pow_of_nat</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">T</span> <span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"n\">R</span><span class=\"o\">[</span><span class=\"n\">T</span><span class=\"bp\">;</span><span class=\"n\">T</span><span class=\"bp\">⁻¹</span><span class=\"o\">])</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"n\">T</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"n\">n</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">T_pow</span><span class=\"o\">,</span> <span class=\"n\">mul_one</span><span class=\"o\">]</span>\n\n<span class=\"kd\">@[simp]</span>\n<span class=\"kd\">theorem</span> <span class=\"n\">map_add</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">toLaurent</span> <span class=\"n\">f</span> <span class=\"bp\">+</span> <span class=\"n\">toLaurent</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"n\">z</span> <span class=\"bp\">=</span> <span class=\"n\">toLaurent</span> <span class=\"n\">f</span> <span class=\"n\">z</span> <span class=\"bp\">+</span> <span class=\"n\">toLaurent</span> <span class=\"n\">g</span> <span class=\"n\">z</span> <span class=\"o\">:=</span> <span class=\"n\">rfl</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">toLaurent_apply_eq_coeff</span> <span class=\"o\">:</span> <span class=\"n\">toLaurent</span> <span class=\"n\">f</span> <span class=\"n\">n</span> <span class=\"bp\">=</span> <span class=\"n\">f.coeff</span> <span class=\"n\">n</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"n\">refine</span> <span class=\"n\">f.induction_on'</span> <span class=\"bp\">?</span><span class=\"n\">_</span> <span class=\"bp\">?</span><span class=\"n\">_</span>\n  <span class=\"bp\">·</span> <span class=\"n\">intros</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">hp</span> <span class=\"n\">hq</span>\n    <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"bp\">←</span> <span class=\"n\">hp</span><span class=\"o\">,</span> <span class=\"bp\">←</span> <span class=\"n\">hq</span><span class=\"o\">,</span> <span class=\"n\">toLaurent.map_add</span><span class=\"o\">]</span>\n  <span class=\"bp\">·</span> <span class=\"n\">intros</span> <span class=\"n\">m</span> <span class=\"n\">a</span>\n    <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">toLaurent_C_mul_T</span><span class=\"o\">,</span> <span class=\"bp\">←</span> <span class=\"n\">single_eq_C_mul_T</span><span class=\"o\">,</span> <span class=\"n\">Finsupp.single_apply</span><span class=\"o\">,</span> <span class=\"n\">Nat.cast_inj</span><span class=\"o\">,</span>\n      <span class=\"n\">coeff_monomial</span><span class=\"o\">]</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">toLaurent_apply_eq_zero_of_neg</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">z</span> <span class=\"bp\">&lt;</span> <span class=\"mi\">0</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">toLaurent</span> <span class=\"n\">f</span> <span class=\"n\">z</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"n\">refine</span> <span class=\"n\">f.induction_on'</span> <span class=\"bp\">?</span><span class=\"n\">_</span> <span class=\"bp\">?</span><span class=\"n\">_</span>\n  <span class=\"bp\">·</span> <span class=\"n\">intro</span> <span class=\"n\">f</span> <span class=\"n\">g</span> <span class=\"n\">f0</span> <span class=\"n\">g0</span>\n    <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">f0</span><span class=\"o\">,</span> <span class=\"n\">g0</span><span class=\"o\">]</span>\n  <span class=\"bp\">·</span> <span class=\"n\">intros</span> <span class=\"n\">n</span> <span class=\"n\">a</span>\n    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">toLaurent_C_mul_T</span><span class=\"o\">,</span> <span class=\"bp\">←</span> <span class=\"n\">single_eq_C_mul_T</span><span class=\"o\">,</span> <span class=\"n\">Finsupp.single_apply_eq_zero</span><span class=\"o\">]</span>\n    <span class=\"n\">rintro</span> <span class=\"n\">rfl</span>\n    <span class=\"n\">exfalso</span>\n    <span class=\"n\">exact</span> <span class=\"n\">Iff.mp</span> <span class=\"o\">(</span><span class=\"n\">Int.negSucc_not_nonneg</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"n\">h</span>\n\n<span class=\"kd\">end</span> <span class=\"n\">LaurentPolynomial</span>\n\n<span class=\"c1\">--  I could only find the commutative version of this lemma, though it likely is already in mathlib</span>\n<span class=\"kd\">theorem</span> <span class=\"n\">_root_.Commute.sub_dvd_pow_dvd_pow_of</span> <span class=\"o\">[</span><span class=\"n\">Ring</span> <span class=\"n\">R</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">R</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">Commute</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">}</span> <span class=\"o\">:</span>\n    <span class=\"n\">a</span> <span class=\"bp\">-</span> <span class=\"n\">b</span> <span class=\"bp\">∣</span> <span class=\"n\">a</span> <span class=\"bp\">^</span> <span class=\"n\">n</span> <span class=\"bp\">-</span> <span class=\"n\">b</span> <span class=\"bp\">^</span> <span class=\"n\">n</span> <span class=\"o\">:=</span>\n<span class=\"n\">Dvd.intro</span> <span class=\"n\">_</span> <span class=\"o\">(</span><span class=\"n\">h.mul_geom_sum₂</span> <span class=\"n\">_</span><span class=\"o\">)</span>\n\n<span class=\"kd\">variable</span> <span class=\"o\">{</span><span class=\"n\">R</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">CommRing</span> <span class=\"n\">R</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">w</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">CommRing</span> <span class=\"n\">S</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">Algebra</span> <span class=\"n\">R</span> <span class=\"n\">S</span><span class=\"o\">]</span>\n\n<span class=\"kd\">variable</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">v</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">DecidableEq</span> <span class=\"n\">n</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">Fintype</span> <span class=\"n\">n</span><span class=\"o\">]</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">Matrix</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">Polynomial</span>\n\n<span class=\"kd\">variable</span> <span class=\"o\">(</span><span class=\"n\">M</span> <span class=\"o\">:</span> <span class=\"n\">Matrix</span> <span class=\"n\">n</span> <span class=\"n\">n</span> <span class=\"n\">R</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">S</span><span class=\"o\">)</span>\n\n<span class=\"kd\">noncomputable</span> <span class=\"kn\">section</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">revcharmatrix_apply</span> <span class=\"o\">:</span> <span class=\"n\">Matrix</span> <span class=\"n\">n</span> <span class=\"n\">n</span> <span class=\"n\">S</span> <span class=\"o\">:=</span>\n  <span class=\"mi\">1</span> <span class=\"bp\">-</span> <span class=\"n\">Matrix.scalar</span> <span class=\"n\">n</span> <span class=\"n\">s</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">algebraMap</span> <span class=\"n\">R</span> <span class=\"n\">S</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mapMatrix</span> <span class=\"n\">M</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">revcharpoly_apply</span> <span class=\"o\">:</span> <span class=\"n\">S</span> <span class=\"o\">:=</span> <span class=\"n\">det</span> <span class=\"o\">(</span><span class=\"n\">revcharmatrix_apply</span> <span class=\"n\">M</span> <span class=\"n\">s</span><span class=\"o\">)</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">LaurentPolynomial</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">scalar_apply_ite</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">R</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"o\">:</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n    <span class=\"o\">(</span><span class=\"n\">scalar</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"n\">a</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"bp\">=</span> <span class=\"n\">ite</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"bp\">=</span> <span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"n\">a</span> <span class=\"mi\">0</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"n\">split_ifs</span> <span class=\"k\">with</span> <span class=\"n\">h</span>\n  <span class=\"bp\">·</span> <span class=\"n\">subst</span> <span class=\"n\">h</span>\n    <span class=\"n\">exact</span> <span class=\"n\">scalar_apply_eq</span> <span class=\"n\">a</span> <span class=\"n\">i</span>\n  <span class=\"bp\">·</span> <span class=\"n\">exact</span> <span class=\"n\">scalar_apply_ne</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">h</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">T_mul_revcharmatrix_apply_eq_charmatrix</span> <span class=\"o\">:</span>\n    <span class=\"n\">T</span> <span class=\"o\">(</span><span class=\"n\">R</span> <span class=\"o\">:=</span> <span class=\"n\">R</span><span class=\"o\">)</span> <span class=\"mi\">1</span> <span class=\"bp\">•</span> <span class=\"o\">(</span><span class=\"n\">revcharmatrix_apply</span> <span class=\"n\">M</span> <span class=\"o\">(</span><span class=\"n\">T</span> <span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">))</span> <span class=\"o\">:</span> <span class=\"n\">Matrix</span> <span class=\"n\">n</span> <span class=\"n\">n</span> <span class=\"n\">R</span><span class=\"o\">[</span><span class=\"n\">T</span><span class=\"bp\">;</span><span class=\"n\">T</span><span class=\"bp\">⁻¹</span><span class=\"o\">])</span> <span class=\"bp\">=</span>\n      <span class=\"n\">toLaurent.mapMatrix</span> <span class=\"o\">(</span><span class=\"n\">charmatrix</span> <span class=\"n\">M</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">revcharmatrix_apply</span><span class=\"o\">,</span> <span class=\"n\">smul_sub</span><span class=\"o\">]</span>\n  <span class=\"n\">trans</span> <span class=\"o\">(</span><span class=\"n\">scalar</span> <span class=\"n\">n</span> <span class=\"o\">(</span><span class=\"n\">T</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"bp\">-</span> <span class=\"o\">(</span><span class=\"n\">algebraMap</span> <span class=\"n\">R</span> <span class=\"n\">R</span><span class=\"o\">[</span><span class=\"n\">T</span><span class=\"bp\">;</span><span class=\"n\">T</span><span class=\"bp\">⁻¹</span><span class=\"o\">])</span><span class=\"bp\">.</span><span class=\"n\">mapMatrix</span> <span class=\"n\">M</span><span class=\"o\">)</span>\n  <span class=\"bp\">·</span> <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">coe_scalar</span><span class=\"o\">,</span> <span class=\"n\">RingHom.mapMatrix_apply</span><span class=\"o\">,</span> <span class=\"n\">AddMonoidAlgebra.coe_algebraMap</span><span class=\"o\">,</span>\n      <span class=\"n\">Algebra.id.map_eq_id</span><span class=\"o\">,</span> <span class=\"n\">Algebra.smul_mul_assoc</span><span class=\"o\">,</span> <span class=\"n\">one_mul</span><span class=\"o\">,</span> <span class=\"bp\">←</span> <span class=\"n\">smul_assoc</span><span class=\"o\">,</span> <span class=\"n\">smul_eq_mul</span><span class=\"o\">,</span> <span class=\"bp\">←</span> <span class=\"n\">T_add</span><span class=\"o\">,</span>\n      <span class=\"n\">add_right_neg</span><span class=\"o\">,</span> <span class=\"n\">T_zero</span><span class=\"o\">,</span> <span class=\"n\">one_smul</span><span class=\"o\">]</span>\n  <span class=\"n\">trans</span> <span class=\"o\">((</span><span class=\"n\">scalar</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">toLaurent</span> <span class=\"n\">X</span><span class=\"o\">)</span> <span class=\"bp\">-</span> <span class=\"o\">((</span><span class=\"n\">toLaurent.comp</span> <span class=\"n\">Polynomial.C</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mapMatrix</span><span class=\"o\">)</span> <span class=\"n\">M</span><span class=\"o\">)</span>\n  <span class=\"bp\">·</span> <span class=\"n\">ext</span>\n    <span class=\"n\">simp</span>\n  <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">RingHom.mapMatrix_apply</span><span class=\"o\">,</span> <span class=\"n\">RingHom.coe_comp</span><span class=\"o\">,</span> <span class=\"n\">map_sub</span><span class=\"o\">,</span>\n    <span class=\"n\">map_map</span><span class=\"o\">,</span> <span class=\"n\">sub_left_inj</span><span class=\"o\">,</span> <span class=\"n\">charmatrix</span><span class=\"o\">]</span>\n  <span class=\"n\">ext</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"o\">:</span> <span class=\"mi\">2</span>\n  <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">scalar_apply_ite</span><span class=\"o\">,</span> <span class=\"n\">map_apply</span><span class=\"o\">,</span> <span class=\"n\">scalar_apply_ite</span><span class=\"o\">]</span>\n  <span class=\"n\">split_ifs</span> <span class=\"bp\">&lt;;&gt;</span> <span class=\"n\">simp</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">T_pow_mul_revcharpoly_T_neg_one_eq_charpoly</span> <span class=\"o\">:</span>\n    <span class=\"n\">T</span> <span class=\"o\">(</span><span class=\"n\">Fintype.card</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">revcharpoly_apply</span> <span class=\"n\">M</span> <span class=\"o\">(</span><span class=\"n\">T</span> <span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">))</span> <span class=\"o\">:</span> <span class=\"n\">R</span><span class=\"o\">[</span><span class=\"n\">T</span><span class=\"bp\">;</span><span class=\"n\">T</span><span class=\"bp\">⁻¹</span><span class=\"o\">])</span> <span class=\"bp\">=</span>\n      <span class=\"n\">toLaurent</span> <span class=\"o\">(</span><span class=\"n\">charpoly</span> <span class=\"n\">M</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">revcharpoly_apply</span><span class=\"o\">,</span> <span class=\"n\">T_eq_pow_of_nat</span><span class=\"o\">,</span> <span class=\"bp\">←</span> <span class=\"n\">det_smul</span><span class=\"o\">,</span> <span class=\"n\">T_mul_revcharmatrix_apply_eq_charmatrix</span><span class=\"o\">,</span>\n    <span class=\"bp\">←</span> <span class=\"n\">RingHom.map_det</span><span class=\"o\">,</span> <span class=\"n\">charpoly</span><span class=\"o\">,</span> <span class=\"n\">charmatrix</span><span class=\"o\">]</span>\n\n<span class=\"c1\">--  oops the exponents have the wrong sign!</span>\n<span class=\"kd\">example</span> <span class=\"o\">[</span><span class=\"n\">Nonempty</span> <span class=\"n\">n</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">trace</span> <span class=\"n\">M</span> <span class=\"bp\">=</span> <span class=\"bp\">-</span> <span class=\"o\">((</span><span class=\"n\">revcharpoly_apply</span> <span class=\"n\">M</span> <span class=\"o\">(</span><span class=\"n\">T</span> <span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">))</span> <span class=\"o\">:</span> <span class=\"n\">R</span><span class=\"o\">[</span><span class=\"n\">T</span><span class=\"bp\">;</span><span class=\"n\">T</span><span class=\"bp\">⁻¹</span><span class=\"o\">])</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span> <span class=\"bp\">→₀</span> <span class=\"n\">R</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"bp\">←</span> <span class=\"n\">mul_one</span> <span class=\"o\">(</span><span class=\"n\">revcharpoly_apply</span> <span class=\"n\">M</span> <span class=\"o\">(</span><span class=\"n\">T</span> <span class=\"o\">(</span><span class=\"n\">R</span> <span class=\"o\">:=</span> <span class=\"n\">R</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">))),</span> <span class=\"bp\">←</span> <span class=\"n\">T_zero</span><span class=\"o\">,</span>\n     <span class=\"bp\">←</span> <span class=\"n\">neg_add_self</span> <span class=\"o\">(</span><span class=\"n\">Fintype.card</span> <span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"n\">T_add</span><span class=\"o\">,</span> <span class=\"bp\">←</span> <span class=\"n\">mul_assoc</span><span class=\"o\">,</span> <span class=\"bp\">←</span> <span class=\"n\">T_mul</span><span class=\"o\">,</span> <span class=\"bp\">←</span> <span class=\"n\">mul_assoc</span><span class=\"o\">,</span>\n     <span class=\"n\">T_pow_mul_revcharpoly_T_neg_one_eq_charpoly</span><span class=\"o\">,</span> <span class=\"n\">T</span><span class=\"o\">]</span>\n  <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">AddMonoidAlgebra.mul_single_apply</span><span class=\"o\">,</span> <span class=\"n\">trace_eq_neg_charpoly_coeff</span><span class=\"o\">]</span>\n  <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">mul_one</span><span class=\"o\">,</span> <span class=\"n\">sub_eq_add_neg</span><span class=\"o\">,</span> <span class=\"n\">add_comm</span><span class=\"o\">,</span> <span class=\"n\">neg_neg</span><span class=\"o\">,</span> <span class=\"bp\">←</span> <span class=\"n\">sub_eq_add_neg</span><span class=\"o\">,</span> <span class=\"n\">neg_inj</span><span class=\"o\">]</span>\n  <span class=\"n\">convert</span> <span class=\"n\">toLaurent_apply_eq_coeff.symm</span>\n  <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"bp\">←</span> <span class=\"n\">Nat.succ_pred</span> <span class=\"o\">(</span><span class=\"n\">Fintype.card_ne_zero</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:=</span> <span class=\"n\">n</span><span class=\"o\">))]</span>\n  <span class=\"n\">simp</span>\n</code></pre></div>",
        "id": 382279368,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1691301913
    },
    {
        "content": "<p>I am probably not going to have time to finish this up.</p>\n<p>If anyone else wants to take over, feel free to do so!  In particular, the proofs are completely unoptimized and there are surely plenty of golfing opportunities, locally and globally!</p>",
        "id": 382279550,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1691302016
    },
    {
        "content": "<p>I opened PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/6450\">#6450</a> today which I claim contains all the results about nilpotency that are needed for Damiano's very nice argument. I intend to open a second PR which actually implements the argument tomorrow and proves:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">lemma</span> <span class=\"n\">Matrix.isNilpotent_charpoly_sub_pow_of_isNilpotent</span>\n    <span class=\"o\">{</span><span class=\"n\">R</span> <span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">_</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">DecidableEq</span> <span class=\"n\">n</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">Fintype</span> <span class=\"n\">n</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">M</span> <span class=\"o\">:</span> <span class=\"n\">Matrix</span> <span class=\"n\">n</span> <span class=\"n\">n</span> <span class=\"n\">R</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">CommRing</span> <span class=\"n\">R</span><span class=\"o\">]</span>\n    <span class=\"o\">(</span><span class=\"n\">hM</span> <span class=\"o\">:</span> <span class=\"n\">IsNilpotent</span> <span class=\"n\">M</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">IsNilpotent</span> <span class=\"o\">(</span><span class=\"n\">M.charpoly</span> <span class=\"bp\">-</span> <span class=\"n\">X</span><span class=\"bp\">^</span><span class=\"o\">(</span><span class=\"n\">Fintype.card</span> <span class=\"n\">n</span><span class=\"o\">))</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 383058140,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1691522639
    }
]