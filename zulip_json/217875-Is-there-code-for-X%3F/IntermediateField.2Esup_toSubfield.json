[
    {
        "content": "<p>We only have <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IntermediateField.inf_toSubfield#doc\">docs#IntermediateField.inf_toSubfield</a>. Is <code>IntermediateField.sup_toSubfield</code> correct? I tried and found that <code>rfl</code> can't prove it. Perhaps some arguments are needed.</p>",
        "id": 453515302,
        "sender_full_name": "Jz Pan",
        "timestamp": 1721766114
    },
    {
        "content": "<p>Does it follow from some combination of <code>le_antisymm</code> and <code>sup_le_iff</code>?</p>",
        "id": 453529077,
        "sender_full_name": "Thomas Browning",
        "timestamp": 1721769569
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"253861\">Thomas Browning</span> <a href=\"#narrow/stream/217875-Is-there-code-for-X.3F/topic/IntermediateField.2Esup_toSubfield/near/453529077\">said</a>:</p>\n<blockquote>\n<p>Does it follow from some combination of <code>le_antisymm</code> and <code>sup_le_iff</code>?</p>\n</blockquote>\n<p>I think this approach is a little bit complicated since it needs to use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Subfield.toIntermediateField#doc\">docs#Subfield.toIntermediateField</a> and some others...</p>",
        "id": 453537457,
        "sender_full_name": "Jz Pan",
        "timestamp": 1721771807
    },
    {
        "content": "<p>This works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib.FieldTheory.Adjoin</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">IntermediateField</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"n\">sup_toSubfield</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IntermediateField</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">⊔</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toSubfield</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">S.toSubfield</span><span class=\"w\"> </span><span class=\"bp\">⊔</span><span class=\"w\"> </span><span class=\"n\">T.toSubfield</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">S.toSubfield.closure_eq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">T.toSubfield.closure_eq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Subfield.closure_union</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">change</span><span class=\"w\"> </span><span class=\"n\">Subfield.closure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set.range</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">algebraMap</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">∪</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">∪</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Subfield.closure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">∪</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">congr</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Set.union_eq_right</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">rintro</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"o\">⟩</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Or.inl</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">algebraMap_mem</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 453538945,
        "sender_full_name": "Jz Pan",
        "timestamp": 1721772184
    },
    {
        "content": "<p>PR created as <a href=\"https://github.com/leanprover-community/mathlib4/pull/15088\">#15088</a>.</p>",
        "id": 453549922,
        "sender_full_name": "Jz Pan",
        "timestamp": 1721777556
    },
    {
        "content": "<p>Arguably we should redefine <code>sup</code> in the complete lattice instance above to make this true by definition</p>",
        "id": 453617885,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1721806524
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/217875-Is-there-code-for-X.3F/topic/IntermediateField.2Esup_toSubfield/near/453617885\">said</a>:</p>\n<blockquote>\n<p>Arguably we should redefine <code>sup</code> in the complete lattice instance above to make this true by definition</p>\n</blockquote>\n<p>I don't know how to do that. Besides, <code>IntermediateField.sSup_toSubfield</code> and <code>IntermediateField.iSup_toSubfield</code> requires that the set in question is not empty, otherwise they are not equal. So I'm afraid that the lattice structure is different.</p>",
        "id": 453635734,
        "sender_full_name": "Jz Pan",
        "timestamp": 1721811047
    },
    {
        "content": "<p>You can see how it's done for <code>bot</code> a few lines above. I suggest you only change <code>sup</code>, not <code>sSup</code>.</p>",
        "id": 453636483,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1721811204
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/217875-Is-there-code-for-X.3F/topic/IntermediateField.2Esup_toSubfield/near/453636483\">said</a>:</p>\n<blockquote>\n<p>You can see how it's done for <code>bot</code> a few lines above. I suggest you only change <code>sup</code>, not <code>sSup</code>.</p>\n</blockquote>\n<p>Do you mean this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CompleteLattice</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">IntermediateField</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">__</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">GaloisInsertion.liftCompleteLattice</span><span class=\"w\"> </span><span class=\"n\">IntermediateField.gi</span>\n<span class=\"w\">  </span><span class=\"n\">bot</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">toSubalgebra</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⊥</span>\n<span class=\"w\">      </span><span class=\"n\">inv_mem'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"n\">rintro</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">r</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"o\">⟩</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">r</span><span class=\"bp\">⁻¹</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">map_inv₀</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"o\">⟩</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"n\">bot_le</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">bot_le</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">⊥</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">x.toSubalgebra</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">sup</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S.toSubfield</span><span class=\"w\"> </span><span class=\"bp\">⊔</span><span class=\"w\"> </span><span class=\"n\">T.toSubfield</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toIntermediateField</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">S.toSubfield</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">S.toSubfield</span><span class=\"w\"> </span><span class=\"bp\">⊔</span><span class=\"w\"> </span><span class=\"n\">T.toSubfield</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">le_sup_left</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">algebraMap_mem</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">le_sup_left</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">le_sup_right</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">sup_le</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>Unfortunately, it breaks a lot of existing code relying on the old definition of <code>sup</code> :(</p>",
        "id": 453640357,
        "sender_full_name": "Jz Pan",
        "timestamp": 1721812282
    },
    {
        "content": "<p>Ah sorry, I got confused between <code>toSubfield</code> and <code>toSubalgebra</code>. Maybe my suggestion isn't worthwhile after all, and certainly your PR is an improvement over the status quo</p>",
        "id": 453646035,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1721813933
    },
    {
        "content": "<p>Probably <code>Subalgebra-&gt;Subring-&gt;Subsemiring</code> version should also be added...</p>",
        "id": 454601813,
        "sender_full_name": "Jz Pan",
        "timestamp": 1722165809
    },
    {
        "content": "<p><strong>ping</strong> What's the progress on reviewing <a href=\"https://github.com/leanprover-community/mathlib4/pull/15088\">#15088</a>?</p>",
        "id": 474865433,
        "sender_full_name": "Jz Pan",
        "timestamp": 1728060669
    },
    {
        "content": "<p><strong>ping</strong> I got some reviews last week, but there are 3 opening conversations I'm not intended to fix. Any other comments?</p>",
        "id": 477026073,
        "sender_full_name": "Jz Pan",
        "timestamp": 1729009261
    }
]