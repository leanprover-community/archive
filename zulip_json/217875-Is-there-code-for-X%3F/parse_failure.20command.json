[
    {
        "content": "<p>here is my command which run parser</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">infix</span><span class=\"o\">:</span><span class=\"mi\">60</span><span class=\"w\"> </span><span class=\"s2\">\" ⋄ \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">mul</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"k\">in</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">parse</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Name</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MetaM</span><span class=\"w\"> </span><span class=\"n\">Syntax</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">ofExcept</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">runParserCategory</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getEnv</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"n\">s</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">parse</span><span class=\"w\"> </span><span class=\"ss\">`term</span><span class=\"w\"> </span><span class=\"s2\">\"1 ⋄ 2 ⋄ 3\"</span>\n</code></pre></div>\n<p>but I want to create <code>#parse_failure</code> command which succeed only when parse fails.</p>",
        "id": 505260527,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1741817001
    },
    {
        "content": "<p>If you want this for testing, <code>#guard_msgs</code> might suffice:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">infix</span><span class=\"o\">:</span><span class=\"mi\">60</span><span class=\"w\"> </span><span class=\"s2\">\" ⋄ \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">mul</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"k\">in</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">parse</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Name</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MetaM</span><span class=\"w\"> </span><span class=\"n\">Syntax</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">ofExcept</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">runParserCategory</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getEnv</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"n\">s</span>\n\n<span class=\"sd\">/-- error: &lt;input&gt;:1:6: expected end of input -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">parse</span><span class=\"w\"> </span><span class=\"ss\">`term</span><span class=\"w\"> </span><span class=\"s2\">\"1 ⋄ 2 ⋄ 3\"</span>\n</code></pre></div>",
        "id": 505466931,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1741882617
    },
    {
        "content": "<p>I know guard_msgs</p>",
        "id": 505545242,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1741908647
    },
    {
        "content": "<p>I want to display my intension by command name, and to display in better form…</p>",
        "id": 505545371,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1741908720
    },
    {
        "content": "<p>Using <code>#guard_msgs</code> is usually preferable to commands like <code>#check_failure</code> because you can guard the error message too.</p>",
        "id": 505545441,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1741908744
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"626349\">Asei Inoue</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/parse_failure.20command/near/505545371\">said</a>:</p>\n<blockquote>\n<p>I want to display my intension by command name, and to display in better form…</p>\n</blockquote>\n<p>You can use a macro that expands into <code>#guard_msgs</code>.</p>",
        "id": 505545468,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1741908759
    },
    {
        "content": "<p>By the way, mathlib has a <code>#parse</code> command in <code>Mathlib.Util.ParseCommand</code> that seems quite similar to your <code>parse</code> function.</p>",
        "id": 505586785,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741929284
    }
]