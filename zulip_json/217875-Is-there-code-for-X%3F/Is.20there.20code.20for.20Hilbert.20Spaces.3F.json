[
    {
        "content": "<p>Is there code for Hilbert spaces? Hilbert spaces are Cauchy-complete inner product space.  </p>\n<p>I have just been doing this</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">tactic</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">RC</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">RCLike</span><span class=\"w\"> </span><span class=\"n\">RC</span><span class=\"o\">]</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CompleteSpace</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">InnerProductSpace</span><span class=\"w\"> </span><span class=\"n\">RC</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>Is this the correct way to declare that <code>E</code> is Hilbert space over the field <code>RC</code>?</p>",
        "id": 508357098,
        "sender_full_name": "Kent Van Vels",
        "timestamp": 1743015691
    },
    {
        "content": "<p>Yes, this is the correct way.</p>",
        "id": 508357986,
        "sender_full_name": "R√©my Degenne",
        "timestamp": 1743015992
    },
    {
        "content": "<p>Ok, thanks.  I feel better now.</p>",
        "id": 508358397,
        "sender_full_name": "Kent Van Vels",
        "timestamp": 1743016147
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"519925\">Kent Van Vels</span> has marked this topic as resolved.</p>",
        "id": 508358404,
        "sender_full_name": "Notification Bot",
        "timestamp": 1743016150
    },
    {
        "content": "<p>Hello, I wanted to ask, way are we using that for Hilbert spaces instead of having a proper definition?</p>",
        "id": 509864915,
        "sender_full_name": "Iv√°n Renison",
        "timestamp": 1743665900
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"646655\">Iv√°n Renison</span> has marked this topic as unresolved.</p>",
        "id": 509871894,
        "sender_full_name": "Notification Bot",
        "timestamp": 1743667940
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=NormedAddCommGroup#doc\">docs#NormedAddCommGroup</a> <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CompleteSpace#doc\">docs#CompleteSpace</a> <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=InnerProductSpace#doc\">docs#InnerProductSpace</a></p>",
        "id": 509879600,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1743670259
    },
    {
        "content": "<p>The first and last things are data, and the middle one is a Prop (and should be called <code>IsCompleteSpace</code> to reduce confusion IMO). Ivan it's not clear what you're proposing instead. Where do you want the data to go?</p>",
        "id": 509879869,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1743670327
    },
    {
        "content": "<p>Would <code>alias IsHilbertSpace := CompleteSpace</code> work for you?</p>",
        "id": 509880150,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1743670405
    },
    {
        "content": "<p>I was thinking more in something like an alias but including the tree, <code>NormedAddCommGroup</code>, <code>CompleteSpace</code> and <code>InnerProductSpace</code>, to be able to use <code>[IsHilbertSpace RC E</code> instead of <code>[NormedAddCommGroup E] [CompleteSpace E] [InnerProductSpace RC E]</code>.<br>\nI don't know, is something like that possible?</p>",
        "id": 509884457,
        "sender_full_name": "Iv√°n Renison",
        "timestamp": 1743671603
    },
    {
        "content": "<p>Yes, this is possible with <code>class abbrev</code> (search for that on Zulip)</p>",
        "id": 509885648,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1743671951
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=NumberField#doc\">docs#NumberField</a></p>",
        "id": 509886202,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1743672090
    },
    {
        "content": "<p>Number fields were an example where we could say \"let K be a number field\" by just throwing typeclass assumptions on K, and it seems that this was ultimately implemented by making a new Prop-valued class which just has fields equal to the old Prop-valued classes but extending the data-carrying classes</p>",
        "id": 509886429,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1743672159
    },
    {
        "content": "<p>(is it usual that we can't see which structures are classes in the docs or is this related to the current docs notation breakage?)</p>",
        "id": 509886739,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1743672262
    },
    {
        "content": "<p>I assume it is related, yes. cf <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/No.20notation.20in.20.23docs/with/509882147\">#mathlib4 &gt; No notation in #docs</a></p>",
        "id": 509887338,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1743672438
    },
    {
        "content": "<p>Great! This looks good:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">HilbertSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">RCLike</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SeminormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">normedAddCommGroup</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">innerProductSpace</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">InnerProductSpace</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">isCompleteSpace</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CompleteSpace</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 509887766,
        "sender_full_name": "Iv√°n Renison",
        "timestamp": 1743672552
    },
    {
        "content": "<p>Would this be a good addition to Mathlib?</p>",
        "id": 509887772,
        "sender_full_name": "Iv√°n Renison",
        "timestamp": 1743672553
    },
    {
        "content": "<p>Sure! Although we will want it to be a <code>class abbrev</code> (not sure what's up with <code>NumberField</code> either)</p>",
        "id": 509888295,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1743672699
    },
    {
        "content": "<p>You don't want to have both <code>SeminormedAddCommGroup E</code> and <code>NormedAddCommGroup E</code> though. That defines two unrelated norms on <code>E</code>.</p>",
        "id": 509888645,
        "sender_full_name": "R√©my Degenne",
        "timestamp": 1743672795
    },
    {
        "content": "<p>You are right R√©my, thanks</p>",
        "id": 509888904,
        "sender_full_name": "Iv√°n Renison",
        "timestamp": 1743672865
    },
    {
        "content": "<p>Okay, then I will work on adding this with a <code>class abbrev</code></p>",
        "id": 509888907,
        "sender_full_name": "Iv√°n Renison",
        "timestamp": 1743672866
    },
    {
        "content": "<p>Thank you</p>",
        "id": 509888917,
        "sender_full_name": "Iv√°n Renison",
        "timestamp": 1743672869
    },
    {
        "content": "<p>If you're going to add this definition, then you probably want to create a <code>[HilbertSpace k E] : NormedAddCommGroup E</code> instance. This instance will lead to a search for <code>HilbertSpace ?k E</code> with unknown <code>?k</code> every time Lean looks for <code>NormedAddCommGroup E</code>.</p>",
        "id": 509961263,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743691396
    },
    {
        "content": "<p>Should we use <code>variable_alias</code> and <code>variable?</code> for that instead?</p>",
        "id": 509961932,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743691564
    },
    {
        "content": "<p>Also, <code>[HilbertSpace Real E] [HilbertSpace Complex E]</code> leads to two potentially incompatible <code>[NormedAddCommGroup E]</code> structures.</p>",
        "id": 509963150,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743691911
    },
    {
        "content": "<p>I think sticking with </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CompleteSpace</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">InnerProductSpace</span><span class=\"w\"> </span><span class=\"n\">RC</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>is really better: it doesn't clutter typeclass search with additional classes which could impact performance, and as Yuri points out you don't want to have a class which extends <code>NormedAddCommGroup E</code> but with an additional field parameter <code>RC</code> that Lean couldn't guess.</p>",
        "id": 509963822,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1743692067
    },
    {
        "content": "<p>If I read the docs correctly, then <code>variable_alias</code> lets you write</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">HilbertSpace</span><span class=\"w\"> </span><span class=\"n\">RC</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>and get it unfolded to</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CompleteSpace</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">InnerProductSpace</span><span class=\"w\"> </span><span class=\"n\">RC</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>It also claims that it drops assumptions that can be deduced from the already available <code>variable</code>s, so</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">HilbertSpace</span><span class=\"w\"> </span><span class=\"n\">RC</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>should become</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CompleteSpace</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">InnerProductSpace</span><span class=\"w\"> </span><span class=\"n\">RC</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>too, without a duplicate <code>[NormedAddCommGroup E]</code> assumption.</p>",
        "id": 509966922,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743692842
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Is.20there.20code.20for.20Hilbert.20Spaces.3F/near/509961932\">said</a>:</p>\n<blockquote>\n<p>Should we use <code>variable_alias</code> and <code>variable?</code> for that instead?</p>\n</blockquote>\n<p>This is what I was suggesting with <code>class abbrev</code></p>",
        "id": 509969767,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1743693505
    },
    {
        "content": "<p>AFAICT, <code>class abbrev</code> is different from <code>variable_alias</code>.</p>",
        "id": 509977342,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743695276
    },
    {
        "content": "<p>Because it creates an actual typeclass that will show up in the assumptions.</p>",
        "id": 509977548,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743695326
    },
    {
        "content": "<p>Yeah, I think we've determined that Mathlib should never use <code>class abbrev</code>.</p>",
        "id": 509978979,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1743695693
    },
    {
        "content": "<p>That doesn't it can't <em>provide</em> some <code>class abbrev</code> for downstream use</p>",
        "id": 509979183,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1743695741
    },
    {
        "content": "<p>That most likely just leaves people rope to tangle themselves in. <code>variable_alias</code> for downstream use sounds more user-friendly</p>",
        "id": 509979629,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1743695860
    },
    {
        "content": "<p>Using <code>variable? [HilbertSpace ùïú F]</code> (with <code>variable_alias</code> in the definition) triggers a suggestion:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Try</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kn\">variable</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">HilbertSpace</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">InnerProductSpace</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CompleteSpace</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 510359888,
        "sender_full_name": "Iv√°n Renison",
        "timestamp": 1743850031
    },
    {
        "content": "<p>So I don't now if it is a good idea to use only <code>variable? [HilbertSpace ùïú F]</code> in Mathlib</p>",
        "id": 510359916,
        "sender_full_name": "Iv√°n Renison",
        "timestamp": 1743850064
    },
    {
        "content": "<p>Indeed mathlib should not use <code>variable?</code>, but it should provide tools so that users can use <code>variable?</code></p>",
        "id": 510364826,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1743853455
    }
]