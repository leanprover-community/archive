[
    {
        "content": "<p>(This is actually about VSC, no other editor or UI. Hope the channel is okay for that too <span aria-label=\"wink\" class=\"emoji emoji-1f609\" role=\"img\" title=\"wink\">:wink:</span>)</p>\n<p>After accepting a suggestion from <code>exact?</code> or <code>apply?</code> by clicking on it in the InfoView I often want to continute typing. But I then need to (move the mouse coursor and) make a second click into the editor. Is there a way to keep the typing focus in the editor, so that immediately after accepting something by clicking <code>[apply]</code> I can type? (Or is it supposed to happen and did I mess up local settings?)</p>\n<p>Somewhat related, as an alternative solution, I vaguely remember using a keyboard shortcut to accept a (the first) suggestion. What is it?</p>",
        "id": 571972666,
        "sender_full_name": "Malvin Gattinger",
        "timestamp": 1770226805
    },
    {
        "content": "<p>Ctrl+1 (or Cmd+1 on macOS) to focus back on the editor</p>",
        "id": 571982015,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1770229856
    },
    {
        "content": "<p>Ctrl+. (or Cmd+.) to accept the suggestion without the mouse</p>",
        "id": 571982163,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1770229901
    },
    {
        "content": "<p>Thanks, I think the emacs-like-keybinding extension I use messed up these standard shortcuts, will try to get them working again.</p>\n<p>And I am still curious if the focus-change-effect of clicking can be prevented.</p>",
        "id": 572011412,
        "sender_full_name": "Malvin Gattinger",
        "timestamp": 1770239923
    },
    {
        "content": "<blockquote>\n<p>And I am still curious if the focus-change-effect of clicking can be prevented.</p>\n</blockquote>\n<p>Not to my knowledge. Note that there are cases where you do want clicking to focus the InfoView - e.g. when using the built-in trace search or the webview search (Ctrl+F).</p>",
        "id": 572094137,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1770282647
    },
    {
        "content": "<p>The extension could just return focus to the editor upon any edit, I tried it here<br>\n<a href=\"https://github.com/leanprover/vscode-lean4/compare/master...mirefek:vscode-lean4:insert-focus\">https://github.com/leanprover/vscode-lean4/compare/master...mirefek:vscode-lean4:insert-focus</a><br>\nIt seems like at least for the case of text insertion, it was already an intention (maybe working, I haven't realized first that [apply] is an edit and not an insertion). What is an example infoview action to insert code to test this?</p>\n<p>(disclaimer: I am no expert in the VSCode extension code, just experimented with it a bit using AI tools)</p>",
        "id": 572191660,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1770307802
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"133339\">Mirek Olšák</span> <a href=\"#narrow/channel/561906-Editors-.26-UIs/topic/keep.20focus.20in.20editor.20after.20clicking.20.5Bapply.5D/near/572191660\">said</a>:</p>\n<blockquote>\n<p>What is an example infoview action to insert code to test this?</p>\n</blockquote>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp?</span>\n</code></pre></div>",
        "id": 572193801,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1770308307
    },
    {
        "content": "<p>I think this is also an edit rather than pure insertion -- it must delete the <code>?</code>. Perhaps I just don't understand what the <code>handleInsertText</code> is doing...</p>",
        "id": 572195681,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1770308724
    },
    {
        "content": "<p>Here's a quick implementation of Mirek's idea (refocusing the editor): <a href=\"https://github.com/leanprover-community/vscode-lean4/pull/702\">vscode-lean4#702</a></p>",
        "id": 572201303,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1770310061
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"133339\">Mirek Olšák</span> <a href=\"#narrow/channel/561906-Editors-.26-UIs/topic/keep.20focus.20in.20editor.20after.20clicking.20.5Bapply.5D/near/572195681\">said</a>:</p>\n<blockquote>\n<p>I think this is also an edit rather than pure insertion -- it must delete the <code>?</code>. Perhaps I just don't understand what the <code>handleInsertText</code> is doing...</p>\n</blockquote>\n<p>I wouldn't stare too closely at that file, it's one of the only remaining ones from the before times and a lot of it doesn't make much sense ... :-)</p>",
        "id": 572201471,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1770310103
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"221921\">Marc Huisinga</span> <a href=\"#narrow/channel/561906-Editors-.26-UIs/topic/keep.20focus.20in.20editor.20after.20clicking.20.5Bapply.5D/near/572201303\">said</a>:</p>\n<blockquote>\n<p>Here's a quick implementation of Mirek's idea (refocusing the editor): <a href=\"https://github.com/leanprover-community/vscode-lean4/pull/702\">vscode-lean4#702</a></p>\n</blockquote>\n<p>How does that code differ from</p>\n<div class=\"codehilite\" data-code-language=\"TypeScript\"><pre><span></span><code><span class=\"k\">await</span><span class=\"w\"> </span><span class=\"nx\">commands</span><span class=\"p\">.</span><span class=\"nx\">executeCommand</span><span class=\"p\">(</span><span class=\"s1\">'workbench.action.focusActiveEditorGroup'</span><span class=\"p\">)</span>\n</code></pre></div>\n<p>suggested by Claude? I suppose yours is more low-level?</p>",
        "id": 572213820,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1770313474
    },
    {
        "content": "<p>The difference is that it actually works, as opposed to that line suggested by Claude :-)</p>\n<p><code>workbench.action.focusActiveEditorGroup</code> focuses the currently active editor group (VS Code slang for \"group of tabs in one specific panel\"), e.g. when you focus something that isn't an editor, like a sidebar entry. When you focus the InfoView, that becomes the currently active editor group.</p>",
        "id": 572216996,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1770314542
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"133339\">Mirek Olšák</span> <a href=\"#narrow/channel/561906-Editors-.26-UIs/topic/keep.20focus.20in.20editor.20after.20clicking.20.5Bapply.5D/near/572213820\">said</a>:</p>\n<blockquote>\n<p><div class=\"codehilite\" data-code-language=\"TypeScript\"><pre><span></span><code><span class=\"k\">await</span><span class=\"w\"> </span><span class=\"nx\">commands</span><span class=\"p\">.</span><span class=\"nx\">executeCommand</span><span class=\"p\">(</span><span class=\"s1\">'workbench.action.focusActiveEditorGroup'</span><span class=\"p\">)</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>FWIW you could have tried it manually in VSCode by opening the command palette (Ctrl+Shift+P) and pasting the command ID <code>workbench.action.focusActiveEditorGroup</code> and selecting the first option</p>",
        "id": 572217414,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1770314660
    },
    {
        "content": "<p>I am a bit confused, are you suggesting it doesn't work at all? Of course I tried it before posting.</p>",
        "id": 572222087,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1770316187
    },
    {
        "content": "<p>I tried it and it does not work, as Marc mentioned</p>",
        "id": 572222355,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1770316272
    },
    {
        "content": "<p>(tried manually, not inside the extension)</p>",
        "id": 572222464,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1770316310
    },
    {
        "content": "<p>I used the extension debug -- Ctrl-F5 in the extension codebase.</p>",
        "id": 572222564,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1770316343
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"133339\">Mirek Olšák</span> <a href=\"#narrow/channel/561906-Editors-.26-UIs/topic/keep.20focus.20in.20editor.20after.20clicking.20.5Bapply.5D/near/572222087\">said</a>:</p>\n<blockquote>\n<p>I am a bit confused, are you suggesting it doesn't work at all? Of course I tried it before posting.</p>\n</blockquote>\n<p>That code has a race condition. It doesn't work at all if you first focus the InfoView and then click the button, and it often works (but sometimes doesn't work) if clicking the button is what focuses the InfoView. Probably has something to do with the point in time at which VS Code decides to actually focus the InfoView when you click the button - there are multiple concurrent and communicating VS Code processes involved here, after all.</p>\n<p>In general, I don't think that vibe-coding against the VS Code API is a good idea. There are lots of complicated subtleties that aren't documented anywhere.</p>",
        "id": 572225024,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1770317182
    },
    {
        "content": "<p>Thanks for the explanation. That makes sense, I tried only the direct click into infoview without focusing it before,<br>\nI am now experimenting with vibe coding a bit, especially on codebases I have no experience with. Sorry for annoying you with it.<br>\nOn the other hand, the difficulties for vibe coding sound like difficulties for any potential newcomer.</p>",
        "id": 572226093,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1770317556
    }
]