[
    {
        "content": "<p>Hi I have been using a fork of Lean4 repo with a built in Lean code formatter for a week. Seems to work relatively reliable. It uses the pretty term formatter of Lean for code and some simple conventions for top level items <a href=\"https://github.com/wvhulle/lean4\">https://github.com/wvhulle/lean4</a></p>",
        "id": 575604783,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1771954610
    },
    {
        "content": "<p>Let me know if anyone is interested in up streaming parts of  this. :)</p>",
        "id": 575605301,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1771954777
    },
    {
        "content": "<p>While it is not upstreamed, could it live in an external server plugin? This way, it could be run on top of normal lean versions. I wrote a small external LSP plugin once and it was reasonably simple (but I don't know about this case), it was possible to add additional LSP methods with <code>builtin_initalize</code> and <code>registerLspRequestHandler</code>.</p>",
        "id": 575853925,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1772047714
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"571941\">Lua Viana Reis</span> <a href=\"#narrow/channel/561906-Editors-.26-UIs/topic/Built-in.20Lean.20formatter/near/575853925\">said</a>:</p>\n<blockquote>\n<p>While it is not upstreamed, could it live in an external server plugin? This way, it could be run on top of normal lean versions. I wrote a small external LSP plugin once and it was reasonably simple (but I don't know about this case), it was possible to add additional LSP methods with <code>builtin_initalize</code> and <code>registerLspRequestHandler</code>.</p>\n</blockquote>\n<p>I don’t think formatting is possible in user space. The lean4 repo only exposes certain lsp capabilities</p>",
        "id": 575855963,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1772048428
    },
    {
        "content": "<p>It can give it another try to make a seperate extension but the lsp capabilities are kind of hard wired in the server module in lean4 repository</p>",
        "id": 575878185,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1772056373
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"928352\">Willem vanhulle</span> <a href=\"#narrow/channel/561906-Editors-.26-UIs/topic/Built-in.20Lean.20formatter/near/575604783\">said</a>:</p>\n<blockquote>\n<p>Hi I have been using a fork of Lean4 repo with a built in Lean code formatter for a week. Seems to work relatively reliable. It uses the pretty term formatter of Lean for code and some simple conventions for top level items <a href=\"https://github.com/wvhulle/lean4\">https://github.com/wvhulle/lean4</a></p>\n</blockquote>\n<p>Cool! I've been planning on writing a Lean formatter for a while, but looks like you beat me to it. <span aria-label=\"smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"smile\">:smile:</span></p>\n<p>I tried it out on some of my Lean files and it seems to work great. Also, is there some way to run the formatter as a command-line tool rather than using the \"Format Document\" option is VSCode?</p>",
        "id": 575920658,
        "sender_full_name": "Anthony Wang",
        "timestamp": 1772074866
    },
    {
        "content": "<p>Are you both aware that the Lean FRO is <em>very</em> actively working on writing a Lean code formatter?</p>",
        "id": 575986448,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1772101617
    },
    {
        "content": "<p>I have seen that message several times over the past years on the Lean FRO blog post and yearly goals, but have not been able to find it. Could I offer any help?</p>",
        "id": 575988368,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1772102141
    },
    {
        "content": "<p>Are you sure you’ve seen that? The roadmaps are all about stuff they would like to do, not about stuff they are very actively working on.</p>",
        "id": 576049756,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1772118835
    },
    {
        "content": "<p>Ah maybe it was on the roadmap that I saw it a while ago. Apologies. </p>\n<p>But it seems like everything is ready. The pretty formatter is there. Just need to add the capability to the lsp server and format the things not covered by the pretty formatted like comments. I’ve done that at my fork. </p>\n<p>Anything we can do to avoid double work? On which branch is the rest working?</p>",
        "id": 576054582,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1772120000
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"928352\">@Willem vanhulle</span> I think I found a bug in your formatter when formatting multiline strings, for instance:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"s2\">\"Hello</span>\n<span class=\"s2\">world\"</span>\n</code></pre></div>\n<p>gets formatted into </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">eval</span>\n<span class=\"w\">  </span><span class=\"s2\">\"Hello</span>\n<span class=\"s2\">    world\"</span>\n</code></pre></div>\n<p>which is already wrong, but if you keep formatting the file, it adds four more spaces each time before <code>world</code>.</p>",
        "id": 576054884,
        "sender_full_name": "Anthony Wang",
        "timestamp": 1772120067
    },
    {
        "content": "<p>Also, is it intentional that the formatter adds an extra newline after comments?</p>",
        "id": 576055972,
        "sender_full_name": "Anthony Wang",
        "timestamp": 1772120326
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"910779\">Anthony Wang</span> <a href=\"#narrow/channel/561906-Editors-.26-UIs/topic/Built-in.20Lean.20formatter/near/576054884\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"928352\">Willem vanhulle</span> I think I found a bug in your formatter when formatting multiline strings, for instance:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"s2\">\"Hello</span>\n<span class=\"s2\">world\"</span>\n</code></pre></div>\n<p>gets formatted into </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">eval</span>\n<span class=\"w\">  </span><span class=\"s2\">\"Hello</span>\n<span class=\"s2\">    world\"</span>\n</code></pre></div>\n<p>which is already wrong, but if you keep formatting the file, it adds four more spaces each time before <code>world</code>.</p>\n</blockquote>\n<p>Will fix that</p>",
        "id": 576056355,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1772120415
    },
    {
        "content": "<p>It is a problem with the exiting formatter of strings in main (outside of the code i added).</p>",
        "id": 576065625,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1772122533
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"910779\">@Anthony Wang</span>  Fixed it by removing the problematic behaviour where Lean formatter would add an indent tab to multiline strings</p>",
        "id": 576094122,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1772130196
    }
]