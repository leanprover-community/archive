[
    {
        "content": "<p>Took me awhile to grok the issue, but I have the following proof:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">object_of</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">object_of</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i_1</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">⟨↑</span><span class=\"o\">(</span><span class=\"n\">Classical</span><span class=\"bp\">.</span><span class=\"n\">choose</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">i_1</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"bp\">⋯⟩</span>\n</code></pre></div>\n<p>and a theorem that <code>object_of</code> is injective. However, rw with the injective theorem fails. The issue is that the implicitly inferred types slightly differ on both sides:</p>\n<p>on one side it is</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">@</span><span class=\"n\">object_of</span><span class=\"w\"> </span><span class=\"n\">inst</span><span class=\"bp\">✝</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">i</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Object</span>\n</code></pre></div>\n<p>while on the other</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">@</span><span class=\"n\">object_of</span><span class=\"w\"> </span><span class=\"n\">inst</span><span class=\"bp\">✝</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">i</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">({</span><span class=\"n\">i</span><span class=\"o\">}</span><span class=\"bp\">.</span><span class=\"n\">iUnion</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i_1</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">⟨↑</span><span class=\"o\">(</span><span class=\"n\">Classical</span><span class=\"bp\">.</span><span class=\"n\">choose</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">i_1</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"bp\">⋯⟩</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Object</span>\n</code></pre></div>\n<p>I can generate a proof that <code>hi : ({i}.iUnion fun x ↦ X) = X</code> but how do I use that to change the Prop (simply doing <code>rw [hi] at this</code> doesn't work).</p>",
        "id": 528507739,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1752387660
    },
    {
        "content": "<p>I guess types have their own definitional and propositional equalities. I need something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">    </span><span class=\"n\">change</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">object_of</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">({</span><span class=\"n\">i</span><span class=\"o\">}:</span><span class=\"n\">Set</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">object_of</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">({</span><span class=\"n\">i</span><span class=\"o\">}:</span><span class=\"n\">Set</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">this</span>\n</code></pre></div>\n<p>but that would let me prove the different terms using <code>hi</code> not just accept defeq.</p>",
        "id": 528508363,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1752388398
    },
    {
        "content": "<p>For the record, I figured out the issue here, and it had to do with an earlier <code>toFun</code> definition (this is in the left_inv proof) that was either wrong or too hard to work with. Using <code>tuple</code> instead of <code>object_of</code> directly does the right rewriting so by the time we are in this proof we have the right arguments.</p>\n<p><a href=\"https://github.com/rkirov/analysis/blob/main/analysis/Analysis/Section_3_5.lean#L431-L435\">https://github.com/rkirov/analysis/blob/main/analysis/Analysis/Section_3_5.lean#L431-L435</a></p>",
        "id": 528972736,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1752635437
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"488971\">Rado Kirov</span> has marked this topic as resolved.</p>",
        "id": 528972741,
        "sender_full_name": "Notification Bot",
        "timestamp": 1752635439
    }
]