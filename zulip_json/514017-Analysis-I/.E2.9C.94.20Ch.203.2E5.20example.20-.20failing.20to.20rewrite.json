[
    {
        "content": "<p>I have what seems to be equivalent terms <code>↑x</code> in the equivalence proof <code>this</code> and in the goal (see screenshot). However, <code>rw</code> fails to replace it, for an unknown to me reason - not sure what <code>_a</code> and the <code>motive</code> are in the error message.</p>\n<p>I went as far as turning on <code>pp.all</code> and checking that that <code>↑x</code> are the same after a full expansion.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Chapter3</span><span class=\"bp\">.</span><span class=\"n\">SetTheory</span><span class=\"bp\">.</span><span class=\"n\">Object</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">122352</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">122351</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">inst</span><span class=\"bp\">✝</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">122351</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Chapter3</span><span class=\"bp\">.</span><span class=\"n\">SetTheory</span><span class=\"bp\">.</span><span class=\"n\">Object</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">122352</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">122351</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">inst</span><span class=\"bp\">✝</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">Chapter3</span><span class=\"bp\">.</span><span class=\"n\">SetTheory</span><span class=\"bp\">.</span><span class=\"n\">Object</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">122352</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">122351</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">inst</span><span class=\"bp\">✝</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↦</span>\n<span class=\"w\">        </span><span class=\"bp\">@</span><span class=\"n\">Membership</span><span class=\"bp\">.</span><span class=\"n\">mem</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">122351</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">122352</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Chapter3</span><span class=\"bp\">.</span><span class=\"n\">SetTheory</span><span class=\"bp\">.</span><span class=\"n\">Object</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">122352</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">122351</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">inst</span><span class=\"bp\">✝</span><span class=\"o\">)</span>\n<span class=\"w\">          </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Chapter3</span><span class=\"bp\">.</span><span class=\"n\">SetTheory</span><span class=\"bp\">.</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">122352</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">122351</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">inst</span><span class=\"bp\">✝</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Chapter3</span><span class=\"bp\">.</span><span class=\"n\">objects_mem_sets</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">122352</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">122351</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">inst</span><span class=\"bp\">✝</span><span class=\"o\">)</span>\n<span class=\"w\">          </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Chapter3</span><span class=\"bp\">.</span><span class=\"n\">SetTheory</span><span class=\"bp\">.</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">iProd</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">122352</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">122351</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">inst</span><span class=\"bp\">✝</span>\n<span class=\"w\">            </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Chapter3</span><span class=\"bp\">.</span><span class=\"n\">SetTheory</span><span class=\"bp\">.</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">122352</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">122351</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">inst</span><span class=\"bp\">✝</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span>\n<span class=\"w\">          </span><span class=\"n\">x</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"n\">x</span><span class=\"o\">)</span>\n</code></pre></div>\n<p><a href=\"/user_uploads/3121/xomMuQXhpkF0YD2_N2dtPOvl/Screenshot-2025-07-15-at-8.12.46PM.png\">Screenshot 2025-07-15 at 8.12.46 PM.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/xomMuQXhpkF0YD2_N2dtPOvl/Screenshot-2025-07-15-at-8.12.46PM.png\" title=\"Screenshot 2025-07-15 at 8.12.46 PM.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"2186x506\" src=\"/user_uploads/thumbnail/3121/xomMuQXhpkF0YD2_N2dtPOvl/Screenshot-2025-07-15-at-8.12.46PM.png/840x560.webp\"></a></div>",
        "id": 528973087,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1752635849
    },
    {
        "content": "<p>Did you read the explanation?</p>",
        "id": 529046922,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752668568
    },
    {
        "content": "<p>not very carefully, didn't realize it was specific to this error. Upon more careful read, it seems:</p>\n<blockquote>\n<p>However, if 'e' depends on specific properties of 'a', then the motive 'm' might not typecheck.</p>\n</blockquote>\n<p>is the important part, but I am not quite sure what does \"specific property\" means here. The term <code>↑x</code> is not repeated anywhere else in my <code>e</code>. Do you have a minimal example where this error is triggered (and how to resolve), so I can study it to see how it applies to my case?</p>",
        "id": 529086442,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1752679779
    },
    {
        "content": "<p>But the suggestion of using <code>simp only [this]</code> does seem to work. I was avoiding <code>simp</code> because of the unexpected deep expansion, but I think I fixed that by changing <code>abbrev</code> with <code>def</code> (see other thread)</p>",
        "id": 529087027,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1752679976
    },
    {
        "content": "<p>In this case, the specific property you are relying on is that <code>a</code> has type <code>∃ x_1, ↑x = tuple x_1</code>, so you see <code>↑x</code> on the lhs of that, but when you rewrite it it needs to have type <code>∃ x_1, _a = tuple x_1</code> (this was also in the error message)</p>",
        "id": 529087489,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752680109
    },
    {
        "content": "<p>aah, I see, foiled by dependent types again, I was looking for <code>x</code> in the terms of <code>e</code>, but it was used in the types!</p>",
        "id": 529087745,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1752680191
    },
    {
        "content": "<p>In this case it looks like you only want to rewrite the right hand side, so <code>conv_rhs =&gt; rw [this]</code> should work, and also <code>rw [← this]</code> should also probably work.</p>",
        "id": 529087767,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752680200
    },
    {
        "content": "<p>That is correct I found out by trail and error that <code>rw [← this]</code> works, which was also suprising to me, as the terms don't look syntactically equal, but turns out they are definitionally equal (I think)</p>",
        "id": 529087987,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1752680263
    },
    {
        "content": "<p>yes, they are equal because of eta reduction</p>",
        "id": 529088065,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752680285
    },
    {
        "content": "<p>is there <code>rw [eta_reduction]</code> I can use? Or folks mostly do <code>simp only</code> for such rewrites.</p>",
        "id": 529088389,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1752680377
    },
    {
        "content": "<p>I found two tactics <code>eta_struct</code> and <code>eta_reduce</code></p>",
        "id": 529088711,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752680482
    },
    {
        "content": "<p><code>simp only</code> should also work</p>",
        "id": 529088795,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752680504
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"488971\">Rado Kirov</span> has marked this topic as resolved.</p>",
        "id": 529187876,
        "sender_full_name": "Notification Bot",
        "timestamp": 1752714839
    }
]