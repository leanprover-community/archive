[
    {
        "content": "<p>I spend almost a whole day trying to work through ch3.3 exercises, and sadly had a lot less fun with those than ones from the previous chapters. The custom definition of <code>Function</code>(using a Property on x and y, that for a given x is only true for a single y) expands into a unreadable mess with <code>simp</code>, so I resorted to the following tactics:</p>\n<ul>\n<li>applying rewrites without being able to make sense of the intermediate state, hoping for a pass from the checker. Forced me to get a better mental model of how the core really works( also got some great insights from a chat <span class=\"user-mention\" data-user-id=\"228466\">@Chris Bailey</span>  at the Berkeley Lean camp)</li>\n<li>for some exercises just mapped in bulk to Mathlib's notion of functions using <code>mk_fn</code> and <code>to_fn</code> and proved it there (without using the built in theorems)</li>\n<li>in some places I tried to undo the automatic expansion, like <code>ext; rw [\\&lt;- eval]</code> so I can work with manageable goals</li>\n</ul>\n<p>If anyone else is working on those or has solutions handy, would love to chat more - I have two unsolved problems left and probably a lot of clean up on the existing solutions <a href=\"https://github.com/rkirov/analysis/blob/main/analysis/Analysis/Section_3_3.lean\">github link</a>. </p>\n<p>I made a small repro for one for the more frustrating problems, I don't know how to prove <code>0 \\in Nat</code> or how to show <code>0 \\neq 1</code> (where Nat is custom addition to the custom SetAxioms, but it has OfNat coersions).</p>\n<p><a href=\"https://live.lean-lang.org/#codez=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\">lean4 web repro link</a></p>",
        "id": 527259031,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1751697743
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">SetTheory</span><span class=\"bp\">.</span><span class=\"n\">nat_equiv</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">2</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">SetTheory</span><span class=\"bp\">.</span><span class=\"n\">nat_equiv</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">2</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">SetTheory</span><span class=\"bp\">.</span><span class=\"n\">nat_equiv</span><span class=\"bp\">.</span><span class=\"n\">injective</span><span class=\"bp\">.</span><span class=\"n\">ne</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n</code></pre></div>",
        "id": 527271032,
        "sender_full_name": "Vlad",
        "timestamp": 1751712224
    },
    {
        "content": "<p>Thanks! That got me through some <a href=\"https://github.com/rkirov/analysis/blob/main/analysis/Analysis/Section_3_3.lean#L742-L759\">counter-examples</a>. </p>\n<p>The next exercise I am stuck on has to with inclusion functions. Again the content of the functions is trivial but I am struggling with aligning the subsets/subtypes proofs. The definition of Function doesn't make things easy to see.</p>\n<p>I extracted it to the <a href=\"https://live.lean-lang.org/#codez=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\">lean4 web playground</a></p>",
        "id": 527286175,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1751726829
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">inclusion_comp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">:</span><span class=\"n\">Set</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hXY</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">⊆</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hYZ</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"bp\">⊆</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">inclusion</span><span class=\"w\"> </span><span class=\"n\">hYZ</span><span class=\"w\"> </span><span class=\"bp\">○</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">inclusion</span><span class=\"w\"> </span><span class=\"n\">hXY</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">    </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">inclusion</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">SetTheory</span><span class=\"bp\">.</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">subset_trans</span><span class=\"w\"> </span><span class=\"n\">hXY</span><span class=\"w\"> </span><span class=\"n\">hYZ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"n\">eval</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">inclusion_eval</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">comp_eval</span><span class=\"o\">]</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">congr!</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"n\">generalize_proofs</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">h₁</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">h₂</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[(</span><span class=\"n\">Classical</span><span class=\"bp\">.</span><span class=\"n\">choose_spec</span><span class=\"w\"> </span><span class=\"n\">h₂</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Classical</span><span class=\"bp\">.</span><span class=\"n\">choose_spec</span><span class=\"w\"> </span><span class=\"n\">h₁</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">generalize_proofs</span><span class=\"w\"> </span><span class=\"n\">h₁</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[(</span><span class=\"n\">Classical</span><span class=\"bp\">.</span><span class=\"n\">choose_spec</span><span class=\"w\"> </span><span class=\"n\">h₁</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 527287380,
        "sender_full_name": "Vlad",
        "timestamp": 1751728257
    },
    {
        "content": "<p>Brilliant, some new tricks for me to learn, thanks!</p>",
        "id": 527287669,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1751728577
    },
    {
        "content": "<p>This is useful feedback.  I am certainly aware that my textbook definition of a function is significantly more inconvenient to use in Lean than the idiomatic Mathlib functions, and starting from Sec 3.4 onwards I switch solely to the Mathlib functions, but I wanted to demonstrate that the textbook definition was actually  implementable in Lean in a way that broadly captures the intended spirit of the book.  The API to convert back and forth between the Section 3.3 functions and the Mathlib functions was certainly intended to assist with some of the more challenging proofs, and also to help prepare the reader for the imminent transition to Mathlib functions.</p>\n<p>If you have suggestions for hints for some of the problems that can be inserted as comments to the Lean file, to allow other students of the text to focus on the mathematical content of the exercises in the spirit of the original text and not be unduly helpd up by purely technical Lean issues, I'd be happy to accept some PRs in this regard.</p>",
        "id": 527294862,
        "sender_full_name": "Terence Tao",
        "timestamp": 1751737275
    },
    {
        "content": "<p>Will definitely try to contribute where I can. I can add some comment hints that would have helped me based on what I knew before starting the exercise and based on the solution I ended up with, but I don't know enough of Lean to know how idiomatic any of this is, so there is a danger to overfitting to my specific solutions. Will keep my eyes open on other new user threads here, and see if multiple journeys through the exercises could have been similarly helped, will contribute more.</p>\n<p>Also, while not the goal of the book as you say, actually struggling through the casts, nat literals (as in the other thread by <span class=\"user-mention\" data-user-id=\"418569\">@Dan Abramov</span> ) etc, is probably quite educational for me when I further work with Lean and Mathlib, so trying to fully hide everything Lean technicality from sight won't be right either.</p>\n<p>The trouble is that for the Lean specific content unlike the math content, there is no helpful text to go with, no worked out exercises (though I appreciate that some of the math examples do come with proofs, that I can read and to emulated) and no slowly increasing difficulty gradient (admittedly hard to do that concurrently with the mathematical content).</p>\n<p>I hope I don't come off as too negative, because I really like the approach of </p>\n<blockquote>\n<p>I wanted to demonstrate that the textbook definition was actually implementable in Lean in a way that broadly captures the intended spirit of the book.</p>\n</blockquote>\n<p>and exactly what I was looking for. The Lean companion has a \"you could have invented/formalized Math\" feel (like popular posts/articles <a href=\"https://www.ams.org/notices/200601/fea-chow.pdf\">[1]</a> <a href=\"http://blog.sigfpe.com/2006/08/you-could-have-invented-monads-and.html\">[2]</a>, etc). Of course, just like a lot these posts, there is a bit of sleight-of-hand, by not adding \"but it probably won't be as ergonomic as the original\" :)</p>",
        "id": 527316353,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1751767943
    },
    {
        "content": "<p>I haven’t gotten to 3.3 myself yet so I haven’t looked at this discussion but wanted to respond to this:</p>\n<blockquote>\n<p>The trouble is that for the Lean specific content unlike the math content, there is no helpful text to go with, no worked out exercises (though I appreciate that some of the math examples do come with proofs, that I can read and to emulated) and no slowly increasing difficulty gradient (admittedly hard to do that concurrently with the mathematical content).</p>\n</blockquote>\n<p>I don’t think it would be appropriate for this book to spend a ton of space in comments explaining what’s going on, but IMO, there’s an opportunity to build up intuition about these things slightly more gradually. For example, after a block with lemmas for casting, it would help to have an <code>example</code> showing “this lets us do this and that”. So that you can see what these lemmas and casts and simps enable without <em>also</em> trying to solve some other problem later. It also gives a reference for something to “come back to” whenever you’re stuck because it would be a one-liner per pattern you use later.</p>",
        "id": 527316866,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1751768883
    },
    {
        "content": "<p>With all the help here, I got finally to the last exercise in Ch3.3. I think it is the first time I am defining a function with if-else, and really struggling to expand it properly. The code looks something like this </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">some_theorem</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">:</span><span class=\"n\">Set</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hXY</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">∩</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">∅</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">∪</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">mk_fn</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">↦</span>\n<span class=\"w\">      </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">z</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">z</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">⟩</span>\n<span class=\"w\">      </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">z</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"bp\">.</span><span class=\"n\">property</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SetTheory</span><span class=\"bp\">.</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">mem_union</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"bp\">;</span>\n<span class=\"w\">        </span><span class=\"n\">tauto</span>\n<span class=\"w\">      </span><span class=\"o\">)</span><span class=\"bp\">⟩</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">hF</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hsub</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">SetTheory</span><span class=\"bp\">.</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">subset_union_left</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">F_at_x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hsub</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">property</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hF</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"c1\">-- how to expand here?</span>\n\n<span class=\"w\">  </span><span class=\"c1\">-- do same for Y and g</span>\n<span class=\"w\">  </span><span class=\"c1\">-- rest of the proof</span>\n<span class=\"w\">  </span><span class=\"n\">tauto</span>\n</code></pre></div>\n<p>The surrounding proof is just True, I need to learn how to expand <code>F</code> and I think I have hope for the rest of the exercise. Actually, very curious how would the disjoint condition come into play.</p>\n<p><a href=\"https://live.lean-lang.org/#codez=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\">playground link</a></p>",
        "id": 527328147,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1751785013
    },
    {
        "content": "<p>You can do <code>simp only [F]</code> or <code>dsimp [F]</code> or <code>unfold F</code></p>",
        "id": 527350201,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751811887
    },
    {
        "content": "<p>none of those seem to work</p>",
        "id": 527352663,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1751814479
    },
    {
        "content": "<p>maybe I forgot how <code>set</code> works</p>",
        "id": 527352813,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751814628
    },
    {
        "content": "<p>At some point there was an <code>unfold_let</code> that was later replaced by <code>unfold</code>.  I don't remember if that worked with <code>set</code> as well.</p>",
        "id": 527352952,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1751814760
    },
    {
        "content": "<p>You want to use <code>Function.eval_of</code></p>",
        "id": 527353015,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751814818
    },
    {
        "content": "<p>both <code>dsimp</code> and <code>unfold</code> work as far as the definition is expanded, but the goal is not completed.</p>",
        "id": 527353054,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1751814849
    },
    {
        "content": "<p>use <code>Function.eval_of</code>, it's stated in a weird way so it won't work with <code>simp</code></p>",
        "id": 527353069,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751814873
    },
    {
        "content": "<p>adding <code>simp [eval, eval_of]</code> makes some changes after also doesn't complete</p>",
        "id": 527353109,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1751814908
    },
    {
        "content": "<p>Do</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hF</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">eval_of</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">dif_pos</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">property</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 527353144,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751814952
    },
    {
        "content": "<p>sadly no. It does work for a more trivial function like <code>mk_fn fun x =&gt; f x</code>, so I wonder if I need to something special for the <code>if ... then ... else ...</code>?</p>",
        "id": 527353525,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1751815352
    },
    {
        "content": "<p>oh, didn't know about <code>dif_pos</code></p>",
        "id": 527353545,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1751815374
    },
    {
        "content": "<p>That did it, thanks!</p>",
        "id": 527353714,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1751815560
    },
    {
        "content": "<p>Hopefully, that will help me complete the glue exercise 3.3.8 e), though still not sure where and how will I use the <code>Disjoint X Y</code> hypothesis.</p>\n<p>One quick quesion what is the difference between the four ways here to expand the definition of F <code>simp only [{F or hF}]</code>, <code>rw [hF]</code> or <code>unfold F</code>?</p>",
        "id": 527353976,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1751815828
    },
    {
        "content": "<p><code>simp only</code> will also do some beta and iota and all the other kinds of reduction</p>",
        "id": 527354015,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751815868
    },
    {
        "content": "<p><code>rw [F]</code> does not work</p>",
        "id": 527354023,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751815874
    },
    {
        "content": "<p><code>rw [hF]</code> will only work if the definition of <code>F</code> is irrelevant for type correctness of the expression being rewritten</p>",
        "id": 527354073,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751815952
    },
    {
        "content": "<p><code>unfold F</code> will just unfold the definition of <code>F</code></p>",
        "id": 527354105,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751815984
    },
    {
        "content": "<blockquote>\n<p>Hopefully, that will help me complete the glue exercise 3.3.8 e), though still not sure where and how will I use the <code>Disjoint X Y</code> hypothesis.</p>\n</blockquote>\n<p>Ok, I answered my question and finally <a href=\"https://github.com/rkirov/analysis/blob/4fa73cc78556b6fa14c08bc2e6c8f429ff5d1d6c/analysis/Analysis/Section_3_3.lean#L917-L984\">finished 3.3.8 e)</a> Won't get style points and lot of things to go back to and clean up, but I know the pieces at play.</p>\n<p>To answer my own question the disjoint hypothesis is used to prove <code>x \\nin X</code> which is needed by <code>dif_neg</code>. It's like I need to drive a little programming language interpreter single evaluation step at time, and at each point I might need to pass some extra proofs to proceed.</p>\n<p>One final observation, there is a missing <code>include_eval</code> theorem which is hard to state because it needs to generalize over subset membership information. I tried to add <a href=\"https://github.com/rkirov/analysis/blob/4fa73cc78556b6fa14c08bc2e6c8f429ff5d1d6c/analysis/Analysis/Section_3_3.lean#L867\">my own</a>, but it is not useful as it  only shows .val equality. So I started just extracting subhypothesis of <code>include</code> applications with have to proceed the evaluation without using <code>eval</code> which explodes the goal.</p>\n<p>Thanks for all the help here! I plan to keep posting my questions here (or a new sub channel) as I continue working through the chapters.</p>",
        "id": 527357472,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1751819398
    },
    {
        "content": "<p>I'll accept a PR with this eval lemma as a helper lemma. (I didn't work too hard on providing an extensive API here since the Section 3.3 function machinery is to be deprecated by the next section, but it still makes sense to make a small illustration of what a reasonable API is supposed to look like.)</p>",
        "id": 527375314,
        "sender_full_name": "Terence Tao",
        "timestamp": 1751838524
    },
    {
        "content": "<p>Sounds good, I will go back and clean up the solutions to attempt only use rw with *_eval theorems. I think I have a clearer picture now that it is best practice to have definitions that are only used by a key API theorems and exercises should only use APIs and seldomly expand underlying definitions.</p>",
        "id": 527377374,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1751841071
    },
    {
        "content": "<p>This topic was moved here from <a class=\"stream-topic\" data-stream-id=\"113489\" href=\"/#narrow/channel/113489-new-members/topic/Tao.27s.20Analysis.20Ch3.2E3\">#new members &gt; Tao's Analysis Ch3.3</a> by <span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span>.</p>",
        "id": 527390452,
        "sender_full_name": "Notification Bot",
        "timestamp": 1751855692
    },
    {
        "content": "<p>Not sure if this is a related problem or not, but I find that whenever I have <code>Classical.choose ...</code> appearing in my InfoView, I have no idea what's going on and lose track of things.</p>\n<p><a href=\"/user_uploads/3121/7q3r-tpouNQZggRu7v50hmA8/Screenshot-2025-07-13-at-00.54.28.png\">Screenshot 2025-07-13 at 00.54.28.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/7q3r-tpouNQZggRu7v50hmA8/Screenshot-2025-07-13-at-00.54.28.png\" title=\"Screenshot 2025-07-13 at 00.54.28.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"2868x872\" src=\"/user_uploads/thumbnail/3121/7q3r-tpouNQZggRu7v50hmA8/Screenshot-2025-07-13-at-00.54.28.png/840x560.webp\"></a></div><p>Maybe this is a sign of the proof itself going in the wrong direction, but the way InfoView chooses to fold things (which I'm guessing is another consequence of the chosen formalism) feels very confusing. Would be nice if there was some way to make these printed in some other way.</p>",
        "id": 528491015,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1752364601
    },
    {
        "content": "<p>I learned that <code>set_option pp.proofs true</code> will configure the pretty-printer to not hide those with ellipsis, but indeed often what you find behind can be quite messy and could be a sign that one should use some theorems instead. Also, I found that sometimes the right helpful theorems (like _eval mentioned there) are missing when writing those you have to work with choose, and choose_spec.</p>",
        "id": 528491335,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1752365018
    },
    {
        "content": "<p>Hmm ok yeah I shouldn't have waited so long to try that <code>pp</code> option, it does help</p>",
        "id": 528491367,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1752365070
    },
    {
        "content": "<p>My tactics so far to deal with <code>choose</code>:<br>\n1) run some evals backwards to hide it again if possible. Sometimes <code>simp</code> will go too far.<br>\n2) create a local  proof with <code>have := choose_spec &lt;expr&gt;</code> that will give you some statement about <code>choose &lt;expr&gt; </code> and you can work with that first instead of <code>choose</code> directly.</p>",
        "id": 528492052,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1752366160
    },
    {
        "content": "<p>I havent used it myself but the choose tactic may be friendlier for beginners here.</p>",
        "id": 528496435,
        "sender_full_name": "Terence Tao",
        "timestamp": 1752372647
    },
    {
        "content": "<p>the <code>choose</code> tactic works great for me</p>",
        "id": 528496537,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752372803
    },
    {
        "content": "<p>but if you want to construct an expression using <code>Classical.choose</code> and then you go to prove stuff about it then I wouldn't recommend it</p>",
        "id": 528496564,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752372846
    },
    {
        "content": "<p>I only recommend it if the choice is confined to a proof</p>",
        "id": 528496578,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752372867
    },
    {
        "content": "<p>not if you want to write a definition using choice</p>",
        "id": 528496584,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752372879
    },
    {
        "content": "<p>With Claude's help I got this but I don't really understand why it works or how to arrive at it yet</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- Compatibility with Mathlib's notion of inverse -/</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">inverse_eq</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">bijective</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">inverse</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">to_fn</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">invFun</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">to_fn</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">y</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">eq_iff</span><span class=\"bp\">.</span><span class=\"n\">mp</span>\n<span class=\"w\">  </span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">x_via_ml</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">invFun</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">to_fn</span><span class=\"w\"> </span><span class=\"n\">y</span>\n<span class=\"w\">  </span><span class=\"n\">symm</span>\n<span class=\"w\">  </span><span class=\"n\">dsimp</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">inverse</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">unique</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Classical</span><span class=\"bp\">.</span><span class=\"n\">choose_spec</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">2</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">x_via_ml</span>\n<span class=\"w\">  </span><span class=\"n\">change</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">to_fn</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">invFun</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">to_fn</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">y</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">invFun_eq</span>\n<span class=\"w\">  </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"n\">y</span>\n<span class=\"w\">  </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div>\n<p>Would the <code>choice</code> tactic help here? I've never used it yet</p>",
        "id": 528496671,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1752372998
    },
    {
        "content": "<p>Ah I think I see why I was getting lost. Taken from <span class=\"user-mention\" data-user-id=\"488971\">@Rado Kirov</span>'s solution:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">inverse_eq'</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">bijective</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">inverse</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">to_fn</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">invFun</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">to_fn</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">y</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">eq_iff</span><span class=\"bp\">.</span><span class=\"n\">mp</span>\n<span class=\"w\">  </span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">invFun</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">to_fn</span><span class=\"w\"> </span><span class=\"n\">y</span>\n<span class=\"w\">  </span><span class=\"n\">symm</span>\n<span class=\"w\">  </span><span class=\"c1\">-- ⊢ x = (f.inverse h).to_fn y</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">inverse_eval</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"c1\">-- ⊢ (fun x ↦ Classical.choose (f.unique x)) x = y</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">to_fn_eval</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"c1\">-- ⊢ f.to_fn x = y</span>\n</code></pre></div>\n<p>As you can see, the first <code>rw [Function.inverse_eval]</code> actually \"expands too much\" so we have to <code>rw [← to_fn_eval]</code> right after. Otherwise, we lose information about this \"just\" being an <code>f x</code> call, and thus can't easily apply inverse transformations that operate on <code>f</code> and <code>infFun f</code>.</p>\n<p>This was super non-obvious to me and I assumed I have to be dealing with <code>Classical.choose</code> myself.</p>",
        "id": 528497148,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1752373779
    },
    {
        "content": "<p><code>fun x ↦ Classical.choose (f.unique x)</code> should be its own definition, and this definition should be listed as <code>CoeFun</code> instead of what we have now which is the <code>CoeFun</code> instance being something complicated</p>",
        "id": 528497422,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752374164
    },
    {
        "content": "<p>Thanks for the tip. Fix incoming: <a href=\"https://github.com/teorth/analysis/pull/180\">https://github.com/teorth/analysis/pull/180</a></p>",
        "id": 528527440,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1752410509
    },
    {
        "content": "<p>I finished my version of 3.3 solutions if you want to have a look: <a href=\"https://github.com/gaearon/analysis-solutions/pull/6\">https://github.com/gaearon/analysis-solutions/pull/6</a></p>\n<p>They ended up fairly clean IMO. The change <span class=\"user-mention\" data-user-id=\"816344\">@Aaron Liu</span> suggested earlier helped quite a bit with keeping the goal on track.  I got a bit lost with the last one due to missing <code>open Classical</code> so I sent <a href=\"https://github.com/teorth/analysis/pull/186\">https://github.com/teorth/analysis/pull/186</a> for that.</p>",
        "id": 528716528,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1752516941
    },
    {
        "content": "<p>Nice, looks a lot cleaner than  my solutions :) will  rebase and rework with the new definitions.</p>",
        "id": 528726167,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1752521130
    }
]