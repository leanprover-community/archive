[
    {
        "content": "<p>Is there a way to nudge the elaborator to use the dot syntax? In particular I’d like it to use <code>h.symm</code> rather than <code>Eq.symm h</code>. Judging from the code it never uses the dot syntax on proofs, and the only attribute to control the behavior (<code>pp_nodot</code>)  goes the wrong way.</p>",
        "id": 475316238,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1728312872
    },
    {
        "content": "<p>You are correct, there's currently no way to get proofs to pretty print with dot notation.</p>\n<p>The justification for this is that it's less likely for dot notation to be able to elaborate, and we want pretty printing to support features like <code>exact?</code>. With <code>h.symm</code>, you have to figure out that <code>h : Eq _ _</code> before it can be resolved, but from <code>Eq.symm h</code> you know both the function and that <code>h : Eq _ _</code> .</p>",
        "id": 475327851,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1728315678
    },
    {
        "content": "<p>(Here's the relevant code: <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.PrettyPrinter.Delaborator.fieldNotationCandidate%3F#doc\">docs#Lean.PrettyPrinter.Delaborator.fieldNotationCandidate?</a>)</p>",
        "id": 475327942,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1728315699
    },
    {
        "content": "<p>Right, but if <code>h</code> inherently has clearly <code>Eq</code> type, then it should be fine and is actually pretty.</p>\n<p>This isnt important, I was just wondering if I can make the <code>calcify</code> output more pretty that way. For now I add an ad-hoc support for this:<br>\n<a href=\"https://github.com/nomeata/lean-calcify/commit/67b07fc2ec499e6e029b5e6b301269ca0f36fce4\">https://github.com/nomeata/lean-calcify/commit/67b07fc2ec499e6e029b5e6b301269ca0f36fce4</a></p>",
        "id": 475329352,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1728316010
    },
    {
        "content": "<p>It can be pretty tricky determining whether <code>h</code> clearly has <code>Eq</code> type with the current architecture. For example, what if <code>h</code> is from a <code>fun</code> binder? Normally <code>fun</code> binders don't print types, and somehow the <code>fun</code> delaborator would need to collaborate with the dot notation delaborator to make sure it comes out as either <code>fun h =&gt; Eq.symm h</code> or <code>fun (h : Eq a b) =&gt; h.symm</code>.</p>",
        "id": 475329843,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1728316159
    },
    {
        "content": "<p>I think we could relax the restriction (behind an option). Theoretically <code>pp.analyze</code>, when it's enabled, can determine whether to suppress dot notation automatically, but it's not been tested nearly enough.</p>\n<p>The current version is \"I'll make this be conservative with proofs because I really don't want to break anything when we roll out generalized dot notation\" :-)</p>",
        "id": 475330226,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1728316270
    },
    {
        "content": "<p>That's a very good point. I wonder if I'll have to revert this change in light of this.</p>\n<p>I expect that we'll see more and more tactics that want to delaborate reliably and prettily, and might need a robust <code>pp.analyze</code> eventually.</p>",
        "id": 475330523,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1728316359
    },
    {
        "content": "<p>Recently I had to debug something and what worked was to use <code>pp.raw</code> and then manually fix the syntax <span aria-label=\"disappointed\" class=\"emoji emoji-1f61e\" role=\"img\" title=\"disappointed\">:disappointed:</span></p>",
        "id": 475330732,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1728316427
    },
    {
        "content": "<p>Something I've wondered for a long time was whether we could have <code>←</code> be a prefix operator that applies some sort of symmetry to a term. For example, it could work like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">variables</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h''</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"c1\">-- 3 = 2</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">h'</span>\n<span class=\"c1\">-- q ↔ p</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">h''</span>\n<span class=\"c1\">-- ∀ n : Nat, n = n + 1 - 1</span>\n</code></pre></div>\n<p>(This is how I thought the arrow worked in <code>rw</code> in my first few hours of learning Lean.)</p>",
        "id": 475333135,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1728317166
    },
    {
        "content": "<p>(Incidentally, it'd be neat if there were a dot notation syntax that can eagerly enter under a function type, like imagine <code>my_thm..mp a b</code> instead of needing to write <code>(my_thm a b).mp</code>.)</p>",
        "id": 475333599,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1728317290
    },
    {
        "content": "<p>Maybe not that notation, but a convenient way to apply iff theorems would be amazing. If we had that, I would write only a third of the theorems I do now! (Slight exaggeration)</p>\n<p>I think in Isabelle <code>apply</code> simply recognizes iff lemma and tries <code>.mp</code> or <code>.mpr</code> implicitly, but I may misremember</p>",
        "id": 475334173,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1728317427
    }
]