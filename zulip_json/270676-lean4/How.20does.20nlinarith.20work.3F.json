[
    {
        "content": "<p>I saw somewhere the following lean code:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Aesop</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">maxHeartbeats</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">BigOperators</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">Topology</span><span class=\"w\"> </span><span class=\"n\">Rat</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h_eq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">^</span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h_contra</span>\n<span class=\"w\">  </span><span class=\"n\">rcases</span><span class=\"w\"> </span><span class=\"n\">h_contra</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"n\">nlinarith</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">sq_nonneg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)]</span>\n</code></pre></div>\n<p>But I am confused about how nlinarith solve the goal.</p>",
        "id": 469775282,
        "sender_full_name": "Shange Tang",
        "timestamp": 1726173062
    },
    {
        "content": "<p>Also a similar question:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">algebra_sqineq_unitcircatbpamblt1</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">h₀</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n\n<span class=\"w\">  </span><span class=\"n\">nlinarith</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">sq_nonneg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)]</span>\n</code></pre></div>",
        "id": 469775566,
        "sender_full_name": "Shange Tang",
        "timestamp": 1726173181
    },
    {
        "content": "<p>Some questions for you, so someone can answer effectively:</p>\n<ul>\n<li>do you know what <code>linarith</code> does?</li>\n<li>have you read the help text (e.g. available by hovering) for <code>linarith</code> and <code>nlinarith</code>?</li>\n</ul>",
        "id": 469838386,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726198866
    },
    {
        "content": "<p>A <a href=\"https://github.com/leanprover-community/mathlib4/blob/1ea941a98905b2166146b60739226f3953fd5290/Mathlib/Tactic/Linarith/Frontend.lean#L448\">quick search in mathlib4 shows</a>:</p>\n<blockquote>\n<p>A variant, <code>nlinarith</code>, adds an extra preprocessing step to handle some basic nonlinear goals.<br>\nThere is a hook in the <code>LinarithConfig</code> configuration object to add custom preprocessing routines.</p>\n</blockquote>\n<p>The only difference in the frontend is this line:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">cfg</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">cfg</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">      </span><span class=\"n\">preprocessors</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">cfg</span><span class=\"bp\">.</span><span class=\"n\">preprocessors</span><span class=\"bp\">.</span><span class=\"n\">concat</span><span class=\"w\"> </span><span class=\"n\">nlinarithExtras</span><span class=\"w\"> </span><span class=\"o\">}</span>\n</code></pre></div>\n<p>so I looked at this function, and it says</p>\n<ul>\n<li>\n<p>For every term <code>t</code> such that <code>t^2</code> or <code>t*t</code> appears in the input, adds a proof of <code>t^2 ≥ 0</code><br>\n  or <code>t*t ≥ 0</code>.</p>\n</li>\n<li>\n<p>For every pair of comparisons <code>t1 R1 0</code> and <code>t2 R2 0</code>, adds a proof of <code>t1*t2 R 0</code>.</p>\n</li>\n</ul>\n<p>All of this can be found quickly by searching <code>nlinarith</code> in the mathlib codebase.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">rg</span><span class=\"w\"> </span><span class=\"c1\">--iglob \"**Frontend**\" nlinarith</span>\n<span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">Linarith</span><span class=\"bp\">/</span><span class=\"n\">Frontend</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"mi\">100</span><span class=\"o\">:</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">variant</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"ss\">`nlinarith</span><span class=\"bp\">`</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">adds</span><span class=\"w\"> </span><span class=\"n\">an</span><span class=\"w\"> </span><span class=\"n\">extra</span><span class=\"w\"> </span><span class=\"n\">preprocessing</span><span class=\"w\"> </span><span class=\"n\">step</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">handle</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">basic</span><span class=\"w\"> </span><span class=\"n\">nonlinear</span><span class=\"w\"> </span><span class=\"n\">goals</span><span class=\"bp\">.</span>\n<span class=\"mi\">129</span><span class=\"o\">:</span><span class=\"n\">linarith</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">nlinarith</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">lra</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">nra</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Fourier</span><span class=\"bp\">-</span><span class=\"n\">Motzkin</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">linear</span><span class=\"w\"> </span><span class=\"n\">arithmetic</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">linear</span><span class=\"w\"> </span><span class=\"n\">programming</span>\n<span class=\"mi\">425</span><span class=\"o\">:</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">variant</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"ss\">`nlinarith</span><span class=\"bp\">`</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">does</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">basic</span><span class=\"w\"> </span><span class=\"n\">preprocessing</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">handle</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">nonlinear</span><span class=\"w\"> </span><span class=\"n\">goals</span><span class=\"bp\">.</span>\n<span class=\"mi\">438</span><span class=\"o\">:</span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">are</span><span class=\"w\"> </span><span class=\"n\">inherited</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"ss\">`nlinarith</span><span class=\"bp\">`;</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"ss\">`nlinarith!</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"ss\">`nlinarith</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"o\">]</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">all</span><span class=\"w\"> </span><span class=\"n\">work</span><span class=\"w\"> </span><span class=\"n\">as</span>\n<span class=\"mi\">447</span><span class=\"o\">:</span><span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">nlinarith</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"nlinarith\"</span><span class=\"w\"> </span><span class=\"s2\">\"!\"</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"n\">linarithArgsRest</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span>\n<span class=\"mi\">448</span><span class=\"o\">:</span><span class=\"kd\">@[</span><span class=\"n\">inherit_doc</span><span class=\"w\"> </span><span class=\"n\">nlinarith</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">macro</span><span class=\"w\"> </span><span class=\"s2\">\"nlinarith!\"</span><span class=\"w\"> </span><span class=\"n\">rest</span><span class=\"o\">:</span><span class=\"n\">linarithArgsRest</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"mi\">449</span><span class=\"o\">:</span><span class=\"w\">  </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">nlinarith</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">rest</span><span class=\"o\">:</span><span class=\"n\">linarithArgsRest</span><span class=\"o\">)</span>\n<span class=\"mi\">479</span><span class=\"o\">:</span><span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">nlinarith</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"o\">[</span><span class=\"bp\">!%$</span><span class=\"n\">bang</span><span class=\"o\">]</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"o\">[</span><span class=\"bp\">$</span><span class=\"n\">cfg</span><span class=\"o\">]</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"o\">[</span><span class=\"n\">only</span><span class=\"bp\">%$</span><span class=\"n\">o</span><span class=\"o\">]</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"o\">[[</span><span class=\"bp\">$</span><span class=\"n\">args</span><span class=\"o\">,</span><span class=\"bp\">*</span><span class=\"o\">]]</span><span class=\"bp\">?</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">withMainContext</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"mi\">480</span><span class=\"o\">:</span><span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">args</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TSepArray</span><span class=\"bp\">.</span><span class=\"n\">getElems</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">getD</span><span class=\"w\"> </span><span class=\"o\">{})</span><span class=\"bp\">.</span><span class=\"n\">mapM</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">elabLinarithArg</span><span class=\"w\"> </span><span class=\"ss\">`nlinarith</span><span class=\"o\">)</span>\n<span class=\"mi\">483</span><span class=\"o\">:</span><span class=\"w\">      </span><span class=\"n\">preprocessors</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">cfg</span><span class=\"bp\">.</span><span class=\"n\">preprocessors</span><span class=\"bp\">.</span><span class=\"n\">concat</span><span class=\"w\"> </span><span class=\"n\">nlinarithExtras</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"mi\">488</span><span class=\"o\">:</span><span class=\"c1\">-- { name       := \"nlinarith\",</span>\n<span class=\"mi\">490</span><span class=\"o\">:</span><span class=\"c1\">--   decl_names := [`tactic.interactive.nlinarith],</span>\n</code></pre></div>",
        "id": 470122663,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1726301315
    }
]