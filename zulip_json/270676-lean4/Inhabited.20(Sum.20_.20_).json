[
    {
        "content": "<p>Given <code>{α β : Type _} [Inhabited α] [Inhabited β]</code>, there are 2 non-propeq instances for <code>Inhabited (Sum α β)</code>. While I didn't encounter issues because of this diamond, this is clearly a source for non-propeq diamonds in other parts of the library.</p>",
        "id": 467988659,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1725572123
    },
    {
        "content": "<p>What breaks if we just turn the second one off?</p>",
        "id": 468011502,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725581567
    },
    {
        "content": "<p>Or perhaps just add an <code>IsEmpty a</code> assumption to it?</p>",
        "id": 468026908,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1725586660
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/270676-lean4/topic/Inhabited.20.28Sum.20_.20_.29/near/468011502\">said</a>:</p>\n<blockquote>\n<p>What breaks if we just turn the second one off?</p>\n</blockquote>\n<p>My personal laptop isn't good enough to rebuild Lean+Mathlib to do this experiment.</p>",
        "id": 468027102,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1725586712
    },
    {
        "content": "<p>I'll have a look.</p>",
        "id": 468030906,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725587807
    },
    {
        "content": "<p>We can't add IsEmpty at the point of definition, as these are in Lean, and IsEmpty is a Mathlib addition.</p>",
        "id": 468031128,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725587852
    },
    {
        "content": "<p>But Lean doesn't mind turning these instances off, it seems.</p>",
        "id": 468031178,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725587863
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/5270\">lean#5270</a>. I don't want to merge this myself, to be sure no one will be upset if this instance goes missing.</p>",
        "id": 468032686,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725588263
    },
    {
        "content": "<p>I wouldn't mind turning of the left-handed versions as well. To preserve symmetry/\"canonicity\"</p>",
        "id": 468062104,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1725597290
    },
    {
        "content": "<p>We have left actions not right actions -- why can't we have left inhabited but not right inhabited, and train people to write their Sums the relevant way around if they want this instance? :-)</p>",
        "id": 468081538,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1725603771
    },
    {
        "content": "<p>I think we should turn off the instance iff someone complains that there is a diamond. <code>Inhabited</code> diamonds tend to just not show up in practice.</p>",
        "id": 468085905,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1725604932
    },
    {
        "content": "<p>My question is motivated by <a href=\"https://github.com/leanprover-community/mathlib4/pull/15764\">#15764</a>, where <span class=\"user-mention\" data-user-id=\"459227\">@Violeta Hernández</span> used <code>[Inhabited (Sum _ _)]</code> as an assumption (no longer needed there).</p>",
        "id": 468086480,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1725605101
    },
    {
        "content": "<p>What breaks if we turn both instances off? I'd argue that <code>Inhabited</code> is supposed to be some obvious default (usually some representation of 0), and that picking between <code>inl default</code> and <code>inr default</code> should be left to the caller as neither is obviously better than the other.</p>",
        "id": 468537864,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1725787680
    },
    {
        "content": "<p>(you could argue that \"<code>Sum</code> with a preferred side\", which does have an obvious default, is usually spelled <code>Except</code>)</p>",
        "id": 468538145,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1725787752
    },
    {
        "content": "<p>Done in <a href=\"https://github.com/leanprover/lean4/pull/5284\">lean#5284</a>. Remove all the Inhabited instances, added back in Nonempty instances, everything works.</p>",
        "id": 468648522,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725844269
    }
]