[
    {
        "content": "<p>I have a goal:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">transduce_helper</span><span class=\"w\"> </span><span class=\"n\">StateMachineType</span><span class=\"bp\">.</span><span class=\"n\">Moore</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"n\">moore</span><span class=\"w\"> </span><span class=\"n\">moore</span><span class=\"bp\">.</span><span class=\"n\">s0</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">  </span><span class=\"n\">transduce_helper</span><span class=\"w\"> </span><span class=\"n\">StateMachineType</span><span class=\"bp\">.</span><span class=\"n\">Mealey</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">o</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">state_space</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">moore</span><span class=\"bp\">.</span><span class=\"n\">state_space</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">s0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">moore</span><span class=\"bp\">.</span><span class=\"n\">s0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">transition</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">moore</span><span class=\"bp\">.</span><span class=\"n\">transition</span><span class=\"o\">,</span>\n<span class=\"w\">      </span><span class=\"n\">output</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">x_1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">moore</span><span class=\"bp\">.</span><span class=\"n\">output</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"n\">moore</span><span class=\"bp\">.</span><span class=\"n\">s0</span><span class=\"w\"> </span><span class=\"n\">is</span>\n</code></pre></div>\n<p>I want to <code>generalize moore.s0 = s</code>  on 2 of the 3 occurrences. I want to leave <code>s0 := moore.s0</code> alone.</p>\n<p>The way I'm doing it now is </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">generalize</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">moore</span><span class=\"bp\">.</span><span class=\"n\">s0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">s</span>\n<span class=\"w\">  </span><span class=\"n\">conv</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">rhs</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">congr</span>\n<span class=\"w\">    </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">H</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">skip</span>\n<span class=\"w\">  </span><span class=\"n\">clear</span><span class=\"w\"> </span><span class=\"n\">H</span>\n</code></pre></div>\n<p>Is there a more straightforward way?</p>",
        "id": 503466102,
        "sender_full_name": "Gustavo Goretkin",
        "timestamp": 1741168067
    },
    {
        "content": "<p>The full context is here: <a href=\"https://gist.github.com/goretkin/623625fbeefe930a135d1390c81f70ce\">https://gist.github.com/goretkin/623625fbeefe930a135d1390c81f70ce</a></p>",
        "id": 503466635,
        "sender_full_name": "Gustavo Goretkin",
        "timestamp": 1741168203
    },
    {
        "content": "<p>Maybe you can use the <code>rw (occs := [1,2]) [...]</code> syntax? That rewrites just occurrences 1 and 2 for example.</p>\n<p>The <code>generalize</code> syntax doesn't give any access to <code>occs</code></p>",
        "id": 503484590,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1741173314
    },
    {
        "content": "<p>Thanks, I will try that! How do I split up what <code>generalize H : foo = bar</code> int o two pieces so that I have an <code>H</code> I can give to <code>rw (occs := .pos [1, 2]) [H]</code> (or i might be missing the bigger picture)</p>",
        "id": 503502079,
        "sender_full_name": "Gustavo Goretkin",
        "timestamp": 1741178509
    },
    {
        "content": "<p>You can use the <code>set!</code> tactic: <code>set! bar := foo with H</code> and then rewrite or conv or whatever</p>",
        "id": 503511869,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1741180721
    },
    {
        "content": "<p>Actually that might not work quite how you'd like...</p>",
        "id": 503512839,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1741180929
    },
    {
        "content": "<p>I'm assuming you want to generalize because of induction?</p>",
        "id": 503512967,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1741180954
    },
    {
        "content": "<p>Then perhaps it is simpler to avoid generalization and use <code>let rec</code> instead</p>",
        "id": 503513104,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1741180986
    },
    {
        "content": "<p>I ended up doing </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">generalize</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">moore</span><span class=\"bp\">.</span><span class=\"n\">s0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">s</span>\n<span class=\"w\">  </span><span class=\"n\">rewrite</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">config</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">occs</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">pos</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"o\">]})</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">clear</span><span class=\"w\"> </span><span class=\"n\">H</span>\n<span class=\"w\">  </span><span class=\"n\">revert</span><span class=\"w\"> </span><span class=\"n\">s</span>\n</code></pre></div>\n<p>which is nicer than what I had before.</p>",
        "id": 503602380,
        "sender_full_name": "Gustavo Goretkin",
        "timestamp": 1741200024
    },
    {
        "content": "<p>I don't see the <code>set!</code> tactic</p>",
        "id": 503602733,
        "sender_full_name": "Gustavo Goretkin",
        "timestamp": 1741200113
    },
    {
        "content": "<p>A hack is you could do <code>generalize H : moore.s0 = s at h</code> where <code>h</code> is some hypothesis that doesn't contain <code>moore.s0</code>. That will prevent <code>moore.s0</code> from being replaced in the goal. I'm not recommending this though.</p>\n<p>There's also doing something like <code>let s := moore.s0</code>, then using <code>change</code> to replace certain occurrences, and then <code>clear_value s</code>. It's not that great of an experience.</p>\n<p>Are you on an old Lean? You should be able to write</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">rewrite</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">occs</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>these days.</p>",
        "id": 503604613,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1741200554
    },
    {
        "content": "<p>Robin's suggestion of <code>set!</code> is a mathlib tactic. It's in <code>Mathlib.Tactic.Set</code>. The <code>!</code> causes <code>set</code> to not rewrite.</p>",
        "id": 503605606,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1741200808
    }
]