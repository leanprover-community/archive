[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functor</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">α</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Mu</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\">  </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">mkMu</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Mu</span><span class=\"w\"> </span><span class=\"n\">f</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">cata</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functor</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Mu</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\">  </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>Attempting to define an algebra as above produces the error \"typeclass instance problem is stuck\", but it typechecks if I omit enforcing that <code>f</code> be a functor. Should I omit this constraint or is there a way to fix typeclass resolution for such an algebra?</p>",
        "id": 474496354,
        "sender_full_name": "nrs",
        "timestamp": 1727938278
    },
    {
        "content": "<p>Remove the <code>[Functor f]</code> from the type signature of <code>Algebra</code>. It's unused anyway.</p>",
        "id": 474536653,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1727947566
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"256311\">Jannis Limperg</span> <a href=\"#narrow/stream/270676-lean4/topic/Proper.20way.20to.20define.20an.20algebra.20for.20a.20catamorphism.3F/near/474536653\">said</a>:</p>\n<blockquote>\n<p>Remove the <code>[Functor f]</code> from the type signature of <code>Algebra</code>. It's unused anyway.</p>\n</blockquote>\n<p>Thank you for the feedback!</p>",
        "id": 474638157,
        "sender_full_name": "nrs",
        "timestamp": 1727974106
    },
    {
        "content": "<p>Even though there is value in constraining <code>f</code>, right?</p>\n<p>I would suggest moving <code>[Functor f]</code> after the definition of <code>f</code>, like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functor</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 474650740,
        "sender_full_name": "Tom",
        "timestamp": 1727977933
    },
    {
        "content": "<p>Try hovering over \"both f's\" in the before and after case: You will see that in your original code, the <code>Functor f</code> is is <code>Type u_1 -&gt; Type u_2</code> and then your <code>f: ...</code> introduces a type variable.  Hence why the metavariables cannot be resolved.</p>",
        "id": 474650941,
        "sender_full_name": "Tom",
        "timestamp": 1727978016
    },
    {
        "content": "<p>I have recently asked about this in two related guises:  <a href=\"#narrow/stream/113489-new-members/topic/Class.2Finstance.20syntax.20clarification/near/471979296\">Here</a>.</p>\n<p>I think the reason why this happens is related to the following (I still claim <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span> ) counterintuitive behavior: <a href=\"#narrow/stream/270676-lean4/topic/.E2.9C.94.20Multiple.20parameters.20with.20the.20same.20name.20isn't.20an.20error/near/473416006\">Here</a></p>",
        "id": 474651485,
        "sender_full_name": "Tom",
        "timestamp": 1727978214
    },
    {
        "content": "<p>You could have avoided this issue by setting <code>set_option autoImplicit false</code>, btw.  I now just paste it above my code to just check my implicits are \"what I think they are\".</p>",
        "id": 474651790,
        "sender_full_name": "Tom",
        "timestamp": 1727978327
    },
    {
        "content": "<p>Btw, cool project.  I was just recently thinking if I could practice some metaprogramming and get lean to generate the \"algebra carriers\" automatically.</p>",
        "id": 474652200,
        "sender_full_name": "Tom",
        "timestamp": 1727978425
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"515083\">Tom</span> <a href=\"#narrow/stream/270676-lean4/topic/Proper.20way.20to.20define.20an.20algebra.20for.20a.20catamorphism.3F/near/474652200\">said</a>:</p>\n<blockquote>\n<p>Btw, cool project.  I was just recently thinking if I could practice some metaprogramming and get lean to generate the \"algebra carriers\" automatically.</p>\n</blockquote>\n<p>Thanks for the comments! I will be mulling these over. If you're working on something similar absolutely tag me if you make progress! Will do likewise</p>",
        "id": 474670507,
        "sender_full_name": "nrs",
        "timestamp": 1727985356
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"515083\">Tom</span> <a href=\"#narrow/stream/270676-lean4/topic/Proper.20way.20to.20define.20an.20algebra.20for.20a.20catamorphism.3F/near/474651790\">said</a>:</p>\n<blockquote>\n<p><code>set_option autoImplicit false</code></p>\n</blockquote>\n<p>woah I've been playing around with <code>set_option autoImplicit false</code> and it's extremely helpful! thanks a lot for that tip</p>",
        "id": 474693003,
        "sender_full_name": "nrs",
        "timestamp": 1727995664
    },
    {
        "content": "<p>Just passing on what others told me <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 474703500,
        "sender_full_name": "Tom",
        "timestamp": 1728002476
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"515083\">Tom</span> <a href=\"#narrow/stream/270676-lean4/topic/Proper.20way.20to.20define.20an.20algebra.20for.20a.20catamorphism.3F/near/474650740\">said</a>:</p>\n<blockquote>\n<p>Even though there is value in constraining <code>f</code>, right?</p>\n<p>I would suggest moving <code>[Functor f]</code> after the definition of <code>f</code>, like this:</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functor</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>a thought about this: if Lean's <code>-&gt;</code> corresponds to a polynomial endofunctor in a locally cartesian closed category, it may actually be accurate to use it simply so without any additional constraint, since the articles presenting recursion schemes seem to be reasoning in that category</p>",
        "id": 474740448,
        "sender_full_name": "nrs",
        "timestamp": 1728020886
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"749978\">@nrs</span>  did you get the catamorphism to work?</p>",
        "id": 486575242,
        "sender_full_name": "DSB",
        "timestamp": 1733510774
    },
    {
        "content": "<p>It seems that I'm trying to do something similar to you. I'm trying to translate some of the Category Theory concepts applied to Programming from Bartosz book.</p>",
        "id": 486575347,
        "sender_full_name": "DSB",
        "timestamp": 1733510818
    },
    {
        "content": "<p>I was just working on this, I haven't tested it extensively but I think it might be a start:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">  </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">P</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"bp\">⟩</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">aa</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">bb</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">⊕</span><span class=\"w\"> </span><span class=\"n\">aa</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Sum</span><span class=\"bp\">.</span><span class=\"n\">elim</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">bb</span><span class=\"bp\">⟩</span>\n\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Ext</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"bp\">.</span><span class=\"n\">α</span>\n<span class=\"w\">  </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"bp\">.</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">T</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Ext</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">TA</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ext</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Ext</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">TA</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">sup</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ext</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"n\">F</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Alg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Ext</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">T</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Alg</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Alg</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Alg</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Alg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">T</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">alga</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">algb</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">alga</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">val</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">algb</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">val</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">cata</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">alg</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Alg</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">T</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">alg</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">cata</span><span class=\"w\"> </span><span class=\"n\">alg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"o\">)</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">ListP</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"bp\">⊕</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Empty</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">TreeP</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"bp\">⊕</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Empty</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"bp\">⊕</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">ListWtoTreeWR</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Alg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">ListP</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">TreeP</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">unit</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">nomatch</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">⟩</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"n\">val</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">unit</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">nomatch</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">⟩</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">unit</span><span class=\"bp\">⟩</span>\n</code></pre></div>",
        "id": 486575671,
        "sender_full_name": "nrs",
        "timestamp": 1733510937
    },
    {
        "content": "<p>it requires using the w-type form of the inductive type however</p>",
        "id": 486575789,
        "sender_full_name": "nrs",
        "timestamp": 1733510980
    },
    {
        "content": "<p>Hmm, I'm not aware of w-types. First type I hear about it. Is there a reason for not wanting to model it using this?</p>",
        "id": 486577234,
        "sender_full_name": "DSB",
        "timestamp": 1733511527
    },
    {
        "content": "<p>it might not be possible otherwise, the main issue is that haskell can evaluate type-level fixpoints while this is not possible in lean due to it being eagerly evaluated</p>",
        "id": 486577448,
        "sender_full_name": "nrs",
        "timestamp": 1733511613
    },
    {
        "content": "<p>Yeah, I was having trouble trying to figure out how to define the fixed point type.</p>",
        "id": 486577589,
        "sender_full_name": "DSB",
        "timestamp": 1733511667
    },
    {
        "content": "<p>I see that in your code you use <code>W F</code> where one would have <code>Fix F</code>. Right?</p>",
        "id": 486577663,
        "sender_full_name": "DSB",
        "timestamp": 1733511699
    },
    {
        "content": "<p>in the above <code>W</code> (which is the type of w-types) is the fixed point type used to make the cata work</p>",
        "id": 486577671,
        "sender_full_name": "nrs",
        "timestamp": 1733511702
    },
    {
        "content": "<p>yeah that's right</p>",
        "id": 486577687,
        "sender_full_name": "nrs",
        "timestamp": 1733511707
    },
    {
        "content": "<p>the theoretical statement at play here is that <code>W</code> is the \"least fixed point\", or the initial algebra, of a given polynomial functor</p>",
        "id": 486577800,
        "sender_full_name": "nrs",
        "timestamp": 1733511744
    },
    {
        "content": "<p>Yeah, I imagine that the issue with <code>Fix F</code> is that it is not guaranteed to exist.</p>",
        "id": 486577908,
        "sender_full_name": "DSB",
        "timestamp": 1733511787
    },
    {
        "content": "<p>Hence, since Lean requires termination, it would not be allowed.</p>",
        "id": 486577942,
        "sender_full_name": "DSB",
        "timestamp": 1733511802
    },
    {
        "content": "<p>Yet, if <code>F</code> is polynomial, it is guaranteed to exists...</p>",
        "id": 486578001,
        "sender_full_name": "DSB",
        "timestamp": 1733511826
    },
    {
        "content": "<p>i think however that there's a <code>Fix</code> type in mathlib, and a computable <code>Fix</code> type somewhere in either Batteries, or Std. might be worth checking if they have any use here</p>",
        "id": 486578040,
        "sender_full_name": "nrs",
        "timestamp": 1733511842
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"709428\">DSB</span> <a href=\"#narrow/channel/270676-lean4/topic/Proper.20way.20to.20define.20an.20algebra.20for.20a.20catamorphism.3F/near/486578001\">said</a>:</p>\n<blockquote>\n<p>Yet, if <code>F</code> is polynomial, it is guaranteed to exists...</p>\n</blockquote>\n<p>yes another issue you might encounter is that in haskell inductive and coinductive types coincide, so the greatest and least fixed points coincide, which is not the case in lean. here our least fixed point generates an inductive type</p>",
        "id": 486578166,
        "sender_full_name": "nrs",
        "timestamp": 1733511882
    },
    {
        "content": "<p>I'm veeery new to Lean. I'm trying to adapt some of the functional (categorical) stuff as I learn.</p>",
        "id": 486578171,
        "sender_full_name": "DSB",
        "timestamp": 1733511885
    },
    {
        "content": "<p>polynomial functors and w-types are good search terms to figure out how to adapt haskell fp to lean, the libraries for these are still very new</p>",
        "id": 486578385,
        "sender_full_name": "nrs",
        "timestamp": 1733511968
    },
    {
        "content": "<p>as a side note, a \"general\" <code>Fix</code> type is not consistent, see <a href=\"https://github.com/leanprover/reference-manual/issues/124\">this issue</a></p>",
        "id": 486578391,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1733511974
    },
    {
        "content": "<p>I can understand the idea behind the fixed point <code>Fix</code>, and how in mathematics a fixed point does not always exist, hence why Lean would not allow such naive implementation. </p>\n<p>I'm intrigued by this <code>W</code> though.</p>",
        "id": 486578487,
        "sender_full_name": "DSB",
        "timestamp": 1733512016
    },
    {
        "content": "<p>I mean, what is it doing so that one could use it instead of Fix?</p>",
        "id": 486578517,
        "sender_full_name": "DSB",
        "timestamp": 1733512033
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"749978\">nrs</span> <a href=\"#narrow/channel/270676-lean4/topic/Proper.20way.20to.20define.20an.20algebra.20for.20a.20catamorphism.3F/near/486578385\">said</a>:</p>\n<blockquote>\n<p>polynomial functors and w-types are good search terms to figure out how to adapt haskell fp to lean, the libraries for these are still very new</p>\n</blockquote>\n<p>Thanks, I'll try to take a look.</p>",
        "id": 486578704,
        "sender_full_name": "DSB",
        "timestamp": 1733512113
    }
]