[
    {
        "content": "<p>I’d like to quickly flag a change I’m about to merge (PR <a href=\"https://github.com/leanprover/lean4/pull/12217\">lean4#12217</a>): As described in RFC <a href=\"https://github.com/leanprover/lean4/pull/12216\">lean4#12216</a>, we are changing how proofs that involve native computation (<code>native_decide</code>, <code>bv_decide</code>) are represented in the proof term. </p>\n<p>Brief summary: Instead of embedding the computation with the general <code>ofReduceBool</code> axiom, and the kernel then calling back to the compiler to evaluate the computation, now the tactic will run the computation and, if it returns true, assert that result using <code>axiom : … = true</code>.  The whole <code>ofReduceBool</code> and <code>Lean.trustCompiler</code> machinery is deprecated.</p>\n<p>The main user-impact is that if you use such tactics, then <code>#print axioms</code> will now show different and possibly multiple axioms:</p>\n<div class=\"codehilite\" data-code-language=\"Diff\"><pre><span></span><code><span class=\"gd\">- 'bv_axiomCheck' depends on axioms: [propext, Classical.choice, Lean.ofReduceBool, Lean.trustCompiler, Quot.sound]</span>\n<span class=\"gi\">+ 'bv_axiomCheck' depends on axioms: [propext, Classical.choice, Quot.sound, bv_axiomCheck._native.bv_decide.ax_1_5]</span>\n</code></pre></div>\n<p>You can even Ctrl-click on the axiom name and jump to the tactic that added it (H'T <span class=\"user-mention\" data-user-id=\"873547\">@Robin Arnez</span> for the suggestion)</p>",
        "id": 571612403,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1770111717
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span>, could the generated axioms come with a doc-string, which gives a user friendly explanation of what is going on?</p>\n<p>Something along the lines of:</p>\n<blockquote>\n<p>The tactic <code>bv_decide</code> uses an external SAT solver for some problems. That SAT solver generates a certificate which <code>bv_decide</code> verifies. You don't need to trust the SAT solver at all, but you are trusting <code>bv_decide</code>'s verification code. Because this expands the trusted code base outside of the Lean kernel, each proof generated by <code>bv_decide</code> is wrapped as a <code>axiom</code>.</p>\n</blockquote>",
        "id": 571792619,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1770163984
    },
    {
        "content": "<p>Can we avoid drowning the environment in such docstrings in cases when many axioms are generated?</p>",
        "id": 571807586,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1770173668
    },
    {
        "content": "<p>One option would be something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- Docstring goes here. -/</span>\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">BVDecideAxiom</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">eq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span>\n\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">bv_axiomCheck</span><span class=\"bp\">._</span><span class=\"n\">native</span><span class=\"bp\">.</span><span class=\"n\">bv_decide</span><span class=\"bp\">.</span><span class=\"n\">ax_1_5</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BVDecideAxiom</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 571807646,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1770173723
    },
    {
        "content": "<p>Both good ideas worth considering, thanks.</p>\n<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> , where do you see issues with the same docstring appearing multiple times? Documentation rendering (not sure of such an auxiliary declaration should appear there)?</p>",
        "id": 571831007,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1770189095
    },
    {
        "content": "<p>I was thinking in olean size, but maybe reuse makes that moot.</p>",
        "id": 571833991,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1770190388
    },
    {
        "content": "<p>But I think we do want this docstring to show up _somewhere_ in doc-gen, and if we have a public decl like <code>BVDecideAxiom</code> to attach it to then it's perhaps easier to understand vs attaching it to the tactic directly.</p>",
        "id": 571834075,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1770190426
    },
    {
        "content": "<p>Well, only if the axiom shows up in the doc-gen. we don't show other auxillary declarations (<code>…._proof</code>) there.</p>",
        "id": 571853092,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1770195949
    }
]