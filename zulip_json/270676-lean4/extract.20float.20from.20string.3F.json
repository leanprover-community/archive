[
    {
        "content": "<p>hey everyone! How do we extract a float value from the string? Theres functions like \"String.toInt?\" but i dont see a similar one for float?</p>",
        "id": 510101403,
        "sender_full_name": "Robert",
        "timestamp": 1743748256
    },
    {
        "content": "<p>I guess the best you can do is use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=OfScientific.ofScientific#doc\">docs#OfScientific.ofScientific</a>, and parse the exact numbers from the <code>String</code> yourself.</p>",
        "id": 510142163,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1743761267
    },
    {
        "content": "<p>there is definitely a float parser in core, it is needed in JSON parsing</p>",
        "id": 510274157,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1743794356
    },
    {
        "content": "<p>It produces <code>JsonNumber</code> but it's not too hard to adapt it</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Json</span><span class=\"bp\">.</span><span class=\"n\">Parser</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">.</span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Float</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"bp\">.</span><span class=\"n\">toFloat?</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">mantissa</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">exponent</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Json</span><span class=\"bp\">.</span><span class=\"n\">Parser</span><span class=\"bp\">.</span><span class=\"n\">num</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toOption</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">divFloat</span><span class=\"w\"> </span><span class=\"n\">mantissa</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">exponent</span><span class=\"o\">)</span>\n\n<span class=\"sd\">/-- info: some 2.000000 -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"bp\">.</span><span class=\"n\">toFloat?</span><span class=\"w\"> </span><span class=\"s2\">\"2.0\"</span>\n<span class=\"sd\">/-- info: some 0.000023 -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"bp\">.</span><span class=\"n\">toFloat?</span><span class=\"w\"> </span><span class=\"s2\">\"2.333333e-5\"</span>\n<span class=\"sd\">/-- info: none -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"bp\">.</span><span class=\"n\">toFloat?</span><span class=\"w\"> </span><span class=\"s2\">\"hello\"</span>\n</code></pre></div>",
        "id": 510275880,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1743795032
    },
    {
        "content": "<p>Perhaps someone could refactor that flip the dependency (i.e. keep the same logic, but in a new Float.fromString? and have the json parser call that?</p>",
        "id": 510426046,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1743898605
    },
    {
        "content": "<p>well you probably wouldn't want to have json route through floats directly as the process is lossy</p>",
        "id": 510427018,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1743899462
    },
    {
        "content": "<p>currently it's being parsed into <code>JsonNumber</code> which can represent decimal fractions losslessly</p>",
        "id": 510427040,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1743899483
    },
    {
        "content": "<p>but you could have a more agnostic basic function which returns the mantissa/exponent components without committing to the <code>JsonNumber</code> type</p>",
        "id": 510427119,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1743899534
    },
    {
        "content": "<p>(Note also that I used a function from batteries here (<code>Int.divFloat</code>), which as you can tell from the module name I'm <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span> on upstreaming)</p>",
        "id": 510427181,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1743899628
    }
]