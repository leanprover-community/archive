[
    {
        "content": "<p>Since a few weeks, lean in neovim doesn't work well for me, any significant modifications leands neovim to indicate that it is <code>Processing file</code>, but that seems to take hours… Doing <code>LeanRestartFile</code> each time kind of works, but this is quite painful. Moreover <code>lake build …</code> works swiftly, so it does not seem to be lean/lake, but really neovim.  </p>\n<p>I tried to update the plugins, with no significant output.</p>",
        "id": 479364936,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1730152148
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321696\">@Julian Berman</span> <span aria-label=\"up\" class=\"emoji emoji-2b06\" role=\"img\" title=\"up\">:up:</span></p>",
        "id": 479365382,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1730152424
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"130609\">@Antoine Chambert-Loir</span> is there anything else notable about the project this happens with? Is it Mathlib? Does it happen if you don't import anything, and then happens if you import Mathlib? Also perhaps share <code>:checkhealth lean</code> though I doubt it will have anything notable in it.</p>",
        "id": 479377780,
        "sender_full_name": "Julian Berman",
        "timestamp": 1730159058
    },
    {
        "content": "<p>Here is the output of <code>:checkhealth lean</code>; it seems OK…</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">lean</span><span class=\"bp\">.</span><span class=\"n\">nvim</span>\n<span class=\"w\">  </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">OK</span><span class=\"w\"> </span><span class=\"n\">Neovim</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">enough</span><span class=\"bp\">.</span>\n<span class=\"w\">  </span><span class=\"bp\">-</span><span class=\"w\">   </span><span class=\"n\">vim</span><span class=\"bp\">.</span><span class=\"n\">version</span><span class=\"o\">():</span><span class=\"w\">  </span><span class=\"mf\">0.10</span><span class=\"bp\">.</span><span class=\"m\">2</span>\n<span class=\"w\">  </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">OK</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">runnable</span><span class=\"bp\">.</span>\n<span class=\"w\">  </span><span class=\"bp\">-</span><span class=\"w\">   </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"c1\">--version:  Lake version 5.0.0-01d414a (Lean version 4.13.0-rc3)</span>\n</code></pre></div>",
        "id": 479423728,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1730190219
    },
    {
        "content": "<p>In case it helps, here is the error message I get:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">LSP</span><span class=\"o\">[</span><span class=\"n\">leanls</span><span class=\"o\">]:</span><span class=\"w\"> </span><span class=\"n\">Error</span><span class=\"w\"> </span><span class=\"n\">NO_RESULT_CALLBACK_FOUND</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">  </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"mi\">32601</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">message</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"No RPC method 'Lean.Widget.getInteractiveDiagnostics' found\"</span>\n<span class=\"w\">  </span><span class=\"o\">},</span>\n<span class=\"w\">  </span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2528</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">jsonrpc</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"2.0\"</span>\n<span class=\"o\">}</span>\n</code></pre></div>",
        "id": 479444493,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1730197237
    },
    {
        "content": "<p>(with <code>id</code>s increasing from that to 2692,  …, 2766,…)</p>",
        "id": 479444648,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1730197298
    },
    {
        "content": "<p>OK, I've seen that error (and have been working on it). I'll get back to it today and should have a fix for you to update to. I'm intrigued that no one else sees it besides you and me, but maybe others see it and haven't reported it yet.</p>",
        "id": 479497022,
        "sender_full_name": "Julian Berman",
        "timestamp": 1730212754
    },
    {
        "content": "<p>I’m pretty sure I’ve already seen it, but not in a reproducible way.</p>",
        "id": 479502678,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1730214212
    },
    {
        "content": "<p>The reproducible way that I know of is if your file starts with <code>import Foo</code> and then you try to edit near it, and <code>Foo</code> is nonsense (i.e. the import doesn't exist or isn't valid syntax or something) and then you try to edit around there, then Lean sends back messages saying \"I'm dead, stop!\" and doesn't respond to that RPC method.</p>",
        "id": 479508895,
        "sender_full_name": "Julian Berman",
        "timestamp": 1730215982
    },
    {
        "content": "<p>So I think I know how to fix it, I'm just confirming. And then <em>hopefully</em> that's the case that the two of you have seen.</p>",
        "id": 479508968,
        "sender_full_name": "Julian Berman",
        "timestamp": 1730216004
    },
    {
        "content": "<p>I have been busier than expected the last few days so I haven't pushed this out yet, apologies, but just noting I definitely haven't forgotten about it.</p>",
        "id": 479887264,
        "sender_full_name": "Julian Berman",
        "timestamp": 1730383837
    },
    {
        "content": "<p>Even though I still don't really understand this scenario well enough to be able to reproduce it in an automated test, I've just pushed out what fixes it for me in the case I was aware of. If you update please let me know if it doesn't fix things for you.</p>",
        "id": 480968775,
        "sender_full_name": "Julian Berman",
        "timestamp": 1730914292
    },
    {
        "content": "<p>No rush of course but <span class=\"user-mention\" data-user-id=\"130609\">@Antoine Chambert-Loir</span> did this fix things for you hopefully?</p>",
        "id": 481383099,
        "sender_full_name": "Julian Berman",
        "timestamp": 1731098335
    },
    {
        "content": "<p>I hadn't the opportunity to do much Lean in the present days. On thursday, the few modifications I made seemed that it was better, but I remember having gotten a few of this “No RPC method” error. (A few within one hour of coding, and not one after every modification.)</p>",
        "id": 481705469,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1731327018
    }
]