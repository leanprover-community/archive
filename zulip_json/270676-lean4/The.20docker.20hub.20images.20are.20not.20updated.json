[
    {
        "content": "<p>I've posted this to leanprover/lean4 on github: <a href=\"https://github.com/leanprover/lean4/issues/6996\">https://github.com/leanprover/lean4/issues/6996</a> but was advised to reach out to the community. Paste here:</p>\n<blockquote>\n<p>The images in the docker hub is outdated. <a href=\"https://hub.docker.com/u/leanprovercommunity\">https://hub.docker.com/u/leanprovercommunity</a><br>\nAlthough the hub is hosted by leanprovercommunity, but the official lean4 repository is here.</p>\n<p>Can we create a new official leanprover identity in docker hub and main the images? I will help many users to install and use lean4 quickly and let developers be able to switch between different versions of lean4 easily. Users can easily add more tools and build their images on top of lean4 easily.</p>\n<p>I could help on this. I already hosted my own docker image release pipeline and build images nightly. <a href=\"https://github.com/ctseng777/docker-lean4/tree/main\">https://github.com/ctseng777/docker-lean4/tree/main</a></p>\n</blockquote>\n<p>Mainly, I want to run lean-gym and various projects on top of lean4 in a cleaner and flexible way. Building/installing several lean4 from scratch locally isn't fun.</p>",
        "id": 498486451,
        "sender_full_name": "Chiung-Yi Tseng",
        "timestamp": 1739007431
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span>, I know you were interested in this. Do you know what the status is? Can we add some CI that keeps these updated, so humans don't have to?</p>",
        "id": 498571188,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1739081603
    },
    {
        "content": "<p>The status is that you should ping me every time we need to update the images. I don't know anything about automating with dockerhub</p>",
        "id": 498581722,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1739091823
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span>  I've built my own docker pipeline which builds nightly images. <br>\n<a href=\"https://github.com/ctseng777/docker-lean4/tree/main\">https://github.com/ctseng777/docker-lean4/tree/main</a><br>\nYou may refer to it, or I  could help.</p>",
        "id": 498585875,
        "sender_full_name": "Chiung-Yi Tseng",
        "timestamp": 1739095347
    },
    {
        "content": "<p>We already have <code>scripts/docker_build.sh</code> and <code>scripts/docker_push.sh</code> that automate most of the work. Sadly, it's hard for me to run these scripts because I am not Unix-proficient <span aria-label=\"sweat\" class=\"emoji emoji-1f613\" role=\"img\" title=\"sweat\">:sweat:</span></p>",
        "id": 498585951,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1739095413
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"875773\">@Chiung-Yi Tseng</span>, if we could run the scripts <span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span> refers to regularly, would this solve your use case? If not, are you able to PR additions to those scripts that would?</p>",
        "id": 498653720,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1739151012
    },
    {
        "content": "<p>The challenge is, even with the script, someone needs to run it. We need to have some ci workflow to fully automate the work.<br>\nIn fact, @<a href=\"https://github.com/leanprover/lean4-nightly/commits?author=leodemoura\">leodemoura</a> has a repo:<a href=\"https://github.com/leanprover/lean4-nightly\">lean4-nightly</a> for it, but the repo has nothing.</p>",
        "id": 498659318,
        "sender_full_name": "Chiung-Yi Tseng",
        "timestamp": 1739154987
    },
    {
        "content": "<p>No, you're misunderstanding the purpose of the lean4-nightly repo.</p>",
        "id": 498660686,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1739155967
    },
    {
        "content": "<p>Yes, we can run a script every day/week/month as appropriate, and I can populate the credentials appropriately. The missing work is someone writing and testing and documenting a script, not running it.</p>",
        "id": 498660751,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1739156016
    },
    {
        "content": "<p>Ah, see. I'd like to help writing/testing/documenting the script.<br>\n<span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span>  I can't find <code>scripts/docker_build.sh</code> and <code>scripts/docker_push.sh</code>. Which repo are they located? Can you share the links?</p>",
        "id": 498662332,
        "sender_full_name": "Chiung-Yi Tseng",
        "timestamp": 1739157121
    },
    {
        "content": "<p>They are both in the mathlib4 repo: <a href=\"https://github.com/leanprover-community/mathlib4/tree/master/scripts\">https://github.com/leanprover-community/mathlib4/tree/master/scripts</a></p>",
        "id": 498689819,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1739174300
    },
    {
        "content": "<p>Okay, <span class=\"user-mention\" data-user-id=\"492774\">@Sky Wilshaw</span> and I tracked down <code>scripts/docker_build.sh</code> not working to the addition of the following two lines in the dockerfile:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">RUN</span><span class=\"w\"> </span><span class=\"n\">curl</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">neovim</span><span class=\"bp\">/</span><span class=\"n\">neovim</span><span class=\"bp\">/</span><span class=\"n\">releases</span><span class=\"bp\">/</span><span class=\"n\">download</span><span class=\"bp\">/</span><span class=\"n\">stable</span><span class=\"bp\">/</span><span class=\"n\">nvim</span><span class=\"bp\">-</span><span class=\"n\">linux64</span><span class=\"bp\">.</span><span class=\"n\">tar</span><span class=\"bp\">.</span><span class=\"n\">gz</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">tar</span><span class=\"w\"> </span><span class=\"n\">xzf</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"bp\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">sudo</span><span class=\"w\"> </span><span class=\"n\">mv</span><span class=\"w\"> </span><span class=\"n\">nvim</span><span class=\"bp\">-</span><span class=\"n\">linux64</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">opt</span><span class=\"bp\">/</span><span class=\"n\">nvim</span>\n<span class=\"n\">ENV</span><span class=\"w\"> </span><span class=\"n\">PATH</span><span class=\"bp\">=</span><span class=\"s2\">\"/home/gitpod/.local/bin:/home/gitpod/.elan/bin:/opt/nvim/bin:${PATH}\"</span>\n</code></pre></div>",
        "id": 498732641,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1739185928
    },
    {
        "content": "<p>They come from <a href=\"https://github.com/leanprover-community/mathlib4/pull/9024\">#9024</a>, which <span class=\"user-mention\" data-user-id=\"321696\">@Julian Berman</span> authored.</p>",
        "id": 498732683,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1739185941
    },
    {
        "content": "<p>Is there any way to achieve the same result without hardcoding the download link, which in this case seems to no longer be valid?</p>",
        "id": 498732774,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1739185977
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/21653\">https://github.com/leanprover-community/mathlib4/pull/21653</a></p>\n<p>It looks like neovim now builds separately for x86-64 and arm64 on Linux. So I've just mirrored that assuming we also may want multi-arch builds (e.g. if someone bundles a toolchain into an image). (If that's not the case then in theory we could just hardcode something there rather than using <code>TARGETARCH</code>). But this seems to work here.</p>\n<p>Jammy's version is ancient, so another way to get the same result would be updating the base image, presumably newer ubuntu has newer neovim (though not sure if newest ubuntu is even up to date honestly).</p>",
        "id": 498770793,
        "sender_full_name": "Julian Berman",
        "timestamp": 1739196428
    },
    {
        "content": "<p>Ah yes, I am happy to update the base image</p>",
        "id": 498771069,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1739196493
    },
    {
        "content": "<p>It looks like even oracular is still old <a href=\"https://packages.ubuntu.com/oracular/neovim\">https://packages.ubuntu.com/oracular/neovim</a> (0.9, which is like 2 years or so, and not supported upstream). So probably still this way is reasonable at least as far as nvim is concerned.</p>",
        "id": 498776628,
        "sender_full_name": "Julian Berman",
        "timestamp": 1739197801
    }
]