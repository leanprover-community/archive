[
    {
        "content": "<p>We all know and love <code>if let</code> notation, right? What do people think about having analogous notation when using <code>while</code>? Then you can write something like:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">mut</span><span class=\"w\"> </span><span class=\"n\">n?</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">while</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">n?</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">n?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">doSomething</span><span class=\"w\"> </span><span class=\"n\">n</span>\n</code></pre></div>\n<p>This would behave the same as:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">mut</span><span class=\"w\"> </span><span class=\"n\">n?</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">repeat</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">n?</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">n?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">doSomething</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"k\">else</span>\n<span class=\"w\">    </span><span class=\"n\">break</span>\n</code></pre></div>\n<p><em>(Both Rust and Swift also have this feature.)</em></p>",
        "id": 532083451,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1753970623
    },
    {
        "content": "<p>Rust also has this feature. It would be handy I think.</p>",
        "id": 532085739,
        "sender_full_name": "Max Nowak üêâ",
        "timestamp": 1753971142
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/1996\">lean4#1996</a></p>",
        "id": 532087490,
        "sender_full_name": "Chris Henson",
        "timestamp": 1753971560
    },
    {
        "content": "<p>My favorite substitute:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">repeat</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">n?</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">break</span>\n<span class=\"w\">  </span><span class=\"bp\">...</span>\n</code></pre></div>",
        "id": 532128000,
        "sender_full_name": "Cameron Zwarich",
        "timestamp": 1753981951
    },
    {
        "content": "<p>I'm a bit worried about Lean adding too much syntax sugar to core, since anything added to core will likely remain in the language forever. Adding more syntax sugar in core also makes it harder to make a second implementation of Lean in the distant future. IMO we should be taking advantage of Lean's metaprogramming to implement new language features outside of core where they have a lower cost.</p>",
        "id": 532141965,
        "sender_full_name": "Niels Voss",
        "timestamp": 1753986375
    },
    {
        "content": "<blockquote>\n<p>Adding more syntax sugar in core also makes it harder to make a second implementation of Lean in the distant future.</p>\n</blockquote>\n<p>This is basically impossible with the fragility of the core algorithms of Lean combined with how much projects (knowingly or unknowingly) rely on details. There are certain files in core where basically any change <em>will</em> break a proof in mathlib.</p>",
        "id": 532143656,
        "sender_full_name": "Henrik B√∂ving",
        "timestamp": 1753986914
    },
    {
        "content": "<p>I agree with <span class=\"user-mention\" data-user-id=\"521331\">@Niels Voss</span>. The issue I linked above has a comment showing a macro to define <code>while let</code>.</p>",
        "id": 532146348,
        "sender_full_name": "Chris Henson",
        "timestamp": 1753987879
    },
    {
        "content": "<p>That's a valid worry, however in this case, isn't it added cognitive complexity that <code>while</code> <em>doesn't</em> accept the same condition syntax as <code>if</code>?</p>",
        "id": 532151203,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753989684
    },
    {
        "content": "<p>The <code>unless</code> syntax probably shouldn't have full <code>if</code> condition syntax though... or at least it could parse and then have an error (the body of the <code>unless</code> joins back into a context where there could be some extra pattern variables)</p>",
        "id": 532152057,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753989998
    },
    {
        "content": "<p>Perhaps <code>unless let .some x := x? then return</code> could emit an error saying \"write <code>let .some x := x? | return</code> instead\"?</p>",
        "id": 532171401,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1753997537
    },
    {
        "content": "<p>Though there are a lot of cases where I've wanted</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">unless</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">throw</span><span class=\"w\"> </span><span class=\"s2\">\"oops\"</span>\n<span class=\"c1\">-- now have `h`</span>\n</code></pre></div>\n<p>and</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstanceAs</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\">  </span><span class=\"n\">throw</span><span class=\"w\"> </span><span class=\"s2\">\"oops\"</span>\n</code></pre></div>\n<p>is a bit unwieldy</p>",
        "id": 532171538,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1753997587
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/270676-lean4/topic/RFC.3A.20.60while.20let.60/near/532151203\">said</a>:</p>\n<blockquote>\n<p>isn't it added cognitive complexity that <code>while</code> <em>doesn't</em> accept the same condition syntax as <code>if</code>?</p>\n</blockquote>\n<p>That's at least how it is for me. I want to write <code>while let</code> and then have to think about what the best workaround is. And seeing as <span class=\"user-mention\" data-user-id=\"656225\">@Cameron Zwarich</span> already has a <em>favorite</em> substitute, I'm guessing I'm not the only one <span aria-label=\"smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 532244280,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1754033406
    },
    {
        "content": "<p>But also, changes/extensions to <code>do</code>-notation are being postponed until the implementation of <code>do</code>-notation is reworked, right?</p>",
        "id": 532244525,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1754033489
    },
    {
        "content": "<p>Well, <code>while</code>, <code>repeat</code>, etc. aren't part of do notation; they are just macros for <code>for _ in Lean.Loop.mk do ...</code> so I believe it's not so strict? Not entirely sure though</p>",
        "id": 532259560,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1754038373
    }
]