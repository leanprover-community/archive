[
    {
        "content": "<p>This was probably discussed before but I can’t find it. Is there a reason why <code>fun (⟨x, y⟩ : X × Y) ↦ whatever x y</code> generates <code>fun p ↦ match p with | ⟨x, y⟩ =&gt; whatever x y</code> instead of <code>fun p ↦ whatever p.1 p.2</code>?</p>",
        "id": 546995445,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1761337756
    },
    {
        "content": "<p>Bonus question: does anyone want to have fun writing a simpproc that turns the match version into the other version?</p>",
        "id": 546995521,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1761337793
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/channel/270676-lean4/topic/Destructuring.20in.20function.20definition/near/546995521\">said</a>:</p>\n<blockquote>\n<p>Bonus question: does anyone want to have fun writing a simpproc that turns the match version into the other version?</p>\n</blockquote>\n<p>does <code>dsimp only</code> not work?</p>",
        "id": 546995833,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761337917
    },
    {
        "content": "<p>It does nothing.</p>",
        "id": 546996619,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1761338300
    },
    {
        "content": "<p>that's weird, I remember it doing something for me before</p>",
        "id": 546996795,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761338391
    },
    {
        "content": "<p>In my examples <code>simp only</code> simplifies this <code>match</code>. Do you have an <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a>? E.g., this works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hf</span>\n<span class=\"w\">  </span><span class=\"n\">guard_hyp</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"bp\">ₛ</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 547018871,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1761357333
    },
    {
        "content": "<p><code>dsimp only</code> works in this example too</p>",
        "id": 547019618,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1761358277
    },
    {
        "content": "<p>Sorry about disappearing, I was travelling yesterday. We’re not talking about the same thing. I’m talking about</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">⟨</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">g</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 547122833,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1761477777
    },
    {
        "content": "<p>The <code>simp only</code> does nothing there.</p>",
        "id": 547122847,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1761477785
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">g</span>\n</code></pre></div>\n<p>but <code>simp</code> doesn't change <code>let</code>s</p>",
        "id": 547122913,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761477859
    },
    {
        "content": "<p>I agree, so we need something to fix this issue.</p>",
        "id": 547123456,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1761478348
    },
    {
        "content": "<p>but my example shows that this isn't about function, this is about the behaviour of <code>simp</code> on <code>let</code></p>",
        "id": 547123535,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761478443
    },
    {
        "content": "<p>I understand, but I think there are not so many cases where you want to use <code>let</code> only to immediately wish <code>dsimp</code> could act on it.</p>",
        "id": 547124117,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1761478999
    },
    {
        "content": "<p>I guess, we can have something like <code>simp%</code> and/or <code>dsimp%</code> for these cases.</p>",
        "id": 553268206,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1762111759
    },
    {
        "content": "<p>It still would be nice to be able to use <code>rw</code>, <code>simp</code> etc on the <em>values</em> of <code>let</code>s, even if indeed it usually isn't useful in polished code.</p>",
        "id": 553276692,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1762120408
    },
    {
        "content": "<p>I think the answer to Patrick's original question is that <code>fun</code> patterns are intended to be a very simple wrapper around <code>match</code> syntax</p>",
        "id": 553276721,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1762120453
    },
    {
        "content": "<p>And so without complicating the wrapper, I guess the question is why <code>match p with Prod.mk x y =&gt; f x y</code> isn't syntax for <code>f p.1 p.2</code>.</p>",
        "id": 553276794,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1762120544
    }
]