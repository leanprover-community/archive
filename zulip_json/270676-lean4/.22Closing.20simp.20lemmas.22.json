[
    {
        "content": "<p>This has surely been discussed before. These are <em>closing</em> lemmas and not simp lemmas. The difference is that closing lemmas need a hint about the goal before triggering. This is beyond simp capabilities and also beyond its intended scope. However, it is debatable whether a <code>simp_close</code> tactic should exist since that's just inches away from a full \"sledgehammer\" IMO.</p>",
        "id": 473486540,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727640128
    },
    {
        "content": "<p><code>simp</code> is however able to make use of closing lemmas; they are especially useful when they occur as hypotheses in conditional simp rules because <code>simp</code> calls itself to prove the side goals. Closing lemmas are rewritten to <code>T = True</code> form and simp auto-closes the goal if it is reduced to <code>True</code>.</p>",
        "id": 473486690,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727640303
    },
    {
        "content": "<p>The trouble with adding closing lemmas as simp rules is that it's not really clear where to stop, because it means almost anything could be a simp lemma</p>",
        "id": 473486708,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727640327
    },
    {
        "content": "<p>Mario's trick is a good idea here. I'm always weary of conditional simps because they can be really slow.</p>\n<p>In any case, I think a <code>@[simp_close]</code> attribute to automate the translation process would be a nice addition. Perhaps with general guidance to use sparingly.</p>",
        "id": 473487479,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727641007
    },
    {
        "content": "<p>Lean has had this feature since the Lean 3 days at least for what it's worth, and in mathlib we have been calling such <code>@[simp]</code> lemmas \"simp lemmas\" as far as I've been using Lean.</p>\n<p><strong>Edit:</strong> I moved this thread from <a href=\"#narrow/stream/270676-lean4/topic/Should.20.60getElem_mem.60.20be.20.60.40.5Bsimp.5D.60.3F/near/473492586\">https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should.20.60getElem_mem.60.20be.20.60.40.5Bsimp.5D.60.3F/near/473492586</a> (This is the earliest message where I can give any context)</p>",
        "id": 473487587,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1727641105
    },
    {
        "content": "<p>yeah I don't think we need a separate attribute</p>",
        "id": 473487621,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727641147
    },
    {
        "content": "<p>I think we have historically had general guidance not to use <code>@[simp]</code> much on closing lemmas</p>",
        "id": 473487645,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727641182
    },
    {
        "content": "<p>but we've not really had clear guidance on when it <em>is</em> allowed</p>",
        "id": 473487715,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727641218
    },
    {
        "content": "<p>The idea of the attribute is to do the translation prior to labeling as simp so that the lemma won't trigger as a \"normal\" simp. It's a restriction not an extension.</p>",
        "id": 473487729,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727641227
    },
    {
        "content": "<p>I am not sure what you mean by translation</p>",
        "id": 473487749,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727641250
    },
    {
        "content": "<p>Actually, I was misremembering the lemmas, they are not iffs. Nevermind, they're already \"translated\".</p>",
        "id": 473487915,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727641406
    },
    {
        "content": "<p>The idea of the translation was to take an iff or eq lemma and rewrite it as a conditional simp lemma in the forward direction so that it becomes a closing lemma only.</p>",
        "id": 473488309,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727641748
    },
    {
        "content": "<p><code>simp</code> can use this lemma to simplify <code>l[i] ∈ l</code> to <code>True</code> inside a big formula.</p>",
        "id": 473488316,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1727641756
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"214703\">@Yury G. Kudryashov</span> Normal iff or eq simp lemmas trigger on the lhs. Closing simps trigger on the rhs, which is why they need to be written as conditional simps. (They don't have to be applied last.)</p>",
        "id": 473489486,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727642842
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"119741\">@François G. Dorais</span> Are you talking about an existing Lean feature? I'm sort of confused, because this isn't familiar.</p>",
        "id": 473489583,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1727642934
    },
    {
        "content": "<p>Yury is just explaining what <code>@[simp]</code> does for the lemma this particular thread is about. <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.getElem_mem#doc\">docs#List.getElem_mem</a></p>",
        "id": 473489602,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1727642958
    },
    {
        "content": "<p>Could you provide an <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a> demonstrating what you're talking about, please?</p>",
        "id": 473489681,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1727643025
    },
    {
        "content": "<p>Conditional simps are an existing feature. Sorry for the confusion, my mind digressed to other simp lemmas and I forgot about the three lemmas in question. Indeed, let me clarify with an example, give me a minute...</p>",
        "id": 473489773,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727643118
    },
    {
        "content": "<p>Conditional simps are definitely a feature, but is what you're saying is relevant to Yury's comment?</p>",
        "id": 473490001,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1727643306
    },
    {
        "content": "<p>Ah! Here's one that's been nagging me recently: <code>exists_prop' (p : Prop) : (∃ x, p) ↔ Nonempty α ∧ p</code> is a simp lemma from Lean core. One of my students got surprised by <code>Nonempty</code> after using simp on what everyone thought was a trivial theorem. In the student's case, the final proof after working together ended up being just <code>simp [-exists_prop']; exists ()</code>. (Yes, I do tell my students to avoid nonterminal simps but this one is fine by me.) Removing <code>exists_prop'</code> from simp made the result <code>∃ x, True</code>, which is trivial to deal with even without assistance from me. Admittedly, <code>exists_prop'</code> is not that useful in closing form because of the <code>∧ p</code> but I think it illustrates the basic idea.</p>\n<p>Another one is <code>Bool.eq_iff_iff</code>. This is (thankfully!) not a simp lemma. However, it could be very useful as a closing lemma. (I'm not currently proposing this, closing lemmas should be used sparingly and I haven't investigated this one seriously.)</p>",
        "id": 473491178,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727644345
    },
    {
        "content": "<p>(Perhaps I misunderstood Yuri, but I read his comment as confusion about the term \"closing\". I assumed he interpreted closing as \"applied last\" and therefore could not be used in the middle of a formula. This is not what closing means in this case, which I clarified.)</p>",
        "id": 473491834,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727644987
    },
    {
        "content": "<p>I don't understand the relationship between your first paragraph and closing simp lemmas</p>",
        "id": 473491935,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727645090
    },
    {
        "content": "<p>If <code>exists_prop'</code> is a <code>simp</code> lemma, then we should have a <code>simp</code> lemma simplifying <code>Nonempty α</code> to <code>True</code> or <code>False</code>, if we have <code>[Nonempty α]</code> or <code>[IsEmpty α]</code>, resp.</p>",
        "id": 473491998,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1727645162
    },
    {
        "content": "<p>But IMHO this isn't relevant to the original topic.</p>",
        "id": 473492072,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1727645180
    },
    {
        "content": "<p>I think perhaps the terminology \"closing simp lemma\" (which <a href=\"#narrow/stream/270676-lean4/topic/Should.20.60getElem_mem.60.20be.20.60.40.5Bsimp.5D.60.3F/near/473486540\">you introduced earlier</a>) should be avoided here, because these aren't necessarily related to closing the goal. I would describe them as \"non-equality simp lemmas\", which are automatically rewritten to equalities using the <code>T = True</code> trick as I mentioned.</p>",
        "id": 473492125,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727645244
    },
    {
        "content": "<p>It's the first thing that came to mind but there's no reason for <code>exists_prop'</code> to trigger in every case of the lhs. This is only useful when there's a <code>Nonempty</code> instance lurking. (Admittedly, this is not exactly \"closing\".)</p>",
        "id": 473492193,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727645306
    },
    {
        "content": "<p>I'm not sure I agree on that, the RHS is simpler in that it breaks a dependency and allows <code>p</code> to be a separate conjunct and eliminates a vacuous quantifier</p>",
        "id": 473492224,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727645375
    },
    {
        "content": "<p>I would also like <code>\\exists x : A, True</code> to be simplified to <code>Nonempty A</code>, as it says the same thing with fewer moving parts</p>",
        "id": 473492347,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727645448
    },
    {
        "content": "<p>Let me repeat that this example is irrelevant to the original topic. I suggest to stick to the topic here and open a new thread, if we want to discuss something else.</p>",
        "id": 473492358,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1727645463
    },
    {
        "content": "<p>I don't remember where I got the term from. I don't think I like it anymore <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span> The idea is a simp-like lemma that triggers on the rhs instead of the lhs. This is realized in Lean in the form of conditional simp lemmas, as you explained.</p>",
        "id": 473492448,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727645531
    },
    {
        "content": "<p>can you give an example of that?</p>",
        "id": 473492489,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727645580
    },
    {
        "content": "<p>there is no such thing currently</p>",
        "id": 473492500,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727645588
    },
    {
        "content": "<p>simp lemmas are always equalities of the form <code>conditions -&gt; lhs = rhs</code> (or rewritten to this form) where <code>lhs</code> is replaced by <code>rhs</code> if <code>conditions</code> are recursively simp-provable</p>",
        "id": 473492569,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727645644
    },
    {
        "content": "<p>33 messages were moved here from <a class=\"stream-topic\" data-stream-id=\"270676\" href=\"/#narrow/stream/270676-lean4/topic/Should.20.02klzzwxh.3A0000.03.20be.20.02klzzwxh.3A0001.03.3F\">#lean4 &gt; Should <code>getElem_mem</code> be <code>@[simp]</code>?</a> by <span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span>.</p>",
        "id": 473492585,
        "sender_full_name": "Notification Bot",
        "timestamp": 1727645674
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> !</p>",
        "id": 473492631,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727645735
    },
    {
        "content": "<p>First, let me apologize for the original mistake. When I realized the three lemmas in question were closing lemmas, I quickly forgot what the lemmas actually were and the discussion diverged quickly after that.</p>",
        "id": 473492775,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727645852
    },
    {
        "content": "<p>To be clear, the \"closing translation\" is from <code>P ↔ Q</code> to <code>P → Q</code>, or equivalently to <code>(h : P) : Q = True</code> in proper simp form. The difference is that as a simp lemma <code>P ↔ Q</code> triggers on <code>P</code> but <code>(h : P) : Q = True</code> triggers on <code>Q</code>.</p>",
        "id": 473493043,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727646081
    },
    {
        "content": "<p>The <code>@[simp_close]</code> suggestion above was to mark a <code>P ↔ Q</code> lemma with <code>@[simp_close]</code> would cause an automatically generated lemma <code>(h : P) : Q = True</code> to be marked as <code>@[simp]</code>.</p>",
        "id": 473493227,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727646254
    },
    {
        "content": "<p>I hope this is clearer.</p>",
        "id": 473493256,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727646300
    },
    {
        "content": "<p>aren't there two versions of that rule? you could also have <code>Q -&gt; P</code> as a simp rule</p>",
        "id": 473493273,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727646308
    },
    {
        "content": "<p>Yes, but simp lemmas are left to right.</p>",
        "id": 473493291,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727646337
    },
    {
        "content": "<p>which is not the same as <code>P &lt;-&gt; Q</code>, it rewrites <code>P</code> only if <code>Q</code> is provable</p>",
        "id": 473493292,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727646338
    },
    {
        "content": "<p>Having both as simp lemmas is probably a bad idea.</p>",
        "id": 473493393,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727646372
    },
    {
        "content": "<p>I don't see any reason we would want to do either of these translations</p>",
        "id": 473493400,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727646386
    },
    {
        "content": "<p>if you want to use the rhs instead of the lhs, just turn the rule around to <code>Q &lt;-&gt; P</code></p>",
        "id": 473493423,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727646412
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/270676-lean4/topic/.22Closing.20simp.20lemmas.22/near/473493292\">said</a>:</p>\n<blockquote>\n<p>which is not the same as <code>P &lt;-&gt; Q</code>, it rewrites <code>P</code> only if <code>Q</code> is provable</p>\n</blockquote>\n<p>Yes, that's the point! It's a restriction.</p>",
        "id": 473493428,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727646417
    },
    {
        "content": "<p>Surely you don't want something like <code>l ≠ [] ↔ getLast l h ∈ l</code> to be a simp lemma. It needs to be <code>(h : l ≠ []) : getLast l h ∈ l</code>. (Actually, this one doesn't make sense but you get the idea...)</p>",
        "id": 473493864,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727646810
    },
    {
        "content": "<p>the former doesn't typecheck, it has an unbound <code>h</code></p>",
        "id": 473493981,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727646907
    },
    {
        "content": "<p>if it didn't have that <code>h</code> argument, it would be a reasonable simp lemma in the opposite direction</p>",
        "id": 473494015,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727646947
    },
    {
        "content": "<p>Is your point that simp-like lemmas that trigger on the rhs are disguised simps in the reverse direction? That's a fair point but I don't think it's true.</p>",
        "id": 473494158,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727647077
    },
    {
        "content": "<p>I think the weakening has a real effect.</p>",
        "id": 473494249,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727647193
    },
    {
        "content": "<p>it has an effect but I'm not clear on when we want that effect</p>",
        "id": 473494392,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727647309
    },
    {
        "content": "<p>simp lemmas never \"trigger on the rhs\", by definition. We put the trigger on the left to express what the trigger is</p>",
        "id": 473494458,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727647357
    },
    {
        "content": "<p>Like I said, that effect is not what simp is really about. It's only after your first comment that I suddenly realized that Lean simp does fully support such lemmas but only when translated as conditional simps.</p>\n<p>The context where I learned about such lemmas was while learning about \"sledgehammer\" tactics, which aim to do a lot more than just simp. Of course, within such a broader tactic, the use of such lemmas is carefully managed, unlike Lean simp.</p>",
        "id": 473495194,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727647871
    },
    {
        "content": "<p>simp performs poorly if it has too many levels of nested discharging to do</p>",
        "id": 473495430,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727648048
    },
    {
        "content": "<p>it's not a replacement for backtracking search over intro lemmas</p>",
        "id": 473495437,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727648058
    },
    {
        "content": "<p>which is why I think it's a good idea to limit the number and composability of available conditional lemmas</p>",
        "id": 473495483,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727648121
    },
    {
        "content": "<p>Exactly, that's why such \"closing simp\" are not always a good idea and also the underlying reason why the three simp lemmas originally discussed have a questionable aspect to them.</p>\n<p>Are we just circling back to the top now?</p>",
        "id": 473495739,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727648368
    },
    {
        "content": "<p>I only skimmed this thread, but my quick takeaway was that there's nothing actionable so far about particular lemmas. Please ping me if that is or becomes incorrect.</p>",
        "id": 473495788,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1727648403
    },
    {
        "content": "<p>You're right <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span>, this discussion digressed long ago. The start is that these three lemmas are simp lemmas of a special kind (formerly known as \"closing lemmas\" in this discussion) and I thought it might be useful for simp to distinguish these from regular simp lemmas. Everything after that is a mess...</p>",
        "id": 473495978,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727648599
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"119741\">@François G. Dorais</span> It loks to me that you continue talking about some hypothetic scenarios without giving specific examples.</p>",
        "id": 473496317,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1727648884
    },
    {
        "content": "<p>When I tried to give real life examples you said they had nothing to do with the original three lemmas (which is true). <span aria-label=\"shrug\" class=\"emoji emoji-1f937\" role=\"img\" title=\"shrug\">:shrug:</span></p>",
        "id": 473496524,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727649048
    },
    {
        "content": "<p>I said they had nothing to do with \"closing simp lemmas\" which is what I thought was the topic of the (sidebar) discussion</p>",
        "id": 473497313,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727649727
    },
    {
        "content": "<p>(Mixed references I think: I was talking about <a href=\"#narrow/stream/270676-lean4/topic/.22Closing.20simp.20lemmas.22/near/473492358\">Yuri's comment</a> not yours.) (Sorry I originally linked the wrong comment.)</p>",
        "id": 473497745,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727649906
    },
    {
        "content": "<p>FWIW, the more useful form of <code>exists_prop'</code> is probably something like <code>[Nonempty α] (h : ∃ x : α, p) : p</code>.</p>",
        "id": 473498877,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727650202
    },
    {
        "content": "<p>I used to be very strict about what a good simp lemma is, but I've relaxed quite a bit due to overwhelming evidence that laxness actually pays off. Originally, if a simp lemma introduced a new constant on the rhs that would raise a yellow flag, not quite a red flag but a flag nonetheless. Today, I would probably let <code>exists_prop'</code> pass if it came up for review but I think my old behavior was not ill-founded in this case.</p>",
        "id": 473499517,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727650487
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span>: I think the correct form of <code>exists_prop'</code> is as a \"closing simp lemma\". As a plain simp lemma, it introduces <code>Nonempty</code> where there is no contextual reason to do that.</p>",
        "id": 473499782,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727650734
    },
    {
        "content": "<p><code>Nonempty</code> to me is just the \"unary version\" of <code>Exists</code>. if you don't have a predicate then that's what you should be using instead of adding a dummy <code>True</code> in there</p>",
        "id": 473499902,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727650826
    },
    {
        "content": "<p>of course if you can simplify the <code>Nonempty</code> away then great, but this can be done with a separate simp lemma</p>",
        "id": 473500023,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727650899
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"119741\">François G. Dorais</span> <a href=\"#narrow/stream/270676-lean4/topic/.22Closing.20simp.20lemmas.22/near/473498877\">said</a>:</p>\n<blockquote>\n<p>FWIW, the more useful form of <code>exists_prop'</code> is probably something like <code>[Nonempty α] (h : ∃ x : α, p) : p</code>.</p>\n</blockquote>\n<p>Even if we said that <code>Nonempty</code> shouldn't be appearing, this is not at all a good simp lemma, it makes the goal worse (introducing a spurious quantifier in a discharge subgoal which will go nowhere) and applies to everything. It should instead be <code>[Nonempty α] : (∃ x : α, p) &lt;-&gt; p</code></p>",
        "id": 473500147,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727651040
    },
    {
        "content": "<p>I don't think it's a big deal. If <em>I</em> unexpectedly encounter <code>Nonempty</code>, I know exactly what to do. My students didn't know about <code>Nonempty</code> (mostly because it was never relevant). Reducing to <code>∃ _, True</code> would have been obvious to them. The new constant was the issue.</p>",
        "id": 473500205,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727651068
    },
    {
        "content": "<p>yes, this is a teaching issue. But this is just one of the things that comes up due to the fact that lean isn't designed out of the box for teaching applications</p>",
        "id": 473500247,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727651115
    },
    {
        "content": "<p>Indeed, \"something like\".</p>",
        "id": 473500252,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727651127
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/270676-lean4/topic/.22Closing.20simp.20lemmas.22/near/473500247\">said</a>:</p>\n<blockquote>\n<p>yes, this is a teaching issue. But this is just one of the things that comes up due to the fact that lean isn't designed out of the box for teaching applications</p>\n</blockquote>\n<p>I disagree, this is an \"onboarding issue\". This is my research group: they're young, inexperienced and I need to manage them with extra care but next year they're working an actual job...</p>",
        "id": 473500453,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727651303
    },
    {
        "content": "<p>I think you should teach them about <code>Nonempty</code> if and when it comes up</p>",
        "id": 473500661,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727651438
    },
    {
        "content": "<p>the concept isn't that hard to grasp, and on the contrary it helps clarify something that can be a confusing point: it is not the case that <code>\\forall x, p</code> and <code>\\exists x, p</code> are equivalent to <code>p</code> even though some people might have seen this claimed in logic textbooks, because in lean not all types are nonempty</p>",
        "id": 473500794,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727651513
    },
    {
        "content": "<p>I did teach them about <code>Nonempty</code> but it didn't need to come up in this case at all. This isn't a math project. We could have arranged for a <code>Nonempty</code> instance but it would only be used in this one theorem. I honestly think <code>exists_prop'</code> is not useful unless there's a <code>Nonempty</code> instance floating around.</p>",
        "id": 473500967,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727651621
    },
    {
        "content": "<p>wasn't your example about unit?</p>",
        "id": 473501068,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727651650
    },
    {
        "content": "<p>there is a nonempty instance floating around in that case</p>",
        "id": 473501096,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727651668
    },
    {
        "content": "<p>No, it was defeq to unit but not reducible.</p>",
        "id": 473501110,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727651673
    },
    {
        "content": "<p>what kind of problem are you giving your students?</p>",
        "id": 473501144,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727651697
    },
    {
        "content": "<p>This is about program verification, not maths. It's a bit different...</p>",
        "id": 473501199,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727651743
    },
    {
        "content": "<p>with <code>use</code> you could still prove it even if it says <code>Nonempty</code> instead of <code>Exists</code>. I'm not so sure about the <code>exists</code> tactic, I basically never use it</p>",
        "id": 473501310,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727651772
    },
    {
        "content": "<p>but if you want to hide this lemma from your students, just disable it</p>",
        "id": 473501368,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727651802
    },
    {
        "content": "<p>There's historical reasons for that, I started using Lean 4 with my students before the first milestone was released... There is a lot of legacy stuff lying around that I never got around to fixing.</p>",
        "id": 473501457,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727651860
    },
    {
        "content": "<p>That's why I need a strong Batteries!</p>",
        "id": 473501504,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727651877
    },
    {
        "content": "<p>(Actually, that's incorrect. I only introduced my students to Lean 4 a few weeks after the first milestone. But I had been dabbling with Lean 4 for a few months at that point.)</p>",
        "id": 473501905,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727652114
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/270676-lean4/topic/.22Closing.20simp.20lemmas.22/near/473501368\">said</a>:</p>\n<blockquote>\n<p>but if you want to hide this lemma from your students, just disable it</p>\n</blockquote>\n<p>That would mean I thought it was <em>never</em> useful, which is not the case. I just don't think this is the best simp lemma for the purpose it tries to serve.</p>",
        "id": 473507140,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727654317
    },
    {
        "content": "<p>the alternatives you have suggested are strictly weaker in proving power, so setting aside the teaching issues that doesn't sound like a good tradeoff</p>",
        "id": 473507337,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727654396
    },
    {
        "content": "<p>if you want alternative simp lemmas for your class you can do that</p>",
        "id": 473507475,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727654421
    },
    {
        "content": "<p>As I've been saying the whole time, the point is to <em>restrict</em> them so they don't apply unless its actually useful. I don't think this has to reduce the proving power, there might be a need for a few more lemmas to get to the same point but odds are these are already simp anyway.</p>\n<p>Also, they are students but this is not a class, it's a research group: they are working with real Lean in a real context. (I do provide extra libraries but these are to add functionality that doesn't yet exist in Lean or Batteries. True, we don't use Mathlib, but mostly because it's huge and irrelevant to what we're doing.)</p>",
        "id": 473509551,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727655019
    },
    {
        "content": "<p>I just did an experiment, I deleted <code>exists_prop'</code> entirely and added your suggestion <code>@[simp] theorem elab_prop'' [Nonempty α] : (∃ x : α, p) &lt;-&gt; p</code>.  Only <code>List.exists_mem_cons</code> failed from core (which is not a simp lemma but the proof is <code>by simp</code>). Batteries had no errors with this modified toolchain. I didn't (and I won't) check Mathlib with this toolchain but I suspect <code>exists_prop'</code> is not that important there either.</p>",
        "id": 473515103,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727657976
    },
    {
        "content": "<p>Actually, I got the same outcome deleting <code>elab_prop'</code> without adding <code>elab_prop''</code> so maybe this is just not that useful a lemma and we shouldn't spend more time thinking about it.</p>",
        "id": 473516863,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727658425
    },
    {
        "content": "<p>After thinking about this for awhile, I think it makes sense making <code>exists_prop'</code> not a simp lemma but adding <code>exists_prop''</code> as a simp lemma. I wouldn't support having neither of them be simp lemmas though.</p>\n<p>But, it turns out core already has it as <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=exists_const#doc\">docs#exists_const</a>, and it's a simp lemma. Easiest then would be to remove simp from <code>exists_prop'</code></p>",
        "id": 473520593,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1727659758
    },
    {
        "content": "<p>I agree that it seems unlikely that simp could ever ever prove <code>Nonempty</code> if it's not already an instance.</p>",
        "id": 473520850,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1727659944
    },
    {
        "content": "<p>(Let's see if anything fails: <a href=\"https://github.com/leanprover/lean4/pull/5529\">lean4#5529</a>. <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span>, what do you think about removing simp from this lemma? On one hand, it replaces exists with and, which is generally good, but on the other it's not clear that simp would ever be able to prove <code>Nonempty</code> without it being an instance.)</p>",
        "id": 473521376,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1727660319
    },
    {
        "content": "<p>Theoretically, <code>simp</code> reduce <code>Nonempty (Fin n)</code> to <code>n ≠ 0</code>, then prove it without <code>NeZero n</code>.</p>",
        "id": 473521910,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1727660730
    },
    {
        "content": "<p>I don't know if it ever happens.</p>",
        "id": 473521926,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1727660740
    },
    {
        "content": "<p>And our <code>simp</code> set isn't designed for this.</p>",
        "id": 473521944,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1727660761
    },
    {
        "content": "<p>even if simp can't prove it, it can still leave it as a subgoal</p>",
        "id": 473612940,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727679673
    },
    {
        "content": "<p>I think the discussion around <a href=\"#narrow/stream/270676-lean4/topic/The.20result.20of.20simp.3F.20gives.20a.20different.20result.20to.20simp/near/469315671\">https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/The.20result.20of.20simp.3F.20gives.20a.20different.20result.20to.20simp/near/469315671</a> might be relevant, since the question of <code>exists_prop'</code> being <code>simp</code> also appears there.</p>",
        "id": 473675947,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1727691897
    }
]