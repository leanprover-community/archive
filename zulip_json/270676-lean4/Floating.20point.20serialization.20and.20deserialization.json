[
    {
        "content": "<p>I am making a library for fast floating point serialization and deserialization (via <code>ryu</code> and <code>fast_float</code>):</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">def</span> <span class=\"n\">FloatFormat.scientific</span>     <span class=\"o\">:</span> <span class=\"n\">USize</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"o\">:</span> <span class=\"n\">USize</span><span class=\"o\">)</span> <span class=\"bp\">&lt;&lt;&lt;</span> <span class=\"mi\">0</span>\n<span class=\"kd\">def</span> <span class=\"n\">FloatFormat.fixed</span>          <span class=\"o\">:</span> <span class=\"n\">USize</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"o\">:</span> <span class=\"n\">USize</span><span class=\"o\">)</span> <span class=\"bp\">&lt;&lt;&lt;</span> <span class=\"mi\">2</span>\n<span class=\"kd\">def</span> <span class=\"n\">FloatFormat.hex</span>            <span class=\"o\">:</span> <span class=\"n\">USize</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"o\">:</span> <span class=\"n\">USize</span><span class=\"o\">)</span> <span class=\"bp\">&lt;&lt;&lt;</span> <span class=\"mi\">3</span>\n<span class=\"kd\">def</span> <span class=\"n\">FloatFormat.no_infnan</span>      <span class=\"o\">:</span> <span class=\"n\">USize</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"o\">:</span> <span class=\"n\">USize</span><span class=\"o\">)</span> <span class=\"bp\">&lt;&lt;&lt;</span> <span class=\"mi\">4</span>\n<span class=\"kd\">def</span> <span class=\"n\">FloatFormat.json_fmt</span>       <span class=\"o\">:</span> <span class=\"n\">USize</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"o\">:</span> <span class=\"n\">USize</span><span class=\"o\">)</span> <span class=\"bp\">&lt;&lt;&lt;</span> <span class=\"mi\">5</span>\n<span class=\"kd\">def</span> <span class=\"n\">FloatFormat.fortran_fmt</span>    <span class=\"o\">:</span> <span class=\"n\">USize</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"o\">:</span> <span class=\"n\">USize</span><span class=\"o\">)</span> <span class=\"bp\">&lt;&lt;&lt;</span> <span class=\"mi\">6</span>\n<span class=\"kd\">def</span> <span class=\"n\">FloatFormat.json</span>           <span class=\"o\">:</span> <span class=\"n\">USize</span> <span class=\"o\">:=</span>\n  <span class=\"n\">FloatFormat.json_fmt</span> <span class=\"bp\">|||</span> <span class=\"n\">FloatFormat.scientific</span> <span class=\"bp\">|||</span> <span class=\"n\">FloatFormat.fixed</span> <span class=\"bp\">|||</span> <span class=\"n\">FloatFormat.no_infnan</span>\n<span class=\"kd\">def</span> <span class=\"n\">FloatFormat.json_or_infnan</span> <span class=\"o\">:</span> <span class=\"n\">USize</span> <span class=\"o\">:=</span>\n  <span class=\"n\">FloatFormat.json_fmt</span> <span class=\"bp\">|||</span> <span class=\"n\">FloatFormat.scientific</span> <span class=\"bp\">|||</span> <span class=\"n\">FloatFormat.fixed</span>\n<span class=\"kd\">def</span> <span class=\"n\">FloatFormat.fortran</span>        <span class=\"o\">:</span> <span class=\"n\">USize</span> <span class=\"o\">:=</span>\n  <span class=\"n\">FloatFormat.fortran_fmt</span> <span class=\"bp\">|||</span> <span class=\"n\">FloatFormat.scientific</span> <span class=\"bp\">|||</span> <span class=\"n\">FloatFormat.fixed</span>\n<span class=\"kd\">def</span> <span class=\"n\">FloatFormat.general</span>        <span class=\"o\">:</span> <span class=\"n\">USize</span> <span class=\"o\">:=</span>\n  <span class=\"n\">FloatFormat.scientific</span> <span class=\"bp\">|||</span> <span class=\"n\">FloatFormat.fixed</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">extern</span> <span class=\"s2\">\"lean_hovercraft_string_to_float\"</span><span class=\"kd\">]</span>\n<span class=\"n\">opaque</span> <span class=\"n\">String.toFloat</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">String</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">format</span> <span class=\"o\">:</span> <span class=\"n\">USize</span> <span class=\"o\">:=</span> <span class=\"n\">FloatFormat.general</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Float</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">extern</span> <span class=\"s2\">\"lean_hovercraft_string_to_float_delimited\"</span><span class=\"kd\">]</span>\n<span class=\"n\">opaque</span> <span class=\"n\">String.toFloatArray</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">String</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">format</span> <span class=\"o\">:</span> <span class=\"n\">USize</span> <span class=\"o\">:=</span> <span class=\"n\">FloatFormat.general</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">FloatArray</span>\n\n\n<span class=\"kd\">@[</span><span class=\"n\">extern</span> <span class=\"s2\">\"lean_hovercraft_float_to_string_finite\"</span><span class=\"kd\">]</span>\n<span class=\"n\">opaque</span> <span class=\"n\">Float.toStringFinite</span> <span class=\"o\">:</span> <span class=\"n\">Float</span> <span class=\"bp\">→</span> <span class=\"n\">String</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">extern</span> <span class=\"s2\">\"lean_hovercraft_float_to_string_infinite\"</span><span class=\"kd\">]</span>\n<span class=\"n\">opaque</span> <span class=\"n\">Float.toStringInfinite</span> <span class=\"o\">:</span> <span class=\"n\">Float</span> <span class=\"bp\">→</span> <span class=\"n\">String</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">extern</span> <span class=\"s2\">\"lean_hovercraft_string_push_float_finite\"</span><span class=\"kd\">]</span>\n<span class=\"n\">opaque</span> <span class=\"n\">String.pushFloatFinite</span> <span class=\"o\">:</span> <span class=\"n\">String</span> <span class=\"bp\">→</span> <span class=\"n\">Float</span> <span class=\"bp\">→</span> <span class=\"n\">String</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">extern</span> <span class=\"s2\">\"lean_hovercraft_string_push_float_infinite\"</span><span class=\"kd\">]</span>\n<span class=\"n\">opaque</span> <span class=\"n\">String.pushFloatInfinite</span> <span class=\"o\">:</span> <span class=\"n\">String</span> <span class=\"bp\">→</span> <span class=\"n\">Float</span> <span class=\"bp\">→</span> <span class=\"n\">String</span>\n</code></pre></div>",
        "id": 400265036,
        "sender_full_name": "Schrodinger ZHU Yifan",
        "timestamp": 1699082623
    }
]