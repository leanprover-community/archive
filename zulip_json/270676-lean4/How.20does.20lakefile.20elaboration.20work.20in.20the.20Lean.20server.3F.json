[
    {
        "content": "<p>If I paste</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lake</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">DSL</span>\n\n<span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n</code></pre></div>\n<p>into the web editor, or any file not called <code>lakefile.lean</code>, I get the error</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>elaboration function for `Lake.DSL.packageCommand` has not been implemented\n</code></pre></div>\n<p>Where is the code that special-cases <code>lakefile.lean</code> in the lean server, and what does it do in order to provide these missing elaborators?</p>",
        "id": 565063323,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1766433779
    },
    {
        "content": "<p>The relevent special case is <a href=\"https://github.com/leanprover/lean4/blob/f6a25b13b956728f9b580775e815107bbb0b0b7a/src/lake/Lake/CLI/Serve.lean#L51-L56\">here</a>.</p>",
        "id": 565095155,
        "sender_full_name": "Mac Malone",
        "timestamp": 1766461862
    },
    {
        "content": "<p>For configuration files, Lake loads Lake as an elaboration plugin, which enables the Lake DSL (as the DSL is all builtin macros/elaborators/initializers now).</p>",
        "id": 565095194,
        "sender_full_name": "Mac Malone",
        "timestamp": 1766461906
    },
    {
        "content": "<p>I guess this is a plugin to keep the Lean binary itself lighter-weight?</p>",
        "id": 565095217,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1766461940
    },
    {
        "content": "<p>Yes, and the DSL is builtin to avoid staging issues in Lake.</p>",
        "id": 565095256,
        "sender_full_name": "Mac Malone",
        "timestamp": 1766461984
    }
]