[
    {
        "content": "<p>The following declaration throws an error on latest mathlib, but is accepted without <code>noncomputable</code> on mathlib stable:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"n\">CommAlgCat</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">MorphismProperty</span><span class=\"bp\">.</span><span class=\"n\">Comma</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">AlgebraicGeometry</span><span class=\"bp\">.</span><span class=\"n\">GammaSpecAdjunction</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Q</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MorphismProperty</span><span class=\"w\"> </span><span class=\"n\">CommRingCat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CommRingCat</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">})</span>\n\n<span class=\"c1\">-- noncomputable</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">CommRingCat</span><span class=\"bp\">.</span><span class=\"n\">Under</span><span class=\"bp\">.</span><span class=\"n\">inclusion</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">MorphismProperty</span><span class=\"bp\">.</span><span class=\"n\">Under</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"w\"> </span><span class=\"bp\">⊤</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">⥤</span><span class=\"w\"> </span><span class=\"n\">Under</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">MorphismProperty</span><span class=\"bp\">.</span><span class=\"n\">Under</span><span class=\"bp\">.</span><span class=\"n\">forget</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"w\"> </span><span class=\"bp\">⊤</span><span class=\"w\"> </span><span class=\"n\">R</span>\n</code></pre></div>\n<p>The error messages is very strange, because the declaration <code>AlgebraicGeometry.LocallyRingedSpace.SpecΓIdentity</code> does not feature anywhere in the definition:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">compile</span><span class=\"w\"> </span><span class=\"n\">definition</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">compiler</span><span class=\"w\"> </span><span class=\"n\">IR</span><span class=\"w\"> </span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">CommRingCat</span><span class=\"bp\">.</span><span class=\"n\">Under</span><span class=\"bp\">.</span><span class=\"n\">inclusion</span><span class=\"bp\">._</span><span class=\"n\">redArg</span><span class=\"bp\">._</span><span class=\"n\">closed_0'</span><span class=\"bp\">.</span>\n<span class=\"n\">Error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">depends</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">declaration</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Functor</span><span class=\"bp\">.</span><span class=\"n\">id</span><span class=\"bp\">._</span><span class=\"n\">at_</span><span class=\"bp\">.</span><span class=\"n\">AlgebraicGeometry</span><span class=\"bp\">.</span><span class=\"n\">LocallyRingedSpace</span><span class=\"bp\">.</span><span class=\"n\">SpecΓIdentity</span><span class=\"bp\">.</span><span class=\"n\">spec_0'</span><span class=\"o\">,</span>\n<span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">executable</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">consider</span><span class=\"w\"> </span><span class=\"n\">marking</span><span class=\"w\"> </span><span class=\"n\">definition</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"kn\">noncomputable</span><span class=\"bp\">'</span>\n</code></pre></div>\n<p>The error vanishes if the (unused) <code>Mathlib.AlgebraicGeometry.GammaSpecAdjunction</code> import is removed.<br>\n(<span class=\"user-mention\" data-user-id=\"656225\">@Cameron Zwarich</span>)</p>",
        "id": 526905154,
        "sender_full_name": "Christian Merten",
        "timestamp": 1751508956
    },
    {
        "content": "<p>This is fixed by <a href=\"https://github.com/leanprover/lean4/pull/8691\">lean4#8691</a>, which should be in an upcoming v4.22.0 rc3.</p>",
        "id": 526907079,
        "sender_full_name": "Cameron Zwarich",
        "timestamp": 1751510854
    },
    {
        "content": "<p>Great, thanks!</p>",
        "id": 526907094,
        "sender_full_name": "Christian Merten",
        "timestamp": 1751510870
    }
]