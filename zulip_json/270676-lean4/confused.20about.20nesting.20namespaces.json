[
    {
        "content": "<p>If I have the following in one file</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Chapter2_</span>\n\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">  The type of formulas.</span>\n<span class=\"sd\">-/</span>\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">false_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">true_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">atom_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">or_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">imp_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">iff_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">Inhabited</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">DecidableEq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Repr</span>\n</code></pre></div>\n<p>and I import it into a file containing this</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Chapter2_</span>\n\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n\n<span class=\"bp\">...</span><span class=\"n\">code</span><span class=\"bp\">...</span>\n</code></pre></div>\n<p>Can I make the code that follows <code>open Formula_</code> belong to an additional nested namespace under <code>Chapter2_</code> called <code>Prop_</code> without making changes to that code? That is, make the code in the first file just in the namespace <code>Chapter2_</code> and the code in the second file in the namespace <code>Chapter2_.Prop_</code>? I tried adding <code>namespace Prop_</code> in various locations in the second file, but it seems to break the code that follows it. I think maybe I'm confused about how namespaces work. My thought was that everything under <code>namespace blah</code> essentially gets <code>blah.</code> prepended to it.</p>",
        "id": 498933149,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1739252775
    },
    {
        "content": "<p>If you add <code>namespace Prop_</code> anywhere after <code>namespace Chapter2_</code>, then the code that follows will be in the <code>Chapter2_.Prop_</code> namespace.</p>\n<p>You can use the <code>#where</code> command to see where you are</p>",
        "id": 498933833,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1739253195
    },
    {
        "content": "<p>If I do this</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Chapter2_</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Prop_</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n</code></pre></div>\n<p>and later on have</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"bp\">.</span><span class=\"n\">is_tautology</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Valuation</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">satisfies</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"n\">F</span>\n</code></pre></div>\n<p>and then</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">is_logical_consequence</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"bp\">.</span><span class=\"n\">imp_</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">is_tautology</span>\n</code></pre></div>\n<p>the last gives</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>invalid field 'is_tautology', the environment does not contain 'Chapter2_.Formula_.is_tautology'\n  P.imp_ Q\nhas type\n  Formula_\n</code></pre></div>",
        "id": 498934214,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1739253438
    },
    {
        "content": "<p>why does the last not see it as <code>Chapter2_.Prop_.Formula_.is_tautology</code>?</p>",
        "id": 498934452,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1739253596
    },
    {
        "content": "<p>If you define <code>Formula_.is_tautology</code> inside this nested namespace, you've defined <code>Chapter2_.Prop_.Formula_.is_tautology</code>, but dot notation is looking in the namespace for <code>Formula_</code>, which is <code>Chapter2_.Formula</code>.</p>",
        "id": 498934674,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1739253696
    },
    {
        "content": "<p>If you want to use dot notation, you'll have to define <code>is_tautology</code> in that namespace.</p>",
        "id": 498934714,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1739253718
    },
    {
        "content": "<p>You should see that <code>is_tautology (P.imp_ Q)</code> is fine, since it'll find <code>is_tautology</code> in the current namespace.</p>",
        "id": 498934817,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1739253745
    },
    {
        "content": "<p>I see. Thank you.</p>",
        "id": 498935327,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1739254055
    },
    {
        "content": "<p>Hmm. It seems I need to do <code>Formula_.is_tautology (P.imp_ Q)</code>.</p>",
        "id": 498936124,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1739254531
    },
    {
        "content": "<p>Oh right, I forgot you defined it as that. Yes, that's expected.</p>",
        "id": 498936228,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1739254577
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"354934\">@David Thrane Christiansen</span> has a <code>defmethod</code> macro for being able to define functions meant to be used with dot notation from within another namespace. This would be convenient here! (<a href=\"https://github.com/leanprover/verso/blob/91d124285fd99be006c508cd40bc2df370255bf7/src/verso/Verso/Method.lean#L13-L64\">code</a>)</p>",
        "id": 498936447,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1739254707
    },
    {
        "content": "<p>Oh? That would be nice!</p>",
        "id": 498936561,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1739254793
    },
    {
        "content": "<p>That file I linked is self-contained, and you could drop it into your project.</p>",
        "id": 498936635,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1739254822
    },
    {
        "content": "<p>Should I try to import the project?</p>",
        "id": 498936898,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1739254976
    },
    {
        "content": "<p>I guess it seems a little odd to copy the file.</p>",
        "id": 498936986,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1739255030
    },
    {
        "content": "<p>Is there a chance the macro might get moved into something like mathlib?</p>",
        "id": 498937178,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1739255145
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/270676-lean4/topic/confused.20about.20nesting.20namespaces/near/498936447\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"354934\">David Thrane Christiansen</span> has a <code>defmethod</code> macro for being able to define functions meant to be used with dot notation from within another namespace. This would be convenient here! (<a href=\"https://github.com/leanprover/verso/blob/91d124285fd99be006c508cd40bc2df370255bf7/src/verso/Verso/Method.lean#L13-L64\">code</a>)</p>\n</blockquote>\n<p>Oh! That would have been great for <span class=\"user-mention\" data-user-id=\"697518\">@Hannah Scholz</span> in <a href=\"https://github.com/leanprover-community/mathlib4/pull/19760\">#19760</a></p>",
        "id": 498937264,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1739255182
    },
    {
        "content": "<p>Copying the file is what I'd do. Verso is a relatively large dependency for just this feature.</p>\n<p>The risk is if Lean changes and it needs fixing, you wouldn't be able to just update the dependency. However, if you keep track of the source of the file, you can manually update it.</p>\n<p>\"Vendoring dependencies\" is an age-old development method.</p>",
        "id": 498937348,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1739255232
    },
    {
        "content": "<p>I'll mention that an alternative (and what mathlib does) is instead either (1) manage carefully which namespace you're in or (2) use <code>_root_</code> like so to temporarily go back to the root namespace:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">root_</span><span class=\"bp\">.</span><span class=\"n\">Chapter2_</span><span class=\"bp\">.</span><span class=\"n\">Formula_</span><span class=\"bp\">.</span><span class=\"n\">is_tautology</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Valuation</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">satisfies</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"n\">F</span>\n</code></pre></div>",
        "id": 498937545,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1739255359
    },
    {
        "content": "<p>Hmm. I'm not sure how to apply this here. There are two different definitions of <code>is_tautology</code> that both use the same definition of <code>Formula_</code>.</p>",
        "id": 498937986,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1739255633
    },
    {
        "content": "<p>If I did that for both they would clash right?</p>",
        "id": 498938168,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1739255754
    },
    {
        "content": "<p>The <code>_root_</code> approach that is.</p>",
        "id": 498938266,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1739255793
    },
    {
        "content": "<p>Would the macro work in that case?</p>",
        "id": 498938498,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1739255940
    },
    {
        "content": "<p>That is, if I do <code>def _root_.Chapter2_.Formula_.is_tautology</code> in two different namespaces, will the definitions clash?</p>",
        "id": 498939093,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1739256354
    },
    {
        "content": "<p>The macro is equivalent to this <code>_root_</code> approach</p>",
        "id": 498939100,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1739256361
    },
    {
        "content": "<p>Yes, they will clash.</p>",
        "id": 498939149,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1739256367
    },
    {
        "content": "<p>I guess the only option is to drop the dot notation then?</p>",
        "id": 498939327,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1739256482
    },
    {
        "content": "<p>If I have</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Chapter2_</span><span class=\"bp\">.</span><span class=\"n\">Prop_</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n</code></pre></div>\n<p>the <code>open Formula_</code> somehow knows to use the definition of <code>Formula_</code> from the <code>Chapter2_</code> namespace and not try to find it in the <code>Chapter2_.Prop_</code> namespace?</p>",
        "id": 498939702,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1739256706
    },
    {
        "content": "<p><code>namespace Chapter2_.Prop_</code> makes all the names in <code>Chapter2_</code> and <code>Chapter2_.Prop_</code> available, so when you do <code>open Formula_</code>, it can resolve that <code>Formula_</code> refers to <code>Chapter2_.Formula_</code>, and then makes the names in there available.</p>",
        "id": 498940138,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1739256916
    },
    {
        "content": "<p>Oh. And I assume <code>namespace Chapter2_.Prop_</code> is the same as</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Chapter2_</span>\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Prop_</span>\n</code></pre></div>\n<p>?</p>",
        "id": 498940372,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1739257037
    },
    {
        "content": "<p>Yeah</p>",
        "id": 498940389,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1739257046
    },
    {
        "content": "<p>Thank you!</p>",
        "id": 498940428,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1739257068
    },
    {
        "content": "<p>Yeah, that macro is there mostly to complain if the name before the dot doesn't resolve, and partly to help with maintenance when I move things around. It helped a lot with early iterative development, but in the long run I'd like to eliminate it.</p>",
        "id": 498947308,
        "sender_full_name": "David Thrane Christiansen",
        "timestamp": 1739260236
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"354934\">David Thrane Christiansen</span> <a href=\"#narrow/channel/270676-lean4/topic/confused.20about.20nesting.20namespaces/near/498947308\">said</a>:</p>\n<blockquote>\n<p>... but in the long run I'd like to eliminate it.</p>\n</blockquote>\n<p>Could you elaborate on why? it seems to me like this is a nice language feature to have?</p>",
        "id": 499075331,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1739299224
    },
    {
        "content": "<p>I think it's fine as an idiomatic language feature, but it doesn't make the Verso codebase easier to understand. It's been very helpful during rapid development, but the core of Verso is getting pretty stable, so I'd rather optimize for being less surprising, easier to maintain, and not so clever when possible. That said, this is not something I feel strongly about :)</p>",
        "id": 499086107,
        "sender_full_name": "David Thrane Christiansen",
        "timestamp": 1739303113
    }
]