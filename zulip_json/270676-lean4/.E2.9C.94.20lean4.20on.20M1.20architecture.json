[
    {
        "content": "<p>How screwed am I? This is a Mac Studio with M1 chip.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">rosetta</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">unexpectedly</span> <span class=\"n\">need</span> <span class=\"n\">to</span> <span class=\"n\">EmulateForward</span> <span class=\"n\">on</span> <span class=\"n\">a</span> <span class=\"n\">synchronous</span> <span class=\"n\">exception</span> <span class=\"n\">x86_rip</span><span class=\"bp\">=</span><span class=\"mi\">0x4581531296</span> <span class=\"n\">arm_pc</span><span class=\"bp\">=</span><span class=\"mi\">0x4712665780</span> <span class=\"n\">num_insts</span><span class=\"bp\">=</span><span class=\"mi\">4</span> <span class=\"n\">inst_index</span><span class=\"bp\">=</span><span class=\"mi\">3</span> <span class=\"n\">x86</span> <span class=\"n\">instruction</span> <span class=\"n\">bytes</span><span class=\"o\">:</span> <span class=\"mi\">0x6215344901283465301</span> <span class=\"mi\">0x753510466700988499</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">external</span> <span class=\"n\">command</span> <span class=\"bp\">`/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">andrej</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---nightly/bin/lean` exited with code 134</span>\n</code></pre></div>",
        "id": 357853980,
        "sender_full_name": "Andrej Bauer",
        "timestamp": 1683894455
    },
    {
        "content": "<p>Rosetta should not be necessary, we have native ARM releases. How did you install elan?</p>",
        "id": 357856769,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1683895068
    },
    {
        "content": "<p>I think a lot of people will have elan installed using the x86 brew, because for lean3 that's the suggested way</p>",
        "id": 357857303,
        "sender_full_name": "Eric Rodriguez",
        "timestamp": 1683895188
    },
    {
        "content": "<p>Hmm, <code>elan</code> resides in <code>~/.elan/bin</code>, I am not sure where I got it from. I can just reinstall. What's the best way to do it, Homebrew or with bare hands?</p>",
        "id": 357857805,
        "sender_full_name": "Andrej Bauer",
        "timestamp": 1683895298
    },
    {
        "content": "<p>I think Homebrew is fine as long as you make sure to install its ARM elan (don't ask me how), it was enabled recently <a href=\"https://github.com/Homebrew/homebrew-core/pull/127594\">https://github.com/Homebrew/homebrew-core/pull/127594</a></p>",
        "id": 357858163,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1683895377
    },
    {
        "content": "<p>It looks like I installed <code>elan-init</code> via Homebrew, but I didn't tell it anything special.</p>",
        "id": 357858317,
        "sender_full_name": "Andrej Bauer",
        "timestamp": 1683895401
    },
    {
        "content": "<p>Is your Homebrew x86? Then I think it only installs x86 packages</p>",
        "id": 357858528,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1683895441
    },
    {
        "content": "<p>How do I find out?</p>",
        "id": 357858618,
        "sender_full_name": "Andrej Bauer",
        "timestamp": 1683895455
    },
    {
        "content": "<p>I'm not sure, does macOS have something like <code>file $(which brew)</code>?</p>",
        "id": 357859246,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1683895596
    },
    {
        "content": "<p>Lean4 works very well on M1 macs, I can report.</p>\n<p>Or you can try <code>file $(which lean)</code>. Yeah.</p>",
        "id": 357859373,
        "sender_full_name": "Max Nowak üêâ",
        "timestamp": 1683895631
    },
    {
        "content": "<p>It's a shell script. Anyhow, I am on homebrew 4.0.14, I'd imagine I have native support. Let me poke around a bit.</p>",
        "id": 357859706,
        "sender_full_name": "Andrej Bauer",
        "timestamp": 1683895705
    },
    {
        "content": "<p>Judging from the Internet, I am on a native homebrew because it's in <code>/opt/homebrew</code> (whereas Intel is in <code>/usr/local</code>).</p>",
        "id": 357860147,
        "sender_full_name": "Andrej Bauer",
        "timestamp": 1683895797
    },
    {
        "content": "<p>Interesting. And what does <code>file $(which lean)</code> say?</p>",
        "id": 357860636,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1683895907
    },
    {
        "content": "<p>Aha!</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">file</span> <span class=\"bp\">$</span><span class=\"o\">(</span><span class=\"n\">which</span> <span class=\"n\">lean</span><span class=\"o\">)</span>\n<span class=\"bp\">/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">andrej</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"o\">:</span> <span class=\"n\">Mach</span><span class=\"bp\">-</span><span class=\"n\">O</span> <span class=\"mi\">64</span><span class=\"bp\">-</span><span class=\"n\">bit</span> <span class=\"n\">executable</span> <span class=\"n\">x86_64</span>\n</code></pre></div>",
        "id": 357860823,
        "sender_full_name": "Andrej Bauer",
        "timestamp": 1683895929
    },
    {
        "content": "<p>And also:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">file</span> <span class=\"bp\">$</span><span class=\"o\">(</span><span class=\"n\">which</span> <span class=\"n\">elan</span><span class=\"o\">)</span>\n<span class=\"bp\">/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">andrej</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">elan</span><span class=\"o\">:</span> <span class=\"n\">Mach</span><span class=\"bp\">-</span><span class=\"n\">O</span> <span class=\"mi\">64</span><span class=\"bp\">-</span><span class=\"n\">bit</span> <span class=\"n\">executable</span> <span class=\"n\">x86_64</span>\n</code></pre></div>\n<p>It's best if I just make sure I've got the native version installed.</p>",
        "id": 357861063,
        "sender_full_name": "Andrej Bauer",
        "timestamp": 1683895987
    },
    {
        "content": "<p>Then it looks like you have both a manual and Homebrew installation of elan, with the former taking precedence in PATH. I would suggest <code>elan self uninstall</code> to get rid of the former.</p>",
        "id": 357861189,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1683896015
    },
    {
        "content": "<p>Is there a config file I should be paying attention to?</p>",
        "id": 357861215,
        "sender_full_name": "Andrej Bauer",
        "timestamp": 1683896024
    },
    {
        "content": "<p>Actually, I only have one <code>elan</code> in <code>~/.elan/bin</code>. There's no <code>elan</code> in <code>/opt/homebrew/bin</code>.</p>",
        "id": 357861460,
        "sender_full_name": "Andrej Bauer",
        "timestamp": 1683896077
    },
    {
        "content": "<p>Ok. But either way, you should get rid of the x86 manual installation and then reinstall either manually or via Homebrew</p>",
        "id": 357861617,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1683896118
    },
    {
        "content": "<p>I'd like to find out what caused me to install the Intel version.</p>",
        "id": 357861709,
        "sender_full_name": "Andrej Bauer",
        "timestamp": 1683896144
    },
    {
        "content": "<p>Is this a reasonable <code>~/.elan/settings.toml</code>?</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">default_toolchain</span> <span class=\"bp\">=</span> <span class=\"s2\">\"nightly\"</span>\n<span class=\"n\">telemetry</span> <span class=\"bp\">=</span> <span class=\"n\">false</span>\n<span class=\"n\">version</span> <span class=\"bp\">=</span> <span class=\"s2\">\"12\"</span>\n\n<span class=\"o\">[</span><span class=\"n\">overrides</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 357861879,
        "sender_full_name": "Andrej Bauer",
        "timestamp": 1683896177
    },
    {
        "content": "<p>I have the same but with <code>default_toolchain = \"leanprover/lean4:nightly\"</code>. I didn't know there was a <code>nightly</code> Lean4 version, huh.</p>",
        "id": 357862225,
        "sender_full_name": "Max Nowak üêâ",
        "timestamp": 1683896263
    },
    {
        "content": "<p><code>nightly</code> is Lean 3</p>",
        "id": 357862280,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1683896275
    },
    {
        "content": "<p>It's reasonable enough, the platform of installed Lean releases is determined by the platform of the elan binary. If you installed it before 04/2022, there was only x86.</p>",
        "id": 357862505,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1683896314
    },
    {
        "content": "<p>Woohoo, the M1 version of Lean is waaaaay faster.</p>",
        "id": 357865880,
        "sender_full_name": "Andrej Bauer",
        "timestamp": 1683897074
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"345260\">Andrej Bauer</span> has marked this topic as resolved.</p>",
        "id": 357868275,
        "sender_full_name": "Notification Bot",
        "timestamp": 1683897629
    }
]