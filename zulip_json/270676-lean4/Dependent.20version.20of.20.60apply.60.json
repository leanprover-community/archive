[
    {
        "content": "<p>Is there a version of/syntax for the <code>apply</code> tactic which allows you to give a name to early parameters? E.g. if I want to prove <code>p /\\ q</code>, having a proof of <code>p</code> around may be handy when proving <code>q</code> (obviously I can just bind a name to my proof of <code>p</code> with <code>have</code>, but could save a fair bit of ceremony in some situations).</p>\n<p>I can get close (for two params) with</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">dapp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"o\">:</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">hp</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hpq</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">hp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hpq</span><span class=\"w\"> </span><span class=\"n\">hp</span><span class=\"o\">)</span>\n\n<span class=\"kn\">macro</span><span class=\"w\"> </span><span class=\"s2\">\"dapply\"</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">dapp</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">f</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">constructor</span><span class=\"o\">)</span>\n<span class=\"o\">)</span>\n</code></pre></div>\n<p>but struggling with idents in tactics (e.g. syntax like <code>dapply And.intro as lhs</code>, performing <code>intro lhs</code> on the second goal), and it feels like something that someone else must have done better, and I'm just not using the right keywords to find it.</p>",
        "id": 510494719,
        "sender_full_name": "Freddie Nash",
        "timestamp": 1743954791
    },
    {
        "content": "<p>i did have something similar, once... although i called it <code>have_goal</code></p>",
        "id": 510495302,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1743955208
    },
    {
        "content": "<p>find the code <a href=\"https://github.com/leanprover-community/mathlib4/blob/blizzard_inc/mathieu12/Mathlib/InformationTheory/Code/Linear/TacticTmp/have_goal.lean\">here</a> (it's one of those, but i can't remember precisely what the differences are)</p>",
        "id": 510495555,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1743955340
    },
    {
        "content": "<p>i guess it would be called unidiomatic by current standards since it only works when there are multiple goals available</p>",
        "id": 510495640,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1743955435
    },
    {
        "content": "<p>it doesn't look it but it comes with big warning signs of <strong><em>don't use unless you really really really have to</em></strong></p>",
        "id": 510495801,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1743955531
    },
    {
        "content": "<p>Topmost elaboration seems to work, and is rather more general than what I was going for</p>",
        "id": 510496519,
        "sender_full_name": "Freddie Nash",
        "timestamp": 1743956011
    },
    {
        "content": "<p>If it's not too complicated a topic, why would use of such a tactic be problematic? From my side, I'd rather name things up front, and not have issues like \"now I need to close the goal with <code>have_goal</code> rather than throwing tactic of my choice at it\" (though presumably it would be easy to adapt to use an arbitrary tactic rather than a term), but those would both be matters of style and convenience, which I expect is not what you're getting at.</p>",
        "id": 510496771,
        "sender_full_name": "Freddie Nash",
        "timestamp": 1743956163
    },
    {
        "content": "<p>to be clear, i was talking about <code>have_goal</code> being unidiomatic, since it acts on multiple goals at once, while not necessarily working on <em>all</em> goals. In particular, it fails when used in combination with a focussing dot.</p>",
        "id": 510497360,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1743956566
    },
    {
        "content": "<p>mathlib lints against this kind of tactic, because (i think?) it makes the structure of the proof unclear?</p>",
        "id": 510497396,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1743956586
    },
    {
        "content": "<p>I see: yes, failing with a dot did throw me initially (code examples for comparison)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">have_goal_test</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">:</span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"o\">:</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hp</span><span class=\"o\">:</span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hpq</span><span class=\"o\">:</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">f</span>\n<span class=\"w\">  </span><span class=\"n\">have_goal</span><span class=\"w\"> </span><span class=\"n\">lhs</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">hp</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hpq</span><span class=\"w\"> </span><span class=\"n\">lhs</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">dapply_test</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">:</span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"o\">:</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hp</span><span class=\"o\">:</span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hpq</span><span class=\"o\">:</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">dapply</span><span class=\"w\"> </span><span class=\"n\">f</span>\n<span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hp</span>\n<span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">lhs</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hpq</span><span class=\"w\"> </span><span class=\"n\">lhs</span>\n\n<span class=\"c1\">-- (not got this working)</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">dapply_ideal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">:</span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"o\">:</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hp</span><span class=\"o\">:</span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hpq</span><span class=\"o\">:</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">dapply</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"n\">lhs</span><span class=\"w\"> </span><span class=\"c1\">-- ideally want to give a list of identifiers</span>\n<span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hp</span>\n<span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hpq</span><span class=\"w\"> </span><span class=\"n\">lhs</span>\n</code></pre></div>\n<p>(obviously with the idea that the proof of the lhs would not be trivial, and that the type of the proposition is probably long and painful to read, so you don't really want to be binding it manually)</p>",
        "id": 510497428,
        "sender_full_name": "Freddie Nash",
        "timestamp": 1743956610
    },
    {
        "content": "<p>You can use <code>refine</code> and named placeholders:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">dapply_ideal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">:</span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"o\">:</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hp</span><span class=\"o\">:</span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hpq</span><span class=\"o\">:</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">lhs</span>\n<span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hp</span>\n<span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hpq</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">as</span>\n</code></pre></div>",
        "id": 510504544,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1743961516
    },
    {
        "content": "<p>Is that a recent addition? Not seeing any bindings with 4.14-rc2 (I probably ought to bump that)</p>",
        "id": 510504973,
        "sender_full_name": "Freddie Nash",
        "timestamp": 1743961832
    },
    {
        "content": "<p>(nor with 4.18)</p>",
        "id": 510505265,
        "sender_full_name": "Freddie Nash",
        "timestamp": 1743962077
    },
    {
        "content": "<p>Ah! I missed the <code>?</code> in the usage: that's exciting, and works with <code>apply</code> also (I presume this allows you to talk about any filled hole)</p>",
        "id": 510505314,
        "sender_full_name": "Freddie Nash",
        "timestamp": 1743962124
    },
    {
        "content": "<p>Oh wow, I didn't realize that worked</p>",
        "id": 510506823,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1743963172
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"715788\">Freddie Nash</span> <a href=\"#narrow/channel/270676-lean4/topic/Dependent.20version.20of.20.60apply.60/near/510504973\">said</a>:</p>\n<blockquote>\n<p>Is that a recent addition?</p>\n</blockquote>\n<p>It's been there since before the first public release of Lean 4.</p>",
        "id": 510506967,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1743963259
    },
    {
        "content": "<p>Yep, I'd missed the <code>?</code> in the <code>exact hpq ?lhs</code> bit, and assumed it wasn't working because the holes don't appear in the list of hypotheses</p>",
        "id": 510507019,
        "sender_full_name": "Freddie Nash",
        "timestamp": 1743963307
    },
    {
        "content": "<p>My experience with named meta-variables is that they can really be inconsistent:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">dapply_ideal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">:</span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬¬</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hpq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬¬</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">lhs</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Classical</span><span class=\"bp\">.</span><span class=\"n\">not_not</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hp</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hpq</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"c1\">-- fails because ?as : p (=&gt; takes meta-variable at the state of `exact hp`)</span>\n</code></pre></div>",
        "id": 514221751,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1745526011
    }
]