[
    {
        "content": "<p>I frequently use the <a href=\"https://live.lean-lang.org/\">web editor</a> to make and review mathlib PR's because, well, it takes 2 minutes to download mathlib cache and sometimes my vscode lean just gets stuck for no reason (I think it's because I have too many files open), so I've noticed three ways that the web editor maybe can be improved:</p>\n<ol>\n<li>If I have a long file open and I edit the first part, every edit seems to be processed separately and each edit has to be processed before the next edit is processed, which effectively means that the entire file afterwards is updated for 20 times before everything starts working again, and ironically hitting the refresh button and letting it start again is faster. I have no clue actually how easy or hard this is to address.</li>\n<li>To make it more like mathlib, maybe we can enable a feature where it will stop automatically accept unprovided vavriables, and also unspecified universe. (See example below)</li>\n<li>Right-clicking an existing theorem and clicking \"Go to definition\" brings me to the doc page, which is helpful, but it doesn't bring me to the section automatically, because the anchorings are done differently between the editor (by line) and the doc pages (by name). (See example below)</li>\n</ol>",
        "id": 543685554,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759911502
    },
    {
        "content": "<p>Example for 2:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"c1\">-- This would not be accepted in Mathlib because `u` and `x` are not defined.</span>\n<span class=\"c1\">-- So this should throw an error in the web editor.</span>\n</code></pre></div>\n<p>Example for 3:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Logic</span><span class=\"bp\">.</span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">Defs</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">Bijective</span><span class=\"w\"> </span><span class=\"c1\">-- right click -&gt; go to definition</span>\n</code></pre></div>",
        "id": 543686164,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759911676
    },
    {
        "content": "<blockquote>\n<ol>\n<li>To make it more like mathlib, maybe we can enable a feature where it will stop automatically accept unprovided vavriables, and also unspecified universe. (See example below)</li>\n</ol>\n</blockquote>\n<p>Add <code>set_option autoImplicit false</code> to the top if you want that.</p>",
        "id": 543691054,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1759913072
    },
    {
        "content": "<p>thanks!</p>",
        "id": 543691330,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759913143
    },
    {
        "content": "<p>Regarding 3, is there any hope of making the \"peek definition\" functionality work? Right now it shows a box with the filename and line number, but it's unable to load the actual file content</p>\n<p><a href=\"/user_uploads/3121/6CvYev0Oh6zGoExZvybN3eJm/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/6CvYev0Oh6zGoExZvybN3eJm/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"3798x1246\" src=\"/user_uploads/thumbnail/3121/6CvYev0Oh6zGoExZvybN3eJm/image.png/840x560.webp\"></a></div>",
        "id": 543700661,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759915922
    },
    {
        "content": "<p>I think that should definitely be doable in theory yes.</p>",
        "id": 543717623,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1759921375
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/270676-lean4/topic/rfc.3A.20three.20suggestions.20to.20improve.20the.20web.20editor/near/543685554\">said</a>:</p>\n<blockquote>\n<ol>\n<li>each edit has to be processed before the next edit is processed</li>\n</ol>\n</blockquote>\n<p>so I assume 1 is impossible?</p>",
        "id": 543821150,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759952155
    },
    {
        "content": "<p>One can get all this with mathlib by opening it  in codespaces or Ona (formerly gitpod). I hope  the web editor stays as it is; as a scratchpad where one can use all Lean features by default  including autoImplicits. The third point is worth filing a bug report about I guess.</p>",
        "id": 543822546,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1759952706
    },
    {
        "content": "<p>Arguably <code>import Mathlib</code> is not any more a Lean feature than defaulting to <code>autoImplicit false</code>; both are a lakefile decision</p>",
        "id": 543837024,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759958594
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/270676-lean4/topic/rfc.3A.20three.20suggestions.20to.20improve.20the.20web.20editor/near/543822546\">said</a>:</p>\n<blockquote>\n<p>I hope  the web editor stays as it is</p>\n</blockquote>\n<p>for 2 i explicitly said \"enable a feature\", so like a button on the top that say \"☐ mathlib mode\"</p>",
        "id": 543837279,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759958680
    },
    {
        "content": "<p>Which I guess would also turn on the mathlib linters?</p>",
        "id": 543837434,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759958750
    },
    {
        "content": "<p>Actually, we can implement 2 today! it's via the example feature</p>\n<p><a href=\"/user_uploads/3121/1nAkvExFgidMT9ft8i_5MeAq/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/1nAkvExFgidMT9ft8i_5MeAq/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"155x237\" src=\"/user_uploads/thumbnail/3121/1nAkvExFgidMT9ft8i_5MeAq/image.png/840x560.webp\"></a></div><p>we can just put an example that says \"mathlib mode\"</p>",
        "id": 543837437,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759958752
    },
    {
        "content": "<p>We could also implement it in the \"latest mathlib\" drop-down, since each choice is essentially choosing a lakefile</p>",
        "id": 543837505,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759958787
    },
    {
        "content": "<p>and that will change the whole file to:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">autoImplicit</span><span class=\"w\"> </span><span class=\"n\">false</span>\n\n<span class=\"kn\">universe</span><span class=\"w\"> </span><span class=\"n\">u</span>\n\n<span class=\"c1\">-- code goes here...</span>\n\n<span class=\"bp\">#</span><span class=\"n\">lint</span>\n</code></pre></div>",
        "id": 543837522,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759958796
    },
    {
        "content": "<p>That doesn't turn on the mathlib style linters</p>",
        "id": 543837567,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759958821
    },
    {
        "content": "<p>ah, the 'syntax linters', right</p>",
        "id": 543837633,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759958849
    },
    {
        "content": "<p>yeah i guess have an option on the bottom of the list that says \"latest mathlib + mathlib mode\"</p>",
        "id": 543837697,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759958884
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/stream/270676-lean4/topic/rfc.3A.20three.20suggestions.20to.20improve.20the.20web.20editor/near/543685554\">said</a>:</p>\n<blockquote>\n<ol start=\"3\">\n<li>Right-clicking an existing theorem and clicking \"Go to definition\" brings me to the doc page, which is helpful, but it doesn't bring me to the section automatically, because the anchorings are done differently between the editor (by line) and the doc pages (by name). (See example below)</li>\n</ol>\n</blockquote>\n<p>I remember when I implemented that I gave up on the jumping to the right section because, I think monaco only exposed something line \"file X, line 77\" instead of the declaration name and the doc-gen pages didn't have any api to open \"whatever is on line 77 of that file\".</p>\n<p>Regarding \"peek definitons\", there might be a chance to get that working if all bugs in the part which translates URIs to file names on disk are eliminated, but that's a rather fiddly matter, I think.</p>",
        "id": 544631357,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1760396050
    },
    {
        "content": "<ol>\n<li>I would make a guess that there might be some RPC-calls/notifications which might need to be called to interrupt the Lean server. Maybe these need to be triggered explicitely by the monaco editor?</li>\n</ol>",
        "id": 544631520,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1760396231
    },
    {
        "content": "<ol start=\"2\">\n<li>Feel free to PR any examples, it should be as easy as just adding a .lean file to the \"mathlib\" project. There are instructions on the lean4web repo.</li>\n</ol>\n<p>In theory each project should also respect the options set in it's lakefile, so one could disable autoimplicits there just like mathlib does. However, that part is as fiddly as what's mentioned before, so it's likely broken again (basically some part of the lean4-vscode extension or lake does require that a file exists on disk without much reason. It will still work if the file doesn't exist, its just been decided that in that case no options from the lakefile will be applied).</p>\n<p>(side note: Also, I personally think disabling auto-imolicits is a bad choice, they are an deliberate feature of Lean. And especially since that feature got added where autoimplicits are displayed by vscode/monaco its also easier to spot them)</p>",
        "id": 544632229,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1760396815
    }
]