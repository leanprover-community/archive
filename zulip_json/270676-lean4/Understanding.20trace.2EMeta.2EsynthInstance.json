[
    {
        "content": "<p>When I look at the output of</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">set_option</span><span class=\"w\"> </span><span class=\"n\">trace.Meta.synthInstance</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kd\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>I see a strange (to my eyes...) behaviour. Lean is trying to infer two <code>OfNat ?m 0</code> instances, to make sense of the two <code>0</code>'s, and this makes sense. What I do not understand is</p>\n<ol>\n<li>Why is it trying <em>twice</em> both for the first and for the second <code>0</code>? Indeed, on the left, it tries both a <code>OfNat ?m.4 0</code> and a <code>OfNat ?m.35 0</code>; and both a <code>OfNat ?m.18 0</code> and a <code>OfNat? m.35 0</code> on the right (of course, the values 4, 18, 35 might vary).</li>\n</ol>\n<p><strong>My trial</strong> Perhaps what launches the instance search is actually the <code>=</code> sign, and Lean is trying both with <code>HEq</code> and with <code>Eq</code>: in the first case it looks for two types to which the two zeros should belong (<code>m.4</code> and <code>m.18</code>), in the second for just one type (<code>m.35)</code>. </p>\n<p><strong>Comment</strong> I guess my trial is false, if I replace the statement with <code>example : 0 â‰¤ 0 := sorry</code> I still get the same behaviour (plus the one for <code>LE</code>, of course), although <code>HLE</code> does not exist...</p>\n<ol start=\"2\">\n<li>At any rate, I do not understand why after some trials for the left-hand <code>0</code> it gives up, while for the right-hand one it ends up finding <code>OfNat Nat 0</code>. Not only is not clear to me where this asymmetry comes from, but also how can it be happy having only found the instance on the RHS and having abandoned the LHS to its fate...</li>\n</ol>",
        "id": 492476921,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1736332707
    },
    {
        "content": "<p>(I'll briefly hijack this thread to suggest upvoting <a href=\"https://github.com/leanprover/lean4/pull/6389\">lean4#6389</a>, which causes <code>trace.Meta.synthInstance</code> to be much harder to read than it was supposed to be)</p>",
        "id": 492488187,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736337154
    },
    {
        "content": "<p>(the indistinguishability of issue numbers vs pr numbers really doesn't help with reading that sentence)</p>",
        "id": 492489115,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1736337506
    }
]