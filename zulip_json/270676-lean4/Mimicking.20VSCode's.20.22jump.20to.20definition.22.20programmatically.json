[
    {
        "content": "<p>I'm working on a project that requires me to programmatically extract Lean definitions. For example, if a proof uses add_comm, I want to retrieve the file containing the definition of add_comm. How can I do that? Thank you so much!</p>",
        "id": 464482995,
        "sender_full_name": "Shubhra Mishra",
        "timestamp": 1724361653
    },
    {
        "content": "<p>I think the infoview <a href=\"https://github.com/leanprover/vscode-lean4/blob/93095f9ed971ac59019408942ac295b56e56807c/lean4-infoview-api/src/rpcApi.ts#L160-L166\">calls</a> the RPC call <a href=\"https://github.com/leanprover/lean4/blob/33d24c3bcab0cb18a26b1f817ef2f0b2299f1e95/src/Lean/Server/FileWorker/WidgetRequests.lean#L109-L123\"><code>Lean.Widget.getGoToLocation</code></a>, so you can probably just do the same.</p>\n<p>Maybe you can share a bit more which context your working in? I assume your project is written in Lean itself? In that case it shouldn't be too hard to follow the procedure above.</p>",
        "id": 464487688,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1724364080
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Group</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"n\">run_meta</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">mod</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">findModuleOf?</span><span class=\"w\"> </span><span class=\"ss\">``add_comm</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">failure</span>\n<span class=\"w\">  </span><span class=\"n\">println!</span><span class=\"w\"> </span><span class=\"n\">mod</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">findDeclarationRanges?</span><span class=\"w\"> </span><span class=\"ss\">``add_comm</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">failure</span>\n<span class=\"w\">  </span><span class=\"n\">println!</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"bp\">.</span><span class=\"n\">pos</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"bp\">.</span><span class=\"n\">endPos</span><span class=\"o\">)</span>\n<span class=\"c1\">-- Mathlib.Algebra.Group.Defs</span>\n<span class=\"c1\">-- (⟨297, 2⟩, ⟨297, 13⟩)</span>\n</code></pre></div>",
        "id": 464488692,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724364589
    },
    {
        "content": "<p>note that line 297:2-13 of Mathlib/Algebra/Group/Basic.lean is actually the text <code>to_additive</code> in</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">to_additive</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">mul_comm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">CommMagma</span><span class=\"bp\">.</span><span class=\"n\">mul_comm</span>\n</code></pre></div>\n<p>because <code>add_comm</code> is not defined directly, it is generated by additivizing <code>mul_comm</code></p>",
        "id": 464489207,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724364831
    },
    {
        "content": "<p>Ah, I see. Thank you for pointing that out, Mario! And <span class=\"user-mention\" data-user-id=\"385895\">@Jon Eugster</span>, the idea I'm interested in experimenting with is how language models can self-improve on their Lean capabilities. Obviously, given how much LLMs hallucinate, pure self-improvement (without absolutely any ground truth) wouldn't work. So I wanted to see how LLMs would perform if I gave them a theorem statement (in Lean), and asked them to generate the proof, but <em>also</em> provided documentation related to the proof. I was planning on using theorems/proofs from MathLib4, meaning that this documentation I provide could just be the code containing the other theorems called on in intermediate steps for the ground truth mathlib4 proof. It's totally possible that self-improving this way would perform even worse than simply finetuning on mathlib4, but it was an experiment I was curious to run. The framework I have so far is in Python (as I've never used Lean to actually program, haha). But would you recommend using Lean instead? And thanks for all your help!</p>",
        "id": 464519226,
        "sender_full_name": "Shubhra Mishra",
        "timestamp": 1724378553
    }
]