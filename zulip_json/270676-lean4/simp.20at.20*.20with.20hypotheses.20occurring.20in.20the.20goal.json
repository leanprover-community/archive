[
    {
        "content": "<p>In the following MWE, simp at * does not simplify a hypothesis, seemingly because it occurs in the goal:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">zeq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">True</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">bug</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">zeq</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"c1\">-- this simplifies the goal, but not the hypothesis h</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">zeq</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"c1\">-- this simplifies the hypothesis h</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Or</span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"n\">trivial</span>\n</code></pre></div>\n<p>I was wondering whether this is a bug. Otherwise, is there a variant of simp at * also simplifying hypotheses used in the goal?</p>",
        "id": 462613322,
        "sender_full_name": "Sven Manthe",
        "timestamp": 1723746595
    },
    {
        "content": "<p>Notice that <code>simp [zeq] at h</code> doesn't simplify <code>h</code> per se, but it creates a new hypothesis called <code>h</code>, shadowing the old one, and simplifies that. It needs to do this because <code>f</code> depends on its argument being a proof of <code>z = 0</code>.</p>\n<p>That said, I haven't looked into why <code>simp at *</code> works the way it does. This seems likely to be intentional.</p>",
        "id": 462614243,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1723746910
    },
    {
        "content": "<p>In the code of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Elab.Tactic.simpLocation#doc\">docs#Lean.Elab.Tactic.simpLocation</a> I see that in the wildcard case it collects specifically non-dependent proposition hypotheses.</p>",
        "id": 462614422,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1723746987
    },
    {
        "content": "<p>Okay, thank you. My concrete use case was that I tried to write a tactic, not expecting this behavior (and know no metaprogamming). Do you have a suggestion how to achieve something like \"for all hypotheses h, do simp at h\", that is, explicitly create all these new shadowing hypotheses?</p>",
        "id": 462615330,
        "sender_full_name": "Sven Manthe",
        "timestamp": 1723747368
    }
]