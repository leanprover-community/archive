[
    {
        "content": "<p>Here is a MWE illustrating the error I am experiencing:</p>\n<p>First, here is <code>Main.lean</code></p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib.Lean.CoreM</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">searchPathRef.set</span><span class=\"w\"> </span><span class=\"n\">compile_time_search_path</span><span class=\"bp\">%</span>\n<span class=\"w\">  </span><span class=\"n\">CoreM.withImportModules</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"ss\">`Mathlib</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"n\">println</span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"s2\">\"success!\"</span>\n</code></pre></div>\n<p>and the associated lakefile:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lake</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">DSL</span>\n\n<span class=\"n\">package</span><span class=\"w\"> </span><span class=\"bp\">«</span><span class=\"n\">foobar</span><span class=\"bp\">»</span><span class=\"w\"> </span><span class=\"n\">where</span>\n\n<span class=\"n\">require</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">git</span>\n<span class=\"w\">  </span><span class=\"s2\">\"https://github.com/leanprover-community/mathlib4.git\"</span>\n\n<span class=\"n\">lean_exe</span><span class=\"w\"> </span><span class=\"n\">foobar</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">root</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"ss\">`Main</span>\n<span class=\"w\">  </span><span class=\"n\">supportInterpreter</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">true</span>\n</code></pre></div>\n<p>Using <code>lake exe foobar</code> results in the following (unhelpful) error:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>uncaught<span class=\"w\"> </span>exception:<span class=\"w\"> </span>parser<span class=\"w\"> </span><span class=\"s1\">'subscript'</span><span class=\"w\"> </span>was<span class=\"w\"> </span>not<span class=\"w\"> </span>found\n</code></pre></div>\n<p>Anyone have any clue about what's causing this error?</p>",
        "id": 489544013,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1734458782
    },
    {
        "content": "<p>I should say that this is with the most recent mathlib as of now, and the following toolchain: <code>leanprover/lean4:v4.15.0-rc1</code>.</p>",
        "id": 489544068,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1734458810
    },
    {
        "content": "<p>I should also add that this is not an issue with <code>CoreM.withImportModules</code>. The following <code>Main.lean</code> causes the same error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"n\">unsafe</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">searchPathRef</span><span class=\"bp\">.</span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">compile_time_search_path</span><span class=\"bp\">%</span>\n<span class=\"w\">  </span><span class=\"n\">withImportModules</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"n\">Import</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"ss\">`Mathlib</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{}</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"n\">println!</span><span class=\"w\"> </span><span class=\"s2\">\"success!\"</span>\n</code></pre></div>\n<p>so it seems that there may be a bug in core?</p>",
        "id": 489544818,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1734459090
    },
    {
        "content": "<p>This issue was reported a lot. If I understand correctly, <a href=\"https://github.com/leanprover/lean4/pull/6325\">https://github.com/leanprover/lean4/pull/6325</a> is related.</p>",
        "id": 489583881,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1734474993
    },
    {
        "content": "<p>You can search for this error message on Zulip.</p>",
        "id": 489583938,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1734475032
    },
    {
        "content": "<p>Thanks Patrick. The PR comment gave me a sufficient hint to solve the issue:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"n\">unsafe</span>\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">searchPathRef.set</span><span class=\"w\"> </span><span class=\"n\">compile_time_search_path</span><span class=\"bp\">%</span>\n<span class=\"w\">  </span><span class=\"n\">enableInitializersExecution</span>\n<span class=\"w\">  </span><span class=\"n\">withImportModules</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"n\">Import.mk</span><span class=\"w\"> </span><span class=\"ss\">`Mathlib</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{}</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"n\">println</span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"s2\">\"success!\"</span>\n</code></pre></div>\n<p>works</p>",
        "id": 489584187,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1734475145
    }
]