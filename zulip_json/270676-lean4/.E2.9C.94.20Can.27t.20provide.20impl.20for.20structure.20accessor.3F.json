[
    {
        "content": "<p>Why does this example not work as one would expect?</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">namespace</span> <span class=\"n\">Hidden</span>\n\n<span class=\"kd\">structure</span> <span class=\"n\">Array</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"n\">Nat</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span> <span class=\"n\">where</span>\n  <span class=\"n\">data</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">:</span> <span class=\"n\">Fin</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">α</span>\n\n<span class=\"kd\">@[extern \"some_extern\"]</span>\n<span class=\"kd\">def</span> <span class=\"n\">get</span> <span class=\"o\">{</span><span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"n\">Nat</span><span class=\"o\">}</span>\n        <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">Array</span> <span class=\"n\">α</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">:</span> <span class=\"n\">Fin</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">α</span>\n  <span class=\"o\">:=</span> <span class=\"n\">A.data</span> <span class=\"n\">i</span>\n\n<span class=\"kn\">attribute</span> <span class=\"o\">[</span><span class=\"n\">implementedBy</span> <span class=\"n\">get</span><span class=\"o\">]</span> <span class=\"n\">Array.data</span>\n</code></pre></div>\n<p>It claims there is a type mismatch, but I can't for the life of me see why</p>",
        "id": 280883974,
        "sender_full_name": "James Gallicchio",
        "timestamp": 1651503343
    },
    {
        "content": "<p>The check is currently syntactic and universe level parameter names are taken into account. The following works</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">namespace</span> <span class=\"n\">Hidden</span>\n\n<span class=\"kd\">structure</span> <span class=\"n\">Array</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"n\">Nat</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span> <span class=\"n\">where</span>\n  <span class=\"n\">data</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">:</span> <span class=\"n\">Fin</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">α</span>\n\n<span class=\"kd\">@[extern \"some_extern\"]</span>\n<span class=\"kd\">def</span> <span class=\"n\">get</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"c\">/-</span><span class=\"cm\"> &lt;&lt;&lt;&lt; Changed here -/</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"n\">Nat</span><span class=\"o\">}</span>\n        <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">Array</span> <span class=\"n\">α</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">:</span> <span class=\"n\">Fin</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">α</span>\n  <span class=\"o\">:=</span> <span class=\"n\">A.data</span> <span class=\"n\">i</span>\n\n<span class=\"kn\">attribute</span> <span class=\"o\">[</span><span class=\"n\">implementedBy</span> <span class=\"n\">get</span><span class=\"o\">]</span> <span class=\"n\">Array.data</span>\n</code></pre></div>\n<p>I will improve this, and make sure the universe levels parameter names are not taken into account.</p>",
        "id": 280885005,
        "sender_full_name": "Leonardo de Moura",
        "timestamp": 1651503699
    },
    {
        "content": "<p>Ah, weird, okay -- thank you for giving it a look!</p>",
        "id": 280885355,
        "sender_full_name": "James Gallicchio",
        "timestamp": 1651503812
    },
    {
        "content": "<p>It also seems like the calling convention modifiers prevent it from matching; is there a way to modify the conventions on auto-generated accessors? (if not I can just put another def between them)</p>",
        "id": 280885720,
        "sender_full_name": "James Gallicchio",
        "timestamp": 1651503950
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"407274\">James Gallicchio</span> <a href=\"#narrow/stream/270676-lean4/topic/Can't.20provide.20impl.20for.20structure.20accessor.3F/near/280885720\">said</a>:</p>\n<blockquote>\n<p>It also seems like the calling convention modifiers prevent it from matching; is there a way to modify the conventions on auto-generated accessors? (if not I can just put another def between them)</p>\n</blockquote>\n<p>What do you mean by calling convention here?</p>",
        "id": 280889644,
        "sender_full_name": "Leonardo de Moura",
        "timestamp": 1651505565
    },
    {
        "content": "<p>The <code>@&amp;</code> borrow annotations</p>",
        "id": 280890144,
        "sender_full_name": "James Gallicchio",
        "timestamp": 1651505807
    },
    {
        "content": "<p>I would have to think about this one and check whether it could generate problems or not. Even if it could, I think it would be fixable, but we don't want to touch the code generation code at this point since part of it is still implemented in C/C++.</p>",
        "id": 280890668,
        "sender_full_name": "Leonardo de Moura",
        "timestamp": 1651506014
    },
    {
        "content": "<p>Understood :) easy enough for me to work around</p>",
        "id": 280890714,
        "sender_full_name": "James Gallicchio",
        "timestamp": 1651506038
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"407274\">James Gallicchio</span> has marked this topic as resolved.</p>",
        "id": 280890964,
        "sender_full_name": "Notification Bot",
        "timestamp": 1651506149
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"407274\">@James Gallicchio</span> <a href=\"https://github.com/leanprover/lean4/commit/94abfdba6c75b6efee68c1838f05fa26efee9a2d\">https://github.com/leanprover/lean4/commit/94abfdba6c75b6efee68c1838f05fa26efee9a2d</a></p>",
        "id": 280892755,
        "sender_full_name": "Leonardo de Moura",
        "timestamp": 1651506895
    },
    {
        "content": "<p>Oh awesome, looks good!</p>",
        "id": 280893456,
        "sender_full_name": "James Gallicchio",
        "timestamp": 1651507199
    }
]