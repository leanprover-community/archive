[
    {
        "content": "<p>I discovered today that <code>trace[debug]</code> doesn't work in linters, because <a href=\"https://github.com/leanprover/lean4/blob/master/src/Lean/Elab/Command.lean#L290\">the trace state is discarded here</a>. Is this deliberate? If so, is there an easy way to copy the traceState into the messages into my own code, so that I can see why my linter is failing?</p>",
        "id": 485095730,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1732885700
    },
    {
        "content": "<p>You probably already know this, but you can use <code>dbg_trace</code> instead, this goes directly to stdout.</p>",
        "id": 485099176,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1732886915
    },
    {
        "content": "<p>My actual issue is that the output of <code>trace.Meta.synthInstance</code> is not appearing anywhere</p>",
        "id": 485099459,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1732886992
    },
    {
        "content": "<p>Not easily I believe as <code>addTraceAsMessages</code> has been made public and generic only <a href=\"https://github.com/leanprover/lean4/commit/38cff088883e4eb9654e2d1a17f84d226ac4efe3#diff-4e819de9d9430729a749ddb68313d355c5f04dce7dfb81e9924661414ad3d1b2R364\">recently</a>. However I went ahead and <a href=\"https://github.com/leanprover/lean4/pull/4460/commits/ddf27d154601ea4a37a71378b6fc98b065fd6d2c\">fixed</a> this in <a href=\"https://github.com/leanprover/lean4/pull/4460\">lean#4460</a> as there any non-reporting state is discarded anyway at the end of the thread.</p>",
        "id": 485099602,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1732887024
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">traces</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getTraceState</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">traces</span><span class=\"bp\">.</span><span class=\"n\">toList</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"n\">traces</span><span class=\"bp\">.</span><span class=\"n\">isEmpty</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"Traces from linter:\"</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">joinSep</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">traces</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·.</span><span class=\"n\">msg</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">nil</span>\n</code></pre></div>\n<p>seemed to work for me to at least see the output</p>",
        "id": 485099940,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1732887130
    }
]