[
    {
        "content": "<p>I am at a loss as to why I am getting this error. Am I missing something obvious?</p>\n<p>This is in one file:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">extern</span><span class=\"w\"> </span><span class=\"s2\">\"shim_clang_getTypedefDeclUnderlyingType\"</span><span class=\"kd\">]</span>\n<span class=\"n\">opaque</span><span class=\"w\"> </span><span class=\"n\">CXCursor.underlyingType</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">cursor</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">@&amp;</span><span class=\"w\"> </span><span class=\"n\">CXCursor</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">CXType</span>\n</code></pre></div>\n<p>And this is in a Main.lean file:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n<span class=\"bp\">...</span>\n<span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">genTypedef</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">typedefCursor</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CXCursor</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">CXChildVisitResult</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">typedefType</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">typedefCursor.type</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">underlyingType</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">typedefCursor.underlyingType</span><span class=\"w\">  </span><span class=\"c1\">-- &lt;&lt; ERROR: failed to infer binder type</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">CXChildVisitResult.Recurse</span>\n<span class=\"bp\">...</span>\n</code></pre></div>\n<p>Here is the error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">././././</span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">78</span><span class=\"o\">:</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">don't</span><span class=\"w\"> </span><span class=\"n\">know</span><span class=\"w\"> </span><span class=\"n\">how</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">synthesize</span><span class=\"w\"> </span><span class=\"n\">implicit</span><span class=\"w\"> </span><span class=\"n\">argument</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">α'</span>\n<span class=\"w\">  </span><span class=\"bp\">@</span><span class=\"n\">bind</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Monad</span><span class=\"bp\">.</span><span class=\"n\">toBind</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">3525</span><span class=\"w\"> </span><span class=\"n\">typedefCursor</span><span class=\"w\"> </span><span class=\"n\">typedefType</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">CXChildVisitResult</span><span class=\"w\"> </span><span class=\"n\">typedefCursor</span><span class=\"bp\">.</span><span class=\"n\">underlyingType</span>\n<span class=\"w\">    </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">underlyingType</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"n\">CXChildVisitResult</span><span class=\"bp\">.</span><span class=\"n\">Recurse</span>\n<span class=\"n\">context</span><span class=\"o\">:</span>\n<span class=\"n\">typedefCursor</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CXCursor</span>\n<span class=\"n\">typedefType</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CXType</span>\n<span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">././././</span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">78</span><span class=\"o\">:</span><span class=\"mi\">8</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">infer</span><span class=\"w\"> </span><span class=\"n\">binder</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">././././</span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">78</span><span class=\"o\">:</span><span class=\"mi\">25</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">don't</span><span class=\"w\"> </span><span class=\"n\">know</span><span class=\"w\"> </span><span class=\"n\">how</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">synthesize</span><span class=\"w\"> </span><span class=\"n\">implicit</span><span class=\"w\"> </span><span class=\"n\">argument</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">CXType'</span>\n<span class=\"w\">  </span><span class=\"bp\">@</span><span class=\"n\">CXCursor</span><span class=\"bp\">.</span><span class=\"n\">underlyingType</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">3525</span><span class=\"w\"> </span><span class=\"n\">typedefCursor</span><span class=\"w\"> </span><span class=\"n\">typedefType</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">typedefCursor</span>\n<span class=\"n\">context</span><span class=\"o\">:</span>\n<span class=\"n\">typedefCursor</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CXCursor</span>\n<span class=\"n\">typedefType</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CXType</span>\n<span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">././././</span><span class=\"n\">Main</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">78</span><span class=\"o\">:</span><span class=\"mi\">8</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">don't</span><span class=\"w\"> </span><span class=\"n\">know</span><span class=\"w\"> </span><span class=\"n\">how</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">synthesize</span><span class=\"w\"> </span><span class=\"n\">placeholder</span>\n<span class=\"n\">context</span><span class=\"o\">:</span>\n<span class=\"n\">typedefCursor</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CXCursor</span>\n<span class=\"n\">typedefType</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CXType</span>\n<span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n</code></pre></div>\n<p>This is easily fixed by adding a type to the binder: </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">underlyingType</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CXType</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">typedefCursor.underlyingType</span>\n</code></pre></div>\n<p>But why?</p>\n<p>I am using: <code>Lean (version 4.11.0-nightly-2024-07-01, arm64-apple-darwin23.5.0, commit 4d0b7cf66c14, Release)</code></p>",
        "id": 456571504,
        "sender_full_name": "Yuri",
        "timestamp": 1722865312
    },
    {
        "content": "<p>Could you <code>#check CXCursor.underlyingType</code>? It seems like <code>CXType</code> is not in scope and autoImplicits are causing it to be an additional implicit parameter.</p>",
        "id": 456581110,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1722867489
    },
    {
        "content": "<p>Thank you! That solves it. CXCursor.underlyingType was declared before the CXType in the CLang.lean module.</p>\n<p>Bitten again by the autoImplicits ... </p>\n<p>Btw, I can't run <code>#check CXCursor.underlyingType</code> (for a while) since my VSCode plugin is stuck with :</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">unknown</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"kn\">prefix</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">CLang'</span>\n\n<span class=\"n\">No</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">CLang'</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">CLang</span><span class=\"bp\">.</span><span class=\"n\">lean'</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">search</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"n\">entries</span><span class=\"o\">:</span>\n<span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span>\n<span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span>\n<span class=\"bp\">/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">baud</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---4.10.0/lib/lean</span>\n<span class=\"bp\">/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">baud</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---4.10.0/lib/lean</span>\n</code></pre></div>\n<p>Even though I can build and run it from the command line.</p>",
        "id": 456583886,
        "sender_full_name": "Yuri",
        "timestamp": 1722867992
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"463095\">Yuri de Wit</span> has marked this topic as resolved.</p>",
        "id": 456584806,
        "sender_full_name": "Notification Bot",
        "timestamp": 1722868102
    }
]