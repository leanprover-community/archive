[
    {
        "content": "<p>Is there any documentation on building/including Lean as a dependency within a Bazel build file? I previously found <a href=\"https://github.com/cpehle/bn\">this repo</a>, but I'm not sure if there's a better way of doing this now.</p>",
        "id": 555138509,
        "sender_full_name": "Arjun Vedantham",
        "timestamp": 1762958900
    },
    {
        "content": "<p>Open-sourcing some bazel rules to build Lean has been on my radar for a while, but I unfortunately haven't found time to do so.</p>",
        "id": 555139225,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1762959014
    },
    {
        "content": "<p>I've been trying to set up a proof of concept using <code>rules_foreign_cc</code>: <a href=\"https://github.com/javathunderman/bazel-rules_foreign_cc-example\">https://github.com/javathunderman/bazel-rules_foreign_cc-example</a></p>\n<p>It's getting stuck while calling into CMake - specifically the log is returning:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">CMake</span><span class=\"w\"> </span><span class=\"n\">Error</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">arjun</span><span class=\"bp\">/.</span><span class=\"n\">cache</span><span class=\"bp\">/</span><span class=\"n\">bazel</span><span class=\"bp\">/_</span><span class=\"n\">bazel_arjun</span><span class=\"bp\">/</span><span class=\"mi\">0530</span><span class=\"n\">fc5131259c17db36145ef68df50f</span><span class=\"bp\">/</span><span class=\"n\">external</span><span class=\"bp\">/</span><span class=\"n\">cmake</span><span class=\"bp\">-</span><span class=\"mf\">3.23</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">-</span><span class=\"n\">linux</span><span class=\"bp\">-</span><span class=\"n\">x86_64</span><span class=\"bp\">/</span><span class=\"n\">share</span><span class=\"bp\">/</span><span class=\"n\">cmake</span><span class=\"bp\">-</span><span class=\"mf\">3.23</span><span class=\"bp\">/</span><span class=\"n\">Modules</span><span class=\"bp\">/</span><span class=\"n\">ExternalProject</span><span class=\"bp\">.</span><span class=\"n\">cmake</span><span class=\"o\">:</span><span class=\"mi\">2776</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">message</span><span class=\"o\">):</span>\n<span class=\"w\">  </span><span class=\"n\">No</span><span class=\"w\"> </span><span class=\"n\">download</span><span class=\"w\"> </span><span class=\"n\">info</span><span class=\"w\"> </span><span class=\"n\">given</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">stage0'</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">its</span><span class=\"w\"> </span><span class=\"n\">source</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"o\">:</span>\n\n<span class=\"w\">   </span><span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">arjun</span><span class=\"bp\">/.</span><span class=\"n\">cache</span><span class=\"bp\">/</span><span class=\"n\">bazel</span><span class=\"bp\">/_</span><span class=\"n\">bazel_arjun</span><span class=\"bp\">/</span><span class=\"mi\">0530</span><span class=\"n\">fc5131259c17db36145ef68df50f</span><span class=\"bp\">/</span><span class=\"n\">sandbox</span><span class=\"bp\">/</span><span class=\"n\">linux</span><span class=\"bp\">-</span><span class=\"n\">sandbox</span><span class=\"bp\">/</span><span class=\"mi\">6</span><span class=\"bp\">/</span><span class=\"n\">execroot</span><span class=\"bp\">/_</span><span class=\"n\">main</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"bp\">-</span><span class=\"mf\">4.25</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">/</span><span class=\"n\">stage0</span>\n\n<span class=\"w\">  </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">an</span><span class=\"w\"> </span><span class=\"n\">existing</span><span class=\"w\"> </span><span class=\"n\">non</span><span class=\"bp\">-</span><span class=\"n\">empty</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"bp\">.</span><span class=\"w\">  </span><span class=\"n\">Please</span><span class=\"w\"> </span><span class=\"n\">specify</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"o\">:</span>\n\n<span class=\"w\">   </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">SOURCE_DIR</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">an</span><span class=\"w\"> </span><span class=\"n\">existing</span><span class=\"w\"> </span><span class=\"n\">non</span><span class=\"bp\">-</span><span class=\"n\">empty</span><span class=\"w\"> </span><span class=\"n\">directory</span>\n<span class=\"w\">   </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">DOWNLOAD_COMMAND</span>\n<span class=\"w\">   </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">URL</span>\n<span class=\"w\">   </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">GIT_REPOSITORY</span>\n<span class=\"w\">   </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">SVN_REPOSITORY</span>\n<span class=\"w\">   </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">HG_REPOSITORY</span>\n<span class=\"w\">   </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">CVS_REPOSITORY</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">CVS_MODULE</span>\n<span class=\"n\">Call</span><span class=\"w\"> </span><span class=\"n\">Stack</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">most</span><span class=\"w\"> </span><span class=\"n\">recent</span><span class=\"w\"> </span><span class=\"n\">call</span><span class=\"w\"> </span><span class=\"n\">first</span><span class=\"o\">):</span>\n<span class=\"w\">  </span><span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">arjun</span><span class=\"bp\">/.</span><span class=\"n\">cache</span><span class=\"bp\">/</span><span class=\"n\">bazel</span><span class=\"bp\">/_</span><span class=\"n\">bazel_arjun</span><span class=\"bp\">/</span><span class=\"mi\">0530</span><span class=\"n\">fc5131259c17db36145ef68df50f</span><span class=\"bp\">/</span><span class=\"n\">external</span><span class=\"bp\">/</span><span class=\"n\">cmake</span><span class=\"bp\">-</span><span class=\"mf\">3.23</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">-</span><span class=\"n\">linux</span><span class=\"bp\">-</span><span class=\"n\">x86_64</span><span class=\"bp\">/</span><span class=\"n\">share</span><span class=\"bp\">/</span><span class=\"n\">cmake</span><span class=\"bp\">-</span><span class=\"mf\">3.23</span><span class=\"bp\">/</span><span class=\"n\">Modules</span><span class=\"bp\">/</span><span class=\"n\">ExternalProject</span><span class=\"bp\">.</span><span class=\"n\">cmake</span><span class=\"o\">:</span><span class=\"mi\">3640</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"n\">ep_add_download_command</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">CMakeLists</span><span class=\"bp\">.</span><span class=\"n\">txt</span><span class=\"o\">:</span><span class=\"mi\">90</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ExternalProject_add</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Maybe CMake is just getting invoked with the wrong options for the build? Not sure if it's failing because of that or something intrinsic to how Bazel invokes CMake with these rules.</p>",
        "id": 558103499,
        "sender_full_name": "Arjun Vedantham",
        "timestamp": 1763519497
    },
    {
        "content": "<p><del>I'm also wondering if it's Bazel blocking external network requests when that <code>ExternalProject</code> function gets invoked</del> disregard, this should not be an issue anymore</p>",
        "id": 558104145,
        "sender_full_name": "Arjun Vedantham",
        "timestamp": 1763520018
    },
    {
        "content": "<p>Ah, never mind, it's just because I didn't include <code>stage0</code> in the file group. Still not working but at least that error is resolved. <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span></p>",
        "id": 558105509,
        "sender_full_name": "Arjun Vedantham",
        "timestamp": 1763521061
    }
]