[
    {
        "content": "<p>I’m experimenting with whether it’s possible to pattern‐match directly on function applications in Lean 4. As a minimal example, consider:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">eval2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">:</span><span class=\"n\">ℕ</span><span class=\"o\">):</span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"n\">d</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"bp\">+</span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">calc2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"n\">ℕ</span><span class=\"o\">):=</span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"n\">eval2</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">eval2</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"w\">  </span><span class=\"bp\">|_=&gt;</span><span class=\"w\"> </span><span class=\"n\">n</span>\n</code></pre></div>\n<p>Here I’d like calc2 (eval2 3 4 5) to reduce to eval2 3 5 5. But Lean’s pattern‐matching doesn’t accept eval2 d a b in the match- it only allows constructors and literals.</p>\n<p>This is just a very general, minimal example; in practice I’d like to detect arbitrary calls of a given function and manipulate their arguments in match-style.<br>\nIs there any built in mechanism in lean 4 to do this for general functions?</p>",
        "id": 529326081,
        "sender_full_name": "Anirudh Suresh",
        "timestamp": 1752773349
    },
    {
        "content": "<p>Yes, but it would be done with Lean's metaprogramming features. You would be matching on the underlying Lean expressions or the syntax. There's a book on the topic: <a href=\"https://leanprover-community.github.io/lean4-metaprogramming-book/main/01_intro.html\">https://leanprover-community.github.io/lean4-metaprogramming-book/main/01_intro.html</a></p>",
        "id": 529327998,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1752774104
    }
]