[
    {
        "content": "<p>Why is there no <code>Repr</code> instance for <code>Empty</code>?  On the surface, this may seem like a nonsense question but it seems to inhibit the generation of <code>Repr</code>s in real code.  E.g. consider slightly modified code from the section <a href=\"https://leanprover.github.io/functional_programming_in_lean/monads/arithmetic.html#further-effects\">Further Effects</a> in FPiL:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">const</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"n\">op</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">prim</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"n\">op</span>\n<span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">Repr</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Prim</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">special</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">plus</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">minus</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">times</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">other</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">special</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Prim</span><span class=\"w\"> </span><span class=\"n\">special</span>\n<span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">Repr</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">CanFail</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">div</span>\n<span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">Repr</span>\n</code></pre></div>\n<p>Now,</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"n\">Prim</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">prim</span><span class=\"w\"> </span><span class=\"n\">plus</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">const</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">const</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">14</span><span class=\"o\">))):</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Prim</span><span class=\"w\"> </span><span class=\"n\">CanFail</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>works, but</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"n\">Prim</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">prim</span><span class=\"w\"> </span><span class=\"n\">plus</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">const</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">const</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">14</span><span class=\"o\">))):</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Prim</span><span class=\"w\"> </span><span class=\"n\">Empty</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>fails because the default Repr is not synthesized (I assume by the virtue of the fact that <code>Empty</code> doesn't have <code>Repr</code>).</p>\n<p>If I make my own empty type</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">MyEmpty</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">Repr</span>\n</code></pre></div>\n<p>then the code works as expected:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"n\">Prim</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">prim</span><span class=\"w\"> </span><span class=\"n\">plus</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">const</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">const</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">14</span><span class=\"o\">))):</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Prim</span><span class=\"w\"> </span><span class=\"n\">MyEmpty</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>I appreciate any insights!</p>",
        "id": 471981842,
        "sender_full_name": "Tom",
        "timestamp": 1726959060
    },
    {
        "content": "<p>you can always do <code>deriving instance Repr for Empty</code> if an upstream type is missing a class you need</p>",
        "id": 471982092,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1726959336
    },
    {
        "content": "<p>Thanks!</p>\n<p>I've come across that.  I am curious if there's a reason why it's not implemented by default.</p>\n<p>I am also not super familiar with how modules and instances are implemented (so e.g. whether e.g. sprinkling that <code>deriving ...</code> clause in multiple files, or incompatible instance definitions in a (large) project) could lead to any issues.</p>",
        "id": 471982295,
        "sender_full_name": "Tom",
        "timestamp": 1726959564
    },
    {
        "content": "<p>I would also be happy to make a PR (perhaps adding the above <code>deriving instance Repr for Empty</code> to e.g. <code>Repr.lean</code>) but feel that modifying something that important is perhaps above my \"pay grade\".</p>",
        "id": 471982522,
        "sender_full_name": "Tom",
        "timestamp": 1726959741
    },
    {
        "content": "<p>I'm certain it was just overlooked</p>",
        "id": 471982649,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1726959865
    },
    {
        "content": "<p>Ok, would you accept a PR?  It would give me a reason to re-learn how build Lean from source and try to write some tests.</p>",
        "id": 471982700,
        "sender_full_name": "Tom",
        "timestamp": 1726959948
    },
    {
        "content": "<p>I'm not in charge, but I would if it was me reviewing the PR</p>",
        "id": 471983116,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1726960398
    },
    {
        "content": "<p>Thanks, I'll give it a go.</p>",
        "id": 471983226,
        "sender_full_name": "Tom",
        "timestamp": 1726960518
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"515083\">Tom</span> has marked this topic as resolved.</p>",
        "id": 471983238,
        "sender_full_name": "Notification Bot",
        "timestamp": 1726960532
    },
    {
        "content": "<p>FYI, I submitted the PR, <a href=\"https://github.com/leanprover/lean4/pull/5415\">https://github.com/leanprover/lean4/pull/5415</a>.  Thanks for your encouragement to do it.</p>",
        "id": 472087338,
        "sender_full_name": "Tom",
        "timestamp": 1727041601
    }
]