[
    {
        "content": "<p>The <code>grind</code> tactic provides a way of hooking into failing invocations with the <code>on_failure</code> syntax. There, one can specify a definition of type <code>Grind.GoalM Unit</code> to be run if <code>grind</code> fails. Is there a way to obtain the original proof goal in such a function (i.e. in <code>Grind.GoalM</code>)? I tried the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"w\"> </span><span class=\"n\">Grind</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">logGoalType</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GoalM</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">goal</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">get</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">goalType</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">goal</span><span class=\"bp\">.</span><span class=\"n\">mvarId</span><span class=\"bp\">.</span><span class=\"n\">getType</span>\n<span class=\"w\">  </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"Goal Type: {goalType}\"</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">grind</span><span class=\"w\"> </span><span class=\"n\">on_failure</span><span class=\"w\"> </span><span class=\"n\">logGoalType</span>\n</code></pre></div>\n<p>... but that always prints <code>Goal Type: False</code>, as <code>grind</code> tries to prove <code>False</code> assuming the negation of the actual proof goal. Thus, I don't see a way to obtain the original proof goal from <code>Grind.GoalM</code>.</p>",
        "id": 542010589,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1759145050
    },
    {
        "content": "<p>Is there a particular reason you're trying to get the original goal? Maybe <a href=\"https://en.wikipedia.org/wiki/XY_problem\">#xy</a>?</p>",
        "id": 542014498,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1759146189
    },
    {
        "content": "<p>I want to try to extract the smallest (AST-size) term equivalent to original proof goal from <code>grind</code>'s e-graph.</p>",
        "id": 542016624,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1759146768
    }
]