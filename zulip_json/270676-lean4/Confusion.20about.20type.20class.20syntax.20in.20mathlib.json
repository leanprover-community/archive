[
    {
        "content": "<p>Hi! In <em>Theorem Proving In Lean</em>, I got familiar with the concept of type classes. However, in Mathlib documentations, I see an unfamiliar syntax:</p>\n<p>class <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Ring/Subring/Defs.html#SubringClass\">SubringClass</a> (looksS : <a href=\"https://leanprover-community.github.io/mathlib4_docs/foundational_types.html\">Type</a> u_1) (R : <a href=\"https://leanprover-community.github.io/mathlib4_docs/Init/Prelude.html#outParam\">outParam</a> <a href=\"https://leanprover-community.github.io/mathlib4_docs/foundational_types.html\">(Type</a> u)) [<a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Ring/Defs.html#Ring\">Ring</a> R] [<a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/SetLike/Basic.html#SetLike\">SetLike</a> S R] extends <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Ring/Subsemiring/Defs.html#SubsemiringClass\">SubsemiringClass</a> S R, <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Group/Subgroup/Defs.html#NegMemClass\">NegMemClass</a> S R :</p>\n<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/foundational_types.html\">Prop</a></p>\n<p>What's the <strong>Prop</strong> in the end doing? It seems like the output type of some function, but that doesn't make sense for a typeclass.</p>\n<p>Thank you.</p>",
        "id": 484575476,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1732646753
    },
    {
        "content": "<p>the function in question is the class itself</p>",
        "id": 484597137,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1732655511
    },
    {
        "content": "<p><code>SubringClass</code> is a function which takes a bunch of types and \"returns\" a proposition asserting that those types have the structure of a subring</p>",
        "id": 484597248,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1732655553
    },
    {
        "content": "<p>in general, type constructors are functions too, e.g. <code>List</code> is a function with the type <code>List : Type -&gt; Type</code>, because <code>List A</code> is a <code>Type</code> given <code>A : Type</code></p>",
        "id": 484597394,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1732655620
    },
    {
        "content": "<p>And <code>class</code> is just the same thing as <code>@[class] structure</code>, i.e. it's a data type constructor together with an annotation which makes it work with the typeclass inference mechanism</p>",
        "id": 484597656,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1732655720
    },
    {
        "content": "<p>(The <code>class</code> keyword turns out to have some other effects too <span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span>, like it changes the binders for the <code>self</code> parameter for projections to be inst implicit, and it causes parent projections to become instances.)</p>",
        "id": 484603805,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1732658550
    },
    {
        "content": "<p>(that's not the only lie I wrote above)</p>",
        "id": 484604153,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1732658746
    },
    {
        "content": "<p>Thanks. That seems complicated, and I didn't see documentations for this feature. Also sometimes I see more complicated return types (for example, sort u) for type classes. How should I understand such declarations in mathlib4 documentations?</p>",
        "id": 484623270,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1732670696
    },
    {
        "content": "<p>If you replace <code>class</code> with <code>def</code> and remove the <code>extends SubsemiringClass S R, NegMemClass S R</code>, the syntax would look familiar, right? It's saying what the resulting type of the type is.</p>\n<p>The <code>inductive</code> command has similar syntax: <a href=\"https://lean-lang.org/doc/reference/latest//The-Lean-Language/The-Type-System/#inductive-declarations\">https://lean-lang.org/doc/reference/latest//The-Lean-Language/The-Type-System/#inductive-declarations</a> (it's described briefly in the second paragraph).</p>\n<p>The section on structures doesn't yet mention it, but it's in the syntax description itself: <a href=\"https://lean-lang.org/doc/reference/latest//The-Lean-Language/The-Type-System/#structures\">https://lean-lang.org/doc/reference/latest//The-Lean-Language/The-Type-System/#structures</a></p>",
        "id": 484623756,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1732671074
    },
    {
        "content": "<p>The syntax</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n</code></pre></div>\n<p>is sort of short for</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"kn\">where</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n</code></pre></div>\n<p>By explicitly putting <code>Prop</code> there, you make sure it's a proposition. Instances of the class are proofs â€” they're proofs that are automatically inferred using the typeclass system.</p>\n<p>(It's a small lie that it's like it puts <code>Type _</code> there. It actually puts <code>Sort _</code> there and then later decides whether to use <code>Type _</code> or <code>Prop</code> based on some heuristics.)</p>",
        "id": 484624068,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1732671360
    },
    {
        "content": "<p>Thanks. What is an instance of a class? Is it a structure containing all the related functions needed to instantiate the type class? How does lean handle type coercion between universes? A Prop is also a Type _, right? So what's the point of putting Prop instead of Type _?</p>",
        "id": 484624556,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1732671660
    }
]