[
    {
        "content": "<p>Here is not minimal but small working example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">qwe</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">))</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">qwe</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">qwe</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>Here <code>simp</code> failing. For some reason <code>simp only</code> is working. But I want to avoid <code>zeta</code> reduction. But <code>simp -zeta only</code> doesn't work. Also any my attempt to use <code>Prod.snd</code> failed. I also tried to write theorem:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Prod_snd</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">snd</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>and use this theorem with no success. Any explanation?</p>",
        "id": 572818488,
        "sender_full_name": "Pavel Klimov",
        "timestamp": 1770652285
    },
    {
        "content": "<p>What do you mean by \"<code>simp</code> failing\"? <code>simp</code> does solve this goal right away and you get an error on <code>rfl</code> because there are no more goals to be solved.</p>",
        "id": 572819928,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1770652610
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"395550\">Henrik Böving</span> <a href=\"#narrow/channel/270676-lean4/topic/Why.20simp.20doesn't.20simplify.20projection.3F/near/572819928\">писал/а</a>:</p>\n<blockquote>\n<p>What do you mean by \"<code>simp</code> failing\"? <code>simp</code> does solve this goal right away and you get an error on <code>rfl</code> because there are no more goals to be solved.</p>\n</blockquote>\n<p>I mean this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"ss\">`simp</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">made</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">progress</span>\n</code></pre></div>",
        "id": 572820197,
        "sender_full_name": "Pavel Klimov",
        "timestamp": 1770652677
    },
    {
        "content": "<p>This doesn't happen on the versions available on <a href=\"http://live.lean-lang.org\">live.lean-lang.org</a>.</p>",
        "id": 572821068,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1770652855
    },
    {
        "content": "<p>What's the output of <code>#version</code> for you?</p>",
        "id": 572821258,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1770652894
    },
    {
        "content": "<p>Hmm! In clean file simp does stuff. Interesting! Looks like definition of simproc using <code>simproc</code> is adding it into simp by default? Is there a way to avoid adding it, and use manually?</p>",
        "id": 572821289,
        "sender_full_name": "Pavel Klimov",
        "timestamp": 1770652902
    },
    {
        "content": "<p>If I use <code>simp -zeta [-mySimProc]</code> where <code>mySimProc</code> is my custom <code>simproc</code>, it works as I wanted. Is there a way to not add <code>simproc</code> into default list?</p>",
        "id": 572822549,
        "sender_full_name": "Pavel Klimov",
        "timestamp": 1770653166
    },
    {
        "content": "<p>Oh, sorry, even though it's not failing, it's still not reducing <code>.2</code> projection <span aria-label=\"frown\" class=\"emoji emoji-1f641\" role=\"img\" title=\"frown\">:frown:</span> .</p>",
        "id": 572822855,
        "sender_full_name": "Pavel Klimov",
        "timestamp": 1770653235
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"900336\">Pavel Klimov</span> <a href=\"#narrow/channel/270676-lean4/topic/Why.20simp.20doesn't.20simplify.20projection.3F/near/572821289\">said</a>:</p>\n<blockquote>\n<p>Is there a way to avoid adding it, and use manually?</p>\n</blockquote>\n<p>Change the <code>simproc</code> to <code>simproc_decl</code></p>",
        "id": 572839329,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1770656759
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"246273\">Bhavik Mehta</span> <a href=\"#narrow/channel/270676-lean4/topic/Why.20simp.20doesn't.20simplify.20projection.3F/near/572839329\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"900336\">Pavel Klimov</span> <a href=\"#narrow/channel/270676-lean4/topic/Why.20simp.20doesn't.20simplify.20projection.3F/near/572821289\">said</a>:</p>\n<blockquote>\n<p>Is there a way to avoid adding it, and use manually?</p>\n</blockquote>\n<p>Change the <code>simproc</code> to <code>simproc_decl</code></p>\n</blockquote>\n<p>Can you elaborate on what this is?</p>",
        "id": 572861219,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1770663020
    },
    {
        "content": "<p>In brief, <code>simproc</code> = <code>simproc_decl</code> but also turn it on by default</p>",
        "id": 572872147,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1770666385
    },
    {
        "content": "<p>As opposed to?</p>",
        "id": 572888128,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1770671733
    },
    {
        "content": "<p>Well, <code>simproc_decl</code> is a raw simplification procedure declaration that you can refer to in <code>simp</code> calls and <code>simproc</code> is like <code>simproc_decl</code> + <code>@[simp]</code>, i.e. it is a simplification procedure that is used by default in <code>simp [...]</code> calls (although not in <code>simp only</code> calls).</p>",
        "id": 572892367,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1770673243
    },
    {
        "content": "<p><code>simproc_decl</code> will make the simproc for you to use later in simp calls (in the same way that <code>lemma</code> makes a lemma for you), but <code>simproc</code> will make the simproc, and also mark it <code>@[simp]</code> (in the same way that <code>@[simp] lemma</code> does)</p>",
        "id": 572893187,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1770673560
    }
]