[
    {
        "content": "<p>If I have a pre-built version of one of the dependencies in <code>lake-manifest.lean</code>, is there any way to inject that into Lean LSP's running environment?</p>\n<p>The use case is this: If I can pre-build a giant dependency like Mathlib, any user of my library can simply fetch that dependency and store it in somewhere convenient like <code>/nix</code>, and doesn't have to take 3 hours for their LSP to fire up for the first time.</p>\n<p>I think this will involve suppressing the <code>Replay</code> function in <code>src/lake/Lake/build/Job.lean</code></p>",
        "id": 482539207,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1731651031
    },
    {
        "content": "<p>This is certainly possible, because we do that with mathlib using <code>lake exe cache get</code>. You will have to distribute the <code>olean</code> files of your pre-built version.</p>",
        "id": 482544298,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1731654101
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/channel/270676-lean4/topic/Caching.20.2Elake/near/482544298\">said</a>:</p>\n<blockquote>\n<p>This is certainly possible, because we do that with mathlib using <code>lake exe cache get</code>. You will have to distribute the <code>olean</code> files of your pre-built version.</p>\n</blockquote>\n<p>Are both <code>.olean</code> and <code>.ilean</code> files required?</p>\n<p>From what I read in the <code>lake</code> <code>README.md</code>, it seems like I need to add the <code>.olean</code>/<code>.ilean</code> tree to <code>LEAN_PATH</code> and the Lean src tree to <code>LEAN_SRC_PATH</code></p>",
        "id": 482544595,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1731654267
    },
    {
        "content": "<p>I do not know whether both <code>olean</code>s and <code>ilean</code>s are needed, but the former contain most of the <code>Expr</code> information, while the latter contain \"hover\" information (and should be <em>much</em> smaller in size).  Even if you <em>could</em> get away with just the <code>olean</code>s, I suspect that you would have a much better experience having both.</p>",
        "id": 482547410,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731655728
    },
    {
        "content": "<p>You need absolutely everything in <code>.lake/build</code>, otherwise <code>lake build</code> will say \"oh, my <code>.trace</code>/<code>.hash</code>/<code>.c</code>/... files are missing, better rebuild the universe\"</p>",
        "id": 482591383,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731670196
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/270676-lean4/topic/Caching.20.2Elake/near/482591383\">said</a>:</p>\n<blockquote>\n<p>You need absolutely everything in <code>.lake/build</code>, otherwise <code>lake build</code> will say \"oh, my <code>.trace</code>/<code>.hash</code>/<code>.c</code>/... files are missing, better rebuild the universe\"</p>\n</blockquote>\n<p>so if I have a pre-built version of <code>.lake/build</code>, I should put it in <code>LEAN_PATH</code>?</p>",
        "id": 482675494,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1731696730
    },
    {
        "content": "<p>In <a href=\"https://github.com/leanprover/lean4/blob/master/src/lake/README.md\">Lake's documentation</a>, it says</p>\n<blockquote>\n<p>This search path can be augmented by including other directories of Lean libraries in the <code>LEAN_PATH</code> environment variable (and their sources in <code>LEAN_SRC_PATH</code>).</p>\n</blockquote>\n<p>but it doesn't say what needs to go into <code>LEAN_PATH</code> and <code>LEAN_SRC_PATH</code>.</p>",
        "id": 482723921,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1731723291
    }
]