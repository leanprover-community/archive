[
    {
        "content": "<p>New lean user here. Just got hit with this super confusing error message that was highlighting code far away from the actual error.<br>\nMy expected behaviour would be and error or warning message on the inductive type declaration. I dont understand why this is even valid syntax with the upper case 'W'.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c\">/-</span>\n<span class=\"cm\"> The 'W' in 'Where' should be lower case. Fixing it clears the error at the bottom.</span>\n<span class=\"cm\">-/</span>\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">MyResult</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">Where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Ok</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">MyResult</span><span class=\"w\"> </span><span class=\"n\">α</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Err</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">MyResult</span><span class=\"w\"> </span><span class=\"n\">α</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Monad</span><span class=\"w\"> </span><span class=\"n\">MyResult</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">Ok</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"n\">bind</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">Ok</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">Err</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">Err</span><span class=\"w\"> </span><span class=\"n\">s</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">myResultProg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MyResult</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">MyResult</span><span class=\"bp\">.</span><span class=\"n\">Ok</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"bp\">-</span><span class=\"mi\">10</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">MyResult</span><span class=\"bp\">.</span><span class=\"n\">Err</span><span class=\"w\"> </span><span class=\"s2\">\"x must be greater than 10\"</span>\n<span class=\"w\">  </span><span class=\"n\">MyResult</span><span class=\"bp\">.</span><span class=\"n\">Ok</span><span class=\"w\"> </span><span class=\"n\">a</span>\n\n<span class=\"c\">/-</span>\n<span class=\"cm\">[error][lake][Lean 4] declaration `_eval` contains universe level metavariables at the expression</span>\n<span class=\"cm\">    repr.{?u.23296} (myResultProg.{?u.23296} 9)</span>\n<span class=\"cm\">in the declaration body</span>\n<span class=\"cm\">    repr.{?u.23296} (myResultProg.{?u.23296} 9)</span>\n<span class=\"cm\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">myResultProg</span><span class=\"w\"> </span><span class=\"mi\">9</span>\n</code></pre></div>\n<p>Lean version 4.24.0</p>",
        "id": 565912938,
        "sender_full_name": "Christopher Lang",
        "timestamp": 1767198528
    },
    {
        "content": "<p>There Where is interpreted as a universe level variable for <code>MyResult</code>, which you can tell by hovering over it or running <code>#check MyResult</code>. The reason for this is that the <code>where</code> is not obligatory and the syntax can thus also be parsed as <code>Type Where</code>.</p>\n<p>This seems like quite an annoying UX bug to me, please do open an issue on lean4.</p>",
        "id": 565913242,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1767198741
    },
    {
        "content": "<p>Issue submitted<br>\n<a href=\"https://github.com/leanprover/lean4/issues/11853\">https://github.com/leanprover/lean4/issues/11853</a></p>",
        "id": 565920946,
        "sender_full_name": "Christopher Lang",
        "timestamp": 1767204462
    }
]