[
    {
        "content": "<p>There's some previous discussion about this, but it's a little hard to search for.</p>\n<h2>Background</h2>\n<p>A strange complexity in basic Lean tactics is <code>intros</code>. The <code>intros</code> tactic with no argument introduces all obvious hypotheses, but then <code>intros x y z</code> is the same as <code>intro x y z</code>, while being a little worse since it doesn't support everything <code>intro</code> can do. Plus, it suddenly stops introducing all obvious hypotheses.</p>\n<h2>Proposed change</h2>\n<p>I'm proposing here that <code>intros x y z</code> should be a macro for <code>intro x y z; intros</code>. The effect of this is that <code>intros</code> will introduce each of the given hypotheses, even if it takes unfolding, and then introduce all the obvious hypotheses, if any remain.</p>\n<h2>Benefits and costs</h2>\n<p>The change to <code>intros</code> has the following benefits:</p>\n<ul>\n<li>Now <code>intros x y z</code> isn't a synonym for <code>intro x y z</code></li>\n<li>Now writing <code>x</code> in<code> intros x</code> doesn't make all the hypotheses in the local context suddenly disappear, which makes for a less-janky experience</li>\n<li>My impression is that users are confused by the role of <code>intros</code> and will benefit from a clearer distinction between the tactics</li>\n</ul>\n<p>It is a breaking change, but the remediation is to use <code>intro</code> instead of <code>intros</code>, which is easy to do. Instances of <code>intros</code> without introducing all obvious hypotheses do occur, but I expect it to be the minority.</p>\n<h2>Other designs</h2>\n<p>We could disallow <code>intros</code>-with-arguments and instead require <code>intro x y z; intros</code>. This is makes the distinction between the tactics even clearer, but it's more backwards incompatible, and also it's less convenient than being able to add arguments directly to <code>intros</code>.</p>\n<p>We could remove <code>intros</code> and instead have ellipsis syntax on <code>intro</code>, like <code>intro x y z ..</code>. One reason not to is that we may want <code>intro x y z ..</code> to be a macro for <code>intro x y z; repeat intro</code>, that is, it would eagerly introduce even <em>non</em>-obvious hypotheses that require the goal to be unfolded. Whichever way ellipses would work, a conservative approach is to change <code>intros</code> itself.</p>\n<h2>Reference PR</h2>\n<p><a href=\"https://github.com/leanprover/lean4/pull/9943\">lean4#9943</a></p>",
        "id": 534778271,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1755369163
    },
    {
        "content": "<p>I forgot <code>intros</code> was a thing, so I'd go with your last alternative instead. But I'm fine with anything, really</p>",
        "id": 534778470,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1755369446
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/270676-lean4/topic/Mini-RFC.3A.20have.20.60intros.20x.20y.20z.60.20be.20.60intro.20x.20y.20z.3B.20intros.60/near/534778271\">said</a>:</p>\n<blockquote>\n<p>We could remove <code>intros</code> and instead have ellipsis syntax on <code>intro</code>, like <code>intro x y z ..</code>. One reason not to is that we may want <code>intro x y z ..</code> to be a macro for <code>intro x y z; repeat intro</code>, that is, it would eagerly introduce even <em>non</em>-obvious hypotheses that require the goal to be unfolded. Whichever way ellipses would work, a conservative approach is to change <code>intros</code> itself.</p>\n</blockquote>\n<p>Stupid suggestion: What about having two ellipses, depending on how unobvious we want the variable introductions to be? I am thinking something like <code>intro x y z ..</code> vs <code>intro x y z ..!</code></p>",
        "id": 534780048,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1755371776
    },
    {
        "content": "<p>Personally, I would much prefer <code>intros</code> goes away entirely, as it would reduce the API surface with little to no loss of functionality in practice (who uses <code>intros</code>? who does so to introduce only non-obvious hypotheses?)</p>",
        "id": 534780102,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1755371857
    },
    {
        "content": "<p><code>intros; some_tactic</code> is fairly common. You can find it in many structure/instance fields, as a way to automate some trivial arguments.</p>\n<p>The larger question of \"should the tactic exist\" is valid, but I think that's too disruptive to carry out (at least that will take more time than iI can put into this!). The RFC is low disruption while making the existing tactic more useful, I think.</p>",
        "id": 534780712,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1755372668
    },
    {
        "content": "<p>The ellipsis variation idea is interesting. There's also messing with <code>with_reducible</code>, though you can't completely disable unfolding that way.</p>",
        "id": 534780757,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1755372731
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/stream/270676-lean4/topic/Mini-RFC.3A.20have.20.60intros.20x.20y.20z.60.20be.20.60intro.20x.20y.20z.3B.20intros.60/near/534780102\">said</a>:</p>\n<blockquote>\n<p>Personally, I would much prefer <code>intros</code> goes away entirely, as it would reduce the API surface with little to no loss of functionality in practice (who uses <code>intros</code>? who does so to introduce only non-obvious hypotheses?)</p>\n</blockquote>\n<p>I use <code>intros</code>, though for no particular reason, just muscle memory. It's been around since Lean 3, right? <span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> could you briefly describe the \"being a little bit worse aspect\"? I've been using it for years and never really thought about the difference, so maybe I am the target confused user!</p>",
        "id": 534781828,
        "sender_full_name": "Chris Henson",
        "timestamp": 1755374424
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"687698\">@Chris Henson</span> It's missing patterns, like <code>intro (x, y)</code>, and it's missing type ascriptions, like <code>intro (h : p)</code>.</p>\n<p>Eliminating these small differences -- and avoiding duplicate tactic elaboration code -- is a motivation for this RFC. Another motivation is that <code>intros</code> bugged me again recently :-)</p>",
        "id": 534782057,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1755374726
    },
    {
        "content": "<p>That makes sense, thanks! I then agree with <span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span> that the ideal would be to eliminate it completely, but given the time/disruption constraints support your idea of making it a macro.</p>",
        "id": 534782198,
        "sender_full_name": "Chris Henson",
        "timestamp": 1755374966
    },
    {
        "content": "<p>Could we make it a (lint) error to write <code>intros x y</code> when it means <code>intro x y</code>?</p>",
        "id": 534783692,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755377189
    },
    {
        "content": "<p>As an aside, I have an <code>intros?</code> tactic that expands to <code>intro x y</code></p>",
        "id": 534783745,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755377251
    },
    {
        "content": "<p>If you are tweaking intro(s) then could you consider making my dream come true and get rid of the <code>intro</code> vs <code>rintro</code> dichotomy?</p>",
        "id": 534784735,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1755378670
    },
    {
        "content": "<p>That dream is a bit tough to realize <span class=\"user-mention\" data-user-id=\"110031\">@Patrick Massot</span>, since <code>rintro</code> uses rcases patterns, but <code>intro</code> uses <code>match</code> patterns.</p>\n<p>Are there features of <code>rintro</code> that <code>intro</code> could support that would approximate your dream? One that comes to mind is <code>rfl</code> patterns, which <code>intro</code> doesn't have a good analogue for (you can do <code>intro (.refl _)</code>, but it can do the wrong thing depending on the whether it's <code>x = 1</code> or <code>1 = x</code>).</p>",
        "id": 534836284,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1755451826
    },
    {
        "content": "<p>I understand those are not the same. The dream is to  have a unified version. And indeed the main missing thing is  the <code>rfl</code> pattern.</p>",
        "id": 534836524,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1755452100
    },
    {
        "content": "<p>I know you know the difference :-) What I was intending to mean by this is that the difference looks too big to unify to me. Maybe you have an idea how it could look?</p>\n<p>In any case, a version of <code>intro</code> with <code>rfl</code> patterns is on the merge queue. This is potentially a mistake since the rfl patterns can't be used recursively (e.g. <code>intro ⟨rfl, rfl⟩</code> won't work, just <code>intro rfl</code>) but perhaps it's a step toward <code>match</code> supporting <code>rfl</code> patterns, or toward a unified <code>intro</code>/<code>rintro</code>.</p>",
        "id": 534961093,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1755526469
    },
    {
        "content": "<p>The biggest gap between rcases patterns and match patterns are the <code>|</code> patterns in rcases.</p>\n<p>The difficulty with trying to merge these things is that match patterns are plain <code>Term</code>s. A benefit to them being terms is that there are no subtle parsing differences between terms and patterns; any changes to <code>Term</code> syntax affects both. It's helpful for metaprogramming too, since you don't need to convert a <code>Term</code> to a \"<code>Pattern</code>\". Plus, any macros defined for <code>Term</code>s apply to patterns as well. (In <a href=\"https://letoverlambda.com/index.cl/guest/chap3.html#sec_7\">LoL</a>, Hoyte calls this general principle \"duality of syntax\"; that section discusses lexical vs dynamic variables, but in the book he tends to use it more generally as \"syntax that can be used in multiple contexts with different semantics\"). The downside is that every pattern-only syntax must be a <code>Term</code> as well, even if it has no term interpretation. E.g. <code>@</code> outside of a pattern gives an elaboration error.</p>\n<p>It would be nice if there were a way to have a syntax category that's temporarily extensible. Imagine if <code>Pattern</code> were the <code>term</code> category, plus some additional <code>term</code> parsers. The key here is that all the existing <code>term</code> parsers that recursively refer to <code>term</code> would then implicitly be extended with these pattern parsers. It's as if every <code>term</code> parser has an implicit argument for how to parse <code>term</code>s — so parameterized parsers — and then this can be swapped out.</p>",
        "id": 534978990,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1755532084
    },
    {
        "content": "<p>The reason for thinking in that direction is that <code>|</code> patterns can't be normal terms, since they'd cause issues for <code>|</code> in syntax like <code>match</code>.</p>\n<p>However, maybe it's possible to use <code>|</code> anyway: we could make the syntax be <code>\"(\" term|+ \")\"</code>, with parentheses. You just wouldn't be able to write things like <code>intro ⟨h1|h1', h2|h2'⟩</code>. It would have to be <code>intro ⟨(h1|h1'), (h2|h2')⟩</code>. Maybe that's better, since then both sorts of pattern syntaxes are bracketed?</p>",
        "id": 534978999,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1755532087
    },
    {
        "content": "<p>If the syntax were <code>\"(\" (term?)|+ \")\"</code>, this syntax could also be used for anonymous constructors, like <code>(h |)</code> and <code>(h |)</code> for <code>Or.inl h</code> and <code>Or.inr h</code>, which is interesting. If there are more than two alternatives, you'd have to be sure to add spaces, like <code>(| | h)</code>, since <code>||</code> and <code>|||</code> are already operators. I'd worry that there are people using brackets out there (<code>(| ... |)</code>) that would be affected.</p>\n<p>I guess the notation could special case placeholders instead, like <code>(h | _)</code>, instead of using optional terms.</p>",
        "id": 534980237,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1755532481
    },
    {
        "content": "<p>I always write <code>(h₁ | h₂)</code> for clarity anyway.</p>",
        "id": 534980375,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1755532526
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/270676-lean4/topic/Mini-RFC.3A.20have.20.60intros.20x.20y.20z.60.20be.20.60intro.20x.20y.20z.3B.20intros.60/near/534780102\">said</a>:</p>\n<blockquote>\n<p>who uses <code>intros</code>?</p>\n</blockquote>\n<p>I recently switched over from using Rocq (Coq) to using Lean and wound up using intros because that's what the corresponding rocq tactic is named. Nothing in the <code>intros</code> documentation (at least, what the LSP pulls up) suggests that <code>intro</code> should be used instead of <code>intros</code>, though from reading through this thread, it looks like I should swap over my usages to <code>intro</code>.</p>",
        "id": 535046140,
        "sender_full_name": "neil",
        "timestamp": 1755570953
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"931836\">@neil</span> The <code>intros</code> tactic has basically been forgotten for years. I looked deeper into the history, and <code>intros</code>-with-arguments was effectively replaced by <code>intro</code> back in 2020.</p>\n<p>Timeline:</p>\n<ul>\n<li>2014: <code>intros</code> was added to Lean 2, with roughly its current features (though with no arguments it used whnf), and <code>intro x</code> (with only one argument!) was a synonym for <code>intros x</code>. A year later, argument-free <code>intro</code> was introduced.</li>\n<li>2016: <code>intro</code> and <code>intros</code> were added to Lean 3, and, like Coq, argument-free <code>intros</code> no longer used whnf. Note that Lean 2 and 3 tended to have singular and plural versions of commands (e.g. <code>variable</code> and <code>variables</code>). The <code>intro</code> tactic could only accept zero or one argument, and <code>intros</code> could accept zero or more.</li>\n<li>2020: Lean 4 got an implementation of <code>intros</code>, which matched the behavior of the Lean 3 tactic. A few months later, <code>intro</code> was generalized to accept any number of arguments. Indeed, in 2021, Lean 4 did away with singular/plural for commands like <code>variable</code>.</li>\n</ul>",
        "id": 535053188,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1755577909
    },
    {
        "content": "<p>Given the feedback so far, this history, and Lean 4's convergence to the singular, it seems to me that the plan should be to</p>\n<ul>\n<li>implement <code>intro ..</code> or <code>intro *</code> (syntax TBD) to do what <code>intros</code> now does, possibly with some mild reduction (maybe it would be better if it unfolded abbreviations — after all, the implicit lambda feature unfolds the expected type); then</li>\n<li>deprecate <code>intros</code>, leaving it in its current form until it is eventually removed.</li>\n</ul>",
        "id": 535053192,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1755577910
    },
    {
        "content": "<p>(If we use <code>..</code>, it would be nice if <code>fun</code> supported it too for consistency/predictability! In fact, I already occasionally find myself reaching for it based on the current usage of <code>..</code>.)</p>",
        "id": 535154016,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1755617070
    }
]