[
    {
        "content": "<p>Could we have a better error message in</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"foo\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">try</span>\n<span class=\"w\">    </span><span class=\"n\">evalTactic</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span><span class=\"n\">skip</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"n\">try</span>\n<span class=\"w\">      </span><span class=\"n\">evalTactic</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span><span class=\"n\">skip</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"n\">catch</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"n\">throwError</span><span class=\"w\"> </span><span class=\"s2\">\"One\"</span>\n<span class=\"w\">  </span><span class=\"n\">catch</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">     </span><span class=\"n\">throwError</span><span class=\"w\"> </span><span class=\"s2\">\"Two\"</span>\n</code></pre></div>",
        "id": 573235708,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1770801826
    },
    {
        "content": "<p>Here Lean complains on the first <code>try</code> that <code>invalid `try`, it must have a `catch` or `finally` </code>, which seems pretty unfair to me.</p>",
        "id": 573235992,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1770801901
    },
    {
        "content": "<p>To be honest I don’t even understand why this is incorrect code.</p>",
        "id": 573236049,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1770801920
    },
    {
        "content": "<p>It's likely associating both <code>catch</code> to the first <code>try</code>, that would be a parser bug</p>",
        "id": 573248017,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1770805265
    },
    {
        "content": "<p>I encountered this recently too. I had to resort to doing <code>try { try ... catch ... } catch ...</code>. I agree it is annoying.</p>",
        "id": 573249313,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1770805646
    },
    {
        "content": "<p>This is <a href=\"https://github.com/leanprover/lean4/pull/8220\">lean4#8220</a>. I have a fix but it's unfortunately a bit more complicated than I would've hoped it to be. And for anyone wondering, the complicated cases are:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"bp\">...</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">  </span><span class=\"bp\">...</span>\n<span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">try</span>\n<span class=\"w\">  </span><span class=\"bp\">...</span>\n<span class=\"n\">catch</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"bp\">...</span>\n</code></pre></div>\n<p>and</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">try</span>\n<span class=\"w\">  </span><span class=\"bp\">...</span>\n<span class=\"n\">catch</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"bp\">...</span>\n</code></pre></div>",
        "id": 573258993,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1770808512
    },
    {
        "content": "<p>Thanks! Yaël, could you please upvote that bug report?</p>",
        "id": 573328596,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1770826304
    }
]