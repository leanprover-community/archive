[
    {
        "content": "<p>In the same vain of Rust's <code>Vec::new_with_capacity</code>, would it make sense for Lean core to provide <code>Array.mkWithCapacity</code> and <code>ByteArray.mkWithCapacity</code>? I know I can create those locally in C, but I believe this is something more ppl can benefit from (potentially even core itself), as avoiding reallocations+copies when possible is strictly better.</p>",
        "id": 504252925,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1741423066
    },
    {
        "content": "<p>That's Array.mkEmpty</p>",
        "id": 504253518,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1741423496
    },
    {
        "content": "<p><code>Array.mkEmpty</code> spends time setting data to a value. I would like to avoid that</p>",
        "id": 504253830,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1741423747
    },
    {
        "content": "<p>That is, just allocate with junk from memory, but with size=0</p>",
        "id": 504253931,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1741423819
    },
    {
        "content": "<p>I don't follow, it's a straight call to <code>lean_alloc_array</code></p>",
        "id": 504254137,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1741424012
    },
    {
        "content": "<p>Hm, I will double check. Maybe I'm confused</p>",
        "id": 504254380,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1741424164
    },
    {
        "content": "<p>Aha! I was indeed confused. There's <code>mkEmpty</code> and <code>mkArray</code>. Thanks!</p>",
        "id": 504254968,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1741424634
    },
    {
        "content": "<p>I think it might be nice to include these in the docstring to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Array#doc\">docs#Array</a>. There's already a discussion of capacities there, so it's natural. (Plus, I tend to forget the name of <code>Array.mkEmpty</code>, so it would be nice to have a quick way to look it up.)</p>",
        "id": 504301831,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1741456865
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/7430\">lean#7430</a></p>",
        "id": 504695712,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1741644073
    },
    {
        "content": "<p>I've been wondering whether it would be worth it to break <code>Array.empty</code> just a tiny bit by adding a capacity argument with default value, that way it'd be a bit closer to what we have in Std's containers like HashMap and TreeMap now</p>",
        "id": 504697106,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1741644648
    },
    {
        "content": "<p>Actually I was thinking of renaming <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Std.HashMap.empty#doc\">docs#Std.HashMap.empty</a> to something like <code>Std.HashMap.withCapacity</code> or <code>Std.HashMap.emptyWithCapacity</code> so that there is no longer a naming conflict between the <code>empty</code> function and the <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=EmptyCollection#doc\">docs#EmptyCollection</a> notation, which is also called <code>empty</code> in identifiers.</p>",
        "id": 504761423,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1741678518
    },
    {
        "content": "<p>Now that you mentioned it, I am extra encouraged to say that I quite like that Rust's APIs have the word \"capacity\" explicit on related symbols</p>",
        "id": 504779799,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1741684165
    },
    {
        "content": "<p><code>emptyWithCapacity</code> everywhere sounds great!</p>",
        "id": 504780082,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1741684243
    },
    {
        "content": "<p>I mean, I overlooked <code>mkEmpty</code> for a reason. It would have been a better experience if the LSP had found it for me when I typed \"Array.capac\"</p>",
        "id": 504784877,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1741685495
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/7445\">lean#7445</a> does the rename for <code>Array</code> (also <code>ByteArray</code> and <code>FloatArray</code>).</p>",
        "id": 505007641,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1741746183
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/7446\">lean#7446</a> replaces some <code>.empty</code>s with <code>∅</code></p>",
        "id": 505008370,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1741746355
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/7447\">lean#7447</a> does <code>HashMap</code>/<code>HashSet</code>, which <span class=\"user-mention\" data-user-id=\"260921\">@Markus Himmel</span> will need to review.</p>\n<p>(Mostly this was written by Claude, with me just pressing tab. Hopefully we got it right.)</p>",
        "id": 505019034,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1741750639
    },
    {
        "content": "<p>(<a href=\"https://github.com/leanprover/lean4/pull/7445\">lean4#7445</a>, <a href=\"https://github.com/leanprover/lean4/pull/7446\">lean4#7446</a>, <a href=\"https://github.com/leanprover/lean4/pull/7447\">lean4#7447</a>)</p>",
        "id": 505020085,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1741751044
    }
]