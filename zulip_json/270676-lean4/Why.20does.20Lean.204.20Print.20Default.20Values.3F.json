[
    {
        "content": "<p>I have a question about the printing in Lean 4. Here is a minimal example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"o\">)</span>\n\n<span class=\"bp\">#</span><span class=\"n\">reduce</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">f</span>\n</code></pre></div>\n<p>I expect this code to print</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">f</span>\n</code></pre></div>\n<p>but it actually prints</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">false</span>\n</code></pre></div>\n<p>I would like to ask why this is? I should think that Lean doesn't need to print default variables if they have the default value. Furthermore, why does it on print one default value, but not the other? I don't understand this behavior. Is there anyone more familiar than myself with the inner workings of Lean 4 who knows why Lean 4 will print one of the default values, but not the other?</p>",
        "id": 453447387,
        "sender_full_name": "Atticus Kuhn",
        "timestamp": 1721748927
    },
    {
        "content": "<p>The reduction engine isn't really interested in things like default values, it is given an elaborated term and reduces it until it can't do any additional thing, then dumps what it came up with.</p>\n<p>I am a little surprised that it doesn't print the second default value. Though if you</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">pp</span><span class=\"bp\">.</span><span class=\"n\">raw</span><span class=\"w\"> </span><span class=\"n\">true</span>\n</code></pre></div>\n<p>You will get the expected term, this hints at a bug in the delaborator that you might want to open an issue about in the Lean 4 repository.</p>\n<p>That said <code>#reduce</code> is almost never the solution you are looking for, what exactly are you trying to achieve? <a href=\"https://en.wikipedia.org/wiki/XY_problem\">#xy</a>.</p>",
        "id": 453450581,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1721749901
    },
    {
        "content": "<p>See also <a href=\"#narrow/stream/113488-general/topic/Printing.20of.20multiple.20optional.20argument/near/453425483\">here</a>.</p>",
        "id": 453451484,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1721750083
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"395550\">Henrik Böving</span> <a href=\"#narrow/stream/270676-lean4/topic/Why.20does.20Lean.204.20Print.20Default.20Values.3F/near/453450581\">said</a>:</p>\n<blockquote>\n<p>That said <code>#reduce</code> is almost never the solution you are looking for, what exactly are you trying to achieve? <a href=\"https://en.wikipedia.org/wiki/XY_problem\">#xy</a>.</p>\n</blockquote>\n<p>You're probably right that this is an xy-problem. What I really have is that I have a series of <code>guard_msg</code>s. I added a default argument, expecting it not to break the <code>guard_msg</code>s, but it actually did for the reason above.</p>",
        "id": 453458988,
        "sender_full_name": "Atticus Kuhn",
        "timestamp": 1721751481
    },
    {
        "content": "<p>I see, then you'll have to wait until the bug linked by Michael is fixed I'm afraid :/</p>",
        "id": 453459793,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1721751613
    },
    {
        "content": "<p>In that thread, <a href=\"#narrow/stream/113488-general/topic/Printing.20of.20multiple.20optional.20argument/near/453465541\">here</a> is an explanation of the current situation. The pretty printer only considers omitting the last optional argument.</p>\n<p>I want to fix it, but it's been low priority. The current behavior is an approximation rather than a bug. I think a fix would be to collect another array recording which arguments could be omitted and then to compute in the end which arguments actually can be.</p>\n<p>This is what it should do, which I think illustrates the mild complexity of the problem:</p>\n<ul>\n<li><code>a.f false false</code> -&gt; <code>a.f</code></li>\n<li><code>a.f false true</code> -&gt; <code>a.f false true</code></li>\n<li><code>a.f true false</code> -&gt; <code>a.f true</code></li>\n<li><code>a.f true true</code> -&gt; <code>a.f true true</code></li>\n</ul>\n<p>One could also wonder whether it should do</p>\n<ul>\n<li><code>a.f false true</code> -&gt; <code>a.f (b2 := true)</code></li>\n</ul>",
        "id": 453467056,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1721753767
    }
]