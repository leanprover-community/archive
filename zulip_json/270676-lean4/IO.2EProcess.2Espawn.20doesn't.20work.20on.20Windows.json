[
    {
        "content": "<p>I was trying to use <span class=\"user-mention\" data-user-id=\"303675\">@Anand Rao Tadipatri</span>'s amazing lean-slides, but I couldn't get anything working. After some work, we managed to minimise it to the follow, which has nothing to do with lean-slides:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"s2\">\"Running a test command ...\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">Process</span><span class=\"bp\">.</span><span class=\"n\">spawn</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"dir\"</span>\n<span class=\"w\">  </span><span class=\"o\">}</span>\n</code></pre></div>",
        "id": 524864822,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1750332442
    },
    {
        "content": "<p>This works just fine in eg the web editor, but on my Windows machine it fails with <code>no such file or directory (error code: 2)</code></p>",
        "id": 524864923,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1750332483
    },
    {
        "content": "<p>Is <code>dir</code> actually a binary and not just a built-in shell command under windows? Have you tried executing anything where you actually know that it exists as a binary file on your machine (maybe even just lean --help)</p>",
        "id": 524866245,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1750333022
    },
    {
        "content": "<p>You talk funny words, but I think what you mean is the following :-)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"k\">do</span><span class=\"w\"> </span><span class=\"c1\">-- no such file or directory (error code: 2)</span>\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"s2\">\"Running a test command ...\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">Process</span><span class=\"bp\">.</span><span class=\"n\">spawn</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"lean --help\"</span>\n<span class=\"w\">  </span><span class=\"o\">}</span>\n</code></pre></div>",
        "id": 524868497,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1750333912
    },
    {
        "content": "<p>Error is just the same as before</p>",
        "id": 524868523,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1750333918
    },
    {
        "content": "<p>What about</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"s2\">\"Running a test command ...\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">Process</span><span class=\"bp\">.</span><span class=\"n\">spawn</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"lean\"</span>\n<span class=\"w\">    </span><span class=\"n\">args</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"s2\">\"--help\"</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">}</span>\n</code></pre></div>",
        "id": 524868852,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1750334042
    },
    {
        "content": "<p>We have three tests that spawn processes using <code>Process.spawn</code> directly in our test suite so I really doubt something is fundamentally broken here</p>",
        "id": 524868972,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1750334095
    },
    {
        "content": "<p>Oh and one other thing, maybe it has to be <code>lean.exe</code> instead of <code>lean</code>, I'm not too famliar with windows specifics in this regard</p>",
        "id": 524869315,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1750334228
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span> are you able to run <code>dir</code> on your terminal? Because that's what the spawned process is trying to do.</p>",
        "id": 524875578,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1750336254
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"395550\">Henrik Böving</span> <a href=\"#narrow/channel/270676-lean4/topic/IO.2EProcess.2Espawn.20doesn't.20work.20on.20Windows/near/524866245\">said</a>:</p>\n<blockquote>\n<p>Is <code>dir</code> actually a binary and not just a built-in shell command under windows? Have you tried executing anything where you actually know that it exists as a binary file on your machine (maybe even just lean --help)</p>\n</blockquote>\n<p>as explained here having the ability to do that does not imply that you can Process.spawn it</p>",
        "id": 524875691,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1750336293
    },
    {
        "content": "<p>It took forever to restart the file (Windows, why <span aria-label=\"melt\" class=\"emoji emoji-1fae0\" role=\"img\" title=\"melt\">:melt:</span>), but indeed Henrik's latest suggestion works</p>",
        "id": 524875889,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1750336384
    },
    {
        "content": "<p>So my original problem is probably a bug in lean-slides</p>",
        "id": 524875990,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1750336414
    },
    {
        "content": "<p>The bit of code I'll need to modify in <code>lean-slides</code> is</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">stdioCfg</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">Process</span><span class=\"bp\">.</span><span class=\"n\">spawn</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"browser-sync\"</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">args</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"s2\">\"slides\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"--port\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">3000</span><span class=\"o\">,</span>\n<span class=\"w\">              </span><span class=\"s2\">\"--watch\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"--no-open\"</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">}</span>\n</code></pre></div>\n<p>which works fine on Linux.</p>\n<p><span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span> has confirmed that running the command</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">browser</span><span class=\"bp\">-</span><span class=\"n\">sync</span><span class=\"w\"> </span><span class=\"n\">slides</span><span class=\"w\"> </span><span class=\"c1\">--port 3000 --watch --no-open</span>\n</code></pre></div>\n<p>directly on the command line in Windows works as intended.</p>\n<p>Does anyone have any advice on how to modify the configuration to be able to spawn this process on Windows?</p>\n<p>Browsersync is installed on the system as an <code>npm</code> package: <a href=\"https://browsersync.io/\">https://browsersync.io/</a>.</p>",
        "id": 524887069,
        "sender_full_name": "Anand Rao Tadipatri",
        "timestamp": 1750339864
    },
    {
        "content": "<p>I have <a href=\"https://github.com/leanprover/lean4/pull/8547\">lean4#8547</a> and <a href=\"https://github.com/leanprover/lean4/pull/8597\">lean4#8597</a> regarding <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IO.Process.spawn#doc\">docs#IO.Process.spawn</a>. For <span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span>'s first example, what should work is:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"s2\">\"Running a test command ...\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">Process</span><span class=\"bp\">.</span><span class=\"n\">spawn</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"cmd.exe\"</span>\n<span class=\"w\">    </span><span class=\"n\">args</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"s2\">\"/c\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"dir\"</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">}</span>\n</code></pre></div>\n<p>but <a href=\"https://github.com/leanprover/lean4/pull/8547\">lean4#8547</a> makes that fail.</p>",
        "id": 524909947,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1750347390
    },
    {
        "content": "<p>I have a PR for that (<a href=\"https://github.com/leanprover-community/mathlib4/pull/8612\">#8612</a>) but we might want to transition to libuv's code instead.</p>",
        "id": 524910085,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1750347435
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/270676-lean4/topic/IO.2EProcess.2Espawn.20doesn't.20work.20on.20Windows/near/524875990\">said</a>:</p>\n<blockquote>\n<p>So my original problem is probably a bug in lean-slides</p>\n</blockquote>\n<p>How can the fact that you use Windows be a bug in lean-slides??</p>",
        "id": 524928729,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1750355729
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"873547\">@Robin Arnez</span> Thanks a lot! Switching to that library sounds promising indeed, I've reacted to both issues with a <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span> to bump up their priority.</p>",
        "id": 525007437,
        "sender_full_name": "Anand Rao Tadipatri",
        "timestamp": 1750411617
    }
]