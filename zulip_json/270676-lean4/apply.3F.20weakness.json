[
    {
        "content": "<p>Consider the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">n</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply?</span><span class=\"w\"> </span><span class=\"c1\">-- lots of unhelpful suggestions</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply?</span><span class=\"w\"> </span><span class=\"c1\">-- Try this: exact congrArg foo h</span>\n</code></pre></div>\n<p>Why does <code>apply?</code> in the first <code>example</code> not come up with <code>refine CongrArg foo ?_</code>, leaving the goal <code>a = b</code>?</p>",
        "id": 490383617,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1734868790
    },
    {
        "content": "<p>Discrimination tree?</p>",
        "id": 490385440,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1734870456
    },
    {
        "content": "<p>What is a discrimination tree and where can I read about it?</p>",
        "id": 490386707,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1734871717
    },
    {
        "content": "<p>Does the discrimination tree include information on the hypotheses in context?<br>\nNote that the only difference in the two examples is the presence or otherwise of <code>h</code>.</p>",
        "id": 490386719,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1734871733
    },
    {
        "content": "<p>Or is the reason that <code>apply?</code> tries <code>exact?</code> (and returns whatever it produces when successful) before looking at the discrimination tree?</p>",
        "id": 490386871,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1734871915
    },
    {
        "content": "<p>My motivation for asking this is the observation that when my goal is an equality of real numbers (say), then <code>apply?</code> almost never gives a useful suggestion (and if it does, it is so far down the list that I lose patience scrolling before reaching it).<br>\nCan <code>apply?</code> be made more helpful with goals like this?</p>",
        "id": 490387187,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1734872161
    },
    {
        "content": "<p>Compare also:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply?</span><span class=\"w\"> </span><span class=\"c1\">-- Try this: refine Real.exp_eq_exp.mpr ?_</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"bp\">.</span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply?</span><span class=\"w\"> </span><span class=\"c1\">-- lots of unhelpful suggestions</span>\n</code></pre></div>\n<p>Here there is a specialized lemma for <code>Real.exp</code>, which <code>apply?</code> finds (but there appears to be no lemma for <code>Real.log</code>).</p>",
        "id": 490387299,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1734872253
    },
    {
        "content": "<p>Not answering your question, but <code>congr</code> is a useful tactic here (or mathlib's version, <code>congr!</code>)</p>",
        "id": 490404657,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1734887982
    },
    {
        "content": "<p>I know, but that's not the point here.</p>",
        "id": 490405053,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1734888331
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> the module docstring here has some info <a href=\"https://leanprover-community.github.io/mathlib4_docs/Lean/Meta/DiscrTree.html\">https://leanprover-community.github.io/mathlib4_docs/Lean/Meta/DiscrTree.html</a></p>",
        "id": 490410656,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1734893753
    },
    {
        "content": "<p>Well that's a lot more over-my-head than I was hoping for, I get stuck on line 2, but it sounds like this has probably got nothing to do with the question here -- is it true that <code>apply?</code> tries <code>exact?</code>? That would perhaps explain Michael's observation.</p>",
        "id": 490419987,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1734902803
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479359\">Michael Stoll</span> <a href=\"#narrow/channel/270676-lean4/topic/apply.3F.20weakness/near/490383617\">said</a>:</p>\n<blockquote>\n<p>Consider the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">n</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply?</span><span class=\"w\"> </span><span class=\"c1\">-- lots of unhelpful suggestions</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply?</span><span class=\"w\"> </span><span class=\"c1\">-- Try this: exact congrArg foo h</span>\n</code></pre></div>\n<p>Why does <code>apply?</code> in the first <code>example</code> not come up with <code>refine CongrArg foo ?_</code>, leaving the goal <code>a = b</code>?</p>\n</blockquote>\n<p>What is going on here is that <code>apply?</code> actually tried running <code>solve_by_elim</code> first!</p>\n<p>This means that with <code>h</code> present, it can find the <code>congrArg</code> proof, even though this would be available via the discrimination tree based lookup of potentially relevant lemmas.</p>",
        "id": 492600356,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1736378925
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/270676-lean4/topic/apply.3F.20weakness/near/492600356\">said</a>:</p>\n<blockquote>\n<p>This means that with <code>h</code> present, it can find the <code>congrArg</code> proof, even though this would be available via the discrimination tree based lookup of potentially relevant lemmas.</p>\n</blockquote>\n<p>Is there a \"not\" missing somewhere in this sentence? I.e., the discrimination tree based lookup does not find <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=congrArg#doc\">docs#congrArg</a> ?</p>",
        "id": 492696037,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736421551
    },
    {
        "content": "<p>Indeed.</p>",
        "id": 492829337,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1736460916
    }
]