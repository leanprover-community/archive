[
    {
        "content": "<p>I'm running into an interesting behaviour, where <code>case succ x ih =&gt; _</code> will bind the wrong values.<br>\nTo trigger it, I did an <code>induction x generalizing y</code> with an inaccessible name in the context that refers to <code>y</code>. As a result, <code>ih</code> won't bind to the induction hypothesis, but instead binds to the value that was previously inaccessible.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">x'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x'</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x'</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span><span class=\"cm\"> Now my local context has a shadowed occurence of `h`</span>\n<span class=\"cm\">      ```</span>\n<span class=\"cm\">      x x' : ℕ</span>\n<span class=\"cm\">      h✝ h : x' = 0</span>\n<span class=\"cm\">      ⊢ True</span>\n<span class=\"cm\">      ``` -/</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">generalizing</span><span class=\"w\"> </span><span class=\"n\">x'</span>\n<span class=\"w\">  </span><span class=\"c1\">--          ^^^^^^^^^^^^^^^ Note: this `generalizing` is load-bearing for the example</span>\n<span class=\"w\">  </span><span class=\"c1\">--                          Without it, everything behaves as expected</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"w\">      </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">constructor</span><span class=\"w\"> </span><span class=\"c1\">-- This case is not particularly interesting</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">new_x</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"c\">/-</span>\n<span class=\"cm\">      At this point, my local context is as follows:</span>\n<span class=\"cm\">      ```</span>\n<span class=\"cm\">      n✝ : ℕ</span>\n<span class=\"cm\">      new_x : ∀ (x' : ℕ), x' = 0 → x' = 0 → True</span>\n<span class=\"cm\">      x' : ℕ</span>\n<span class=\"cm\">      ih h : x' = 0</span>\n<span class=\"cm\">      ⊢ True</span>\n<span class=\"cm\">      ```</span>\n<span class=\"cm\">      Notice how the variable `ih` was bound to what was previously a shadowed occurence of `h`,</span>\n<span class=\"cm\">      and `new_x` was bound to what should be the induction hypothesis.</span>\n<span class=\"cm\">      The value that should have been bound to `new_x` remains inaccessible.</span>\n<span class=\"cm\">    -/</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>I've confirmed this still happens with <code>leanprover/lean4:nightly-2024-07-04</code></p>",
        "id": 449405230,
        "sender_full_name": "Alex Keizer",
        "timestamp": 1720217733
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">generalizing</span><span class=\"w\"> </span><span class=\"n\">x'</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"w\">      </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">constructor</span><span class=\"w\"> </span><span class=\"c1\">-- This case is not particularly interesting</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">new_x</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>does work as expected</p>",
        "id": 449407642,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1720218974
    }
]