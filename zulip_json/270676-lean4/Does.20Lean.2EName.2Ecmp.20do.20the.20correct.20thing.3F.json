[
    {
        "content": "<p>It seems like <code>min_imports</code> does not sort correctly, caused by the behavior of <code>Name.cmp</code>, at least if it does not do the same thing you'd get when converting to a String first.<br>\nThe issue to fix it for <code>min_imports</code> is here: <a href=\"https://github.com/leanprover-community/import-graph/pull/18\">https://github.com/leanprover-community/import-graph/pull/18</a>.<br>\n<span class=\"user-mention\" data-user-id=\"385895\">@Jon Eugster</span> suggested to bring it up and potentially change the behavior of <code>Name.cmp</code>?</p>",
        "id": 457085745,
        "sender_full_name": "Moritz Firsching",
        "timestamp": 1723030622
    },
    {
        "content": "<p>ah, I see just now there is also <a href=\"https://github.com/leanprover/lean4/issues/4944\">https://github.com/leanprover/lean4/issues/4944</a></p>",
        "id": 457085793,
        "sender_full_name": "Moritz Firsching",
        "timestamp": 1723030648
    },
    {
        "content": "<p>The sorting that <code>Name.cmp</code> uses is good if you are trying to figure out, for instance, how many folders you have to cross to get to a file, so I am not so sure that <code>Name.cmp</code> should just look at a string.</p>",
        "id": 457090100,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723031958
    },
    {
        "content": "<p>I'd expect it to do a lexicographic comparison on the lists of strings it consists of</p>",
        "id": 457090405,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723032035
    },
    {
        "content": "<p>Well, it is currently doing the \"graded\" lex comparison, right?</p>",
        "id": 457091086,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723032180
    },
    {
        "content": "<p>As in, depth in the hierarchy and, within a given depth, lex.</p>",
        "id": 457091262,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723032215
    },
    {
        "content": "<p>Right, and I agree with Moritz that this is not the thing you want when sorting imports</p>",
        "id": 457100050,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723034909
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/270676-lean4/topic/Does.20Name.2Ecmp.20do.20the.20correct.20thing.3F/near/457100050\">said</a>:</p>\n<blockquote>\n<p>Right, and I agree with Moritz that this is not the thing you want when sorting imports</p>\n</blockquote>\n<p>That for sure! My question was whether this graded sorting is the right \"default\" sorting on <code>Name</code></p>",
        "id": 457100636,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1723035119
    },
    {
        "content": "<p>Ok, I think that we all agree that imports should be sorted as a string, lexicographically, treating the <code>.</code> as a character.  I was mostly arguing that the <code>Name.cmp</code> is not necessarily undesirable as a sorting for <code>Name</code>.</p>",
        "id": 457100836,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723035185
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/stream/270676-lean4/topic/Does.20Name.2Ecmp.20do.20the.20correct.20thing.3F/near/457100836\">said</a>:</p>\n<blockquote>\n<p>treating the <code>.</code> as a character.</p>\n</blockquote>\n<p>I don't agree,  that would make <code> `Foo.«A.B» </code> and <code> `Foo.A.B </code> equal. <code>.</code> needs to be treated specially</p>",
        "id": 457101267,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723035360
    },
    {
        "content": "<p>What you could do is sort the result of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Name.components#doc\">docs#Lean.Name.components</a>, taking advantage of lex order for List</p>",
        "id": 457101417,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1723035405
    },
    {
        "content": "<p>Note also that <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=getAllModulesSorted#doc\">docs#getAllModulesSorted</a>, which is the function that <code>mk_all</code> uses to sort imports in <code>Mathlib.lean</code> does indeed sort the strings, not the names (even if the array of strings is called <code>names</code> in the code).</p>",
        "id": 457101584,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723035474
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/stream/270676-lean4/topic/Does.20Name.2Ecmp.20do.20the.20correct.20thing.3F/near/457101417\">said</a>:</p>\n<blockquote>\n<p>What you could do is sort the result of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Name.components#doc\">docs#Lean.Name.components</a></p>\n</blockquote>\n<p>I was expecting this to return <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.NamePart#doc\">docs#Lean.NamePart</a> s</p>",
        "id": 457101704,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723035509
    },
    {
        "content": "<p>At least <code>.</code> comes before letters in ASCII, so sorting <code>Name.toString</code> should mostly work, though it could do some odd things with names with french-quoted dots. (<span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span>, <code>Name.toString</code> of <code>Foo.«A.B»</code> is <code>\"Foo.«A.B»\"</code>, so it would be sorted after <code>Foo.A.B</code>)</p>",
        "id": 457107434,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1723036705
    },
    {
        "content": "<p>For the imports <code>(← getEnv).minimalRequiredModules.qsort (·.toString &lt; ·.toString)</code> instead of <code>.qsort Name.lt</code> should do what we want in that case. (<a href=\"https://github.com/leanprover-community/import-graph/pull/24/files\">see commit</a>)</p>\n<p>Thanks for the comments</p>",
        "id": 457112550,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1723037995
    },
    {
        "content": "<p>This came as a surprise to me:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"bp\">#</span><span class=\"n\">guard</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Name</span><span class=\"bp\">.</span><span class=\"n\">cmp</span><span class=\"w\"> </span><span class=\"ss\">`A</span><span class=\"w\"> </span><span class=\"ss\">`ZZZ</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lt</span>\n<span class=\"bp\">#</span><span class=\"n\">guard</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Name</span><span class=\"bp\">.</span><span class=\"n\">cmp</span><span class=\"w\"> </span><span class=\"ss\">`A</span><span class=\"w\"> </span><span class=\"ss\">`ZZZ.Z</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lt</span>\n<span class=\"bp\">#</span><span class=\"n\">guard</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Name</span><span class=\"bp\">.</span><span class=\"n\">cmp</span><span class=\"w\"> </span><span class=\"ss\">`A.A</span><span class=\"w\"> </span><span class=\"ss\">`ZZZ</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">gt</span><span class=\"w\"> </span><span class=\"c1\">-- wat</span>\n<span class=\"bp\">#</span><span class=\"n\">guard</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Name</span><span class=\"bp\">.</span><span class=\"n\">cmp</span><span class=\"w\"> </span><span class=\"ss\">`A.A</span><span class=\"w\"> </span><span class=\"ss\">`ZZZ.Z</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lt</span>\n</code></pre></div>\n<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Name.cmp#doc\">docs#Lean.Name.cmp</a> is undocumented, but this is not the order I would expect.</p>\n<p>(<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Name.lt#doc\">docs#Lean.Name.lt</a> is consistent with <code>cmp</code>, but I mention it here for future Zulip searches)</p>",
        "id": 500025305,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1739724810
    },
    {
        "content": "<p>(cc <span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> for <a href=\"https://github.com/leanprover-community/mathlib4/pull/20908\">#20908</a>)</p>",
        "id": 500025331,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1739724831
    },
    {
        "content": "<p>I think that something similar was discussed <a href=\"#narrow/channel/270676-lean4/topic/Does.20Name.2Ecmp.20do.20the.20correct.20thing.3F\">here</a> as well.</p>",
        "id": 500050685,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1739744957
    },
    {
        "content": "<p>Thanks, I've merged the threads</p>",
        "id": 500052679,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1739746734
    }
]