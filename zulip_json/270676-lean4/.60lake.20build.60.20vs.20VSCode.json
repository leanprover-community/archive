[
    {
        "content": "<p>I have a file <code>Mathlib/declarations_diff.lean</code> that in VSCode works as intended, but when I use <code>lake build Mathlib.declarations_diff</code> reports</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>trace:<span class=\"w\"> </span>.&gt;<span class=\"w\"> </span><span class=\"nv\">LEAN_PATH</span><span class=\"o\">=</span>././.lake/packages/Cli/.lake/build/lib/lean:././.lake/packages/batteries/.lake/build/lib/lean:././.lake/packages/Qq/.lake/build/lib/lean:././.lake/packages/aesop/.lake/build/lib/lean:././.lake/packages/proofwidgets/.lake/build/lib/lean:././.lake/packages/importGraph/.lake/build/lib/lean:././.lake/packages/LeanSearchClient/.lake/build/lib/lean:././.lake/packages/plausible/.lake/build/lib/lean:././.lake/build/lib/lean<span class=\"w\"> </span>/home/damiano/.elan/toolchains/leanprover--lean4---v4.18.0-rc1/bin/lean<span class=\"w\"> </span>-Dpp.unicode.fun<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-DautoImplicit<span class=\"o\">=</span><span class=\"nb\">false</span><span class=\"w\"> </span>-DmaxSynthPendingDepth<span class=\"o\">=</span><span class=\"m\">3</span><span class=\"w\"> </span>-Dweak.linter.docPrime<span class=\"o\">=</span><span class=\"nb\">false</span><span class=\"w\"> </span>-Dweak.linter.hashCommand<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-Dweak.linter.oldObtain<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-Dweak.linter.refine<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-Dweak.linter.style.cdot<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-Dweak.linter.style.dollarSyntax<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-Dweak.linter.style.header<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-Dweak.linter.style.lambdaSyntax<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-Dweak.linter.style.longLine<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-Dweak.linter.style.longFile<span class=\"o\">=</span><span class=\"m\">1500</span><span class=\"w\"> </span>-Dweak.linter.style.missingEnd<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-Dweak.linter.style.multiGoal<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-Dweak.linter.style.setOption<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>././././Mathlib/declarations_diff.lean<span class=\"w\"> </span>-R<span class=\"w\"> </span>./././.<span class=\"w\"> </span>-o<span class=\"w\"> </span>././.lake/build/lib/lean/Mathlib/declarations_diff.olean<span class=\"w\"> </span>-i<span class=\"w\"> </span>././.lake/build/lib/lean/Mathlib/declarations_diff.ilean<span class=\"w\"> </span>-c<span class=\"w\"> </span>././.lake/build/ir/Mathlib/declarations_diff.c<span class=\"w\"> </span>--json\nerror:<span class=\"w\"> </span>Lean<span class=\"w\"> </span>exited<span class=\"w\"> </span>with<span class=\"w\"> </span>code<span class=\"w\"> </span><span class=\"m\">139</span>\nSome<span class=\"w\"> </span>required<span class=\"w\"> </span>builds<span class=\"w\"> </span>logged<span class=\"w\"> </span>failures:\n-<span class=\"w\"> </span>Mathlib.declarations_diff\nerror:<span class=\"w\"> </span>build<span class=\"w\"> </span>failed\n</code></pre></div>",
        "id": 504044721,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741338430
    },
    {
        "content": "<p>I suspect that the reason is that some computations overflows when using <code>lake build</code>, but the overflow settings are different for VSCode and it manages to work there.</p>",
        "id": 504044739,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741338437
    },
    {
        "content": "<p>The file loads two <code>Environment</code>s, each containing ~90k declarations and computes the diff of the two declaration <code>NameSet</code>s.</p>",
        "id": 504044749,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741338440
    },
    {
        "content": "<p>I can provide a (non-)working example, if wanted, but I wondered if there is some simple flag that I can pass to <code>lake build</code> that will make it behave like VSCode to test if that is the issue!</p>",
        "id": 504044762,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741338442
    },
    {
        "content": "<p>Given that there is a segfault happening it would be interesting to take a look at the coredump to figure out what's going on. Are you working on Linux or MacOS?</p>\n<p>Furthermore: Could you send the file that you are executing as well?</p>",
        "id": 504049101,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1741339801
    },
    {
        "content": "<p>The file is in the PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/22648\">#22648</a>.</p>",
        "id": 504049286,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741339858
    },
    {
        "content": "<p>You can see the CI workflow fails, but if you open the <code>scripts/declarations_diff.lean</code> in VSCode and add <code>ddiff</code> at the bottom, it will work.</p>",
        "id": 504049428,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741339901
    },
    {
        "content": "<p>(Or should.)</p>",
        "id": 504049440,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741339905
    },
    {
        "content": "<p>The important factor is that <code>Mathlib/Algebra/Quandle.lean</code> is modified, so getting the <em>other</em> working environment without the modification seems to cause the problem.</p>",
        "id": 504049621,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741339957
    },
    {
        "content": "<p>I am on Linux.</p>",
        "id": 504049672,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741339973
    },
    {
        "content": "<p>How do I get a coredump?</p>",
        "id": 504049716,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741339984
    },
    {
        "content": "<p>I can produce a \"cleaner\" branch with the example, if you want.</p>",
        "id": 504049817,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741340018
    },
    {
        "content": "<p>If you are running on a Linux that has systemd (which you most likely are) you can use <code>coredumpctl</code>. In particular <code>coredumpctl list</code> to list all coredumps and <code>coredumpctl debug</code> to open a GDB session with the latest coredump. If you could crash the thing again, then do <code>coredumpctl debug</code> and post the output of <code>thread apply all bt</code> that would be great.</p>",
        "id": 504050047,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1741340101
    },
    {
        "content": "<p>So, I crash it and then type <code>coredumpctl debug</code> in the same terminal?</p>",
        "id": 504050171,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741340143
    },
    {
        "content": "<p>Like this?</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$<span class=\"w\"> </span>coredumpctl<span class=\"w\"> </span>debug\n<span class=\"w\">           </span>PID:<span class=\"w\"> </span><span class=\"m\">67261</span><span class=\"w\"> </span><span class=\"o\">(</span>lean<span class=\"o\">)</span>\n<span class=\"w\">           </span>UID:<span class=\"w\"> </span><span class=\"m\">1000</span><span class=\"w\"> </span><span class=\"o\">(</span>damiano<span class=\"o\">)</span>\n<span class=\"w\">           </span>GID:<span class=\"w\"> </span><span class=\"m\">1000</span><span class=\"w\"> </span><span class=\"o\">(</span>damiano<span class=\"o\">)</span>\n<span class=\"w\">        </span>Signal:<span class=\"w\"> </span><span class=\"m\">11</span><span class=\"w\"> </span><span class=\"o\">(</span>SEGV<span class=\"o\">)</span>\n<span class=\"w\">     </span>Timestamp:<span class=\"w\"> </span>Fri<span class=\"w\"> </span><span class=\"m\">2025</span>-03-07<span class=\"w\"> </span><span class=\"m\">09</span>:58:29<span class=\"w\"> </span>CET<span class=\"w\"> </span><span class=\"o\">(</span>37min<span class=\"w\"> </span>ago<span class=\"o\">)</span>\n<span class=\"w\">  </span>Command<span class=\"w\"> </span>Line:<span class=\"w\"> </span>/home/damiano/.elan/toolchains/leanprover--lean4---v4.18.0-rc1/bin/lean<span class=\"w\"> </span>-Dpp.unicode.fun<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-DautoImplicit<span class=\"o\">=</span><span class=\"nb\">false</span><span class=\"w\"> </span>-DmaxSynthPendingDepth<span class=\"o\">=</span><span class=\"m\">3</span><span class=\"w\"> </span>-Dweak.linter.docPrime<span class=\"o\">=</span><span class=\"nb\">false</span><span class=\"w\"> </span>-Dweak.linter.hashCommand<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-Dweak.linter.oldObtain<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-Dweak.linter.refine<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-Dweak.linter.style.cdot<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-Dweak.linter.style.dollarSyntax<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-Dweak.linter.style.header<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-Dweak.linter.style.lambdaSyntax<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-Dweak.linter.style.longLine<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-Dweak.linter.style.longFile<span class=\"o\">=</span><span class=\"m\">1500</span><span class=\"w\"> </span>-Dweak.linter.style.missingEnd<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-Dweak.linter.style.multiGoal<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-Dweak.linter.style.setOption<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>././././Mathlib/declarations_diff.lean<span class=\"w\"> </span>-R<span class=\"w\"> </span>./././.<span class=\"w\"> </span>-o<span class=\"w\"> </span>././.lake/build/lib/lean/Mathlib/declarations_diff.olean<span class=\"w\"> </span>-i<span class=\"w\"> </span>././.lake/build/lib/lean/Mathlib/declarations_diff.ilean<span class=\"w\"> </span>-c<span class=\"w\"> </span>././.lake/build/ir/Mathlib/declarations_diff.c<span class=\"w\"> </span>--json\n<span class=\"w\">    </span>Executable:<span class=\"w\"> </span>/home/damiano/.elan/toolchains/leanprover--lean4---v4.18.0-rc1/bin/lean\n<span class=\"w\"> </span>Control<span class=\"w\"> </span>Group:<span class=\"w\"> </span>/user.slice/user-1000.slice/session-c1.scope\n<span class=\"w\">          </span>Unit:<span class=\"w\"> </span>session-c1.scope\n<span class=\"w\">         </span>Slice:<span class=\"w\"> </span>user-1000.slice\n<span class=\"w\">       </span>Session:<span class=\"w\"> </span>c1\n<span class=\"w\">     </span>Owner<span class=\"w\"> </span>UID:<span class=\"w\"> </span><span class=\"m\">1000</span><span class=\"w\"> </span><span class=\"o\">(</span>damiano<span class=\"o\">)</span>\n<span class=\"w\">       </span>Boot<span class=\"w\"> </span>ID:<span class=\"w\"> </span>6dd808f6f19e41fab1260d15efcb0367\n<span class=\"w\">    </span>Machine<span class=\"w\"> </span>ID:<span class=\"w\"> </span>2e6db7b3feeb408ba59f7482257bc249\n<span class=\"w\">      </span>Hostname:<span class=\"w\"> </span>damiano-Aspire-XC-886\n<span class=\"w\">       </span>Storage:<span class=\"w\"> </span>/var/lib/systemd/coredump/core.lean.1000.6dd808f6f19e41fab1260d15efcb0367.67261.1741337909000000.zst<span class=\"w\"> </span><span class=\"o\">(</span>truncated<span class=\"o\">)</span>\n<span class=\"w\">     </span>Disk<span class=\"w\"> </span>Size:<span class=\"w\"> </span><span class=\"m\">561</span>.8M\n<span class=\"w\">       </span>Message:<span class=\"w\"> </span>Process<span class=\"w\"> </span><span class=\"m\">67261</span><span class=\"w\"> </span><span class=\"o\">(</span>lean<span class=\"o\">)</span><span class=\"w\"> </span>of<span class=\"w\"> </span>user<span class=\"w\"> </span><span class=\"m\">1000</span><span class=\"w\"> </span>dumped<span class=\"w\"> </span>core.\n\n<span class=\"w\">                </span>Found<span class=\"w\"> </span>module<span class=\"w\"> </span>/home/damiano/.elan/toolchains/leanprover--lean4---v4.18.0-rc1/bin/lean<span class=\"w\"> </span>without<span class=\"w\"> </span>build-id.\n<span class=\"w\">                </span>Stack<span class=\"w\"> </span>trace<span class=\"w\"> </span>of<span class=\"w\"> </span>thread<span class=\"w\"> </span><span class=\"m\">67265</span>:\n<span class=\"w\">                </span><span class=\"c1\">#0  0x00007f44f317ac50 n/a (n/a + 0x0)</span>\n\nGNU<span class=\"w\"> </span>gdb<span class=\"w\"> </span><span class=\"o\">(</span>Ubuntu<span class=\"w\"> </span><span class=\"m\">12</span>.1-0ubuntu1~22.04.2<span class=\"o\">)</span><span class=\"w\"> </span><span class=\"m\">12</span>.1\nCopyright<span class=\"w\"> </span><span class=\"o\">(</span>C<span class=\"o\">)</span><span class=\"w\"> </span><span class=\"m\">2022</span><span class=\"w\"> </span>Free<span class=\"w\"> </span>Software<span class=\"w\"> </span>Foundation,<span class=\"w\"> </span>Inc.\nLicense<span class=\"w\"> </span>GPLv3+:<span class=\"w\"> </span>GNU<span class=\"w\"> </span>GPL<span class=\"w\"> </span>version<span class=\"w\"> </span><span class=\"m\">3</span><span class=\"w\"> </span>or<span class=\"w\"> </span>later<span class=\"w\"> </span>&lt;http://gnu.org/licenses/gpl.html&gt;\nThis<span class=\"w\"> </span>is<span class=\"w\"> </span>free<span class=\"w\"> </span>software:<span class=\"w\"> </span>you<span class=\"w\"> </span>are<span class=\"w\"> </span>free<span class=\"w\"> </span>to<span class=\"w\"> </span>change<span class=\"w\"> </span>and<span class=\"w\"> </span>redistribute<span class=\"w\"> </span>it.\nThere<span class=\"w\"> </span>is<span class=\"w\"> </span>NO<span class=\"w\"> </span>WARRANTY,<span class=\"w\"> </span>to<span class=\"w\"> </span>the<span class=\"w\"> </span>extent<span class=\"w\"> </span>permitted<span class=\"w\"> </span>by<span class=\"w\"> </span>law.\nType<span class=\"w\"> </span><span class=\"s2\">\"show copying\"</span><span class=\"w\"> </span>and<span class=\"w\"> </span><span class=\"s2\">\"show warranty\"</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span>details.\nThis<span class=\"w\"> </span>GDB<span class=\"w\"> </span>was<span class=\"w\"> </span>configured<span class=\"w\"> </span>as<span class=\"w\"> </span><span class=\"s2\">\"x86_64-linux-gnu\"</span>.\nType<span class=\"w\"> </span><span class=\"s2\">\"show configuration\"</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span>configuration<span class=\"w\"> </span>details.\nFor<span class=\"w\"> </span>bug<span class=\"w\"> </span>reporting<span class=\"w\"> </span>instructions,<span class=\"w\"> </span>please<span class=\"w\"> </span>see:\n&lt;https://www.gnu.org/software/gdb/bugs/&gt;.\nFind<span class=\"w\"> </span>the<span class=\"w\"> </span>GDB<span class=\"w\"> </span>manual<span class=\"w\"> </span>and<span class=\"w\"> </span>other<span class=\"w\"> </span>documentation<span class=\"w\"> </span>resources<span class=\"w\"> </span>online<span class=\"w\"> </span>at:\n<span class=\"w\">    </span>&lt;http://www.gnu.org/software/gdb/documentation/&gt;.\n\nFor<span class=\"w\"> </span>help,<span class=\"w\"> </span><span class=\"nb\">type</span><span class=\"w\"> </span><span class=\"s2\">\"help\"</span>.\nType<span class=\"w\"> </span><span class=\"s2\">\"apropos word\"</span><span class=\"w\"> </span>to<span class=\"w\"> </span>search<span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span>commands<span class=\"w\"> </span>related<span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"s2\">\"word\"</span>...\nReading<span class=\"w\"> </span>symbols<span class=\"w\"> </span>from<span class=\"w\"> </span>/home/damiano/.elan/toolchains/leanprover--lean4---v4.18.0-rc1/bin/lean...\nBFD:<span class=\"w\"> </span>warning:<span class=\"w\"> </span>/var/tmp/coredump-L0fJzl<span class=\"w\"> </span>has<span class=\"w\"> </span>a<span class=\"w\"> </span>segment<span class=\"w\"> </span>extending<span class=\"w\"> </span>past<span class=\"w\"> </span>end<span class=\"w\"> </span>of<span class=\"w\"> </span>file\n\nwarning:<span class=\"w\"> </span>Can<span class=\"s1\">'t open file anon_inode:[io_uring] which was expanded to anon_inode:[io_uring] during file-backed mapping note processing</span>\n\n<span class=\"s1\">warning: Can'</span>t<span class=\"w\"> </span>open<span class=\"w\"> </span>file<span class=\"w\"> </span>anon_inode:<span class=\"o\">[</span>io_uring<span class=\"o\">]</span><span class=\"w\"> </span>which<span class=\"w\"> </span>was<span class=\"w\"> </span>expanded<span class=\"w\"> </span>to<span class=\"w\"> </span>anon_inode:<span class=\"o\">[</span>io_uring<span class=\"o\">]</span><span class=\"w\"> </span>during<span class=\"w\"> </span>file-backed<span class=\"w\"> </span>mapping<span class=\"w\"> </span>note<span class=\"w\"> </span>processing\n\nwarning:<span class=\"w\"> </span>Can<span class=\"s1\">'t open file anon_inode:[io_uring] which was expanded to anon_inode:[io_uring] during file-backed mapping note processing</span>\n\n<span class=\"s1\">warning: Can'</span>t<span class=\"w\"> </span>open<span class=\"w\"> </span>file<span class=\"w\"> </span>anon_inode:<span class=\"o\">[</span>io_uring<span class=\"o\">]</span><span class=\"w\"> </span>which<span class=\"w\"> </span>was<span class=\"w\"> </span>expanded<span class=\"w\"> </span>to<span class=\"w\"> </span>anon_inode:<span class=\"o\">[</span>io_uring<span class=\"o\">]</span><span class=\"w\"> </span>during<span class=\"w\"> </span>file-backed<span class=\"w\"> </span>mapping<span class=\"w\"> </span>note<span class=\"w\"> </span>processing\n<span class=\"o\">[</span>New<span class=\"w\"> </span>LWP<span class=\"w\"> </span><span class=\"m\">67265</span><span class=\"o\">]</span>\n<span class=\"o\">[</span>New<span class=\"w\"> </span>LWP<span class=\"w\"> </span><span class=\"m\">67263</span><span class=\"o\">]</span>\n<span class=\"o\">[</span>New<span class=\"w\"> </span>LWP<span class=\"w\"> </span><span class=\"m\">67261</span><span class=\"o\">]</span>\n<span class=\"o\">[</span>New<span class=\"w\"> </span>LWP<span class=\"w\"> </span><span class=\"m\">67264</span><span class=\"o\">]</span>\n<span class=\"o\">[</span>New<span class=\"w\"> </span>LWP<span class=\"w\"> </span><span class=\"m\">67266</span><span class=\"o\">]</span>\n\nwarning:<span class=\"w\"> </span>Error<span class=\"w\"> </span>reading<span class=\"w\"> </span>shared<span class=\"w\"> </span>library<span class=\"w\"> </span>list<span class=\"w\"> </span>entry<span class=\"w\"> </span>at<span class=\"w\"> </span>0x29ba00746473\nFailed<span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"nb\">read</span><span class=\"w\"> </span>a<span class=\"w\"> </span>valid<span class=\"w\"> </span>object<span class=\"w\"> </span>file<span class=\"w\"> </span>image<span class=\"w\"> </span>from<span class=\"w\"> </span>memory.\nCore<span class=\"w\"> </span>was<span class=\"w\"> </span>generated<span class=\"w\"> </span>by<span class=\"w\"> </span><span class=\"sb\">`</span>/home/damiano/.elan/toolchains/leanprover--lean4---v4.18.0-rc1/bin/lean<span class=\"w\"> </span>-Dpp.un<span class=\"err\">'</span>.\nProgram<span class=\"w\"> </span>terminated<span class=\"w\"> </span>with<span class=\"w\"> </span>signal<span class=\"w\"> </span>SIGSEGV,<span class=\"w\"> </span>Segmentation<span class=\"w\"> </span>fault.\n<span class=\"c1\">#0  0x00007f44f317ac50 in ?? ()</span>\n<span class=\"o\">[</span>Current<span class=\"w\"> </span>thread<span class=\"w\"> </span>is<span class=\"w\"> </span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"o\">(</span>LWP<span class=\"w\"> </span><span class=\"m\">67265</span><span class=\"o\">)]</span>\n<span class=\"o\">(</span>gdb<span class=\"o\">)</span><span class=\"w\"> </span>Quit\n<span class=\"o\">(</span>gdb<span class=\"o\">)</span>\n</code></pre></div>",
        "id": 504050424,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741340212
    },
    {
        "content": "<p>(And do I type <code>exit</code> now? <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span> )</p>",
        "id": 504050868,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741340350
    },
    {
        "content": "<p>You do <code>thread apply all bt</code> now and show us the output^^</p>",
        "id": 504053340,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1741341042
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code><span class=\"o\">(</span>gdb<span class=\"o\">)</span><span class=\"w\"> </span>thread<span class=\"w\"> </span>apply<span class=\"w\"> </span>all<span class=\"w\"> </span>bt\n\nThread<span class=\"w\"> </span><span class=\"m\">5</span><span class=\"w\"> </span><span class=\"o\">(</span>LWP<span class=\"w\"> </span><span class=\"m\">67266</span><span class=\"o\">)</span>:\n<span class=\"c1\">#0  0x00007f44ebb4d117 in ?? ()</span>\nBacktrace<span class=\"w\"> </span>stopped:<span class=\"w\"> </span>Cannot<span class=\"w\"> </span>access<span class=\"w\"> </span>memory<span class=\"w\"> </span>at<span class=\"w\"> </span>address<span class=\"w\"> </span>0x7f44e1ffac40\n\nThread<span class=\"w\"> </span><span class=\"m\">4</span><span class=\"w\"> </span><span class=\"o\">(</span>LWP<span class=\"w\"> </span><span class=\"m\">67264</span><span class=\"o\">)</span>:\n<span class=\"c1\">#0  0x00007f44ebbe1b68 in ?? ()</span>\nBacktrace<span class=\"w\"> </span>stopped:<span class=\"w\"> </span>Cannot<span class=\"w\"> </span>access<span class=\"w\"> </span>memory<span class=\"w\"> </span>at<span class=\"w\"> </span>address<span class=\"w\"> </span>0x7f44eb2aef90\n\nThread<span class=\"w\"> </span><span class=\"m\">3</span><span class=\"w\"> </span><span class=\"o\">(</span>LWP<span class=\"w\"> </span><span class=\"m\">67261</span><span class=\"o\">)</span>:\n<span class=\"c1\">#0  0x00007f44ebb4d117 in ?? ()</span>\nBacktrace<span class=\"w\"> </span>stopped:<span class=\"w\"> </span>Cannot<span class=\"w\"> </span>access<span class=\"w\"> </span>memory<span class=\"w\"> </span>at<span class=\"w\"> </span>address<span class=\"w\"> </span>0x7ffd068de330\n\nThread<span class=\"w\"> </span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"o\">(</span>LWP<span class=\"w\"> </span><span class=\"m\">67263</span><span class=\"o\">)</span>:\n<span class=\"c1\">#0  0x0000000000000000 in ?? ()</span>\nBacktrace<span class=\"w\"> </span>stopped:<span class=\"w\"> </span>Cannot<span class=\"w\"> </span>access<span class=\"w\"> </span>memory<span class=\"w\"> </span>at<span class=\"w\"> </span>address<span class=\"w\"> </span>0x0\n\nThread<span class=\"w\"> </span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"o\">(</span>LWP<span class=\"w\"> </span><span class=\"m\">67265</span><span class=\"o\">)</span>:\n<span class=\"c1\">#0  0x00007f44f317ac50 in ?? ()</span>\nBacktrace<span class=\"w\"> </span>stopped:<span class=\"w\"> </span>Cannot<span class=\"w\"> </span>access<span class=\"w\"> </span>memory<span class=\"w\"> </span>at<span class=\"w\"> </span>address<span class=\"w\"> </span>0x7f44e9aa82e8\n<span class=\"o\">(</span>gdb<span class=\"o\">)</span>\n</code></pre></div>",
        "id": 504053495,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741341100
    },
    {
        "content": "<p>Although I realised that, in a different terminal, I switched git branch and then switched back.</p>",
        "id": 504053550,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741341121
    },
    {
        "content": "<p>Should I run everything again from scratch?  (I.e. crash with <code>lake build</code>, then coredump and thread, with not intervening commands?)</p>",
        "id": 504053669,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741341157
    },
    {
        "content": "<p>You can do that just to be sure but it should not change the result I think...regardless this is unfortunately a very unhelpful backtrace, I don't really understand how all threads could be corrupted in this fashion.</p>",
        "id": 504054024,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1741341260
    },
    {
        "content": "<p>Here it is: to me, it indeed seems very similar to the above.</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$<span class=\"w\"> </span>coredumpctl<span class=\"w\"> </span>debug\n<span class=\"w\">           </span>PID:<span class=\"w\"> </span><span class=\"m\">94520</span><span class=\"w\"> </span><span class=\"o\">(</span>lean<span class=\"o\">)</span>\n<span class=\"w\">           </span>UID:<span class=\"w\"> </span><span class=\"m\">1000</span><span class=\"w\"> </span><span class=\"o\">(</span>damiano<span class=\"o\">)</span>\n<span class=\"w\">           </span>GID:<span class=\"w\"> </span><span class=\"m\">1000</span><span class=\"w\"> </span><span class=\"o\">(</span>damiano<span class=\"o\">)</span>\n<span class=\"w\">        </span>Signal:<span class=\"w\"> </span><span class=\"m\">11</span><span class=\"w\"> </span><span class=\"o\">(</span>SEGV<span class=\"o\">)</span>\n<span class=\"w\">     </span>Timestamp:<span class=\"w\"> </span>Fri<span class=\"w\"> </span><span class=\"m\">2025</span>-03-07<span class=\"w\"> </span><span class=\"m\">11</span>:05:38<span class=\"w\"> </span>CET<span class=\"w\"> </span><span class=\"o\">(</span>19s<span class=\"w\"> </span>ago<span class=\"o\">)</span>\n<span class=\"w\">  </span>Command<span class=\"w\"> </span>Line:<span class=\"w\"> </span>/home/damiano/.elan/toolchains/leanprover--lean4---v4.18.0-rc1/bin/lean<span class=\"w\"> </span>-Dpp.unicode.fun<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-DautoImplicit<span class=\"o\">=</span><span class=\"nb\">false</span><span class=\"w\"> </span>-DmaxSynthPendingDepth<span class=\"o\">=</span><span class=\"m\">3</span><span class=\"w\"> </span>-Dweak.linter.docPrime<span class=\"o\">=</span><span class=\"nb\">false</span><span class=\"w\"> </span>-Dweak.linter.hashCommand<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-Dweak.linter.oldObtain<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-Dweak.linter.refine<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-Dweak.linter.style.cdot<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-Dweak.linter.style.dollarSyntax<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-Dweak.linter.style.header<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-Dweak.linter.style.lambdaSyntax<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-Dweak.linter.style.longLine<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-Dweak.linter.style.longFile<span class=\"o\">=</span><span class=\"m\">1500</span><span class=\"w\"> </span>-Dweak.linter.style.missingEnd<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-Dweak.linter.style.multiGoal<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>-Dweak.linter.style.setOption<span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"w\"> </span>././././Mathlib/declarations_diff.lean<span class=\"w\"> </span>-R<span class=\"w\"> </span>./././.<span class=\"w\"> </span>-o<span class=\"w\"> </span>././.lake/build/lib/lean/Mathlib/declarations_diff.olean<span class=\"w\"> </span>-i<span class=\"w\"> </span>././.lake/build/lib/lean/Mathlib/declarations_diff.ilean<span class=\"w\"> </span>-c<span class=\"w\"> </span>././.lake/build/ir/Mathlib/declarations_diff.c<span class=\"w\"> </span>--json\n<span class=\"w\">    </span>Executable:<span class=\"w\"> </span>/home/damiano/.elan/toolchains/leanprover--lean4---v4.18.0-rc1/bin/lean\n<span class=\"w\"> </span>Control<span class=\"w\"> </span>Group:<span class=\"w\"> </span>/user.slice/user-1000.slice/session-c1.scope\n<span class=\"w\">          </span>Unit:<span class=\"w\"> </span>session-c1.scope\n<span class=\"w\">         </span>Slice:<span class=\"w\"> </span>user-1000.slice\n<span class=\"w\">       </span>Session:<span class=\"w\"> </span>c1\n<span class=\"w\">     </span>Owner<span class=\"w\"> </span>UID:<span class=\"w\"> </span><span class=\"m\">1000</span><span class=\"w\"> </span><span class=\"o\">(</span>damiano<span class=\"o\">)</span>\n<span class=\"w\">       </span>Boot<span class=\"w\"> </span>ID:<span class=\"w\"> </span>6dd808f6f19e41fab1260d15efcb0367\n<span class=\"w\">    </span>Machine<span class=\"w\"> </span>ID:<span class=\"w\"> </span>2e6db7b3feeb408ba59f7482257bc249\n<span class=\"w\">      </span>Hostname:<span class=\"w\"> </span>damiano-Aspire-XC-886\n<span class=\"w\">       </span>Storage:<span class=\"w\"> </span>/var/lib/systemd/coredump/core.lean.1000.6dd808f6f19e41fab1260d15efcb0367.94520.1741341938000000.zst<span class=\"w\"> </span><span class=\"o\">(</span>truncated<span class=\"o\">)</span>\n<span class=\"w\">     </span>Disk<span class=\"w\"> </span>Size:<span class=\"w\"> </span><span class=\"m\">561</span>.8M\n<span class=\"w\">       </span>Message:<span class=\"w\"> </span>Process<span class=\"w\"> </span><span class=\"m\">94520</span><span class=\"w\"> </span><span class=\"o\">(</span>lean<span class=\"o\">)</span><span class=\"w\"> </span>of<span class=\"w\"> </span>user<span class=\"w\"> </span><span class=\"m\">1000</span><span class=\"w\"> </span>dumped<span class=\"w\"> </span>core.\n\n<span class=\"w\">                </span>Found<span class=\"w\"> </span>module<span class=\"w\"> </span>/home/damiano/.elan/toolchains/leanprover--lean4---v4.18.0-rc1/bin/lean<span class=\"w\"> </span>without<span class=\"w\"> </span>build-id.\n<span class=\"w\">                </span>Stack<span class=\"w\"> </span>trace<span class=\"w\"> </span>of<span class=\"w\"> </span>thread<span class=\"w\"> </span><span class=\"m\">94524</span>:\n<span class=\"w\">                </span><span class=\"c1\">#0  0x00007fc38f193c50 n/a (n/a + 0x0)</span>\n\nGNU<span class=\"w\"> </span>gdb<span class=\"w\"> </span><span class=\"o\">(</span>Ubuntu<span class=\"w\"> </span><span class=\"m\">12</span>.1-0ubuntu1~22.04.2<span class=\"o\">)</span><span class=\"w\"> </span><span class=\"m\">12</span>.1\nCopyright<span class=\"w\"> </span><span class=\"o\">(</span>C<span class=\"o\">)</span><span class=\"w\"> </span><span class=\"m\">2022</span><span class=\"w\"> </span>Free<span class=\"w\"> </span>Software<span class=\"w\"> </span>Foundation,<span class=\"w\"> </span>Inc.\nLicense<span class=\"w\"> </span>GPLv3+:<span class=\"w\"> </span>GNU<span class=\"w\"> </span>GPL<span class=\"w\"> </span>version<span class=\"w\"> </span><span class=\"m\">3</span><span class=\"w\"> </span>or<span class=\"w\"> </span>later<span class=\"w\"> </span>&lt;http://gnu.org/licenses/gpl.html&gt;\nThis<span class=\"w\"> </span>is<span class=\"w\"> </span>free<span class=\"w\"> </span>software:<span class=\"w\"> </span>you<span class=\"w\"> </span>are<span class=\"w\"> </span>free<span class=\"w\"> </span>to<span class=\"w\"> </span>change<span class=\"w\"> </span>and<span class=\"w\"> </span>redistribute<span class=\"w\"> </span>it.\nThere<span class=\"w\"> </span>is<span class=\"w\"> </span>NO<span class=\"w\"> </span>WARRANTY,<span class=\"w\"> </span>to<span class=\"w\"> </span>the<span class=\"w\"> </span>extent<span class=\"w\"> </span>permitted<span class=\"w\"> </span>by<span class=\"w\"> </span>law.\nType<span class=\"w\"> </span><span class=\"s2\">\"show copying\"</span><span class=\"w\"> </span>and<span class=\"w\"> </span><span class=\"s2\">\"show warranty\"</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span>details.\nThis<span class=\"w\"> </span>GDB<span class=\"w\"> </span>was<span class=\"w\"> </span>configured<span class=\"w\"> </span>as<span class=\"w\"> </span><span class=\"s2\">\"x86_64-linux-gnu\"</span>.\nType<span class=\"w\"> </span><span class=\"s2\">\"show configuration\"</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span>configuration<span class=\"w\"> </span>details.\nFor<span class=\"w\"> </span>bug<span class=\"w\"> </span>reporting<span class=\"w\"> </span>instructions,<span class=\"w\"> </span>please<span class=\"w\"> </span>see:\n&lt;https://www.gnu.org/software/gdb/bugs/&gt;.\nFind<span class=\"w\"> </span>the<span class=\"w\"> </span>GDB<span class=\"w\"> </span>manual<span class=\"w\"> </span>and<span class=\"w\"> </span>other<span class=\"w\"> </span>documentation<span class=\"w\"> </span>resources<span class=\"w\"> </span>online<span class=\"w\"> </span>at:\n<span class=\"w\">    </span>&lt;http://www.gnu.org/software/gdb/documentation/&gt;.\n\nFor<span class=\"w\"> </span>help,<span class=\"w\"> </span><span class=\"nb\">type</span><span class=\"w\"> </span><span class=\"s2\">\"help\"</span>.\nType<span class=\"w\"> </span><span class=\"s2\">\"apropos word\"</span><span class=\"w\"> </span>to<span class=\"w\"> </span>search<span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span>commands<span class=\"w\"> </span>related<span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"s2\">\"word\"</span>...\nReading<span class=\"w\"> </span>symbols<span class=\"w\"> </span>from<span class=\"w\"> </span>/home/damiano/.elan/toolchains/leanprover--lean4---v4.18.0-rc1/bin/lean...\nBFD:<span class=\"w\"> </span>warning:<span class=\"w\"> </span>/var/tmp/coredump-wQkTK4<span class=\"w\"> </span>has<span class=\"w\"> </span>a<span class=\"w\"> </span>segment<span class=\"w\"> </span>extending<span class=\"w\"> </span>past<span class=\"w\"> </span>end<span class=\"w\"> </span>of<span class=\"w\"> </span>file\n\nwarning:<span class=\"w\"> </span>Can<span class=\"s1\">'t open file anon_inode:[io_uring] which was expanded to anon_inode:[io_uring] during file-backed mapping note processing</span>\n\n<span class=\"s1\">warning: Can'</span>t<span class=\"w\"> </span>open<span class=\"w\"> </span>file<span class=\"w\"> </span>anon_inode:<span class=\"o\">[</span>io_uring<span class=\"o\">]</span><span class=\"w\"> </span>which<span class=\"w\"> </span>was<span class=\"w\"> </span>expanded<span class=\"w\"> </span>to<span class=\"w\"> </span>anon_inode:<span class=\"o\">[</span>io_uring<span class=\"o\">]</span><span class=\"w\"> </span>during<span class=\"w\"> </span>file-backed<span class=\"w\"> </span>mapping<span class=\"w\"> </span>note<span class=\"w\"> </span>processing\n\nwarning:<span class=\"w\"> </span>Can<span class=\"s1\">'t open file anon_inode:[io_uring] which was expanded to anon_inode:[io_uring] during file-backed mapping note processing</span>\n\n<span class=\"s1\">warning: Can'</span>t<span class=\"w\"> </span>open<span class=\"w\"> </span>file<span class=\"w\"> </span>anon_inode:<span class=\"o\">[</span>io_uring<span class=\"o\">]</span><span class=\"w\"> </span>which<span class=\"w\"> </span>was<span class=\"w\"> </span>expanded<span class=\"w\"> </span>to<span class=\"w\"> </span>anon_inode:<span class=\"o\">[</span>io_uring<span class=\"o\">]</span><span class=\"w\"> </span>during<span class=\"w\"> </span>file-backed<span class=\"w\"> </span>mapping<span class=\"w\"> </span>note<span class=\"w\"> </span>processing\n<span class=\"o\">[</span>New<span class=\"w\"> </span>LWP<span class=\"w\"> </span><span class=\"m\">94524</span><span class=\"o\">]</span>\n<span class=\"o\">[</span>New<span class=\"w\"> </span>LWP<span class=\"w\"> </span><span class=\"m\">94520</span><span class=\"o\">]</span>\n<span class=\"o\">[</span>New<span class=\"w\"> </span>LWP<span class=\"w\"> </span><span class=\"m\">94525</span><span class=\"o\">]</span>\n<span class=\"o\">[</span>New<span class=\"w\"> </span>LWP<span class=\"w\"> </span><span class=\"m\">94522</span><span class=\"o\">]</span>\n<span class=\"o\">[</span>New<span class=\"w\"> </span>LWP<span class=\"w\"> </span><span class=\"m\">94523</span><span class=\"o\">]</span>\n\nwarning:<span class=\"w\"> </span>Error<span class=\"w\"> </span>reading<span class=\"w\"> </span>shared<span class=\"w\"> </span>library<span class=\"w\"> </span>list<span class=\"w\"> </span>entry<span class=\"w\"> </span>at<span class=\"w\"> </span>0x29ba00746473\nFailed<span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"nb\">read</span><span class=\"w\"> </span>a<span class=\"w\"> </span>valid<span class=\"w\"> </span>object<span class=\"w\"> </span>file<span class=\"w\"> </span>image<span class=\"w\"> </span>from<span class=\"w\"> </span>memory.\nCore<span class=\"w\"> </span>was<span class=\"w\"> </span>generated<span class=\"w\"> </span>by<span class=\"w\"> </span><span class=\"sb\">`</span>/home/damiano/.elan/toolchains/leanprover--lean4---v4.18.0-rc1/bin/lean<span class=\"w\"> </span>-Dpp.un<span class=\"err\">'</span>.\nProgram<span class=\"w\"> </span>terminated<span class=\"w\"> </span>with<span class=\"w\"> </span>signal<span class=\"w\"> </span>SIGSEGV,<span class=\"w\"> </span>Segmentation<span class=\"w\"> </span>fault.\n<span class=\"c1\">#0  0x00007fc38f193c50 in ?? ()</span>\n<span class=\"o\">[</span>Current<span class=\"w\"> </span>thread<span class=\"w\"> </span>is<span class=\"w\"> </span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"o\">(</span>LWP<span class=\"w\"> </span><span class=\"m\">94524</span><span class=\"o\">)]</span>\n<span class=\"o\">(</span>gdb<span class=\"o\">)</span><span class=\"w\"> </span>thread<span class=\"w\"> </span>apply<span class=\"w\"> </span>all<span class=\"w\"> </span>bt\n\nThread<span class=\"w\"> </span><span class=\"m\">5</span><span class=\"w\"> </span><span class=\"o\">(</span>LWP<span class=\"w\"> </span><span class=\"m\">94523</span><span class=\"o\">)</span>:\n<span class=\"c1\">#0  0x00007fc387bfab68 in ?? ()</span>\nBacktrace<span class=\"w\"> </span>stopped:<span class=\"w\"> </span>Cannot<span class=\"w\"> </span>access<span class=\"w\"> </span>memory<span class=\"w\"> </span>at<span class=\"w\"> </span>address<span class=\"w\"> </span>0x7fc3872c7f90\n\nThread<span class=\"w\"> </span><span class=\"m\">4</span><span class=\"w\"> </span><span class=\"o\">(</span>LWP<span class=\"w\"> </span><span class=\"m\">94522</span><span class=\"o\">)</span>:\n<span class=\"c1\">#0  0x0000000000000000 in ?? ()</span>\nBacktrace<span class=\"w\"> </span>stopped:<span class=\"w\"> </span>Cannot<span class=\"w\"> </span>access<span class=\"w\"> </span>memory<span class=\"w\"> </span>at<span class=\"w\"> </span>address<span class=\"w\"> </span>0x0\n\nThread<span class=\"w\"> </span><span class=\"m\">3</span><span class=\"w\"> </span><span class=\"o\">(</span>LWP<span class=\"w\"> </span><span class=\"m\">94525</span><span class=\"o\">)</span>:\n<span class=\"c1\">#0  0x00007fc387b66117 in ?? ()</span>\nBacktrace<span class=\"w\"> </span>stopped:<span class=\"w\"> </span>Cannot<span class=\"w\"> </span>access<span class=\"w\"> </span>memory<span class=\"w\"> </span>at<span class=\"w\"> </span>address<span class=\"w\"> </span>0x7fc37dffac40\n\nThread<span class=\"w\"> </span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"o\">(</span>LWP<span class=\"w\"> </span><span class=\"m\">94520</span><span class=\"o\">)</span>:\n<span class=\"c1\">#0  0x00007fc387b66117 in ?? ()</span>\nBacktrace<span class=\"w\"> </span>stopped:<span class=\"w\"> </span>Cannot<span class=\"w\"> </span>access<span class=\"w\"> </span>memory<span class=\"w\"> </span>at<span class=\"w\"> </span>address<span class=\"w\"> </span>0x7fff83ae55b0\n\nThread<span class=\"w\"> </span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"o\">(</span>LWP<span class=\"w\"> </span><span class=\"m\">94524</span><span class=\"o\">)</span>:\n<span class=\"c1\">#0  0x00007fc38f193c50 in ?? ()</span>\nBacktrace<span class=\"w\"> </span>stopped:<span class=\"w\"> </span>Cannot<span class=\"w\"> </span>access<span class=\"w\"> </span>memory<span class=\"w\"> </span>at<span class=\"w\"> </span>address<span class=\"w\"> </span>0x7fc385ac12e8\n<span class=\"o\">(</span>gdb<span class=\"o\">)</span>\n</code></pre></div>",
        "id": 504056332,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741341999
    },
    {
        "content": "<p>I left some comments on the PR, debugging this issue aside, this seems like a fragile approach</p>",
        "id": 504106592,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741357302
    }
]