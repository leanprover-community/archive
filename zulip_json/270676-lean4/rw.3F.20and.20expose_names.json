[
    {
        "content": "<p>Since a while ago, <code>rw?</code> and friends sometimes produce suggestions that involve <code>expose_names</code> and frequently come with the added caveat \"found an applicable rewrite lemma, but the corresponding tactic failed\" (which leads to no clickable \"Try this:\"). However, there are cases where</p>\n<ul>\n<li>the <code>expose_names</code> is actually unnecessary;</li>\n<li>the suggested <code>rw [...]</code> <em>with</em> or <em>without</em> <code>expose_names</code> works perfectly well.</li>\n</ul>\n<p>Here is a Mathlib-free example.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">?_⟩</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw?</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">H</span>\n<span class=\"w\">    </span><span class=\"c1\">-- found an applicable rewrite lemma, but the corresponding tactic failed:</span>\n<span class=\"w\">    </span><span class=\"c1\">-- (expose_names; rw [and_congr_left_eq (congrFun rfl)] at H)</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>but <code>rw [and_comm] at H</code> (say) just works.</p>\n<p>It seems to be relevant that there is <code>B n</code> and not just some <code>C : Prop</code> in the term.</p>\n<p>This looks like a bug to me.</p>",
        "id": 524274076,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1750085390
    },
    {
        "content": "<p>I haven't implemented the <code>expose_names</code> feature yet in my <code>rw??</code> tactic, but apparently I shouldn't copy exactly what <code>rw?</code> does <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 524295898,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1750092634
    }
]