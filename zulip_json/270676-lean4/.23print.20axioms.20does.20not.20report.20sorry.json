[
    {
        "content": "<p>I am playing around the proof of algebra_amgm_prod1toneq1_sum1tongeqn by DeepSeek-Prover-V2, and I got this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Aesop</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">maxHeartbeats</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">BigOperators</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">Topology</span><span class=\"w\"> </span><span class=\"n\">Rat</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">am_gm_inequality</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">NNReal</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">),</span>\n<span class=\"w\">    </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">prod</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">m</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h₁</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">NNReal</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">NNReal</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">T</span>\n<span class=\"w\">      </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">t</span>\n<span class=\"w\">      </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">m</span>\n<span class=\"w\">      </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">prod</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">apply?</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">h₂</span>\n\n<span class=\"c1\">-- 'f' does not depend on any axioms</span>\n<span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">axioms</span><span class=\"w\"> </span><span class=\"n\">f</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"c1\">-- \"thm\"</span>\n<span class=\"n\">run_cmd</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">info</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getConstInfo</span><span class=\"w\"> </span><span class=\"ss\">`f</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">thmInfo</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">info</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"s2\">\"thm\"</span>\n</code></pre></div>\n<p>(Edit just so it is clear: this is a bug I discovered during debugging, not something exploited by DeepSeek-Prover-V2)</p>\n<p>There are errors in the Infoview, but there are no squiggly lines (except the blue one for <code>apply?</code>). Moreover, this example breaks if I remove the seemingly unrelated <code>have h₁</code>. On the Lean side, is this really expected?</p>",
        "id": 515566581,
        "sender_full_name": "Thomas Zhu",
        "timestamp": 1746127510
    },
    {
        "content": "<p>how did you manage to prove <code>False</code></p>",
        "id": 515567133,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1746127735
    },
    {
        "content": "<p>The proof is <code>sorry</code> but it doesn't depend on any axioms???</p>",
        "id": 515567773,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1746127993
    },
    {
        "content": "<p>unsolved goals lol</p>",
        "id": 515567862,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1746128033
    },
    {
        "content": "<p>Technically, the proof isn't even complete (unsolved goals). But even if you add a <code>sorry</code> to the end of the proof to finish it, the message is still the same</p>",
        "id": 515567940,
        "sender_full_name": "Thomas Zhu",
        "timestamp": 1746128051
    },
    {
        "content": "<p>Can the <code>apply?</code> be replaced with something that preserves the proving-False-ness?</p>",
        "id": 515567955,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1746128061
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"282271\">Bolton Bailey</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/DeepSeek-Prover.20V2/near/515567955\">said</a>:</p>\n<blockquote>\n<p>Can the <code>apply?</code> be replaced with something that preserves the proving-False-ness?</p>\n</blockquote>\n<p>Yes, replace it with <code>sorry</code> to get the same behavior</p>",
        "id": 515568010,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1746128095
    },
    {
        "content": "<p>Ok, but at that point the proof depends on sorry, so it isn't impressive that it proves <code>False</code></p>",
        "id": 515568121,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1746128135
    },
    {
        "content": "<p><code>#print f</code> shows <code>sorry</code> still</p>",
        "id": 515568233,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1746128165
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"282271\">Bolton Bailey</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/DeepSeek-Prover.20V2/near/515568121\">said</a>:</p>\n<blockquote>\n<p>Ok, but at that point the proof depends on sorry, so it isn't impressive that it proves false</p>\n</blockquote>\n<p>But <code>apply?</code> also inserted a <code>sorry</code> so it really isn't any different?</p>",
        "id": 515568367,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1746128228
    },
    {
        "content": "<p><del>I think it's this line? <a href=\"https://github.com/leanprover/lean4/blob/92775557d938bf64f39ac81e3a1d2835eb1b5adb/src/Lean/AddDecl.lean#L173\">https://github.com/leanprover/lean4/blob/92775557d938bf64f39ac81e3a1d2835eb1b5adb/src/Lean/AddDecl.lean#L173</a> because it complains about <code>levelParams</code></del></p>",
        "id": 515568386,
        "sender_full_name": "Thomas Zhu",
        "timestamp": 1746128236
    },
    {
        "content": "<p>11 messages were moved here from <a class=\"stream-topic\" data-stream-id=\"219941\" href=\"/#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/DeepSeek-Prover.20V2/with/515338707\">#Machine Learning for Theorem Proving &gt; DeepSeek-Prover V2</a> by <span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span>.</p>",
        "id": 515568644,
        "sender_full_name": "Notification Bot",
        "timestamp": 1746128333
    },
    {
        "content": "<p>I think there are two separate issues here: (1) <code>apply?</code> inserts a sorry but after that there are no red/orange squiggly lines; (2) if you replace <code>apply?</code> with <code>sorry</code> the lines appear, but in either case <code>#print axioms f</code> shows no axioms</p>",
        "id": 515568833,
        "sender_full_name": "Thomas Zhu",
        "timestamp": 1746128412
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"631691\">Thomas Zhu</span> <a href=\"#narrow/channel/270676-lean4/topic/.23print.20axioms.20does.20not.20report.20sorry/near/515568833\">said</a>:</p>\n<blockquote>\n<p>(1) <code>apply?</code> inserts a sorry but after that there are no red/orange squiggly lines</p>\n</blockquote>\n<p>This happens because you can only see the first 500 squiggles in any given file and <code>apply?</code> fills them all up with code suggestions.</p>",
        "id": 515568934,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1746128461
    },
    {
        "content": "<p>Is there an option to increase that limit anywhere?</p>",
        "id": 515569247,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1746128555
    },
    {
        "content": "<p>Ahh ok, thanks for pointing out! In any case, the issue (2) is more concerning:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">am_gm_inequality</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">NNReal</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">),</span>\n<span class=\"w\">    </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">prod</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">m</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h₁</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">NNReal</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">NNReal</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">prod</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"gr\">sorry</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">h₂</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n\n<span class=\"c1\">-- 'f' does not depend on any axioms</span>\n<span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">axioms</span><span class=\"w\"> </span><span class=\"n\">f</span>\n</code></pre></div>\n<p>and the result is sensitive to the <code>have h₁</code> line</p>",
        "id": 515569429,
        "sender_full_name": "Thomas Zhu",
        "timestamp": 1746128623
    },
    {
        "content": "<p>It's because there's a universe level in the proof that's not in the type</p>",
        "id": 515569535,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1746128652
    },
    {
        "content": "<p><code>Type*</code> is the culprit here</p>",
        "id": 515569561,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1746128665
    },
    {
        "content": "<p>MWE:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">universe</span><span class=\"w\"> </span><span class=\"n\">u</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">id</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n\n<span class=\"c1\">-- 'f' does not depend on any axioms</span>\n<span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">axioms</span><span class=\"w\"> </span><span class=\"n\">f</span>\n</code></pre></div>",
        "id": 515569779,
        "sender_full_name": "Thomas Zhu",
        "timestamp": 1746128754
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479299\">Jovan Gerbscheid</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Task.2026.3A.20Replace.20Type.20u.20by.20Type*.20wherever.20possible/near/513715193\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span>, using explicit universes also gives the error you said is weird:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">universe</span><span class=\"w\"> </span><span class=\"n\">u</span>\n\n<span class=\"c1\">-- error is on the whole `theorem` line</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">weird</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span>\n<span class=\"w\">  </span><span class=\"n\">trivial</span>\n</code></pre></div>\n<p>So I think the problem here is just that  Lean's universe error messages have room for improvement. (Although this isn't a common scenario in practice anyways)</p>\n</blockquote>",
        "id": 515570676,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1746129080
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/270676-lean4/topic/.23print.20axioms.20does.20not.20report.20sorry/near/515569247\">said</a>:</p>\n<blockquote>\n<p>Is there an option to increase that limit anywhere?</p>\n</blockquote>\n<p>I checked VS Code's source code at some point in the past for this, but I didn't find anything (IIRC it's just a constant that cannot be configured), so I suspect the answer is \"no\".</p>\n<p>Edit: Ah, <a href=\"https://github.com/microsoft/vscode/blob/3f0b857f7fd96e532df82c85614ebd08675bd8e4/src/vs/editor/common/services/markerDecorationsService.ts#L116\">here</a> it is, and it is still not configurable.</p>",
        "id": 515571523,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1746129411
    },
    {
        "content": "<p>On v4.18.0, the message is as expected <code>'f' depends on axioms: [sorryAx]</code></p>",
        "id": 515572510,
        "sender_full_name": "Thomas Zhu",
        "timestamp": 1746129782
    },
    {
        "content": "<p>This is a more minimized error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">universe</span><span class=\"w\"> </span><span class=\"n\">u</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">CoreM</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getEnv</span>\n<span class=\"w\">  </span><span class=\"n\">assert!</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">env</span><span class=\"bp\">.</span><span class=\"n\">find?</span><span class=\"w\"> </span><span class=\"ss\">``f</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">isSome</span>\n<span class=\"w\">  </span><span class=\"n\">assert!</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">env</span><span class=\"bp\">.</span><span class=\"n\">constants</span><span class=\"bp\">.</span><span class=\"n\">find?</span><span class=\"w\"> </span><span class=\"ss\">``f</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">isNone</span>\n<span class=\"w\">  </span><span class=\"n\">assert!</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">env</span><span class=\"bp\">.</span><span class=\"n\">checked</span><span class=\"bp\">.</span><span class=\"n\">get</span><span class=\"bp\">.</span><span class=\"n\">find?</span><span class=\"w\"> </span><span class=\"ss\">``f</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">isNone</span>\n</code></pre></div>",
        "id": 515576356,
        "sender_full_name": "Thomas Zhu",
        "timestamp": 1746131289
    },
    {
        "content": "<p>The name <code>`f</code> is in <code>env.find?</code> but not in <code>env.constants</code>. (I think) this makes the line <code>#print axioms f</code> not raise an error. But f is not in Kernel.Environment:  <code>env.checked.get.find? f</code> is none, and <code>env.checked.get.find?</code> is (only recently) used in the <code>Lean.collectAxioms</code> function for <code>#print axioms</code>.</p>",
        "id": 515576987,
        "sender_full_name": "Thomas Zhu",
        "timestamp": 1746131523
    },
    {
        "content": "<p>This is definitely an unintended side effect of parallelism that should be fixed but I see this as very far from the level of an interface soundness issue: there clearly is an error message (whose text should also be improved) and so <code>lean</code>/<code>lake build</code>/CI/... would still fail. And <code>lean4checker</code> would of course have caught it in either case.</p>",
        "id": 515578201,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1746131990
    },
    {
        "content": "<p>I don't intend this issue to be \"we broke Lean's soundness\" or whatever, it's just something I couldn't figure out the cause of</p>",
        "id": 515579088,
        "sender_full_name": "Thomas Zhu",
        "timestamp": 1746132349
    },
    {
        "content": "<p>Is there any reason why <a href=\"https://github.com/leanprover/lean4/blob/af4c693030f0491645bbaa5bbf7d75bb549e105e/src/Lean/Util/CollectAxioms.lean#L37\">this line</a> silently ignores a constant not in the (kernel) environment? To me the quickest fix seems to raise an error at this line. I am really not familiar with the way asynchronous elaboration works, so I don't know if the <code>env.find?</code> differing from <code>env.constants.find?</code> above is a genuine bug or is it intended.</p>",
        "id": 515610900,
        "sender_full_name": "Thomas Zhu",
        "timestamp": 1746148365
    }
]