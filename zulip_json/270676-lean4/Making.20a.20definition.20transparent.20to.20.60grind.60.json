[
    {
        "content": "<p>Hello,</p>\n<p>In my usecase of <code>grind</code>, I need some predicate definitions to be transparent. What is the proper way to do this?</p>\n<p>I tried to annotate these predicates as <code>reducible</code>, however this comes with the downside that we cannot ematch on this predicate anymore (see <code>fg</code> on the example below, there we cannot ematch on <code>∧</code>).</p>\n<p>Then I tried to add a grind pattern on the <code>.eq_def</code> theorem of my predicate, but this raises an error (see below). This feels like a bug to me, should I open an issue?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">fg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">n</span>\n\n<span class=\"c1\">-- Error: Unknown constant `fg.eq_def`</span>\n<span class=\"n\">grind_pattern</span><span class=\"w\"> </span><span class=\"n\">fg</span><span class=\"bp\">.</span><span class=\"n\">eq_def</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">fg</span><span class=\"w\"> </span><span class=\"n\">n</span>\n\n\n<span class=\"c1\">-- workaround</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">fg</span><span class=\"bp\">.</span><span class=\"n\">grind_eq_def</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">fg</span><span class=\"bp\">.</span><span class=\"n\">eq_def</span>\n<span class=\"n\">grind_pattern</span><span class=\"w\"> </span><span class=\"n\">fg</span><span class=\"bp\">.</span><span class=\"n\">grind_eq_def</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">fg</span><span class=\"w\"> </span><span class=\"n\">n</span>\n\n<span class=\"c1\">-- surprisingly, now this works??</span>\n<span class=\"n\">grind_pattern</span><span class=\"w\"> </span><span class=\"n\">fg</span><span class=\"bp\">.</span><span class=\"n\">eq_def</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">fg</span><span class=\"w\"> </span><span class=\"n\">n</span>\n</code></pre></div>",
        "id": 539956616,
        "sender_full_name": "Théophile",
        "timestamp": 1758097693
    },
    {
        "content": "<p>You can mark the definition itself with <code>@[grind]</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">grind</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">fg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">n</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">fg</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">grind</span>\n</code></pre></div>",
        "id": 539958672,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1758098350
    },
    {
        "content": "<p>About the <code>surprisingly, now this works??</code>, there are some definitions in Lean which are only generated on first use. So <code>fg.eq_def</code> might be one of these, and is therefore only available <em>after</em> you used it in the <code>fg.grind_eq_def</code>.</p>",
        "id": 539959010,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1758098465
    },
    {
        "content": "<p>That would be a bug though; in places like these identifiers should cause the necessary realizations to happen</p>",
        "id": 539959816,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758098726
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"372804\">@Marcus Rossel</span> ah indeed, I didn't think about that for some reason, thanks!</p>",
        "id": 539997069,
        "sender_full_name": "Théophile",
        "timestamp": 1758110760
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/10426\">lean4#10426</a></p>",
        "id": 539998891,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758111229
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"873547\">@Robin Arnez</span> !!</p>",
        "id": 539999477,
        "sender_full_name": "Théophile",
        "timestamp": 1758111380
    }
]