[
    {
        "content": "<p>I would expect that library search tools like <code>exact?</code> would suggest local theorems, even if they are not marked as <code>public</code>. However, <code>private</code> theorems are not suggested by <code>exact?</code></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">module</span>\n\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">exact?</span><span class=\"w\"> </span><span class=\"c1\">-- error</span>\n</code></pre></div>",
        "id": 564586152,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1766100606
    },
    {
        "content": "<p>The problem is in <code>blacklistInsertion</code>, which calls <code>Name.isInternalDetail</code>, which triggers on <code>private</code> declarations.</p>",
        "id": 564586334,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1766100712
    },
    {
        "content": "<p>I've opened a PR to fix this: <a href=\"https://github.com/leanprover/lean4/pull/11736\">lean#11736</a></p>",
        "id": 564605300,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1766111235
    },
    {
        "content": "<p>Does you fix also account for private declarations imported via <code>import all</code>?</p>",
        "id": 564759313,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1766170570
    },
    {
        "content": "<p>No, it doesn't. Is the preferred behaviour then \"if not in the module system, only use <code>private</code> from the same file, if in the module system, then use all <code>private</code> declarations (except, as usual any <code>isImplementationDetail</code> declarations, etc)\"?</p>",
        "id": 564762136,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1766171826
    },
    {
        "content": "<p>I guess so. I would describe it as: if you can use it with <code>exact</code>, then it should be considered by <code>exact?</code>.</p>",
        "id": 564762845,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1766172129
    },
    {
        "content": "<p>Shouldn't that fix be applied to the body of <code>isInternalDetail</code> itself?</p>",
        "id": 564763260,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1766172321
    },
    {
        "content": "<p>No, <code>isInternalDetail</code> is something else.</p>",
        "id": 564777590,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1766179540
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/270676-lean4/topic/.60exact.3F.60.20and.20private.20declarations/near/564762136\">said</a>:</p>\n<blockquote>\n<p>No, it doesn't. Is the preferred behaviour then \"if not in the module system, only use <code>private</code> from the same file, if in the module system, then use all <code>private</code> declarations (except, as usual any <code>isImplementationDetail</code> declarations, etc)\"?</p>\n</blockquote>\n<p>I've pushed this change to the PR now.</p>",
        "id": 564777598,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1766179547
    },
    {
        "content": "<p>The only other place where <code>isInternalDetail</code> is used, is here: <a href=\"https://github.com/leanprover/lean4/blob/c88ec35c0db43ab95e70eb829a62b287031e7959/src/Lean/LibrarySuggestions/Basic.lean#L321\">https://github.com/leanprover/lean4/blob/c88ec35c0db43ab95e70eb829a62b287031e7959/src/Lean/LibrarySuggestions/Basic.lean#L321</a><br>\nAnd I guess, this place also should receive the same fix for handling <code>private</code> declarations.<br>\nIf <code>isInternalDetail</code> is something else, then maybe we should use different name. <code>isVisibleName</code>/<code>isAccessibleName</code> or something like that?</p>",
        "id": 564789206,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1766187957
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/270676-lean4/topic/.60exact.3F.60.20and.20private.20declarations/near/564777598\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/270676-lean4/topic/.60exact.3F.60.20and.20private.20declarations/near/564762136\">said</a>:</p>\n<blockquote>\n<p>No, it doesn't. Is the preferred behaviour then \"if not in the module system, only use <code>private</code> from the same file, if in the module system, then use all <code>private</code> declarations (except, as usual any <code>isImplementationDetail</code> declarations, etc)\"?</p>\n</blockquote>\n<p>I've pushed this change to the PR now.</p>\n</blockquote>\n<p>I don't see any new changes in <a href=\"https://github.com/leanprover/lean4/pull/11736\">lean#11736</a> ?</p>",
        "id": 564789647,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1766188455
    },
    {
        "content": "<p>Sorry, I failed to push. Fixed in <a href=\"https://github.com/leanprover/lean4/pull/11759\">https://github.com/leanprover/lean4/pull/11759</a></p>",
        "id": 564914023,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1766349179
    }
]