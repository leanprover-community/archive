[
    {
        "content": "<p>In the following example, if the last line of the proof is replaced by <code>exact?</code> we get an error and <code>apply?</code> has many suggestions, but none that close the goal. Is this just a case of depth of search? If so, is there some configuration change available?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">isom_bijective</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">      </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_11</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_12</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ϕ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"bp\">≃*</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">),</span>\n<span class=\"w\">        </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">Bijective</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">⇑</span><span class=\"n\">ϕ</span><span class=\"bp\">.</span><span class=\"n\">toMonoidHom</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"n\">inst₁</span><span class=\"w\"> </span><span class=\"n\">inst₂</span><span class=\"w\"> </span><span class=\"n\">ϕ</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">MulEquiv</span><span class=\"bp\">.</span><span class=\"n\">bijective</span>\n</code></pre></div>",
        "id": 547687421,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1761736018
    },
    {
        "content": "<p>I have reduced the import to just the file containing the theorem, Mathlib.Algebra.Group.Equiv.Defs, and things still fail. Is this a bug?</p>",
        "id": 547689278,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1761736666
    },
    {
        "content": "<p>Have you looked at the output of <code>set_option trace.Tactic.librarySearch</code> and <code>set_option trace.Tactic.librarySearch.lemmas</code>?</p>",
        "id": 547689762,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761736848
    },
    {
        "content": "<p>Just tried, and it seems the correct function was found and rejected. Pasting the output from the infoview:</p>\n<p>[Tactic.librarySearch] <span aria-label=\"cross mark\" class=\"emoji emoji-274c\" role=\"img\" title=\"cross mark\">:cross_mark:</span> Function.Bijective ⇑ϕ.toMonoidHom ▼<br>\n  [] <span aria-label=\"cross mark\" class=\"emoji emoji-274c\" role=\"img\" title=\"cross mark\">:cross_mark:</span> trying EquivLike.bijective  <br>\n  [] <span aria-label=\"check\" class=\"emoji emoji-2705\" role=\"img\" title=\"check\">:check:</span> trying Function.bijective_iff_existsUnique with mpr  <br>\n  [] <span aria-label=\"check\" class=\"emoji emoji-2705\" role=\"img\" title=\"check\">:check:</span> trying Function.Bijective.of_comp_iff' with mp  <br>\n  [] <span aria-label=\"check\" class=\"emoji emoji-2705\" role=\"img\" title=\"check\">:check:</span> trying Function.bijective_iff_has_inverse with mpr  <br>\n  [] <span aria-label=\"cross mark\" class=\"emoji emoji-274c\" role=\"img\" title=\"cross mark\">:cross_mark:</span> trying Function.bijective_of_subsingleton  <br>\n  [] <span aria-label=\"check\" class=\"emoji emoji-2705\" role=\"img\" title=\"check\">:check:</span> trying Function.Bijective.of_comp_iff with mp  <br>\n  [] <span aria-label=\"cross mark\" class=\"emoji emoji-274c\" role=\"img\" title=\"cross mark\">:cross_mark:</span> trying Function.Involutive.bijective  <br>\n  [] <span aria-label=\"check\" class=\"emoji emoji-2705\" role=\"img\" title=\"check\">:check:</span> trying Unique.bijective  <br>\n  [] <span aria-label=\"check\" class=\"emoji emoji-2705\" role=\"img\" title=\"check\">:check:</span> trying EquivLike.bijective_comp with mp  <br>\n  [] <span aria-label=\"check\" class=\"emoji emoji-2705\" role=\"img\" title=\"check\">:check:</span> trying EquivLike.comp_bijective with mp  <br>\n  [] <span aria-label=\"check\" class=\"emoji emoji-2705\" role=\"img\" title=\"check\">:check:</span> trying Equiv.bijective_comp with mp  <br>\n  [] <span aria-label=\"check\" class=\"emoji emoji-2705\" role=\"img\" title=\"check\">:check:</span> trying Equiv.comp_bijective with mp</p>",
        "id": 547690250,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1761737025
    },
    {
        "content": "<p>Oops, sorry. That is a different function.</p>",
        "id": 547690463,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1761737102
    },
    {
        "content": "<p>But it seems that 12 functions were tried, 9 leading to the next step and some internal barrier was hit (was it <code>constantsPerImportTask</code>?)</p>",
        "id": 547691104,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1761737295
    },
    {
        "content": "<p>That looks like MulEquiv.bijective isn't even on the list. Does it show up under the <code>lemmas</code> trace option?</p>",
        "id": 547691639,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761737476
    },
    {
        "content": "<p>I got that list with </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">librarySearch</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">librarySearch</span><span class=\"bp\">.</span><span class=\"n\">lemmas</span><span class=\"w\"> </span><span class=\"n\">true</span>\n</code></pre></div>",
        "id": 547691873,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1761737576
    },
    {
        "content": "<p>You have to unfold semireducible definitions to apply the lemma <code>MulEquiv.bijective</code>. I forgot if <code>library_search</code> tries to unify up to semireducible defeq? And even if it does, maybe the discrimination tree keys are not computed up to semireducible defeq?</p>",
        "id": 547692524,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1761737812
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"n\">inst₁</span><span class=\"w\"> </span><span class=\"n\">inst₂</span><span class=\"w\"> </span><span class=\"n\">ϕ</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span>\n<span class=\"w\">    </span><span class=\"n\">exact?</span>\n</code></pre></div>\n<p>does work</p>",
        "id": 547692667,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1761737866
    },
    {
        "content": "<p>Wow. Thanks.</p>",
        "id": 547692745,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1761737896
    }
]