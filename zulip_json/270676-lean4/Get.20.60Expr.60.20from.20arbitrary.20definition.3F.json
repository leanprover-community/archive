[
    {
        "content": "<p>Hello! Is it possible in Lean to obtain the <code>Expr</code> object from an arbitrary <code>let</code> definition? I see that there is a <code>ToExpr</code> class for this purpose, but it works only with a small set of types.</p>",
        "id": 448578599,
        "sender_full_name": "Vasilii Nesterov",
        "timestamp": 1719918516
    },
    {
        "content": "<p>Are you looking for something like the <code>Qq</code> library? I allows you to make an <code>Expr</code> object like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Qq</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Qq</span>\n<span class=\"c\">/-</span>\n<span class=\"cm\">Lean.Expr.app</span>\n<span class=\"cm\">  (Lean.Expr.app</span>\n<span class=\"cm\">    (Lean.Expr.app</span>\n<span class=\"cm\">      (Lean.Expr.app</span>\n<span class=\"cm\">        (Lean.Expr.app</span>\n<span class=\"cm\">          (Lean.Expr.app</span>\n<span class=\"cm\">            (Lean.Expr.const `HAdd.hAdd [Lean.Level.zero, Lean.Level.zero, Lean.Level.zero])</span>\n<span class=\"cm\">            (Lean.Expr.const `Nat []))</span>\n<span class=\"cm\">          (Lean.Expr.const `Nat []))</span>\n<span class=\"cm\">        (Lean.Expr.const `Nat []))</span>\n<span class=\"cm\">      (Lean.Expr.app</span>\n<span class=\"cm\">        (Lean.Expr.app (Lean.Expr.const `instHAdd [Lean.Level.zero]) (Lean.Expr.const `Nat []))</span>\n<span class=\"cm\">        (Lean.Expr.const `instAddNat [])))</span>\n<span class=\"cm\">    (Lean.Expr.app</span>\n<span class=\"cm\">      (Lean.Expr.app</span>\n<span class=\"cm\">        (Lean.Expr.app (Lean.Expr.const `OfNat.ofNat [Lean.Level.zero]) (Lean.Expr.const `Nat []))</span>\n<span class=\"cm\">        (Lean.Expr.lit (Lean.Literal.natVal 1)))</span>\n<span class=\"cm\">      (Lean.Expr.app (Lean.Expr.const `instOfNatNat []) (Lean.Expr.lit (Lean.Literal.natVal 1)))))</span>\n<span class=\"cm\">  (Lean.Expr.app</span>\n<span class=\"cm\">    (Lean.Expr.app</span>\n<span class=\"cm\">      (Lean.Expr.app (Lean.Expr.const `OfNat.ofNat [Lean.Level.zero]) (Lean.Expr.const `Nat []))</span>\n<span class=\"cm\">      (Lean.Expr.lit (Lean.Literal.natVal 1)))</span>\n<span class=\"cm\">    (Lean.Expr.app (Lean.Expr.const `instOfNatNat []) (Lean.Expr.lit (Lean.Literal.natVal 1))))</span>\n\n<span class=\"cm\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 448580536,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1719919112
    },
    {
        "content": "<p>Thanks, that's almost what I was looking for! Can I use it with local definitions? Something like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 448585165,
        "sender_full_name": "Vasilii Nesterov",
        "timestamp": 1719920564
    },
    {
        "content": "<p>You can do</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">n</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 448585611,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1719920724
    }
]