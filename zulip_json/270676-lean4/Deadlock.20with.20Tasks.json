[
    {
        "content": "<p>Hey there,</p>\n<p>I've been using tasks for a while now, and i recently updated to 4.14</p>\n<p>It seems that this introduces a reproducible deadlock in my code.</p>\n<p>Is there something that changed recently-ish?</p>",
        "id": 482745903,
        "sender_full_name": "Thomas Vigouroux",
        "timestamp": 1731741619
    },
    {
        "content": "<p>Wait actually, the deadlock seems to happen in earlier versions of lean, so I am definitely doing something wrong here</p>\n<p>What are the does/don't about Tasks ?</p>",
        "id": 482779629,
        "sender_full_name": "Thomas Vigouroux",
        "timestamp": 1731771310
    },
    {
        "content": "<p>Do avoid Task.get in non-dedicated tasks as having all tasks in the thread pool wait on it will lead to deadlocks</p>",
        "id": 482780475,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1731772004
    },
    {
        "content": "<p>Hmm so from what I can see I only call it once...</p>",
        "id": 482781468,
        "sender_full_name": "Thomas Vigouroux",
        "timestamp": 1731772851
    },
    {
        "content": "<p>The code is here by the way: <a href=\"https://git.sr.ht/~vigoux/busybeaver/tree/733fdfcef00587f38e16e2c161d500516bf629a0/item/Busybeaver/Enumerate/Impl.lean\">https://git.sr.ht/~vigoux/busybeaver/tree/733fdfcef00587f38e16e2c161d500516bf629a0/item/Busybeaver/Enumerate/Impl.lean</a></p>",
        "id": 482781592,
        "sender_full_name": "Thomas Vigouroux",
        "timestamp": 1731772935
    },
    {
        "content": "<p>The idea is that the <code>BBComputeP</code> functions does some kind of parallel fold operation on a tree</p>",
        "id": 482781622,
        "sender_full_name": "Thomas Vigouroux",
        "timestamp": 1731772966
    },
    {
        "content": "<p>Does <code>List.waitAll</code> count as a <code>Task.get</code>?</p>",
        "id": 482781705,
        "sender_full_name": "Thomas Vigouroux",
        "timestamp": 1731773039
    },
    {
        "content": "<p>If you look at the stack traces in a debugger, it should tell you where they are stuck</p>",
        "id": 482783984,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1731774882
    },
    {
        "content": "<p>Can you display stakes for multiple thread though?</p>",
        "id": 482784022,
        "sender_full_name": "Thomas Vigouroux",
        "timestamp": 1731774934
    },
    {
        "content": "<p>You can either switch to another thread and do a backtrace:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">th</span><span class=\"w\"> </span><span class=\"mi\">3</span>\n<span class=\"n\">bt</span>\n</code></pre></div>\n<p>or show all:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">th</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">all</span><span class=\"w\"> </span><span class=\"n\">bt</span>\n</code></pre></div>",
        "id": 482784799,
        "sender_full_name": "Henrik BÃ¶ving",
        "timestamp": 1731775560
    },
    {
        "content": "<p>'Kay, I'll have a look then</p>\n<p>From what I've seen, there remains 4 threads running and doing nothing but using each one core</p>",
        "id": 482785216,
        "sender_full_name": "Thomas Vigouroux",
        "timestamp": 1731775918
    },
    {
        "content": "<p>Which surprises me actually, is there some kind of spin loop?</p>",
        "id": 482785262,
        "sender_full_name": "Thomas Vigouroux",
        "timestamp": 1731775930
    }
]