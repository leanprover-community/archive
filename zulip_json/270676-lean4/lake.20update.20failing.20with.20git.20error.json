[
    {
        "content": "<p>Running <code>lake update</code> in a repo of mine is giving this error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">update</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">external</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">git'</span><span class=\"w\"> </span><span class=\"n\">exited</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n</code></pre></div>\n<p>How can I figure out what's going on here? Git is otherwise working as normal for me</p>",
        "id": 510540053,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1743989671
    },
    {
        "content": "<p>Ah, the verbose option. I'm still not sure what the fix is though:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">trace</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">fetch</span><span class=\"w\"> </span><span class=\"c1\">--tags --force origin</span>\n<span class=\"n\">trace</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cannot</span><span class=\"w\"> </span><span class=\"n\">lock</span><span class=\"w\"> </span><span class=\"n\">ref</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">refs</span><span class=\"bp\">/</span><span class=\"n\">remotes</span><span class=\"bp\">/</span><span class=\"n\">origin</span><span class=\"bp\">/</span><span class=\"n\">jt496_brooks'</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"mi\">756</span><span class=\"n\">d8e3dbdf1959dc91b6dc74b8c29756e915825</span><span class=\"w\"> </span><span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"mi\">9</span><span class=\"n\">fbf12e16956d0ae7c908fed62da8f0d69c32c33</span>\n<span class=\"n\">From</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span>\n<span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"mi\">9</span><span class=\"n\">fbf12e169</span><span class=\"bp\">..</span><span class=\"m\">3058685</span><span class=\"n\">a7a</span><span class=\"w\">  </span><span class=\"n\">jt496_brooks</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">origin</span><span class=\"bp\">/</span><span class=\"n\">jt496_brooks</span><span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">unable</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">update</span><span class=\"w\"> </span><span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"n\">ref</span><span class=\"o\">)</span>\n<span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b1b71c3f05</span><span class=\"bp\">...</span><span class=\"n\">dadb75c188</span><span class=\"w\"> </span><span class=\"n\">update</span><span class=\"bp\">-</span><span class=\"n\">dependencies</span><span class=\"bp\">-</span><span class=\"n\">bot</span><span class=\"bp\">-</span><span class=\"n\">use</span><span class=\"bp\">-</span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">origin</span><span class=\"bp\">/</span><span class=\"n\">update</span><span class=\"bp\">-</span><span class=\"n\">dependencies</span><span class=\"bp\">-</span><span class=\"n\">bot</span><span class=\"bp\">-</span><span class=\"n\">use</span><span class=\"bp\">-</span><span class=\"n\">only</span><span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">forced</span><span class=\"w\"> </span><span class=\"n\">update</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 510540385,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1743989917
    },
    {
        "content": "<p>Have you tried nuking the .lake/packages/mathlib directory?</p>",
        "id": 510540536,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1743990012
    },
    {
        "content": "<p>That seemed to work - it made git use 300% of my CPU, but it worked! Thanks!</p>",
        "id": 510540652,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1743990100
    },
    {
        "content": "<p>I usually assume \"cannot lock ref\" means git got into a bad state, that rarely reproducible,.</p>",
        "id": 510540992,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1743990310
    },
    {
        "content": "<p>same error happened to me... is there anything wrong with <code>v19.0 -rc3</code>?</p>",
        "id": 513847587,
        "sender_full_name": "Edison Xie",
        "timestamp": 1745408502
    },
    {
        "content": "<p>I had a git error code 128 yesterday with a failing <code>lake update mathlib</code> but the usual faffing around fixed it in the end.</p>",
        "id": 513858624,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1745411404
    },
    {
        "content": "<p>mine is fixes using nuke mathlib directory but I doubt that's the normal way to do... (</p>",
        "id": 513862734,
        "sender_full_name": "Edison Xie",
        "timestamp": 1745412524
    }
]