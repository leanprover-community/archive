[
    {
        "content": "<p>I have recently noticed a surprising \"double mathlib compilation\" in some cases. Steps to reproduce:</p>\n<div class=\"codehilite\" data-code-language=\"txt\"><pre><span></span><code>$ mkdir some-project\n$ cd some-project\n$ lake init\n</code></pre></div>\n<p>then add</p>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"k\">[[require]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"mathlib\"</span>\n<span class=\"n\">scope</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"leanprover-community\"</span>\n</code></pre></div>\n<p>into <code>lakefile.toml</code> (before <code>lean-lib</code>), run</p>\n<div class=\"codehilite\" data-code-language=\"txt\"><pre><span></span><code>$ lake update\n</code></pre></div>\n<p>Then this is fine</p>\n<div class=\"codehilite\" data-code-language=\"txt\"><pre><span></span><code>$ lake build\nBuild completed successfully (8 jobs).\n</code></pre></div>\n<p>But if we change <code>SomeProject/Basic.lean</code> to</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">hello</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"world\"</span>\n</code></pre></div>\n<p>then</p>\n<div class=\"codehilite\" data-code-language=\"txt\"><pre><span></span><code>$ lake lean SomeProject.lean\n⣽ [8015/8016] Running SomeProject.Basic (+ 0 more)\n</code></pre></div>\n<p>is still quick, however</p>\n<div class=\"codehilite\" data-code-language=\"txt\"><pre><span></span><code>$ lake build\n⣟ [8059/16020] Running Batteries.Control.Nondet.Basic:c.o (+ 7 more)\n</code></pre></div>\n<p>starts compiling a double of Mathlib, or how I should interpret the number 16020.</p>\n<p>What happened? Is it a bug? Am I doing something fundamentally wrong?</p>",
        "id": 573936514,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1771115516
    },
    {
        "content": "<p>This topic was moved here from <a class=\"stream-topic\" data-stream-id=\"270676\" href=\"/#narrow/channel/270676-lean4/topic/Recompiling.20Mathlib.20after.20adding.20as.20a.20dependency\">#lean4 &gt; Recompiling Mathlib after adding as a dependency</a> by <span class=\"user-mention silent\" data-user-id=\"133339\">Mirek Olšák</span>.</p>",
        "id": 573959722,
        "sender_full_name": "Notification Bot",
        "timestamp": 1771143353
    },
    {
        "content": "<p>That's often the case if your project has some exe (e.g. a <code>Main.lean</code>) floating around which some of the default projects create by <code>lake</code> do. Simply delete the executable from the lakefile if you don't need it or make sure it does not import Mathlib</p>",
        "id": 573962411,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1771146557
    },
    {
        "content": "<p>Ah, I see makes sense.</p>",
        "id": 573962709,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1771146893
    }
]