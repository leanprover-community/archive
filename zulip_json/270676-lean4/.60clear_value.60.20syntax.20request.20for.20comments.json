[
    {
        "content": "<p>In <a href=\"https://github.com/leanprover/lean4/pull/8449\">lean4#8449</a>, I upstreamed the mathlib <code>clear_value</code> tactic while adding a new feature, which is the ability to create a new propositional equality defining the value before clearing it.</p>\n<p>For example, given <code>n : Nat := 2</code> in the local context, then <code>clear_value n with h</code> now adds <code>h : n = 2</code> before clearing the value of <code>n</code>.</p>\n<p><strong>*Using <code>with</code> is a bit of a compromise.</strong> Being able to write something like <code>clear_value h : n</code> is more \"Lean 4\", and makes it closer to tactics like <code>generalize</code>. However, <code>clear_value</code> is similar to <code>clear</code>, and both take a space-delimited list of identifiers, like <code>unfold</code>. I went with <code>with</code> here because the <code>generalize</code>-style syntax should be comma-delimited. That is, you would write <code>clear_value a, b, c</code> rather than <code>clear_value a b c</code> to accommodate the <code>clear_value a, hb : b, c</code> feature.</p>",
        "id": 520704290,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1748361865
    },
    {
        "content": "<p><strong>Are there any alternative syntax ideas?</strong> Here are some that come to mind:</p>\n<ul>\n<li>Pioneer a dual notation for identifier lists, allowing both <code>clear_value a b c</code> and <code>clear_value [a, b, c]</code>. Only the second version would allow <code>clear_value [a, hb : b, c]</code>.</li>\n<li>Remove this feature from <code>clear_value</code> and add a separate tactic for creating these equalities. (Perhaps <code>have_eq hb : b</code>, and use comma-separated lists like <code>generalize</code>.) We are also planning on adding <code>let (eq := hb) b := 2</code> syntax to create the equality at the same time as the let binding is created, so <code>have_eq</code> may not be necessary.</li>\n<li>The previous idea in another direction, don't add the feature, but add a term elaborator such as <code>value% b</code> so that one write <code>have hb : b = value% b := rfl</code> instead. If anything, <code>value%</code> would be useful on its own, and that could support writing <code>have_eq</code> as a macro.</li>\n<li>Use a noWs syntax like <code>clear_value a hb:b c</code>.</li>\n<li>Something else...</li>\n</ul>",
        "id": 520704315,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1748361873
    },
    {
        "content": "<p>(Pinging <span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span>, who commented on the PR.)</p>",
        "id": 520704320,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1748361875
    },
    {
        "content": "<p><code>clear_value h : n</code> and <code>clear_value [a, hb : b, c]</code> are IMO both a bad idea since <code>h</code>/<code>hb</code> are NOT of type <code>n</code>/<code>b</code></p>",
        "id": 520810026,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1748412234
    },
    {
        "content": "<p><code>let (eq := hb) b := 2</code> and <code>value%</code> would both be lovely and would mostly sidestep the issue</p>",
        "id": 520810189,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1748412311
    },
    {
        "content": "<p>I believe all this makes happy to stick with <code>with</code></p>",
        "id": 520810215,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1748412336
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/270676-lean4/topic/.60clear_value.60.20syntax.20request.20for.20comments/near/520810189\">said</a>:</p>\n<blockquote>\n<p><code>let (eq := hb) b := 2</code> and <code>value%</code> would both be lovely and would mostly sidestep the issue</p>\n</blockquote>\n<p>I think there is <code>set b := 2 with hb</code></p>",
        "id": 520819918,
        "sender_full_name": "Jz Pan",
        "timestamp": 1748416450
    },
    {
        "content": "<p>Yes, but it's a different keyword for no good reason!</p>",
        "id": 520820249,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1748416572
    },
    {
        "content": "<p>It's only marginally different.</p>",
        "id": 520820409,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1748416639
    },
    {
        "content": "<p>And <code>set! b := 2 with hb</code> should be exactly your <code>let (eq := hb) b := 2</code> (<code>set!</code> is without substitution, I think).</p>",
        "id": 520820481,
        "sender_full_name": "Jz Pan",
        "timestamp": 1748416671
    },
    {
        "content": "<p>... which is weird, since prepending <code>!</code> to a tactic name (almost) always means \"Try harder\", not \"Try less\"</p>",
        "id": 520820752,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1748416771
    },
    {
        "content": "<p>Maybe it should be <code>set¡</code></p>",
        "id": 520820938,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1748416831
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"366779\">Jz Pan</span> <a href=\"#narrow/channel/270676-lean4/topic/.60clear_value.60.20syntax.20request.20for.20comments/near/520819918\">said</a>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">think</span><span class=\"w\"> </span><span class=\"n\">there</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"ss\">`set</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">hb</span><span class=\"bp\">`</span>\n</code></pre></div>\n<p>Yes, though that's a tactic, and <code>let (eq := hb) b := 2</code> would be available as term syntax too (also for <code>have</code>).</p>",
        "id": 520836158,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1748421953
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/270676-lean4/topic/.60clear_value.60.20syntax.20request.20for.20comments/near/520810026\">said</a>:</p>\n<blockquote>\n<p><code>clear_value h : n</code> and <code>clear_value [a, hb : b, c]</code> are IMO both a bad idea since <code>h</code>/<code>hb</code> are NOT of type <code>n</code>/<code>b</code></p>\n</blockquote>\n<p>It is meant to be like <code>for h : i in [0:n] do</code> and <code>match h : x with</code> syntax.</p>",
        "id": 520836448,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1748422045
    },
    {
        "content": "<p>Perhaps <code>clear_value (ha : a) b (hc : c)</code>? I would prefer that over the list syntax. Although I'm not entirely convinced that the notion of <code>:</code> from type ascription takes... So perhaps <code>a b c with ha _ hc</code> seems like the best solution.</p>",
        "id": 520855678,
        "sender_full_name": "Sebastian Graf",
        "timestamp": 1748427817
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/270676-lean4/topic/.60clear_value.60.20syntax.20request.20for.20comments/near/520836448\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/270676-lean4/topic/.60clear_value.60.20syntax.20request.20for.20comments/near/520810026\">said</a>:</p>\n<blockquote>\n<p><code>clear_value h : n</code> and <code>clear_value [a, hb : b, c]</code> are IMO both a bad idea since <code>h</code>/<code>hb</code> are NOT of type <code>n</code>/<code>b</code></p>\n</blockquote>\n<p>It is meant to be like <code>for h : i in [0:n] do</code> and <code>match h : x with</code> syntax.</p>\n</blockquote>\n<p>Great, because I don't like those notations either :-) At least I'm consistent <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 520856509,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1748428094
    },
    {
        "content": "<p>Right, but the existence of those two features actually makes <code>(ha : a) b (hc : c)</code> feel consistent to me, even if in isolation overloading : seems like a questionable idea. (Should've taken the care to read Kyle's last post, thanks for pointing it out.)</p>",
        "id": 520858876,
        "sender_full_name": "Sebastian Graf",
        "timestamp": 1748428934
    },
    {
        "content": "<p>Your personal tastes have been noted <span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span> — that said, <code>match h : x with</code> syntax is here to stay, and <code>clear_value</code> has similar semantics.</p>\n<p><span class=\"user-mention\" data-user-id=\"130195\">@Sebastian Graf</span> That's an interesting solution, though having the parentheses makes it look even more like a type ascription. Maybe a synthesis of some ideas is <code>clear_value (ha : a = _) b (hc : c = _)</code>? That also admits writing other terms in place of <code>_</code> in case you want to adjust the term while clearing...</p>",
        "id": 520858951,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1748428960
    },
    {
        "content": "<p>Love it! <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 520859045,
        "sender_full_name": "Sebastian Graf",
        "timestamp": 1748428993
    },
    {
        "content": "<p>Implemented in <a href=\"https://github.com/leanprover/lean4/pull/8516\">lean4#8516</a></p>",
        "id": 520880854,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1748435543
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/270676-lean4/topic/.60clear_value.60.20syntax.20request.20for.20comments/near/520858951\">said</a>:</p>\n<blockquote>\n<p>Maybe a synthesis of some ideas is <code>clear_value (ha : a = _) b (hc : c = _)</code>?</p>\n</blockquote>\n<p>This is exactly what was at the back of my mind! I wasn't sure I should offer it, since the <code>= _</code> feels redundant, but being able to replace the <code>_</code> with some defeq expression is great justification for it being there</p>",
        "id": 520889959,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1748438051
    },
    {
        "content": "<p>Or in the space of things that I think I was already told was impossible,</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">clear_eq</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">a</span>\n</code></pre></div>",
        "id": 520984980,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748471697
    },
    {
        "content": "<p>More relevantly; is there design space here for a tactic that goes from</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>and changes the goal to</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"n\">hb</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"mi\">37</span>\n<span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">b</span>\n</code></pre></div>\n<p>or perhaps</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"n\">ha</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"mi\">37</span>\n</code></pre></div>\n<p>or is partially clearing values like this never useful in practice?</p>",
        "id": 520985277,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748471880
    },
    {
        "content": "<p>It seems like you can do that with <code>revert</code> and <code>generalize</code></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"o\">)</span><span class=\"bp\">;</span>\n<span class=\"w\">    </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">a</span>\n\n<span class=\"w\">  </span><span class=\"n\">revert</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"n\">generalize</span><span class=\"w\"> </span><span class=\"n\">hb</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span>\n<span class=\"cm\">  b : ℕ</span>\n<span class=\"cm\">  hb : bar 37 = b</span>\n<span class=\"cm\">  a : ℕ := foo b</span>\n<span class=\"cm\">  -/</span>\n</code></pre></div>\n<p>(Doing <code>generalize hb : bar 37 = b at a</code> doesn't seem to affect the let value.)</p>",
        "id": 520985771,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1748472170
    },
    {
        "content": "<p>In general, do many tactics affect <code>let</code> values? I think I've wanted to use <code>rw</code> at a let value in the past.</p>",
        "id": 520986443,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748472587
    }
]