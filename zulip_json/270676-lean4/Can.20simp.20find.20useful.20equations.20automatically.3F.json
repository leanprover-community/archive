[
    {
        "content": "<p>I encountered the following situation again and again: I have a goal in which a term of the form <code>n - m + m</code> appears, where <code>n</code> and <code>m</code> are terms of type ℕ,  (Note that <code>n</code> and <code>m</code> are not always simple variables but may be expressions themselves.).  In general, <code>n - m + m</code> cannot be simplified to <code>n</code>.  But In the context I have the hypothesis <code>m ≤ n</code>, so indeed <code>n - m + m = n</code> in this context.  Right now I have to manually tell Lean this fact by adding <code>show n - m + m = n by omega</code> to the list of equations given to <code>simp</code>.  Would it be possible for <code>simp</code> to find such equations by itself?</p>",
        "id": 532991209,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1754428698
    },
    {
        "content": "<p>If <code>h : m ≤ n</code> then try <code>simp [h]</code>?</p>",
        "id": 532991501,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754428853
    },
    {
        "content": "<p>One more example: I may have <code>m &lt; n</code> among the hypotheses and the goal contains an if-then-else whose condition is <code>m &lt; n + 1</code>.  Then \"obviously\" the condition is false and the ITE should simply to its ELSE clause.  But now I have to explicitly supply <code>show ¬ m &lt; n + 1 by omega</code> to <code>simp</code>.</p>",
        "id": 532992000,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1754429141
    },
    {
        "content": "<p>It's possible to tell <code>simp</code> to use <code>omega</code> as a discharger as well, via <code>simp (disch := omega)</code>.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">disch</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">omega</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"c1\">-- `n = 2`</span>\n</code></pre></div>\n<p>Aaron's suggestion of <code>simp [h]</code> (or <code>simp [*]</code>) works here too because this supplies the hypothesis to the simp lemma.</p>",
        "id": 532992983,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1754429714
    },
    {
        "content": "<p>I'm not sure why <code>if_pos</code> needs to be given explicitly here, but the discharger works for <code>if</code> as well:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">disch</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">omega</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">if_pos</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"c1\">-- ⊢ p</span>\n</code></pre></div>",
        "id": 532993315,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1754429915
    },
    {
        "content": "<p>How about this?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>Here <code>f</code> represent some complex expression in which the ℕ terms are embedded.</p>",
        "id": 532993744,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1754430169
    },
    {
        "content": "<p>Another situation: The goal is:<br>\n<code>ss (k + 1 + φ m) ∈ Automaton.next (ss (k + φ m)) (as (k + φ m))</code><br>\nwhile there is this hypothesis:<br>\n<code>ss (k + φ m + 1) ∈ Automaton.next (ss (k + φ m)) (as (k + φ m))</code><br>\nIt would be really nice if some like \"assumption\" would just work.</p>",
        "id": 532994471,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1754430576
    },
    {
        "content": "<p>Sorry, I made a typo above, which I just corrected.</p>",
        "id": 532994803,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1754430769
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110637\">Ching-Tsun Chou</span> <a href=\"#narrow/channel/270676-lean4/topic/Can.20simp.20find.20useful.20equations.20automatically.3F/near/532993744\">said</a>:</p>\n<blockquote>\n<p>How about this?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>Here <code>f</code> represent some complex expression in which the ℕ terms are embedded.</p>\n</blockquote>\n<p>Have you been able to try <code>grind</code> yet? It's good at that sort of goal.</p>\n<p>I'm not sure <code>simp</code> will ever have significant symbolic arithmetic normalization integrated into it. Note that users can write simprocs to extend simp's capabilities, and one can write some kind of symbolic normalizer.</p>\n<p>I'll mention that there's some limited arithmetic normalization with <code>simp +arith</code>.</p>",
        "id": 532994804,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1754430770
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110637\">Ching-Tsun Chou</span> <a href=\"#narrow/channel/270676-lean4/topic/Can.20simp.20find.20useful.20equations.20automatically.3F/near/532994471\">said</a>:</p>\n<blockquote>\n<p>It would be really nice if some like \"assumption\" would just work.</p>\n</blockquote>\n<p>I agree that it would be nice if there were better ways to do \"conversion modulo arithmetic\".</p>\n<p>With our current tactics, all I can really think of for that particular case is doing <code>convert h using n</code> where <code>n</code> is some number to limit congruence, and then <code>omega</code>.</p>\n<p><code>grind</code> probably works here; might be worth testing.</p>",
        "id": 532995151,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1754431037
    },
    {
        "content": "<p>Indeed <code>grind</code> works for that example!  Thanks for pointing that out.<br>\nI don't necessarily have to use <code>simp</code>.  It's just the first thing I reach for, so many of my <code>show ... by omega</code> lemmas appear as equations given to <code>simp</code>.</p>",
        "id": 532995163,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1754431047
    }
]