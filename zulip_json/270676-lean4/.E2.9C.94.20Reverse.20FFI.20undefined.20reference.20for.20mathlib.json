[
    {
        "content": "<p>Hi, I am playing around with the toy example for Reverse FFI, but I keep running into issue when I tried to add an import to <code>RFFI.lean</code> :   </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"n\">my_length</span><span class=\"kd\">]</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">myLength</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt64</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n\n<span class=\"w\">Â  </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"bp\">.</span><span class=\"n\">toUInt64</span>\n</code></pre></div>\n<p>And when I run <code>make</code> there will be error saying <code>underfined reference to 'initialize_Mathlib_Data_List_Basic'</code>. </p>\n<p>FYI, I have require mathlib from git in lakefile and I am using Ubuntu on windows . Thanks!</p>",
        "id": 475128923,
        "sender_full_name": "Cruise Song",
        "timestamp": 1728241633
    },
    {
        "content": "<p>How did you compile and link your code? The error suggests that somehow you are not linking against Mathlib</p>",
        "id": 475142073,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1728248292
    },
    {
        "content": "<p>I made an example project for reverse ffi with mathlib <a href=\"https://github.com/lecopivo/ReverseFFIwithMathlib\">https://github.com/lecopivo/ReverseFFIwithMathlib</a> following it might help</p>",
        "id": 475194190,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1728275691
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"346070\">Tomas Skrivan</span> <a href=\"#narrow/stream/270676-lean4/topic/Reverse.20FFI.20undefined.20reference.20for.20mathlib/near/475194190\">said</a>:</p>\n<blockquote>\n<p>I made an example project for reverse ffi with mathlib <a href=\"https://github.com/lecopivo/ReverseFFIwithMathlib\">https://github.com/lecopivo/ReverseFFIwithMathlib</a> following it might help</p>\n</blockquote>\n<p>Thanks a lot! However when I tried to follow through on my mac there's error </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">cruis</span><span class=\"bp\">@</span><span class=\"n\">CruiseBook</span><span class=\"w\"> </span><span class=\"n\">ReverseFFIwithMathlib</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"bp\">.</span><span class=\"n\">cpp</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">lleanshared</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">lreverseffiwithmathlib</span>\n\n<span class=\"n\">ld</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">__</span><span class=\"n\">DATA_CONST</span><span class=\"w\"> </span><span class=\"n\">segment</span><span class=\"w\"> </span><span class=\"n\">missing</span><span class=\"w\"> </span><span class=\"n\">SG_READ_ONLY</span><span class=\"w\"> </span><span class=\"n\">flag</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"bp\">'/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">cruis</span><span class=\"bp\">/</span><span class=\"n\">Documents</span><span class=\"bp\">/</span><span class=\"n\">ReverseFFIwithMathlib</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">libreverseffiwithmathlib</span><span class=\"bp\">.</span><span class=\"n\">dylib'</span>\n<span class=\"n\">clang</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">linker</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">exit</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">see</span><span class=\"w\"> </span><span class=\"n\">invocation</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Is this error specific to macOS?</p>",
        "id": 475412659,
        "sender_full_name": "Cruise Song",
        "timestamp": 1728340077
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"346070\">Tomas Skrivan</span> <a href=\"#narrow/stream/270676-lean4/topic/Reverse.20FFI.20undefined.20reference.20for.20mathlib/near/475194190\">said</a>:</p>\n<blockquote>\n<p>I made an example project for reverse ffi with mathlib <a href=\"https://github.com/lecopivo/ReverseFFIwithMathlib\">https://github.com/lecopivo/ReverseFFIwithMathlib</a> following it might help</p>\n</blockquote>\n<p>Hi, this is a great repo, thanks! I was able to run the code using mathlib version v4.6.0-rc1, but I couldn't run the code on the latest mathlib version. Do I need to update lakefile.lean somehow? Thank you!</p>",
        "id": 475422753,
        "sender_full_name": "Brian Li",
        "timestamp": 1728344602
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"620790\">Cruise Song</span> <a href=\"#narrow/stream/270676-lean4/topic/Reverse.20FFI.20undefined.20reference.20for.20mathlib/near/475412659\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"346070\">Tomas Skrivan</span> <a href=\"#narrow/stream/270676-lean4/topic/Reverse.20FFI.20undefined.20reference.20for.20mathlib/near/475194190\">said</a>:</p>\n<blockquote>\n<p>I made an example project for reverse ffi with mathlib <a href=\"https://github.com/lecopivo/ReverseFFIwithMathlib\">https://github.com/lecopivo/ReverseFFIwithMathlib</a> following it might help</p>\n</blockquote>\n<p>Thanks a lot! However when I tried to follow through on my mac there's error </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">cruis</span><span class=\"bp\">@</span><span class=\"n\">CruiseBook</span><span class=\"w\"> </span><span class=\"n\">ReverseFFIwithMathlib</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"bp\">.</span><span class=\"n\">cpp</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">lleanshared</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">lreverseffiwithmathlib</span>\n\n<span class=\"n\">ld</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">__</span><span class=\"n\">DATA_CONST</span><span class=\"w\"> </span><span class=\"n\">segment</span><span class=\"w\"> </span><span class=\"n\">missing</span><span class=\"w\"> </span><span class=\"n\">SG_READ_ONLY</span><span class=\"w\"> </span><span class=\"n\">flag</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"bp\">'/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">cruis</span><span class=\"bp\">/</span><span class=\"n\">Documents</span><span class=\"bp\">/</span><span class=\"n\">ReverseFFIwithMathlib</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">libreverseffiwithmathlib</span><span class=\"bp\">.</span><span class=\"n\">dylib'</span>\n<span class=\"n\">clang</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">linker</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">exit</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">see</span><span class=\"w\"> </span><span class=\"n\">invocation</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Is this error specific to macOS?</p>\n</blockquote>\n<p>Most likely, I filed it as <a href=\"https://github.com/leanprover/lean4/pull/5649\">lean#5649</a></p>",
        "id": 475503673,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1728374761
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"764939\">Brian Li</span> <a href=\"#narrow/stream/270676-lean4/topic/Reverse.20FFI.20undefined.20reference.20for.20mathlib/near/475422753\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"346070\">Tomas Skrivan</span> <a href=\"#narrow/stream/270676-lean4/topic/Reverse.20FFI.20undefined.20reference.20for.20mathlib/near/475194190\">said</a>:</p>\n<blockquote>\n<p>I made an example project for reverse ffi with mathlib <a href=\"https://github.com/lecopivo/ReverseFFIwithMathlib\">https://github.com/lecopivo/ReverseFFIwithMathlib</a> following it might help</p>\n</blockquote>\n<p>Hi, this is a great repo, thanks! I was able to run the code using mathlib version v4.6.0-rc1, but I couldn't run the code on the latest mathlib version. Do I need to update lakefile.lean somehow? Thank you!</p>\n</blockquote>\n<p>I have updated the repo to the latest mathlib. </p>\n<p>I had to add one additional step, converting <code>libLean.a</code> to <code>libLean.so</code> because linker was complaining about undefined reference to <code>initialize_Lean_Replay</code> and <code>l_Lean_Environment_replay</code>.</p>",
        "id": 475798133,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1728463868
    },
    {
        "content": "<p>I didn't take a closer look at your repo but <code>libleanshared.so</code> contains <code>libLean.a</code></p>",
        "id": 475815323,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1728468125
    },
    {
        "content": "<p>Interesting, however running</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">nm</span><span class=\"w\"> </span><span class=\"bp\">~/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.13.0-rc3/lib/lean/libleanshared.so | grep initialize_Lean_Replay</span>\n</code></pre></div>\n<p>does not print anything, but </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">nm</span><span class=\"w\"> </span><span class=\"bp\">~/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.13.0-rc3/lib/lean/libLean.a | grep initialize_Lean_Replay</span>\n</code></pre></div>\n<p>prints</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"mi\">000000000000</span><span class=\"n\">dd90</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">initialize_Lean_Replay</span>\n</code></pre></div>",
        "id": 475824204,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1728470613
    },
    {
        "content": "<p>Oh, it's an orphan file not reachable from <code>Lean</code>... that may not be intentional</p>",
        "id": 475828891,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1728471848
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"620790\">Cruise Song</span> has marked this topic as resolved.</p>",
        "id": 476369397,
        "sender_full_name": "Notification Bot",
        "timestamp": 1728646990
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110024\">Sebastian Ullrich</span> <a href=\"#narrow/stream/270676-lean4/topic/.E2.9C.94.20Reverse.20FFI.20undefined.20reference.20for.20mathlib/near/475828891\">said</a>:</p>\n<blockquote>\n<p>Oh, it's an orphan file not reachable from <code>Lean</code>... that may not be intentional</p>\n</blockquote>\n<p>Fixed in <a href=\"https://github.com/leanprover/lean4/pull/5693\">lean#5693</a>.</p>",
        "id": 476651238,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1728868373
    }
]