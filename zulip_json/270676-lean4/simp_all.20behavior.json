[
    {
        "content": "<p>Hi everyone,</p>\n<p>I use <code>simp_all</code> a lot, usually via <code>aesop</code>. Today, I encountered the following behavior which I am having a hard time understanding.</p>\n<p>See <a href=\"https://live.lean-lang.org/#codez=FAWhAIGUHsFsFNwAcBO8AmBLAxgQwC6LQB24ABgHIFnDRK4COArokuABSkBc4V+AlOB4AFFHXDBg8AB65YSADaJ2ACyHJwABnCAkwg0BGQau082mwTwBiuBQGdEXALzgARgE9g4cLczyA+jYK4GCu8Cq4AG7wtuAKmADWiDJI8NiE6J7BEGqm4PoANOAqJhragEVE4NZ28Jm20CgoHqAQxNAA7rHw+ADkMUz24LjgbSi4SCko4ABm9eRIZAB0wOjwU+DCHNy8BBbrYmxOGsSSMnKKyjmluut5RsXqG+bqVQOH7rW+SAEKQQDawgBdLJzPJkcCYGKwCE+YgAc2mYlg4HwKkQsOgNkyIXuuXKlRs9iAA\">here</a>.</p>\n<p>Could someone help me understand what is happening here?<br>\nThanks!</p>",
        "id": 556904698,
        "sender_full_name": "Xavier Généreux",
        "timestamp": 1763404509
    },
    {
        "content": "<p><code>simp_all only [P]</code> tranforms <code>h</code> into <code>True → True</code>, that is sospicius...</p>",
        "id": 556911345,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1763406813
    },
    {
        "content": "<p>There must a stupid thing that confuses us (us = humans)</p>",
        "id": 556911481,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1763406878
    },
    {
        "content": "<p>Maybe what it does is that it realizes <code>p 0</code> is true, so also <code>P 1</code>, and now it has lost the implication</p>",
        "id": 556912099,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1763407110
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">simp_all</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">P</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>Like this it also removes <code>h1 : P 1</code>.</p>",
        "id": 556912784,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1763407366
    },
    {
        "content": "<p>It looks like a bug</p>",
        "id": 556912891,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1763407405
    },
    {
        "content": "<p>I looks like <code>simp_all</code> used used <code>h</code> and <code>h0</code> to realize <code>p 1</code> is True. The bug is in the fact, that it completely got rid of <code>p 1</code> assumption.</p>",
        "id": 556913204,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1763407540
    },
    {
        "content": "<p>Yes I don't understand why <code>P 1</code> gets transformed into <code>True</code>.</p>",
        "id": 556921018,
        "sender_full_name": "Xavier Généreux",
        "timestamp": 1763410144
    },
    {
        "content": "<p>Well, this happens often with <code>simp</code> calls. I guess it also transforms <code>x = x</code> into <code>True</code>, or something similar.</p>",
        "id": 556921362,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1763410256
    },
    {
        "content": "<p>But <code>p 1</code> is not universally true like <code>x = x</code>. That's not the same. Here <code>h h0</code> is a proof of <code>p 1</code>. The bug is that <code>simp_all</code> simplified <code>h</code> to True using <code>h h0</code>, without adding <code>h h0</code> to the context.</p>",
        "id": 556925747,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1763411767
    },
    {
        "content": "<p>It used the assumption to simplify itself</p>",
        "id": 556926853,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1763412181
    },
    {
        "content": "<p>Yes, I totally agree it's a bug</p>",
        "id": 556931097,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1763413819
    },
    {
        "content": "<p>Could you please write this up as an issue?</p>",
        "id": 558129510,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1763536706
    },
    {
        "content": "<p>See <a href=\"https://github.com/leanprover/lean4/issues/11291\">11291</a></p>",
        "id": 558473833,
        "sender_full_name": "Xavier Généreux",
        "timestamp": 1763655643
    }
]