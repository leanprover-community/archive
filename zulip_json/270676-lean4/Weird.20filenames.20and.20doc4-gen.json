[
    {
        "content": "<p>When trying to get doc-gen4 to work with a project, I got a failure when trying to build a module/filename containing characters that need french quoting. Perhaps this is expected and just not supported by doc-gen4. I made a minimal working example here:<br>\n<a href=\"https://github.com/mo271/TestProject\">https://github.com/mo271/TestProject</a><br>\nThis project contains a file <code>TestProject/Erdős.lean</code>. When running </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">DOCGEN_SRC</span><span class=\"bp\">=</span><span class=\"s2\">\"vscode\"</span> <span class=\"n\">lake</span> <span class=\"bp\">-</span><span class=\"n\">R</span> <span class=\"bp\">-</span><span class=\"n\">Kenv</span><span class=\"bp\">=</span><span class=\"n\">dev</span> <span class=\"n\">build</span> <span class=\"n\">TestProject</span><span class=\"o\">:</span><span class=\"n\">docs</span>\n</code></pre></div>\n<p>I get an error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"o\">[</span><span class=\"mi\">155</span><span class=\"bp\">/</span><span class=\"mi\">159</span><span class=\"o\">]</span> <span class=\"n\">Documenting</span> <span class=\"n\">module</span><span class=\"o\">:</span> <span class=\"n\">TestProject.</span><span class=\"bp\">«</span><span class=\"n\">Erd</span><span class=\"bp\">ő</span><span class=\"n\">s</span><span class=\"bp\">»</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">no</span> <span class=\"n\">such</span> <span class=\"n\">file</span> <span class=\"n\">or</span> <span class=\"n\">directory</span> <span class=\"o\">(</span><span class=\"n\">error</span> <span class=\"n\">code</span><span class=\"o\">:</span> <span class=\"mi\">2</span><span class=\"o\">)</span>\n  <span class=\"n\">file</span><span class=\"o\">:</span> <span class=\"bp\">./.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">doc</span><span class=\"bp\">/</span><span class=\"n\">TestProject</span><span class=\"bp\">/</span><span class=\"n\">Erd</span><span class=\"bp\">ő</span><span class=\"n\">s.html</span>\n</code></pre></div>\n<p>and indeed this file is not present:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">ls</span> <span class=\"bp\">./.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">doc</span><span class=\"bp\">/</span><span class=\"n\">TestProject</span>\n<span class=\"n\">Basic.html</span>  <span class=\"n\">Basic.html.hash</span>  <span class=\"n\">Basic.html.trace</span>  <span class=\"bp\">«</span><span class=\"n\">Erd</span><span class=\"bp\">ő</span><span class=\"n\">s</span><span class=\"bp\">».</span><span class=\"n\">html</span>  <span class=\"n\">Erd</span><span class=\"bp\">ő</span><span class=\"n\">s.html.trace</span>\n</code></pre></div>\n<p>However, <code> «Erdős».html</code> is there. I think the name of the missing file comes from this line:<br>\n<a href=\"https://github.com/leanprover/doc-gen4/blob/a34d3c1f7b72654c08abe5741d94794db40dbb2e/lakefile.lean#L139\">https://github.com/leanprover/doc-gen4/blob/a34d3c1f7b72654c08abe5741d94794db40dbb2e/lakefile.lean#L139</a><br>\nwhile the file that is present is written here: <a href=\"https://github.com/leanprover/doc-gen4/blob/a34d3c1f7b72654c08abe5741d94794db40dbb2e/DocGen4/Output/Base.lean#L125\">https://github.com/leanprover/doc-gen4/blob/a34d3c1f7b72654c08abe5741d94794db40dbb2e/DocGen4/Output/Base.lean#L125</a></p>\n<p>Is there an easy fix for that or is the solution to use more conventional names?</p>",
        "id": 434611197,
        "sender_full_name": "Moritz Firsching",
        "timestamp": 1713725882
    },
    {
        "content": "<p>Is <code>mod.filePath</code> set incorrectly there?</p>",
        "id": 434611551,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1713726190
    },
    {
        "content": "<p>not sure which one it incorrect, but this one is set to the name without the french quotes : <code>./.lake/build/doc/TestProject/Erdős.html</code><br>\n<a href=\"https://github.com/leanprover/lean4/blob/62cdb51ed5b9d8487877d5a4adbcd4659d81fc6a/src/lake/Lake/Config/Module.lean#L65-L66\">https://github.com/leanprover/lean4/blob/62cdb51ed5b9d8487877d5a4adbcd4659d81fc6a/src/lake/Lake/Config/Module.lean#L65-L66</a></p>",
        "id": 434613968,
        "sender_full_name": "Moritz Firsching",
        "timestamp": 1713728453
    },
    {
        "content": "<p>bumping this: Has anyone been able to use doc4-gen together with filenames that work only with french quotes?</p>",
        "id": 437002682,
        "sender_full_name": "Moritz Firsching",
        "timestamp": 1714810090
    },
    {
        "content": "<p>doc-gen4 failed to build Lean files with names containing a hyphen: <a href=\"https://paste.sr.ht/~chabulhwi/e2acec95483a00bc442afc376a2cf9ab6320da2d\">https://paste.sr.ht/~chabulhwi/e2acec95483a00bc442afc376a2cf9ab6320da2d</a>.</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">Some required builds logged failures:</span>\n<span class=\"go\">- TPIL.Chapter02.«Question01-10»:docs</span>\n<span class=\"go\">- TPIL.Chapter02.«Question13-14»:docs</span>\n<span class=\"go\">- TPIL.Chapter02.«Question19-20»:docs</span>\n<span class=\"go\">- TPIL.Chapter02.«Question22-25»:docs</span>\n<span class=\"go\">- TPIL.Chapter02.«Question34-38»:docs</span>\n<span class=\"go\">- TPIL.Chapter03.«Question03-08»:docs</span>\n<span class=\"go\">- TPIL.Chapter03.«Question10-14»:docs</span>\n<span class=\"go\">- TPIL.Chapter04.«Question04-05»:docs</span>\n<span class=\"go\">error: build failed</span>\n</code></pre></div>",
        "id": 500019330,
        "sender_full_name": "Bulhwi Cha",
        "timestamp": 1739719844
    },
    {
        "content": "<p>Possible fix in <a href=\"https://github.com/leanprover/doc-gen4/pull/267\">https://github.com/leanprover/doc-gen4/pull/267</a></p>",
        "id": 500020882,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1739721210
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"417769\">@Bulhwi Cha</span>, <span class=\"user-mention\" data-user-id=\"313038\">@Moritz Firsching</span>, this is now merged: can you check if it works for you?</p>",
        "id": 502055127,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1740578768
    },
    {
        "content": "<p>I'll test it tomorrow. Thanks!</p>",
        "id": 502058503,
        "sender_full_name": "Bulhwi Cha",
        "timestamp": 1740579633
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> It works great!</p>",
        "id": 502177494,
        "sender_full_name": "Bulhwi Cha",
        "timestamp": 1740619715
    },
    {
        "content": "<p>I found another problem: doc-gen4 creates duplicate web pages for a Lean file containing a hyphen.</p>\n<p><a href=\"/user_uploads/3121/zYam_eAWfGLO_tG8GRiirrnW/20250227_10h32m57s_doc-gen4.png\">20250227_10h32m57s_doc-gen4.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/zYam_eAWfGLO_tG8GRiirrnW/20250227_10h32m57s_doc-gen4.png\" title=\"20250227_10h32m57s_doc-gen4.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"532x552\" src=\"/user_uploads/thumbnail/3121/zYam_eAWfGLO_tG8GRiirrnW/20250227_10h32m57s_doc-gen4.png/840x560.webp\"></a></div><div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>▼ TPIL (file)\n  ▶ Chapter02\n  ▼ Chapter03\n      Question03-08\n      Question10-14\n      «Question03-08»\n      «Question10-14»\n  ▶ Chapter04\n  ▶ Exam\n</code></pre></div>",
        "id": 502178416,
        "sender_full_name": "Bulhwi Cha",
        "timestamp": 1740620260
    },
    {
        "content": "<p>Do both pages exist?</p>",
        "id": 502178525,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1740620324
    },
    {
        "content": "<p>Yes, they do.</p>",
        "id": 502178554,
        "sender_full_name": "Bulhwi Cha",
        "timestamp": 1740620350
    },
    {
        "content": "<p>Or do half of these links not work? (if so, which half?)</p>",
        "id": 502178555,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1740620351
    },
    {
        "content": "<p>Can you try <code>rm -rf .lake</code> and rebuilding, just to be sure?</p>",
        "id": 502178585,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1740620379
    },
    {
        "content": "<p>I wonder if you have a mixture of outputs from old and new doc-gen somehow</p>",
        "id": 502178612,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1740620397
    },
    {
        "content": "<p>Let me try removing the <code>.lake</code> subdirectory and rebuilding it.</p>",
        "id": 502179172,
        "sender_full_name": "Bulhwi Cha",
        "timestamp": 1740620715
    },
    {
        "content": "<p>If you have a live url you can share it would be much easier to debug</p>",
        "id": 502179854,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1740621136
    },
    {
        "content": "<p>Rebuilding docs fixed the problem!</p>",
        "id": 502180017,
        "sender_full_name": "Bulhwi Cha",
        "timestamp": 1740621256
    },
    {
        "content": "<p>Now, there's no page whose name contains French double quotation marks.</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>▼ TPIL (file)\n  ▶ Chapter02\n  ▼ Chapter03\n      Question03-08\n      Question10-14\n  ▶ Chapter04\n  ▶ Exam\n</code></pre></div>",
        "id": 502180089,
        "sender_full_name": "Bulhwi Cha",
        "timestamp": 1740621310
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> , the fix also works for me!</p>",
        "id": 502227586,
        "sender_full_name": "Moritz Firsching",
        "timestamp": 1740646249
    },
    {
        "content": "<p>Just for the record, while the fixed worked for some weird filenames, it didn't fix the problem for filenames which contain \"<code>.</code>\" (except of coure, the last \"<code>.</code>\" in \"<code>.lean</code>\"). Example repo here: <a href=\"https://github.com/mo271/DocgenTest\">https://github.com/mo271/DocgenTest</a>. </p>\n<p>The error is something like:</p>\n<div class=\"codehilite\" data-code-language=\"Fish\"><pre><span></span><code>rc3/lib ././../.lake/packages/doc-gen4/.lake/build/bin/doc-gen4 single --build ././.lake/build DocgenTest.«File.with.dots» file:///home/firsching/DocgenTest/DocgenTest/«File.with.dots».lean\nerror: no such file <span class=\"k\">or</span> directory <span class=\"o\">(</span>error code: 2<span class=\"o\">)</span>\n  file: ././.lake/build/doc/DocgenTest/File.with.dots.html\nSome required builds logged failures:\n- DocgenTest.«File.with.dots»:docs\n</code></pre></div>",
        "id": 512497097,
        "sender_full_name": "Moritz Firsching",
        "timestamp": 1744793183
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/doc-gen4/pull/275\">https://github.com/leanprover/doc-gen4/pull/275</a></p>",
        "id": 512506122,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744795746
    }
]