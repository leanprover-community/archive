[
    {
        "content": "<p>The following lean code can not be compiled successfully. It took more than half an hour and the compiling is still running. I am wondering if there is some infinite loop in this code?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Init</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Nat</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">gcd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"c1\">-- Base case: n = 0</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">gcd</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"c1\">-- Inductive step: assume the statement holds for n, prove for n + 1</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">gcd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">gcd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">gcd_comm</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">gcd</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">ring</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h1</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">ih</span>\n</code></pre></div>",
        "id": 465859147,
        "sender_full_name": "Shange Tang",
        "timestamp": 1724883907
    },
    {
        "content": "<p>Can you have a quick look at <a href=\"https://github.com/leanprover-community/mathlib/wiki/Code-in-backticks\">#backticks</a> (it's a link, you can click) and fix the formatting just to be sure of exactly what you're running</p>",
        "id": 465861024,
        "sender_full_name": "Julian Berman",
        "timestamp": 1724884948
    },
    {
        "content": "<p>It's also possible that what appears to be compiling is Mathlib -- the way you should get access to Mathlib is by downloading a \"cache\" which saves all of the work of building it yourself. Usually the way you do that is by running <code>lake exe cache get</code> (first closing VSCode!) -- have you run that?</p>",
        "id": 465861209,
        "sender_full_name": "Julian Berman",
        "timestamp": 1724885058
    },
    {
        "content": "<p>Thanks for the reply! I will try that.</p>",
        "id": 465865363,
        "sender_full_name": "Shange Tang",
        "timestamp": 1724887574
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321696\">Julian Berman</span> <a href=\"#narrow/stream/270676-lean4/topic/Possible.20infinite.20loop.3F/near/465861209\">said</a>:</p>\n<blockquote>\n<p>the way you should get access to Mathlib is by downloading a \"cache\" which saves all of the work of building it yourself. Usually the way you do that is by running <code>lake exe cache get</code> (first closing VSCode!) -- have you run that?</p>\n</blockquote>\n<p>Why close VSCode? I regularly <code>lake exe cache get</code> without closing, never had an issue (with this particular command. Of course, updating dependencies etc. causes issues often)</p>",
        "id": 465869409,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1724890542
    },
    {
        "content": "<p>I think not closing it just runs the risk that there's some compilation still ongoing (whereas closing it will stop that). It's not the worst thing, but I've seen others recommend closing it just to not be confused by continued high CPU usage. (All the above is parroted mostly though as I don't use VSCode often myself).</p>",
        "id": 465871326,
        "sender_full_name": "Julian Berman",
        "timestamp": 1724892038
    },
    {
        "content": "<p>I would strongly recommend you stop using <code>lake exe cache get</code> and start using the new vscode command <code>Lean 4: Project: Fetch Mathlib Build Cache For Focused File</code> (sadly only works within mathlib right now, but I'm sure we can open an issue)</p>",
        "id": 465900989,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1724905694
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/stream/270676-lean4/topic/Possible.20infinite.20loop.3F/near/465900989\">said</a>:</p>\n<blockquote>\n<p>I would strongly recommend you stop using <code>lake exe cache get</code> and start using the new vscode command <code>Lean 4: Project: Fetch Mathlib Build Cache For Focused File</code> (sadly only works within mathlib right now, but I'm sure we can open an issue)</p>\n</blockquote>\n<p>This is due to the API of <code>lake exe cache get</code>, which IIRC is <a href=\"https://github.com/leanprover-community/mathlib4/blob/f29bd08eb816af4554c9a41b968f445ee3302afb/Cache/IO.lean#L129\">hardcoded for Mathlib</a>.</p>",
        "id": 465928267,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1724916094
    },
    {
        "content": "<p>At least I think that I tested <code>lake exe cache get &lt;path&gt;</code> in projects downstream of Mathlib at the time and couldn't get it to work, but it's been a while</p>",
        "id": 465928654,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1724916208
    },
    {
        "content": "<p>I have just tried. Seems to work fine?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">gitpod</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">workspace</span><span class=\"bp\">/</span><span class=\"n\">LeanAPAP</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nnLpNorm</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Algebra</span><span class=\"bp\">/</span><span class=\"n\">Module</span><span class=\"bp\">/</span><span class=\"n\">PID</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"n\">installing</span><span class=\"w\"> </span><span class=\"n\">leantar</span><span class=\"w\"> </span><span class=\"mf\">0.1</span><span class=\"bp\">.</span><span class=\"m\">13</span>\n<span class=\"w\">  </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">Total</span><span class=\"w\">    </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">Received</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">Xferd</span><span class=\"w\">  </span><span class=\"n\">Average</span><span class=\"w\"> </span><span class=\"n\">Speed</span><span class=\"w\">   </span><span class=\"n\">Time</span><span class=\"w\">    </span><span class=\"n\">Time</span><span class=\"w\">     </span><span class=\"n\">Time</span><span class=\"w\">  </span><span class=\"n\">Current</span>\n<span class=\"w\">                                 </span><span class=\"n\">Dload</span><span class=\"w\">  </span><span class=\"n\">Upload</span><span class=\"w\">   </span><span class=\"n\">Total</span><span class=\"w\">   </span><span class=\"n\">Spent</span><span class=\"w\">    </span><span class=\"n\">Left</span><span class=\"w\">  </span><span class=\"n\">Speed</span>\n<span class=\"w\">  </span><span class=\"mi\">0</span><span class=\"w\">     </span><span class=\"mi\">0</span><span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"w\">     </span><span class=\"mi\">0</span><span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"w\">     </span><span class=\"mi\">0</span><span class=\"w\">      </span><span class=\"mi\">0</span><span class=\"w\">      </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"c1\">--:--:-- --:--:-- --:--:--     0</span>\n<span class=\"mi\">100</span><span class=\"w\"> </span><span class=\"mi\">1054</span><span class=\"n\">k</span><span class=\"w\">  </span><span class=\"mi\">100</span><span class=\"w\"> </span><span class=\"mi\">1054</span><span class=\"n\">k</span><span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"w\">     </span><span class=\"mi\">0</span><span class=\"w\">  </span><span class=\"mi\">1417</span><span class=\"n\">k</span><span class=\"w\">      </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"c1\">--:--:-- --:--:-- --:--:-- 1417k</span>\n\n<span class=\"n\">Attempting</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">download</span><span class=\"w\"> </span><span class=\"mi\">1559</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span>\n<span class=\"n\">Downloaded</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1559</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">attempted</span><span class=\"w\"> </span><span class=\"mi\">1559</span><span class=\"bp\">/</span><span class=\"mi\">1559</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">100</span><span class=\"bp\">%</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">100</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">success</span><span class=\"o\">)</span>\n<span class=\"n\">Decompressing</span><span class=\"w\"> </span><span class=\"mi\">1559</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span>\n<span class=\"n\">Unpacked</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mi\">41</span><span class=\"w\"> </span><span class=\"n\">ms</span>\n<span class=\"n\">Completed</span><span class=\"w\"> </span><span class=\"n\">successfully!</span>\n</code></pre></div>",
        "id": 465929100,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1724916355
    },
    {
        "content": "<p>Yes, but you want to get the cache for the current file (i.e. all of its Mathlib dependencies), not a specific dependency, no? Otherwise you'll have to copy and paste paths again, which is why this command exists in the first place.</p>",
        "id": 465929425,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1724916446
    },
    {
        "content": "<p>Ah sorry, I misunderstood what you said. Let me try again</p>",
        "id": 465929653,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1724916515
    },
    {
        "content": "<p>Indeed <span aria-label=\"sad\" class=\"emoji emoji-2639\" role=\"img\" title=\"sad\">:sad:</span></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">gitpod</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">workspace</span><span class=\"bp\">/</span><span class=\"n\">LeanAPAP</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nnLpNorm</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"n\">LeanAPAP</span><span class=\"bp\">/</span><span class=\"n\">Prereqs</span><span class=\"bp\">/</span><span class=\"n\">Expect</span><span class=\"bp\">/</span><span class=\"n\">Basic</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"n\">uncaught</span><span class=\"w\"> </span><span class=\"n\">exception</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Unknown</span><span class=\"w\"> </span><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">LeanAPAP</span>\n</code></pre></div>",
        "id": 465929760,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1724916551
    },
    {
        "content": "<p>The alternative would be for the vscode action to run <code>lake exe cache get &lt;file&gt;</code> for <code>file</code> runnning over all mathlib imports of the file. Do you think that's doable?</p>",
        "id": 465932112,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1724917134
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span>, how about just fixing <code>cache</code>, rather than asking for the VSCode extension to jump through hoops?</p>",
        "id": 465933463,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724917541
    },
    {
        "content": "<p>I mean, that's obviously the better solution, but I thought this was put aside because we didn't agree on mathlib getting special-casing?</p>",
        "id": 465933735,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1724917588
    },
    {
        "content": "<p>I don't think VS Code should provide this functionality. I'd like the commands of the extension to remain either thin wrappers over existing tooling functionality or more elaborate tools which provide UI interactivity that the corresponding CLI tools can't provide.</p>\n<p>The crux with vscode-lean4 is that it is not versioned with Lean (or Mathlib) and needs to be backwards compatible at least with Lean versions where users could already rely on a given vscode-lean4 feature in the past.</p>",
        "id": 465934076,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1724917682
    },
    {
        "content": "<p>Why not use <code>lake exe cache get</code> without a path?</p>",
        "id": 465936633,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1724918336
    },
    {
        "content": "<p>That takes way longer than it should. Most files import at most a quarter of mathlib</p>",
        "id": 465938068,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1724918721
    },
    {
        "content": "<p>How often do you update mathlib?</p>",
        "id": 465939527,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1724919160
    },
    {
        "content": "<p>I switch branches every 3-5 minutes</p>",
        "id": 465939978,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1724919295
    }
]