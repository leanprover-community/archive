[
    {
        "content": "<p>Hi all! If I run this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">run_elab</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Term</span><span class=\"bp\">.</span><span class=\"n\">elabTerm</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">none</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">lambdaTelescope</span><span class=\"w\"> </span><span class=\"n\">e</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"{v}\"</span>\n</code></pre></div>\n<p>I get somewhat inscrutable names. For various reasons; I'd like to get my hands on the original <code>x</code> and <code>y</code>. Is there any way to do this?</p>\n<p>Other question: if I then later lambda over these generated names, do I get a term that looks nice?</p>",
        "id": 545406558,
        "sender_full_name": "Cody Roux",
        "timestamp": 1760634744
    },
    {
        "content": "<p>this is the wrong way to do whatever you are trying to do</p>",
        "id": 545407512,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760635012
    },
    {
        "content": "<p>can you give some more information please about whatever you are trying to do</p>",
        "id": 545407686,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760635067
    },
    {
        "content": "<p>like for example those various reasons</p>",
        "id": 545407798,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760635102
    },
    {
        "content": "<p>This might be closer to what you want:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"w\"> </span><span class=\"n\">Elab</span>\n<span class=\"n\">run_elab</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Term</span><span class=\"bp\">.</span><span class=\"n\">elabTerm</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">none</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">lambdaTelescope</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"{v}\"</span>\n</code></pre></div>",
        "id": 545408227,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1760635230
    },
    {
        "content": "<p>(also <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a>)</p>",
        "id": 545408242,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1760635235
    },
    {
        "content": "<p>aha</p>",
        "id": 545408340,
        "sender_full_name": "Cody Roux",
        "timestamp": 1760635264
    },
    {
        "content": "<p>Note that the monads <code>MetaM</code> and <code>TermElabM</code> have a notion of local context (i.e. the hypotheses you see in the tactic state). This is part of the monad context. A function like <code>lambdaTelescope</code> modifies the context (it's different inside the program in its argument).<br>\nThe variables <code>v</code> and <code>_</code> that <code>lambdaTelescope</code> might <em>not</em> be well-typed inside the ambient context, and so operations on them will not work properly.</p>",
        "id": 545408533,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1760635318
    },
    {
        "content": "<p>to answer <span class=\"user-mention\" data-user-id=\"816344\">@Aaron Liu</span> ; we have a bunch of code that's doing the \"wrong\" thing all over the place; I'm trying to incrementally move it to being the \"right\" thing.</p>",
        "id": 545408695,
        "sender_full_name": "Cody Roux",
        "timestamp": 1760635367
    },
    {
        "content": "<p>though going in to the details would be time consuming and would probably need me to understand more of the code than I currently do</p>",
        "id": 545408901,
        "sender_full_name": "Cody Roux",
        "timestamp": 1760635425
    },
    {
        "content": "<p>incrementally?</p>",
        "id": 545408904,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760635426
    },
    {
        "content": "<p>Actually the last line can be just <code>logInfo m!\"{v}\"</code> (editing that now)</p>",
        "id": 545408930,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1760635434
    },
    {
        "content": "<p>Note: <code>m!\"...\"</code> is the recommended way to print anything that involves expressions. It gives nice hovers in the InfoView.</p>",
        "id": 545409166,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1760635500
    },
    {
        "content": "<p>I see, thanks!</p>",
        "id": 545409228,
        "sender_full_name": "Cody Roux",
        "timestamp": 1760635518
    },
    {
        "content": "<p>Yes; for now I'm just trying to make the front end a little less crazy; at the moment it creates fresh variables wholesale, which it later lambdas over.</p>",
        "id": 545409514,
        "sender_full_name": "Cody Roux",
        "timestamp": 1760635605
    },
    {
        "content": "<p>You may be looking for</p>\n<ul>\n<li><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.mkFreshFVarId#doc\">docs#Lean.mkFreshFVarId</a></li>\n<li><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Meta.withLocalDecl#doc\">docs#Lean.Meta.withLocalDecl</a></li>\n<li><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Meta.lambdaTelescope#doc\">docs#Lean.Meta.lambdaTelescope</a></li>\n</ul>",
        "id": 545410082,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760635766
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 545410258,
        "sender_full_name": "Cody Roux",
        "timestamp": 1760635820
    }
]