[
    {
        "content": "<p>Is there a simple way to switch off common subexpression elimination in the code generator?</p>",
        "id": 451047531,
        "sender_full_name": "John Tristan",
        "timestamp": 1720809418
    },
    {
        "content": "<p>Unfortunately not no. The new compiler does have a highly modifiable compilation pass pipeline but its not production ready yet and also, as of now, not being worked on though that will change again at some point.</p>\n<p>Are you having issues with CSE and linearity?</p>",
        "id": 451048094,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1720809662
    },
    {
        "content": "<p>No, I'm exploring some idea for doing probabilistic computation</p>",
        "id": 451048464,
        "sender_full_name": "John Tristan",
        "timestamp": 1720809829
    },
    {
        "content": "<p>If you want to show some code I can try to figure something out but if the only possible approach is to disable CSE you're out of luck I'm afraid.</p>",
        "id": 451048619,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1720809885
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"221511\">John Tristan</span> <a href=\"#narrow/stream/270676-lean4/topic/Switch.20off.20common.20subexpression.20elimination/near/451048464\">said</a>:</p>\n<blockquote>\n<p>No, I'm exploring some idea for doing probabilistic computation</p>\n</blockquote>\n<p>I'm playing around with probabilistic programming  and I didn't run into such issue. Can you share some code where common subexpression elimination causes issues?</p>",
        "id": 451084175,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1720822067
    },
    {
        "content": "<p>I ran into this problem because I was trying something out and playing with the FFI (and I was doing it wrong). I'll share something when it is presentable. But I do agree that there are ways to do verification of probabilistic computation that do not have such issues, I have an example here: <a href=\"https://github.com/leanprover/SampCert\">https://github.com/leanprover/SampCert</a></p>",
        "id": 451099680,
        "sender_full_name": "John Tristan",
        "timestamp": 1720830009
    },
    {
        "content": "<p>I was suspecting ffi, you probably didn't respect purity i.e. pure function was returning random output. The solution is to wrap it in <code>IO</code> monad.</p>",
        "id": 451108102,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1720834321
    },
    {
        "content": "<p>Exactly. I'm now calling <code>lean_io_result_mk_ok</code> and my tests are working.</p>",
        "id": 451110205,
        "sender_full_name": "John Tristan",
        "timestamp": 1720835739
    }
]