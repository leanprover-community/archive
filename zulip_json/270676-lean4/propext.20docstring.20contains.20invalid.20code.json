[
    {
        "content": "<p><code>propext</code> (propositional extensionality) is in <code>Init/Core.lean</code>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/Init/Core.html#propext\">documented here</a><br>\nIts docstring contains the following example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">pp</span><span class=\"bp\">.</span><span class=\"n\">proofs</span><span class=\"w\"> </span><span class=\"n\">true</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨λ</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">propext</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"bp\">▸</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">this</span>\n\n<span class=\"bp\">#</span><span class=\"n\">reduce</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n<span class=\"c1\">-- propext { mp := fun x x =&gt; True.intro, mpr := fun x =&gt; True.intro } ▸ 2</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"c1\">-- 2</span>\n</code></pre></div>\n<p>This code fails, as you can see <a href=\"https://live.lean-lang.org/#codez=M4UwLg+g9gDmCWUB2ACGMB0MBOUoDNgUxsBXEAKAoBMR8V88UAuFAOQEMwWBeFAIwCeFFCgAWHAG4gWKABQAVMjMBJhCiXkAlCkAphOuW8UgC/JA3cAoIKHgD5i2eJPgcANgBoUZixeu37jp4EvyEXEpGWY+HFgQAA9uMDF4IkAO0nkAJllOME0g6I4AY1j44CoAYmwQalJcmUYoCgBaOrRcGGjuAG8UAFsYQ3xSVCiUQe8NEAx4JBIoN27sXv6hyxtR8cncFABfFGSUkpBJZwYmBpRdoA\">on Lean 4 Web</a>, with the following error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">invalid</span><span class=\"w\"> </span><span class=\"bp\">`▸`</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">equality</span>\n<span class=\"w\">  </span><span class=\"n\">propext</span><span class=\"w\"> </span><span class=\"n\">this</span>\n<span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">True</span>\n<span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">neither</span><span class=\"w\"> </span><span class=\"n\">side</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">equality</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">mentioned</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">Nat</span>\n</code></pre></div>\n<p>What goes wrong in this example? Is it something that broke in the Lean 4 transition?</p>",
        "id": 530390517,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1753288878
    },
    {
        "content": "<p>My guess is that it previously did not complain about this exact problem and just did:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">pp</span><span class=\"bp\">.</span><span class=\"n\">proofs</span><span class=\"w\"> </span><span class=\"n\">true</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨λ</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"n\">rec</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">propext</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">this</span>\n\n<span class=\"bp\">#</span><span class=\"n\">reduce</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n<span class=\"c1\">-- foo._proof_2 foo._proof_1 ▸ 2</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"c1\">-- 2</span>\n</code></pre></div>",
        "id": 530392064,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1753289364
    },
    {
        "content": "<p>So should we fix it to use your solution in a PR?</p>",
        "id": 530396747,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1753290951
    },
    {
        "content": "<p>What is this example supposed to illustrate?</p>",
        "id": 530461864,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1753322412
    },
    {
        "content": "<p>Reduction getting stuck in the presence of this axiom</p>",
        "id": 530486971,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1753339939
    },
    {
        "content": "<p>Doesn't reduction get stuck on any axiom? Anyway, it's an unusual thing to put in a docstring.</p>",
        "id": 530536050,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1753356708
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"119741\">François G. Dorais</span> <a href=\"#narrow/channel/270676-lean4/topic/propext.20docstring.20contains.20invalid.20code/near/530536050\">said</a>:</p>\n<blockquote>\n<p>Doesn't reduction get stuck on any axiom?</p>\n</blockquote>\n<p>Other than <code>propext</code>, the only axioms in Lean &amp; Mathlib are <code>Classical.choice</code> and <code>Quot</code> stuff.<br>\nHere's an example with choice:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo_ne</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Nonempty</span><span class=\"bp\">.</span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"bp\">⟩</span>\n\n<span class=\"bp\">#</span><span class=\"n\">reduce</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Classical</span><span class=\"bp\">.</span><span class=\"n\">choice</span><span class=\"w\"> </span><span class=\"n\">foo_ne</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">val</span>\n<span class=\"c1\">-- (Classical.choice foo_ne).1</span>\n</code></pre></div>\n<p>But can <code>Quot.sound</code> do this as well? Not sure</p>",
        "id": 530540053,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1753357670
    },
    {
        "content": "<p><code>Quot.sound</code> example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">TestType</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Quot</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TestType</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Quot</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"mi\">3</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Quot</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Quot</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Quot</span><span class=\"bp\">.</span><span class=\"n\">sound</span><span class=\"w\"> </span><span class=\"n\">trivial</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">▸</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">value</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">test</span>\n<span class=\"bp\">#</span><span class=\"n\">reduce</span><span class=\"w\"> </span><span class=\"n\">test</span>\n</code></pre></div>\n<p>My guess is that <code>propext</code> is here in particular because it's commonly found when using <code>rw</code>. Maybe a better example is:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">myProp</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"n\">False</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"n\">myProp</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">myProp</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">infer_instance</span>\n\n<span class=\"bp\">#</span><span class=\"n\">reduce</span><span class=\"w\"> </span><span class=\"n\">decide</span><span class=\"w\"> </span><span class=\"n\">myProp</span><span class=\"w\"> </span><span class=\"c1\">-- gets stuck</span>\n</code></pre></div>",
        "id": 530550138,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1753359932
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"933054\">Snir</span> <a href=\"#narrow/channel/270676-lean4/topic/propext.20docstring.20contains.20invalid.20code/near/530540053\">said</a>:</p>\n<blockquote>\n<p>Other than <code>propext</code>, the only axioms in Lean &amp; Mathlib are <code>Classical.choice</code> and <code>Quot</code> stuff.</p>\n</blockquote>\n<p>And <code>sorryAx</code>, <code>ofReduceBool</code>, <code>ofReduceNat</code>, maybe a couple more? Also, <code>opaque</code> defs should break reduction in the same way. It seems to be there isn't anything special to <code>propext</code> here.</p>",
        "id": 530550373,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1753359990
    },
    {
        "content": "<p>IMHO the bottom line is that this kind of reduction issue should be documented somewhere but the docstring for <code>propext</code> is not the right place since it gives little guidance on how to use <code>propext</code> other than the fact that it is an axiom.</p>",
        "id": 530663151,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1753399532
    },
    {
        "content": "<p>So PR to delete it then?</p>",
        "id": 530667963,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1753402440
    },
    {
        "content": "<p>That's probably the best.</p>",
        "id": 530674296,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1753406188
    },
    {
        "content": "<p>I think the motivation of this part of the docstring is to point out that you can't use iffs to do rewrites and expect the result to still reduce. This is a reason for the overly general advice \"don't use tactics to make definitions\".</p>\n<p><span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> wrote this — maybe he wants to iterate on it? Or maybe <span class=\"user-mention\" data-user-id=\"354934\">@David Thrane Christiansen</span> is planning on incorporating it into the language reference?</p>",
        "id": 530677012,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753407979
    },
    {
        "content": "<p>I'm not sure I understand the issue</p>",
        "id": 530677180,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1753408087
    },
    {
        "content": "<p>the docstring does mention that the same thing is true for any axiom</p>",
        "id": 530677199,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1753408104
    },
    {
        "content": "<p>the way to use <code>propext</code> is to prove that two propositions are equal given that they are iff, this seems self-explanatory and is also the first paragraph</p>",
        "id": 530677269,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1753408146
    },
    {
        "content": "<p>The issue is that the example doesn't work right now. Mainly, I figured I'd ping you before someone makes a PR to delete anything, and if someone's wanting to modify things, best to ping the original author.</p>",
        "id": 530677516,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753408289
    },
    {
        "content": "<p>this code was definitely tested at one point, so it must be a regression</p>",
        "id": 530677655,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1753408359
    },
    {
        "content": "<p>I'm sure you tested it. I think what happened is the triangle operator was improved. It notices that neither <code>True</code> nor <code>True -&gt; True</code> appears in <code>Nat</code> and fails intentionally.</p>",
        "id": 530677883,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753408479
    },
    {
        "content": "<p>here's a fixed version, but it has significantly degraded as a demonstration:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">pp</span><span class=\"bp\">.</span><span class=\"n\">proofs</span><span class=\"w\"> </span><span class=\"n\">true</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨λ</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">propext</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">recOn</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">this</span>\n\n<span class=\"bp\">#</span><span class=\"n\">reduce</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n<span class=\"c1\">-- foo._proof_2 foo._proof_1 ▸ 2</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"c1\">-- 2</span>\n</code></pre></div>",
        "id": 530677978,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1753408538
    },
    {
        "content": "<p>maybe there is a way to disable the proof extraction</p>",
        "id": 530678005,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1753408569
    },
    {
        "content": "<p>I think the docstring should just link to <a href=\"https://lean-lang.org/doc/reference/latest/find/?domain=Verso.Genre.Manual.section&amp;name=axiom-reduction\">the section on reduction and axioms</a> if this is something that needs to be explicitly called out here, and this example can be deleted.</p>",
        "id": 530848151,
        "sender_full_name": "David Thrane Christiansen",
        "timestamp": 1753477339
    },
    {
        "content": "<p>I can do it in the next couple of days</p>",
        "id": 530848218,
        "sender_full_name": "David Thrane Christiansen",
        "timestamp": 1753477361
    },
    {
        "content": "<p>There's some stuff in that section that's wrong/misleading, specifically the \"Axioms and Compilation\" section:</p>\n<blockquote>\n<p>The function is marked <code>partial</code> to avoid further error messages from termination checking.</p>\n</blockquote>\n<p>That's not true, there are no further error messages.</p>\n<blockquote>\n<p>The <a href=\"https://lean-lang.org/doc/reference/latest//Tactic-Proofs/Tactic-Reference/#by_cases\">by_cases</a> tactic uses the Law of the Excluded Middle, which is proved in the standard library using the Axiom of Choice. Indeed, this definition uses three axioms:</p>\n</blockquote>\n<p>This is misleading, the actual source of <code>Classical.choice</code> turns out to be <code>Nat.left_eq_add</code>! In fact, this variant doesn't use choice:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">nextOdd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"n\">property</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">by_cases</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">↓</span><span class=\"n\">reduceIte</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">succ_ne_self</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">ne_add_one</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">or_false</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">or_true</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">and_true</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">omega</span>\n</code></pre></div>",
        "id": 530853933,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1753480302
    },
    {
        "content": "<p>Man, this thing about stupid uses of choice bums me out so much. Lean FRO has changed a lot in the past few years, I'd really like us to allow some PRs through to fix the low hanging fruit here</p>",
        "id": 531015655,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1753569744
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"873547\">@Robin Arnez</span>, I've fixed the inaccuracies.</p>",
        "id": 531398869,
        "sender_full_name": "David Thrane Christiansen",
        "timestamp": 1753716493
    }
]