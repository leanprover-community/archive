[
    {
        "content": "<p>I wonder if there is some established way of measuring \"proof efficiency,\" meaning how easy it is to compile it. </p>\n<p>I learned about <code>#count_heartbeats</code> command, but I'm not sure if this is the best metric for that; also I'm not sure how to use it properly: when I prepend a theorem with <code>#count_heartbeats in</code>, sometimes Lean freezes completely, and sometimes warnings appear in the proof (which otherwise was correct and without warnings).</p>\n<p>I also see there is the <code>--profile</code> flag for the <code>lean</code> command, which seems very useful and works fine, but there is a problem of substantial variance across runs.</p>\n<p>So I'd be grateful for some insights about this!</p>",
        "id": 536865688,
        "sender_full_name": "Bartosz Piotrowski",
        "timestamp": 1756504262
    },
    {
        "content": "<p>Hey Bartosz! I don't have a great answer for you; I have been wondering about this myself lately.</p>\n<p>One crude metric is to check the size of the proof term using <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Expr.numObjs#doc\">docs#Lean.Expr.numObjs</a>, but different terms of the same size can have drastically different kernel proof checking times, so size is not a great measure.</p>\n<p>For measuring the kernel checking compute in terms of heartbeats, I have been using</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DefinitionVal</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"c1\">-- get this from the environment or from somewhere</span>\n<span class=\"c1\">-- the option is critical to ensure `addDecl` waits for the kernel</span>\n<span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">heartbeats</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">withOptions</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">opts</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">async</span><span class=\"bp\">.</span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">opts</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"n\">withHeartbeats</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"n\">withoutModifyingEnv</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">addDecl</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">defnDecl</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"bp\">.</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"ss\">`bench</span><span class=\"w\"> </span><span class=\"o\">}</span>\n</code></pre></div>",
        "id": 537790997,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1757046254
    },
    {
        "content": "<p>Thanks a lot, Wojciech!</p>",
        "id": 540322820,
        "sender_full_name": "Bartosz Piotrowski",
        "timestamp": 1758230716
    }
]