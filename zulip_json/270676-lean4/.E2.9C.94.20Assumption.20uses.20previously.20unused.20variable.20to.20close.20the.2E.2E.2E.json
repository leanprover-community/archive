[
    {
        "content": "<p>Fails:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">b</span><span class=\"o\">}</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">assumption</span>\n</code></pre></div>\n<p>Works (the example's type contains <code>{b : a}</code>):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">}</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">assumption</span>\n</code></pre></div>\n<p>Is it expected?</p>",
        "id": 451585651,
        "sender_full_name": "Daniil Kisel",
        "timestamp": 1721068123
    },
    {
        "content": "<p>i think maybe yes, this is expected? you also get this issue when doing <code>variable {b a}</code>, probably for the same reason?</p>",
        "id": 451590415,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1721068938
    },
    {
        "content": "<p>i.e. if you declare <code>b</code> before <code>a</code>, it can't be of type <code>a</code> because that didn't exist at the point of declaration.</p>",
        "id": 451590553,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1721068966
    },
    {
        "content": "<p>I am confused about <code>b</code> being used despite no mention in the source code. The docstring for <code>variable</code> states that variables are added as arguments only when the definition uses them, but in infoview there is \"b : ?m.11\" regardless of its use.</p>",
        "id": 451592010,
        "sender_full_name": "Daniil Kisel",
        "timestamp": 1721069226
    },
    {
        "content": "<p>The infoview includes things that <em>might</em> be included</p>",
        "id": 451592195,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1721069259
    },
    {
        "content": "<p>But should assumption use previously unused variables?</p>",
        "id": 451593076,
        "sender_full_name": "Daniil Kisel",
        "timestamp": 1721069405
    },
    {
        "content": "<p>the mention might not be explicit in the source code, but often it is the case that it is implicit. For example, if you write <code>3 + 4</code>, lean will assume i'm talking about <code>Nat</code>, and find an instance <code>HAdd Nat Nat Nat</code> to make sure the <code>+</code> will typecheck, without it being mentioned explicitly.</p>",
        "id": 451606953,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1721071776
    },
    {
        "content": "<p>the reason why it uses <code>b</code> without a mention is because of the <code>assumption</code> tactic: it looks for anything in context which is able to fill the goal. in the example where it works, the tactic fills the goal with <code>b</code> because it <em>can</em> fit.</p>",
        "id": 451609259,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1721072153
    },
    {
        "content": "<p>so you <em>are</em> telling lean to use <code>b</code>, only indirectly by using the <code>assumption</code> tactic</p>",
        "id": 451609521,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1721072197
    },
    {
        "content": "<p>In other words, if you write the weird <code>variable {b}</code> then you can expect weird behaviour :-)</p>",
        "id": 451609631,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1721072217
    },
    {
        "content": "<p>I understand the behavior here, I am not sure if it is desired. I guess I've started with a wrong assumption about <code>assumption</code> usecases. I'll use explicitly-typed variables from now on, thanks for your replies.</p>",
        "id": 451611498,
        "sender_full_name": "Daniil Kisel",
        "timestamp": 1721072531
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"587706\">Daniil Kisel</span> has marked this topic as resolved.</p>",
        "id": 451611515,
        "sender_full_name": "Notification Bot",
        "timestamp": 1721072535
    }
]