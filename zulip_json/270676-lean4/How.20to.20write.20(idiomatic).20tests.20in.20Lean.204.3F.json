[
    {
        "content": "<p>What the title says. I've been trying to find information about what the idiomatic way of writing tests in Lean 4 is supposed to be, but that information seems to be under some rock. Also, how do I run the tests once I have written them? I see <code>lake</code> has a command <code>test</code>, but the help for <code>lake test</code> talks about some \"test driver\", and I've still to find a clearly written example of this. Do I need to set it up in <code>lakefile.toml</code>?</p>",
        "id": 491012866,
        "sender_full_name": "Santtu",
        "timestamp": 1735320206
    },
    {
        "content": "<p>Yes, you need a <code>lakefile.toml</code> or a <code>lakefile.lean</code>, but you need this for any lean project. Here is an example <code>lakefile.toml</code> with a <code>test driver</code>.</p>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"LeanSearchClient\"</span>\n<span class=\"n\">testDriver</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"LeanSearchClientTest\"</span>\n<span class=\"n\">defaultTargets</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"LeanSearchClient\"</span><span class=\"p\">]</span>\n\n<span class=\"k\">[[lean_lib]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"LeanSearchClient\"</span>\n\n<span class=\"k\">[[lean_lib]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"LeanSearchClientTest\"</span>\n</code></pre></div>\n<p>The library <code>LeanSearchClientTest</code> has the <em>test</em> files, which are simply Lean files. A useful way to write tests is to use <code>guard_msgs</code> before a command say <code>#eval ...</code> or <code>#check ...</code>.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"sd\">/-- info: 2 -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"k\">#eval</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n</code></pre></div>\n<p>The great thing about <code>#guard_msgs</code> is if you just include it, you will get a code action to add the correct stuff.</p>",
        "id": 491082776,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1735382989
    },
    {
        "content": "<p>Right, having the tests as a separate library makes sense. And I suppose that marking the tests library as a test driver makes it possible to import stuff from the actual library?</p>",
        "id": 491094590,
        "sender_full_name": "Santtu",
        "timestamp": 1735394297
    },
    {
        "content": "<p>I think the <code>lean_lib</code> is what makes the imports resolve; the <code>testDriver</code> just hooks it up to <code>lake test</code></p>",
        "id": 491094777,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1735394492
    },
    {
        "content": "<p>What is the idiomatic way to run compiled tests?</p>\n<p>I.e. I have a bunch of lean files with <code>def main : IO Int := ...</code> which should return <code>0</code> when executed.</p>\n<p>I do now want to list all those files in lakefile but say that all files in a directory should be treated that way.</p>",
        "id": 491118790,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1735418502
    }
]