[
    {
        "content": "<p>I want to install on some university computers, and I have a few questions:</p>\n<ul>\n<li>Once VSCode (and git) is installed on Ubuntu, does one require root access to install Lean itself?</li>\n<li>The home directory is on an old and slow (and remote) file server. If I have a symlink in <code>~/.elan</code> and <code>~/.cache</code> to another folder, will Lean (and the cache) respect these symlinks? </li>\n<li>Or alternatively, is it still possible to set <code>LEAN_PATH</code> or a similar environment variable to set the location for elan and the cache?</li>\n</ul>",
        "id": 478081382,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1729522339
    },
    {
        "content": "<p><code>ELAN_HOME</code> is the envvar for telling elan where to put stuff (i.e. it defaults to <code>~/.elan</code>)</p>",
        "id": 478087464,
        "sender_full_name": "Julian Berman",
        "timestamp": 1729523875
    },
    {
        "content": "<p>I think I tried a symlinked <code>~/.elan</code> at some point and it caused problems, but I don't recall the details. Root should not be necessary to install elan and Lean.</p>",
        "id": 478088801,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1729524234
    },
    {
        "content": "<p>Does <code>ELAN_HOME</code> just control where elan is or does it also control where the cache is?</p>",
        "id": 478107144,
        "sender_full_name": "Fran√ßois G. Dorais",
        "timestamp": 1729529464
    },
    {
        "content": "<p>You can also use <code>elan toolchain link</code> to point it at a toolchain stored somewhere else, so that only <code>elan</code> itself runs from the slow directory</p>",
        "id": 478115092,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729532105
    },
    {
        "content": "<p>Cache seems to be controlled by the environment variable <code>XDG_CACHE_HOME</code> (<a href=\"https://github.com/leanprover-community/mathlib4/blob/d2c8beddb0e73ffe98e51d3a9933d5acd833d52f/Cache/IO.lean#L46\">source</a>)</p>",
        "id": 478115688,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1729532294
    },
    {
        "content": "<p>I'll try setting <code>ELAN_HOME</code> and <code>XDG_CACHE_HOME</code> before doing any Lean-install, and hopefully that will result in my home directory not being used at all.</p>",
        "id": 478116056,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1729532411
    },
    {
        "content": "<p>Please let us know how that works out! I personally need to do the same kind of thing here in the near future.</p>",
        "id": 478137075,
        "sender_full_name": "Fran√ßois G. Dorais",
        "timestamp": 1729539964
    },
    {
        "content": "<p>What does the blind sudo in the standard Linux set-up script do if root isn't needed?</p>",
        "id": 478152239,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1729545769
    },
    {
        "content": "<p><a href=\"https://raw.githubusercontent.com/leanprover-community/mathlib4/master/scripts/install_debian.sh\">This script</a>? The <code>sudo</code>s install git, curl and VSCode.</p>",
        "id": 478155171,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1729546931
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"111080\">Floris van Doorn</span> <a href=\"#narrow/channel/270676-lean4/topic/installing.20Lean.20on.20university.20computer/near/478116056\">said</a>:</p>\n<blockquote>\n<p>I'll try setting <code>ELAN_HOME</code> and <code>XDG_CACHE_HOME</code> before doing any Lean-install, and hopefully that will result in my home directory not being used at all.</p>\n</blockquote>\n<p>Apologies for my impatience, did it work?</p>",
        "id": 478830762,
        "sender_full_name": "Fran√ßois G. Dorais",
        "timestamp": 1729823766
    },
    {
        "content": "<p>I haven't tried yet, and it will probably take another week for me to try to do this setup.</p>",
        "id": 478858665,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1729841929
    },
    {
        "content": "<p>Sorry, I forgot to report back here. This is all working perfectly.</p>",
        "id": 497884110,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1738759423
    },
    {
        "content": "<p>Do you want to write up what you did exactly? :)</p>",
        "id": 497909059,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1738766451
    },
    {
        "content": "<p>It was done in collaboration with the IT-support here in Bonn, so I didn't execute all commands myself. <br>\nBut basically, if you set the <code>ELAN_HOME</code> and <code>XDG_CACHE_HOME</code> environment variables before you do the Lean installation (and make sure these environment variables persist on later logins), then those are the places where Lean toolchains and compressed <code>.olean</code> caches are stored, and you can ensure that your home directory is not touched at all.</p>\n<p>(note: in <a class=\"message-link\" href=\"/#narrow/channel/113489-new-members/topic/Looking.20for.20help/near/497910184\">#new members &gt; Looking for help @ üí¨</a>  <span class=\"user-mention\" data-user-id=\"321696\">@Julian Berman</span> mentions you can also set <code>$MATHLIB_CACHE_DIR</code> instead of <code>$XDG_CACHE_HOME</code>)</p>",
        "id": 497962203,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1738781644
    },
    {
        "content": "<p>I'm not in front of lean but I may have misremembered whether MATHLIB_CACHE_DIR still exists these days -- it definitely did in lean 3 (I wrote the line which did it) but glancing at cache says maybe it does not anymore: <a href=\"https://github.com/leanprover-community/mathlib4/blob/24c597596e1eab32ef9047e2ca944e099df3d294/Cache/IO.lean#L47\">https://github.com/leanprover-community/mathlib4/blob/24c597596e1eab32ef9047e2ca944e099df3d294/Cache/IO.lean#L47</a> so you may really just have XDG_CACHE_HOME at this point</p>",
        "id": 497963264,
        "sender_full_name": "Julian Berman",
        "timestamp": 1738782044
    },
    {
        "content": "<p>If someone is interested in having that work, <a href=\"https://github.com/leanprover-community/mathlib4/pull/21480\">https://github.com/leanprover-community/mathlib4/pull/21480</a> adds it.</p>",
        "id": 497976049,
        "sender_full_name": "Julian Berman",
        "timestamp": 1738786792
    },
    {
        "content": "<p>I would <em>love</em> to have a CI workflow that installs things using this setup, so:</p>\n<ol>\n<li>we can remain confident that the setup continues to work</li>\n<li>if done nicely, people could even use it as a template to crib from</li>\n</ol>",
        "id": 498015793,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1738805335
    },
    {
        "content": "<p>I'm a little bit concerned about setting XDG_CACHE_HOME since that's not a lean/lake/elan specific variable. I'm also concerned about Windows/VMWare installs since Windows remarkably sucks at sharing. Does anyone know enough about this to relieve/confirm my concerns?</p>",
        "id": 498016979,
        "sender_full_name": "Fran√ßois G. Dorais",
        "timestamp": 1738805987
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"119741\">@Fran√ßois G. Dorais</span>, <a href=\"https://github.com/leanprover-community/mathlib4/pull/21480\">#21480</a> above allows you to set MATHLIB_CACHE_DIR instead of XDG_CACHE_HOME.</p>",
        "id": 498017138,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1738806078
    },
    {
        "content": "<p>I don't understand what your concern is about Windows/VMWare. Are you saying you don't think this setup will work? Or something else?</p>",
        "id": 498017188,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1738806109
    },
    {
        "content": "<p>Yes. I'm concerned because Windows/VMWare loves to lock files when another process uses them. I want all my students to be able to access the cache files at the same time (read only) but that hasn't been working reliably for me.</p>\n<p>PS: I'm not a habitual Windows user so much of this may be due to my ignorance.</p>",
        "id": 498017646,
        "sender_full_name": "Fran√ßois G. Dorais",
        "timestamp": 1738806306
    },
    {
        "content": "<p>PPS: I'm hoping we will move away from VMWare but universities move slowly...</p>",
        "id": 498022786,
        "sender_full_name": "Fran√ßois G. Dorais",
        "timestamp": 1738809434
    }
]