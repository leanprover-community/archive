[
    {
        "content": "<p>In some cases, I can use <code>←</code>-notation inside if-then-else without inserting an extra <code>do</code> and sometimes I cannot:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt8</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Except</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">myfun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt8</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Except</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">←</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">    </span><span class=\"k\">else</span>\n<span class=\"w\">      </span><span class=\"n\">pure</span><span class=\"w\">  </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">myfun'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt8</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Except</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"bp\">←</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">    </span><span class=\"k\">else</span>\n<span class=\"w\">      </span><span class=\"n\">pure</span><span class=\"w\">  </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- invalid use of `(&lt;- ...)`, must be nested inside a 'do' expression</span>\n</code></pre></div>\n<p>I am just wondering: Is there some logic behind this that I am not seeing? Is this intentional?</p>",
        "id": 574267785,
        "sender_full_name": "Alexander Bentkamp",
        "timestamp": 1771327274
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"k\">do</span>\n</code></pre></div>",
        "id": 574270986,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1771328480
    },
    {
        "content": "<p>I would just expect the parameter after inlined \"←\" is a monad but not using <code>do</code> notation, so basically the same as if you wrote</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">myfun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt8</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Except</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n</code></pre></div>\n<p>without <code>do</code></p>",
        "id": 574271349,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1771328648
    },
    {
        "content": "<p>I am rather a little surprised it works after <code>let</code>.</p>",
        "id": 574271429,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1771328680
    },
    {
        "content": "<p>Right, it seems a bit inconsistent.</p>",
        "id": 574274919,
        "sender_full_name": "Alexander Bentkamp",
        "timestamp": 1771329970
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"133339\">Mirek Olšák</span> <a href=\"#narrow/channel/270676-lean4/topic/.60.E2.86.90.60.20inside.20if-then-else/near/574271429\">said</a>:</p>\n<blockquote>\n<p>I am rather a little surprised it works after <code>let</code>.</p>\n</blockquote>\n<p>This is part of <a href=\"https://lean-lang.org/doc/reference/latest/find/?domain=Verso.Genre.Manual.section&amp;name=The-Lean-Language-Reference--Functors___-Monads-and--do--Notation--Syntax--do--Notation--Sequential-Computations\">the syntax of <code>do</code> statements.</a>.</p>\n<p>I'd  think about <code>do</code> as having basically two layers: at a fundamental level, there's a process that desugars a sequence of <code>do</code> statements into uses of <code>&gt;&gt;=</code>. Do statements consist of <code>let ... := ...</code>, <code>let ... ← ...</code>, <code>let mut</code>, control structures like <code>while</code>, <code>return</code>, <code>if</code>, and <code>match</code>, and also ordinary terms. The desugaring process matches each of these statements with its enclosing <code>do</code> block, and the immediate children of control structures like the arms of an <code>if</code> have the same <code>do</code> block as their parent.</p>\n<p>On top of that, there's the layer that desugars nested actions (with <code>←</code>) into separate <code>let FRESH_VAR ← ...</code> statements. In other words, <code>let ... ← ...</code> is not a special case of <code>let ... := ← ...</code>; instead, it goes the other way around.</p>",
        "id": 574868325,
        "sender_full_name": "David Thrane Christiansen",
        "timestamp": 1771564412
    }
]