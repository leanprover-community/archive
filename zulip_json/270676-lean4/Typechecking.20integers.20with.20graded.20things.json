[
    {
        "content": "<p>So I have some graded objects, say <code>GradedPapers</code> below:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">structure</span><span class=\"w\"> </span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">grade</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">GradedPapers.combine</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">⟨</span><span class=\"n\">a.grade</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b.grade</span><span class=\"o\">⟩</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">PaperA</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"mi\">10</span><span class=\"o\">⟩</span>\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">PaperB</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"mi\">10</span><span class=\"o\">⟩</span>\n<span class=\"k\">#check</span><span class=\"w\"> </span><span class=\"n\">PaperA.combine</span><span class=\"w\"> </span><span class=\"n\">PaperB</span>\n\n<span class=\"kd\">instance</span><span class=\"w\"> </span><span class=\"n\">GradedPapers.instAdd</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Add</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">combine</span><span class=\"o\">⟩</span>\n\n<span class=\"k\">#check</span><span class=\"w\"> </span><span class=\"n\">PaperA</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">PaperB</span>\n<span class=\"k\">#check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">PaperA</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">PaperB</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">PaperB'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">PaperB</span>\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">PaperAB</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">PaperA</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">PaperB'</span>\n</code></pre></div>\n<p>The first check succeeds, while the last two fails, and the final definition succeeds (but <em>not</em> with <code>PaperB</code>). I <em>kind of</em> understand why, but also not really, so I have some questions/clarifications:</p>\n<ol>\n<li>Since the first check succeeds, I believe <code>3</code> and <code>2 + 1</code> are definitionally equal in the kernel/typechecker. Is that correct?</li>\n<li>If so, why don't the second and third checks work?</li>\n<li>In fact, if I turn <code>set_option trace.Meta.synthInstance</code> on, I see the following:</li>\n</ol>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">✅</span><span class=\"w\"> </span><span class=\"n\">HAdd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">▼</span>\n<span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">❌</span><span class=\"w\"> </span><span class=\"n\">HAdd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">483</span><span class=\"w\"> </span><span class=\"bp\">▶</span>\n</code></pre></div>\n<p>3a. Why doesn't it use the green tick line?? The output type is correct<br>\n3b. Why is the output type of the red cross line a hole (<code>?m.483</code>)? It seems especially weird on the third check, because I explicitly wrote <code>: GradedPapers 3</code> for the output type. Same for the <code>PaperAB</code> if you replace <code>PaperB'</code> by <code>PaperB</code>.</p>\n<ol start=\"4\">\n<li>Is there any way to make <code>+</code> work smoothly here?</li>\n</ol>",
        "id": 463891806,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1724196426
    },
    {
        "content": "<p>(There are questions hidden under the code block, please click \"Show more\" :D)</p>",
        "id": 463891831,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1724196444
    },
    {
        "content": "<p><code>#check PaperA + (by exact PaperB)</code> work too!</p>",
        "id": 463894712,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1724198161
    },
    {
        "content": "<p>Wow I hate it</p>",
        "id": 463898641,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1724199305
    },
    {
        "content": "<p>Okay hmm but is there any other way? I think it's quite annoying if I have to write something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib.NumberTheory.ModularForms.EisensteinSeries.Basic</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">EisensteinSeries</span><span class=\"w\"> </span><span class=\"n\">ModularForm</span><span class=\"w\"> </span><span class=\"n\">UpperHalfPlane</span><span class=\"w\"> </span><span class=\"n\">CongruenceSubgroup</span>\n\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kd\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"G[\"</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"s2\">\"]\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">eisensteinSeries_MF</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"n\">decide</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"kd\">noncomputable</span><span class=\"w\"> </span><span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">E₄</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ModularForm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Gamma</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">[</span><span class=\"mi\">4</span><span class=\"o\">]</span>\n<span class=\"kd\">noncomputable</span><span class=\"w\"> </span><span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">E₆</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ModularForm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Gamma</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">[</span><span class=\"mi\">6</span><span class=\"o\">]</span>\n<span class=\"kd\">noncomputable</span><span class=\"w\"> </span><span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">Δ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ModularForm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Gamma</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">1728</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">E₄.mul</span><span class=\"w\"> </span><span class=\"n\">E₄</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mul</span><span class=\"w\"> </span><span class=\"n\">E₄</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">E₆.mul</span><span class=\"w\"> </span><span class=\"n\">E₆</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>But if that's the best way for now, then sure.</p>",
        "id": 463900300,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1724200562
    },
    {
        "content": "<p>But maybe it would be nice to have an extension of the <code>(... : _)</code> syntax to really really force the type of the term (syntactically)</p>",
        "id": 463900384,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1724200617
    },
    {
        "content": "<p>Can you make your 'combine' take two separate GradedPapers, one over n, one over m, and combine also takes a proof that n = m that is proven by autoparam omega or decide or something?</p>",
        "id": 463909276,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1724203522
    },
    {
        "content": "<p>Okay I just tried, and (as always) the first check works, that's expected. But then I don't know how to define the <code>Add</code> instance, so I changed it to a <code>HAdd</code> instance, and now everything breaks down :(</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib.Tactic</span>\n\n<span class=\"kd\">structure</span><span class=\"w\"> </span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">grade</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span>\n\n<span class=\"kd\">set_option</span><span class=\"w\"> </span><span class=\"n\">linter.unusedVariables</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">GradedPapers.combine</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"n\">omega</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">⟨</span><span class=\"n\">a.grade</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b.grade</span><span class=\"o\">⟩</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">PaperA</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"mi\">10</span><span class=\"o\">⟩</span>\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">PaperB</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"mi\">10</span><span class=\"o\">⟩</span>\n<span class=\"k\">#check</span><span class=\"w\"> </span><span class=\"n\">PaperA.combine</span><span class=\"w\"> </span><span class=\"n\">PaperB</span>\n\n<span class=\"c1\">-- instance GradedPapers.instAdd {n : Int} : Add (GradedPapers n) := ⟨combine⟩</span>\n<span class=\"kd\">instance</span><span class=\"w\"> </span><span class=\"n\">GradedPapers.instHAdd</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fact</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">HAdd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">combine</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">h.out</span><span class=\"o\">⟩</span>\n\n<span class=\"k\">#check</span><span class=\"w\"> </span><span class=\"n\">PaperA</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">PaperB</span>\n<span class=\"k\">#check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">PaperA</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">PaperB</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">PaperB'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">PaperB</span>\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">PaperAB</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">PaperA</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">PaperB'</span>\n</code></pre></div>",
        "id": 464032617,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1724242012
    },
    {
        "content": "<p>(Small reminder that there's a \"View in Playground\" button)</p>",
        "id": 464032711,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1724242027
    },
    {
        "content": "<p>Why Fact the equality? TC will never solve that</p>",
        "id": 464036758,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1724242903
    },
    {
        "content": "<p>How should I do it then?</p>",
        "id": 464037232,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1724243068
    },
    {
        "content": "<p>Under my omega proposal, you'd have notation based addition, not via a typeclass</p>",
        "id": 464037301,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1724243093
    },
    {
        "content": "<p>What does that mean?</p>",
        "id": 464037359,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1724243110
    },
    {
        "content": "<p>Oh like define a new notation<code>+\\_m</code> or something, then write that instead (<code>M1 +\\_m M2 +\\_m M3</code>)?</p>",
        "id": 464037475,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1724243145
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/blob/ed125a4216d18273cb1b96d4c846d32b85d74faf/Mathlib%2FGroupTheory%2FPerm%2FCycle%2FConcrete.lean#L468-L469\">https://github.com/leanprover-community/mathlib4/blob/ed125a4216d18273cb1b96d4c846d32b85d74faf/Mathlib%2FGroupTheory%2FPerm%2FCycle%2FConcrete.lean#L468-L469</a></p>",
        "id": 464037682,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1724243195
    },
    {
        "content": "<p>Like the cycle notation is able to discharge the proof of nodup of the list</p>",
        "id": 464037778,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1724243218
    },
    {
        "content": "<p>First show that your combine will work when calling combine explicitly on your 3 and 1+1+1 examples without having to provide a proof.</p>",
        "id": 464037969,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1724243260
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">set_option</span><span class=\"w\"> </span><span class=\"n\">quotPrecheck</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kd\">notation</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"s2\">\"+ₘ\"</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">GradedPapers.combine</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"n\">omega</span><span class=\"o\">)</span>\n\n<span class=\"k\">#check</span><span class=\"w\"> </span><span class=\"n\">PaperA</span><span class=\"w\"> </span><span class=\"bp\">+ₘ</span><span class=\"w\"> </span><span class=\"n\">PaperB</span>\n<span class=\"k\">#check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">PaperA</span><span class=\"w\"> </span><span class=\"bp\">+ₘ</span><span class=\"w\">  </span><span class=\"n\">PaperB</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">PaperAB</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">PaperA</span><span class=\"w\"> </span><span class=\"bp\">+ₘ</span><span class=\"w\"> </span><span class=\"n\">PaperB</span>\n</code></pre></div>\n<p>Okay I think this works perfectly - I think this is what you mean <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 464038084,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1724243293
    },
    {
        "content": "<p>(all works)</p>",
        "id": 464038099,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1724243301
    },
    {
        "content": "<p>In fact, using this I can remove the auto outParam for <code>m = n</code> entirely</p>",
        "id": 464038194,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1724243340
    },
    {
        "content": "<p>You could, or make it an implicit autoparam so that the notation doesn't even have to mention omega</p>",
        "id": 464038266,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1724243369
    },
    {
        "content": "<p>Not sure if explicit vs implicit matters</p>",
        "id": 464038308,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1724243390
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">structure</span><span class=\"w\"> </span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">grade</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span>\n\n<span class=\"kd\">set_option</span><span class=\"w\"> </span><span class=\"n\">linter.unusedVariables</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">GradedPapers.combine</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">⟨</span><span class=\"n\">a.grade</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b.grade</span><span class=\"o\">⟩</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">PaperA</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"mi\">10</span><span class=\"o\">⟩</span>\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">PaperB</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"mi\">10</span><span class=\"o\">⟩</span>\n<span class=\"k\">#check</span><span class=\"w\"> </span><span class=\"n\">PaperA.combine</span><span class=\"w\"> </span><span class=\"n\">PaperB</span>\n\n<span class=\"kd\">set_option</span><span class=\"w\"> </span><span class=\"n\">quotPrecheck</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kd\">notation</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"s2\">\"+ₘ\"</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">GradedPapers.combine</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"n\">omega</span><span class=\"o\">)</span>\n\n<span class=\"k\">#check</span><span class=\"w\"> </span><span class=\"n\">PaperA</span><span class=\"w\"> </span><span class=\"bp\">+ₘ</span><span class=\"w\"> </span><span class=\"n\">PaperB</span>\n<span class=\"k\">#check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">PaperA</span><span class=\"w\"> </span><span class=\"bp\">+ₘ</span><span class=\"w\"> </span><span class=\"n\">PaperB</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">PaperAB</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GradedPapers</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">PaperA</span><span class=\"w\"> </span><span class=\"bp\">+ₘ</span><span class=\"w\"> </span><span class=\"n\">PaperB</span>\n</code></pre></div>\n<p>This seems to break, and I don't know why</p>",
        "id": 464038563,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1724243453
    },
    {
        "content": "<p>When I said make it implicit, I meant implicit autoparam. It breaks now because your by omega in notation never fires on the h' argument</p>",
        "id": 464039959,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1724243706
    },
    {
        "content": "<p>And you use n twice in arguments to combine</p>",
        "id": 464040013,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1724243730
    },
    {
        "content": "<p><span aria-label=\"man facepalming\" class=\"emoji emoji-1f926-200d-2642\" role=\"img\" title=\"man facepalming\">:man_facepalming:</span> yes the second one is the issue</p>",
        "id": 464040091,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1724243755
    },
    {
        "content": "<p>Thank you. I think I will stick with removing the <code>h'</code> entirely for now, and when it breaks for whatever reason I can fall back to this</p>",
        "id": 464040208,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1724243777
    },
    {
        "content": "<p>Also one more thing, is it possible to get dot notation to work in notation?</p>",
        "id": 464040906,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1724243897
    },
    {
        "content": "<p><code>notation A \"+ₘ\" B =&gt; A.combine B</code> fails for some reason (the <code>.combine</code> is treated as some metavariable I don't understand</p>",
        "id": 464041895,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1724244110
    },
    {
        "content": "<p>Because I have two types of graded papers, both with an <code>.add</code>, and it would be great to have the same notation for them</p>",
        "id": 464042039,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1724244134
    },
    {
        "content": "<p><code>notation A \"+ₘ\" B =&gt; (A).combine B</code> works!</p>",
        "id": 464046952,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1724244963
    }
]