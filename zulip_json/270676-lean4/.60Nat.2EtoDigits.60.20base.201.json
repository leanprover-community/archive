[
    {
        "content": "<p>Should <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.toDigits#doc\">docs#Nat.toDigits</a> return a meaningful result for base <code>1</code>? Currently it returns <code>n + 1</code> <code>'0'</code>s. One might expect it to return exactly <code>n</code> <code>'0'</code>'s as a unary encoding of <code>n</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">toDigits</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">base</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"c1\">-- ['0']</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">toDigits</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">base</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"c1\">-- ['0', '0']</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">toDigits</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">base</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"c1\">-- ['0', '0', '0']</span>\n</code></pre></div>",
        "id": 522991408,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1749405349
    },
    {
        "content": "<p>I would say this is a defect in the documentation at the very least. Could you open a bug on the lean4 repo?</p>",
        "id": 522993823,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1749408113
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/8686\">lean4#8686</a></p>",
        "id": 522996312,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1749411167
    },
    {
        "content": "<p>I feel like it is at least reasonable for <code>0</code> to always be encoded \"0\" though, so I'd rather say this is an edge-case which is simply not expected to output anything useful. On the other hand, we document that <code>x / 0 = 0</code> so maybe it should be documented that:<br>\n\"For base 1, this function returns <code>n + 1</code> zeroes and for base 0 a singleton list containing <code>Nat.digitChar n</code>.\"</p>",
        "id": 523028540,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1749448431
    },
    {
        "content": "<p>Also why the arbitrary decision to make bases 17 and beyond produce garbage output (with <code>*</code> everywhere)? Pretty much every other programming language I know goes until base 36 until it produces an error</p>",
        "id": 523028786,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1749448661
    },
    {
        "content": "<p>Coming to this late; <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.digits#doc\">docs#Nat.digits</a> has a slightly more expected behavior in base 1:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">digits</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"c1\">-- []</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">digits</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"c1\">-- [1]</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">digits</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"c1\">-- [1, 1]</span>\n</code></pre></div>",
        "id": 525981941,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1750972588
    }
]