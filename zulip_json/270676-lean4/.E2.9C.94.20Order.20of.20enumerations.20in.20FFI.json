[
    {
        "content": "<p>What is the order of enums in the FFI? For example,</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">inductive</span><span class=\"w\"> </span><span class=\"n\">BinderInfo</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- Default binder annotation, e.g. `(x : α)` -/</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">default</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- Implicit binder annotation, e.g., `{x : α}` -/</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">implicit</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- Strict implicit binder annotation, e.g., `{{ x : α }}` -/</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">strictImplicit</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- Local instance binder annotataion, e.g., `[Decidable α]` -/</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">instImplicit</span>\n<span class=\"w\">  </span><span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">Inhabited</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">BEq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Repr</span>\n</code></pre></div>\n<p>is <code>.default</code> the same as <code>lean_box(0)</code> and <code>.implicit</code> <code>lean_box(1)</code>, etc.?</p>\n<p>From my experiment it seems like the correspondence is not in order, with <code>0</code> corresponding to <code>strictImplicit</code>, <code>1</code> to <code>instImplicit</code>, etc.</p>",
        "id": 451906105,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1721179781
    },
    {
        "content": "<p>they are in order</p>",
        "id": 451910949,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1721181149
    },
    {
        "content": "<p>what was your test?</p>",
        "id": 451911015,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1721181180
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/270676-lean4/topic/Order.20of.20enumerations.20in.20FFI/near/451911015\">said</a>:</p>\n<blockquote>\n<p>what was your test?</p>\n</blockquote>\n<p>its a part of larger program. I'm trying to narrow the cause down. Basically I constructed <code>lambda (p: Prop) (h: p) =&gt; h</code> using <code>lean_expr_mk_lambda</code>, and fed in <code>lean_box(0)</code> or <code>lean_box(1)</code> as the last argument (binder info)</p>",
        "id": 451918359,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1721184482
    },
    {
        "content": "<p>When I used <code>lean_box(1)</code> (which should be implicit) printing the generated expr gives</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>\n<p>When I used <code>lean_box(0)</code>, it gives</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">h</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>",
        "id": 451918505,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1721184599
    },
    {
        "content": "<p>I found the bug, the call signature should not take a <code>lean_obj*</code> (8 bytes) as the last argument, but rather <code>uint8_t</code>, which means I was tampering the stack</p>",
        "id": 451918844,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1721184845
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"599027\">Leni Aniva</span> has marked this topic as resolved.</p>",
        "id": 451918846,
        "sender_full_name": "Notification Bot",
        "timestamp": 1721184847
    }
]