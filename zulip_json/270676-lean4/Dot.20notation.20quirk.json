[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">baz</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">bar</span><span class=\"bp\">.</span><span class=\"n\">succ</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">my_foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"mi\">0</span><span class=\"bp\">⟩</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">baz</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">my_foo</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"c1\">-- 1</span>\n</code></pre></div>\n<p>I understand the logic of why that works, but allowing this is a little bit confusing imho.</p>",
        "id": 510578314,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1744009879
    },
    {
        "content": "<p>Wait what</p>",
        "id": 510582849,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1744011258
    },
    {
        "content": "<p>Yea, I feel like that shouldn't be valid syntax</p>",
        "id": 510582952,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1744011287
    },
    {
        "content": "<p>I think this is actually really practical because this syntax could mean nothing else and the alternative is lengthy: <code>#eval baz (f := my_foo) |&gt;.baz</code></p>",
        "id": 510583856,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1744011524
    },
    {
        "content": "<p>Adding a mere 3 characters</p>",
        "id": 510584161,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1744011608
    },
    {
        "content": "<p>Well, I use it quite a lot</p>",
        "id": 510584283,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1744011643
    },
    {
        "content": "<p>I see that it can’t mean anything else, but years of programming gets you into the habit of interpreting <code>(...).foo</code> as applying foo to whatever is in the parentheses, not to the parentheses + what’s behind them.</p>",
        "id": 510584329,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1744011658
    },
    {
        "content": "<p>Yes, it feels like it should have a higher precedence than function application</p>",
        "id": 510584530,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1744011721
    },
    {
        "content": "<p>(and similar notations with unbracketed spaces)</p>",
        "id": 510584716,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1744011768
    },
    {
        "content": "<p>Please tell me that you're not using this for anything serious <span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span></p>",
        "id": 510588683,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744012811
    },
    {
        "content": "<p>Hmm, well, I'm sure I've used it in Toric at some point. I guess that's serious?</p>",
        "id": 510590190,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1744013173
    },
    {
        "content": "<p>Surely the alternative is <code>#eval (baz (f := my_foo)).bar</code></p>",
        "id": 510625492,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1744021989
    },
    {
        "content": "<p>yes, although a downside is you have to go back to place the opening bracket, which is also effort</p>",
        "id": 510627257,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1744022457
    },
    {
        "content": "<p>Not if you have the foresight to place it first</p>",
        "id": 510630873,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1744023441
    },
    {
        "content": "<p>Foresight? What's that <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 510639947,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1744025664
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/270676-lean4/topic/Dot.20notation.20quirk/near/510630873\">said</a>:</p>\n<blockquote>\n<p>Not if you have the foresight to place it first</p>\n</blockquote>\n<p>Well usually how it happens is that you write a long list of chained dot notation and suddenly you notice there isn't enough type information for the lemma to apply (or possibly the lemma doesn't apply, but Lean won't tell you why until you fill in some metavariables in the proof term), so you go back to your list of chained dot notation and fill in each metavariable one by one using this funky <code> proof (arg := value).next_proof</code> syntax until it works/gives a better error message</p>",
        "id": 510677916,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1744033997
    },
    {
        "content": "<p>This is clearly unintended syntax -- please don't let this one escape your lab Yaël!</p>\n<p>I'm very amused that the rules line up to make such an unlikely thing parse in a useful way.</p>",
        "id": 510706830,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744040603
    },
    {
        "content": "<p>I guess we can't call it Dr Dillies's monster yet <span aria-label=\"innocent\" class=\"emoji emoji-1f607\" role=\"img\" title=\"innocent\">:innocent:</span></p>",
        "id": 510713345,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1744042355
    },
    {
        "content": "<p>What about this</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">structure</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">Repr</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">foo.bar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f.test</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">baz</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f.test</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">my_foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"mi\">0</span><span class=\"o\">⟩</span>\n\n<span class=\"k\">#eval</span><span class=\"w\"> </span><span class=\"n\">baz</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">my_foo</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">bar</span>\n<span class=\"k\">#eval</span><span class=\"w\"> </span><span class=\"n\">baz</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">my_foo</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">bar</span>\n</code></pre></div>",
        "id": 510718584,
        "sender_full_name": "Jz Pan",
        "timestamp": 1744043748
    },
    {
        "content": "<p>Yeah I've been aware of this issue for a while and always write it as <code>(foo (a := x)).1</code> even though lean is fine without it. It's similar to the issue with <code>foo ...1</code>  (aka <code>(foo ..).1</code>) which was fixed some time ago. It would be great if the fixes here weren't so fragile (I won't be surprised if in a few weeks we find out <code>foo fun x =&gt; by simp.1</code> parses as <code>foo (fun x =&gt; by simp).1</code> or something)</p>",
        "id": 510721243,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744044502
    },
    {
        "content": "<p>...it does, actually (well, <code>foo fun x =&gt; (by simp).1</code> but close enough) <span aria-label=\"melt\" class=\"emoji emoji-1fae0\" role=\"img\" title=\"melt\">:melt:</span></p>",
        "id": 510722005,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744044761
    },
    {
        "content": "<p>well that one i kinda get, <code>by simp</code> is \"atomic\" relative to dot notation since it changes categories...</p>",
        "id": 510722656,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1744044937
    },
    {
        "content": "<p>I think the reliable way to fix this is to allow it to parse, and then reject if the argument left of the dot is anything other than an identifier or a grouped expression</p>",
        "id": 510722836,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744044984
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/channel/270676-lean4/topic/Dot.20notation.20quirk/near/510722656\">said</a>:</p>\n<blockquote>\n<p>well that one i kinda get, <code>by simp</code> is \"atomic\" relative to dot notation since it changes categories...</p>\n</blockquote>\n<p>sure one can <em>explain</em> the behavior, but it's not <em>intended</em> behavior, people visually expect spaces to break the meaning and would read it as <code>by (simp.1)</code> which is nonsense</p>",
        "id": 510723163,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744045084
    },
    {
        "content": "<p>if I use something else there like <code>rw</code> then it can get even more confusing</p>",
        "id": 510723263,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744045124
    },
    {
        "content": "<p>yea, fair</p>",
        "id": 510723401,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1744045169
    }
]