[
    {
        "content": "<p>I'm puzzled by a difference I see between universe inference in Lean and Coq and which I do not understand.<br>\nIf I write the following definition in Lean, I get that <code>Tree</code> lives in <code>Type 2</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">inductive</span><span class=\"w\"> </span><span class=\"n\">Tree</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Ret</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Act</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Tree</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>However the equivalent Coq definition happily lives in <code>Type</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Coq\"><pre><span></span><code><span class=\"kn\">Inductive</span> <span class=\"n\">tree</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"o\">:=</span>\n<span class=\"o\">|</span> <span class=\"n\">Ret</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"o\">|</span> <span class=\"n\">Act</span> <span class=\"o\">{</span><span class=\"n\">β</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">β</span> <span class=\"o\">→</span> <span class=\"n\">tree</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"o\">.</span>\n</code></pre></div>\n<p>Could someone explain me the reason which leads to this discrepancy?</p>",
        "id": 519875396,
        "sender_full_name": "Son Ho",
        "timestamp": 1747930916
    },
    {
        "content": "<p>Note: In Lean any universe <code>&gt; 0</code> is a valid target universe for this inductive type, in particular 1 also works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Tree</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Ret</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Act</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Tree</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>About Coq, are you sure that there is no hidden universe parameters in these <code>Type</code>s that are actually different? Otherwise setting <code>β = Tree α</code>, this seems inconsistent.</p>",
        "id": 519877116,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1747931425
    },
    {
        "content": "<p>IIRC in Coq, if you don't turn on universe polymorphism explicitly, your universe live in some universe parameters with some universe inequalities behind the scenes(?)</p>",
        "id": 519877274,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1747931481
    },
    {
        "content": "<p>Oh indeed you're right, the universe was hidden in Coq.<br>\nDoing this:</p>\n<div class=\"codehilite\" data-code-language=\"Coq\"><pre><span></span><code><span class=\"kn\">Set</span> <span class=\"kn\">Printing</span> <span class=\"kn\">Universes</span><span class=\"p\">.</span>\n<span class=\"kn\">Check</span> <span class=\"n\">tree</span><span class=\"o\">.</span>\n</code></pre></div>\n<p>gives me:</p>\n<div class=\"codehilite\" data-code-language=\"Coq\"><pre><span></span><code><span class=\"n\">tree</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"o\">@{</span><span class=\"n\">tree.u0</span><span class=\"o\">}</span> <span class=\"o\">→</span> <span class=\"kt\">Type</span><span class=\"o\">@{</span><span class=\"n\">max</span><span class=\"o\">(</span><span class=\"kt\">Set</span><span class=\"o\">,</span><span class=\"n\">tree.u0</span><span class=\"o\">,</span><span class=\"n\">exercises.lang</span><span class=\"o\">.</span><span class=\"mi\">251</span><span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"o\">)}</span>\n</code></pre></div>\n<p>which seems to be the same. So everything is good (sorry for the noise <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span> )</p>",
        "id": 519878269,
        "sender_full_name": "Son Ho",
        "timestamp": 1747931796
    },
    {
        "content": "<p>universe 252 <span aria-label=\"eyes\" class=\"emoji emoji-1f440\" role=\"img\" title=\"eyes\">:eyes:</span></p>",
        "id": 519880496,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1747932580
    },
    {
        "content": "<p>the language automatically going that high is wild</p>",
        "id": 519880594,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1747932606
    },
    {
        "content": "<p>I think <code>foo.251</code> is just an internal number given to the universe variable as its name. In a small Lean file, I expect that the internal universe metavariable counter will exceed that very quickly.</p>",
        "id": 519881032,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1747932747
    },
    {
        "content": "<p>i suppose that is a more sensible explanation</p>",
        "id": 519884820,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1747934110
    },
    {
        "content": "<p>Isn’t Type in Coq equivalent to Type 2 in lean?</p>",
        "id": 519895225,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1747937968
    },
    {
        "content": "<p>I thought they called their <code>Type</code> <code>Set</code>?</p>",
        "id": 519895283,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1747937995
    },
    {
        "content": "<p>Source of my (mis?)-understanding : <a href=\"https://cs.stackexchange.com/a/80737\">https://cs.stackexchange.com/a/80737</a></p>",
        "id": 519895784,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1747938166
    },
    {
        "content": "<p>I could be wrong and Set and Prop are at the same universe level in Rocq</p>",
        "id": 519895956,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1747938239
    },
    {
        "content": "<p>It's a bit complicated. The Rocq universe hierarchy has <code>Prop : Type@{Set+1}</code>, <code>Set : Type@{Set+1}</code> and <code>Type@{u} : Type@{u+1}</code>, or more generally <code>Type@{u} : Type@{v}</code> when <code>u &lt; v</code>. Note that <code>Set</code> is both a universe name and also a level name, and <code>Set</code> means <code>Type@{Set}</code>  and <code>Prop = Type@{Prop}</code> likewise. <code>Prop+1</code> is not a well formed level expression, but from the typing relations it seems <code>Prop+1</code> effectively evaluates to <code>Set+1</code>.</p>",
        "id": 519905618,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1747941454
    },
    {
        "content": "<p>One extra inclusion: <code>SProp : Type@{Set+1}</code> as well, but <code>SProp</code> is not a level name like the other two so it is not expressible as <code>Type@{...}</code>.</p>",
        "id": 519906742,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1747941996
    },
    {
        "content": "<p>oh and also they recently .generalized their universe hierarchy some more with sort polymorphism, so we have <code>Type@{Prop|u}</code> which means something. I think it doesn't add any actually new universes but there are now sort variables that range over <code>SProp, Prop, Set</code></p>",
        "id": 519906995,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1747942089
    },
    {
        "content": "<p>Still, they still have a way to go to compete with the <a href=\"https://github.com/agda/agda/blob/e4342775741d7a48644b68b0209bdb84444e294f/src/full/Agda/Syntax/Internal.hs#L317-L331\">awe inspiring complexity of the agda universe hierarchy</a></p>",
        "id": 519907504,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1747942305
    },
    {
        "content": "<p>Sometimes I feel like I inhabit <code>DummyS</code>.</p>",
        "id": 519907888,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1747942468
    },
    {
        "content": "<p>So Coq’s universe hierarchy is a partial order with no ordering between Set and Prop</p>",
        "id": 519914150,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1747945053
    }
]