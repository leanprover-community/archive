[
    {
        "content": "<p>I have noticed that <code>simp?</code> tends to include variables from <code>let</code> bindings in the list it suggests even though they are not necessary (e.g., because they do not even occur in the expression to be simplified). This seems to be triggered by an earlier <code>simp</code> or <code>simp only</code> using such a variable. Here is a Mathlib-free <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">p</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"c1\">-- no `p` below without the `simp only [p]` here</span>\n<span class=\"w\">  </span><span class=\"n\">simp?</span><span class=\"c1\">-- Try this: simp only [Int.add_sub_cancel, p]</span>\n</code></pre></div>\n<p>Clearly, <code>p</code> should not be mentioned (and <code>simp only [Int.add_sub_cancel]</code> of course works). Replacing <code>simp only [p]</code> in the line above by <code>sorry</code> makes the <code>p</code> go away.</p>",
        "id": 521364328,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1748635547
    },
    {
        "content": "<p>It looks like the <code>zetaDeltaFVarIds</code> set isn't being reset by simp, and <code>simp</code> uses this to keep track of which local variables have been reduced. Could you report a Lean 4 issue with this example?</p>",
        "id": 521374278,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1748640542
    },
    {
        "content": "<p>I have made <a href=\"https://github.com/leanprover/lean4/pull/7539\">lean4#7539</a> to fix this. I think the relevant issue is <a href=\"https://github.com/leanprover/lean4/pull/6655\">lean4#6655</a></p>",
        "id": 521382639,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1748645891
    },
    {
        "content": "<p>Good to know, I was considering making a similar change for other reasons.</p>",
        "id": 521383522,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1748646414
    },
    {
        "content": "<p>I've added the example to <a href=\"https://github.com/leanprover/lean4/pull/6655\">lean4#6655</a> .</p>",
        "id": 521419601,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1748677134
    }
]