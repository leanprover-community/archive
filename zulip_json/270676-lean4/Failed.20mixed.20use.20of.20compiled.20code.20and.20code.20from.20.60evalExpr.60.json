[
    {
        "content": "<p>I'm trying to mix the use of compiled code and code from <code>evalExpr</code> in a Lean project. During my experiments, I found what appears to be a bug: mixing compiled code with code obtained through <code>evalExpr</code> causes a stack overflow under specific conditions.</p>\n<p>I've created a minimal reproduction project here: <a href=\"https://github.com/zqy1018/compilation-vs-evalExpr\">https://github.com/zqy1018/compilation-vs-evalExpr</a> (OS version of my machine: MacOS 26.1 (arm64)). I've also done some testing; the result is in the <a href=\"https://github.com/zqy1018/compilation-vs-evalExpr/blob/main/README.md\">README.md</a>.</p>\n<p>The result indicates:</p>\n<ol>\n<li>Pure <code>evalExpr</code> (<code>main1</code> + <code>bycall</code>) works fine</li>\n<li>Pure compiled code (<code>main2</code>) works fine</li>\n<li>The problem only occurs when mixing the two (<code>main1</code> + <code>byarg</code>)</li>\n<li>It only happens with the large input</li>\n<li>It only affects <code>isPrimeUsingClass</code> and <code>isPrimeNotUsingClass</code>, which are relatively complicated and involve typeclass instances</li>\n<li>Interestingly, whether the called function actually <em>uses</em> the typeclass doesn't matter (<code>isPrimeUsingClass</code> uses the typeclass, <code>isPrimeNotUsingClass</code> doesn't)</li>\n</ol>\n<p>My question is: is this a bug, or is there something fundamentally wrong with my approach? More broadly, is it reasonable/supported to use <code>evalExpr</code> within compiled programs to dynamically generate code in this way?</p>\n<p>Any insights would be greatly appreciated!</p>",
        "id": 566124849,
        "sender_full_name": "Qiyuan Zhao",
        "timestamp": 1767416897
    }
]