[
    {
        "content": "<p>Is there a way to automatically propagate the renaming of a definition or theorem throughout an entire project? The refactor command in Visual Code doesn't seem to work for this, so I change one name at a time, rebuild after each, and fix it where it breaks. If I do a replace in all files, it doesn't take the semantics of what a definition or theorem is into account.</p>",
        "id": 488896985,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1734114087
    },
    {
        "content": "<p>My experience has been that the right-click option \"rename symbol\" works quite well, have you tried that instead of refactor?</p>",
        "id": 488898832,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1734114784
    },
    {
        "content": "<p>Oh, I meant that, instead of the literal \"refactor\" command. I've had trouble with it in the past, but I can give it another try.</p>",
        "id": 488899189,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1734114936
    },
    {
        "content": "<p>It doesn't seem to work for at least the case <code>Formula_.free_var_set</code> -&gt; <code>Formula_.free_var_set_test</code>. Maybe because it is an extension of the <code>Formula_</code> definition?</p>",
        "id": 488900042,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1734115255
    },
    {
        "content": "<p>It goes from</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"bp\">.</span><span class=\"n\">free_var_set</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">VarName_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">pred_const_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"bp\">.</span><span class=\"n\">toFinset</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">pred_var_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"bp\">.</span><span class=\"n\">toFinset</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">eq_</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">true_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">∅</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">false_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">∅</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"bp\">.</span><span class=\"n\">free_var_set</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">imp_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"bp\">.</span><span class=\"n\">free_var_set</span><span class=\"w\"> </span><span class=\"bp\">∪</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"bp\">.</span><span class=\"n\">free_var_set</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"bp\">.</span><span class=\"n\">free_var_set</span><span class=\"w\"> </span><span class=\"bp\">∪</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"bp\">.</span><span class=\"n\">free_var_set</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">or_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"bp\">.</span><span class=\"n\">free_var_set</span><span class=\"w\"> </span><span class=\"bp\">∪</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"bp\">.</span><span class=\"n\">free_var_set</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">iff_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"bp\">.</span><span class=\"n\">free_var_set</span><span class=\"w\"> </span><span class=\"bp\">∪</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"bp\">.</span><span class=\"n\">free_var_set</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">forall_</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"bp\">.</span><span class=\"n\">free_var_set</span><span class=\"w\"> </span><span class=\"bp\">\\</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">exists_</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"bp\">.</span><span class=\"n\">free_var_set</span><span class=\"w\"> </span><span class=\"bp\">\\</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">def_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"bp\">.</span><span class=\"n\">toFinset</span>\n</code></pre></div>\n<p>to</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"bp\">.</span><span class=\"n\">free_var_set_test</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">VarName_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">pred_const_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"bp\">.</span><span class=\"n\">toFinset</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">pred_var_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"bp\">.</span><span class=\"n\">toFinset</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">eq_</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">true_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">∅</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">false_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">∅</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"bp\">.</span><span class=\"n\">Formula_</span><span class=\"bp\">.</span><span class=\"n\">free_var_set_test</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">imp_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"bp\">.</span><span class=\"n\">Formula_</span><span class=\"bp\">.</span><span class=\"n\">free_var_set_test</span><span class=\"w\"> </span><span class=\"bp\">∪</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"bp\">.</span><span class=\"n\">Formula_</span><span class=\"bp\">.</span><span class=\"n\">free_var_set_test</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"bp\">.</span><span class=\"n\">Formula_</span><span class=\"bp\">.</span><span class=\"n\">free_var_set_test</span><span class=\"w\"> </span><span class=\"bp\">∪</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"bp\">.</span><span class=\"n\">Formula_</span><span class=\"bp\">.</span><span class=\"n\">free_var_set_test</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">or_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"bp\">.</span><span class=\"n\">Formula_</span><span class=\"bp\">.</span><span class=\"n\">free_var_set_test</span><span class=\"w\"> </span><span class=\"bp\">∪</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"bp\">.</span><span class=\"n\">Formula_</span><span class=\"bp\">.</span><span class=\"n\">free_var_set_test</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">iff_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"bp\">.</span><span class=\"n\">Formula_</span><span class=\"bp\">.</span><span class=\"n\">free_var_set_test</span><span class=\"w\"> </span><span class=\"bp\">∪</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"bp\">.</span><span class=\"n\">Formula_</span><span class=\"bp\">.</span><span class=\"n\">free_var_set_test</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">forall_</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"bp\">.</span><span class=\"n\">Formula_</span><span class=\"bp\">.</span><span class=\"n\">free_var_set_test</span><span class=\"w\"> </span><span class=\"bp\">\\</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">exists_</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"bp\">.</span><span class=\"n\">Formula_</span><span class=\"bp\">.</span><span class=\"n\">free_var_set_test</span><span class=\"w\"> </span><span class=\"bp\">\\</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">def_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"bp\">.</span><span class=\"n\">toFinset</span>\n</code></pre></div>",
        "id": 488901280,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1734115752
    },
    {
        "content": "<p>Oh that's interesting. Yeah for names with more than one segment it does seem to handle subsequent invocations via dot notation poorly, I'm so used to opening <code>namespace Foo</code> right after the base definition.</p>",
        "id": 488902781,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1734116324
    },
    {
        "content": "<p>If I try to rename just the suffix in for example <code>psi.free_var_set</code>, the <code>Formula_.free_var_set</code> becomes <code>free_var_set_test</code>.</p>",
        "id": 488932352,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1734129489
    },
    {
        "content": "<p>Would this have to be addressed in Visual Code itself?</p>",
        "id": 488949046,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1734141224
    },
    {
        "content": "<p>I would assume the behavior of the rename action is governed by a combination of the lean vscode extension and the lsp stuff that's built in to lean (in the Lean.Lsp namespace), and not vscode itself.</p>",
        "id": 488953870,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1734145658
    },
    {
        "content": "<p>It's a client/server architecture, so I think the Lean LSP gets a message along the lines of \"user requests <code>rename(&lt;foo&gt;, &lt;bar&gt;) @ &lt;loc&gt;</code>\" and the language server (rather than the editor) is responsible for working out the contents of the message to send back reflecting the actual change.</p>",
        "id": 488954272,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1734145815
    },
    {
        "content": "<p>I see.</p>",
        "id": 488954842,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1734146368
    },
    {
        "content": "<p>This is a known limitation of the current implementation, it doesn't have the context it needs to be able to do the replacement correctly. It's probably worth filing a bug anyway, but it is not an easy fix, it requires more data to be stored in ilean files</p>",
        "id": 489017169,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1734201882
    }
]