[
    {
        "content": "<p>While it is convenient to use the <code>guard</code> function within a monadic context, how can we assign names to the propositions being guarded, as in the following example?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">arr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">arr</span><span class=\"bp\">.</span><span class=\"n\">get?</span><span class=\"w\"> </span><span class=\"n\">i</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">else</span>\n<span class=\"w\">    </span><span class=\"n\">none</span>\n</code></pre></div>",
        "id": 491995822,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1736108856
    },
    {
        "content": "<p>I found myself needing this the other day, and used</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">h</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">PLift</span><span class=\"bp\">.</span><span class=\"n\">up</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">failure</span>\n</code></pre></div>",
        "id": 492064355,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736154681
    },
    {
        "content": "<p>(in my case I actually used <code>throwError</code> not <code>failure</code>)</p>",
        "id": 492064493,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736154726
    },
    {
        "content": "<p>Ideally we'd have <code>unless h : P do failure</code> as syntax for this</p>",
        "id": 492064601,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736154774
    },
    {
        "content": "<p>i seem to recall someone working on this/something along these lines?</p>",
        "id": 492089166,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1736164091
    },
    {
        "content": "<p>i feel like there might be a lean issue/pr for it</p>",
        "id": 492089240,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1736164129
    },
    {
        "content": "<p>unfortunately, i can't find it</p>",
        "id": 492090317,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1736164601
    },
    {
        "content": "<p>Do you mean <a href=\"https://github.com/leanprover/lean4/issues/5598\">https://github.com/leanprover/lean4/issues/5598</a>?</p>",
        "id": 492097136,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1736167331
    },
    {
        "content": "<p>that might be it, although i also remember this involving <code>if</code> without <code>else</code>... that might just be wishful thinking on my part though <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 492102263,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1736169156
    },
    {
        "content": "<p>Edward, maybe you were thinking of <a href=\"#narrow/channel/270676-lean4/topic/Indexing.20hypothesis.20observations\">this</a> or <a href=\"#narrow/channel/270676-lean4/topic/RFC.3A.20If.20hypothesis.20scope\">this</a>?</p>",
        "id": 492106155,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736170618
    },
    {
        "content": "<p>yes, that second one is it!</p>",
        "id": 492109128,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1736171674
    },
    {
        "content": "<p>I put a snippet you can copy/paste on <a href=\"https://github.com/leanprover/lean4/pull/5598\">lean4#5598</a></p>",
        "id": 492117529,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736174501
    }
]