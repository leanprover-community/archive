[
    {
        "content": "<p>Hi,<br>\nI am currently working with <code>Subarray</code> to prove the correctness of some algorithm and find it a bit tedious to work with. As a background the problem deals with finding the optimal subarray of some given array <code>a</code> and criteria.</p>\n<p>I very often need to add <code>s.array = a</code> to my theorem statements, because the Subarray only receives the type and hence there might be a different array <code>a'</code> with some better subarray. A more clean definition for my use case would be the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Subarray'</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">start</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"w\">  </span><span class=\"n\">stop</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"w\">  </span><span class=\"sd\">/--</span>\n<span class=\"sd\">  The starting index is no later than the ending index.</span>\n\n<span class=\"sd\">  The ending index is exclusive. If the starting and ending indices are equal, then the subarray is</span>\n<span class=\"sd\">  empty.</span>\n<span class=\"sd\">  -/</span>\n<span class=\"w\">  </span><span class=\"n\">start_le_stop</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">start</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">stop</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The stopping index is no later than the end of the array.</span>\n\n<span class=\"sd\">  The ending index is exclusive. If it is equal to the size of the array, then the last element of</span>\n<span class=\"sd\">  the array is in the subarray.</span>\n<span class=\"sd\">  -/</span>\n<span class=\"w\">  </span><span class=\"n\">stop_le_array_size</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stop</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"bp\">.</span><span class=\"n\">size</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Subarray'</span><span class=\"bp\">.</span><span class=\"n\">array</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Subarray'</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">a</span>\n</code></pre></div>\n<p>The <code>Subarray.array</code> method looks then a bit strange with the anonymous subarray, but I think the rest should work the same as previously.</p>\n<p>Is there some alternative reason that makes this definition better to use or is it better on a low-level memory aspect? If not I would propose to change it and can also create the PR. I also looked in mathlib and batteries and at least with githubs search didn't find any usecase where this would lead to large fallout (or any large use of it).</p>",
        "id": 515141088,
        "sender_full_name": "Johannes Tantow",
        "timestamp": 1745954271
    },
    {
        "content": "<p>We will completely overhaul <code>Subarray</code> in the next few months, so I'm afraid right now would not be a good time to make a PR. Thanks a lot for writing down your experience, we will be taking this into account for the new design.</p>",
        "id": 515144546,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1745955560
    },
    {
        "content": "<p>I guess I can also for now just define my own subarray instance and work with that. I mainly use it to bundle the information better, so that works for me for now.</p>",
        "id": 515151807,
        "sender_full_name": "Johannes Tantow",
        "timestamp": 1745958425
    },
    {
        "content": "<p>I think currently <code>Subarray</code> does not have API for mutation but I'm not even sure if it would be possible to do for your definition of subarray.</p>",
        "id": 515170712,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1745967080
    },
    {
        "content": "<p>I don't see why it shouldn't be possible though one might have to use cast in the definition when the underlying array changes. <br>\nI guess the design mainly depends though on what you want to do with it. I am not really interested in having subarrays of different arrays to have the same type.</p>",
        "id": 515226339,
        "sender_full_name": "Johannes Tantow",
        "timestamp": 1745997619
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"260921\">Markus Himmel</span> has marked this topic as resolved.</p>",
        "id": 523311732,
        "sender_full_name": "Notification Bot",
        "timestamp": 1749567319
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"260921\">Markus Himmel</span> has marked this topic as unresolved.</p>",
        "id": 523313420,
        "sender_full_name": "Notification Bot",
        "timestamp": 1749567752
    }
]