[
    {
        "content": "<p>I have written a small snippet of code to render the <code>Mathlib4</code> docs in the Lean Infoview using the <a href=\"https://github.com/EdAyers/ProofWidgets4\"><code>ProofWidgets4</code> framework</a>. The intended use case is for looking up definitions and theorems in <code>Mathlib4</code> without having to leave the Lean editor. Here is how it looks in VS Code (triggered by typing <code>#docs</code>):</p>\n<p><a href=\"/user_uploads/3121/07ov-aWgXxeT5QSKbNZygW0x/docs_infoview.png\">docs_infoview.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/07ov-aWgXxeT5QSKbNZygW0x/docs_infoview.png\" title=\"docs_infoview.png\"><img src=\"/user_uploads/3121/07ov-aWgXxeT5QSKbNZygW0x/docs_infoview.png\"></a></div><p>The code (available <a href=\"https://github.com/0art0/ProofWidgets4/blob/main/ProofWidgets/Demos/Docs.lean\">here</a>)    essentially creates an embedded HTML iframe with <a href=\"https://leanprover-community.github.io/mathlib4_docs/\">the Mathlib4 docs page</a> as its source. The recommended way to try this code is by cloning and building the original <a href=\"https://github.com/EdAyers/ProofWidgets4\"><code>ProofWidgets4</code> repository</a> according to <a href=\"https://github.com/EdAyers/ProofWidgets4#viewing-the-demos\">the instructions in the <code>README</code></a> and then pasting the following code in a file in <code>ProofWidgets/Demos</code>. </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">ProofWidgets.Component.HtmlDisplay</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">scoped</span> <span class=\"n\">ProofWidgets.Jsx</span>\n\n<span class=\"n\">syntax</span> <span class=\"o\">(</span><span class=\"n\">name</span> <span class=\"o\">:=</span> <span class=\"n\">docsCmd</span><span class=\"o\">)</span> <span class=\"s2\">\"#docs\"</span> <span class=\"o\">:</span> <span class=\"n\">command</span>\n\n<span class=\"bp\">#</span><span class=\"n\">html</span> <span class=\"bp\">&lt;</span><span class=\"n\">iframe</span> <span class=\"n\">src</span><span class=\"bp\">=</span><span class=\"s2\">\"https://leanprover-community.github.io/mathlib4_docs/\"</span> <span class=\"n\">width</span><span class=\"bp\">=</span><span class=\"s2\">\"100%\"</span> <span class=\"n\">height</span><span class=\"bp\">=</span><span class=\"s2\">\"500px\"</span> <span class=\"n\">frameborder</span><span class=\"bp\">=</span><span class=\"s2\">\"0\"</span><span class=\"bp\">&gt;&lt;/</span><span class=\"n\">iframe</span><span class=\"bp\">&gt;</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">Lean</span> <span class=\"n\">ProofWidgets</span> <span class=\"n\">Elab</span> <span class=\"n\">Command</span> <span class=\"n\">Server</span> <span class=\"n\">Json</span> <span class=\"k\">in</span>\n<span class=\"kd\">@[command_elab docsCmd]</span>\n<span class=\"kd\">def</span> <span class=\"n\">elabDocsCmd</span> <span class=\"o\">:</span> <span class=\"n\">CommandElab</span>\n  <span class=\"bp\">|</span> <span class=\"n\">stx</span><span class=\"bp\">@`</span><span class=\"o\">(</span><span class=\"n\">command</span><span class=\"bp\">|</span> <span class=\"bp\">#</span><span class=\"n\">docs</span><span class=\"o\">)</span> <span class=\"bp\">=&gt;</span> <span class=\"k\">do</span>\n    <span class=\"n\">runTermElabM</span> <span class=\"k\">fun</span> <span class=\"n\">_</span> <span class=\"bp\">=&gt;</span> <span class=\"k\">do</span>\n      <span class=\"k\">let</span> <span class=\"n\">docs</span> <span class=\"o\">:=</span> <span class=\"n\">ProofWidgets.Html.ofTHtml</span> <span class=\"bp\">&lt;|</span>\n        <span class=\"bp\">&lt;</span><span class=\"n\">iframe</span> <span class=\"n\">src</span><span class=\"bp\">=</span><span class=\"s2\">\"https://leanprover-community.github.io/mathlib4_docs/\"</span>\n            <span class=\"n\">width</span><span class=\"bp\">=</span><span class=\"s2\">\"100%\"</span> <span class=\"n\">height</span><span class=\"bp\">=</span><span class=\"s2\">\"600px\"</span> <span class=\"n\">frameborder</span><span class=\"bp\">=</span><span class=\"s2\">\"0\"</span><span class=\"bp\">&gt;</span>\n        <span class=\"bp\">&lt;/</span><span class=\"n\">iframe</span><span class=\"bp\">&gt;</span>\n      <span class=\"n\">savePanelWidgetInfo</span> <span class=\"n\">stx</span> <span class=\"bp\">``</span><span class=\"n\">HtmlDisplayPanel</span> <span class=\"k\">do</span>\n        <span class=\"n\">return</span> <span class=\"n\">json</span><span class=\"bp\">%</span> <span class=\"o\">{</span> <span class=\"n\">html</span><span class=\"o\">:</span> <span class=\"bp\">$</span><span class=\"o\">(</span><span class=\"bp\">‚Üê</span> <span class=\"n\">rpcEncode</span> <span class=\"n\">docs</span><span class=\"o\">)</span> <span class=\"o\">}</span>\n  <span class=\"bp\">|</span> <span class=\"n\">_</span> <span class=\"bp\">=&gt;</span> <span class=\"n\">throwError</span> <span class=\"s2\">\"Unexpected syntax for rendering docs.\"</span>\n\n<span class=\"bp\">#</span><span class=\"n\">docs</span>\n</code></pre></div>\n<p>I find that some of the links - especially the <code>ink</code> and <code>source</code> buttons as well as the ones on the left sidebar - don't usually work when I click on them. This is probably a HTML <code>iframe</code> issue and not one specific to Lean or VS Code.</p>",
        "id": 363624850,
        "sender_full_name": "Anand Rao Tadipatri",
        "timestamp": 1685948080
    },
    {
        "content": "<p>I have now generalised the code to permit arbitrary browsing in the infoview. The <a href=\"https://github.com/0art0/ProofWidgets4/blob/main/ProofWidgets/Demos/Docs.lean\">new code</a> contains two new commands - <code>#browse</code> and <code>#web</code>. The first takes in a URL as a string and renders the webpage in the infoview. The second takes in a name and a URL (for example, <code>#web docs \"https://leanprover-community.github.io/mathlib4_docs/\"</code>) and creates a new command (<code>#docs</code>, in this example) for opening the chosen webpage.</p>\n<p>Here are a few screenshots of the commands in VS Code:<br>\n<a href=\"/user_uploads/3121/JBK8VgDM5n9mFbJew74HwrcY/browse_lean_blog_infoview.png\">browse_lean_blog_infoview.png</a><br>\n<a href=\"/user_uploads/3121/6jzAdYrNCC6n4F55_xEMzfRN/desmos_web_infoview.png\">desmos_web_infoview.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/JBK8VgDM5n9mFbJew74HwrcY/browse_lean_blog_infoview.png\" title=\"browse_lean_blog_infoview.png\"><img src=\"/user_uploads/3121/JBK8VgDM5n9mFbJew74HwrcY/browse_lean_blog_infoview.png\"></a></div><div class=\"message_inline_image\"><a href=\"/user_uploads/3121/6jzAdYrNCC6n4F55_xEMzfRN/desmos_web_infoview.png\" title=\"desmos_web_infoview.png\"><img src=\"/user_uploads/3121/6jzAdYrNCC6n4F55_xEMzfRN/desmos_web_infoview.png\"></a></div><p>To try out the code, run the following sequence of commands in the terminal:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>git<span class=\"w\"> </span>clone<span class=\"w\"> </span>https://github.com/0art0/ProofWidgets4<span class=\"w\"> </span>--branch<span class=\"w\"> </span>browsing\n<span class=\"nb\">cd</span><span class=\"w\"> </span>ProofWidgets4\nlake<span class=\"w\"> </span>build<span class=\"w\"> </span>:release\n</code></pre></div>\n<p>The above examples are contained in the file <code>ProofWidgets/Demos/Docs.lean</code>.</p>",
        "id": 363886783,
        "sender_full_name": "Anand Rao Tadipatri",
        "timestamp": 1686027461
    },
    {
        "content": "<p>Does zulip work well in the infoview? I'd never leave VSCode again. :-)</p>",
        "id": 363890999,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1686029491
    },
    {
        "content": "<p>I tried, but unfortunately it doesn't load. It turns out that GitHub and Zulip (among other websites like Google) have taken measures to prevent their pages from being embedded as HTML iframes. Zulip may work if the HTML page is generated in a different way without iframes. </p>\n<p>A bit of work will also be required to stay logged in to the same Zulip session across all files (I'm actually not sure if this is possible through Lean).</p>",
        "id": 363893482,
        "sender_full_name": "Anand Rao Tadipatri",
        "timestamp": 1686030650
    }
]