[
    {
        "content": "<p>Is there a way to automatically figure out a minimal list of imports that are necessary to make a file compile? For example, although it is possible to import all of Mathlib via <code>import Mathlib</code>, doing so can significantly slow down one's environment. I thought <code>#min_imports</code> was the way to do it. However, I could not make it work. For example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Filter</span>\n\n<span class=\"kd\">example</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Tendsto</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">atTop</span><span class=\"w\"> </span><span class=\"n\">atTop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Tendsto.atTop_pow</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hn</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"n\">norm_num</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">a</span>\n\n<span class=\"bp\">#</span><span class=\"n\">min_imports</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">outputs</span><span class=\"w\"> </span><span class=\"n\">nothing</span><span class=\"bp\">...</span>\n</code></pre></div>\n<p>Here, I would expect the last command to give me a minimal list of imports. However, it outputs nothing. Am I doing something wrong?</p>",
        "id": 518038915,
        "sender_full_name": "Jonathan Laurent",
        "timestamp": 1747221920
    },
    {
        "content": "<p>It outputs nothing because you used <code>example</code>. If you turn it into a lemma you will get an import list.</p>",
        "id": 518040520,
        "sender_full_name": "Rémy Degenne",
        "timestamp": 1747222355
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Filter</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">myExample</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Tendsto</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">atTop</span><span class=\"w\"> </span><span class=\"n\">atTop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Tendsto</span><span class=\"bp\">.</span><span class=\"n\">atTop_pow</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hn</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">norm_num</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">a</span>\n\n<span class=\"bp\">#</span><span class=\"n\">min_imports</span>\n<span class=\"c\">/-</span>\n<span class=\"cm\">import Mathlib.Algebra.Order.Ring.Star</span>\n<span class=\"cm\">import Mathlib.Order.Filter.AtTopBot.Monoid</span>\n<span class=\"cm\">import Mathlib.Tactic.NormNum.Ineq</span>\n<span class=\"cm\">-/</span>\n</code></pre></div>",
        "id": 518040527,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1747222357
    },
    {
        "content": "<p>The first import in that list is not actually needed (probably because one instance from that file is used, but another instance could be used if that file was not imported). My very heuristic rule of thumb: any time <code>#min_imports</code> tells me to import something with star in the name (cstaralgebra, etc), that's spurious.</p>",
        "id": 518041043,
        "sender_full_name": "Rémy Degenne",
        "timestamp": 1747222522
    },
    {
        "content": "<p>Thanks! The documentation from #min_imports hints at some limitations:</p>\n<blockquote>\n<p>Tactics and macros may result in incorrect output.</p>\n</blockquote>\n<p>However, it is unclear to me what this means regarding tactics. Does this mean that correct imports will be generated for names present in statements but not necessarily in tactic-based proof scripts?</p>",
        "id": 518042528,
        "sender_full_name": "Jonathan Laurent",
        "timestamp": 1747222964
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"890848\">Jonathan Laurent</span> has marked this topic as resolved.</p>",
        "id": 518042911,
        "sender_full_name": "Notification Bot",
        "timestamp": 1747223078
    }
]