[
    {
        "content": "<p>Just checking that Iâ€¯didnâ€™t miss anything before my new course starts: was there any progress on the issue of the size of Lean4 + Mathlib? Is there any way to distribute smaller oleans? Any way to automatically distribute only the part of Mathlib that a given lib depends on? My current plan is to use a Mathlib fork where I will manually delete most of the library, but any tool automating this would be welcome.</p>",
        "id": 491865418,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1735986377
    },
    {
        "content": "<p>You can distribute smaller oleans with <code>lake exe cache get Mathlib.Data.Matrix.Basic</code> or similar</p>",
        "id": 491871243,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1735991970
    },
    {
        "content": "<p>I don't know if that works for downstream libraries or if you have to name a mathlib module (or modules?)</p>",
        "id": 491871313,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1735992007
    },
    {
        "content": "<p>I tried using <code>lake exe cache get Mathlib.Tactic</code>. lake says <code>Warning: .lake/packages/mathlib/Mathlib.Tactic not found. Skipping all files that depend on it</code> but it still downloads only 2.7Gb instead of 5.1Gb.</p>",
        "id": 492281957,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736245718
    },
    {
        "content": "<p>Iâ€™m still not 100% sure Iâ€™ll be able to teach using Lean 4 this year, because of this issue. I need to talk to the IT people here.</p>",
        "id": 492282050,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736245752
    },
    {
        "content": "<p>Right now Iâ€™ll try to see if I can find a combination of lighter tactic imports. Iâ€™m really surprised that <code>import Mathlib.Tactic</code> imports more than half of Mathlib (if this is indeed what cache is telling me).</p>",
        "id": 492282312,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736245832
    },
    {
        "content": "<p>And Tactic.Basic?</p>",
        "id": 492294479,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1736250475
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span>\n\n<span class=\"c\">/-</span>\n<span class=\"cm\">3589 transitive imports</span>\n\n<span class=\"cm\">2291 starting with \"Mathlib\":</span>\n<span class=\"cm\">[Mathlib.Algebra.AddTorsor,</span>\n<span class=\"cm\"> Mathlib.Algebra.Algebra.Basic,</span>\n<span class=\"cm\"> Mathlib.Algebra.Algebra.Bilinear,</span>\n<span class=\"cm\"> and so on...</span>\n<span class=\"cm\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">trans_imports</span><span class=\"w\"> </span><span class=\"s2\">\"Mathlib\"</span>\n</code></pre></div>\n<p>while with basic</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Util</span><span class=\"bp\">.</span><span class=\"n\">TransImports</span>\n\n<span class=\"c\">/-</span>\n<span class=\"cm\">1102 transitive imports</span>\n\n<span class=\"cm\">18 starting with \"Mathlib\":</span>\n<span class=\"cm\">[Mathlib.Init,</span>\n<span class=\"cm\"> Mathlib.Tactic.Basic,</span>\n<span class=\"cm\"> Mathlib.Tactic.DeclarationNames,</span>\n<span class=\"cm\"> Mathlib.Tactic.ExtendDoc,</span>\n<span class=\"cm\"> Mathlib.Tactic.Lemma,</span>\n<span class=\"cm\"> Mathlib.Tactic.Linter.DocPrime,</span>\n<span class=\"cm\"> Mathlib.Tactic.Linter.GlobalAttributeIn,</span>\n<span class=\"cm\"> Mathlib.Tactic.Linter.HashCommandLinter,</span>\n<span class=\"cm\"> Mathlib.Tactic.Linter.Header,</span>\n<span class=\"cm\"> Mathlib.Tactic.Linter.Lint,</span>\n<span class=\"cm\"> Mathlib.Tactic.Linter.Multigoal,</span>\n<span class=\"cm\"> Mathlib.Tactic.Linter.OldObtain,</span>\n<span class=\"cm\"> Mathlib.Tactic.Linter.RefineLinter,</span>\n<span class=\"cm\"> Mathlib.Tactic.Linter.Style,</span>\n<span class=\"cm\"> Mathlib.Tactic.Linter.UnusedTactic,</span>\n<span class=\"cm\"> Mathlib.Tactic.PPWithUniv,</span>\n<span class=\"cm\"> Mathlib.Tactic.TypeStar,</span>\n<span class=\"cm\"> Mathlib.Util.TransImports]</span>\n<span class=\"cm\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">trans_imports</span><span class=\"w\"> </span><span class=\"s2\">\"Mathlib\"</span>\n</code></pre></div>",
        "id": 492296474,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736251288
    },
    {
        "content": "<p>I need linarith of course. But I manage to get down to 1.5Gb. Iâ€™ll continue trying to work on it.</p>",
        "id": 492297560,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736251739
    },
    {
        "content": "<p>How big is too big for you?</p>",
        "id": 492297644,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736251782
    },
    {
        "content": "<p>linarith implies 449 mathlib files.</p>",
        "id": 492297659,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736251790
    },
    {
        "content": "<p>Of course this 1.5Gb does not include the Lean toolchain which is already more than 1Gb.</p>",
        "id": 492297661,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736251791
    },
    {
        "content": "<p>In the Lean days I was shipping less than 150Mb.</p>",
        "id": 492297751,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736251815
    },
    {
        "content": "<p>including lean itself.</p>",
        "id": 492297760,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736251822
    },
    {
        "content": "<p>That was surely the compressed size, right?</p>",
        "id": 492298402,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736252099
    },
    {
        "content": "<p>I guess my question is whether the problem is shipped size or installed size</p>",
        "id": 492298484,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736252141
    },
    {
        "content": "<p>Ah yes, youâ€™re right, that was the compressed size. Let me try to uncompress it.</p>",
        "id": 492300998,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736253199
    },
    {
        "content": "<p>The uncompressed size was 410Mb, <em>including</em> VSCode.</p>",
        "id": 492301293,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736253324
    },
    {
        "content": "<p>If you delete all the .c files from the uncompressed cache in Lean 4, how big is it?</p>",
        "id": 492302209,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736253673
    },
    {
        "content": "<p>(this isn't something that lake will actually let you do right now, but is conceivably something it could permit in future)</p>",
        "id": 492302279,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736253708
    },
    {
        "content": "<p>I canâ€™t test right now because Iâ€™m trying to tweak imports and rebuild things.</p>",
        "id": 492302537,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736253811
    },
    {
        "content": "<p>One issue I have is I import <code>Mathlib.Topology.Instances.Real</code> which has 2030 transitive imports (1040 in Mathlib).</p>",
        "id": 492303017,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736253998
    },
    {
        "content": "<p>Looks like the c files are less than 10%:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">gitpod</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">workspace</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">master</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">du</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">d2</span>\n<span class=\"mf\">3.2</span><span class=\"n\">M</span><span class=\"w\">    </span><span class=\"bp\">./</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Cache</span>\n<span class=\"mf\">4.0</span><span class=\"n\">G</span><span class=\"w\">    </span><span class=\"bp\">./</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span>\n<span class=\"mf\">4.0</span><span class=\"n\">G</span><span class=\"w\">    </span><span class=\"bp\">./</span><span class=\"n\">lib</span>\n<span class=\"mf\">1.8</span><span class=\"n\">M</span><span class=\"w\">    </span><span class=\"bp\">./</span><span class=\"n\">ir</span><span class=\"bp\">/</span><span class=\"n\">Cache</span>\n<span class=\"mi\">372</span><span class=\"n\">M</span><span class=\"w\">    </span><span class=\"bp\">./</span><span class=\"n\">ir</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span>\n<span class=\"mi\">376</span><span class=\"n\">M</span><span class=\"w\">    </span><span class=\"bp\">./</span><span class=\"n\">ir</span>\n<span class=\"mi\">104</span><span class=\"n\">M</span><span class=\"w\">    </span><span class=\"bp\">./</span><span class=\"n\">bin</span>\n<span class=\"mf\">4.5</span><span class=\"n\">G</span><span class=\"w\">    </span><span class=\"bp\">.</span>\n</code></pre></div>",
        "id": 492303183,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736254077
    },
    {
        "content": "<p>Iâ€™ll try to live with <code>import Mathlib.Data.Real.Basic</code> and sorries.</p>",
        "id": 492303275,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736254097
    },
    {
        "content": "<p>Remember that the 1131 transitive imports in <code>Lean</code>/<code>Init</code>/<code>Std</code> are basically free (or at least, not something you can avoid distributing without a custom lean installation)</p>",
        "id": 492303338,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736254118
    },
    {
        "content": "<p>Seeing all the linter warnings from Mathlib while building a downstream lib without getting cache first is really painful.</p>",
        "id": 492309069,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736256312
    },
    {
        "content": "<p>And having</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"w\">  </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Ring</span>\n<span class=\"n\">uncaught</span><span class=\"w\"> </span><span class=\"n\">exception</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Unknown</span><span class=\"w\"> </span><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span>\n</code></pre></div>\n<p>is also painful.</p>",
        "id": 492309357,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736256416
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/channel/270676-lean4/topic/Size.20issue/near/492309069\">said</a>:</p>\n<blockquote>\n<p>Seeing all the linter warnings from Mathlib while building a downstream lib without getting cache first is really painful.</p>\n</blockquote>\n<p>Are there more warnings than the <code>docPrime</code> linter?</p>",
        "id": 492310705,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736256886
    },
    {
        "content": "<p>The docPrime linter already produces many many warnings!</p>",
        "id": 492314416,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1736258188
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110031\">@Patrick Massot</span> I'm having the same problem with my students. Have you tried gitpod (or codespace), I am thinking about just using it.</p>",
        "id": 492333336,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1736264116
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/channel/270676-lean4/topic/Size.20issue/near/492310705\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/channel/270676-lean4/topic/Size.20issue/near/492309069\">said</a>:</p>\n<blockquote>\n<p>Seeing all the linter warnings from Mathlib while building a downstream lib without getting cache first is really painful.</p>\n</blockquote>\n<p>Are there more warnings than the <code>docPrime</code> linter?</p>\n</blockquote>\n<p>It would be hard to notice another warning among the tsunami of <code>docPrime</code> warning so I cannot answer for sure.</p>",
        "id": 492357753,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736272213
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130384\">Riccardo Brasca</span> <a href=\"#narrow/channel/270676-lean4/topic/Size.20issue/near/492333336\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> I'm having the same problem with my students. Have you tried gitpod (or codespace), I am thinking about just using it.</p>\n</blockquote>\n<p>I tried gitpod or codespace for a GlimpseOfLean afternoon a couple of months ago and it was a disaster so I really want this to be only a backup solution.</p>",
        "id": 492358384,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736272449
    },
    {
        "content": "<p>How many students do you have?</p>",
        "id": 492358991,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1736272684
    },
    {
        "content": "<p>(I ask because a slightly insane solution is just to give them all flash drives with the required space available; if there aren't too many this wouldn't be terribly expensive.)</p>",
        "id": 492359148,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1736272758
    },
    {
        "content": "<p>I think the painful part would be changing the cache directory.</p>",
        "id": 492359346,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1736272821
    },
    {
        "content": "<p>I will have about 60 students.</p>",
        "id": 492359998,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736273029
    },
    {
        "content": "<p>So flash drives are not great.</p>",
        "id": 492360053,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736273043
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130384\">Riccardo Brasca</span> <a href=\"#narrow/channel/270676-lean4/topic/Size.20issue/near/492333336\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> I'm having the same problem with my students. Have you tried gitpod (or codespace), I am thinking about just using it.</p>\n</blockquote>\n<p>I was just writing about this in a private thread, so let me move it here too: I've taught with Lean on Codespaces with little trouble, <em>except</em> that you can't follow the standard GitHub Classrooms assignment model of having one repository per homework assignment. Even with GitHub Pro, there's a monthly limit on total codespace size that you'll hit if students have more than a couple active codepaces with mathlib caches. You'd need to tell students to be very aggressive about deleting old codespaces, and leave time between new assignments, and hope that students aren't using Codespaces for anything else.</p>",
        "id": 492381715,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1736281642
    },
    {
        "content": "<p>That said, if you follow the model where you have one course repo and each student forks/clones that one time, Codespaces works great.</p>",
        "id": 492382017,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1736281785
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/channel/270676-lean4/topic/Size.20issue/near/492309357\">said</a>:</p>\n<blockquote>\n<p>And having</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"w\">  </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Ring</span>\n<span class=\"n\">uncaught</span><span class=\"w\"> </span><span class=\"n\">exception</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Unknown</span><span class=\"w\"> </span><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span>\n</code></pre></div>\n<p>is also painful.</p>\n</blockquote>\n<p>Can someone explain to me what <span class=\"user-mention\" data-user-id=\"110031\">@Patrick Massot</span> means here?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">Ring</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n</code></pre></div>\n<p>seems to work for me just fine and is what is documented.</p>\n<p>Is the message a request for the module name to work as well?</p>",
        "id": 492419891,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1736300749
    },
    {
        "content": "<p>Here's a useful but hacky script:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">find</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"bp\">./.</span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">prune</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"s2\">\"*.lean\"</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">exec</span><span class=\"w\"> </span><span class=\"n\">grep</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"s2\">\"^import Mathlib</span><span class=\"err\">\\</span><span class=\"s2\">.\"</span><span class=\"w\"> </span><span class=\"o\">{}</span><span class=\"w\"> </span><span class=\"bp\">\\;</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">sed</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">s</span><span class=\"bp\">/</span><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"bp\">\\</span><span class=\"o\">(</span><span class=\"n\">Mathlib</span><span class=\"bp\">\\.</span><span class=\"o\">[</span><span class=\"bp\">^</span><span class=\"o\">[:</span><span class=\"n\">space</span><span class=\"o\">:]]</span><span class=\"bp\">*\\</span><span class=\"o\">)</span><span class=\"bp\">/\\</span><span class=\"mi\">1</span><span class=\"bp\">/'</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">sed</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">s</span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"bp\">.*$//'</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">tr</span><span class=\"w\"> </span><span class=\"bp\">'.'</span><span class=\"w\"> </span><span class=\"bp\">'/'</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">sed</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">s</span><span class=\"bp\">/^//'</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">sed</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">s</span><span class=\"bp\">/$/\\.</span><span class=\"n\">lean</span><span class=\"bp\">/'</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">tr</span><span class=\"w\"> </span><span class=\"bp\">'\\</span><span class=\"n\">n'</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">xargs</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span>\n</code></pre></div>\n<p>This looks for all <code>.lean</code> files in subdirectories (but excluding <code>.lake</code>), and find all <code>import Mathlib.X.Y.Z</code> lines, and then runs <code>lake exe cache get Mathlib/X/Y/Z.lean</code> for all of these.</p>",
        "id": 492420994,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1736301473
    },
    {
        "content": "<p>i.e. it only downloads the subset of Mathlib your current project needs.</p>",
        "id": 492421045,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1736301493
    },
    {
        "content": "<p>Any suggestions as to how we can make this more robust and/or deploy it in an easy-to-use way?</p>",
        "id": 492421066,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1736301517
    },
    {
        "content": "<p>I guess we could just expose it as <code>lake exe cache get^</code> or something?</p>",
        "id": 492421495,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1736301812
    },
    {
        "content": "<p>If we get <code>proofAsSorry</code> to work with Mathlib perhaps the cache could use that, which could potentially make it much smaller</p>",
        "id": 492444673,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1736319696
    },
    {
        "content": "<p>Thanks a lot Kim. I was misled by <a class=\"message-link\" href=\"/#narrow/channel/270676-lean4/topic/Size.20issue/near/491871243\">#lean4 &gt; Size issue @ ðŸ’¬</a> . I agree it would be great to have a robust easy thing to avoid your hack.</p>",
        "id": 492457269,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736325761
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 492462406,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736327648
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 492462616,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736327727
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/270676-lean4/topic/Size.20issue/near/492421495\">said</a>:</p>\n<blockquote>\n<p>I guess we could just expose it as <code>lake exe cache get^</code> or something?</p>\n</blockquote>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/20567\">#20567</a> implements this as <code>miniget</code>; comments (e.g. naming suggestions) welcome</p>",
        "id": 492503510,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1736342506
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/270676-lean4/topic/Size.20issue/near/492419891\">said</a>:</p>\n<blockquote>\n<p>Is the message a request for the module name to work as well?</p>\n</blockquote>\n<p>Or just for a better error message to indicate that it expects a filename</p>",
        "id": 492507604,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736343849
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/20589\">#20589</a></p>",
        "id": 492595766,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1736376348
    },
    {
        "content": "<p>It seems everyone, including CI, has been confused about the arguments of <code>lake exe cache get</code>.</p>",
        "id": 492595877,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1736376409
    },
    {
        "content": "<p>If anyone would like to modify this further, so that if <code>cache</code> can't find the path it tries again re-interpreting the argument as a module name, that would be great.</p>",
        "id": 492595920,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1736376441
    },
    {
        "content": "<p>Oh, that would explain why this CI step was always causing problems and has been enabled and disabled a few times...  <span aria-label=\"man facepalming\" class=\"emoji emoji-1f926-200d-2642\" role=\"img\" title=\"man facepalming\">:man_facepalming:</span></p>",
        "id": 492596770,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736376909
    },
    {
        "content": "<p>Speaking of codespace, is it working for you? If I try <a href=\"https://codespaces.new/leanprover-community/mathlib4\">mathlib's one</a> it is stuck at the \"setting up remote connection\" and then it says \"oh no it looks you are offline\".</p>",
        "id": 493316491,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1736764772
    },
    {
        "content": "<p>it now works, never mind</p>",
        "id": 493319237,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1736765600
    },
    {
        "content": "<p>I managed to get the compressed Lean4 Windows packages slightly less than 1.0GB. When decompressed (without unpackaging Mathlib caches) it is 3GB. After unpackaging Mathlib caches, it's 8GB.</p>",
        "id": 493323264,
        "sender_full_name": "Jz Pan",
        "timestamp": 1736766861
    },
    {
        "content": "<p>I used a modified version of scripts here <a class=\"message-link\" href=\"/#narrow/channel/113488-general/topic/trylean.20bundle.20for.20lean4/near/493321317\">#general &gt; trylean bundle for lean4 @ ðŸ’¬</a> . The key point is don't let <code>lake update</code> unpacks Mathlib cache. This could be done via an environment variable (found in build script of mathlib).</p>",
        "id": 493323537,
        "sender_full_name": "Jz Pan",
        "timestamp": 1736766958
    }
]