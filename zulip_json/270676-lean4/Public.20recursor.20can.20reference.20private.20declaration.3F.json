[
    {
        "content": "<p>Is it intended that recursors for structures with private fields should be public? This means that private decls used in the type of the private field can appear in the public type of the recursor.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">module</span>\n\n<span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">PrivBar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Bool</span>\n\n<span class=\"n\">public</span><span class=\"w\"> </span><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"n\">priv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PrivBar</span>\n\n<span class=\"c1\">-- public, but references private type `PrivBar`</span>\n<span class=\"sd\">/--</span>\n<span class=\"sd\">info: @[reducible] protected def Foo.recOn.{u} : {motive : Foo → Sort u} →</span>\n<span class=\"sd\">  (t : Foo) → ((priv : PrivBar) → motive { priv := priv }) → motive t :=</span>\n<span class=\"sd\">fun {motive} t _private.«external:file:///MathlibDemo/MathlibDemo.lean».0.Foo.mk =&gt;</span>\n<span class=\"sd\">  Foo.rec _private.«external:file:///MathlibDemo/MathlibDemo.lean».0.Foo.mk t</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">recOn</span>\n</code></pre></div>\n<p>I can imagine there might be some necessary carve-out given how fundamental recursors are to actually <em>doing</em> anything with the structure, but I was still surprised to hit an \"unknown constant\" error when looping through declarations in the environment using <code>MetaM</code> methods. Since this violated my expectations of how visibility should behave, I just thought I'd check. :)</p>",
        "id": 562586044,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1765244552
    },
    {
        "content": "<p>Still curious if I should open an issue for this, or if there's something to learn about visibility otherwise. :)</p>",
        "id": 564489576,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1766071647
    },
    {
        "content": "<p>Aha, with a slightly different search query I found <a class=\"stream-topic\" data-stream-id=\"270676\" href=\"/#narrow/channel/270676-lean4/topic/Meaning.20of.20private.20structure.20constructor.2Ffields/with/531984596\">#lean4 &gt; Meaning of private structure constructor/fields</a>, the issue <a href=\"https://github.com/leanprover/lean4/pull/8665\">lean4#8665</a>, and a relevant (not yet merged) PR <a href=\"https://github.com/leanprover/lean4/pull/9648\">lean4#9648</a>. So I suppose that covers it. :)</p>",
        "id": 564490570,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1766071872
    }
]