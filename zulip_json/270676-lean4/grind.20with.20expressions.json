[
    {
        "content": "<p>AFAIK, currently <code>grind</code> can only take constants as parameters. That is, the following won't work:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">grind</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"c1\">--^^</span>\n<span class=\"c\">/-</span><span class=\"cm\"> unexpected identifier; expected ']' -/</span>\n</code></pre></div>\n<p>However, in the definition of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Meta.Grind.EMatchTheorem#doc\">docs#Lean.Meta.Grind.EMatchTheorem</a>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">EMatchTheorem</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"sd\">/--</span>\n<span class=\"sd\">  It stores universe parameter names for universe polymorphic proofs.</span>\n<span class=\"sd\">  Recall that it is non-empty only when we elaborate an expression provided by the user.</span>\n<span class=\"sd\">  When `proof` is just a constant, we can use the universe parameter names stored in the declaration.</span>\n<span class=\"sd\">  -/</span>\n<span class=\"w\">  </span><span class=\"n\">levelParams</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Name</span>\n<span class=\"w\">  </span><span class=\"bp\">...</span>\n</code></pre></div>\n<p>... the comment on the field <code>levelParams</code> suggests that support for general expressions might be planned in the future? Is that so, or am I interpreting this comment incorrectly?</p>",
        "id": 537452029,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1756897897
    },
    {
        "content": "<p>I encountered the same limitation, but have relied on the following workaround which worked well in my use cases:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"n\">grind</span>\n</code></pre></div>\n<p>(in this case <code>grind</code> will work without the <code>have</code>, but it works in more complex examples)</p>",
        "id": 537454447,
        "sender_full_name": "Théophile",
        "timestamp": 1756898886
    },
    {
        "content": "<p>We're planning to add support for this soon, but it's not ready yet. For now <code>have</code> is the workaround.</p>",
        "id": 537573063,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1756946863
    },
    {
        "content": "<p>This has now landed in the latest nightly :) <a href=\"https://github.com/leanprover/lean4-nightly/commit/47228b94fdc9a2c008ec83987f78221053ee258c\">https://github.com/leanprover/lean4-nightly/commit/47228b94fdc9a2c008ec83987f78221053ee258c</a></p>",
        "id": 558394757,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1763634365
    }
]