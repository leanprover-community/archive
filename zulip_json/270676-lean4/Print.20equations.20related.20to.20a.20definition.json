[
    {
        "content": "<p>Here's my example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">PrintPrefix</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">myDef</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n</code></pre></div>\n<p>I'd like to see which equational lemmas Lean generates for this definition. Here's what I tried:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"kn\">prefix</span><span class=\"w\"> </span><span class=\"n\">myDef</span>\n<span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"kn\">prefix</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"n\">internals</span><span class=\"w\"> </span><span class=\"n\">myDef</span>\n<span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">eqns</span><span class=\"w\"> </span><span class=\"n\">myDef</span>\n<span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">equations</span><span class=\"w\"> </span><span class=\"n\">myDef</span>\n<span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">myDef</span>\n</code></pre></div>\n<p>but none of these told me about <code>myDef.eq_def</code>. How can I see the _full_ list of declarations with a given prefix, without things like this being hidden?</p>",
        "id": 500299381,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1739841603
    },
    {
        "content": "<p><code>whatsnew in</code> might do what you want here</p>",
        "id": 500299780,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1739841853
    },
    {
        "content": "<p>It doesn't, it just outputs a subset of the above.</p>",
        "id": 500299883,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1739841928
    },
    {
        "content": "<p>Note that <code>myDef.eq_def</code> is generated on first use, and then cached. If you don't have anything that uses <code>myDef.eq_def</code> then it doesn't exist.</p>",
        "id": 500299895,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1739841935
    },
    {
        "content": "<p>Can you explain this some more? <code>#check myDef.eq_def</code> seems to tell me it exists before I use it. Or are you saying that me typing this in is using it? Even after that check, all the above don't show me this lemma</p>",
        "id": 500300219,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1739842106
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">PrintPrefix</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">myDef</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"c1\">-- #print myDef.eq_def -- uncomment for magic</span>\n<span class=\"c1\">-- def foo := myDef.eq_def -- uncomment for magic</span>\n\n<span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"kn\">prefix</span><span class=\"w\"> </span><span class=\"n\">myDef</span>\n</code></pre></div>",
        "id": 500300317,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1739842175
    },
    {
        "content": "<p>Weirdly, <code>#check</code> has no side effect but <code>#print</code> does</p>",
        "id": 500300409,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1739842209
    },
    {
        "content": "<p><code>#check</code> erases its side effects</p>",
        "id": 500300435,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1739842227
    },
    {
        "content": "<p>In that case I'm surprised that <code>#print</code> does not</p>",
        "id": 500300459,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1739842244
    },
    {
        "content": "<p>Okay, that makes sense. But this is still pretty weird right, why do we have lemmas which behave like this: it doesn't exist until I use it, and then it does exist</p>",
        "id": 500300681,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1739842376
    },
    {
        "content": "<p>What if you have this huge function, like <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Meta.kabstract#doc\">docs#Lean.Meta.kabstract</a>, but never unfold it in a proof? Then it would be a waste to have the equational lemma.</p>",
        "id": 500300856,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1739842473
    },
    {
        "content": "<p>Hmm, okay</p>",
        "id": 500300980,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1739842560
    },
    {
        "content": "<p>One more surprise (to me): if I use <code>myDef.eq_unfold</code> and don't use <code>myDef.eq_def</code>, then Lean also generates the <code>eq_def</code> lemma. (This is documented in <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Meta.getConstUnfoldEqnFor%3F#doc\">docs#Lean.Meta.getConstUnfoldEqnFor?</a>)</p>",
        "id": 500301057,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1739842588
    },
    {
        "content": "<p>Also see <a class=\"stream-topic\" data-stream-id=\"113489\" href=\"/#narrow/channel/113489-new-members/topic/.E2.9C.94.20Can.20I.20know.20exactly.20what.20collaterals.20are.20added.20by.20commands.3F/with/493008239\">#new members &gt; ✔ Can I know exactly what collaterals are added by commands?</a></p>",
        "id": 500301717,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1739843013
    }
]