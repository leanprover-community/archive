[
    {
        "content": "<p>Is it possible to define directly parametrized notations in Lean, i.e. notations that embark a term of some type (a parameter), or do we need to declare this parameter as a variable beforehand to introduce the notation, possibly by grouping the variable declaration and the notation in some \"Notations\" section?</p>",
        "id": 506507787,
        "sender_full_name": "Anthony Bordg",
        "timestamp": 1742310657
    },
    {
        "content": "<p>What do you mean by this? Can you give an example of what you want to do?</p>",
        "id": 506510874,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1742311453
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Struc</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\"> </span><span class=\"n\">field1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">type1</span>\n<span class=\"w\">Â </span><span class=\"n\">field2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">type2</span>\n</code></pre></div>\n<p>Assume I want to introduce a notation for <code>Struct.field1</code> <strong>that depends on the name <code>t</code> of a parameter  <code>t : Struct</code></strong>. I first need to have a term <code>t</code> of type <code>Struct</code> for introducing such a notation. Can I do this on the fly as part of the notation declaration or do I need to declare a variable <code>t</code> of type <code>Struc</code> beforehand?</p>",
        "id": 506522133,
        "sender_full_name": "Anthony Bordg",
        "timestamp": 1742314136
    },
    {
        "content": "<p>Depending on your exact use case, I think it is doable to have the notation before having the <code>t : Struct</code>.</p>",
        "id": 506522598,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1742314253
    },
    {
        "content": "<p>So you mean something like this?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Struc</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">field1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"w\">  </span><span class=\"n\">field2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"s2\">\"$$$\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Struc</span><span class=\"bp\">.</span><span class=\"n\">field1</span><span class=\"w\"> </span><span class=\"n\">t</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Struc</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">field1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"n\">field2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"bp\">$$$</span><span class=\"w\"> </span><span class=\"c1\">-- 0</span>\n</code></pre></div>",
        "id": 506522752,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1742314292
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/270676-lean4/topic/parametrized.20notations/near/506522598\">said</a>:</p>\n<blockquote>\n<p>Depending on your exact use case, I think it is doable to have the notation before having the <code>t : Struct</code>.</p>\n</blockquote>\n<p>How? :)</p>",
        "id": 506548866,
        "sender_full_name": "Anthony Bordg",
        "timestamp": 1742321591
    },
    {
        "content": "<p>I think it would help if you gave a clearer example of what you want to be able to write vs what you want it to elaborate to</p>",
        "id": 506549064,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1742321643
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"372804\">Marcus Rossel</span> <a href=\"#narrow/channel/270676-lean4/topic/parametrized.20notations/near/506522752\">said</a>:</p>\n<blockquote>\n<p><code>notation t \"$$$\" =&gt; Struc.field1 t</code></p>\n</blockquote>\n<p>Here, Lean has no way to understand that <code>t</code> is expected to have type <code>Struc</code>, right? And it should be more something like <code>t.field1</code> on the right side of <code>=&gt;</code>, no?</p>",
        "id": 506549271,
        "sender_full_name": "Anthony Bordg",
        "timestamp": 1742321720
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"125073\">Anthony Bordg</span> <a href=\"#narrow/channel/270676-lean4/topic/parametrized.20notations/near/506548866\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/270676-lean4/topic/parametrized.20notations/near/506522598\">said</a>:</p>\n<blockquote>\n<p>Depending on your exact use case, I think it is doable to have the notation before having the <code>t : Struct</code>.</p>\n</blockquote>\n<p>How? :)</p>\n</blockquote>\n<p>I will point to <span class=\"user-mention\" data-user-id=\"372804\">@Marcus Rossel</span>'s solution until you demonstrate that it doesn't work for your use case.</p>",
        "id": 506549685,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1742321861
    },
    {
        "content": "<p>Will try to give more details later, but basically <code>t</code> is not an argument of Struct.field1, so I don't even see what <code>Struc.field1 t</code> would mean. Also, I realize that if one writes <code>t.Struc.field1</code> on the right side, then it may not be possible to write <code>t</code> on the left side, something I want, because then Lean would consider <code>t</code> as an unused variable.</p>",
        "id": 506551075,
        "sender_full_name": "Anthony Bordg",
        "timestamp": 1742322355
    },
    {
        "content": "<p>I'm confused... The first parameter of <code>Struct.field1</code> is a value of <code>Struct</code>, which is why Marcus's solution works. Try doing <code>#check Struct.field1</code> to see its type.</p>",
        "id": 506553338,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1742323065
    },
    {
        "content": "<p>Every structure field gets a projection function like this whose first explicit parameter is the structure itself.</p>",
        "id": 506553460,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1742323103
    },
    {
        "content": "<p>I think Anthony is looking for a type-aware version of <code>notation</code>. And I think the answer is: if you want that, you have to write your own elaborator for that specific bit of notation. But also, you don't need to do it, because the type-unaware <code>notation</code> is good enough 99% of the time.</p>",
        "id": 506633940,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1742360113
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/270676-lean4/topic/parametrized.20notations/near/506553338\">said</a>:</p>\n<blockquote>\n<p>I'm confused... The first parameter of <code>Struct.field1</code> is a value of <code>Struct</code>, which is why Marcus's solution works. Try doing <code>#check Struct.field1</code> to see its type.</p>\n</blockquote>\n<p>Marcus and you are right, and Marcus' solution solves my problem, thanks.</p>",
        "id": 506686211,
        "sender_full_name": "Anthony Bordg",
        "timestamp": 1742379423
    }
]