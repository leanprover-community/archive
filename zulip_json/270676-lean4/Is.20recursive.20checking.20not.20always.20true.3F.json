[
    {
        "content": "<p>I have a simple Inductive like the following, but it says error is in the function smaller (I have checked with #eval! but not found any error):</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">inductive</span><span class=\"w\"> </span><span class=\"n\">Nat2</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat2</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">next</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat2</span>\n<span class=\"k\">#eval</span><span class=\"w\"> </span><span class=\"n\">Nat2.next</span><span class=\"w\"> </span><span class=\"n\">Nat2.zero</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">Nat2.from_nat</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">value</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat2</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">    </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">Nat2.zero</span>\n<span class=\"w\">    </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">Nat2.next</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat2.from_nat</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">value</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">))</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">Nat2.to_nat</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">self</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">self</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">next</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">n.to_nat</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">Nat2.pre</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">self</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat2</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">self</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Nat2.zero</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">next</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">n</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">Nat2.is_zero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">self</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">self</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">next</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">false</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">Nat2.smaller</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">self</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">other</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">self.is_zero</span>\n<span class=\"w\">    </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">other.is_zero</span>\n<span class=\"w\">  </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">self.pre.smaller</span><span class=\"w\"> </span><span class=\"n\">other.pre</span>\n\n<span class=\"k\">#eval</span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat2.from_nat</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">smaller</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat2.from_nat</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 535130787,
        "sender_full_name": "luong doan",
        "timestamp": 1755610578
    },
    {
        "content": "<p>nothing is \"simple\" when you've deviated from the standard matching patterns</p>",
        "id": 535131663,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755610838
    },
    {
        "content": "<p>in this case, Lean doesn't know that <code>self.pre</code> is smaller than <code>self</code></p>",
        "id": 535131708,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755610852
    },
    {
        "content": "<p>you should use addition building up instead of subtraction building down, at least that's the general philosophy with lean</p>",
        "id": 535131806,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755610879
    },
    {
        "content": "<p>Oh, thank you for helping me figure it out. I will reread the docs.</p>",
        "id": 535132322,
        "sender_full_name": "luong doan",
        "timestamp": 1755611013
    },
    {
        "content": "<p>For defining recursive functions, you're generally going to get better results matching on the constructors directly when you can:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Nat2</span><span class=\"bp\">.</span><span class=\"n\">smaller</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">self</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">other</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">self</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">other</span><span class=\"bp\">.</span><span class=\"n\">is_zero</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">next</span><span class=\"w\"> </span><span class=\"n\">self'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">self'</span><span class=\"bp\">.</span><span class=\"n\">smaller</span><span class=\"w\"> </span><span class=\"n\">other</span><span class=\"bp\">.</span><span class=\"n\">pre</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval!</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat2</span><span class=\"bp\">.</span><span class=\"n\">from_nat</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">smaller</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat2</span><span class=\"bp\">.</span><span class=\"n\">from_nat</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 535132483,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1755611048
    },
    {
        "content": "<p>I mean, you already did it in the three functions above, so it seems like you already know how to do it</p>",
        "id": 535132850,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755611132
    },
    {
        "content": "<p>Yeah, I know the basics, but I didn't know why it error</p>",
        "id": 535133270,
        "sender_full_name": "luong doan",
        "timestamp": 1755611235
    },
    {
        "content": "<p>Anyway, thanks again for your help, guys</p>",
        "id": 535133648,
        "sender_full_name": "luong doan",
        "timestamp": 1755611334
    }
]