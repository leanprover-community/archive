[
    {
        "content": "<p>Is this expected to work?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">extern</span><span class=\"w\"> </span><span class=\"s2\">\"l_Int_div___boxed\"</span><span class=\"kd\">]</span>\n<span class=\"kn\">opaque</span><span class=\"w\"> </span><span class=\"n\">call_int_div</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Int</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">call_int_div</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n</code></pre></div>\n<p>It seems to crash the server for me.</p>",
        "id": 448723137,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1719963876
    },
    {
        "content": "<p>(<a href=\"https://en.wikipedia.org/wiki/XY_problem\">#xy</a>: can I inspect from within Lean whether a name <code> `foo </code> has a native implementation available?)</p>",
        "id": 448723327,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1719963941
    },
    {
        "content": "<p>If by native you mean any native code associated then no not currently but if we were to make this function part of our API: <a href=\"https://github.com/leanprover/lean4/blob/master/src/library/compiler/ir_interpreter.cpp#L298\">https://github.com/leanprover/lean4/blob/master/src/library/compiler/ir_interpreter.cpp#L298</a> then yes.</p>\n<p>If you mean extern, yes that's easy its just an attribute</p>",
        "id": 448770465,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1719989476
    },
    {
        "content": "<p>I mean the former</p>",
        "id": 448792215,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1719996831
    },
    {
        "content": "<p>Do you have a feeling for why my example above doesn't work?</p>",
        "id": 448796662,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1719998226
    },
    {
        "content": "<p>I think this is because the relevant function is not marked <code>LEAN_EXPORT</code>, because they used to be and this was busting the DLL exported symbols budget on windows</p>",
        "id": 448798628,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1719998784
    },
    {
        "content": "<p>If I <code>objdump -T</code> my lean binary on linux, I see the symbol is there</p>",
        "id": 448800642,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1719999255
    },
    {
        "content": "<p>I guess I'll attach lldb and see what's going on</p>",
        "id": 448804048,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1720000068
    },
    {
        "content": "<p><code>@[extern]</code> definitions are not direct calls of the specified symbol. Instead, the symbol is wrapped within another C definition produced by the Lean compiler. That wrapper is the native symbol invoked by the interpreter. Thus, an <code>@[extern]</code> can never be evaluated in the module in which it is declared (as the native symbol for the wrapper will not have been compiled yet). Even in core, such native symbols are drawn from the previous stage, not the one currently being compiled.</p>",
        "id": 449005302,
        "sender_full_name": "Mac Malone",
        "timestamp": 1720071214
    }
]