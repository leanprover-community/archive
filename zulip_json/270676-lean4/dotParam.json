[
    {
        "content": "<p>RFC: <a href=\"https://github.com/leanprover/lean4/pull/6489\">lean4#6489</a></p>\n<p>This RFC is trying to address being able to write generic API that we can <code>export</code> into other namespaces and use via dot notation. There are a few solutions in the design space, and this RFC is suggesting a <code>dotParam</code> widget (like `optParam, etc.). Comments welcome!</p>",
        "id": 491440998,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1735678278
    },
    {
        "content": "<p>i seem to recall a similar RFC (<a href=\"https://github.com/leanprover/lean4/pull/5482\">lean4#5482</a>) proposing to have this/similar behaviour linked to parameters named <code>self</code>... how does this compare?</p>",
        "id": 491445403,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1735682127
    },
    {
        "content": "<p>The downside of <code>self</code> is that this puts pressure on libraries to name arguments <code>self</code> rather than a better-named argument. (That's the summary of the thread referenced by <a href=\"https://github.com/leanprover/lean4/issues/1629#issuecomment-1253015236\">this comment</a>.)</p>",
        "id": 491445544,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1735682279
    },
    {
        "content": "<p>I worry this would interact badly with <code>alias Foo.ofBar := Bar.toFoo</code>, as here the argument marked as <code>dotParam</code> on the RHS should not necessarily be inherited by the LHS</p>",
        "id": 491462480,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1735698958
    },
    {
        "content": "<p>Maybe this isn't prevalent enough to actually matter though</p>",
        "id": 491462538,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1735698983
    },
    {
        "content": "<p>It'd be good to find a concrete example where this would be an issue. Note that the Batteries <code>alias</code> command does not create aliases in the <code>export</code> sense — it creates a new declaration. Possibly <code>alias</code> could be modified to have an option to strip <code>dotParam</code> before it makes such an \"alias\".</p>",
        "id": 491511858,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1735748839
    },
    {
        "content": "<p>I also have another alternative design to this RFC than <code>dotParam</code>, but it's a bit more complicated, and it's not clear it's implementable within the current dot notation resolution framework.</p>\n<p>The rule for resolving dot notation could be modified to the following: Suppose we have <code>x.f</code> with <code>x : S</code>. Resolve the name <code>S.f</code> to get the name <code>N.g</code>. Look for the first parameter of <code>N.g</code> whose type <code>T</code> is of the form <code>N ..</code>. If <code>N</code> is a class and <code>x</code> is not an instance of <code>N</code>, then if <code>T</code> is of the form <code>T .. A ..</code> with <code>A</code> the first type argument, we look instead for an argument of type <code>A</code>.</p>",
        "id": 491512320,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1735749276
    },
    {
        "content": "<p>Benefit: this seems to handle many practical uses of <code>dotParam</code>, without needing to write <code>dotParam</code>.</p>\n<p>Drawback: it's less-flexible, and the rule is somewhat complicated to explain.</p>",
        "id": 491512491,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1735749444
    },
    {
        "content": "<p>Would another option be <code>@[dotParam param_name]</code>?</p>",
        "id": 491517213,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1735753926
    },
    {
        "content": "<p>A downside to a <code>dotParam</code> attribute is that you wouldn't be able to control dot notation with <code>CoeFun</code>. One of the use cases of the <code>dotParam</code> widget is that you can use <code>dotParam</code> in a <code>CoeFun</code> instance to specify which argument gets used.</p>",
        "id": 491517275,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1735754007
    },
    {
        "content": "<p>(Apologies, I searched for <code>@[</code> in the rfc, but missed the word \"attribute\")</p>",
        "id": 491517690,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1735754421
    },
    {
        "content": "<p>Can you elaborate on how <code>dotParam</code> would be used with a <code>CoeFun</code> instance, with a code sample?</p>",
        "id": 491517699,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1735754431
    },
    {
        "content": "<p>I was imagining something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">priority</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">100</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">hasCoeToFun</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CoeFun</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">dotParam</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">coe</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">DFunLike</span><span class=\"bp\">.</span><span class=\"n\">coe</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n</code></pre></div>\n<p>(or rather to put the <code>dotParam</code> into the type of <code>DFunLike.coe</code>, since coercions get unfolded)</p>",
        "id": 491539698,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1735776908
    }
]