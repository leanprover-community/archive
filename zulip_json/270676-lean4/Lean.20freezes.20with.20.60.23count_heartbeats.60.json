[
    {
        "content": "<p>Can someone (on any operating system) test the following steps:</p>\n<ol>\n<li>Create a new file in Mathlib with the following contents, and wait for it to compile</li>\n</ol>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">}</span>\n\n<span class=\"c1\">-- slowly type the following line below this comment</span>\n<span class=\"c1\">-- attribute [-instance] Subsingleton.to_noZeroDivisors</span>\n\n\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">Free</span><span class=\"bp\">.</span><span class=\"n\">of_subsingleton'</span>\n\n<span class=\"bp\">#</span><span class=\"n\">count_heartbeats</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Grind</span><span class=\"bp\">.</span><span class=\"n\">NoNatZeroDivisors</span><span class=\"w\"> </span><span class=\"n\">K</span>\n</code></pre></div>\n<ol start=\"2\">\n<li>Below the comment, slowly type <code>attribute [-instance] Subsingleton.to_noZeroDivisors</code></li>\n<li>Wait for 1+ minutes</li>\n</ol>\n<p>In this case, my Lean file becomes unresponsive (the yellow bars never disappear), and will not respond until <code>Restart File</code>/<code>Restart Server</code> or something similar is triggered</p>\n<p>(tested on both Windows and Debian)</p>\n<p>(<code>#count_heartbeats</code> is a Mathlib command, but I'm not sure if it itself it the culprit or just exposes something in Core)</p>",
        "id": 530596747,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1753372953
    },
    {
        "content": "<p>I can reproduce (Debian bookworm, on mathlib master). Typed <code>attribute [-instance]</code> (the last word at normal typing speed), then deleted letters until <code>attribute [-ins</code>, and now Lean is freezing beautifully.</p>",
        "id": 530615472,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1753379042
    },
    {
        "content": "<p>Commenting out the <code>#count_heartbeats</code> makes the issue disappear on my end.</p>",
        "id": 530615898,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1753379196
    },
    {
        "content": "<p>I can also reproduce this (on macOS). Oddly though, if I type very slowly, it doesn't freeze: </p>\n<p><a href=\"/user_uploads/3121/J3Il3M5M5Smv4AgdPlBI_cln/Screen-Recording.mp4\">No Freeze</a></p>\n<div class=\"message_inline_image message_inline_video\"><a href=\"/user_uploads/3121/J3Il3M5M5Smv4AgdPlBI_cln/Screen-Recording.mp4\" title=\"No Freeze\"><video preload=\"metadata\" src=\"/user_uploads/3121/J3Il3M5M5Smv4AgdPlBI_cln/Screen-Recording.mp4\"></video></a></div><p>It seems waiting for the suggestions to roll in at <code>attribute [-ins</code> avoids the freeze.</p>",
        "id": 530621832,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1753381342
    }
]