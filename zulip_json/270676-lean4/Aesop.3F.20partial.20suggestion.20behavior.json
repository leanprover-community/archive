[
    {
        "content": "<p>Aesop's <a href=\"https://zenodo.org/records/7430233\">specification</a> says that if Aesop fails to fully prove a goal, it reports the safe goals, i.e., the goals obtained by just applying Aesop's normalization and safe rules. Likewise, the suggestion given by <code>aesop?</code> on a goal that Aesop cannot fully prove is exactly the tactic script corresponding to the application of these normalization and safe rules. This makes sense and is ultimately, not a problem.</p>\n<p>However, there are some circumstances where it seems Aesop could make a bit more progress, even when it can't fully close the original goal. Consider the following pair of examples:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">hp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">hq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">q</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"c1\">-- `aesop? (add unsafe hp) (add unsafe hq)` succeeds and suggests the following proof:</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Iff</span><span class=\"bp\">.</span><span class=\"n\">intro</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">hq</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">hp</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"c1\">-- `aesop? (add unsafe hp)` fails and suggests the following proof:</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Iff</span><span class=\"bp\">.</span><span class=\"n\">intro</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>In the second example, even though Aesop could close the second sorry with <code>apply hp</code> (as it finds in the first example), it doesn't because <code>hp</code> is registered as an unsafe rule.</p>\n<p>How difficult would it be to change <code>aesop?</code>'s behavior so that if an unsafe rule closes a <code>Prop</code>-typed goal and does not generate any new goals, it is included in the final <code>aesop?</code> recommendation (despite not being a \"safe\" rule application). My intuition is that this would still preserve provability (as only applying safe rules does) and it would yield strictly more complete suggestions, but I don't know how difficult this would be to implement or whether there are issues I'm failing to consider.</p>",
        "id": 517909135,
        "sender_full_name": "Josh Clune",
        "timestamp": 1747165142
    },
    {
        "content": "<p>This is a great suggestion; your behaviour is clearly better than what's currently implemented. It's not entirely trivial to implement, but shouldn't be too hard, either. Do you need it soon?</p>\n<p><a href=\"https://github.com/leanprover-community/aesop/pull/221\">aesop#221</a></p>",
        "id": 518911299,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1747565493
    },
    {
        "content": "<p>The current behavior isn’t blocking for me, so there’s no urgency on this. Thanks for making an issue, I’m sure I’ll find this helpful whenever it gets implemented.</p>",
        "id": 518925724,
        "sender_full_name": "Josh Clune",
        "timestamp": 1747577559
    }
]