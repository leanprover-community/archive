[
    {
        "content": "<p>A student of mine is currently struggling with induction over mutually inductive predicates (in <code>Prop</code>) because</p>\n<ul>\n<li><code>induction</code> doesn't support mutual inductive types;</li>\n<li>mutual recursion is implemented via well-founded recursion, but inductive predicates don't have (and can't have) a useful <code>SizeOf</code> instance.</li>\n</ul>\n<p>As far as I can tell, he has the following options, none of which are particularly pleasing:</p>\n<ul>\n<li>Recurse over the data rather than the predicates.</li>\n<li>Put the predicates into <code>Type</code>.</li>\n<li>Use the recursor directly.</li>\n<li>Give up on mutual types and define the union of the predicates as a single inductive predicate, essentially doing the elaborator's job by hand.</li>\n</ul>\n<p>Is there a more idiomatic way?</p>",
        "id": 402060061,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1699992219
    },
    {
        "content": "<p>Nope, this is currently not really supported. The best option for now is just using the recursor directly</p>",
        "id": 402166538,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1700034547
    },
    {
        "content": "<p>Probably using an inductive family is the path of least resistance</p>",
        "id": 402166661,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1700034601
    },
    {
        "content": "<p>Okay, thanks!</p>",
        "id": 402193431,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1700042949
    },
    {
        "content": "<p>You can use a mutual block of two definitions to consume the mutually inductive type. Then you wonâ€™t use the induction tactic, but simply obtain the IH by invoking the other definition recursively. It actually works quite nice.</p>",
        "id": 424023451,
        "sender_full_name": "Max Nowak ğŸ‰",
        "timestamp": 1709214837
    },
    {
        "content": "<p>I think back when I made this thread, your suggestion didn't work for <code>Prop</code>-valued(!) inductive types because mutual rec went via wfrec, which went via <code>SizeOf</code> and <code>Prop</code>-valued types can't have a useful <code>SizeOf</code> instance. Maybe that has changed in the meantime.</p>",
        "id": 424032167,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1709217306
    },
    {
        "content": "<p>I noticed that there's structural mutual recursion now: <a href=\"https://github.com/leanprover/lean4/pull/4575\">https://github.com/leanprover/lean4/pull/4575</a><br>\nIs there some way of doing mutual induction over inductive predicates with this instead of encoding a mutual predicate as a single inductive family? I've run into an error saying my mutual inductive type</p>\n<blockquote>\n<p>does not have a <code>.brecOn</code> recursor</p>\n</blockquote>\n<p>and I'm not sure if there's a trick I'm missing or if indexed predicates are inherently different from propositions</p>",
        "id": 486707305,
        "sender_full_name": "Jonathan Chan",
        "timestamp": 1733607956
    },
    {
        "content": "<p>Afaik using induction on mutual inductives should be possible... Can you post a <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a>?</p>",
        "id": 486712282,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1733612211
    },
    {
        "content": "<p>okay not so minimal but this is demonstrating the kind of proof I'm trying to do, I'm mechanizing typing judgements and proving syntactic properties:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">autoImplicit</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">pp</span><span class=\"bp\">.</span><span class=\"n\">fieldNotation</span><span class=\"w\"> </span><span class=\"n\">false</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Term</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">ğ’°</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Term</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Term</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Ctxt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">nil</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ctxt</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ctxt</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Term</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Ctxt</span>\n<span class=\"kn\">notation</span><span class=\"o\">:</span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"s2\">\"â¬\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Ctxt</span><span class=\"bp\">.</span><span class=\"n\">nil</span>\n<span class=\"kn\">infixl</span><span class=\"o\">:</span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"s2\">\"âˆ·\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Ctxt</span><span class=\"bp\">.</span><span class=\"n\">cons</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Eqv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Term</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Term</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Eqv</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">â†’</span>\n<span class=\"w\">    </span><span class=\"n\">Eqv</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">â†’</span>\n<span class=\"w\">    </span><span class=\"c1\">---------</span>\n<span class=\"w\">    </span><span class=\"n\">Eqv</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">c</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">ğ’°</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">â†’</span>\n<span class=\"w\">    </span><span class=\"c1\">----------------</span>\n<span class=\"w\">    </span><span class=\"n\">Eqv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ’°</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ’°</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"kn\">infix</span><span class=\"o\">:</span><span class=\"mi\">40</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">priority</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1001</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"â‰ˆ\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Eqv</span>\n\n<span class=\"kn\">mutual</span>\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Wf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ctxt</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">nil</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Wf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">â¬</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î“</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Wf</span><span class=\"w\"> </span><span class=\"n\">Î“</span><span class=\"w\"> </span><span class=\"bp\">â†’</span>\n<span class=\"w\">    </span><span class=\"n\">Wt</span><span class=\"w\"> </span><span class=\"n\">Î“</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ’°</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â†’</span>\n<span class=\"w\">    </span><span class=\"c1\">--------------</span>\n<span class=\"w\">    </span><span class=\"n\">Wf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Î“</span><span class=\"w\"> </span><span class=\"bp\">âˆ·</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Wt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ctxt</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Term</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Term</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">ğ’°</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î“</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">â†’</span>\n<span class=\"w\">    </span><span class=\"c1\">-----------------</span>\n<span class=\"w\">    </span><span class=\"n\">Wt</span><span class=\"w\"> </span><span class=\"n\">Î“</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ’°</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ’°</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">conv</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î“</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">â‰ˆ</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">â†’</span>\n<span class=\"w\">    </span><span class=\"n\">Wt</span><span class=\"w\"> </span><span class=\"n\">Î“</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">â†’</span>\n<span class=\"w\">    </span><span class=\"n\">Wt</span><span class=\"w\"> </span><span class=\"n\">Î“</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ’°</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â†’</span>\n<span class=\"w\">    </span><span class=\"c1\">--------------</span>\n<span class=\"w\">    </span><span class=\"n\">Wt</span><span class=\"w\"> </span><span class=\"n\">Î“</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">B</span>\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">notation</span><span class=\"o\">:</span><span class=\"mi\">40</span><span class=\"w\"> </span><span class=\"s2\">\"âŠ¢\"</span><span class=\"w\"> </span><span class=\"n\">Î“</span><span class=\"o\">:</span><span class=\"mi\">40</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Wf</span><span class=\"w\"> </span><span class=\"n\">Î“</span>\n<span class=\"kn\">notation</span><span class=\"o\">:</span><span class=\"mi\">40</span><span class=\"w\"> </span><span class=\"n\">Î“</span><span class=\"o\">:</span><span class=\"mi\">41</span><span class=\"w\"> </span><span class=\"s2\">\"âŠ¢\"</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">:</span><span class=\"mi\">41</span><span class=\"w\"> </span><span class=\"s2\">\"âˆ¶\"</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">:</span><span class=\"mi\">41</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Wt</span><span class=\"w\"> </span><span class=\"n\">Î“</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">A</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">wtğ’°Inv</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î“</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">ğ’°'</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î“</span><span class=\"w\"> </span><span class=\"bp\">âŠ¢</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">âˆ¶</span><span class=\"w\"> </span><span class=\"n\">ğ’°'</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">ğ’°</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"bp\">âˆƒ</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ğ’°</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">â‰ˆ</span><span class=\"w\"> </span><span class=\"n\">ğ’°'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">subst</span><span class=\"w\"> </span><span class=\"n\">e</span>\n<span class=\"w\">  </span><span class=\"c1\">-- induction h</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span><span class=\"cm\"> 'induction' tactic does not support mutually inductive types,</span>\n<span class=\"cm\">     the eliminator 'Wt.rec' has multiple motives -/</span>\n<span class=\"w\">  </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">ğ’°</span><span class=\"w\"> </span><span class=\"n\">lt</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Eqv</span><span class=\"bp\">.</span><span class=\"n\">ğ’°</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"bp\">âŸ©</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">conv</span><span class=\"w\"> </span><span class=\"n\">eâ‚</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">eâ‚‚</span><span class=\"bp\">âŸ©</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">wtğ’°Inv</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Eqv</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"n\">eâ‚‚</span><span class=\"w\"> </span><span class=\"n\">eâ‚</span><span class=\"bp\">âŸ©</span>\n<span class=\"w\">  </span><span class=\"n\">termination_by</span><span class=\"w\"> </span><span class=\"n\">structural</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span><span class=\"cm\"> failed to infer structural recursion:</span>\n<span class=\"cm\">     Cannot use parameter h:</span>\n<span class=\"cm\">       unknown constant 'Wt.brecOn' -/</span>\n</code></pre></div>",
        "id": 487290545,
        "sender_full_name": "Jonathan Chan",
        "timestamp": 1733847398
    },
    {
        "content": "<p>Induction on mutually defined predicates (in <code>Prop</code>) still seems to be effectively unsupported. A student of mine is currently struggling with this. The best solution we came up with is to manually define an induction principle for all the mutual types together, using the induction principles for each individual type that Lean generates. But it's a big pain.</p>",
        "id": 487293709,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1733848246
    },
    {
        "content": "<p>I have done <code>mutual theorem</code> (or <code>mutual def</code>) before and it works just fine. That is what the induction tactic does under the hood anyway, right? The induction hypothesis is just the result obtained via a recursive call.</p>",
        "id": 487296213,
        "sender_full_name": "Max Nowak ğŸ‰",
        "timestamp": 1733848893
    },
    {
        "content": "<p>Yeah, my current solution is also to manually define the induction principles I need for the mutual predicate that I've encoded as a single predicate</p>",
        "id": 487312606,
        "sender_full_name": "Jonathan Chan",
        "timestamp": 1733853984
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"416280\">Max Nowak ğŸ‰</span> <a href=\"#narrow/channel/270676-lean4/topic/Induction.20over.20mutually.20inductive.20predicates/near/487296213\">said</a>:</p>\n<blockquote>\n<p>I have done <code>mutual theorem</code> (or <code>mutual def</code>) before and it works just fine. That is what the induction tactic does under the hood anyway, right? The induction hypothesis is just the result obtained via a recursive call.</p>\n</blockquote>\n<p>This does seem to work. I might have to apologise to my student. It seems to do recursion on the mutual types over which the mutual predicates are presumably defined, so no rule induction. But this is probably fine for most use cases.</p>",
        "id": 487313227,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1733854206
    },
    {
        "content": "<p>A toy example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">mutual</span>\n<span class=\"w\">  </span><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">base</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">good</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">A</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">evil</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">A</span>\n\n<span class=\"w\">  </span><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">good</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">B</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">evil</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">B</span>\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">mutual</span>\n<span class=\"w\">  </span><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">AGood</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">base</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AGood</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">base</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">good</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BGood</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">AGood</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">good</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"w\">  </span><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">BGood</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">good</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AGood</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">BGood</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">good</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span>\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">mutual</span>\n<span class=\"w\">  </span><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">AEvil</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">here</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AEvil</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">evil</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">there</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BEvil</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">AEvil</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">good</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"w\">  </span><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">BEvil</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">here</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BEvil</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">evil</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">there</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AEvil</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">BEvil</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">good</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span>\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">mutual</span>\n<span class=\"w\">  </span><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">AGood_not_AEvil</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AGood</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"bp\">Â¬</span><span class=\"w\"> </span><span class=\"n\">AEvil</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">contra</span>\n<span class=\"w\">    </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">base</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">contra</span>\n<span class=\"w\">    </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">good</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">contra</span>\n<span class=\"w\">      </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">BGood_not_BEvil</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">assumption</span>\n\n<span class=\"w\">  </span><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">BGood_not_BEvil</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BGood</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"bp\">Â¬</span><span class=\"w\"> </span><span class=\"n\">BEvil</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">contra</span>\n<span class=\"w\">    </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">contra</span>\n<span class=\"w\">    </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">there</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">AGood_not_AEvil</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">assumption</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 487313287,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1733854233
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"416280\">@Max Nowak ğŸ‰</span>!</p>",
        "id": 487313954,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1733854484
    },
    {
        "content": "<p>you can also explicitly invoke <code>.rec</code>, which i think should work too</p>",
        "id": 487334070,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1733861928
    },
    {
        "content": "<p>Yes, that also works. But the recursors that Lean generates have a bit of an awkward shape (they ask you to prove one property per mutual type,  but then conclude only the property for one of the types). So if you want to go down that route, it's better to first define a more natural recursor/induction principle.</p>",
        "id": 487338155,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1733863610
    }
]