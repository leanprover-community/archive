[
    {
        "content": "<p>I'm missing an inductive hypothesis when trying to use induction on a constructor that has a different type for the recusion. Here's an MWE:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Foo</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">base</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">reccase</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Foo</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">natcase</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Foo</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">decFoo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Foo</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">base</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">base</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">reccase</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">f</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">natcase</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">base</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">natcase</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">natcase</span><span class=\"w\"> </span><span class=\"n\">n</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">decFoo_decrease</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">sizeOf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">decFoo</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">sizeOf</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"c1\">--&lt;;&gt; simp [decFoo]</span>\n<span class=\"w\"> </span><span class=\"c\">/-</span>\n<span class=\"cm\"> 3 goals</span>\n<span class=\"cm\">case base</span>\n<span class=\"cm\">⊢ sizeOf (decFoo Foo.base) ≤ sizeOf Foo.base</span>\n<span class=\"cm\">case reccase</span>\n<span class=\"cm\">a✝ : Foo</span>\n<span class=\"cm\">a_ih✝ : sizeOf (decFoo a✝) ≤ sizeOf a✝</span>\n<span class=\"cm\">⊢ sizeOf (decFoo a✝.reccase) ≤ sizeOf a✝.reccase</span>\n<span class=\"cm\">case natcase</span>\n<span class=\"cm\">a✝ : Nat</span>\n<span class=\"cm\">⊢ sizeOf (decFoo (Foo.natcase a✝)) ≤ sizeOf (Foo.natcase a✝)</span>\n<span class=\"cm\"> -/</span>\n</code></pre></div>\n<p>On the regular recursive case <code>.reccase</code> we get the induction hypothesis <code>a_ih✝ : sizeOf (decFoo a✝) ≤ sizeOf a✝</code>, but on the other recursive case that uses another inductive type (<code>Nat</code> in this case), it's missing. If I look at the recursor, it's there though:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">rec</span>\n<span class=\"c\">/-</span>\n<span class=\"cm\">Foo.rec.{u} {motive : Foo → Sort u}</span>\n<span class=\"cm\">(base : motive Foo.base)</span>\n<span class=\"cm\">(reccase : (a : Foo) → motive a → motive a.reccase)</span>\n<span class=\"cm\">(natcase : (a : Nat) → motive (Foo.natcase a))</span>\n<span class=\"cm\">(t : Foo) : motive t</span>\n<span class=\"cm\">-/</span>\n</code></pre></div>\n<p>Is that a bug/missing feature in the <code>induction</code> tactic? (Maybe <span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span> is the person to ask here?)</p>",
        "id": 462099051,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1723551783
    },
    {
        "content": "<p>The recursor is not giving you an IH here?</p>",
        "id": 462099957,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1723552045
    },
    {
        "content": "<p>There is also no induction to be done in that case, <code>natcase</code> only contains a <code>Nat</code>, your induction goes over a <code>Foo</code>.</p>",
        "id": 462100066,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1723552069
    },
    {
        "content": "<p>hm, you're right <span class=\"user-mention\" data-user-id=\"395550\">@Henrik Böving</span> maybe this was too minimal, I have to think a bit more about why it's not working in my actual case</p>",
        "id": 462100503,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1723552153
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">decFoo_decrease</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">sizeOf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">decFoo</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">sizeOf</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">base</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">decFoo</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">reccase</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">decFoo</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">natcase</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">decFoo</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">decFoo</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 462100587,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1723552168
    },
    {
        "content": "<p>yep, that was quite silly! My actual case was just a more complicated version of the same. I needed to do an induction in the other type, but the reasoning from <span class=\"user-mention\" data-user-id=\"395550\">@Henrik Böving</span> still applied. Thanks!</p>",
        "id": 462106386,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1723553517
    },
    {
        "content": "<p>Note that you can also use functional induction here (don't know if that applies to your real world problem)</p>",
        "id": 462106546,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1723553552
    },
    {
        "content": "<p>(functional induction works better in my actual use case too, thanks!)</p>",
        "id": 462131730,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1723559608
    },
    {
        "content": "<p>wanted to write it up for the MWE for completeness here, but interestingly I can't get it to work <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span> </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Foo</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">base</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">reccase</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Foo</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">natcase</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Foo</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">decFoo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Foo</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">base</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">base</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">reccase</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">f</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">natcase</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">base</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">natcase</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">natcase</span><span class=\"w\"> </span><span class=\"n\">n</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">decFoo</span><span class=\"w\"> </span><span class=\"c1\">-- decFoo : Foo → Foo</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">decFoo</span><span class=\"bp\">.</span><span class=\"n\">induct</span><span class=\"w\"> </span><span class=\"c1\">-- unknown constant 'decFoo.induct'</span>\n</code></pre></div>",
        "id": 462132894,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1723560005
    },
    {
        "content": "<p>You only get functional induction for recursive functions (at the moment, at least), so it’s not applicable to your proof. But it is also an <code>induction</code> that you don't need induction, merely <code>case</code></p>",
        "id": 462136009,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1723560798
    },
    {
        "content": "<p>Or even just</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">decFoo_decrease</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">sizeOf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">decFoo</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">sizeOf</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">decFoo</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">split</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n</code></pre></div>",
        "id": 462136150,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1723560843
    },
    {
        "content": "<p>makes sense, thanks! (FWIW, in the non-minimal case it is recursive and functional induction worked like a charm)</p>",
        "id": 462136604,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1723560980
    },
    {
        "content": "<p>Ah, the danger of mwe-ification. Glad to hear it works for you!</p>",
        "id": 462136867,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1723561068
    }
]