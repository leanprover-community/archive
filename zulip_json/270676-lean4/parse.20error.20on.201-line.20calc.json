[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">  </span><span class=\"n\">constructor</span>\n<span class=\"w\">  </span><span class=\"k\">calc</span>\n<span class=\"w\">    </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">    </span><span class=\"c1\">-- _ ≤ m := by sorry</span>\n<span class=\"w\">  </span><span class=\"n\">trivial</span><span class=\"w\"> </span><span class=\"c1\">-- error \"unexpected end of input; expected ':='\"</span>\n<span class=\"c1\">-- error disappears with line 5 uncommented</span>\n</code></pre></div>",
        "id": 512241323,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1744700495
    },
    {
        "content": "<p><code>calc</code> is a tactic that works with transitive relations, and in particular uses transitive laws to connect each line. If you only put one relation (e.g. <code>n ≤ m := by sorry</code>), calc has no way to use transitive laws. That's why it expects at least two lines.</p>",
        "id": 512242133,
        "sender_full_name": "Sabbir Rahman",
        "timestamp": 1744700775
    },
    {
        "content": "<p>This error already exists on v4.18 (also on v4.19-rc3), but I think this used to work at some point.</p>",
        "id": 512242145,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1744700779
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"484770\">Sabbir Rahman</span> <a href=\"#narrow/channel/270676-lean4/topic/parse.20error.20on.201-line.20calc/near/512242133\">said</a>:</p>\n<blockquote>\n<p><code>calc</code> is a tactic that works with transitive relations, and in particular uses transitive laws to connect each line. If you only put one relation (e.g. <code>n ≤ m := by sorry</code>), calc has no way to use transitive laws. That's why it expects at least two lines.</p>\n</blockquote>\n<p>Even if you think this is bad style, it certainly shouldn't give a parse error. Especially not one that can parse <em>many</em> subsequent tactics before raising an error. <br>\nAlso, the following works, so I'd assume this falls \"in the spec\" of calc.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">calc</span>\n<span class=\"w\">    </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 512242424,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1744700874
    },
    {
        "content": "<p>one-line calcs are very dangerous things because of these parse issues. I strongly encourage students away from them.</p>",
        "id": 512243402,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744701191
    },
    {
        "content": "<p>Oh, this behavior already exists for longer? Was this introduced to make the indentation of <code>calc</code> more flexible? I'm in favor of that, but I put the line at \"if you return to the same column as the <code>calc</code> tactic, then that ends the <code>calc</code>-tactic.</p>\n<p>I guess I should make an RFC for this.</p>",
        "id": 512244553,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1744701607
    },
    {
        "content": "<p>What I tell the students right now is \"one-line calcs are never useful in practice so always avoid them\"</p>",
        "id": 512244747,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744701682
    },
    {
        "content": "<p>This issue with calc is definitely known for some time</p>",
        "id": 512253200,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1744704066
    },
    {
        "content": "<p>I have thought of a way to fix this, but I have not tested it yet.</p>",
        "id": 512291837,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1744715663
    }
]