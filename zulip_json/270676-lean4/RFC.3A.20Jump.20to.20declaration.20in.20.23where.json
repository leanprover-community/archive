[
    {
        "content": "<p>I often find myself searching for the place where a specific typeclass assumption has been declared in a large file. This is time-consuming and I was hoping <code>#where</code> would help, but <code>#where</code> only ever tells you what's declared at a specific point in the file, rather than <em>where</em> it was declared. Would it be possible to make the log info printed by <code>#where</code> clickable, so that each part of it gives the place where the syntax was declared?</p>",
        "id": 545746193,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1760783602
    },
    {
        "content": "<p>As in, jump to the <code>variable</code> line?</p>",
        "id": 545746718,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1760784199
    },
    {
        "content": "<p>... or the <code>set_option ...</code> or the <code>noncomputable section</code> or ...</p>",
        "id": 545746913,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1760784401
    },
    {
        "content": "<p>I don't really know how to get the \"jump to definition\" part, but for <code>variable</code>s, the position information is stored in the scope, so you can at least make them \"visible\":</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Command</span>\n\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"#where!\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getScope</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">vars</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">varDecls</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">fm</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getFileMap</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">mut</span><span class=\"w\"> </span><span class=\"n\">msg</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[]</span>\n<span class=\"w\">  </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">vars</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">pos</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">fm</span><span class=\"bp\">.</span><span class=\"n\">toPosition</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"bp\">.</span><span class=\"n\">raw</span><span class=\"bp\">.</span><span class=\"n\">getPos?</span><span class=\"bp\">.</span><span class=\"n\">getD</span><span class=\"w\"> </span><span class=\"n\">default</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">msg</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">msg</span><span class=\"bp\">.</span><span class=\"n\">push</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"Line {pos.line}, column {pos.column}: {(v.raw.getSubstring?.getD default).trim}\"</span>\n<span class=\"w\">    </span><span class=\"n\">logInfoAt</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"{pos}: {(v.raw.getSubstring?.getD default).trim}\"</span>\n<span class=\"w\">  </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span><span class=\"bp\">.</span><span class=\"n\">joinSep</span><span class=\"w\"> </span><span class=\"n\">msg</span><span class=\"bp\">.</span><span class=\"n\">toList</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"o\">)</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">info: ⟨19, 9⟩: (x y : Nat)</span>\n<span class=\"sd\">---</span>\n<span class=\"sd\">info: ⟨21, 9⟩: (z w : Nat)</span>\n<span class=\"sd\">---</span>\n<span class=\"sd\">info: ⟨21, 21⟩: (a : Unit)</span>\n<span class=\"sd\">---</span>\n<span class=\"sd\">info: Line 19, column 9: (x y : Nat)</span>\n<span class=\"sd\">Line 21, column 9: (z w : Nat)</span>\n<span class=\"sd\">Line 21, column 21: (a : Unit)</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"kn\">where</span><span class=\"bp\">!</span>\n</code></pre></div>",
        "id": 546098335,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1760995347
    },
    {
        "content": "<p>In the code above, each variable command is highlighted (except that <code>#guard_msgs</code> \"captures\" the highlight).  The \"individual\" messages are logged at the corresponding variable location. while the final \"summary\" is on the <code>#where!</code> syntax..</p>",
        "id": 546099140,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1760995668
    }
]