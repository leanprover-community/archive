[
    {
        "content": "<p>Printing out the syntax tree of <code>Mathlib/ModelTheory/Syntax.lean</code>, I found this constant</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">           </span><span class=\"o\">(</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">refine</span>\n<span class=\"w\">            </span><span class=\"s2\">\"refine\"</span>\n<span class=\"w\">            </span><span class=\"o\">(</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">TermCongr</span><span class=\"bp\">.</span><span class=\"n\">termCongr</span>\n<span class=\"w\">             </span><span class=\"s2\">\"congr(\"</span>\n<span class=\"w\">             </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">term_''_</span>\n<span class=\"w\">              </span><span class=\"o\">(</span><span class=\"n\">Term</span><span class=\"bp\">.</span><span class=\"n\">hole</span><span class=\"w\"> </span><span class=\"s2\">\"_\"</span><span class=\"o\">)</span>\n<span class=\"w\">              </span><span class=\"s2\">\"''\"</span>\n<span class=\"w\">              </span><span class=\"o\">(</span><span class=\"n\">Term</span><span class=\"bp\">.</span><span class=\"n\">paren</span>\n<span class=\"w\">               </span><span class=\"s2\">\"(\"</span>\n<span class=\"w\">               </span><span class=\"o\">(</span><span class=\"bp\">«</span><span class=\"n\">term_</span><span class=\"bp\">∩_»</span>\n<span class=\"w\">                </span><span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">pseudo</span><span class=\"bp\">.</span><span class=\"n\">antiquot</span><span class=\"w\"> </span><span class=\"s2\">\"$\"</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">antiquotNestedExpr</span><span class=\"w\"> </span><span class=\"s2\">\"(\"</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Term</span><span class=\"bp\">.</span><span class=\"n\">syntheticHole</span><span class=\"w\"> </span><span class=\"s2\">\"?\"</span><span class=\"w\"> </span><span class=\"s2\">\"_\"</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\")\"</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[])</span>\n<span class=\"w\">                </span><span class=\"s2\">\"∩\"</span>\n<span class=\"w\">                </span><span class=\"o\">(</span><span class=\"n\">Term</span><span class=\"bp\">.</span><span class=\"n\">hole</span><span class=\"w\"> </span><span class=\"s2\">\"_\"</span><span class=\"o\">))</span>\n<span class=\"w\">               </span><span class=\"s2\">\")\"</span><span class=\"o\">))</span>\n<span class=\"w\">             </span><span class=\"s2\">\")\"</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>which occurs on this line:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"w\">    </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">⟨{⟨</span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"o\">⟩,</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">j</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"mi\">2</span><span class=\"o\">⟩},</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">_</span><span class=\"o\">⟩,</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">_</span><span class=\"o\">⟩⟩,</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">_</span><span class=\"o\">⟩</span>\n</code></pre></div>\n<p>what is <code>term.pseudo.antiquot</code>? The Lean tactic prettyprinter fails to print this</p>",
        "id": 487164981,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1733808711
    },
    {
        "content": "<p>I think you have the line number wrong</p>",
        "id": 487251049,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733837711
    },
    {
        "content": "<p>It should be from something like <code>exact congr(_ '' ($(?_) \\inter _)</code></p>",
        "id": 487251375,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733837799
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/blob/16956ef06e49e3e4f34d7be6d97f170580b42a79/Mathlib/ModelTheory/Syntax.lean#L854\"><code>refine congr(_ '' ($(?_) ∩ _))</code></a></p>",
        "id": 487319534,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733856412
    },
    {
        "content": "<p>the answer to your question is that <code>term.pseudo.antiquot</code> is the syntax for antiquotations, which for no particularly good reason has no pretty printer. (I think this narrowly avoided being an issue for mathport because lean 3 did not have <code>congr(...)</code> or <code>q(...)</code> and we did not attempt to translate tactic metaprograms containing antiquotations)</p>",
        "id": 487319979,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733856571
    },
    {
        "content": "<p>cc: <span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span></p>",
        "id": 487320014,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733856580
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/270676-lean4/topic/What.20is.20.60term.2Epseudo.2Eantiquot.60.3F/near/487319979\">said</a>:</p>\n<blockquote>\n<p>the answer to your question is that <code>term.pseudo.antiquot</code> is the syntax for antiquotations, which for no particularly good reason has no pretty printer. (I think this narrowly avoided being an issue for mathport because lean 3 did not have <code>congr(...)</code> or <code>q(...)</code> and we did not attempt to translate tactic metaprograms containing antiquotations)</p>\n</blockquote>\n<p>Should I write a prettyprinter for it and pr?</p>",
        "id": 488019390,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1733895421
    },
    {
        "content": "<p>I don't think it is quite trivial to implement it in full antiquotation generality. Might be better to implement a local pretty printer in your project specifically for your use case.</p>",
        "id": 488086417,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1733920260
    },
    {
        "content": "<p>Could it print as <code>$&lt;cannot print&gt;</code> or something to prevent it tainting the entire syntax being printed?</p>",
        "id": 488162237,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733942174
    },
    {
        "content": "<p>I think that's a general suggestion too, although IIRC this is hard to implement because the formatter misuses backtracking so it can't tell the difference between missing formatters and deliberate alternation</p>",
        "id": 488163018,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733942456
    }
]