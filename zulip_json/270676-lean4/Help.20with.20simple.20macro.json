[
    {
        "content": "<p>I want to write a very simple macro, which takes 3 terms, and calls another tactic with these three terms. However, I'm having some trouble getting it to work. This is what I want to write:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- `subst_hom_lift p f Ï†` tries to substitute `f` with `p(Ï†)` by using `p.IsHomLift f Ï†` -/</span>\n<span class=\"kn\">macro</span><span class=\"w\"> </span><span class=\"s2\">\"subst_hom_lift\"</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"n\">Ï†</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨âŸ©</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Functor</span><span class=\"bp\">.</span><span class=\"n\">IsHomLift</span><span class=\"bp\">.</span><span class=\"n\">cond</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Ï†</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">Ï†</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>However, when I try to call it with a functor <code>p : ğ’³ â¥¤ ğ’®</code>, and two morphisms <code>f</code> and <code>Ï†</code>, I get the error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"k\">at</span>\n<span class=\"w\">  </span><span class=\"n\">p</span>\n<span class=\"n\">term</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">ğ’³</span><span class=\"w\"> </span><span class=\"bp\">â¥¤</span><span class=\"w\"> </span><span class=\"n\">ğ’®</span>\n</code></pre></div>\n<p>I am not sure how to make sense of this error., but I assume it is because I am not substituting in the terms correctly. Will I need to do some preprocessing to make this work?</p>\n<p>Previously I just wrote the macro with <code>ident</code>s instead of <code>term</code>s, but then I will not be able to use the macro on more complicated expressions (such as when <code>f</code> is of the form <code>F.map g</code>). If you want to run it your self, the ident version is in <code>CategoryTheory/FiberedCategory/HomLift</code> in mathlib.</p>",
        "id": 466224753,
        "sender_full_name": "Calle SÃ¶nne",
        "timestamp": 1725012725
    },
    {
        "content": "<p>What the error message is (indirectly) telling you is that when you write <code>subst_hom_lift a b c</code>, it's interpreting <code>a b c</code> as the first term (named <code>p</code> in your macro). Therefore <code>a</code> is expected to be a function with <code>b</code> and <code>c</code> being arguments to <code>a</code>. The way to fix this is by writing <code>p:term:max f:term:max Ï†:term:max</code> in your macro.</p>",
        "id": 466228559,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1725013476
    },
    {
        "content": "<p>Thanks a lot!</p>",
        "id": 466235783,
        "sender_full_name": "Calle SÃ¶nne",
        "timestamp": 1725014919
    }
]