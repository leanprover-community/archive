[
    {
        "content": "<p>Here's a proof of false that smuggles an axiom through <code>csimp</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">bad_one</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">cheating</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">False</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">csimp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">oops</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">bad_one</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">cheating</span><span class=\"bp\">.</span><span class=\"n\">elim</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">ohno</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">native_decide</span>\n\n<span class=\"sd\">/-- info: 'ohno' depends on axioms: [Lean.ofReduceBool] -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">axioms</span><span class=\"w\"> </span><span class=\"n\">ohno</span>\n</code></pre></div>\n<p>Should <code>ofReduceBool</code> somehow track the other axioms it uses?</p>",
        "id": 505140945,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741787838
    },
    {
        "content": "<p>An alternative might be to modify the csimp attribute itself to ban the use of nonstandard axioms in tagged lemmas.</p>",
        "id": 505257000,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1741815866
    },
    {
        "content": "<p>Banning is probably overkill, but it could emit a warning that it is no safer than <code>implemented_by</code> if it detects such axioms</p>",
        "id": 505259070,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741816551
    },
    {
        "content": "<p>I don't think we should force the user to replace <code>@[csimp]</code> + <code>sorry</code>+ <code>--TODO</code> with <code>implemented_by</code></p>",
        "id": 505259178,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741816575
    },
    {
        "content": "<p>I agree a warning is better. But <code>sorryAx</code> should probably count as a \"standard axiom\" for this check.</p>",
        "id": 505268138,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1741819699
    },
    {
        "content": "<p>issue/PR welcome.</p>",
        "id": 505268154,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1741819709
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/270676-lean4/topic/Axioms.20used.20by.20csimp.20are.20not.20reported/near/505268138\">said</a>:</p>\n<blockquote>\n<p><code>sorryAx</code> should probably count as a \"standard axiom\" for this check.</p>\n</blockquote>\n<p>Well then you can conclude that your theorem is \"sorry free\" when actually you just hid your sorry behind a <code>csimp</code>!</p>",
        "id": 505268260,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741819757
    },
    {
        "content": "<p>Indeed, I'm always in the mind set that <code>sorry</code> can't ever hit a <code>master</code> branch... For projects that work otherwise, I agree.</p>",
        "id": 505268701,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1741819931
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/7463\">lean4#7463</a></p>",
        "id": 505268798,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741819983
    }
]