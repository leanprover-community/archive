[
    {
        "content": "<p>Let's say I'm working in a monad with an Alternative instance. How do I use this with do-notation - intuitively it feels like I need some clear way of notating a branch or a case split which I would assume is done via match or match-style notation, but I'm not sure if there's a better way.</p>",
        "id": 543351106,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759764993
    },
    {
        "content": "<p>Just use <code>&lt;|&gt;</code> I would think</p>",
        "id": 543351992,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1759765188
    },
    {
        "content": "<p>Yeah I guess what I'm asking is that I am not sure I quite understand how to use &lt;|&gt; in a neat way.</p>",
        "id": 543352143,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759765219
    },
    {
        "content": "<p>Like you then need to write two program flows effectively.</p>",
        "id": 543352270,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759765246
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">onFailure</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n<span class=\"w\">  </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"bp\">&lt;|&gt;</span><span class=\"w\"> </span><span class=\"n\">onFailure</span>\n</code></pre></div>",
        "id": 543353504,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1759765505
    },
    {
        "content": "<p>Aha!</p>",
        "id": 543353542,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759765515
    },
    {
        "content": "<p>Thanks.</p>",
        "id": 543353561,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759765519
    },
    {
        "content": "<p>Sometimes I feel like there should be a neater notation for this than infix, since formatting can get awkward if you want to write it inline as <code>(do ...) &lt;|&gt; (do ...)</code>.</p>\n<p>Examples in core:</p>\n<ul>\n<li><a href=\"https://github.com/leanprover/lean4/blob/232a0495b0b11e6817adfed89b1e913bbbc34157/src/Lean/PrettyPrinter/Delaborator/Builtins.lean#L461-L464\">https://github.com/leanprover/lean4/blob/232a0495b0b11e6817adfed89b1e913bbbc34157/src/Lean/PrettyPrinter/Delaborator/Builtins.lean#L461-L464</a></li>\n<li><a href=\"https://github.com/leanprover/lean4/blob/232a0495b0b11e6817adfed89b1e913bbbc34157/src/Lean/Structure.lean#L349-L355\">https://github.com/leanprover/lean4/blob/232a0495b0b11e6817adfed89b1e913bbbc34157/src/Lean/Structure.lean#L349-L355</a></li>\n</ul>\n<p>For example, perhaps this could be notation:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">stmt1</span>\n<span class=\"w\">  </span><span class=\"n\">stmt2</span>\n<span class=\"w\">  </span><span class=\"n\">first</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">stmt1a</span>\n<span class=\"w\">    </span><span class=\"n\">stmt2a</span>\n<span class=\"w\">    </span><span class=\"n\">stmt3a</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">stmt1b</span>\n<span class=\"w\">    </span><span class=\"n\">stmt2b</span>\n</code></pre></div>\n<p>I doubt it comes up enough for the added complexity to be worth it, but it doesn't hurt thinking about it.</p>",
        "id": 543355222,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1759765838
    },
    {
        "content": "<p>Something like that was what I was thinking about yes</p>",
        "id": 543355313,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759765859
    },
    {
        "content": "<p>Maybe it wouldn't hurt to have an RFC, if someone is interested in writing it.</p>\n<p>I'd expect to see:</p>\n<ul>\n<li>some realistic examples where using <code>&lt;|&gt;</code> is awkward and <code>first</code> would read clearer</li>\n<li>a mention that <code>first</code> is already a tactic with an analogous meaning so the parallelism strengthens Lean's design</li>\n<li>a justification for why it is ok to reserve <code>first</code> as a keyword (note that tactics do not reserve keywords), which would involve looking for any uses of <code>first</code> in declarations in core, batteries, mathlib, and other downstream libraries, and evaluating the impact</li>\n</ul>\n<p>No guarantees this proposal would go anywhere, but a strong RFC would give it the best chance.</p>",
        "id": 543357322,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1759766387
    },
    {
        "content": "<p>Another spelling choice is</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">run_meta</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">firstM</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"o\">[</span>\n<span class=\"w\">    </span><span class=\"k\">do</span>\n<span class=\"w\">      </span><span class=\"n\">failure</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"k\">do</span>\n<span class=\"w\">      </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 543358447,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759766709
    },
    {
        "content": "<p>Which is a little less annoying to line-wrap than <code>(do ...) &lt;|&gt; (do ...)</code></p>",
        "id": 543358548,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759766736
    },
    {
        "content": "<p>I guess the key distinction is that the proposed <code>first</code> would allow modifying <code>mut</code> <code>let</code>s, <code>break</code>, <code>continue</code>, and <code>return</code></p>",
        "id": 543358782,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759766790
    },
    {
        "content": "<p>Yeah, that's a good point, and it would need to be evaluated in the RFC. The <code>mut</code> and control flow integration would be an important feature here.</p>\n<p>(If there's a plan to make it possible to run combinators in a way that links them into the current <code>do</code> then there might be no need for <code>first</code>, also worth mentioning.)</p>",
        "id": 543359392,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1759766986
    },
    {
        "content": "<p>13 messages were moved from this topic to <a class=\"stream-topic\" data-stream-id=\"270676\" href=\"/#narrow/channel/270676-lean4/topic/Applicative.20and.20do-notation/with/543620782\">#lean4 &gt; Applicative and do-notation</a> by <span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span>.</p>",
        "id": 543620783,
        "sender_full_name": "Notification Bot",
        "timestamp": 1759870720
    },
    {
        "content": "<p>5 messages were moved from this topic to <a class=\"stream-topic\" data-stream-id=\"113488\" href=\"/#narrow/channel/113488-general/topic/Showing.20branching.20side-by-side/with/545275890\">#general &gt; Showing branching side-by-side</a> by <span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span>.</p>",
        "id": 545275892,
        "sender_full_name": "Notification Bot",
        "timestamp": 1760613510
    }
]