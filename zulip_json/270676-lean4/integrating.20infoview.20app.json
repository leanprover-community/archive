[
    {
        "content": "<p>Hi continuing <a href=\"#narrow/stream/113489-new-members/topic/lsp.20getInteractiveGoals.20and.20subexprPos.3F\">the thread</a> I am trying to integrate <a href=\"https://github.com/leanprover/vscode-lean4/tree/master/lean4-infoview\">the infoview app</a> with intelij idea. I got the basic functionality work but sometimes when there is no goal I got stuck for providing maybe a wrong default value like:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">DummyEditorApi</span><span class=\"w\"> </span><span class=\"n\">implements</span><span class=\"w\"> </span><span class=\"n\">EditorApi</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"n\">async</span><span class=\"w\"> </span><span class=\"n\">sendClientRequest</span><span class=\"o\">(</span><span class=\"n\">uri</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">string</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">method</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">string</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">params</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">any</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">Promise</span><span class=\"bp\">&lt;</span><span class=\"n\">any</span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">        </span><span class=\"n\">console</span><span class=\"bp\">.</span><span class=\"n\">log</span><span class=\"o\">(</span><span class=\"ss\">`Sending</span><span class=\"w\"> </span><span class=\"n\">client</span><span class=\"w\"> </span><span class=\"n\">request</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"o\">{</span><span class=\"n\">method</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">URI</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"o\">{</span><span class=\"n\">uri</span><span class=\"o\">}</span><span class=\"bp\">`</span><span class=\"o\">)</span><span class=\"bp\">;</span>\n<span class=\"w\">        </span><span class=\"n\">const</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">await</span><span class=\"w\"> </span><span class=\"n\">fetch</span><span class=\"o\">(</span><span class=\"bp\">'/</span><span class=\"n\">api</span><span class=\"bp\">/</span><span class=\"n\">sendClientRequest'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">                </span><span class=\"n\">method</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"POST\"</span><span class=\"o\">,</span>\n<span class=\"w\">                </span><span class=\"n\">headers</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">                    </span><span class=\"s2\">\"Content-Type\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"application/json\"</span>\n<span class=\"w\">                </span><span class=\"o\">},</span>\n<span class=\"w\">                </span><span class=\"n\">body</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">JSON</span><span class=\"bp\">.</span><span class=\"n\">stringify</span><span class=\"o\">(</span><span class=\"n\">params</span><span class=\"o\">)</span>\n<span class=\"w\">            </span><span class=\"o\">}</span>\n<span class=\"w\">        </span><span class=\"o\">)</span><span class=\"bp\">;</span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">!</span><span class=\"n\">res</span><span class=\"bp\">.</span><span class=\"n\">ok</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">            </span><span class=\"n\">throw</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">Error</span><span class=\"o\">(</span><span class=\"bp\">'</span><span class=\"n\">Network</span><span class=\"w\"> </span><span class=\"n\">response</span><span class=\"w\"> </span><span class=\"n\">was</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">ok'</span><span class=\"o\">)</span><span class=\"bp\">;</span>\n<span class=\"w\">        </span><span class=\"o\">}</span>\n<span class=\"w\">        </span><span class=\"n\">const</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">await</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"bp\">.</span><span class=\"n\">json</span><span class=\"o\">()</span><span class=\"bp\">;</span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Object</span><span class=\"bp\">.</span><span class=\"n\">keys</span><span class=\"o\">(</span><span class=\"n\">result</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">params</span><span class=\"bp\">.</span><span class=\"n\">method</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"s2\">\"Lean.Widget.getInteractiveGoals\"</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">                </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">                    </span><span class=\"n\">goals</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">[]</span>\n<span class=\"w\">                </span><span class=\"o\">}</span>\n<span class=\"w\">            </span><span class=\"o\">}</span>\n<span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">params</span><span class=\"bp\">.</span><span class=\"n\">method</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"s2\">\"Lean.Widget.getInteractiveTermGoal\"</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">                </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">                    </span><span class=\"n\">goals</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">[],</span>\n<span class=\"w\">                    </span><span class=\"n\">hyps</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">[]</span>\n<span class=\"w\">                </span><span class=\"o\">}</span>\n<span class=\"w\">            </span><span class=\"o\">}</span>\n<span class=\"w\">            </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"o\">[]</span>\n<span class=\"w\">        </span><span class=\"o\">}</span>\n<span class=\"w\">        </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"bp\">;</span>\n<span class=\"w\">    </span><span class=\"o\">}</span>\n</code></pre></div>\n<p>it seems that for the no goal case I am providing a wrong default value and get error in here (lean4-infoview/src/infoview/interactiveCode.tsx:36) with <code>fmt</code> undefined:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">/**</span>\n<span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Core</span><span class=\"w\"> </span><span class=\"n\">loop</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">display</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"bp\">@</span><span class=\"n\">link</span><span class=\"w\"> </span><span class=\"n\">TaggedText</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">objects</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">Invokes</span><span class=\"w\"> </span><span class=\"ss\">`InnerTagUi</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"ss\">`tag</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">nodes</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">order</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">support</span>\n<span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">various</span><span class=\"w\"> </span><span class=\"n\">embedded</span><span class=\"w\"> </span><span class=\"n\">information</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"n\">subexpression</span><span class=\"w\"> </span><span class=\"n\">information</span><span class=\"w\"> </span><span class=\"n\">stored</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"bp\">@</span><span class=\"n\">link</span><span class=\"w\"> </span><span class=\"n\">CodeWithInfos</span><span class=\"o\">}</span><span class=\"bp\">.</span>\n<span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">*/</span>\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">InteractiveTaggedText</span><span class=\"bp\">&lt;</span><span class=\"n\">T</span><span class=\"bp\">&gt;</span><span class=\"o\">({</span><span class=\"w\"> </span><span class=\"n\">fmt</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">InnerTagUi</span><span class=\"w\"> </span><span class=\"o\">}:</span><span class=\"w\"> </span><span class=\"n\">InteractiveTaggedTextProps</span><span class=\"bp\">&lt;</span><span class=\"n\">T</span><span class=\"bp\">&gt;</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">'</span><span class=\"n\">text'</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">fmt</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">&lt;&gt;</span><span class=\"o\">{</span><span class=\"n\">fmt</span><span class=\"bp\">.</span><span class=\"n\">text</span><span class=\"o\">}</span><span class=\"bp\">&lt;/&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">'</span><span class=\"n\">append'</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">fmt</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"o\">(</span>\n<span class=\"w\">            </span><span class=\"bp\">&lt;&gt;</span>\n<span class=\"w\">                </span><span class=\"o\">{</span><span class=\"n\">fmt</span><span class=\"bp\">.</span><span class=\"n\">append</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"o\">((</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span>\n<span class=\"w\">                    </span><span class=\"bp\">&lt;</span><span class=\"n\">InteractiveTaggedText</span><span class=\"w\"> </span><span class=\"n\">key</span><span class=\"bp\">=</span><span class=\"o\">{</span><span class=\"n\">i</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">fmt</span><span class=\"bp\">=</span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">InnerTagUi</span><span class=\"bp\">=</span><span class=\"o\">{</span><span class=\"n\">InnerTagUi</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">/&gt;</span>\n<span class=\"w\">                </span><span class=\"o\">))}</span>\n<span class=\"w\">            </span><span class=\"bp\">&lt;/&gt;</span>\n<span class=\"w\">        </span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">'</span><span class=\"n\">tag'</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">fmt</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"n\">InnerTagUi</span><span class=\"w\"> </span><span class=\"n\">fmt</span><span class=\"bp\">=</span><span class=\"o\">{</span><span class=\"n\">fmt</span><span class=\"bp\">.</span><span class=\"n\">tag</span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">]}</span><span class=\"w\"> </span><span class=\"n\">tag</span><span class=\"bp\">=</span><span class=\"o\">{</span><span class=\"n\">fmt</span><span class=\"bp\">.</span><span class=\"n\">tag</span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">]}</span><span class=\"w\"> </span><span class=\"bp\">/&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">throw</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">Error</span><span class=\"o\">(</span><span class=\"ss\">`malformed</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">TaggedText'</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">'$</span><span class=\"o\">{</span><span class=\"n\">fmt</span><span class=\"o\">}</span><span class=\"bp\">'`</span><span class=\"o\">)</span>\n<span class=\"o\">}</span>\n</code></pre></div>",
        "id": 453733293,
        "sender_full_name": "Shanghe Chen",
        "timestamp": 1721836537
    },
    {
        "content": "<p>any idea for this? It seems kind of fuzzy and I got a screenshot for the error. It seems I didn't provide the correct default value to infoview-app but I cannot find it after some tries<br>\n<a href=\"/user_uploads/3121/Xj3PME-PpZyx6YWZ0y8cMra2/infoview_app3.mp4\">infoview_app3.mp4</a></p>\n<div class=\"message_inline_image message_inline_video\"><a href=\"/user_uploads/3121/Xj3PME-PpZyx6YWZ0y8cMra2/infoview_app3.mp4\" title=\"infoview_app3.mp4\"><video preload=\"metadata\" src=\"/user_uploads/3121/Xj3PME-PpZyx6YWZ0y8cMra2/infoview_app3.mp4\"></video></a></div>",
        "id": 453737974,
        "sender_full_name": "Shanghe Chen",
        "timestamp": 1721837582
    },
    {
        "content": "<p>Hm, a few questions:</p>\n<ul>\n<li>The two fallback cases you have under <code>Object.keys(result).length == 0</code> are supposed to happen when <code>method === '$/lean/rpc/call'</code>, right? It might be clearer to check for that.</li>\n<li>But then still, what are these fallback cases for? Are they necessary? The RPC calls try to handle various errors, so it might be okay to simply throw an error. In that case the infoview should show the error message.</li>\n<li>As to your specific question, I _think_ that the returned data in <code>interactiveTermGoal</code> has the wrong shape. The type it should have is specified <a href=\"https://github.com/leanprover/vscode-lean4/blob/0bab1db6be08083e3b41286627334bd2dd19dc75/lean4-infoview-api/src/rpcApi.ts#L75\">here</a>. As you can see, it has no <code>goals</code> field, and you're missing the <code>type</code> field. But instead of being an object, the whole thing can be <code>undefined</code>, so just <code>return undefined</code> might work.</li>\n</ul>",
        "id": 453781341,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1721850173
    },
    {
        "content": "<p>Oh, and congrats on getting the infoview working as far as you already did! It would be great to support multiple editors and not just VSCode.</p>",
        "id": 453781786,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1721850378
    },
    {
        "content": "<p>Also, I'm not sure how exactly your infoview&lt;-&gt;editor communication works (looks like it's using HTTP requests?), but as per the API I linked above, the result of <code>getInteractiveTermGoal</code> can be <code>undefined</code>, and this is a valid value. It simply means that there is no term goal at that specific position. On the other hand, it looks like your code assumes that <code>result</code> is an object (as <code>Object.keys(undefined)</code> throws an error). You may have to fix something internally to handle the case when <code>result === undefined</code> correctly.</p>",
        "id": 453782450,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1721850649
    },
    {
        "content": "<p>Thanks! Yeah I changed the default value to <code>undefined</code> for the method <code>Lean.Widget.getInteractiveTermGoal</code> and it works  for all case now!  But It seems that the default value for method <code>Lean.Widget.getInteractiveGoals</code> cannot be <code>undefined</code> and must be <code>{\"goals\":[]}</code></p>",
        "id": 453970075,
        "sender_full_name": "Shanghe Chen",
        "timestamp": 1721919215
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"128280\">Wojciech Nawrocki</span> <a href=\"#narrow/stream/270676-lean4/topic/integrating.20infoview.20app/near/453782450\">å‘è¨€é“</a>ï¼š</p>\n<blockquote>\n<p>Also, I'm not sure how exactly your infoview&lt;-&gt;editor communication works (looks like it's using HTTP requests?)</p>\n</blockquote>\n<p>Yeah the editor is as a rest service backend and the infoview is the frontend. For EditorApi I sent HTTP requests and using <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events\">server-sent events</a> for bridging infoview api. Maybe for crossing the http protocol that's why I had to handle these fallback cases.</p>",
        "id": 453971064,
        "sender_full_name": "Shanghe Chen",
        "timestamp": 1721919471
    },
    {
        "content": "<p>Btw any recommend way to handle outdated RPC session? I am thinking create a new session in the editor end or should I tell infoview to get a new session. And it seems kind of weird it's outdated since I sent <code>$/lean/rpc/keepAlive</code> each 9 seconds periodly though</p>",
        "id": 453971569,
        "sender_full_name": "Shanghe Chen",
        "timestamp": 1721919590
    },
    {
        "content": "<p>Does it help to look at the implementation <a href=\"https://github.com/leanprover/vscode-lean4/blob/e15359532db1a80a6915459dc619db46330c02db/vscode-lean4/src/infoview.ts#L305-L328\">here</a>?</p>",
        "id": 454909606,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1722276532
    },
    {
        "content": "<p>Yeah thanks! I will check the impl in vscode-lean4</p>",
        "id": 455000600,
        "sender_full_name": "Shanghe Chen",
        "timestamp": 1722307550
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"128280\">Wojciech Nawrocki</span> <a href=\"#narrow/stream/270676-lean4/topic/integrating.20infoview.20app/near/454909606\">å‘è¨€é“</a>ï¼š</p>\n<blockquote>\n<p>Does it help to look at the implementation <a href=\"https://github.com/leanprover/vscode-lean4/blob/e15359532db1a80a6915459dc619db46330c02db/vscode-lean4/src/infoview.ts#L305-L328\">here</a>?</p>\n</blockquote>\n<p>Hi I found that for integrating infoview app inside a web browser, for showing \"All Messages\" it seems relying on earlier <code>textDocument/publishDiagnostics</code> server notifications. May I ask what 's the designing way for showing up all messages in the infoview? Currently I am caching all server notifications and replaying them if there is a new client connection. But I am afraiding the cache may grow too big though.</p>",
        "id": 464874123,
        "sender_full_name": "Shanghe Chen",
        "timestamp": 1724519146
    },
    {
        "content": "<p>I saw <a href=\"https://github.com/leanprover/vscode-lean4/blob/master/lean4-infoview/src/infoview/messages.tsx#L146\">here</a> that there is some logic for determing <code>maxLine</code> for the <code>All Messages</code> tab but still not quite getting it</p>",
        "id": 464877311,
        "sender_full_name": "Shanghe Chen",
        "timestamp": 1724520397
    },
    {
        "content": "<p>Here is how it works. The infoview listens on <code>textDocument/publishDiagnostics</code> LSP notifications <a href=\"https://github.com/leanprover/vscode-lean4/blob/97d7d8c382d1549c18b66cd99ab4df0b6634c8f1/lean4-infoview/src/infoview/messages.tsx#L247\">here</a>. Recall that notifications should be passed to the infoview by the editor in the <a href=\"https://github.com/leanprover/vscode-lean4/blob/97d7d8c382d1549c18b66cd99ab4df0b6634c8f1/lean4-infoview-api/src/infoviewApi.ts#L120\">editor API</a>. The latest set of diagnostics for any given file is persisted in the infoview as part of a React context. Unfortunately, base LSP diagnostics do not contain interactive content, so the infoview must make a <code>getInteractiveDiagnostics</code> call whenever the base diagnostics have changed in order to fetch their 'interactive' versions. This is done just below the line you linked, <a href=\"https://github.com/leanprover/vscode-lean4/blob/97d7d8c382d1549c18b66cd99ab4df0b6634c8f1/lean4-infoview/src/infoview/messages.tsx#L148\">here</a>.</p>\n<p>As far as the editor side is concerned, you shouldn't need to cache anything. It suffices to implement the editor API correctly, in that whenever the LSP server sends a notification that has been <a href=\"https://github.com/leanprover/vscode-lean4/blob/97d7d8c382d1549c18b66cd99ab4df0b6634c8f1/lean4-infoview-api/src/infoviewApi.ts#L29\">subscribed</a>, you pass it through with <code>gotServerNotification</code>. The infoview will cache them as needed. You also need to implement the RPC passthrough correctly for <code>getInteractiveDiagnostics</code> to work.</p>",
        "id": 468627606,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1725829755
    },
    {
        "content": "<p>Hope this helps <span class=\"user-mention\" data-user-id=\"560873\">@Shanghe Chen</span></p>",
        "id": 468627643,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1725829764
    },
    {
        "content": "<p>Thanks! I just saw this. It helps a lot!</p>",
        "id": 468738247,
        "sender_full_name": "Shanghe Chen",
        "timestamp": 1725875204
    }
]