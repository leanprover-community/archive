[
    {
        "content": "<p>Consider the following code at the current Lean nightly version on <a href=\"https://live.lean-lang.org/\">https://live.lean-lang.org/</a>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">compiler</span><span class=\"bp\">.</span><span class=\"n\">extract_closed</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n</code></pre></div>\n<p>It will report an error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">compiler</span><span class=\"w\"> </span><span class=\"n\">IR</span><span class=\"w\"> </span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">a'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unknown</span><span class=\"w\"> </span><span class=\"n\">declaration</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">f'</span>\n</code></pre></div>\n<p>But we may want an error message like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">compile</span><span class=\"w\"> </span><span class=\"n\">definition</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">consider</span><span class=\"w\"> </span><span class=\"n\">marking</span><span class=\"w\"> </span><span class=\"n\">it</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"kn\">noncomputable</span><span class=\"bp\">'</span><span class=\"w\"> </span><span class=\"n\">because</span><span class=\"w\"> </span><span class=\"n\">it</span><span class=\"w\"> </span><span class=\"n\">depends</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">f'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">it</span><span class=\"w\"> </span><span class=\"n\">does</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">executable</span><span class=\"w\"> </span><span class=\"n\">code</span>\n</code></pre></div>\n<p>I read the source code, and in the <code>else</code> block of function <code>infer_constant</code> of file <code>library/compiler/ll_infer_type.cpp</code>, when we can't find the constant in both the environment and <code>m_new_decl_names</code>, we will prompt the user to mark it as noncomputable. However, in the function <code>getDecl</code> of <code>Lean/Compiler/IR/Checker.lean</code>, we just prompt \"unknown declaration '{c}'\" when we can't find the constant in the environment, and it's may be not so informative.<br>\nCould I make a pull request for this? We could change it to \"The definition depends on '{c}' but its executable code can't be found, consider marking the definition as 'noncomputable'\".</p>",
        "id": 463557597,
        "sender_full_name": "Shuhao Song",
        "timestamp": 1724119060
    },
    {
        "content": "<p>There is an old lean 4 issue for this: <a href=\"https://github.com/leanprover/lean4/issues/1785\">https://github.com/leanprover/lean4/issues/1785</a></p>",
        "id": 463995995,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1724232810
    },
    {
        "content": "<p>OK, thanks. I cited this issue in my PR.</p>",
        "id": 464011926,
        "sender_full_name": "Shuhao Song",
        "timestamp": 1724237148
    },
    {
        "content": "<p>Oh there is also <a href=\"https://github.com/leanprover/lean4/pull/4729\">https://github.com/leanprover/lean4/pull/4729</a> which seems to fix the same thing.</p>",
        "id": 464078696,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1724251840
    }
]