[
    {
        "content": "<p>The <code>Inhabited</code> instance for <code>MessageData</code> is derived from <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MessageData.ofGoal#doc\">docs#MessageData.ofGoal</a>, which in turn uses the default <code>MVarId</code>, which is <code>Name.anonymous</code>.  This causes confusion when trying to log the default <code>MessageData</code>.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Command</span>\n\n<span class=\"n\">run_cmd</span><span class=\"w\"> </span><span class=\"c1\">-- [error when printing message: unknown goal [anonymous]]</span>\n<span class=\"w\">  </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">default</span>\n\n<span class=\"n\">run_cmd</span><span class=\"w\"> </span><span class=\"c1\">-- [error when printing message: unknown goal [anonymous]]</span>\n<span class=\"w\">  </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"Interesting message\"</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">default</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\" and more interesting stuff here.\"</span>\n</code></pre></div>\n<p>If, instead, the default instance was <code>m!\"\"</code>, then there would be no issues above.</p>",
        "id": 554310219,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1762518467
    },
    {
        "content": "<p>Should we make it something distinctive (like <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.instInhabitedExpr#doc\">docs#Lean.instInhabitedExpr</a> does <code>.const `_inhabitedExprDummy []</code>) to aid debugging?</p>",
        "id": 554383578,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762538070
    },
    {
        "content": "<p><code>m!\"\"</code> would match <code>Inhabited</code> for <code>String</code></p>",
        "id": 554383792,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1762538129
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/270676-lean4/topic/Default.20MessageData/near/554383578\">said</a>:</p>\n<blockquote>\n<p>Should we make it something distinctive (like <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.instInhabitedExpr#doc\">docs#Lean.instInhabitedExpr</a> does <code>.const `_inhabitedExprDummy []</code>) to aid debugging?</p>\n</blockquote>\n<p>Debugging-wise, ideally we have this for <code>Format</code> and <code>String</code> too imo, with differences so that it’s easy to tell which type it’s coming from (e.g. <code>m!\"&lt;default MessageData&gt;\"</code>)!</p>",
        "id": 554406730,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1762545602
    },
    {
        "content": "<p>Not sure if this would introduce any costs with these types being so basic and widely used, though.</p>",
        "id": 554406811,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1762545634
    },
    {
        "content": "<p>Why do we care about the value of <code>default</code> in the first place? Does it ever get used?</p>",
        "id": 554413640,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1762548619
    },
    {
        "content": "<p>My guess is that the main place it matters is for <code>panic!</code>, where I'd perhaps argue a separate <code>panicValue</code> would make the intent clearer</p>",
        "id": 554413773,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1762548679
    },
    {
        "content": "<p>I found out about this, because I was writing a long match statement, and I pre-filled in the various branches with <code>default</code>, just to get something that compiled.  I then proceeded to fill in the various values with meaningful messages, but left one out.  It took me quite a while to debug what was the issue, though, since I was getting <em>no</em> output at all from the log, except that there was an error with printing some goal.</p>",
        "id": 554414063,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1762548816
    },
    {
        "content": "<p>So, indeed, in the end, there are no <code>default</code>s left in my code, but some better default would have given me an easier time when debugging what went wrong.</p>",
        "id": 554414171,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1762548864
    },
    {
        "content": "<p>in that case I would use <code>sorry</code></p>",
        "id": 554414335,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762548938
    },
    {
        "content": "<p>Sure, I could have also used <code>m!\"\"</code>.</p>",
        "id": 554414426,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1762548970
    },
    {
        "content": "<p>But I did not and there was no indication that what I was doing would give me such a hard time!</p>",
        "id": 554414465,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1762548990
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/270676-lean4/topic/Default.20MessageData/near/554413773\">said</a>:</p>\n<blockquote>\n<p>My guess is that the main place it matters is for <code>panic!</code>, where I'd perhaps argue a separate <code>panicValue</code> would make the intent clearer</p>\n</blockquote>\n<p>I agree this is the main place it matters, but I'd be reluctant to create an edge case where we indicate something panicked, when in fact e.g. someone (or something else) had just left a <code>default</code> somewhere, thus sending people on a wild goose chase... <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 554440547,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1762566457
    },
    {
        "content": "<p>To be clear, my suggestion is to have separate <code>Inhabited</code> and <code>PanicValue</code> classes, perhaps with a low-priority instance inferring one from the other</p>",
        "id": 554487278,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1762612760
    },
    {
        "content": "<p>Oh, sorry, I misinterpreted. I like that!</p>",
        "id": 554488885,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1762614169
    }
]