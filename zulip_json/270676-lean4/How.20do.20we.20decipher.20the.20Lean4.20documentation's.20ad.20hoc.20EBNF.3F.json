[
    {
        "content": "<p>See <a href=\"https://proofassistants.stackexchange.com/questions/6450/is-there-a-reference-page-for-understanding-the-syntax-pseudo-language-as-presen?noredirect=1#comment11788_6450\">this PASE post</a> for more information about what I need, but basically, the EBNF used throughout the documentation for Lean4 is not making complete sense to me.  So, any guidance would be appreciated.</p>\n<p>I need to know more syntax than the small idiomatic subset of Lean4 that I do use.  So, I'm going by the EBNF we have in the Lean4 docs.   I can't really work with examples, since my PEGTL grammar auto-generator is quite mechanical and not very smart (no AI and/or grammar induction).</p>\n<p>Specifically, what does the following mean more explicitly?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">::=</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">derivingClass</span><span class=\"o\">,</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"o\">,</span><span class=\"bp\">*</span>\n</code></pre></div>\n<p>What does the first Kleene star apply to: is it (derivingClass ,)* or is it  (deriving instance derivingClass ,)*?</p>\n<p>Also, what do the \"...\" mean here?  Perhaps it's related to the Kleene star list?  My best guess is that it means include the other rules of Nonterminal \"command\", which can be found in other places of the docs.</p>",
        "id": 568108555,
        "sender_full_name": "Daniel Donnelly",
        "timestamp": 1768439191
    },
    {
        "content": "<p>The <code>...</code> refers to all other commands defined elsewhere (<code>def</code>, <code>theorem</code> etc…). The <code>derivingClass,*</code> means “a comma separated list of derived classes”. So it could be <code>Repr, ToString</code> for instance.</p>",
        "id": 568142917,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1768464133
    },
    {
        "content": "<p>The notation for syntax in the language reference is based off of the notation for syntax in Lean 4, so the documentation for syntax declarations also mostly applies to the syntax in the language reference: <a href=\"https://lean-lang.org/doc/reference/latest/Notations-and-Macros/Defining-New-Syntax/#syntax-rules\">https://lean-lang.org/doc/reference/latest/Notations-and-Macros/Defining-New-Syntax/#syntax-rules</a> (see Syntax Specifiers)</p>",
        "id": 568329199,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1768519496
    },
    {
        "content": "<p>Concretely, the example means:<br>\nAmong others, the keyword <code>deriving</code> followed by the keyword <code>instance</code> followed by a comma-separated list of syntax of kind <code>derivingClass</code> followed by the keyword <code>for</code> followed by a comma-separated list of syntax of kind <code>term</code> is a syntax of kind <code>command</code>.<br>\nNow, I'm aware, <code>derivingClass</code> is documented nowhere and there is no hover for it. However, all the syntax in the language reference is based off of Lean's syntax so you can find it <a href=\"https://github.com/leanprover/lean4/blob/4af9cc05924d81e1d5dd35105fdce007c5bbc2e8/src/Lean/Parser/Command.lean#L186\">here</a>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">...</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">derivingClass</span><span class=\"w\">    </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">leading_parser</span>\n<span class=\"w\">  </span><span class=\"n\">optional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"s2\">\"@[\"</span><span class=\"w\"> </span><span class=\"bp\">&gt;&gt;</span><span class=\"w\"> </span><span class=\"n\">nonReservedSymbol</span><span class=\"w\"> </span><span class=\"s2\">\"expose\"</span><span class=\"w\"> </span><span class=\"bp\">&gt;&gt;</span><span class=\"w\"> </span><span class=\"s2\">\"]\"</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">&gt;&gt;</span><span class=\"w\"> </span><span class=\"n\">withForbidden</span><span class=\"w\"> </span><span class=\"s2\">\"for\"</span><span class=\"w\"> </span><span class=\"n\">termParser</span>\n<span class=\"bp\">...</span>\n</code></pre></div>\n<p>which reveals (written in Lean code rather than syntax notation) that <code>derivingClass</code> is an optional <code>@[expose]</code> before a term that may not contain the keyword <code>for</code>.</p>",
        "id": 568330406,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1768520211
    },
    {
        "content": "<p>I am confused about something in this example though, perhaps just a small mistake. The documentation says <code>derivingClass,*</code> but it appears that the implementation corresponds to <code>derivingClass,+</code> (i.e. it uses <code>sepBy1</code> and not <code>sepBy</code>).</p>\n<p>The implementation of standalone deriving instances is <a href=\"https://github.com/leanprover/lean4/blob/4af9cc05924d81e1d5dd35105fdce007c5bbc2e8/src/Lean/Parser/Command.lean#L283\">here</a> and that calls <a href=\"https://github.com/leanprover/lean4/blob/4af9cc05924d81e1d5dd35105fdce007c5bbc2e8/src/Lean/Parser/Command.lean#L188\"><code>derivingClasses</code></a> which uses <code>sepBy1</code>.</p>",
        "id": 568331799,
        "sender_full_name": "Eric Paul",
        "timestamp": 1768521146
    },
    {
        "content": "<p>Thanks to all who posted to guide me.  I will read through each post carefully in a few days.  Currently working on GitManager / Tasks testing right now though.</p>",
        "id": 568332179,
        "sender_full_name": "Daniel Donnelly",
        "timestamp": 1768521424
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"873547\">Robin Arnez</span> <a href=\"#narrow/channel/270676-lean4/topic/How.20do.20we.20decipher.20the.20Lean4.20documentation's.20ad.20hoc.20EBNF.3F/near/568330406\">said</a>:</p>\n<blockquote>\n<p>Concretely, the example means:<br>\nAmong others, the keyword <code>deriving</code> followed by the keyword <code>instance</code> followed by a comma-separated list of syntax of kind <code>derivingClass</code> followed by the keyword <code>for</code> followed by a comma-separated list of syntax of kind <code>term</code> is a syntax of kind <code>command</code>.<br>\nNow, I'm aware, <code>derivingClass</code> is documented nowhere and there is no hover for it. However, all the syntax in the language reference is based off of Lean's syntax so you can find it <a href=\"https://github.com/leanprover/lean4/blob/4af9cc05924d81e1d5dd35105fdce007c5bbc2e8/src/Lean/Parser/Command.lean#L186\">here</a>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">...</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">derivingClass</span><span class=\"w\">    </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">leading_parser</span>\n<span class=\"w\">  </span><span class=\"n\">optional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"s2\">\"@[\"</span><span class=\"w\"> </span><span class=\"bp\">&gt;&gt;</span><span class=\"w\"> </span><span class=\"n\">nonReservedSymbol</span><span class=\"w\"> </span><span class=\"s2\">\"expose\"</span><span class=\"w\"> </span><span class=\"bp\">&gt;&gt;</span><span class=\"w\"> </span><span class=\"s2\">\"]\"</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">&gt;&gt;</span><span class=\"w\"> </span><span class=\"n\">withForbidden</span><span class=\"w\"> </span><span class=\"s2\">\"for\"</span><span class=\"w\"> </span><span class=\"n\">termParser</span>\n<span class=\"bp\">...</span>\n</code></pre></div>\n<p>which reveals (written in Lean code rather than syntax notation) that <code>derivingClass</code> is an optional <code>@[expose]</code> before a term that may not contain the keyword <code>for</code>.</p>\n</blockquote>\n<p>Where did you get that the derivingClass (or the term?) may not contain the keyword \"for\"?  Thanks! <span aria-label=\"cactus\" class=\"emoji emoji-1f335\" role=\"img\" title=\"cactus\">:cactus:</span></p>",
        "id": 568630386,
        "sender_full_name": "Daniel Donnelly",
        "timestamp": 1768703501
    },
    {
        "content": "<p>Actually, I found it it's done with Lean4 code.  Will have to learn some more Lean4.  So, I'm going through TPIL4 some more.</p>",
        "id": 568692745,
        "sender_full_name": "Daniel Donnelly",
        "timestamp": 1768768948
    }
]