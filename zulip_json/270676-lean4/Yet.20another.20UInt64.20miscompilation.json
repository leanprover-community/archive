[
    {
        "content": "<p>This seems bad (on <code>leanprover/lean4:v4.25.0-rc2</code>):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">UInt</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">danger</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt64</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">UInt64</span><span class=\"bp\">.</span><span class=\"n\">ofNat</span><span class=\"w\"> </span><span class=\"n\">UInt64</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">danger_eq_large</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">danger</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">18446744073709551615</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">decide</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"n\">kernel</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">danger_eq_one</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">danger</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">native_decide</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">bad</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">danger_eq_large</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"n\">danger_eq_one</span>\n</code></pre></div>",
        "id": 548250126,
        "sender_full_name": "Geoffrey Irving",
        "timestamp": 1761947406
    },
    {
        "content": "<p>Fixed <a href=\"https://github.com/leanprover-community/mathlib4/pull/11042\">#11042</a></p>",
        "id": 548268244,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1761964261
    },
    {
        "content": "<p>Do you mean <a href=\"https://github.com/leanprover/lean4/pull/11042\">lean#11042</a>?</p>",
        "id": 548269810,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1761966273
    },
    {
        "content": "<p>Numbers were clearly never meant to be decided <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span></p>",
        "id": 548284449,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1761982699
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"395550\">@Henrik Böving</span> Thank you for the fix!</p>\n<p>Do you know when it’s likely to land in a release?</p>",
        "id": 548305454,
        "sender_full_name": "Geoffrey Irving",
        "timestamp": 1762001459
    },
    {
        "content": "<p>Will be in an rc 15 ish days from now</p>",
        "id": 548305486,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1762001488
    },
    {
        "content": "<p>In the meantime, you can use the nightly build, if you need it.</p>",
        "id": 548316266,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1762010669
    },
    {
        "content": "<p>I'm curious, how did you even find this bug...?</p>",
        "id": 553204350,
        "sender_full_name": "Gavin Zhao",
        "timestamp": 1762047269
    },
    {
        "content": "<p><del>It occurred to me in a dream tha 18446744073709551615 might be equal to 1 due to some constant folding optimizations.</del></p>",
        "id": 553204395,
        "sender_full_name": "Gavin Zhao",
        "timestamp": 1762047318
    },
    {
        "content": "<p>For both this one and the previous UInt64 miscompilation, it was caught by my unit tests in <a href=\"https://github.com/girving/interval\">https://github.com/girving/interval</a>.</p>",
        "id": 553227641,
        "sender_full_name": "Geoffrey Irving",
        "timestamp": 1762072385
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"766285\">Gavin Zhao</span> <a href=\"#narrow/channel/270676-lean4/topic/Yet.20another.20UInt64.20miscompilation/near/553204350\">said</a>:</p>\n<blockquote>\n<p>I'm curious, how did you even find this bug...?</p>\n</blockquote>\n<p>Finding this bug is pretty easy, the above test is far from an MWE, if you had written <code>def f (x : UInt64) := 0 - x</code> you would've already found it.</p>",
        "id": 553235731,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1762079970
    },
    {
        "content": "<p>Maybe we should start fuzzing the code generator at some point...</p>",
        "id": 553235770,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1762079997
    },
    {
        "content": "<p>Code generator fuzzing would be very good!</p>",
        "id": 553239645,
        "sender_full_name": "Geoffrey Irving",
        "timestamp": 1762083902
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"395550\">Henrik Böving</span> <a href=\"#narrow/channel/270676-lean4/topic/Yet.20another.20UInt64.20miscompilation/near/553235731\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"766285\">Gavin Zhao</span> <a href=\"#narrow/channel/270676-lean4/topic/Yet.20another.20UInt64.20miscompilation/near/553204350\">said</a>:</p>\n<blockquote>\n<p>I'm curious, how did you even find this bug...?</p>\n</blockquote>\n<p>Finding this bug is pretty easy, the above test is far from an MWE, if you had written <code>def f (x : UInt64) := 0 - x</code> you would've already found it.</p>\n</blockquote>\n<p>This seems to be conflating “finding” and “confirming” the bug. :)</p>",
        "id": 553239698,
        "sender_full_name": "Geoffrey Irving",
        "timestamp": 1762083945
    },
    {
        "content": "<p>I can confirm that <code>leanprover/lean4:v4.26.0-rc1</code> fixes this problem! <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span></p>",
        "id": 558319316,
        "sender_full_name": "Geoffrey Irving",
        "timestamp": 1763592830
    }
]