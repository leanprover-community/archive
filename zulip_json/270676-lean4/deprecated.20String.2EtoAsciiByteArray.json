[
    {
        "content": "<p>since <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/ByteArray.html#String.toAsciiByteArray\">String.toAsciiByteArray</a> is now deprecated in stable, what should i use instead?</p>",
        "id": 467120871,
        "sender_full_name": "David Stainton ðŸ¦¡",
        "timestamp": 1725341839
    },
    {
        "content": "<p>Can you just copy the declaration into your project? What is the use case?</p>",
        "id": 467130973,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725344335
    },
    {
        "content": "<p>I can also just move this to Batteries quickly, and undeprecate it there, if that would be useful.</p>",
        "id": 467131171,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725344393
    },
    {
        "content": "<p>I use it for some of my test cases, as a convenience to produce ByteArray input for testing with. I could easily do something else... but having this live on in Batteries sounds good.</p>",
        "id": 467132158,
        "sender_full_name": "David Stainton ðŸ¦¡",
        "timestamp": 1725344597
    },
    {
        "content": "<p>I also wouldn't mind just putting the declaration in my test code</p>",
        "id": 467132240,
        "sender_full_name": "David Stainton ðŸ¦¡",
        "timestamp": 1725344623
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"736493\">David Stainton ðŸ¦¡</span> <a href=\"#narrow/stream/270676-lean4/topic/deprecated.20String.2EtoAsciiByteArray/near/467120871\">said</a>:</p>\n<blockquote>\n<p>since <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/ByteArray.html#String.toAsciiByteArray\">String.toAsciiByteArray</a> is now deprecated in stable, what should i use instead?</p>\n</blockquote>\n<p>Are you sure you need the ASCII truncating behavior?</p>",
        "id": 467134592,
        "sender_full_name": "Henrik BÃ¶ving",
        "timestamp": 1725345134
    },
    {
        "content": "<p>I do not need the ASCII truncating behavior.. I'm just incidentally using that function... I think I can just replace it with literal ByteArrays.</p>",
        "id": 467135129,
        "sender_full_name": "David Stainton ðŸ¦¡",
        "timestamp": 1725345239
    },
    {
        "content": "<p>If you don't need that you can also just use String.toUTF8</p>",
        "id": 467135535,
        "sender_full_name": "Henrik BÃ¶ving",
        "timestamp": 1725345309
    },
    {
        "content": "<p>perfect. thanks!</p>",
        "id": 467135621,
        "sender_full_name": "David Stainton ðŸ¦¡",
        "timestamp": 1725345326
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/batteries/pull/943\">batteries#943</a> has a note now that will hopefully avoid anyone else using this when they should be using <code>String.toUTF8</code>!</p>",
        "id": 467136595,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725345506
    },
    {
        "content": "<p>Can someone tell me a proper use case for the ASCII variant? Either you'll get the toUTF8 behavior or you'll get some unexpected output because of the modulo, why would people want to use this?</p>",
        "id": 467136990,
        "sender_full_name": "Henrik BÃ¶ving",
        "timestamp": 1725345589
    },
    {
        "content": "<p>If I remember correctly, it was claimed that this function could be faster if you know it's all ASCII.</p>",
        "id": 467137217,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725345622
    },
    {
        "content": "<p>Sounds unlikely that any lean code is going to out pace a probably SIMD optimized mem copy that doesnt care about the contents at all: <a href=\"https://github.com/leanprover/lean4/blob/4a2458b51d4c5cf7b1a72b10d01907f6ca5cc0a2/src/runtime/object.cpp#L1685\">https://github.com/leanprover/lean4/blob/4a2458b51d4c5cf7b1a72b10d01907f6ca5cc0a2/src/runtime/object.cpp#L1685</a></p>",
        "id": 467138434,
        "sender_full_name": "Henrik BÃ¶ving",
        "timestamp": 1725345823
    },
    {
        "content": "<p>On top of that it doesnt even Pre allocate with the correct capacity if I'm seeing that correctly? So for large strings it will even realloc the byte array in flight. If someone was to measure this function would most likely always be notabky slower than toUTF8</p>",
        "id": 467139450,
        "sender_full_name": "Henrik BÃ¶ving",
        "timestamp": 1725345983
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> I'd say we should just deprecate it? It seems to have no performance benefit (and even a penalty) to me.</p>",
        "id": 467139872,
        "sender_full_name": "Henrik BÃ¶ving",
        "timestamp": 1725346062
    },
    {
        "content": "<p>I think this isn't about performance, but about having something like <a href=\"https://docs.python.org/3/library/codecs.html#error-handlers\">Python's <code>str.encode('ascii', errors='replace')</code></a>, which preserves the invariant of one byte per character.</p>",
        "id": 467174567,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1725352982
    }
]