[
    {
        "content": "<p>I have the following command in my <code>lakefile.lean</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">extern_lib</span><span class=\"w\"> </span><span class=\"n\">libffi</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span><span class=\"w\"> </span><span class=\"n\">inputBinFile</span><span class=\"w\"> </span><span class=\"s2\">\"generated-rust-lib/libffi.a\"</span>\n</code></pre></div>\n<p>This creates a <code>.dylib</code> file on MacOS and <code>.so</code> file on Linux. However, on Linux, the <code>.so</code> file subsequently cannot be found:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">loading</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">libffi</span><span class=\"bp\">.</span><span class=\"n\">so</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cannot</span><span class=\"w\"> </span><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">shared</span><span class=\"w\"> </span><span class=\"n\">object</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">No</span><span class=\"w\"> </span><span class=\"n\">such</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">directory</span>\n</code></pre></div>\n<p>I have tried moving the <code>.so</code> file out of the <code>generated-rust-lib</code> directory. Any ideas?</p>",
        "id": 506291524,
        "sender_full_name": "Chase Norman",
        "timestamp": 1742257710
    },
    {
        "content": "<p>Why is it generating a <code>.so</code> file? Do you have <code>precompileModules := true</code>?</p>",
        "id": 506304549,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1742263726
    },
    {
        "content": "<p>Yes</p>",
        "id": 506304597,
        "sender_full_name": "Chase Norman",
        "timestamp": 1742263750
    },
    {
        "content": "<p>As far as I can tell this is necessary for executing the code via FFI in VSCode</p>",
        "id": 506304816,
        "sender_full_name": "Chase Norman",
        "timestamp": 1742263859
    },
    {
        "content": "<p>I'd try moving <code>generated-rust-lib/libffi.a</code> to <code>.lake/build/lib/libffi.a</code> and setting the <code>extern_lib</code> to point to that path instead, just to see if Lake does a better job at finding the <code>.so</code> file</p>",
        "id": 506305431,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1742264161
    },
    {
        "content": "<p>Ah, actually you didn't set the relative path to your lib properly.</p>\n<p>Add a <code>pkg</code> argument to your extern lib and use <code>pkg.dir</code> to teach Lake to point to your lib correctly when your project is being used as a dependency</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">extern_lib</span><span class=\"w\"> </span><span class=\"n\">libffi</span><span class=\"w\"> </span><span class=\"n\">pkg</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">inputBinFile</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">pkg</span><span class=\"bp\">.</span><span class=\"n\">dir</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"s2\">\"generated-rust-lib\"</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"s2\">\"libffi.a\"</span>\n</code></pre></div>",
        "id": 506307805,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1742265296
    }
]