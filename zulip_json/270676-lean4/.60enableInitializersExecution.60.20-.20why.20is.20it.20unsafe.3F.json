[
    {
        "content": "<p>I'm working on a tool that allows the user to run lean code (including mathlib) in an altered environment.  What are the rules to follow if I want to call <code>enableInitializersExecution</code> and then load some Lean files?</p>",
        "id": 486931821,
        "sender_full_name": "Tony Beta Lambda",
        "timestamp": 1733732693
    },
    {
        "content": "<p>It is unsafe for the reason listed in its comments</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/--</span>\n<span class=\"sd\">By default the `initialize` code is not executed when importing .olean files.</span>\n<span class=\"sd\">When this flag is set to `true`, the initializers are executed.</span>\n<span class=\"sd\">This method is meant to be used by the Lean frontend only.</span>\n<span class=\"sd\">Remark: it is not safe to run `initialize` code when using multiple threads.</span>\n<span class=\"sd\">Remark: Any loaded native Lean code must match its imported version. In particular,</span>\n<span class=\"sd\">  no two versions of the same module may be loaded when this flag is set.</span>\n<span class=\"sd\">  No native code may be loaded after its module has been imported.</span>\n<span class=\"sd\">Remark: Compacted module regions must not be freed when using this flag as the</span>\n<span class=\"sd\">  cached initializer results may reference objects in them.</span>\n<span class=\"sd\">Remark: The Lean frontend executes this method at startup time.</span>\n<span class=\"sd\">-/</span>\n</code></pre></div>\n<p>Before you load any Lean files, run</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">unsafe</span><span class=\"w\"> </span><span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">initSearch</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sp</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">Lean.enableInitializersExecution</span>\n<span class=\"w\">  </span><span class=\"n\">Lean.initSearchPath</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">Lean.findSysroot</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 486934675,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1733733463
    },
    {
        "content": "<p>Can you explain the second remark in more details?  I can't seem to understand it.  Does \"native Lean code\" mean \".olean files\"?  How do one load two versions of the same module?  And what does \"No native code may be loaded after ITS module has been imported\" mean?  Does native code have a module associated?  If so, how?</p>",
        "id": 490108445,
        "sender_full_name": "Tony Beta Lambda",
        "timestamp": 1734680243
    }
]