[
    {
        "content": "<p>I've noticed a couple of situations where the pretty-printer uses soft newlines where I would have expected a hard newline. Example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">CoreM</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">thm</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">command</span><span class=\"bp\">|</span>\n<span class=\"w\">    </span><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"n\">simp</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">PrettyPrinter</span><span class=\"bp\">.</span><span class=\"n\">ppCommand</span><span class=\"w\"> </span><span class=\"n\">thm</span>\n\n<span class=\"c1\">-- theorem foo : 1 = 1 := by have : 1 = 1 := by simp</span>\n</code></pre></div>\n<p><span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> do you consider this a bug that should be reported?</p>",
        "id": 524702244,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1750251850
    },
    {
        "content": "<p>I think often people expect one-liner tactics to print in one line.</p>\n<p>Are you suggesting newlines after one or both of these <code>by</code>s?</p>\n<p>It looks like this might be for pretty printing the start of a proof script. I wonder if there should be a special tactic (let's call it <code>HERE%</code> for now) that formats itself as a blank line, and then you could have</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">thm</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">command</span><span class=\"bp\">|</span>\n<span class=\"w\">    </span><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"n\">simp</span>\n<span class=\"w\">      </span><span class=\"n\">HERE</span><span class=\"bp\">%</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 524747076,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1750265176
    },
    {
        "content": "<p>I would definitely expect a hard newline after the first <code>by</code>. Theorem with proof all on one line seems like it would be \"wrong\" more often than \"right\". Though if the goal is to mimic human style very closely, I guess you'd have to distinguish between atomic tactics (<code>:= by simp</code>) and non-atomic tactics (<code>:= by have ... := by simp</code>).</p>\n<p>The second <code>by</code> seems debatable. I would prefer consistency, but I can see the case for concise one-liners.</p>\n<p>The printing-only tactic hack is a nice idea! I'll add this to the tool that sparked this conversation.</p>",
        "id": 524871116,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1750334830
    }
]