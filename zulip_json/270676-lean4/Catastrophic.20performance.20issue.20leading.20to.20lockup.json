[
    {
        "content": "<p>In the github repo linesthatinterlace/controlbits, in the file ArrayPerm.lean, I've recently done what felt like a fairly minor refactor, adding a GetElem instance for the type I define there. Now I'm getting catastrophic performance issues, like full on \"my file is locking up and I have to force a computer reboot\" issues which looks like it's totally consuming all my memory, and I do not understand why. It's very difficult to diagnose or fix the issue because of the lockups. I would really appreciate any urgent help with this - I'm tearing my hair out at it! I could probably walk back the refactor slowly but it'll be pretty hard to do. </p>\n<p>At a minimum if there's a way to stop Lean evaluating the whole file and instead type checking line by line, that might help with diagnosis.</p>",
        "id": 456808453,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1722936646
    },
    {
        "content": "<p>Which OS are you on? On Linux, it is relatively easy to limit memory usage of a process (tree)</p>",
        "id": 456809195,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1722936874
    },
    {
        "content": "<p>Linux</p>",
        "id": 456809217,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1722936881
    },
    {
        "content": "<p>It would be good to understand <em>why</em> it's running out of memory suddenly but I'll take that too.</p>",
        "id": 456809328,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1722936919
    },
    {
        "content": "<p>Having your system still available when that happens seems like a good first debugging step to me :) . Something like <code>(ulimit -v 4000000; code .)</code> for a 4GB limit might work, but I haven't tried. Just make sure it's not reusing any existing VS Code process.</p>",
        "id": 456809929,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1722937138
    },
    {
        "content": "<p>My computer is now not restarting (!)</p>",
        "id": 456809996,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1722937166
    },
    {
        "content": "<p>Really XKCD shark comic hours over here</p>",
        "id": 456810047,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1722937176
    },
    {
        "content": "<p>I'm wondering if it's to do with the VS code update that just dropped somehow</p>",
        "id": 456810088,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1722937195
    },
    {
        "content": "<p>I would be grateful to see if the performance issues replicate on other machines. I thought I'd fixed this before I went to bed last night but now on my work computer they're recurring.</p>",
        "id": 456810230,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1722937238
    },
    {
        "content": "<p>I have enabled Magic SysReq out-of-memory killing which ought to help</p>",
        "id": 456813134,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1722938181
    },
    {
        "content": "<p>rather than hard REISUBing it</p>",
        "id": 456813149,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1722938186
    },
    {
        "content": "<p>Is this related to <a href=\"https://github.com/leanprover/lean4/pull/4920\">lean4#4920</a> ?</p>",
        "id": 456815720,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1722938987
    },
    {
        "content": "<p>Hmm, interesting. I think I've tracked it down to one of my definitions - I think it was having to run <code>get_elem_tactic</code> every time and that was causing slowness... we'll see if giving the proof term directly has fixed it</p>",
        "id": 456815827,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1722939014
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/stream/270676-lean4/topic/Catastrophic.20performance.20issue.20leading.20to.20lockup/near/456815720\">said</a>:</p>\n<blockquote>\n<p>Is this related to <a href=\"https://github.com/leanprover/lean4/pull/4920\">lean4#4920</a> ?</p>\n</blockquote>\n<p>I can't see an obvious link but it is in an adjacent area.</p>",
        "id": 456815935,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1722939050
    }
]