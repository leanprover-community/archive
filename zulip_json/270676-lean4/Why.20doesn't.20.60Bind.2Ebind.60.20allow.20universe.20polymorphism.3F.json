[
    {
        "content": "<p>I just found out that <code>&gt;&gt;=</code> aka <code>Bind.bind</code> requires all intermediate results to stay in the same sort, while more specific binds like <code>Option.bind</code> allow disuniformity:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">section</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î²</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î³</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Inhabited</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Inhabited</span><span class=\"w\"> </span><span class=\"n\">Î²</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Inhabited</span><span class=\"w\"> </span><span class=\"n\">Î³</span><span class=\"o\">]</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">Î²</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î²</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">Î³</span><span class=\"o\">)</span>\n<span class=\"sd\">/--error: Application type mismatch: The argument</span>\n<span class=\"sd\">  g</span>\n<span class=\"sd\">has type</span>\n<span class=\"sd\">  Î² â†’ Option.{w} Î³</span>\n<span class=\"sd\">of sort `Type (max v w)` but is expected to have type</span>\n<span class=\"sd\">  ?m.3 â†’ Option.{w} Î³</span>\n<span class=\"sd\">of sort `Type w` in the application</span>\n<span class=\"sd\">  @Bind.bind.{w, w} Option.{w} (@Monad.toBind.{w, w} Option.{w} instMonadOption.{w}) ?m.3 Î³ ?m.5 g</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">Î³</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&gt;&gt;=</span><span class=\"w\"> </span><span class=\"n\">g</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">Î³</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">bind</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">g</span>\n\n<span class=\"sd\">/--info: Bind.bind.{u, v} {m : Type u â†’ Type v} [self : Bind.{u, v} m] {Î± Î² : Type u} : m Î± â†’ (Î± â†’ m Î²) â†’ m Î² -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Bind</span><span class=\"bp\">.</span><span class=\"n\">bind</span>\n<span class=\"sd\">/--info: Option.bind.{u_1, u_2} {Î± : Type u_1} {Î² : Type u_2} : Option.{u_1} Î± â†’ (Î± â†’ Option.{u_2} Î²) â†’ Option.{u_2} Î² -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">bind</span>\n<span class=\"kn\">end</span>\n</code></pre></div>\n<p>I suspect that allowing different sorts may not make sense for a general monad other than <code>Option</code>, but I find it hard for me to pin down exactly why.</p>",
        "id": 538007151,
        "sender_full_name": "Gravifer",
        "timestamp": 1757168722
    },
    {
        "content": "<p>See <a class=\"message-link\" href=\"/#narrow/channel/270676-lean4/topic/universe.20polymorphic.20IO/near/282613597\">#lean4 &gt; universe polymorphic IO @ ðŸ’¬</a></p>",
        "id": 538007611,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757169052
    },
    {
        "content": "<p>Is it ok if I put similarly novice questions in this thread as well?<br>\nWhy don't we define <code>PUnit</code> and <code>PEmpty</code> with <code>Type</code>instead of <code>Sort</code>?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">PUnit</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The only element of the universe-polymorphic unit type. -/</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">unit</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PUnit</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- `True` is true, and `True.intro` (or more commonly, `trivial`)</span>\n<span class=\"sd\">  is the proof. -/</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span>\n</code></pre></div>\n<p>Since <code>True</code> and <code>False</code> behave like <code>Unit</code> and <code>Empty</code>, I thought the situation would be like that of products</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Prod</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Î²</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"sd\">/--</span>\n<span class=\"sd\">  Constructs a pair. This is usually written `(x, y)` instead of `Prod.mk x y`.</span>\n<span class=\"sd\">  -/</span>\n<span class=\"w\">  </span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"bp\">::</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The first element of a pair. -/</span>\n<span class=\"w\">  </span><span class=\"n\">fst</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The second element of a pair. -/</span>\n<span class=\"w\">  </span><span class=\"n\">snd</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î²</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">And</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- `And.intro : a â†’ b â†’ a âˆ§ b` is the constructor for the And operation. -/</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"bp\">::</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- Extract the left conjunct from a conjunction. `h : a âˆ§ b` then</span>\n<span class=\"sd\">  `h.left`, also notated as `h.1`, is a proof of `a`. -/</span>\n<span class=\"w\">  </span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- Extract the right conjunct from a conjunction. `h : a âˆ§ b` then</span>\n<span class=\"sd\">  `h.right`, also notated as `h.2`, is a proof of `b`. -/</span>\n<span class=\"w\">  </span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span>\n</code></pre></div>",
        "id": 538011715,
        "sender_full_name": "Gravifer",
        "timestamp": 1757172550
    },
    {
        "content": "<p>I just realize there is such a thing as  <code>PProd</code>, just below <code>Prod</code> in the source</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">PProd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Î²</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The first element of a pair. -/</span>\n<span class=\"w\">  </span><span class=\"n\">fst</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The second element of a pair. -/</span>\n<span class=\"w\">  </span><span class=\"n\">snd</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î²</span>\n</code></pre></div>\n<p>but now I'm confused how the universe of the output is deduced</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">PProd</span><span class=\"w\"> </span><span class=\"sd\">/--info:</span>\n<span class=\"sd\">structure PProd.{u, v} (Î± : Sort u) (Î² : Sort v) : Sort (max (max 1 u) v)</span>\n<span class=\"sd\">number of parameters: 2</span>\n<span class=\"sd\">fields:</span>\n<span class=\"sd\">  PProd.fst.{u, v} : Î±</span>\n<span class=\"sd\">  PProd.snd.{u, v} : Î²</span>\n<span class=\"sd\">constructor:</span>\n<span class=\"sd\">  PProd.mk.{u, v} {Î± : Sort u} {Î² : Sort v} (fst : Î±) (snd : Î²) : PProd.{u, v} Î± Î²</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">PProd</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"sd\">/--info: PProd.{0, 0} : Prop â†’ Prop â†’ Type -/</span>\n</code></pre></div>",
        "id": 538011918,
        "sender_full_name": "Gravifer",
        "timestamp": 1757172732
    },
    {
        "content": "<p>I also notice that <code>Unit</code> is abbrev for <code>PUnit.{1}</code> while <code>Empty</code> is unrelated to <code>PEmpty</code>; I feel baffled.</p>\n<hr>\n<p>I tried</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Empty</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">PEmpty</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">1</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">nofun</span><span class=\"w\">  </span><span class=\"c1\">--!error: Missing cases:</span>\n</code></pre></div>\n<p>except there shouldn't be any cases ...?</p>",
        "id": 538012124,
        "sender_full_name": "Gravifer",
        "timestamp": 1757172930
    }
]