[
    {
        "content": "<p>Why do i seem to see everything thrice in the output of the profiler?<br>\nI wouldn't expect to see the part about <code>cases n with</code> 3 times and would directly want to see how long each of the cases take. The second case also seems to print a few things multiple times.<br>\nIs there any way to have less redundancy in the output, but still know the time for each tactic/line?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">profiler</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">profiler</span><span class=\"bp\">.</span><span class=\"n\">threshold</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">nat_case_analysis</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">rw?</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">right</span>\n<span class=\"w\">    </span><span class=\"n\">exists</span><span class=\"w\"> </span><span class=\"n\">k</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p><a href=\"/user_uploads/3121/4mAobFg1O2SCDxWn4emDZqzP/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/4mAobFg1O2SCDxWn4emDZqzP/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1176x954\" src=\"/user_uploads/thumbnail/3121/4mAobFg1O2SCDxWn4emDZqzP/image.png/840x560.webp\"></a></div>",
        "id": 569900576,
        "sender_full_name": "Moritz R",
        "timestamp": 1769285559
    },
    {
        "content": "<p>The output of trace.profiler is not in relation to tactics or lines but in relation to semantically meaningful steps in elaboration that are chosen by the authors of the tactic and the larger Lean eco system. If that happens to print the same thing multiple times because for some situations maybe the output would change at that point while for others it doesn't that's just how it is.</p>",
        "id": 569905489,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1769291205
    },
    {
        "content": "<p>I wish there was an option to not show the parent, if there is exactly one child and this child takes almost the same amount of time as it's parent.</p>",
        "id": 569909420,
        "sender_full_name": "Moritz R",
        "timestamp": 1769295833
    },
    {
        "content": "<p>For larger proofs, using the profiler becomes an exercise in scrolling and clicking on the triangles until one actually finds any different timings from the whole-proof timing. This is often multiple screens of scrolling to do</p>",
        "id": 569909465,
        "sender_full_name": "Moritz R",
        "timestamp": 1769295890
    },
    {
        "content": "<p>Also, we already have the option to threshold away small children nodes, how is this so different from thesholding small intermediate nodes</p>",
        "id": 569949164,
        "sender_full_name": "Moritz R",
        "timestamp": 1769341897
    },
    {
        "content": "<p>Only one of these checks is dirt-cheap. But there may be some low-hanging fruits for removing some of the redundant nodes, please consider opening an issue</p>",
        "id": 569959633,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1769353122
    },
    {
        "content": "<p>Which one of the checks is not cheap?</p>",
        "id": 569959753,
        "sender_full_name": "Moritz R",
        "timestamp": 1769353247
    },
    {
        "content": "<p>(I have no experience with this)</p>",
        "id": 569959772,
        "sender_full_name": "Moritz R",
        "timestamp": 1769353268
    },
    {
        "content": "<p>The one that is not implemented, skipping nested nodes with identical output</p>",
        "id": 569963111,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1769356717
    },
    {
        "content": "<p>Isn't it linear in the number of nodes?<br>\nIf this is too much, one could hide it behind a default-false option still</p>",
        "id": 569963280,
        "sender_full_name": "Moritz R",
        "timestamp": 1769356900
    }
]