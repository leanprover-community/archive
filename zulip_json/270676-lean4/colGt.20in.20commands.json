[
    {
        "content": "<p>I'm trying to make a command that takes a list of identifiers, like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"n\">withPosition</span><span class=\"o\">(</span><span class=\"s2\">\"test\"</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">ns</span><span class=\"o\">:(</span><span class=\"n\">ppSpace</span><span class=\"w\"> </span><span class=\"n\">colGt</span><span class=\"w\"> </span><span class=\"n\">ident</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"{ns}\"</span>\n</code></pre></div>\n<p>Afaiu, <code>colGt</code> should mean that this doesn't work:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n<span class=\"n\">bar</span>\n</code></pre></div>\n<p>But it does and prints <code>[foo, bar]</code>. What am I doing wrong?</p>",
        "id": 471792513,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1726854000
    },
    {
        "content": "<p><code>colGt</code> only works within the scope of a <code>withPosition</code>, that's why <code>withPosition</code> is a combinator and not just a 0-ary parser like <code>colGt</code></p>",
        "id": 471813861,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1726860039
    },
    {
        "content": "<p>it asserts that the current parser column is gt the position of the nearest enclosing <code>withPosition</code>, if there is one</p>",
        "id": 471813949,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1726860076
    },
    {
        "content": "<p>Interesting, the <code>colGt</code>s/<code>checkGolGt</code>s in the builtin commands don't do anything.</p>\n<p>I wonder if a general fix should be to have the top-level command parser use <code>withPosition</code>. This would be like how it's <code>by</code>'s responsibility to use <code>withPosition</code>, that way tactics don't each need to be wrapped in <code>withPosition</code>.</p>",
        "id": 471958337,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1726938633
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/270676-lean4/topic/colGt.20in.20commands/near/471813861\">said</a>:</p>\n<blockquote>\n<p><code>colGt</code> only works within the scope of a <code>withPosition</code>, that's why <code>withPosition</code> is a combinator and not just a 0-ary parser like <code>colGt</code></p>\n</blockquote>\n<p>I am trying to understand this. What is an example of <code>withPosition</code> that <strong>does</strong> work.</p>",
        "id": 472037641,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1727002692
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"266304\">@Siddhartha Gadgil</span> Here's an example where it does work:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span>\n<span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>\n<p>There's an error on <code>h</code> since it's not parsed as an argument to <code>intro</code> since <code>colGt</code> fails for that token. That <code>h</code> is being parsed as if it were a command. The <code>by</code> parser sets up <code>withPosition</code> for all the tactics that follow.</p>",
        "id": 472068558,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1727028173
    },
    {
        "content": "<p>Thanks. What I was asking for was the parser definition which works</p>",
        "id": 472078256,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1727034203
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"n\">withPosition</span><span class=\"o\">(</span><span class=\"s2\">\"test\"</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ppSpace</span><span class=\"w\"> </span><span class=\"n\">colGt</span><span class=\"w\"> </span><span class=\"n\">ident</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span>\n</code></pre></div>",
        "id": 472078379,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727034308
    },
    {
        "content": "<p>you have to separate it from the <code>elab_rules</code> declaration though because the binding syntax doesn't support combinators like this</p>",
        "id": 472078446,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727034347
    }
]