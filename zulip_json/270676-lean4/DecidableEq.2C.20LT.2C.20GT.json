[
    {
        "content": "<p>I've been struggling to define DecidableEq, LT, and LE instances for \"non-direct\" notions of equality — that is, equality different from the default, where, for example,  <a href=\"https://proofassistants.stackexchange.com/questions/4363/how-to-implement-decidableeq-on-a-inductive-datatype-manually-in-lean-4\">in this post</a>, <code>monday = monday</code> and <code>wednesday = wednesday</code>.</p>\n<p>Suppose I want to define NumQ, which is rational -- like:</p>\n<p>inductive NumQ where<br>\n   | rat : Int -&gt; Nat -&gt; NumQ      -- \"rat num den\"</p>\n<p>where I want DecidableEq, LT and LE to consider the comparison by cross multiplication to say that, e.g.:</p>\n<p>(rat 3 4 = rat 30 40) = true.</p>\n<p>How should I define DecidableEq, LT, and LE for NumQ in this way?</p>",
        "id": 541739661,
        "sender_full_name": "André Luiz Feijó dos Santos",
        "timestamp": 1758917953
    },
    {
        "content": "<p>for decidableeq you need to take a quotient</p>",
        "id": 541739998,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1758918113
    },
    {
        "content": "<p>Thanks for answering. Could you give me an example of how to implement it?</p>",
        "id": 541740234,
        "sender_full_name": "André Luiz Feijó dos Santos",
        "timestamp": 1758918221
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">NumQ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">rat</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">NumQ</span><span class=\"w\"> </span><span class=\"c1\">-- \"rat num den\"</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">NumQ</span>\n\n<span class=\"c1\">-- actually it doesn't work like that</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">rat</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"n\">rat</span><span class=\"w\"> </span><span class=\"mi\">30</span><span class=\"w\"> </span><span class=\"mi\">40</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n</code></pre></div>",
        "id": 541740345,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1758918266
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"511683\">André Luiz Feijó dos Santos</span> <a href=\"#narrow/channel/270676-lean4/topic/DecidableEq.2C.20LT.2C.20GT/near/541740234\">said</a>:</p>\n<blockquote>\n<p>Thanks for answering. Could you give me an example of how to implement it?</p>\n</blockquote>\n<p>well Batteries does <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Rat#doc\">docs#Rat</a> differently (it reduces the fractions) and usually we don't like to use <code>Quotient</code> if there's a way to efficiently pick a representative from each equivalence class</p>",
        "id": 541740749,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1758918363
    },
    {
        "content": "<p>since it breaks canonicity</p>",
        "id": 541740881,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1758918415
    },
    {
        "content": "<p>If you want to still know how quotients work:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">PreNumQ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">rat</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">PreNumQ</span><span class=\"w\"> </span><span class=\"c1\">-- \"rat num den\"</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">PreNumQ</span><span class=\"bp\">.</span><span class=\"n\">Eqv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PreNumQ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">rat</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">rat</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"c1\">-- what you want rat a b = rat c d to mean</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">PreNumQ</span><span class=\"bp\">.</span><span class=\"n\">setoid</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Setoid</span><span class=\"w\"> </span><span class=\"n\">PreNumQ</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">PreNumQ</span><span class=\"bp\">.</span><span class=\"n\">Eqv</span>\n<span class=\"w\">  </span><span class=\"n\">iseqv</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"c1\">-- proof that it is an equivalence relation</span>\n<span class=\"w\">    </span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">    </span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">    </span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"o\">}</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">NumQ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Quotient</span><span class=\"w\"> </span><span class=\"n\">PreNumQ</span><span class=\"bp\">.</span><span class=\"n\">setoid</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">NumQ</span><span class=\"bp\">.</span><span class=\"n\">rat</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">NumQ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Quotient</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">rat</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">NumQ</span><span class=\"bp\">.</span><span class=\"n\">rat_eq_rat_iff</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">rat</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">rat</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">PreNumQ</span><span class=\"bp\">.</span><span class=\"n\">Eqv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">rat</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">rat</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">⟨</span><span class=\"n\">Quotient</span><span class=\"bp\">.</span><span class=\"n\">exact</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Quotient</span><span class=\"bp\">.</span><span class=\"n\">sound</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">PreNumQ</span><span class=\"bp\">.</span><span class=\"n\">setoid</span><span class=\"o\">)</span><span class=\"bp\">⟩</span>\n</code></pre></div>",
        "id": 541752141,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758924462
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"511683\">@André Luiz Feijó dos Santos</span> the key concept here is that while <code>&lt;</code> and <code>&lt;=</code> are relations that can be defined arbitrarily, <code>=</code> is actually a core notion of Lean that cannot be changed</p>",
        "id": 541756117,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1758927556
    },
    {
        "content": "<p>In addition to the previous responses, note that <code>==</code> (aka <code>BEq</code>) can be defined arbitrarily. It is, however, required to be decidable since its value is in <code>Bool</code> instead of <code>Prop</code>.</p>",
        "id": 541776063,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1758950101
    },
    {
        "content": "<p>higher inductives when :(</p>",
        "id": 541787923,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1758963374
    },
    {
        "content": "<p>The reference manual explains <a href=\"https://lean-lang.org/doc/reference/latest/find/?domain=Verso.Genre.Manual.section&amp;name=quotients\">quotient types</a> and gives some related examples, in case that's useful.</p>",
        "id": 541848964,
        "sender_full_name": "David Thrane Christiansen",
        "timestamp": 1759018968
    }
]