[
    {
        "content": "<p>I defined a notation and want it to show up in the infoview instead of its definition. Looking at the definitions of notations that do show up in the infoview, like <code>∈</code>, I don't see a difference from mine. What makes this happen?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Set</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span>\n\n<span class=\"kn\">notation</span><span class=\"o\">:</span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">:</span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"s2\">\"~\"</span><span class=\"n\">X</span><span class=\"o\">:</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">:</span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EqOn</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"c1\">-- ⊢ EqOn f g X instead of ⊢ f ~X g</span>\n</code></pre></div>",
        "id": 490679096,
        "sender_full_name": "Nir Paz",
        "timestamp": 1735048336
    },
    {
        "content": "<p>It is because of the parenthesis around <code>EqOn f g X</code> - if you remove them it works (almost, you should do <code>notation:50 f:50 \" ~\"X:max g:50 =&gt; EqOn f g X</code>)</p>",
        "id": 490679299,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1735048476
    },
    {
        "content": "<p>Huh, thanks. Do you know why this happens?</p>",
        "id": 490679386,
        "sender_full_name": "Nir Paz",
        "timestamp": 1735048555
    },
    {
        "content": "<p>I'd guess whatever mechanism is responsible for creating a delaborator for the notation doesn't figure out the head function correctly, but I'm not sure why</p>",
        "id": 490679477,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1735048607
    },
    {
        "content": "<p>If the definition is slightly more complicated, like <br>\n<code>notation:50 f:50 \" ~\"X:max g:50 =&gt; EqOn f g X ∧ False</code><br>\nthen it breaks again.</p>",
        "id": 490679517,
        "sender_full_name": "Nir Paz",
        "timestamp": 1735048655
    },
    {
        "content": "<p><code>notation3</code> works there, I don't know why <code>notation</code> doesn't</p>",
        "id": 490679598,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1735048706
    },
    {
        "content": "<p>Good enough for me! But if someone can explain the difference that's causing this.</p>",
        "id": 490679789,
        "sender_full_name": "Nir Paz",
        "timestamp": 1735048825
    },
    {
        "content": "<p><code>notation:50 f:50 \" ~\"X:max g:50 =&gt; And (EqOn f g X) False</code> also works</p>",
        "id": 490679903,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1735048921
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Elab.Command.mkUnexpander#doc\">docs#Lean.Elab.Command.mkUnexpander</a> says:</p>\n<blockquote>\n<p>Try to derive an unexpander from a notation. The notation must be of the form <code>notation ... =&gt; c body</code> where <code>c</code> is a declaration in the current scope and <code>body</code> any syntax that contains each variable from the LHS at most once.</p>\n</blockquote>",
        "id": 490680010,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1735048981
    },
    {
        "content": "<p>That explains it, but it seems very finicky compared to lean3.</p>",
        "id": 490681151,
        "sender_full_name": "Nir Paz",
        "timestamp": 1735049873
    },
    {
        "content": "<p>Hence the 3 in <code>notation3</code></p>",
        "id": 490682511,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1735050695
    },
    {
        "content": "<p>the reason this is so finicky is because it doesn't have type information, so it can't properly elaborate the syntax and in many cases it has to make guesses about what constants you are talking about</p>",
        "id": 490949093,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1735276189
    },
    {
        "content": "<p>so the current limitation is that you basically have to write it out as just nested constant applications without notation</p>",
        "id": 490949166,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1735276231
    }
]