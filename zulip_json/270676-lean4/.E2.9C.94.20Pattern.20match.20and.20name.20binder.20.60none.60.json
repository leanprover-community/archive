[
    {
        "content": "<p>This is a bit stupid, but I want to destruct a <code>structure</code> that has a field named <code>none</code> into all its fields, as follows:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"w\">  </span><span class=\"n\">other</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span>\n\n<span class=\"c1\">-- This works</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">baz</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Id</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">none</span>\n<span class=\"w\">  </span><span class=\"n\">none</span>\n\n<span class=\"c1\">-- This doesn't work</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Id</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">none</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">other</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"c1\">-- application type mismatch</span>\n<span class=\"w\">  </span><span class=\"n\">none</span>\n\n<span class=\"c1\">-- If it matters: I want to do this kind of matching in a `do` block</span>\n</code></pre></div>\n<p>Is there some way to write the <code>let ⟨none, _other⟩</code> pattern match such that <code>none</code> is _forced_ to be treated as a binder, rather than as a constructor?</p>\n<p>I know I can destruct the fields one by one, as in <code>baz</code>, but I want to generate this kind of destruction (for structures with tens of fields) in a meta-program, and it would be helpful if I could make it generate something readable.</p>",
        "id": 514331885,
        "sender_full_name": "George Pîrlea",
        "timestamp": 1745572421
    },
    {
        "content": "<p>I'm pretty sure this is just because of a poor choice of name (<code>none</code> already is in the root namespace and it has a different meaning!)</p>",
        "id": 514466533,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1745617426
    },
    {
        "content": "<p>if you use <code>none'</code> in <code>bar</code> then it works</p>",
        "id": 514466615,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1745617458
    },
    {
        "content": "<p>I understand that, but as I said, I do want to introduce a new binder called <code>none</code> that shadows the one in the root namespace, similar to the behavior in <code>baz</code>.</p>\n<p>I’m asking if there is some way to do that with the pattern matching syntax.</p>",
        "id": 514568061,
        "sender_full_name": "George Pîrlea",
        "timestamp": 1745695025
    },
    {
        "content": "<p><code>none@_</code> is a workaround</p>",
        "id": 514568614,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1745695452
    },
    {
        "content": "<p>By the way, you can use the pattern <code>{ none := none@_ , .. }</code></p>",
        "id": 514568629,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1745695462
    },
    {
        "content": "<p>Thank you very much. That solves the issue I had!</p>",
        "id": 514746269,
        "sender_full_name": "George Pîrlea",
        "timestamp": 1745827375
    },
    {
        "content": "<p>Interestingly, it seems that the information shown on hover when using this feature is broken:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"w\">  </span><span class=\"n\">other</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Id</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">mut</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">none</span><span class=\"bp\">@_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">other</span><span class=\"bp\">@_⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span>\n<span class=\"w\">  </span><span class=\"c1\">-- bug: hovering over `none` on the LHS shows `Option.none`</span>\n<span class=\"w\">  </span><span class=\"bp\">⟨</span><span class=\"n\">none</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">_⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">⟨</span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">other</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">none</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"bp\">⟩</span>\n</code></pre></div>",
        "id": 514747512,
        "sender_full_name": "George Pîrlea",
        "timestamp": 1745827724
    },
    {
        "content": "<p>Should I report this somewhere?</p>",
        "id": 514747562,
        "sender_full_name": "George Pîrlea",
        "timestamp": 1745827739
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"542918\">George Pîrlea</span> has marked this topic as resolved.</p>",
        "id": 514747588,
        "sender_full_name": "Notification Bot",
        "timestamp": 1745827745
    }
]