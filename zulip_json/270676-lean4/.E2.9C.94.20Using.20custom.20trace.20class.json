[
    {
        "content": "<p>Why does this complain that the option is not defined?</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean.Util</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"n\">builtin_initialize</span>\n<span class=\"w\">  </span><span class=\"n\">registerTraceClass</span><span class=\"w\"> </span><span class=\"ss\">`Mystery</span>\n\n<span class=\"kd\">set_option</span><span class=\"w\"> </span><span class=\"n\">trace.Mystery</span><span class=\"w\"> </span><span class=\"n\">true</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">coreM</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CoreM</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">trace</span><span class=\"o\">[</span><span class=\"n\">Mystery</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"s2\">\"hi\"</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Lean.Environment</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Lean.importModules</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">imports</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"ss\">`Init</span><span class=\"o\">])</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">opts</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{})</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">trustLevel</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">coreM.toIO</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">fileName</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"&lt;mystery&gt;\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">fileMap</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">source</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">positions</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">}}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"n\">IO.println</span><span class=\"w\"> </span><span class=\"s2\">\"hi\"</span>\n</code></pre></div>\n<p>and is there any way to enable the trace class?</p>",
        "id": 505549158,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1741910732
    },
    {
        "content": "<p>I think you have to define the trace class in a different file</p>",
        "id": 505549855,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741911018
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/270676-lean4/topic/Using.20custom.20trace.20class/near/505549855\">said</a>:</p>\n<blockquote>\n<p>I think you have to define the trace class in a different file</p>\n</blockquote>\n<p>Are there any restrictions to using trace classes in another Lean library? In my use case the error shows up even if I enable the trace class in another file.</p>",
        "id": 505553230,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1741912694
    },
    {
        "content": "<p>I think you also need <code>initialize</code> not <code>builtin_initialize</code></p>",
        "id": 505553755,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741912990
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"599027\">Leni Aniva</span> has marked this topic as resolved.</p>",
        "id": 505554099,
        "sender_full_name": "Notification Bot",
        "timestamp": 1741913101
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/270676-lean4/topic/.E2.9C.94.20Using.20custom.20trace.20class/near/505553755\">said</a>:</p>\n<blockquote>\n<p>I think you also need <code>initialize</code> not <code>builtin_initialize</code></p>\n</blockquote>\n<p>Is there a way to make the trace message show up immediately? I realized that all the trace messages are buffered in the coreM monad and I'm discarding them</p>",
        "id": 505556869,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1741914673
    },
    {
        "content": "<p>I assume you can work out how to not discard them. I'm not sure how to avoid buffering them, or if it's even possible</p>",
        "id": 505557248,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741914875
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/270676-lean4/topic/.E2.9C.94.20Using.20custom.20trace.20class/near/505557248\">said</a>:</p>\n<blockquote>\n<p>I assume you can work out how to not discard them. I'm not sure how to avoid buffering them, or if it's even possible</p>\n</blockquote>\n<p>yeah in the end I just <code>printTraces</code> when I need to see the traces</p>",
        "id": 505562001,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1741917472
    }
]