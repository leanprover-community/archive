[
    {
        "content": "<p>I was thinking that maybe the following language construct might be useful.</p>\n<p>Given type with parameters like <code>Foo : Nat ‚Üí Type</code> the term <code>Foo ?n</code> would be equivalent to <code>(n : Nat) √ó Foo n</code>, but, with some additional properties. The point is to think about <code>Foo ?n</code> as <code>Foo n</code> for some arbitrary <code>n</code>. So instances of <code>Foo ?n</code> should behave identically to instances of <code>Foo n</code>. The properties I think we would want from it to achieve this (there might be more) are:</p>\n<ul>\n<li><code>a : Foo ?n</code> is coercible to <code>Foo a.1</code>;</li>\n<li><code>Foo n</code> is coercible to <code>Foo ?n</code>;</li>\n<li>Both coercions should happen implicitly and be essentially \"invisible\" to the user;</li>\n<li>Dot notation for <code>Foo ?n</code> works just like for <code>Foo n</code>.</li>\n</ul>\n<p>We might also want some kind of syntax to be able to refer to parameters of <code>Foo ?n</code>, e.g. <code>a.?n</code>.</p>\n<p>One additional design decision I am unsure about, is that <code>(n : Nat) √ó Foo n</code> forces <code>n</code> to be part of runtime representation. We might want to avoid it, though I am unsure about how to do that, maybe use <code>(n : Erased Nat) √ó Foo n.out</code> instead? In which case we would want, for <code>a : Foo ?n</code>, <code>a.?n</code> to return (noncomputable) <code>Nat</code>, instead of <code>Erased Nat</code>.</p>\n<p>I came up with this idea because of <a class=\"stream-topic\" data-stream-id=\"252551\" href=\"/#narrow/channel/252551-graph-theory/topic/How.20to.20return.20Walk/with/561524867\">#graph theory &gt; How to return Walk</a>. Basically, such a feature would mean I could replace <code>(v : V) √ó G.Walk v v</code> with <code>G.Walk ?v ?v</code> and get all the nice UX-improving properties I listed above.<br>\nAnother place this could potentially be useful is that there's a common problem of coercion between <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Combinatorics/SimpleGraph/Subgraph.html#SimpleGraph.Subgraph\">SimpleGraph.Subgraph</a> and <code>SimpleGraph</code>. Instead of <code>SimpleGraph.Subgraph</code> we could use <code>G' : SimpleGraph (?verts : Set V(G))</code> with some <code>G' ‚â§g G</code> property, which could potentially solve some issues, because now <code>G'</code> is \"almost\" <code>SimpleGraph</code>. It's \"almost\" <code>SimpleGraph</code>, because it's a <code>SimpleGraph</code> with a hole, but the point of defining types with holes as a language construct is that instance of <code>SimpleGraph</code> with hole should behave exactly the same as instance of <code>SimpleGraph</code>.</p>\n<p>One other place this could be useful is that we could define <code>Array Œ±</code> to be <code>Vector Œ± ?size</code>, thus avoiding code duplication between Array and Vector.</p>\n<p>I believe other people can come up with more example of where having to juggle type parameters leads to DTT hell. This feature has a potential of helping in all these cases too.</p>",
        "id": 568355761,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1768538026
    },
    {
        "content": "<p>Maybe someone is aware of a similar feature existing in some other language?</p>",
        "id": 568355891,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1768538081
    },
    {
        "content": "<p>I don't get this, how does it differ from standard implicit arguments?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Foo</span><span class=\"o\">)</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">grind</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>This definitely does NOT make sense as an extension to the kernel logic, perhaps as yet another syntax sugar on top of something but then it would help if you write on top of what exactly.</p>",
        "id": 568495551,
        "sender_full_name": "Mirek Ol≈°√°k",
        "timestamp": 1768587292
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"133339\">Mirek Ol≈°√°k</span> <a href=\"#narrow/channel/270676-lean4/topic/RFC.3A.20Types.20with.20holes/near/568495551\">said</a>:</p>\n<blockquote>\n<p>I don't get this, how does it differ from standard implicit arguments?</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Foo</span><span class=\"o\">)</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">grind</span><span class=\"o\">)</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>My proposition is unlike implicit arguments. Types with holes don't make much sense when used as arguments of definitions, because you can always \"pass\" argument as an implicit argument of definition. But the following doesn't work with implicit arguments:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">mkFoo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n</code></pre></div>\n<p>While you can have:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">mkFoo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n</code></pre></div>\n<p><span class=\"user-mention silent\" data-user-id=\"133339\">Mirek Ol≈°√°k</span> <a href=\"#narrow/channel/270676-lean4/topic/RFC.3A.20Types.20with.20holes/near/568495551\">said</a>:</p>\n<blockquote>\n<p>This definitely does NOT make sense as an extension to the kernel logic [...]</p>\n</blockquote>\n<p>I don't think we need to extend kernel logic to implement this. Except maybe ¬´Both coercions should happen implicitly and be essentially \"invisible\" to the user¬ª part?</p>",
        "id": 568497852,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1768588055
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 568497908,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1768588074
    },
    {
        "content": "<p>Write more basic examples of Lean code with your features. It is hard to follow what you want.</p>",
        "id": 568507277,
        "sender_full_name": "Mirek Ol≈°√°k",
        "timestamp": 1768591243
    },
    {
        "content": "<p>I think you're asking for</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">badCoeSort</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CoeSort</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">coe</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Sigma</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">wat</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Vector</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">v</span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">]</span><span class=\"bp\">‚ü©</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">badCoeSortTrans</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Œ≤</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CoeSort</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CoeSort</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">coe</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">Œ£</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">wat2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Vector</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">Int</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">v</span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">]</span><span class=\"bp\">‚ü©</span>\n</code></pre></div>",
        "id": 568513798,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1768593679
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/270676-lean4/topic/RFC.3A.20Types.20with.20holes/near/568513798\">said</a>:</p>\n<blockquote>\n<p>I think you're asking for</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">badCoeSort</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CoeSort</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">coe</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Sigma</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">wat</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Vector</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">v</span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">]</span><span class=\"bp\">‚ü©</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">badCoeSortTrans</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Œ≤</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CoeSort</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CoeSort</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">coe</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">Œ£</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">wat2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Vector</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">Int</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">v</span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">]</span><span class=\"bp\">‚ü©</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Hm, kinda? But that's just small portion. Dot notation for <code>wat</code> (e.g. <code>#check wat.push</code>) doesn't work. And given function <code>foo : Vector Int n ‚Üí Œ≤</code> <code>foo wat</code> should also work. So basically coercion from <code>xs : Sigma (Vector Int)</code> to <code>Vector Int xs.1</code>.</p>",
        "id": 568533369,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1768601930
    },
    {
        "content": "<p>I've modified my code from <a class=\"message-link\" href=\"/#narrow/channel/217875-Is-there-code-for-X.3F/topic/bipartite.20iff.20does.20not.20contain.20an.20odd.20cycle/near/536817520\">#Is there code for X? &gt; bipartite iff does not contain an odd cycle @ üí¨</a> to show how I would imagine this feature. I've commented parts of the original code for comparison.<br>\nThere's some bug with copy-pasting long code here in zulip, so here's a link: <a href=\"https://live.lean-lang.org/#codez=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\">https://live.lean-lang.org/...</a></p>",
        "id": 568534630,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1768602600
    },
    {
        "content": "<p>Hm, maybe, what I would want is for the following code to work, i.e. Lean should automatically deduce the type for <code>mkFoo</code>, like in <code>mkFoo'</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">mkFoo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">mkFoo'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 568539704,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1768606416
    },
    {
        "content": "<p>I see, this is the eternal dilemma between bundled &amp; unbundled datastructures. By the way, was it you who was saying that <code>Finset</code> is not needed as a bundled \"Set which is finite\" because it can be always written separately <span aria-label=\"wink\" class=\"emoji emoji-1f609\" role=\"img\" title=\"wink\">:wink:</span> ? Here, working with a bundled <code>Walk</code> seems better (but I get the difference, the bundled <code>Walk</code> carries data). I indeed don't think you want types with <code>match</code> -- that leads to most of DTT hell.</p>\n<p>Regarding the <code>Walk</code> code you linked in live lean: You can add a coercion (like Eric said), something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CoeOut</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">Œ£</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">coe</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">‚ü©</span>\n</code></pre></div>\n<p>With this, you don't have to write <code>‚ü®_, cycle‚ü©</code>, and it is sufficient to write <code>cycle</code>.<br>\nI don't know how you imagined coercion from <code>Walk.nil</code> to work since it is very non-obvious that you want to store <code>u</code> inside.<br>\nRegarding dot notation, it is a little hack on itself, and I am rather impressed how well it works (unfolds definitions). People usually accept writing some extra <code>.2</code> inside.</p>",
        "id": 568601988,
        "sender_full_name": "Mirek Ol≈°√°k",
        "timestamp": 1768669366
    },
    {
        "content": "<p>Here it's index parameters vs structure field. Which is e.g. <code>G.Walk u v</code> vs <code>G.Walk</code>.</p>\n<p>That's I think very much different than bundled vs unbundled. Which is e.g. <code>Finset Œ±</code> vs <code>(s : Set Œ±)</code>+<code>s.Finite</code> as separate arguments.</p>\n<p>Unless there's a connection between the two I'm not seeing?</p>",
        "id": 568603276,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1768670678
    },
    {
        "content": "<p>isn't that the same thing</p>",
        "id": 568603359,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1768670751
    },
    {
        "content": "<p>if you have it as structure field then compared to having it as an index you've bundled in the index into the structure</p>",
        "id": 568603370,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1768670770
    },
    {
        "content": "<p>Hmm, you're kinda right. There is some connection, but I wouldn't say it's the same.</p>\n<p>Let's say you have <code>foo : Finset Œ±</code>. Then \"unbudling\" it would mean defining first <code>foo : Set Œ±</code>, and then <code>foo_fin : foo.Finite</code>.</p>\n<p>Let's say you have <code>bar : G.Walk'</code>. By <code>G.Walk'</code> I mean the type of walks without index parameters for first and last vertex. \"Unbudling\" <code>bar</code> would mean first defining <code>bar_u : V</code> and <code>bar_v : V</code>, and then defining <code>bar : G.Walk bar_u bar_v</code>.</p>\n<p>In the first case, you first write more generic definition, and then prove desired property. In the latter case you first have to define indices separately, and only then you can state the definition.</p>",
        "id": 568603781,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1768671140
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"870257\">Jakub Nowak</span> <a href=\"#narrow/channel/270676-lean4/topic/RFC.3A.20Types.20with.20holes/near/568603781\">said</a>:</p>\n<blockquote>\n<p>Hmm, you're kinda right. There is some connection, but I wouldn't say it's the same.</p>\n</blockquote>\n<p>Depending on the definition of \"same\" <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 568604060,
        "sender_full_name": "Mirek Ol≈°√°k",
        "timestamp": 1768671443
    },
    {
        "content": "<p>The difference is that <code>Walk u u</code> is a <code>Type</code>, and <code>Set.Finite s</code> is a <code>Prop</code>.</p>",
        "id": 568604170,
        "sender_full_name": "Mirek Ol≈°√°k",
        "timestamp": 1768671541
    },
    {
        "content": "<p>As long as you treat <code>Prop</code> and <code>Type</code> the same way (and Lean's syntax does that to a great extent), it is the same.</p>",
        "id": 568604225,
        "sender_full_name": "Mirek Ol≈°√°k",
        "timestamp": 1768671589
    },
    {
        "content": "<p>Sorry, I think I've lost you. What are you referring to now?</p>",
        "id": 568604263,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1768671634
    },
    {
        "content": "<p>I was explaining that bundling type parameters and bundling properties are different things.</p>",
        "id": 568604296,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1768671668
    },
    {
        "content": "<p>Oh, I was saying that bundled \"finite set\", and bundled \"walk with arbitrary endpoints\" are kind of the same.</p>",
        "id": 568604377,
        "sender_full_name": "Mirek Ol≈°√°k",
        "timestamp": 1768671735
    },
    {
        "content": "<p>Ah, I think I've got your point. Hm, you're right. <code>Walk u u</code> and <code>Set.Finite s</code> are in fact the same thing for the purpose of this discussion.</p>",
        "id": 568604627,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1768671960
    },
    {
        "content": "<p>Hm, I think we've got offtopic here. The main discussion of this topic was how to handle e.g. <code>Walk u u</code> when <code>u</code> cannot be easily defined.</p>",
        "id": 568604725,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1768672050
    },
    {
        "content": "<p>I didn't see such case in the linked example in live lean.</p>",
        "id": 568604787,
        "sender_full_name": "Mirek Ol≈°√°k",
        "timestamp": 1768672131
    },
    {
        "content": "<p>Another idea I've got is that given</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">odd_cycle_of_odd_walk_step</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">pref</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">suf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">suf</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">nil</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Walk</span><span class=\"bp\">.</span><span class=\"n\">nil</span><span class=\"bp\">‚ü©</span><span class=\"w\"> </span><span class=\"c1\">-- unreachable</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">cons'</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">hAdj</span><span class=\"w\"> </span><span class=\"n\">suf'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"n\">pref</span><span class=\"bp\">.</span><span class=\"n\">support</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">pref_pre_part</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">pref</span><span class=\"bp\">.</span><span class=\"n\">takeUntil</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">pref_cycle_part</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">pref</span><span class=\"bp\">.</span><span class=\"n\">dropUntil</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">cycle</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"n\">hAdj</span><span class=\"w\"> </span><span class=\"n\">pref_cycle_part</span>\n<span class=\"w\">      </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">cycle</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"bp\">.</span><span class=\"n\">bodd</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">        </span><span class=\"bp\">‚ü®</span><span class=\"n\">v</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">cycle</span><span class=\"bp\">‚ü©</span>\n<span class=\"w\">      </span><span class=\"k\">else</span>\n<span class=\"w\">        </span><span class=\"n\">odd_cycle_of_odd_walk_step</span><span class=\"w\"> </span><span class=\"n\">pref_pre_part</span><span class=\"w\"> </span><span class=\"n\">suf'</span>\n<span class=\"w\">    </span><span class=\"k\">else</span>\n<span class=\"w\">      </span><span class=\"n\">odd_cycle_of_odd_walk_step</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">pref</span><span class=\"bp\">.</span><span class=\"n\">concat</span><span class=\"w\"> </span><span class=\"n\">hAdj</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">suf'</span>\n</code></pre></div>\n<p>Lean could automatically define the following two definitions:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">odd_cycle_of_odd_walk_step_aux_w</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">pref</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">suf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">suf</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">nil</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">u</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">cons'</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">hAdj</span><span class=\"w\"> </span><span class=\"n\">suf'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"n\">pref</span><span class=\"bp\">.</span><span class=\"n\">support</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">pref_pre_part</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">pref</span><span class=\"bp\">.</span><span class=\"n\">takeUntil</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">pref_cycle_part</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">pref</span><span class=\"bp\">.</span><span class=\"n\">dropUntil</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">cycle</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"n\">hAdj</span><span class=\"w\"> </span><span class=\"n\">pref_cycle_part</span>\n<span class=\"w\">      </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">cycle</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"bp\">.</span><span class=\"n\">bodd</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">        </span><span class=\"n\">v</span>\n<span class=\"w\">      </span><span class=\"k\">else</span>\n<span class=\"w\">        </span><span class=\"n\">odd_cycle_of_odd_walk_step_aux_w</span><span class=\"w\"> </span><span class=\"n\">pref_pre_part</span><span class=\"w\"> </span><span class=\"n\">suf'</span>\n<span class=\"w\">    </span><span class=\"k\">else</span>\n<span class=\"w\">      </span><span class=\"n\">odd_cycle_of_odd_walk_step_aux_w</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">pref</span><span class=\"bp\">.</span><span class=\"n\">concat</span><span class=\"w\"> </span><span class=\"n\">hAdj</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">suf'</span>\n\n<span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">odd_cycle_of_odd_walk_step</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">pref</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">suf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">odd_cycle_of_odd_walk_step_aux_w</span><span class=\"w\"> </span><span class=\"n\">pref</span><span class=\"w\"> </span><span class=\"n\">suf</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">odd_cycle_of_odd_walk_step_aux_w</span><span class=\"w\"> </span><span class=\"n\">pref</span><span class=\"w\"> </span><span class=\"n\">suf</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">suf</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">nil</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Walk</span><span class=\"bp\">.</span><span class=\"n\">nil</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">cons'</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">hAdj</span><span class=\"w\"> </span><span class=\"n\">suf'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"n\">pref</span><span class=\"bp\">.</span><span class=\"n\">support</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">pref_pre_part</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">pref</span><span class=\"bp\">.</span><span class=\"n\">takeUntil</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">pref_cycle_part</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">pref</span><span class=\"bp\">.</span><span class=\"n\">dropUntil</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">cycle</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"n\">hAdj</span><span class=\"w\"> </span><span class=\"n\">pref_cycle_part</span>\n<span class=\"w\">      </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">cycle</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"bp\">.</span><span class=\"n\">bodd</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">        </span><span class=\"n\">cycle</span>\n<span class=\"w\">      </span><span class=\"k\">else</span>\n<span class=\"w\">        </span><span class=\"n\">odd_cycle_of_odd_walk_step</span><span class=\"w\"> </span><span class=\"n\">pref_pre_part</span><span class=\"w\"> </span><span class=\"n\">suf'</span>\n<span class=\"w\">    </span><span class=\"k\">else</span>\n<span class=\"w\">      </span><span class=\"n\">odd_cycle_of_odd_walk_step</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">pref</span><span class=\"bp\">.</span><span class=\"n\">concat</span><span class=\"w\"> </span><span class=\"n\">hAdj</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">suf'</span>\n</code></pre></div>\n<p>But that's very similar to what I described <a href=\"#narrow/channel/270676-lean4/topic/RFC.3A.20Types.20with.20holes/near/568539704\">here</a>, and you're saying this would likely lead to DTT hell.</p>",
        "id": 568604843,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1768672213
    },
    {
        "content": "<p>What do you mean with <code>unreachable</code>?</p>",
        "id": 568605012,
        "sender_full_name": "Mirek Ol≈°√°k",
        "timestamp": 1768672406
    },
    {
        "content": "<p>If you can prove that the case cannot happen, you can use <code>False.elim</code> there.</p>",
        "id": 568605090,
        "sender_full_name": "Mirek Ol≈°√°k",
        "timestamp": 1768672455
    },
    {
        "content": "<p>Ah, it doesn't matter, it's a leftover from where I copied this code from. This case doesn't happen, but with some additional assumptions that are part of the theorem about this definition but not the definition itself.</p>",
        "id": 568605128,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1768672507
    },
    {
        "content": "<p>I would indeed prefer to use bundled walk here. What is wrong with bundled walks (Sigma type) except you sometimes have to insert <code>.2</code>?</p>",
        "id": 568605603,
        "sender_full_name": "Mirek Ol≈°√°k",
        "timestamp": 1768672943
    },
    {
        "content": "<p>That and the fact that dot-notation isn't working.</p>",
        "id": 568605733,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1768673007
    },
    {
        "content": "<p>It is when you insert <code>.2</code></p>",
        "id": 568605805,
        "sender_full_name": "Mirek Ol≈°√°k",
        "timestamp": 1768673077
    },
    {
        "content": "<p>Hm, true.</p>",
        "id": 568605829,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1768673093
    },
    {
        "content": "<p>I think that having to insert <code>.2</code> sometimes is a thing that's worth trying to improve. This is an instance of manual coercion. I found things like that slowing me down when writing proofs and it's an additional thing I have to keep track of in a limited context window of my brain.</p>",
        "id": 568605905,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1768673156
    },
    {
        "content": "<p>I kind of get it, you could ask for a fix in two places</p>\n<ul>\n<li>(a) You could want <code>Walk</code> to be unbundled by default, or to have an unbundled alternative. This would require changing some graph theory in Mathlib, I suppose there are other places where unbundled walk is better, so it needs either (a.1) convince others that bundled walks are better, or (a.2) create a parallel structure for bundled walks.</li>\n<li>(b) Smoother transition between bundled &amp; unbundled datastructures. If this can be done well, it could help many people, however doing it well is a hard preliminary to accomplish. Then you should take a more principled approach, look at pain points that occur in practice in more general than in your specific use case. Algebraic structures (they are currently mostly unbundled, and done with typeclasses), finite sets, ... I don't know how to do it well, and so far, I am not really convinced by <code>Walk ?w ?w</code>.</li>\n</ul>",
        "id": 568606655,
        "sender_full_name": "Mirek Ol≈°√°k",
        "timestamp": 1768673837
    }
]