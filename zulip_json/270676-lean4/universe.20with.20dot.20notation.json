[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">inv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">})</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">inv</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"c1\">-- invalid use of explicit universe parameters, 'x' is a local variable</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">inv</span><span class=\"w\"> </span><span class=\"c1\">-- succeeds</span>\n</code></pre></div>",
        "id": 523773815,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1749739626
    },
    {
        "content": "<p>Is it intentional that <code>.{u}</code> notation cannot be used with dot notation?</p>",
        "id": 523773856,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1749739637
    },
    {
        "content": "<p>it can, just not when <code>x</code> is a variable:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">inv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">universe</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">inv</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">}</span>\n</code></pre></div>",
        "id": 523775101,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1749740033
    },
    {
        "content": "<p>sure, but it could still be useful when x is a variable</p>",
        "id": 523775374,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1749740109
    },
    {
        "content": "<p>There's no syntax for dot notation (you can check that <code>(x).inv.{u}</code> is a syntax error).</p>\n<p>True dot notation is <code>(x).inv</code>, and when you write <code>x.inv</code>, what happens is that the elaborator sees that <code>x.inv</code> isn't a constant, so it automatically splits the last name component off and tries <code>(x).inv</code>. This is why <code>x.inv.{u}</code> parses at all.</p>\n<p>I think it's clear you've found a bug. I'm not sure it was intentional that <code>x.inv.{u}</code> even attempts to elaborate. Could you file a Lean 4 issue? I think it's reasonable to ask for this new feature in that issue as well.</p>",
        "id": 523775396,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1749740115
    },
    {
        "content": "<p>i suspect this tries to apply the universe level to <code>x</code>?</p>",
        "id": 523775652,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1749740176
    },
    {
        "content": "<p>but when it's a variable, it already has a universe level, so it complains</p>",
        "id": 523775726,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1749740193
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/channel/270676-lean4/topic/universe.20with.20dot.20notation/near/523775652\">said</a>:</p>\n<blockquote>\n<p>i suspect this tries to apply the universe level to <code>x</code>?</p>\n</blockquote>\n<p>Yes, that's what the error is indicating.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/channel/270676-lean4/topic/universe.20with.20dot.20notation/near/523775726\">said</a>:</p>\n<blockquote>\n<p>but when it's a variable, it already has a universe level, so it complains</p>\n</blockquote>\n<p>No,  given that it's apparently interpreting <code>x.inv.{u}</code> as <code>(x.{u}).inv</code>, the issue is that only <code>Expr.const</code> has universe levels. This <code>x</code> is a local variable (an <code>Expr.fvar</code>).</p>",
        "id": 523775963,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1749740256
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/270676-lean4/topic/universe.20with.20dot.20notation/near/523775963\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/channel/270676-lean4/topic/universe.20with.20dot.20notation/near/523775726\">said</a>:</p>\n<blockquote>\n<p>but when it's a variable, it already has a universe level, so it complains</p>\n</blockquote>\n<p>No, the issue is that only <code>Expr.const</code> has universe levels. This <code>x</code> is a local variable (an <code>Expr.fvar</code>).</p>\n</blockquote>\n<p>i feel like we're saying the same thing here?</p>",
        "id": 523776179,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1749740320
    },
    {
        "content": "<p>This came up in a PR as <code>P.Obj.{v}</code> for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=PFunctor.Obj#doc\">docs#PFunctor.Obj</a>, which wasn't legal and we had to write <code>Obj.{v} P</code> instead.</p>",
        "id": 523776561,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749740428
    },
    {
        "content": "<p>Created <a href=\"https://github.com/leanprover/lean4/pull/8743\">lean4#8743</a></p>",
        "id": 523776608,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1749740437
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/channel/270676-lean4/topic/universe.20with.20dot.20notation/near/523776179\">said</a>:</p>\n<blockquote>\n<p>i feel like we're saying the same thing here?</p>\n</blockquote>\n<p>(It doesn't make sense to say <code>x</code> already has a universe level. Local variables don't have universe levels at all.)</p>",
        "id": 523776751,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1749740480
    },
    {
        "content": "<p>right, i guess the way to phrase it is \"there are no free universe variables to fill in the type\"?</p>",
        "id": 523777694,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1749740739
    },
    {
        "content": "<p>That's still inaccurate â€” it's about filling in the universe levels of a constant; constants need to be instantiated with particular universe levels. The types of expressions doesn't come into this.</p>",
        "id": 523778511,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1749740961
    }
]