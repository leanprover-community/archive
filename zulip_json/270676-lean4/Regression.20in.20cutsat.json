[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">cutsat</span>\n</code></pre></div>\n<p>This works in Lean 4.25.1 but fails in Lean 4.26.0-rc2 (and <code>lia</code> and <code>grind</code> also fail on 4.26.0-rc2). Does anyone know what changed that could have caused this? </p>\n<p>(<a href=\"https://github.com/leanprover/lean4/pull/11515\">lean4#11515</a>)</p>",
        "id": 561929374,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1764867092
    },
    {
        "content": "<p>Well, <code>4 ^ (m + 1)</code> used to be normalized to <code>4 ^ m * 4</code>, however that caused <a href=\"https://github.com/leanprover/lean4/pull/10661\">lean4#10661</a>, so that normalizer got replaced by a propagator which is less powerful -- instead of <code>4</code> being a nice constant, it is hidden behind an equality and then <code>grind</code> fails for the same reason that <code>grind</code> can't do:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"bp\">∣</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"bp\">∣</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">grind</span>\n</code></pre></div>\n<p>which is that <code>grind</code> or more specifically the <code>cutsat</code> module works with linear integer arithmetic, and multiplying two variables is well ... not linear</p>",
        "id": 561936678,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1764869070
    },
    {
        "content": "<p>Bah, so this is all my fault! It's annoying though that we can't solve both of these goals simultaneously...</p>",
        "id": 561966806,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1764879306
    },
    {
        "content": "<p>One thing which isn't clear to me is why <code>grind [Nat.pow_succ]</code> also doesn't work, since now it should be explicitly using this lemma instead of (or as well as) the propagator. But <code>grind [Nat.pow_succ, = Nat.mul_assoc]</code> does work, even though the ring module should already know about associativity?</p>",
        "id": 561969686,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1764880466
    },
    {
        "content": "<p>Huh, and <code>grind [= Nat.mul_assoc]</code> solves my original goal... That's surprising to me, but it's a short fix at least</p>",
        "id": 561970074,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1764880607
    },
    {
        "content": "<p>Solved in <a href=\"https://github.com/leanprover/lean4/pull/11519\">lean4#11519</a></p>",
        "id": 562019581,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1764909567
    }
]