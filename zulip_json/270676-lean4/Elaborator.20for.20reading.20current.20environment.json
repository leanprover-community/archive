[
    {
        "content": "<p>Is there an elaborator that allows me to read values from the currently-being-elaborated environment? Ideally I want to do something like <code>withEnv% (fun env =&gt; myEnvironmentExtension.getState env)</code>.</p>\n<p>Context: the <code>lint-style</code> script is controlled by the linter options from a project's lakefile. To support linter sets, we need to look in the corresponding environment extension which linters belong to which set. We <a href=\"https://github.com/leanprover-community/mathlib4/blob/07c736302f5e38ea8a89a00b33240f4542e3e527/scripts/lint-style.lean#L152\">currently do this</a> by importing a specific file (<code>Mathlib.Tactic.Linter.TextBased</code>) and reading out its environment. But this does not work anymore since <a href=\"https://github.com/leanprover/lean4/pull/6325\">lean4#6325</a>, which disables loading extensions in <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.withImportModules#doc\">docs#Lean.withImportModules</a>. We can work around this by calling <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.importModules#doc\">docs#Lean.importModules</a> directly. But maybe there is a better way to do this?</p>",
        "id": 539048336,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1757678940
    },
    {
        "content": "<p>I would probably suggest writing a one-off elaborator that persists the information into e.g. a generated <code>def</code>?</p>",
        "id": 539049851,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1757679358
    },
    {
        "content": "<p>Thanks! For future reference, I ended up going with:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- Return the linter sets defined at this point of elaborating the current file. -/</span>\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"linter_sets%\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">toExpr</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">linterSetsExt</span><span class=\"bp\">.</span><span class=\"n\">getState</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">getEnv</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>(After defining a <code>ToExpr LinterSets</code> instance.)</p>",
        "id": 539062001,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1757682773
    }
]