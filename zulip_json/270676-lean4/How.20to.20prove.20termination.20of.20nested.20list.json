[
    {
        "content": "<p>The function below fails to prove termination at <code>loop</code> of line 5</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">NestedList</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">nl</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">NestedList</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">NestedList</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">loop</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">NestedList</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">NestedList</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">nl</span><span class=\"w\"> </span><span class=\"n\">lss</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">nl</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">loop</span><span class=\"w\"> </span><span class=\"n\">lss</span><span class=\"o\">)</span>\n<span class=\"n\">termination_by</span><span class=\"w\"> </span><span class=\"n\">lss</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">sizeOf</span><span class=\"w\"> </span><span class=\"n\">lss</span>\n</code></pre></div>\n<p>The error message says:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">lss</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">NestedList</span>\n<span class=\"n\">a</span><span class=\"bp\">✝</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">NestedList</span>\n<span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"n\">sizeOf</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">✝</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">sizeOf</span><span class=\"w\"> </span><span class=\"n\">lss</span>\n</code></pre></div>\n<p>but where does a✝ come from?<br>\nSince we don't know it, it seems termination proof is impossible for this function. or we cannot prove this kind of termination problem using sizeOf?</p>",
        "id": 479037189,
        "sender_full_name": "Rikiya Kashiwagi",
        "timestamp": 1729935794
    },
    {
        "content": "<p>it comes from the unfolding of <code>List.map</code></p>",
        "id": 479038803,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1729937380
    },
    {
        "content": "<p>in the literal context where it applies <code>loop</code> , lean doesn't know that <code>a</code> was orignally a member of <code>lss</code>. using <code>lss.attach.map (fun ⟨a,_⟩ =&gt; loop a)</code> might fix this</p>",
        "id": 479038907,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1729937496
    },
    {
        "content": "<p>(what that does is add the hypothesis <code>a \\in lss</code> to the context of the term <code>loop a</code>)</p>",
        "id": 479039199,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1729937800
    },
    {
        "content": "<p>Thanks, it worked. <br>\nI hope that somehow the error message will imply such a solution in the future.</p>",
        "id": 479040454,
        "sender_full_name": "Rikiya Kashiwagi",
        "timestamp": 1729939027
    },
    {
        "content": "<p>We're thinking about it! (Even some ideas so you don't need to write the <code>attach</code> in the first place.)</p>",
        "id": 479175517,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1730073366
    }
]