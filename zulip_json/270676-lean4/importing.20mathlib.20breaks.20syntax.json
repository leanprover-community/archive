[
    {
        "content": "<p>Hi, the following snippet is parsed correctly:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">xss</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">[[</span><span class=\"mi\">2</span><span class=\"o\">]]</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">xss</span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">]</span><span class=\"bp\">!</span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">]</span><span class=\"bp\">!</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n</code></pre></div>\n<p>However, if I import this file from mathlib, I get an error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">SpecialFunctions</span><span class=\"bp\">.</span><span class=\"n\">Trigonometric</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">xss</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">[[</span><span class=\"mi\">2</span><span class=\"o\">]]</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">xss</span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">]</span><span class=\"bp\">!</span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">]</span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"c1\">--unexpected token '!['; expected command</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n</code></pre></div>\n<p>I believe this is caused by some notation defined in the mathlib file that conflicts with the <code>get!</code> notation. Is there a way to import just the definitions from the mathlib file, without the notation? Or maybe another way to fix this problem so I can have both the notation and the import?</p>",
        "id": 542498318,
        "sender_full_name": "Tomaz Mascarenhas",
        "timestamp": 1759326019
    },
    {
        "content": "<p>I expect that this conflicts with the <code>![a, b, c]</code> notation for vectors in Mathlib (in a much lower-level file).<br>\nThe answer is that currently it's not possible to not import notation.</p>",
        "id": 542499243,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1759326243
    },
    {
        "content": "<p>Is <code>(xss[0]!)[0]!</code> acceptable as a workaround for now?</p>",
        "id": 542499308,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1759326258
    },
    {
        "content": "<p>I think so, thanks!</p>",
        "id": 542499399,
        "sender_full_name": "Tomaz Mascarenhas",
        "timestamp": 1759326281
    },
    {
        "content": "<p>Only marginally related, @Lean core team: Maybe <code>xss[0, 0]!</code> would be nice notation for this?</p>",
        "id": 542500082,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1759326436
    },
    {
        "content": "<p>Can we change the precedence to fix this?</p>",
        "id": 542533585,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759334714
    },
    {
        "content": "<p>Or perhaps split the token in two</p>",
        "id": 542533649,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759334728
    },
    {
        "content": "<p>Yeah, right, <code>\"!\" noWs \"[\"</code> for example</p>",
        "id": 542622458,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1759357056
    },
    {
        "content": "<p>I think the vector notation should also be <code>scoped</code> (regardless of any other fixes we might choose).</p>",
        "id": 542628123,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1759360368
    },
    {
        "content": "<p>Is <code>v[...]</code> or <code>#[...]</code> notation scoped?</p>",
        "id": 542672163,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759390408
    },
    {
        "content": "<p>I'd rather keep <code>![...]</code> global in the same way as <code>#v[...]</code> and <code>#[...]</code></p>",
        "id": 542719226,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1759405217
    },
    {
        "content": "<p>Somewhat unrelatedly, what happened to the nice plan of making <code>![...]</code> reduce to a recursor in reducible transparency, so that its applications can be reduced in <code>rw</code> and type class search?</p>",
        "id": 542719527,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1759405326
    },
    {
        "content": "<p>similarly I don't think scoping notations is the solution to every problem. maybe putting <code>atomic</code> on <code>]!</code> or <code>![</code> might solve the problem?</p>",
        "id": 542719546,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759405333
    },
    {
        "content": "<p>Doesn't the tokenization happen before parsing? So changing the parser wouldn't fix the problem of getting the wrong token?</p>",
        "id": 542720024,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1759405490
    },
    {
        "content": "<p>Yes, we need to avoid getting a <code>\"![\"</code> token in the first place, so separating them into two tokens in the <code>![...]</code> parser is the way to go.</p>",
        "id": 542782812,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1759421838
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/270676-lean4/topic/importing.20mathlib.20breaks.20syntax/near/542719546\">said</a>:</p>\n<blockquote>\n<p>I don't think scoping notations is the solution to every problem.</p>\n</blockquote>\n<p>I think we should scope virtually <em>all</em> notations, maybe with a feature to have some scopes open by default, but also with the ability to close scopes. (And as I said, this is orthogonal to whether we implement other fixes to this specific issue.)</p>",
        "id": 542783418,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1759422019
    },
    {
        "content": "<p>I would also complain less if the docgen opens scoped syntax</p>",
        "id": 542783492,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759422045
    }
]