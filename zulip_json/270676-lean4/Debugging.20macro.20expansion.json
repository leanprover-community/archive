[
    {
        "content": "<p>How can I see what a macro has expanded to at its use site? I have a macro with syntax that produces a type error, but I can't work out how to see the syntax. <code>dbg_trace</code> isn't very useful because it can't pretty-print the <code>Syntax</code> object (as the pretty printer can't be called from <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MacroM#doc\">docs#MacroM</a>)</p>",
        "id": 402096026,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1700007199
    },
    {
        "content": "<p>set_option pp.macroStack true?</p>",
        "id": 402096872,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1700007495
    },
    {
        "content": "<p>That seems to expand much further than I was hoping; I want to expand only my current macro</p>",
        "id": 402097524,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1700007798
    },
    {
        "content": "<p>(also <a href=\"https://github.com/leanprover/lean4/pull/2878\">lean4#2878</a> to fix the documentation for that option)</p>",
        "id": 402097552,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1700007811
    },
    {
        "content": "<p>Ah, it's a call stack with the least expanded version at the bottom!</p>",
        "id": 402097824,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1700007938
    },
    {
        "content": "<p>Unfortunately it prints as <code>[Error pretty printing syntax: parenthesize: uncaught backtrack exception. Falling back to raw printer.]</code>, so it's still not very helpful; but that's a different problem</p>",
        "id": 402098515,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1700008201
    },
    {
        "content": "<p>One thing I recall is that if you mess with the syntax enough, Lean suggests a setting to view the fully expanded term.</p>",
        "id": 402099019,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1700008394
    },
    {
        "content": "<p>That gives you a huge term with a lot of <code>TSyntax  cat</code> stuff</p>",
        "id": 402099114,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1700008431
    },
    {
        "content": "<p>Found it :   set_option pp.rawOnError true</p>",
        "id": 402099266,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1700008485
    },
    {
        "content": "<p>But it also does exactly what your error message says.</p>",
        "id": 402099909,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1700008709
    }
]