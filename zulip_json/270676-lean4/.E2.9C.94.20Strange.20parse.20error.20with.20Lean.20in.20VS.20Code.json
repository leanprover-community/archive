[
    {
        "content": "<p>I've encountered a strange bug with the VSCode extension:</p>\n<p>In a file that looks like this</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">fact1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">n</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"mi\">10</span>\n</code></pre></div>\n<p>Everything seemed fine and I saw 10 in the Lean infoview. <br>\nWhen I added an extra space before <code>10</code>, I got a parse error saying a command was expected.  <br>\nWhen I inserted another space,  everything was fine again, and after insert another one, I got a parse error again etc.</p>\n<p>I was also able to reproduce with a match statement, where the last line was </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n</code></pre></div>\n<p>Following the same pattern, the Info view panel was fine, following by complaining that <code>n</code> wasn't a variable, to being fine etc.</p>\n<p>I tried running lean on the file from the command line and received no errors even though VSCode was showing  there was a problem.  After restarting the server, the problem has gone away.</p>\n<p><span aria-label=\"shrug\" class=\"emoji emoji-1f937\" role=\"img\" title=\"shrug\">:shrug:</span></p>",
        "id": 472440176,
        "sender_full_name": "Tom",
        "timestamp": 1727168622
    },
    {
        "content": "<p>I don't have a good repro beyond the description above.  Should I file this as a bug, or is it too vague to be able to identify?  Is there a way I can provide more telemetry in the future?</p>",
        "id": 472440438,
        "sender_full_name": "Tom",
        "timestamp": 1727168691
    },
    {
        "content": "<p>This is Lean 4.11 and VS Code extension v0.0.178</p>",
        "id": 472440821,
        "sender_full_name": "Tom",
        "timestamp": 1727168784
    },
    {
        "content": "<p>I did not manage to reproduce this. I tried VScode (Lean extension v0.0.178, just like OP), and lean.nvim and the web editor.</p>\n<p><span class=\"user-mention\" data-user-id=\"515083\">@Tom</span> Can you reproduce on Lean 4.12.0 ?</p>",
        "id": 472454299,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1727172223
    },
    {
        "content": "<p>Sorry, I am not able to reproduce now.  Is there more information I can try and collect (how?) if it happens again?</p>",
        "id": 472586414,
        "sender_full_name": "Tom",
        "timestamp": 1727219328
    },
    {
        "content": "<p>If you manage to reproduce it and get video of it, that could be helpful.</p>",
        "id": 472588083,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1727220589
    },
    {
        "content": "<p>Ah, it's happening again!  Same symptoms but slightly different parse error.  Screenshots incoming.  LMK if there are some logs I can dump, too.</p>\n<p>What I did to get to this point:  I am trying to go through the \"Recursive definitions tutorial\" on the Lean Blog.</p>\n<p>1) I opened new a file called \"termination.lean\"<br>\n2) Pasted the code from the first two examples of the blog<br>\n3) Saw the function is non-terminating.  Added <code>partial</code> to the function<br>\n4) Saw another error saying that <code>\\a</code> is not inhabited, so I added the <code>[Inhabited \\a]</code> type class<br>\n5) Saw some weirdness on the #check/eval line, so I tried to simplify, realized that I'm seeing the same problem again</p>\n<p>My guess is that the cursor/current line buffer is somehow being messed up in the LSP.  Hopefully  the \"why\" is clearer from the screenshots.</p>",
        "id": 472595312,
        "sender_full_name": "Tom",
        "timestamp": 1727226407
    },
    {
        "content": "<p>Main code window</p>\n<p><a href=\"/user_uploads/3121/BHW9hGVF6Ql7tpS7SUQ9FNkz/Screenshot-2024-09-24-at-18.07.19.png\">Screenshot-2024-09-24-at-18.07.19.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/BHW9hGVF6Ql7tpS7SUQ9FNkz/Screenshot-2024-09-24-at-18.07.19.png\" title=\"Screenshot-2024-09-24-at-18.07.19.png\"><img data-original-dimensions=\"797x349\" src=\"/user_uploads/thumbnail/3121/BHW9hGVF6Ql7tpS7SUQ9FNkz/Screenshot-2024-09-24-at-18.07.19.png/840x560.webp\"></a></div>",
        "id": 472595386,
        "sender_full_name": "Tom",
        "timestamp": 1727226481
    },
    {
        "content": "<p>Note how lean thinks there's an extra <code>s</code> before the <code>10</code>, so it's complaining that I typed <code>s10</code> into the <code>#eval</code></p>\n<p><a href=\"/user_uploads/3121/bXMIAcRAqbZEAnGArgHWWy5F/Screenshot-2024-09-24-at-18.08.28.png\">Screenshot-2024-09-24-at-18.08.28.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/bXMIAcRAqbZEAnGArgHWWy5F/Screenshot-2024-09-24-at-18.08.28.png\" title=\"Screenshot-2024-09-24-at-18.08.28.png\"><img data-original-dimensions=\"797x349\" src=\"/user_uploads/thumbnail/3121/bXMIAcRAqbZEAnGArgHWWy5F/Screenshot-2024-09-24-at-18.08.28.png/840x560.webp\"></a></div>",
        "id": 472595485,
        "sender_full_name": "Tom",
        "timestamp": 1727226570
    },
    {
        "content": "<p>In the terminal, you see I installed lean via elan; the version and the fact that the file works as expected.</p>\n<p><a href=\"/user_uploads/3121/7qMdGBSi1Ls1b9ImL1wSzbzF/Screenshot-2024-09-24-at-18.10.33.png\">Screenshot-2024-09-24-at-18.10.33.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/7qMdGBSi1Ls1b9ImL1wSzbzF/Screenshot-2024-09-24-at-18.10.33.png\" title=\"Screenshot-2024-09-24-at-18.10.33.png\"><img data-original-dimensions=\"797x280\" src=\"/user_uploads/thumbnail/3121/7qMdGBSi1Ls1b9ImL1wSzbzF/Screenshot-2024-09-24-at-18.10.33.png/840x560.webp\"></a></div>",
        "id": 472595631,
        "sender_full_name": "Tom",
        "timestamp": 1727226685
    },
    {
        "content": "<p>You can also see I'm on MacOS, for what it's worth.</p>",
        "id": 472595654,
        "sender_full_name": "Tom",
        "timestamp": 1727226713
    },
    {
        "content": "<p>More info:  I looked through the <code>Lean Editor</code> Output Logs and right at the end I see</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">lean</span><span class=\"w\"> </span><span class=\"c1\">--version</span>\n<span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"mf\">4.11</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">arm64</span><span class=\"bp\">-</span><span class=\"n\">apple</span><span class=\"bp\">-</span><span class=\"n\">darwin23</span><span class=\"bp\">.</span><span class=\"m\">6</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">commit</span><span class=\"w\"> </span><span class=\"n\">ec3042d94bd1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Release</span><span class=\"o\">)</span>\n<span class=\"o\">[</span><span class=\"n\">Error</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">:</span><span class=\"mi\">57</span><span class=\"o\">:</span><span class=\"mi\">13</span><span class=\"w\"> </span><span class=\"n\">PM</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Request</span><span class=\"w\"> </span><span class=\"n\">textDocument</span><span class=\"bp\">/</span><span class=\"n\">documentHighlight</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"bp\">.</span>\n<span class=\"w\">  </span><span class=\"n\">Message</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Server</span><span class=\"w\"> </span><span class=\"n\">process</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"o\">:</span><span class=\"bp\">///</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">tom</span><span class=\"bp\">/</span><span class=\"n\">dev</span><span class=\"bp\">/</span><span class=\"n\">feline</span><span class=\"bp\">/</span><span class=\"n\">termination</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"w\"> </span><span class=\"n\">crashed</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">likely</span><span class=\"w\"> </span><span class=\"n\">due</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">stack</span><span class=\"w\"> </span><span class=\"n\">overflow</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">bug</span><span class=\"bp\">.</span>\n<span class=\"w\">  </span><span class=\"n\">Code</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"mi\">32902</span>\n</code></pre></div>\n<p>Interestingly, I didn't see any notification in the UI that this happened.</p>",
        "id": 472596013,
        "sender_full_name": "Tom",
        "timestamp": 1727226989
    },
    {
        "content": "<p>Thanks for the detailed report. As this happens after editing the beginning of the very first function in the file, this is likely <a href=\"https://github.com/leanprover-community/mathlib4/pull/5312\">#5312</a>, which should become part of 4.12.0</p>",
        "id": 472632623,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1727250108
    },
    {
        "content": "<p>Sebastian means <a href=\"https://github.com/leanprover/lean4/pull/5312\">lean4#5312</a>.</p>",
        "id": 472643142,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1727253723
    },
    {
        "content": "<p>Got it, thanks!  I will update to 4.12 once it becomes stable and report back if I see it again.  Thank you.</p>",
        "id": 472725154,
        "sender_full_name": "Tom",
        "timestamp": 1727278504
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"515083\">Tom</span> has marked this topic as resolved.</p>",
        "id": 472725183,
        "sender_full_name": "Notification Bot",
        "timestamp": 1727278511
    }
]