[
    {
        "content": "<p>The following code leads to a <code>(kernel) deterministic timeout</code> after calling simp:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">test_1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BitVec</span><span class=\"w\"> </span><span class=\"mi\">32</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"k\">do</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">val</span>\n<span class=\"w\">      </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"mi\">8589934338</span><span class=\"bp\">#</span><span class=\"mi\">33</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&amp;&amp;&amp;</span><span class=\"w\"> </span><span class=\"mi\">255</span><span class=\"bp\">#</span><span class=\"mi\">32</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">signExtend</span><span class=\"w\"> </span><span class=\"mi\">33</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">msb</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"mi\">8589934338</span><span class=\"bp\">#</span><span class=\"mi\">33</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&amp;&amp;&amp;</span><span class=\"w\"> </span><span class=\"mi\">255</span><span class=\"bp\">#</span><span class=\"mi\">32</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">signExtend</span><span class=\"w\"> </span><span class=\"mi\">33</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">getMsbD</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">#</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"bp\">#</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">      </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"bp\">#</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">bind_eq_bind</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">some_bind</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>Does anyone have a pointer on how to debug this?</p>",
        "id": 490959841,
        "sender_full_name": "Tobias Grosser",
        "timestamp": 1735284757
    },
    {
        "content": "<p>Try using the new <code>simp -implicitDefEqProofs</code>, which should ensure that the kernel has to do no more work than <code>simp</code> itself</p>",
        "id": 490965360,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1735288425
    },
    {
        "content": "<p>Perfect. This resolved the issue (when applied strategically). It took me a moment to realize that <code>-implicitDefEqProofs</code> followed by a <code>config</code> option has no effect.</p>",
        "id": 491028656,
        "sender_full_name": "Tobias Grosser",
        "timestamp": 1735330967
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"122318\">Tobias Grosser</span> has marked this topic as resolved.</p>",
        "id": 491028661,
        "sender_full_name": "Notification Bot",
        "timestamp": 1735330969
    },
    {
        "content": "<p>4 messages were moved from this topic to <a class=\"stream-topic\" data-stream-id=\"270676\" href=\"/#narrow/channel/270676-lean4/topic/interaction.20of.20.2Bfoo.20and.20.28config.20.3A.3D.20.E2.80.A6.29\">#lean4 &gt; interaction of +foo and (config := …)</a> by <span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span>.</p>",
        "id": 491082755,
        "sender_full_name": "Notification Bot",
        "timestamp": 1735382961
    }
]