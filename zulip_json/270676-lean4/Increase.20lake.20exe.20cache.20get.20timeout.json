[
    {
        "content": "<p>Is there a way to increase the timeout duration of lake exe cache get. I have quite a slow internet connection and I don't mind waiting for it an hour or so just to download, but it seems that it disconnects after some minutes of time even if the internet connection is stable.</p>",
        "id": 534529427,
        "sender_full_name": "Jafar Tanoukhi",
        "timestamp": 1755192602
    },
    {
        "content": "<p>Cache does all of its requests using <code>curl</code> so we could in principle let users increase the timeout by setting curl options, but I don't think we have a way to do that yet. Do you have an example log of <code>lake exe cache get</code> disconnecting?</p>",
        "id": 534530847,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1755193129
    },
    {
        "content": "<p>I can start it up and wait a couple minutes for it to fail and show you the message but it's something to do with \"Transfered partial file, n bytes remaining\" .<br>\nWhich to me looks almost certainly a timeout and nothing to do with an unstable internet.</p>",
        "id": 534531382,
        "sender_full_name": "Jafar Tanoukhi",
        "timestamp": 1755193343
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"123965\">Bryan Gin-ge Chen</span> <a href=\"#narrow/channel/270676-lean4/topic/Increase.20lake.20exe.20cache.20get.20timeout/near/534530847\">said</a>:</p>\n<blockquote>\n<p>let users increase the timeout by setting curl options, but I don't think we have a way to do that yet.</p>\n</blockquote>\n<p>Also if that's the case, it sounds like a simple PR? Not sure if lake is open for PRs but maybe i can give that a go?</p>",
        "id": 534531782,
        "sender_full_name": "Jafar Tanoukhi",
        "timestamp": 1755193516
    },
    {
        "content": "<p>As far as I am aware, <code>curl</code> has no default timeout  for downlaods [c.f. <a href=\"https://unix.stackexchange.com/questions/94604/does-curl-have-a-timeout\">StackExchange</a>) and <code>cache</code> does not set one, so it is a bit confusing what would be timing it out.</p>",
        "id": 534532031,
        "sender_full_name": "Mac Malone",
        "timestamp": 1755193624
    },
    {
        "content": "<p>If you want to give it a shot, here's where <code>Cache</code> is: <a href=\"https://github.com/leanprover-community/mathlib4/tree/master/Cache\">https://github.com/leanprover-community/mathlib4/tree/master/Cache</a></p>",
        "id": 534532094,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1755193647
    },
    {
        "content": "<p>Another thought: you could maybe try running Cache in a loop until it succeeds in downloading everything; I seem to remember it picks up where it left off if you run it again if only some of the files were downloaded (?).</p>",
        "id": 534532362,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1755193756
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"315577\">Mac Malone</span> <a href=\"#narrow/channel/270676-lean4/topic/Increase.20lake.20exe.20cache.20get.20timeout/near/534532031\">said</a>:</p>\n<blockquote>\n<p>As far as I am aware, <code>curl</code> has no default timeout  for downlaods [c.f. <a href=\"https://unix.stackexchange.com/questions/94604/does-curl-have-a-timeout\">StackExchange</a>) and <code>cache</code> does not set one, so it is a bit confusing what would be timing it out.</p>\n</blockquote>\n<p>Hmmmm, i think it has to do with the server itself, as I requested the url <code>https://releases.lean-lang.org/lean4/v4.22.0/lean-4.22.0-windows.tar.zst</code> directly from my browser and it just refused to continue downloading after a couple minutes. My hopes for a PR that will fix this are shattered <span aria-label=\"smiling face with tear\" class=\"emoji emoji-1f972\" role=\"img\" title=\"smiling face with tear\">:smiling_face_with_tear:</span></p>",
        "id": 534532881,
        "sender_full_name": "Jafar Tanoukhi",
        "timestamp": 1755193954
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"123965\">Bryan Gin-ge Chen</span> <a href=\"#narrow/channel/270676-lean4/topic/Increase.20lake.20exe.20cache.20get.20timeout/near/534532362\">said</a>:</p>\n<blockquote>\n<p>Another thought: you could maybe try running Cache in a loop until it succeeds in downloading everything; I seem to remember it picks up where it left off if you run it again if only some of the files were downloaded (?).</p>\n</blockquote>\n<p>I already wrote that as a little batch file it just fails at the same point over and over again xD. It does not pick up from where it left sadly.</p>",
        "id": 534533008,
        "sender_full_name": "Jafar Tanoukhi",
        "timestamp": 1755194001
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/zzSAlBnRU-P9H3KqbEyY9P4M/image.png\">image.png</a><br>\nHere's the annoying error</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/zzSAlBnRU-P9H3KqbEyY9P4M/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1408x187\" src=\"/user_uploads/thumbnail/3121/zzSAlBnRU-P9H3KqbEyY9P4M/image.png/840x560.webp\"></a></div>",
        "id": 534537468,
        "sender_full_name": "Jafar Tanoukhi",
        "timestamp": 1755195763
    },
    {
        "content": "<p>Oh, that is an error downloading Lean itself (via <code>elan</code>), not Mathlib's <code>cache</code>.</p>",
        "id": 534537820,
        "sender_full_name": "Mac Malone",
        "timestamp": 1755195920
    },
    {
        "content": "<p>I'm not sure I understand much what that implies? Also, does this mean that after this completes, there will be another one for the actual mathlib cache ?</p>",
        "id": 534539124,
        "sender_full_name": "Jafar Tanoukhi",
        "timestamp": 1755196422
    },
    {
        "content": "<p>I did run <code>lake exe cache get</code> successfully around a week or a little bit more ago. It asked it again and i assumed it's because of recents PRs pushed to mathlib-master?</p>",
        "id": 534539287,
        "sender_full_name": "Jafar Tanoukhi",
        "timestamp": 1755196498
    },
    {
        "content": "<p>For context, Mathlib was recently updated to the latest Lean stable (v4.22.0) and when you run <code>lake exe cache get</code> it attempts to update Lean/Lake to that version by downloading the new release. That download is the one failing. It never gets to the point of running <code>cache</code> to download the Mathlib build.</p>",
        "id": 534539794,
        "sender_full_name": "Mac Malone",
        "timestamp": 1755196711
    },
    {
        "content": "<p>Oh alright.</p>",
        "id": 534552702,
        "sender_full_name": "Jafar Tanoukhi",
        "timestamp": 1755202499
    }
]