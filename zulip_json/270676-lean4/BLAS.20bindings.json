[
    {
        "content": "<p>I have created C BLAS bindings for Lean, <a href=\"https://github.com/lecopivo/LeanBLAS\">LeanBLAS</a>. Right now I have just level 1 for double precision.</p>\n<p>Also I started writing specification in <code>Spec</code> directory, for level one I'm still missing <code>iamax</code>, <code>rotg</code>, <code>rotmg</code> and <code>rot</code>.</p>\n<p>If anyone is interested in contributing, here is a list of things to do:</p>\n<p>- add level one for single precision float<br>\n  - add level one for complex numbers<br>\n  - finish specification for level one<br>\n  - add bindings for level 2 and 3<br>\n  - write specification for level 2 and 3<br>\n  - set up build for cuBLAS<br>\n  - set up build for clBLAS</p>\n<p>Copilot is really good at writing this kind of code. I would be interested if anyone would manage to oneshot all of this with some AI code generator.</p>",
        "id": 489086337,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1734271445
    },
    {
        "content": "<p>Should <code>ComplexFloat</code> be in Lean core, since C99 has it natively?</p>",
        "id": 489105148,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1734287450
    },
    {
        "content": "<p>Maybe the better question is \"while it's not in Lean core, can we use <code>implemented_by</code> to compile it to C <code>complex double</code>?\".</p>",
        "id": 489105578,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1734287825
    },
    {
        "content": "<p>Good question, I'm planing to implement single precision float as</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">opaque</span><span class=\"w\"> </span><span class=\"n\">Float32</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">UInt32</span>\n</code></pre></div>\n<p>Unfortunately, current compiler boxes types when they are marked opaque, so for some time it would have to be <code>def Float32 := UInt32</code> and just not exploit defeq.</p>\n<p>Similarly  <code>complex float</code> can be done using <code>UInt64</code> but for <code>complex double</code> I would need <code>UInt128</code>. </p>\n<p>But it is not so bad as values in <code>ComplexFloat</code> are no boxed as they would be in <code>Float × Float</code>.</p>\n<p>Hopefully, compiling <code>ComplexFloat</code> down to <code>complex double</code> will be possible as user code in the new complier.</p>",
        "id": 489106567,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1734288822
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"346070\">Tomas Skrivan</span> <a href=\"#narrow/channel/270676-lean4/topic/BLAS.20bindings/near/489106567\">said</a>:</p>\n<blockquote>\n<p>Good question, I'm planing to implement single precision float as</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">opaque</span><span class=\"w\"> </span><span class=\"n\">Float32</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">UInt32</span>\n</code></pre></div>\n<p>Unfortunately, current compiler boxes types when they are marked opaque, so for some time it would have to be <code>def Float32 := UInt32</code> and just not exploit defeq.</p>\n<p>Similarly  <code>complex float</code> can be done using <code>UInt64</code> but for <code>complex double</code> I would need <code>UInt128</code>. </p>\n<p>But it is not so bad as values in <code>ComplexFloat</code> are no boxed as they would be in <code>Float × Float</code>.</p>\n<p>Hopefully, compiling <code>ComplexFloat</code> down to <code>complex double</code> will be possible as user code in the new complier.</p>\n</blockquote>\n<p>Leo added built-in support for <code>Float32</code> this week</p>",
        "id": 489108333,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1734290609
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/270676-lean4/topic/BLAS.20bindings/near/489105578\">said</a>:</p>\n<blockquote>\n<p>Maybe the better question is \"while it's not in Lean core, can we use <code>implemented_by</code> to compile it to C <code>complex double</code>?\".</p>\n</blockquote>\n<p>That is not something that is technically possible with <code>implemented_by</code>, the set of types that Lean accepts as unboxed is currently not open to extension and hard controlled by the compiler.</p>",
        "id": 489108348,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1734290639
    },
    {
        "content": "<p>Relatedly, perhaps mathlib's <code>Complex</code> should be generalized to <code>Complex Real</code> or similar (perhaps in batteries), so that you can get <code>Complex Float64</code> for \"free\"</p>",
        "id": 489112108,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1734294267
    },
    {
        "content": "<p>I don't know if defaulting the type argument to <code>Real</code> is well-behaved, but at least mathlib pretty much exclusively uses the notation anyway.</p>",
        "id": 489112120,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1734294291
    },
    {
        "content": "<p>Plus then we can merge Complex and GaussianInt</p>",
        "id": 489112147,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1734294326
    },
    {
        "content": "<p>Also you could use it for vector space complexification.</p>",
        "id": 489112285,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1734294459
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/270676-lean4/topic/BLAS.20bindings/near/489112147\">said</a>:</p>\n<blockquote>\n<p>Plus then we can merge Complex and GaussianInt</p>\n</blockquote>\n<p>Then presumably we want to generalize <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Zsqrtd#doc\">docs#Zsqrtd</a> to any type rather than just <code>Int</code>, and possibly upstream?</p>",
        "id": 489116432,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1734298220
    },
    {
        "content": "<p>We should do it the Bourbaki way really, and have <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi><mo stretchy=\"false\">[</mo><mi>X</mi><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">/</mi><mo stretchy=\"false\">(</mo><msup><mi>X</mi><mn>2</mn></msup><mo>−</mo><mi>a</mi><mi>X</mi><mo>−</mo><mi>b</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">R[X]/(X^2-aX-b)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mclose\">]</span><span class=\"mord\">/</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">)</span></span></span></span> instead of just <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi><mo stretchy=\"false\">[</mo><mi>X</mi><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">/</mi><mo stretchy=\"false\">(</mo><msup><mi>X</mi><mn>2</mn></msup><mo>−</mo><mi>d</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">R[X]/(X^2-d)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mclose\">]</span><span class=\"mord\">/</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mclose\">)</span></span></span></span>. This is the general free rank 2 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi></mrow><annotation encoding=\"application/x-tex\">R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span></span>-algebra, you can't complete the square if 2 isn't invertible in <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi></mrow><annotation encoding=\"application/x-tex\">R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span></span>.</p>",
        "id": 489122404,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1734303718
    },
    {
        "content": "<p>Maybe we have special notation or whatever for the case <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">a=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span> but we should really have the general thing too.</p>",
        "id": 489122479,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1734303761
    },
    {
        "content": "<p>that makes it <em>noncomputable</em> though</p>",
        "id": 489122770,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1734303988
    },
    {
        "content": "<p>(at least, i think?)</p>",
        "id": 489122789,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1734304001
    },
    {
        "content": "<p>there is <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AdjoinRoot#doc\">docs#AdjoinRoot</a></p>",
        "id": 489122817,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1734304035
    },
    {
        "content": "<p>anyhow, the point is not to do fancy math things for Complex numbers, but to get a nice memory layout, and i don't believe going through <code>Polynomial</code> does that.</p>",
        "id": 489122992,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1734304179
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/270676-lean4/topic/BLAS.20bindings/near/489122404\">said</a>:</p>\n<blockquote>\n<p>We should do it the Bourbaki way really, and have <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi><mo stretchy=\"false\">[</mo><mi>X</mi><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">/</mi><mo stretchy=\"false\">(</mo><msup><mi>X</mi><mn>2</mn></msup><mo>−</mo><mi>a</mi><mi>X</mi><mo>−</mo><mi>b</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">R[X]/(X^2-aX-b)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mclose\">]</span><span class=\"mord\">/</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">)</span></span></span></span> instead of just <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi><mo stretchy=\"false\">[</mo><mi>X</mi><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">/</mi><mo stretchy=\"false\">(</mo><msup><mi>X</mi><mn>2</mn></msup><mo>−</mo><mi>d</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">R[X]/(X^2-d)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mclose\">]</span><span class=\"mord\">/</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mclose\">)</span></span></span></span>.</p>\n</blockquote>\n<p>As a small note, right now neither <code>Complex</code> nor <code>GaussianInt</code> is defined this way.</p>",
        "id": 489124154,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1734305295
    },
    {
        "content": "<p>I think one can have both memory layout and mathematical generality. We'll define (apologies, on mobile) </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Complex'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">re</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span>\n<span class=\"w\">  </span><span class=\"n\">im</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span>\n</code></pre></div>\n<p>The parameters <code>a</code> and <code>b</code> are then not used until it's time to define multiplication.</p>",
        "id": 489128438,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1734309267
    },
    {
        "content": "<p>No the thing Kevin suggesting is not going through <code>Polynomial</code> but just generalize <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Zsqrtd#doc\">docs#Zsqrtd</a> from pairs <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi><mo>+</mo><mi>m</mi><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">n + mX</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span> such that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>X</mi><mn>2</mn></msup><mo>=</mo><mi>d</mi></mrow><annotation encoding=\"application/x-tex\">X^2 = d</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">d</span></span></span></span> to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>X</mi><mn>2</mn></msup><mo>=</mo><mi>a</mi><mi>X</mi><mo>+</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">X^2=aX+b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span>.</p>",
        "id": 489128457,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1734309301
    },
    {
        "content": "<p>The <code>by exact</code> is a trick to allow default values without typeclasses in the signature.</p>",
        "id": 489128473,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1734309311
    },
    {
        "content": "<p>i'm trying to define instances for the suggested structure... Just to be sure, is there a sensible instance of <code>Star</code> when <code>a</code> is nonzero? because simply negating the imaginary component is not it...</p>",
        "id": 489579505,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1734472968
    },
    {
        "content": "<p>i.e. does not yield a <code>StarRing</code> assuming the original ring is a <code>CommRing</code></p>",
        "id": 489583859,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1734474981
    },
    {
        "content": "<p>(maybe at this point the conversation should be moved to either <a class=\"stream\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4\">#mathlib4</a> or <a class=\"stream\" data-stream-id=\"116395\" href=\"/#narrow/channel/116395-maths\">#maths</a>?)</p>",
        "id": 489583981,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1734475059
    },
    {
        "content": "<p><del>You need 2 to be invertible, so you can send <code>X</code> to the other root.</del></p>\n<p>Doesn't <code>X \\mapsto -X + a</code> work?</p>",
        "id": 489596428,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1734481855
    },
    {
        "content": "<p>i've run into a small issue, and i don't know what's causing it:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">autoImplicit</span><span class=\"w\"> </span><span class=\"n\">false</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Complex'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">re</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span>\n<span class=\"w\">  </span><span class=\"n\">im</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Complex'</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Zero</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"o\">:</span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Complex'</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">re</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">r</span>\n<span class=\"w\">  </span><span class=\"n\">im</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"c1\">-- not relevant afaict</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Mul</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Complex'</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"c1\">-- issue in this declaration</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">exists_coprime_of_gcd_pos</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">d</span><span class=\"o\">:</span><span class=\"n\">ℤ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Complex'</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Complex'</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">re</span><span class=\"bp\">.</span><span class=\"n\">gcd</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">im</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Complex'</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"c1\">-- could not synthesize default value for parameter 'a' using tactics</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n\n<span class=\"c1\">-- similar issue in this declaration, now at a different position</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">exists_coprime_of_gcd_pos</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">d</span><span class=\"o\">:</span><span class=\"n\">ℤ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Complex'</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"c1\">-- could not synthesize default value for parameter 'a' using tactics</span>\n<span class=\"w\">    </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">re</span><span class=\"bp\">.</span><span class=\"n\">gcd</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">im</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Complex'</span>\n</code></pre></div>\n<p>the error occurs at the uses of <code>Complex'</code> in the marked lines.<br>\nFixing is easy enough, just provide the parameter explicitly... still, i'd love to know what triggers this issue...</p>",
        "id": 489836713,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1734553874
    },
    {
        "content": "<p>I'm not sure. I wonder if there is some obstruction to running autoparams inside type ascriptions??</p>",
        "id": 490073823,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1734655572
    },
    {
        "content": "<p>Does anyone have experience with BLAS on Windows? I'm really do not know how can I make the library easily portable :( Should I include source of OpenBLAS and just compile it on user machine? Should I download binaries? </p>\n<p>cc <span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span> what is the recommended way for Lean project to depend on C library?</p>\n<p>On Linux or Mac you just run <code>sudo apt-get install libblas-dev</code> or <code>brew install openblas</code> but on Windows you can't  do anything simple like that.</p>",
        "id": 497459737,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1738595129
    },
    {
        "content": "<p>Also I would like to provide optional dependency on CUDA/cuBLAS. What would be the recommended way of adding an <code>ENABLE_CUDA</code> switch? And how should downstream projects  use this switch?</p>",
        "id": 497460447,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1738595291
    }
]