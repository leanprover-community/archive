[
    {
        "content": "<p>I am working through some code that tries to use <code>for h: ...</code> and <code>if h: ...</code> etc.  I noticed a few minor things which could be QoL improvements for code that currently exists in the Lean4 codebase.</p>\n<ol>\n<li><code>unless</code> doesn't seem to support the <code>unless h : ... </code> syntax</li>\n<li>It may be useful to be able to associate the hypothesis with a subexpression rather than with the full expression. eg. in <code>Lean/Util/Diff.lean</code> on line 174 the code says</li>\n</ol>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\"> </span><span class=\"n\">while</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">original</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"bp\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">original</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"bp\">!=</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"k\">do</span>\n</code></pre></div>\n<p>if would be convenient to be able to say</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">while</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">original</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">original</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">!=</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"k\">do</span><span class=\"w\"> </span><span class=\"c1\">-- notice the missing `!`</span>\n</code></pre></div>\n<p>I've noticed this before with other compound expressions e.g. in <code>if</code> statements, where I e.g. wish to write</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">cond1</span><span class=\"w\"> </span><span class=\"bp\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">cond2</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n<span class=\"k\">else</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n</code></pre></div>\n<p>but if I want to use a hypothesis, AFAICS,  I have to switch to <code>if h: cond1  ∧ cond2 then</code></p>",
        "id": 473969520,
        "sender_full_name": "Tom",
        "timestamp": 1727767578
    },
    {
        "content": "<p>The second point requires knowing a lot about truth tables: if you had and <code>or</code> what should it do?</p>",
        "id": 473975631,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727769290
    },
    {
        "content": "<p>That's a great observation!  I can see how that would get complicated with short-circuiting operators.</p>",
        "id": 473977241,
        "sender_full_name": "Tom",
        "timestamp": 1727769717
    },
    {
        "content": "<p>You can use <code>∃ h : i &lt; original.size, original[i] != d</code>, although I'm not sure if it short-circuits correctly</p>",
        "id": 474007186,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1727779936
    }
]