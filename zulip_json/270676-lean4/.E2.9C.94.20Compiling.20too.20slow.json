[
    {
        "content": "<p><a href=\"/user_uploads/3121/rGT92h4DrgXAPIeIFY2pVNnK/Test.mp4\">Test.mp4</a></p>\n<div class=\"message_inline_image message_inline_video\"><a href=\"/user_uploads/3121/rGT92h4DrgXAPIeIFY2pVNnK/Test.mp4\" title=\"Test.mp4\"><video preload=\"metadata\" src=\"/user_uploads/3121/rGT92h4DrgXAPIeIFY2pVNnK/Test.mp4\"></video></a></div><p>Doing Lean has not been fun for me for a while as everything is super slow. Attached is a video showing what's happening.</p>\n<p>I have the latest version of Lean, which can be seen in the end of the video. My machine is in Windows, with i7 and 32G RAM. Tests were done without importing Mathlib so it's not the problem with it.</p>\n<p>It worked well before, and I don't know what may have caused the problem. I have two folders, one provided by my teacher and one created by myself according to <a href=\"https://leanprover-community.github.io/install/project.html\">https://leanprover-community.github.io/install/project.html</a> and it happens in both.</p>\n<p>I'm based in London and Kevin Buzzard saw what's happening in a streaming today. We did some tests and he was also confused.</p>\n<p>Anyone's got any idea? Thanks.</p>",
        "id": 484386515,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732567470
    },
    {
        "content": "<p>Does temporarily disabling your antivirus have any effect?</p>",
        "id": 484386777,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1732567571
    },
    {
        "content": "<p>(don't forget to turn it back on after testing)</p>",
        "id": 484386810,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1732567595
    },
    {
        "content": "<p>Usually that manifested in the disk access graph though, so I'm not hopeful here</p>",
        "id": 484386849,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1732567613
    },
    {
        "content": "<p>Thanks for advice. I have no third-party antivirus so I turned off Windows Defender and then restarted VSCode. Unfortunately no effect.</p>",
        "id": 484389375,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732568700
    },
    {
        "content": "<p>Have you perhaps tried uninstalling elan + all toolchains and reinstalling, just in case that fixes things without needing to think too hard?</p>",
        "id": 484391735,
        "sender_full_name": "Julian Berman",
        "timestamp": 1732569729
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321696\">Julian Berman</span> <a href=\"#narrow/channel/270676-lean4/topic/Compiling.20too.20slow/near/484391735\">said</a>:</p>\n<blockquote>\n<p>Have you perhaps tried uninstalling elan + all toolchains and reinstalling, just in case that fixes things without needing to think too hard?</p>\n</blockquote>\n<p>I'm sorry but I'm afraid that I'm unfamiliar with the elan thing. Just to make sure I don't make it worse, shall I do the following:</p>",
        "id": 484404207,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732575330
    },
    {
        "content": "<ol>\n<li>run elan self uninstall in the .elan folder</li>\n</ol>",
        "id": 484404353,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732575394
    },
    {
        "content": "<ol start=\"2\">\n<li>run \"elan toolchain uninstall\" in the .elan folder</li>\n</ol>",
        "id": 484404402,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732575418
    },
    {
        "content": "<ol start=\"3\">\n<li>install elan following the instruction on <a href=\"https://leanprover-community.github.io/install/windows.html\">https://leanprover-community.github.io/install/windows.html</a></li>\n</ol>",
        "id": 484404795,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732575610
    },
    {
        "content": "<p>I actually don't remember whether the first (<code>elan self uninstall</code>) will do the latter automatically or whether it orphans the toolchains.</p>",
        "id": 484404939,
        "sender_full_name": "Julian Berman",
        "timestamp": 1732575698
    },
    {
        "content": "<p>oh I see</p>",
        "id": 484405052,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732575767
    },
    {
        "content": "<p>I don't see an answer in the elan readme. I think my recommendation would be run <code>elan self uninstall</code>, then reinstall elan, then run <code>elan toolchain list</code> and let me know if you see anything listed there (if so we can uninstall them). And then after that try your project again and see if you still have the slowness.</p>",
        "id": 484405053,
        "sender_full_name": "Julian Berman",
        "timestamp": 1732575769
    },
    {
        "content": "<p>Thank you! I'll do that now</p>",
        "id": 484405189,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732575847
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"C\"><pre><span></span><code><span class=\"nl\">C</span><span class=\"p\">:</span><span class=\"err\">\\</span><span class=\"n\">Users</span><span class=\"err\">\\</span><span class=\"n\">xiang</span><span class=\"err\">\\</span><span class=\"p\">.</span><span class=\"n\">elan</span><span class=\"o\">&gt;</span><span class=\"n\">elan</span><span class=\"w\"> </span><span class=\"n\">toolchain</span><span class=\"w\"> </span><span class=\"n\">list</span>\n<span class=\"n\">leanprover</span><span class=\"o\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">stable</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">default</span><span class=\"p\">)</span>\n<span class=\"n\">leanprover</span><span class=\"o\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"mf\">.14.0</span><span class=\"o\">-</span><span class=\"n\">rc2</span>\n</code></pre></div>\n<p>Shall I uninstall them?</p>",
        "id": 484406328,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732576605
    },
    {
        "content": "<p>I think it's worth doing yeah.</p>",
        "id": 484406794,
        "sender_full_name": "Julian Berman",
        "timestamp": 1732576897
    },
    {
        "content": "<p>Just to rule out that one of them is somehow broken. So <code>elan toolchain uninstall</code> each and then I think try your project again.</p>",
        "id": 484406824,
        "sender_full_name": "Julian Berman",
        "timestamp": 1732576918
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"C\"><pre><span></span><code><span class=\"nl\">C</span><span class=\"p\">:</span><span class=\"err\">\\</span><span class=\"n\">Users</span><span class=\"err\">\\</span><span class=\"n\">xiang</span><span class=\"err\">\\</span><span class=\"p\">.</span><span class=\"n\">elan</span><span class=\"o\">&gt;</span><span class=\"n\">elan</span><span class=\"w\"> </span><span class=\"n\">toolchain</span><span class=\"w\"> </span><span class=\"n\">uninstall</span><span class=\"w\"> </span><span class=\"n\">leanprover</span><span class=\"o\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"mf\">.14.0</span><span class=\"o\">-</span><span class=\"n\">rc2</span>\n<span class=\"nl\">info</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"n\">uninstalling</span><span class=\"w\"> </span><span class=\"n\">toolchain</span><span class=\"w\"> </span><span class=\"err\">'</span><span class=\"n\">leanprover</span><span class=\"o\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"mf\">.14.0</span><span class=\"o\">-</span><span class=\"n\">rc2</span><span class=\"err\">'</span>\n<span class=\"nl\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"n\">could</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">remove</span><span class=\"w\"> </span><span class=\"err\">'</span><span class=\"n\">update</span><span class=\"w\"> </span><span class=\"n\">hash</span><span class=\"err\">'</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"err\">'</span><span class=\"n\">C</span><span class=\"o\">:</span><span class=\"err\">\\</span><span class=\"n\">Users</span><span class=\"err\">\\</span><span class=\"n\">xiang</span><span class=\"err\">\\</span><span class=\"p\">.</span><span class=\"n\">elan</span><span class=\"err\">\\</span><span class=\"n\">update</span><span class=\"o\">-</span><span class=\"n\">hashes</span><span class=\"err\">\\</span><span class=\"n\">leanprover</span><span class=\"o\">--</span><span class=\"n\">lean4</span><span class=\"o\">---</span><span class=\"n\">v4</span><span class=\"mf\">.14.0</span><span class=\"o\">-</span><span class=\"n\">rc2</span><span class=\"err\">'</span>\n</code></pre></div>\n<p>I've successfully uninstalled the first one.But then I have this error uninstalling the other. There is indeed no such file in the folder, but there is the \"leanprover--lean4---v4.14.0-rc2\" folder under .elan\\toolchains. Shall I simply delete the folder then?</p>",
        "id": 484407303,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732577187
    },
    {
        "content": "<p>If you do that then also delete the similarly-named file or folder in the other directory in .elan (I forgot what everything was called but there's a gotcha here)<br>\n. Or you could just completely delete .elan which might be a good idea in your situation</p>",
        "id": 484410207,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1732578816
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"781091\">@Samuel Yin</span> (sorry, I was making dinner), I think if you get that error then yes <code>rm ~/.elan</code> is probably a good idea as well like Kevin said (which I suspect means reinstalling elan yet again). So concretely, <code>elan self uninstall &amp;&amp; rm -r ~/.elan</code> and then reinstall elan, confirm <code>elan toolchain list</code> is empty, and then let me know what happens.</p>",
        "id": 484413265,
        "sender_full_name": "Julian Berman",
        "timestamp": 1732580528
    },
    {
        "content": "<p>Thank you all!</p>\n<p>I have uninstalled and then reinstalled elan as instructed, and confirmed that <code>elan toolchain list</code> is empty. Then I opened VSCode and it automatically installed <code>leanprover/lean4:v4.14.0-rc2</code> for me. Now it's still slow.</p>",
        "id": 484422517,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732587339
    },
    {
        "content": "<p>Ok, sorry for wasting time, it was worth a shot. The next thing that would occur to me to try would be check if you see slowness at the command line? If you put some new lean code in a file in your project and try to run it, is it as slow?</p>",
        "id": 484423399,
        "sender_full_name": "Julian Berman",
        "timestamp": 1732588055
    },
    {
        "content": "<p>Yeah, I'm wondering if the issue is VS Code. From the terminal, you could try doing <code>lake build MyProject.test3</code> to build that file.</p>\n<p>Do you have any other VS Code extensions installed? Is the Lean 4 extension up-to-date? Someone online suggests that there could be a problem with git — there should be a VS Code terminal for git activity; when you edit, is there activity there?</p>",
        "id": 484435196,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1732596654
    },
    {
        "content": "<p>I saw this phenomenon happening in real time when Samuel was typing -- could this really be a git thing?</p>",
        "id": 484446113,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1732604747
    },
    {
        "content": "<blockquote>\n<p>It worked well before, and I don't know what may have caused the problem</p>\n</blockquote>\n<p>Very mysterious issue. When it worked, was that the same Lean version?</p>",
        "id": 484460334,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1732610890
    },
    {
        "content": "<p>Thank you all and sorry if I can't reply each of you, because I have some exciting new discoveries:</p>\n<p>I uninstalled and reinstalled elan, confirmed toolchain list empty. Then I opened my old folder in VSCode and was suggested to install the stable toolchain. Then I did some tests and everything works perfectly in this old folder, but not in the new folder!</p>\n<p>Now automatically there are two new toolchains: </p>\n<div class=\"codehilite\" data-code-language=\"C\"><pre><span></span><code><span class=\"nl\">C</span><span class=\"p\">:</span><span class=\"err\">\\</span><span class=\"n\">Users</span><span class=\"err\">\\</span><span class=\"n\">xiang</span><span class=\"err\">\\</span><span class=\"p\">.</span><span class=\"n\">elan</span><span class=\"o\">&gt;</span><span class=\"n\">elan</span><span class=\"w\"> </span><span class=\"n\">toolchain</span><span class=\"w\"> </span><span class=\"n\">list</span>\n<span class=\"n\">stable</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">default</span><span class=\"p\">)</span>\n<span class=\"n\">leanprover</span><span class=\"o\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"mf\">.14.0</span><span class=\"o\">-</span><span class=\"n\">rc2</span>\n<span class=\"n\">leanprover</span><span class=\"o\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"mf\">.2.0</span><span class=\"o\">-</span><span class=\"n\">rc1</span>\n</code></pre></div>\n<p>And when I type</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">versionString</span>\n</code></pre></div>\n<p>, in the old folder it's <code>\"4.2.0-rc1\"</code>, and in the new folder it's <code>\"4.14.0-rc2\"</code></p>",
        "id": 484501126,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732623915
    },
    {
        "content": "<p>p.s. the old folder is one provided by my school, but I prefer to work in a folder created by myself from the scratch, which is the new folder. I created it following the instructions in the \"Creating a Lean Project\" section on  <a href=\"https://leanprover-community.github.io/install/project.html\">https://leanprover-community.github.io/install/project.html</a>.</p>",
        "id": 484502650,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732624401
    },
    {
        "content": "<p>Try <code>rm -rf .lake</code> in the new folder and then let Lean redownload everything. No idea if that will make any difference but it's a quick experiment.</p>",
        "id": 484505258,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1732625204
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/HTHyewmGiJEzgHT2faV7334v/931c11849bb4a3b0347cf76e054e6d02.png\">931c11849bb4a3b0347cf76e054e6d02.png</a><br>\nI have this error, where the Chinese says: No parameter matching the name “rf” was found</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/HTHyewmGiJEzgHT2faV7334v/931c11849bb4a3b0347cf76e054e6d02.png\" title=\"931c11849bb4a3b0347cf76e054e6d02.png\"><img data-original-dimensions=\"1890x722\" src=\"/user_uploads/thumbnail/3121/HTHyewmGiJEzgHT2faV7334v/931c11849bb4a3b0347cf76e054e6d02.png/840x560.webp\"></a></div>",
        "id": 484510147,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732626595
    },
    {
        "content": "<p>This is perhaps shell-specific, and IIRC you are using powershell which is not great. The command I suggested means \"recursively remove the directory and don't ask any questions\". You can just remove it manually using Windows file explorer. It's a hidden file (begins with a dot) so it might not show up in a windows file explorer, but  probably a way to fix this (I know nothing about windows). Alternatively switch to a more competent shell like git bash and the command will work fine I suspect. Or figure out what the powershell command to remove a directory is.</p>",
        "id": 484510759,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1732626766
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"781091\">Samuel Yin</span> <a href=\"#narrow/channel/270676-lean4/topic/Compiling.20too.20slow/near/484510147\">said</a>:</p>\n<blockquote>\n<p><a href=\"/user_uploads/3121/HTHyewmGiJEzgHT2faV7334v/931c11849bb4a3b0347cf76e054e6d02.png\">931c11849bb4a3b0347cf76e054e6d02.png</a><br>\nI have this error, where the Chinese says: No parameter matching the name “rf” was found</p>\n</blockquote>\n<p>Hmm, is your directory indexed by OneDrive?<br>\nCould you try creating a new Lean project outside of your OneDrive folder, somewhere where it isn't indexed by OneDrive, and see if the issue remains?</p>",
        "id": 484510810,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1732626785
    },
    {
        "content": "<p>Maybe Marc's comment is far more pertinent. Is the old folder also in OneDrive?</p>",
        "id": 484510965,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1732626839
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"221921\">Marc Huisinga</span> <a href=\"#narrow/channel/270676-lean4/topic/Compiling.20too.20slow/near/484510810\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"781091\">Samuel Yin</span> <a href=\"#narrow/channel/270676-lean4/topic/Compiling.20too.20slow/near/484510147\">said</a>:</p>\n<blockquote>\n<p><a href=\"/user_uploads/3121/HTHyewmGiJEzgHT2faV7334v/931c11849bb4a3b0347cf76e054e6d02.png\">931c11849bb4a3b0347cf76e054e6d02.png</a><br>\nI have this error, where the Chinese says: No parameter matching the name “rf” was found</p>\n</blockquote>\n<p>Hmm, is your directory indexed by OneDrive?<br>\nCould you try creating a new Lean project outside of your OneDrive folder, somewhere where it isn't indexed by OneDrive, and see if the issue remains?</p>\n</blockquote>\n<p>That's a good point! But both folders are in OneDrive. I just created a new project from scratch outside of OneDrive, and it's still slow.</p>",
        "id": 484517723,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732628870
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/270676-lean4/topic/Compiling.20too.20slow/near/484510759\">said</a>:</p>\n<blockquote>\n<p>This is perhaps shell-specific, and IIRC you are using powershell which is not great. The command I suggested means \"recursively remove the directory and don't ask any questions\". You can just remove it manually using Windows file explorer. It's a hidden file (begins with a dot) so it might not show up in a windows file explorer, but  probably a way to fix this (I know nothing about windows). Alternatively switch to a more competent shell like git bash and the command will work fine I suspect. Or figure out what the powershell command to remove a directory is.</p>\n</blockquote>\n<p>Then shall I try this?</p>",
        "id": 484517821,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732628889
    },
    {
        "content": "<p>If what Kevin wrote doesn't help (I don't think it's likely given that you created a fresh project and it's still an issue), it would also be good to figure out the following details:</p>\n<ol>\n<li>Does the issue only occur in Mathlib projects, or in standalone projects as well? You can check this by creating a new standalone project with <code>lake +leanprover/lean4:v4.14.0-rc2 new TestProject</code> and then repeating your test from the first post. If Lean is still slow for you, then we know for sure that this issue is independent of Mathlib.</li>\n<li>Once we know that the issue is independent of Mathlib, it would be good to figure out on which exact Lean version it started getting slow on your machine. You can create a new project with a given Lean version <code>&lt;version&gt;</code> via <code>lake +leanprover/lean4:&lt;version&gt; new &lt;ProjectName&gt;</code>, e.g. <code>lake +leanprover/lean4:v4.13.0 new &lt;ProjectName&gt;</code>, <code>lake +leanprover/lean4:v4.12.0 new &lt;ProjectName&gt;</code> and so on, with a new <code>&lt;ProjectName&gt;</code> for each project. The first version where it starts being slow is the one that we want to find. If you want this process to go faster than a linear search, you can also use <a href=\"https://en.wikipedia.org/wiki/Binary_search\">binary search</a> on the Lean versions :-)</li>\n</ol>",
        "id": 484518425,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1732629067
    },
    {
        "content": "<p>Since you already confirmed that this is not related to OneDrive, it seems more and more likely that this is something that we broke somewhere between 4.2.0 and now (that for some unclear reason doesn't affect most other Windows users). Sorry for that and for having to expend additional time to help us isolate the issue.</p>",
        "id": 484519506,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1732629374
    },
    {
        "content": "<p>No worries at all and thanks for your help! I've just confirmed it's independent of Mathlib, and I will do the version check after a lecture</p>",
        "id": 484520883,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732629729
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"221921\">Marc Huisinga</span> <a href=\"#narrow/channel/270676-lean4/topic/Compiling.20too.20slow/near/484518425\">said</a>:</p>\n<blockquote>\n<p>If what Kevin wrote doesn't help (I don't think it's likely given that you created a fresh project and it's still an issue), it would also be good to figure out the following details:</p>\n<ol>\n<li>Does the issue only occur in Mathlib projects, or in standalone projects as well? You can check this by creating a new standalone project with <code>lake +leanprover/lean4:v4.14.0-rc2 new TestProject</code> and then repeating your test from the first post. If Lean is still slow for you, then we know for sure that this issue is independent of Mathlib.</li>\n<li>Once we know that the issue is independent of Mathlib, it would be good to figure out on which exact Lean version it started getting slow on your machine. You can create a new project with a given Lean version <code>&lt;version&gt;</code> via <code>lake +leanprover/lean4:&lt;version&gt; new &lt;ProjectName&gt;</code>, e.g. <code>lake +leanprover/lean4:v4.13.0 new &lt;ProjectName&gt;</code>, <code>lake +leanprover/lean4:v4.12.0 new &lt;ProjectName&gt;</code> and so on, with a new <code>&lt;ProjectName&gt;</code> for each project. The first version where it starts being slow is the one that we want to find. If you want this process to go faster than a linear search, you can also use <a href=\"https://en.wikipedia.org/wiki/Binary_search\">binary search</a> on the Lean versions :-)</li>\n</ol>\n</blockquote>\n<p>After running <code>lake +leanprover/lean4:v4.8.0 new Test480</code>, the corresponding toolchain was installed, and in the \"Test480\" folder I see this file \"lean-toolchain\" saying <code>leanprover/lean4:v4.8.0</code>. However, when I type </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">versionString</span>\n</code></pre></div>\n<p>in a <code>test.lean</code> file, it's still <code>\"4.14.0-rc2\"</code>. Did I do something wrong?</p>",
        "id": 484553742,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732638961
    },
    {
        "content": "<p>Is the <code>test.lean</code> file saved in the <code>Test480</code> project? Also, is the <code>Test480</code> project contained in some other Lean project further up?</p>",
        "id": 484554028,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1732639058
    },
    {
        "content": "<p>You can check where it grabs the version from by using the \"Troubleshooting: Show Setup Information\" command in the forall menu in the top right in the file where you see this version string.</p>",
        "id": 484554193,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1732639101
    },
    {
        "content": "<p>Oh sorry, it's contained in my \"new folder\", which is the problematic project. But the reason why I did that is when I tried to run <code>lake +leanprover/lean4:v4.8.0 new Test480</code> somewhere else, it gives me:</p>\n<div class=\"codehilite\" data-code-language=\"C\"><pre><span></span><code><span class=\"nl\">C</span><span class=\"p\">:</span><span class=\"err\">\\</span><span class=\"n\">Users</span><span class=\"err\">\\</span><span class=\"n\">xiang</span><span class=\"err\">\\</span><span class=\"n\">OneDrive</span><span class=\"err\">\\</span><span class=\"n\">桌面</span><span class=\"err\">\\</span><span class=\"n\">Lean</span><span class=\"o\">&gt;</span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"n\">leanprover</span><span class=\"o\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"mf\">.8.0</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">Test4</span><span class=\"mf\">.8.0</span>\n<span class=\"n\">PANIC</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"p\">.</span><span class=\"n\">modToFilePath</span><span class=\"p\">.</span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"p\">.</span><span class=\"n\">Util</span><span class=\"p\">.</span><span class=\"n\">Path</span><span class=\"o\">:</span><span class=\"mi\">38</span><span class=\"o\">:</span><span class=\"mi\">20</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ill</span><span class=\"o\">-</span><span class=\"n\">formed</span><span class=\"w\"> </span><span class=\"n\">import</span>\n<span class=\"n\">PANIC</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"p\">.</span><span class=\"n\">modToFilePath</span><span class=\"p\">.</span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"p\">.</span><span class=\"n\">Util</span><span class=\"p\">.</span><span class=\"n\">Path</span><span class=\"o\">:</span><span class=\"mi\">38</span><span class=\"o\">:</span><span class=\"mi\">20</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ill</span><span class=\"o\">-</span><span class=\"n\">formed</span><span class=\"w\"> </span><span class=\"n\">import</span>\n<span class=\"n\">PANIC</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"p\">.</span><span class=\"n\">escapeName</span><span class=\"o\">!</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"p\">.</span><span class=\"n\">CLI</span><span class=\"p\">.</span><span class=\"n\">Init</span><span class=\"o\">:</span><span class=\"mi\">175</span><span class=\"o\">:</span><span class=\"mi\">23</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unreachable</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">been</span><span class=\"w\"> </span><span class=\"n\">reached</span>\n<span class=\"n\">PANIC</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"p\">.</span><span class=\"n\">escapeName</span><span class=\"o\">!</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"p\">.</span><span class=\"n\">CLI</span><span class=\"p\">.</span><span class=\"n\">Init</span><span class=\"o\">:</span><span class=\"mi\">175</span><span class=\"o\">:</span><span class=\"mi\">23</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unreachable</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">been</span><span class=\"w\"> </span><span class=\"n\">reached</span>\n<span class=\"n\">PANIC</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"p\">.</span><span class=\"n\">escapeName</span><span class=\"o\">!</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"p\">.</span><span class=\"n\">CLI</span><span class=\"p\">.</span><span class=\"n\">Init</span><span class=\"o\">:</span><span class=\"mi\">175</span><span class=\"o\">:</span><span class=\"mi\">23</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unreachable</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">been</span><span class=\"w\"> </span><span class=\"n\">reached</span>\n<span class=\"nl\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">such</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">)</span>\n<span class=\"w\">  </span><span class=\"nl\">file</span><span class=\"p\">:</span>\n</code></pre></div>\n<p>so where should I run it?</p>",
        "id": 484554793,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732639294
    },
    {
        "content": "<p>Does it work if you remove the dots from the project name?</p>",
        "id": 484555151,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1732639415
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"221921\">Marc Huisinga</span> <a href=\"#narrow/channel/270676-lean4/topic/Compiling.20too.20slow/near/484554193\">said</a>:</p>\n<blockquote>\n<p>You can check where it grabs the version from by using the \"Troubleshooting: Show Setup Information\" command in the forall menu in the top right in the file where you see this version string.</p>\n</blockquote>\n<p><strong>Operating system</strong>: Windows_NT (release: 10.0.22631)<br>\n<strong>CPU architecture</strong>: x64<br>\n<strong>CPU model</strong>: 16 x 13th Gen Intel(R) Core(TM) i7-1360P<br>\n<strong>Available RAM</strong>: 34.02 GB</p>\n<p><strong>VS Code version</strong>: Reasonably up-to-date (version: 1.95.3)<br>\n<strong>Lean 4 extension version</strong>: 0.0.184<br>\n<strong>Curl installed</strong>: true<br>\n<strong>Git installed</strong>: true<br>\n<strong>Elan</strong>: Reasonably up-to-date (version: 3.1.1)<br>\n<strong>Lean</strong>: Reasonably up-to-date (version: 4.14.0-rc2)<br>\n<strong>Project</strong>: Valid Lean project (path: c:\\Users\\xiang\\OneDrive\\桌面\\Lean\\my_project)</p>\n<hr>\n<p><strong>Elan toolchains</strong>: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">installed</span><span class=\"w\"> </span><span class=\"n\">toolchains</span>\n<span class=\"c1\">--------------------</span>\n\n<span class=\"n\">stable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">default</span><span class=\"o\">)</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">nightly</span><span class=\"bp\">-</span><span class=\"mi\">2024</span><span class=\"bp\">-</span><span class=\"mi\">04</span><span class=\"bp\">-</span><span class=\"mi\">24</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">14</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc2</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc1</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">5</span><span class=\"bp\">.</span><span class=\"m\">0</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">8</span><span class=\"bp\">.</span><span class=\"m\">0</span>\n\n\n<span class=\"n\">active</span><span class=\"w\"> </span><span class=\"n\">toolchain</span>\n<span class=\"c1\">----------------</span>\n\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">14</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">overridden</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"bp\">'\\\\?\\</span><span class=\"n\">C</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">xiang</span><span class=\"bp\">\\</span><span class=\"n\">OneDrive</span><span class=\"bp\">\\桌面\\</span><span class=\"n\">Lean</span><span class=\"bp\">\\</span><span class=\"n\">my_project</span><span class=\"bp\">\\</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">toolchain'</span><span class=\"o\">)</span>\n\n<span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"mf\">4.14</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x86_64</span><span class=\"bp\">-</span><span class=\"n\">w64</span><span class=\"bp\">-</span><span class=\"n\">windows</span><span class=\"bp\">-</span><span class=\"n\">gnu</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">commit</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"n\">dc1ceb8d431</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Release</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>This is what I got from \"Troubleshooting: Show Setup Information\"</p>",
        "id": 484555189,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732639427
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"221921\">Marc Huisinga</span> <a href=\"#narrow/channel/270676-lean4/topic/Compiling.20too.20slow/near/484555151\">said</a>:</p>\n<blockquote>\n<p>Does it work if you remove the dots from the project name?</p>\n</blockquote>\n<p>Aha! Yes it works, thanks. Let me do the tests then</p>",
        "id": 484555471,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732639513
    },
    {
        "content": "<p>I did a binary search, and in particular I created a project in latest version with <code>lake +leanprover/lean4:v4.14.0-rc2 new LastTest</code>, and it turns out that they all work perfectly. So is it that there was something wrong with the way I created the project before?</p>",
        "id": 484558589,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732640507
    },
    {
        "content": "<p>so what I used to do is:<br>\nrunning </p>\n<div class=\"codehilite\" data-code-language=\"C\"><pre><span></span><code><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"n\">leanprover</span><span class=\"o\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">nightly</span><span class=\"mi\">-2024</span><span class=\"mo\">-04</span><span class=\"mi\">-24</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">my_project</span><span class=\"w\"> </span><span class=\"n\">math</span>\n</code></pre></div>\n<p>and then </p>\n<div class=\"codehilite\" data-code-language=\"C\"><pre><span></span><code><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">update</span>\n</code></pre></div>",
        "id": 484558974,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732640629
    },
    {
        "content": "<p>oh wait, that means that I did this no.1 test wrong</p>\n<p><span class=\"user-mention silent\" data-user-id=\"221921\">Marc Huisinga</span> <a href=\"#narrow/channel/270676-lean4/topic/Compiling.20too.20slow/near/484518425\">said</a>:</p>\n<blockquote>\n<p>If what Kevin wrote doesn't help (I don't think it's likely given that you created a fresh project and it's still an issue), it would also be good to figure out the following details:</p>\n<ol>\n<li>Does the issue only occur in Mathlib projects, or in standalone projects as well? You can check this by creating a new standalone project with <code>lake +leanprover/lean4:v4.14.0-rc2 new TestProject</code> and then repeating your test from the first post. If Lean is still slow for you, then we know for sure that this issue is independent of Mathlib.</li>\n<li>Once we know that the issue is independent of Mathlib, it would be good to figure out on which exact Lean version it started getting slow on your machine. You can create a new project with a given Lean version <code>&lt;version&gt;</code> via <code>lake +leanprover/lean4:&lt;version&gt; new &lt;ProjectName&gt;</code>, e.g. <code>lake +leanprover/lean4:v4.13.0 new &lt;ProjectName&gt;</code>, <code>lake +leanprover/lean4:v4.12.0 new &lt;ProjectName&gt;</code> and so on, with a new <code>&lt;ProjectName&gt;</code> for each project. The first version where it starts being slow is the one that we want to find. If you want this process to go faster than a linear search, you can also use <a href=\"https://en.wikipedia.org/wiki/Binary_search\">binary search</a> on the Lean versions :-)</li>\n</ol>\n</blockquote>",
        "id": 484559779,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732640879
    },
    {
        "content": "<p>so it appears that the issue is dependent of Mathlib?</p>",
        "id": 484560032,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732640954
    },
    {
        "content": "<p>Hmmm. Some more questions to answer:</p>\n<ol>\n<li>Is Lean fast <em>immediately</em> after opening the project in VS Code in one of your standalone projects?</li>\n<li>If you wait for a couple of minutes in your new Mathlib project after opening VS Code, does Lean become less slow?</li>\n</ol>\n<p>I'm asking because we do a bunch of work when Lean's language server is first started that is roughly proportional to the size of the project you're working on (i.e. we need to do much more work in a Mathlib project than a project without Mathlib), and I'm wondering whether it's this that slows down your language server for some unclear reason.</p>",
        "id": 484712835,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1732711718
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/a5hTz_P-hGZFFY2aJMPiGhEl/Test_2.mp4\">Test_2.mp4</a><br>\nIn the video attached, first you can see that everything is fast immediately after opening a file in the standalone project. Then when it comes to the other project with Mathlib installed, but not imported in the file which has been opened for 10+ mins, it's very slow.</p>\n<div class=\"message_inline_image message_inline_video\"><a href=\"/user_uploads/3121/a5hTz_P-hGZFFY2aJMPiGhEl/Test_2.mp4\" title=\"Test_2.mp4\"><video preload=\"metadata\" src=\"/user_uploads/3121/a5hTz_P-hGZFFY2aJMPiGhEl/Test_2.mp4\"></video></a></div>",
        "id": 484724156,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732714985
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/InZ1oh3PXkDFh8UO9XjZ5z4x/Test_3.mp4\">Test_3.mp4</a><br>\nOh I just realised that the first part of my last video was not immediately after opening the project, but only immediately after opening a file. So in this new video I opened the folder and then a file and then immediately did the test. It's still fast.</p>\n<div class=\"message_inline_image message_inline_video\"><a href=\"/user_uploads/3121/InZ1oh3PXkDFh8UO9XjZ5z4x/Test_3.mp4\" title=\"Test_3.mp4\"><video preload=\"metadata\" src=\"/user_uploads/3121/InZ1oh3PXkDFh8UO9XjZ5z4x/Test_3.mp4\"></video></a></div>",
        "id": 484729502,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732716479
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"781091\">@Samuel Yin</span> to eliminate (or determine) vscode and the LSP as a source of error here could you try the following experiment:</p>\n<ol>\n<li>Run your standalone file from a shell with <code>lean standalone.lean</code></li>\n<li>In your shell go into your mathlib project directory and run a copy of the standalone file there with <code>lake lean copyofstandalone.lean</code></li>\n</ol>\n<p>And check how much time they take each?</p>",
        "id": 484772989,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1732730324
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"395550\">Henrik Böving</span> <a href=\"#narrow/channel/270676-lean4/topic/Compiling.20too.20slow/near/484772989\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"781091\">Samuel Yin</span> to eliminate (or determine) vscode and the LSP as a source of error here could you try the following experiment:</p>\n<ol>\n<li>Run your standalone file from a shell with <code>lean standalone.lean</code></li>\n<li>In your shell go into your mathlib project directory and run a copy of the standalone file there with <code>lake lean copyofstandalone.lean</code></li>\n</ol>\n<p>And check how much time they take each?</p>\n</blockquote>\n<p><a href=\"/user_uploads/3121/areD53NoPusaV4sHcvKvmvLS/image.png\">image.png</a><br>\n<a href=\"/user_uploads/3121/gqUofbw8bCHNcsZ5ho3Rtn-c/image.png\">image.png</a><br>\nSorry I'm not familiar with shell, but do you mean doing this?</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/areD53NoPusaV4sHcvKvmvLS/image.png\" title=\"image.png\"><img data-original-dimensions=\"2879x1799\" src=\"/user_uploads/thumbnail/3121/areD53NoPusaV4sHcvKvmvLS/image.png/840x560.webp\"></a></div><div class=\"message_inline_image\"><a href=\"/user_uploads/3121/gqUofbw8bCHNcsZ5ho3Rtn-c/image.png\" title=\"image.png\"><img data-original-dimensions=\"2879x1799\" src=\"/user_uploads/thumbnail/3121/gqUofbw8bCHNcsZ5ho3Rtn-c/image.png/840x560.webp\"></a></div>",
        "id": 484778511,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732732511
    },
    {
        "content": "<p>I think they take the same amount of time</p>",
        "id": 484778803,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732732630
    },
    {
        "content": "<p>Yes and that's unfortunate :/</p>",
        "id": 484779381,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1732732875
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"395550\">Henrik Böving</span> <a href=\"#narrow/channel/270676-lean4/topic/Compiling.20too.20slow/near/484779381\">said</a>:</p>\n<blockquote>\n<p>Yes and that's unfortunate :/</p>\n</blockquote>\n<p>Thanks for your advice anyway :)</p>",
        "id": 484780944,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732733524
    },
    {
        "content": "<p>I've lost track of the thread a bit (though you have the attention of others who know more). But could you perhaps summarize which things are known to be fast and which are known to be slow again perhaps?</p>",
        "id": 484784079,
        "sender_full_name": "Julian Berman",
        "timestamp": 1732734808
    },
    {
        "content": "<p>In particular, you mentioned yesterday that 4.2.0 was fast and 4.14.0 was slow -- was that then eliminated afterwards as a possible explanation?</p>",
        "id": 484784142,
        "sender_full_name": "Julian Berman",
        "timestamp": 1732734842
    },
    {
        "content": "<p>The case that's slow is specifically in a project dependent on Mathlib (and not otherwise), and specifically within an editor (and not at the CLI)?</p>",
        "id": 484784452,
        "sender_full_name": "Julian Berman",
        "timestamp": 1732734984
    },
    {
        "content": "<p>I'm sorry if the following is wordy!</p>\n<p>Everything is fast if created by <code>lake +leanprover/lean4:&lt;version&gt; new &lt;ProjectName&gt;</code>, i.e. without Mathlib. Call this type (1).</p>\n<p>There is a project not created by me, where Mathlib is installed and it runs on 4.2.0-rc1. Mathlib is updated. Everything is fast here. Call this type (2).</p>\n<p>The only problematic projects are those created by me via <code>lake +leanprover/lean4:nightly-2024-04-24 new my_project math</code>, i.e. with Mathlib installed. Call this type (3). And they are not slow when run from a shell, which inspires me to do the latest experiment, which shows that the slowness only occurs when editing, but not when everything turns blue when I open a file (sorry I don't know what to call this process)</p>",
        "id": 484802964,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732743446
    },
    {
        "content": "<p><strong>P.S.</strong> I'm confused that, given that the tests are done without <code>import Mathlib</code>, why the problem might still be dependent on Mathlib? Can it be that there are other difference between (1) and (3), other than whether Mathlib is installed? (Note also that (2) is good with Mathlib)</p>",
        "id": 484802984,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732743469
    },
    {
        "content": "<p><strong>The experiments on where the slowness occurs:</strong></p>\n<p>Before my latest experiment, my penultimate experiment involved a file with 1000 lines, i.e. 500 copies of </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">exact?</span>\n</code></pre></div>\n<p>When run from Git Bash, no matter which project the file is in, it runs fast.<br>\nWhen run in VSCode, no matter which project the file is in, everything turns blue fast. However, when I try to edit, it responds fast in (1) and (2), but slow in (3).</p>\n<p>But 1 + 1 = 2 is easy no matter how many times it's repeated, so I did my latest experiment to support my guess that slowness only occurs when editing:</p>\n<p>I have a file with \"import Mathlib\" and 800 lines. I made one copy in (2) and one in (3). </p>\n<p>I open one of them and record the time it needed for everything to turn blue, and then I edit something to see how fast it responds. I did this multiple times in each of (2) and (3), and the conclusion is they spend similar time on turning everything blue, but when editing, it responds fast in (2) but slow in (3).</p>",
        "id": 484803052,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732743487
    },
    {
        "content": "<p>Thanks, that's helpful to me at least. It seems like from that description that it'd be useful at least to try creating a project dependent on Mathlib for the intermediate versions between 4.2.0 and 4.14 to see where things get slow maybe, unless someone has a better idea. E.g. if you create a project for lean <code>4.7.0</code> and you depend on Mathlib (which has a <code>4.7.0</code> git tag you can use), and then open it, is it slow or fast?</p>",
        "id": 484822451,
        "sender_full_name": "Julian Berman",
        "timestamp": 1732756267
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321696\">Julian Berman</span> <a href=\"#narrow/channel/270676-lean4/topic/Compiling.20too.20slow/near/484822451\">said</a>:</p>\n<blockquote>\n<p>Thanks, that's helpful to me at least. It seems like from that description that it'd be useful at least to try creating a project dependent on Mathlib for the intermediate versions between 4.2.0 and 4.14 to see where things get slow maybe, unless someone has a better idea. E.g. if you create a project for lean <code>4.7.0</code> and you depend on Mathlib (which has a <code>4.7.0</code> git tag you can use), and then open it, is it slow or fast?</p>\n</blockquote>\n<p>Thank you! But I'm afraid that I don't know how to create a project with Mathlib for a specific version</p>",
        "id": 484822877,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732756591
    },
    {
        "content": "<p>I was hoping to have some energy to write a little script for you to do that but I'm a bit exhausted somehow at the moment. Perhaps in an hour I'll get a second wind. Basically Mathlib4 has a git tag that it writes (or has been writing) for the last versions.</p>",
        "id": 484823030,
        "sender_full_name": "Julian Berman",
        "timestamp": 1732756733
    },
    {
        "content": "<p>The slightly annoying bit is the Lake syntax changes a few times in those versions.</p>",
        "id": 484823219,
        "sender_full_name": "Julian Berman",
        "timestamp": 1732756875
    },
    {
        "content": "<p>I <em>think</em> the URL one will work for all of them maybe?</p>",
        "id": 484823241,
        "sender_full_name": "Julian Berman",
        "timestamp": 1732756904
    },
    {
        "content": "<p>What you can try is (generate a project called <code>foo</code> or whatever via <code>lake new foo math.lean</code>. What you're going to do is repeatedly edit the <code>lean-toolchain</code> and <code>lakefile.lean</code> files).</p>\n<p>The syntax which goes in your lakefile.lean and which will depend on a specific version of Mathlib corresponding to your Lean version will be:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">require</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/leanprover-community/mathlib4\"</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"s2\">\"LEAN_VERSION\"</span>\n</code></pre></div>",
        "id": 484823398,
        "sender_full_name": "Julian Berman",
        "timestamp": 1732757012
    },
    {
        "content": "<p>So you change <code>lean-toolchain</code> to have <code>leanprover/lean4:4.7.0</code>, then you change <code>lakefile.lean</code> such that that line I showed has <code>require mathlib from git \"https://github.com/leanprover-community/mathlib4\" @ \"4.7.0\"</code> and <em>hopefully</em> that should work for all versions, and then you can do your fast/slow testi.</p>",
        "id": 484823496,
        "sender_full_name": "Julian Berman",
        "timestamp": 1732757067
    },
    {
        "content": "<p>Does that help to get started maybe?</p>",
        "id": 484823521,
        "sender_full_name": "Julian Berman",
        "timestamp": 1732757089
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321696\">Julian Berman</span> <a href=\"#narrow/channel/270676-lean4/topic/Compiling.20too.20slow/near/484823521\">said</a>:</p>\n<blockquote>\n<p>Does that help to get started maybe?</p>\n</blockquote>\n<p><a href=\"/user_uploads/3121/V-Pw0sb7lN4cS5VRFos--GZO/image.png\">image.png</a><br>\n<a href=\"/user_uploads/3121/EK4rrY8k2pfPSV8a8N5gQPRQ/image.png\">image.png</a><br>\nThank you so much! I got this error</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/V-Pw0sb7lN4cS5VRFos--GZO/image.png\" title=\"image.png\"><img data-original-dimensions=\"1059x710\" src=\"/user_uploads/thumbnail/3121/V-Pw0sb7lN4cS5VRFos--GZO/image.png/840x560.webp\"></a></div><div class=\"message_inline_image\"><a href=\"/user_uploads/3121/EK4rrY8k2pfPSV8a8N5gQPRQ/image.png\" title=\"image.png\"><img data-original-dimensions=\"2777x861\" src=\"/user_uploads/thumbnail/3121/EK4rrY8k2pfPSV8a8N5gQPRQ/image.png/840x560.webp\"></a></div>",
        "id": 484824755,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732757883
    },
    {
        "content": "<p>Bleh OK more syntax has changed, one second let me try.</p>",
        "id": 484824842,
        "sender_full_name": "Julian Berman",
        "timestamp": 1732758001
    },
    {
        "content": "<p>I guess an easier way to do this is to use <code>lake</code> for each corresponding version, which is what I was going to script up, but let's see if we can make this work first.</p>",
        "id": 484824906,
        "sender_full_name": "Julian Berman",
        "timestamp": 1732758027
    },
    {
        "content": "<p>OK here's a minimal (complete) lakefile.lean which should avoid some of the changes:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lake</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">DSL</span>\n\n<span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n\n<span class=\"n\">require</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/leanprover-community/mathlib4\"</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"s2\">\"v4.8.0\"</span>\n\n<span class=\"n\">lean_lib</span><span class=\"w\"> </span><span class=\"bp\">«</span><span class=\"n\">Foo</span><span class=\"bp\">»</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n</code></pre></div>\n<p>Try that.</p>",
        "id": 484825055,
        "sender_full_name": "Julian Berman",
        "timestamp": 1732758169
    },
    {
        "content": "<p>(It's good you have patience by the way! I'm sure this is solvable if we can figure out where the issue ends up being, so yeah props for being persistent.)</p>",
        "id": 484825090,
        "sender_full_name": "Julian Berman",
        "timestamp": 1732758231
    },
    {
        "content": "<p>Yes I'll never give up with all these help!</p>",
        "id": 484825368,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732758364
    },
    {
        "content": "<p>Now there's no error</p>",
        "id": 484825374,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732758370
    },
    {
        "content": "<p>I'll try to do some tests</p>",
        "id": 484825381,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732758380
    },
    {
        "content": "<p>Oh no there is this error<br>\n<a href=\"/user_uploads/3121/76fCJttxdMmKLreZIFu7Em67/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/76fCJttxdMmKLreZIFu7Em67/image.png\" title=\"image.png\"><img data-original-dimensions=\"1779x1150\" src=\"/user_uploads/thumbnail/3121/76fCJttxdMmKLreZIFu7Em67/image.png/840x560.webp\"></a></div>",
        "id": 484825525,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732758512
    },
    {
        "content": "<p>Heh, yeah ok I guess I picked the hard way. You can <code>rm lake-manifest.json</code> and try again then I think that error will go away.</p>",
        "id": 484825560,
        "sender_full_name": "Julian Berman",
        "timestamp": 1732758560
    },
    {
        "content": "<p>Do you mean typing in the terminal in VSCode?</p>",
        "id": 484826073,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732759009
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/-4zXzIJBLzDBKI6M3pfv7pBi/image.png\">image.png</a><br>\nI reopened the project and got this</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/-4zXzIJBLzDBKI6M3pfv7pBi/image.png\" title=\"image.png\"><img data-original-dimensions=\"481x317\" src=\"/user_uploads/thumbnail/3121/-4zXzIJBLzDBKI6M3pfv7pBi/image.png/840x560.webp\"></a></div>",
        "id": 484826102,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732759052
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"781091\">Samuel Yin</span> <a href=\"#narrow/channel/270676-lean4/topic/Compiling.20too.20slow/near/484826073\">said</a>:</p>\n<blockquote>\n<p>Do you mean typing in the terminal in VSCode?</p>\n</blockquote>\n<p>Yeah, any way of deleting the <code>lake-manifest.json</code> (which it seems like was being complained about). The line I gave was meant for the terminal.</p>",
        "id": 484826580,
        "sender_full_name": "Julian Berman",
        "timestamp": 1732759394
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"781091\">Samuel Yin</span> <a href=\"#narrow/channel/270676-lean4/topic/Compiling.20too.20slow/near/484826102\">said</a>:</p>\n<blockquote>\n<p><a href=\"/user_uploads/3121/-4zXzIJBLzDBKI6M3pfv7pBi/image.png\">image.png</a><br>\nI reopened the project and got this</p>\n</blockquote>\n<p>Hm. What does the output say if you click that \"Go to Output\" button in the second popup?</p>",
        "id": 484826597,
        "sender_full_name": "Julian Berman",
        "timestamp": 1732759419
    },
    {
        "content": "<p>Oh sorry I reopened again and now the error is gone</p>",
        "id": 484826751,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732759551
    },
    {
        "content": "<p>I'm going to proceed with the tests then</p>",
        "id": 484826813,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732759585
    },
    {
        "content": "<p>Great!</p>",
        "id": 484826863,
        "sender_full_name": "Julian Berman",
        "timestamp": 1732759652
    },
    {
        "content": "<p>I tested several versions back and forth: 4.5.0 and 4.7.0 are good. 4.8.0-rc1, 4.8.0 and 4.9.0 are slow.</p>",
        "id": 484830360,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732762178
    },
    {
        "content": "<p>4.10.0 and 4.11.0 are also slow. When it comes to 4.12.0 there is error in lakefile.lean so I guess the syntax changes</p>",
        "id": 484830834,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732762500
    },
    {
        "content": "<p>Do any of the following VS Codes commands make the file fast again? You can invoke them with Ctrl+Shift+P and then typing part of the command name.</p>\n<ul>\n<li><code>Lean 4 Server: Restart File</code></li>\n<li><code>Lean 4 Server: Restart Server</code></li>\n<li><code>Developer: Restart Extension Host</code></li>\n</ul>\n<p>(Commands are listed in order of the strength. The later commands will do the former plus more.)</p>",
        "id": 484834692,
        "sender_full_name": "Mac Malone",
        "timestamp": 1732765226
    },
    {
        "content": "<p>In my experience Lean can get gradually slower on Windows over time if it gets caught doing too much background processing.. In my expereince, these commands cam be used to make things fast again . My slowdowns, however, have not been as quick or as drastic as yours.</p>",
        "id": 484834849,
        "sender_full_name": "Mac Malone",
        "timestamp": 1732765366
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"781091\">Samuel Yin</span> <a href=\"#narrow/channel/270676-lean4/topic/Compiling.20too.20slow/near/484830360\">said</a>:</p>\n<blockquote>\n<p>I tested several versions back and forth: 4.5.0 and 4.7.0 are good. 4.8.0-rc1, 4.8.0 and 4.9.0 are slow.</p>\n</blockquote>\n<p>Thanks, this is already pretty helpful.</p>\n<p>It's another long-shot, but in your project that is using Mathlib on 4.8.0, after closing VS Code, could you try deleting all files ending in <code>.ilean</code> in the <code>.lake</code> folder in the project and try your reproduction again and whether it's faster? This won't work anymore once you need to import anything from Mathlib, but it will provide us with some more info.</p>\n<p>In the Git bash terminal (which should have been installed when you installed Git), you should be able to delete all .ilean files in .lake by navigating to .lake with <code>cd</code> and then running <code>find . -name \"*.ilean\" -type f -delete</code> in that folder. If you want to confirm that it's deleting the right files beforehand, you can also run <code>find . -name \"*.ilean\" -type f</code> there.<br>\nApparently, you can also do this in PowerShell with <code>ls *.ilean -Recurse | foreach {rm $_}</code> after navigating to the folder, but I haven't tried it.</p>",
        "id": 484882432,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1732788317
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"315577\">Mac Malone</span> <a href=\"#narrow/channel/270676-lean4/topic/Compiling.20too.20slow/near/484834692\">said</a>:</p>\n<blockquote>\n<p>Do any of the following VS Codes commands make the file fast again? You can invoke them with Ctrl+Shift+P and then typing part of the command name.</p>\n<ul>\n<li><code>Lean 4 Server: Restart File</code></li>\n<li><code>Lean 4 Server: Restart Server</code></li>\n<li><code>Developer: Restart Extension Host</code></li>\n</ul>\n<p>(Commands are listed in order of the strength. The later commands will do the former plus more.)</p>\n</blockquote>\n<p>Thank you for your advice. Unfortunately they don't :(</p>",
        "id": 484890924,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732790774
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"221921\">Marc Huisinga</span> <a href=\"#narrow/channel/270676-lean4/topic/Compiling.20too.20slow/near/484882432\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"781091\">Samuel Yin</span> <a href=\"#narrow/channel/270676-lean4/topic/Compiling.20too.20slow/near/484830360\">said</a>:</p>\n<blockquote>\n<p>I tested several versions back and forth: 4.5.0 and 4.7.0 are good. 4.8.0-rc1, 4.8.0 and 4.9.0 are slow.</p>\n</blockquote>\n<p>Thanks, this is already pretty helpful.</p>\n<p>It's another long-shot, but in your project that is using Mathlib on 4.8.0, after closing VS Code, could you try deleting all files ending in <code>.ilean</code> in the <code>.lake</code> folder in the project and try your reproduction again and whether it's faster? This won't work anymore once you need to import anything from Mathlib, but it will provide us with some more info.</p>\n<p>In the Git bash terminal (which should have been installed when you installed Git), you should be able to delete all .ilean files in .lake by navigating to .lake with <code>cd</code> and then running <code>find . -name \"*.ilean\" -type f -delete</code> in that folder. If you want to confirm that it's deleting the right files beforehand, you can also run <code>find . -name \"*.ilean\" -type f</code> there.<br>\nApparently, you can also do this in PowerShell with <code>ls *.ilean -Recurse | foreach {rm $_}</code> after navigating to the folder, but I haven't tried it.</p>\n</blockquote>\n<p>After doing that there was some error, so I run <code>rm lake-manifest.json</code> as usual, and now there is still an error (after reopening VSCode several times)<br>\n<a href=\"/user_uploads/3121/l1LnLJS1q1cTuPhgU_V2dMR5/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/l1LnLJS1q1cTuPhgU_V2dMR5/image.png\" title=\"image.png\"><img data-original-dimensions=\"1919x1079\" src=\"/user_uploads/thumbnail/3121/l1LnLJS1q1cTuPhgU_V2dMR5/image.png/840x560.webp\"></a></div>",
        "id": 484894118,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732791729
    },
    {
        "content": "<p>Did you actually delete the <code>.ilean</code> files, or did you accidentally delete the <code>.lean</code> files, too?</p>",
        "id": 484894779,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1732791955
    },
    {
        "content": "<p>oh sorry! I actually only delete the .lean files.</p>",
        "id": 484895010,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732792028
    },
    {
        "content": "<p>Then I guess I will recreate a project and do that again</p>",
        "id": 484895052,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732792042
    },
    {
        "content": "<p>It works!!</p>",
        "id": 484896638,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732792528
    },
    {
        "content": "<p>It can do 1 + 1 = 2 smoothly now</p>",
        "id": 484897049,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732792656
    },
    {
        "content": "<p>Great! So it's related to the .ileans after all, even though it's not the loading of the .ilean files (since the issue didn't go away after 10 minutes on your end). </p>\n<p>The next step is to obtain the language server trace. You can do so as follows:</p>\n<ol>\n<li>Open the settings menu.</li>\n<li>\n<p>In the top right, click the 'Open Settings (JSON)' button. It looks like this: <br>\n<a href=\"/user_uploads/3121/kKmkLpOtnjfZJaKFoZBuUDit/image.png\">'Open Settings (JSON)' button</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/kKmkLpOtnjfZJaKFoZBuUDit/image.png\" title=\"'Open Settings (JSON)' button\"><img data-original-dimensions=\"118x31\" src=\"/user_uploads/thumbnail/3121/kKmkLpOtnjfZJaKFoZBuUDit/image.png/840x560.webp\"></a></div></li>\n<li>\n<p>Paste the following line at the end of the settings file to enable tracing: <code>\"lean4.trace.server\": \"verbose\"</code>. My config looks like this after adding the setting (note that the setting is inserted before the closing <code>}</code> bracket and has no trailing comma, unlike the other options): <br>\n<a href=\"/user_uploads/3121/N3EMoEI06sLqbp2DLgF4qzW2/image.png\">settings.json</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/N3EMoEI06sLqbp2DLgF4qzW2/image.png\" title=\"settings.json\"><img data-original-dimensions=\"594x861\" src=\"/user_uploads/thumbnail/3121/N3EMoEI06sLqbp2DLgF4qzW2/image.png/840x560.webp\"></a></div><ul>\n<li>In the editor for <code>settings.json</code>, VS Code will tell you that the <code>lean4.trace.server</code> configuration option isn't known, but it's lying and you can safely ignore that.</li>\n</ul>\n</li>\n<li>\n<p>Save the file.</p>\n</li>\n<li>Close VS Code and restart it.</li>\n<li>Open your project and the file within it, wait for a couple of minutes (it's best not to touch the file during this) and only then start editing the file. Lean should still feel slow.</li>\n<li>\n<p>Use the 'Troubleshooting: Show Output' command (It can be found in the forall menu). It should display a panel titled \"Output\" that is focused on \"Lean: Editor\", e.g. something similar to this: <br>\n<a href=\"/user_uploads/3121/D7-7NdEviR6hg9mG1cVzvOOy/image.png\">Output panel</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/D7-7NdEviR6hg9mG1cVzvOOy/image.png\" title=\"Output panel\"><img data-original-dimensions=\"824x526\" src=\"/user_uploads/thumbnail/3121/D7-7NdEviR6hg9mG1cVzvOOy/image.png/840x560.webp\"></a></div></li>\n<li>\n<p>Copy the full output (Ctrl+A and then Ctrl+C), paste it into a file and upload the file on Zulip. It shouldn't contain any private information except for Lean file paths (it's just the protocol data between Lean and VS Code), but you can also send it to me in a PM.</p>\n</li>\n</ol>",
        "id": 484913925,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1732798238
    },
    {
        "content": "<p>(After you are done, you should remove the <code>\"lean4.trace.server\": \"verbose\"</code> line from your settings file again)</p>",
        "id": 484916149,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1732798900
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/_NFtspWgKEnDKTJZ2-Sh_wQN/Output.txt\">Output.txt</a><br>\nThank you! Is this OK?</p>",
        "id": 484916806,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732799117
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"781091\">Samuel Yin</span> <a href=\"#narrow/channel/270676-lean4/topic/Compiling.20too.20slow/near/484916806\">said</a>:</p>\n<blockquote>\n<p><a href=\"/user_uploads/3121/_NFtspWgKEnDKTJZ2-Sh_wQN/Output.txt\">Output.txt</a><br>\nThank you! Is this OK?</p>\n</blockquote>\n<p>I may have found a pretty huge performance issue thanks to this investigation, and I'm extremely surprised that you are the first person to report this.</p>\n<p>Do you have auto-save enabled? If so, can you try disabling it and see if the issue persists?</p>",
        "id": 484921768,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1732800667
    },
    {
        "content": "<p>It works!!!</p>",
        "id": 484967573,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732816831
    },
    {
        "content": "<p>Great! :-) Thanks a lot for helping debug this, I'm sure this has tripped up a bunch of people in the past and you were the first to report this. It should also resolve a significant performance hit that everyone else encounters when they save manually.</p>\n<p>Fix: <a href=\"https://github.com/leanprover/lean4/pull/6246\">lean4#6246</a></p>",
        "id": 484967874,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1732816969
    },
    {
        "content": "<p>(Regardless, I would still recommend to store your Lean projects outside of OneDrive or other cloud integrations. If you want to sync them with others, it's best to use Git, e.g. via <a href=\"https://desktop.github.com/download/\">GitHub Desktop</a> and <a href=\"https://github.com/\">GitHub</a>!)</p>",
        "id": 484968138,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1732817098
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"221921\">Marc Huisinga</span> <a href=\"#narrow/channel/270676-lean4/topic/Compiling.20too.20slow/near/484968138\">said</a>:</p>\n<blockquote>\n<p>(Regardless, I would still recommend to store your Lean projects outside of OneDrive or other cloud integrations. If you want to sync them with others, it's best to use Git, e.g. via <a href=\"https://desktop.github.com/download/\">GitHub Desktop</a> and <a href=\"https://github.com/\">GitHub</a>!)</p>\n</blockquote>\n<p>I wanted to ask about that! Thank you!</p>",
        "id": 484968556,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732817355
    },
    {
        "content": "<p>Do you mean that you have resolved the issue or shall I keep auto-save disabled for now?</p>",
        "id": 484968581,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732817371
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"781091\">Samuel Yin</span> <a href=\"#narrow/channel/270676-lean4/topic/Compiling.20too.20slow/near/484968581\">said</a>:</p>\n<blockquote>\n<p>Do you mean that you have resolved the issue or shall I keep auto-save disabled for now?</p>\n</blockquote>\n<p>Keep it disabled for now and the fix should land in the next release candidate (v4.15.0-rc1). New Lean versions are usually announced in <a class=\"stream\" data-stream-id=\"113486\" href=\"/#narrow/channel/113486-announce\">#announce</a>. You should be able to re-enable it on Lean versions after that.</p>",
        "id": 484968787,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1732817486
    },
    {
        "content": "<p>I see. Thank you!</p>",
        "id": 484969040,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732817630
    },
    {
        "content": "<p>Also many thanks to everyone in this conversation for your help!</p>",
        "id": 484969053,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732817639
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"781091\">Samuel Yin</span> has marked this topic as resolved.</p>",
        "id": 484969577,
        "sender_full_name": "Notification Bot",
        "timestamp": 1732817907
    },
    {
        "content": "<p>This thread is a great example of teamwork, cliche as it sounds. Well done to all of us (Samuel certainly equally you).</p>",
        "id": 484970346,
        "sender_full_name": "Julian Berman",
        "timestamp": 1732818334
    },
    {
        "content": "<p>Couldn't agree more - it's been a great experience for me!</p>",
        "id": 484970969,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732818660
    },
    {
        "content": "<p>Shouldn't this fix be backported to 4.14? It looks pretty important.</p>",
        "id": 484991027,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1732831144
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"781091\">@Samuel Yin</span> thanks very very much for (a) reporting this and (b) persevering with the debugging. Come to Xena in two weeks' time and I'll buy you dinner (I would have said next week but I'll be in Pittsburgh). <span class=\"user-mention\" data-user-id=\"221921\">@Marc Huisinga</span> also thank you very much for persevering. Samuel is doing his MSc project in lean and during a live screenshare session he showed me what he was having to endure and it was pretty clear that he would not be able to complete the project at all easily with things in the state that they had somehow gotten into, so your work has played a substantial role in sorting out what could have turned into a major inconvenience.</p>",
        "id": 484995904,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1732835154
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/270676-lean4/topic/.E2.9C.94.20Compiling.20too.20slow/near/484995904\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"781091\">Samuel Yin</span> thanks very very much for (a) reporting this and (b) persevering with the debugging. Come to Xena in two weeks' time and I'll buy you dinner (I would have said next week but I'll be in Pittsburgh). <span class=\"user-mention silent\" data-user-id=\"221921\">Marc Huisinga</span> also thank you very much for persevering. Samuel is doing his MSc project in lean and during a live screenshare session he showed me what he was having to endure and it was pretty clear that he would not be able to complete the project at all easily with things in the state that they had somehow gotten into, so your work has played a substantial role in sorting out what could have turned into a major inconvenience.</p>\n</blockquote>\n<p>Thank you so much! I wouldn't have known what to begin with without your suggestion. I'm really glad that I can contribute to the community, and have my own issue solved at the same time. I know you must have a lot of work to do but I'm sure there will be plenty of opportunities to catch up in the future.</p>",
        "id": 484999703,
        "sender_full_name": "Samuel Yin",
        "timestamp": 1732838544
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/channel/270676-lean4/topic/.E2.9C.94.20Compiling.20too.20slow/near/484991027\">said</a>:</p>\n<blockquote>\n<p>Shouldn't this fix be backported to 4.14? It looks pretty important.</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"110031\">@Patrick Massot</span>, we thought about it, but decided not to backport. It will be available in v4.15.0-rc1 in a few days.</p>",
        "id": 485008953,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732846439
    },
    {
        "content": "<p>This is again encouraging people to all use release candidates instead of stable versions <span aria-label=\"sad\" class=\"emoji emoji-2639\" role=\"img\" title=\"sad\">:sad:</span></p>",
        "id": 485158225,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1732913013
    },
    {
        "content": "<p>I'm happy to explain why we decided not to backport it, Patrick. </p>\n<p>One of the main reasons for why we have release candidates is so that changes can get tested on a release candidate for a while before they make it into a stable release. This applies to both features and bug fixes. Even when I'm very confident in a change like this one, changes to the language server are always tricky and prone to all kinds of incidental errors due to the nature of the component. Merging a language server change effectively straight into a stable release with mere days of time left on a release candidate is generally a bad idea. This isn't the elaboration or tactic infrastructure where every change is immediately and automatically tested by tens of thousands of lines of code in Mathlib, and you can be fairly confident that a change is sound as soon as it passes a build.</p>\n<p>This issue has been in Lean since 4.8 and hasn't been reported since, so it is clearly not super common and there's a workaround available for anyone who does encounter it on Lean versions between 4.8 and 4.15. I don't see it as being so latency sensitive that we must backport it into 4.14 now immediately at the significant cost of bypassing an important safety mechanism.</p>\n<p>I hope you understand.</p>",
        "id": 485160368,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1732914313
    },
    {
        "content": "<p>Thanks for the explanation and all your hard work Marc.</p>",
        "id": 485216802,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1732963717
    },
    {
        "content": "<p>I'm a little surprised to hear that this bug is caused by autosave, because I think that's been the default behavior on Gitpod since forever. Maybe GItpod autosave is somehow different to the setting in question here? Or maybe I've just put up with the performance issue forever...</p>",
        "id": 485437081,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733017635
    },
    {
        "content": "<p>It was only since this thread that I began to notice that sometimes the same thing would happen to me, but I hesitated to mention it during the debugging because I thought I might be the victim of some kind of weird psycological issue where someone else had something and I wanted it too. One thing was for sure though, it was happening rarely to me, rather than all the time as in Samuel's situation.</p>",
        "id": 485456675,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733038036
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/270676-lean4/topic/.E2.9C.94.20Compiling.20too.20slow/near/485437081\">said</a>:</p>\n<blockquote>\n<p>I'm a little surprised to hear that this bug is caused by autosave, because I think that's been the default behavior on Gitpod since forever. Maybe GItpod autosave is somehow different to the setting in question here? Or maybe I've just put up with the performance issue forever...</p>\n</blockquote>\n<p>I've checked and this issue definitely affects Gitpod as well, they just appear to be much quicker at traversing the directory tree than is the case on Samuel's machine. There's a good chance that this has to do with Windows vs Linux, as well as the use of OneDrive.</p>\n<p>By default, auto-save triggers a second after the change, so all notifications and requests that go through within that time window are quick. This usually includes editor diagnostics and the state of the InfoView for that change, which are responded to quickly. Requests sent immediately after the one second window then need to wait for the erroneous directory walk to complete.<br>\nHowever, as soon as you make multiple changes to the document, the messages for editor diagnostics and the state of the InfoView may also end up in the \"slow-down window\" of a previous change. So the slower the erroneous directory walk, the more likely your editor diagnostics and InfoView state will be delayed significantly by previous changes as well.<br>\nIf the \"slow-down window\" is larger than a second, VS Code will still send file watcher updates to the server within a second after a change, which again causes it to traverse the full directory structure. When this happens, if you keep making changes to the document, the watchdog of the server will just be entirely busy with old file watcher updates and the added latency for further requests keeps accumulating.</p>\n<p>In my testing, after multiple changes to the document on Gitpod with auto-save enabled, requests sometimes take roughly 200-250ms to be responded to. After disabling auto-save, they are consistently responded to within 1ms-2ms.<br>\n250ms of added latency is definitely annoying, but not as horrible as the 3s-5s latency that Samuel was experiencing.</p>",
        "id": 485477944,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1733056494
    }
]