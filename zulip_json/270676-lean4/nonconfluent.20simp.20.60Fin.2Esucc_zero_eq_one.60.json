[
    {
        "content": "<p>I came across an example like this where I would expect <code>simp</code> to apply the simp lemma <code>Fin.cases_succ</code>. However, it first applies <code>Fin.succ_zero_eq_one</code>, turning <code>0.succ</code> into <code>1</code>, so that <code>Fin.cases_succ</code> doesn't work anymore.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"c1\">--only [Fin.cases_succ]</span>\n<span class=\"c1\">-- unsolved goals</span>\n<span class=\"c1\">-- ‚ä¢ Fin.cases False (fun x =&gt; True) 1</span>\n</code></pre></div>\n<p>Is there a way to fix this? Or is the only way to add copies of <code>Fin.cases_succ</code> for the special case of <code>1</code> and <code>2</code> (since there is also <code>Fin.succ_one_eq_two</code>)</p>",
        "id": 484342644,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1732551569
    },
    {
        "content": "<p>Yes, I think adding the extra copies is required.</p>\n<p>(Although I am a bit surprised the confluence checker isn't detecting this one, it seems like it should...)</p>\n<p>I think <code>succ_zero_eq_one</code> is probably a good simp lemma, although Lean itself compiles fine without it. We can see at <a href=\"https://github.com/leanprover/lean4/pull/6292\">lean#6292</a> what the downstream fallout is.</p>",
        "id": 485728931,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733184094
    },
    {
        "content": "<p>After I installed some new simprocs for <code>Fin</code>, there are only two failures in Mathlib from removing these simp lemmas, and they are easy to work around... Still uncertain whether it is a good idea to remove.</p>",
        "id": 485770017,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733209246
    },
    {
        "content": "<p>The lemma <code>pred_succ</code> on the other hand does come with the lemma <code>pred_one</code>.</p>\n<p>And I think your PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/6295\">#6295</a> adding simprocs for <code>Fin</code>, makes the simp lemma <code>succ_zero_eq_one</code> redundant?</p>",
        "id": 486187557,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1733350111
    },
    {
        "content": "<p>How does the confluence checker work? Does it try to find critical pairs?</p>",
        "id": 486187595,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1733350136
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479299\">Jovan Gerbscheid</span> <a href=\"#narrow/channel/270676-lean4/topic/nonconfluent.20simp.20.60Fin.2Esucc_zero_eq_one.60/near/486187557\">said</a>:</p>\n<blockquote>\n<p>And I think your PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/6295\">#6295</a> adding simprocs for <code>Fin</code>, makes the simp lemma <code>succ_zero_eq_one</code> redundant?</p>\n</blockquote>\n<p>No, the simproc will only fire for \"ground\" values of <code>n</code>.</p>",
        "id": 486194857,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733353928
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479299\">Jovan Gerbscheid</span> <a href=\"#narrow/channel/270676-lean4/topic/nonconfluent.20simp.20.60Fin.2Esucc_zero_eq_one.60/near/486187595\">said</a>:</p>\n<blockquote>\n<p>How does the confluence checker work? Does it try to find critical pairs?</p>\n</blockquote>\n<p>Yes. The confluence checker is in <a href=\"https://github.com/leanprover/lean4/pull/5717\">lean#5717</a>, unfortunately still not merged. (My fault, we keep accumulating non-confluence problems faster than I fix them. ...)</p>",
        "id": 486194929,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733353985
    }
]