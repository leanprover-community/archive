[
    {
        "content": "<p>Is it expected that <code>tri'</code> doesn't compile?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">tri</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">tri</span><span class=\"w\"> </span><span class=\"n\">m</span>\n\n<span class=\"kn\">section</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">tri'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">tri'</span><span class=\"w\"> </span><span class=\"n\">m</span>\n\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 451369702,
        "sender_full_name": "James Sully",
        "timestamp": 1720978047
    },
    {
        "content": "<p>Yes, you can only do recursion on variables in the function's parameter list.</p>\n<p>(A <a href=\"#narrow/stream/270676-lean4/topic/.60variable.60.20puzzle/near/450957065\">recent thread</a>)</p>",
        "id": 451370192,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1720978568
    },
    {
        "content": "<p>Thanks! I guess my intuition that <code>variable</code> just adds to the parameter list of any definition that refers to it is subtly wrong</p>",
        "id": 451370324,
        "sender_full_name": "James Sully",
        "timestamp": 1720978719
    },
    {
        "content": "<p>Not an explanation for why it works this way, but during elaboration these parameters are added <em>before</em> your <code>tri'</code> starts to be elaborated, and during elaboration a local function <code>tri'</code> is added (later, any calls to <code>tri'</code> will be \"compiled out\"). It makes some sense that this local <code>tri'</code> wouldn't be responsible for pre-existing variables.</p>",
        "id": 451370867,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1720979328
    },
    {
        "content": "<p>I can't quite follow this sorry<br>\n</p>\n<blockquote>\n<p>a local function <code>tri'</code> is added</p>\n</blockquote>\n<ul>\n<li>what does \"local\" mean in this context?</li>\n<li>added to what?</li>\n<li>isn't <code>tri'</code> already there?</li>\n</ul>",
        "id": 451401099,
        "sender_full_name": "James Sully",
        "timestamp": 1721010689
    },
    {
        "content": "<p>Added to the local context.</p>\n<p>The <code>tri'</code> function doesn't exist globally until after the whole definition is elaborated and processed. Until then, there's a secret <code>tri'</code> function in the local context that you're referring to. (It's marked in such a way that you can't see it in the Infoview.)</p>",
        "id": 451568065,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1721065227
    }
]