[
    {
        "content": "<p>Is it possible to do this in Lean? Or does dependent type theory allow this?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"c1\">-- get Nat from t</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"c1\">-- get String from t</span>\n</code></pre></div>",
        "id": 453983693,
        "sender_full_name": "kbridge",
        "timestamp": 1721922450
    },
    {
        "content": "<p>yes, using <code>t.fst</code> and <code>t.snd</code></p>",
        "id": 453998393,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1721925689
    },
    {
        "content": "<p>or wait, maybe not like that... let me think about it</p>",
        "id": 453998486,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1721925723
    },
    {
        "content": "<p>it isn't possible: what you want is a function <code>Type -&gt; Type</code> which, when the left type is a product, produces the left (or right) type, however, that function isn't total...</p>",
        "id": 454000086,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1721926233
    },
    {
        "content": "<p>i.e. there is no defintion for what to do when <code>t</code> <em>isn't</em> a product.</p>",
        "id": 454000343,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1721926279
    },
    {
        "content": "<p>If you're willing to change the definition of <code>t</code> a little, you could write:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">fst</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">snd</span>\n</code></pre></div>",
        "id": 454001532,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1721926638
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/stream/270676-lean4/topic/extract.20component.20type.20from.20product.20type/near/454000086\">said</a>:</p>\n<blockquote>\n<p>it isn't possible: what you want is a function <code>Type -&gt; Type</code> which, when the left type is a product, produces the left (or right) type, however, that function isn't total...</p>\n</blockquote>\n<p>How about defining a function <code>Type -&gt; Option Type</code>?</p>\n<p>But pattern matching rejects it...</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">first</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">some</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">none</span>\n</code></pre></div>",
        "id": 454036035,
        "sender_full_name": "kbridge",
        "timestamp": 1721935758
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"372804\">Marcus Rossel</span> <a href=\"#narrow/stream/270676-lean4/topic/extract.20component.20type.20from.20product.20type/near/454001532\">said</a>:</p>\n<blockquote>\n<p>If you're willing to change the definition of <code>t</code> a little, you could write:</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">fst</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">snd</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>but then <code>t</code> isn't a <code>Type</code> anymore right?</p>\n<p>This won't compile:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">Nat</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"s2\">\"ok\"</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 454036477,
        "sender_full_name": "kbridge",
        "timestamp": 1721935877
    },
    {
        "content": "<p><code>Type</code> is not itself an inductive type, it's a universe, and all it's really good for is being the type of types.</p>",
        "id": 454036940,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1721936084
    },
    {
        "content": "<p>You can't do any pattern matching with it. For example, being able to use <code>a × b</code> as a match pattern would require that <code>Prod</code> be injective, but it might be or it might not be.</p>",
        "id": 454037063,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1721936143
    },
    {
        "content": "<p>If you like, a reason you can't do this is that types do not have any runtime representation, so there's no data to do a match on.</p>",
        "id": 454037155,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1721936174
    },
    {
        "content": "<p>is there possibly an <a href=\"https://en.wikipedia.org/wiki/XY_problem\">#xy</a> going on here? because if you have that <code>x:a × b</code> for some <code>a, b : Type</code>, it is definitely possible to recover <code>a</code> or <code>b</code>.</p>",
        "id": 454037372,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1721936282
    },
    {
        "content": "<p>Even though you can't <code>match</code> on types, you can do syntactic matching on types using typeclasses, which is more in the \"metaprogramming\" vs \"programming\" realm.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">IsProd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">firstType</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">  </span><span class=\"n\">secondType</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsProd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">firstType</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">α</span>\n<span class=\"w\">  </span><span class=\"n\">secondType</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">β</span>\n\n<span class=\"bp\">#</span><span class=\"n\">reduce</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">IsProd</span><span class=\"bp\">.</span><span class=\"n\">firstType</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span>\n<span class=\"c1\">-- Nat</span>\n<span class=\"bp\">#</span><span class=\"n\">reduce</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">IsProd</span><span class=\"bp\">.</span><span class=\"n\">secondType</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span>\n<span class=\"c1\">-- Int</span>\n</code></pre></div>",
        "id": 454037524,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1721936337
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> Thanks man, this is helpful!</p>",
        "id": 454159206,
        "sender_full_name": "kbridge",
        "timestamp": 1721965518
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> I want to know more about universes in dependent types. Where should I start?</p>",
        "id": 454160288,
        "sender_full_name": "kbridge",
        "timestamp": 1721965908
    },
    {
        "content": "<p><a href=\"https://leanprover.github.io/theorem_proving_in_lean4/\">#tpil</a> is where I learnt about them</p>",
        "id": 454196063,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1721977584
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"739890\">kbridge</span> has marked this topic as resolved.</p>",
        "id": 454467758,
        "sender_full_name": "Notification Bot",
        "timestamp": 1722083007
    },
    {
        "content": "<p>I found this <a href=\"https://www.youtube.com/watch?v=AWeT_G04a0A\">talk</a> very helpful.</p>\n<div class=\"youtube-video message_inline_image\"><a data-id=\"AWeT_G04a0A\" href=\"https://www.youtube.com/watch?v=AWeT_G04a0A\"><img src=\"https://uploads.zulipusercontent.net/e527293f4481d55d5a61addbb58429a9cdc97bf5/68747470733a2f2f692e7974696d672e636f6d2f76692f415765545f4730346130412f64656661756c742e6a7067\"></a></div>",
        "id": 454473478,
        "sender_full_name": "kbridge",
        "timestamp": 1722087795
    }
]