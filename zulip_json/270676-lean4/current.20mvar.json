[
    {
        "content": "<p>This is just for fun basically, so,</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"c1\">-- import Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Meta</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">currentMVar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MetaM</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">⟨.</span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"ss\">`_uniq</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">mkFreshMVarId</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">throwError</span><span class=\"w\"> </span><span class=\"s2\">\"aaa\"</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">n</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">currentMVar</span>\n<span class=\"c\">/-</span>\n<span class=\"cm\">977 with import Mathlib</span>\n<span class=\"cm\">887 with import Lean</span>\n<span class=\"cm\">-/</span>\n</code></pre></div>\n<p>I wrote a code to get the \"current number of metavariables\", and found that it's 887 with just <code>import Lean</code>, an 977 with <code>import Mathlib</code></p>",
        "id": 533961918,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754998727
    },
    {
        "content": "<p>does this mean there are 90 unassigned metavariables in Mathlib?</p>",
        "id": 533961943,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754998739
    },
    {
        "content": "<p>no???</p>",
        "id": 533962210,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754998846
    },
    {
        "content": "<p>it means some instance synthesis is happening probably</p>",
        "id": 533962262,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754998864
    },
    {
        "content": "<p>what determines the number i get?</p>",
        "id": 533962268,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754998867
    },
    {
        "content": "<p>the metavariable counter resets for every file</p>",
        "id": 533962310,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754998882
    },
    {
        "content": "<p>the number you get is just sequential based on how many numbers</p>",
        "id": 533962382,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754998913
    },
    {
        "content": "<p>based on how many times the name generator was incremented</p>",
        "id": 533962436,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754998937
    },
    {
        "content": "<p>how many times it was incremented since the file was initialized</p>",
        "id": 533963063,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754999173
    },
    {
        "content": "<p>That number gets incremented all the time but never decremented. Most notably it gets used for <code>mkFreshMVarId</code> and <code>mkFreshFVarId</code> which get indirectly called tons of times in pretty much every meta program. You can see this by just querying the name generator twice:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Meta</span>\n\n<span class=\"sd\">/-- info: { namePrefix := `_uniq, idx := 1147 } -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">getNGen</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MetaM</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">NameGenerator</span><span class=\"o\">)</span>\n\n<span class=\"sd\">/-- info: { namePrefix := `_uniq, idx := 2293 } -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">getNGen</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MetaM</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">NameGenerator</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>As you can see, the single <code>#eval</code> command is already responsible for 1146 increments (it's 1 in its initial state)</p>",
        "id": 535806776,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1755955832
    }
]