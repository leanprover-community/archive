[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">fib</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">fib</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"c1\">-- n.fib</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">fib</span><span class=\"w\"> </span><span class=\"c1\">-- Nat.fib 3</span>\n</code></pre></div>\n<p>I've noticed that sometimes pp uses dot notation and sometimes it doesn't. What is the exact rule? I can't quite figure it out from my usecases.</p>",
        "id": 543309338,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759755992
    },
    {
        "content": "<p>My not-so-fleshed-out rule is that it tries to round trip, without using type ascriptions.</p>",
        "id": 543310271,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1759756224
    },
    {
        "content": "<p>That at least works in the case above!</p>",
        "id": 543310325,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1759756238
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> the real testcase (with <code>import Mathlib</code>) that I'm facing is:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">notation</span><span class=\"o\">:</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">ğ’œ</span><span class=\"s2\">\"â‚Š\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">HomogeneousIdeal</span><span class=\"bp\">.</span><span class=\"n\">irrelevant</span><span class=\"w\"> </span><span class=\"n\">ğ’œ</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î¹</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Ïƒ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_2</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_3</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">Î¹</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">Î¹</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">PartialOrder</span><span class=\"w\"> </span><span class=\"n\">Î¹</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CanonicallyOrderedAdd</span><span class=\"w\"> </span><span class=\"n\">Î¹</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SetLike</span><span class=\"w\"> </span><span class=\"n\">Ïƒ</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddSubmonoidClass</span><span class=\"w\"> </span><span class=\"n\">Ïƒ</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ’œ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î¹</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Ïƒ</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">GradedRing</span><span class=\"w\"> </span><span class=\"n\">ğ’œ</span><span class=\"o\">]</span>\n\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">HomogeneousIdeal</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\">  </span><span class=\"n\">HomogeneousIdeal</span><span class=\"w\"> </span><span class=\"n\">ğ’œ</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">HomogeneousIdeal</span><span class=\"w\"> </span><span class=\"n\">ğ’œ</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">ğ’œ</span><span class=\"bp\">â‚Š.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">ğ’œ</span><span class=\"w\"> </span><span class=\"c1\">-- HomogeneousIdeal.map ğ’œ ğ’œâ‚Š</span>\n\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"mi\">3</span>\n</code></pre></div>",
        "id": 543311073,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759756409
    },
    {
        "content": "<p>where the first <code>#check</code> fails to use dot notation</p>",
        "id": 543311123,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759756421
    },
    {
        "content": "<p>(and it isn't because of the notation, you can delete that line)</p>",
        "id": 543311262,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759756449
    },
    {
        "content": "<p>ah... I think it might be because the pp tries to check <code>map</code> and found <code>Ideal.map</code> as well??</p>",
        "id": 543312411,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759756744
    },
    {
        "content": "<p>so <code>I.map</code> wouldn't be unambiguous</p>",
        "id": 543312474,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759756758
    },
    {
        "content": "<p><code>Nat.fib 3</code> doesn't pretty print as <code>3.fib</code> because numerals are special cased (it never uses dot notation for numerals). It's unlikely to round trip. Worse, <code>3.fib</code> doesn't even parse.</p>\n<p>The reason <code>HomogeneousIdeal.map</code> doesn't pretty print with dot notation is that the pretty printer uses the heuristic that it should only use dot notation if the first explicit argument is the \"object\" of dot notation.</p>\n<p>It's not sophisticated enough yet to actually check whether there is an ambiguity with <code>map</code> in other namespaces.</p>",
        "id": 543330044,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1759760638
    },
    {
        "content": "<p>aha! somehow i never noticed maybe, thanks for the (obvious in hindsight) explanation!</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">fib</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">fib</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"c1\">-- Nat.fib m n</span>\n</code></pre></div>",
        "id": 543330328,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759760704
    }
]