[
    {
        "content": "<p>I'm getting the titular error message from a module that contains only <code>import</code>s, and so surely cannot claim any <code>init</code> declarations as its own.</p>\n<p>Roughly my setup is:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- In Linters/Foo.lean</span>\n\n<span class=\"n\">register_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">  </span><span class=\"n\">defValue</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"w\">  </span><span class=\"n\">descr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"foo\"</span>\n<span class=\"o\">}</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">fooLinter</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Linter</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">someFactory</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">foo</span>\n\n<span class=\"n\">initialize</span><span class=\"w\"> </span><span class=\"n\">addLinter</span><span class=\"w\"> </span><span class=\"n\">fooLinter</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- in Linters.lean</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Linters</span><span class=\"bp\">.</span><span class=\"n\">Foo</span>\n</code></pre></div>\n<p>which fails when building  <code>Linters.lean</code> on 4.22.0, complaining about how <code>linter.foo</code> is accessed.</p>",
        "id": 536824732,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1756485004
    },
    {
        "content": "<p><code>init</code> declarations are run in the wrong order, this was also a problem on nightly-testing</p>",
        "id": 536827008,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1756485840
    },
    {
        "content": "<p>Ultimately this was fixed with <code>@[noinline]</code> on a function like:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">logLint</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monad</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MonadLog</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddMessageContext</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MonadOptions</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MonadLiftT</span><span class=\"w\"> </span><span class=\"n\">BaseIO</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">linterOption</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Syntax</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">msg</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MessageData</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">logErrorAt</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">logWarningAt</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">tagged</span><span class=\"w\"> </span><span class=\"n\">linterOption</span><span class=\"bp\">.</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"{msg} [{linterOption.name}]\"</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>which I guess was being inlined and the compiler then tried to inline <code>linter.foo.name</code></p>",
        "id": 536827063,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1756485867
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"873547\">@Robin Arnez</span>, is there a bug report for that?</p>",
        "id": 536828403,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1756486398
    },
    {
        "content": "<p>I don't think so</p>",
        "id": 536828703,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1756486523
    },
    {
        "content": "<p>You can report it if you can find an mwe that works on latest nightly (just make a new project with today's nightly toolchain)</p>",
        "id": 536829098,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1756486688
    },
    {
        "content": "<p>As far as I'm aware, the order specifically depends on the names of the init declarations..?</p>",
        "id": 536829199,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1756486721
    },
    {
        "content": "<p>Actually, I'll make the issue</p>",
        "id": 536830356,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1756487164
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/10175\">lean4#10175</a></p>",
        "id": 536832487,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1756488041
    }
]