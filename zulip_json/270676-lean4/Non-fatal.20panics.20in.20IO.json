[
    {
        "content": "<p>How can I make <code>panic!</code> behave as it does in a pure context within IO? This doesn't work:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">ohno</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">panic!</span><span class=\"s2\">\"wat\"</span><span class=\"w\">  </span><span class=\"c1\">-- panic isn't shown</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">panic!</span><span class=\"s2\">\"wat\"</span><span class=\"w\">  </span><span class=\"c1\">-- panic isn't shown</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">ohno</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">panic!</span><span class=\"s2\">\"wat\"</span><span class=\"w\">  </span><span class=\"c1\">-- panic works, returns `1`</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">ohno</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n</code></pre></div>",
        "id": 543609195,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759866214
    },
    {
        "content": "<p><a class=\"message-link\" href=\"/#narrow/channel/270676-lean4/topic/.E2.9C.94.20Evaluation.20order/near/339688192\">#lean4 &gt; âœ” Evaluation order @ ðŸ’¬</a>  seems somewhat relevant</p>",
        "id": 543610079,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759866561
    },
    {
        "content": "<p>it seems to be getting optimized out since the value isn't used</p>",
        "id": 543612378,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1759867438
    },
    {
        "content": "<p>does that not happen in a pure context too?</p>",
        "id": 543612438,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1759867464
    },
    {
        "content": "<p><del>cc <span class=\"user-mention silent\" data-user-id=\"110024\">Sebastian Ullrich</span>, since the solutions you used in <a href=\"https://github.com/leanprover/lean4/pull/7321\">lean4#7321</a> look like they don't work anymore, suggesting those panics are now silent</del></p>",
        "id": 543613619,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759867936
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"n\">letI</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Inhabited</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">âŸ©</span>\n<span class=\"w\">    </span><span class=\"n\">panic!</span><span class=\"s2\">\"wat\"</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">BaseIO</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">panic!</span><span class=\"s2\">\"wat\"</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n</code></pre></div>\n<p>both work</p>",
        "id": 543613862,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759868039
    }
]