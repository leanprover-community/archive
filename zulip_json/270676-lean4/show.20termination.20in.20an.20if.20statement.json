[
    {
        "content": "<p>Hi, i am dealing with a function like 'exemple' in the mwe where i do stuff and recurcively apply a function 'step' if the argument has decreased </p>\n<p>To show the terminaison, i found that it was accepted by provinding in the else part the evidence that the argument has decreased.</p>\n<p>I would like to know if there is a better way to show the terminaison, or if it the correct way to think about it.</p>\n<p>Thank you very much</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">step</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"n\">Nat</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">true</span><span class=\"o\">,</span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">false</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">exemple</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"n\">Nat</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">step</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"k\">else</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"gr\">sorry</span>\n<span class=\"w\">    </span><span class=\"n\">exemple</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"bp\">.</span><span class=\"m\">2</span>\n</code></pre></div>",
        "id": 472264971,
        "sender_full_name": "yannis monbru",
        "timestamp": 1727105584
    },
    {
        "content": "<p><del>Does using</del></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"k\">then</span>\n</code></pre></div>\n<p><del>work?  Note that I added a \"name\" to the hypothesis.</del><br>\nMaybe I misunderstood the question.</p>",
        "id": 472265499,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727105718
    },
    {
        "content": "<p>My non-minimal exemple of this is accepted by lean, and my question is about if it’s the way i should do it or if it’s working but not optimal</p>",
        "id": 472275111,
        "sender_full_name": "yannis monbru",
        "timestamp": 1727108126
    },
    {
        "content": "<p>you can probably avoid the entire thing by simply matching on <code>n</code> in the function body of <code>example</code> rather than defining the auxilary function <code>step</code>...</p>",
        "id": 472275580,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1727108280
    },
    {
        "content": "<p>I am struggling to do that,  because in this example you can recover the value of the bolean from the 'Nat' you get as an output but in my code i couldn't and then i needed to return a bolean to know if i had to stop in the function 'exemple'</p>",
        "id": 472434516,
        "sender_full_name": "yannis monbru",
        "timestamp": 1727166887
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"432800\">yannis monbru</span> <a href=\"#narrow/stream/270676-lean4/topic/show.20termination.20in.20an.20if.20statement/near/472434516\">said</a>:</p>\n<blockquote>\n<p>in this example you can recover the value of the bolean from the 'Nat' you get as an output but in my code i couldn't</p>\n</blockquote>\n<p>could you then maybe give a clearer idea of what logic your version of the  <code>step</code> function entails? because it's hard to judge if lean can tell if a function terminates, when the example doesn't use the same logical decision structure...</p>",
        "id": 472438974,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1727168300
    },
    {
        "content": "<p>My version of step is manipulating two list and the bolean is there to tell if  'step' changed the size of one of the list<br>\nwhat matters to me is the fact of having the bolean to know if you can apply step or if you will enter an infinite loop</p>\n<p>In my version lean is happy (and there is no sorry)</p>",
        "id": 472517528,
        "sender_full_name": "yannis monbru",
        "timestamp": 1727190894
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span> do you have any comment here?</p>",
        "id": 473087742,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1727437202
    },
    {
        "content": "<p>Sorry, I am not sure what the question is. </p>\n<blockquote>\n<p>In my version lean is happy (and there is no sorry)</p>\n</blockquote>\n<p>So is this resolved?</p>",
        "id": 473088027,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727437315
    },
    {
        "content": "<p>I think part of the question is how to write something like:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">step</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"n\">Nat</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">true</span><span class=\"o\">,</span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">false</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">exemple</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"n\">Nat</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">step</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"k\">else</span>\n<span class=\"w\">    </span><span class=\"n\">exemple</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"bp\">.</span><span class=\"m\">2</span>\n<span class=\"n\">termination_by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 473091761,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1727438635
    },
    {
        "content": "<p>But termination_by is not happy here.</p>",
        "id": 473091898,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1727438673
    },
    {
        "content": "<p>My understanding after our lunch was that termination_by would happily give two goals, one for each branch of the if.</p>",
        "id": 473092230,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1727438769
    },
    {
        "content": "<p>Like this?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">step</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"n\">Nat</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">true</span><span class=\"o\">,</span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">false</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">exemple</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">step</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"k\">else</span>\n<span class=\"w\">    </span><span class=\"n\">exemple</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"bp\">.</span><span class=\"m\">2</span>\n<span class=\"n\">termination_by</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"n\">decreasing_by</span><span class=\"w\"> </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">simp_all</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">step</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 473092281,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727438788
    },
    {
        "content": "<p>Are you confusing <code>termination_by</code> and <code>decreasing_by</code>?  (Not unreasonable to confuse the two)</p>\n<p>Also, it’s one branch for each recursive call, not necessarily for each branch.</p>",
        "id": 473092387,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727438824
    },
    {
        "content": "<p>Thanks, that helps a lot.</p>",
        "id": 473094022,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1727439322
    }
]