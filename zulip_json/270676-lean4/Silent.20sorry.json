[
    {
        "content": "<p>Is there any way to build a project without throwing warnings on <code>sorry</code>?</p>",
        "id": 503537964,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1741186228
    },
    {
        "content": "<p>Motivation: My projects are unfinished and I do not care about them using <code>sorry</code>, but I care about them not throwing other warnings</p>",
        "id": 503538151,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1741186273
    },
    {
        "content": "<p>I'm doing it with a custom axiom and you can override existing notation with priority.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">silentSorryAxiom</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span>\n\n<span class=\"kn\">macro</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">priority</span><span class=\"o\">:=</span><span class=\"n\">high</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"sorry\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">silentSorryAxiom</span><span class=\"o\">)</span>\n\n<span class=\"kn\">macro</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">priority</span><span class=\"o\">:=</span><span class=\"n\">high</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"sorry\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 503539681,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1741186600
    },
    {
        "content": "<p>Good idea, but unfortunately that's an extra import to add to all files, and I use having no imports from my project as the signal that a file can be upstreamed</p>",
        "id": 503540454,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1741186761
    },
    {
        "content": "<p>I see, then I'm afraid you need to ask core to change as there does not seem to be a option switch when printing warning about sorry. It happens <a href=\"https://github.com/leanprover/lean4/blob/db0abe89cfd3fb2a29423d9f7a6550204c13c616/src/Lean/AddDecl.lean#L83\">here</a></p>",
        "id": 503541675,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1741187005
    },
    {
        "content": "<p>I'm all for having an option for this!</p>",
        "id": 503541899,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1741187045
    },
    {
        "content": "<p>What’s your application? Isn’t it possible to ask lake to spit out json, then pipe the output to jq and filter out warnings using the output of jq?</p>",
        "id": 503543524,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1741187406
    },
    {
        "content": "<p>In the meantime, can you simply screen out warnings that come from <code>sorry</code>s, and keep everything else?</p>",
        "id": 503543592,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741187422
    },
    {
        "content": "<p>That's the question, right? :)</p>",
        "id": 503543680,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1741187446
    },
    {
        "content": "<p>Oh, sorry, I meant using a commandline filter like grep on the output of lake build.</p>",
        "id": 503543832,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741187480
    },
    {
        "content": "<p>Yeah that’s essentially what I had in mind too. I.e. one can say this is not a lean question.</p>",
        "id": 503543940,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1741187510
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"243562\">Adam Topaz</span> <a href=\"#narrow/channel/270676-lean4/topic/Silent.20sorry/near/503543524\">said</a>:</p>\n<blockquote>\n<p>What’s your application? Isn’t it possible to ask lake to spit out json, then pipe the output to jq and filter out warnings using the output of jq?</p>\n</blockquote>\n<p>The application is for me to find the relevant information in the output of <code>lake build</code>. Given how often I am running this operation, I would rather avoid any extra filtering</p>",
        "id": 503544050,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1741187528
    },
    {
        "content": "<p>I would pass json output to jq, and process it that way.</p>",
        "id": 503544163,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1741187556
    },
    {
        "content": "<p>I also type <code>lake build</code> a lot in FLT and am now always inundated with hundreds of warnings, meaning that it's much harder to look at what I was just typing seconds before. I've just got used to it now but it would be great to be able to switch it off by default when building. I know I can just write a script in 10 seconds but I've never cared enough to do so (so this must be filed as low prio in my head)</p>",
        "id": 503550342,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1741188837
    },
    {
        "content": "<p>Here is what I would use:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code><span class=\"c1\">## builds the input module/filename removing `sorry` warnings from the output</span>\nnosorry<span class=\"w\"> </span><span class=\"o\">()</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">  </span><span class=\"nb\">local</span><span class=\"w\"> </span><span class=\"nv\">module</span><span class=\"o\">=</span><span class=\"si\">${</span><span class=\"nv\">1</span><span class=\"p\">//</span><span class=\"se\">\\/</span><span class=\"p\">/.</span><span class=\"si\">}</span>\n<span class=\"w\">  </span>lake<span class=\"w\"> </span>build<span class=\"w\"> </span><span class=\"s2\">\"</span><span class=\"si\">${</span><span class=\"nv\">module</span><span class=\"p\">/%.lean/</span><span class=\"si\">}</span><span class=\"s2\">\"</span><span class=\"w\"> </span><span class=\"p\">|</span><span class=\"w\"> </span>grep<span class=\"w\"> </span>-v<span class=\"w\"> </span><span class=\"s2\">\"^warning: .*: declaration uses 'sorry'\"</span>\n<span class=\"o\">}</span>\n\n<span class=\"c1\"># both work</span>\nnosorry<span class=\"w\"> </span>Mathlib/Data/Nat/Basic.lean\nnosorry<span class=\"w\"> </span>Mathlib.Data.Nat.Basic\n</code></pre></div>\n<p>It is not especially high-tech, but will probably mostly work.</p>",
        "id": 503555566,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741189903
    },
    {
        "content": "<p>how do I do <code>lake build</code>? (edit: looks like <code>nosorry</code> works)</p>",
        "id": 503557550,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1741190293
    },
    {
        "content": "<p>It's still noisy but it's far less noisy:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>buzzard@buster:~/lean-projects/FLT$<span class=\"w\"> </span>nosorry\n⚠<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">1318</span>/6290<span class=\"o\">]</span><span class=\"w\"> </span>Replayed<span class=\"w\"> </span>FLT.Mathlib.Topology.Algebra.Module.ModuleTopology\n⚠<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">6228</span>/6290<span class=\"o\">]</span><span class=\"w\"> </span>Replayed<span class=\"w\"> </span>FLT.DedekindDomain.FiniteAdeleRing.BaseChange\n⚠<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">6243</span>/6290<span class=\"o\">]</span><span class=\"w\"> </span>Replayed<span class=\"w\"> </span>FLT.NumberField.InfiniteAdeleRing\n⚠<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">6244</span>/6290<span class=\"o\">]</span><span class=\"w\"> </span>Replayed<span class=\"w\"> </span>FLT.NumberField.AdeleRing\n⚠<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">6245</span>/6290<span class=\"o\">]</span><span class=\"w\"> </span>Replayed<span class=\"w\"> </span>FLT.DivisionAlgebra.Finiteness\n⚠<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">6247</span>/6290<span class=\"o\">]</span><span class=\"w\"> </span>Replayed<span class=\"w\"> </span>FLT.AutomorphicForm.QuaternionAlgebra.FiniteDimensional\n⚠<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">6249</span>/6290<span class=\"o\">]</span><span class=\"w\"> </span>Replayed<span class=\"w\"> </span>FLT.AutomorphicRepresentation.Example\n⚠<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">6250</span>/6290<span class=\"o\">]</span><span class=\"w\"> </span>Replayed<span class=\"w\"> </span>FLT.EllipticCurve.Torsion\n⚠<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">6251</span>/6290<span class=\"o\">]</span><span class=\"w\"> </span>Replayed<span class=\"w\"> </span>FLT.Basic.Reductions\n⚠<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">6259</span>/6290<span class=\"o\">]</span><span class=\"w\"> </span>Replayed<span class=\"w\"> </span>FLT.GlobalLanglandsConjectures.GLnDefs\n⚠<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">6260</span>/6290<span class=\"o\">]</span><span class=\"w\"> </span>Replayed<span class=\"w\"> </span>FLT.GlobalLanglandsConjectures.GLzero\nwarning:<span class=\"w\"> </span>././././FLT/GlobalLanglandsConjectures/GLzero.lean:73:28:<span class=\"w\"> </span><span class=\"sb\">`</span>Complex.abs<span class=\"sb\">`</span><span class=\"w\"> </span>has<span class=\"w\"> </span>been<span class=\"w\"> </span>deprecated:<span class=\"w\"> </span>use<span class=\"w\"> </span>the<span class=\"w\"> </span>norm<span class=\"w\"> </span>instead\n⚠<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">6267</span>/6290<span class=\"o\">]</span><span class=\"w\"> </span>Replayed<span class=\"w\"> </span>FLT.Mathlib.MeasureTheory.Group.Action\n⚠<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">6268</span>/6290<span class=\"o\">]</span><span class=\"w\"> </span>Replayed<span class=\"w\"> </span>FLT.Mathlib.NumberTheory.Padics.PadicIntegers\n⚠<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">6269</span>/6290<span class=\"o\">]</span><span class=\"w\"> </span>Replayed<span class=\"w\"> </span>FLT.HaarMeasure.MeasurableSpacePadics\n⚠<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">6274</span>/6290<span class=\"o\">]</span><span class=\"w\"> </span>Replayed<span class=\"w\"> </span>FLT.Junk.Algebra\nwarning:<span class=\"w\"> </span>././././FLT/Junk/Algebra.lean:1:0:<span class=\"w\"> </span>using<span class=\"w\"> </span><span class=\"s1\">'exit'</span><span class=\"w\"> </span>to<span class=\"w\"> </span>interrupt<span class=\"w\"> </span>Lean\n⚠<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">6275</span>/6290<span class=\"o\">]</span><span class=\"w\"> </span>Replayed<span class=\"w\"> </span>FLT.Junk.Algebra2\nwarning:<span class=\"w\"> </span>././././FLT/Junk/Algebra2.lean:1:0:<span class=\"w\"> </span>using<span class=\"w\"> </span><span class=\"s1\">'exit'</span><span class=\"w\"> </span>to<span class=\"w\"> </span>interrupt<span class=\"w\"> </span>Lean\n⚠<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">6276</span>/6290<span class=\"o\">]</span><span class=\"w\"> </span>Replayed<span class=\"w\"> </span>FLT.Mathlib.Algebra.IsQuaternionAlgebra\n⚠<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">6286</span>/6290<span class=\"o\">]</span><span class=\"w\"> </span>Replayed<span class=\"w\"> </span>FLT.QuaternionAlgebra.NumberField\nℹ<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">6289</span>/6290<span class=\"o\">]</span><span class=\"w\"> </span>Replayed<span class=\"w\"> </span>FermatsLastTheorem\ninfo:<span class=\"w\"> </span>././././FermatsLastTheorem.lean:30:0:<span class=\"w\"> </span><span class=\"s1\">'PNat.pow_add_pow_ne_pow'</span><span class=\"w\"> </span>depends<span class=\"w\"> </span>on<span class=\"w\"> </span>axioms:<span class=\"w\"> </span><span class=\"o\">[</span>propext,<span class=\"w\"> </span>sorryAx,<span class=\"w\"> </span>Classical.choice,<span class=\"w\"> </span>Quot.sound<span class=\"o\">]</span>\nBuild<span class=\"w\"> </span>completed<span class=\"w\"> </span>successfully.\nbuzzard@buster:~/lean-projects/FLT$\n</code></pre></div>",
        "id": 503557866,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1741190355
    },
    {
        "content": "<p>Worth filtering out also the <code>Replayed</code> lines?</p>",
        "id": 503558392,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1741190455
    },
    {
        "content": "<p>Oh, you want it to be completely silent?</p>",
        "id": 503559668,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741190681
    },
    {
        "content": "<p>I thought that you only wanted to silence warnings arising from <code>sorry</code>.</p>",
        "id": 503559803,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741190713
    },
    {
        "content": "<p>Sébastien is saying that there are some replaying lines that do not correspond to any warning anymore</p>",
        "id": 503559990,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1741190756
    },
    {
        "content": "<p>Ah, so filtering should also omit a <code>Replayed</code> if the consecutive line is also <code>Replayed</code>.</p>",
        "id": 503560375,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741190834
    },
    {
        "content": "<p>I'm not at a computer now, but that is also easy.</p>",
        "id": 503560436,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741190845
    },
    {
        "content": "<p>I personally want it to not print out all the things I don't care about. I already know that my repo has many <code>sorry</code>s and I don't care about that. I also don't care about replaying (whatever that means), but I definitely care about everything else in that output.</p>",
        "id": 503560470,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1741190853
    },
    {
        "content": "<p>If no <code>Replayed</code> is wanted with no extra condition, that is even easier.</p>",
        "id": 503560800,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741190922
    },
    {
        "content": "<p>I actually have another script that already extracts the <code>code fileLocation</code> for each warning.</p>",
        "id": 503561024,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741190973
    },
    {
        "content": "<p>Is the goal to just print <del>out</del>in the lines that begin with <code>warning:</code>, <code>error:</code> and maybe <code>info:</code> and filter out everything else?</p>",
        "id": 503574436,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741193654
    },
    {
        "content": "<p>Here is a version that only keeps the <code>warning</code>, <code>error</code> and <code>info</code> lines:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code><span class=\"c1\">## builds the input module/filename keeping only `warning`/`error`/`info`</span>\n<span class=\"c1\">## but ignoring `sorry`s</span>\nshort_nosorry<span class=\"w\"> </span><span class=\"o\">()</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">  </span><span class=\"nb\">local</span><span class=\"w\"> </span><span class=\"nv\">module</span><span class=\"o\">=</span><span class=\"si\">${</span><span class=\"nv\">1</span><span class=\"p\">//</span><span class=\"se\">\\/</span><span class=\"p\">/.</span><span class=\"si\">}</span>\n<span class=\"w\">  </span>lake<span class=\"w\"> </span>build<span class=\"w\"> </span><span class=\"s2\">\"</span><span class=\"si\">${</span><span class=\"nv\">module</span><span class=\"p\">/%.lean/</span><span class=\"si\">}</span><span class=\"s2\">\"</span><span class=\"w\"> </span><span class=\"p\">|</span><span class=\"w\"> </span>grep<span class=\"w\"> </span><span class=\"s2\">\"^\\(warning:\\|error:\\|info:\\|Build completed\\)\"</span><span class=\"w\"> </span><span class=\"p\">|</span><span class=\"w\"> </span>grep<span class=\"w\"> </span>-v<span class=\"w\"> </span><span class=\"s2\">\"^warning: .*: declaration uses 'sorry'\"</span>\n<span class=\"o\">}</span>\n\n<span class=\"c1\"># both work</span>\nshort_nosorry<span class=\"w\"> </span>Mathlib/Data/Nat/Basic.lean\nshort_nosorry<span class=\"w\"> </span>Mathlib.Data.Nat.Basic\n</code></pre></div>",
        "id": 503577916,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741194358
    },
    {
        "content": "<p>Oh this gives the desired output on FLT, thanks! What do I do with the code though? Right now I'm just cutting and pasting it. I was expecting a shell script <code>nosorry</code> which I could put in <code>~/.local/bin</code>.</p>",
        "id": 503585462,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1741195923
    },
    {
        "content": "<p>Thank you Damiano for the effort, but I would like us to stop writing scripts as bandages to issues that should be fixed at their source. This leads to fragmentation between repositories and reduces maintainability: I am currently spending literal days of my life making the ten or so projects I manage align.</p>",
        "id": 503586394,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1741196162
    },
    {
        "content": "<p>If you add the definition of <code>short_sorry</code> to <code>.bash_aliases</code> on your computer, then you can use it on your computer directly as <code>short_nosorry</code>.</p>",
        "id": 503586526,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741196191
    },
    {
        "content": "<p>Yaël, I agree with you: I was not expecting the command above to become a script in the repository, but just a script in a personal <code>.bash_aliases</code> file that you can run on your computer.</p>",
        "id": 503586903,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741196287
    },
    {
        "content": "<p>I don’t quite agree with this point of view. I think the output of lake build should include all the messages that are generated in the code itself, and it should be the responsibility of the user to process those messages as they require.</p>",
        "id": 503590422,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1741197199
    },
    {
        "content": "<p><code>sorry</code> generates a warning, which is one kind of a message. I don’t see why it should get special treatment in the lake source over other warnings (e.g. linter warnings) or other messages (e.g. those coming from <code>#check</code> commands)</p>",
        "id": 503591082,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1741197357
    },
    {
        "content": "<p>One thing that I do think should be an option is to have the option for <code>lake build</code> to give its output in json form. I thought this was already available, but it seems that it is not? (it is available for <code>lake query</code>.)</p>",
        "id": 503591974,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1741197565
    },
    {
        "content": "<p>What is the downside of having a flag <code>--no-warning-on-sorry</code> or similar to <code>lake build</code>?</p>",
        "id": 503592398,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1741197660
    },
    {
        "content": "<p>Having an unfinished project is a common use case, and wanting to check whether you have any errors/warnings besides sorries is a common subuse case</p>",
        "id": 503592624,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1741197711
    },
    {
        "content": "<p>Claude told me that the following should work:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>lake<span class=\"w\"> </span>build<span class=\"w\"> </span><span class=\"p\">|</span><span class=\"w\"> </span>grep<span class=\"w\"> </span>-v<span class=\"w\"> </span>-E<span class=\"w\"> </span><span class=\"s1\">'warning.*sorry|sorry.*warning'</span>\n</code></pre></div>",
        "id": 503606734,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1741201111
    },
    {
        "content": "<p>Did Claude not read the bit about the replaying?</p>",
        "id": 503607527,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1741201294
    },
    {
        "content": "<p>I think it might be possible to have a core Lean option (<code>unapologetic</code> or <code>sorry.notSorry</code>?) to turn off sorry warnings.</p>\n<p>One detail is that it should only filter out warnings that come from user-defined sorries, rather than synthetic sorries (sorries due to invalid code or tactic failures).</p>\n<p>It's possible to pass Lean options on the command line to Lake, right?</p>\n<p>Are there any issues where people's grading scripts might break because they didn't anticipate students being able to turn off the warning?</p>",
        "id": 503609356,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1741201762
    },
    {
        "content": "<p>I like the <code>unapologetic</code> option!</p>",
        "id": 503610247,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1741201982
    },
    {
        "content": "<p>I like the unapologetic option, too! <br>\nI really want this!</p>",
        "id": 503613121,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1741202708
    },
    {
        "content": "<p>In some test files, mathlib also uses custom <code>sorry</code>s to avoid warnings.  Those could also be replaced by \"actual\" and setting the unapologetic option.</p>",
        "id": 503616365,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741203517
    },
    {
        "content": "<p><code>lean</code> already has a command-line option <code>-q</code> or <code>--quiet</code> that <a href=\"#narrow/channel/270676-lean4/topic/profiling.20a.20project/near/500650140\">doesn't do anything</a>, but maybe could turn Lean quiet for anything but errors.</p>",
        "id": 503620843,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1741204753
    },
    {
        "content": "<p>I do want other warnings to show though (I am currently turning on the mathlib linters in my projects)</p>",
        "id": 503621081,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1741204814
    },
    {
        "content": "<p>Hopefully someone can write an RFC? It seems like there's not quite consensus on what this should even do.</p>",
        "id": 503630803,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1741207866
    },
    {
        "content": "<p>My view is as follows.</p>",
        "id": 503631767,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741208214
    },
    {
        "content": "<p>Except for <code>sorry</code>, all other axioms are used \"silently\".</p>",
        "id": 503631794,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741208227
    },
    {
        "content": "<p>I certainly understand that <code>sorry</code> is the only axiom that is known to be inconsistent (ignoring <code>ofReduceBool</code>), so it is great that the default is to flag it.</p>",
        "id": 503631805,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741208230
    },
    {
        "content": "<p>However, I also can see that in the development phase of a project, <code>sorry</code>ed out statements have a different status than other errors/linter messages, so it seems reasonable to want to have an option to silence <code>sorry</code> as opposed to any other kind of warning/error/info.</p>",
        "id": 503631813,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741208231
    },
    {
        "content": "<p>When writing test cases often a mwe is full of sorries. A quckt way to disable the warning about such explicit worries (<code>set_option warning.sorry false</code> or so) would be useful. Although I have started to define a local testSorry axiom and used that with <code>exact</code>, so a workaround exists</p>",
        "id": 503635734,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1741209566
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> said:</p>\n<blockquote>\n<p>Hopefully someone can write an RFC?</p>\n</blockquote>\n<p>Has the RFC been created yet? Shall I do it?</p>",
        "id": 504241797,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1741415469
    },
    {
        "content": "<p>What's the attractiveness of creating a sorry-specific mechanism for this rather than a warnings-wide one?</p>",
        "id": 504297374,
        "sender_full_name": "Julian Berman",
        "timestamp": 1741453725
    },
    {
        "content": "<p>Is it \"simply\" that the latter seems more likely to be more effort and discussion?</p>",
        "id": 504297386,
        "sender_full_name": "Julian Berman",
        "timestamp": 1741453740
    },
    {
        "content": "<p>Also <span aria-label=\"bike\" class=\"emoji emoji-1f6b2\" role=\"img\" title=\"bike\">:bike:</span>  while \"unapologetic\" is cute it is very undiscoverable? Hopefully if that really is what ends up happening that's addressed in some other way.</p>",
        "id": 504297538,
        "sender_full_name": "Julian Berman",
        "timestamp": 1741453834
    },
    {
        "content": "<p>Joachim's <code>warning.sorry</code> is much more serious of a contender. You could see it as being part of a warnings-wide solution to the problem too: we might have a way to register warnings and have a macro like <code>trace[...]</code> that conditionally outputs a given warning.</p>",
        "id": 504299208,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1741454991
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"626349\">Asei Inoue</span> <a href=\"#narrow/channel/270676-lean4/topic/Silent.20sorry/near/504241797\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> said:</p>\n<blockquote>\n<p>Hopefully someone can write an RFC?</p>\n</blockquote>\n<p>Has the RFC been created yet? Shall I do it?</p>\n</blockquote>\n<p>Did you do it? I couldn't find it, so I did it: <a href=\"https://github.com/leanprover/lean4/pull/8611\">lean4#8611</a> . I thought that with the advent of the <a href=\"https://github.com/google-deepmind/formal-conjectures\">formal conjectures</a> repo (495 lines of lake output every time you compile, and counting) it was time to think about this again.</p>\n<p>Please thumbs up if you think this is relevant to you!</p>",
        "id": 522080862,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748945689
    },
    {
        "content": "<p>Whoops sorry I completely missed the RFC-writing request</p>",
        "id": 522082498,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1748946191
    },
    {
        "content": "<p>Well I scooped you :-)</p>",
        "id": 522082645,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748946242
    },
    {
        "content": "<p>You did a very good job of the RFC, thank you :)</p>",
        "id": 522082736,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1748946267
    },
    {
        "content": "<p>I found a way to do this, using some unholy hacks.</p>\n<p><code>SuppressSorry.lean</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Command</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Command</span>\n\n<span class=\"n\">register_option</span><span class=\"w\"> </span><span class=\"n\">suppressSorry</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">  </span><span class=\"n\">defValue</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"w\">  </span><span class=\"n\">descr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"suppress sorry warnings\"</span>\n<span class=\"o\">}</span>\n<span class=\"n\">initialize</span>\n<span class=\"w\">  </span><span class=\"n\">commandElabAttribute</span><span class=\"bp\">.</span><span class=\"n\">tableRef</span><span class=\"bp\">.</span><span class=\"n\">modify</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Id</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">mut</span><span class=\"w\"> </span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"bp\">.</span><span class=\"n\">map₁</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">wrap</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">      </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">stx</span>\n<span class=\"w\">      </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">suppressSorry</span><span class=\"bp\">.</span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getOptions</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">        </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">msgs</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">messages</span><span class=\"w\"> </span><span class=\"bp\">++</span>\n<span class=\"w\">          </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">snapshotTasks</span><span class=\"bp\">.</span><span class=\"n\">foldl</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"bp\">·.</span><span class=\"n\">get</span><span class=\"bp\">.</span><span class=\"n\">getAll</span><span class=\"bp\">.</span><span class=\"n\">foldl</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"bp\">·.</span><span class=\"n\">diagnostics</span><span class=\"bp\">.</span><span class=\"n\">msgLog</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">empty</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{}</span>\n<span class=\"w\">        </span><span class=\"n\">modify</span><span class=\"w\"> </span><span class=\"o\">({</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">messages</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">msgs</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">snapshotTasks</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">})</span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">msgs</span><span class=\"bp\">.</span><span class=\"n\">hasUnreported</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">          </span><span class=\"n\">modify</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">            </span><span class=\"n\">messages</span><span class=\"bp\">.</span><span class=\"n\">unreported</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">messages</span><span class=\"bp\">.</span><span class=\"n\">unreported</span><span class=\"bp\">.</span><span class=\"n\">filter</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">              </span><span class=\"bp\">!</span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"n\">severity</span><span class=\"w\"> </span><span class=\"n\">matches</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">warning</span><span class=\"w\"> </span><span class=\"bp\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">hasTag</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"ss\">`hasSorry</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"ss\">``Parser.Command.declaration</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">      </span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">map</span><span class=\"bp\">.</span><span class=\"n\">modify</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">wrap</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">map₁</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">}</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">SuppressSorry</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">suppressSorry</span><span class=\"w\"> </span><span class=\"n\">true</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"c1\">-- look ma, no warning</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 522088264,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1748947967
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> My recommendation is for you to put this <span aria-label=\"this\" class=\"emoji emoji-1f446\" role=\"img\" title=\"this\">:this:</span> in FLT repo in a file imported early in the hierarchy, and then use the lakefile to set the <code>suppressSorry</code> option to true</p>",
        "id": 522089766,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1748948473
    },
    {
        "content": "<p>Should we put this in mathlib?</p>",
        "id": 522092637,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748949289
    },
    {
        "content": "<p>(or batteries)</p>",
        "id": 522092839,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748949347
    },
    {
        "content": "<p>I would avoid importing it unless it is actually being used, but otherwise it seems reasonable to have available</p>",
        "id": 522093125,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1748949432
    },
    {
        "content": "<p>To check I understand correctly, this modifies every command parser in order to add an extra hook on the end?</p>",
        "id": 522093690,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748949604
    },
    {
        "content": "<p>Does it reliably run <em>after</em> all command parsers are registered?</p>",
        "id": 522093869,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748949652
    },
    {
        "content": "<p>yes, except right now it's a whitelist of parsers and the only parser that is hooked is the declaration parser (so e.g. structures and inductives will not be affected)</p>",
        "id": 522094780,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1748949914
    },
    {
        "content": "<p>Initialization is done in import order, so core lean parsers will at least be available to be hooked. This doesn't hook all parsers, but it's not like the kind of projects that need this write a lot of additional commands (or can't opt them in to use this mechanism as well)</p>",
        "id": 522094786,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1748949917
    },
    {
        "content": "<p>If this went into mathlib (and thus was a solution which could be used for all libraries downstream from mathlib, which would cover all of Yael's and FLT and formal-conjectures) and if it doesn't degrade the VS Code experience then it might be a good solution</p>",
        "id": 522124768,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748957493
    },
    {
        "content": "<p>I would still like to be warned about where the sorries are when working on a file though (I think?)</p>",
        "id": 522125097,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748957574
    },
    {
        "content": "<p>I successfully tested this on FLT repo. No <code>Replayed</code> or sorry lines, just a clean build:</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"gp\">$ </span>lake<span class=\"w\"> </span>build\n<span class=\"go\">⣟ [2836/2854] Running Mathlib.CategoryTheory.Limits.Preserves.Shapes.Biproducts (+ 9 more)</span>\n<span class=\"go\">ℹ [3409/3410] Built FermatsLastTheorem</span>\n<span class=\"go\">info: /home/mario/Documents/lean/FLT/FermatsLastTheorem.lean:30:0: 'PNat.pow_add_pow_ne_pow' depends on axioms: [propext, sorryAx, Classical.choice, Quot.sound]</span>\n<span class=\"go\">Build completed successfully.</span>\n</code></pre></div>",
        "id": 522136445,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1748960169
    },
    {
        "content": "<p>to accomplish the suggestion above, I put </p>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"n\">weakLeanArgs</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"> </span><span class=\"c1\"># options that only take effect at `lake build`, not interactively</span>\n<span class=\"w\">  </span><span class=\"s2\">\"-Dweak.suppressSorry=true\"</span><span class=\"w\"> </span><span class=\"c1\"># suppress 'declaration uses sorry' warnings</span>\n<span class=\"p\">]</span>\n</code></pre></div>\n<p>in the lakefile</p>",
        "id": 522136737,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1748960245
    },
    {
        "content": "<p><a href=\"https://github.com/ImperialCollegeLondon/FLT/pull/610\">FLT#610</a></p>",
        "id": 522138283,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1748960571
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/25401\">#25401</a></p>",
        "id": 522155076,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1748964463
    }
]