[
    {
        "content": "<p>Since <a href=\"https://github.com/leanprover/lean4/pull/10045\">#10045</a>, <a href=\"https://github.com/leanprover/lean4/pull/10303\">#10303</a> and <a href=\"https://github.com/leanprover/lean4/pull/10633\">10633</a> we have polymorphic ranges over integers:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"n\">Int</span><span class=\"o\">)</span><span class=\"bp\">...</span><span class=\"o\">(</span><span class=\"mi\">5</span><span class=\"o\">:</span><span class=\"n\">Int</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">toList</span><span class=\"w\"> </span><span class=\"c1\">-- [0, 1, 2, 3, 4]</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">-</span><span class=\"mi\">5</span><span class=\"o\">:</span><span class=\"n\">Int32</span><span class=\"o\">)</span><span class=\"bp\">...</span><span class=\"o\">(</span><span class=\"mi\">5</span><span class=\"o\">:</span><span class=\"n\">Int32</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">toList</span><span class=\"w\"> </span><span class=\"c1\">-- [-5, -4, -3, -2, -1, 0, 1, 2, 3, 4]</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"n\">UInt32</span><span class=\"o\">)</span><span class=\"bp\">...</span><span class=\"o\">(</span><span class=\"mi\">5</span><span class=\"o\">:</span><span class=\"n\">UInt32</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">toList</span><span class=\"w\"> </span><span class=\"c1\">-- [0, 1, 2, 3, 4]</span>\n</code></pre></div>\n<p>I'm using such ranges in <code>for</code> loops, and trying to prove properties with <code>mvcgen</code>. The size of the range appears in the proof : <code>(s...e).size</code>. While it computes fine:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\">  </span><span class=\"o\">((</span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"n\">Int</span><span class=\"o\">)</span><span class=\"bp\">...</span><span class=\"o\">(</span><span class=\"mi\">5</span><span class=\"o\">:</span><span class=\"n\">Int</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"c1\">-- 5</span>\n</code></pre></div>\n<p>and while there are instances of <code>HasSize</code> for Int, proving anything about them is hard. I had to do this to prove a simple statement : </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">int_range_size</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"bp\">...</span><span class=\"n\">e</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toNat</span>\n<span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span>\n<span class=\"w\">    </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Rco</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">Id</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Rco</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">iter</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Rxo</span><span class=\"bp\">.</span><span class=\"n\">HasSize</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Rxc</span><span class=\"bp\">.</span><span class=\"n\">HasSize</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Iterators</span><span class=\"bp\">.</span><span class=\"n\">Iter</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Iterators</span><span class=\"bp\">.</span><span class=\"n\">Iter</span><span class=\"bp\">.</span><span class=\"n\">toIterM</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Iterators</span><span class=\"bp\">.</span><span class=\"n\">IteratorSize</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">Pure</span><span class=\"bp\">.</span><span class=\"n\">pure</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">toNat_sub'</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">omega</span>\n</code></pre></div>\n<p><a href=\"https://live.lean-lang.org/#project=lean-nightly&amp;codez=FAFwFgpg9gThC2ACAlgOxAfRgQ1QcwgwGdkAvCRACiMQoC5EBJdASkTuEURsBMiWxQEmEnKkQB04iC1ElyiALxUKAWm5SQUAHLYQiYHQUAjAJ7C0IGFERgMAGwjCS8AA6IA2ly7CuAZRAATUQAlAGMoaTIIABpdDyYAmABXVGivRF8AkLDmEAgYVGwbUWQcmEjU9KCADzCACWwibwjw8hTYisDK4NE6hqaZKPL/UUYS7VgxEdzmqJiPCsmcdRgJktF1BYBZMrahhbHl4dGlxvJp7Y8ABQS4USdrga4AXWEYAHc3QATCJnQ1zW1iBIGADkzy4UHgEDw2E8QA\">link to playground</a></p>\n<p>Am I missing something or is it to be expected ?</p>",
        "id": 546463287,
        "sender_full_name": "Clément Blaudeau",
        "timestamp": 1761140980
    },
    {
        "content": "<p>The standard library should provide these, but adding them is somewhere in the middle of the (very long) TODO list for iterators/ranges/slices. If you would like to open a PR to the lean4 repo which adds these lemmas in an analogous fashion to the <code>Nat</code> ones <a href=\"https://github.com/leanprover/lean4/blob/744f98064b056ee27fc8c97f524797c8cc96f436/src/Init/Data/Range/Polymorphic/NatLemmas.lean\">here</a>, I would be happy to merge it.</p>",
        "id": 546465227,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1761141443
    },
    {
        "content": "<p>Nice! I missed those for Nat. I'll try to find some time to open a PR on that! Thanks.</p>",
        "id": 546466339,
        "sender_full_name": "Clément Blaudeau",
        "timestamp": 1761141727
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"260921\">@Markus Himmel</span> <a href=\"https://github.com/leanprover/lean4/pull/11159\">https://github.com/leanprover/lean4/pull/11159</a></p>",
        "id": 555320416,
        "sender_full_name": "Alexander Bentkamp",
        "timestamp": 1763030383
    }
]