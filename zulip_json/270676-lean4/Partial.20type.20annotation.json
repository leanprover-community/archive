[
    {
        "content": "<p>I found that partial type annotation in usual places work (e.g., inside function body or inside <code>#check</code>):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">id</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">foo</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">foo</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">foo</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>but it is not allowed for function definition:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- def bar := foo -- works</span>\n<span class=\"c1\">-- def bar: _ → _ := foo -- does not work</span>\n<span class=\"c1\">-- def bar: Nat → _ := foo -- does not work</span>\n<span class=\"c1\">-- def bar: _ → Nat := foo -- does not work</span>\n</code></pre></div>\n<p>I agree that enforcing full explicit types for function signatures has benefit for readability (iirc Scala also did?), but in my experience it sometimes is convenient to partially annotate types and rely on type inference for the rest. Lean already allows fully omitting types (the first definition checks), but partially omitting types seems to be disabled in function definitions. I am curious if this is an intended feature / if there is some flag to control this.</p>",
        "id": 490197835,
        "sender_full_name": "Youngju Song",
        "timestamp": 1734713533
    },
    {
        "content": "<p>I've also found myself wanting a flag to control this</p>",
        "id": 490205495,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1734716743
    },
    {
        "content": "<p>Or even to demote it to a linter that emits a warning rather than an immediate error</p>",
        "id": 490205711,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1734716826
    },
    {
        "content": "<p>It's helpful to be able to write</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MetaM</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n</code></pre></div>\n<p>and start writing some code before I've decided on the return type</p>",
        "id": 490205753,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1734716852
    },
    {
        "content": "<p>I can of course work around this with</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">MetaM</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\">  </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n</code></pre></div>",
        "id": 490205782,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1734716879
    },
    {
        "content": "<p>I'd personally agree this should be a warning not an error. However there may be a bad interaction with parallel elaboration, and we don't want to add any complication there right now.</p>",
        "id": 490276169,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1734766136
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> Thank you for the comments! Thank you for letting me know about the \"show\" keyword - I think I can live with it right now. Hope this could be relaxed sometime in the future :)</p>",
        "id": 491327726,
        "sender_full_name": "Youngju Song",
        "timestamp": 1735591787
    },
    {
        "content": "<p>Thanks for making me think about this annoyance hard enough to make me realize that <code>show</code> does the trick!</p>",
        "id": 491330171,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1735593221
    }
]