[
    {
        "content": "<p>do people think it’s worth upstreaming <a href=\"https://tqft.net/mathlib4files/Mathlib/Lean/Json\">file#Mathlib/Lean/Json</a> (a pretty small file) and adding the one-liners for <code>UInt64</code> etc?</p>",
        "id": 494443716,
        "sender_full_name": "llllvvuu",
        "timestamp": 1737149507
    },
    {
        "content": "<p>I think the entire <code>Mathlib.Lean</code> folder is \"things which should be upstreamed but the author doesn't want to wait 1-2 months before they are available in mathlib\".</p>",
        "id": 494460044,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1737158493
    },
    {
        "content": "<p>Obviously core probably doesn't want <em>everything</em> in there, but I think the Json file should be uncontroversial (modulo bikeshedding the error messages)</p>",
        "id": 494460178,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1737158543
    },
    {
        "content": "<p>somewhat unrelated: out of curiosity, are JSON/XML parsing not intended to be in the stdlib? I was somewhat surprised to see them under <code>Lean</code> and not <code>Init</code></p>",
        "id": 494462913,
        "sender_full_name": "llllvvuu",
        "timestamp": 1737160511
    },
    {
        "content": "<p>I think at one point <code>Init</code> was not allowed to import <code>Lean</code>, and so it would be impossible to write the <code>json%</code> elaborator solely within <code>Init</code>. Maybe that rule has been relaxed now.</p>",
        "id": 494463185,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1737160701
    },
    {
        "content": "<p>That rule hasn't been relaxed but now there is also <code>Std</code> in between <code>Init</code> and <code>Lean</code>.</p>",
        "id": 494469850,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1737165794
    },
    {
        "content": "<p>I'm a bit skeptical about running predicates in <code>fromJson?</code></p>",
        "id": 494482063,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1737176952
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/270676-lean4/topic/upstreaming.20Mathlib.2ELean.2EJson/near/494482063\">said</a>:</p>\n<blockquote>\n<p>I'm a bit skeptical about running predicates in <code>fromJson?</code></p>\n</blockquote>\n<p>Is this complaint leveled at the Fin instance, or just the Subtype one?</p>",
        "id": 494501293,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1737193361
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/270676-lean4/topic/upstreaming.20Mathlib.2ELean.2EJson/near/494501293\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/270676-lean4/topic/upstreaming.20Mathlib.2ELean.2EJson/near/494482063\">said</a>:</p>\n<blockquote>\n<p>I'm a bit skeptical about running predicates in <code>fromJson?</code></p>\n</blockquote>\n<p>Is this complaint leveled at the Fin instance, or just the Subtype one?</p>\n</blockquote>\n<p>And I do think that <code>Fin</code> makes sense as it's a cheap check but <code>Subtype</code> is potentially dangerous as an adversary could make you execute potentially highly expensive computation.</p>",
        "id": 494509379,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1737199796
    },
    {
        "content": "<p>I took a look at Lean/Data/Json/FromToJson and it seems UInt64 is already handled (I didn't notice since the one that I needed was actually UInt32), but it gets serialized as a string, unlike <code>Nat</code>/<code>Int</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">toJson</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">UInt64</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">toJson</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">UInt64</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">toJson</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt64</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Now I'm not sure what would be the right thing for <code>Fin</code> (probably still a number like <code>Nat</code>?).</p>",
        "id": 494581521,
        "sender_full_name": "llllvvuu",
        "timestamp": 1737243522
    },
    {
        "content": "<p>A message was moved from this topic to <a class=\"stream-topic\" data-stream-id=\"270676\" href=\"/#narrow/channel/270676-lean4/topic/Importing.20Lean.20from.20Std.20and.20Init\">#lean4 &gt; Importing Lean from Std and Init</a> by <span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span>.</p>",
        "id": 494701207,
        "sender_full_name": "Notification Bot",
        "timestamp": 1737336595
    },
    {
        "content": "<p>Json serializing as a string sounds wrong to me there</p>",
        "id": 494701508,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1737336772
    },
    {
        "content": "<p>I understand that the javascript <code>JSON.parse</code> loses precision when parsing uint64s, but really that's the job of the parser to use a better parsing library (like <a href=\"https://www.npmjs.com/package/json-with-bigint\">https://www.npmjs.com/package/json-with-bigint</a>).</p>",
        "id": 494701655,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1737336873
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"395550\">Henrik Böving</span> <a href=\"#narrow/channel/270676-lean4/topic/upstreaming.20Mathlib.2ELean.2EJson/near/494509379\">said</a>:</p>\n<blockquote>\n<p>And I do think that <code>Fin</code> makes sense as it's a cheap check but <code>Subtype</code> is potentially dangerous as an adversary could make you execute potentially highly expensive computation.</p>\n</blockquote>\n<p>For instance if your field is <code>{p : Nat // p.Prime}</code>, and your adversary gives you a very large prime?</p>",
        "id": 494701808,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1737336985
    },
    {
        "content": "<p>Yes</p>",
        "id": 494742747,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1737360457
    }
]