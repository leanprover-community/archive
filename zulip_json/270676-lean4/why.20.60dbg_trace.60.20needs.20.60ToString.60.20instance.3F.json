[
    {
        "content": "<p>Why do we need <code>ToString</code> instances for debugging?</p>",
        "id": 482748529,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1731744043
    },
    {
        "content": "<p>Is the question why it specifically needs to be the <code>ToString</code> class, or why there needs to be a class instance at all? <code>dbg_trace</code> just prints stuff, so it needs to know how to print the elements being traced. It would be possible to just fall back to printing the Expr representation and not require any further direction, but always getting the <code>pp.all</code> version of terms is frequently going to be more noisy than helpful.</p>",
        "id": 482765177,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1731759291
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">inductive</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">intro</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"c1\">-- failed to synth ToString</span>\n<span class=\"w\">  </span><span class=\"n\">dbg_trace</span><span class=\"w\"> </span><span class=\"n\">f</span>\n<span class=\"w\">  </span><span class=\"mi\">0</span>\n</code></pre></div>",
        "id": 482771988,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1731765368
    },
    {
        "content": "<p>My thought is that if the instance for debugging is a ToString, you have to manually create a ToString instance every time you want to debug.<br>\nIf you can use Repr, I think there are situations where that would be fine, and you could automatically create ToString instances from Repr.</p>",
        "id": 482772046,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1731765432
    },
    {
        "content": "<p>this could be a default instance: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Repr</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ToString</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">  </span><span class=\"n\">toString</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">reprStr</span>\n<span class=\"o\">}</span>\n</code></pre></div>",
        "id": 482772190,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1731765557
    },
    {
        "content": "<p>It would be good if <code>deriving ToString</code> could be done.<br>\nSince deriving <code>Repr</code> can be done, it should be possible to generate it with <code>reprStr</code> from <code>Repr</code>.</p>",
        "id": 482772369,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1731765699
    },
    {
        "content": "<p>I see. Apparently some kind of \"try X then fall back to Y\" behavior was recently added for the way <code>eval</code> is printed (<a href=\"#narrow/channel/113488-general/topic/Repr.20vs.20ToString/near/479062655\">https://leanprover.zulipchat.com/#narrow/channel/113488-general/topic/Repr.20vs.20ToString/near/479062655</a>), maybe it would be desirable to add that to <code>dbg_trace</code>, in this case locally doing \"try to use ToString, if you can't' find an instance of it, look for <code>Repr</code> and use <code>reprStr</code> instead\" since it doesn't have the parsing/round-trip concerns of eval.</p>",
        "id": 482777936,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1731769860
    },
    {
        "content": "<p>One difference between <code>dbg_trace</code> and <code>#eval</code> is that <code>#eval</code> is able to fully elaborate its argument before doing its instance synthesis logic. With <code>dbg_trace</code>, it might need to postpone things, which makes things tricker.</p>\n<p>However, it would be nice to not have to worry about synthesizing ToString/Repr instances just to debug. Sebastian and I have talked a little bit about this, and there's no obvious obstruction (other than compiler performance impacts).</p>\n<p>Relatedly, something that I've wondered with <code>#eval</code> is whether it would be desirable to have it print unprintable subterms using syntax like <code>(â‹¯ : Nat -&gt; Bool)</code>. On one hand, this is a lot better since often there can be terms you want to understand but not all of it is printable. On the other, it might get in the way of auto-derive feature of <code>#eval</code> (it currently has logic to do one level of trying to derive a Repr instance automatically).</p>",
        "id": 482789484,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1731779635
    },
    {
        "content": "<blockquote>\n<p>However, it would be nice to not have to worry about synthesizing ToString/Repr instances just to debug.</p>\n</blockquote>\n<p>Yes!</p>",
        "id": 482880088,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1731864203
    }
]