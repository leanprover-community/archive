[
    {
        "content": "<p>The follow does not type-check due to <code>unknown type Ty</code> in the definition of Tm. I can imagine why, but I was expecting <code>mutual</code> to be able to deal with it.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">Name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">String</span>\n\n<span class=\"kn\">mutual</span>\n<span class=\"w\">  </span><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Ty</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">star</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ty</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">arr</span><span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ty</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Tm</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Ty</span>\n\n<span class=\"w\">  </span><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Tm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ty</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">var</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Name</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Tm</span><span class=\"w\"> </span><span class=\"n\">A</span>\n<span class=\"kn\">end</span>\n</code></pre></div>\n<p>What would be a sensible work around?</p>",
        "id": 553501917,
        "sender_full_name": "Yuri",
        "timestamp": 1762214569
    },
    {
        "content": "<p>I guess here is one possibility (dumbing down the index):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Kind</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">ty</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Kind</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">tm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Kind</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Kind</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">star</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">ty</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">arr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">ty</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">tm</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">ty</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">var</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">ty</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Name</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">tm</span>\n</code></pre></div>\n<p>But I am not sure if I am setting up myself for some pain latter one when dealing with contexts, typing judgments, etc</p>",
        "id": 553502450,
        "sender_full_name": "Yuri",
        "timestamp": 1762214928
    },
    {
        "content": "<p>It seems that the following typechecks in Agda:</p>\n<div class=\"codehilite\" data-code-language=\"Agda\"><pre><span></span><code><span class=\"kr\">mutual</span>\n<span class=\"w\">  </span><span class=\"kr\">data</span><span class=\"w\"> </span>Ty<span class=\"w\"> </span><span class=\"ow\">:</span><span class=\"w\"> </span><span class=\"kt\">Set</span><span class=\"w\"> </span><span class=\"kr\">where</span>\n<span class=\"w\">    </span><span class=\"nf\">star</span><span class=\"w\"> </span><span class=\"ow\">:</span><span class=\"w\"> </span>Ty\n<span class=\"w\">    </span><span class=\"nf\">arr</span><span class=\"w\"> </span><span class=\"ow\">:</span><span class=\"w\"> </span><span class=\"o\">(</span>A<span class=\"w\"> </span><span class=\"ow\">:</span><span class=\"w\"> </span>Ty<span class=\"o\">)</span><span class=\"w\"> </span><span class=\"ow\">-&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span>s<span class=\"w\"> </span>t<span class=\"w\"> </span><span class=\"ow\">:</span><span class=\"w\"> </span>Tm<span class=\"w\"> </span>A<span class=\"o\">)</span><span class=\"w\"> </span><span class=\"ow\">-&gt;</span><span class=\"w\"> </span>Ty\n\n<span class=\"w\">  </span><span class=\"kr\">data</span><span class=\"w\"> </span>Tm<span class=\"w\"> </span><span class=\"ow\">:</span><span class=\"w\"> </span>Ty<span class=\"w\"> </span><span class=\"ow\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Set</span><span class=\"w\"> </span><span class=\"kr\">where</span>\n<span class=\"w\">    </span><span class=\"nf\">var</span><span class=\"w\"> </span><span class=\"ow\">:</span><span class=\"w\"> </span><span class=\"o\">(</span>A<span class=\"w\"> </span><span class=\"ow\">:</span><span class=\"w\"> </span>Ty<span class=\"o\">)</span><span class=\"w\"> </span><span class=\"ow\">-&gt;</span><span class=\"w\"> </span>Tm<span class=\"w\"> </span>A\n</code></pre></div>",
        "id": 553504011,
        "sender_full_name": "Yuri",
        "timestamp": 1762216005
    },
    {
        "content": "<p>Your first example is an example of an inductive-inductive type: <a href=\"https://ncatlab.org/nlab/show/inductive-inductive+type\">https://ncatlab.org/nlab/show/inductive-inductive+type</a></p>\n<p>These are not supported in Lean, but are supported in Agda.</p>",
        "id": 553573781,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1762251444
    },
    {
        "content": "<p>This thread gives more info, including workarounds: <a class=\"stream-topic\" data-stream-id=\"113488\" href=\"/#narrow/channel/113488-general/topic/inductive-inductive.20types/with/257953252\">#general &gt; inductive-inductive types</a> <br>\nYou should be able to model inductive-inductive types in Lean, but you don't get definitional computation rules (and I'm not sure if you'll get efficiently compiling code, if you care about that).</p>",
        "id": 553574087,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1762251529
    },
    {
        "content": "<p>Thanks, <span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span> , this helps! Sometimes I am not sure if I am not seeing something obvious, what I am trying is an impossible ask, or whether it is just a current Lean limitation. I will read the links carefully.</p>\n<p>BTW: I do care about compiled code.</p>",
        "id": 553703292,
        "sender_full_name": "Yuri",
        "timestamp": 1762286791
    }
]