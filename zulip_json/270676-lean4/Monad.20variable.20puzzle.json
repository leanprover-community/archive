[
    {
        "content": "<p>In what is below, <code>noMonad</code> does not use <code>[Monad m]</code>.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Environment</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monad</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">]</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">noMonad</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MonadEnv</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">Environment</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span><span class=\"w\"> </span><span class=\"n\">getEnv</span>\n\n<span class=\"sd\">/-- info: noMonad {m : Type → Type} [MonadEnv m] : m Environment -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">noMonad</span>\n</code></pre></div>\n<p>What happens if you remove <code>[Monad m]</code> from <code>variable</code>?</p>",
        "id": 479578546,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730242508
    },
    {
        "content": "<p>ah. i guess that sortof makes sense?</p>",
        "id": 479579514,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1730243039
    },
    {
        "content": "<p>not really, but sortof?</p>",
        "id": 479579567,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1730243048
    },
    {
        "content": "<p>I probably agree: I am still undecided on whether I think that it is cool or that it should not work.</p>",
        "id": 479579778,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730243180
    },
    {
        "content": "<p>i guess <code>MonadEnv</code> basically is a misnomer compared to what it does?</p>",
        "id": 479580461,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1730243604
    },
    {
        "content": "<p>and we can either change the way it works, or its name?</p>",
        "id": 479580498,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1730243634
    },
    {
        "content": "<p>I'm not sure that it is <code>MonadEnv</code> that is at fault there.  You can get a similar outcome with other <code>MonadXXX</code> classes.</p>",
        "id": 479580585,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730243693
    },
    {
        "content": "<p>it makes sense that you'd expect <code>MonadXXX</code> to be somehow related to Monads?</p>",
        "id": 479580824,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1730243834
    },
    {
        "content": "<p>so either we make them be related, or we change the name?</p>",
        "id": 479580842,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1730243849
    },
    {
        "content": "<p>I am not sure that there is anything to be changed, I just find the rules for inclusion of variables in declaration surprising, that's all.</p>",
        "id": 479581330,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730244155
    },
    {
        "content": "<p>i guess there's two surprises here. the first is that, despite the fact that <code>Monad m</code> doesn't get used here, its existance as an assumption is required in order to allow <code>do</code> notation. The second is that using a <code>MonadEnv</code> assumption doesn't somehow require you to have <code>Monad</code> already (resulting in the error with <code>do</code> notation when you remove the <code>Monad</code> assumption, rather than an error at <code>MonadEnv</code>).</p>",
        "id": 479581586,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1730244341
    },
    {
        "content": "<p>Yes, but I am not too surprised to find out that <code>MonadXXX</code> does not actually require <code>Monad</code>.</p>",
        "id": 479581788,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730244464
    },
    {
        "content": "<p>but it's in the name?</p>",
        "id": 479581938,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1730244589
    },
    {
        "content": "<p>it doesn't make sense as a class without?</p>",
        "id": 479582004,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1730244607
    },
    {
        "content": "<p>To me, the name suggests that <code>Monad</code> will be relevant, which it is.  As for making sense... Lean is happy with it, so I'm happy to accept that it does make sense!  <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 479582579,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730245073
    },
    {
        "content": "<p>I wonder if there are other typeclasses that you need to have present to elaborate but do not appear in the final type.</p>",
        "id": 479585414,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1730247000
    },
    {
        "content": "<p>I do not know: I found out about this since the \"unused variable command linter\" that I am writing told me that <code>Monad m</code> was not needed and when I went to remove it, I got slapped!</p>",
        "id": 479585527,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730247072
    },
    {
        "content": "<p>(The specific <code>MonadXXX</code> that was being used was <code>MonadMCtx</code>, though this is probably irrelevant.)</p>",
        "id": 479585579,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730247123
    },
    {
        "content": "<p>See <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Mathlib.Tactic.modifyMetavarDecl#doc\">docs#Mathlib.Tactic.modifyMetavarDecl</a>.</p>",
        "id": 479585671,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730247202
    },
    {
        "content": "<p>In that case, removing <code>Monad m</code> <em>and</em> <code>do</code> is an option!  <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 479585754,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730247251
    },
    {
        "content": "<p>I am not sure if there are some unexpected consequences in the removal, but <a href=\"https://github.com/leanprover-community/mathlib4/pull/18420\">#18420</a> is a PR making the linter happier.</p>",
        "id": 479586494,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730247797
    },
    {
        "content": "<p>Looks good, there are no consequences to that</p>",
        "id": 479586702,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1730247910
    },
    {
        "content": "<p>Incidentally I was just noticing that MonadEnv didn't need Monad a few days ago</p>",
        "id": 479586796,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1730247972
    },
    {
        "content": "<p>If I find more surprising removals, I will flag them, but so far all the removals have been pretty boring: a file has been split, <code>variable</code>s have been copied, but are now unused.  Mostly.</p>",
        "id": 479586803,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730247990
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/270676-lean4/topic/Monad.20variable.20puzzle/near/479586796\">said</a>:</p>\n<blockquote>\n<p>Incidentally I was just noticing that MonadEnv didn't need Monad a few days ago</p>\n</blockquote>\n<p>I view this a little like when in mathlib you define \"local rings\" and there is nothing \"local\" about them: in my mind, the fact that <code>MonadXXX</code> may not require <code>Monad</code> seems just an implementation detail.</p>",
        "id": 479586939,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730248086
    }
]