[
    {
        "content": "<p>I would like to add typeclasses for heterogeneous union and intersection, generalizing <code>Union</code> and <code>Inter</code> the way <code>HAdd</code> does for <code>Add</code>.</p>\n<p>Specifically, I would like to add the following to <code>src/Init/Core.lean</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/--</span>\n<span class=\"sd\">The notation typeclass for heterogeneous union.</span>\n<span class=\"sd\">This enables the notation `a â‹ƒ b : Î³` where `a : Î±`, `b : Î²`.</span>\n<span class=\"sd\">-/</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">HUnion</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Î²</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Î³</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">outParam</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- `a â‹ƒ b` computes the union of `a` and `b`.</span>\n<span class=\"sd\">  The meaning of this notation is type-dependent. -/</span>\n<span class=\"w\">  </span><span class=\"n\">hUnion</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Î²</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Î³</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">The notation typeclass for heterogeneous intersection.</span>\n<span class=\"sd\">This enables the notation `a âˆ© b : Î³` where `a : Î±`, `b : Î²`.</span>\n<span class=\"sd\">-/</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">HInter</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Î²</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Î³</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">outParam</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- `a âˆ© b` computes the intersection of `a` and `b`.</span>\n<span class=\"sd\">  The meaning of this notation is type-dependent. -/</span>\n<span class=\"w\">  </span><span class=\"n\">hInter</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Î²</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Î³</span>\n\n<span class=\"sd\">/-- `a âˆª b` is the union of`a` and `b`. -/</span>\n<span class=\"kn\">infixl</span><span class=\"o\">:</span><span class=\"mi\">65</span><span class=\"w\"> </span><span class=\"s2\">\" âˆª \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">HUnion</span><span class=\"bp\">.</span><span class=\"n\">hUnion</span>\n\n<span class=\"sd\">/-- `a âˆ© b` is the intersection of`a` and `b`. -/</span>\n<span class=\"kn\">infixl</span><span class=\"o\">:</span><span class=\"mi\">70</span><span class=\"w\"> </span><span class=\"s2\">\" âˆ© \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">HInter</span><span class=\"bp\">.</span><span class=\"n\">hInter</span>\n</code></pre></div>\n<p>I am working on a pull request for mathlib4 with closure operations for automata, including union and intersection. It would be nicer if I could use a mathematical notation instead of an English name to make the code closer to pen-and-paper formalism.</p>\n<p>Would this interfere with the current notations for <code>Union</code> and <code>Inter</code>...</p>\n<p>Thanks!</p>",
        "id": 501639360,
        "sender_full_name": "Rudy Peterson",
        "timestamp": 1740428150
    },
    {
        "content": "<p>Does such heterogeneous union and intersection exist anywhere on paper?</p>",
        "id": 501640224,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1740428445
    },
    {
        "content": "<p>Hmmm, good question.</p>\n<p>In the automata literature I have seen sometimes math notation is not used to give the union of <code>M1</code> and <code>M2</code>.  It seems that often it is declared as \"let <code>M</code> be the union of automata <code>M1</code> and <code>M2</code> such that <code>L(M) = L(M1) âˆª L(M2)</code>\".</p>\n<p>In one document where they use <code>M1 + M2</code> for the \"sum\" automaton, and <code>M1 Ã— M2</code> for the \"cartesian product\" automaton, which they use to define the union and intersection respectively. This more closely reflects how I construct the operations.</p>\n<p>Maybe <code>+</code> and <code>Ã—</code> would be better for my purposes: it's a strange disconnect between defining automata on paper in set theory where there are no strict types and one can just do operations between different sets and in Lean where any distinctions are enforced...</p>",
        "id": 501642871,
        "sender_full_name": "Rudy Peterson",
        "timestamp": 1740429300
    },
    {
        "content": "<p>It may be a case where the distinction is more important than for the average mathematical topic. We had lots of discussions about this in the context of matroids.</p>",
        "id": 501645099,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1740430116
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> may want to take a look here.</p>",
        "id": 501645384,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1740430206
    },
    {
        "content": "<p>Here is a link to a topic that Patrick is presumably referring to where I asked something like this - it was <code>sdiff</code> rather than union, for 'remove a thing' type operations in combinatorics. </p>\n<p><a class=\"message-link\" href=\"/#narrow/channel/287929-mathlib4/topic/Making.20SDiff.20heterogeneous.3F/near/375524912\">#mathlib4 &gt; Making SDiff heterogeneous? @ ðŸ’¬</a></p>",
        "id": 501794756,
        "sender_full_name": "Peter Nelson",
        "timestamp": 1740486739
    },
    {
        "content": "<p>In the end, I just used a custom unicode backslash.</p>",
        "id": 501795156,
        "sender_full_name": "Peter Nelson",
        "timestamp": 1740486869
    },
    {
        "content": "<p>There's a technical hurdle with heterogenous operators. Homogeneous operators are able to use the expected type, which they propagate to their arguments, aiding elaboration.</p>\n<p>Heterogeneous operators on the other hand don't have a mechanism to do that propagation on their own. This can mean lots of type ascriptions.</p>\n<p>One partial solutions is default instances that apply the homogenous instance when all else fails.</p>\n<p>For arithmetic operations, the rest of the solution is the <code>binop%</code> elaborator, which does the propagation using a metaprogram.</p>\n<p>If core moves to use heterogenous unions and intersections, then it would need to change <code>Union</code> and Inter<code>, which would affect </code>Set<code> in mathlib. It's possible that </code>binop%<code> would work with </code>Set` arguments, but I worry about set operations and arithmetic operations interacting in surprising ways.</p>",
        "id": 501978768,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1740555046
    }
]