[
    {
        "content": "<p>In <a class=\"message-link\" href=\"/#narrow/channel/113488-general/topic/Mathematics.20in.20Lean/near/529622206\">#general &gt; Mathematics in Lean @ üí¨</a>, a new user got confused by a version of:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">bar</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n</code></pre></div>\n<p>Where the <code>bar</code> in the proof of <code>foo.bar</code> was meant to refer to <code>_root_.bar</code>, but Lean thinks it‚Äôs a recursive call to </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">fail</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">termination</span><span class=\"w\"> </span><span class=\"n\">for</span>\n<span class=\"w\">  </span><span class=\"n\">foo</span><span class=\"bp\">.</span><span class=\"n\">bar</span>\n<span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">errors</span>\n<span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">infer</span><span class=\"w\"> </span><span class=\"n\">structural</span><span class=\"w\"> </span><span class=\"n\">recursion</span><span class=\"o\">:</span>\n<span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">parameters</span><span class=\"w\"> </span><span class=\"n\">suitable</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">structural</span><span class=\"w\"> </span><span class=\"n\">recursion</span>\n\n<span class=\"n\">well</span><span class=\"bp\">-</span><span class=\"n\">founded</span><span class=\"w\"> </span><span class=\"n\">recursion</span><span class=\"w\"> </span><span class=\"n\">cannot</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">used</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">foo</span><span class=\"bp\">.</span><span class=\"n\">bar'</span><span class=\"w\"> </span><span class=\"n\">does</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">take</span><span class=\"w\"> </span><span class=\"n\">any</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">non</span><span class=\"bp\">-</span><span class=\"n\">fixed</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">arguments</span>\n</code></pre></div>\n<p>Could we add to the error message something like: ‚Äúif you didn‚Äôt intend this to be a recursive definition then write <code>nonrec theorem</code> instead of <code>theorem</code> or double check you don‚Äôt have two declarations with the same name in different currently accessible namespaces‚Äù? Lean could even check if there is indeed a name clash in currently opened namespaces.</p>",
        "id": 529678529,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1753007484
    },
    {
        "content": "<p>I think it's pretty clear from the error message what the issue is (it says <code>foo.bar!</code>) though...</p>",
        "id": 529682071,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1753011258
    },
    {
        "content": "<p>I still think that mentioning <code>nonrec</code> in the error message is a clear improvement.</p>",
        "id": 529682421,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1753011597
    },
    {
        "content": "<p>I'm a bit on the fence of including text in error messages that is not specific to the concrete error instance at hand. If it's just pointing out a feature that may be useful then it's useful the first and second time you see it, and from then on its just noise and a waste of precious screen estate.</p>\n<p>The new ‚Äúerror explanation‚Äù feature (a manual section dedicated to and linked from a specific error message) is a better place to put such additional information, I think.</p>",
        "id": 529697322,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1753027338
    },
    {
        "content": "<p>What <em>would</em> be a useful feature is to include a Note in the error message only if the recursive calls would resolve to something else under <code>nonrec</code>, i.e. if there is plausible evidence that the user did not mean to write a recursive function. Then the extra note carries actual additional value, even to non-beginners.</p>",
        "id": 529697457,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1753027466
    },
    {
        "content": "<p>(ah, as Patrick said in the last sentence)</p>",
        "id": 529697484,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1753027494
    },
    {
        "content": "<p>Issue welcome.</p>",
        "id": 529697488,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1753027499
    }
]