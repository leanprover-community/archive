[
    {
        "content": "<p>Is there a way to specify the number of cores <code>lake build</code> is allowed to use (similar to <code>-j</code> in make)? <br>\nReason: On my office computer, when running <code>lake build</code> on Mathlib, all other programs start to lag/be unresponsive<br>\n(This is on Debian GNU/Linux 11 (bullseye), with GUI LXQt)</p>",
        "id": 500691450,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1739982363
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">LEAN_NUM_THREADS</span><span class=\"bp\">=</span><span class=\"n\">number</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span>\n</code></pre></div>",
        "id": 500692023,
        "sender_full_name": "Henrik BÃ¶ving",
        "timestamp": 1739982518
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 500692207,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1739982569
    },
    {
        "content": "<p>Is there no command-line flag for this?</p>",
        "id": 544059742,
        "sender_full_name": "Gavin Zhao",
        "timestamp": 1760051435
    },
    {
        "content": "<p>Also is the existence of <code>LEAN_NUM_THREAD</code> documented somewhere? I couldn't find it in the lake README or the manual.</p>",
        "id": 544059859,
        "sender_full_name": "Gavin Zhao",
        "timestamp": 1760051527
    },
    {
        "content": "<p>It's pretty common for build tools to have a flag <code>-j</code> or <code>--jobs</code> to specify this on the command-line so I think lake should have it as well.</p>",
        "id": 544059909,
        "sender_full_name": "Gavin Zhao",
        "timestamp": 1760051565
    },
    {
        "content": "<p>Lake lacks a <code>-j</code> option because Lean did not (and I believe still does not) provide a way for user programs (like Lake) to lmit the number of threads in its <code>Task</code> thread pool.</p>",
        "id": 544060196,
        "sender_full_name": "Mac Malone",
        "timestamp": 1760051759
    },
    {
        "content": "<p>While this is something that will hopefully be provided in the future, it has not yet appeared to be major issue and thus a fix has not been priotized.</p>",
        "id": 544060339,
        "sender_full_name": "Mac Malone",
        "timestamp": 1760051861
    },
    {
        "content": "<p>(and <code>LEAN_NUM_THREADS</code> serves a good-enough fix for the few places this has been issue)</p>",
        "id": 544060400,
        "sender_full_name": "Mac Malone",
        "timestamp": 1760051914
    },
    {
        "content": "<p>Lean has a <code>-j</code> option, printed by <code>lean --help</code> eg by this: <a href=\"https://github.com/leanprover/lean4/blob/3bab621364f87e8884927361b992a2b26b53c983/src/Lean/Shell.lean#L143\">https://github.com/leanprover/lean4/blob/3bab621364f87e8884927361b992a2b26b53c983/src/Lean/Shell.lean#L143</a></p>",
        "id": 544073436,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1760061090
    },
    {
        "content": "<p>It certainly does! That is because its <code>main</code> function is written in C++.</p>",
        "id": 544084513,
        "sender_full_name": "Mac Malone",
        "timestamp": 1760070381
    }
]