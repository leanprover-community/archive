[
    {
        "content": "<p>Suppose I have a big messy goal which I would like, for presentational reasons, to separate from the current proof and solve as a separate theorem/lemma. Copying the goal expression out of the goal window and into a new <code>theorem</code> structure doesn't always work, for example if it includes chained up-arrow conversions, these may be ambiguous.</p>\n<p>Is there a way to tell Lean to print out the current goal in an unambiguous form, one that can be copied into a new theorem without needing to be fixed up, and such that <code>exact new_theorem</code> will solve that goal (assuming a proof of <code>new_theorem</code>)?</p>",
        "id": 517901825,
        "sender_full_name": "Zack Weinberg",
        "timestamp": 1747162560
    },
    {
        "content": "<p>I found <code>pp.all</code> and that <em>works</em> but it goes way too far; my <code>new_theorem</code>'s statement is now 129 lines of syntax tree.</p>",
        "id": 517903678,
        "sender_full_name": "Zack Weinberg",
        "timestamp": 1747163180
    },
    {
        "content": "<p><code>extract_goal</code>, but it hits the same issue with not round tripping</p>",
        "id": 517908652,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1747164967
    },
    {
        "content": "<p>yeah, that is only slightly helpful</p>",
        "id": 517911289,
        "sender_full_name": "Zack Weinberg",
        "timestamp": 1747165919
    },
    {
        "content": "<p>it looks like it's printing the exact same thing that the goal window had</p>",
        "id": 517911461,
        "sender_full_name": "Zack Weinberg",
        "timestamp": 1747165966
    },
    {
        "content": "<p>in my specific case, <code>set_option pp.coercions.types true</code> got <code>extract_goal</code> to print expressions that are still pretty ugly, but not unmanageably so, and that do work</p>",
        "id": 517912353,
        "sender_full_name": "Zack Weinberg",
        "timestamp": 1747166301
    },
    {
        "content": "<p>yeah up-arrow coercions is the classic reason for failure to round-trip. With the goals I often work with, just removing the up-arrows has a fair chance of rescuing the situation.</p>",
        "id": 517927903,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1747172370
    },
    {
        "content": "<p>Double conversions (from <code>Fin</code> to <code>Nat</code> to <code>Int</code>) were what was messing things up for me.</p>\n<p>I wonder if a direct Fin-&gt;Int coercion would be useful.</p>",
        "id": 518138994,
        "sender_full_name": "Zack Weinberg",
        "timestamp": 1747249119
    }
]