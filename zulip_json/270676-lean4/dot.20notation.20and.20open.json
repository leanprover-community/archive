[
    {
        "content": "<p>Is this intended behavior?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Wat</span><span class=\"bp\">.</span><span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"n\">thd</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"n\">Î²</span><span class=\"w\"> </span><span class=\"n\">Î³</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"bp\">Ã—</span><span class=\"w\"> </span><span class=\"n\">Î²</span><span class=\"w\"> </span><span class=\"bp\">Ã—</span><span class=\"w\"> </span><span class=\"n\">Î³</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î³</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"m\">2</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Wat</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">thd</span><span class=\"w\"> </span><span class=\"c1\">-- works!</span>\n</code></pre></div>",
        "id": 526421996,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751295335
    },
    {
        "content": "<p>Yes, the idea is supposed to be that you can <code>open</code> some functions for your own library, without polluting another namespace you don't own.</p>",
        "id": 526422319,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1751295438
    },
    {
        "content": "<p>This ends up a little confusing with things like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">List</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">v</span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">]</span><span class=\"bp\">.</span><span class=\"n\">exists_eq_cons</span>\n</code></pre></div>\n<p>which is trying to invoke <code>List.Vector.exists_eq_cons</code> on <code>_root_.Vector</code></p>",
        "id": 526422799,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751295573
    },
    {
        "content": "<p>(<a href=\"https://github.com/leanprover/lean4/pull/6189\">lean4#6189</a> was the change)</p>",
        "id": 526422944,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1751295607
    },
    {
        "content": "<p>For what it's worth, this isn't breaking me, I just was surprised by the feature, and it seems risky in the face of types that share a name in different namespaces.</p>",
        "id": 526423336,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751295657
    },
    {
        "content": "<p>That's not good... but I think it's also not good practice sharing name components like this, having the same name for a type in different namespaces.</p>",
        "id": 526423480,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1751295700
    },
    {
        "content": "<p>At least in this case it's just surprising it resolves at all, right? Not that you're not getting things that you want to resolve to resolve?</p>",
        "id": 526423715,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1751295768
    },
    {
        "content": "<p>Indeed, I don't have an example where it's harmful, only where it fails confusingly</p>",
        "id": 526429194,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751297373
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/270676-lean4/topic/dot.20notation.20and.20open/near/526423480\">said</a>:</p>\n<blockquote>\n<p>That's not good... but I think it's also not good practice sharing name components like this, having the same name for a type in different namespaces.</p>\n</blockquote>\n<p>This is a new change to 'good practice' if so. To me it seems quite reasonable if you have several different versions of an API which are separated by their namespace</p>",
        "id": 526433969,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751298873
    },
    {
        "content": "<p>in fact, it largely defeats the purpose of namespaces, it means we have to be globally unique again and worry about name conflicts caused by this</p>",
        "id": 526434095,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751298910
    },
    {
        "content": "<p>For what it's worth, C# has this feature via \"extension methods\", but it's opt in by marking one of the arguments in a special way</p>",
        "id": 526437661,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751300069
    },
    {
        "content": "<p>I don't think C# has the ability to turn extension methods on and off again, or does it?</p>",
        "id": 526438508,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751300362
    },
    {
        "content": "<p>in rust if you use typeclasses to define extension methods then they are available as long as you have opened the typeclass, so you can turn them off and on again to some extent</p>",
        "id": 526438594,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751300398
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/270676-lean4/topic/dot.20notation.20and.20open/near/526433969\">said</a>:</p>\n<blockquote>\n<p>This is a new change to 'good practice' if so. To me it seems quite reasonable if you have several different versions of an API which are separated by their namespace</p>\n</blockquote>\n<p>It's not a change â€” I'm expressing a personal opinion.</p>\n<p>Let me refine this opinion: if you have multiple namespaces you are working with and you want to <code>open</code> them all, you shouldn't reuse name components. In my experience, it's not good practice, since the name conflicts cause issues. (I personally like to avoid reusing any name components between namespaces that tend to be used in modules together, even if I don't <code>open</code> them, but that's not a strict rule.)</p>\n<p>Here we have <code>Vector</code> and <code>List.Vector</code>, with <code>open List</code>. Would you agree that having <code>List.Vector</code> defeats the purpose of being able to <code>open List</code>?</p>",
        "id": 526445709,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1751302876
    },
    {
        "content": "<p>I agree that you shouldn't use <code>Vector</code> and <code>List.Vector</code> at the same time if you have used <code>open List</code></p>",
        "id": 526474976,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751312108
    },
    {
        "content": "<p>Is it the case that all problematic situations here for dot notation are also problematic in the sense of having an ambiguous name in scope?</p>",
        "id": 526475150,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751312168
    },
    {
        "content": "<p>If I understand correctly, the net effect of this is we could <code>namespace Mathlib</code> and nothing would break (in Mathlib, downstream would then have to <code>open Mathlib</code> a lot). Is that correct? This would obviate the biggest obstacle in my mind to that choice.</p>",
        "id": 526494422,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1751321958
    },
    {
        "content": "<p>+1 to namespacing Mathlib BTW. I don't see why we should be arrogant enough to just take the root namespace for our ideas.</p>",
        "id": 526495620,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1751322762
    },
    {
        "content": "<p>I don't think that was really the point of Jireh's comment; we could have Mathlib.Group anyway, it's things likeÂ <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.digits#doc\">docs#Nat.digits</a>Â that the re-namespacing of is more controversial.</p>",
        "id": 526496598,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751323362
    },
    {
        "content": "<p>The doc-gen site would display Mathlib before every definition name, though</p>",
        "id": 526499230,
        "sender_full_name": "Niels Voss",
        "timestamp": 1751325202
    },
    {
        "content": "<p>Good? Or if it's bad, then change doc-gen? Seems a minor problem!</p>",
        "id": 526502663,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1751327833
    },
    {
        "content": "<p>Out of curiosity, would this allow two different versions of Mathlib based on the same Lean version to be loaded simultaneously by changing one of the namespace names? (I am not claiming this is a good idea, I'm just wondering if it would be possible)</p>",
        "id": 526513134,
        "sender_full_name": "Niels Voss",
        "timestamp": 1751335905
    },
    {
        "content": "<p>Actually nevermind, there are overlapping tactics and global notations</p>",
        "id": 526513166,
        "sender_full_name": "Niels Voss",
        "timestamp": 1751335936
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"521331\">Niels Voss</span> <a href=\"#narrow/channel/270676-lean4/topic/dot.20notation.20and.20open/near/526499230\">said</a>:</p>\n<blockquote>\n<p>The doc-gen site would display Mathlib before every definition name, though</p>\n</blockquote>\n<p>And loogle too. This is already a big issue when</p>\n<ol>\n<li>We can't use scoped notation in loogle</li>\n<li>There are super long namespaces like <code>CategoryTheory</code></li>\n</ol>",
        "id": 526549586,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1751357406
    },
    {
        "content": "<p>1: yes we can, <code>open scoped Foo in $your_search</code></p>",
        "id": 526582603,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751367989
    },
    {
        "content": "<p>A user-configurable, persistent set of default opens for Loogle seems like a reasonable feature request to me, I would use it for <code>open Lean</code>!</p>",
        "id": 526590031,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1751370621
    },
    {
        "content": "<p>It seems like there's another potentially unintended behaviour:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">A</span>\n\n<span class=\"c1\">-- comment me out</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">A</span>\n\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"bp\">.</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">c</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">A</span>\n</code></pre></div>",
        "id": 535099587,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755599871
    },
    {
        "content": "<p>you have to actually <code>open</code> the namespace to make this bug work, even if you're already in the <code>namespace</code>! (I would have previously assumed that the namespace is automatically <code>open</code>ed in the <code>namespace</code>)</p>",
        "id": 535099625,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755599892
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span> I was experimenting with this recently in the unfinished <a href=\"https://github.com/leanprover/lean4/pull/9636\">lean4#9636</a> to try to address issue <a href=\"https://github.com/leanprover/lean4/pull/6135\">lean4#6135</a></p>\n<p>The current rules for dot notation ignore the current namespace when resolving the name. Roughly, the way name resolution works in general is that it first uses all prefixes of the current namespace to find a name, and if that doesn't work, it tries all the open namespaces. The PR would make it use the namespaces.</p>\n<p>The idea of the PR is to make it possible to be in namespace <code>A</code>, then define <code>A.IO.FS.Stream.foo</code>, and then use it with dot notation. And, while making sure that <code>open IO</code> will always open <code>_root_.IO</code>, even if it might also open <code>A.IO</code> because you're somewhere in the <code>A</code> namespace.</p>",
        "id": 535161446,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1755619332
    },
    {
        "content": "<p>I am happy with Mathlib having the monopoly for defining what <code>Group</code> is.<br>\nMy personal preference is to not <code>namespace</code> everything.</p>",
        "id": 543149035,
        "sender_full_name": "Martin DvoÅ™Ã¡k",
        "timestamp": 1759655257
    },
    {
        "content": "<p>(Link to an MWE about a possibly related issue: <a class=\"message-link\" href=\"/#narrow/channel/287929-mathlib4/topic/dot.20notation/near/543333752\">#mathlib4 &gt; dot notation @ ðŸ’¬</a> )</p>",
        "id": 543335338,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1759761805
    }
]