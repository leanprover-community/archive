[
    {
        "content": "<p>For context, I'm working on a clone of mathlib with some of my own changes for my own learning purposes. </p>\n<p>I ran into a bug where Lean is unable to synthesize an instance that was declared just above it. Due to how deep this is in my project, and my unfamiliarity with #synth, I'm not able to create a nice MVE. But I have saved this bug into a branch linked below.</p>\n<p><a href=\"https://github.com/RustyYato/lean4-math/blob/4bfa4a8e14d94c28acd6b96c06d12b50789799bf/Math/Topology/MetricSpace/Defs.lean#L127-L137\">https://github.com/RustyYato/lean4-math/blob/4bfa4a8e14d94c28acd6b96c06d12b50789799bf/Math/Topology/MetricSpace/Defs.lean#L127-L137</a></p>\n<p>The relevant portion looks like this, with the following error showing up in VSCode</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsMetricSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"n\">metricSpaceSup</span>\n\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">IsMetricSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">synthesize</span>\n<span class=\"w\">  </span><span class=\"n\">IsMetricSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span>\n\n<span class=\"n\">Additional</span><span class=\"w\"> </span><span class=\"n\">diagnostic</span><span class=\"w\"> </span><span class=\"n\">information</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">available</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"ss\">`set_option</span><span class=\"w\"> </span><span class=\"n\">diagnostics</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"bp\">.</span>\n</code></pre></div>\n<p>My lean version</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"mf\">4.19</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">nightly</span><span class=\"bp\">-</span><span class=\"mi\">2025</span><span class=\"bp\">-</span><span class=\"mi\">03</span><span class=\"bp\">-</span><span class=\"mi\">24</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x86_64</span><span class=\"bp\">-</span><span class=\"n\">unknown</span><span class=\"bp\">-</span><span class=\"n\">linux</span><span class=\"bp\">-</span><span class=\"n\">gnu</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">commit</span><span class=\"w\"> </span><span class=\"mi\">635</span><span class=\"n\">af865bf52</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Release</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>I wanted to check to see if this was something I was doing before filing a bug report. Does anyone know what might be going on?</p>",
        "id": 507916528,
        "sender_full_name": "RustyYato",
        "timestamp": 1742871799
    },
    {
        "content": "<p>Does this work?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsMetricSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstance</span>\n</code></pre></div>\n<p>Also, if you hover over the keyword <code>instance</code> in <code>instance : IsMetricSpace (α × β) := Prod.metricSpaceSup</code>, what type do you see?</p>",
        "id": 507917548,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1742872504
    },
    {
        "content": "<p>no, inferInstance is in the same boat (and that's actually how I found this, since I wasn't able to synthesize this instance for some reason, and while trying to reduce that bug I ran into this more weird bug).</p>\n<blockquote>\n<p>Also, if you hover over the keyword <code>instance</code> in <code>instance : IsMetricSpace (α × β) := Prod.metricSpaceSup</code>, what type do you see?</p>\n</blockquote>\n<p>This type, which is correct as far as I can tell. </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">instIsMetricSpaceProd</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">u_2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">u_3</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_2</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_3</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Dist</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Dist</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LE</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LT</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">]</span>\n<span class=\"o\">[</span><span class=\"n\">AddMonoidOps</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsOrderedAddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Sup</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsSemiLatticeSup</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsAddCancel</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsMetricSpace</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span>\n<span class=\"o\">[</span><span class=\"n\">IsMetricSpace</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsMetricSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>I forgot to put this in my example above, but I also have these variables in scope</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Dist</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Dist</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">LE</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LT</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddMonoidOps</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">IsOrderedAddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Sup</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsSemiLatticeSup</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">IsAddCancel</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">IsMetricSpace</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsMetricSpace</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 507921599,
        "sender_full_name": "RustyYato",
        "timestamp": 1742875171
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"610303\">RustyYato</span> <a href=\"#narrow/channel/270676-lean4/topic/synth.20bug.2C.20not.20inferring.20instance.20defined.20just.20above/near/507921599\">said</a>:</p>\n<blockquote>\n<p>I forgot to put this in my example above, but I also have these variables in scope</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Dist</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Dist</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">LE</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LT</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddMonoidOps</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">IsOrderedAddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Sup</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsSemiLatticeSup</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">IsAddCancel</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">IsMetricSpace</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsMetricSpace</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">]</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>If I put that at the top of my scope, I get an error, because <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Dist#doc\">docs#Dist</a> only takes one type argument.</p>",
        "id": 507930002,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1742879922
    },
    {
        "content": "<p>Maybe lean is failing to synthesise gamma? Is it an outparam?</p>",
        "id": 507931722,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1742880902
    },
    {
        "content": "<blockquote>\n<p>If I put that at the top of my scope, I get an error, because <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Dist#doc\">docs#Dist</a> only takes one type argument.</p>\n</blockquote>\n<p>Yes, that's because this isn't Mathlib :), this is from my own project which is quite similar to mathlib (since I'm using it as a reference for my own learning,).</p>\n<blockquote>\n<p>Maybe lean is failing to synthesise gamma? Is it an outparam?</p>\n</blockquote>\n<p>yes it's in outparam in <code>Dist</code>, <code>IsPseudoMetricSpace</code> and <code>IsMetricSpace</code>. </p>\n<p>And now that I think of it, why is it an outparam in <code>IsPseudoMetricSpace</code> and <code>IsMetricSpace</code>? That seems suspect.</p>",
        "id": 507932211,
        "sender_full_name": "RustyYato",
        "timestamp": 1742881208
    },
    {
        "content": "<p>Wow, removing outparam on the <code>Is*MetricSpace</code> type-classes fixed the issue. I still don't understand why that is. Is there a special interaction that I'm not aware of?</p>\n<p>the relevant snippet is this one</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Dist</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">β</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">outParam</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">dist</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">β</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">IsPseudoMetricSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">β</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"c1\">-- before β was also marked as an outParam, and that seemed to cause the issue</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">LT</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LE</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddMonoidOps</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsOrderedAddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Dist</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">IsLinearOrder</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n</code></pre></div>",
        "id": 507932442,
        "sender_full_name": "RustyYato",
        "timestamp": 1742881356
    },
    {
        "content": "<p>Meybe <code>set_option trace.Meta.synthInstance true</code> will be able to help you</p>",
        "id": 507932866,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1742881582
    },
    {
        "content": "<p>Thanks for all the help! Looks like I'll need to figure out how to properly use outParam <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span>. I thought I had understood it, but it looks like there are some subtleties I need to figure out.</p>",
        "id": 507933306,
        "sender_full_name": "RustyYato",
        "timestamp": 1742881839
    },
    {
        "content": "<p>I think you're running into a (known) bug where it's failing to report that <code>IsPseudoMetricSpace</code> has a questionable parent projection instance.</p>\n<p>The parent projection to <code>IsLinearOrder β</code> needs to somehow figure out what <code>α</code> is to apply. How can it do this? (Take a look at <code>IsPseudoMetricSpace.toIsLinearOrder</code> to see the instance.) Could you try <code>set_option trace.Meta.synthOrder true</code> and report back on the synth order for the arguments to this instance?</p>\n<p>I believe what you need to do instead is not extend <code>IsLinearOrder β</code>, and instead add it as an <code>[IsLinearOrder β]</code> argument.</p>",
        "id": 508053784,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1742915940
    },
    {
        "content": "<blockquote>\n<p>Could you try <code>set_option trace.Meta.synthOrder true</code> and report back on the synth order for the arguments to this instance?</p>\n</blockquote>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthOrder</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">synthesizing</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">arguments</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">instIsMetricSpaceProd</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">order</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">9</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">11</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">13</span><span class=\"o\">]:</span>\n<span class=\"w\">      </span><span class=\"n\">Dist</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span>\n<span class=\"w\">      </span><span class=\"n\">Dist</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span>\n<span class=\"w\">      </span><span class=\"n\">LE</span><span class=\"w\"> </span><span class=\"n\">γ</span>\n<span class=\"w\">      </span><span class=\"n\">LT</span><span class=\"w\"> </span><span class=\"n\">γ</span>\n<span class=\"w\">      </span><span class=\"n\">AddMonoidOps</span><span class=\"w\"> </span><span class=\"n\">γ</span>\n<span class=\"w\">      </span><span class=\"n\">IsOrderedAddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">γ</span>\n<span class=\"w\">      </span><span class=\"n\">Sup</span><span class=\"w\"> </span><span class=\"n\">γ</span>\n<span class=\"w\">      </span><span class=\"n\">IsSemiLatticeSup</span><span class=\"w\"> </span><span class=\"n\">γ</span>\n<span class=\"w\">      </span><span class=\"n\">IsAddCancel</span><span class=\"w\"> </span><span class=\"n\">γ</span>\n<span class=\"w\">      </span><span class=\"n\">IsMetricSpace</span><span class=\"w\"> </span><span class=\"n\">α</span>\n<span class=\"w\">      </span><span class=\"n\">IsMetricSpace</span><span class=\"w\"> </span><span class=\"n\">β</span>\n</code></pre></div>\n<blockquote>\n<p>I think you're running into a (known) bug where it's failing to report that <code>IsPseudoMetricSpace</code> has a questionable parent projection instance.</p>\n</blockquote>\n<p>I see, is this because there's no reliable way to work backwards from <code>IsLinearOrder Y</code> to <code>IsMetricSpace A</code> (with <code>Dist A Y</code>)?</p>",
        "id": 508089292,
        "sender_full_name": "RustyYato",
        "timestamp": 1742924509
    },
    {
        "content": "<p>Yeah, there's no way to infer <code>A</code>.</p>\n<p>I think the only reason it's looking like it works at the moment is that instances that come from the local context (e.g. ones from <code>variables</code> or binders) use slightly different rules, and the consequence is that it's solving for <code>A</code> by unification. I didn't do an experiment to validate this in your case.</p>",
        "id": 508098614,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1742927244
    },
    {
        "content": "<p>(The bug is that the synthOrder checker ignores issues with parent projection type parameters. It assumes they're all solvable by unification, which is not true in general.)</p>",
        "id": 508098793,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1742927286
    },
    {
        "content": "<p>Ok that makes sense, I'll probably switch over to [IsLinearOrder] soon then. Thanks for the heads up!</p>",
        "id": 508098893,
        "sender_full_name": "RustyYato",
        "timestamp": 1742927315
    },
    {
        "content": "<blockquote>\n<p>I think you're running into a (known) bug where it's failing to report that <code>IsPseudoMetricSpace</code> has a questionable parent projection instance.</p>\n</blockquote>\n<p>Oh wow, I ran into this exact issue somewhere else in my project, it would have taken forever to debug without your heads up! Thanks again <span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span></p>",
        "id": 509055719,
        "sender_full_name": "RustyYato",
        "timestamp": 1743361485
    }
]