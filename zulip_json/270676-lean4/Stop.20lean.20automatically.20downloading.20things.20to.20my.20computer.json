[
    {
        "content": "<p>There are a lot of \"conveniences\" in the lean toolchain that I find pretty aggressive. I get pretty upset when things are downloaded or installed onto my computer without my consent.</p>\n<p>I would like to get help with the following problems.<br>\nNumber 1, how do I avoid the problem that <code>lean --version</code> tries to download and install lean? What on earth kind of behavior is that?<br>\n<a href=\"/user_uploads/3121/ZRt43XaP2FBpOqf8sWaWdeEY/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/ZRt43XaP2FBpOqf8sWaWdeEY/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"720x37\" src=\"/user_uploads/thumbnail/3121/ZRt43XaP2FBpOqf8sWaWdeEY/image.png/840x560.webp\"></a></div><p>Number 2, when I open VSCode, it says 'Starting lean language server and <strong>cloning necessary repositories.</strong>\" No, thank you very much! How do I stop this behavior?</p>\n<p>Please point me to everywhere else where this toolchain is downloading and installing things without my explicit direction so that I can disable this aggressive and absolutely unsolicited behavior. This is like the used car salesman of programming languages.</p>",
        "id": 564801818,
        "sender_full_name": "Patrick Nicodemus",
        "timestamp": 1766205514
    },
    {
        "content": "<p>Regarding <code>lean --version</code>, this is invoking a shim provided by <code>elan</code> (which you presumably installed), which downloads the <code>lean</code> binary and runs that instead</p>",
        "id": 564802011,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1766205790
    },
    {
        "content": "<p>If you want to see what toolchains <code>elan</code> has installed, rather than invoke one, you can use <code>elan toolchain list</code></p>",
        "id": 564802024,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1766205818
    },
    {
        "content": "<p>I think there's two problems here: <code>elan</code> automatically downloads toolchains (what Eric Wieser mentioned), and <code>lake</code> automatically installs dependencies when it is run (which happens automatically when Lean is started up). For the former problem, it might be reasonable for <code>elan</code> to add a config option to allow prompting the user before installing new toolchains, though <code>elan</code> doesn't really seem to have a configuration right now. <code>elan</code> is a fork of <code>rustup</code>, so I'm wondering if anyone who uses Rust knows whether or not this same thing happens there, and how it has been resolved if so.</p>\n<p>For the latter problem, there's at least two things that can be done: either have the Lean language server prompt the user before running <code>lake build</code>, or have <code>lake build</code> prompt before downloading repositories. It's not clear to me that either of these solutions is desirable. I think we could take inspiration from other programming languages, but as far as I know all other build tools (e.g. gradle with java, uv with python) I have worked with do the same thing that Lean does and just automatically download packages.</p>",
        "id": 564819421,
        "sender_full_name": "Niels Voss",
        "timestamp": 1766227204
    },
    {
        "content": "<p>How do I <em>personally</em> configure the Lean LSP or Lake build to behave differently with this regard?</p>",
        "id": 564826377,
        "sender_full_name": "Patrick Nicodemus",
        "timestamp": 1766235226
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">patrick</span><span class=\"bp\">@</span><span class=\"n\">patrick</span><span class=\"bp\">-</span><span class=\"n\">ThinkPad</span><span class=\"w\"> </span><span class=\"bp\">~/</span><span class=\"n\">c</span><span class=\"bp\">/</span><span class=\"n\">l</span><span class=\"bp\">/</span><span class=\"n\">double</span><span class=\"bp\">-</span><span class=\"n\">categories</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">master</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">]</span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">elan</span><span class=\"w\"> </span><span class=\"n\">default</span><span class=\"w\"> </span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">26</span><span class=\"bp\">.</span><span class=\"m\">0</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">default</span><span class=\"w\"> </span><span class=\"n\">toolchain</span><span class=\"w\"> </span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">26</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">'</span>\n<span class=\"n\">patrick</span><span class=\"bp\">@</span><span class=\"n\">patrick</span><span class=\"bp\">-</span><span class=\"n\">ThinkPad</span><span class=\"w\"> </span><span class=\"bp\">~/</span><span class=\"n\">c</span><span class=\"bp\">/</span><span class=\"n\">l</span><span class=\"bp\">/</span><span class=\"n\">double</span><span class=\"bp\">-</span><span class=\"n\">categories</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">master</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SIGINT</span><span class=\"o\">]</span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">lean</span><span class=\"w\"> </span><span class=\"c1\">--version</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">downloading</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">releases</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">lang</span><span class=\"bp\">.</span><span class=\"n\">org</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"bp\">/</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">27</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc1</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"mf\">4.27</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc1</span><span class=\"bp\">-</span><span class=\"n\">linux</span><span class=\"bp\">.</span><span class=\"n\">tar</span><span class=\"bp\">.</span><span class=\"n\">zst</span>\n</code></pre></div>",
        "id": 564826437,
        "sender_full_name": "Patrick Nicodemus",
        "timestamp": 1766235314
    },
    {
        "content": "<p>How do I stop <code>lean</code> from downloading the most recent version of <code>lean</code>? Obviously <code>elan default</code> isn't doing what I am looking for</p>",
        "id": 564826456,
        "sender_full_name": "Patrick Nicodemus",
        "timestamp": 1766235338
    },
    {
        "content": "<p>Oh, I see.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">patrick</span><span class=\"bp\">@</span><span class=\"n\">patrick</span><span class=\"bp\">-</span><span class=\"n\">ThinkPad</span><span class=\"w\"> </span><span class=\"bp\">~/</span><span class=\"n\">c</span><span class=\"bp\">/</span><span class=\"n\">l</span><span class=\"bp\">/</span><span class=\"n\">double</span><span class=\"bp\">-</span><span class=\"n\">categories</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">master</span><span class=\"o\">)</span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">update</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">checking</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">revision</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"mi\">950</span><span class=\"n\">ff565938d137c026ab67af9dcd978a2ddd3be'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">updating</span><span class=\"w\"> </span><span class=\"n\">toolchain</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">27</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc1'</span>\n</code></pre></div>\n<p>I didn't realize <code>lake update</code> was going to edit my project-local configuration files. Is there a way to pin the Lean version to a project? What is the command to update only those projects which don't already have a version pinned?</p>",
        "id": 564826804,
        "sender_full_name": "Patrick Nicodemus",
        "timestamp": 1766235731
    },
    {
        "content": "<p>For example I just installed Lean 4.26, and I want to install any version of mathlib which is compatible with this, say the most recent compatible version. How do I install a compatible version of mathlib?</p>",
        "id": 564827342,
        "sender_full_name": "Patrick Nicodemus",
        "timestamp": 1766236268
    },
    {
        "content": "<p>Do you want an independent clone of mathlib or do you have a project that depends on mathlib, and you want it to use a compatible version?</p>",
        "id": 564827944,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1766236907
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/270676-lean4/topic/Stop.20lean.20automatically.20downloading.20things.20to.20my.20computer/near/564827944\">said</a>:</p>\n<blockquote>\n<p>Do you want an independent clone of mathlib or do you have a project that depends on mathlib, and you want it to use a compatible version?</p>\n</blockquote>\n<p>Right now I have a project that depends on mathlib and I'd like to use a compatible version. However, I'd be interested in hearing about the first one.</p>",
        "id": 564827997,
        "sender_full_name": "Patrick Nicodemus",
        "timestamp": 1766236959
    },
    {
        "content": "<p>If you have a <code>lakefile.lean</code>, you can use</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">require</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">git</span>\n<span class=\"w\">  </span><span class=\"s2\">\"https://github.com/leanprover-community/mathlib4.git\"</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"s2\">\"v4.26.0\"</span>\n</code></pre></div>\n<p>or with a <code>lakefile.toml</code></p>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"k\">[[require]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"mathlib\"</span>\n<span class=\"n\">scope</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"leanprover-community\"</span>\n<span class=\"n\">rev</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"v4.26.0\"</span>\n</code></pre></div>\n<p>and within an independent clone of mathlib, you can do <code>git checkout v4.26.0</code></p>",
        "id": 564828232,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1766237179
    },
    {
        "content": "<p>Okay, thank you. That's very helpful. Is rev = \"v.4.26.0\" a tag in the Mathlib git repo?</p>",
        "id": 564828789,
        "sender_full_name": "Patrick Nicodemus",
        "timestamp": 1766237787
    },
    {
        "content": "<p>Yes, exactly</p>",
        "id": 564830060,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1766238965
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"460251\">Patrick Nicodemus</span> <a href=\"#narrow/channel/270676-lean4/topic/Stop.20lean.20automatically.20downloading.20things.20to.20my.20computer/near/564826804\">said</a>:</p>\n<blockquote>\n<p>I didn't realize <code>lake update</code> was going to edit my project-local configuration files. Is there a way to pin the Lean version to a project?</p>\n</blockquote>\n<p>Note that these project-local configuration files are exactly what does the pinning; the <code>lake update</code> command means \"move the pin to something more recent\".</p>",
        "id": 565202811,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1766517386
    },
    {
        "content": "<p>What <span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span>  is suggesting is a reasonable strategy if you want to carefully choose the version to pin to; if you just care about being on a stable version, I believe you can use <code>@ \"stable\"</code> instead, which will allow <code>lake update</code> to upgrade to <code>4.27.0</code> when it releases.</p>",
        "id": 565202836,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1766517397
    }
]