[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Fin2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">}</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">error: `grind` failed</span>\n<span class=\"sd\">case grind</span>\n<span class=\"sd\">n : Fin2</span>\n<span class=\"sd\">h : 2 ≤ n.val</span>\n<span class=\"sd\">⊢ False</span>\n<span class=\"sd\">[grind] Goal diagnostics</span>\n<span class=\"sd\">  [facts] Asserted facts</span>\n<span class=\"sd\">    [prop] 2 ≤ n.val</span>\n<span class=\"sd\">  [eqc] True propositions</span>\n<span class=\"sd\">    [prop] 2 ≤ n.val</span>\n<span class=\"sd\">  [cutsat] Assignment satisfying linear constraints</span>\n<span class=\"sd\">    [assign] n.val := 2</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">grind</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">grind</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">property</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>Should we add <code>[grind .]</code> attribute to <code>Subtype.property</code> so it can solve goals like this?</p>",
        "id": 556986882,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1763446130
    },
    {
        "content": "<p>I mean this would work with actual subtypes and e.g. if you marked <code>Fin2</code> an <code>abbrev</code>. In this case, you used <code>Subtype.val</code> on a <code>Fin2</code> though which, to <code>grind</code>, is not a subtype. So here the better option would be to avoid the defeq abuse and define the necessary functions and lemmas yourself:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Fin2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Fin2</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">1</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">grind!</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Fin2</span><span class=\"bp\">.</span><span class=\"n\">lt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">grind</span>\n</code></pre></div>",
        "id": 556993363,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1763449395
    },
    {
        "content": "<p>Note that Fin2 already has a meaning in Mathlib (though I think in practice it's somewhat deprecated?)... also is there a reason you aren't using <code>Fin 2</code>?</p>",
        "id": 557892971,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1763461996
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"330967\">Wrenna Robson</span> <a href=\"#narrow/channel/270676-lean4/topic/Add.20Subtype.2Eproperty.20to.20grind.3F/near/557892971\">said</a>:</p>\n<blockquote>\n<p>is there a reason you aren't using <code>Fin 2</code>?</p>\n</blockquote>\n<p>It's example for <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a>.</p>",
        "id": 557893327,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1763462089
    },
    {
        "content": "<p>Aha.</p>",
        "id": 557893356,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1763462100
    },
    {
        "content": "<p>Yeah I assume the issue is that grind can't see through the <code>def</code>.</p>",
        "id": 557893482,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1763462137
    },
    {
        "content": "<p>But I agree with <span class=\"user-mention\" data-user-id=\"873547\">@Robin Arnez</span>. <code>grind</code> probably shouldn't even see past the definition in the first place. The fact that adding <code>Subtype.property</code> to grind set helped me solve the goal is a bit of a defeq abuse as Robin called it.</p>",
        "id": 557893837,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1763462269
    },
    {
        "content": "<p>Surely we have <code>grind_pattern Subtype.property =&gt; self.val</code> somewhere!?! I'm sure I added that way back, but I can't find it. :-(</p>",
        "id": 557902217,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1763464689
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/270676-lean4/topic/Add.20Subtype.2Eproperty.20to.20grind.3F/near/557902217\">said</a>:</p>\n<blockquote>\n<p>Surely we have <code>grind_pattern Subtype.property =&gt; self.val</code> somewhere!?! I'm sure I added that way back, but I can't find it. :-(</p>\n</blockquote>\n<p>Can't find it either. But is it needed? This works fine:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">Fin2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">}</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">grind</span><span class=\"w\"> </span><span class=\"n\">only</span>\n</code></pre></div>",
        "id": 557906520,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1763465725
    }
]