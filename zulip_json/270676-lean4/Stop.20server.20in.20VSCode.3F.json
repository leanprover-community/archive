[
    {
        "content": "<p>Is there a way to stop the Lean server altogether in VS Code? When rebuilding the Lean sources in VS Code, the build can fail because the previously built Lean is already running in as the Lean server for VS Code (and thus it can't overwrite the executable). Thus, if I could start the server before building and then start it again after, I could get around this issue.</p>",
        "id": 237211748,
        "sender_full_name": "Mac",
        "timestamp": 1620068495
    },
    {
        "content": "<p>Does the server build the executable? I would have assumed not</p>",
        "id": 237211915,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1620068567
    },
    {
        "content": "<p>Wow, I assume you're on Windows?</p>",
        "id": 237213824,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1620069452
    },
    {
        "content": "<p>See also this change in Lean 3: <a href=\"https://github.com/leanprover-community/lean/commit/667e1e138162ef6d65a2041abfe760a7aa79c2c5\">https://github.com/leanprover-community/lean/commit/667e1e138162ef6d65a2041abfe760a7aa79c2c5</a></p>",
        "id": 237215471,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1620070193
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110024\">Sebastian Ullrich</span> <a href=\"#narrow/stream/270676-lean4/topic/Stop.20server.20in.20VSCode.3F/near/237213824\">said</a>:</p>\n<blockquote>\n<p>Wow, I assume you're on Windows?</p>\n</blockquote>\n<p>Yep, I'm on Windows.</p>",
        "id": 237219834,
        "sender_full_name": "Mac",
        "timestamp": 1620072047
    },
    {
        "content": "<p>Ok, then we should use something like the commit linked by Gabriel so that the server doesn't have to be stopped at all</p>",
        "id": 237221849,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1620072923
    },
    {
        "content": "<p>Sounds great! That would be even more convient!</p>",
        "id": 237224108,
        "sender_full_name": "Mac",
        "timestamp": 1620073902
    },
    {
        "content": "<p>If anyone wants to figure this out and test it, please go ahead <span aria-label=\"big smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"big smile\">:big_smile:</span></p>",
        "id": 237225100,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1620074283
    },
    {
        "content": "<p>Fyi, in addition to this problem appearing while building a new Lean while the server is running, it also appears if one runs <code>elan update</code> on a toolchain while the toolchain server is running.</p>",
        "id": 238788654,
        "sender_full_name": "Mac",
        "timestamp": 1621007949
    },
    {
        "content": "<p>That is, the issue is also (Lean 4) user-facing in addition to (Lean 4) developer-facing.</p>",
        "id": 238788722,
        "sender_full_name": "Mac",
        "timestamp": 1621007980
    },
    {
        "content": "<p>Is there a way to stop the server in VSCode? When I'm actively editing a file and I don't want to see the infoview or anything, the server is still running, and that slows down other stuff I want to happen (like replacing <code>\\a</code> with <code>Î±</code>). I'd be great if I could just stop the server while I'm editing and resume it once I'm done. The \"pause\" button in the infoview only seems to pause the infoview state, it doesn't actually stop the server.</p>",
        "id": 526233577,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751152822
    },
    {
        "content": "<p>I just type <code>killall lean</code> in a terminal</p>",
        "id": 526234641,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1751154673
    },
    {
        "content": "<p>I'm on windows sometimes and <code>stop-process -name \"lean\"</code> is more characters than I want to type.</p>",
        "id": 526234671,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751154723
    },
    {
        "content": "<p>Also I have to start it up again when I'm done typing</p>",
        "id": 526234688,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751154744
    },
    {
        "content": "<p>I'd be great if I could just use a keyboard shortcut or something</p>",
        "id": 526234695,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751154756
    },
    {
        "content": "<p>To start it again I just click the \"lean has stopped, click here to start it again\" button</p>",
        "id": 526234922,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1751155139
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/270676-lean4/topic/Stop.20server.20in.20VSCode.3F/near/526234922\">said</a>:</p>\n<blockquote>\n<p>To start it again I just click the \"lean has stopped, click here to start it again\" button</p>\n</blockquote>\n<p>That's two more clicks than I want, and that still doesn't solve the problem with stopping Lean.</p>",
        "id": 526235960,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751156618
    },
    {
        "content": "<p>Maybe a nearly ideal solution would be to pause the server while typing (i.e., have a configurable time interval that the server waits after the user has typed something that is restarted with every keystroke). This way, one does not have to always click/type twice (to stop and then restart the server) in addition to the actual typing.</p>",
        "id": 526258454,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1751189891
    },
    {
        "content": "<p>And maybe all threads the server is running should be killed when I type something.</p>",
        "id": 526259117,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1751190747
    },
    {
        "content": "<p>Any significant computation outliving a text edit is a bug and should be reported</p>",
        "id": 526259390,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1751191070
    },
    {
        "content": "<p>My impression is that this is happening all the time. At least, I experience that VSCode becomes sluggish when typing in a (not very short) file; for example (as mentioned above), after typing <code>\\N</code> or similar, it takes a while until <code>â„•</code> appears, and in some cases, it even doesn't, and I have to delete <code>\\N</code> and re-type it.</p>",
        "id": 526262632,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1751195340
    },
    {
        "content": "<p>That sounds a lot like what I reported months ago</p>",
        "id": 526263720,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1751196628
    },
    {
        "content": "<p>I don't think I have ever experienced this. What OS are you on and how much memory do you have? When I am killing the server it's for reasons such as \"I am running lake exe cache get or lake build on the command line and my gut feeling is that it's safer to restart\" rather than \"I am having problems\"</p>",
        "id": 526267430,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1751200809
    },
    {
        "content": "<p>cf <a class=\"message-link\" href=\"/#narrow/channel/113488-general/topic/v4.2E19.2E0-rc2/near/513367404\">#general &gt; v4.19.0-rc2 @ ðŸ’¬</a></p>",
        "id": 526267550,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1751200972
    },
    {
        "content": "<p>I'm on Linux and have a reasonably fast laptop. When I type near the beginning of a Lean file with ~500 lines or so, I can see yellow bars all the way down while typing, and the system monitor shows that the server spawns a whole bunch of threads. Depending on the situation, this can max out the number of available cores, which is when I experience the sluggishness mentioned above.</p>\n<p>I would argue that while I'm typing, there is no need for the server to check all subsequent code in the file; this can be done once I have stopped typing (for something like maybe half a second), as it is pretty unlikely that the intermediate states of the text while I'm typing are in any way meaningful.</p>",
        "id": 526268414,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1751202014
    },
    {
        "content": "<p>I asked something similar but for neovim <a href=\"#narrow/stream/113488-general/topic/lean.2Envim/near/512540778\">here</a><br>\nIt looks like for now there's no good way of doing this.</p>",
        "id": 526268903,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1751202595
    },
    {
        "content": "<p>Oh interesting! My workflow is different -- I always dump an <code>#exit</code> after the declaration I'm working on if I'm hacking in the middle of a file.</p>",
        "id": 526271128,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1751205055
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479359\">Michael Stoll</span> <a href=\"#narrow/channel/270676-lean4/topic/Stop.20server.20in.20VSCode.3F/near/526268414\">said</a>:</p>\n<blockquote>\n<p>I would argue that while I'm typing, there is no need for the server to check all subsequent code in the file; this can be done once I have stopped typing (for something like maybe half a second), as it is pretty unlikely that the intermediate states of the text while I'm typing are in any way meaningful.</p>\n</blockquote>\n<p>This is fairly standard for search engines. Does the LSP not do this?</p>",
        "id": 526272762,
        "sender_full_name": "Justin Asher",
        "timestamp": 1751206819
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/270676-lean4/topic/Stop.20server.20in.20VSCode.3F/near/526271128\">said</a>:</p>\n<blockquote>\n<p>Oh interesting! My workflow is different -- I always dump an <code>#exit</code> after the declaration I'm working on if I'm hacking in the middle of a file.</p>\n</blockquote>\n<p>I resort to that when it gets too bad, but it would be better if that weren't necessary.</p>",
        "id": 526273254,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1751207257
    },
    {
        "content": "<p>I feel like it's cruel to keep making the server try and make sense of code which is temporarily junk because there's a declaration missing (as it's being refactored or whatever) :-)</p>",
        "id": 526273302,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1751207305
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479359\">Michael Stoll</span> <a href=\"#narrow/channel/270676-lean4/topic/Stop.20server.20in.20VSCode.3F/near/526258454\">said</a>:</p>\n<blockquote>\n<p>Maybe a nearly ideal solution would be to pause the server while typing (i.e., have a configurable time interval that the server waits after the user has typed something that is restarted with every keystroke).</p>\n</blockquote>\n<p>I'm pretty sure this already exists, but my typing times vary and I don't want to have to wait 10 seconds for the server to restart after I'm done typing and I also don't want the server to start up again while I'm in a 10 second pause to figure out what to type next</p>",
        "id": 526274525,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751208605
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"816344\">@Aaron Liu</span> Do you want a stop / run button then that appears on the LSP console? I do not think that should be very hard to add.</p>",
        "id": 526279687,
        "sender_full_name": "Justin Asher",
        "timestamp": 1751213931
    },
    {
        "content": "<p>I found a VSCode command to stop the server. It's kind of hidden, and not in any of the menus afaik. I go to the search bar at the top of VSCode and type <code>&gt;stop</code> and it appears <code>Lean 4: Server: Stop Server</code>. Still not amazing but it's a lot better than typing <code>stop-process -name \"lean\"</code> into the console.</p>",
        "id": 566112719,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767399957
    }
]