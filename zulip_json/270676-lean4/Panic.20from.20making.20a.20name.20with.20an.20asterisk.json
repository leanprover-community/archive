[
    {
        "content": "<p>I just found the following panic, when trying to make a test-case for a mathlib linter I'm working on.<br>\nThis causes a panic on the assertion failure, with an error mentioning (<code>Inhabited.default</code> for <code>IO.Error</code>).</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Linter</span><span class=\"bp\">.</span><span class=\"n\">TextBased</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Linter</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Linter</span><span class=\"bp\">.</span><span class=\"n\">TextBased</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">testModulesForbiddenWindows</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"c1\">-- Explicitly enable the linter, although it is enabled by default.</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">opts</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LinterOptions</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"n\">toOptions</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">modulesUpperCamelCase</span><span class=\"bp\">.</span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"o\">{}</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"w\">    </span><span class=\"n\">linterSets</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{}</span>\n<span class=\"w\">  </span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"n\">assert!</span><span class=\"o\">((</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">modulesForbiddenWindows</span><span class=\"w\"> </span><span class=\"n\">opts</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"ss\">`Mathlib.Foo</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"s2\">\"Foo*\"</span><span class=\"bp\">.</span><span class=\"n\">toName</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">testModulesForbiddenWindows</span><span class=\"w\"> </span><span class=\"c1\">-- panic</span>\n</code></pre></div>\n<p>Changing the assertion to <code>assert!((← modulesForbiddenWindows opts #[</code>Mathlib.Foo.«Foo*»]) == 1)` works --- so this is arguably a user error. I would expect a better error message, though!</p>",
        "id": 532868078,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1754383954
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 532868198,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1754383987
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 532868405,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1754384039
    },
    {
        "content": "<p>I think the panic just comes from the <code>assert!</code>, so maybe use something other than <code>assert!</code></p>",
        "id": 532888002,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1754390659
    },
    {
        "content": "<p>Well, <code>assert!</code> is non-monadic, so it will return <code>default : IO Unit</code> on failure</p>",
        "id": 532889624,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1754391283
    },
    {
        "content": "<p>To be more precise, <code>assert!</code> throws a <code>panic!</code> message and then returns <code>default : IO Unit</code></p>",
        "id": 532891799,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1754392044
    }
]