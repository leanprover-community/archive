[
    {
        "content": "<p>Would it be possible to add a small button in VSCode extension for <code>#min_imports</code>, where clicking it automatically replaces all the imports with minimized imports? (I always copy-paste manually.)</p>",
        "id": 565871076,
        "sender_full_name": "Seewoo Lee",
        "timestamp": 1767166822
    },
    {
        "content": "<p>It might be possible to make it produce a <code>Try this</code> suggestion.</p>",
        "id": 565872056,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1767167829
    },
    {
        "content": "<p>I left this as an issue in <a href=\"https://github.com/leanprover/vscode-lean4/issues/698\">vscode-lean4</a>.</p>",
        "id": 566004739,
        "sender_full_name": "Seewoo Lee",
        "timestamp": 1767309187
    },
    {
        "content": "<p>That's not really an issue for vscode-lean4, #min_imports is mathlib code.</p>",
        "id": 566004824,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1767309334
    },
    {
        "content": "<p>Oops sorry, then where should I ask this? Issue in actual mathlib? I don't know much about how other <code>Try this</code> suggestions works in vscode extension.</p>",
        "id": 566004909,
        "sender_full_name": "Seewoo Lee",
        "timestamp": 1767309481
    },
    {
        "content": "<p>Here is a possible implementation: I called it <code>#min_imports'</code> simply to distinguish it from the other.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">ImportGraph</span><span class=\"bp\">.</span><span class=\"n\">Meta</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">TryThis</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Command</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">TryThis</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"#min_imports'\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">imports</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getEnv</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">minimalRequiredModules</span><span class=\"bp\">.</span><span class=\"n\">qsort</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·.</span><span class=\"n\">toString</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"bp\">·.</span><span class=\"n\">toString</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toList</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s!</span><span class=\"s2\">\"import {·}\"</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">newImports</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span><span class=\"bp\">.</span><span class=\"n\">intercalate</span><span class=\"w\"> </span><span class=\"n\">imports</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">fm</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getFileMap</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">imps</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">parseHeader</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">inputString</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">fm</span><span class=\"bp\">.</span><span class=\"n\">source</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">fileName</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getFileName</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">fileMap</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">fm</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"n\">liftTermElabM</span><span class=\"w\"> </span><span class=\"k\">do</span><span class=\"w\"> </span><span class=\"n\">addSuggestion</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">origSpan?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">imps</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getRef</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">newImports</span>\n\n<span class=\"bp\">#</span><span class=\"n\">min_imports'</span>\n</code></pre></div>",
        "id": 566042946,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1767349908
    },
    {
        "content": "<p>Note that if the imports are interspersed with comments, those will get erased by the <code>Try this</code> suggestion.</p>",
        "id": 566043003,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1767349942
    },
    {
        "content": "<p>Leading/trailing comments are preserved, though.</p>",
        "id": 566043061,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1767349995
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- survives `Try this`</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"c1\">-- this comment gets erased</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"w\"> </span><span class=\"c1\">-- this comment also survives</span>\n</code></pre></div>",
        "id": 566043101,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1767350037
    },
    {
        "content": "<p>The new shake will do a much better job than #min_imports, which is essentially obsolete now. Once we're actually shipping the new shake we will probably add a VSCode extension menu item for it.</p>",
        "id": 566139932,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1767435960
    }
]