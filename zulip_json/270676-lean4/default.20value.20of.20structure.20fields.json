[
    {
        "content": "<p>default value of structure's field must be type of <code>Prop</code>?</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">structure</span><span class=\"w\"> </span><span class=\"n\">NonEmptyString</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"w\">  </span><span class=\"n\">another_value</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"n\">ev</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">value.length</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"n\">decide</span>\n<span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">Repr</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">eg</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">NonEmptyString</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span>\n<span class=\"cm\">  type mismatch</span>\n<span class=\"cm\">    fun another_value =&gt; { value := \"hello\", another_value := another_value, ev := ⋯ }</span>\n<span class=\"cm\">  has type</span>\n<span class=\"cm\">    Int → NonEmptyString : Type</span>\n<span class=\"cm\">  but is expected to have type</span>\n<span class=\"cm\">    NonEmptyString : Type</span>\n<span class=\"cm\">  -/</span>\n<span class=\"w\">  </span><span class=\"n\">NonEmptyString.mk</span><span class=\"w\"> </span><span class=\"s2\">\"hello\"</span>\n</code></pre></div>",
        "id": 451093710,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1720826456
    },
    {
        "content": "<p>default value of <code>ev</code> does work,  but default value of <code>another_value</code>does not work...</p>",
        "id": 451093777,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1720826503
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">NonEmptyString</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"w\">  </span><span class=\"n\">another_value</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"n\">ev</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">decide</span>\n<span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">Repr</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">eg</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">NonEmptyString</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"hello\"</span><span class=\"w\"> </span><span class=\"o\">}</span>\n</code></pre></div>\n<p>works</p>",
        "id": 451093894,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1720826575
    },
    {
        "content": "<p>why <code>.mk</code> function does not have default value of <code>another_value</code>?<br>\nis it a bug? (I think this is very surprising and it should be a bug... )</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"c\">/-</span>\n<span class=\"cm\">NonEmptyString.mk (value : String) (another_value : Int) (ev : value.length &gt; 0 := by decide) : NonEmptyString</span>\n<span class=\"cm\">-/</span>\n<span class=\"k\">#check</span><span class=\"w\"> </span><span class=\"n\">NonEmptyString.mk</span>\n</code></pre></div>",
        "id": 451093988,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1720826640
    },
    {
        "content": "<p>Yeah, might be a bug.</p>",
        "id": 451094106,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1720826697
    },
    {
        "content": "<p>ok I will submit a issue on leanprover/lean4</p>",
        "id": 451094151,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1720826723
    },
    {
        "content": "<p>done: <a href=\"https://github.com/leanprover/lean4/issues/4736\">https://github.com/leanprover/lean4/issues/4736</a></p>",
        "id": 451095099,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1720827352
    },
    {
        "content": "<p>I think default values of structure fields are different to default values of functions?</p>",
        "id": 451096398,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1720828191
    },
    {
        "content": "<p>This also works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">NonEmptyString</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">mk</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">another_value</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">ev</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">decide</span><span class=\"o\">)</span>\n<span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">Repr</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">eg</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">NonEmptyString</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">NonEmptyString</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"s2\">\"hello\"</span>\n</code></pre></div>",
        "id": 451096504,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1720828242
    },
    {
        "content": "<p>I think defaults have to be handled specially in <code>structure</code> because of how they interact with inheritance</p>",
        "id": 451096527,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1720828258
    },
    {
        "content": "<blockquote>\n<p>I think default values of structure fields are different to default values of functions?</p>\n</blockquote>\n<p>constructor of structure should have same dafault value, I think</p>",
        "id": 451096530,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1720828259
    },
    {
        "content": "<blockquote>\n<p>I think defaults have to be handled specially in <code>structure</code> because of how they interact with inheritance</p>\n</blockquote>\n<p>oh... I hadn't thought of that ... .</p>",
        "id": 451096697,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1720828349
    },
    {
        "content": "<p>even if this is not a bug, this is still negative surprising.</p>",
        "id": 451098713,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1720829443
    },
    {
        "content": "<p>Default value processing for structures is rather complicated, and it only works with <code>{...}</code> notation</p>",
        "id": 451099520,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1720829921
    },
    {
        "content": "<p>The main problem is that default values need to take <code>extends</code> into account</p>",
        "id": 451099555,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1720829940
    },
    {
        "content": "<p>in detail, what does problem occurs if structure’s constructor have default value?</p>",
        "id": 451099956,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1720830167
    },
    {
        "content": "<p>Here's an example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"c1\">-- A.mk (x : Nat) : A</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"c1\">-- B.mk (toA : A) : B</span>\n</code></pre></div>",
        "id": 451104174,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1720832048
    },
    {
        "content": "<p>There's no place for the default value for <code>x</code> to go in <code>B.mk</code>.</p>",
        "id": 451104274,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1720832098
    }
]