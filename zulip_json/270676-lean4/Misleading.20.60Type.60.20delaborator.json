[
    {
        "content": "<p>This caught me by surprise:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- for convenience, not part of the issue</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Qq</span><span class=\"bp\">.</span><span class=\"n\">Macro</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Qq</span>\n\n<span class=\"n\">run_cmd</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mkLevelParam</span><span class=\"w\"> </span><span class=\"ss\">`u</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mkLevelParam</span><span class=\"w\"> </span><span class=\"ss\">`v</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">t1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)))</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">t2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"({t1} == {t2}) = {t1 == t2}\"</span>\n<span class=\"c1\">-- (Type (max u v) == Type (max u v)) = false</span>\n</code></pre></div>\n<p>My mental model was that delaborators should round trip up to Expr equality, not just to defeq; is this a reasonable model?</p>",
        "id": 493633828,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736875390
    },
    {
        "content": "<p>Ah, this is from the fact that the delaborator uses <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Level.dec#doc\">docs#Lean.Level.dec</a> to decide whether to pretty print using <code>Type</code> or <code>Sort</code>.</p>\n<p>I'm not sure there's a firm policy on universe levels for the pretty printer. It seems like it would be very hard to guarantee universe level equality when round tripping.</p>\n<p>At least for expressions, I think it's the case that pretty printing yields equal expressions, modulo universe levels.</p>",
        "id": 493636357,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1736876293
    }
]