[
    {
        "content": "<p>I'm trying to run the code from <a href=\"https://github.com/leanprover/lean4/blob/master/tests/pkg/user_ext/UserExt/FooExt.lean\">github.com/leanprover/lean4/~/UserExt/FooExt.lean</a> e.g. with <code>def hi := 5; insert_foo hi; show_foo_set;</code>, and I get:</p>\n<blockquote>\n<p>Lean server printed an error: libc++abi: terminating with uncaught exception of type lean::exception: cannot evaluate <code>[init]</code> declaration 'fooExtension' in the same module</p>\n</blockquote>\n<p>Why does this happen/how to properly run these? (<span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span>?)</p>",
        "id": 308816865,
        "sender_full_name": "Evgenia Karunus",
        "timestamp": 1668009279
    },
    {
        "content": "<p>that's what happens when you use an environment extension in the same module (aka file) that declares it</p>",
        "id": 308817025,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1668009331
    },
    {
        "content": "<p>that's why the usage code <a href=\"https://github.com/leanprover/lean4/blob/master/tests/pkg/user_ext/UserExt/Tst1.lean\">https://github.com/leanprover/lean4/blob/master/tests/pkg/user_ext/UserExt/Tst1.lean</a> is a separate file</p>",
        "id": 308817316,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1668009429
    },
    {
        "content": "<p>Is this because of the <code>initialize</code> keyword?</p>",
        "id": 308818452,
        "sender_full_name": "Evgenia Karunus",
        "timestamp": 1668009745
    },
    {
        "content": "<p>anything that ultimately boils down to code that declares a global variable using <code>initialize</code> can't actually be accessed until the initialization code is run during initialization (i.e. when this file is imported into another during an <code>import</code> line)</p>",
        "id": 308820383,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1668010336
    },
    {
        "content": "<p>you can write functions that refer to the variable but those functions can't be run using the equivalent of <code>#eval</code> inside the same file</p>",
        "id": 308820564,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1668010394
    },
    {
        "content": "<p>that also includes declaring an attribute and then applying it to definitions in the same file, or declaring a variable with <code>initialize</code> and then reading it in the same file, or declaring an environment extension and using a tactic/command that accesses the extension in the same file</p>",
        "id": 308820763,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1668010456
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"480079\">Evgenia Karunus</span> has marked this topic as resolved.</p>",
        "id": 308826537,
        "sender_full_name": "Notification Bot",
        "timestamp": 1668012223
    }
]