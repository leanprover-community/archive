[
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a> (on arm64, MacOS Sonoma 14.2, Apple clang version 15.0.0 (clang-1500.3.9.4)):</p>\n<p><code>test.c</code>:</p>\n<div class=\"codehilite\" data-code-language=\"C\"><pre><span></span><code><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;lean/lean.h&gt;</span>\n\n<span class=\"n\">lean_object</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"nf\">initialize_Init</span><span class=\"p\">(</span><span class=\"kt\">uint8_t</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">lean_object</span><span class=\"o\">*</span><span class=\"p\">);</span>\n\n<span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"nf\">main</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">  </span><span class=\"n\">initialize_Init</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">lean_io_mk_world</span><span class=\"p\">());</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><code>test.sh</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code><span class=\"ch\">#!/usr/bin/env sh</span>\n<span class=\"nv\">TOOLCHAIN_DIR</span><span class=\"o\">=</span><span class=\"s2\">\"</span><span class=\"k\">$(</span>lean<span class=\"w\"> </span>--print-prefix<span class=\"k\">)</span><span class=\"s2\">\"</span>\n<span class=\"nv\">INCLUDE_DIR</span><span class=\"o\">=</span><span class=\"s2\">\"</span><span class=\"nv\">$TOOLCHAIN_DIR</span><span class=\"s2\">/include\"</span>\n<span class=\"nv\">LIB_DIR</span><span class=\"o\">=</span><span class=\"s2\">\"</span><span class=\"nv\">$TOOLCHAIN_DIR</span><span class=\"s2\">/lib\"</span>\n<span class=\"nv\">LEAN_LIB_DIR</span><span class=\"o\">=</span><span class=\"s2\">\"</span><span class=\"nv\">$LIB_DIR</span><span class=\"s2\">/lean\"</span>\nclang<span class=\"w\"> </span>-g<span class=\"w\"> </span>test.c<span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>-o<span class=\"w\"> </span>test_bin<span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>-I<span class=\"s2\">\"</span><span class=\"nv\">$INCLUDE_DIR</span><span class=\"s2\">\"</span><span class=\"w\"> </span>-L<span class=\"s2\">\"</span><span class=\"nv\">$LEAN_LIB_DIR</span><span class=\"s2\">\"</span><span class=\"w\"> </span>-L<span class=\"s2\">\"</span><span class=\"nv\">$LIB_DIR</span><span class=\"s2\">\"</span><span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>-fstack-clash-protection<span class=\"w\"> </span>-fvisibility<span class=\"o\">=</span>hidden<span class=\"w\"> </span>-lleancpp<span class=\"w\"> </span>-lInit<span class=\"w\"> </span>-lStd<span class=\"w\"> </span>-lLean<span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>-lleanrt<span class=\"w\"> </span>-lc++<span class=\"w\"> </span>-lLake<span class=\"w\"> </span>-lgmp<span class=\"w\"> </span>-luv\n</code></pre></div>\n<p>lean-toolchain:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">12</span><span class=\"bp\">.</span><span class=\"m\">0</span>\n</code></pre></div>\n<p>output:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">lldb</span><span class=\"w\"> </span><span class=\"bp\">./</span><span class=\"n\">test_bin</span>\n<span class=\"o\">(</span><span class=\"n\">lldb</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">create</span><span class=\"w\"> </span><span class=\"s2\">\"./test_bin\"</span>\n<span class=\"n\">Current</span><span class=\"w\"> </span><span class=\"n\">executable</span><span class=\"w\"> </span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"bp\">'/</span><span class=\"n\">path</span><span class=\"bp\">/</span><span class=\"n\">to</span><span class=\"bp\">/</span><span class=\"n\">test_bin'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">arm64</span><span class=\"o\">)</span><span class=\"bp\">.</span>\n<span class=\"o\">(</span><span class=\"n\">lldb</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">run</span>\n<span class=\"n\">Process</span><span class=\"w\"> </span><span class=\"mi\">54539</span><span class=\"w\"> </span><span class=\"n\">launched</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">'/</span><span class=\"n\">path</span><span class=\"bp\">/</span><span class=\"n\">to</span><span class=\"bp\">/</span><span class=\"n\">test_bin'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">arm64</span><span class=\"o\">)</span>\n<span class=\"n\">Process</span><span class=\"w\"> </span><span class=\"mi\">54539</span><span class=\"w\"> </span><span class=\"n\">stopped</span>\n<span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">queue</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">com</span><span class=\"bp\">.</span><span class=\"n\">apple</span><span class=\"bp\">.</span><span class=\"n\">main</span><span class=\"bp\">-</span><span class=\"n\">thread'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">stop</span><span class=\"w\"> </span><span class=\"n\">reason</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">EXC_BAD_ACCESS</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">code</span><span class=\"bp\">=</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">address</span><span class=\"bp\">=</span><span class=\"mi\">0</span><span class=\"n\">x20</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">frame</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">x00000001002b4168</span><span class=\"w\"> </span><span class=\"n\">test_bin</span><span class=\"ss\">`lean_alloc_small</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">36</span>\n<span class=\"n\">test_bin</span><span class=\"ss\">`lean_alloc_small</span><span class=\"o\">:</span>\n<span class=\"bp\">-&gt;</span><span class=\"w\">  </span><span class=\"mi\">0</span><span class=\"n\">x1002b4168</span><span class=\"w\"> </span><span class=\"bp\">&lt;+</span><span class=\"mi\">36</span><span class=\"bp\">&gt;</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ldr</span><span class=\"w\">    </span><span class=\"n\">x2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">x10</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">0</span><span class=\"n\">x10</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"n\">x1002b416c</span><span class=\"w\"> </span><span class=\"bp\">&lt;+</span><span class=\"mi\">40</span><span class=\"bp\">&gt;</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ldr</span><span class=\"w\">    </span><span class=\"n\">x10</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">x9</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">0</span><span class=\"n\">x2068</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"n\">x1002b4170</span><span class=\"w\"> </span><span class=\"bp\">&lt;+</span><span class=\"mi\">44</span><span class=\"bp\">&gt;</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">add</span><span class=\"w\">    </span><span class=\"n\">x10</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x10</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">0</span><span class=\"n\">x1</span>\n<span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"n\">x1002b4174</span><span class=\"w\"> </span><span class=\"bp\">&lt;+</span><span class=\"mi\">48</span><span class=\"bp\">&gt;</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">str</span><span class=\"w\">    </span><span class=\"n\">x10</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">x9</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">0</span><span class=\"n\">x2068</span><span class=\"o\">]</span>\n<span class=\"n\">Target</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">test_bin</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">stopped</span><span class=\"bp\">.</span>\n<span class=\"o\">(</span><span class=\"n\">lldb</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">bt</span>\n<span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">queue</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">com</span><span class=\"bp\">.</span><span class=\"n\">apple</span><span class=\"bp\">.</span><span class=\"n\">main</span><span class=\"bp\">-</span><span class=\"n\">thread'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">stop</span><span class=\"w\"> </span><span class=\"n\">reason</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">EXC_BAD_ACCESS</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">code</span><span class=\"bp\">=</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">address</span><span class=\"bp\">=</span><span class=\"mi\">0</span><span class=\"n\">x20</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">frame</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">x00000001002b4168</span><span class=\"w\"> </span><span class=\"n\">test_bin</span><span class=\"ss\">`lean_alloc_small</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">36</span>\n<span class=\"w\">    </span><span class=\"n\">frame</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">x00000001000e44ac</span><span class=\"w\"> </span><span class=\"n\">test_bin</span><span class=\"ss\">`initialize_Init_Prelude</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">148</span>\n<span class=\"w\">    </span><span class=\"n\">frame</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">x0000000100292220</span><span class=\"w\"> </span><span class=\"n\">test_bin</span><span class=\"ss\">`initialize_Init</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">80</span>\n<span class=\"w\">    </span><span class=\"n\">frame</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">3</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">x0000000100000ef8</span><span class=\"w\"> </span><span class=\"n\">test_bin</span><span class=\"ss\">`main</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"bp\">.</span><span class=\"n\">c</span><span class=\"o\">:</span><span class=\"mi\">6</span><span class=\"o\">:</span><span class=\"mi\">3</span>\n<span class=\"w\">    </span><span class=\"n\">frame</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">x00000001804090e0</span><span class=\"w\"> </span><span class=\"n\">dyld</span><span class=\"ss\">`start</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2360</span>\n</code></pre></div>\n<p>is it a real issue or did I get the build command wrong?</p>",
        "id": 474765184,
        "sender_full_name": "llllvvuu",
        "timestamp": 1728029087
    },
    {
        "content": "<p>Please see <a href=\"https://docs.lean-lang.org/lean4/doc/dev/ffi.html#initialization\">https://docs.lean-lang.org/lean4/doc/dev/ffi.html#initialization</a></p>",
        "id": 474781838,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1728034448
    },
    {
        "content": "<p>I see, so <code>lean_initialize_runtime_module();</code> / <code>lean_io_mark_end_initialization();</code> is required. Thank you!</p>",
        "id": 474784373,
        "sender_full_name": "llllvvuu",
        "timestamp": 1728035371
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"607118\">llllvvuu</span> has marked this topic as resolved.</p>",
        "id": 474784379,
        "sender_full_name": "Notification Bot",
        "timestamp": 1728035373
    }
]