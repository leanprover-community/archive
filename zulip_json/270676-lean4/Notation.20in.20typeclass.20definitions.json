[
    {
        "content": "<p>Is there a way to define a notation at the same time as a typeclass? In Coq I might do something like </p>\n<div class=\"codehilite\" data-code-language=\"Coq\"><pre><span></span><code><span class=\"kn\">Reserved</span> <span class=\"n\">Infix</span> <span class=\"s2\">\"~&gt;\"</span> <span class=\"o\">(</span><span class=\"n\">at</span> <span class=\"n\">level</span> <span class=\"mi\">90</span><span class=\"o\">,</span> <span class=\"k\">right</span> <span class=\"n\">associativity</span><span class=\"o\">).</span>\n\n<span class=\"kn\">Class</span> <span class=\"n\">Category</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"o\">:=</span> <span class=\"o\">{</span>\n  <span class=\"n\">object</span><span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"o\">;</span>\n  <span class=\"n\">arrow</span><span class=\"o\">:</span> <span class=\"n\">object</span> <span class=\"o\">-&gt;</span> <span class=\"n\">object</span> <span class=\"o\">-&gt;</span> <span class=\"kt\">Type</span> <span class=\"n\">where</span> <span class=\"s2\">\"a ~&gt; b\"</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">arrow</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">);</span>\n  <span class=\"o\">.</span>\n  <span class=\"o\">.</span>\n  <span class=\"o\">.</span>\n <span class=\"c\">(* the rest of the typeclass, can now use the ~&gt; notation for readability *)</span>\n<span class=\"o\">}</span>\n\n<span class=\"kn\">Notation</span> <span class=\"s2\">\"f ~&gt; g\"</span>   <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">arrow</span> <span class=\"n\">f</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">at</span> <span class=\"n\">level</span> <span class=\"mi\">90</span><span class=\"o\">,</span> <span class=\"k\">right</span> <span class=\"n\">associativity</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Is there a Lean equivalent?</p>",
        "id": 448640326,
        "sender_full_name": "Chris Henson",
        "timestamp": 1719935203
    },
    {
        "content": "<p>I know of a hacky and, I imagine, discouraged way, through disabling hygiene.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">hygiene</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">section</span>\n<span class=\"w\">  </span><span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">infixr</span><span class=\"o\">:</span><span class=\"mi\">90</span><span class=\"w\">  </span><span class=\"s2\">\" ~&gt; \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">arrow</span>\n\n<span class=\"w\">  </span><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Category</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"n\">object</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"w\">    </span><span class=\"n\">arrow</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">object</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">object</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"w\">    </span><span class=\"n\">iden</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">object</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">infixr</span><span class=\"o\">:</span><span class=\"mi\">90</span><span class=\"w\"> </span><span class=\"s2\">\" ~&gt; \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"n\">arrow</span>\n</code></pre></div>",
        "id": 448659618,
        "sender_full_name": "Horațiu Cheval",
        "timestamp": 1719940217
    },
    {
        "content": "<p>The usual solution is to define the class in stages. For example in Mathlib we:</p>\n<ul>\n<li>define <code>Quiver</code></li>\n<li>set up the arrow notation from that</li>\n<li>define <code>Category extends Quiver</code>, and can use the notation in the data/axioms</li>\n</ul>",
        "id": 448715804,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1719960219
    },
    {
        "content": "<p>(In fact we have even more layers, with <code>CategoryStruct</code> for just the <code>id</code>/<code>comp</code> data, and finally <code>Category</code> with the axioms.)</p>",
        "id": 448715838,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1719960240
    },
    {
        "content": "<p>Arguably the fact this helps with notation is an afterthought; in my mind the main motivation for this design is that sometimes you need to prove some very simple lemmas about the operation before you can proceed with the rest of the typeclass</p>",
        "id": 448716135,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1719960372
    },
    {
        "content": "<p>I don't think there are any such for <code>Quiver</code> or <code>CategoryStruct</code>?</p>",
        "id": 448716531,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1719960583
    },
    {
        "content": "<p>Also note this is a regression compared to Lean 3.</p>",
        "id": 448825805,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1720006733
    },
    {
        "content": "<p>How so? Isn't the counter to that \"you can ask for the lean3 behavior with<code>set_option hygiene false in</code>\"?</p>",
        "id": 448828394,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1720007702
    },
    {
        "content": "<p>In Lean you could put notations inside structure definitions.</p>",
        "id": 448840126,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1720010907
    }
]