[
    {
        "content": "<p>I'm playing around with group actions and I've hit a problem where I'm trying to prove that for an additive action <code>+ᵥ</code>, we have <code>0 +ᵥ x=x</code>.</p>\n<p>Here's what I've attempted so far:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AddAction</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">vadd</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"n\">zero_vadd</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"c1\">-- ⊢ 0 +ᵥ x = x</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"o\">[</span><span class=\"n\">vadd</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"c1\">-- unknown identifier 'vadd'</span>\n<span class=\"w\">  </span><span class=\"n\">add_vadd</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>How do I actually use the definition of <code>vadd</code> to rewrite the goal into <code>0+x=x</code>?</p>\n<p>(I'm trying to do this for a slightly more complicated group action)</p>\n<p>Thanks!</p>",
        "id": 513063729,
        "sender_full_name": "Björn W",
        "timestamp": 1744994738
    },
    {
        "content": "<p>Well the notation is for a function called <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=HVAdd.hVAdd#doc\">docs#HVAdd.hVAdd</a></p>",
        "id": 513063967,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1744994860
    },
    {
        "content": "<p>you can use the <code>simp [· +ᵥ ·]</code> notation</p>",
        "id": 513063992,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1744994872
    },
    {
        "content": "<p><code>zero_vadd x := show (0 : </code>ℤ<code>) + x = x by simp</code> is one option</p>",
        "id": 513064053,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1744994889
    },
    {
        "content": "<p><code>simp [· +ᵥ ·]</code> seems to be closest to what I was looking for. Thanks for the other suggestions, as well.</p>",
        "id": 513064270,
        "sender_full_name": "Björn W",
        "timestamp": 1744994997
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"873766\">Björn W</span> has marked this topic as resolved.</p>",
        "id": 513064280,
        "sender_full_name": "Notification Bot",
        "timestamp": 1744995001
    },
    {
        "content": "<p>Another approach is to define <code>vadd</code>  first, then write a simp lemma <code>vadd_def</code> saying <code>vadd n x = n + x</code>, prove it with <code>rfl</code>, and then define the AddAction.</p>",
        "id": 513073632,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744999287
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"873766\">Björn W</span> <a href=\"#narrow/stream/270676-lean4/topic/.E2.9C.94.20How.20to.20expand.20definition.20within.20instance.3F/near/513064270\">said</a>:</p>\n<blockquote>\n<p><code>simp [· +ᵥ ·]</code> seems to be closest to what I was looking for. Thanks for the other suggestions, as well.</p>\n</blockquote>\n<p>Is this really legal without the parentheses!?</p>",
        "id": 513088991,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1745005804
    },
    {
        "content": "<p>I hope not (it is)</p>",
        "id": 513089813,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1745006219
    },
    {
        "content": "<p>If Mathlib defined <code>AddAction</code> to extend <code>HVAdd</code> rather than <code>VAdd</code>, this unfolding would happen automatically.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"sd\">/-- Type class for additive monoid actions. -/</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">AddAction'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddMonoid</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">HVAdd</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- Zero is a neutral element for `+ᵥ` -/</span>\n<span class=\"w\">  </span><span class=\"kn\">protected</span><span class=\"w\"> </span><span class=\"n\">zero_vadd</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+ᵥ</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">p</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- Associativity of `+` and `+ᵥ` -/</span>\n<span class=\"w\">  </span><span class=\"n\">add_vadd</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g₁</span><span class=\"w\"> </span><span class=\"n\">g₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g₁</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">g₂</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+ᵥ</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">g₁</span><span class=\"w\"> </span><span class=\"bp\">+ᵥ</span><span class=\"w\"> </span><span class=\"n\">g₂</span><span class=\"w\"> </span><span class=\"bp\">+ᵥ</span><span class=\"w\"> </span><span class=\"n\">p</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AddAction'</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">hVAdd</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"n\">zero_vadd</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"c1\">-- ⊢ ↑0 + x = x (rather than ⊢ 0 +ᵥ x = x)</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"n\">add_vadd</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 513092876,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1745007746
    },
    {
        "content": "<p>(as of Lean 4.19)</p>",
        "id": 513092909,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1745007762
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"873547\">Robin Arnez</span> <a href=\"#narrow/channel/270676-lean4/topic/.E2.9C.94.20How.20to.20expand.20definition.20within.20instance.3F/near/513063992\">said</a>:</p>\n<blockquote>\n<p>you can use the <code>simp [· +ᵥ ·]</code> notation</p>\n</blockquote>\n<p>But if my definition of <code>· +ᵥ ·</code> relies on some other <code>· +ᵥ ·</code> (usually more basic one), then this will simp too much.</p>",
        "id": 513135728,
        "sender_full_name": "Jz Pan",
        "timestamp": 1745039470
    },
    {
        "content": "<p>Then use Kevin's approach</p>",
        "id": 513139034,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1745042523
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/270676-lean4/topic/.E2.9C.94.20How.20to.20expand.20definition.20within.20instance.3F/near/513088991\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"873766\">Björn W</span> <a href=\"#narrow/stream/270676-lean4/topic/.E2.9C.94.20How.20to.20expand.20definition.20within.20instance.3F/near/513064270\">said</a>:</p>\n<blockquote>\n<p><code>simp [· +ᵥ ·]</code> seems to be closest to what I was looking for. Thanks for the other suggestions, as well.</p>\n</blockquote>\n<p>Is this really legal without the parentheses!?</p>\n</blockquote>\n<p>Sort of. It parses as is, but if you put parentheses around it it is interpreted as a lambda, i.e. <code>(by simp[· +ᵥ ·])</code> becomes <code>fun x y =&gt; by simp[x +ᵥ y]</code></p>",
        "id": 513212155,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1745102670
    },
    {
        "content": "<p>that seems unintentional; normally an unparenthesized <code>· +ᵥ ·</code> would trigger an elaborator error but because <code>simp</code> intercepts it without elaborating it exactly this error is not triggered</p>",
        "id": 513212204,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1745102727
    },
    {
        "content": "<p>Yeah, the dot function algorithm only knows to stop at parentheses.</p>\n<p>Maybe <code>by</code> should be another delimiter...</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">·</span><span class=\"o\">])</span>\n</code></pre></div>",
        "id": 513213229,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1745103679
    },
    {
        "content": "<p>Another issue with dots is that they're 'non-hygienic' in the sense that they don't record which parentheses they were written within. That let AlphaProof <a href=\"https://storage.googleapis.com/deepmind-media/DeepMind.com/Blog/imo-2024-solutions/P1/index.html\">produce</a> this oddity:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">use</span><span class=\"bp\">λ</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">=&gt;</span><span class=\"n\">y</span><span class=\"bp\">.</span><span class=\"n\">rec</span><span class=\"w\"> </span><span class=\"bp\">λ</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">=&gt;?_</span>\n</code></pre></div>\n<p>That's a dot in a binder list (!) and it's using that <code>use</code> inserts the provided syntax into a type ascription before elaborating, so this would be the same as <code>fun z =&gt; λy z x=&gt;y.rec λS p=&gt;?_</code>. (I see Eric Wieser added some syntax to mathlib to suppress dots and fixed <code>use</code>.)</p>",
        "id": 513213576,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1745104036
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/270676-lean4/topic/.E2.9C.94.20How.20to.20expand.20definition.20within.20instance.3F/near/513213229\">said</a>:</p>\n<blockquote>\n<p>Yeah, the dot function algorithm only knows to stop at parentheses.</p>\n<p>Maybe <code>by</code> should be another delimiter...</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">·</span><span class=\"o\">])</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>I've used that in real code <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 513216599,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1745107206
    }
]