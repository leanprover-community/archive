[
    {
        "content": "<p>For now <code>TermElabM</code> holds a single field:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">tacSnap?</span><span class=\"w\">         </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Language</span><span class=\"bp\">.</span><span class=\"n\">SnapshotBundle</span><span class=\"w\"> </span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">TacticParsedSnapshot</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">none</span>\n</code></pre></div>\n<p>which works only for tactics, but not for new syntax defined by user.</p>\n<p>To support state reuse of my own elaboration, I must go back to command level and extract my own snapshot from <code>CommandElabM</code>'s field</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">snap?</span><span class=\"w\">          </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Language</span><span class=\"bp\">.</span><span class=\"n\">SnapshotBundle</span><span class=\"w\"> </span><span class=\"n\">Language</span><span class=\"bp\">.</span><span class=\"n\">DynamicSnapshot</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>In summary, there are a few questions:</p>\n<ol>\n<li>Are there specific reason why <code>TermElabM</code> is coupled with the tactic level state?</li>\n<li>Are there existing plan for extending the reuse system?</li>\n<li>Why is there another field <code>tacticCache? : Option (IO.Ref Tactic.Cache)</code> in addition to <code>tacSnap?</code>? I know it's used to implement <code>save</code> tactic. But can it be replaced by <code>tacSnap</code> in general?</li>\n</ol>\n<p>If the answer to 2 is no, and the dev team is welcoming contributors, I am willing to help with this.<br>\nAbout me: I am fairly experienced in metaprogramming in Lean4 after having internship on it for bytedance in the past months. And now I have enough sophomore time to contribute.</p>",
        "id": 470923837,
        "sender_full_name": "Qiu",
        "timestamp": 1726565319
    },
    {
        "content": "<p>No, we are not currently planning on extending that. What are you trying to achieve with it?</p>",
        "id": 470953844,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1726573069
    },
    {
        "content": "<p>I was trying to make another set of \"tactics\" but with some special constraints. One of the main goals is to interleave it with by-block and so get a way to \"gradually\" transform it into a whole by-block. Sorry for some reason I can't put it clear here. But this really makes sense.</p>",
        "id": 471025934,
        "sender_full_name": "Qiu",
        "timestamp": 1726588887
    }
]