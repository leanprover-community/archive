[
    {
        "content": "<p>I had thought that any bogus proof of FLT would be spottable with <code>#print axioms</code>, but this was just pointed out to me on the Xena Discord:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">section</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">debug</span><span class=\"bp\">.</span><span class=\"n\">skipKernelTC</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"so_sorry\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">closeMainGoal</span><span class=\"w\"> </span><span class=\"ss\">`so_sorry</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">mkConst</span><span class=\"w\"> </span><span class=\"ss\">``trivial</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">so_sorry</span>\n\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">easy</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FermatLastTheorem</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">elim</span>\n\n<span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">axioms</span><span class=\"w\"> </span><span class=\"n\">easy</span><span class=\"w\"> </span><span class=\"c1\">-- 'easy' depends on axioms: [propext]</span>\n</code></pre></div>\n<p>I am surprised that <code>debug.skipKernelTC true</code> isn't \"infectious\" like <code>partial</code> or <code>native_decide</code>. This means that I cannot trust any proof, even if <code>#print axioms</code> only mentions the standard three which are allowed in mathlib/FLT? I <em>need</em> to run it through a typechecker? (which will of course spot this hack).</p>",
        "id": 507604427,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1742763060
    },
    {
        "content": "<p>See also <a class=\"stream-topic\" data-stream-id=\"113488\" href=\"/#narrow/channel/113488-general/topic/PSA.20about.20trusting.20Lean.20proofs/with/392684837\">#general &gt; PSA about trusting Lean proofs</a>, it looks to me like similar stuff is going on. That is, <code>closeMainGoal</code> is also adding a decl to the environment, and the debug option is turning off kernel-checking at that point</p>",
        "id": 507605186,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1742763568
    },
    {
        "content": "<p>I would say you should run it through a typechecker because axioms <a href=\"#narrow/channel/113488-general/topic/Code.20with.20Proofs.3A.20the.20Arena/near/482808260\">can also be redefined</a>, so even without <code>skipKernelTC</code> just checking <code>#print axioms</code> is insufficient.</p>",
        "id": 507605374,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1742763620
    },
    {
        "content": "<p>OK the message has finally sunk in :-)</p>",
        "id": 507605967,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1742763956
    },
    {
        "content": "<p>Here's an example of adding a bad declaration without using the <code>debug.skipKernelTC</code> option:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib.NumberTheory.FLT.Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">myBadTheorem</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TheoremVal</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"ss\">`bad</span>\n<span class=\"w\">  </span><span class=\"n\">levelParams</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">[]</span>\n<span class=\"w\">  </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Lean.mkConst</span><span class=\"w\"> </span><span class=\"ss\">``False</span>\n<span class=\"w\">  </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Lean.mkConst</span><span class=\"w\"> </span><span class=\"ss\">``trivial</span>\n<span class=\"w\">  </span><span class=\"n\">all</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">[]</span>\n\n<span class=\"k\">#eval</span><span class=\"w\"> </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">CoreM</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">currentEnv</span><span class=\"w\"> </span><span class=\"bp\">â†</span><span class=\"w\"> </span><span class=\"n\">getEnv</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">Lean.Kernel.Environment.addDeclWithoutChecking</span><span class=\"w\"> </span><span class=\"n\">currentEnv.toKernelEnv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">thmDecl</span><span class=\"w\"> </span><span class=\"n\">myBadTheorem</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">ok</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">setEnv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Environment.ofKernelEnv</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">throwError</span><span class=\"w\"> </span><span class=\"s2\">\"didn't work\"</span>\n\n<span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"n\">flt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FermatLastTheorem</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">bad.elim</span>\n<span class=\"k\">#print</span><span class=\"w\"> </span><span class=\"kd\">axioms</span><span class=\"w\"> </span><span class=\"n\">flt</span><span class=\"w\"> </span><span class=\"c1\">-- 'flt' depends on axioms: [propext]</span>\n</code></pre></div>",
        "id": 507606777,
        "sender_full_name": "Niels Voss",
        "timestamp": 1742764518
    },
    {
        "content": "<p>Thanks Neils (nb who was the person who brought this to my attention on Discord). Yes I had suspected that \"grep for <code>debug.skipKernelTC</code>\" would not be enough.</p>",
        "id": 507617859,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1742772883
    },
    {
        "content": "<p>We really need to make <code>lean4checker</code> a default part of the CI runs for new projects...</p>",
        "id": 507626868,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1742779494
    }
]