[
    {
        "content": "<p>Where can I read what <code>set_option backward.whnf.reducibleClassField false</code> means? I can't tell from the docstring which setting is true and which is false, nor what the default is!</p>",
        "id": 575891831,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1772061432
    },
    {
        "content": "<p>The <a href=\"https://github.com/leanprover/lean4/blob/d4b560ec4ac4431e5439565f91e73eec1ce12c37/src/Lean/Meta/WHNF.lean#L821-L837\">docstring on the option declaration itself</a> may be more helpful (the hover shows the descr):</p>\n<blockquote>\n<p>When <code>true</code>, unfolding a <code>[reducible]</code> class field at <code>TransparencyMode.reducible</code> also unfolds the associated instance projection at <code>TransparencyMode.instances</code>.</p>\n</blockquote>\n<blockquote>\n<p><strong>Motivation:</strong> Consider <code>a ≤ b</code> where <code>a b : Nat</code> and <code>LE.le</code> is <code>[reducible]</code>. Unfolding <code>LE.le</code> gives <code>instLENat.1 a b</code>, which is stuck because <code>instLENat</code> is <code>[implicit_reducible]</code> (not <code>[reducible]</code>). Similarly, <code>stM m (ExceptT ε m) α</code> unfolds to an instance projection that is stuck at <code>.reducible</code>. Without this option, marking a class field as <code>[reducible]</code> is pointless when the instance providing it is only <code>[implicit_reducible]</code>. This option makes the <code>[reducible]</code> annotation on class fields work as the user expects by temporarily bumping to <code>.instances</code> for the projection.</p>\n</blockquote>\n<blockquote>\n<p>See <code>unfoldDefault</code> for the implementation.</p>\n</blockquote>\n<p>(the default value seems to be <code>true</code>? I don't believe it's overridden in mathlib's lakefile)</p>",
        "id": 575892927,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1772061916
    },
    {
        "content": "<p>I've always found it a bit weird how there are both docstrings and descrs for options; was there ever discussion about merging them?</p>",
        "id": 575893422,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1772062178
    },
    {
        "content": "<p>(We should move this discussion to a new topic <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span>) I'd be in favor of merging them! I've never understood the reason they're separate either.</p>",
        "id": 575893668,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1772062273
    },
    {
        "content": "<p>4 messages were moved here from <a class=\"stream-topic\" data-stream-id=\"345428\" href=\"/#narrow/channel/345428-mathlib-reviewers/topic/requests.20for.20speedy.20review.2Fdelegation/with/575890970\">#mathlib reviewers &gt; requests for speedy review/delegation</a> by <span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span>.</p>",
        "id": 575897271,
        "sender_full_name": "Notification Bot",
        "timestamp": 1772063968
    },
    {
        "content": "<p>Interestingly, the server <a href=\"https://github.com/leanprover/lean4/blob/d4b560ec4ac4431e5439565f91e73eec1ce12c37/src/Lean/Server/InfoUtils.lean#L337-L342\">first looks for a docstring</a>, then falls back to the <code>descr</code>. This means that you have the full docstring as hover in the following, but you lose it if you comment out <code>import Lean</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"c1\">-- comment out</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">backward</span><span class=\"bp\">.</span><span class=\"n\">whnf</span><span class=\"bp\">.</span><span class=\"n\">reducibleClassField</span><span class=\"w\"> </span><span class=\"n\">true</span>\n</code></pre></div>\n<p>This seems a bit inconsistent...it would be nice to have the same hover everywhere! At first I thought this might also be an issue for non-core options due to module system changes, but there's actually a different issue there: <a href=\"#narrow/channel/270676-lean4/topic/Language.20server.20allows.20.60set_option.60s.20that.20.60lake.60.20doesn't\">#lean4 &gt; Language server allows &#96;set_option&#96;s that &#96;lake&#96; doesn't</a> </p>\n<p>However, the <code>descr</code> is also used for preview text during autocomplete (and the docstring isn't). Maybe that's its true role? It makes sense for that to be more minimal.</p>\n<p>I would be in favor of making sure the hover is the same everywhere for builtin options somehow, if it's not an insurmountable technical challenge, and clarifying that the <code>descr</code> field is only intended for \"what is seen in autocomplete hints\", if true.</p>",
        "id": 575901366,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1772066039
    }
]