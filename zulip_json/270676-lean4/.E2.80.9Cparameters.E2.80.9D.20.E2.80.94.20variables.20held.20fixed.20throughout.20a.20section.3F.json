[
    {
        "content": "<p>Is there a Lean 4 command or idiom equivalent to ‚Äúparameters‚Äù from Lean 3 as described <a href=\"https://leanprover.github.io/reference/other_commands.html#sections\">here</a> ‚Äî that is, something like section variables, but held fixed until the end of the section, rather than generalised immediately for each declaration?</p>",
        "id": 506531607,
        "sender_full_name": "Peter LeFanu Lumsdaine",
        "timestamp": 1742316644
    },
    {
        "content": "<p>see <a href=\"#narrow/channel/113489-new-members/topic/.60parameter.60.20in.20Lean.204.3F\">#new members &gt; &#96;parameter&#96; in Lean 4?</a></p>",
        "id": 506533481,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1742317179
    },
    {
        "content": "<p>Thanks, and apologies for channel pollution ‚Äî had misremembered the topic scope of this channel vs mathlib4.</p>",
        "id": 506533984,
        "sender_full_name": "Peter LeFanu Lumsdaine",
        "timestamp": 1742317334
    },
    {
        "content": "<p>I think that question is reasonable for this channel, since it's about a core lean feature which was removed</p>",
        "id": 506534332,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1742317448
    },
    {
        "content": "<p>(I think Yael's <span aria-label=\"-1\" class=\"emoji emoji-1f44e\" role=\"img\" title=\"-1\">:-1:</span> is just saying \"no it does not exist\" rather than \"this is a bad question\")</p>",
        "id": 506534550,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1742317524
    },
    {
        "content": "<p>I think this has not been pursued, because we don't really like them in Mathlib: we want to make sure that the interface of a file is good, even after the section is closed and the parameters have been generalized.</p>\n<p>This is a feature that would be useful in many places outside Mathlib. It is hard to implement, though: both in Lean 2 and Lean 3 the implementation was a hack, by basically registering each new declaration name as an abbreviation for the \"real\" declaration (with the parameters as arguments) applied to the parameters. The problem was that all other features (i.e. tactics) have to also be made aware of this hack, which was not always the case, causing issues.</p>\n<p>As a workaround, you can make a class with a field for each of your desired parameters, e.g. like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">MyParameters</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">parameter1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"w\">  </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span>\n<span class=\"w\">  </span><span class=\"n\">parameter2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">MyParameters</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">parameter1</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"n\">parameter2</span><span class=\"o\">)</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MyParameters</span><span class=\"o\">]</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">parameter1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">parameter1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">parameter2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">parameter2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">parameter2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">parameter2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n</code></pre></div>\n<p>I use this in the Carleson project with a class <a href=\"https://florisvandoorn.com/carleson/docs/find/?pattern=ProofData#doc\">carleson#ProofData</a> with a bunch of information shared throughout most of the proof. There, my class also has some arguments, in particular a type argument used to find the \"right\" instance, even though I only have 1 instance ever. <br>\nI only now realize that this class doesn't in fact need any arguments... <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span> (kudos to the devs that both type-class inference and variable-insertion works as I hoped for classes without arguments!)</p>",
        "id": 506550553,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1742322141
    },
    {
        "content": "<p>Yep, I also mention nullary typeclasses in the linked previous discussion</p>",
        "id": 506554294,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1742323403
    },
    {
        "content": "<p>A more recent example where I used this trick for doing parameters is in the equational theories project, see <a class=\"message-link\" href=\"/#narrow/channel/270676-lean4/topic/Have.20to.20keep.20passing.20same.20variable.20as.20inputs/near/486321700\">#lean4 &gt; Have to keep passing same variable as inputs @ üí¨</a> (another thread with basically the same discussion). In the end it actually turned out fairly clean, no need for using <code>@</code> to get a theorem which uses things from the section from outside</p>",
        "id": 506555284,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1742323662
    },
    {
        "content": "<p>it works because in lean 4 you can just construct one of these classes in a <code>let</code> binding and then it will be available for typeclass inference</p>",
        "id": 506555522,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1742323732
    }
]