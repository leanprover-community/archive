[
    {
        "content": "<p>There are some functions where there's a <code>Prop</code>-type argument, and it should pretty much <em>always</em> be shown by the pretty printer by default. For instance, if I have two positive semidefinite matrices A and B (and the proofs that they are, are <code>hA</code> and <code>hB</code>), and now I'm talking about the expression <code>sqrt A + sqrt B</code>, I will actually have things in my goal of the form <code>Matrix.PosSemidef.add (Matrix.PosSemidef.sqrt hA) (Matrix.PosSemidef.sqrt hB)</code>. More succinctly, the \"expression\" is really <code>hA.sqrt.add hB.sqrt</code>. But this gets pretty-printed as <code>⋯.add ⋯</code>. </p>\n<p>This is a problem with pretty much all of the <code>IsHermitian</code> and <code>PosSemidef</code> API: the expressions you're working with, you don't see the <em>expressions</em>, you just see the proofs, and if you want to keep a useful infoview you need to write a really oddly structured proof.</p>\n<p>I guess I'd hope that one of two things would be possible:</p>\n<ul>\n<li>Mark the <code>hA</code> and <code>hB</code> arguments in <code>Matrix.PosSemidef.add</code> as \"display in the pretty printer by default\". Ideally this would act like <code>pp.proofs.withType</code> but just for that one argument.</li>\n<li>Some sort of custom delaborator, so that it renders as just <code>(sqrt A + sqrt B).PSD</code> or something similar. I know approximately zero about delaborators so I don't even know if this is the right kind of question.</li>\n</ul>",
        "id": 493965205,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1736958077
    },
    {
        "content": "<p>Here's an illustration of the kind of problem I mean:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">LinearAlgebra</span><span class=\"bp\">.</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">PosDef</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Classical</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">IsHermitian</span><span class=\"bp\">.</span><span class=\"n\">smul_real</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hA</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">.</span><span class=\"n\">IsHermitian</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">IsHermitian</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n\n<span class=\"sd\">/-- Claim: each eigenvalue of (A+B)/2 is at most than the average of the largest eigenvalues of A and B. -/</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">eigenvalue_mixing</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hA</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">.</span><span class=\"n\">PosSemidef</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hB</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"bp\">.</span><span class=\"n\">PosSemidef</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">hA</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">.</span><span class=\"n\">smul_real</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hB</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">.</span><span class=\"n\">smul_real</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">)))</span><span class=\"bp\">.</span><span class=\"n\">eigenvalues</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">≤</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"bp\">⨆</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hA</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">.</span><span class=\"n\">eigenvalues</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">)</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">⨆</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hB</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">.</span><span class=\"n\">eigenvalues</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">)</span><span class=\"bp\">/</span><span class=\"mi\">2</span>\n<span class=\"w\">     </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>That goal now renders as</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"bp\">⋯.</span><span class=\"n\">eigenvalues</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">⨆</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">⋯.</span><span class=\"n\">eigenvalues</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">⨆</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">⋯.</span><span class=\"n\">eigenvalues</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n</code></pre></div>\n<p>which is pretty useless to read!</p>",
        "id": 493967193,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1736958612
    },
    {
        "content": "<p>The question is legitimate, but I’m surprised the API doesn’t define those functions on all matrices (with junk values in irrelevant cases).</p>",
        "id": 493974834,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736960383
    },
    {
        "content": "<p>I would really expect to see <code>A.eigenvalues i</code> here, defined as <code>0</code> when it doesn’t make sense.</p>",
        "id": 493975104,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736960448
    },
    {
        "content": "<p>Yeah. It does make me really appreciate why e.g. <code>x / y</code> doesn't require a proof that <code>y ≠ 0</code>. (Besides the pretty-printing, it makes doing rewrites much more annoying, because there is a constant bunch of proof terms that are equal, but still creates blockages.)</p>",
        "id": 493977045,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1736961091
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/channel/270676-lean4/topic/Force.20visibility.20of.20certain.20proof.20terms/near/493974834\">said</a>:</p>\n<blockquote>\n<p>The question is legitimate, but I’m surprised the API doesn’t define those functions on all matrices (with junk values in irrelevant cases).</p>\n</blockquote>\n<p>I've used this API a bit. I didn't find it too painful, but I also didn't do terribly much with it. Certainly it would be a pain if you need to rewrite <code>A</code>.</p>",
        "id": 494003334,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1736970284
    }
]