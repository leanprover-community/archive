[
    {
        "content": "<p>I was wondering how the fields of <code>LocalContext</code>—<code>fvarIdToDecl</code> and <code>decls</code>—were related.</p>\n<p>My guess would be that <code>decls</code> is semi-redundant with <code>fvarIdToDecl</code>, but keeps track of the order given that it's an array—that is, the list of values of <code>lctx.fvarIdToDecl</code> should be exactly the same as <code>lctx.decls.reduceOption.toList</code> up to order. (My second guess would be that <code>decls</code> potentially holds only a subset of the values in <code>fvarIdToDecl</code>.)</p>\n<p>In this view, I'd also expect that each assignment in <code>fvarIdToDecl : PersistentHashMap FVarId LocalDecl</code> is of the form <code>fvarId0</code> ↦ <code>cdecl _ fvarId0 ..</code> or <code>fvarId0</code> ↦ <code>ldecl _ fvarId0 ..</code>—that is, each fvarId is assigned to an l- or cdecl which holds the same fvarId. I'd also expect it to be the case that the <code>index</code> is always the position in <code>lctx.decls.reduceOption</code>.</p>\n<p>Is this indeed how it works? Context: I want to compare LocalContexts, and want to know if I can rely on these coincidences so that I can make fewer component comparisons. :)</p>",
        "id": 373617050,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1688882557
    },
    {
        "content": "<p>Afaiu <code>fvarIdToDecl</code> is just a cache for <code>decls</code> (allowing efficient lookup by <code>FVarId</code>). So your invariants should hold.</p>",
        "id": 373948952,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1688993160
    }
]