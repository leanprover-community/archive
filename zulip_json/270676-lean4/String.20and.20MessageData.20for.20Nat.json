[
    {
        "content": "<p>I was a little surprised that the code below does not work.  Should I have expected it not to work?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Command</span>\n\n<span class=\"n\">run_cmd</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">con</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\">  </span><span class=\"c1\">-- works with `let con : Nat := 0`</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">con</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">con</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\">  </span><span class=\"c1\">-- this line is just for show, it can be removed and the issue persists</span>\n<span class=\"w\">  </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"Step {con}\"</span><span class=\"w\">  </span><span class=\"c1\">-- comment this line and everything works</span>\n\n<span class=\"n\">run_cmd</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">mut</span><span class=\"w\"> </span><span class=\"n\">con</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\">  </span><span class=\"c1\">-- works with `let mut con : Nat := 0`</span>\n<span class=\"w\">  </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">[:</span><span class=\"mi\">1</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"n\">con</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">con</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\">  </span><span class=\"c1\">-- this line is just for show, it can be removed and the issue persists</span>\n<span class=\"w\">    </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"Step {con}\"</span><span class=\"w\">  </span><span class=\"c1\">-- comment this line and everything works</span>\n<span class=\"w\">    </span><span class=\"n\">continue</span>\n</code></pre></div>",
        "id": 500105798,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1739778697
    },
    {
        "content": "<p>This is because of a few quirks in how things work here:</p>\n<ol>\n<li>It sees <code>{con}</code> here, so first thing it thinks is that <code>con</code> must be a <code>MessageData</code></li>\n<li>It ends up with <code>let con : MessageData := con + 1</code> which is not possible<br>\nA type annotation or using <code>{con.repr}</code> fixes this issue because then you tell it that it can't be <code>MessageData</code> and it should try to convert it to a string first.</li>\n</ol>",
        "id": 500108457,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1739779491
    },
    {
        "content": "<p>Still, this feels like it should be able to figure it out itself, seems to just be a quirk of the implementation.</p>",
        "id": 500108896,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1739779642
    },
    {
        "content": "<p>I think that is sees <code>m!\"...{con}\"</code> first, so it tries a <code>MessageData</code>: it works if you try to produce an interpolated string via <code>s!</code>.</p>",
        "id": 500109130,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1739779692
    },
    {
        "content": "<p>I was more curious of whether this is expected behaviour: it seems like a pretty common thing to do to have a counter that you increase and you print it.</p>",
        "id": 500109250,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1739779727
    },
    {
        "content": "<p>I don't think this is really expected behavior but adding a type annotation is simple enough that it doesn't really matter.</p>",
        "id": 500109438,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1739779797
    }
]