[
    {
        "content": "<p>What am I doing wrong here?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Std</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">PRange</span><span class=\"bp\">.</span><span class=\"n\">UpwardEnumerable</span><span class=\"w\"> </span><span class=\"n\">UInt32</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">succ?</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">silly</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Id</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mf\">0.</span><span class=\"bp\">..</span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"n\">xD800</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt32</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">iter</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">false</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">silly'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Id</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mf\">0.</span><span class=\"bp\">..</span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"n\">xD800</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt32</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">iter</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">false</span>\n</code></pre></div>\n<p>both fail to synthesize the instance needed for the <code>for</code> construct</p>",
        "id": 538065568,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757237102
    },
    {
        "content": "<p>Not sure, but you may be missing an instance ? i see many in the <code>Nat</code> implementation :<br>\n<a href=\"https://github.com/leanprover/lean4/blob/master/src/Init/Data/Range/Polymorphic/Nat.lean\">https://github.com/leanprover/lean4/blob/master/src/Init/Data/Range/Polymorphic/Nat.lean</a></p>",
        "id": 538067880,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1757239714
    },
    {
        "content": "<p>The ForIn impl seems to require a ton of them :<br>\n<a href=\"https://github.com/leanprover/lean4/blob/master/src/Init/Data/Range/Polymorphic/Iterators.lean#L95\">https://github.com/leanprover/lean4/blob/master/src/Init/Data/Range/Polymorphic/Iterators.lean#L95</a></p>",
        "id": 538068524,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1757240347
    },
    {
        "content": "<p>Indeed. The generality of the polymorphic ranges unfortunately requires a host of type classes. (I'm planning to write a manual entry for iterators/ranges, but it's not there yet.)</p>",
        "id": 538108123,
        "sender_full_name": "Paul Reichert",
        "timestamp": 1757282504
    },
    {
        "content": "<p>It looks like the version at head has changed quite a lot since the one in 4.22.0, so perhaps I should wait before trying to do this for UInt32 (for which the motivation was <a href=\"https://github.com/leanprover-community/batteries/pull/1344\">batteries#1344</a>)</p>",
        "id": 538108739,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757283295
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"221653\">Paul Reichert</span> <a href=\"#narrow/channel/270676-lean4/topic/Iterating.20ranges.20with.20PRange/near/538108123\">said</a>:</p>\n<blockquote>\n<p>The generality of the polymorphic ranges unfortunately requires a host of type classes</p>\n</blockquote>\n<p>In fairness I should have expected the <code>for h : i in</code> version to require a handful of lawfulness typeclasses.</p>",
        "id": 538108793,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757283376
    },
    {
        "content": "<p>Maybe for number types we could have a common generic implementation (or at least common helpers if genericity is not possible), so that it would not require everyone to implement their own Lawfulness typeclasses ?</p>",
        "id": 538137123,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1757310700
    },
    {
        "content": "<p>Range instances for <code>(U)Int*</code> are also something I certainly want to provide in the standard library. Here's the <code>UInt</code> part: <a href=\"https://github.com/leanprover/lean4/pull/10303\">lean4#10303</a></p>\n<p><span class=\"user-mention\" data-user-id=\"942100\">@ecyrbe</span> What do you mean by number types -- the types from the standard library (<code>SInt*</code>, <code>UInt*</code>, <code>Fin</code>, <code>Int</code>, <code>Nat</code>, ...), types from Batteries/Mathlib or custom types?</p>",
        "id": 538218335,
        "sender_full_name": "Paul Reichert",
        "timestamp": 1757336173
    },
    {
        "content": "<p>yes, the ones from standard library</p>",
        "id": 538311322,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1757363931
    }
]