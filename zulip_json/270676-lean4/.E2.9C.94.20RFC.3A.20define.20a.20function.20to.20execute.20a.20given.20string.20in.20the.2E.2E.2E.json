[
    {
        "content": "<p>How about defining a function like the following as a standard? I am ready to submit a PR.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">runCmd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">input</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">cmdList</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">input</span><span class=\"bp\">.</span><span class=\"n\">splitOn</span><span class=\"w\"> </span><span class=\"s2\">\" \"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">cmdList</span><span class=\"bp\">.</span><span class=\"n\">head!</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">cmdList</span><span class=\"bp\">.</span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toArray</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">Process</span><span class=\"bp\">.</span><span class=\"n\">output</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">cmd</span>\n<span class=\"w\">    </span><span class=\"n\">args</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">args</span>\n<span class=\"w\">  </span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"bp\">.</span><span class=\"n\">exitCode</span><span class=\"w\"> </span><span class=\"bp\">!=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">eprintln</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"bp\">.</span><span class=\"n\">stderr</span>\n<span class=\"w\">    </span><span class=\"n\">throw</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">userError</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"Failed to execute: {input}\"</span>\n<span class=\"w\">  </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"n\">out</span><span class=\"bp\">.</span><span class=\"n\">stdout</span><span class=\"bp\">.</span><span class=\"n\">isEmpty</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"bp\">.</span><span class=\"n\">stdout</span>\n</code></pre></div>\n<p>- <strong>User Experience</strong>: I define this function in the lakefile every time to write build scripts. There are probably others besides me who wish there were such functions in the standard library.</p>\n<p>- <strong>Beneficiaries</strong>: Lean libraries defining a custom build script.</p>",
        "id": 490273346,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1734763286
    },
    {
        "content": "<p>There are a million variations of this that someone might want. I think the composable components are already there? I'm unconvinced that opinionated specialisations are useful.</p>",
        "id": 490275838,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1734765792
    },
    {
        "content": "<p>In any case, I don't think we want piecemeal additions at this point to the <code>IO.Process</code> library. Building this out should be done (if at all) as a coherent project. (Or, of course, as external libraries, where you can do whatever you like!)</p>",
        "id": 490275972,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1734765936
    },
    {
        "content": "<p>Note that the function as implemented in this thread is incorrect, <code>runCmd \"binary \\\"argument with spaces\\\"\"</code> is not handled as it would be in the shell</p>",
        "id": 490284850,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1734774910
    },
    {
        "content": "<p>Nor does <code>runCmd \"echo foo | grep f\"</code> work; I think you should reconsider what you think \"run in the shell\" means, because it's certainly not what you wrote above! <code>{ cmd := \"bash\", args := #[\"-c\", shell_script] }</code> is perhaps closer, but this doesn't work on Windows where the shell is different.</p>",
        "id": 490285095,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1734775133
    },
    {
        "content": "<p><span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 490297464,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1734786475
    },
    {
        "content": "<p>‘Running it on the shell’ may not have been what I wanted to do.</p>",
        "id": 490297689,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1734786620
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"626349\">Asei Inoue</span> has marked this topic as resolved.</p>",
        "id": 490297702,
        "sender_full_name": "Notification Bot",
        "timestamp": 1734786633
    }
]