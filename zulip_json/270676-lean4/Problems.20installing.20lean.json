[
    {
        "content": "<p>I am hoping to use lean to show the equivalence between a connection on a principal bundle and the Yang-Mills field (the pullback via a section on to the base manifold) but I can't even install lean. I've followed the instructions here <a href=\"https://leanprover-community.github.io/install/project.html\">https://leanprover-community.github.io/install/project.html</a> but get</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">[</span><span class=\"n\">nix</span><span class=\"bp\">-</span><span class=\"n\">shell</span><span class=\"o\">:</span><span class=\"bp\">~/</span><span class=\"n\">Dropbox</span><span class=\"bp\">/</span><span class=\"n\">Tidy</span><span class=\"bp\">/</span><span class=\"n\">DifferentialGeometry</span><span class=\"bp\">/</span><span class=\"n\">mathematics_in_lean</span><span class=\"o\">]</span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span>\n<span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"n\">lakefile</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">10</span><span class=\"o\">:</span><span class=\"mi\">7</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unexpected</span><span class=\"w\"> </span><span class=\"n\">token</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">identifier</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"n\">lakefile</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">11</span><span class=\"o\">:</span><span class=\"mi\">7</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unexpected</span><span class=\"w\"> </span><span class=\"n\">token</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">identifier</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"n\">lakefile</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">12</span><span class=\"o\">:</span><span class=\"mi\">7</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unexpected</span><span class=\"w\"> </span><span class=\"n\">token</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">identifier</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"n\">lakefile</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">13</span><span class=\"o\">:</span><span class=\"mi\">7</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unexpected</span><span class=\"w\"> </span><span class=\"n\">token</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">identifier</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"n\">lakefile</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">14</span><span class=\"o\">:</span><span class=\"mi\">7</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unexpected</span><span class=\"w\"> </span><span class=\"n\">token</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">identifier</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"n\">lakefile</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">configuration</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">errors</span>\n</code></pre></div>",
        "id": 469122842,
        "sender_full_name": "Dominic Steinitz",
        "timestamp": 1725980615
    },
    {
        "content": "<p>(Welcome.) Which were the instructions you followed for installing Lean itself? That page is for \"step 2\". Were they <a href=\"https://leanprover-community.github.io/install/linux.html\">https://leanprover-community.github.io/install/linux.html</a>, or did you follow something nixOS specific? Also can you show us what <code>lake --version</code> says in that directory?</p>",
        "id": 469123987,
        "sender_full_name": "Julian Berman",
        "timestamp": 1725980786
    },
    {
        "content": "<p>I believe this happens if the version of Lean in your local repo does not match the one in Mathlib.  Try making sure that your local <code>lean-toolchain</code> file in the root of your repository matches that of <a href=\"https://github.com/leanprover-community/mathlib4/blob/master/lean-toolchain\">https://github.com/leanprover-community/mathlib4/blob/master/lean-toolchain</a> (for your version of Mathlib that you have in <code>lakefile.lean</code>).  There is some more documentation here: <a href=\"https://github.com/leanprover-community/mathlib4/wiki/Using-mathlib4-as-a-dependency\">https://github.com/leanprover-community/mathlib4/wiki/Using-mathlib4-as-a-dependency</a>.</p>",
        "id": 469124092,
        "sender_full_name": "Yann Herklotz",
        "timestamp": 1725980803
    },
    {
        "content": "<p>Dominic has cloned the <a href=\"https://leanprover-community.github.io/mathematics_in_lean/\">#mil</a> repo it would seem, so I think you're right that it means the version doesn't match, but the fix is very unlikely to be changing the <code>lean-toolchain</code> file unless the plan really is to work on MIL (which it sounds like it isn't, it's just a test project?). The fix will likely be that Dominic should be following the instructions saying to install elan :)</p>",
        "id": 469126731,
        "sender_full_name": "Julian Berman",
        "timestamp": 1725981370
    },
    {
        "content": "<p>Ah OK I wasn't familiar with <a href=\"https://leanprover-community.github.io/mathematics_in_lean/\">#mil</a>, and I see now that it's a nix shell!  So yes installing elan first and then it should pick up the right version from the <a href=\"https://leanprover-community.github.io/mathematics_in_lean/\">#mil</a> repo (or one can create a new repo).</p>",
        "id": 469127651,
        "sender_full_name": "Yann Herklotz",
        "timestamp": 1725981635
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">[</span><span class=\"n\">nix</span><span class=\"bp\">-</span><span class=\"n\">shell</span><span class=\"o\">:</span><span class=\"bp\">~/</span><span class=\"n\">Dropbox</span><span class=\"bp\">/</span><span class=\"n\">Tidy</span><span class=\"bp\">/</span><span class=\"n\">DifferentialGeometry</span><span class=\"bp\">/</span><span class=\"n\">mathematics_in_lean</span><span class=\"o\">]</span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"c1\">--version</span>\n<span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"c1\">--version</span>\n<span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"mf\">5.0</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">9</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"mf\">4.9</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 469129635,
        "sender_full_name": "Dominic Steinitz",
        "timestamp": 1725982105
    },
    {
        "content": "<p>Should I not have run <code>nix-shell -p lean4</code>? I just wanted to try lean before committing to a more permanent installation.</p>",
        "id": 469129826,
        "sender_full_name": "Dominic Steinitz",
        "timestamp": 1725982172
    },
    {
        "content": "<p>Mathlib and <a href=\"https://leanprover-community.github.io/mathematics_in_lean/\">#mil</a> seem to require Lean 4.12.0-rc1.  Lean changes quite a lot with each version, and using something like <code>elan</code> will automatically use the right version for the project.  It should be easy to uninstall as well, I believe it is just installed under <code>~/.elan</code>, so removing that directory will remove lean.</p>",
        "id": 469130178,
        "sender_full_name": "Yann Herklotz",
        "timestamp": 1725982270
    },
    {
        "content": "<p>I am afraid the general answer is that nixOS isn’t supported. You can search for many previous discussions about this, and they are always very painful.</p>",
        "id": 469130208,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1725982278
    },
    {
        "content": "<p>More generally, refusing to use <code>elan</code> is not supported. There are simply not enough resources to  support such requirements.</p>",
        "id": 469130372,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1725982315
    },
    {
        "content": "<p>:-( homebrew did not seem to work either</p>",
        "id": 469130459,
        "sender_full_name": "Dominic Steinitz",
        "timestamp": 1725982330
    },
    {
        "content": "<p>Using elan from NixOS is absolutely supported, but using <code>lean4</code> from it directly is not recommended for these reasons</p>",
        "id": 469130938,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1725982455
    },
    {
        "content": "<p>It’s the same issue. There is a one line installation procedure explained at <a href=\"https://leanprover-community.github.io/install/macos.html\">https://leanprover-community.github.io/install/macos.html</a>. You are free to insist on using homebrew, but you are on your own. This isn’t a moral judgement at  all, we have a lot to do and not enough time to support non-recommended setups.</p>",
        "id": 469131038,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1725982477
    },
    {
        "content": "<blockquote>\n<p>Here we will discuss the fast way, assuming a lot of trust from you.</p>\n</blockquote>\n<p>I will hold back for now but thanks very much for the help and support :-)</p>",
        "id": 469131097,
        "sender_full_name": "Dominic Steinitz",
        "timestamp": 1725982493
    },
    {
        "content": "<p>Note you don’t have to trust us, you can also inspect <a href=\"https://raw.githubusercontent.com/leanprover-community/mathlib4/master/scripts/install_macos.sh\">https://raw.githubusercontent.com/leanprover-community/mathlib4/master/scripts/install_macos.sh</a> before running it.</p>",
        "id": 469131267,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1725982547
    },
    {
        "content": "<p>and recursively inspect <a href=\"https://raw.githubusercontent.com/leanprover/elan/master/elan-init.sh\">https://raw.githubusercontent.com/leanprover/elan/master/elan-init.sh</a></p>",
        "id": 469131438,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1725982586
    },
    {
        "content": "<p>I don't trust myself is the problem. I will go and look at the script.</p>",
        "id": 469131615,
        "sender_full_name": "Dominic Steinitz",
        "timestamp": 1725982639
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110024\">Sebastian Ullrich</span> <a href=\"#narrow/stream/270676-lean4/topic/Problems.20installing.20lean/near/469130938\">said</a>:</p>\n<blockquote>\n<p>Using elan from NixOS is absolutely supported, but using <code>lean4</code> from it directly is not recommended for these reasons</p>\n</blockquote>\n<p>i.e. just run <code>nix-shell -p elan</code> and <code>lake exe cache get</code> should work fine in the resulting shell</p>",
        "id": 469690972,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1726151134
    },
    {
        "content": "<p>(although I don't use nix on Darwin, so I can't be sure)</p>",
        "id": 469691198,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1726151186
    },
    {
        "content": "<p>Thank you all - in the end I installed using the one line installation procedure and it now appears to be working via emacs.</p>",
        "id": 469701459,
        "sender_full_name": "Dominic Steinitz",
        "timestamp": 1726153359
    }
]