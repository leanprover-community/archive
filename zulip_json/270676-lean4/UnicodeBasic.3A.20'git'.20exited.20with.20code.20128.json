[
    {
        "content": "<p>If I <code>lake init</code> a new project at <code>v4.26.0-rc2</code> with this lakefile.toml:</p>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"test-lake\"</span>\n<span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"0.1.0\"</span>\n<span class=\"n\">defaultTargets</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"test-lake\"</span><span class=\"p\">]</span>\n\n<span class=\"k\">[[lean_lib]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"TestLake\"</span>\n\n<span class=\"k\">[[require]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"«doc-gen4»\"</span>\n<span class=\"n\">git</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/leanprover/doc-gen4\"</span>\n<span class=\"n\">rev</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"v4.26.0-rc2\"</span>\n</code></pre></div>\n<p>and do <code>lake build</code>, I see this error:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>%<span class=\"w\"> </span>lake<span class=\"w\"> </span>build\ninfo:<span class=\"w\"> </span>test-lake:<span class=\"w\"> </span>no<span class=\"w\"> </span>previous<span class=\"w\"> </span>manifest,<span class=\"w\"> </span>creating<span class=\"w\"> </span>one<span class=\"w\"> </span>from<span class=\"w\"> </span>scratch\ninfo:<span class=\"w\"> </span>doc-gen4:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/leanprover/doc-gen4\ninfo:<span class=\"w\"> </span>doc-gen4:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'8b1135b818a03f16d69fb796589ebb4ad448d5ea'</span>\ninfo:<span class=\"w\"> </span>toolchain<span class=\"w\"> </span>not<span class=\"w\"> </span>updated<span class=\"p\">;</span><span class=\"w\"> </span>already<span class=\"w\"> </span>up-to-date\ninfo:<span class=\"w\"> </span>Cli:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/leanprover/lean4-cli\ninfo:<span class=\"w\"> </span>Cli:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'7e1ced9e049a4fab2508980ec4877ca9c46dffc9'</span>\ninfo:<span class=\"w\"> </span>UnicodeBasic:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/fgdorais/lean4-unicode-basic\ninfo:<span class=\"w\"> </span>UnicodeBasic:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'378b62cdf3bb90d3cd9aa12dc2be43b42bdda339'</span>\nerror:<span class=\"w\"> </span>external<span class=\"w\"> </span><span class=\"nb\">command</span><span class=\"w\"> </span><span class=\"s1\">'git'</span><span class=\"w\"> </span>exited<span class=\"w\"> </span>with<span class=\"w\"> </span>code<span class=\"w\"> </span><span class=\"m\">128</span>\n</code></pre></div>\n<p>The commit <code>378b62cdf3bb90d3cd9aa12dc2be43b42bdda339</code> appears to not exist in <a href=\"https://github.com/fgdorais/lean4-unicode-basic\">https://github.com/fgdorais/lean4-unicode-basic</a>, even though doc-gen4's lake-manifest.json <a href=\"https://github.com/leanprover/doc-gen4/blob/8b1135b818a03f16d69fb796589ebb4ad448d5ea/lake-manifest.json#L18\">points to it</a>.</p>",
        "id": 560585778,
        "sender_full_name": "David Renshaw",
        "timestamp": 1764246718
    },
    {
        "content": "<p>doc-gen4's lakefile.lean <a href=\"https://github.com/leanprover/doc-gen4/blob/8b1135b818a03f16d69fb796589ebb4ad448d5ea/lakefile.lean#L21\">points to</a> the nightly-testing branch of <a href=\"https://github.com/fgdorais/lean4-unicode-basic\">https://github.com/fgdorais/lean4-unicode-basic</a>, which should work fine.</p>",
        "id": 560586106,
        "sender_full_name": "David Renshaw",
        "timestamp": 1764246829
    },
    {
        "content": "<p>So I guess the problem here is that my <code>lake build</code> is using doc-gen4's broken lake-manifest.json.<br>\nThis is surprising to me, as I was under the impression that a library's lake-manifest.json is not visible to projects that depend on the library. (I believe that's how Cargo.lock works in Rust land.)</p>",
        "id": 560586909,
        "sender_full_name": "David Renshaw",
        "timestamp": 1764247058
    },
    {
        "content": "<p>This problem has broken our CI build on Noperthedron: <a href=\"https://github.com/jcreedcmu/Noperthedron/actions/runs/19719146140\">https://github.com/jcreedcmu/Noperthedron/actions/runs/19719146140</a></p>",
        "id": 560587636,
        "sender_full_name": "David Renshaw",
        "timestamp": 1764247284
    },
    {
        "content": "<p>I have the same error in various projects</p>",
        "id": 560588535,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1764247556
    },
    {
        "content": "<p>No idea how to solve it</p>",
        "id": 560588556,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1764247562
    },
    {
        "content": "<p>correction: the commit currently does exist, just not on any branch: <a href=\"https://github.com/fgdorais/lean4-unicode-basic/tree/378b62cdf3bb90d3cd9aa12dc2be43b42bdda339\">https://github.com/fgdorais/lean4-unicode-basic/tree/378b62cdf3bb90d3cd9aa12dc2be43b42bdda339</a></p>",
        "id": 560589898,
        "sender_full_name": "David Renshaw",
        "timestamp": 1764247943
    },
    {
        "content": "<p>I have updated the <code>v4.26.0-rc2</code> tag of <code>doc-gen4</code> to a new commit that should work. Please try <code>lake update</code> (or restarting CI if the error happened in <code>docgen-action</code>) and see if the build succeeds.</p>",
        "id": 560603254,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1764251692
    },
    {
        "content": "<p>It works for me, thanks!</p>",
        "id": 560612870,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1764254228
    },
    {
        "content": "<p>It works for me, too! (After a <code>lake update</code>.) Thanks!</p>",
        "id": 560627747,
        "sender_full_name": "David Renshaw",
        "timestamp": 1764258483
    },
    {
        "content": "<p>I had the same problem <a href=\"https://github.com/m4lvin/lean4-pdl/actions/runs/19833460775/job/56824979556\">here</a> and <a href=\"https://github.com/m4lvin/Gossip-in-Lean/actions/runs/19783717582/job/56687528079\">here</a> but both times could solve it with <code>lake update doc-gen4</code>.</p>\n<p>I guess the \"right thing to do\" and to avoid breakage like this would be to switch to <code>docgen-action</code>? And/or to stick with non-rc versions?</p>",
        "id": 561251709,
        "sender_full_name": "Malvin Gattinger",
        "timestamp": 1764615554
    },
    {
        "content": "<p><code>docgen-action</code> does a lot of work for you, so I would recommend you use it :) It would unfortunately not solve this specific error (but not leave you worse off either), since the action makes use of the doc-gen release corresponding with the Lean version in <code>lean-toolchain</code>.</p>\n<p>Sticking with release candidates of Lean should be okay. Because Mathlib runs under release candidates of Lean, we'll quickly see (and fix, hopefully!) any breakage.</p>",
        "id": 561384427,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1764674192
    },
    {
        "content": "<p>We are running into this issue again <a href=\"https://github.com/AmosNico/validator/actions/runs/20193776647/job/57974809146\">here</a> and would like to avoid updating the Lean or mathlib versions used in this project (for now). Is there a way to tell <code>docgen-action</code> to use a working UnicodeBasic without updating Lean? Should it suffice to pin a newer <code>docgen-action</code> version? Cc <span class=\"user-mention\" data-user-id=\"403557\">@Amos Nicodemus</span></p>",
        "id": 563693786,
        "sender_full_name": "Malvin Gattinger",
        "timestamp": 1765723852
    },
    {
        "content": "<p>I suspect that this is due to <code>doc-gen4</code> not having a <code>v4.25.2</code> tag. I have now pushed such a tag, so please try again and let me know if it is working now for your repository.</p>",
        "id": 563749486,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1765784134
    },
    {
        "content": "<p>We ended up updating to <code>v4.27.0-rc1</code> anyway, now it works.</p>",
        "id": 564654749,
        "sender_full_name": "Amos Nicodemus",
        "timestamp": 1766137429
    }
]