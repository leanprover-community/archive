[
    {
        "content": "<p>This might be very niche, but maybe somebody could help me.</p>\n<p>For the web editor, which starts <code>lean --server</code> as a process, I noticed (<a href=\"https://github.com/leanprover-community/lean4web/issues/39\">bug report</a>) that it completely ignores any <code>leanOptions</code> specified in the projects lakefile:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">leanProject</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">leanOptions</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"ss\">`pp.unicode.fun</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">]</span>\n</code></pre></div>\n<p>The reason is that the browser editor just pretends to be working on a file <code>/project/WebEditor.lean</code> but somewhere in the Lean infrastructure it's decided that the package options are not applied unless the opened file actually lies inside the correct project folder and exists physically.</p>\n<p>Is there a way to fix this and have the <code>leanOptions</code> be active in all files?</p>\n<p>I have a hacky fix here, just appending the correct paths and adding dummy files in the right places: <a href=\"https://github.com/hhu-adam/lean4monaco/pull/3\">https://github.com/hhu-adam/lean4monaco/pull/3</a> (I'm sure I can tweak it to pass Windows CI, too)</p>\n<p>Would anybody have time to look at this PR and see if you know a better approach?</p>",
        "id": 469731202,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1726160459
    },
    {
        "content": "<p>Maybe related and easier to answer: What's actually the difference between <code>lean --server</code> and <code>lake serve --</code> which one should I use?</p>\n<p>I remember we had <code>lake serve --</code> but then <span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span> and <span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span> changed it to <code>lean --server</code></p>",
        "id": 469733842,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1726161252
    },
    {
        "content": "<p>I think I inherited that from Sebastian, and assume it was done to tie down the sandbox much more, with not even <code>lake</code> running inside it.</p>",
        "id": 469734260,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1726161404
    },
    {
        "content": "<p>If it helps, I think the following is why files must lie in the correct directory for the options to take effect. </p>\n<p>The file worker calls <code>lake setup-file</code> to determine any options set in the lakefile. This is where Lake requires that files must lie in the correct directory:<br>\n<a href=\"https://github.com/leanprover/lean4/blob/master/src/lake/Lake/CLI/Serve.lean#L53-L56\">https://github.com/leanprover/lean4/blob/master/src/lake/Lake/CLI/Serve.lean#L53-L56</a><br>\n<a href=\"https://github.com/leanprover/lean4/blob/master/src/Lean/Util/Path.lean#L129-L130\">https://github.com/leanprover/lean4/blob/master/src/Lean/Util/Path.lean#L129-L130</a></p>\n<p>I don't think we can do anything about it. So either we go for your fix or the browser editor needs to be informed what the file path must be according to the directory structure of the server.</p>",
        "id": 469773966,
        "sender_full_name": "Alexander Bentkamp",
        "timestamp": 1726172557
    },
    {
        "content": "<p>Thanks for looking into it!</p>",
        "id": 469784583,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1726177051
    }
]