[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Factors</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">l10</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">]</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">primeFactorsList</span><span class=\"w\"> </span><span class=\"mi\">10</span>\n<span class=\"c1\">--[2, 5]</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">hl10</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">l10</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">primeFactorsList</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>This doesn't work in v4.19.0-rc2 anymore but it used to work in v4.12.0-rc1. Also</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">reduce</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">primeFactorsList</span><span class=\"w\"> </span><span class=\"mi\">10</span>\n</code></pre></div>\n<p>won't reduce to [2, 5] anymore. I assume the two are related? Maybe a reduced default number of iterations in reduce? Is there a way to increase it by setting some option? Or is there another simple way to complete the proof of the lemma hl10?</p>",
        "id": 516450301,
        "sender_full_name": "Mario Weitzer",
        "timestamp": 1746539351
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/15420\">#15420</a> is the eventual answer here</p>",
        "id": 516451841,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1746539751
    },
    {
        "content": "<p>Or redefining <code>primeFactorsList</code> to not use well-founded recursion</p>",
        "id": 516451971,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1746539776
    },
    {
        "content": "<p>So there is no easy way anymore to complete the proof or #reduce the term with primeFactorsList defined the way it is?</p>",
        "id": 516456221,
        "sender_full_name": "Mario Weitzer",
        "timestamp": 1746540771
    },
    {
        "content": "<p>The culprit here is <a href=\"https://github.com/leanprover/lean4/commit/41a2e9af19b88b29070542bcd71ace95cd5d64ac\">https://github.com/leanprover/lean4/commit/41a2e9af19b88b29070542bcd71ace95cd5d64ac</a> but this now \"intended\" behavior. You usually don't want to unfold functions defined by well-founded recursion. The way you could make it work again is to make <code>Nat.primeFactorsList</code> <code>@[semireducible]</code> at its definition. But the way it is, no, reducing is impossible.</p>",
        "id": 516460630,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1746541876
    },
    {
        "content": "<p>I see. And how would one complete the (supposedly easy) proof of the lemma then?</p>",
        "id": 516462146,
        "sender_full_name": "Mario Weitzer",
        "timestamp": 1746542222
    },
    {
        "content": "<p>e.g. <code>simp [Nat.primeFactorsList, Nat.minFac, Nat.minFacAux, l10]</code> although that isn't very pretty</p>",
        "id": 516464978,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1746542943
    },
    {
        "content": "<p>Another option is to locally <code>unseal</code> some definitions.</p>",
        "id": 516465144,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1746542984
    },
    {
        "content": "<p>No, see the commit above:</p>\n<blockquote>\n<p>This changes renders <code>unseal</code> ineffective for such definitions. To avoid the opaque proof, annotate the function definition with <code>@[semireducible]</code>.</p>\n</blockquote>",
        "id": 516465470,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1746543065
    },
    {
        "content": "<p>Ah, I've missed this change. Sorry.</p>",
        "id": 516465776,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1746543128
    },
    {
        "content": "<p>A bit of prettier way is <code>norm_num [Nat.primeFactorsList, l10]</code> perhaps though</p>",
        "id": 516465803,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1746543135
    },
    {
        "content": "<p>Although maybe <a href=\"https://github.com/leanprover/lean4/pull/7965\">lean4#7965</a> will make it possible to have it be <code>rfl</code> again</p>",
        "id": 516466169,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1746543222
    }
]