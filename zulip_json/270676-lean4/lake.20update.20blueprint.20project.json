[
    {
        "content": "<p>Usually when I have a working leanblueprint project and try to move it to a new version of Mathlib with <code>lake update</code>, the github action to build the project fails and I am tempted to start a whole new repo.<br>\nFor example <a href=\"https://github.com/bjoernkjoshanssen/deontic/actions/runs/20438240556/job/58724786766\">this</a> reports an error associated with pip, \"no such option: --global-option\".</p>\n<p>I'll try editing the .yml file accordingly, hopefully it works... not sure if best practice is to keep fixing old projects or starting a new one.</p>",
        "id": 565304215,
        "sender_full_name": "Bjørn Kjos-Hanssen",
        "timestamp": 1766597588
    },
    {
        "content": "<p>I recommend using the LeanBlueprint CI template featuring the new ecosystem actions</p>",
        "id": 565315553,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1766607736
    },
    {
        "content": "<p>The following <code>blueprint.yml</code> should fix the issue:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">name</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Compile</span><span class=\"w\"> </span><span class=\"n\">blueprint</span>\n\n<span class=\"n\">on</span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">push</span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">branches</span><span class=\"o\">:</span>\n<span class=\"w\">      </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">main</span>\n<span class=\"w\">  </span><span class=\"n\">pull_request</span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">branches</span><span class=\"o\">:</span>\n<span class=\"w\">      </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">main</span>\n<span class=\"w\">  </span><span class=\"n\">workflow_dispatch</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Allow</span><span class=\"w\"> </span><span class=\"n\">manual</span><span class=\"w\"> </span><span class=\"n\">triggering</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">workflow</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">GitHub</span><span class=\"w\"> </span><span class=\"n\">Actions</span><span class=\"w\"> </span><span class=\"n\">interface</span>\n\n<span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Cancel</span><span class=\"w\"> </span><span class=\"n\">previous</span><span class=\"w\"> </span><span class=\"n\">runs</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">commit</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">pushed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">same</span><span class=\"w\"> </span><span class=\"n\">PR</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">branch</span>\n<span class=\"n\">concurrency</span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">group</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"o\">{{</span><span class=\"w\"> </span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">ref</span><span class=\"w\"> </span><span class=\"o\">}}</span><span class=\"w\">  </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"n\">runs</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">ref</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">branch</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">PR</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">cancel</span><span class=\"bp\">-</span><span class=\"k\">in</span><span class=\"bp\">-</span><span class=\"n\">progress</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\">  </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Cancel</span><span class=\"w\"> </span><span class=\"n\">any</span><span class=\"w\"> </span><span class=\"n\">ongoing</span><span class=\"w\"> </span><span class=\"n\">runs</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">same</span><span class=\"w\"> </span><span class=\"n\">group</span>\n\n<span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Sets</span><span class=\"w\"> </span><span class=\"n\">permissions</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">GITHUB_TOKEN</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">allow</span><span class=\"w\"> </span><span class=\"n\">deployment</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">GitHub</span><span class=\"w\"> </span><span class=\"n\">Pages</span>\n<span class=\"n\">permissions</span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">contents</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">read</span><span class=\"w\">          </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Read</span><span class=\"w\"> </span><span class=\"n\">access</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">repository</span><span class=\"w\"> </span><span class=\"n\">contents</span>\n<span class=\"w\">  </span><span class=\"n\">pages</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">write</span><span class=\"w\">            </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Write</span><span class=\"w\"> </span><span class=\"n\">access</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">GitHub</span><span class=\"w\"> </span><span class=\"n\">Pages</span>\n<span class=\"w\">  </span><span class=\"n\">id</span><span class=\"bp\">-</span><span class=\"n\">token</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">write</span><span class=\"w\">         </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Write</span><span class=\"w\"> </span><span class=\"n\">access</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">ID</span><span class=\"w\"> </span><span class=\"n\">tokens</span>\n<span class=\"w\">  </span><span class=\"n\">issues</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">write</span><span class=\"w\">           </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Write</span><span class=\"w\"> </span><span class=\"n\">access</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">issues</span>\n<span class=\"w\">  </span><span class=\"n\">pull</span><span class=\"bp\">-</span><span class=\"n\">requests</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">write</span><span class=\"w\">    </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Write</span><span class=\"w\"> </span><span class=\"n\">access</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">pull</span><span class=\"w\"> </span><span class=\"n\">requests</span>\n\n<span class=\"n\">jobs</span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">build_project</span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">runs</span><span class=\"bp\">-</span><span class=\"n\">on</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ubuntu</span><span class=\"bp\">-</span><span class=\"n\">latest</span>\n<span class=\"w\">    </span><span class=\"n\">name</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Build</span><span class=\"w\"> </span><span class=\"n\">project</span>\n<span class=\"w\">    </span><span class=\"n\">steps</span><span class=\"o\">:</span>\n<span class=\"w\">      </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Cleanup</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">free</span><span class=\"w\"> </span><span class=\"n\">disk</span><span class=\"w\"> </span><span class=\"n\">space</span>\n<span class=\"w\">        </span><span class=\"n\">uses</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">jlumbroso</span><span class=\"bp\">/</span><span class=\"n\">free</span><span class=\"bp\">-</span><span class=\"n\">disk</span><span class=\"bp\">-</span><span class=\"n\">space</span><span class=\"bp\">@</span><span class=\"n\">main</span>\n<span class=\"w\">        </span><span class=\"k\">with</span><span class=\"o\">:</span>\n<span class=\"w\">          </span><span class=\"n\">tool</span><span class=\"bp\">-</span><span class=\"n\">cache</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"w\">          </span><span class=\"n\">android</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">saves</span><span class=\"w\"> </span><span class=\"n\">approximately</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"w\"> </span><span class=\"n\">GB</span>\n<span class=\"w\">          </span><span class=\"n\">dotnet</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"w\">          </span><span class=\"n\">haskell</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"w\">          </span><span class=\"n\">large</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"w\">          </span><span class=\"n\">docker</span><span class=\"bp\">-</span><span class=\"n\">images</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"w\">          </span><span class=\"n\">swap</span><span class=\"bp\">-</span><span class=\"n\">storage</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">false</span>\n\n<span class=\"w\">      </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Checkout</span><span class=\"w\"> </span><span class=\"n\">project</span>\n<span class=\"w\">        </span><span class=\"n\">uses</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">actions</span><span class=\"bp\">/</span><span class=\"n\">checkout</span><span class=\"bp\">@</span><span class=\"mi\">8</span><span class=\"n\">e8c483db84b4bee98b60c0593521ed34d9990e8</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">v6</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">.</span><span class=\"m\">1</span>\n<span class=\"w\">        </span><span class=\"k\">with</span><span class=\"o\">:</span>\n<span class=\"w\">          </span><span class=\"n\">fetch</span><span class=\"bp\">-</span><span class=\"n\">depth</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Fetch</span><span class=\"w\"> </span><span class=\"n\">all</span><span class=\"w\"> </span><span class=\"n\">history</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">all</span><span class=\"w\"> </span><span class=\"n\">branches</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">tags</span>\n\n<span class=\"w\">      </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Build</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">project</span>\n<span class=\"w\">        </span><span class=\"n\">uses</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">action</span><span class=\"bp\">@</span><span class=\"mi\">434</span><span class=\"n\">f25c2f80ded67bba02502ad3a86f25db50709</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"bp\">.</span><span class=\"m\">3</span><span class=\"bp\">.</span><span class=\"m\">0</span>\n<span class=\"w\">        </span><span class=\"k\">with</span><span class=\"o\">:</span>\n<span class=\"w\">          </span><span class=\"n\">use</span><span class=\"bp\">-</span><span class=\"n\">github</span><span class=\"bp\">-</span><span class=\"n\">cache</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">false</span>\n\n<span class=\"w\">      </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Compile</span><span class=\"w\"> </span><span class=\"n\">blueprint</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">documentation</span>\n<span class=\"w\">        </span><span class=\"n\">uses</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">docgen</span><span class=\"bp\">-</span><span class=\"n\">action</span><span class=\"bp\">@</span><span class=\"n\">deed0cdc44dd8e5de07a300773eb751d33e32fc8</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"mi\">2025</span><span class=\"bp\">-</span><span class=\"mi\">10</span><span class=\"bp\">-</span><span class=\"mi\">26</span>\n<span class=\"w\">        </span><span class=\"k\">with</span><span class=\"o\">:</span>\n<span class=\"w\">          </span><span class=\"n\">blueprint</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"w\">          </span><span class=\"n\">homepage</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">home_page</span>\n</code></pre></div>",
        "id": 565315766,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1766607976
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"556875\">@Pietro Monticone</span> I'm giving it a try now.</p>",
        "id": 565316361,
        "sender_full_name": "Bjørn Kjos-Hanssen",
        "timestamp": 1766608569
    },
    {
        "content": "<p>You need to remove <code>doc-gen4</code> from the <code>lakefile.toml</code> requirements too:</p>\n<div class=\"codehilite\" data-code-language=\"Diff\"><pre><span></span><code>name = \"deontic\"\nversion = \"0.1.0\"\nkeywords = [\"math\"]\ndefaultTargets = [\"Deontic\"]\n\n[leanOptions]\npp.unicode.fun = true # pretty-prints `fun a ↦ b`\nautoImplicit = false\n\n[[require]]\nname = \"mathlib\"\nscope = \"leanprover-community\"\n\n[[require]]\nname = \"checkdecls\"\ngit = \"https://github.com/PatrickMassot/checkdecls.git\"\n<span class=\"gd\">-</span>\n<span class=\"gd\">- [[require]]</span>\n<span class=\"gd\">- name = \"«doc-gen4»\"</span>\n<span class=\"gd\">- git = \"https://github.com/leanprover/doc-gen4\"</span>\n<span class=\"gd\">- rev = \"main\"</span>\n\n[[lean_lib]]\nname = \"Deontic\"\n</code></pre></div>",
        "id": 565316771,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1766608993
    },
    {
        "content": "<p>Your first version already worked actually.</p>",
        "id": 565324795,
        "sender_full_name": "Bjørn Kjos-Hanssen",
        "timestamp": 1766617823
    },
    {
        "content": "<p>Yes, but it’s better for your next <code>lake update</code> to remove an unnecessary dependency from your project config file.</p>",
        "id": 565325394,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1766618542
    },
    {
        "content": "<p>hijacking but I am still on <code>lakefile.lean</code><br>\nhow do I update to <code>lakefile.toml</code> automatically?</p>",
        "id": 565683721,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1767020436
    },
    {
        "content": "<p>The command <a href=\"https://lean-lang.org/doc/reference/latest/Build-Tools-and-Distribution/Lake/#translate-config\"><code>lake translate-config</code></a> can be used to automatically convert between the two formats.</p>",
        "id": 565686579,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1767021439
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"400289\">Artie Khovanov</span> <a href=\"#narrow/channel/270676-lean4/topic/lake.20update.20blueprint.20project/near/565683721\">said</a>:</p>\n<blockquote>\n<p>hijacking but I am still on <code>lakefile.lean</code><br>\nhow do I update to <code>lakefile.toml</code> automatically?</p>\n</blockquote>\n<p>Filing under questions I should have known to ask but never thought of</p>",
        "id": 565702245,
        "sender_full_name": "Bjørn Kjos-Hanssen",
        "timestamp": 1767029240
    }
]