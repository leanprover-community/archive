[
    {
        "content": "<p>Is there a way to navigate the Lean core library in VSCode, with Lean interpeting these files without error?</p>\n<ul>\n<li>If I am in a separate repo and open a file from Core (say <code>Lean.Expr</code>) I get the error</li>\n</ul>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>unknown package 'Std'\nYou might need to open 'c:\\Users\\Floris\\.elan\\toolchains\\leanprover--lean4---v4.13.0-rc3\\src\\lean' as a workspace in your editor\n</code></pre></div>\n<ul>\n<li>If I open that folder as a workspace, I get the same error</li>\n<li>If I checkout the Lean4-repo at the <code>v4.13.0-rc3</code> branch I get some scary errors. This also contains the output of <code>elan --show</code> (with weird errors)</li>\n</ul>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>long output</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>c:\\Users\\Floris\\projects\\lean4&gt; curl --version\ncurl 8.9.1 (Windows) libcurl/8.9.1 Schannel zlib/1.3 WinIDN\nRelease-Date: 2024-07-31\nProtocols: dict file ftp ftps http https imap imaps ipfs ipns mqtt pop3 pop3s smb smbs smtp smtps telnet tftp\nFeatures: alt-svc AsynchDNS HSTS HTTPS-proxy IDN IPv6 Kerberos Largefile libz NTLM SPNEGO SSL SSPI threadsafe Unicode UnixSockets\n\nc:\\Users\\Floris\\projects\\lean4&gt; git --version\ngit version 2.40.0.windows.1\n\nc:\\Users\\Floris\\projects\\lean4&gt; lean --version\ninfo: downloading component 'lean'\nError(Download(HttpStatus(404)), State { next_error: None, backtrace: InternalBacktrace { backtrace: None } })\nerror: could not download nonexistent lean version `lean4`\ninfo: caused by: could not download file from 'https://github.com/leanprover/lean4/releases/expanded_assets/lean4' to 'C:\\Users\\Floris\\.elan\\tmp\\uc5szft0m8kenn2g_file'\ninfo: caused by: http request returned an unsuccessful status code: 404\n=&gt; Operation failed. Exit code: 1.\nc:\\Users\\Floris\\projects\\lean4&gt; curl --version\ncurl 8.9.1 (Windows) libcurl/8.9.1 Schannel zlib/1.3 WinIDN\nRelease-Date: 2024-07-31\nProtocols: dict file ftp ftps http https imap imaps ipfs ipns mqtt pop3 pop3s smb smbs smtp smtps telnet tftp\nFeatures: alt-svc AsynchDNS HSTS HTTPS-proxy IDN IPv6 Kerberos Largefile libz NTLM SPNEGO SSL SSPI threadsafe Unicode UnixSockets\n\nc:\\Users\\Floris\\projects\\lean4&gt; git --version\ngit version 2.40.0.windows.1\n\nc:\\Users\\Floris\\projects\\lean4&gt; elan --version\nelan 3.1.1 (71ddc6633 2024-02-22)\n\nc:\\Users\\Floris\\projects\\lean4&gt; lean --version\ninfo: downloading component 'lean'\nError(Download(HttpStatus(404)), State { next_error: None, backtrace: InternalBacktrace { backtrace: None } })\nerror: could not download nonexistent lean version `lean4`\ninfo: caused by: could not download file from 'https://github.com/leanprover/lean4/releases/expanded_assets/lean4' to 'C:\\Users\\Floris\\.elan\\tmp\\mg239zxor5bhaqp8_file'\ninfo: caused by: http request returned an unsuccessful status code: 404\n=&gt; Operation failed. Exit code: 1.\nc:\\Users\\Floris\\projects\\lean4&gt; elan show\ninfo: downloading component 'lean'\n\nError(Download(HttpStatus(404)), State { next_error: None, backtrace: InternalBacktrace { backtrace: None } })\n\ninstalled toolchains\n--------------------\n\ngebner/lean4:reenableeta230506\nleanprover-community/lean:3.35.1\nleanprover-community/lean:3.44.1\nleanprover-community/lean:3.45.0\nleanprover-community/lean:3.50.3\nleanprover-community/lean:3.51.0\nleanprover-community/lean:3.51.1\nleanprover/lean4-pr-releases:pr-release-4595\nleanprover/lean4:nightly\nleanprover/lean4:nightly-2022-10-20\nleanprover/lean4:nightly-2022-12-16\nleanprover/lean4:nightly-2023-02-04\nleanprover/lean4:nightly-2023-03-09\nleanprover/lean4:nightly-2023-03-31 (default)\nleanprover/lean4:nightly-2023-04-11\nleanprover/lean4:nightly-2023-04-20\nleanprover/lean4:nightly-2023-05-06\nleanprover/lean4:nightly-2023-05-16\nleanprover/lean4:nightly-2023-05-31\nleanprover/lean4:nightly-2023-06-10\nleanprover/lean4:nightly-2023-06-20\nleanprover/lean4:nightly-2023-07-01\nleanprover/lean4:nightly-2023-07-12\nleanprover/lean4:nightly-2023-07-15\nleanprover/lean4:nightly-2023-07-29\nleanprover/lean4:nightly-2023-08-05\n\nleanprover/lean4:nightly-2023-08-19\nleanprover/lean4:nightly-2023-08-23\nleanprover/lean4:nightly-2024-03-01\nleanprover/lean4:nightly-2024-03-02\nleanprover/lean4:nightly-2024-04-24\nleanprover/lean4:nightly-2024-04-29\nleanprover/lean4:nightly-2024-04-30\nleanprover/lean4:nightly-2024-05-14\nleanprover/lean4:stable\nleanprover/lean4:v4.0.0\nleanprover/lean4:v4.0.0-rc2\nleanprover/lean4:v4.0.0-rc4\nleanprover/lean4:v4.1.0\nleanprover/lean4:v4.1.0-rc1\nleanprover/lean4:v4.10.0-rc1\nleanprover/lean4:v4.10.0-rc2\nleanprover/lean4:v4.11.0-rc1\nleanprover/lean4:v4.11.0-rc2\nleanprover/lean4:v4.12.0\nleanprover/lean4:v4.12.0-rc1\nleanprover/lean4:v4.13.0-rc1\nleanprover/lean4:v4.13.0-rc3\nleanprover/lean4:v4.2.0\nleanprover/lean4:v4.2.0-rc1\nleanprover/lean4:v4.2.0-rc2\nleanprover/lean4:v4.2.0-rc3\nleanprover/lean4:v4.2.0-rc4\nleanprover/lean4:v4.3.0\nleanprover/lean4:v4.3.0-rc1\nleanprover/lean4:v4.3.0-rc2\nleanprover/lean4:v4.4.0-rc1\nleanprover/lean4:v4.5.0-rc1\nleanprover/lean4:v4.6.0\nleanprover/lean4:v4.6.0-rc1\nleanprover/lean4:v4.7.0\nleanprover/lean4:v4.7.0-rc2\nleanprover/lean4:v4.8.0-rc1\nleanprover/lean4:v4.8.0-rc2\nleanprover/lean4:v4.9.0-rc1\nleanprover/lean4:v4.9.0-rc2\nleanprover/lean4:v4.9.0-rc3\n3.4.2\n\n\nactive toolchain\n----------------\n\n(error: could not download nonexistent lean version `lean4`, could not download file from 'https://github.com/leanprover/lean4/releases/expanded_assets/lean4' to 'C:\\Users\\Floris\\.elan\\tmp\\8j1upf5clzjvy6zx_file')\n</code></pre></div>\n</div></div>",
        "id": 478593747,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1729722658
    },
    {
        "content": "<p>(note: if I checkout the Lean 4 repo at a commit from ~1 year ago, it works just fine in VSCode)</p>",
        "id": 478594129,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1729722883
    },
    {
        "content": "<p>Oh, I guess this related to the latest release candidate, so feel free to ignore this if this is WIP. It works fine on Lean from 1 month ago.</p>",
        "id": 478595038,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1729723423
    },
    {
        "content": "<p>I think this is because when you open the lean folder, elan just uses a random lean toolchain</p>",
        "id": 478595903,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729723989
    },
    {
        "content": "<p>And so the fix is to set the default elan toolchain to the same version as the source you're looking at</p>",
        "id": 478595946,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729724023
    },
    {
        "content": "<p>I did try to look at the <code>v4.13.0-rc3</code> branch with the same default toolchain, which also didn't work.</p>\n<p>It might have to do with the fact that Core has been split into <code>Lean</code> + <code>Std</code> recently?</p>",
        "id": 478596365,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1729724318
    },
    {
        "content": "<p>Have you followed the instructions at <a href=\"https://lean-lang.org/lean4/doc/dev/index.html#dev-setup-using-elan\">https://lean-lang.org/lean4/doc/dev/index.html#dev-setup-using-elan</a></p>",
        "id": 478637807,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1729749602
    },
    {
        "content": "<p>in particular about creating the toolchains?</p>",
        "id": 478637867,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1729749613
    },
    {
        "content": "<p>I have not. I am also not trying to change Lean Core, just navigate the existing code without errors, so I was not aware that that page was relevant for me.</p>",
        "id": 478652498,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1729755906
    },
    {
        "content": "<p>When I Ctrl+click on e.g. <code>import Lean.Expr</code> in Mathlib.Lean.Expr.ReplaceRec, everything works for me and \"Lean 4: Troubleshooting: Show Setup Information\" says</p>\n<blockquote>\n<p>...<br>\n<strong>Elan</strong>: Reasonably up-to-date (version: 3.1.1)<br>\n<strong>Lean</strong>: Reasonably up-to-date (version: 4.13.0-rc3)<br>\n<strong>Project</strong>: Valid Lean project (path: /home/sebastian/.elan/toolchains/leanprover--lean4---v4.13.0-rc3/src/lean)</p>\n<p>active toolchain</p>\n<hr>\n<p>leanprover/lean4:v4.13.0-rc3 (override because inside toolchain directory '/home/sebastian/.elan/toolchains/leanprover--lean4---v4.13.0-rc3')</p>\n<p>Lean (version 4.13.0-rc3, x86_64-unknown-linux-gnu, commit 01d414ac36dc, Release)</p>\n</blockquote>",
        "id": 478658132,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1729757818
    }
]