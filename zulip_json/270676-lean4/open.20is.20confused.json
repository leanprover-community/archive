[
    {
        "content": "<p>I've found a very interesting behaviour, not sure if it's intended or not:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">51</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Foo</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">my_test</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">39</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">21</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">29</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">foo</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"c1\">-- unknown identifier 'foo'</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Foo</span>\n</code></pre></div>\n<p>Here Lean complains that it has no idea what <code>foo</code> means, until you comment out <code>Nat.my_test</code> above it!</p>",
        "id": 528744032,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752528763
    },
    {
        "content": "<p>presumably Lean saw the additional declaration <code>Foo.Nat.my_test</code> and decided that <code>open Nat</code> means <code>open Foo.Nat</code>?</p>",
        "id": 528744067,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752528784
    },
    {
        "content": "<p>(I suppose the intended solution is to replace <code>Nat.my_test</code> with instead <code>_root_.Nat.my_test</code></p>",
        "id": 528744108,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752528805
    },
    {
        "content": "<p>Odd, <code>open Nat</code> is supposed to open every <code>Nat</code> that can be opened, if I remember correctly.</p>",
        "id": 528744205,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1752528861
    },
    {
        "content": "<p>weird</p>",
        "id": 528744322,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752528927
    },
    {
        "content": "<p>is <code>Nat</code> resolved in the current namespace?</p>",
        "id": 528744345,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752528940
    },
    {
        "content": "<p>this properly opens <code>Nat</code></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">51</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Foo</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">my_test</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">39</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">21</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">root_</span><span class=\"bp\">.</span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">29</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">foo</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"c1\">-- unknown identifier 'foo'</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Foo</span>\n</code></pre></div>",
        "id": 528744436,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752528984
    },
    {
        "content": "<p>Yes, it seems to be resolved. If you do <code>open Nat in #where</code> you can see <code>open Foo.Nat</code>.</p>",
        "id": 528744476,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1752529006
    },
    {
        "content": "<p>I guess the deal is that <code>resolveNamespace</code> returns just a single resolution here.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">51</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Foo</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">my_test</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">39</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">21</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">resolveNamespace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">mkIdent</span><span class=\"w\"> </span><span class=\"ss\">`Nat</span><span class=\"o\">)</span>\n<span class=\"c1\">-- [`Foo.Nat]</span>\n</code></pre></div>",
        "id": 528744792,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1752529154
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.ResolveName.resolveNamespaceUsingScope%3F#doc\">docs#Lean.ResolveName.resolveNamespaceUsingScope?</a> only looks for a single resolution, using the largest prefix of the current namespace.</p>\n<p>(This sort of problem that reusing namespace components can cause.)</p>",
        "id": 528745519,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1752529532
    },
    {
        "content": "<p>I think this kind of resolution is correct when it comes to identifiers. Because priority is given to those that can be obtained using the <code>namespace</code>s and without the <code>open</code>s. (so that e.g. in <code>namespace CategoryTheory</code>, <code>Functor</code> is unambiguous). But when <code>open</code>ing namespaces, this seems wrong.</p>",
        "id": 528746968,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1752530163
    },
    {
        "content": "<p>See also <a class=\"message-link\" href=\"/#narrow/channel/270676-lean4/topic/open.20not.20opening.20a.20namespace/near/491436479\">#lean4 &gt; open not opening a namespace @ ðŸ’¬</a></p>",
        "id": 528814423,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1752570962
    }
]