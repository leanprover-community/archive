[
    {
        "content": "<p>In <a href=\"https://github.com/leanprover/lean4/pull/5317\">lean4#5317</a> I rename 13 simp lemmas, including <code>iff_self</code>, to resolve a TODO in <code>Mathlib.Init.Logic</code>. But I am getting this error even though <code>iff_self_eq</code> (the renamed <code>iff_self</code>) is not in the lemma list:<br>\n<code>Init/Data/Nat/Basic.lean:321:17: error: unknown constant 'iff_self'</code><br>\n<code>| succ c ih =&gt; simp only [Nat.add_succ, Nat.sub_succ, ih]</code><br>\nDo I need to update stage0? If so, how can I do this locally?</p>",
        "id": 469534730,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1726106750
    },
    {
        "content": "<p>(The Mathlib TODO says <code>-- FIXME: remove _iff and add _eq for the lean 4 core versions</code>. Versions with <code>_iff</code> appended are in <code>Mathlib.Init.Logic</code>)</p>",
        "id": 469535029,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1726106901
    },
    {
        "content": "<p>More saliently <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span>: do you think the core simp lemmas should have the <code>_eq</code> appended or not? If the latter, then I should be able to simply deprecate the 13 lemmas under the TODO</p>",
        "id": 469536482,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1726107428
    },
    {
        "content": "<p>I'm skeptical these really need a rename. Let's just deprecate in mathlib.</p>",
        "id": 469538541,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726108648
    },
    {
        "content": "<p>The lean 4 core lemmas here are not written in the standard style, so I think they should not be squatting the nice names for the respective lemmas</p>",
        "id": 469633022,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1726138005
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"598052\">@Jeremy Tan</span> yes this is a stage0 issue. <code>simp</code> contains a reference to <code>iff_self</code> directly in its code, via the <code>simpOnlyBuiltins</code> list. When you rename the theorem and try to compile lean core, you are still using the stage0 <code>simp</code> tactic to compile the <code>Init</code> library and this tactic doesn't realize that the theorem has been renamed. You might be able to do this in two stages where in the first stage you have <code>iff_self</code> and <code>iff_self_eq</code> both defined, and in the second stage (after compilation of the compiler is complete and <code>simp</code> is updated to use the new name) you can remove <code>iff_self</code> or change its statement</p>",
        "id": 469633930,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1726138196
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/270676-lean4/topic/unknown.20identifier.20.60iff_self.60.2C.20even.20without.20the.20lemma/near/469633022\">said</a>:</p>\n<blockquote>\n<p>The lean 4 core lemmas here are not written in the standard style, so I think they should not be squatting the nice names for the respective lemmas</p>\n</blockquote>\n<p>Same problem with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=forall_congr#doc\">docs#forall_congr</a> which I would like to see renamed to <code>forall_congr_eq</code> so that we can unprime <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=forall_congr%27#doc\">docs#forall_congr'</a></p>",
        "id": 469654583,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1726143173
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/270676-lean4/topic/unknown.20identifier.20.60iff_self.60.2C.20even.20without.20the.20lemma/near/469633022\">said</a>:</p>\n<blockquote>\n<p>The lean 4 core lemmas here are not written in the standard style, so I think they should not be squatting the nice names for the respective lemmas</p>\n</blockquote>\n<p>Kim said that the core lemmas should not be renamed, and I've already got <a href=\"https://github.com/leanprover-community/mathlib4/pull/16721\">#16721</a> in mathlib which deprecates the mathlib versions. Now what? Should I still press on with my core PR and rename <code>forall_congr</code>?</p>",
        "id": 469660965,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1726144597
    },
    {
        "content": "<p>it looks like most of <a href=\"https://github.com/leanprover-community/mathlib4/pull/16721\">#16721</a> can stand as is because when it is used in <code>simp</code> it doesn't matter if you use an equality or iff</p>",
        "id": 469661924,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1726144865
    },
    {
        "content": "<p>but in general I would say hold please until discussion is concluded</p>",
        "id": 469662079,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1726144915
    },
    {
        "content": "<p>Some general principles for proposing renamings in the Lean repo:</p>\n<ol>\n<li>Yes, I would like to know about things that are clearly named incorrectly, and I would like to fix them.</li>\n<li>But I really don't want to spend time personally on discussions about <em>whether</em> things are named correctly.</li>\n<li>So I'd prefer that renaming requests only happen when it is absolutely clear that <a href=\"https://leanprover-community.github.io/contribute/naming.html\">#naming</a> says the current name is wrong, and specifies what the name should be. (If this motivates improvements to <a href=\"https://leanprover-community.github.io/contribute/naming.html\">#naming</a> first, great!)</li>\n<li>For now at least, I don't want to touch the Lean/elsewhere disagreement about \"what constitutes a name fragment\", so in particular let's not revisit the <code>congr_arg</code> / <code>congrArg</code> question.</li>\n<li>I would be happy to have more precise rules about <code>iff</code> naming. Currently <a href=\"https://leanprover-community.github.io/contribute/naming.html\">#naming</a> only says <code>sometimes omitted along with the right hand side of the iff</code>, and it would be good to provide clearer guidance on \"sometimes\". (And until/unless this is clarified, point 3 above applies!)</li>\n<li>I would prefer to avoid entirely the duplication of <code>X_iff</code> and <code>X_eq</code> lemmas by where possible replacing the <code>=</code> versions with <code>iff</code> versions, and would be happy to review PRs effecting this.</li>\n</ol>",
        "id": 469840635,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726199678
    },
    {
        "content": "<p>I agree that (6) would be the best solution for this particular issue, there is no need for simp to have eq lemmas here in the first place</p>",
        "id": 469867993,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1726209803
    }
]