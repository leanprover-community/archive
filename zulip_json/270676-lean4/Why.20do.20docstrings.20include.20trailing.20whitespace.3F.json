[
    {
        "content": "<p>Just curious: seeing as the style for docstrings is generally <code>/-- example -/</code> (or even</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/--</span>\n<span class=\"sd\">example</span>\n<span class=\"sd\">-/</span>\n</code></pre></div>\n<p>), with whitespace preceding <code>-/</code>, why do we only call <code>removeLeadingWhitespace</code> in <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.addDocString#doc\">docs#Lean.addDocString</a> and leave trailing whitespace?</p>\n<p>To see that trailing whitespace is not handled somewhere else in the code (before rendering, that is), note the space after <code>test</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"sd\">/-- test -/</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">trivial</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"sd\">/-- info: some (test ) -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"n\">run_cmd</span><span class=\"w\"> </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"{(← findDocString? (← getEnv) `foo)}\"</span>\n</code></pre></div>\n<p>(This isn't crucial; I was just handling different ways of providing docstrings in <a href=\"https://github.com/leanprover-community/mathlib4/pull/28133\">#28133</a> and was surprised to note the difference.)</p>",
        "id": 533553356,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1754714505
    },
    {
        "content": "<p>Oh you know what's even funnier? <code>docComment</code>s don't even <em>have</em> leading whitespace; that gets trimmed while parsing:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/--</span>\n<span class=\"sd\">-- heh this is whitespace</span>\n<span class=\"sd\">/- This is also whitespace -/</span>\n<span class=\"n\">It</span><span class=\"w\"> </span><span class=\"n\">begins</span><span class=\"w\"> </span><span class=\"n\">here</span><span class=\"bp\">.</span>\n<span class=\"c1\">-- heh this is not whitespace</span>\n<span class=\"c\">/-</span><span class=\"cm\"> This also isn't whitespace -/</span>\n<span class=\"bp\">-/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">hi</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">3</span>\n</code></pre></div>",
        "id": 533565501,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1754729770
    },
    {
        "content": "<p>Zulip completely messes this up, as expected :-)</p>",
        "id": 533565513,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1754729792
    },
    {
        "content": "<p>Not strictly related, but</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">37</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">/-</span>\n<span class=\"sd\">/-</span>\n<span class=\"sd\">-/</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">stest</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨⟩</span>\n</code></pre></div>\n<p>producing</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">▼</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">:</span><span class=\"mi\">1</span><span class=\"bp\">-</span><span class=\"mi\">3</span><span class=\"o\">:</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">warning</span><span class=\"o\">:</span>\n<span class=\"n\">unused</span><span class=\"w\"> </span><span class=\"ss\">`termination_by?</span><span class=\"bp\">`</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">recursive</span>\n</code></pre></div>\n<p>is also a bit strange (though a proper \"unterminated comment\" does appear at the bottom line as well)</p>",
        "id": 533566327,
        "sender_full_name": "Julian Berman",
        "timestamp": 1754730742
    },
    {
        "content": "<p>Did you know that this has nothing to do with docstrings?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- warning: unused `termination_by?`, function is not recursive -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"n\">arbitrarily_chosen_token</span><span class=\"w\"> </span><span class=\"c\">/-</span>\n</code></pre></div>",
        "id": 533569822,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1754734848
    },
    {
        "content": "<p>The problem is that a token followed by an unterminated comment causes the token to be pushed to the syntax stack but produce an error so <code>satisfySymbolFn</code> doesn't check whether it is actually correct.</p>",
        "id": 533569888,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1754734947
    },
    {
        "content": "<p>Oh and you won't believe what the output of this is (on latest mathlib):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- -/</span><span class=\"w\"> </span><span class=\"c\">/-</span>\n</code></pre></div>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Error message</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>elaboration function for 'Lean.Parser.«command_Builtin_grind_propagator____:=_»' has not been implemented</p>\n</div></div>",
        "id": 533584951,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1754752835
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"873547\">Robin Arnez</span> <a href=\"#narrow/channel/270676-lean4/topic/Why.20do.20docstrings.20include.20trailing.20whitespace.3F/near/533565501\">said</a>:</p>\n<blockquote>\n<p>Oh you know what's even funnier? <code>docComment</code>s don't even <em>have</em> leading whitespace; that gets trimmed while parsing:</p>\n</blockquote>\n<p>Huh! I was curious, and traced the blame—apparently removing leading spaces <a href=\"https://github.com/leanprover/lean4/commit/c341d8432f0ca9d4e89ecec997297f87e386b118\">was necessary in 2022</a>. Maybe parsing has changed since then?</p>",
        "id": 533587611,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1754755781
    }
]