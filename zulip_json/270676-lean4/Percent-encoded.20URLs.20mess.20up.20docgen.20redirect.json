[
    {
        "content": "<p>It's a bit difficult to demonstrate this bug because most browsers automatically do percent-decoding, but the following link does not work if you go to it directly, e.g. via <code>wget</code>: <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CategoryTheory.nerve%E2%82%82Adj#doc\">https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CategoryTheory.nerve%E2%82%82Adj#doc</a> . I encountered this issue because links inside PDF documents do <em>not</em> do this decoding process, and so the string is sent unchanged as the <code>find/</code> query string, which ends up redirecting to <code>https:/​/​leanprover-community.github.io/​mathlib4_docs/​404.html#CategoryTheory.nerve%E2%82%82Adj</code>. This is apparently per spec - PDF does not let you put unicode in URLs at all, so AFAICT this makes it impossible to link to declarations using non-ASCII using the equivalent of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CategoryTheory#doc\">docs#CategoryTheory</a>.nerve₂Adj .</p>",
        "id": 506300535,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1742261948
    },
    {
        "content": "<p>...and of course the linkifier breaks too. Pretend I wrote <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CategoryTheory.nerve₂Adj#doc\">docs#CategoryTheory.nerve₂Adj</a> above. (But I will leave it unedited because it also seems to make a point, although I'm not sure what the takeaway should be, besides \"non-ASCII in identifiers is still non-portable\".)</p>",
        "id": 506300766,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1742262054
    },
    {
        "content": "<p>This seems to only be an issue with <code>find/</code>, if one links directly to the docgen page <code>https://leanprover-community.github.io/mathlib4_docs/Mathlib/AlgebraicTopology/SimplicialSet/NerveAdjunction.html#CategoryTheory.nerve%E2%82%82Adj</code> this works as intended (because the browser is interpreting the escapes). I think the source of the bug is the fact that <code>find/</code> <a href=\"https://github.com/leanprover/doc-gen4/blob/1b489cdbe4bc57a6acdddb9a5dc5699acacdecdd/static/find/find.js#L33-L42\">bypasses the usual browser handling</a> to be more \"lean-friendly\"</p>",
        "id": 506302959,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1742263043
    },
    {
        "content": "<p>actually never mind, it was user error (the URL was double percent encoded). find.js is <a href=\"https://github.com/leanprover/doc-gen4/blob/1b489cdbe4bc57a6acdddb9a5dc5699acacdecdd/static/find/find.js#L52\">correctly decoding the URL fragment</a>.</p>",
        "id": 506305123,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1742264002
    }
]