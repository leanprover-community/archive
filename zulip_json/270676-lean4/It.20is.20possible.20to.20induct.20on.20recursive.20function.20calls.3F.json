[
    {
        "content": "<p>So I'm working on a parser and I have functions that look like this MWE. <code>acceptNext</code>steps through the input. <code>advanceWhile</code> skips through characters as long as a predicate is true. (In the real code, acceptNext does some bookkeeping for things like line and column numbers which is why it is a separate function)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">acceptNext</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Char</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Char</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Char</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">cs</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">cs</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">none</span>\n\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">advanceWhile</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Char</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">pred</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Char</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Char</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">isSome</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">acceptNext</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ls</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">pred</span><span class=\"w\"> </span><span class=\"n\">c</span>\n<span class=\"w\">    </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">advanceWhile</span><span class=\"w\"> </span><span class=\"n\">ls</span><span class=\"w\"> </span><span class=\"n\">pred</span>\n<span class=\"w\">    </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">l</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">l</span>\n<span class=\"w\">  </span><span class=\"n\">termination_by</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">decreasing_by</span>\n<span class=\"w\">    </span><span class=\"n\">simp_wf</span>\n<span class=\"w\">    </span><span class=\"n\">revert</span><span class=\"w\"> </span><span class=\"n\">isSome</span>\n<span class=\"w\">    </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">nil</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">acceptNext</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"w\"> </span><span class=\"n\">ls'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">acceptNext</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span>\n<span class=\"w\">      </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">hls</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hls</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span>\n</code></pre></div>\n<p>In order to help me prove that some callers terminate, I would like to prove that</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">advanceWhile_progresses</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Char</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">pred</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Char</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">advanceWhile</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">pred</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n</code></pre></div>\n<p>I'm very confused by how to go about it. If I was doing it on paper, I would probably do something like induction on the size of the call stack. But I'm not sure how I would do that here.</p>",
        "id": 510504019,
        "sender_full_name": "Alex Zani",
        "timestamp": 1743961142
    },
    {
        "content": "<p>if the proof follows the same shape as the function, i imagine <code>advanceWhile.induct</code> might help</p>",
        "id": 510504127,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1743961227
    },
    {
        "content": "<p>Lean generates <code>acceptNext.induct</code> and <code>advanceWhile.induct</code>, one of these might be helpful to  you</p>",
        "id": 510504134,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1743961235
    },
    {
        "content": "<p>In particular, <code>acceptNext.induct</code> will do induction on the size of the call stack, since that's the shape of that definition. You could alternatively induct on <code>l</code> itself, which should do something similar, and will induct on the shape of the list</p>",
        "id": 510504238,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1743961311
    },
    {
        "content": "<p>Thanks. <code>acceptNext.induct</code> does not appear to exist. I'm also a bit unsure how I'm supposed to go about using <code>acceptWhile.induct</code>. I assume I should constructure an assumption using it, but the first thing it wants is a function from my parameters to Prop.</p>",
        "id": 510506188,
        "sender_full_name": "Alex Zani",
        "timestamp": 1743962681
    },
    {
        "content": "<p>Does the <code>fun_induction</code> tactic work now?</p>",
        "id": 510506714,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1743963104
    },
    {
        "content": "<p>I'm getting \"unknown tactic\"</p>",
        "id": 510507532,
        "sender_full_name": "Alex Zani",
        "timestamp": 1743963688
    },
    {
        "content": "<p>What does <code>#version</code> say for you?</p>",
        "id": 510507961,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1743964042
    },
    {
        "content": "<p><code>unexpected token '#'; expected command</code></p>\n<p><code>eval Lean.versionString</code> gives 4.10.0</p>",
        "id": 510508288,
        "sender_full_name": "Alex Zani",
        "timestamp": 1743964270
    },
    {
        "content": "<p>I see — the latest stable release is 4.18, and 4.19 is currently under testing. Would you be able to upgrade?</p>",
        "id": 510508840,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1743964756
    },
    {
        "content": "<p>I'll see if I can.</p>",
        "id": 510508862,
        "sender_full_name": "Alex Zani",
        "timestamp": 1743964779
    }
]