[
    {
        "content": "<p>The <code>repeat</code> and <code>while</code> notations currently make it impossible to prove things about them, due to working with the opaque <code>Lean.Loop.forIn</code>. However, it is possible (for most monads) to write a definition of <code>Lean.Loop.forIn</code> that works with an equality theorem</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">forIn</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">init</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">  </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">()</span><span class=\"w\"> </span><span class=\"n\">init</span><span class=\"w\"> </span><span class=\"bp\">&gt;&gt;=</span><span class=\"w\"> </span><span class=\"k\">fun</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">done</span><span class=\"w\"> </span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"n\">val</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">yield</span><span class=\"w\"> </span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">forIn</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"n\">f</span>\n</code></pre></div>\n<p>Here is a proof of concept of how such an integration would go:<br>\n<a href=\"/user_uploads/3121/EtG_Mwl8T9FbON-V94PD4hu7/Loop.lean\">Loop.lean</a><br>\n(this one uses <code>partial_fixpoint</code> to make things simpler, so you need a newer version of lean, e.g. nightly)<br>\n(the proof on the bottom is an example of it working with a complex monad, although there probably should be more simp lemmas or lawful classes that would make the proof less painful)<br>\nThe point of this would be to make it more possible to use monadic notation and in particular <code>repeat</code> and <code>while</code> with proofs. There is definitely a lot to do still to make monadic implementations better to work with but I think this would be a good step.</p>",
        "id": 500498439,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1739908175
    }
]