[
    {
        "content": "<p>I have the following definition (actually mine is somewhat more complicated but not in a way that matters for my question).</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foobar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">zipWithIndex</span><span class=\"bp\">.</span><span class=\"n\">foldr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">bp</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"bp\">.</span><span class=\"n\">swap!</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">bp</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">bp</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">bp</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">.</span><span class=\"n\">toNat</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"n\">as</span>\n</code></pre></div>\n<p>Effectively what this does is that it goes along the array, performing swaps on adjacent pairs if the corresponding bit is set in c, for each bit in c.</p>\n<p>I am struggling to work with this definition - even proving it doesn't change the size is proving difficult, let alone describing the values I end up with. Can anyone suggest a route forward or a way I might change my definition?</p>",
        "id": 455315092,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1722413764
    },
    {
        "content": "<p>If the list is notionally organised as pairs, and you're operating on these pairs, why are you not just working with an <code>Array (α × α)</code> at this point?</p>\n<p>I think you might need to <a href=\"https://en.wikipedia.org/wiki/XY_problem\">#xy</a> a bit to get good advice.</p>",
        "id": 455360779,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1722427548
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/270676-lean4/topic/Working.20with.20Array.2Efoldr/near/455360779\">said</a>:</p>\n<blockquote>\n<p>If the list is notionally organised as pairs, and you're operating on these pairs, why are you not just working with an <code>Array (α × α)</code> at this point?</p>\n<p>I think you might need to <a href=\"https://en.wikipedia.org/wiki/XY_problem\">#xy</a> a bit to get good advice.</p>\n</blockquote>\n<p>It isn't organised as pairs, or rather the strategy here is to manipulate different sets of pairs.</p>",
        "id": 455361103,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1722427646
    },
    {
        "content": "<p>(in fact I also look at pairs of \"every fourth element\" etc. too.)</p>",
        "id": 455361196,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1722427678
    },
    {
        "content": "<p>What do you mean by <a href=\"https://en.wikipedia.org/wiki/XY_problem\">#xy</a>?</p>",
        "id": 455361280,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1722427692
    },
    {
        "content": "<p>\"explain not just the question, but the question behind the question\" (or \"why you're interested in the question in the first place\")</p>",
        "id": 455378015,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1722433300
    },
    {
        "content": "<p>Right! So essentially I have a list of natural numbers, some permutation of 0-n-1 - in fact actually n will be some power of two. I could shuffle these by conditionally flipping every pair (0-1, 2-3, etc.), every four (0-2, 1-3, etc.). I can do this via a map on values (that is, literally sending 0 to 1, 1 to 0, etc.) which is just an array map. Or I could operate on indices - send the 0th member of the list to the first and the first to the 0th, etc.: effectively a set of conditional swaps. I want to precisely show that doing the latter is like doing the operation of the former to the index</p>",
        "id": 455379149,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1722433628
    }
]