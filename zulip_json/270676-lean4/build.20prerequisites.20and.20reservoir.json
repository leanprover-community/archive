[
    {
        "content": "<p>My library <a href=\"https://reservoir.lean-lang.org/@lecopivo/leanblas\">LeanBLAS</a> requires development files for BLAS to be installed. This is clearly not the case when reservoir tries to build the library. How am I supposed to ensure that BLAS is installed?</p>",
        "id": 499768722,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1739546659
    },
    {
        "content": "<p>CC <span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span> sounds potentially relevant to the FFI goals for this quarter as well maybe?</p>",
        "id": 499769118,
        "sender_full_name": "Henrik BÃ¶ving",
        "timestamp": 1739546773
    },
    {
        "content": "<p>LeanCopilot has a custom <a href=\"https://github.com/lean-dojo/LeanCopilot/blob/92a5ab6b58d06df8fd60d98dc38b1f674706eaad/lakefile.lean#L169\">lake target</a> which manually downloads OpenBLAS from github and builds it. I doubt that this is the way it is supposed to be done.</p>",
        "id": 499769721,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1739546941
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"346070\">Tomas Skrivan</span> <a href=\"#narrow/channel/270676-lean4/topic/build.20prerequisites.20and.20reservoir/near/499769721\">said</a>:</p>\n<blockquote>\n<p>LeanCopilot has a custom <a href=\"https://github.com/lean-dojo/LeanCopilot/blob/92a5ab6b58d06df8fd60d98dc38b1f674706eaad/lakefile.lean#L169\">lake target</a> which manually downloads OpenBLAS from github and builds it. I doubt that this is the way it is supposed to be done.</p>\n</blockquote>\n<p>No, that is the standard solution. The FFI improvements coming this quarter will make this simpler, less finicky, and more declarative, but the underlying idea is more-or-less the same.</p>",
        "id": 499941586,
        "sender_full_name": "Mac Malone",
        "timestamp": 1739645791
    },
    {
        "content": "<p>Ok sounds reasonable and I have adopted the approach from LeanCopilot. I'm still having issues using LeanBLAS as a dependency but I need to investigate more carefully what is going wrong.</p>",
        "id": 499946362,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1739650070
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"315577\">Mac Malone</span> <a href=\"#narrow/channel/270676-lean4/topic/build.20prerequisites.20and.20reservoir/near/499941586\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"346070\">Tomas Skrivan</span> <a href=\"#narrow/channel/270676-lean4/topic/build.20prerequisites.20and.20reservoir/near/499769721\">said</a>:</p>\n<blockquote>\n<p>LeanCopilot has a custom <a href=\"https://github.com/lean-dojo/LeanCopilot/blob/92a5ab6b58d06df8fd60d98dc38b1f674706eaad/lakefile.lean#L169\">lake target</a> which manually downloads OpenBLAS from github and builds it. I doubt that this is the way it is supposed to be done.</p>\n</blockquote>\n<p>No, that is the standard solution. The FFI improvements coming this quarter will make this simpler, less finicky, and more declarative, but the underlying idea is more-or-less the same.</p>\n</blockquote>\n<p>I'm having really hard time using such library as dependency. I'm trying to use <code>LeanBLAS</code> in <code>SciLean</code> but I'm constantly getting </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">libopenblas</span><span class=\"bp\">.</span><span class=\"n\">so</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cannot</span><span class=\"w\"> </span><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">shared</span><span class=\"w\"> </span><span class=\"n\">object</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">No</span><span class=\"w\"> </span><span class=\"n\">such</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">directory</span>\n</code></pre></div>\n<p>In LeanBLAS I have a custom target <code>target libopenblas pkg : FilePath := ...</code> that creates <code>libopenblas.so</code>. How am I supposed to say that this should be linked to <code>libLeanBLAS.so</code>?  Also I want this to be somehow transitive. If another project depends on <code>LeanBLAS</code> it should not be forced to add explicit linking flat for <code>libopenblas.so</code>.</p>",
        "id": 500304553,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1739844634
    },
    {
        "content": "<p>The only way I can successfully build SciLean with the depedency I have to run <code>lake build leanblas</code> to build explicitly build the dependency and set up scilean package as</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">linkArgs</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"s2\">\"-L./.lake/packages/leanblas/.lake/build/lib/\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"-lopenblas\"</span><span class=\"o\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">moreLeanArgs</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"s2\">\"--load-dynlib=./.lake/packages/leanblas/.lake/build/lib/libopenblas.so\"</span><span class=\"o\">]</span>\n\n<span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">scilean</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">  </span><span class=\"n\">moreLinkArgs</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">linkArgs</span>\n<span class=\"w\">  </span><span class=\"n\">moreLeanArgs</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">moreLeanArgs</span>\n<span class=\"o\">}</span>\n</code></pre></div>",
        "id": 500307067,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1739846246
    },
    {
        "content": "<p>And if I compile binary <code>HelloWorld</code> I can run it only with</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">LD_LIBRARY_PATH</span><span class=\"bp\">=.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">leanblas</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">HelloWorld</span>\n</code></pre></div>",
        "id": 500307910,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1739846839
    }
]