[
    {
        "content": "<p>Hi everyone! I am trying to define an inductive datatype that represents natural-number literals an n-ary operators on them. However, Lean is rejecting my datatype with the error message <code>(kernel) invalid nested inductive datatype 'Vector', nested inductive datatypes parameters cannot contain local variables.</code>.  I've attached an <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a> <a href=\"https://live.lean-lang.org/#codez=JYWwDg9gTgLgBAWQIYwBYBtgCMB0ARFJHANQFMBjGaHAISQGdhyAoZ4AOwBMBXS4AN1JwActxCkoTAKIAPMFFL1GEdnADuqCaWZw4AHzjsxEpgBlgMCUnRwAXCJRwAtAD4RxyeVnzFy9jv04CDArGGAVOzgAClV7YRQASmc3KLJKaAd4VVdMpJzUiiood3FPbwUlcNV2PLdRUuk5Cr8gA\">here</a>. Could anyone give a suggestion on how to make this type work?</p>",
        "id": 533972625,
        "sender_full_name": "Andrew",
        "timestamp": 1755002573
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"938806\">@Andrew</span> you can include the code using <a href=\"https://github.com/leanprover-community/mathlib/wiki/Code-in-backticks\">#backticks</a>, which already generates a link to the website (on the top right hand corner of the code block)</p>",
        "id": 533974004,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755003029
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Vector</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">NumericExpression</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">numericLiteral</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">NumericExpression</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">operation</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Vector</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Vector</span><span class=\"w\"> </span><span class=\"n\">NumericExpression</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">NumericExpression</span>\n</code></pre></div>",
        "id": 533974387,
        "sender_full_name": "Andrew",
        "timestamp": 1755003152
    },
    {
        "content": "<p>Even more minimal <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a> here:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Vector</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">NumericExpression</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">operation</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Vector</span><span class=\"w\"> </span><span class=\"n\">NumericExpression</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">NumericExpression</span>\n</code></pre></div>",
        "id": 533974445,
        "sender_full_name": "Andrew",
        "timestamp": 1755003180
    },
    {
        "content": "<p>you forgot to include the definition of MyVector</p>",
        "id": 533974813,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755003303
    },
    {
        "content": "<p>Just changed it, I'm using the standard library vector, MyVector was just for debugging</p>",
        "id": 533974913,
        "sender_full_name": "Andrew",
        "timestamp": 1755003335
    },
    {
        "content": "<p>It works with <code>List</code>, and I think also with <code>Array</code>, but <code>Vector</code> is not supported yet for constructing inductive types through it. This is a limitation in the current implementation of inductive types. In the new year 3 roadmap it says that <code>inductive</code> will be fixed so that <code>HashMap</code> and <code>TreeMap</code> are supported here. I assume that this will also fix it for <code>Vector</code>.</p>",
        "id": 534009912,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1755013897
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 534036897,
        "sender_full_name": "Andrew",
        "timestamp": 1755024360
    },
    {
        "content": "<p>I ran into a <a href=\"#narrow/channel/270676-lean4/topic/Defining.20tree.20with.20dependent.20branching.20factor\">similar problem</a> a while ago. It turns out <code>Vector</code> or refined types aren't supported yet. A current suggested solution would be something like <code>Fin n -&gt; NumericExpression</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">NumericExpression</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">numericLiteral</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">NumericExpression</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">operation</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Vector</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">NumericExpression</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">NumericExpression</span>\n</code></pre></div>\n<p>But if you'd prefer a first-order, more readily inspectable representation, you could also try mutually defining <code>NumericExpressionList : Nat -&gt; Type</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">mutual</span>\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">NumericExpression</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">numericLiteral</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">NumericExpression</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">operation</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Vector</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">NumericExpressionList</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">NumericExpression</span>\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">NumericExpressionList</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">nil</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">NumericExpressionList</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">NumericExpression</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">NumericExpressionList</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">NumericExpressionList</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"kn\">end</span>\n</code></pre></div>\n<p>These solutions are sub-optimal (e.g. boilerplate, poor locality, etc.). But I think they'll improve this coming year.</p>",
        "id": 534036975,
        "sender_full_name": "Phil Nguyen",
        "timestamp": 1755024397
    },
    {
        "content": "<p>(Note also that you don't need to import <code>Mathlib.Data.Vector.Basic</code>, as <code>Vector</code> is defined in <code>Std</code>)</p>",
        "id": 534048628,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1755029445
    }
]