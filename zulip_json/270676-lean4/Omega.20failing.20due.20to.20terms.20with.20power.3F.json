[
    {
        "content": "<p>(edited to make mathlib independent)</p>\n<p>Hi, I was working on a proof related to natural numbers and noticed omega failing in a place where I was expecting it to succeed. I have been able to reduce it to following minimal reproduction:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\">  </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">omega</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">omega</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">^</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">^</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">omega</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">^</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">^</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">omega</span><span class=\"w\"> </span><span class=\"c1\">-- this one fails with following message</span>\n<span class=\"c\">/-</span>\n<span class=\"cm\">omega could not prove the goal:</span>\n<span class=\"cm\">a possible counterexample may satisfy the constraints</span>\n<span class=\"cm\">  d ≥ 0</span>\n<span class=\"cm\">  c ≤ -1</span>\n<span class=\"cm\">  c ≤ -1</span>\n<span class=\"cm\">where</span>\n<span class=\"cm\"> c := ↑2 ^ a</span>\n<span class=\"cm\"> d := ↑b</span>\n<span class=\"cm\">-/</span>\n</code></pre></div>\n<p>as you can see, omega is for some reasone treating <code>2^a</code> and <code>b</code> as integers and even then the counterexample still doesn't make sense to me. I've only been using lean for a month or so. So I am not sure how to trace a tactic like omega and to me it feels like omega should handle the 4th example too, unless I am missing some fact. If anyone can clear up if this is a bug or feature, will be great.</p>\n<p>btw I am aware that this simple example can be solved by theorems in mathlib. But like I said I faced my original problem in a different place with powered terms.</p>",
        "id": 511110190,
        "sender_full_name": "Sabbir Rahman",
        "timestamp": 1744187629
    },
    {
        "content": "<p>I think the naive answer is \"omega doesn't deal with powers\" but I'm surprised it's not treating 2^a as an atom.</p>",
        "id": 511113294,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744188440
    },
    {
        "content": "<p>At first I assumed that too, but 3rd example has <code>2^b</code> and that worked without issues</p>",
        "id": 511114079,
        "sender_full_name": "Sabbir Rahman",
        "timestamp": 1744188660
    },
    {
        "content": "<p>I would change <code>\\N</code> to <code>Nat</code> and repost without any imports in #lean4 to get some expert eyes on this. As for the integer suggestion, I think this is just part of the algorithm, I wouldn't take these things too seriously. Or edit your original post to be mathlib-free and I can move the thread to that channel.</p>",
        "id": 511115645,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744189063
    },
    {
        "content": "<p>changed the code to be mathlib free, could you move it please?</p>\n<p>also I was not aware that omega is defined in lean and not in mathlib, I keep learning new facts in lean everyday.</p>",
        "id": 511116970,
        "sender_full_name": "Sabbir Rahman",
        "timestamp": 1744189386
    },
    {
        "content": "<p>This topic was moved here from <a class=\"stream-topic\" data-stream-id=\"113488\" href=\"/#narrow/channel/113488-general/topic/Omega.20failing.20due.20to.20terms.20with.20power.3F\">#general &gt; Omega failing due to terms with power?</a> by <span class=\"user-mention silent\" data-user-id=\"311453\">Frédéric Dupuis</span>.</p>",
        "id": 511185742,
        "sender_full_name": "Notification Bot",
        "timestamp": 1744208046
    },
    {
        "content": "<p>I also tried that last example with <code>grind</code> (an experimental tactic that should also close goals like this) and it crashed on Lean 4.19.0-rc2.</p>",
        "id": 511186124,
        "sender_full_name": "Frédéric Dupuis",
        "timestamp": 1744208138
    }
]