[
    {
        "content": "<p>Hi, I'm getting the following error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">application</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">mismatch</span>\n<span class=\"w\">  </span><span class=\"n\">assoc'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Term</span><span class=\"bp\">.</span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"n\">mul</span><span class=\"o\">)</span>\n<span class=\"n\">argument</span>\n<span class=\"w\">  </span><span class=\"n\">Term</span><span class=\"bp\">.</span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"n\">mul</span>\n<span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">1535</span><span class=\"w\"> </span><span class=\"n\">mul</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Term</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">1535</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">1536</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Term</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">1535</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">1536</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">1532</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Term</span><span class=\"w\"> </span><span class=\"n\">arity</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Term</span><span class=\"w\"> </span><span class=\"n\">arity</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n</code></pre></div>\n<p>where <code>arity : Ops → ℕ</code> is explicitly defined for <code>mul : Ops</code> as <code>2</code>. Looking at meta-variables it should be easy to deduce</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">1535</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">arity</span>\n<span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">1536</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">ℕ</span>\n</code></pre></div>\n<p>so I guess the problem is with <code>?u.1532</code>. But why is it not deduced to <code>0</code> after other deductions are made? And why is there this meta-variable, is it because the domain type of <code>?m.1535</code> is not yet known?</p>",
        "id": 514678665,
        "sender_full_name": "Michał Staromiejski",
        "timestamp": 1745783695
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a> ?</p>",
        "id": 514678926,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1745783898
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> tried to create one and it was not easy. Will try to port to lean web and post a link here.</p>",
        "id": 514679115,
        "sender_full_name": "Michał Staromiejski",
        "timestamp": 1745784027
    },
    {
        "content": "<p>But anyway, it's a question about why those specific type \"instances\" cannot trigger proper inference.</p>",
        "id": 514679174,
        "sender_full_name": "Michał Staromiejski",
        "timestamp": 1745784067
    },
    {
        "content": "<p>My answer to these questions is usually \"I don't have any understanding of how unification works so let me just add more hints\" and this usually solves it.</p>",
        "id": 514679379,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1745784237
    },
    {
        "content": "<p>i.e. type <code>(assoc (Term.op mul) : [the type you want it to be])</code> somehow</p>",
        "id": 514679441,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1745784261
    },
    {
        "content": "<p>With a MWE I'd try and do this for you.</p>",
        "id": 514679456,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1745784278
    },
    {
        "content": "<p>With hints it works (enough to specify <code>Term.op (s := arity) mul</code>), I already know it :) But I want to understand this case...<br>\nThe link to a \"nsmwe\" (not-so-minimal-...): <a href=\"https://live.lean-lang.org/#codez=JYWwDg9gTgLgBAWQIYwBYBtgCMB0BBdAcwFMsokcBFAVwhmGIDsYAoUSWRFDbHAERQUAysRgAZYAGtiOAEJIAzsADGbcNHjI0mXAJjDREYABM5ilWo6buO/oJwAxYIxwA1YsoBydFMAiMWFiQsMmIANzgIADM8KGAYAE84AApJOAAuOEBUQgBKFIANDLgAFQSwYgAqPPSAXhSnRjg0wCTCOHy81vzAsKQ44PRiOABvISLS8oqAXxSFItHW3MCAegBaFZKywei4akZgMOIoBSR0OBOSMiQ4BRgoamUYaihiWf84AAM8d7gAd3jUa7AQiMFBPQbvBTfJCMYxwYgAR2ovn8s3eAFF3jg4CslixlOhFLMAKp7A5HE4EC7kFJ4MabKq/VCHYgsOCRMApKLVSIxOKJGZwLlwPDdXrAfqDZK02RwADCdImORYPT6WAGcAA2iT9odjuhKaRqbM8ABdTXasl6g2Xa5wWRmrWk3UUoiGq6zWUmwLOYz3egHEqHEDDUaZcaVabJWaZebZPLJQph+l5H5M56suAAHzgEWSAA8iu0M9mIBzklE5vGrpkGgKha1ikHbUXlWKJcNjdNnCxjMQK42oCAcOETgByYb5SOEQtwVp4ePwMNN2btIq02oZkAoZQA+B/NDFnNwAs1AB8cGnecPpcFZzgZ7gFud+tdlxwN4rUV2cGAcEAZYRwj06DjtOyRXMASosKs6zhjyOxOuSpznG61y3H6YKvI0nzfPuAJKMCoLPB8kJnDCcKIsijAKFiOJ4gSCjEghVqvuQaLwrMQwAJKRgi0ZwJxs6BoOtpZHAADrQnBrMuQ0gqlR5MQeYwEwxiMTqiHWkawqMsyGa8QA+scMDjpkgAARBeRSiXOAA0cDmcAtnJLxP45DgACMw5ASB94pM5EE4AATJ5Y4XoEpZMFwtzAAWA7Bt2KrimqgxDAoXYBL2FaEhAygpKWAVFMktb5Q2y5xoJsUidyFXSeJkkiRkNQZsk7L5QAhBqeVwO1EQAAy2REbkmv1cABUNLVdRqvW2Z13VwG5w2jWakE+n6OpwCIIBAlAEDUGAADyYCHiA1DoIEGXrcQm2ENtu0HTgYr8skN4xpdW07ftYDcqJG5sluMA7uyvz/FmcDHacD4Bd6MKrQGG1vbtbEKEdJ36VlqgsOFjRw9d70HRdV03WAiNnX2+Pw2WADickMj9j5MS6VJIMTbJsg9CQZmyX6NAicyvTjCPsf+oPbgCPO4RzLOrGcDHZeK/rxEktEsyz2Zg6jMs5Q+aMpLF74cmDeRrNLCjZTrQZ6wKtRnHyCR5Ab2LrD80CSEjysUywQA\">here</a></p>",
        "id": 514680297,
        "sender_full_name": "Michał Staromiejski",
        "timestamp": 1745784894
    },
    {
        "content": "<p>Oh, just realised my question got \"merged\" with another similar one. Will go through the answer as well, maybe it would clarify more.</p>",
        "id": 514680472,
        "sender_full_name": "Michał Staromiejski",
        "timestamp": 1745784991
    },
    {
        "content": "<p>52 lines is perfectly minimal enough! I don't know how the unification algorithm works though, you're asking an interesting question, perhaps I'll learn something too.</p>",
        "id": 514683494,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1745787183
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"759408\">Michał Staromiejski</span> <a href=\"#narrow/channel/270676-lean4/topic/Type.20inference.20problem/near/514678665\">said</a>:</p>\n<blockquote>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">application</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">mismatch</span>\n<span class=\"w\">  </span><span class=\"n\">assoc'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Term</span><span class=\"bp\">.</span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"n\">mul</span><span class=\"o\">)</span>\n<span class=\"n\">argument</span>\n<span class=\"w\">  </span><span class=\"n\">Term</span><span class=\"bp\">.</span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"n\">mul</span>\n<span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">1535</span><span class=\"w\"> </span><span class=\"n\">mul</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Term</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">1535</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">1536</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Term</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">1535</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">1536</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">1532</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Term</span><span class=\"w\"> </span><span class=\"n\">arity</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Term</span><span class=\"w\"> </span><span class=\"n\">arity</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Unfortunately, the unification algorithm here works from left to right, so it starts with <code>2 =?= ?m.1535 mul</code>, and there it gets stuck and throws an error.</p>",
        "id": 515175512,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1745969977
    },
    {
        "content": "<p>Generally, higher order unification is hard (i.e. there are metavariables that are functions). In this case it got the unification order the wrong way around to do manage the higher order unificaiton.</p>",
        "id": 515175671,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1745970077
    },
    {
        "content": "<p>it's not just hard, it's undecidable right? Thanks for the explanation!</p>",
        "id": 515230230,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1745998922
    }
]