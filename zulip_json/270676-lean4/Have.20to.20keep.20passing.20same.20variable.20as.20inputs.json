[
    {
        "content": "<p>I think I asked for help with this in the past. I'm formalizing a proof that involves a somewhat complicated construction with many hypotheses fixed throughout. Basically the theorem has the form <code>∀ x : Foo, ∃ y, P y</code>, and the proof fixes an <code>x</code> and reaches a contradiction using a lengthy construction that uses the hypothesis <code>∀ y, ¬ P y</code>.</p>\n<p>There are many assumptions about <code>Foo</code> in the background, and theoretically the way I want to structure the proof  is to add them all as variables in a section and in it define the steps of the construction and the lemmas about it. The problem is that I always have to pass the variables as inputs at every step. For example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">section</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Classical</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">assumptions</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">we</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">make</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span>\n\n<span class=\"c1\">-- function uses many variables</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">assumptions</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">we</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">make</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"c1\">-- failed to synth implicit arguments to `foo`</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"kn\">end</span>\n</code></pre></div>\n<p>So whenevery I use <code>foo</code> I have to pass many assumptions to it, which I would like to think of as \"assumptions we fixed before we started the construction\". These extra inputs are passed down into every theorem about <code>foo</code>.</p>\n<p>Does anyone have a better way to organize such proofs?</p>",
        "id": 486198995,
        "sender_full_name": "Nir Paz",
        "timestamp": 1733356246
    },
    {
        "content": "<p>You can put assumptions in a structure.</p>",
        "id": 486250539,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1733387682
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/channel/270676-lean4/topic/Have.20to.20keep.20passing.20same.20variable.20as.20inputs/near/486250539\">said</a>:</p>\n<blockquote>\n<p>You can put assumptions in a structure.</p>\n</blockquote>\n<p>This works nicely! Also makes it easier for lean to fill it in. Is there a way to \"open\" a structure so that I can write <code>h</code> instead of <code>foo.h</code>?</p>",
        "id": 486320503,
        "sender_full_name": "Nir Paz",
        "timestamp": 1733409662
    },
    {
        "content": "<p><code>open foo</code></p>",
        "id": 486320700,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733409716
    },
    {
        "content": "<p>One technique I have used occasionally when the list of assumptions is sufficiently large and stable across theorems is to use nullary typeclasses. <a href=\"https://github.com/teorth/equational_theories/blob/6c65d0a0a0193ea88383f0234e5511e19b2f7142/equational_theories/ManuallyProved/Equation854.lean#L138-L162\">Here</a> is an example. Note the use of <code>a</code> in the <code>dom_a</code> theorem is referring to the field of the <code>Extension1</code> structure</p>",
        "id": 486321700,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733409956
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/270676-lean4/topic/Have.20to.20keep.20passing.20same.20variable.20as.20inputs/near/486320700\">said</a>:</p>\n<blockquote>\n<p><code>open foo</code></p>\n</blockquote>\n<p><code>foo : Foo</code> in this context, so I can't <code>open foo</code>. And <code>open Foo</code> doesn't work either. But the example you gave using classes is great! The exact same structure seems to work smoothly in my case, thanks!</p>",
        "id": 486325706,
        "sender_full_name": "Nir Paz",
        "timestamp": 1733410906
    }
]