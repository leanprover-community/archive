[
    {
        "content": "<p>It seems that the <code>package</code> command only supports pure values ... is there any mechanism for deriving a package version from git info in a <code>lakefile.lean</code>?</p>\n<p>The motivation is to have a package release process which is driven by tagging in git. Something similar is possible in Haskell with a cabal <code>Setup.hs</code> using a <code>confHook</code>.</p>",
        "id": 565700572,
        "sender_full_name": "Miles Sabin",
        "timestamp": 1767028403
    },
    {
        "content": "<p>I think this is a question for <span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span>.</p>",
        "id": 566459113,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1767658538
    },
    {
        "content": "<p>You can run arbitrary IO in a <code>lakefile.lean</code> via the <code>run_io</code> syntax. For example, you could derive the version of a package from a Git tag like so:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">getVersion</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">StdVer</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">repo</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">GitRepo</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"bp\">__</span><span class=\"n\">dir__</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">tag</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">repo</span><span class=\"bp\">.</span><span class=\"n\">findTag?</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">v!</span><span class=\"s2\">\"0.0.0\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">ok</span><span class=\"w\"> </span><span class=\"n\">ver</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">StdVer</span><span class=\"bp\">.</span><span class=\"n\">parse</span><span class=\"w\"> </span><span class=\"n\">tag</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">v!</span><span class=\"s2\">\"0.0.0\"</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">ver</span>\n\n<span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">mypkg</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">run_io</span><span class=\"w\"> </span><span class=\"n\">getVersion</span>\n</code></pre></div>",
        "id": 566460301,
        "sender_full_name": "Mac Malone",
        "timestamp": 1767659467
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span> very belated thanks ... that works perfectly.</p>",
        "id": 572634835,
        "sender_full_name": "Miles Sabin",
        "timestamp": 1770569914
    }
]