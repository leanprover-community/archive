[
    {
        "content": "<p>Taking an hour to complete:</p>\n<p><a href=\"/user_uploads/3121/Xcz99y32eJtA7YWTPHk_lhoP/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/Xcz99y32eJtA7YWTPHk_lhoP/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"915x720\" src=\"/user_uploads/thumbnail/3121/Xcz99y32eJtA7YWTPHk_lhoP/image.png/840x560.webp\"></a></div><p>Also, is it against Lean4's license to include it in my own application's downloadable package because this download wait time is not very good UX?</p>\n<p>I'm making a standalone IDE for Lean4.  But it's going to have commutative diagram support via Quiver.  These diagrams will just get translated into definitions in the focused Lean4 file.</p>",
        "id": 567370349,
        "sender_full_name": "Daniel Donnelly",
        "timestamp": 1768112718
    },
    {
        "content": "<p>Solution: I cloned a Lean4 project  w/o mathlib dependency.</p>",
        "id": 567371444,
        "sender_full_name": "Daniel Donnelly",
        "timestamp": 1768113847
    },
    {
        "content": "<p>No, it never takes me that long! Usually comfortably under a minute.</p>",
        "id": 567371483,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1768113903
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"548935\">@Thomas Murrills</span> I must be doing something wrong then :)</p>",
        "id": 567371575,
        "sender_full_name": "Daniel Donnelly",
        "timestamp": 1768113994
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"548935\">@Thomas Murrills</span> So it takes you under a minute to download mathlib4?</p>",
        "id": 567371593,
        "sender_full_name": "Daniel Donnelly",
        "timestamp": 1768114022
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"236489\">Daniel Donnelly</span> <a href=\"#narrow/channel/270676-lean4/topic/Does.20getting.20lean4.20.2F.20mathlib.20usually.20take.20this.20long.3F/near/567371575\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"548935\">Thomas Murrills</span> I must be doing something wrong then :)</p>\n</blockquote>\n<p>Not necessarily—it's entirely possible the software is doing something wrong. <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span> If I recall correctly people have reported weird situations where this can take very long...you might find them on zulip somewhere, but unfortunately I'm not sure where.</p>\n<p>Others might have more insight into what could be happening, but I just wanted to let you know that this is certainly not typical! :)</p>",
        "id": 567371767,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1768114217
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"236489\">Daniel Donnelly</span> <a href=\"#narrow/channel/270676-lean4/topic/Does.20getting.20lean4.20.2F.20mathlib.20usually.20take.20this.20long.3F/near/567371593\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"548935\">Thomas Murrills</span> So it takes you under a minute to download mathlib4?</p>\n</blockquote>\n<p>That's right!</p>",
        "id": 567371779,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1768114230
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"548935\">@Thomas Murrills</span> what do you think about this idea?  It is supposed to be simpler than using VScode (original / current Lean4 ext).   Though doesnt hamper you from using one or the either because we use QFileSystemWatcher to monitor a project.  It's going to have easy access to many lean4-extension projects.  Syntax highlighting as well as LaTeX previewing / posting on a site (whatever can be done now with that certain library, then we'll enhance it).</p>",
        "id": 567372951,
        "sender_full_name": "Daniel Donnelly",
        "timestamp": 1768115726
    },
    {
        "content": "<p>This can sometimes be caused by an overeager antivirus</p>",
        "id": 567378577,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1768123623
    },
    {
        "content": "<p>(which intercepts every individual download and substantially slows it down)</p>",
        "id": 567378630,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1768123672
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> it's not that for me.  I don't have AV / firewall on my workstation</p>",
        "id": 567380817,
        "sender_full_name": "Daniel Donnelly",
        "timestamp": 1768126389
    },
    {
        "content": "<p>enabled</p>",
        "id": 567380821,
        "sender_full_name": "Daniel Donnelly",
        "timestamp": 1768126397
    },
    {
        "content": "<p>lake new MyProject math<br>\ncd MyProject<br>\nlake exe cache get</p>\n<p>Using this to create a new project with mathlib.  Not sure why it takes infinity time...  I tried this at raw command line on Windows 10 as well.</p>",
        "id": 567380940,
        "sender_full_name": "Daniel Donnelly",
        "timestamp": 1768126547
    },
    {
        "content": "<p>Yes, even in Vscode, so if I were even doing this with usual dev environment.  It's not working right....</p>",
        "id": 567380984,
        "sender_full_name": "Daniel Donnelly",
        "timestamp": 1768126612
    },
    {
        "content": "<p>Even with Edge browser downloading the .zip of the github repository is taking ages.</p>",
        "id": 567381093,
        "sender_full_name": "Daniel Donnelly",
        "timestamp": 1768126751
    },
    {
        "content": "<p>Well, I kind of see why : I'm extracting the zip now and it's taking another millenium</p>",
        "id": 567381299,
        "sender_full_name": "Daniel Donnelly",
        "timestamp": 1768126964
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/_kbIcr-2bK7TkQfpkhS4XuEz/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/_kbIcr-2bK7TkQfpkhS4XuEz/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"449x291\" src=\"/user_uploads/thumbnail/3121/_kbIcr-2bK7TkQfpkhS4XuEz/image.png/840x560.webp\"></a></div>",
        "id": 567381384,
        "sender_full_name": "Daniel Donnelly",
        "timestamp": 1768127061
    },
    {
        "content": "<p>Okay it can be my internet provider / conn.  So I got more data.  Anyway testing that hypothesis out rn</p>",
        "id": 567383585,
        "sender_full_name": "Daniel Donnelly",
        "timestamp": 1768129391
    },
    {
        "content": "<p>Perhaps you have a very slow hard drive?</p>",
        "id": 567385578,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1768131921
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"236489\">Daniel Donnelly</span> <a href=\"#narrow/channel/270676-lean4/topic/Does.20getting.20lean4.20.2F.20mathlib.20usually.20take.20this.20long.3F/near/567380817\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> it's not that for me.  I don't have AV / firewall on my workstation</p>\n</blockquote>\n<p>Not even the builtin windows defender?</p>",
        "id": 567385589,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1768131936
    },
    {
        "content": "<p>FWIW here's a gif showing what happens on my linux machine if I type in the commands you mentioned above:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">MyProject</span><span class=\"w\"> </span><span class=\"n\">math</span>\n<span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"n\">MyProject</span>\n<span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span>\n</code></pre></div>\n<p>although I'm pretty sure that the third one is unnecessary as it looks to me like all this was done once during the first command. I think I was all ready to go after about 2 minutes.</p>\n<p><a href=\"/user_uploads/3121/s2Qq3x89jP5AfkVNNbwzcZ5U/Peek-2026-01-11-13-01.gif\">Peek 2026-01-11 13-01.gif</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/s2Qq3x89jP5AfkVNNbwzcZ5U/Peek-2026-01-11-13-01.gif\" title=\"Peek 2026-01-11 13-01.gif\"><img data-animated=\"true\" data-original-content-type=\"image/gif\" data-original-dimensions=\"1047x639\" src=\"/user_uploads/thumbnail/3121/s2Qq3x89jP5AfkVNNbwzcZ5U/Peek-2026-01-11-13-01.gif/840x560-anim.webp\"></a></div>",
        "id": 567389028,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1768136579
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> yes, that's all disabled.   <span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> thanks for the GIF, that gives me a good idea of the timing. I'll try it again from the command line to compare.</p>",
        "id": 567435332,
        "sender_full_name": "Daniel Donnelly",
        "timestamp": 1768188228
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span>  it's totally unlike your screenshot.  Stays here for a long time:</p>\n<p>C:\\Lean4Projects\\blah&gt;lake new MyProject math<br>\ninfo: MyProject: no previous manifest, creating one from scratch<br>\ninfo: leanprover-community/mathlib: cloning <a href=\"https://github.com/leanprover-community/mathlib4\">https://github.com/leanprover-community/mathlib4</a></p>\n<p>At least 5 minutes for me.  Could it be because I'm on Starlink satellite internet?</p>",
        "id": 567435684,
        "sender_full_name": "Daniel Donnelly",
        "timestamp": 1768188674
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"236489\">Daniel Donnelly</span> <a href=\"#narrow/channel/270676-lean4/topic/Does.20getting.20lean4.20.2F.20mathlib.20usually.20take.20this.20long.3F/near/567381299\">said</a>:</p>\n<blockquote>\n<p>Well, I kind of see why : I'm extracting the zip now and it's taking another millenium</p>\n</blockquote>\n<p>This looks like the file system or something related is slowing things down. Do you have an external SSD or some other fast usb stick? Then you could try to download the zip to that and extract there to see if whatever is <code>C:</code> is the culprit.</p>",
        "id": 567467505,
        "sender_full_name": "Malvin Gattinger",
        "timestamp": 1768207676
    },
    {
        "content": "<p>1 hour and 20 minutes</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>time lake new MyProject math</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"txt\"><pre><span></span><code>user@host:~$ time lake new MyProject math\ninfo: downloading https://releases.lean-lang.org/lean4/v4.26.0/lean-4.26.0-linux.tar.zst\n479.0 MiB / 479.0 MiB (100 %) 272.0 KiB/s ETA:   0 s\ninfo: installing /home/user/.elan/toolchains/leanprover--lean4---v4.26.0\ninfo: MyProject: no previous manifest, creating one from scratch\ninfo: leanprover-community/mathlib: cloning https://github.com/leanprover-community/mathlib4\ninfo: leanprover-community/mathlib: checking out revision '2df2f0150c275ad53cb3c90f7c98ec15a56a1a67'\ninfo: plausible: cloning https://github.com/leanprover-community/plausible\ninfo: plausible: checking out revision '160af9e8e7d4ae448f3c92edcc5b6a8522453f11'\ninfo: LeanSearchClient: cloning https://github.com/leanprover-community/LeanSearchClient\ninfo: LeanSearchClient: checking out revision '3591c3f664ac3719c4c86e4483e21e228707bfa2'\ninfo: importGraph: cloning https://github.com/leanprover-community/import-graph\ninfo: importGraph: checking out revision 'e9f31324f15ead11048b1443e62c5deaddd055d2'\ninfo: proofwidgets: cloning https://github.com/leanprover-community/ProofWidgets4\ninfo: proofwidgets: checking out revision 'b4fb2aa5290ebf61bc5f80a5375ba642f0a49192'\ninfo: aesop: cloning https://github.com/leanprover-community/aesop\ninfo: aesop: checking out revision '2f6d238744c4cb07fdc91240feaf5d4221a27931'\ninfo: Qq: cloning https://github.com/leanprover-community/quote4\ninfo: Qq: checking out revision '9312503909aa8e8bb392530145cc1677a6298574'\ninfo: batteries: cloning https://github.com/leanprover-community/batteries\ninfo: batteries: checking out revision '24241822ef9d3e7f6a3bcc53ad136e12663db8f3'\ninfo: Cli: cloning https://github.com/leanprover/lean4-cli\ninfo: Cli: checking out revision '933fce7e893f65969714c60cdb4bd8376786044e'\ninfo: mathlib: running post-update hooks\nFetching ProofWidgets cloud release... done!\nCurrent branch: HEAD\nUsing cache (Azure) from origin: leanprover-community/mathlib4\nAttempting to download 7727 file(s) from leanprover-community/mathlib4 cache\nDownloaded: 7724 file(s) [attempted 7724/7727 = 99%, 1 KB/s]\n/home/user/.cache/mathlib/1ce7fb848dccaf60.ltar.part: Transfer failed (error code: 0): OpenSSL SSL_read: Connection timed out, errno 110\nDownloaded: 7726 file(s) [attempted 7727/7727 = 100%, 1 KB/s], 1 failed\n1 download(s) failed\nerror: mathlib: failed to fetch cache\n\nreal  80m40.046s\nuser  2m47.508s\nsys   0m34.581s\n</code></pre></div>\n</div></div>",
        "id": 567511849,
        "sender_full_name": "Shubakur Mitra",
        "timestamp": 1768219075
    },
    {
        "content": "<p>That looks like it didn't actually work, so maybe something took a long time to time out?. On a mac on wireless at work (in the UK) I get 2.5 minutes:</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>time lake new MyProject math</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"txt\"><pre><span></span><code>buzzard@MacBook-Pro temp % time lake new MyProject math\ninfo: downloading https://releases.lean-lang.org/lean4/v4.26.0/lean-4.26.0-darwin_aarch64.tar.zst\nTotal: 464.3 MiB Speed:  14.9 MiB/s\ninfo: installing /Users/buzzard/.elan/toolchains/leanprover--lean4---v4.26.0\ninfo: MyProject: no previous manifest, creating one from scratch\ninfo: leanprover-community/mathlib: cloning https://github.com/leanprover-community/mathlib4\ninfo: leanprover-community/mathlib: checking out revision '2df2f0150c275ad53cb3c90f7c98ec15a56a1a67'\ninfo: plausible: cloning https://github.com/leanprover-community/plausible\ninfo: plausible: checking out revision '160af9e8e7d4ae448f3c92edcc5b6a8522453f11'\ninfo: LeanSearchClient: cloning https://github.com/leanprover-community/LeanSearchClient\ninfo: LeanSearchClient: checking out revision '3591c3f664ac3719c4c86e4483e21e228707bfa2'\ninfo: importGraph: cloning https://github.com/leanprover-community/import-graph\ninfo: importGraph: checking out revision 'e9f31324f15ead11048b1443e62c5deaddd055d2'\ninfo: proofwidgets: cloning https://github.com/leanprover-community/ProofWidgets4\ninfo: proofwidgets: checking out revision 'b4fb2aa5290ebf61bc5f80a5375ba642f0a49192'\ninfo: aesop: cloning https://github.com/leanprover-community/aesop\ninfo: aesop: checking out revision '2f6d238744c4cb07fdc91240feaf5d4221a27931'\ninfo: Qq: cloning https://github.com/leanprover-community/quote4\ninfo: Qq: checking out revision '9312503909aa8e8bb392530145cc1677a6298574'\ninfo: batteries: cloning https://github.com/leanprover-community/batteries\ninfo: batteries: checking out revision '24241822ef9d3e7f6a3bcc53ad136e12663db8f3'\ninfo: Cli: cloning https://github.com/leanprover/lean4-cli\ninfo: Cli: checking out revision '933fce7e893f65969714c60cdb4bd8376786044e'\ninfo: mathlib: running post-update hooks\nFetching ProofWidgets cloud release... done!\nCurrent branch: HEAD\nUsing cache (Azure) from origin: leanprover-community/mathlib4\nAttempting to download 7727 file(s) from leanprover-community/mathlib4 cache\nDownloaded: 7727 file(s) [attempted 7727/7727 = 100%, 59 KB/s]]\nDecompressing 7727 file(s)\nUnpacked in 6773 ms\nCompleted successfully!\nlake new MyProject math  75.91s user 46.70s system 78% cpu 2:36.98 total\nbuzzard@MacBook-Pro temp %\n</code></pre></div>\n</div></div>",
        "id": 567562877,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1768231002
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"236489\">@Daniel Donnelly</span> does <code>git clone https://github.com/leanprover-community/mathlib4</code> work? How long does it take?</p>",
        "id": 567563733,
        "sender_full_name": "Julian Berman",
        "timestamp": 1768231191
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"989333\">@Shubakur Mitra</span> your output shows <code>479.0 MiB / 479.0 MiB (100 %) 272.0 KiB/s </code> -- at 200Kib/s that means like 30 minutes or more is spent just downloading. If you go to <a href=\"https://fast.com/\">https://fast.com/</a> how fast does it say your connection is acting?</p>\n<p>Note also that that 500MB download is a Lean toolchain you didn't have, so if you run it a second time, it will skip the first part but still run the second part -- which still involves downloading stuff of similar size, so there a bunch more time is taken just downloading things over your connection.</p>",
        "id": 567564936,
        "sender_full_name": "Julian Berman",
        "timestamp": 1768231413
    },
    {
        "content": "<p>My comment is not a complaint but a reference point, answering the original question about download times for Lean, Mathlib, and fetching the cache on different machines. Of course, a slow connection is the main culprit here. The \"failed to fetch cache\" error is somewhat misleading; it fetched all but one file (at only 1 KB/s!), and the remaining file can be compiled locally.</p>",
        "id": 567572964,
        "sender_full_name": "Shubakur Mitra",
        "timestamp": 1768233034
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321696\">Julian Berman</span> <a href=\"#narrow/channel/270676-lean4/topic/Does.20getting.20lean4.20.2F.20mathlib.20usually.20take.20this.20long.3F/near/567564936\">said</a>:</p>\n<blockquote>\n<p>that means like 30 minutes or more is spent just downloading.</p>\n</blockquote>\n<p>1 hour and 19 minutes is spent downloading.</p>",
        "id": 567573802,
        "sender_full_name": "Shubakur Mitra",
        "timestamp": 1768233205
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>Downloaded: 7717 file(s) [attempted 7717/7816 = 98%, 651 KB/7816 = 100%, 73 KB/s]Downloaded: 7720 file(s) [attempted 7720/7816 = 98%, 195 KBDownloaded: 7725 file(s) [attempted 7725/7816 = 98%, 434 KBDownloaded: 7768 file(s) [attempted 7768/7816 = 99%, 69 KB/Downloaded: 7785 file(s) [attempted 7785/7816 = 99%, 123 KBDownloaded: 7809 file(s) [attempted 7809/7816 = 99%, 55 KB/Downloaded: 7812 file(s) [attempted 7812/7816 = 99%, 153 KBDownloaded: 7814 file(s) [attempted 7814/7816 = 99%, 73 KB/Downloaded: 7816 file(s) [attempted 7816/7816 = 100%, 73 KB/s]\nDecompressing 7816 file(s)\nC:\\Users\\fruit\\.cache\\mathlib\\c760715337f7bfc0.ltar: removing corrupted file\nC:\\Users\\fruit\\.cache\\mathlib\\69d5a457a2708031.ltar: removing corrupted file\nC:\\Users\\fruit\\.cache\\mathlib\\67b72aceb1067fb5.ltar: removing corrupted file\nC:\\Users\\fruit\\.cache\\mathlib\\cd64103bcfa2d2b6.ltar: removing corrupted file\nC:\\Users\\fruit\\.cache\\mathlib\\5f03f77954\n</code></pre></div>\n<p>I started the command:</p>\n<p>\"lake exe cache get\"</p>\n<p>About 20 minutes ago, and it's still running.  When I saw a lot of console traffic, I felt like an internet god with my T-mobile data plan on my phone.  Now it seems to be stuck at a removing corrupted file line -_-.   Can we possibly get Mathlib in small chunks?</p>",
        "id": 567716879,
        "sender_full_name": "Daniel Donnelly",
        "timestamp": 1768296210
    },
    {
        "content": "<p>Well, I see an issue I have 0MB of space left on my hard drive.  Time to delete some apps.</p>",
        "id": 567717622,
        "sender_full_name": "Daniel Donnelly",
        "timestamp": 1768296447
    },
    {
        "content": "<p>I don't know how many times I've downloaded mathlib4 ;d  My recycle bin is 21GB though....</p>",
        "id": 567718420,
        "sender_full_name": "Daniel Donnelly",
        "timestamp": 1768296670
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321696\">Julian Berman</span> <a href=\"#narrow/channel/270676-lean4/topic/Does.20getting.20lean4.20.2F.20mathlib.20usually.20take.20this.20long.3F/near/567563733\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"236489\">Daniel Donnelly</span> does <code>git clone https://github.com/leanprover-community/mathlib4</code> work? How long does it take?</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"321696\">@Julian Berman</span> Running this now.   </p>\n<p>It took 6minutes :)  But I'm not sure how this relates to lake command.... is there a guide somewhere on what each command does?</p>\n<p>Well, I found this on readme front page of mathlib4:</p>\n<blockquote>\n<p>The complete documentation for contributing to <code>mathlib</code> is located <a href=\"https://leanprover-community.github.io/contribute/index.html\">on the community guide contribute to mathlib</a></p>\n<p>You may want to subscribe to the <code>mathlib4</code> channel on <a href=\"https://leanprover.zulipchat.com/\">Zulip</a> to introduce yourself and your plan to the community. Often you can find community members willing to help you get started and advise you on the fit and feasibility of your project.</p>\n<ul>\n<li>\n<p>To obtain precompiled <code>olean</code> files, run <code>lake exe cache get</code>. (Skipping this step means the next step will be very slow.)</p>\n</li>\n<li>\n<p>To build <code>mathlib4</code> run <code>lake build</code>.</p>\n</li>\n</ul>\n</blockquote>\n<p>Hopefully this method will work for me now that I have free space, internet bandwidth, and know a little bit more of what to do.</p>",
        "id": 567738142,
        "sender_full_name": "Daniel Donnelly",
        "timestamp": 1768302899
    },
    {
        "content": "<p>If it takes 6 minutes to clone mathlib using git then your problem is not with lean, your problem is elsewhere.</p>",
        "id": 567922209,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1768378097
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/270676-lean4/topic/Does.20getting.20lean4.20.2F.20mathlib.20usually.20take.20this.20long.3F/near/567922209\">said</a>:</p>\n<blockquote>\n<p>If it takes 6 minutes to clone mathlib using git then your problem is not with lean, your problem is elsewhere.</p>\n</blockquote>\n<p>Is there an easy way to avoid cloning mathlib <em>repeatedly</em>?</p>",
        "id": 567937020,
        "sender_full_name": "Bbbbbbbbba",
        "timestamp": 1768383134
    },
    {
        "content": "<p>That question is going to be hard to answer without knowing what you are trying to do. Unless you need to create new Lean projects as a fundamental part of your workflow (for example, you're testing the <code>lake new</code> command), you should almost never have to clone Mathlib repeatedly.</p>",
        "id": 567960285,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1768389765
    },
    {
        "content": "<p>Well I just want to organize my work in different projects, and also so that I only need to fix one project at a time when I want to bump up the version.</p>",
        "id": 567960567,
        "sender_full_name": "Bbbbbbbbba",
        "timestamp": 1768389876
    },
    {
        "content": "<p>If you want different versions of Mathlib for different projects to depend on, I don't know any practical way to achieve this without having different clones of Mathlib inside those projects.</p>",
        "id": 567962643,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1768390365
    },
    {
        "content": "<p>You can use <a href=\"https://git-scm.com/docs/git-worktree\">Git worktrees</a> to have only one <code>.git</code> folder, which would save you about 700MB per copy</p>",
        "id": 567974419,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1768393696
    },
    {
        "content": "<p>That's what I use to work on multiple Mathlib things in parallel</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">worktree</span><span class=\"w\"> </span><span class=\"n\">list</span>\n<span class=\"n\">mathlib4</span><span class=\"w\">          </span><span class=\"n\">ae275c9caf8</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">master</span><span class=\"o\">]</span>\n<span class=\"n\">mathlib4</span><span class=\"bp\">-</span><span class=\"n\">copy</span><span class=\"w\">     </span><span class=\"n\">b1e306623a0</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">pr</span><span class=\"bp\">/</span><span class=\"mi\">30658</span><span class=\"o\">]</span>\n<span class=\"n\">mathlib4</span><span class=\"bp\">-</span><span class=\"n\">copy2</span><span class=\"w\">    </span><span class=\"n\">ae275c9caf8</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">feature</span><span class=\"bp\">/</span><span class=\"n\">linter</span><span class=\"bp\">/</span><span class=\"n\">factorial</span><span class=\"bp\">-</span><span class=\"kn\">notation</span><span class=\"o\">]</span>\n<span class=\"n\">mathlib4</span><span class=\"bp\">-</span><span class=\"n\">nightly</span><span class=\"w\">  </span><span class=\"n\">ce00192bf80</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">nightly</span><span class=\"bp\">-</span><span class=\"n\">testing</span><span class=\"bp\">-</span><span class=\"n\">green</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 567974687,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1768393785
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"933054\">@Snir Broshi</span> thanks!  That is really useful and we will need exactly that.</p>",
        "id": 568109657,
        "sender_full_name": "Daniel Donnelly",
        "timestamp": 1768439879
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"933054\">@Snir Broshi</span>  So for my use case I'm assuming I have to do this:</p>\n<p>Have the user first fork Mathlib so that they can create worktree branches inside of it.  But that's not really proper use of git if it's for an project independent of Mathlib.</p>\n<p>What about this: 1) Fork mathlib creating a \"worktree space containing mathlib\" then: 2) Adding in a project (separate github repository) as a git submodule?  </p>\n<p>Would this work?  I am indeed looking for a way to download mathlib once (or whenever needing update) and re-using / linking lean4 projects to that one copy.</p>",
        "id": 571499733,
        "sender_full_name": "Daniel Donnelly",
        "timestamp": 1770056872
    },
    {
        "content": "<p>I don't understand your use case, but I think you're using the word \"worktree\" incorrect here- forks have nothing to do with worktrees, worktrees are a local concept.<br>\nTo use worktrees, <code>git clone</code> mathlib, then if you need multiple versions you can <code>git worktree add ...</code>.<br>\nIf you need these in some Lean copy, you can create the worktrees right where you need them, or use symbolic links to place them inside Lean (<code>mklink /s</code> on Windows, <code>ln -s</code> otherwise)</p>",
        "id": 571501791,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1770057631
    },
    {
        "content": "<p>Decided to not support worktrees unless they create them manually.  At least in version 0.  I think the solutions in the other thread are more appropriate for now.</p>",
        "id": 571506963,
        "sender_full_name": "Daniel Donnelly",
        "timestamp": 1770059592
    }
]