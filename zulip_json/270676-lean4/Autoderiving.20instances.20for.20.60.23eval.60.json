[
    {
        "content": "<p>Should the auto-derivation emit a warning recommending the user add <code>deriving instance Repr for Tp</code>?</p>",
        "id": 476724680,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1728896630
    },
    {
        "content": "<p>In particular:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">⇒</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"c1\">-- works</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">⇒</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- fails</span>\n\n<span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">Repr</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">Tp</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">⇒</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- works</span>\n</code></pre></div>",
        "id": 476724980,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1728896698
    },
    {
        "content": "<p>2 messages were moved here from <a class=\"stream-topic\" data-stream-id=\"270676\" href=\"/#narrow/stream/270676-lean4/topic/Prettyprinting.20the.20result.20of.20an.20.23eval\">#lean4 &gt; Prettyprinting the result of an #eval</a> by <span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span>.</p>",
        "id": 476826067,
        "sender_full_name": "Notification Bot",
        "timestamp": 1728925904
    },
    {
        "content": "<p>This was something I wasn't sure about. I expect autoderivation to be relatively quick, so it's not clear to me anyone needs to be told to add <code>deriving</code> commands themselves. On the other hand, it would be a shame if people didn't know they could speed up <code>#eval</code> a little bit by deriving the instances!</p>\n<p>Recursive autoderivation is still something I am thinking about. The main change was to get <code>#eval</code> into a state where it was even possible to consider autoderivation at all, so the current form is a proof of the concept.</p>\n<p>I'm also considering things like having <code>#eval</code> throw in \"fake\" Repr instances for unrepresentable objects, like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Repr</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">reprPrec</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"&lt;type&gt;\"</span>\n</code></pre></div>\n<p>possibly by having a namespace of <code>scoped</code> instances it can activate.</p>\n<p>Eventually we may even see a ToExpr deriving handler in core. A neat thing for that would be that in truly unrepresentable situations (like functions <code>Nat -&gt; Nat</code>), the pretty printed omissions could have hovers that explain why they are missing.</p>",
        "id": 476826955,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1728926400
    }
]