[
    {
        "content": "<p>Hi I found that <code>elan which lake</code> downloads lean if locally not downloaded yet:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">onriv</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"n\">archdell</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"bp\">~/</span><span class=\"n\">data</span><span class=\"bp\">/</span><span class=\"n\">repos</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"o\">:</span><span class=\"n\">master</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"mi\">59</span><span class=\"o\">:</span><span class=\"mi\">02</span><span class=\"o\">]</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">elan</span><span class=\"w\"> </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">lake</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">downloading</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">lean'</span>\n<span class=\"n\">Total</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mf\">201.1</span><span class=\"w\"> </span><span class=\"n\">MiB</span><span class=\"w\"> </span><span class=\"n\">Speed</span><span class=\"o\">:</span><span class=\"w\">   </span><span class=\"mf\">2.9</span><span class=\"w\"> </span><span class=\"n\">MiB</span><span class=\"bp\">/</span><span class=\"n\">s</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">installing</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">lean'</span>\n<span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">onriv</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.11.0-rc2/bin/lake</span>\n</code></pre></div>\n<p>is it behaving as designed? Currently I am using this command to determine the path of the <code>lake</code> command, I am not sure if it's suitable or should I just assume the lake command is with the format <code>$HOME/.elan/toolchains/&lt;content of lean-toolchain  under project&gt;/bin/lake</code></p>",
        "id": 464875932,
        "sender_full_name": "Shanghe Chen",
        "timestamp": 1724519787
    },
    {
        "content": "<p>Call me wrong, but I believe this is by design as elan always needs at least one lean toolchain to work.<br>\nWhy is that a problem?</p>\n<p>Also, <code>which lake</code> tells me there is a <code>lake</code> executable at <code>/usr/local/bin/lake</code> (which I think is a binary that automatically downloads &amp; uses the correct version depending on the toolchain.</p>\n<p>I use <code>cd MyLeanProject &amp;&amp; lake env printenv ELAN_HOME</code> in a project to determine where <code>.elan/</code> is, but I don't know if that's \"the right way\"</p>",
        "id": 464891798,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1724527405
    },
    {
        "content": "<p>Thanks for the explanation and the test! Yeah maybe I have \"xy\"ed the problem. I am trying to start to lsp server using the following code snippet:</p>\n<div class=\"codehilite\" data-code-language=\"Kotlin\"><pre><span></span><code><span class=\"kd\">private</span><span class=\"w\"> </span><span class=\"kd\">fun</span><span class=\"w\"> </span><span class=\"nf\">setServerCommand</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"kd\">val</span><span class=\"w\"> </span><span class=\"nv\">elan</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">getElan</span><span class=\"p\">()</span>\n<span class=\"w\">    </span><span class=\"kd\">val</span><span class=\"w\"> </span><span class=\"nv\">lake</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"</span><span class=\"si\">$</span><span class=\"n\">elan</span><span class=\"s\"> which lake\"</span><span class=\"p\">.</span><span class=\"na\">runCommand</span><span class=\"p\">(</span><span class=\"n\">File</span><span class=\"p\">(</span><span class=\"n\">project</span><span class=\"p\">.</span><span class=\"na\">basePath</span><span class=\"o\">!!</span><span class=\"p\">)).</span><span class=\"na\">trim</span><span class=\"p\">()</span>\n<span class=\"w\">    </span><span class=\"n\">commands</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">listOf</span><span class=\"p\">(</span><span class=\"n\">lake</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"serve\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"--\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">project</span><span class=\"p\">.</span><span class=\"na\">basePath</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">workingDirectory</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">project</span><span class=\"p\">.</span><span class=\"na\">basePath</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">private</span><span class=\"w\"> </span><span class=\"kd\">fun</span><span class=\"w\"> </span><span class=\"nf\">getElan</span><span class=\"p\">():</span><span class=\"w\"> </span><span class=\"kt\">String</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"kd\">val</span><span class=\"w\"> </span><span class=\"nv\">home</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">System</span><span class=\"p\">.</span><span class=\"na\">getProperty</span><span class=\"p\">(</span><span class=\"s\">\"user.home\"</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"kd\">val</span><span class=\"w\"> </span><span class=\"nv\">elanFile</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">OsUtil</span><span class=\"p\">.</span><span class=\"na\">isWindows</span><span class=\"p\">())</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">Path</span><span class=\"p\">.</span><span class=\"na\">of</span><span class=\"p\">(</span><span class=\"n\">home</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\".elan\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"bin\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"elan.exe\"</span><span class=\"p\">).</span><span class=\"na\">toFile</span><span class=\"p\">()</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">Path</span><span class=\"p\">.</span><span class=\"na\">of</span><span class=\"p\">(</span><span class=\"n\">home</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\".elan\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"bin\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"elan\"</span><span class=\"p\">).</span><span class=\"na\">toFile</span><span class=\"p\">()</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">elanFile</span><span class=\"p\">.</span><span class=\"na\">exists</span><span class=\"p\">())</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"k\">throw</span><span class=\"w\"> </span><span class=\"n\">IllegalStateException</span><span class=\"p\">(</span><span class=\"s\">\"</span><span class=\"si\">$</span><span class=\"n\">elanFile</span><span class=\"s\"> does not exist!\"</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">elanFile</span><span class=\"p\">.</span><span class=\"na\">isFile</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"k\">throw</span><span class=\"w\"> </span><span class=\"n\">IllegalStateException</span><span class=\"p\">(</span><span class=\"s\">\"</span><span class=\"si\">$</span><span class=\"n\">elanFile</span><span class=\"s\"> is not file!\"</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">elanFile</span><span class=\"p\">.</span><span class=\"na\">absolutePath</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>Checking the codebases of vscode-lean4 and lean.nvim it seems no need to handle this and just using the executable from system enviroment is enough. But the editor I am trying to adapt <a href=\"https://youtrack.jetbrains.com/issue/IDEA-347154/The-installed-plugin-doesnt-have-access-to-environment-variables\">failing at getting the system enviroments</a> though.</p>",
        "id": 464951099,
        "sender_full_name": "Shanghe Chen",
        "timestamp": 1724567246
    },
    {
        "content": "<p>Yeah I tested that using the default lake executable and <code>lake env printenv ELAN_HOME</code> it's somekind a dry run. I think it suffices for my purpose. <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">onriv</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"n\">archdell</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"bp\">~/</span><span class=\"n\">data</span><span class=\"bp\">/</span><span class=\"n\">repos</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"o\">:</span><span class=\"n\">master</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">14</span><span class=\"o\">:</span><span class=\"mi\">28</span><span class=\"o\">:</span><span class=\"mi\">10</span><span class=\"o\">]</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">lake</span>\n<span class=\"bp\">/</span><span class=\"n\">usr</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">lake</span>\n\n<span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">onriv</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"n\">archdell</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"bp\">~/</span><span class=\"n\">data</span><span class=\"bp\">/</span><span class=\"n\">repos</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"o\">:</span><span class=\"n\">master</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">14</span><span class=\"o\">:</span><span class=\"mi\">28</span><span class=\"o\">:</span><span class=\"mi\">24</span><span class=\"o\">]</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"n\">printenv</span><span class=\"w\"> </span><span class=\"n\">ELAN_HOME</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">toolchain</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">11</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc2'</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">installed</span>\n</code></pre></div>",
        "id": 464952184,
        "sender_full_name": "Shanghe Chen",
        "timestamp": 1724567558
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 464956380,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1724570272
    },
    {
        "content": "<p>Yeah currently I think that I am kind of not in favor of setting up the environment implicitly as I start the lsp client. But I think checking it works first in the terminal is OK.</p>",
        "id": 464956681,
        "sender_full_name": "Shanghe Chen",
        "timestamp": 1724570434
    }
]