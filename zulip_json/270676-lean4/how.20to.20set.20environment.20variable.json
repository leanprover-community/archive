[
    {
        "content": "<p>How to set environment variable in Lean?</p>",
        "id": 553209046,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1762053551
    },
    {
        "content": "<p>What do you mean by environment variable?</p>",
        "id": 553209084,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762053610
    },
    {
        "content": "<p>environment variable in OS, such as LEAN_ABORT_ON_PANIC</p>",
        "id": 553209111,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1762053645
    },
    {
        "content": "<p>after a quick search I found <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Std.Internal.IO.Async.System.setEnvVar#doc\">docs#Std.Internal.IO.Async.System.setEnvVar</a></p>",
        "id": 553209162,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762053748
    },
    {
        "content": "<p>and also <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Std.Internal.UV.System.osSetenv#doc\">docs#Std.Internal.UV.System.osSetenv</a></p>",
        "id": 553209167,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762053771
    },
    {
        "content": "<p>they're both <code>Internal</code> so I'm not sure if it's meant to be used directly</p>",
        "id": 553209178,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762053795
    },
    {
        "content": "<p>there's stuff to run a command right</p>",
        "id": 553209286,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1762054003
    },
    {
        "content": "<p>yeah</p>",
        "id": 553209370,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762054154
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IO.Process.run#doc\">docs#IO.Process.run</a></p>",
        "id": 553209388,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762054182
    },
    {
        "content": "<p>For a variable like <code>LEAN_ABORT_ON_PANIC</code>, you usually set them when invoking the Lean program, not while the Lean program is running. For example, on the command line you can write <code>LEAN_ABORT_ON_PANIC=1 lake exe myprogram</code>.</p>",
        "id": 553223116,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1762068312
    },
    {
        "content": "<p>But yes, running <code>Std.Internal.IO.Async.System.setEnvVar \"LEAN_ABORT_ON_PANIC\" \"1\"</code> does also work (we're going to stabilize this API soon and move it out of the <code>Internal</code> namespace, so no harm in using it except that the name will change without deprecation sometime soon). I would not recommend doing this though, modifying the behavior of your program like that while it is running is asking for trouble.</p>",
        "id": 553223382,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1762068535
    },
    {
        "content": "<p>Thank you. </p>\n<p>but why this code outputs \"hello\"?<br>\n(fail to abort?)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Std</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"w\"> </span><span class=\"n\">Internal</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Async</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">System</span><span class=\"bp\">.</span><span class=\"n\">setEnvVar</span><span class=\"w\"> </span><span class=\"s2\">\"LEAN_ABORT_ON_PANIC\"</span><span class=\"w\"> </span><span class=\"s2\">\"1\"</span>\n\n<span class=\"c1\">-- \"hello\" appears</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">panic!</span><span class=\"w\"> </span><span class=\"s2\">\"panic message\"</span>\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"n\">a</span>\n\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"s2\">\"hello\"</span>\n</code></pre></div>",
        "id": 553227246,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1762072032
    },
    {
        "content": "<p>It doesn't for me. In VS Code it crashes the server and when runnning <code>lake build</code> it prints the backtrace and then <code>lake</code> reports \"Lean exited with code 134\".</p>",
        "id": 553227432,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1762072206
    },
    {
        "content": "<p>I'm on Windows. It depends on OS?</p>",
        "id": 553227501,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1762072270
    },
    {
        "content": "<p>Ah, yes, from a quick search it looks like it is known that due to the way that we set and access the environment variables, this update is not picked up on on Windows. We could fix this on the Lean side, but it is probably low priority because like I said you should set this environment variable before running your progam.</p>",
        "id": 553227895,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1762072676
    },
    {
        "content": "<p>\"set environment variable before running you program\" works well in Windows, too. </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"mi\">11325</span><span class=\"bp\">@</span><span class=\"n\">gtune</span><span class=\"w\"> </span><span class=\"n\">MINGW64</span><span class=\"w\"> </span><span class=\"bp\">~/</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"k\">by</span><span class=\"bp\">-</span><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">main</span><span class=\"o\">)</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">LEAN_ABORT_ON_PANIC</span><span class=\"bp\">=</span><span class=\"mi\">1</span>\n\n<span class=\"mi\">11325</span><span class=\"bp\">@</span><span class=\"n\">gtune</span><span class=\"w\"> </span><span class=\"n\">MINGW64</span><span class=\"w\"> </span><span class=\"bp\">~/</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"k\">by</span><span class=\"bp\">-</span><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">main</span><span class=\"o\">)</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lean</span><span class=\"w\"> </span><span class=\"c1\">--run LeanByExample/Syntax/Panic/Abort.lean</span>\n<span class=\"n\">panic</span><span class=\"w\"> </span><span class=\"n\">message</span>\n</code></pre></div>",
        "id": 553228105,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1762072876
    },
    {
        "content": "<p>my problem is resolved. Thanks!</p>",
        "id": 553228178,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1762072920
    },
    {
        "content": "<p>oh... in windows, <code>lean --run</code> does not consider this environment variable?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"mi\">11325</span><span class=\"bp\">@</span><span class=\"n\">gtune</span><span class=\"w\"> </span><span class=\"n\">MINGW64</span><span class=\"w\"> </span><span class=\"bp\">~/</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"k\">by</span><span class=\"bp\">-</span><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">main</span><span class=\"o\">)</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">LEAN_ABORT_ON_PANIC</span><span class=\"bp\">=</span><span class=\"mi\">0</span>\n\n<span class=\"mi\">11325</span><span class=\"bp\">@</span><span class=\"n\">gtune</span><span class=\"w\"> </span><span class=\"n\">MINGW64</span><span class=\"w\"> </span><span class=\"bp\">~/</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"k\">by</span><span class=\"bp\">-</span><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">main</span><span class=\"o\">)</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lean</span><span class=\"w\"> </span><span class=\"c1\">--run LeanByExample/Syntax/Panic/Abort.lean</span>\n<span class=\"n\">panic</span><span class=\"w\"> </span><span class=\"n\">message</span>\n</code></pre></div>",
        "id": 553236622,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1762080838
    },
    {
        "content": "<p>the content of <code>LeanByExample/Syntax/Panic/Abort.lean</code> is here:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Std</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"w\"> </span><span class=\"n\">Internal</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Async</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">panic</span><span class=\"w\"> </span><span class=\"s2\">\"panic message\"</span>\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"n\">a</span>\n\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"s2\">\"hello\"</span>\n</code></pre></div>",
        "id": 553236649,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1762080860
    },
    {
        "content": "<p>For <code>LEAN_ABORT_ON_PANIC</code> we only check if the variable has any value at all and interpret this as \"should abort\" (yes, this is inconsistent with <code>LEAN_BACKTRACE</code>). Try <code>unset LEAN_ABORT_ON_PANIC</code>.</p>",
        "id": 553237905,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1762082147
    }
]