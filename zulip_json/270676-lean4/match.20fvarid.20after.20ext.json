[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">ElabTerm</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Meta</span>\n\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"identify_fvar \"</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"o\">:</span><span class=\"n\">ident</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">iID</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">getFVarId</span><span class=\"w\"> </span><span class=\"n\">id</span>\n<span class=\"w\">  </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"a: {iID.name}\"</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"bp\">.</span><span class=\"n\">fvar</span><span class=\"w\"> </span><span class=\"n\">iID</span>\n<span class=\"w\">  </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"b: {i}\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">typ</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">inferType</span><span class=\"w\"> </span><span class=\"n\">i</span>\n<span class=\"w\">  </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"c: {typ}\"</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">identify_fvar</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"c1\">-- a: _uniq.1131 // b: i // c: Nat</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">i</span>\n<span class=\"w\">  </span><span class=\"n\">identify_fvar</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"c1\">-- a: _uniq.1209 // b: _fvar.1209 // unknown free variable `_fvar.1209`</span>\n</code></pre></div>",
        "id": 546029313,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760978062
    },
    {
        "content": "<p>I want to convert an identifier to an FVar, and it works for the first example, but it fails for the second example where the variable is introduced by <code>ext</code>. What's going on here?</p>",
        "id": 546029666,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760978143
    },
    {
        "content": "<p>Did you <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Elab.Tactic.withMainContext#doc\">docs#Lean.Elab.Tactic.withMainContext</a></p>",
        "id": 546033568,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760979100
    },
    {
        "content": "<p>that works; what context was it using? i did some debugging and found that <code>i</code> was just entirely missing from the context</p>",
        "id": 546033770,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760979144
    },
    {
        "content": "<p>oh, it must have been just using the context that was just after <code>by</code> maybe</p>",
        "id": 546033861,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760979168
    },
    {
        "content": "<p>It uses the context at the beginning of the tactic seq I think (but don't rely on that)</p>",
        "id": 546033883,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760979171
    },
    {
        "content": "<p>thanks; i now have a custom tactic for destructing <code>Fin n</code> that is 10 times faster than <code>fin_cases</code> (i'm not kidding)</p>",
        "id": 546034758,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760979390
    },
    {
        "content": "<p>that's probably faster not after?</p>",
        "id": 546034998,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760979454
    },
    {
        "content": "<p>yes, corrected</p>",
        "id": 546035109,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760979481
    },
    {
        "content": "<p>Well <code>fin_cases</code> is kind of weird with what it does</p>",
        "id": 546035141,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760979489
    },
    {
        "content": "<p>I looked at the code since there was a bug and I saw the code and the bug is <del>impossible</del> very awkward to fix without a complete rewrite</p>",
        "id": 546035257,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760979523
    },
    {
        "content": "<p>It's not that complicated so a complete rewrite isn't too bad but</p>",
        "id": 546035379,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760979553
    }
]