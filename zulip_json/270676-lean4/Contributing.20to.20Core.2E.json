[
    {
        "content": "<p>Hi. I have some I think genuinely useful lemmas that really seem to fit into Init.Data.Array.Lemmas and similar places. Is it possibly to contribute such lemmas? I know that the process is different to that of Mathlib but I don't really understand what that difference is.</p>",
        "id": 519136790,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1747666310
    },
    {
        "content": "<p>Fork the core repo. In your fork you add the lemmas you need (best into a separate branch). Then you open a pull request from your fork to the main repo.<br>\nYou will need a label once your PR is ready to review, which you can set writing a comment with the desired label, which should be changelog-library in your case.<br>\nThere is a style guide here: <a href=\"https://github.com/leanprover/lean4/tree/master/doc/std\">https://github.com/leanprover/lean4/tree/master/doc/std</a> , but this should be similar to mathlib</p>",
        "id": 519145123,
        "sender_full_name": "Johannes Tantow",
        "timestamp": 1747668000
    },
    {
        "content": "<p>Thanks.</p>\n<p>An example of what I was intending to contribute:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">getElem_swapIfInBounds</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hk</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">as</span><span class=\"bp\">.</span><span class=\"n\">swapIfInBounds</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">as</span><span class=\"bp\">.</span><span class=\"n\">swapIfInBounds</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">)[</span><span class=\"n\">k</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">]</span><span class=\"bp\">'</span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">h₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span><span class=\"bp\">'</span><span class=\"n\">h₂</span><span class=\"bp\">.</span><span class=\"m\">2</span>\n<span class=\"w\">    </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">]</span><span class=\"bp\">'</span><span class=\"o\">(</span><span class=\"n\">hk</span><span class=\"bp\">.</span><span class=\"n\">trans_eq</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"bp\">.</span><span class=\"n\">size_swapIfInBounds</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"n\">proof_goes_here</span><span class=\"bp\">&gt;</span>\n</code></pre></div>\n<p>Would this be suitable? We seem to have most other <code>getElem</code> lemmas like this.</p>",
        "id": 519146104,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1747668200
    },
    {
        "content": "<p>For the standard library in particular, see <a href=\"https://github.com/leanprover/lean4/blob/master/doc/std/vision.md\">https://github.com/leanprover/lean4/blob/master/doc/std/vision.md</a></p>",
        "id": 519146238,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1747668235
    },
    {
        "content": "<p>Yes, I was just reading that - it said to discuss possible contributions here first (I think?)</p>",
        "id": 519146452,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1747668279
    },
    {
        "content": "<p>That looks like a pretty awkward lemma statement to me</p>",
        "id": 519146894,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747668383
    },
    {
        "content": "<p>By analogy with</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">getElem_swap</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hi</span><span class=\"w\"> </span><span class=\"n\">hj</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hk</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">xs</span><span class=\"bp\">.</span><span class=\"n\">swap</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"n\">hi</span><span class=\"w\"> </span><span class=\"n\">hj</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">xs</span><span class=\"bp\">.</span><span class=\"n\">swap</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"n\">hi</span><span class=\"w\"> </span><span class=\"n\">hj</span><span class=\"o\">)[</span><span class=\"n\">k</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">]</span><span class=\"bp\">'</span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp_all</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n</code></pre></div>",
        "id": 519147166,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1747668449
    },
    {
        "content": "<p>Which this seems similar to? I am not seeing the awkwardness.</p>",
        "id": 519147249,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1747668468
    },
    {
        "content": "<p>Well, except in so far as <code>swapIfInBounds</code> is an awkward function.</p>",
        "id": 519147500,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1747668513
    },
    {
        "content": "<p>I'd suggest splitting it into multiple lemmas, one for each branch of the <code>if</code></p>",
        "id": 519147561,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747668529
    },
    {
        "content": "<p>Which <code>swap</code> also does. But I guess the existence of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Array.getElem_swap#doc\">docs#Array.getElem_swap</a> is sufficient to justify your lemma in addition to those pieces.</p>",
        "id": 519147680,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747668554
    },
    {
        "content": "<p>Yes, I wouldn't have the full fat lemma without that already existing. Sometimes it is useful to just hit the <code>getElem</code> on the head with no preconditions.</p>",
        "id": 519147828,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1747668590
    },
    {
        "content": "<p>(I was also going to add the other lemmas.)</p>",
        "id": 519147950,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1747668610
    },
    {
        "content": "<p>Hmm - elan is failing in these files (I assume because they are part of the bootstrapping process?). Getting errors like: <code>error: no such release: lean4-stage0</code>.</p>",
        "id": 519150816,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1747669243
    },
    {
        "content": "<p>do I have to make lean locally?</p>",
        "id": 519150941,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1747669273
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/blob/master/doc/dev/index.md#dev-setup-using-elan\">https://github.com/leanprover/lean4/blob/master/doc/dev/index.md#dev-setup-using-elan</a></p>\n<p>Ah it looks like this is what I need to do?</p>",
        "id": 519151566,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1747669416
    },
    {
        "content": "<p>I think there's also a gitpod setup that kicks off most of the build for you</p>",
        "id": 519161166,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747671648
    },
    {
        "content": "<p>(but takes about half an hour before you can start writing Lean code)</p>",
        "id": 519161207,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747671659
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"619540\">Johannes Tantow</span> <a href=\"#narrow/channel/270676-lean4/topic/Contributing.20to.20Core.2E/near/519145123\">said</a>:</p>\n<blockquote>\n<p>Fork the core repo. In your fork you add the lemmas you need (best into a separate branch). Then you open a pull request from your fork to the main repo.<br>\nYou will need a label once your PR is ready to review, which you can set writing a comment with the desired label, which should be changelog-library in your case.<br>\nThere is a style guide here: <a href=\"https://github.com/leanprover/lean4/tree/master/doc/std\">https://github.com/leanprover/lean4/tree/master/doc/std</a> , but this should be similar to mathlib</p>\n</blockquote>\n<p>How is this, from a \"correct form\" point of view? <a href=\"https://github.com/leanprover/lean4/pull/8406\">lean4#8406</a></p>",
        "id": 519170100,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1747673842
    }
]