[
    {
        "content": "<p>When building a shared library and linking a dependency of that shared library statically via <code>moreLinkObjs = [\"pkg/tgt:static\"]</code> (as in <a class=\"stream-topic\" data-stream-id=\"270676\" href=\"/#narrow/channel/270676-lean4/topic/Load.20plugin.20during.20build.3F/with/564120940\">#lean4 &gt; Load plugin during build?</a>), sometimes I see a</p>\n<blockquote>\n<p>⚠ [710/765] Built Batteries.Data.Char.Basic:c.o<br>\nwarning: /Users/thomas/LeanContribution/thorimur/mathlib4/.lake/packages/batteries/.lake/build/ir/Batteries/Data/Char/Basic.c.o.export.trace: offset 0: unexpected end of input</p>\n</blockquote>\n<p>and this <em>seems</em> to break things when using the shared library as a plugin later (by emitting a similar \"offset 0\" error). But sometimes, it builds without issue.</p>\n<p>However, I tried minimizing, and have been unsuccessful. :( This only seems to happen on the branch I'm using for experimenting with making Mathlib.Init a plugin, which you can find at <a href=\"https://github.com/leanprover-community/mathlib4/pull/33015\">#33015</a> (draft PR created only for convenient sharing).</p>\n<p>(Note for the concerned reader: I have zero plans to actually make Mathlib.Init a plugin—it's just a really useful test case for exploring plugins due to its complexity and convenient \"separation\" from Mathlib! :) )</p>\n<p>To be clear, what I'm running here is <code>lake build MathlibInit</code>. You can see a log demonstrating the nondeterminism here (the second <code>lake build MathlibInit</code> is successful, but the third has different errors!)</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>shell log</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>thomas@trm<span class=\"w\"> </span>mathlib4<span class=\"w\"> </span>%<span class=\"w\"> </span>rm<span class=\"w\"> </span>-rf<span class=\"w\"> </span>./.lake\nthomas@trm<span class=\"w\"> </span>mathlib4<span class=\"w\"> </span>%<span class=\"w\"> </span>lake<span class=\"w\"> </span>build<span class=\"w\"> </span>MathlibInit\ninfo:<span class=\"w\"> </span>plausible:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/leanprover-community/plausible\ninfo:<span class=\"w\"> </span>plausible:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'8d3713f36dda48467eb61f8c1c4db89c49a6251a'</span>\ninfo:<span class=\"w\"> </span>LeanSearchClient:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/leanprover-community/LeanSearchClient\ninfo:<span class=\"w\"> </span>LeanSearchClient:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'19e5f5cc9c21199be466ef99489e3acab370f079'</span>\ninfo:<span class=\"w\"> </span>importGraph:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/leanprover-community/import-graph\ninfo:<span class=\"w\"> </span>importGraph:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'4eb26e1a4806b200ddfe5179d0c2a0fae56c54a7'</span>\ninfo:<span class=\"w\"> </span>proofwidgets:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/leanprover-community/ProofWidgets4\ninfo:<span class=\"w\"> </span>proofwidgets:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'ef8377f31b5535430b6753a974d685b0019d0681'</span>\ninfo:<span class=\"w\"> </span>aesop:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/leanprover-community/aesop\ninfo:<span class=\"w\"> </span>aesop:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'fb12f5535c80e40119286d9575c9393562252d21'</span>\ninfo:<span class=\"w\"> </span>Qq:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/leanprover-community/quote4\ninfo:<span class=\"w\"> </span>Qq:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'523ec6fc8062d2f470fdc8de6f822fe89552b5e6'</span>\ninfo:<span class=\"w\"> </span>batteries:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/leanprover-community/batteries\ninfo:<span class=\"w\"> </span>batteries:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'6254bed25866358ce4f841fa5a13b77de04ffbc8'</span>\ninfo:<span class=\"w\"> </span>Cli:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/leanprover/lean4-cli\ninfo:<span class=\"w\"> </span>Cli:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'726b98c53e2da249c1de768fbbbb5e67bc9cef60'</span>\n⚠<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">710</span>/765<span class=\"o\">]</span><span class=\"w\"> </span>Built<span class=\"w\"> </span>Batteries.Data.Char.Basic:c.o\nwarning:<span class=\"w\"> </span>/Users/thomas/LeanContribution/thorimur/mathlib4/.lake/packages/batteries/.lake/build/ir/Batteries/Data/Char/Basic.c.o.export.trace:<span class=\"w\"> </span>offset<span class=\"w\"> </span><span class=\"m\">0</span>:<span class=\"w\"> </span>unexpected<span class=\"w\"> </span>end<span class=\"w\"> </span>of<span class=\"w\"> </span>input\nBuild<span class=\"w\"> </span>completed<span class=\"w\"> </span>successfully<span class=\"w\"> </span><span class=\"o\">(</span><span class=\"m\">765</span><span class=\"w\"> </span><span class=\"nb\">jobs</span><span class=\"o\">)</span>.\nthomas@trm<span class=\"w\"> </span>mathlib4<span class=\"w\"> </span>%<span class=\"w\"> </span>rm<span class=\"w\"> </span>-rf<span class=\"w\"> </span>./.lake\nthomas@trm<span class=\"w\"> </span>mathlib4<span class=\"w\"> </span>%<span class=\"w\"> </span>lake<span class=\"w\"> </span>build<span class=\"w\"> </span>MathlibInit\ninfo:<span class=\"w\"> </span>plausible:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/leanprover-community/plausible\ninfo:<span class=\"w\"> </span>plausible:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'8d3713f36dda48467eb61f8c1c4db89c49a6251a'</span>\ninfo:<span class=\"w\"> </span>LeanSearchClient:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/leanprover-community/LeanSearchClient\ninfo:<span class=\"w\"> </span>LeanSearchClient:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'19e5f5cc9c21199be466ef99489e3acab370f079'</span>\ninfo:<span class=\"w\"> </span>importGraph:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/leanprover-community/import-graph\ninfo:<span class=\"w\"> </span>importGraph:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'4eb26e1a4806b200ddfe5179d0c2a0fae56c54a7'</span>\ninfo:<span class=\"w\"> </span>proofwidgets:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/leanprover-community/ProofWidgets4\ninfo:<span class=\"w\"> </span>proofwidgets:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'ef8377f31b5535430b6753a974d685b0019d0681'</span>\ninfo:<span class=\"w\"> </span>aesop:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/leanprover-community/aesop\ninfo:<span class=\"w\"> </span>aesop:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'fb12f5535c80e40119286d9575c9393562252d21'</span>\ninfo:<span class=\"w\"> </span>Qq:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/leanprover-community/quote4\ninfo:<span class=\"w\"> </span>Qq:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'523ec6fc8062d2f470fdc8de6f822fe89552b5e6'</span>\ninfo:<span class=\"w\"> </span>batteries:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/leanprover-community/batteries\ninfo:<span class=\"w\"> </span>batteries:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'6254bed25866358ce4f841fa5a13b77de04ffbc8'</span>\ninfo:<span class=\"w\"> </span>Cli:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/leanprover/lean4-cli\ninfo:<span class=\"w\"> </span>Cli:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'726b98c53e2da249c1de768fbbbb5e67bc9cef60'</span>\nBuild<span class=\"w\"> </span>completed<span class=\"w\"> </span>successfully<span class=\"w\"> </span><span class=\"o\">(</span><span class=\"m\">768</span><span class=\"w\"> </span><span class=\"nb\">jobs</span><span class=\"o\">)</span>.\nthomas@trm<span class=\"w\"> </span>mathlib4<span class=\"w\"> </span>%<span class=\"w\"> </span>rm<span class=\"w\"> </span>-rf<span class=\"w\"> </span>./.lake\nthomas@trm<span class=\"w\"> </span>mathlib4<span class=\"w\"> </span>%<span class=\"w\"> </span>lake<span class=\"w\"> </span>build<span class=\"w\"> </span>MathlibInit\ninfo:<span class=\"w\"> </span>plausible:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/leanprover-community/plausible\ninfo:<span class=\"w\"> </span>plausible:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'8d3713f36dda48467eb61f8c1c4db89c49a6251a'</span>\ninfo:<span class=\"w\"> </span>LeanSearchClient:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/leanprover-community/LeanSearchClient\ninfo:<span class=\"w\"> </span>LeanSearchClient:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'19e5f5cc9c21199be466ef99489e3acab370f079'</span>\ninfo:<span class=\"w\"> </span>importGraph:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/leanprover-community/import-graph\ninfo:<span class=\"w\"> </span>importGraph:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'4eb26e1a4806b200ddfe5179d0c2a0fae56c54a7'</span>\ninfo:<span class=\"w\"> </span>proofwidgets:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/leanprover-community/ProofWidgets4\ninfo:<span class=\"w\"> </span>proofwidgets:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'ef8377f31b5535430b6753a974d685b0019d0681'</span>\ninfo:<span class=\"w\"> </span>aesop:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/leanprover-community/aesop\ninfo:<span class=\"w\"> </span>aesop:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'fb12f5535c80e40119286d9575c9393562252d21'</span>\ninfo:<span class=\"w\"> </span>Qq:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/leanprover-community/quote4\ninfo:<span class=\"w\"> </span>Qq:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'523ec6fc8062d2f470fdc8de6f822fe89552b5e6'</span>\ninfo:<span class=\"w\"> </span>batteries:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/leanprover-community/batteries\ninfo:<span class=\"w\"> </span>batteries:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'6254bed25866358ce4f841fa5a13b77de04ffbc8'</span>\ninfo:<span class=\"w\"> </span>Cli:<span class=\"w\"> </span>cloning<span class=\"w\"> </span>https://github.com/leanprover/lean4-cli\ninfo:<span class=\"w\"> </span>Cli:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'726b98c53e2da249c1de768fbbbb5e67bc9cef60'</span>\n⚠<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">510</span>/767<span class=\"o\">]</span><span class=\"w\"> </span>Built<span class=\"w\"> </span>Batteries.Control.Monad:c.o\nwarning:<span class=\"w\"> </span>/Users/thomas/LeanContribution/thorimur/mathlib4/.lake/packages/batteries/.lake/build/ir/Batteries/Control/Monad.c.o.export.trace:<span class=\"w\"> </span>offset<span class=\"w\"> </span><span class=\"m\">0</span>:<span class=\"w\"> </span>unexpected<span class=\"w\"> </span>end<span class=\"w\"> </span>of<span class=\"w\"> </span>input\n⚠<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">623</span>/767<span class=\"o\">]</span><span class=\"w\"> </span>Built<span class=\"w\"> </span>Batteries.Data.Vector:c.o\nwarning:<span class=\"w\"> </span>/Users/thomas/LeanContribution/thorimur/mathlib4/.lake/packages/batteries/.lake/build/ir/Batteries/Data/Vector.c.o.export.trace:<span class=\"w\"> </span>offset<span class=\"w\"> </span><span class=\"m\">0</span>:<span class=\"w\"> </span>unexpected<span class=\"w\"> </span>end<span class=\"w\"> </span>of<span class=\"w\"> </span>input\nBuild<span class=\"w\"> </span>completed<span class=\"w\"> </span>successfully<span class=\"w\"> </span><span class=\"o\">(</span><span class=\"m\">767</span><span class=\"w\"> </span><span class=\"nb\">jobs</span><span class=\"o\">)</span>.\n</code></pre></div>\n</div></div>\n<p>And for reference, here's an example of the similar error I see upon <code>lake build Mathlib</code> sometimes:</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>lake build Mathlib error</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>✖<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">16</span>/653<span class=\"o\">]</span><span class=\"w\"> </span>Building<span class=\"w\"> </span>MathlibInit.Linter.Header\ntrace:<span class=\"w\"> </span>.&gt;<span class=\"w\"> </span><span class=\"nv\">LEAN_PATH</span><span class=\"o\">=</span>/Users/thomas/LeanContribution/thorimur/mathlib4/.lake/packages/Cli/.lake/build/lib/lean:/Users/thomas/LeanContribution/thorimur/mathlib4/.lake/packages/batteries/.lake/build/lib/lean:/Users/thomas/LeanContribution/thorimur/mathlib4/.lake/packages/Qq/.lake/build/lib/lean:/Users/thomas/LeanContribution/thorimur/mathlib4/.lake/packages/aesop/.lake/build/lib/lean:/Users/thomas/LeanContribution/thorimur/mathlib4/.lake/packages/proofwidgets/.lake/build/lib/lean:/Users/thomas/LeanContribution/thorimur/mathlib4/.lake/packages/importGraph/.lake/build/lib/lean:/Users/thomas/LeanContribution/thorimur/mathlib4/.lake/packages/LeanSearchClient/.lake/build/lib/lean:/Users/thomas/LeanContribution/thorimur/mathlib4/.lake/packages/plausible/.lake/build/lib/lean:/Users/thomas/LeanContribution/thorimur/mathlib4/.lake/build/lib/lean<span class=\"w\"> </span>/Users/thomas/.elan/toolchains/leanprover--lean4---v4.27.0-rc1/bin/lean<span class=\"w\"> </span>/Users/thomas/LeanContribution/thorimur/mathlib4/MathlibInit/Linter/Header.lean<span class=\"w\"> </span>-o<span class=\"w\"> </span>/Users/thomas/LeanContribution/thorimur/mathlib4/.lake/build/lib/lean/MathlibInit/Linter/Header.olean<span class=\"w\"> </span>-i<span class=\"w\"> </span>/Users/thomas/LeanContribution/thorimur/mathlib4/.lake/build/lib/lean/MathlibInit/Linter/Header.ilean<span class=\"w\"> </span>-c<span class=\"w\"> </span>/Users/thomas/LeanContribution/thorimur/mathlib4/.lake/build/ir/MathlibInit/Linter/Header.c<span class=\"w\"> </span>--setup<span class=\"w\"> </span>/Users/thomas/LeanContribution/thorimur/mathlib4/.lake/build/ir/MathlibInit/Linter/Header.setup.json<span class=\"w\"> </span>--json\ninfo:<span class=\"w\"> </span>stderr:\nfailed<span class=\"w\"> </span>to<span class=\"w\"> </span>load<span class=\"w\"> </span>header<span class=\"w\"> </span>from<span class=\"w\"> </span>/Users/thomas/LeanContribution/thorimur/mathlib4/.lake/build/ir/MathlibInit/Linter/Header.setup.json:<span class=\"w\"> </span>offset<span class=\"w\"> </span><span class=\"m\">0</span>:<span class=\"w\"> </span>unexpected<span class=\"w\"> </span>end<span class=\"w\"> </span>of<span class=\"w\"> </span>input\nerror:<span class=\"w\"> </span>Lean<span class=\"w\"> </span>exited<span class=\"w\"> </span>with<span class=\"w\"> </span>code<span class=\"w\"> </span><span class=\"m\">1</span>\n</code></pre></div>\n</div></div>\n<p>(This occurs for many different files referencing files in <code>MathlibInit</code>.)</p>",
        "id": 564344200,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1766006342
    }
]