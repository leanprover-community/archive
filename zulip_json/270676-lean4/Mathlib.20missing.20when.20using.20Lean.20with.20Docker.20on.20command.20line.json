[
    {
        "content": "<p>I'm new to Lean and am interested in a non-standard use case. I'm not using VSCode or Emacs to run Lean interactively. Instead, I have a Dockerfile and want to run Lean on the command line.</p>\n<p>I've posted a question to <a href=\"https://proofassistants.stackexchange.com/questions/4616/mathlib-missing-when-using-lean-with-docker-on-command-line\">Proof Assistants on Stack Exchange</a>. If there's a good channel to ask in Zulip I'm not sure which channel is most relevant.</p>",
        "id": 493113273,
        "sender_full_name": "Ben",
        "timestamp": 1736616744
    },
    {
        "content": "<p>You're not supposed to run <code>lean test.lean</code> directly. You can run <code>lake build ProjectName.test</code> instead. The reason <code>lake build</code> by itself does nothing is because it builds the <code>ProjectName.lean</code> file at the root of your project, which you probably haven't edited.</p>",
        "id": 493114146,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736617558
    },
    {
        "content": "<p>If you encounter cache issues, it's a known issue with the most recent unstable version of lean. Take a look at <a class=\"message-link\" href=\"/#narrow/channel/113488-general/topic/Updating.20to.204.2E15.2E0/near/492094698\">#general &gt; Updating to 4.15.0 @ ðŸ’¬</a> for how to revert to v4.15.0</p>",
        "id": 493114251,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736617646
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"325367\">Mauricio Collares</span> <a href=\"#narrow/channel/270676-lean4/topic/Mathlib.20missing.20when.20using.20Lean.20with.20Docker.20on.20command.20line/near/493114146\">said</a>:</p>\n<blockquote>\n<p>You're not supposed to run <code>lean test.lean</code> directly. You can run <code>lake build test</code> instead.</p>\n</blockquote>\n<p>Here's what I get when, in <code>/opt/new_project/project_name/</code>, I run that:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">test</span>\n<span class=\"n\">Build</span><span class=\"w\"> </span><span class=\"n\">completed</span><span class=\"w\"> </span><span class=\"n\">successfully</span><span class=\"bp\">.</span>\n</code></pre></div>\n<p>But nothing is produced from that successful build as far as I can tell</p>",
        "id": 493114337,
        "sender_full_name": "Ben",
        "timestamp": 1736617717
    },
    {
        "content": "<p>If <code>test.lean</code> contains errors, do you get an error when running <code>lake build test</code> or <code>lake build ProjectName.test</code>?</p>",
        "id": 493114383,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736617776
    },
    {
        "content": "<p>Build artifacts are in <code>.lake/build</code> by default</p>",
        "id": 493114464,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736617829
    },
    {
        "content": "<p>Thanks for the feedback! As you might be able to tell, I'm new to Lean. The lack of documentation for my use case is challenging.</p>\n<p>No errors from the build. Interestingly, when I run </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">ProjectName</span><span class=\"bp\">.</span><span class=\"n\">test</span>\n<span class=\"bp\">â£¾</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">371</span><span class=\"bp\">/</span><span class=\"mi\">635</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Running</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Simps</span><span class=\"bp\">.</span><span class=\"n\">Basic</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"n\">more</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>it looks like Mathlib is being found...</p>\n<p>Regarding the version, I do have the latest:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">lean</span><span class=\"w\"> </span><span class=\"c1\">--version</span>\n<span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"mf\">4.16</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">aarch64</span><span class=\"bp\">-</span><span class=\"n\">unknown</span><span class=\"bp\">-</span><span class=\"n\">linux</span><span class=\"bp\">-</span><span class=\"n\">gnu</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">commit</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">c9a488bea56</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Release</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>so I've added <code>rev = \"v4.15.0\"</code> to <code>lakefile.toml</code></p>\n<p>The build command did produce <code>test.c</code> in <code>.lake/build/ir/ProjectName/test.c</code> </p>\n<p>Is there no way to just run <code>lean test.lean</code>? I have to compile the file to .c as part of a project?</p>",
        "id": 493114839,
        "sender_full_name": "Ben",
        "timestamp": 1736618250
    },
    {
        "content": "<p>Bare <code>lean</code> does not handle external packages, but if you really want you can use <code>lake lean test.lean</code></p>",
        "id": 493115122,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736618497
    },
    {
        "content": "<p>It still generates a <code>test.c</code> file, though</p>",
        "id": 493115377,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736618675
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"325367\">Mauricio Collares</span> <a href=\"#narrow/channel/270676-lean4/topic/Mathlib.20missing.20when.20using.20Lean.20with.20Docker.20on.20command.20line/near/493115122\">said</a>:</p>\n<blockquote>\n<p>Bare <code>lean</code> does not handle external packages, but if you really want you can use <code>lake lean test.lean</code></p>\n</blockquote>\n<p>Perfect! Now I get</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">opt</span><span class=\"bp\">/</span><span class=\"n\">new_project</span><span class=\"bp\">/</span><span class=\"n\">project_name</span>\n<span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">lean</span><span class=\"w\"> </span><span class=\"n\">ProjectName</span><span class=\"bp\">/</span><span class=\"n\">test</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"n\">TopologicalSpace</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span>\n</code></pre></div>",
        "id": 493115389,
        "sender_full_name": "Ben",
        "timestamp": 1736618691
    },
    {
        "content": "<p>Note that <code>lake build ProjectName.test</code> also \"runs\" your <code>#check</code> commands and the like, so it should be indistinguishable from the above command (I think?)</p>",
        "id": 493115561,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736618861
    },
    {
        "content": "<p>No. Here's what I get:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>root@7d9883e60726:/opt/new_project/project_name#<span class=\"w\"> </span>ls\nlakefile.toml<span class=\"w\">  </span>lake-manifest.json<span class=\"w\">  </span>lean-toolchain<span class=\"w\">  </span>ProjectName<span class=\"w\">  </span>ProjectName.lean<span class=\"w\">  </span>README.md\nroot@7d9883e60726:/opt/new_project/project_name#<span class=\"w\"> </span>ls<span class=\"w\"> </span>ProjectName\nBasic.lean<span class=\"w\">  </span>test.lean\nroot@7d9883e60726:/opt/new_project/project_name#<span class=\"w\"> </span>lake<span class=\"w\"> </span>lean<span class=\"w\"> </span>ProjectName/test.lean\nTopologicalSpace.<span class=\"o\">{</span>u<span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span>X<span class=\"w\"> </span>:<span class=\"w\"> </span>Type<span class=\"w\"> </span>u<span class=\"o\">)</span><span class=\"w\"> </span>:<span class=\"w\"> </span>Type<span class=\"w\"> </span>u\nroot@7d9883e60726:/opt/new_project/project_name#<span class=\"w\"> </span>lake<span class=\"w\"> </span>lean<span class=\"w\"> </span>ProjectName.test\nerror:<span class=\"w\"> </span>no<span class=\"w\"> </span>such<span class=\"w\"> </span>file<span class=\"w\"> </span>or<span class=\"w\"> </span>directory<span class=\"w\"> </span><span class=\"o\">(</span>error<span class=\"w\"> </span>code:<span class=\"w\"> </span><span class=\"m\">2</span><span class=\"o\">)</span>\n<span class=\"w\">  </span>file:<span class=\"w\"> </span>ProjectName.test\n</code></pre></div>",
        "id": 493115692,
        "sender_full_name": "Ben",
        "timestamp": 1736618958
    },
    {
        "content": "<p>That's not the command I suggested :) <code>lake build</code> and <code>lake lean</code> expect different arguments. But I'm not saying you should use <code>lake build</code>, I was just pointing out an alternative:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">ProjectName</span><span class=\"bp\">.</span><span class=\"n\">test</span>\n<span class=\"n\">â„¹</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">635</span><span class=\"bp\">/</span><span class=\"mi\">635</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">ProjectName</span><span class=\"bp\">.</span><span class=\"n\">test</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">././././</span><span class=\"n\">ProjectName</span><span class=\"bp\">/</span><span class=\"n\">test</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TopologicalSpace</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span>\n<span class=\"n\">Build</span><span class=\"w\"> </span><span class=\"n\">completed</span><span class=\"w\"> </span><span class=\"n\">successfully</span><span class=\"bp\">.</span>\n\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">lean</span><span class=\"w\"> </span><span class=\"n\">ProjectName</span><span class=\"bp\">/</span><span class=\"n\">test</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"n\">TopologicalSpace</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span>\n</code></pre></div>",
        "id": 493116101,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736619303
    },
    {
        "content": "<p>Ah, thanks for explaining. My mistake for not reading carefully. </p>\n<p>Would you like to claim credit on <a href=\"https://proofassistants.stackexchange.com/questions/4616/mathlib-missing-when-using-lean-with-docker-on-command-line\">Stack Exchange</a> for answering my question? (Or should post the answer?)</p>",
        "id": 493116238,
        "sender_full_name": "Ben",
        "timestamp": 1736619429
    },
    {
        "content": "<p>No need, thanks for asking! But I'm happy with you (or someone else) posting it as an answer there.</p>",
        "id": 493116357,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736619516
    }
]