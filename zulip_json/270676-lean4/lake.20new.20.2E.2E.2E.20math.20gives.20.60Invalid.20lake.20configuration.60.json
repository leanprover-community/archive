[
    {
        "content": "<p>This is what I get after running <code>lake new boltonworkspace math</code> and opening <code>Boltonworkspace/Basic.lean</code>.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">`/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">boltonbailey</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.16.0-rc2/bin/lake setup-file /Users/boltonbailey/Documents/MyDocuments/Professional/numina-all-files/contribution/boltonworkspace/Boltonworkspace/Basic.lean Init --no-build --no-cache` failed:</span>\n\n<span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">boltonworkspace</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">previous</span><span class=\"w\"> </span><span class=\"n\">manifest</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">creating</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">scratch</span>\n<span class=\"n\">trace</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">boltonworkspace</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">updating</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">mathlib'</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"o\">{}</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">.</span><span class=\"n\">git</span>\n<span class=\"n\">trace</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">.&gt;</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">clone</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">.</span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span>\n<span class=\"n\">trace</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"n\">Cloning</span><span class=\"w\"> </span><span class=\"n\">into</span><span class=\"w\"> </span><span class=\"bp\">'././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib'</span><span class=\"bp\">...</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">RPC</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">HTTP</span><span class=\"w\"> </span><span class=\"mi\">400</span><span class=\"w\"> </span><span class=\"n\">curl</span><span class=\"w\"> </span><span class=\"mi\">22</span><span class=\"w\"> </span><span class=\"n\">The</span><span class=\"w\"> </span><span class=\"n\">requested</span><span class=\"w\"> </span><span class=\"n\">URL</span><span class=\"w\"> </span><span class=\"n\">returned</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">400</span>\n<span class=\"n\">fatal</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">packfile'</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">external</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">git'</span><span class=\"w\"> </span><span class=\"n\">exited</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mi\">128</span>\n<span class=\"n\">Invalid</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">configuration</span><span class=\"bp\">.</span><span class=\"w\">  </span><span class=\"n\">Please</span><span class=\"w\"> </span><span class=\"n\">restart</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">server</span><span class=\"w\"> </span><span class=\"n\">after</span><span class=\"w\"> </span><span class=\"n\">fixing</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">configuration</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"bp\">.</span>\n</code></pre></div>\n<p>Why is it telling me I have an invalid Lake configuration file? I Haven't touched it at all, it's exactly what the lake new command gave:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lake</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">DSL</span>\n\n<span class=\"n\">package</span><span class=\"w\"> </span><span class=\"bp\">«</span><span class=\"n\">boltonworkspace</span><span class=\"bp\">»</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"c1\">-- Settings applied to both builds and interactive editing</span>\n<span class=\"w\">  </span><span class=\"n\">leanOptions</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span>\n<span class=\"w\">    </span><span class=\"bp\">⟨</span><span class=\"ss\">`pp.unicode.fun</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"c1\">-- pretty-prints `fun a ↦ b`</span>\n<span class=\"w\">  </span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"c1\">-- add any additional package configuration options here</span>\n\n<span class=\"n\">require</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">git</span>\n<span class=\"w\">  </span><span class=\"s2\">\"https://github.com/leanprover-community/mathlib4.git\"</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">default_target</span><span class=\"kd\">]</span>\n<span class=\"n\">lean_lib</span><span class=\"w\"> </span><span class=\"bp\">«</span><span class=\"n\">Boltonworkspace</span><span class=\"bp\">»</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"c1\">-- add any library configuration options here</span>\n</code></pre></div>",
        "id": 494896833,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1737400607
    },
    {
        "content": "<p>Is it a network error? Can you connect to GitHub?</p>",
        "id": 494914486,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1737407757
    },
    {
        "content": "<p>I guess it probably has something to do with the network, I've seen the git part of the error message when using git clone on a non-mathlib related project. Nevertheless, I am still concerned about why it would be saying the lakefile is bad when its the network that's the issue.</p>",
        "id": 494914728,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1737407858
    },
    {
        "content": "<p>I also asked this <a href=\"#narrow/channel/113488-general/topic/Cloning.20mathematics.20in.20lean.20repo/near/494681480\">here</a>, but I'll ask again - there a way to get lake to use ssh rather than http?</p>",
        "id": 494914869,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1737407904
    },
    {
        "content": "<p>I do not know about the ssh vs http answer, but maybe <a href=\"#narrow/channel/287929-mathlib4/topic/cache.20rebuilding.20proofwidgets.20JS/near/477824133\">this conversation</a> can be useful?</p>",
        "id": 494915410,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1737408127
    },
    {
        "content": "<p>(My hunch based on what I understood from that conversation is that <code>lake</code> prefers it if you use <code>http</code> rather than <code>ssh</code>, but I am not sure.)</p>",
        "id": 494915813,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1737408302
    },
    {
        "content": "<p>Indeed, it looks interesting, but I don't seem to have this <code>insteadOf</code> in my gitconfig</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">credential</span><span class=\"bp\">.</span><span class=\"n\">helper</span><span class=\"bp\">=</span><span class=\"n\">osxkeychain</span>\n<span class=\"n\">init</span><span class=\"bp\">.</span><span class=\"n\">defaultbranch</span><span class=\"bp\">=</span><span class=\"n\">main</span>\n<span class=\"n\">user</span><span class=\"bp\">.</span><span class=\"n\">name</span><span class=\"bp\">=</span><span class=\"n\">Bolton</span><span class=\"w\"> </span><span class=\"n\">Bailey</span>\n<span class=\"n\">user</span><span class=\"bp\">.</span><span class=\"n\">email</span><span class=\"bp\">=</span><span class=\"n\">bolton</span><span class=\"bp\">.</span><span class=\"n\">bailey</span><span class=\"bp\">@</span><span class=\"n\">gmail</span><span class=\"bp\">.</span><span class=\"n\">com</span>\n<span class=\"n\">gpg</span><span class=\"bp\">.</span><span class=\"n\">program</span><span class=\"bp\">=/</span><span class=\"n\">opt</span><span class=\"bp\">/</span><span class=\"n\">homebrew</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">gpg</span>\n<span class=\"n\">filter</span><span class=\"bp\">.</span><span class=\"n\">lfs</span><span class=\"bp\">.</span><span class=\"n\">clean</span><span class=\"bp\">=</span><span class=\"n\">git</span><span class=\"bp\">-</span><span class=\"n\">lfs</span><span class=\"w\"> </span><span class=\"n\">clean</span><span class=\"w\"> </span><span class=\"c1\">-- %f</span>\n<span class=\"n\">filter</span><span class=\"bp\">.</span><span class=\"n\">lfs</span><span class=\"bp\">.</span><span class=\"n\">smudge</span><span class=\"bp\">=</span><span class=\"n\">git</span><span class=\"bp\">-</span><span class=\"n\">lfs</span><span class=\"w\"> </span><span class=\"n\">smudge</span><span class=\"w\"> </span><span class=\"c1\">-- %f</span>\n<span class=\"n\">filter</span><span class=\"bp\">.</span><span class=\"n\">lfs</span><span class=\"bp\">.</span><span class=\"n\">process</span><span class=\"bp\">=</span><span class=\"n\">git</span><span class=\"bp\">-</span><span class=\"n\">lfs</span><span class=\"w\"> </span><span class=\"n\">filter</span><span class=\"bp\">-</span><span class=\"n\">process</span>\n<span class=\"n\">filter</span><span class=\"bp\">.</span><span class=\"n\">lfs</span><span class=\"bp\">.</span><span class=\"n\">required</span><span class=\"bp\">=</span><span class=\"n\">true</span>\n<span class=\"n\">init</span><span class=\"bp\">.</span><span class=\"n\">templatedir</span><span class=\"bp\">=/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">boltonbailey</span><span class=\"bp\">/.</span><span class=\"n\">git</span><span class=\"bp\">-</span><span class=\"n\">templates</span>\n<span class=\"n\">http</span><span class=\"bp\">.</span><span class=\"n\">version</span><span class=\"bp\">=</span><span class=\"n\">HTTP</span><span class=\"bp\">/</span><span class=\"mf\">1.1</span>\n<span class=\"n\">http</span><span class=\"bp\">.</span><span class=\"n\">postbuffer</span><span class=\"bp\">=</span><span class=\"mi\">524288000</span>\n</code></pre></div>",
        "id": 494916390,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1737408555
    },
    {
        "content": "<p>Ok after trying several other things switching to mobile internet worked. Not sure what the problem is with my home internet and the internet at the cafe I was at earlier, maybe both are just very slow? Even that doesn't really make sense as I get &gt;100MB/sec in my speed tests.</p>",
        "id": 494918453,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1737409455
    },
    {
        "content": "<p>Hmm, I am now trying it again in order to be able to download the carleson project and it is again failing, even over mobile internet.</p>\n<p>Is it possible I have just tried to clone mathlib too many times and github is throttling me?</p>",
        "id": 494922524,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1737411376
    },
    {
        "content": "<p>I'm having similar issue, wondering about throttling too</p>",
        "id": 495797873,
        "sender_full_name": "Alok Singh",
        "timestamp": 1737755089
    },
    {
        "content": "<p>This seems to go against the consensus opinion here, but if you have <a href=\"https://docs.github.com/en/authentication/connecting-to-github-with-ssh\">ssh</a> configured you could try forcing lake to use it by first running: </p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>git<span class=\"w\"> </span>config<span class=\"w\"> </span>--global<span class=\"w\"> </span>url.<span class=\"s2\">\"git@github.com:\"</span>.insteadOf<span class=\"w\"> </span><span class=\"s2\">\"https://github.com/\"</span>\n</code></pre></div>",
        "id": 495800511,
        "sender_full_name": "Nick Ward",
        "timestamp": 1737756307
    },
    {
        "content": "<p>You can later undo this change to your <code>.gitconfig</code> by deleting the added section or by running:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>git<span class=\"w\"> </span>config<span class=\"w\"> </span>--global<span class=\"w\"> </span>--remove-section<span class=\"w\"> </span>url.<span class=\"s2\">\"git@github.com:\"</span>\n</code></pre></div>",
        "id": 495801006,
        "sender_full_name": "Nick Ward",
        "timestamp": 1737756521
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"282271\">Bolton Bailey</span> <a href=\"#narrow/channel/270676-lean4/topic/lake.20new.20.2E.2E.2E.20math.20gives.20.60Invalid.20lake.20configuration.60/near/494914728\">said</a>:</p>\n<blockquote>\n<p>I guess it probably has something to do with the network, I've seen the git part of the error message when using git clone on a non-mathlib related project. Nevertheless, I am still concerned about why it would be saying the lakefile is bad when its the network that's the issue.</p>\n</blockquote>\n<p>Wild guess: I think this might just be a confusing message. To compile your lakefile.lean into lakefile.olean, lake needs to look at mathlib's lakefile.lean due to the <code>require</code>. Then you don't get a lakefile.olean, which is probably the definition of an invalid configuration. Again, just a guess.</p>",
        "id": 495894326,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1737829938
    },
    {
        "content": "<p>Yes, <a href=\"https://github.com/leanprover/lean4/blob/62788395345c7f145714157c138acd0e137ab716/src/lake/Lake/CLI/Serve.lean#L39\">here</a> is the line that generates this error. Seems like it simply writes this error message no matter what kind of error is experienced, even if it does not have to do with the lakefile itself being the problem.</p>",
        "id": 495943194,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1737876756
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span>, could this error message be improved?</p>",
        "id": 496226453,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1738019016
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> Sure! Since the real error is already printed, perhaps the following would good?</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>Failed to configure the Lake workspace. Please restart the server after fixing the error above.\n</code></pre></div>",
        "id": 496226810,
        "sender_full_name": "Mac Malone",
        "timestamp": 1738019184
    },
    {
        "content": "<p>This error message looks fine to me.</p>",
        "id": 496239967,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1738026818
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"776338\">Nick Ward</span> <a href=\"#narrow/channel/270676-lean4/topic/lake.20new.20.2E.2E.2E.20math.20gives.20.60Invalid.20lake.20configuration.60/near/495800511\">said</a>:</p>\n<blockquote>\n<p>This seems to go against the consensus opinion here, but if you have <a href=\"https://docs.github.com/en/authentication/connecting-to-github-with-ssh\">ssh</a> configured you could try forcing lake to use it by first running: </p>\n<p><div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>git<span class=\"w\"> </span>config<span class=\"w\"> </span>--global<span class=\"w\"> </span>url.<span class=\"s2\">\"git@github.com:\"</span>.insteadOf<span class=\"w\"> </span><span class=\"s2\">\"https://github.com/\"</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Thanks for the advice. Doing this, I do not get immediate errors, but unfortunately it does not seem to have sped up the cloning process and I am waiting at least several minutes with the \"starting Lean language client message\".</p>",
        "id": 496240157,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1738026948
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"315577\">Mac Malone</span> <a href=\"#narrow/channel/270676-lean4/topic/lake.20new.20.2E.2E.2E.20math.20gives.20.60Invalid.20lake.20configuration.60/near/496226810\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> Sure! Since the real error is already printed, perhaps the following would good?</p>\n<p><div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>Failed to configure the Lake workspace. Please restart the server after fixing the error above.\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>FYI I made <a href=\"https://github.com/leanprover/lean4/pull/6827\">lean4#6827</a> to track this.</p>",
        "id": 496425671,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1738098922
    },
    {
        "content": "<p>And I made a PR <a href=\"https://github.com/leanprover/lean4/pull/6829\">lean4#6829</a> in case we feel this is uncontroversial and can be simply changed quickly.</p>",
        "id": 496429627,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1738100731
    },
    {
        "content": "<p>Just got a very similar error message:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">batteries</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">URL</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">changed</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">deleting</span><span class=\"w\"> </span><span class=\"bp\">'././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">batteries'</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">again</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">batteries</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">batteries</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">external</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">git'</span><span class=\"w\"> </span><span class=\"n\">exited</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mi\">128</span>\n</code></pre></div>\n<p>This is confusing and super frustrating! I was working on this branch just fine yesterday, and I don't think I've checked out any other branches since then - has batteries moved since then?</p>",
        "id": 498384466,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1738947395
    }
]