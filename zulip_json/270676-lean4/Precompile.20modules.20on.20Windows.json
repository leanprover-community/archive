[
    {
        "content": "<p>I'm trying to build SciLean on Windows but I'm having issues with <code>precompileModules</code> option and I'm getting linker errors <code>undefined symbol ...</code>.</p>\n<hr>\n<p>Here is mwe</p>\n<p><code>lakefile.lean</code></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lake</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">DSL</span><span class=\"w\"> </span><span class=\"n\">System</span>\n\n<span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n\n<span class=\"n\">lean_lib</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">roots</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"ss\">`Foo</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">precompileModules</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">true</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">default_target</span><span class=\"kd\">]</span>\n<span class=\"n\">lean_exe</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">root</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"ss\">`Main</span>\n</code></pre></div>\n<p><code>Foo/Basic.lean</code></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">extern</span><span class=\"w\"> </span><span class=\"s2\">\"hello_impl\"</span><span class=\"kd\">]</span>\n<span class=\"kn\">opaque</span><span class=\"w\"> </span><span class=\"n\">hello</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span>\n</code></pre></div>\n<p><code>Foo/Impl.lean</code></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"n\">hello_impl</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">helloImpl</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"hello {name}\"</span>\n</code></pre></div>\n<p><code>Foo.lean</code></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">Impl</span>\n</code></pre></div>\n<p><code>Main.lean</code></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Foo</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"Hello, {hello \"</span><span class=\"n\">John</span><span class=\"s2\">\"}!\"</span>\n</code></pre></div>\n<hr>\n<p>Running <code>lake build</code> produces error</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Γ</span><span class=\"bp\">£û</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">8</span><span class=\"bp\">/</span><span class=\"mi\">16</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Building</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">Basic</span><span class=\"o\">:</span><span class=\"n\">dynlib</span>\n<span class=\"n\">trace</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">.&gt;</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">skriv</span><span class=\"bp\">\\.</span><span class=\"n\">elan</span><span class=\"bp\">\\</span><span class=\"n\">toolchains</span><span class=\"bp\">\\</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---stable\\bin\\leanc.exe -shared -o .\\.\\.lake\\build\\lib\\Foo-Basic-1.dll .\\.\\.lake\\build\\ir\\Foo\\Basic.c.o.export -L.\\.\\.lake\\build\\lib</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"n\">ld</span><span class=\"bp\">.</span><span class=\"n\">lld</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">undefined</span><span class=\"w\"> </span><span class=\"n\">symbol</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">hello_impl</span>\n<span class=\"bp\">&gt;&gt;&gt;</span><span class=\"w\"> </span><span class=\"n\">referenced</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"bp\">.\\.\\.</span><span class=\"n\">lake</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">ir</span><span class=\"bp\">\\</span><span class=\"n\">Foo</span><span class=\"bp\">\\</span><span class=\"n\">Basic</span><span class=\"bp\">.</span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">o</span><span class=\"bp\">.</span><span class=\"kn\">export</span><span class=\"o\">:(</span><span class=\"n\">l_hello___boxed</span><span class=\"o\">)</span>\n<span class=\"n\">clang</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">linker</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">exit</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">see</span><span class=\"w\"> </span><span class=\"n\">invocation</span><span class=\"o\">)</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">external</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">c</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">skriv</span><span class=\"bp\">\\.</span><span class=\"n\">elan</span><span class=\"bp\">\\</span><span class=\"n\">toolchains</span><span class=\"bp\">\\</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---stable\\bin\\leanc.exe' exited with code 1</span>\n<span class=\"n\">Some</span><span class=\"w\"> </span><span class=\"n\">required</span><span class=\"w\"> </span><span class=\"n\">builds</span><span class=\"w\"> </span><span class=\"n\">logged</span><span class=\"w\"> </span><span class=\"n\">failures</span><span class=\"o\">:</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">Basic</span><span class=\"o\">:</span><span class=\"n\">dynlib</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">failed</span>\n</code></pre></div>\n<p>Looks like that the call to <code>leanc</code> is missing <code>-lFoo-Impl-1</code>. So manually calling</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">c</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">skriv</span><span class=\"bp\">\\.</span><span class=\"n\">elan</span><span class=\"bp\">\\</span><span class=\"n\">toolchains</span><span class=\"bp\">\\</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---stable\\bin\\leanc.exe -shared -o .\\.\\.lake\\build\\lib\\Foo-Basic-1.dll .\\.\\.lake\\build\\ir\\Foo\\Basic.c.o.export -L.\\.\\.lake\\build\\lib -lFoo-Impl-1</span>\n</code></pre></div>\n<p>does not fail anymore and produces desired <code>Foo-Basic-1.dll</code>.</p>\n<p>Now we have <code>Foo-Basic-1.dll</code> lets try resume build and call <code>lake build</code> again. It fails with</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Γ</span><span class=\"bp\">£û</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">10</span><span class=\"bp\">/</span><span class=\"mi\">16</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Building</span><span class=\"w\"> </span><span class=\"n\">Foo</span>\n<span class=\"n\">trace</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">.&gt;</span><span class=\"w\"> </span><span class=\"n\">LEAN_PATH</span><span class=\"bp\">=.\\.\\.</span><span class=\"n\">lake</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"w\"> </span><span class=\"n\">PATH</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">skriv</span><span class=\"bp\">\\.</span><span class=\"n\">elan</span><span class=\"bp\">\\</span><span class=\"n\">toolchains</span><span class=\"bp\">\\</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---stable\\bin\\lean.exe .\\.\\.\\.\\Foo.lean -R .\\.\\.\\. -o .\\.\\.lake\\build\\lib\\Foo.olean -i .\\.\\.lake\\build\\lib\\Foo.ilean -c .\\.\\.lake\\build\\ir\\Foo.c --load-dynlib=.\\.\\.lake\\build\\lib\\Foo-Basic-1.dll --load-dynlib=.\\.\\.lake\\build\\lib\\Foo-Impl-1.dll --json</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"n\">libc</span><span class=\"bp\">++</span><span class=\"n\">abi</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">terminating</span><span class=\"w\"> </span><span class=\"n\">due</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">uncaught</span><span class=\"w\"> </span><span class=\"n\">exception</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">lean</span><span class=\"bp\">::</span><span class=\"n\">exception</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">loading</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"w\"> </span><span class=\"bp\">.\\.\\.</span><span class=\"n\">lake</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">\\</span><span class=\"n\">Foo</span><span class=\"bp\">-</span><span class=\"n\">Basic</span><span class=\"bp\">-</span><span class=\"mf\">1.</span><span class=\"n\">dll</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">126</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">exited</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mi\">3221226505</span>\n<span class=\"n\">Some</span><span class=\"w\"> </span><span class=\"n\">required</span><span class=\"w\"> </span><span class=\"n\">builds</span><span class=\"w\"> </span><span class=\"n\">logged</span><span class=\"w\"> </span><span class=\"n\">failures</span><span class=\"o\">:</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Foo</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">failed</span>\n</code></pre></div>\n<p>I have not been successful in modifying this command to make it succeed. </p>\n<hr>\n<p>Is this a bug in <code>lake</code>? <span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span> Or what am I doing wrong?</p>",
        "id": 485561682,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1733125401
    },
    {
        "content": "<p>Oh wow, we definitely didn't design it with such extern/export cross-edges in mind</p>",
        "id": 485562359,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1733125663
    },
    {
        "content": "<p>Uhh what do you mean? I'm just recreating what is done with <a href=\"https://github.com/leanprover/lean4/blob/3c5e612dc54733cd707becb929457d2f9d8ca6fd/src/Lean/Meta/Tactic/Simp/Types.lean#L241\"><code>simp</code></a>/<a href=\"https://github.com/leanprover/lean4/blob/3c5e612dc54733cd707becb929457d2f9d8ca6fd/src/Lean/Meta/Tactic/Simp/Main.lean#L752\"><code>simpImp</code></a>, <code>whnf</code>, <code>isDefEq</code> etc.</p>",
        "id": 485562570,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1733125750
    },
    {
        "content": "<p>Maybe I'm not doing it right but it works on Linux. (I didn't test this particular mwe on Linux as I'm on Windows right now but in SciLean I'm doing something identical)</p>",
        "id": 485562738,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1733125835
    },
    {
        "content": "<p>How am I supposed to write a recursive tactic like <code>simp</code> using extern/export and use it in my project? I need `precompileModules,  right? </p>\n<p>The above mwe compiled fine if I remove <code>precompileModules</code> but then I can't <code>#eval main</code> in <code>Main.lean</code> as I get server error</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">libc</span><span class=\"bp\">++</span><span class=\"n\">abi</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">terminating</span><span class=\"w\"> </span><span class=\"n\">due</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">uncaught</span><span class=\"w\"> </span><span class=\"n\">exception</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">lean</span><span class=\"bp\">::</span><span class=\"n\">exception</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Could</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">find</span><span class=\"w\"> </span><span class=\"n\">native</span><span class=\"w\"> </span><span class=\"n\">implementation</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">external</span><span class=\"w\"> </span><span class=\"n\">declaration</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">hello'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">symbols</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">l_hello___boxed'</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">l_hello'</span><span class=\"o\">)</span><span class=\"bp\">.</span>\n</code></pre></div>",
        "id": 485563731,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1733126263
    },
    {
        "content": "<p>Just because core does it doesn't mean it's the best solution for user code. If it's infeasible to contain the recursion in one <code>mutual</code>, you could for example store the function for recursive use in an <code>IO.Ref</code>, kind of the userspace equivalent of export+extern</p>",
        "id": 485574863,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1733130256
    },
    {
        "content": "<p>I see, I will keep that in mind. However right now I have a fork of simp and redesigning to that would probably be quite some work.</p>",
        "id": 485580511,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1733132004
    },
    {
        "content": "<p>The IO.Ref should be a simple change</p>",
        "id": 485582303,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1733132572
    },
    {
        "content": "<p>Do I understand it correctly that I it should look something like this:</p>\n<p><code>Init.lean</code></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">initialize</span><span class=\"w\"> </span><span class=\"n\">factorialRef</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">Ref</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">mkRef</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">factorial</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">ref</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">factorialRef</span><span class=\"bp\">.</span><span class=\"n\">get</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">ref</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n</code></pre></div>\n<p><code>Impl.lean</code></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">factorialImpl</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">factorial</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n\n<span class=\"n\">initialize</span><span class=\"w\"> </span><span class=\"n\">factorialRef</span><span class=\"bp\">.</span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">factorialImpl</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">factorial</span><span class=\"w\"> </span><span class=\"mi\">4</span>\n</code></pre></div>",
        "id": 485587340,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1733134223
    },
    {
        "content": "<p>In that case the change should be easy, thanks for the help!</p>",
        "id": 485587674,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1733134334
    },
    {
        "content": "<p>Great, fixing SciLean was just six lines and now it compiles on Windows.</p>",
        "id": 485593615,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1733136109
    },
    {
        "content": "<p>FYI, what probably happened here is that Linux allows undefined symbols in shared libraries as long as they are defined at load time, and Windows doesn't. So this is a correct cross-platform solution.</p>",
        "id": 485619263,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1733144411
    },
    {
        "content": "<p>This is also the case for Macs, as I've learned recently. Where the solution is <code>-Wl,-undefined,dynamic_lookup</code>: <a href=\"https://blog.tim-smith.us/2015/09/python-extension-modules-os-x/\">https://blog.tim-smith.us/2015/09/python-extension-modules-os-x/</a></p>",
        "id": 485648195,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1733152819
    }
]