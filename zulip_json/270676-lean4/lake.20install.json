[
    {
        "content": "<p>Is there something like a <code>lake install</code> planned?</p>\n<p>I tried to programmatically copy the executable binary file generated by <code>lake build</code> to a folder in my PATH. But the copied file no longer has permission to be executed. I remember this solution used to work in the past.</p>\n<p>Nevertheless, a <code>lake install</code> (like <code>cargo install</code>) seems like a better solution overall.</p>\n<p>In any case, while there's no such thing, can someone help me make the copying strategy work?</p>\n<p>Thanks in advance!</p>",
        "id": 497782266,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1738714661
    },
    {
        "content": "<p>Does symlinking it instead work? Or otherwise maybe checking <code>otool -L</code> (or <code>ldd</code>) to see whether it's trying to look for libraries in relative paths or something might be worth checking.</p>",
        "id": 497786035,
        "sender_full_name": "Julian Berman",
        "timestamp": 1738716829
    },
    {
        "content": "<p>Symlink won't work because the original binary file is not stable. I need the real binary file to be put on a separate folder and made available to be called.</p>\n<p>Maybe I didn't understand the <code>otool</code> idea, but the issue doesn't seem to be related to calls to things by relative paths. You can reproduce it with just a hello world program. The issue really is the fact that the copied file ends up without permission to be executed, while the original file created by Lake has the permission to be executed.</p>",
        "id": 497787008,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1738717289
    },
    {
        "content": "<p>It seems to work here (on macOS):</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>⊙<span class=\"w\">  </span>rm<span class=\"w\"> </span>-rf<span class=\"w\"> </span>foo<span class=\"w\"> </span>~/.local/bin/foo<span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span>lake<span class=\"w\"> </span>new<span class=\"w\"> </span>foo<span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"nb\">cd</span><span class=\"w\"> </span>foo<span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span>lake<span class=\"w\"> </span>build<span class=\"w\"> </span>--quiet<span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span>cp<span class=\"w\"> </span>.lake/build/bin/foo<span class=\"w\"> </span>~/.local/bin<span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span>~/.local/bin/foo<span class=\"w\">                                                                                                                                                                                                                         </span>julian@Mac\nHello,<span class=\"w\"> </span>world!\n</code></pre></div>\n<p>What do you get?</p>",
        "id": 497788685,
        "sender_full_name": "Julian Berman",
        "timestamp": 1738718209
    },
    {
        "content": "<p>I'm not copying with <code>cp</code>. I'm copying with a Lean script so it can work on Windows as well.</p>\n<p>I do this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">FS</span><span class=\"bp\">.</span><span class=\"n\">writeBinFile</span><span class=\"w\"> </span><span class=\"n\">tgtPath</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">FS</span><span class=\"bp\">.</span><span class=\"n\">readBinFile</span><span class=\"w\"> </span><span class=\"n\">srcPath</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>And when I try to execute it with <code>./path-to-my-bin</code> it just says \"Permission denied\"</p>",
        "id": 497789699,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1738718881
    },
    {
        "content": "<p>Hm. Well let's see what that does, maybe it's not preserving the executable bit.</p>",
        "id": 497789871,
        "sender_full_name": "Julian Berman",
        "timestamp": 1738718966
    },
    {
        "content": "<p>I mean I guess you said already that it's not.</p>",
        "id": 497789886,
        "sender_full_name": "Julian Berman",
        "timestamp": 1738718985
    },
    {
        "content": "<p>So I guess let's see what the way to do that is.</p>",
        "id": 497789910,
        "sender_full_name": "Julian Berman",
        "timestamp": 1738718997
    },
    {
        "content": "<p>When I <code>ls -lh</code> on the original file, it says <code>-rwxrwxr-x</code>. But for the newly created file it says <code>-rw-rw-r--</code>. I've lost the <code>x</code>s for execution permissions</p>",
        "id": 497790046,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1738719075
    },
    {
        "content": "<p>Yeah. I see Lean has <code>FS.setAccessRights</code> which looks like  it exposes <code>chmod</code>.</p>",
        "id": 497790235,
        "sender_full_name": "Julian Berman",
        "timestamp": 1738719188
    },
    {
        "content": "<p>I don't see <code>stat</code> yet</p>",
        "id": 497790240,
        "sender_full_name": "Julian Berman",
        "timestamp": 1738719193
    },
    {
        "content": "<p>But let me reiterate that I don't like this manual copying strategy, even when it works. I'd rather have a principled way to install binaries like <code>cargo install</code> for Rust or <code>stack install</code> for Haskell etc</p>",
        "id": 497790247,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1738719198
    },
    {
        "content": "<p>(<em>nod</em>, agree with that)</p>",
        "id": 497790262,
        "sender_full_name": "Julian Berman",
        "timestamp": 1738719213
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321696\">Julian Berman</span> <a href=\"#narrow/channel/270676-lean4/topic/lake.20install/near/497790235\">said</a>:</p>\n<blockquote>\n<p>Yeah. I see Lean has <code>FS.setAccessRights</code></p>\n</blockquote>\n<p>Where is that? I type <code>IO.FS.</code> and that function doesn't show up for auto-completion</p>",
        "id": 497790670,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1738719464
    },
    {
        "content": "<p>Ah, it's <code>IO.setAccessRights</code></p>",
        "id": 497790874,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1738719591
    },
    {
        "content": "<p>Sorry that, yes. (I should learn to stop trying to answer what namespace a declaration is via Cmd-F \"namespace\"...)</p>",
        "id": 497791668,
        "sender_full_name": "Julian Berman",
        "timestamp": 1738720027
    },
    {
        "content": "<p>Okay, that did the trick. Thanks!</p>",
        "id": 497791828,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1738720102
    }
]