[
    {
        "content": "<p>Hey guys,<br>\nI’m wondering if it’s possible to scope keywords within a syntax definition.<br>\nMy goal is to nest one syntax category inside another, and have the parser only recognize the keywords or tokens from the inner syntax category when it's currently parsing the outer syntax category.<br>\nThe reason for this is that I want to avoid having certain keywords from the inner syntax category be reserved globally.<br>\nHere is a mwe:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Parser</span>\n\n<span class=\"n\">declare_syntax_cat</span><span class=\"w\"> </span><span class=\"n\">outer_syntax</span>\n<span class=\"n\">declare_syntax_cat</span><span class=\"w\"> </span><span class=\"n\">inner_syntax</span>\n\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"start_syntax\"</span><span class=\"w\"> </span><span class=\"n\">withPosition</span><span class=\"o\">(</span><span class=\"n\">semicolonOrLinebreak</span><span class=\"o\">)</span>\n<span class=\"w\">          </span><span class=\"n\">inner_syntax</span><span class=\"bp\">*</span>\n<span class=\"w\">          </span><span class=\"n\">withPosition</span><span class=\"o\">(</span><span class=\"n\">semicolonOrLinebreak</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"s2\">\"end_syntax\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">outer_syntax</span>\n\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"ex\"</span><span class=\"w\"> </span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"bp\">&amp;</span><span class=\"s2\">\"x\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">inner_syntax</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"n\">outer_syntax</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\">  </span><span class=\"n\">start_syntax</span>\n<span class=\"w\">          </span><span class=\"n\">ex</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">        </span><span class=\"n\">end_syntax</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">ex</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"c1\">-- unexpected token 'ex'; expected identifier</span>\n</code></pre></div>",
        "id": 546442297,
        "sender_full_name": "Marx",
        "timestamp": 1761135332
    },
    {
        "content": "<p>This is currently not supported; keywords are always global. However, you can configure your inner syntax category to accept <code>&amp;\"ex\"</code> as a 'keyword' (changes marked with <code>!!</code>):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Parser</span>\n\n<span class=\"n\">declare_syntax_cat</span><span class=\"w\"> </span><span class=\"n\">outer_syntax</span>\n<span class=\"n\">declare_syntax_cat</span><span class=\"w\"> </span><span class=\"n\">inner_syntax</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">behavior</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">both</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- !!</span>\n\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"start_syntax\"</span><span class=\"w\"> </span><span class=\"n\">withPosition</span><span class=\"o\">(</span><span class=\"n\">semicolonOrLinebreak</span><span class=\"o\">)</span>\n<span class=\"w\">          </span><span class=\"n\">inner_syntax</span><span class=\"bp\">*</span>\n<span class=\"w\">          </span><span class=\"n\">withPosition</span><span class=\"o\">(</span><span class=\"n\">semicolonOrLinebreak</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"s2\">\"end_syntax\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">outer_syntax</span>\n\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"bp\">&amp;</span><span class=\"s2\">\"ex\"</span><span class=\"w\"> </span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"bp\">&amp;</span><span class=\"s2\">\"x\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">inner_syntax</span><span class=\"w\"> </span><span class=\"c1\">-- !!</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"n\">outer_syntax</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\">  </span><span class=\"n\">start_syntax</span>\n<span class=\"w\">          </span><span class=\"n\">ex</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">        </span><span class=\"n\">end_syntax</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">ex</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"c1\">-- unexpected token 'ex'; expected identifier</span>\n</code></pre></div>",
        "id": 546443734,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1761135716
    },
    {
        "content": "<p>Oh that's great, thank you very much!</p>",
        "id": 546444448,
        "sender_full_name": "Marx",
        "timestamp": 1761135925
    }
]