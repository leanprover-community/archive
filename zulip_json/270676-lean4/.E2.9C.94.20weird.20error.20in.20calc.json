[
    {
        "content": "<p>This is probably a trivial question, but is there a reason why</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"k\">calc</span>\n<span class=\"w\">      </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">      </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">  </span><span class=\"n\">trivial</span>\n</code></pre></div>\n<p>works and</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"k\">calc</span>\n<span class=\"w\">      </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">  </span><span class=\"n\">trivial</span>\n</code></pre></div>\n<p>throws an error?</p>",
        "id": 522482772,
        "sender_full_name": "Thomas Zhu",
        "timestamp": 1749089045
    },
    {
        "content": "<p><code>trivial</code> is parsed as the second line of the calc</p>",
        "id": 522482986,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1749089167
    },
    {
        "content": "<p>the syntax is flexible enough to allow this</p>",
        "id": 522483002,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1749089177
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"816344\">@Aaron Liu</span> I understand the error is <code>trivial</code> is parsed as the second line, but I don't really think this should have been the case? Shouldn't trivial be parsed as part of the outer proof?</p>",
        "id": 522483125,
        "sender_full_name": "Thomas Zhu",
        "timestamp": 1749089241
    },
    {
        "content": "<p>Sorry, just found an older topic on this issue: <a class=\"stream-topic\" data-stream-id=\"270676\" href=\"/#narrow/channel/270676-lean4/topic/Single.20line.20calc.20syntax/with/501159679\">#lean4 &gt; Single line calc syntax</a></p>",
        "id": 522483276,
        "sender_full_name": "Thomas Zhu",
        "timestamp": 1749089297
    },
    {
        "content": "<p>in the first example you already have two calc lines so everything from the second line onwards has to be indented the same so when the parser encounters <code>trivial</code> it knows that it's not part of the <code>calc</code> since it isn't indented the same but in the second example you only have one line and so there's no reference indentation to compare to so it just takes <code>trivial</code> as the second line of the <code>calc</code></p>",
        "id": 522483295,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1749089311
    },
    {
        "content": "<p>Ah, thank you! Now I understand why it doesn't work. User-experience-wise, I still think it would be reasonable to use indentation of first line (if it is on a different line than <code>calc</code>) though</p>",
        "id": 522483502,
        "sender_full_name": "Thomas Zhu",
        "timestamp": 1749089452
    },
    {
        "content": "<p>The behavior is very unintuitive especially for people (me) who don't know the underlying syntax of <code>calc</code></p>",
        "id": 522483566,
        "sender_full_name": "Thomas Zhu",
        "timestamp": 1749089491
    },
    {
        "content": "<p>The reason it's like this is so you can do stuff like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">calc</span>\n<span class=\"w\">      </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\">        </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"w\">  </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\">    </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\">  </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\">         </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>where the first line is not indented the same as all the others</p>",
        "id": 522483997,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1749089760
    },
    {
        "content": "<p>Ok, that sort of makes sense. Thank you.</p>",
        "id": 522515437,
        "sender_full_name": "Thomas Zhu",
        "timestamp": 1749107522
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"631691\">Thomas Zhu</span> has marked this topic as resolved.</p>",
        "id": 522515443,
        "sender_full_name": "Notification Bot",
        "timestamp": 1749107525
    },
    {
        "content": "<p>One-line calcs considered harmful. This is becoming a common question</p>",
        "id": 522524545,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1749110291
    },
    {
        "content": "<p>the syntax does not match what is expected</p>",
        "id": 522555230,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1749119097
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> has marked this topic as resolved.</p>",
        "id": 522555246,
        "sender_full_name": "Notification Bot",
        "timestamp": 1749119103
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/270676-lean4/topic/.E2.9C.94.20weird.20error.20in.20calc/near/522524545\">said</a>:</p>\n<blockquote>\n<p>One-line calcs considered harmful. This is becoming a common question</p>\n</blockquote>\n<p>What about a linter against it?</p>",
        "id": 522587221,
        "sender_full_name": "Thomas Zhu",
        "timestamp": 1749128716
    },
    {
        "content": "<p>I stumbled upon this one-line calc in messing around in a proof. I don't think I have read explicitly \"one-line calcs are considered harmful\" in any documentation, so I wouldn't naturally think that's the case.</p>",
        "id": 522587601,
        "sender_full_name": "Thomas Zhu",
        "timestamp": 1749128835
    }
]