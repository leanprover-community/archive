[
    {
        "content": "<p>Hello! I was wondering if there's any technical reason attributes can't appear on constructors. It's currently <a href=\"https://github.com/leanprover/lean4/blob/2bbf5db04fc536a192756091ee9f640b6ddf489f/src/Lean/Elab/MutualInductive.lean#L233-L234\">not implemented, and results in an error</a>.</p>\n<p>I have some use-cases that this it would be handy for (i.e. customizing the behaviour of other attributes and/or deriving implementations). Also for a more general application, I've noticed <a href=\"https://github.com/leanprover-community/mathlib4/blob/f0e5f810b831671addae1078f6e05fb3697276ab/Mathlib/Logic/Relation.lean#L256-L262\">this sort of thing pop up a couple times</a>, where a common attribute such as <code>refl</code> is applicable to a constructor, but has to be included outside the definition. It would be much nicer if you could write:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">ReflTransGen</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"kd\">@[</span><span class=\"n\">refl</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ReflTransGen</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ReflTransGen</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ReflTransGen</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">c</span>\n</code></pre></div>\n<p>...which currently parses, but then triggers the error above.</p>\n<p>If there's no reason this wouldn't be possible, and others agree that it would be useful to have, I'd be happy to spend some time on implementing it. Thanks!</p>",
        "id": 539149585,
        "sender_full_name": "Matthew Toohey",
        "timestamp": 1757704731
    },
    {
        "content": "<p>You can always write <code>attribute [refl] ReflTransGen.refl</code> after the <code>inductive</code> is over</p>",
        "id": 539169130,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757714665
    },
    {
        "content": "<p>But indeed it would be nice to support the syntax</p>",
        "id": 539169177,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757714686
    },
    {
        "content": "<p>An even simpler ask would be to have the error message inform the user of the <code>attribute</code> syntax in the meantime</p>",
        "id": 539169335,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757714751
    },
    {
        "content": "<p>This topic was moved here from <a class=\"stream-topic\" data-stream-id=\"113488\" href=\"/#narrow/channel/113488-general/topic/Attributes.20on.20constructors\">#general &gt; Attributes on constructors</a> by <span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span>.</p>",
        "id": 539169360,
        "sender_full_name": "Notification Bot",
        "timestamp": 1757714765
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/270676-lean4/topic/Attributes.20on.20constructors/near/539169130\">said</a>:</p>\n<blockquote>\n<p>You can always write <code>attribute [refl] ReflTransGen.refl</code> after the <code>inductive</code> is over</p>\n</blockquote>\n<p>Oh that's true, I guess I could at least make my stuff work by doing that for now.</p>",
        "id": 539169815,
        "sender_full_name": "Matthew Toohey",
        "timestamp": 1757715022
    },
    {
        "content": "<p>I thought you already knew that, since you said:</p>\n<p><span class=\"user-mention silent\" data-user-id=\"689088\">Matthew Toohey</span> <a href=\"#narrow/channel/270676-lean4/topic/Attributes.20on.20constructors/near/539149585\">said</a>:</p>\n<blockquote>\n<p>has to be included outside the definition</p>\n</blockquote>",
        "id": 539170260,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757715199
    },
    {
        "content": "<p>Lol I should've after bringing up the <code>ReflTransGen</code> example but I didn't really process that it'd work for my use-cases</p>",
        "id": 539173878,
        "sender_full_name": "Matthew Toohey",
        "timestamp": 1757717203
    },
    {
        "content": "<p>That being said, it would still be much more convenient to be able to write these inline since I may need a lot of them, so if anyone who's familiar with the code could offer an opinion about whether this would be feasible, that'd be great!</p>",
        "id": 539173963,
        "sender_full_name": "Matthew Toohey",
        "timestamp": 1757717268
    },
    {
        "content": "<p>This might be reasonable. I don't see anything in the Lean 4 issue tracker for this — could you try searching it again, and create an issue if there's nothing relevant?</p>\n<p>Please include some motivating use cases. It would be helpful to have comparison to using <code>attribute</code>. The tough thing right now with the suggestion is that there's a reasonable workaround.</p>\n<p>It'd be helpful to have some examples of mutual inductive types with some constructor attributes that help decide what order attributes ought to be applied. I'm imagining that the order would be (1) afterTypechecking attributes for all the inductive types in the block, then (2) those for all the constructors, then (3) afterCompilation attributes for all inductive types, and lastly (4) those for all constructors. Though maybe there are examples where (3) should come before (2)?</p>",
        "id": 539182120,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1757722533
    },
    {
        "content": "<p>Perhaps</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"c1\">-- Invalid attribute: Attributes cannot be added to fields</span>\n<span class=\"w\">  </span><span class=\"kd\">@[</span><span class=\"n\">instance</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fact</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>belongs in the same tracking issue</p>",
        "id": 539183068,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757723160
    },
    {
        "content": "<p>I'd suggest a different issue for that, but link them for sure.</p>",
        "id": 539185191,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1757724424
    },
    {
        "content": "<p>I've created an issue for this here: <a href=\"https://github.com/leanprover/lean4/issues/10521\">https://github.com/leanprover/lean4/issues/10521</a></p>",
        "id": 541225544,
        "sender_full_name": "Matthew Toohey",
        "timestamp": 1758719387
    }
]