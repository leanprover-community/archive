[
    {
        "content": "<p>Consider the following setup with two folders/packages, <code>lake1/</code> and <code>lake2/</code>.</p>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"c1\"># lake1/lakefile.toml</span>\n\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"lake1\"</span>\n<span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"0.1.0\"</span>\n<span class=\"n\">defaultTargets</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"mylib\"</span><span class=\"p\">]</span>\n\n<span class=\"k\">[[lean_lib]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"mylib\"</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- lake1/mylib/mod1.lean</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"lake1\"</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"c1\"># lake2/lakefile.toml</span>\n\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"lake2\"</span>\n<span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"0.1.0\"</span>\n<span class=\"n\">defaultTargets</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"mylib\"</span><span class=\"p\">]</span>\n\n<span class=\"k\">[[require]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"lake1\"</span>\n<span class=\"n\">path</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"../lake1\"</span>\n\n<span class=\"k\">[[lean_lib]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"mylib\"</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- lake2/mylib/mod2.lean</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">ghi</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"lake2\"</span>\n</code></pre></div>\n<p>Then a file <code>lake2/test.lean</code> containing <code>import mylib.mod2</code> works in Lean 4.26 but gives the following error on 4.27 and above.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">âœ–</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">3</span><span class=\"bp\">/</span><span class=\"mi\">6</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Running</span><span class=\"w\"> </span><span class=\"n\">mylib</span><span class=\"bp\">.</span><span class=\"n\">mod2</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">such</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">file</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">lake1</span><span class=\"bp\">/</span><span class=\"n\">mylib</span><span class=\"bp\">/</span><span class=\"n\">mod2</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n</code></pre></div>\n<p>Is this an intended change or a regression? If it's intended, are all <code>lean_lib</code> names supposed to be made globally unique by package maintainers?</p>",
        "id": 573396736,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1770847891
    },
    {
        "content": "<p>I don't think it's the <code>lean_lib</code> names that matter; what has to be globally unique is the top-level directory.</p>",
        "id": 573456072,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1770883605
    },
    {
        "content": "<p>(I guess by default the globs are set based on the name, but they don't have to be)</p>",
        "id": 573456099,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1770883620
    },
    {
        "content": "<p>In 4.26 could you import both files, or did it just exchange which one works and which doesn't?</p>",
        "id": 573456313,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1770883701
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/270676-lean4/topic/Module.20resolution.20with.20ambiguous.20lean_lib.20names/near/573456313\">said</a>:</p>\n<blockquote>\n<p>In 4.26 could you import both files, or did it just exchange which one works and which doesn't?</p>\n</blockquote>\n<p>They were exchanged: you could import <code>mylib.mod2</code> but not <code>mylib.mod1</code>. This made sense to me at the time as prioritizing the 'current' package, so I had several packages that all contained a <code>test/</code> subdirectory (and imported each other). It may be that this was, in the end, just relying on unspecified implementation behavior, but I wanted to check here.</p>",
        "id": 573937044,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1771116166
    },
    {
        "content": "<p>Module roots should be unique. I'm not sure why there was already a recent regression with the current behavior, but as it currently stands, <a href=\"https://github.com/leanprover/lean4/pull/11662\">lean4#11662</a> and <a href=\"https://github.com/leanprover/lean4/pull/12310\">lean4#12310</a> will definitely require module roots to be unique in the given dependency closure of a package. This also has the benefit that we can resolve module names without file operations.</p>",
        "id": 574071779,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1771235631
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> has marked this topic as resolved.</p>",
        "id": 574608804,
        "sender_full_name": "Notification Bot",
        "timestamp": 1771450740
    }
]