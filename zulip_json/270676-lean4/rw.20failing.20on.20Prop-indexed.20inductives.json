[
    {
        "content": "<p>I have defined the following abbreviations and inductives:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">Env</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">Ã—</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span>\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">HyperEnv</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Env</span><span class=\"o\">)</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Typing</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HyperEnv</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">parr</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î“</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Env</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">      </span><span class=\"n\">Typing</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î“</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"o\">{(</span><span class=\"n\">y</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"o\">{(</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)}}</span><span class=\"w\"> </span><span class=\"bp\">â†’</span>\n<span class=\"w\">      </span><span class=\"n\">Typing</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î“</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"o\">{(</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)}}</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">TS1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HyperEnv</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">Ã—</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â†’</span>\n<span class=\"w\">  </span><span class=\"n\">HyperEnv</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">parr</span>\n<span class=\"w\">      </span><span class=\"o\">{</span><span class=\"n\">Î“</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Env</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">ğ’Ÿ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Typing</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î“</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"o\">{(</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)}})</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">ğ’Ÿ'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Typing</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î“</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"o\">{(</span><span class=\"n\">y</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"o\">{(</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)}})</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">      </span><span class=\"n\">TS1</span>\n<span class=\"w\">        </span><span class=\"o\">{</span><span class=\"n\">Î“</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"o\">{(</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)}}</span>\n<span class=\"w\">        </span><span class=\"o\">[(</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)]</span>\n<span class=\"w\">        </span><span class=\"o\">{</span><span class=\"n\">Î“</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"o\">{(</span><span class=\"n\">y</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"o\">{(</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)}}</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">TS2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">âˆ€</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ğ’¢</span><span class=\"w\"> </span><span class=\"n\">ğ’¢'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HyperEnv</span><span class=\"o\">},</span>\n<span class=\"w\">  </span><span class=\"n\">Typing</span><span class=\"w\"> </span><span class=\"n\">ğ’¢</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">Ã—</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Typing</span><span class=\"w\"> </span><span class=\"n\">ğ’¢'</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">parr</span>\n<span class=\"w\">      </span><span class=\"o\">{</span><span class=\"n\">Î“</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Env</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">ğ’Ÿ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Typing</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î“</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"o\">{(</span><span class=\"n\">y</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"o\">{(</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)}})</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">      </span><span class=\"n\">TS2</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"n\">Typing</span><span class=\"bp\">.</span><span class=\"n\">parr</span><span class=\"w\"> </span><span class=\"n\">ğ’Ÿ</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"o\">[(</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)]</span>\n<span class=\"w\">        </span><span class=\"n\">ğ’Ÿ</span>\n</code></pre></div>\n<p>Here are two examples. With <code>TS1</code>, rewriting works, but with <code>TS2</code> it fails:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">swap_last_two</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Env</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">aesop</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">move_last_two_left</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Env</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">aesop</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">example1</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î“</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Env</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">ğ’Ÿ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Typing</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î“</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"o\">{(</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"o\">{(</span><span class=\"n\">z</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)}})</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">ğ’Ÿ'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Typing</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î“</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"o\">{(</span><span class=\"n\">y</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"o\">{(</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"o\">{(</span><span class=\"n\">z</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)}})</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">TS1</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">Î“</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"o\">{(</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"o\">{(</span><span class=\"n\">z</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)}}</span>\n<span class=\"w\">    </span><span class=\"o\">[(</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)]</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">Î“</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"o\">{(</span><span class=\"n\">y</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"o\">{(</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"o\">{(</span><span class=\"n\">z</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)}}</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">move_last_two_left</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">swap_last_two</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">TS1</span><span class=\"bp\">.</span><span class=\"n\">parr</span>\n<span class=\"w\">  </span><span class=\"bp\">Â·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">â†</span><span class=\"w\"> </span><span class=\"n\">swap_last_two</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">ğ’Ÿ</span>\n<span class=\"w\">  </span><span class=\"bp\">Â·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">â†</span><span class=\"w\"> </span><span class=\"n\">move_last_two_left</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">ğ’Ÿ'</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">example2</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î“</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Env</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">ğ’Ÿ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Typing</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î“</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"o\">{(</span><span class=\"n\">y</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"o\">{(</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"o\">{(</span><span class=\"n\">z</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)}})</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">TS2</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Typing</span><span class=\"bp\">.</span><span class=\"n\">parr</span><span class=\"w\"> </span><span class=\"n\">ğ’Ÿ</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">[(</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)]</span>\n<span class=\"w\">    </span><span class=\"n\">ğ’Ÿ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">swap_last_two</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">ğ’Ÿ</span><span class=\"w\"> </span><span class=\"c1\">-- Creates a copy instead of rewriting the goal</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">move_last_two_left</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"c1\">-- Tactic `rewrite` failed: motive is not type correct</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>When using <code>TS2</code>, rewriting the goal fails with :<code>Tactic 'rewrite' failed: motive is not type correct</code>, and rewriting the hypothesis duplicates it instead of replacing it.</p>\n<p>Is this behaviour expected when the inductive is <code>Prop</code>-indexed, or is there a cleaner way to perform such rewrites? Ideally, I'd like to write rules as in <code>TS2</code> and  define proof goals as in <code>example2</code>.</p>",
        "id": 554912931,
        "sender_full_name": "MBN",
        "timestamp": 1762867547
    },
    {
        "content": "<p>Try <code>revert</code>ing the hypothesis and then rewriting</p>",
        "id": 554941504,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762875265
    },
    {
        "content": "<p><code>rw!</code> usually handles dependent types better than <code>rw</code></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">revert</span><span class=\"w\"> </span><span class=\"n\">ğ’Ÿ</span>\n<span class=\"n\">rw!</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">swap_last_two</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">move_last_two_left</span><span class=\"o\">]</span>\n<span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">ğ’Ÿ</span>\n</code></pre></div>",
        "id": 554957048,
        "sender_full_name": "Vlad",
        "timestamp": 1762879886
    },
    {
        "content": "<p>I should definitely fix <code>rw!</code> soon</p>",
        "id": 554975028,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762886254
    }
]