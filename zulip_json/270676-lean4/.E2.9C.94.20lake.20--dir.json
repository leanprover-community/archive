[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">➜</span><span class=\"w\">  </span><span class=\"n\">sail</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"o\">:(</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">registerless</span><span class=\"bp\">-</span><span class=\"n\">monad</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">✗</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"c1\">--dir test/lean/atom_bool/out/ build</span>\n<span class=\"bp\">✖</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Building</span><span class=\"w\"> </span><span class=\"n\">Out</span><span class=\"bp\">.</span><span class=\"n\">Sail</span><span class=\"bp\">.</span><span class=\"n\">Sail</span>\n<span class=\"n\">trace</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">.&gt;</span><span class=\"w\"> </span><span class=\"n\">LEAN_PATH</span><span class=\"bp\">=</span><span class=\"n\">test</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">atom_bool</span><span class=\"bp\">/</span><span class=\"n\">out</span><span class=\"bp\">//./.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"w\"> </span><span class=\"n\">LD_LIBRARY_PATH</span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">javra</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.13.0/bin/lean test/lean/atom_bool/out//./././Out/Sail/Sail.lean -R test/lean/atom_bool/out//././. -o test/lean/atom_bool/out//./.lake/build/lib/Out/Sail/Sail.olean -i test/lean/atom_bool/out//./.lake/build/lib/Out/Sail/Sail.ilean -c test/lean/atom_bool/out//./.lake/build/ir/Out/Sail/Sail.c --json</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">atom_bool</span><span class=\"bp\">/</span><span class=\"n\">out</span><span class=\"bp\">//./././</span><span class=\"n\">Out</span><span class=\"bp\">/</span><span class=\"n\">Sail</span><span class=\"bp\">/</span><span class=\"n\">Sail</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">43</span><span class=\"o\">:</span><span class=\"mi\">36</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"k\">at</span>\n<span class=\"w\">  </span><span class=\"n\">Vector</span>\n<span class=\"n\">term</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">3420</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">exited</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"n\">Some</span><span class=\"w\"> </span><span class=\"n\">required</span><span class=\"w\"> </span><span class=\"n\">builds</span><span class=\"w\"> </span><span class=\"n\">logged</span><span class=\"w\"> </span><span class=\"n\">failures</span><span class=\"o\">:</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Out</span><span class=\"bp\">.</span><span class=\"n\">Sail</span><span class=\"bp\">.</span><span class=\"n\">Sail</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">failed</span>\n<span class=\"bp\">➜</span><span class=\"w\">  </span><span class=\"n\">sail</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"o\">:(</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">registerless</span><span class=\"bp\">-</span><span class=\"n\">monad</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">✗</span><span class=\"w\"> </span><span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">atom_bool</span><span class=\"bp\">/</span><span class=\"n\">out</span><span class=\"bp\">/</span>\n<span class=\"bp\">➜</span><span class=\"w\">  </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"o\">:(</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">registerless</span><span class=\"bp\">-</span><span class=\"n\">monad</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">✗</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span>\n<span class=\"bp\">⚠</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">3</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Replayed</span><span class=\"w\"> </span><span class=\"n\">Out</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">atom_bool</span><span class=\"bp\">/</span><span class=\"n\">out</span><span class=\"bp\">/./././</span><span class=\"n\">Out</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">7</span><span class=\"o\">:</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unused</span><span class=\"w\"> </span><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"ss\">`lit</span><span class=\"bp\">`</span>\n<span class=\"n\">note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"ss\">`set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">unusedVariables</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"bp\">`</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">atom_bool</span><span class=\"bp\">/</span><span class=\"n\">out</span><span class=\"bp\">/./././</span><span class=\"n\">Out</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">10</span><span class=\"o\">:</span><span class=\"mi\">26</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unused</span><span class=\"w\"> </span><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"ss\">`lit</span><span class=\"bp\">`</span>\n<span class=\"n\">note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"ss\">`set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">unusedVariables</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"bp\">`</span>\n<span class=\"n\">Build</span><span class=\"w\"> </span><span class=\"n\">completed</span><span class=\"w\"> </span><span class=\"n\">successfully</span><span class=\"bp\">.</span>\n</code></pre></div>\n<p>Does <code>lake --dir</code> not use the <code>lean-toolchain</code> of the specifiec package directory? (Ignore the specifics of the above, this is just to show that if I've set the <code>elan default</code> to an old Lean version, the build with <code>lake --dir ... build</code> fails while <code>cd</code>ing and <code>lake build</code> succeeds)</p>",
        "id": 498106226,
        "sender_full_name": "Jakob von Raumer",
        "timestamp": 1738843987
    },
    {
        "content": "<p>cc <span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span></p>",
        "id": 498122527,
        "sender_full_name": "Jakob von Raumer",
        "timestamp": 1738849069
    },
    {
        "content": "<p>No, it does not. Lake's toolchain is determined by its executable (which is versioned by Elan), not its options. <code>--dir</code> does not respawn Lake in the directory or change the process directory -- it just tells Lake where to find the workspace.</p>",
        "id": 498123277,
        "sender_full_name": "Mac Malone",
        "timestamp": 1738849298
    },
    {
        "content": "<p>(As an aside, the reason the option is named <code>--dir</code> rather than <code>-C</code> like Make is because it does not change directories -- though even if it did, that would still be sufficient for it to be the Lake of the directory's toolchian.)</p>",
        "id": 498123638,
        "sender_full_name": "Mac Malone",
        "timestamp": 1738849402
    },
    {
        "content": "<p>Kk, I guess we misinterpreted \"use the package configuration in a specific directory\" then</p>",
        "id": 498124071,
        "sender_full_name": "Jakob von Raumer",
        "timestamp": 1738849521
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110789\">Jakob von Raumer</span> has marked this topic as resolved.</p>",
        "id": 498124094,
        "sender_full_name": "Notification Bot",
        "timestamp": 1738849528
    },
    {
        "content": "<p>I was just bitten by this same misconception (which I notice just because the command I was running now fails because of version mismatch with the directory I was <code>lake exe</code>'ing), isn't this a bit of a footgun?</p>",
        "id": 526422222,
        "sender_full_name": "Julian Berman",
        "timestamp": 1751295407
    },
    {
        "content": "<p>A second minor (CLI parsing?) bug is that</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">⊙</span><span class=\"w\">  </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"c1\">--dir ~/Development/lean4export/ --version</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unknown</span><span class=\"w\"> </span><span class=\"n\">long</span><span class=\"w\"> </span><span class=\"n\">option</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"c1\">--version'</span>\n</code></pre></div>",
        "id": 526422469,
        "sender_full_name": "Julian Berman",
        "timestamp": 1751295481
    },
    {
        "content": "<p>(On the expectation that I and it seems Jakob had -- I understand not exec'ing again but it could be an option to the elan shim presumably?)</p>",
        "id": 526422768,
        "sender_full_name": "Julian Berman",
        "timestamp": 1751295566
    }
]