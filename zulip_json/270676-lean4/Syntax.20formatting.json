[
    {
        "content": "<p>Hey y'all,</p>\n<p>Is there any way to format syntax beyond just using newlines?</p>\n<p>For example, in this mwe: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Parser</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">PrettyPrinter</span><span class=\"w\"> </span><span class=\"n\">Delaborator</span>\n\n<span class=\"n\">declare_syntax_cat</span><span class=\"w\"> </span><span class=\"n\">testSyntax</span>\n\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"start\"</span><span class=\"w\"> </span><span class=\"n\">withPosition</span><span class=\"o\">(</span><span class=\"n\">semicolonOrLinebreak</span><span class=\"w\"> </span><span class=\"n\">ppDedent</span><span class=\"o\">(</span><span class=\"n\">ppLine</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"n\">withPosition</span><span class=\"o\">(</span><span class=\"n\">semicolonOrLinebreak</span><span class=\"w\"> </span><span class=\"n\">ppDedent</span><span class=\"o\">(</span><span class=\"n\">ppLine</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"n\">withPosition</span><span class=\"o\">(</span><span class=\"n\">semicolonOrLinebreak</span><span class=\"w\"> </span><span class=\"n\">ppDedent</span><span class=\"o\">(</span><span class=\"n\">ppLine</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"s2\">\"end\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">testSyntax</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Test</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">test1</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"w\">  </span><span class=\"n\">test2</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">numToIdent</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"o\">:</span><span class=\"n\">TSyntax</span><span class=\"w\"> </span><span class=\"ss\">`term</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TSyntax</span><span class=\"w\"> </span><span class=\"ss\">`num</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Unhygienic</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"n\">num</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">app_unexpander</span><span class=\"w\"> </span><span class=\"n\">Test</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">TestUnexpander</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Unexpander</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">Test</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">n1</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">n2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">id1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">numToIdent</span><span class=\"w\"> </span><span class=\"n\">n1</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">id2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">numToIdent</span><span class=\"w\"> </span><span class=\"n\">n2</span>\n<span class=\"w\">    </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">testSyntax</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">start</span>\n<span class=\"w\">        </span><span class=\"bp\">$</span><span class=\"n\">id1</span>\n<span class=\"w\">        </span><span class=\"bp\">$</span><span class=\"n\">id2</span>\n<span class=\"w\">    </span><span class=\"kn\">end</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">throw</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"bp\">.</span><span class=\"n\">unit</span>\n</code></pre></div>\n<p>I want the numbers to be indented like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">start</span>\n<span class=\"w\">      </span><span class=\"mi\">1</span>\n<span class=\"w\">      </span><span class=\"mi\">2</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 481198944,
        "sender_full_name": "Marx",
        "timestamp": 1731013052
    },
    {
        "content": "<p>In case someone has the same question, here is my solution: </p>\n<p>Its possible to format syntax with </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">ppDedent</span><span class=\"o\">()</span>\n<span class=\"n\">ppIndent</span><span class=\"o\">()</span>\n</code></pre></div>\n<p>Those are no-op parser combinators which take either another parser combinator or a no-op parser like this </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">ppSpace</span>\n<span class=\"n\">ppLine</span>\n</code></pre></div>\n<p>as argument. This lets you format the syntax with indents or newlines.</p>",
        "id": 485716032,
        "sender_full_name": "Marx",
        "timestamp": 1733176940
    }
]