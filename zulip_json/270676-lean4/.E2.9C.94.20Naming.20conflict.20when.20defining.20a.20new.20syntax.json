[
    {
        "content": "<p>I am going to define a small DSL in lean. I don't want my new syntax pollutes the syntax of lean itself, so I declare a new syntax category <code>b</code> and define an evaluation <code>syntax \"[|\" b \"|]\": term</code> as follows.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">inductive</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">And</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Not</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">B</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">f1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">True</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">False</span>\n\n<span class=\"n\">declare_syntax_cat</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"true\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"false\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"n\">syntax</span><span class=\"o\">:</span><span class=\"mi\">20</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">:</span><span class=\"mi\">20</span><span class=\"w\"> </span><span class=\"s2\">\"and\"</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">:</span><span class=\"mi\">21</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"n\">syntax</span><span class=\"o\">:</span><span class=\"mi\">25</span><span class=\"w\"> </span><span class=\"s2\">\"not\"</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">:</span><span class=\"mi\">25</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"[|\"</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"s2\">\"|]\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span>\n\n<span class=\"n\">macro_rules</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">([</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">B.True</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">([</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">B.False</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">([</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">B.And</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">|$</span><span class=\"n\">x</span><span class=\"bp\">|</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">|$</span><span class=\"n\">y</span><span class=\"bp\">|</span><span class=\"o\">])</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">([</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">B.Not</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">|$</span><span class=\"n\">x</span><span class=\"bp\">|</span><span class=\"o\">])</span>\n\n\n<span class=\"k\">#check</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"o\">]</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">f2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">True</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">False</span>\n</code></pre></div>\n<p>In the above code, <code>f1</code> is fine, but when it comes to <code>f2</code>, <code>lean</code> starts to complain that <code>true</code> is an unexpected token. I guess this is because after <code>syntax \"true\"</code>, <code>true</code> becomes a token of <code>lean</code> lexer. Thus, I am no longer able to use <code>true: Bool</code>.</p>\n<p>You may suggest that I use <code>Bool.true</code> instead, but this will still be a problem when it comes to proof tactics.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">example</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intros</span><span class=\"w\"> </span><span class=\"n\">H</span>\n<span class=\"w\">  </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span>\n</code></pre></div>\n<p>How can I fix this? I want to use true and false both for my DSL and <code>Bool</code>. In Coq, you can make such a custom syntax without affecting the existing syntax (<a href=\"https://softwarefoundations.cis.upenn.edu/lf-current/Imp.html#lab399\">here</a>). (Or maybe I should always use <code>@Bool.rec</code> and forget about <code>true</code> and <code>false</code>.)</p>",
        "id": 502487494,
        "sender_full_name": "xiao",
        "timestamp": 1740713792
    },
    {
        "content": "<p>I see <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.ParserDescr.nonReservedSymbol#doc\">docs#Lean.ParserDescr.nonReservedSymbol</a>, but I don't see how to use it. Maybe you can investigate that.</p>",
        "id": 502555252,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1740741877
    },
    {
        "content": "<p>Does <code>syntax &amp;\"true\" : b</code> fix it?</p>",
        "id": 502615797,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1740759698
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"372804\">Marcus Rossel</span> <a href=\"#narrow/channel/270676-lean4/topic/Naming.20conflict.20when.20defining.20a.20new.20syntax/near/502615797\">said</a>:</p>\n<blockquote>\n<p>Does <code>syntax &amp;\"true\" : b</code> fix it?</p>\n</blockquote>\n<p>No, then <code>[| true |]</code> interprets <code>true</code> as an identifier.</p>",
        "id": 502619184,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1740760595
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/270676-lean4/topic/Naming.20conflict.20when.20defining.20a.20new.20syntax/near/502555252\">发言道</a>：</p>\n<blockquote>\n<p>I see <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.ParserDescr.nonReservedSymbol#doc\">docs#Lean.ParserDescr.nonReservedSymbol</a>, but I don't see how to use it. Maybe you can investigate that.</p>\n</blockquote>\n<p>This seems a parser that means <code>Next, I want to parse a symbol that is not in the reserved symbol list.</code>, not some directive I can use to tell lean not to treat a new syntax as a reserved symbol.</p>\n<p>I think this is happening during the parsing (lexing) period and thus I can't control it by macro or elaboration. I am not sure about the implementation of lean parser, but it seems that the parser should use different lexers. I guess they are using the same lexer for all categories while the parsers are different in each category. (Maybe I shall leave this on GitHub?)</p>\n<p>My solution is to define <code>syntax ident: b</code> and <code>Coe Bool B</code>. Since I also want other predefined <code>B</code>-expressions usable in the DSL, this is reasonable in my case. The only con is that I have to do one extra <code>simp</code> step for the coercion. (Thus, it is not harmful to interpret <code>true</code> as an identifier).</p>\n<p>But, I wonder what if two packages have this naming conflict: package <code>A</code> defines some inductive type with <code>foo</code>, <code>bar</code> while package <code>B</code> defines <code>syntax \"foo\" \"bar\"</code>. Is there any good way to solve this? (I can always apply the destructor <code>@some_type.rec</code>, despite the inelegancy.)</p>",
        "id": 502655101,
        "sender_full_name": "xiao",
        "timestamp": 1740772275
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"717159\">xiao</span> <a href=\"#narrow/channel/270676-lean4/topic/Naming.20conflict.20when.20defining.20a.20new.20syntax/near/502655101\">said</a>:</p>\n<blockquote>\n<p>not some directive I can use to tell lean not to treat a new syntax as a reserved symbol.</p>\n</blockquote>\n<p>It's indeed a way to tell Lean not to treat the syntax as a reserved symbol. (<code>&amp;</code> is the syntax for <code>nonReservedSymbol</code> by the way)</p>\n<p>The difficulty here seems to be that category parsers like to try to parse tokens, which causes <code>true</code> to parse as an identifier.</p>\n<p>The <code>nonReservedSymbol</code> parser has an argument that enables reinterpreting identifiers as atoms. It seems to work here:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">nonReservedTrue</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">leading_parser</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Parser</span><span class=\"bp\">.</span><span class=\"n\">nonReservedSymbol</span><span class=\"w\"> </span><span class=\"s2\">\"true\"</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">nonReservedFalse</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">leading_parser</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Parser</span><span class=\"bp\">.</span><span class=\"n\">nonReservedSymbol</span><span class=\"w\"> </span><span class=\"s2\">\"false\"</span><span class=\"w\"> </span><span class=\"n\">true</span>\n\n<span class=\"n\">declare_syntax_cat</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"n\">nonReservedTrue</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"n\">nonReservedFalse</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"kn\">syntax</span><span class=\"o\">:</span><span class=\"mi\">20</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">:</span><span class=\"mi\">20</span><span class=\"w\"> </span><span class=\"s2\">\"and\"</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">:</span><span class=\"mi\">21</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"kn\">syntax</span><span class=\"o\">:</span><span class=\"mi\">25</span><span class=\"w\"> </span><span class=\"s2\">\"not\"</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">:</span><span class=\"mi\">25</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"[|\"</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"s2\">\"|]\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span>\n</code></pre></div>",
        "id": 502657654,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1740773198
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"717159\">xiao</span> <a href=\"#narrow/channel/270676-lean4/topic/Naming.20conflict.20when.20defining.20a.20new.20syntax/near/502655101\">said</a>:</p>\n<blockquote>\n<p>it seems that the parser should use different lexers</p>\n</blockquote>\n<p>Yes, unfortunately the fact that there is one set of reserved tokens is a known limitation of the current Lean parser. Addressing this is planned.</p>",
        "id": 502658016,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1740773324
    },
    {
        "content": "<p>I did it (why was this option so hard to find?)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">And</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Not</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">B</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">f1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">True</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">False</span>\n\n<span class=\"n\">declare_syntax_cat</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">behavior</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">symbol</span><span class=\"o\">)</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"true\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"false\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"kn\">syntax</span><span class=\"o\">:</span><span class=\"mi\">20</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">:</span><span class=\"mi\">20</span><span class=\"w\"> </span><span class=\"s2\">\"and\"</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">:</span><span class=\"mi\">21</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"kn\">syntax</span><span class=\"o\">:</span><span class=\"mi\">25</span><span class=\"w\"> </span><span class=\"s2\">\"not\"</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">:</span><span class=\"mi\">25</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"[|\"</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"s2\">\"|]\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span>\n\n<span class=\"kn\">macro_rules</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">([</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"bp\">.</span><span class=\"n\">True</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">([</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"bp\">.</span><span class=\"n\">False</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">([</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"bp\">.</span><span class=\"n\">And</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">|$</span><span class=\"n\">x</span><span class=\"bp\">|</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">|$</span><span class=\"n\">y</span><span class=\"bp\">|</span><span class=\"o\">])</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">([</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"bp\">.</span><span class=\"n\">Not</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">|$</span><span class=\"n\">x</span><span class=\"bp\">|</span><span class=\"o\">])</span>\n\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"o\">]</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">f2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">True</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">False</span>\n</code></pre></div>",
        "id": 502659393,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1740773884
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> <span class=\"user-mention\" data-user-id=\"816344\">@Aaron Liu</span>  Thank you guys. I think this problem is solved. And I can sit down and wait for the update on the lexer.</p>\n<p>By the way, where do you find the documents on those <code>leading_parser</code> and <code>declare_syntax_cat b (behavior := symbol)</code>? I was reading the metaprogramming book and they are not mentioned. (Did I missed something?)</p>",
        "id": 502660202,
        "sender_full_name": "xiao",
        "timestamp": 1740774210
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"717159\">xiao</span> has marked this topic as resolved.</p>",
        "id": 502660218,
        "sender_full_name": "Notification Bot",
        "timestamp": 1740774219
    },
    {
        "content": "<p>I found <code>declare_syntax_cat b (behavior := symbol)</code> <a href=\"https://lean-lang.org/doc/reference/latest/find/?domain=Verso.Genre.Manual.section&amp;name=syntax-categories\">here</a>, which I got to from <a href=\"https://www.google.com/search?q=lean+define+custom+parser\">a google search</a>, since nothing else had turned useful results yet.</p>",
        "id": 502660616,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1740774379
    },
    {
        "content": "<p>(I didn't actually need <code>leading_parser</code> by the way. It's just a way to make sure the parser gets tagged with a node. It's for core Lean, and it's not really meant for users. Ideally everything can be done with <code>syntax</code>, but this aspect of <code>nonReservedSymbol</code> is not being exposed.)</p>",
        "id": 502660919,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1740774497
    },
    {
        "content": "<p>Thank you again. Maybe I would have read those reference manuals and core code if I were free. (And I have to logout my google account because my search results are quite different.)</p>",
        "id": 502661430,
        "sender_full_name": "xiao",
        "timestamp": 1740774696
    }
]