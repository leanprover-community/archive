[
    {
        "content": "<p>Does anyone have a best practice guideline for using Lean 4 with Gitpod? This used to work:<br>\n<a href=\"https://github.com/avigad/lamr\">https://github.com/avigad/lamr</a><br>\nBut now it gives the message:</p>\n<p>info: downloading component 'lean'<br>\n  error: binary package was not provided for 'linux'</p>\n<p>I can fix it by typing <code>elan self update</code> and then <code>lake build</code> in the terminal and then restarting the server. But if I try adding <code>lean self update</code> to the <code>init</code> portion of the <code>.yml</code> file, it doesn't work.</p>\n<p>As a fallback, I suppose I can delete the line that fetches elan and let the Lean 4 extension do it. But it would be nice to do <code>lake build</code> in the <code>init</code> section, because Gitpod will prebuild the image with that and make loading faster.</p>",
        "id": 307433205,
        "sender_full_name": "Jeremy Avigad",
        "timestamp": 1667350802
    },
    {
        "content": "<p>Update: updating elan in the Dockerfile (instead of the yml file) seems to have done the trick! So, never mind (unless someone has a better solution).</p>",
        "id": 307434204,
        "sender_full_name": "Jeremy Avigad",
        "timestamp": 1667351454
    },
    {
        "content": "<p>Any change to the Dockerfile probably would have been sufficient because it would invalidate the cached image. You can also do so manually without editing the file, <a href=\"https://www.gitpod.io/docs/configure/workspaces/workspace-image#manually-rebuild-a-workspace-image\">https://www.gitpod.io/docs/configure/workspaces/workspace-image#manually-rebuild-a-workspace-image</a></p>",
        "id": 307476004,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1667379221
    },
    {
        "content": "<p>Wanting to get a little experience with Lean 4, I recently watched Scott's tutorial on porting things to Lean 4. I started following the instructions but I stopped when it got to the point where I had to actually install Lean 4, because it was telling me I would have to update elan, and I was afraid that would interfere with my Rosetta installation of elan. Is there a way of working on mathlib4 through Gitpod?</p>",
        "id": 307494097,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1667385632
    },
    {
        "content": "<p>Is there a reason that video is unlisted by the way <span class=\"user-mention\" data-user-id=\"110087\">@Scott Morrison</span> ? I thought it was a good tutorial on the porting process.</p>",
        "id": 307495958,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1667386260
    },
    {
        "content": "<p>Only that it seemed likely to quickly become outdated. I don't mind if it is switched to public so people can find it on the leanprover-community YouTube page. I'm away from a computer at that moment but if I remember tomorrow I'll change the setting.</p>",
        "id": 307496383,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1667386429
    },
    {
        "content": "<p>I’ve found packing more instructions in the Dockerfile than in the bespoke config files (either GitPod or Codespaces) to generally be better.</p>",
        "id": 307499919,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1667387733
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"282271\">Bolton Bailey</span> <a href=\"#narrow/stream/270676-lean4/topic/Gitpod/near/307494097\">said</a>:</p>\n<blockquote>\n<p>because it was telling me I would have to update elan, and I was afraid that would interfere with my Rosetta installation of elan</p>\n</blockquote>\n<p>I'm not aware of anything that could go wrong with that fwiw. You should not need a second elan.</p>",
        "id": 307501819,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1667388460
    },
    {
        "content": "<p>Opening mathlib4 in gitpod currently results in </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\"> </span><span class=\"n\">HISTFILE</span><span class=\"bp\">=/</span><span class=\"n\">workspace</span><span class=\"bp\">/.</span><span class=\"n\">gitpod</span><span class=\"bp\">/</span><span class=\"n\">cmd</span><span class=\"bp\">-</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">history</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">r</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"n\">elan</span><span class=\"w\"> </span><span class=\"n\">self</span><span class=\"w\"> </span><span class=\"n\">update</span>\n<span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span>\n\n<span class=\"o\">}</span>\n<span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">r</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">workspace</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">master</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\">  </span><span class=\"n\">HISTFILE</span><span class=\"bp\">=/</span><span class=\"n\">workspace</span><span class=\"bp\">/.</span><span class=\"n\">gitpod</span><span class=\"bp\">/</span><span class=\"n\">cmd</span><span class=\"bp\">-</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">history</span>\n<span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">elan</span><span class=\"w\"> </span><span class=\"n\">self</span><span class=\"w\"> </span><span class=\"n\">update</span>\n<span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span>\n<span class=\"bp\">&gt;</span>\n<span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">downloading</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">lean'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">installing</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">lean'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">batteries</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">batteries</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"bp\">'././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">batteries'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Qq</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">quote4</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"bp\">'././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">Qq'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">aesop</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">aesop</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"bp\">'././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">aesop'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">proofwidgets</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">ProofWidgets4</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"bp\">'././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">proofwidgets'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">importGraph</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"kn\">import</span><span class=\"bp\">-</span><span class=\"n\">graph</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"bp\">'././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">importGraph'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LeanSearchClient</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">LeanSearchClient</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"bp\">'././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">LeanSearchClient'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">plausible</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">plausible</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"bp\">'././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">plausible'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Cli</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"bp\">-</span><span class=\"n\">cli</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"bp\">'././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">Cli'</span>\n<span class=\"bp\">✖</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">10</span><span class=\"bp\">/</span><span class=\"mi\">10</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Building</span><span class=\"w\"> </span><span class=\"n\">cache</span>\n<span class=\"n\">trace</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">.&gt;</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">gitpod</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.14.0-rc1/bin/leanc -o ././.lake/build/bin/cache ././.lake/build/ir/Cache/Main.c.o.export ././.lake/build/ir/Cache/IO.c.o.export ././.lake/build/ir/Cache/Hashing.c.o.export ././.lake/build/ir/Cache/Requests.c.o.export</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"n\">ld</span><span class=\"bp\">.</span><span class=\"n\">lld</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unable</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">find</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">lpthread</span>\n<span class=\"n\">ld</span><span class=\"bp\">.</span><span class=\"n\">lld</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unable</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">find</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">ldl</span>\n<span class=\"n\">ld</span><span class=\"bp\">.</span><span class=\"n\">lld</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unable</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">find</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">lrt</span>\n<span class=\"n\">clang</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">linker</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">exit</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">see</span><span class=\"w\"> </span><span class=\"n\">invocation</span><span class=\"o\">)</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">external</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">'/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">gitpod</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.14.0-rc1/bin/leanc' exited with code 1</span>\n<span class=\"n\">Some</span><span class=\"w\"> </span><span class=\"n\">required</span><span class=\"w\"> </span><span class=\"n\">builds</span><span class=\"w\"> </span><span class=\"n\">logged</span><span class=\"w\"> </span><span class=\"n\">failures</span><span class=\"o\">:</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">cache</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">failed</span>\n</code></pre></div>",
        "id": 480703565,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1730807805
    },
    {
        "content": "<p>Did Lean recently start requiring new libraries <code>lpthread</code>, <code>ldl</code>, <code>lrt</code>?</p>",
        "id": 480703990,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1730807940
    },
    {
        "content": "<p>I saw someone else flagging a linking issue on zulip yesterday (?)</p>",
        "id": 480704265,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1730808022
    },
    {
        "content": "<p>Seems likely but this can be fixed in the docker image file</p>",
        "id": 480704796,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730808191
    },
    {
        "content": "<p>Thanks, this makes it easier to reproduce than <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/lake.20exe.20cache.20get.20error\">#mathlib4 &gt; lake exe cache get error</a>. It is definitely not intended.</p>",
        "id": 480705354,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1730808404
    },
    {
        "content": "<p>There is now <a href=\"https://github.com/leanprover/lean4/pull/5966\">lean4#5966</a> to fix it</p>",
        "id": 480762292,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1730825157
    },
    {
        "content": "<p>While on the subject of gitpod, do we know how gitpod's plans to switch to their flex setup help/hinder us?</p>",
        "id": 480763530,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730825573
    },
    {
        "content": "<p>I believe there is an option to self-host freely. Also their gitpod desktop installation takes care of installing docker (although currently it only works on macOS, they have suggested that windows and linux releases can be expected).</p>",
        "id": 480763638,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730825617
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/270676-lean4/topic/Gitpod/near/480762292\">said</a>:</p>\n<blockquote>\n<p>There is now <a href=\"https://github.com/leanprover/lean4/pull/5966\">lean4#5966</a> to fix it</p>\n</blockquote>\n<p>This is now released as 4.14.0-rc2 and the toolchain on mathlib master is updated, so Gitpod is usable again.</p>",
        "id": 480854006,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1730875495
    }
]