[
    {
        "content": "<p>I thought that it was possible to set the value of options from the command line, when using <code>lake build</code>.  I tried several flags, such as <code>-D</code>, <code>-K</code>, <code>-R</code>, but none seem to work.</p>\n<p>Could someone given me an example of how to build a file, say with the <code>Elab.async</code> option set to false, please?</p>\n<p>Thanks!</p>",
        "id": 541825318,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1758995580
    },
    {
        "content": "<p>I'm setting an option with <code>-K</code> here:</p>\n<p><a href=\"https://github.com/hhu-adam/GameSkeleton/blob/main/lakefile.lean#L34-L39\">https://github.com/hhu-adam/GameSkeleton/blob/main/lakefile.lean#L34-L39</a></p>\n<p>My guess would be that you'd need <code>-R -Kyour.option</code></p>",
        "id": 541880521,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1759054075
    },
    {
        "content": "<p>Thanks!  This no longer gives me an error, but does not seem to actually set the option.</p>",
        "id": 541880719,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1759054302
    },
    {
        "content": "<p>I have tried with <code>lake build -R -K[weak.]my.option[=true]</code> with all combinations of present and not for the parts in square brackets.</p>",
        "id": 541880762,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1759054361
    },
    {
        "content": "<p>None gives an error, but also none seems to have the desired effect: it only seems to build the file as is.</p>",
        "id": 541880777,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1759054379
    },
    {
        "content": "<p>I'll look more closely at the actual code that you linked, since I would actually like to run this from within a lean script.</p>",
        "id": 541880811,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1759054423
    },
    {
        "content": "<p>ok I do get the same results, and I wonder if it's even possible to set the Lean options per file through lake...</p>\n<p>To minimise the example above </p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>lakefile.lean</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lake</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">DSL</span>\n\n<span class=\"n\">package</span><span class=\"w\"> </span><span class=\"s2\">\"OptionTest\"</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"bp\">!</span><span class=\"s2\">\"0.1.0\"</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">default_target</span><span class=\"kd\">]</span>\n<span class=\"n\">lean_lib</span><span class=\"w\"> </span><span class=\"n\">OptionTest</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">default_target</span><span class=\"kd\">]</span>\n<span class=\"n\">lean_exe</span><span class=\"w\"> </span><span class=\"s2\">\"optiontest\"</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">root</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"ss\">`Main</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"k\">#eval</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">IO.println</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">get_config</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"n\">Elab.async</span><span class=\"w\"> </span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- `true` or `false` depending on the `-K` option</span>\n</code></pre></div>\n</div></div>\n<p>using <code>get_config?</code> I can change the options with <code>lake update -R -KElab.async=false</code> inside the lakefile, but this does not seem to change to option for any other file</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>OptionTest/File1.lean</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">getValue</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">key</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CoreM</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">dbg_trace</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"Value of `Elab.async` in {key}: {Elab.async.get (‚Üê getOptions)}\"</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">getValue</span><span class=\"w\"> </span><span class=\"s2\">\"file 1\"</span><span class=\"w\"> </span><span class=\"c1\">-- always `true`</span>\n</code></pre></div>\n</div></div>\n<p>(my test is temporarily uploaded here: <a href=\"https://github.com/joneugster/OptionTest\">https://github.com/joneugster/OptionTest</a>)</p>",
        "id": 541883755,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1759057594
    },
    {
        "content": "<p><code>lean -DElab.async=false OptionTest/File1.lean</code> does set the option as expected, but that only works for files wich no imports, as <code>lake</code> is not used.</p>",
        "id": 541884139,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1759057988
    },
    {
        "content": "<p>Ah, so the issue is that the option that is set from <code>lake build</code> is overridden by the one in the lakefile?</p>",
        "id": 541884286,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1759058105
    },
    {
        "content": "<p>All that I want to achieve is the same as adding <code>set_option ...</code> at the start of a file and build it.</p>",
        "id": 541884351,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1759058185
    },
    {
        "content": "<p>Currently, I'm actually editing the file to include the extra line, saving it and then building the edited file.</p>",
        "id": 541884369,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1759058215
    },
    {
        "content": "<p>However, editing the lakefile is not really an option for me, since then lean would build all the dependencies of my file, whereas I already have a working cache.</p>",
        "id": 541884469,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1759058330
    },
    {
        "content": "<p>I'm not sure either, sorry. But I'd be interested in knowing the answer, too!</p>",
        "id": 541884825,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1759058719
    },
    {
        "content": "<p>No worries!  I am glad that someone else tried this and confirmed that it is not immediately clear how to do that!</p>",
        "id": 541884856,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1759058756
    },
    {
        "content": "<p>To explain,<code>-K</code> is used to set Lake options, not Lean options. Lean options can be configured via <code>moreLeanOptions</code> on a package / library in a lakefile. If the lakefile supports it, Lake options can be used to configure Lean options.  Otherwise, one must modify the lakefile.</p>",
        "id": 542160803,
        "sender_full_name": "Mac Malone",
        "timestamp": 1759190568
    },
    {
        "content": "<p>Ah, that explains a lot, thanks!</p>",
        "id": 542175436,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1759201876
    },
    {
        "content": "<p>It never occurred to me that \"option\" could refer to a Lake option, rather than a Lean option!</p>",
        "id": 542175489,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1759201929
    },
    {
        "content": "<p>So, it looks like editing the file is not easy to avoid programmatically.</p>",
        "id": 542175524,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1759201973
    }
]