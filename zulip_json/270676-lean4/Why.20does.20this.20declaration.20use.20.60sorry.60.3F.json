[
    {
        "content": "<p>I'm trying to understand how some of the internals of the elaborator work and I can't figure out why declarations like this end up involving <code>sorry</code> when the corresponding <code>native_decide</code> proof doesn't.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">implemented_by</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">true'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">true</span>\n\n<span class=\"sd\">/-- warning: declaration uses `sorry` -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">reduceBool</span><span class=\"w\"> </span><span class=\"n\">true'</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"sd\">/-- info: 'sorry?' depends on axioms: [sorryAx, Lean.trustCompiler] -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">axioms</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"bp\">?</span>\n\n<span class=\"c1\">-- The proof of `sorry?` is actually just a `sorry` term.</span>\n<span class=\"sd\">/-- info: sorry -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">reduce</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">proofs</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"bp\">?</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">notSorry</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">true'</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">native_decide</span>\n\n<span class=\"sd\">/-- info: 'notSorry' depends on axioms: [Lean.ofReduceBool, Lean.trustCompiler] -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">axioms</span><span class=\"w\"> </span><span class=\"n\">notSorry</span>\n</code></pre></div>\n<p>Perhaps relatedly, the <code>#check</code> here just silently fails, producing no message or error.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">implemented_by</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">true'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">true</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">reduceBool</span><span class=\"w\"> </span><span class=\"n\">true'</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">)</span>\n</code></pre></div>\n<p><a href=\"https://github.com/leanprover/lean4/issues/12216\">I know that the behavior of <code>native_decide</code> is probably going to change eventually</a>, but I just want to understand where this <code>sorry</code> is coming from.</p>",
        "id": 570693846,
        "sender_full_name": "James E Hanson",
        "timestamp": 1769653298
    },
    {
        "content": "<p>uhoh</p>",
        "id": 570695354,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1769654481
    },
    {
        "content": "<p>is there not an error on the <code>rfl</code>?</p>",
        "id": 570695362,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1769654493
    },
    {
        "content": "<p>like \"type mismatch\" or something</p>",
        "id": 570695383,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1769654505
    },
    {
        "content": "<p>I believe you get an error if you try to compile it, but you don't in the editor.</p>",
        "id": 570696128,
        "sender_full_name": "James E Hanson",
        "timestamp": 1769655047
    },
    {
        "content": "<p>The thing is that I think <code>Lean.reduceBool true'</code> is supposed to be definitionally equal to <code>true</code> (because of how <code>Lean.reduceBool</code> has special treatment in the kernel), and it would be if <code>true'</code> was defined in an import instead of in the same file.</p>",
        "id": 570697177,
        "sender_full_name": "James E Hanson",
        "timestamp": 1769655803
    },
    {
        "content": "<p>It doesn't work because <code>Bool.true</code> is a constructor and thus doesn't have an executable IR declaration associated to it</p>",
        "id": 570765778,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1769684911
    },
    {
        "content": "<p>but the lack of error is weird</p>",
        "id": 570765808,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1769684919
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"873547\">Robin Arnez</span> <a href=\"#narrow/channel/270676-lean4/topic/Why.20does.20this.20declaration.20use.20.60sorry.60.3F/near/570765778\">said</a>:</p>\n<blockquote>\n<p>It doesn't work because <code>Bool.true</code> is a constructor and thus doesn't have an executable IR declaration associated to it</p>\n</blockquote>\n<p>Why does it behave differently than this example then?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- error: (interpreter) unknown declaration 'Bool.true' -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">reduceBool</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>",
        "id": 570833469,
        "sender_full_name": "James E Hanson",
        "timestamp": 1769702139
    }
]