[
    {
        "content": "<p>Hello,</p>\n<p>I am trying to prove <code>theorem question (x : ℝ) : (x^3)^(1/3) = x := by</code>. I was trying <code>ring</code> and <code>ring_nf</code>. Both gave me the resulting goal <code>1 = x</code>, which is strange.</p>\n<p>I wonder why this happened and how in general do we solve such theorem?</p>\n<p>Thanks in advance!</p>",
        "id": 503506588,
        "sender_full_name": "Tianxiang Xia",
        "timestamp": 1741179551
    },
    {
        "content": "<p>This is not a problem that <code>ring</code> can solve, because you can't take cube roots in general rings. As a fallback, <code>ring</code> calls <code>ring_nf</code>, which explains why they gave the same result.</p>",
        "id": 503508183,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1741179863
    },
    {
        "content": "<p><del>In fact, this is not a problem anyone can solve, because it is unprovable: if <code>x = 2</code> then the goal is <code>2 = 8</code>, which is false.</del></p>",
        "id": 503508501,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1741179939
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/270676-lean4/topic/Weird.20.60ring.60performance.20and.20how.20to.20simplify.20.60.28x.5E3.29.5E.281.2F3.29.60/near/503508183\">said</a>:</p>\n<blockquote>\n<p>This is not a problem that <code>ring</code> can solve, because you can't take cube roots in general rings. As a fallback, <code>ring</code> calls <code>ring_nf</code>, which explains why they gave the same result.</p>\n</blockquote>\n<p>Thanks!</p>\n<p>Then any idea on how to solve the original theorem? <code>theorem question (x : ℝ) : (x^3)^(1/3) = x := by</code></p>\n<p>I am also interested in why <code>ring_nf</code> will \"simplify\" the goal into such an unsolvable goal</p>",
        "id": 503509126,
        "sender_full_name": "Tianxiang Xia",
        "timestamp": 1741180092
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span></p>\n<p>Sorry for the wrong theorem. Just edited. <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span> Now the result of <code>ring_nf</code> is still strange and I don't know how to solve the original theorem...</p>",
        "id": 503509670,
        "sender_full_name": "Tianxiang Xia",
        "timestamp": 1741180234
    },
    {
        "content": "<p><code>1 / 3 = 0</code></p>",
        "id": 503509720,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1741180247
    },
    {
        "content": "<p>This is because you didn't tell Lean <code>1 / 3</code> was supposed to be a real number. Try doing <code>(1 / 3 : ℝ)</code> instead</p>",
        "id": 503509851,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1741180278
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/270676-lean4/topic/Weird.20.60ring.60performance.20and.20how.20to.20simplify.20.60.28x.5E3.29.5E.281.2F3.29.60/near/503509720\">said</a>:</p>\n<blockquote>\n<p><code>1 / 3 = 0</code></p>\n</blockquote>\n<p>Ah... Okay. Now the <code>ring_nf</code> does nothing. Any insight on solving <code>theorem question (x : ℝ) : (x^3)^(1/3 : ℝ) = x := by</code> ?</p>",
        "id": 503510694,
        "sender_full_name": "Tianxiang Xia",
        "timestamp": 1741180477
    },
    {
        "content": "<p>This is <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Real.pow_rpow_inv_natCast#doc\">docs#Real.pow_rpow_inv_natCast</a></p>",
        "id": 503511133,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1741180565
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"884272\">Tianxiang Xia</span> has marked this topic as resolved.</p>",
        "id": 503511496,
        "sender_full_name": "Notification Bot",
        "timestamp": 1741180649
    },
    {
        "content": "<p>The theorem still isn't true even if the power is real; the cube root of a negative number is, I believe, not what you think it is.</p>",
        "id": 503534904,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1741185547
    },
    {
        "content": "<p>True.. I need to suppose x&gt;=0 then.</p>",
        "id": 503540971,
        "sender_full_name": "Tianxiang Xia",
        "timestamp": 1741186859
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">rpow_def</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">ofReal_neg</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">ofReal_one</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">ofReal_inv</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">ofReal_ofNat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ne_eq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">neg_eq_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">one_ne_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">not_false_eq_true</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">cpow_def_of_ne_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">log_neg_one</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mul_right_comm</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">exp_mul_I</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">norm_cast</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">add_re</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">ofReal_re</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"c1\">-- non-confluence</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">ofReal_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">ofReal_im</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">ofReal_inv</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">ofReal_ofNat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">mul_re</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">I_re</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">I_im</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">mul_one</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">zero_sub</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"c1\">-- more non-confluence</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">neg_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">add_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_one_div</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">cos_pi_div_three</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>This is basically a combination of <code>simp</code> and <code>norm_cast</code> except that <code>simp</code> seems super-nonconfluent around this part of the library.</p>",
        "id": 503549807,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1741188719
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/270676-lean4/topic/.E2.9C.94.20Weird.20.60ring.60performance.20and.20how.20to.20simplify.20.60.28x.5E3.29.5E.281.2F3.29.60/near/503509720\">said</a>:</p>\n<blockquote>\n<p><code>1 / 3 = 0</code></p>\n</blockquote>\n<p>This is why I write <code>3⁻¹</code> instead</p>",
        "id": 503551355,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1741189050
    },
    {
        "content": "<p>Rather annoyingly, we have <code>Real.cos_pi_div_three</code> but not <code>Real.cos_pi_mul_inv_three</code>, so I had to fight against the <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>3</mn><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">3^{-1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord\">3</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span> in the above proof. This reminds me of the old <code>sub_eq_add_neg</code> thing which in core Lean 3.4.1 was marked as <code>@[simp]</code> and one of the first things we did after the fork was to remove this. All the <code>simp only</code> calls are (<code>simp?</code> + remove stuff like <code>one_div</code>) but there were other problems too, like <code>simp</code> eagerly wanting to change <code>Real.sin x : \\C</code> back to <code>Complex.sin (x : \\C)</code> which was the wrong direction for this proof.</p>",
        "id": 503553879,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1741189557
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/25364\">#25364</a> is related to the original question here</p>",
        "id": 521731875,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748867073
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">rpow_def_of_neg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">norm_num</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">log_neg_eq_log</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">log_one</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">zero_mul</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">exp_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">one_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">one_div_mul_eq_div</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">cos_pi_div_three</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 521733477,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1748867455
    },
    {
        "content": "<p>I mentioned this on the PR, but I'll repeat it here:</p>\n<blockquote>\n<p>Unless you can provide a reason that this is a truly useful mathematical concept (i.e., I want a situation in which you were working on something else, and having this would have made your life easier), I personally would prefer not to add it. From my point of view, all it does it exchange one (semi-unexpected) behavior for new users for a different one.</p>\n</blockquote>",
        "id": 521818129,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1748889661
    }
]