[
    {
        "content": "<p>Currently in Lean we have <code>List.min? [Min α] : List α → Option α</code>, and in Batteries we have <code>Array.min? [Ord α] : Array α → Option α</code> (which is in turn defined in terms of <code>minD [Ord α] : Array α → α → α</code> and <code>minWith [Ord α] : Array → α → α</code>).</p>\n<p>I would like to make these uniform, and would like to solicit input on the design.</p>\n<ol>\n<li>I could \"weaken\" <code>List.min?</code> to require an <code>Ord α</code> instance instead: the use cases I know of would survive fine.</li>\n<li>\n<p>We could add an instance from <code>Ord</code> to <code>Min</code>, and then switch the existing <code>Array</code> functions to only require <code>Min</code>.</p>\n<ul>\n<li>This would require some care with the semantics, but I think works out.</li>\n<li>The Array functions produce the \"first minimal element\", i.e. if they encounter a comparison of <code>Ordering.eq</code> they prefer the first one. </li>\n<li>If we make the default <code>Min</code> instance from <code>Ord</code> behave the same way (which would be consistent with all our existing definitions of <code>min</code>) then there will be no change in behaviour.</li>\n<li>Expanding the doc-string could clarify what happens if you provide a <code>Min</code> instance with different behaviour.</li>\n</ul>\n</li>\n</ol>\n<p>I have a preference for 2. (it generalizes rather than restricts) but I'm happy to have input, particularly if I'm wrong about preserving the semantics or efficiency.</p>\n<p>As far as I can see this won't affect Mathlib, hence posting here.</p>",
        "id": 473421964,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1727594493
    },
    {
        "content": "<p>Although archaic, <a href=\"https://github.com/leanprover/lean4/pull/1777\">lean4#1777</a> is relevant here.</p>",
        "id": 473425849,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727597693
    },
    {
        "content": "<p>Yes. We need to punt on big decisions about <code>Ord</code>, and just deal with this question in the context of the status quo.</p>",
        "id": 473426561,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1727598382
    },
    {
        "content": "<p>I like 2, but I think we need to consider what <code>Ord</code> is supposed to be accomplishing. Is it a mechanism for defining an ordering on a type, or is it somehow independent from it?</p>",
        "id": 473429633,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1727600452
    },
    {
        "content": "<p>If the intention is the former, then yeah, I think <a href=\"https://github.com/leanprover/lean4/pull/1777\">lean4#1777</a> should get approved, and defining <code>Array.min?</code> in terms of <code>Min</code> is the way to go</p>",
        "id": 473429670,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1727600484
    },
    {
        "content": "<p>To clarify: we are not discussing the design of <code>Ord</code> here, and <a href=\"https://github.com/leanprover/lean4/pull/1777\">lean4#1777</a> is not under consideration today. :-)</p>",
        "id": 473432386,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1727602429
    },
    {
        "content": "<p>(I hope eventually, but a redesign of <code>Ord</code> is not on the agenda now.)</p>",
        "id": 473432447,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1727602469
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/348111-batteries/topic/Design.20of.20.60List.2Emin.3F.60.20.2F.20.60Array.2Emin.3F.60/near/473426561\">said</a>:</p>\n<blockquote>\n<p>Yes. We need to punt on big decisions about <code>Ord</code>, and just deal with this question in the context of the status quo.</p>\n</blockquote>\n<p>I agree with the sentiment but that seems idealistic. Both options implicitly propose a definition of what it means to have a lawful combination of <code>Min</code> and <code>Ord</code>, with 1 being slightly less prescriptive. This is of course contributing to the problem that <a href=\"https://github.com/leanprover/lean4/pull/1777\">lean4#1777</a> aims to resolve. To really punt the issue, 1 and providing both left and right variants works, but this is silly since the distinction is irrelevant in the vast majority of applications.</p>",
        "id": 473432849,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727602824
    },
    {
        "content": "<p>How about 2 with just saying that the definition is <code>foldl min</code> or <code>foldr min</code> (whichever one you pick) to make the outcome clear. The user is left to figure out the implications.</p>",
        "id": 473433064,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727603006
    },
    {
        "content": "<p>I guess that's actually just 2... It seems that I just convinced myself that I'm on board with 2. <span aria-label=\"smirk\" class=\"emoji emoji-1f60f\" role=\"img\" title=\"smirk\">:smirk:</span></p>",
        "id": 473433354,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727603246
    },
    {
        "content": "<p>Actually, I think the most important invariant should be <code>[a, b].min? = some (min a b)</code>, so 2 is better in that sense too.</p>",
        "id": 473433983,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727603824
    },
    {
        "content": "<p>Am I right in saying that Mathlib hijacks <code>Min</code> for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Sup#doc\">docs#Sup</a> ? Or do we only attempt that on linear orders?</p>",
        "id": 473490929,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1727644114
    },
    {
        "content": "<p>I don't think we enable <code>Min</code> on lattices</p>",
        "id": 473491847,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727645005
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"459227\">Violeta Hernández</span> <a href=\"#narrow/stream/348111-batteries/topic/Design.20of.20.60List.2Emin.3F.60.20.2F.20.60Array.2Emin.3F.60/near/473429670\">said</a>:</p>\n<blockquote>\n<p>I think <a href=\"https://github.com/leanprover/lean4/pull/1777\">lean4#1777</a> should get approved,</p>\n</blockquote>\n<p>Without wanting to hijack this thread, I haven't seen any objections yet so thought I should note I have some - I left some comments there.</p>",
        "id": 473494492,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1727647405
    }
]