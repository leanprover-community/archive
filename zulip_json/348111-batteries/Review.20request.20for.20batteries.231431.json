[
    {
        "content": "<p>I have addressed one of the few remaining proof_wanteds in batteries, see <a href=\"https://github.com/leanprover-community/batteries/pull/1431\">batteries#1431</a>. I hope this will be a fairly straightforward review. </p>\n<p>My only comment is that I could see an argument for Mathlib's <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Fin.find_min#doc\">docs#Fin.find_min</a> to be ported over to batteries (which I would have made use of here).</p>",
        "id": 541784917,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758960159
    },
    {
        "content": "<p>Actually having said that I realise maybe I've just proved the equivalent of it for Fin.find?. Also... Fin.find and Fin.find? seem pretty much identical in function except the latter takes Bool-valued predicates and the former takes Decidable Prop-valued ones. These are not very different.</p>",
        "id": 541785135,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758960374
    },
    {
        "content": "<p>I think the plan was to eventually deprecate Mathlib's <code>Fin.find</code> for Batteries <code>Fin.find?</code> but that fell out of sight.</p>",
        "id": 541824550,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1758995033
    },
    {
        "content": "<p>Makes sense. I have an alternative plan I'm working on for that.</p>",
        "id": 541827034,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758996720
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"119741\">@François G. Dorais</span> hey: have responded to your easy review comments but there's one persistent one I want to respond to: namely this thing about the \"&lt;\" condition being redundant.</p>\n<p>It \"obviously\" is redundant. However... I found the proof of the iff that I began with a lot easier to just do straightforwardly by induction if it is included - it's a lot more natural. It's like trying to work with Nat.find while not using Nat.find_min.</p>\n<p>It's obvious that if a witness exists, a minimal witness exists. However... just because something is obvious doesn't suffice. Where is the theorem that proves it? I couldn't find it (perhaps I missed it).</p>",
        "id": 541845678,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759015166
    },
    {
        "content": "<p>From a certain perspective, this <em>is</em> the theorem that proves this.</p>",
        "id": 541845693,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759015191
    },
    {
        "content": "<p>If you can provide me with the library theory that expresses the obvious thing, I'll be happy.</p>",
        "id": 541845740,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759015244
    },
    {
        "content": "<p>It feels like a thing that should surely exist, I agree!</p>",
        "id": 541846123,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759015724
    },
    {
        "content": "<p>Lacking the API I have written in <a href=\"https://github.com/leanprover-community/mathlib4/pull/30037\">#30037</a> for a new Fin.find, though, I'm not sure how one expresses \"minimal solution\".</p>",
        "id": 541846214,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759015839
    },
    {
        "content": "<p>Is there a reason you wouldn't use the strong form <code>findSome?_eq_some_iff</code> or <code>find?_eq_some_iff</code> when you also need minimality? My thought is that someone using <code>find?_isSome_iff</code> doesn't care about the value of <code>find?</code> so probably doesn't care about minimality either.</p>",
        "id": 541883880,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1759057722
    },
    {
        "content": "<p>Yeah it's a good point. I'm not even really sure when you'd use the isSome one!</p>",
        "id": 541883950,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759057798
    },
    {
        "content": "<p>I think I've come down on the side of it being good to have both iffs (the one that looks weaker and the one that looks stronger). I'm not sure about naming though.</p>",
        "id": 541883994,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759057839
    },
    {
        "content": "<p>The name is incorrect.</p>",
        "id": 541884540,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1759058412
    },
    {
        "content": "<p>Indeed. Really I think it wants something after the iff? I'm happy to hear suggestions.</p>",
        "id": 541884644,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759058539
    },
    {
        "content": "<p>We can figure that out in the second review pass.</p>",
        "id": 541885658,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1759059480
    },
    {
        "content": "<p>Alright. I think it might nearly be ready for that but I will have a check.</p>",
        "id": 541885689,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759059510
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"119741\">@François G. Dorais</span> I would like to mimic the naming of Init.Data.List.Find with e.g. <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.find%3F_replicate_of_neg#doc\">docs#List.find?_replicate_of_neg</a></p>",
        "id": 541894740,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759068248
    },
    {
        "content": "<p>i.e. use <code>pos</code> and <code>neg</code> and have <code>p j = true</code> and <code>¬ p j = true</code>.</p>",
        "id": 541894769,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759068276
    },
    {
        "content": "<p>Why not <code>eq_true</code> and <code>ne_true</code>?</p>",
        "id": 541895160,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1759068612
    },
    {
        "content": "<p>I like that more, but it is less the standard.</p>",
        "id": 541896298,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759069629
    },
    {
        "content": "<p>Also: how would you feel about adding the following lemma into the Fin namespace in an appropriate place:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">fin_exists_iff_exists_min</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidablePred</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">_⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"n\">elim0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">_⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"n\">elim0</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">exists_fin_succ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">forall_fin_succ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">not_lt_zero</span><span class=\"o\">,</span>\n<span class=\"w\">      </span><span class=\"n\">false_implies</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">implies_true</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">and_true</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">succ_lt_succ_iff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">succ_pos</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">forall_const</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">by_cases</span><span class=\"w\"> </span><span class=\"n\">h0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">grind</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ih</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">grind</span>\n</code></pre></div>",
        "id": 541896330,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759069649
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"119741\">François G. Dorais</span> <a href=\"#narrow/channel/348111-batteries/topic/Review.20request.20for.20batteries.231431/near/541895160\">said</a>:</p>\n<blockquote>\n<p>Why not <code>eq_true</code> and <code>ne_true</code>?</p>\n</blockquote>\n<p>Specifically to be fair it is less the standard <em>when they are a hypothesis</em>.</p>",
        "id": 541896446,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759069780
    },
    {
        "content": "<p>A bit of a bummer but since <code>ne_true</code> is not simp NF we really should use <code>eq_false</code> instead. I'm not a huge fan of this simp lemma but I don't think that will change.</p>",
        "id": 541897104,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1759070368
    },
    {
        "content": "<p>Mmm. I think the other issue is that it makes it a bit less straightforward to compare to a predicate, but maybe.</p>",
        "id": 541897277,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759070518
    },
    {
        "content": "<p>Agreed. But <code>decide P = false</code> simps to <code>¬P</code> so it might not be too bad.</p>",
        "id": 541898278,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1759071391
    },
    {
        "content": "<p>Another handy lemma:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">exists_minimal</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidablePred</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">heq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">find?</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">decide</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">decide_eq_true_iff</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">isSome_find?_of_eq_true</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">decide</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">heq</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">exists</span><span class=\"w\"> </span><span class=\"n\">i</span>\n<span class=\"w\">    </span><span class=\"n\">simp_all</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">find?_eq_some_iff</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 541899427,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1759072412
    },
    {
        "content": "<p>Oh yes that is even better. Though I think neither entirely help with the findSome? = some a ones, because basically there's this <code>a</code> parameter.</p>",
        "id": 541899506,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759072497
    },
    {
        "content": "<p>My one does avoid the use of Fin.find? which I do prefer.</p>",
        "id": 541899550,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759072533
    },
    {
        "content": "<p>I never asked to change <code>findSome?_eq_some_iff</code> nor <code>find?_eq_some_iff</code>, these are fine. But <code>isSome_findSome?_iff</code> and <code>isSome_find?_iff</code> should not include the minimality condition since that makes them weaker than without it.</p>",
        "id": 541899928,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1759072899
    },
    {
        "content": "<p>Right</p>",
        "id": 541900139,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759073121
    },
    {
        "content": "<p>I think there's an argument that either it doesn't change it or it makes it stronger. But arguably that is just covered by having the one direction of the minimality condition.</p>",
        "id": 541900167,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759073160
    },
    {
        "content": "<p>It makes the &lt;- direction weaker since there is an unnecessary hypothesis.</p>",
        "id": 541900260,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1759073240
    },
    {
        "content": "<p>Right, and the -&gt; stronger because an extra conclusion. So we just have the -&gt; I guess. I am still not sure when you would actually <em>use</em> this iff, mind.</p>",
        "id": 541900307,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759073291
    },
    {
        "content": "<p>The &lt;- direction is more useful (without minimality). Maybe it should be written the other way around?</p>",
        "id": 541900445,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1759073414
    },
    {
        "content": "<p>But they already existed in the better form, so we should just restore the original.</p>",
        "id": 541900650,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1759073586
    },
    {
        "content": "<p>Yes.</p>",
        "id": 541900792,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759073718
    },
    {
        "content": "<p>Let's add this theorem somewhere in the file:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">exists_eq_true_iff_exists_minimal_eq_true</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n</code></pre></div>\n<p>The nontrivial direction is basically <code>exists_minimal</code> from above.</p>",
        "id": 541901026,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1759073935
    },
    {
        "content": "<p>Is this not my <code>exists_fin_iff_exists_min</code>, but for Bool preds</p>",
        "id": 541902741,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759075595
    },
    {
        "content": "<p>I really don't think we should duplicate every result for decidable preds on boolean ones.</p>",
        "id": 541902754,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759075613
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">exists_eq_true_iff_exists_minimal_eq_true</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">exists_fin_iff_exists_min</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Bool</span><span class=\"bp\">.</span><span class=\"n\">not_eq_true</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 541902777,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759075645
    },
    {
        "content": "<p>Similarly I think I simply disagree that we should correct to the simp-normal form <code>p j = false</code>.</p>",
        "id": 541902822,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759075694
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">exists_minimal</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidablePred</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">exists_fin_iff_exists_min</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">⟩</span>\n</code></pre></div>",
        "id": 541902878,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759075750
    },
    {
        "content": "<p>Your exists_minimal is just one direction of my theorem.</p>",
        "id": 541902895,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759075765
    },
    {
        "content": "<p>Right. Let's first do the pending changes and then come back to this since it's not clear exactly where to put these lemmas.</p>",
        "id": 541903131,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1759075992
    },
    {
        "content": "<p>OK, I've pushed my latest.</p>",
        "id": 541903164,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759076028
    },
    {
        "content": "<p>Sorry for delay - had a life meeting thing</p>",
        "id": 541903171,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759076034
    },
    {
        "content": "<p>Family planning.</p>",
        "id": 541903173,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759076037
    },
    {
        "content": "<p>No worries. I'm never in a rush when reviewing.</p>",
        "id": 541903220,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1759076073
    },
    {
        "content": "<p>Could we close the existing comments and start from this revision? I am struggling to keep track of what we've settled on. I've tried to action everything thus far, with the exception of this <code>p i = false</code> thing</p>",
        "id": 541903230,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759076086
    },
    {
        "content": "<p>I closed all the old comments and added some more, nothing controversial except for the <code>= false</code> thing.</p>",
        "id": 541908283,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1759081572
    },
    {
        "content": "<p>Grand. I think we should get a third opinion on that maybe? I don't disagree with your perspective but I worry about deviating too much from the existing style.</p>",
        "id": 541908329,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759081624
    },
    {
        "content": "<p>Fair enough.</p>\n<p>We should keep track of deprecations:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">Lemmas</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Alias</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Fin</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">deprecated</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">since</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"2025-09-28\"</span><span class=\"o\">)</span><span class=\"kd\">]</span>\n<span class=\"kn\">alias</span><span class=\"w\"> </span><span class=\"n\">exists_of_findSome?_eq_some</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">exists_eq_some_of_findSome?_eq_some</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">deprecated</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">since</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"2025-09-28\"</span><span class=\"o\">)</span><span class=\"kd\">]</span>\n<span class=\"kn\">alias</span><span class=\"w\"> </span><span class=\"n\">findSome?_isSome_iff</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">isSome_findSome?_iff</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">deprecated</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">since</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"2025-09-28\"</span><span class=\"o\">)</span><span class=\"kd\">]</span>\n<span class=\"kn\">alias</span><span class=\"w\"> </span><span class=\"n\">findSome?_isNone_iff</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">isNone_findSome?_iff</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">deprecated</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">since</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"2025-09-28\"</span><span class=\"o\">)</span><span class=\"kd\">]</span>\n<span class=\"kn\">alias</span><span class=\"w\"> </span><span class=\"n\">find?_isSome_iff</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">isSome_find?_iff</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">deprecated</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">since</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"2025-09-28\"</span><span class=\"o\">)</span><span class=\"kd\">]</span>\n<span class=\"kn\">alias</span><span class=\"w\"> </span><span class=\"n\">find?_isNone_iff</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">isNone_find?_iff</span>\n</code></pre></div>",
        "id": 541908808,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1759082230
    },
    {
        "content": "<p>Thanks. Good stuff.</p>",
        "id": 541908828,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759082249
    },
    {
        "content": "<p>This is quick:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">exists_eq_true_iff_exists_minimal_eq_true</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">find?</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">grind</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">find?_eq_none_iff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">find?_eq_some_iff</span><span class=\"o\">]</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">exists_iff_exists_minimal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidablePred</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">exists_eq_true_iff_exists_minimal_eq_true</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">decide</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">simp_all</span>\n</code></pre></div>",
        "id": 541909968,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1759083527
    },
    {
        "content": "<p>I don't disagree but it uses find? to do it. I'm not sure if that's desirable.</p>",
        "id": 541910090,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759083677
    },
    {
        "content": "<p>I do wonder if some of these lemmas should be grind lemmas, in particular the two you have there.</p>",
        "id": 541910113,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759083707
    },
    {
        "content": "<p>How would you do it without using find?</p>",
        "id": 541910219,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1759083852
    },
    {
        "content": "<p>Well see my proof above that doesn't use it?</p>",
        "id": 541910236,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759083872
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"330967\">Wrenna Robson</span> <a href=\"#narrow/channel/348111-batteries/topic/Review.20request.20for.20batteries.231431/near/541896330\">said</a>:</p>\n<blockquote>\n<p>Also: how would you feel about adding the following lemma into the Fin namespace in an appropriate place:</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">fin_exists_iff_exists_min</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidablePred</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">_⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"n\">elim0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">_⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"n\">elim0</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">exists_fin_succ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">forall_fin_succ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">not_lt_zero</span><span class=\"o\">,</span>\n<span class=\"w\">      </span><span class=\"n\">false_implies</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">implies_true</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">and_true</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">succ_lt_succ_iff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">succ_pos</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">forall_const</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">by_cases</span><span class=\"w\"> </span><span class=\"n\">h0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">grind</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ih</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">grind</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Here.</p>",
        "id": 541910252,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759083887
    },
    {
        "content": "<p>Like I'm not sure if you missed this? But it is deliberately independent of find?</p>",
        "id": 541910335,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759083994
    },
    {
        "content": "<p>Using <code>find?</code> allows eliminating <code>Classical.choice</code>. Of course grind uses it always but this expanded proof avoids it:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">exists_eq_true_iff_exists_minimal_eq_true</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">find?</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">simp_all</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">find?_eq_some_iff</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">constructor</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">exists</span><span class=\"w\"> </span><span class=\"n\">i</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">exists</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"m\">1</span>\n</code></pre></div>\n<p>Batteries does not not care about constructivity. <span aria-label=\"grinning\" class=\"emoji emoji-1f600\" role=\"img\" title=\"grinning\">:grinning:</span> </p>\n<p>In the end, it just depends on where that theorem goes.</p>",
        "id": 541910920,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1759084673
    },
    {
        "content": "<p>I suppose. I find it more elegant not to use definitions that aren't necessary I think.</p>",
        "id": 541910953,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759084722
    },
    {
        "content": "<p>I think if you're using a Fin n -&gt; Bool it makes sense to be constructive.</p>",
        "id": 541910977,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759084751
    },
    {
        "content": "<p>I'm not sure mine uses Classical.choice?</p>",
        "id": 541911001,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759084792
    },
    {
        "content": "<p>It does, but if you eliminate grind then it probably doesn't.</p>\n<p>Since <code>find?</code> is almost literally the constructive argument for these theorems, it makes sense to use it for that.</p>\n<p>I'm not going to pressure one way or the other, I just want to make sure we consider all options.</p>",
        "id": 541911377,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1759085167
    },
    {
        "content": "<p>No indeed. I think that's good.</p>",
        "id": 541911701,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759085536
    },
    {
        "content": "<p>Having slept on it, I think I am alright to change stuff to eq_false.</p>",
        "id": 541973028,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759135113
    },
    {
        "content": "<p>We should build mathlib again to check it still works.</p>",
        "id": 541973094,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759135131
    },
    {
        "content": "<p>I am not sure how I retrigger a build</p>",
        "id": 541973132,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759135145
    },
    {
        "content": "<p>I think I would need write permissions.</p>",
        "id": 541979933,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759136818
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4-nightly-testing/actions/runs/18079454960/job/51440671329\">https://github.com/leanprover-community/mathlib4-nightly-testing/actions/runs/18079454960/job/51440671329</a></p>",
        "id": 541979935,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759136819
    },
    {
        "content": "<p>If someone could re-run this that would be good.</p>",
        "id": 541979965,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759136826
    },
    {
        "content": "<p>I have a \"rerun all jobs\" button on that link and I've just clicked it.</p>",
        "id": 541983426,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1759137724
    },
    {
        "content": "<p>Thanks Kevin</p>",
        "id": 541983463,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759137732
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> Please grant Wrenna (linesthatinterlace) write access to mathlib4-nightly-testing.</p>",
        "id": 542000158,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1759142217
    },
    {
        "content": "<p>As an aside by the way, I'd like to look at moving some of <code>Mathlib.Data.Fin.SuccPred</code> over to batteries as I think they have non-mathematical uses. In particular <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Fin.forall_fin_succ%27#doc\">docs#Fin.forall_fin_succ'</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Fin.exists_fin_succ%27#doc\">docs#Fin.exists_fin_succ'</a> though also stuff like <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Fin.castSucc_le_castSucc_iff#doc\">docs#Fin.castSucc_le_castSucc_iff</a> or <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Fin.succ_le_castSucc_iff#doc\">docs#Fin.succ_le_castSucc_iff</a>.</p>\n<p>They come up when doing induction arguments on Fin quite a bit.</p>\n<p>In particular I would like to consider providing <code>Fin.findRev?</code> and related things, and when arguing \"from the top\" that kinda thing does come up.</p>",
        "id": 542001161,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759142508
    },
    {
        "content": "<p>Outside this PR though.</p>",
        "id": 542001199,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759142518
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"119741\">@François G. Dorais</span> Kim is unavailable for a while</p>",
        "id": 542001544,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1759142615
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"307953\">@Ruben Van de Velde</span> Thanks for the reminder! Do you know who else might have permissions to do that?</p>",
        "id": 542010000,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1759144897
    },
    {
        "content": "<p>If we're lucky, any of the mathlib maintainers</p>",
        "id": 542084870,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1759162801
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 542099053,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759166861
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"330967\">Wrenna Robson</span> <a href=\"#narrow/channel/348111-batteries/topic/Review.20request.20for.20batteries.231431/near/541908329\">said</a>:</p>\n<blockquote>\n<p>Grand. I think we should get a third opinion on that maybe? I don't disagree with your perspective but I worry about deviating too much from the existing style.</p>\n</blockquote>\n<p>FWIW I agree with François that the <code>p = false</code> normal form is bad, it means you have to duplicate all lemmas about boolean functions</p>",
        "id": 542839264,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1759443993
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> We've already given up to the upstream NF. I don't like it but it works for the time being...</p>",
        "id": 542840005,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1759444396
    },
    {
        "content": "<p>Upstream changes are always too <em>slow</em>!</p>",
        "id": 542840102,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1759444457
    },
    {
        "content": "<p>Yes - personally I think \"p = false\" should normalise to \"\\not p = true\". But that's going to be really annoying to change.</p>",
        "id": 542847863,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1759448924
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"119741\">François G. Dorais</span> <a href=\"#narrow/channel/348111-batteries/topic/Review.20request.20for.20batteries.231431/near/542000158\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> Please grant Wrenna (linesthatinterlace) write access to mathlib4-nightly-testing.</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"330967\">@Wrenna Robson</span>, please check your inbox for an invitation to the <code>nightly-testing</code> team, which will give you this access.</p>",
        "id": 544644979,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1760407313
    },
    {
        "content": "<p>Thank you.</p>",
        "id": 544677298,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1760426925
    },
    {
        "content": "<p>It says I'm now a member of leanprover-community, not specifically nightly-testing. I hope this is right.</p>",
        "id": 544677851,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1760427120
    },
    {
        "content": "<p>Yeah, it's a team within that organisation</p>",
        "id": 544679487,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1760427696
    },
    {
        "content": "<p>Right</p>",
        "id": 544679525,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1760427709
    },
    {
        "content": "<p>Well I think I accepted!</p>",
        "id": 544679578,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1760427721
    },
    {
        "content": "<p>Also, good to see you back (?) <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span></p>",
        "id": 544682859,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1760428813
    }
]