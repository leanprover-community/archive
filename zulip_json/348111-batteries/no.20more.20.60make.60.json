[
    {
        "content": "<p>I just want to call attention to a minor triumph at <a href=\"https://github.com/leanprover-community/batteries/pull/918\">batteries#918</a>, and congratulate <span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span> (for lake), <span class=\"user-mention\" data-user-id=\"699684\">@Austin Letson</span> (for <code>lean-action</code>), and <span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> (for the environment linter framework) for making this possible: there is no more <code>makefile</code> in Batteries, and everything can be driven just by <code>lake build</code>, <code>lake test</code>, and <code>lake lint</code>.</p>",
        "id": 462659898,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723765537
    },
    {
        "content": "<p>(Now if someone just wants to rewrite <code>scripts/lintWhitespace.sh</code> and <code>scripts/updateBatteries.sh</code> in Lean, we can ignore the mess of yml files in CI, and claim that Batteries is entirely in Lean!)</p>",
        "id": 462660015,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723765614
    },
    {
        "content": "<p><code>lintWhitespace</code> is just checking that lines do not end in space and that the last character of a file is a line break, right?</p>",
        "id": 462685433,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723778387
    },
    {
        "content": "<p>That should be easy to write in lean!</p>",
        "id": 462685455,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723778399
    },
    {
        "content": "<p>Here is an attempt: <a href=\"https://github.com/leanprover-community/batteries/pull/920\">batteries#920</a></p>",
        "id": 462698204,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723782445
    },
    {
        "content": "<p>Alternatively, this could be a non-syntax linter option:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Command</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"n\">run_cmd</span>\n<span class=\"w\">  </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">fil</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">System</span><span class=\"bp\">.</span><span class=\"n\">FilePath</span><span class=\"bp\">.</span><span class=\"n\">walkDir</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">currentDir</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"s2\">\"Batteries\"</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"s2\">\"lean\"</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">fil</span><span class=\"bp\">.</span><span class=\"n\">extension</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">lines</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">FS</span><span class=\"bp\">.</span><span class=\"n\">lines</span><span class=\"w\"> </span><span class=\"n\">fil</span>\n<span class=\"w\">      </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">[:</span><span class=\"n\">lines</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">        </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">lines</span><span class=\"o\">[</span><span class=\"n\">l</span><span class=\"o\">]</span><span class=\"bp\">!</span>\n<span class=\"w\">        </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">tr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"bp\">.</span><span class=\"n\">takeRightWhile</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·.</span><span class=\"n\">isWhitespace</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"n\">tr</span><span class=\"bp\">.</span><span class=\"n\">isEmpty</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">          </span><span class=\"n\">logWarning</span>\n<span class=\"w\">            </span><span class=\"n\">m!</span><span class=\"s2\">\"{fil}:{l} ends with {tr.length} space{if tr.length == 1 then \"\" else \"</span><span class=\"n\">s</span><span class=\"s2\">\"}\"</span>\n<span class=\"w\">      </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">FS</span><span class=\"bp\">.</span><span class=\"n\">readFile</span><span class=\"w\"> </span><span class=\"n\">fil</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">back</span><span class=\"w\"> </span><span class=\"bp\">!=</span><span class=\"w\"> </span><span class=\"bp\">'\\</span><span class=\"n\">n'</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">        </span><span class=\"n\">logWarning</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"{fil} does not end with a line break\"</span>\n</code></pre></div>",
        "id": 462729545,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723792749
    }
]