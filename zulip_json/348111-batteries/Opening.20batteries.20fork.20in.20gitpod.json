[
    {
        "content": "<p>Currently it is trival to open mathlib or a fork of it in gitpod. There is a link in the README.md file. Is there a way to do the same for forks of batteries?</p>",
        "id": 462100581,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723552167
    },
    {
        "content": "<p><a href=\"https://gitpod.io/#https://github.com/leanprover-community/batteries\">https://gitpod.io/#https://github.com/leanprover-community/batteries</a></p>",
        "id": 462100855,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1723552211
    },
    {
        "content": "<p>Well that's the two step way. I am looking for a gitpod link in PRs and README</p>",
        "id": 462101239,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723552276
    },
    {
        "content": "<p>I guess that depends on what \"trivial\" means, but the <code>gitpod.io/#</code> trick (if that's really a trick, arguably it's one of the most prominent features of Gitpod) applies to literally all repos, so I don't really see how that doesn't fit the bill.</p>",
        "id": 462102231,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1723552447
    },
    {
        "content": "<p>Note that the Gitpod badge in the README is simply an hyperlink to what I wrote above</p>",
        "id": 462102375,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1723552481
    },
    {
        "content": "<p>I imagine teaching is much simpler if there is a single repository that students can spin gitpod instances from.</p>",
        "id": 462102528,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723552503
    },
    {
        "content": "<p>and for demos too</p>",
        "id": 462102569,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723552508
    },
    {
        "content": "<p>Don't students know how to click a link?</p>",
        "id": 462103280,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1723552641
    },
    {
        "content": "<p>sure. I am just suggesting we put one in the batteries README.md</p>",
        "id": 462103363,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723552658
    },
    {
        "content": "<p>One thing about that link is, it isn't adaptive. If I fork a repo <code>X</code> as <code>fork_X</code>, and if <code>X</code> has a gitpod link. then the gitpod link of <code>fork_X</code> will set up <code>X</code>. If one opens the fork by handcrafting the the link, one automatically gets two git remotes setup.</p>",
        "id": 462103714,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723552725
    },
    {
        "content": "<p>Install the gitpod chrome extension, to get that link everywhere?</p>",
        "id": 462105746,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723553287
    },
    {
        "content": "<p>firefox user here</p>",
        "id": 462105775,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723553300
    },
    {
        "content": "<p>s/chrome/your browser of choice/</p>",
        "id": 462105821,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723553323
    },
    {
        "content": "<p>that's neat. thanks.</p>",
        "id": 462107317,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723553812
    },
    {
        "content": "<p>maybe this is slightly off topic. But I have another project (math dependent) for which I want to set up gitpod that work as out of the box as it does for mathlib. I understand that I need some Dockerfiles and a gitpod.yml file. Could some tell me exactly how to do this?</p>",
        "id": 462218957,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723586516
    },
    {
        "content": "<p>You just need <code>.gitpod.yml</code>. <a href=\"https://github.com/YaelDillies/LeanAPAP/blob/master/.gitpod.yml\">This file</a> will do</p>",
        "id": 462219097,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1723586585
    },
    {
        "content": "<p>It points to a dockerfile, and that dockerfile is the one provided by mathlib, so you don't even have to worry about maintaining the dockerfile yourself</p>",
        "id": 462219150,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1723586617
    },
    {
        "content": "<p>ooh this is even better than I thought. Thanks :)</p>",
        "id": 462219205,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723586641
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/stream/348111-batteries/topic/Opening.20batteries.20fork.20in.20gitpod/near/462219150\">said</a>:</p>\n<blockquote>\n<p>It points to a dockerfile, and that dockerfile is the one provided by mathlib</p>\n</blockquote>\n<p>I have no idea where this docker image comes from</p>",
        "id": 462223280,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723588851
    },
    {
        "content": "<p>Unless <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> knows better, I don't think anything updates that image any more</p>",
        "id": 462223331,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723588884
    },
    {
        "content": "<p>I just tested it on my project repo and so far it works.</p>",
        "id": 462223358,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723588907
    },
    {
        "content": "<p>My repo was on toolchain 4.10.0</p>",
        "id": 462223414,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723588925
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/348111-batteries/topic/Opening.20batteries.20fork.20in.20gitpod/near/462223280\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/stream/348111-batteries/topic/Opening.20batteries.20fork.20in.20gitpod/near/462219150\">said</a>:</p>\n<blockquote>\n<p>It points to a dockerfile, and that dockerfile is the one provided by mathlib</p>\n</blockquote>\n<p>I have no idea where this docker image comes from</p>\n</blockquote>\n<p>Actually, me neither. And I haven't managed to get gitpod to update it</p>",
        "id": 462223523,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1723588988
    },
    {
        "content": "<p>No, nothing is updating that docker image at present.</p>",
        "id": 462242482,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723600869
    },
    {
        "content": "<p>Could it be updated? Every time I open gitpod, I must update elan from 1.4.3 to 3.1.1</p>",
        "id": 462280991,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1723620102
    },
    {
        "content": "<p>What happens if you just modify the Dockerfile? e.g. add some whitespace if nothing else? As far as I'm aware gitpod is not pulling images from anywhere, and just building itself.</p>",
        "id": 462431517,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723677620
    },
    {
        "content": "<p>Already modified the dockerfile in less trivial ways and it still opens with elan 1.4.3</p>",
        "id": 462431656,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1723677681
    },
    {
        "content": "<p>I think the docker file that is fetched is from docker hub?</p>",
        "id": 462431675,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723677700
    },
    {
        "content": "<p>Sorry, no, I meant I modified <code>.gitpop.yml</code></p>",
        "id": 462431693,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1723677715
    },
    {
        "content": "<p>The dockerfile I don't have access to, because as Shreyas says it's hosted on dockerhub</p>",
        "id": 462431758,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1723677734
    },
    {
        "content": "<p>In any case, updates to the dockerfile have to be propagated to docker hub somehow.</p>",
        "id": 462431793,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723677762
    },
    {
        "content": "<p>Otherwise they don't have any effect</p>",
        "id": 462431803,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723677771
    },
    {
        "content": "<p>That's not how it used to work on gitpod... They were building their own images direct from the the Dockerfile in the repository.</p>",
        "id": 462433013,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723678533
    },
    {
        "content": "<p>I can double check what's happening per these instructions: <a href=\"https://www.gitpod.io/docs/references/gitpod-yml#image\">https://www.gitpod.io/docs/references/gitpod-yml#image</a> </p>\n<p>But apparently GitHub is down</p>",
        "id": 462433167,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723678625
    },
    {
        "content": "<p>But it does seem to be what happens now.</p>",
        "id": 462433337,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723678725
    },
    {
        "content": "<p>At least <em>someone</em> pulled the image from docker hub 16 hours ago.</p>",
        "id": 462433352,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723678736
    },
    {
        "content": "<p>I did</p>",
        "id": 462433375,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723678747
    },
    {
        "content": "<p>16 hours ago sounds about right</p>",
        "id": 462433394,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723678758
    },
    {
        "content": "<p>Oh, so that is no evidence that gitpod is pulling from it.</p>",
        "id": 462433397,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723678760
    },
    {
        "content": "<p>No I did it from gitpod</p>",
        "id": 462433412,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723678770
    },
    {
        "content": "<p>The image at docker hub contains mathlib3 from 2 years ago.</p>",
        "id": 462433423,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723678775
    },
    {
        "content": "<p>I mean I opened gitpod</p>",
        "id": 462433426,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723678775
    },
    {
        "content": "<p>I doubt this is what is affecting Yael?</p>",
        "id": 462433438,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723678782
    },
    {
        "content": "<p>What Yael says also happens to me. Elan self update is the first instruction that runs after the image is ready</p>",
        "id": 462433540,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723678837
    },
    {
        "content": "<p><a href=\"https://hub.docker.com/layers/leanprovercommunity/mathlib/gitpod/images/sha256-2a9254b40ef9b316d6d429335137095953e060f7c0a927005f92203d09e5dc65?context=repo\">https://hub.docker.com/layers/leanprovercommunity/mathlib/gitpod/images/sha256-2a9254b40ef9b316d6d429335137095953e060f7c0a927005f92203d09e5dc65?context=repo</a></p>",
        "id": 462433604,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723678863
    },
    {
        "content": "<p>is all that exists at docker hub.</p>",
        "id": 462433619,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723678871
    },
    {
        "content": "<p>My bad. The image is specified in .gitpod.yml as  .docker/gitpod/Dockerfile. That's the local file</p>",
        "id": 462433829,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723679004
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span>, in the setup <em>you</em> usually use, can you distinguish between the Dockerfile in the mathlib repo (e.g. which installs nvim) and the Dockerfiler that was pushed to docker hub 2 years ago (e.g. which doesn't).</p>\n<p>I'm very skeptical that docker hub has anything to do with this.</p>",
        "id": 462433835,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723679012
    },
    {
        "content": "<p>Has anyone tried <a href=\"https://www.gitpod.io/docs/configure/workspaces/workspace-image#manually-rebuild-a-workspace-image\">https://www.gitpod.io/docs/configure/workspaces/workspace-image#manually-rebuild-a-workspace-image</a></p>",
        "id": 462433934,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723679080
    },
    {
        "content": "<p>Dockerhub has nothing to do with it. I am sorry.</p>",
        "id": 462433938,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723679083
    },
    {
        "content": "<p>The docker file in mathlib is installing elan as follows:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">install</span><span class=\"w\"> </span><span class=\"n\">elan</span>\n<span class=\"n\">RUN</span><span class=\"w\"> </span><span class=\"n\">curl</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">raw</span><span class=\"bp\">.</span><span class=\"n\">githubusercontent</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">master</span><span class=\"bp\">/</span><span class=\"n\">elan</span><span class=\"bp\">-</span><span class=\"n\">init</span><span class=\"bp\">.</span><span class=\"n\">sh</span>\n</code></pre></div>",
        "id": 462433969,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723679104
    },
    {
        "content": "<p>Is this correct?</p>",
        "id": 462433978,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723679110
    },
    {
        "content": "<p>I misread that image spec line which is why I thought it was picking the image from dockerhub. Sincere apologies. The file that is being used is the one in mathlib4 repo which is installing elan as described above.</p>",
        "id": 462434140,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723679203
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/stream/348111-batteries/topic/Opening.20batteries.20fork.20in.20gitpod/near/462433969\">said</a>:</p>\n<blockquote>\n<p>The docker file in mathlib is installing elan as follows:</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">install</span><span class=\"w\"> </span><span class=\"n\">elan</span>\n<span class=\"n\">RUN</span><span class=\"w\"> </span><span class=\"n\">curl</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">raw</span><span class=\"bp\">.</span><span class=\"n\">githubusercontent</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">master</span><span class=\"bp\">/</span><span class=\"n\">elan</span><span class=\"bp\">-</span><span class=\"n\">init</span><span class=\"bp\">.</span><span class=\"n\">sh</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>No, it's not?</p>",
        "id": 462434359,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723679376
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/blob/master/.docker/gitpod/Dockerfile#L23\">https://github.com/leanprover-community/mathlib4/blob/master/.docker/gitpod/Dockerfile#L23</a></p>",
        "id": 462434375,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723679399
    },
    {
        "content": "<p>I truncated the copy since I am on my phone</p>",
        "id": 462434552,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723679487
    },
    {
        "content": "<p>But it's the same line.</p>",
        "id": 462434559,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723679494
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> : the following is my .gitpod.yml : <a href=\"https://github.com/Shreyas4991/DGAlgorithms/blob/main/.gitpod.yml\">https://github.com/Shreyas4991/DGAlgorithms/blob/main/.gitpod.yml</a></p>",
        "id": 462434834,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723679727
    },
    {
        "content": "<p>I copied it from the LeanAPAP one that Yael linked to in this chat</p>",
        "id": 462434855,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723679755
    },
    {
        "content": "<p>Fwiw, it worked after the elan update. I think the mathlib gitpod.yml is different. Whence all the above confusion about hub and installation practices</p>",
        "id": 462434941,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723679803
    },
    {
        "content": "<p>I assumed these files must have come from mathlib</p>",
        "id": 462435011,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723679872
    },
    {
        "content": "<p>Until a minute ago</p>",
        "id": 462435062,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723679885
    },
    {
        "content": "<p>It seems both <span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span> and I are using a .gitpod.yml file that fetches the mathlib3 docker image from docker hub. How it works with mathlib4 projects perfectly is a mystery to me.</p>",
        "id": 462436088,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723680520
    },
    {
        "content": "<p>elan <em>just works</em></p>",
        "id": 462436124,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723680558
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/348111-batteries/topic/Opening.20batteries.20fork.20in.20gitpod/near/462433604\">said</a>:</p>\n<blockquote>\n<p><a href=\"https://hub.docker.com/layers/leanprovercommunity/mathlib/gitpod/images/sha256-2a9254b40ef9b316d6d429335137095953e060f7c0a927005f92203d09e5dc65?context=repo\">https://hub.docker.com/layers/leanprovercommunity/mathlib/gitpod/images/sha256-2a9254b40ef9b316d6d429335137095953e060f7c0a927005f92203d09e5dc65?context=repo</a></p>\n</blockquote>\n<p>This one to be precise</p>",
        "id": 462436126,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723680560
    },
    {
        "content": "<p>Okay, now I understand!</p>",
        "id": 462436128,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723680566
    },
    {
        "content": "<p>Because Mathlib wasn't using that image, I assumed no one else was.</p>",
        "id": 462436142,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723680579
    },
    {
        "content": "<p>Ideally, we would have no dependency on docker hub, and no ongoing maintenance job to update images there.</p>",
        "id": 462436166,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723680598
    },
    {
        "content": "<p>Can you solve this problem simply by copying the Dockerfile from Mathlib into your repo (<span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span> too)?</p>",
        "id": 462436226,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723680617
    },
    {
        "content": "<p>I'd prefer to pursue that first.</p>",
        "id": 462436233,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723680624
    },
    {
        "content": "<p>I sorta assumed  that because my mathlib4 based project worked perfectly fine, Yael must be using the same file as mathlib, and I think they were under the same assumption</p>",
        "id": 462436248,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723680642
    },
    {
        "content": "<p>(Ideally, we can delete the images on docker hub, but I guess at this point it's hard to be sure no one is relying on them <span aria-label=\"sad\" class=\"emoji emoji-2639\" role=\"img\" title=\"sad\">:sad:</span> )</p>",
        "id": 462436254,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723680646
    },
    {
        "content": "<p>Taking a look at that docker file, I think it can be standardised with no updates required. Only the parts downloading mathlib3tools needs to be deleted</p>",
        "id": 462436890,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723680849
    },
    {
        "content": "<p>as along as elan _just works_ which is almost always, we don't need to rely on the parts of the docker file after the elan based toolchain install.</p>",
        "id": 462437047,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723680896
    },
    {
        "content": "<p>In the mathlib4 file the mathlib3 parts are not there and instead a neovim install is offered (but I guess that's for a general container, not needed for gitpod). The remaining parts of the file can stay unchanged.</p>",
        "id": 462437470,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723680997
    },
    {
        "content": "<p>No updates needed</p>",
        "id": 462437508,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723681007
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> : I tried remotely linking to the mathlib4 Dockerfile. This fails. Maintaining my own copy means tracking changes to the Dockerfile in the main mathlib4 repository. Is this the only viable way. Ideally we should be able to link to a standard image that mathlib4 specifies.</p>",
        "id": 462438835,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723681504
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/Tpkb8tlbg18kYWaF7MhWLXFy/Screenshot-from-2024-08-15-02-24-48.png\">Screenshot-from-2024-08-15-02-24-48.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/Tpkb8tlbg18kYWaF7MhWLXFy/Screenshot-from-2024-08-15-02-24-48.png\" title=\"Screenshot-from-2024-08-15-02-24-48.png\"><img data-original-dimensions=\"1072x986\" src=\"/user_uploads/thumbnail/3121/Tpkb8tlbg18kYWaF7MhWLXFy/Screenshot-from-2024-08-15-02-24-48.png/840x560.webp\"></a></div><p>This is what I get when trying to link directly to the mathlib4 docker file</p>",
        "id": 462438854,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723681523
    },
    {
        "content": "<p>Also, I am not sure how the \"maintain our own copy of the dockerfile\" approach scales.  If there are substantial changes to setup, then I suspect anybody who uses gitpod will start facing issues.</p>",
        "id": 462439132,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723681627
    },
    {
        "content": "<p>I think \"maintain a standard docker image\" is something we should start doing at the point where the setup becomes complicated, not at the point where we start theorizing about how it might in future become complicated</p>",
        "id": 462446940,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723685216
    },
    {
        "content": "<p>Would it make sense to host docker images on ghcr, since we're so GitHub based?</p>",
        "id": 462447408,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1723685520
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/348111-batteries/topic/Opening.20batteries.20fork.20in.20gitpod/near/462436226\">said</a>:</p>\n<blockquote>\n<p>Can you solve this problem simply by copying the Dockerfile from Mathlib into your repo (<span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> too)?</p>\n</blockquote>\n<p>Oh sure, but I thought it was preferred for everyone to use the same image by pulling it from dockerhub, as then that's less maintenance work: If the dockerfile needs updating, some mathlib maintainer updates it and all people downstream immediately see the changes</p>",
        "id": 462485044,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1723704005
    },
    {
        "content": "<p>It is complicated for all downstream users as soon as people have to maintain their own image.</p>",
        "id": 462485468,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723704236
    },
    {
        "content": "<p>Docker images are not easy to debug unless someone knows docker and understands these files. So essentially projects which would like to use gitpod would need one docker expert to make keep pace with changes.</p>",
        "id": 462485957,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723704400
    },
    {
        "content": "<p>Okay, I persuaded that if someone is willing to take on this job, it would be a good idea to update regularly at docker hub.</p>",
        "id": 462490190,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723706125
    },
    {
        "content": "<p>Happy to volunteer</p>",
        "id": 462490234,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723706148
    },
    {
        "content": "<p>It requires credentials for the account, so I would prefer to find a maintainer or (official) reviewer to take this.</p>",
        "id": 462490333,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723706191
    },
    {
        "content": "<p>I am willing to do it, as I use it in at least 5 different projects</p>",
        "id": 462490359,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1723706215
    },
    {
        "content": "<p>Great. Docker Hub credentials incoming via DM!</p>",
        "id": 462490729,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723706410
    },
    {
        "content": "<p>Just so that we agree, we do <em>not</em> want to continue the docker image associated to the mathlib repo, but instead want a new one associated to the mathlib4 repo?</p>",
        "id": 462492272,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1723706822
    },
    {
        "content": "<p>yes. A similar one for batteries alone would be nice.</p>",
        "id": 462492428,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723706853
    },
    {
        "content": "<p>for the moment I suspect you will find it easy to use the gitpod dockerfile of mathlib minus the nvim parts.</p>",
        "id": 462492834,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723707009
    },
    {
        "content": "<p>Something I'm not very clear about is why there is a notion of repositories at all in dockerhub, as opposed to, you know, just containers</p>",
        "id": 462493275,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1723707145
    },
    {
        "content": "<p>Docker has a notion of images created by repositories. Because sometimes you need many images. Containers are running instances of images.</p>",
        "id": 462495438,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723707784
    },
    {
        "content": "<p>My comment about GHCR was to make it simpler with regards to credentials and linking images with code repositories.</p>",
        "id": 462496303,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1723708092
    },
    {
        "content": "<p>Where we could have a GitHub workflow that builds and pushes an image on every master push or what have you. The workflow would look quite similar to the same one that would push to Dockerhub, other than how the credentials are passed</p>",
        "id": 462496576,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1723708183
    },
    {
        "content": "<p>In this case, it needs to be tested with gitpod.yml config. I don't see any obvious way to specify third party sources</p>",
        "id": 462496923,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723708271
    },
    {
        "content": "<p><code>image: ghcr.io/leanprover-community/mathlib4</code> in gitpod.yml</p>",
        "id": 462497153,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1723708391
    },
    {
        "content": "<p><a href=\"https://www.gitpod.io/docs/configure/workspaces/workspace-image#configuring-a-workspace-image\">https://www.gitpod.io/docs/configure/workspaces/workspace-image#configuring-a-workspace-image</a></p>",
        "id": 462497588,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1723708548
    },
    {
        "content": "<p>One warning about using an un-versioned community image: downstream projects with a <code>Dockerfile</code> are currently pinned to a set of install requirements, but this isn't the case if your dockerfile says <code>ghcr.io/leanprover-community/mathlib4</code></p>",
        "id": 462514981,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723715878
    },
    {
        "content": "<p>This means if <code>polyrith</code> ever is rewritten to not use python, then your old repos on old mathlib versions pointing to the image will find themselves unable to use <code>polyrith</code> because you'll get the new image for old code.</p>",
        "id": 462515171,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723715937
    },
    {
        "content": "<p>Does that apply to dockerhub also?</p>",
        "id": 462515977,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1723716257
    },
    {
        "content": "<p>Yes, this applies to publishing any image anywhere without versioning it</p>",
        "id": 462516008,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723716277
    },
    {
        "content": "<p>I guess my question is: \"Does either of GHCR or DockerHub let you publish versioned images?\"</p>",
        "id": 462516110,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1723716332
    },
    {
        "content": "<p>I think all such registries do, but we never used the feature before</p>",
        "id": 462516138,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723716348
    },
    {
        "content": "<p>Yes, but like git, each version has a different hash. You need to make sure that the gitpod tag matches the latest</p>",
        "id": 462516909,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723716607
    },
    {
        "content": "<p>Yes, of course one can publish tagged images. I would imagine we always publish a latest, and also publish a tag matching a lean version release on version bumps</p>",
        "id": 462529439,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1723720673
    },
    {
        "content": "<p>Without a tag specified, docker pulls the image with the \"latest\" tag</p>",
        "id": 462529599,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1723720716
    },
    {
        "content": "<p>As it exists the image doesn't come with a toolchain. Elan is installed without a toolchain. Then when the project is opened, lake does the honours.</p>",
        "id": 462530695,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723721197
    },
    {
        "content": "<p>Keeps things simple</p>",
        "id": 462530713,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723721205
    },
    {
        "content": "<p>Sure, but you still need to decide which python packages to install in the container, which elan doesn't manage</p>",
        "id": 462531402,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723721500
    },
    {
        "content": "<p>If your container is literally just <code>elan</code> then managing a docker image seems like too much overhead</p>",
        "id": 462531486,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723721532
    },
    {
        "content": "<p>While it doesn't come with a toolchain, the image tagged with some lean release is really from a mathlib4 commit where the lakefile points to that particular lean release.</p>",
        "id": 462532602,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1723722070
    },
    {
        "content": "<p>Yes and that's what lake uses to do the honours</p>",
        "id": 462533135,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723722269
    },
    {
        "content": "<p>It doesn't affect the building of the image per se. Just what's loaded into the project folder and guides lake</p>",
        "id": 462533193,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723722303
    },
    {
        "content": "<p>I think it installs some toolchain but doesn't pick a default to be more precise. But that's semantics</p>",
        "id": 462533346,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723722366
    },
    {
        "content": "<p>Anyway that's a moot point. The question is whether the docker image should do what elan and lake can manage as long as a standard Linux + FS is provided</p>",
        "id": 462534318,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723722834
    }
]