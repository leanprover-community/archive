[
    {
        "content": "<p>I am to blame here as I put this on the merge queue</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">getLast?_scanr</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">scanr</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">getLast?</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">getLast?</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">split</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"bp\">‹_›</span><span class=\"w\"> </span><span class=\"n\">scanr_ne_nil</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←‹_›</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">getLast_scanr</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>but let's please never use <code>←‹_›</code>, in Batteries or elsewhere.</p>",
        "id": 564913103,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1766347797
    },
    {
        "content": "<p>Rust has the turbofish, should we not have equally inscrutable syntax patterns?</p>",
        "id": 564914281,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1766349436
    },
    {
        "content": "<p>Harpoonfish?</p>",
        "id": 564915955,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1766351813
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/348111-batteries/topic/antipattern/near/564913103\">said</a>:</p>\n<blockquote>\n<p>I am to blame here as I put this on the merge queue</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">getLast?_scanr</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">scanr</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">getLast?</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">getLast?</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">split</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"bp\">‹_›</span><span class=\"w\"> </span><span class=\"n\">scanr_ne_nil</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←‹_›</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">getLast_scanr</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>but let's please never use <code>←‹_›</code>, in Batteries or elsewhere.</p>\n</blockquote>\n<p>Yeah I'll be honest I have never seen this before this moment.</p>",
        "id": 564968441,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1766396986
    },
    {
        "content": "<p>It looks evil though</p>",
        "id": 564968449,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1766396991
    },
    {
        "content": "<p>why not being a litle more explicit ?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">getLast?_scanr</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">scanr</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">getLast?</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">getLast?</span>\n<span class=\"w\">  </span><span class=\"n\">split</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">rename_i</span><span class=\"w\"> </span><span class=\"n\">hscanr_eq</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">hscanr_eq</span><span class=\"w\"> </span><span class=\"n\">scanr_ne_nil</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"n\">hscanr_eq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">getLast_scanr</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>or using <code>cases</code> and <code>grind</code> :</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">getLast?_scanr</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">scanr</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">getLast?</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">getLast?</span>\n<span class=\"w\">  </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">scanr</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">l</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">grind</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">scanr_ne_nil</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">grind</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">getLast_scanr</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 564974532,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1766399178
    },
    {
        "content": "<p>Exactly. (Actually, I replaced the whole thing with a <code>grind</code>.)</p>",
        "id": 565094574,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1766461121
    },
    {
        "content": "<p>Huh, this is a creative use of <code>‹_›</code>... I almost want to say that this syntax should throw an error if there are metavariables in the type (basically have <code>‹T›</code> elaborated as <code>show T by assumption</code>) — or at least if there are metavariables it should check that there's exactly one hypothesis that matches!</p>\n<p>Side note: I was idly thinking recently — unseriously — about what if the syntax for <code>‹T›</code> were <code>that T</code>. Sort of like in \"we know that T hence ...\". If the term after <code>that</code> were optional, then, ignoring some precedence issues, <code>that</code> on its own could refer to a recent assumption <span aria-label=\"smiling devil\" class=\"emoji emoji-1f608\" role=\"img\" title=\"smiling devil\">:smiling_devil:</span></p>",
        "id": 565095152,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1766461860
    },
    {
        "content": "<p>I’d love some more evocative syntax for \\f&lt;. As someone kind of new to lean, I find myself misreading it as \\&lt; fairly often.</p>",
        "id": 565206643,
        "sender_full_name": "cmlsharp",
        "timestamp": 1766519933
    },
    {
        "content": "<p>For what it's worth, AlphaProof was already pushing this <code>‹_›</code> syntax in 2024 :)</p>",
        "id": 565223107,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1766531080
    },
    {
        "content": "<p>I think the underlying problem here is that the <code>split</code> tactic has no syntax for giving a name to the introduced variable.</p>",
        "id": 565223387,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1766531367
    },
    {
        "content": "<p>there is a long standing proposal to improve <code>split</code> : <a href=\"https://github.com/leanprover/lean4/issues/2745\">https://github.com/leanprover/lean4/issues/2745</a></p>",
        "id": 565279414,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1766580091
    }
]