[
    {
        "content": "<p>The following three lemmas about lists in <a href=\"https://github.com/leanprover-community/Batteries/pull/743\">Batteries#743</a> aren't necessary for proving the theorem <code>String.splitOn_of_valid</code>, which is the whole point of this pull request. Should I move these lemmas to a separate PR or just remove them?</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>My lemmas about lists</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Batteries.Control.ForInStep.Lemmas</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Batteries.Data.List.Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Batteries.Tactic.Init</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Batteries.Tactic.Alias</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">List</span>\n\n<span class=\"c1\">-- NOTE: I need this lemma.</span>\n<span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"n\">head_cons_tail</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">head</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">::</span><span class=\"w\"> </span><span class=\"n\">l.tail</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">l</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"o\">::</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"n\">singleton_head_eq_self</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hne</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"o\">[])</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">htl</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">l.tail</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">[])</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">l.head</span><span class=\"w\"> </span><span class=\"n\">hne</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">  </span><span class=\"n\">conv</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">rhs</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">head_cons_tail</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">hne</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">htl</span><span class=\"o\">]</span>\n\n<span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"n\">singleton_prefix_cons</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">a</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">&lt;+</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">::</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">prefix_cons_inj</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"n\">nil_prefix</span>\n\n<span class=\"c1\">-- NOTE: I need this lemma.</span>\n<span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"n\">ne_nil_of_not_prefix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"n\">l₁</span><span class=\"w\"> </span><span class=\"bp\">&lt;+</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">l₂</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">l₁</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">heq</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">heq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">nil_prefix</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n\n<span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"n\">not_prefix_and_not_prefix_symm_iff_exists</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">BEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LawfulBEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">l₁</span><span class=\"w\"> </span><span class=\"n\">l₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"n\">l₁</span><span class=\"w\"> </span><span class=\"bp\">&lt;+</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">l₂</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"n\">l₂</span><span class=\"w\"> </span><span class=\"bp\">&lt;+</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">l₁</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">c₁</span><span class=\"w\"> </span><span class=\"n\">c₂</span><span class=\"w\"> </span><span class=\"n\">pre</span><span class=\"w\"> </span><span class=\"n\">suf₁</span><span class=\"w\"> </span><span class=\"n\">suf₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">c₁</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"n\">c₂</span><span class=\"w\"> </span><span class=\"bp\">∧</span>\n<span class=\"w\">      </span><span class=\"n\">l₁</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">pre</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">c₁</span><span class=\"w\"> </span><span class=\"o\">::</span><span class=\"w\"> </span><span class=\"n\">suf₁</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">l₂</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">pre</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">c₂</span><span class=\"w\"> </span><span class=\"o\">::</span><span class=\"w\"> </span><span class=\"n\">suf₂</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">  </span><span class=\"n\">constructor</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">obtain</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">c₁</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">l₁</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"o\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">l₁.exists_cons_of_ne_nil</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ne_nil_of_not_prefix</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">obtain</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">c₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">l₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"o\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">l₂.exists_cons_of_ne_nil</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ne_nil_of_not_prefix</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"mi\">2</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">cons_prefix_cons</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">not_and</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">Decidable.em</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c₁</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">c₂</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">subst</span><span class=\"w\"> </span><span class=\"n\">c₂</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">forall_const</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">c₁'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">c₂'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pre</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">suf₁</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">suf₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hc</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">heq₁</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">heq₂</span><span class=\"o\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">        </span><span class=\"n\">not_prefix_and_not_prefix_symm_iff_exists.mp</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">c₁'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">c₂'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">c₁</span><span class=\"o\">::</span><span class=\"n\">pre</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">suf₁</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">suf₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hc</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">heq₁</span><span class=\"o\">],</span><span class=\"w\"> </span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">heq₂</span><span class=\"o\">]⟩</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">next</span><span class=\"w\"> </span><span class=\"n\">hc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">c₁</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">c₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">[],</span><span class=\"w\"> </span><span class=\"n\">l₁</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">l₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hc</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">nil_append</span><span class=\"w\"> </span><span class=\"bp\">..</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">nil_append</span><span class=\"w\"> </span><span class=\"bp\">..</span><span class=\"o\">⟩</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">c₁</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">c₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pre</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">suf₁</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">suf₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hc</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">heq₁</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">heq₂</span><span class=\"o\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">heq₁</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">heq₂</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">prefix_append_right_inj</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">cons_prefix_cons</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hc</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hc.symm</span><span class=\"o\">]</span>\n\n<span class=\"kd\">end</span><span class=\"w\"> </span><span class=\"n\">List</span>\n</code></pre></div>\n</div></div>",
        "id": 476716892,
        "sender_full_name": "Bulhwi Cha",
        "timestamp": 1728894618
    },
    {
        "content": "<p>Focused PRs are preferred whenever possible. It's okay to have PRs that depend on another PR, just make that clear in the description.</p>",
        "id": 476720806,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1728895642
    },
    {
        "content": "<p>I made a new PR: <a href=\"https://github.com/leanprover-community/Batteries/pull/987\">Batteries#987</a>.</p>",
        "id": 476730178,
        "sender_full_name": "Bulhwi Cha",
        "timestamp": 1728898050
    }
]