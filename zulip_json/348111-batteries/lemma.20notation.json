[
    {
        "content": "<p>Both <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=lemma#doc\">docs#lemma</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Batteries.Tactic.Lemma.lemmaCmd#doc\">docs#Batteries.Tactic.Lemma.lemmaCmd</a> exist; should the second one have lower priority to avoid ambiguous parsing?</p>",
        "id": 474605534,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1727966083
    },
    {
        "content": "<p>the <del>second</del> first one should not exist, it should have been removed when lemmaCmd was merged</p>",
        "id": 474607220,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727966405
    },
    {
        "content": "<p>actually, it looks like the implementation is not ideal for the mathlib use case - turning an option on would affect only mathlib and not its dependents, and the docstring on <code>lemma</code> is also not very good if <code>lang.lemmaCmd</code> option is enabled</p>",
        "id": 474607886,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727966590
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/348111-batteries/topic/lemma.20notation/near/474607220\">said</a>:</p>\n<blockquote>\n<p>when lemmaCmd was merged</p>\n</blockquote>\n<p>Are you talking about a different <code>lemmaCmd</code> to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Batteries.Tactic.Lemma.lemmaCmd#doc\">docs#Batteries.Tactic.Lemma.lemmaCmd</a>, which you say should be removed ?</p>",
        "id": 474607964,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1727966617
    },
    {
        "content": "<p>the easiest way to get desired behavior in mathlib is indeed to just make the priority of <code>lemma</code> slightly higher than default</p>",
        "id": 474607994,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727966628
    },
    {
        "content": "<p>I think we need to rethink this implementation in batteries, it's not that easy to just flip a switch and turn on the command</p>",
        "id": 474608437,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727966742
    },
    {
        "content": "<p>What's the default notation priority?</p>",
        "id": 474610012,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1727966997
    },
    {
        "content": "<p><code>default</code></p>",
        "id": 474610141,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727967008
    },
    {
        "content": "<p>you can write <code>default+1</code></p>",
        "id": 474610168,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727967012
    },
    {
        "content": "<p>maybe it would be better to just have batteries provide a function which does the equivalent of the present mathlib definition line called <code>enableLemmaGlobally</code>, and then mathlib can call it. That way we can centralize the metaprogramming machinery involved in one place</p>",
        "id": 474610184,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727967015
    },
    {
        "content": "<p>I don't understand why this needs to be a transitive option.</p>",
        "id": 474612728,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727967399
    },
    {
        "content": "<p>batteries can provide both options</p>",
        "id": 474613112,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727967457
    },
    {
        "content": "<p>What happens if a downstream project opens a mathlib file with a <code>lemma</code>: would that parse?</p>",
        "id": 474613256,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727967478
    },
    {
        "content": "<p>it's a mathlib choice whether it wants to do it globally or only within mathlib</p>",
        "id": 474613349,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727967485
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> yes, lake respects project-local options</p>",
        "id": 474613428,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727967497
    },
    {
        "content": "<p>I suspect that mathlib will either want to enable it globally, or add <code>lang.lemmaCmd</code> to the <code>math</code> template in lake (but there will still be a backwards incompatibility in this case for all projects downstream of mathlib using <code>lemma</code> today)</p>",
        "id": 474614031,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727967621
    },
    {
        "content": "<p>For the project-local option, there is still the issue of the bad docstring though, I don't know any way to script around this issue</p>",
        "id": 474614250,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727967684
    },
    {
        "content": "<p>I think we just need to make the docstring more ambiguous so that it reads okay for either possible setting of <code>lang.lemmaCmd</code></p>",
        "id": 474614483,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727967745
    },
    {
        "content": "<p>The docstring in Batteries could be the same as in Mathlib. The error message is enough if the lemma option is not on. No?</p>",
        "id": 474614877,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1727967850
    },
    {
        "content": "<p>If the option is not turned on, <code>lemma</code> is still a parse error, so maybe the doc-string in Batteries could be the one in mathlib.  After all, lemma is still a \"small\" theorem...</p>",
        "id": 474614914,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727967859
    },
    {
        "content": "<p>actually no, it's an elaboration time error now rather than a parse error. That's actually the reason for adding it to batteries in the first place: when it's a parse error you get much worse errors talking about applications and stuff</p>",
        "id": 474616628,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727968318
    },
    {
        "content": "<p>I don't see a definite plan after this discussion. Would someone volunteer to make an issue on Batteries?</p>\n<p>PS: With more maintainers on Batteries, we can make better use of issues. This is still a TODO for now but we will get to it!</p>",
        "id": 475024750,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1728164207
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/348111-batteries/topic/lemma.20notation/near/474607994\">said</a>:</p>\n<blockquote>\n<p>the easiest way to get desired behavior in mathlib is indeed to just make the priority of <code>lemma</code> slightly higher than default</p>\n</blockquote>\n<p>Is this a sensible immediate plan?</p>",
        "id": 475025026,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1728164498
    },
    {
        "content": "<p>yes, if it's causing issues please do that</p>",
        "id": 475028744,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1728168293
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/17533\">#17533</a></p>",
        "id": 475522297,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1728380832
    }
]