[
    {
        "content": "<p>I have a new WIP PR <a href=\"https://github.com/leanprover-community/batteries/pull/1007\">batteries#1007</a> for a replacement for Mathlib's <code>FinEnum</code> class.  It's pretty big since there's a lot of machinery going on. It comes from my personal library, so it's not quite up to \"standard form\" yet. I'd like some feedback on how to bring it more \"in line\". I don't need much input on implementation details right now since I'm still tuning them.</p>\n<p>This is needed because the Mathlib version is impractical. Instances rely on building a list of all elements of the type, which fits well with <code>Fintype</code> and <code>Finset</code> (which are both well designed) but is not practical for computation. The proposed alternative only builds a bijection between the type and <code>Fin size</code>, which can scale way beyond memory limitations.</p>",
        "id": 478824203,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1729818856
    },
    {
        "content": "<p>I don't really get what makes <code>Fin.Enum</code> distinct from <code>FinEnum</code>. Aren't both just data-carrying bijections between a type and some <code>Fin n</code>?</p>",
        "id": 478825177,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1729819626
    },
    {
        "content": "<p>The types aren't very different (except that <code>Equiv</code> doesn't exist in Batteries). The instances are very different though. All the Mathlib instances require building an actual list of all elements of the type, which is prohibitive for <code>Char</code> and impossible for <code>Char -&gt; Bool</code>. This implementation avoids that by just building the bijection and not the list.</p>",
        "id": 478825482,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1729819822
    },
    {
        "content": "<p>In other words, all the hard work is in <code>Fin.Coding</code> not in <code>Fin.Enum</code>.</p>",
        "id": 478825602,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1729819922
    },
    {
        "content": "<p>(Which reminds me I need to add an instance for <code>Char</code>...)</p>",
        "id": 478825894,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1729820147
    },
    {
        "content": "<p>I like the new definition, but I think I'd prefer to see mathlib refactored to use it first, then upstream it later</p>",
        "id": 478826291,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729820465
    },
    {
        "content": "<p>In particular, having <code>Equiv</code> in mathlib feels like it makes a lot of constructions easier, especially with things like <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=finSumFinEquiv#doc\">docs#finSumFinEquiv</a> etc</p>",
        "id": 478826318,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729820487
    },
    {
        "content": "<p>I think we should move <code>Equiv</code> to batteries actually</p>",
        "id": 478826341,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1729820504
    },
    {
        "content": "<p>It's a very simple and straightforward interface and it doesn't have poor computational behavior</p>",
        "id": 478826411,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1729820532
    },
    {
        "content": "<p>But you can't pick the simp-normal form without having DFunlike too</p>",
        "id": 478826433,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729820560
    },
    {
        "content": "<p>Or at least, you'd end up with a different simp-normal form to mathlib</p>",
        "id": 478826444,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729820569
    },
    {
        "content": "<p>I am okay with that</p>",
        "id": 478826481,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1729820601
    },
    {
        "content": "<p>I'm not sure it was a good idea to try to unify those across libraries in the first place</p>",
        "id": 478826499,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1729820622
    },
    {
        "content": "<p>somehow I suspect the call is going to be taken out of our hands anyway...</p>",
        "id": 478826576,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1729820667
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/348111-batteries/topic/Fin.2EEnum.20PR/near/478826499\">said</a>:</p>\n<blockquote>\n<p>I'm not sure it was a good idea to try to unify those across libraries in the first place</p>\n</blockquote>\n<p>Perhaps, but if downstream libraries  want to disagree with upstream ones, there ought to be a mechanism to unregister the simp lemmas</p>",
        "id": 478826638,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729820715
    },
    {
        "content": "<p>Otherwise it's easy to create loops</p>",
        "id": 478826660,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729820733
    },
    {
        "content": "<p>So far I haven't felt tempted to move <code>Equiv</code> up to Lean. :-) But I do encourage moving it to Batteries, particularly this PR seems be badly want it.</p>",
        "id": 478826907,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1729820919
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/348111-batteries/topic/Fin.2EEnum.20PR/near/478826638\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/348111-batteries/topic/Fin.2EEnum.20PR/near/478826499\">said</a>:</p>\n<blockquote>\n<p>I'm not sure it was a good idea to try to unify those across libraries in the first place</p>\n</blockquote>\n<p>Perhaps, but if downstream libraries  want to disagree with upstream ones, there ought to be a mechanism to unregister the simp lemmas</p>\n</blockquote>\n<p>that would indeed be nice</p>",
        "id": 478827042,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1729821025
    },
    {
        "content": "<p>I'm not at all opposed to moving <code>Equiv</code> to Batteries and I am happy to refactor this PR after that's done.</p>",
        "id": 478827326,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1729821278
    },
    {
        "content": "<p>Are you opposed to making the Enum refactor in mathlib first, so that we can leverage all the existing  equivs there?</p>",
        "id": 478827403,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729821353
    },
    {
        "content": "<p>I think most of your <code>Coding.lean</code> file already exists scattered throughout mathlib</p>",
        "id": 478827465,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729821371
    },
    {
        "content": "<p>Can you find them all? I gave up after a few steps down the rabbit hole :-) I figured we could just alias or deprecate them when they are discovered.</p>",
        "id": 478827913,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1729821658
    },
    {
        "content": "<p>It's also easier to maintain a coherent library of these standard codings.</p>",
        "id": 478828158,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1729821816
    },
    {
        "content": "<p>I would hope that Loogle can find them fairly quickly</p>",
        "id": 478828242,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729821865
    },
    {
        "content": "<p>Didn't help me much but you are surely a better loogler than I am.</p>",
        "id": 478828332,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1729821930
    },
    {
        "content": "<p>This is the kind of help I need!</p>",
        "id": 478828416,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1729821972
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"644391\">@loogle</span> Fin _ ⊕ Fin _ ≃ Fin _</p>",
        "id": 478828485,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729822025
    },
    {
        "content": "<p><span aria-label=\"search\" class=\"emoji emoji-1f50d\" role=\"img\" title=\"search\">:search:</span> <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Logic/Equiv/Fin.html#finSumFinEquiv\">finSumFinEquiv</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Logic/Equiv/Fin.html#finSumFinEquiv_apply_left\">finSumFinEquiv_apply_left</a>, and <a href=\"https://loogle.lean-lang.org/?q=Fin%20_%20%E2%8A%95%20Fin%20_%20%E2%89%83%20Fin%20_\">4 more</a></p>",
        "id": 478828486,
        "sender_full_name": "loogle",
        "timestamp": 1729822025
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 478828508,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729822039
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"644391\">@loogle</span> |- _ ≃ Fin _</p>",
        "id": 478828585,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729822085
    },
    {
        "content": "<p><span aria-label=\"search\" class=\"emoji emoji-1f50d\" role=\"img\" title=\"search\">:search:</span> <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Fin/Basic.html#finCongr\">finCongr</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Fintype/Card.html#Fintype.equivFin\">Fintype.equivFin</a>, and <a href=\"https://loogle.lean-lang.org/?q=%7C-%20_%20%E2%89%83%20Fin%20_\">17 more</a></p>",
        "id": 478828586,
        "sender_full_name": "loogle",
        "timestamp": 1729822086
    },
    {
        "content": "<p>It's inconsistent whether the <code>Fin</code> is on the LHS or RHS</p>",
        "id": 478828629,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729822125
    },
    {
        "content": "<p>The <code>Sum</code> stuff is relevant but kind of trivial, we might as well alias those with Fin.Coding functions. Relying on <code>Fintype</code> and <code>BigOperators</code> is a no go. That's the rabbit hole!</p>",
        "id": 478828944,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1729822407
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/348111-batteries/topic/Fin.2EEnum.20PR/near/478827403\">said</a>:</p>\n<blockquote>\n<p>Are you opposed to making the Enum refactor in mathlib first, so that we can leverage all the existing  equivs there?</p>\n</blockquote>\n<p>I am not opposed. I just don't think there is much to gain. Also, to a much lesser weight, I personally need it in Batteries sooner than later for at least two of my projects :-)</p>",
        "id": 478830267,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1729823471
    },
    {
        "content": "<p>PS: The <code>Fin.Enum</code> name was chosen so that Mathlib could gently deprecate <code>FinEnum</code>. And also to allow future variations like <code>Nat.Enum</code> with a compatible API.</p>",
        "id": 478831700,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1729824574
    },
    {
        "content": "<p>That's <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Encodable#doc\">docs#Encodable</a> I think</p>",
        "id": 478832990,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729825608
    },
    {
        "content": "<p>Yes, that's what I'm thinking about for <code>Nat.Enum</code>. We should keep that existing API in the back of our minds while thinking about the proposed API from this PR.</p>",
        "id": 478833198,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1729825782
    },
    {
        "content": "<p>By the way, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Finite#doc\">docs#Finite</a> is essentially <code>Prop</code> version of <code>Fin.Enum</code>. It seems like once <code>Fin.Enum</code> exists it would be a reasonable next step to update that definition.</p>",
        "id": 478833521,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1729826046
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"119741\">François G. Dorais</span> <a href=\"#narrow/channel/348111-batteries/topic/Fin.2EEnum.20PR/near/478824203\">said</a>:</p>\n<blockquote>\n<p>This is needed because the Mathlib version is impractical</p>\n</blockquote>\n<p>I just want to mention that we know this too, and it's come up a few times in discussions — glad to see motion to get this done!</p>\n<p>(I've also written my own <code>Fin.Enum</code> occasionally for projects, so looking forward to a well-developed one.)</p>",
        "id": 478833786,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1729826286
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/348111-batteries/topic/Fin.2EEnum.20PR/near/478827403\">said</a>:</p>\n<blockquote>\n<p>Are you opposed to making the Enum refactor in mathlib first, so that we can leverage all the existing  equivs there?</p>\n</blockquote>\n<p>How about this process:</p>\n<ol>\n<li>Merge the Batteries PR with Fin.Coding and Fin.Enum. Nothing there clashes with Mathlib.</li>\n<li>Figure out how to harmonize Mathlib and Fin.Coding. (Leaving Fin.Enum alone, just updating Fin.Coding and Mathlib defs to match.)</li>\n<li>Gently replace Mathlib's FinEnum with Batteries's Fin.Enum, reverting back to step 2 if that fails.</li>\n</ol>",
        "id": 479378882,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1730159961
    },
    {
        "content": "<p>Flagging PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/15647\">#15647</a> by <span class=\"user-mention\" data-user-id=\"712641\">@Tom Kranz</span> which adds 86 lines to mathlib's FinEnum and makes a new 120-line long file with definitions and lemmas about it.</p>",
        "id": 481806143,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1731357921
    },
    {
        "content": "<p>At a quick glance, this contribution focuses on implementing induction on cardinality for <code>FinEnum</code>. This is a fine and useful addition to Mathlib. However, the recursion principle has little computational value so there is little interest in having this in Batteries.</p>",
        "id": 481872837,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1731392696
    },
    {
        "content": "<p>Can we also get a (<code>proxy_equiv%</code> based) <code>deriving</code> impl for <code>Fin.Enum</code> in this PR? I think that would make it a complete replacement for the version I have been using :P</p>",
        "id": 483990794,
        "sender_full_name": "James Gallicchio",
        "timestamp": 1732309300
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"407274\">@James Gallicchio</span> Since <code>proxy_equiv%</code> is in Mathlib, the derive handler would have to be there.  Though it could be upstreamed in the near future since there seems to be universal agreement for upstreaming <code>Equiv</code> to batteries.</p>",
        "id": 484230994,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1732522239
    }
]