[
    {
        "content": "<p>I'm going to ask this here because <code>List.Chain</code> and <code>List.Chain'</code> live in batteries nowadays. I sort of asked this in an oblique way this morning but I think it's better here more directly.</p>\n<p>a) Can we come up with a better name than <code>Chain'</code> for <code>Chain'</code>? I understand why one might want both, but on the other hand <code>Chain'</code> could just do everything. Having done a search this discussion has come up a couple of times in the past, but I am interested in people's thoughts.<br>\nb) Would there be value in having a <code>chain</code> Bool-valued predicate, something like:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">chain</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Bool</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">[],</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">_</span><span class=\"o\">],</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">chain</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">R</span>\n</code></pre></div>\n<p>Notably for a transitive predicate this does efficiently calculate whether the list is sorted according to it! You could also have <code>chainM</code> in the same way as <code>anyM</code>.<br>\nc) In a similar vein, would there be any interest in something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">pairwise</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Bool</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">[],</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">all</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">pairwise</span><span class=\"w\"> </span><span class=\"n\">R</span>\n</code></pre></div>\n<p>d) In a similar similar vein, one could define these for Arrays - in particular, one could define them efficienctly a la how Array.anyM etc. are done, rather than Array.Pairwise which just defers it to the list representation. I have done this but it's a bit long so I won't post it here.<br>\ne) I am not really sure if these things should do in core, Batteries, or even Mathlib (though I feel like surely not). I don't quite get why List.Pairwise is in core but List.Chain is in Batteries! So I would appreciate some help understanding the rationale here.</p>",
        "id": 540256222,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758207649
    },
    {
        "content": "<p>a) Unfortunately, <a href=\"https://github.com/leanprover-community/batteries/pull/1052\">batteries#1052</a> has gone stale. You could ask the author if you can help reviving it.</p>\n<p>b,c) Makes sense. A <code>Decidable</code> instance is probably enough. Batteries tries to make sure these instances have efficient implementations, which probably amounts to your <code>chain</code> and <code>pairwise</code>.</p>\n<p>d) That makes sense too. I would recommend a separate PR though.</p>\n<p>e) \"Keeping similar things together\" is not a primary concern for the separation between core, Std and Batteries. Core and Std have interest in keeping their API surface small. As a rule of thumb, if it's not essential for Lean itself then core won't take it. Similarly, if it's not essential for the Lean programming language, then Std won't take it. Batteries is more welcoming but anything that is not useful for Lean programming per se probably belongs in Mathlib.</p>",
        "id": 540334855,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1758234766
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"119741\">François G. Dorais</span> <a href=\"#narrow/channel/348111-batteries/topic/Chain.20and.20Chain'.20and.20Pairwise/near/540334855\">said</a>:</p>\n<blockquote>\n<p>probably belongs in Mathlib</p>\n</blockquote>\n<p>... if it is useful for doing mathematics.</p>",
        "id": 540349498,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1758239217
    },
    {
        "content": "<p>I'd be happy to see <code>Chain</code> filled out for <code>Array</code> and <code>Vector</code>! I'd recommend Batteries for now.</p>",
        "id": 540349554,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1758239278
    },
    {
        "content": "<p>Another clarification regarding e) I don't think it's the PR author's sole responsibility to decide where their contributions belong. It is especially discouraged to split PRs because some part belongs here and the other belongs there. In case of doubt, the default should be to send to Batteries. If that's not the right place, maintainers will point to the appropriate location. If it's more complicated than that, the FRO has qualified (and paid) staff to help with that; Batteries maintainers will also gladly help pinging the right people for this kind of surgery.</p>",
        "id": 540355668,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1758244449
    },
    {
        "content": "<p>Why is Pairwise essential for Lean programming? I don't deny that it is to be clear, I'm sure it comes up, but I don't know where that would be.</p>",
        "id": 540377434,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758260934
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"119741\">François G. Dorais</span> <a href=\"#narrow/channel/348111-batteries/topic/Chain.20and.20Chain'.20and.20Pairwise/near/540334855\">said</a>:</p>\n<blockquote>\n<p>a) Unfortunately, <a href=\"https://github.com/leanprover-community/batteries/pull/1052\">batteries#1052</a> has gone stale. You could ask the author if you can help reviving it.</p>\n<p>b,c) Makes sense. A <code>Decidable</code> instance is probably enough. Batteries tries to make sure these instances have efficient implementations, which probably amounts to your <code>chain</code> and <code>pairwise</code>.</p>\n<p>d) That makes sense too. I would recommend a separate PR though.</p>\n<p>e) \"Keeping similar things together\" is not a primary concern for the separation between core, Std and Batteries. Core and Std have interest in keeping their API surface small. As a rule of thumb, if it's not essential for Lean itself then core won't take it. Similarly, if it's not essential for the Lean programming language, then Std won't take it. Batteries is more welcoming but anything that is not useful for Lean programming per se probably belongs in Mathlib.</p>\n</blockquote>\n<p>Why do we have in some cases things like List.all/any, which is bool-valued, and in other cases we just use Decidable?</p>",
        "id": 540377535,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758261003
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"330967\">Wrenna Robson</span> <a href=\"#narrow/channel/348111-batteries/topic/Chain.20and.20Chain'.20and.20Pairwise/near/540377434\">schrieb</a>:</p>\n<blockquote>\n<p>Why is Pairwise essential for Lean programming?</p>\n</blockquote>\n<p>Well, it's maybe not essential for programming but it is a dependency of the hash maps and tree maps and thus needs to be in core. (I'm not sure this is <em>how</em> it got into core, it might have been there before, but that's at least one use case)</p>",
        "id": 540393938,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758268484
    },
    {
        "content": "<p>Aha</p>",
        "id": 540394008,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758268510
    },
    {
        "content": "<p>Did we have any insights on Chain versus Chain'? I am still kinda of the view that the current state of affairs there is non-ideal.</p>",
        "id": 540394225,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758268585
    },
    {
        "content": "<p>But maybe I'm missing something.</p>",
        "id": 540394263,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758268601
    },
    {
        "content": "<p>I'm fine with the <code>Decidable</code> instances using this separation of <code>[]</code> and <code>a :: as</code> on the top level and then doing it like the current <code>Chain</code> since that reduces the amount of destructuring operations but I'm not sure whether it's worth actually separating them out into different predicates. I'd done something like:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">IsChain</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">nil</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsChain</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">[]</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">singleton</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsChain</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">a</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsChain</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsChain</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"o\">)</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">instDecidableIsChain</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DecidableRel</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">IsChain</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">nil</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">l</span>\n<span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">IsChain</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">singleton</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">l'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"n\">hr</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">hr</span><span class=\"w\"> </span><span class=\"n\">h'</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">        </span><span class=\"bp\">@</span><span class=\"n\">decidable_of_decidable_of_iff</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">l'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">⟨.</span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"n\">h'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">h''</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">h''</span><span class=\"bp\">⟩</span>\n</code></pre></div>",
        "id": 540396821,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758269460
    },
    {
        "content": "<p>So IsChain here replaces the current Chain and Chain'?</p>",
        "id": 540397148,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758269554
    },
    {
        "content": "<p>Yeah, <code>List.Chain'</code> becomes <code>List.IsChain</code> and <code>List.Chain r a l</code> becomes <code>List.IsChain r (a :: l)</code></p>",
        "id": 540397857,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758269786
    },
    {
        "content": "<p>That does feel better. Why the change to IsChain instead of Chain?</p>",
        "id": 540398545,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758270013
    },
    {
        "content": "<p>No idea, got inspired by <a href=\"https://github.com/leanprover-community/batteries/pull/1052\">batteries#1052</a>?</p>",
        "id": 540399770,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758270399
    },
    {
        "content": "<p>I guess that also allows us to do more proper deprecation without suddenly changing the meaning of something</p>",
        "id": 540399909,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758270439
    },
    {
        "content": "<p>Yes true</p>",
        "id": 540399939,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758270448
    },
    {
        "content": "<p>Why is it you use <code>go</code> rather than an extra match case in the top level match?</p>",
        "id": 540403266,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758271434
    },
    {
        "content": "<p>Does it give some computational advantage?</p>",
        "id": 540403294,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758271446
    },
    {
        "content": "<p>Yeah, because otherwise you have to match twice on every list</p>",
        "id": 540403610,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758271565
    },
    {
        "content": "<p>Oh, wheras this way you only do one match because <code>go</code> is compiled into a function, or something?</p>",
        "id": 540403803,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758271617
    },
    {
        "content": "<p>Right, the code generated looks like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">    </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">instDecidableIsChain</span><span class=\"bp\">._</span><span class=\"n\">redArg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">obj</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x_2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tobj</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">u8</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">      </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">x_2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tobj</span><span class=\"w\"> </span><span class=\"n\">of</span>\n<span class=\"w\">      </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">nil</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">        </span><span class=\"bp\">...</span>\n<span class=\"w\">      </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">        </span><span class=\"bp\">...</span>\n<span class=\"w\">        </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">x_6</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">u8</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">instDecidableIsChain</span><span class=\"bp\">.</span><span class=\"n\">go</span><span class=\"bp\">._</span><span class=\"n\">redArg</span><span class=\"w\"> </span><span class=\"n\">x_1</span><span class=\"w\"> </span><span class=\"n\">x_4</span><span class=\"w\"> </span><span class=\"n\">x_5</span><span class=\"bp\">;</span>\n<span class=\"w\">        </span><span class=\"n\">ret</span><span class=\"w\"> </span><span class=\"n\">x_6</span>\n\n<span class=\"w\">    </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">instDecidableIsChain</span><span class=\"bp\">.</span><span class=\"n\">go</span><span class=\"bp\">._</span><span class=\"n\">redArg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">obj</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x_2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tobj</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x_3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tobj</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">u8</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">      </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">x_3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tobj</span><span class=\"w\"> </span><span class=\"n\">of</span>\n<span class=\"w\">      </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">nil</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">        </span><span class=\"bp\">...</span>\n<span class=\"w\">      </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">        </span><span class=\"bp\">...</span>\n<span class=\"w\">        </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">x_7</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tagged</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"n\">x_1</span><span class=\"w\"> </span><span class=\"n\">x_2</span><span class=\"w\"> </span><span class=\"n\">x_5</span><span class=\"bp\">;</span>\n<span class=\"w\">        </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">x_8</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">u8</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">unbox</span><span class=\"w\"> </span><span class=\"n\">x_7</span><span class=\"bp\">;</span>\n<span class=\"w\">        </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">x_8</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">u8</span><span class=\"w\"> </span><span class=\"n\">of</span>\n<span class=\"w\">        </span><span class=\"n\">Bool</span><span class=\"bp\">.</span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">          </span><span class=\"bp\">...</span>\n<span class=\"w\">        </span><span class=\"n\">Bool</span><span class=\"bp\">.</span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">          </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">x_10</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">u8</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">instDecidableIsChain</span><span class=\"bp\">.</span><span class=\"n\">go</span><span class=\"bp\">._</span><span class=\"n\">redArg</span><span class=\"w\"> </span><span class=\"n\">x_1</span><span class=\"w\"> </span><span class=\"n\">x_5</span><span class=\"w\"> </span><span class=\"n\">x_6</span><span class=\"bp\">;</span>\n<span class=\"w\">          </span><span class=\"n\">ret</span><span class=\"w\"> </span><span class=\"n\">x_10</span>\n</code></pre></div>\n<p>while the other one would look like:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">    </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">instDecidableIsChain2</span><span class=\"bp\">._</span><span class=\"n\">redArg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">obj</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x_2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tobj</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">u8</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">      </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">x_2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tobj</span><span class=\"w\"> </span><span class=\"n\">of</span>\n<span class=\"w\">      </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">nil</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">        </span><span class=\"bp\">...</span>\n<span class=\"w\">      </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">        </span><span class=\"bp\">...</span>\n<span class=\"w\">        </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">x_5</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tobj</span><span class=\"w\"> </span><span class=\"n\">of</span>\n<span class=\"w\">        </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">nil</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">          </span><span class=\"bp\">...</span>\n<span class=\"w\">        </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">          </span><span class=\"bp\">...</span>\n<span class=\"w\">          </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">x_8</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tagged</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"n\">x_1</span><span class=\"w\"> </span><span class=\"n\">x_4</span><span class=\"w\"> </span><span class=\"n\">x_7</span><span class=\"bp\">;</span>\n<span class=\"w\">          </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">x_9</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">u8</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">unbox</span><span class=\"w\"> </span><span class=\"n\">x_8</span><span class=\"bp\">;</span>\n<span class=\"w\">          </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">x_9</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">u8</span><span class=\"w\"> </span><span class=\"n\">of</span>\n<span class=\"w\">          </span><span class=\"n\">Bool</span><span class=\"bp\">.</span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">            </span><span class=\"bp\">...</span>\n<span class=\"w\">          </span><span class=\"n\">Bool</span><span class=\"bp\">.</span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">            </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">x_11</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">u8</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">instDecidableIsChain2</span><span class=\"bp\">._</span><span class=\"n\">redArg</span><span class=\"w\"> </span><span class=\"n\">x_1</span><span class=\"w\"> </span><span class=\"n\">x_5</span><span class=\"bp\">;</span>\n<span class=\"w\">            </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">x_11</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">u8</span><span class=\"w\"> </span><span class=\"n\">of</span>\n<span class=\"w\">            </span><span class=\"n\">Bool</span><span class=\"bp\">.</span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">              </span><span class=\"n\">ret</span><span class=\"w\"> </span><span class=\"n\">x_11</span>\n<span class=\"w\">            </span><span class=\"n\">Bool</span><span class=\"bp\">.</span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">              </span><span class=\"n\">ret</span><span class=\"w\"> </span><span class=\"n\">x_6</span>\n</code></pre></div>",
        "id": 540404817,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758271931
    },
    {
        "content": "<p>Got it.</p>",
        "id": 540404884,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758271952
    },
    {
        "content": "<p>I hadn't appreciated there was a meaningful difference computationally there.</p>",
        "id": 540404943,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758271971
    },
    {
        "content": "<p>Hmm. So you can decide <code>IsChain R []</code> or <code>IsChain R [a]</code> even when <code>R</code> isn't decidable, right? Is there a way to register that? Is that a bad idea?</p>",
        "id": 540405578,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758272144
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">instDecidableIsChainNil</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">([]</span><span class=\"bp\">.</span><span class=\"n\">IsChain</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">nil</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">instDecidableIsChainSingleton</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">([</span><span class=\"n\">a</span><span class=\"o\">]</span><span class=\"bp\">.</span><span class=\"n\">IsChain</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">singleton</span><span class=\"w\"> </span><span class=\"n\">a</span>\n</code></pre></div>\n<p>Like we also have these.</p>",
        "id": 540405766,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758272195
    },
    {
        "content": "<p>I guess but what would be the use case?</p>",
        "id": 540407048,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758272585
    },
    {
        "content": "<p>When you write <code>if h : [].IsChain R</code> then you could've also just omitted the if</p>",
        "id": 540407138,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758272615
    },
    {
        "content": "<p>True</p>",
        "id": 540407178,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758272627
    },
    {
        "content": "<p>(As an aside, arguably <code>List.Forall</code> should also be in batteries under a similar rationale and more clearly linked to <code>List.all</code>.  We have <code>List.Forall₂</code> in batteries!)</p>",
        "id": 540408174,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758272969
    },
    {
        "content": "<p>I have a slight adapation: what do you think of this?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">IsChain</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- A list of length 0 is a chain. -/</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">nil</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsChain</span><span class=\"w\"> </span><span class=\"o\">[]</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- A list of length 1 is a chain. -/</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">singleton</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsChain</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">a</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- If `a` relates to `b` and `b::l` is a chain, then `a :: b :: l` is also a chain. -/</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsChain</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsChain</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"o\">)</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">isChain_nil</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsChain</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">nil</span>\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">isChain_singleton</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsChain</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">a</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">singleton</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">isChain_cons₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsChain</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">IsChain</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"n\">hr</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">hr</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">⟩</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">hr</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"n\">hr</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">instDecidableIsChain</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DecidableRel</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"bp\">.</span><span class=\"n\">IsChain</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">nil</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">l</span>\n<span class=\"w\">  </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">IsChain</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">      </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">singleton</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">haveI</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"o\">)</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">decidable_of_iff'</span><span class=\"w\">  </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">isChain_cons₂</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 540410682,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758273871
    },
    {
        "content": "<p>Basically I think we want these <code>simp</code> lemmas and then once you have them it makes sense to use them in the decidability proof I think.</p>",
        "id": 540410911,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758273955
    },
    {
        "content": "<p>Seems good, the code generated seems to be the same</p>",
        "id": 540411464,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758274141
    },
    {
        "content": "<p>Though possible these lemmas should go in Data.List.Lemmas, in which case we should indeed use your version.</p>",
        "id": 540411467,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758274142
    },
    {
        "content": "<p>But I tend to like putting them here.</p>",
        "id": 540411501,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758274153
    },
    {
        "content": "<p>Incidentally: when I change my cases in my match statement, VScode or Lean (not sure which is messing up) flags a syntax error for the wrong cases which goes away if I refresh the page or cut/paste the problematic part, causing a recheck</p>",
        "id": 540423890,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758278470
    },
    {
        "content": "<p>Which suggests some kind of bug I think?</p>",
        "id": 540423908,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758278477
    },
    {
        "content": "<p>I've created <a href=\"https://github.com/leanprover-community/batteries/pull/1421\">batteries#1421</a>. This is the first time I've done work in batteries that requires changes in mathlib, so bear with me on that: do I want to get it fully reviewed in batteries first and then make the changes downstream?</p>",
        "id": 540426062,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758279161
    },
    {
        "content": "<p>Also if this does pass review, <a href=\"https://github.com/leanprover-community/batteries/pull/1052\">batteries#1052</a> can be dropped.</p>",
        "id": 540426144,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758279185
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"873547\">@Robin Arnez</span> would you be able to review first of all?</p>",
        "id": 540426275,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758279221
    },
    {
        "content": "<p>Yeah, I'll take a look</p>",
        "id": 540426326,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758279242
    },
    {
        "content": "<p>Thanks. I've included lemmas that seemed analogous to ones we have for Pairwise in core or batteries, but ultimately it is to taste a little. It is possible that there are lemmas for Chain or Chain' in Mathlib that should move over (or vice versa).</p>",
        "id": 540426488,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758279299
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"330967\">Wrenna Robson</span> <a href=\"#narrow/channel/348111-batteries/topic/Chain.20and.20Chain'.20and.20Pairwise/near/540423890\">said</a>:</p>\n<blockquote>\n<p>Incidentally: when I change my cases in my match statement, VScode or Lean (not sure which is messing up) flags a syntax error for the wrong cases which goes away if I refresh the page or cut/paste the problematic part, causing a recheck</p>\n</blockquote>\n<p>This happens to me too it doesn't impact my work but is annoying</p>",
        "id": 540428870,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1758280053
    },
    {
        "content": "<p>Yeah it's a small thing but annoying.</p>",
        "id": 540429237,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758280180
    },
    {
        "content": "<p>For the mathlib fixing, there's no cache availiable - does that mean that I need to build mathlib by hand?</p>",
        "id": 540461177,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758289806
    },
    {
        "content": "<p>Really? Are you on the right branch?</p>",
        "id": 540461263,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758289840
    },
    {
        "content": "<p>I think so?</p>",
        "id": 540461300,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758289849
    },
    {
        "content": "<p>nightly-testing/batteries-pr-testing-1421 (or, well, my local copy).</p>",
        "id": 540461410,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758289879
    },
    {
        "content": "<p>Possibly I have misconfigured something?</p>",
        "id": 540461443,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758289887
    },
    {
        "content": "<p>I did update the copy of batteries so it was my most recent commit which I guess probably broke something.</p>",
        "id": 540461511,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758289907
    },
    {
        "content": "<p>I don't know if I'm meant to upload those manually or if CI handles it.</p>",
        "id": 540464417,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758290665
    },
    {
        "content": "<p>Well, I get 1709/7224 files in cache, you get nothing?</p>",
        "id": 540464699,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758290750
    },
    {
        "content": "<p>Yes. Is that with batteries updated or as it was when it was first pushed.</p>",
        "id": 540464815,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758290775
    },
    {
        "content": "<p>Oh it might've not updated yet</p>",
        "id": 540464951,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758290807
    },
    {
        "content": "<p>Yeah IDK how that works :)</p>",
        "id": 540464996,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758290823
    },
    {
        "content": "<p>Just <code>lake update</code> seemed to work</p>",
        "id": 540465288,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758290900
    },
    {
        "content": "<p>You might need to pull that branch now</p>",
        "id": 540465317,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758290910
    },
    {
        "content": "<p>DId you have to change the <code>json</code> file?</p>",
        "id": 540465338,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758290917
    },
    {
        "content": "<p><code>lake-manifest.json</code>, I mean.</p>",
        "id": 540465413,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758290935
    },
    {
        "content": "<p>No, just <code>lake update</code></p>",
        "id": 540465422,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758290939
    },
    {
        "content": "<p>It changes it automatically</p>",
        "id": 540465452,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758290947
    },
    {
        "content": "<p>Huh. That feels unexpected. OK.</p>",
        "id": 540465509,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758290964
    },
    {
        "content": "<p>Right, got it. Where is the CI for the Mathlib build?</p>",
        "id": 540466506,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758291194
    },
    {
        "content": "<p>Just on the commits in <a href=\"https://github.com/leanprover-community/mathlib4-nightly-testing/tree/batteries-pr-testing-1421\">https://github.com/leanprover-community/mathlib4-nightly-testing/tree/batteries-pr-testing-1421</a></p>",
        "id": 540466647,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758291224
    },
    {
        "content": "<p>I don't have the rights to push to nightly-testing - should I push to my own mathlib fork and create a PR?</p>",
        "id": 540467061,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758291310
    },
    {
        "content": "<p>Yeah, you can make a PR and I can then just merge it</p>",
        "id": 540467223,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758291352
    },
    {
        "content": "<p>I took care of some of the simpler stuff (which you might need to pull) but I'll let you do everything in Mathlib.Data.List.Chain</p>",
        "id": 540467432,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758291404
    },
    {
        "content": "<p>OK, I have created <a href=\"https://github.com/leanprover-community/mathlib4/pull/29809\">#29809</a></p>",
        "id": 540467718,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758291471
    },
    {
        "content": "<p>Wrong target, you need to put it to leanprover-community/mathlib-nightly-testing:batteries-pr-testing-1421 (might need to do manually)</p>",
        "id": 540467902,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758291517
    },
    {
        "content": "<p>I am trying to manually create the PR but I can't fill in <code>leanprover-community/mathlib-nightly-testing</code> into the base repo..</p>",
        "id": 540468577,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758291709
    },
    {
        "content": "<p>Oh it's <code>mathlib4-nightly-testing</code>, isn't it?</p>",
        "id": 540468748,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758291735
    },
    {
        "content": "<p>Still can't see it though.</p>",
        "id": 540468773,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758291745
    },
    {
        "content": "<p>Oh, my bad</p>",
        "id": 540468788,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758291748
    },
    {
        "content": "<p>Does this work? <a href=\"https://github.com/leanprover-community/mathlib4-nightly-testing/compare/batteries-pr-testing-1421...linesthatinterlace:mathlib4:batteries-pr-testing-1421\">https://github.com/leanprover-community/mathlib4-nightly-testing/compare/batteries-pr-testing-1421...linesthatinterlace:mathlib4:batteries-pr-testing-1421</a></p>",
        "id": 540468970,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758291781
    },
    {
        "content": "<p>Yes!</p>",
        "id": 540469050,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758291795
    },
    {
        "content": "<p>OK so I have <a href=\"https://github.com/leanprover-community/mathlib4-nightly-testing/pull/70\">mathlib4-nightly-testing#70</a></p>",
        "id": 540469148,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758291831
    },
    {
        "content": "<p>Does that look correct?</p>",
        "id": 540469206,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758291848
    },
    {
        "content": "<p>Why didn't I want to create a regular Mathlib PR?</p>",
        "id": 540469299,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758291877
    },
    {
        "content": "<p>Because regular mathlib doesn't have your batteries version?</p>",
        "id": 540469463,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758291915
    },
    {
        "content": "<p>Right... but the batteries version is specified by the lakefile</p>",
        "id": 540469558,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758291951
    },
    {
        "content": "<p>Which the PR updates!</p>",
        "id": 540469579,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758291957
    },
    {
        "content": "<p>I'm going off the workflow described here: <a href=\"https://github.com/leanprover-community/batteries/\">https://github.com/leanprover-community/batteries/</a></p>",
        "id": 540469650,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758291976
    },
    {
        "content": "<p>Yeah, I mean you can't just PR something to mathlib that adds <a href=\"https://github.com/linesthatinterlace/batteries\">https://github.com/linesthatinterlace/batteries</a> to the lakefile</p>",
        "id": 540469703,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758291991
    },
    {
        "content": "<p>No I know.</p>",
        "id": 540469732,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758292000
    },
    {
        "content": "<p>The README explains this.</p>",
        "id": 540469754,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758292004
    },
    {
        "content": "<h3>Mathlib Adaptations</h3>\n<p>Batteries PRs often affect Mathlib, a key component of the Lean ecosystem.<br>\nWhen Batteries changes in a significant way, Mathlib must adapt promptly.<br>\nWhen necessary, Batteries contributors are expected to either create an adaptation PR on Mathlib, or ask for assistance for and to collaborate with this necessary process.</p>\n<p>Every Batteries PR has an automatically created Mathlib branch called <code>batteries-pr-testing-N</code> where <code>N</code> is the number of the Batteries PR.<br>\nThis is a clone of Mathlib where the Batteries requirement points to the Batteries PR branch instead of the main branch.<br>\nBatteries uses this branch to check whether the Batteries PR needs Mathlib adaptations.<br>\nA tag <code>builds-mathlib</code> will be issued when this branch needs no adaptation; a tag <code>breaks-mathlib</code> will be issued when the branch does need an adaptation.</p>\n<p>The first step in creating an adaptation PR is to switch to the <code>batteries-pr-testing-N</code> branch and push changes to that branch until the Mathlib CI process works.<br>\nChanges to the Batteries PR will be integrated automatically as you work on this process.<br>\nDo not redirect the Batteries requirement to main until the Batteries PR is merged.<br>\nPlease ask questions to Batteries and Mathlib maintainers if you run into issues with this process.</p>\n<p>When everything works, create an adaptation PR on Mathlib from the <code>batteries-pr-testing-N</code> branch.<br>\nYou may need to ping a Mathlib maintainer to review the PR, ask if you don't know who to ping.<br>\nOnce the Mathlib adaptation PR and the original Batteries PR have been reviewed and accepted, the Batteries PR will be merged first. Then, the Mathlib PR's lakefile needs to be repointed to the Batteries main branch: change the Batteries line to</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">require</span><span class=\"w\"> </span><span class=\"s2\">\"leanprover-community\"</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"s2\">\"batteries\"</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"s2\">\"main\"</span>\n</code></pre></div>\n<p>Once CI once again checks out on Mathlib, the adaptation PR can be merged using the regular Mathlib process.</p>",
        "id": 540469796,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758292016
    },
    {
        "content": "<p>So I was just going to change the lakefile once it was done.</p>",
        "id": 540469925,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758292049
    },
    {
        "content": "<p>But this does seem to assume you're doing a regular Mathlib PR to do the adaption.</p>",
        "id": 540470131,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758292106
    },
    {
        "content": "<p>Yeah, right... but you don't have access to the <code>batteries-pr-testing-N</code> branch</p>",
        "id": 540470180,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758292117
    },
    {
        "content": "<p>Well I have access to my one.</p>",
        "id": 540470250,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758292136
    },
    {
        "content": "<p>Hmm yeah it seems like this description doesn't incorporate the new PR from fork model</p>",
        "id": 540470490,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758292206
    },
    {
        "content": "<p>That is what I was wondering.</p>",
        "id": 540470529,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758292217
    },
    {
        "content": "<p>It is not a <em>super</em> clear process but on the \"PR from fork\" model I feel like <a href=\"https://github.com/leanprover-community/mathlib4/pull/29809\">#29809</a> would have been fine (it just couldn't have actually merged until the batteries PR merged, which is fine).</p>",
        "id": 540470656,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758292258
    },
    {
        "content": "<p>Hmm yeah you might be right</p>",
        "id": 540470886,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758292317
    },
    {
        "content": "<p>I guess you just don't get a builds-mathlib conformation then?</p>",
        "id": 540470975,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758292340
    },
    {
        "content": "<p>Yeah I'm not sure how that part is meant to work.</p>",
        "id": 540471064,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758292362
    },
    {
        "content": "<p>Well, we can probably work with how it is now; once you get a clean build, I'll merge and then we can look from there</p>",
        "id": 540471424,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758292458
    },
    {
        "content": "<p>The nightly testing PR?</p>",
        "id": 540471501,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758292485
    },
    {
        "content": "<p>I guess?</p>",
        "id": 540471547,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758292495
    },
    {
        "content": "<p>OK :). Worse comes to worst I can put it somewhere else</p>",
        "id": 540471621,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758292518
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"330967\">Wrenna Robson</span> <a href=\"#narrow/channel/348111-batteries/topic/Chain.20and.20Chain'.20and.20Pairwise/near/540408174\">said</a>:</p>\n<blockquote>\n<p>(As an aside, arguably <code>List.Forall</code> should also be in batteries under a similar rationale and more clearly linked to <code>List.all</code>.  We have <code>List.Forall₂</code> in batteries!)</p>\n</blockquote>\n<p>List.Forall deliberately doesn't exist, you are supposed to use <code>∀ x ∈ l, p x</code></p>",
        "id": 540472211,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1758292690
    },
    {
        "content": "<p>Right! Somewhat confusing that it does exist in Mathlib but I do see why that's better.</p>",
        "id": 540472383,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758292745
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"873547\">@Robin Arnez</span> It was a bit of work, but Data/List/Chain is cleaned up, I just pushed it. Let's see where that gets us.</p>",
        "id": 540516997,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758307869
    },
    {
        "content": "<p>Hmm seems lika Data.List.Chain works now but there are at least 8 new files with problems</p>",
        "id": 540518413,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758308471
    },
    {
        "content": "<p>About what I expected :) - But I'm done for the day I think. Feel free though to look at the other files - my hope is that they will be more minor adapations</p>",
        "id": 540519972,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758309152
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"873547\">@Robin Arnez</span> god willing, the latest push to <a href=\"https://github.com/leanprover-community/mathlib4-nightly-testing/pull/70\">mathlib4-nightly-testing#70</a> ought to fix it.</p>",
        "id": 540788786,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758544102
    },
    {
        "content": "<p>I'm really happy to see Chain and Chain' merged into one. I've always figured the former should have been an implementation detail at most.</p>",
        "id": 540876629,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1758567664
    },
    {
        "content": "<p>We're not there yet but it's getting there.</p>",
        "id": 540877935,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758568145
    },
    {
        "content": "<p>Something is going wrong with the cache uploading which is substantially slowing matters.</p>",
        "id": 540878689,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758568440
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"330967\">Wrenna Robson</span> <a href=\"#narrow/channel/348111-batteries/topic/Chain.20and.20Chain'.20and.20Pairwise/near/540878689\">said</a>:</p>\n<blockquote>\n<p>Something is going wrong with the cache uploading which is substantially slowing matters.</p>\n</blockquote>\n<p>Could you make an issue about that? I've noticed this but I think my maintainer privileges prevent me from fully experiencing the issue.</p>",
        "id": 540901420,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1758578843
    },
    {
        "content": "<p>Where ought that to be?</p>",
        "id": 540901452,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758578860
    },
    {
        "content": "<p>Batteries for now. We'll retarget once the issue has been narrowed down.</p>",
        "id": 540901535,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1758578911
    },
    {
        "content": "<p>Righto.</p>",
        "id": 540901543,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758578917
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 540901611,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1758578974
    },
    {
        "content": "<p>There are also a few existing discussions about similar problems I believe</p>",
        "id": 540901617,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758578978
    },
    {
        "content": "<p>Yes, but no significant progress there either AFAIK.</p>",
        "id": 540901700,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1758579047
    },
    {
        "content": "<p>Yeah, right. I think this might be a problem specifically (or at least primarily) for PRs</p>",
        "id": 540901812,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758579138
    },
    {
        "content": "<p>I think we need a CI guru to look into this.</p>",
        "id": 540902002,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1758579281
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/batteries/issues/1425\">https://github.com/leanprover-community/batteries/issues/1425</a></p>",
        "id": 540906837,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758582945
    },
    {
        "content": "<p>I have a religious holiday tomorrow and this issue has made my tidying up take much longer than it ought to have,</p>",
        "id": 540907725,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758583744
    },
    {
        "content": "<p>and then I have other things to do.</p>",
        "id": 540907735,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758583751
    },
    {
        "content": "<p>So if my final push hasn't fixed all the little issues that would be SO much easier to fix if I had a full cache to work with...</p>",
        "id": 540907759,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758583770
    },
    {
        "content": "<p>It's going to have to wait, or someone take on getting it over the line.</p>",
        "id": 540907776,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758583786
    },
    {
        "content": "<p>Ah so the good news is we are good! Building Mathlib finally and I've addressed all the comments on the batteries PR. I'm not sure if I now want to consider moving my Mathlib PR over to the main branch or what.</p>",
        "id": 540945578,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758612621
    },
    {
        "content": "<p>Basically not sure how this landing part works</p>",
        "id": 540945626,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758612635
    },
    {
        "content": "<p>Can someone open the Mathlib PR, please?</p>",
        "id": 541134537,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1758683555
    },
    {
        "content": "<p>i.e. there needs to be a PR in which you've run <code>lake update</code>, and fixed the problems from these deprecations.</p>",
        "id": 541134550,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1758683575
    },
    {
        "content": "<p>My preference is that when we know that an adaptation is needed, we don't merge the Batteries PR until the corresponding Mathlib PR actually exists (although that PR will need to point Mathlib's lakefile to the Batteries PR branch, and this will then subsequently need to be updated before the Mathlib PR can be merged).</p>\n<p>Having this PR open, and linked to from the Batteries PR, means we're not stuck in this situation where <code>nightly-testing</code> isn't working, but I need to wait on someone else before fixing it.</p>",
        "id": 541134873,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1758683751
    },
    {
        "content": "<p>Also, I see that this PR was merged despite open review comments from <span class=\"user-mention\" data-user-id=\"873547\">@Robin Arnez</span>. What is the status of these? Do they need to be addressed in a follow-up PR?</p>",
        "id": 541134912,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1758683789
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> hi Kim. Apologies for the confusion here: I was not expecting people to merge stuff before I came back from Rosh HaShanah.</p>\n<p>There was some confusion about whether it needs to be a Mathlib PR or a Mathlib Nightly PR. I've done the latter and that exists with the required adaptions - I did open the former but I was told that was wrong? If I'm honest the guidance wasn't entirely clear to me. I'm happy to open one and migrate my branch over, if I can manage that.</p>",
        "id": 541155268,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758697165
    },
    {
        "content": "<p>I'm not sure what the open comments from Robin Arnez were. I don't remember seeing those on Monday - when were they made?</p>",
        "id": 541155443,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758697219
    },
    {
        "content": "<p>I've opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/29928\">#29928</a> now</p>",
        "id": 541155456,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758697224
    },
    {
        "content": "<p>I've opened review comments shortly before the PR was merged, they are not urgent though and are more style-related, we could address them in a follow-up</p>",
        "id": 541155698,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758697326
    },
    {
        "content": "<p>Read your comments now. I don't disagree with what you're saying but happy I think it probably can be addressed in a future PR. The need for isChain_cons* was that I was worrying I'd been too overzealous in regressing previous lemmas and I had a couple places in Mathlib where it was easier to just drop that in. But it ought to be fixable.</p>",
        "id": 541155900,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758697415
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"873547\">Robin Arnez</span> <a href=\"#narrow/channel/348111-batteries/topic/Chain.20and.20Chain'.20and.20Pairwise/near/541155456\">said</a>:</p>\n<blockquote>\n<p>I've opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/29928\">#29928</a> now</p>\n</blockquote>\n<p>Unfortunately there are significant conflicts with <code>master</code>.</p>",
        "id": 541157171,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1758697895
    },
    {
        "content": "<p>Oh dear.</p>",
        "id": 541157297,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758697935
    },
    {
        "content": "<p>I see the build is failing as well, even after all the work in <a href=\"https://github.com/leanprover-community/mathlib4-nightly-testing/pull/70\">mathlib4-nightly-testing#70</a>?</p>",
        "id": 541157584,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758698052
    },
    {
        "content": "<p>Assuming <a href=\"https://github.com/leanprover-community/mathlib4/pull/29928\">#29928</a> brings that over.</p>",
        "id": 541157712,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758698106
    },
    {
        "content": "<p>I'm not sure I'll be able to contribute to this either as I don't think I have permissions to push to someone else's PR.</p>",
        "id": 541157772,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758698134
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"330967\">Wrenna Robson</span> <a href=\"#narrow/channel/348111-batteries/topic/Chain.20and.20Chain'.20and.20Pairwise/near/541155268\">said</a>:</p>\n<blockquote>\n<p>There was some confusion about whether it needs to be a Mathlib PR or a Mathlib Nightly PR.</p>\n</blockquote>\n<p>It needs to be a PR against Mathlib <code>master</code>. The branch lives on the mathlib4-nightly-testing fork for convenience (we don't give out write access to the main repo, but it's helpful if Batteries contributors can be given access to these branches).</p>",
        "id": 541157854,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1758698171
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"330967\">Wrenna Robson</span> <a href=\"#narrow/channel/348111-batteries/topic/Chain.20and.20Chain'.20and.20Pairwise/near/541157772\">said</a>:</p>\n<blockquote>\n<p>I'm not sure I'll be able to contribute to this either as I don't think I have permissions to push to someone else's PR.</p>\n</blockquote>\n<p>You can make a PR to the PR.</p>",
        "id": 541157897,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1758698189
    },
    {
        "content": "<p>Thanks Kim - that was what I originally started with :S</p>",
        "id": 541158024,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758698234
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/29928\">#29928</a> is made directly from the batteries-pr-testing-1421 branch. So you just need to keep pushing to that!</p>",
        "id": 541158035,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1758698237
    },
    {
        "content": "<p>(which I think you already have permission to do, right?)</p>",
        "id": 541158093,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1758698256
    },
    {
        "content": "<p>I think so. I have been pushing to a branch on my fork I think?</p>",
        "id": 541158134,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758698274
    },
    {
        "content": "<p>This is all slightly beyond what I've done with Git before because I'm juggling like three remotes. So it's very possible I've misconfigured something.</p>",
        "id": 541158269,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758698320
    },
    {
        "content": "<p>I'm still on the way into work but I'll look at this ASAP.</p>",
        "id": 541158397,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758698369
    },
    {
        "content": "<p>That'll be on my work computer though which I wasn't on before, so I guess I'll have to set it up. A guide would be somewhat useful.</p>",
        "id": 541158758,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758698494
    },
    {
        "content": "<p>Set it up for working on this branch I mean.</p>",
        "id": 541158791,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758698508
    },
    {
        "content": "<p>Fixed the merge conflicts and updated to the right batteries revision, so let's see how the build goes</p>",
        "id": 541159362,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758698698
    },
    {
        "content": "<p>Aha</p>",
        "id": 541159643,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758698793
    },
    {
        "content": "<p>We are looking good!</p>",
        "id": 541175498,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758703865
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> That process makes sense but it's very different from what we used to do!</p>\n<p>I merged Wrenna's PR into batteries-pr-testing-1421 and then I merged the PR into Batteries right after  the CI passed at timestamp 2025-09-23 14:16:45. How did CI on batteries-pr-testing-1421 fail <em>after</em> that?</p>\n<p>PS: Robin's last comments were posted in the split second between the time I checked that batteries-pr-testing-1421 passed CI and pressed the button to put the PR in the merge queue. What luck!</p>",
        "id": 541177973,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1758704619
    },
    {
        "content": "<p>I think because it wasn't fully merged into master and that broke things - as far as I can tell fixing the merge conflicts appears to have made things fine.</p>",
        "id": 541178154,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758704674
    },
    {
        "content": "<p>My experience of this was that contributing to batteries is relatively user-friendly but specifically adapting Mathlib is a somewhat trickier process. But I suspect there's some easy wins in terms of making the process clear and consistent! :)</p>",
        "id": 541178334,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758704733
    },
    {
        "content": "<p>You're one of the first outside PRs we've had that needed significant Mathlib adaptation since Mathlib switched to using forks. So you're unfortunately the guinea pig for that new process.</p>",
        "id": 541178846,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1758704882
    },
    {
        "content": "<p>I am chill and happy. These things take time and everyone is patient for the most part.</p>",
        "id": 541179055,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758704957
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/29928\">#29928</a> looks good to go incidentally from my eye.</p>",
        "id": 541179304,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758705030
    },
    {
        "content": "<p>I made minor edits to the Mathlib adaptation process: <a href=\"https://github.com/leanprover-community/batteries/pull/1428\">batteries#1428</a></p>",
        "id": 541198947,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1758711258
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/29928\">#29928</a> looks like it still needs a few more fixes, but I'm happy to merge once it's green.</p>",
        "id": 541220013,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1758717968
    },
    {
        "content": "<p>Yes, it looks like Rob has been improving my adapation (which makes sense, I was just trying to get it working without too much concern for doing so in the best way).</p>",
        "id": 541221889,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758718444
    },
    {
        "content": "<p>Incidentally, <span class=\"user-mention\" data-user-id=\"873547\">@Robin Arnez</span> IDK what you think, but at some point after this as a Mathlib PR I think we should kill off <code>destutter'</code> and integrate it into <code>destutter</code> in pretty much exactly the same way.</p>",
        "id": 541222452,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758718592
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/--</span>\n<span class=\"sd\">A recursion principle for lists which separates the singleton case.</span>\n<span class=\"sd\">-/</span>\n<span class=\"kd\">@[</span><span class=\"n\">elab_as_elim</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">twoStepInduction</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nil</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"o\">[])</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">singleton</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">x</span><span class=\"o\">])</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">cons_cons</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">nil</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">l</span>\n<span class=\"w\">  </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">singleton</span><span class=\"w\"> </span><span class=\"n\">y</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"n\">cons_cons</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">twoStepInduction</span><span class=\"w\"> </span><span class=\"n\">nil</span><span class=\"w\"> </span><span class=\"n\">singleton</span><span class=\"w\"> </span><span class=\"n\">cons_cons</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Also: is this a better implementation of <code>twoStepInduction</code>? I am wondering in particular for defining stuff, analogous to your approach for the decidable instance.</p>",
        "id": 541227242,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758719850
    },
    {
        "content": "<p>Why did you introduce <code>IsChain.concat_induction</code>?</p>",
        "id": 541243092,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758723835
    },
    {
        "content": "<p>I think it may have been an overabundance of enthusiasm.</p>",
        "id": 541243213,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758723864
    },
    {
        "content": "<p>Heh I guess you wanted symmetry for <code>backwards_cons_induction</code> and <code>cons_induction</code></p>",
        "id": 541243511,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758723932
    },
    {
        "content": "<p>I'll remove them for now</p>",
        "id": 541243610,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758723957
    },
    {
        "content": "<p>Actually, I don't quite know what to do with this situation... I guess we can keep them? idk</p>",
        "id": 541248740,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758725309
    },
    {
        "content": "<p>Oh! Yes that is what it was.</p>",
        "id": 541253508,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758726425
    },
    {
        "content": "<p>Putting aside the annoying fact that <code>concat</code> does not refer to <code>List.concat</code>, because the standard spelling is <code>l ++ [a]</code>...</p>",
        "id": 541253624,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758726454
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"330967\">Wrenna Robson</span> <a href=\"#narrow/channel/348111-batteries/topic/Chain.20and.20Chain'.20and.20Pairwise/near/541227242\">said</a>:</p>\n<blockquote>\n<p>Also: is this a better implementation of <code>twoStepInduction</code>? I am wondering in particular for defining stuff, analogous to your approach for the decidable instance.</p>\n</blockquote>",
        "id": 541254024,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758726556
    },
    {
        "content": "<p>Any thoughts on this?</p>",
        "id": 541254047,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758726562
    },
    {
        "content": "<p>I guess if you would use this to write definitions, it would be a bit faster; but I feel like it would be over-kill to care about these details -- I wouldn't expect people to define functions through such a function usually anyway.</p>",
        "id": 541260539,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758728079
    },
    {
        "content": "<p>I do this &lt;_&lt; - but perhaps it is a bad habit.</p>",
        "id": 541262853,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758728501
    },
    {
        "content": "<p>Can you give an example?</p>",
        "id": 541263014,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758728534
    },
    {
        "content": "<p>Something like:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">instDecidableIsChain</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DecidableRel</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"bp\">.</span><span class=\"n\">IsChain</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"bp\">.</span><span class=\"n\">twoStepInduction</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">nil</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">singleton</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">rec</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">haveI</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">rec</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">decidable_of_iff'</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">isChain_cons_cons</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 541267385,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758729576
    },
    {
        "content": "<p>Let's use this thread to collect any further cleanup that is needed:</p>",
        "id": 541393454,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758787486
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Acc.list_chain%27#doc\">docs#Acc.list_chain'</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=WellFounded.list_chain#doc\">docs#WellFounded.list_chain</a> look like they could do with name changes?</p>",
        "id": 541393539,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758787508
    },
    {
        "content": "<p>Not sure if we introduced this but: \"This file provides basic results about List.IsChain from betteries.\" -&gt; batteries</p>",
        "id": 541393723,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758787569
    },
    {
        "content": "<p>Also I just started this thread which is outside the scope of this discussion but is related.</p>",
        "id": 541400558,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758789476
    },
    {
        "content": "<p><a class=\"message-link\" href=\"/#narrow/channel/287929-mathlib4/topic/The.20Sorted.20predicate.2E/near/541400462\">#mathlib4 &gt; The Sorted predicate. @ 💬</a></p>",
        "id": 541400636,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1758789495
    }
]