[
    {
        "content": "<p>I would not have merged <a href=\"https://github.com/leanprover-community/batteries/pull/1234\">batteries#1234</a>, <span class=\"user-mention\" data-user-id=\"119741\">@FranÃ§ois G. Dorais</span> . I mean, I understand it is my own fault for not deprecating <code>Vector.tail</code> already, but it seems the obvious conclusion to \"what should I do about Vector.tail not having API\" should be to complain that it's pointless API surface area that should be removed.</p>\n<p>While I'm at it, it was merged with terminal <code>simp only [...]</code>s that should have just been <code>simp [...]</code>, which promptly <a href=\"#narrow/channel/428973-nightly-testing/topic/Batteries.20status.20updates/near/519852535\">broke</a> on nightly-testing --- this is why we prefer to avoid terminal <code>simp only</code>, because they are fragile!</p>\n<p><a href=\"https://github.com/leanprover/lean4/pull/8445\">lean#8445</a> adds the simp lemma converting <code>Vector.tail</code> into <code>Vector.extract</code> (analogous to the existing lemmas for take and drop). Hopefully the simpNF linter will complain on the next Batteries nightly.</p>",
        "id": 519933265,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1747954844
    },
    {
        "content": "<p>A recent relevant discussion (about <code>cons</code> not <code>tail</code> but the idea is similar): <a class=\"message-link\" href=\"/#narrow/channel/287929-mathlib4/topic/.E2.9C.94.20List.2EVector.20-.20could.20we.20just.20remove.20it.3F/near/519397908\">#mathlib4 &gt; âœ” List.Vector - could we just remove it? @ ðŸ’¬</a></p>",
        "id": 519934299,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1747955596
    },
    {
        "content": "<p>I think for simp purposes <code>extract</code> is not better than <code>tail</code>, since the latter has a better defeq than <code>extract</code> could ever have</p>",
        "id": 519934404,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1747955665
    },
    {
        "content": "<blockquote>\n<p>but it seems the obvious conclusion to \"what should I do about Vector.tail not having API\" should be to complain that it's pointless API surface area that should be removed.</p>\n</blockquote>\n<p>Also I really don't agree with this kind of argument. Maybe the functions exist because they are useful? Not having lemmas says only that they haven't been a priority for the FRO</p>",
        "id": 519934546,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1747955799
    },
    {
        "content": "<p>I consider <a href=\"https://github.com/leanprover/lean4/pull/8445\">lean#8445</a> actively harmful, and would prefer you just removed the operation from lean core and put it in batteries</p>",
        "id": 519934674,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1747955918
    },
    {
        "content": "<p>actually <code>extract</code> looks like the worst of all of these operations in terms of its signature. It has optional arguments that will make rewrites painful, and a messy type which requires casts. The <code>take</code> and <code>drop</code> simp lemmas should not be simp lemmas, they should all just be simp normal</p>",
        "id": 519935017,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1747956163
    },
    {
        "content": "<p>in particular, <code>(v.take n).toList = v.toList.take n</code> should be a simp lemma and the <code>take_eq_extract</code> lemma will surely leave the LHS here in a mess</p>",
        "id": 519935082,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1747956229
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/348111-batteries/topic/feat.3A.20add.20Vector.2Etail.20API.20batteries.231234/near/519933265\">said</a>:</p>\n<blockquote>\n<p>While I'm at it, it was merged with terminal <code>simp only [...]</code>s that should have just been <code>simp [...]</code>, which promptly <a href=\"#narrow/channel/428973-nightly-testing/topic/Batteries.20status.20updates/near/519852535\">broke</a> on nightly-testing --- this is why we prefer to avoid terminal <code>simp only</code>, because they are fragile!</p>\n</blockquote>\n<p>What broke exactly? <a href=\"https://github.com/leanprover-community/batteries/commit/6ebce3f4cd95c7c5b8002177d2223093dc29a263\">It's</a> a short <code>simp only</code> containing only a few lemmas, did the statements of these lemmas change?</p>",
        "id": 519936420,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1747957143
    },
    {
        "content": "<p>The issue seems to be that on current batteries main, <code>{ toArray := #[], size_toArray := â‹¯ }.toList</code> is reduced to <code>[]</code> by <code>simp only</code> (no lemmas), while on the nightly-testing version it is not reduced but there is a <code>toList_mk</code> simp lemma. What changed?</p>",
        "id": 519937240,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1747957759
    },
    {
        "content": "<p>This makes some sense since it's pure constructor reasoning. Is the flag of <code>simp</code> for doing constructor reduction no longer enabled by default?</p>",
        "id": 519937400,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1747957867
    },
    {
        "content": "<p>The reason for the discrepancy is not a change to <code>simp</code>, but a change in the statements of some theorems, because <code>.toList</code> here changed from being syntax sugar for <code>.toArray.toList</code> (which displayed as <code>.toList</code> because it was a stack of parent projections) to being an actual function <code>Vector.toList</code>, which needs unfolding and is not unfolded by <code>simp only</code>. (Maybe it should be an <code>abbrev</code>...)</p>",
        "id": 519937896,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1747958237
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/348111-batteries/topic/feat.3A.20add.20Vector.2Etail.20API.20batteries.231234/near/519933265\">said</a>:</p>\n<blockquote>\n<p>I would not have merged <a href=\"https://github.com/leanprover-community/batteries/pull/1234\">batteries#1234</a>, @FranÃ§ois G. Dorais . I mean, I understand it is my own fault for not deprecating <code>Vector.tail</code> already, but it seems the obvious conclusion to \"what should I do about Vector.tail not having API\" should be to complain that it's pointless API surface area that should be removed.</p>\n</blockquote>\n<p>I see that Mario said much of this in his own words...</p>\n<p>That was exactly my first thought about <a href=\"https://github.com/leanprover-community/batteries/pull/1234\">batteries#1234</a>. However, I changed my mind after realizing that the alternatives <code>Vector.eraseIdx</code> and <code>Vector.extract</code> both have unnecessarily complex API and a simpler API for <code>Vector.tail</code> makes sense in Batteries.</p>\n<p>I was actually surprised that <code>Vector.tail</code> was in core at all since <code>Array.tail</code> does not exist. I imagined that this was an oversight and it would soon disappear from core and we could add it to Batteries (along with <code>Array.tail</code>) instead.</p>\n<p>Is there a reason to keep <code>Vector.tail</code> in core?</p>",
        "id": 519968222,
        "sender_full_name": "FranÃ§ois G. Dorais",
        "timestamp": 1747976620
    },
    {
        "content": "<p>Consulting internally about whether we want to keep Vector.tail/take/drop as is, or deprecate/move downstream. I'll reply here when ready.</p>",
        "id": 520143856,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1748044430
    }
]