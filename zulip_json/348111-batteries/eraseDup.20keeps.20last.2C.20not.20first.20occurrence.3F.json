[
    {
        "content": "<p>The documentation says that <code>eraseDup l</code> removes duplicates from <code>l</code> (taking only the <strong>first</strong> occurrence). (emphasis mine)</p>\n<p>I think it should say the <strong>last</strong> there, if the example below is correct?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">eraseDup</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"c1\">-- [0, 2, 1]</span>\n\n<span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">eraseDup</span><span class=\"w\"> </span><span class=\"c1\">-- List.pwFilter (· ≠ ·)</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">pwFilter</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"c1\">-- [0, 2, 1]</span>\n\n<span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">pwFilter</span><span class=\"w\"> </span><span class=\"c1\">-- List.foldr (fun x IH =&gt; if ∀ (y : α), y ∈ IH → R x y then x :: IH else IH) [] l</span>\n\n<span class=\"c1\">-- Silly example to check what happens.</span>\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">MagicStuff</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">MagicStuff</span>\n<span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">Repr</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BEq</span><span class=\"w\"> </span><span class=\"n\">MagicStuff</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"bp\">_⟩</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">y</span><span class=\"o\">,</span><span class=\"bp\">_⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">magicList</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">MagicStuff</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">1</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"mi\">1</span><span class=\"bp\">⟩</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">1</span><span class=\"bp\">⟩</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">2</span><span class=\"bp\">⟩</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">2</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">]</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">eraseDup</span><span class=\"w\"> </span><span class=\"n\">magicList</span><span class=\"w\"> </span><span class=\"c1\">-- [MagicStuff.mk 0 1, MagicStuff.mk 2 2, MagicStuff.mk 1 2]</span>\n<span class=\"c1\">-- The `2`s here mean that eraseDup keeps the **last** occurrence, right?</span>\n</code></pre></div>",
        "id": 480723737,
        "sender_full_name": "Malvin Gattinger",
        "timestamp": 1730814169
    },
    {
        "content": "<p>Yes, you're right. A documentation fix would be welcome, but perhaps we can leave to <span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> what they think should be done regarding possibly changing the definitions.</p>",
        "id": 480803866,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1730842599
    },
    {
        "content": "<p>I think a documentation fix would be the easiest thing, these definitions are used not insignificantly for setting up finsets</p>",
        "id": 480806538,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730843903
    },
    {
        "content": "<p>I wrote the docstrings exactly because I would always get mixed up about these kind of details</p>",
        "id": 480806602,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730843936
    },
    {
        "content": "<p>I guess it is the first, working from right-to-left <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 480806700,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730843999
    },
    {
        "content": "<p>The thing is that <code>foldr</code> has better basic equations for find-like purposes.</p>",
        "id": 481423980,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1731123929
    },
    {
        "content": "<p>I just realised that there is also <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.eraseDups#doc\">docs#List.eraseDups</a> (with <code>s</code>) in <code>Init.Data.List.Basic</code> which indeed does keep the first occurrence.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- Silly example to check what happens.</span>\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">MagicStuff</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">MagicStuff</span>\n<span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">Repr</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BEq</span><span class=\"w\"> </span><span class=\"n\">MagicStuff</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"bp\">_⟩</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">y</span><span class=\"o\">,</span><span class=\"bp\">_⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">⟩</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">magicList</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">MagicStuff</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">1</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"mi\">1</span><span class=\"bp\">⟩</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">1</span><span class=\"bp\">⟩</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">2</span><span class=\"bp\">⟩</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">2</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">]</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">eraseDups</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"c1\">-- [1, 0, 2]</span>\n\n<span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">eraseDups</span><span class=\"w\"> </span><span class=\"c1\">-- List.eraseDups.loop as []</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">eraseDups</span><span class=\"w\"> </span><span class=\"n\">magicList</span><span class=\"w\"> </span><span class=\"c1\">-- [MagicStuff.mk 1 1, MagicStuff.mk 0 1, MagicStuff.mk 2 1]</span>\n</code></pre></div>\n<p>So maybe <code>eraseDup</code> should just be removed?</p>",
        "id": 481714766,
        "sender_full_name": "Malvin Gattinger",
        "timestamp": 1731329768
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/348111-batteries/topic/eraseDup.20keeps.20last.2C.20not.20first.20occurrence.3F/near/480806538\">said</a>:</p>\n<blockquote>\n<p>I think a documentation fix would be the easiest thing, these definitions are used not insignificantly for setting up finsets</p>\n</blockquote>\n<p>I tried to find uses of <code>eraseDup</code> and <code>eraseDups</code> elswhere in batteries and mathlib, but could not find many, and in particular not in the Finset files. And what I did find seems to use the function with <code>s</code> already anyway.</p>",
        "id": 481715324,
        "sender_full_name": "Malvin Gattinger",
        "timestamp": 1731329919
    },
    {
        "content": "<p>I'm not certain here. <code>eraseDups</code> (from Lean) is simpler, and more intuitively keeps the first occurrence. However <code>eraseDup</code> (from Batteries) is built on top of <code>pwFilter</code>, so in the long run there will be a better verification story (because it is connected to other things, and some lemmas can be shared).</p>",
        "id": 481852375,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731379784
    },
    {
        "content": "<p>Ideally we could sensibly change the definition of <code>pwFilter</code>, so <code>eraseDup</code> did in fact keep the first occurrence, and then eventually replace <code>eraseDups</code> with <code>eraseDup</code>.</p>",
        "id": 481852458,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731379816
    },
    {
        "content": "<p>Writing theory for <code>eraseDups</code> is not high on my priorities right now, but I'll eventually get there. If <code>eraseDup</code> can be fixed up in the meantime, that would be great.</p>",
        "id": 481852515,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731379853
    },
    {
        "content": "<p>Also as <span class=\"user-mention\" data-user-id=\"119741\">@François G. Dorais</span> said, <code>eraseDup</code>, being built on a right fold, has nicer equations for rewriting. Since the ordering is actually visible here it's not like we can prove right-fold lemmas for <code>eraseDups</code> either.</p>",
        "id": 481874671,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1731393830
    },
    {
        "content": "<p>However the names are obviously bad</p>",
        "id": 481874770,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1731393862
    },
    {
        "content": "<p>I think if you had a free choice of these two and didn't care whether the first or last duplicate was kept, and were in a proof context, you would prefer <code>eraseDup</code> and <code>pwFilter</code>. There are no similarly nice equations for a <code>pwFilter'</code> which takes the left-most occurrence other than either reversing the list first or having an accumulator.</p>",
        "id": 481875259,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1731394083
    }
]