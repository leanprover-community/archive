[
    {
        "content": "<p>I was perhaps slightly hasty in merging <a href=\"https://github.com/leanprover-community/batteries/pull/895\">batteries#895</a>, which I see now as I'm repairing it on <code>nightly-testing</code> has a number of proofs that have multiple goals that are not managed using focus notation, e.g. at <a href=\"https://github.com/leanprover-community/batteries/pull/895/files#diff-7f6f2022caefd253ab58d36270f54286b95fdf21e1e8199626ab9f22f3d1e5efR190\">https://github.com/leanprover-community/batteries/pull/895/files#diff-7f6f2022caefd253ab58d36270f54286b95fdf21e1e8199626ab9f22f3d1e5efR190</a></p>\n<ol>\n<li>I presume we agree this isn't great style and should be avoided where possible.</li>\n<li>Does Mathlib have a linter for it? Can we have it?</li>\n</ol>",
        "id": 473652041,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1727686811
    },
    {
        "content": "<p>The linter is written, and  <span class=\"user-mention\" data-user-id=\"634338\">@Michael Rothgang</span>  has been helping to push it through, but there are a huge number of exceptions.</p>",
        "id": 473653307,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727687031
    },
    {
        "content": "<p>Btw, Michael is not subscribed to this channel, so he won't feel summoned.</p>",
        "id": 473653432,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727687053
    },
    {
        "content": "<p>It is called the multiGoals linter but I'm on mobile and can't give you the PR number.</p>",
        "id": 473653613,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727687102
    },
    {
        "content": "<p>Actually, <a href=\"https://github.com/leanprover-community/mathlib4/pull/12339\">#12339</a> may be it</p>",
        "id": 473654693,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727687352
    },
    {
        "content": "<p>The linter only checks for missing focusing dots, not for unnecessary ones.</p>",
        "id": 473655210,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727687470
    },
    {
        "content": "<p>There is a PR with an extension to the linter that does that, but since progress on the initial multiGoal linter was slow, I left it dormant.</p>",
        "id": 473655444,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727687523
    },
    {
        "content": "<p>Thanks for the update. No urgency on this, mostly this gets caught in review (and in this case I was the reviewer so I'm not blaming anyone! :-)</p>",
        "id": 473661791,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1727688493
    },
    {
        "content": "<p>Agreed we should enable and enforce this on batteries</p>",
        "id": 473669302,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727690271
    },
    {
        "content": "<p>As far as testing goes, I was quite pleased with how the linter worked on Mathlib.  If you want to try it out on batteries, at least to add some focusing dots, it should be pretty smooth sailing.</p>",
        "id": 473703705,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727697343
    },
    {
        "content": "<p>I forget exactly what happens, but I seem to recall that if you blindly add a focusing dot on the first line flagged by the linter and indent all the lines flagged by the linter, it should magically work.</p>",
        "id": 473704082,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727697388
    },
    {
        "content": "<p>(Recursively, sometimes.)</p>",
        "id": 473704158,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727697399
    },
    {
        "content": "<p>The intention was to make it as self-correcting as possible.  I was going to plug it into a \"refactor\"-like step, but that is on hold for both the linter and refactor!  <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 473705542,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727697606
    },
    {
        "content": "<p>I'm giving the PR another push, but splitting out the focusing dots into 3 smaller PRs: <a href=\"https://github.com/leanprover-community/mathlib4/pull/17313\">#17313</a>, <a href=\"https://github.com/leanprover-community/mathlib4/pull/17314\">#17314</a>, <a href=\"https://github.com/leanprover-community/mathlib4/pull/17315\">#17315</a>.  I'm mentioning it here, in case someone might be interested in reviewing... <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 473883111,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727738454
    },
    {
        "content": "<p>Left comments on all of them. I find the <code>on_goal</code>s confusing.</p>",
        "id": 473893254,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1727742401
    },
    {
        "content": "<p>I removed most of the <code>on_goal</code>s: their use, in the context of the linter, is usually to maintain a proof where a tactic generates multiple goals, you massage the first goal a bit, and then you discharge all goals (the massaged one and the remaining ones) with <code>all_goals</code> or something similar.</p>",
        "id": 473898314,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727743962
    },
    {
        "content": "<p>There was discussion about making this proof startegy (delaying side-goals until something has happened), and a couple of prototypes, but nothing concrete.</p>\n<p>So, I resorted to using <code>on_goal</code>s, to not drag the process further.</p>",
        "id": 473898463,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727744031
    },
    {
        "content": "<p>For reference, <a href=\"#narrow/stream/287929-mathlib4/topic/.60on_sides.60.20tactic\">this conversation</a> (and the one linked from there) was the discussion about the side-goals.</p>",
        "id": 473899067,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727744290
    }
]