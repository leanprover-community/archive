[
    {
        "content": "<p>After an upgrade to 4.18.0-rc1, I'm getting this warning:</p>\n<div class=\"codehilite\" data-code-language=\"EmacsLisp\"><pre><span></span><code><span class=\"nv\">Warning</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"nv\">lsp-mode</span><span class=\"p\">)</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"nv\">Unknown</span><span class=\"w\"> </span><span class=\"nv\">request</span><span class=\"w\"> </span><span class=\"nv\">method:</span><span class=\"w\"> </span><span class=\"nv\">workspace/inlayHint/refresh</span>\n</code></pre></div>\n<p>Did something change in the Lean lsp server implementation?</p>",
        "id": 503129948,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1741038379
    },
    {
        "content": "<p>Yes, Marc worked a lot on inlay hints.</p>",
        "id": 503130407,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1741038558
    },
    {
        "content": "<p>This mean some extra text displayed by the editor which is not in your source code.</p>",
        "id": 503130570,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1741038624
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/7112\">https://github.com/leanprover/lean4/pull/7112</a></p>",
        "id": 503130629,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1741038650
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/6768\">https://github.com/leanprover/lean4/pull/6768</a> has some screenshot</p>",
        "id": 503130701,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1741038683
    },
    {
        "content": "<p>The very light gray stuff in <br>\n<a href=\"/user_uploads/3121/RhNeWxjXFBPOGpbRmVd6G-um/image.png\">image.png</a><br>\nis not part of the file, itâ€™s added by the editor.</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/RhNeWxjXFBPOGpbRmVd6G-um/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"448x276\" src=\"/user_uploads/thumbnail/3121/RhNeWxjXFBPOGpbRmVd6G-um/image.png/840x560.webp\"></a></div>",
        "id": 503130834,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1741038734
    },
    {
        "content": "<p>those are auto-implicit types.</p>",
        "id": 503130878,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1741038754
    },
    {
        "content": "<p>Thank you! I'll see if Emacs lsp supports them. For now, I'll just ignore the warning.</p>",
        "id": 503131007,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1741038807
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"779400\">@Mekeor Melire</span> Do you know anything about this?</p>",
        "id": 503131238,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1741038885
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">(</span><span class=\"n\">setq</span><span class=\"w\"> </span><span class=\"n\">lsp</span><span class=\"bp\">-</span><span class=\"n\">inlay</span><span class=\"bp\">-</span><span class=\"n\">hint</span><span class=\"bp\">-</span><span class=\"n\">enable</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">lsp</span><span class=\"bp\">-</span><span class=\"n\">inlay</span><span class=\"bp\">-</span><span class=\"n\">hints</span><span class=\"bp\">-</span><span class=\"n\">mode</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 503274005,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1741096659
    },
    {
        "content": "<p>I tried this, and I'm still getting the warnings.</p>",
        "id": 503325346,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1741109594
    },
    {
        "content": "<p>What's your lsp-mode package version? I can see the inlay hints here.</p>",
        "id": 503366149,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1741123142
    },
    {
        "content": "<p>9.0.1</p>",
        "id": 503371635,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1741125166
    },
    {
        "content": "<p>Right, I see the same thing as well when opening Mathlib/Control/Random.lean. lsp-mode contains this line:</p>\n<div class=\"codehilite\" data-code-language=\"EmacsLisp\"><pre><span></span><code><span class=\"o\">,@</span><span class=\"p\">(</span><span class=\"nb\">when</span><span class=\"w\"> </span><span class=\"nv\">lsp-inlay-hint-enable</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"p\">((</span><span class=\"nv\">inlayHint</span><span class=\"w\"> </span><span class=\"o\">.</span><span class=\"w\"> </span><span class=\"p\">((</span><span class=\"nv\">refreshSupport</span><span class=\"w\"> </span><span class=\"o\">.</span><span class=\"w\"> </span><span class=\"nb\">:json-false</span><span class=\"p\">)))))</span>\n</code></pre></div>\n<p>which indicates the server shouldn't be sending refresh requests in the first place (and inlay hints work without them). cc <span class=\"user-mention\" data-user-id=\"221921\">@Marc Huisinga</span></p>",
        "id": 503740010,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1741252437
    },
    {
        "content": "<p>Feel free to open a bug report about this in the Lean 4 repository. Note that without support for refresh requests, inlay hints cannot ever become a usable feature in any editor that lacks them. <br>\nCurrently, we don't really implement any support for client capabilities at all; either the client supports the features that are provided by the Lean language server with its various extensions and LSP spec violations that are necessary for interactive theorem proving, or it will be broken in various ways and (at best) only function correctly in some cases by accident.</p>\n<p>In general, my recommendation would be to switch to a plugin that is actually being maintained (like the NeoVim plugin) and hasn't been in a half-broken and unmaintained state for years. Alternatively, someone needs to step up to properly maintain the Emacs plugin and bring it into a mostly feature-complete and working state, after which I'll be happy to coordinate changes to the language server with the maintainer before a release, as we now do with NeoVim.</p>",
        "id": 503744691,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1741253668
    },
    {
        "content": "<p>Thanks for the information! I think it's fair to say no one will switch from Emacs to vim to get inlay hints, but I will file an issue in the lsp-mode repository now that I know that support for refresh requests is essential.</p>",
        "id": 503754572,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1741256459
    },
    {
        "content": "<p>Posted a comment on a preexisting issue (<a href=\"https://github.com/emacs-lsp/lsp-mode/issues/4230\">https://github.com/emacs-lsp/lsp-mode/issues/4230</a>), but that was filed for the semgrep LSP.  I will file a separate issue if I don't see activity after a few days.</p>",
        "id": 503758837,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1741257712
    },
    {
        "content": "<p>I opened an issue: <a href=\"https://github.com/leanprover/lean4/pull/7488\">lean4#7488</a></p>",
        "id": 505704093,
        "sender_full_name": "David Renshaw",
        "timestamp": 1741966183
    },
    {
        "content": "<blockquote>\n<p>in a half-broken and unmaintained state for years</p>\n</blockquote>\n<p>lean4-mode had been working well for me, until this warning started showing up.</p>",
        "id": 505704681,
        "sender_full_name": "David Renshaw",
        "timestamp": 1741966327
    },
    {
        "content": "<p>i'm kind of sad that emacs lean4-mode is in such a bad state.  i am also just sad that working with lean is almost only possible with vs code and nvim.  i am happy that there is at least one other editor than vs code.</p>",
        "id": 505710363,
        "sender_full_name": "Berber",
        "timestamp": 1741967792
    },
    {
        "content": "<p>As just an interested outsider I think Marc made it sound like above that all that's really needed is some more ownership over pushing the emacs plugin forward, no? I think <span class=\"user-mention\" data-user-id=\"214703\">@Yury G. Kudryashov</span> expressed similar sentiments before that he feels he's not quite an expert enough in emacs to own maintenance (apologies if I'm misremembering). It looks like there's 4 current open PRs, if it's helpful I'm happy to review some of them even myself if they're stuff I had to understand for the nvim plugin, though of course I'm not an emacs expert by any means, but it seems to me like a decent step is someone saying they want to own helping to review the open PRs and perhaps then that person or one or more people getting commit bit on the repo (or otherwise it living somewhere else if <code>leanprover-community</code> is less comfortable with giving that out).</p>",
        "id": 505712008,
        "sender_full_name": "Julian Berman",
        "timestamp": 1741968207
    },
    {
        "content": "<p>(None of which is to say that if it worked fine before and it's easy enough to do so that just disabling this warning might be a good short term thing -- though I think it sounded like the LSP doesn't really respect client capabilities at all at the minute so who knows how easy that is. Well. Marc is a who :)</p>",
        "id": 505712300,
        "sender_full_name": "Julian Berman",
        "timestamp": 1741968275
    },
    {
        "content": "<p>The above discussion makes it sound like this particular issue (lack of support for inlay refresh) is with upstream lsp-mode, not with lean4-mode.</p>",
        "id": 505714291,
        "sender_full_name": "David Renshaw",
        "timestamp": 1741968800
    },
    {
        "content": "<p>indeed, i also understand the problem as being with lsp-mode, not with lean4-mode.</p>\n<p>however, the fact that the last commit has been 3 months ago, and that its development seems scattered (with good efforts that i support, like making it work with eglot), does not look good.</p>",
        "id": 505715413,
        "sender_full_name": "Berber",
        "timestamp": 1741969101
    },
    {
        "content": "<p>My impression is that the community would welcome people who would like to make the Lean-in-emacs experience better. Whilst the majority of people here use VS Code, several power users are using nvim and certainly there have been power users using emacs in the past (and the existence of this channel is another indication that people are interested). Lean is rapidly-changing software and my understanding of the above discussion is that it is only recently that things got derailed a bit with recent changes to core Lean.</p>",
        "id": 505717186,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1741969566
    },
    {
        "content": "<p>Indeed, I don't have much time for Emacs lean4-mode. I'll do my best to go over the open PRs this weekend.</p>",
        "id": 505763261,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1741984797
    },
    {
        "content": "<p>AFAIR, at least one of the open PRs is a large refactor. I plan to cherry-pick some parts of it to the current <code>HEAD</code>, then decide what to do with non-bc changes.</p>",
        "id": 505763550,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1741984909
    },
    {
        "content": "<p>I'm working around this warning with</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">(</span><span class=\"n\">setq</span><span class=\"w\"> </span><span class=\"n\">warning</span><span class=\"bp\">-</span><span class=\"n\">minimum</span><span class=\"bp\">-</span><span class=\"n\">level</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"n\">error</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>(though that potentially disables other warnings as well).</p>",
        "id": 505793579,
        "sender_full_name": "Joseph Myers",
        "timestamp": 1742001715
    },
    {
        "content": "<p>Pressing Enter adds this to <code>custom-set-variables</code>:</p>\n<div class=\"codehilite\" data-code-language=\"EmacsLisp\"><pre><span></span><code><span class=\"o\">'</span><span class=\"p\">(</span><span class=\"nv\">warning-suppress-types</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"p\">((</span><span class=\"nv\">lsp-mode</span><span class=\"p\">)))</span>\n</code></pre></div>",
        "id": 505800376,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1742006558
    },
    {
        "content": "<p>6 messages were moved from this topic to <a class=\"stream-topic\" data-stream-id=\"468104\" href=\"/#narrow/channel/468104-Emacs/topic/Dev.3A.20Inlay.20Hint.20Refresh.20Request/with/513978783\">#Emacs &gt; Dev: Inlay Hint Refresh Request</a> by <span class=\"user-mention silent\" data-user-id=\"779400\">Mekeor Melire</span>.</p>",
        "id": 514213364,
        "sender_full_name": "Notification Bot",
        "timestamp": 1745522805
    },
    {
        "content": "<p>(Sorry for the noise, I had bad luck renaming this topic in Zulip. Further discussion will take place in <code>Dev: Inlay Hint Refresh Request</code> topic.)</p>",
        "id": 514213811,
        "sender_full_name": "Mekeor Melire",
        "timestamp": 1745522988
    },
    {
        "content": "<p>Just mentioning this workaround for those who don't know it (like me, until I happened to read <a href=\"https://github.com/leanprover/lean4/issues/7488#issuecomment-2725708538\">this comment</a> from <span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span>): by pressing Enter with point on the warning (on the button/emoji at the start of the warning for me), Emacs provides you with the option to ignore or hide it in future.</p>",
        "id": 525086063,
        "sender_full_name": "Raghuram",
        "timestamp": 1750443970
    }
]