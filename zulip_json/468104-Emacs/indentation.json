[
    {
        "content": "<p>Hi everyone, I'm new to lean. I installed the latest version of lean (Lean (version 4.20.0, x86_64-unknown-linux-gnu, commit b02228b03f65, Release), and setup lean4-mode as described in the installation instruction. I use lean with lsp-mode. Most things work well (type annotations, errors, etc.), but the indentation is broken. M-x indent-region simply removes all space from the beginning of the lines. Is it normal (i.e. unsupported) or a problem in my configuration ?<br>\nThank you for your help, and sorry if it is already answered somewhere</p>",
        "id": 523304505,
        "sender_full_name": "Clément Blaudeau",
        "timestamp": 1749565399
    },
    {
        "content": "<p>Not sure if we even have automatic indentation in vs code <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 523322361,
        "sender_full_name": "Malvin Gattinger",
        "timestamp": 1749570520
    },
    {
        "content": "<p><a href=\"https://github.com/Julian/lean.nvim/blob/main/lua/lean/indent.lua\">This</a> is what I implemented for lean.nvim for autoindent in case it's helpful for reference, with <a href=\"https://github.com/Julian/lean.nvim/blob/main/spec/indent_spec.lua\">test cases here</a>.</p>\n<p>It seems to work pretty well (in the sense that no one has complained to me about it!)</p>",
        "id": 523328961,
        "sender_full_name": "Julian Berman",
        "timestamp": 1749572643
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"422703\">Malvin Gattinger</span> <a href=\"#narrow/channel/468104-Emacs/topic/indentation/near/523322361\">said</a>:</p>\n<blockquote>\n<p>Not sure if we even have automatic indentation in vs code <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>\n</blockquote>\n<p>When you hit enter at the end of a line, what happens ? does the next line starts always start at column 0 ? You do all the indentation manually ?</p>",
        "id": 523517928,
        "sender_full_name": "Clément Blaudeau",
        "timestamp": 1749634122
    },
    {
        "content": "<p>Ah, no, in VS code I think it usually stays in the same indentation level as the line you were on before hitting enter. But besides that there is no \"smart\" indentation function I think, so nothing like what <code>Mx indent-region</code> does for me in a <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>LaTeX</mtext></mrow><annotation encoding=\"application/x-tex\">\\LaTeX</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8988em;vertical-align:-0.2155em;\"></span><span class=\"mord text\"><span class=\"mord textrm\">L</span><span class=\"mspace\" style=\"margin-right:-0.36em;\"></span><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6833em;\"><span style=\"top:-2.905em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"mord\"><span class=\"mord textrm mtight sizing reset-size6 size3\">A</span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:-0.15em;\"></span><span class=\"mord text\"><span class=\"mord textrm\">T</span><span class=\"mspace\" style=\"margin-right:-0.1667em;\"></span><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4678em;\"><span style=\"top:-2.7845em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord textrm\">E</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2155em;\"><span></span></span></span></span><span class=\"mspace\" style=\"margin-right:-0.125em;\"></span><span class=\"mord textrm\">X</span></span></span></span></span></span> document for example.</p>",
        "id": 523731004,
        "sender_full_name": "Malvin Gattinger",
        "timestamp": 1749725928
    },
    {
        "content": "<p>Do you have <code>haskell-mode</code> installed? You can try using <code>haskell-indent-mode</code>, which is a minor mode (I'm not sure if it conflicts with <code>lean4-indent.el</code>, though :/ )</p>",
        "id": 524488082,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1750176990
    },
    {
        "content": "<p><code>haskell-indent-mode</code> does not help (neither <code>electric-indent-mode</code>), each newline is still thrown at column 0... Could someone share a minimal emacs config where the indentation is, at least, the same as the previous line ? It has been the main roadblock for trying Lean so far for me</p>",
        "id": 526612656,
        "sender_full_name": "Clément Blaudeau",
        "timestamp": 1751377557
    },
    {
        "content": "<p>More investigation revealed that all the indent infrastructure <em>is</em> there in the lean4-mode (in <code>lean4-eri.el</code>), so the problem is more of getting it activated properly...</p>",
        "id": 526633201,
        "sender_full_name": "Clément Blaudeau",
        "timestamp": 1751383332
    },
    {
        "content": "<p>I am using doom emacs. For me, \"gg=G\" (or C-x h M-x indent-region) just flattens all the buffer, no indentation at all. but when \"o\" (or RET),  it continues from the indentation of the line RET is pressed. Thus, second RET continues at column 0, for example. I think this is very open to enhance.</p>\n<p>For example, I always keep pressing SPC two times after going to new line from a line starting with dot. Here, see the demo:<br>\n<a href=\"/user_uploads/3121/4E5BBrl74U_yWtYBaLuxtNMh/2025-07-05-11-29-47.mkv\">2025-07-05 11-29-47.mkv</a></p>",
        "id": 527264874,
        "sender_full_name": "Abdullah Uyu",
        "timestamp": 1751704786
    },
    {
        "content": "<p>I think for a line starting with a dot, the default indentation for the second line should be +2.</p>",
        "id": 527265048,
        "sender_full_name": "Abdullah Uyu",
        "timestamp": 1751704944
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"746143\">Clément Blaudeau</span> <a href=\"#narrow/channel/468104-Emacs/topic/indentation/near/526633201\">said</a>:</p>\n<blockquote>\n<p>More investigation revealed that all the indent infrastructure <em>is</em> there in the lean4-mode (in <code>lean4-eri.el</code>), so the problem is more of getting it activated properly...</p>\n</blockquote>\n<p>Hi-- It seems that I've just been putting up with the indentation behavior you describe (!) but spurred by your question I arrived at the following which is maybe the behavior you want? </p>\n<ul>\n<li>For lean4-mode, redefine the newline behavior to have new lines indented to <code>(current-indentation)</code> of the preceding line. In the code below, this is accomplished by defining <code>lean4-newline-and-indent</code> and having some code in the <code>lean4-mode-hook</code> assign this function to the return key.</li>\n<li>For good measure, I also set <code>&lt;backtab&gt;</code> (i.e. \"shift-tab\") to <code>lean4-eri-indent-reverse</code> so that you can easily back up indentation levels .</li>\n</ul>\n<p>Here is the code I (now) use to initialize <code>lean4-mode</code> in my emacs initialization:</p>\n<div class=\"codehilite\" data-code-language=\"EmacsLisp\"><pre><span></span><code><span class=\"p\">(</span><span class=\"nb\">use-package</span><span class=\"w\"> </span><span class=\"nv\">lean4-mode</span>\n<span class=\"w\">  </span><span class=\"nb\">:defer</span><span class=\"w\"> </span><span class=\"no\">t</span>\n<span class=\"w\">  </span><span class=\"nb\">:commands</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"nv\">lean4-mode</span><span class=\"p\">)</span>\n<span class=\"w\">  </span><span class=\"nb\">:vc</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"nb\">:url</span><span class=\"w\"> </span><span class=\"s\">\"https://github.com/leanprover-community/lean4-mode.git\"</span>\n<span class=\"w\">       </span><span class=\"nb\">:rev</span><span class=\"w\"> </span><span class=\"nb\">:last-release</span>\n<span class=\"w\">      </span><span class=\"p\">)</span>\n<span class=\"w\">  </span><span class=\"nb\">:config</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"nb\">defun</span><span class=\"w\"> </span><span class=\"nv\">lean4-newline-and-indent</span><span class=\"w\"> </span><span class=\"p\">()</span>\n<span class=\"w\">    </span><span class=\"s\">\"Insert a newline and indent according to the previous line.\"</span>\n<span class=\"w\">    </span><span class=\"p\">(</span><span class=\"k\">interactive</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"p\">(</span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"p\">((</span><span class=\"nv\">indentation</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"nf\">current-indentation</span><span class=\"p\">)))</span>\n<span class=\"w\">      </span><span class=\"p\">(</span><span class=\"nv\">newline</span><span class=\"p\">)</span>\n<span class=\"w\">      </span><span class=\"p\">(</span><span class=\"nv\">indent-line-to</span><span class=\"w\"> </span><span class=\"nv\">indentation</span><span class=\"p\">)))</span>\n\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"nv\">add-hook</span><span class=\"w\"> </span><span class=\"ss\">'lean4-mode-hook</span>\n<span class=\"w\">          </span><span class=\"p\">(</span><span class=\"nb\">lambda</span><span class=\"w\"> </span><span class=\"p\">()</span>\n<span class=\"w\">            </span><span class=\"p\">(</span><span class=\"nv\">local-set-key</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"nv\">kbd</span><span class=\"w\"> </span><span class=\"s\">\"RET\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"ss\">'lean4-newline-and-indent</span><span class=\"p\">)</span>\n<span class=\"w\">            </span><span class=\"p\">(</span><span class=\"nv\">local-set-key</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"nv\">kbd</span><span class=\"w\"> </span><span class=\"s\">\"&lt;backtab&gt;\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"ss\">'lean4-eri-indent-reverse</span><span class=\"p\">)))</span>\n<span class=\"w\">  </span><span class=\"nb\">:custom</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"nv\">lean4-keybinding-auto-complete</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"nv\">kbd</span><span class=\"w\"> </span><span class=\"s\">\"C-c C-SPC\"</span><span class=\"p\">)))</span>\n</code></pre></div>\n<p>(I think there is some way to give <code>use-package</code> a <code>:keys</code> argument which probably avoids some of the boilerplate in the <code>add-hook</code> call, but I was feeling lazy and didn't dig into it)</p>\n<p>best,<br>\nGeorge</p>",
        "id": 531146464,
        "sender_full_name": "George McNinch",
        "timestamp": 1753625250
    },
    {
        "content": "<p>Thank you ! I'll add it to my config and see how it feels over the coming Lean sessions</p>",
        "id": 537152499,
        "sender_full_name": "Clément Blaudeau",
        "timestamp": 1756749224
    }
]