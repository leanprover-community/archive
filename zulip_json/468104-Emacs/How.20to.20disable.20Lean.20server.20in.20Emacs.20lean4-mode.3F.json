[
    {
        "content": "<p>I mainly use VScode to edit Lean file and interact with Lean server.  But sometimes I also use Emacs, because the search-and-replace functionality in VScode is just too painful to use.  So I would like to use Emacs lean4-mode to edit Lean files without starting a Lean server.  How do I do that?</p>",
        "id": 574656096,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1771481726
    },
    {
        "content": "<p>I've used Emacs in the past to edit lean files when I want to use macros and have a more powerful editing experience. But because I mainly use VS Code I just deleted all lean-related things from my Emacs setup and so when I open a lean file my Emacs treats it like a text file. I can then hack away in Emacs whilst having the same file open in VS Code to view the changes with the server running.</p>",
        "id": 574666946,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1771488105
    },
    {
        "content": "<p>Thoughts from reading the source code; without having tested: I'd guess that what triggers lsp-mode is: <code>lean4-mode</code> then<code>lean4-mode-setup</code> then <code>lean4-create-lsp-workspace</code> then <code>lsp-workspace-folders-add</code>. You could thus for example define an advice overriding <code>lean4-create-lsp-workspace</code> like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">(</span><span class=\"n\">define</span><span class=\"bp\">-</span><span class=\"n\">advice</span><span class=\"w\"> </span><span class=\"n\">lean4</span><span class=\"bp\">-</span><span class=\"n\">create</span><span class=\"bp\">-</span><span class=\"n\">lsp</span><span class=\"bp\">-</span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"o\">(:</span><span class=\"n\">override</span><span class=\"w\"> </span><span class=\"o\">()))</span>\n</code></pre></div>\n<hr>\n<p>Beyond lean4-mode:</p>\n<p>As <span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> mentioned, you can also deinstall lean4-mode. Or use my fork <a href=\"https://codeberg.org/mekeor/nael\">Nael</a> which is carefully engineered to not depend on lsp-mode and to not even load any LSP client unless one is spawned. There's also <a href=\"https://github.com/lua-vr/lean-ts-mode/blob/main/lean-ts-mode.el\">lean-ts-mode</a> which seems to not start Eglot automatically.</p>",
        "id": 574675365,
        "sender_full_name": "Mekeor Melire",
        "timestamp": 1771491156
    },
    {
        "content": "<p>Thanks for the comments!  I found an easy solution: I just used Emacs's customization interface to set <code>lean4-executable-name</code> to \"nil\" for the current and future sessions.  (This will save the change in the <code>~/.emacs</code> file.)  Then Emacs will fail to launch Lean when I edit a Lean file.  This generates some error messages, which can be easily ignored by typing <code>^G</code>.</p>\n<p>I don't want to uninstall lean4-mode, because I still want all the syntax highlighting and the ability to type Lean's unicode characters via the standard key binding.</p>\n<p>BTW, I also use this VScode extension:<br>\n<a href=\"https://github.com/whitphx/vscode-emacs-mcx\">https://github.com/whitphx/vscode-emacs-mcx</a><br>\nThis makes the key bindings of VScode close to those of Emacs, even though there are still many situations where the two editors behaves differently.</p>",
        "id": 574787446,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1771522799
    },
    {
        "content": "<p>I find using emacs for lean more pleasant than vs code, probably because I am so embedded in emacs for everything else. With an lsp and the lean4 mode things work pretty smoothly for me. I think these are the sections from my init file that are relevant. Not much of a set up really:</p>\n<div class=\"codehilite\" data-code-language=\"EmacsLisp\"><pre><span></span><code><span class=\"p\">(</span><span class=\"nb\">use-package</span><span class=\"w\"> </span><span class=\"nv\">lsp-mode</span>\n<span class=\"w\">  </span><span class=\"nb\">:init</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">setq</span><span class=\"w\"> </span><span class=\"nv\">lsp-keymap-prefix</span><span class=\"w\"> </span><span class=\"s\">\"C-c s\"</span><span class=\"p\">)</span>\n<span class=\"w\">  </span><span class=\"nb\">:config</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"nb\">require</span><span class=\"w\"> </span><span class=\"ss\">'lsp-haskell</span><span class=\"p\">)</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"k\">setq</span><span class=\"w\"> </span><span class=\"nv\">lsp-rename-use-prepare</span><span class=\"w\"> </span><span class=\"no\">nil</span><span class=\"w\"> </span><span class=\"c1\">; temp fix for broken rename in haskell on emacs jan 18 2026</span>\n<span class=\"w\">    </span><span class=\"nv\">lsp-enable-snippet</span><span class=\"w\"> </span><span class=\"no\">t</span>\n<span class=\"w\">        </span><span class=\"nv\">lsp-enable-symbol-highlighting</span><span class=\"w\"> </span><span class=\"no\">t</span>\n<span class=\"w\">        </span><span class=\"nv\">lsp-enable-on-type-formatting</span><span class=\"w\"> </span><span class=\"no\">nil</span>\n<span class=\"w\">        </span><span class=\"nv\">lsp-headerline-breadcrumb-enable</span><span class=\"w\"> </span><span class=\"no\">t</span>\n<span class=\"w\">        </span><span class=\"nv\">lsp-modeline-code-actions-enable</span><span class=\"w\"> </span><span class=\"no\">t</span>\n<span class=\"w\">        </span><span class=\"nv\">lsp-modeline-diagnostics-enable</span><span class=\"w\"> </span><span class=\"no\">t</span>\n<span class=\"w\">        </span><span class=\"nv\">lsp-completion-provider</span><span class=\"w\"> </span><span class=\"nb\">:capf</span><span class=\"p\">))</span>\n\n<span class=\"p\">(</span><span class=\"nb\">use-package</span><span class=\"w\"> </span><span class=\"nv\">lsp-ui</span>\n<span class=\"w\">  </span><span class=\"nb\">:config</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">setq</span><span class=\"w\"> </span><span class=\"nv\">lsp-ui-doc-use-childframe</span><span class=\"w\"> </span><span class=\"no\">nil</span><span class=\"p\">)</span>\n<span class=\"w\">  </span><span class=\"p\">)</span>\n\n<span class=\"p\">(</span><span class=\"nb\">use-package</span><span class=\"w\"> </span><span class=\"nv\">lean4-mode</span>\n<span class=\"w\">  </span><span class=\"nb\">:commands</span><span class=\"w\"> </span><span class=\"nv\">lean4-mode</span>\n<span class=\"w\">  </span><span class=\"nb\">:vc</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"nb\">:url</span><span class=\"w\"> </span><span class=\"s\">\"https://github.com/leanprover-community/lean4-mode.git\"</span>\n<span class=\"w\">       </span><span class=\"nb\">:rev</span><span class=\"w\"> </span><span class=\"nb\">:last-release</span>\n<span class=\"w\">       </span><span class=\"p\">)</span>\n<span class=\"w\">  </span><span class=\"nb\">:hook</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"nv\">lean4-mode</span><span class=\"w\"> </span><span class=\"o\">.</span><span class=\"w\"> </span><span class=\"nv\">lsp</span><span class=\"p\">))</span>\n\n<span class=\"c1\">;; trying to get my path variables for this user emacs version</span>\n<span class=\"c1\">;; the same as the system environment</span>\n<span class=\"p\">(</span><span class=\"nb\">use-package</span><span class=\"w\"> </span><span class=\"nv\">exec-path-from-shell</span>\n<span class=\"w\">  </span><span class=\"p\">)</span>\n\n<span class=\"p\">(</span><span class=\"nv\">exec-path-from-shell-initialize</span><span class=\"p\">)</span>\n\n<span class=\"p\">(</span><span class=\"nb\">use-package</span><span class=\"w\"> </span><span class=\"nv\">dash</span>\n<span class=\"w\">  </span><span class=\"p\">)</span><span class=\"c1\">;;dependency for lean4-mode</span>\n\n<span class=\"c1\">;;for lsp to work I need to increase the gc-cons level. It is suggested to make</span>\n<span class=\"c1\">;; this a big number, and also I need the lean stuff on my emacs path,</span>\n<span class=\"c1\">;;which is not always the same as my system path. To be safe I am</span>\n<span class=\"c1\">;;adding it here</span>\n\n<span class=\"p\">(</span><span class=\"k\">setq</span><span class=\"w\"> </span><span class=\"nv\">gc-cons-threshold</span><span class=\"w\"> </span><span class=\"mi\">100000000</span><span class=\"p\">)</span>\n<span class=\"p\">(</span><span class=\"nv\">add-to-list</span><span class=\"w\"> </span><span class=\"ss\">'exec-path</span><span class=\"w\"> </span><span class=\"s\">\"/home/britt/.elan/bin\"</span><span class=\"p\">)</span>\n</code></pre></div>\n<p>Good luck.</p>",
        "id": 574887698,
        "sender_full_name": "Britt Anderson",
        "timestamp": 1771576139
    }
]