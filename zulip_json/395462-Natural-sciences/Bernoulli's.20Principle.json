[
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"417769\">Bulhwi Cha</span> <a href=\"#narrow/stream/395462-Natural-sciences/topic/wrong.20formalization.20of.20boyle's.20law.20in.20lean/near/373080345\">said</a>:</p>\n<blockquote>\n<p>I should also point out that <span class=\"user-mention silent\" data-user-id=\"587824\">David⚛️</span>'s <a href=\"#narrow/stream/113489-new-members/topic/.E2.9C.94.20D_W.20Equation/near/370533896\">formalization of the Darcy-Weisbach equation</a> has the same problem. Where's the definition of force? Premises like <code>h₃ : F = f₁ * P * L * U^2</code> are <em>not</em> definitions. These formalizations are all underspecifications!</p>\n<p><span class=\"user-mention silent\" data-user-id=\"346070\">Tomas Skrivan</span> <a href=\"#narrow/stream/113489-new-members/topic/.E2.9C.94.20D_W.20Equation/near/371749736\">said</a>:</p>\n<blockquote>\n<p>I'm looking forward to seeing a refactored version where it is clear what are the assumptions, definitions and empirical facts!<br>\n</p>\n</blockquote>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"346070\">@Tomas Skrivan</span> I also want to hear your thoughts on this matter.</p>",
        "id": 375073404,
        "sender_full_name": "Bulhwi Cha",
        "timestamp": 1689286494
    },
    {
        "content": "<p>I'm not entirely sure what to say as I didn't have time to fully understand the DW equation yet. </p>\n<p>However, Bernoulli principle can be formally derived for potential flow satisfying the Euler equation(Navier-Stokes with zero viscosity).</p>\n<p>Therefore anything using the Bernoulli principle should be framed in the context of potential flow and I do not see potential flow mentioned anywhere.</p>",
        "id": 375080461,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1689288897
    },
    {
        "content": "<p>Here is my sketch of formalizing Bernoulli's principle. I skipped proofs but I think that it should be fairly straightforward for someone familiar with relevant parts of mathlib.</p>",
        "id": 375326838,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1689352915
    },
    {
        "content": "<p><strong>edit</strong>: fixed <code>ℝ³</code> based on Eric's suggestion</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">Mathlib.Analysis.Calculus.FDeriv.Basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.Data.Real.Basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.Algebra.BigOperators.Basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.Analysis.InnerProductSpace.PiL2</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">BigOperators</span>\n\n<span class=\"kd\">notation</span> <span class=\"s2\">\" ℝ³ \"</span> <span class=\"bp\">=&gt;</span> <span class=\"n\">EuclideanSpace</span> <span class=\"n\">ℝ</span> <span class=\"o\">(</span><span class=\"n\">Fin</span> <span class=\"mi\">3</span><span class=\"o\">)</span>\n\n<span class=\"kd\">variable</span> <span class=\"o\">{</span><span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">_</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span> <span class=\"n\">X</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">NormedSpace</span> <span class=\"n\">ℝ</span> <span class=\"n\">X</span><span class=\"o\">]</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">basis</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">:</span> <span class=\"n\">Fin</span> <span class=\"mi\">3</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span> <span class=\"o\">:=</span> <span class=\"k\">fun</span> <span class=\"n\">j</span> <span class=\"bp\">=&gt;</span> <span class=\"k\">if</span> <span class=\"n\">i</span><span class=\"bp\">=</span><span class=\"n\">j</span> <span class=\"k\">then</span> <span class=\"mi\">1</span> <span class=\"k\">else</span> <span class=\"mi\">0</span>\n\n<span class=\"sd\">/-- Partial derivative -/</span>\n<span class=\"kd\">noncomputable</span>\n<span class=\"kd\">def</span> <span class=\"n\">pderiv</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">:</span> <span class=\"n\">Fin</span> <span class=\"mi\">3</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span> <span class=\"bp\">→</span> <span class=\"n\">X</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span> <span class=\"bp\">→</span> <span class=\"n\">X</span> <span class=\"o\">:=</span>\n  <span class=\"k\">fun</span> <span class=\"n\">x</span> <span class=\"bp\">=&gt;</span> <span class=\"n\">fderiv</span> <span class=\"n\">ℝ</span> <span class=\"o\">(</span><span class=\"k\">fun</span> <span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">=&gt;</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">h</span> <span class=\"bp\">•</span> <span class=\"n\">basis</span> <span class=\"n\">i</span><span class=\"o\">))</span> <span class=\"mi\">0</span> <span class=\"mi\">1</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">StationaryFlow</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"bp\">∀</span> <span class=\"n\">t</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"n\">v</span> <span class=\"n\">t</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">v</span> <span class=\"mi\">0</span> <span class=\"n\">x</span>\n<span class=\"kd\">def</span> <span class=\"n\">PotentialFlow</span>   <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"bp\">∃</span> <span class=\"n\">φ</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">t</span> <span class=\"n\">x</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">pderiv</span> <span class=\"n\">i</span> <span class=\"o\">(</span><span class=\"n\">φ</span> <span class=\"n\">t</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">v</span> <span class=\"n\">t</span> <span class=\"n\">x</span> <span class=\"n\">i</span>\n\n<span class=\"sd\">/-- Potential flow identity 1 `(v⬝∇)v = (∇v)^T v` -/</span>\n<span class=\"kd\">theorem</span> <span class=\"n\">potential_flow_identity1</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span><span class=\"o\">)</span>\n  <span class=\"o\">:</span> <span class=\"n\">PotentialFlow</span> <span class=\"n\">v</span> <span class=\"bp\">→</span> <span class=\"bp\">∀</span> <span class=\"n\">t</span> <span class=\"n\">x</span> <span class=\"n\">i</span><span class=\"o\">,</span>\n    <span class=\"o\">(</span><span class=\"bp\">∑</span> <span class=\"n\">j</span><span class=\"o\">,</span> <span class=\"n\">v</span> <span class=\"n\">t</span> <span class=\"n\">x</span> <span class=\"n\">j</span> <span class=\"bp\">*</span> <span class=\"n\">pderiv</span> <span class=\"n\">j</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"n\">t</span> <span class=\"bp\">·</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"n\">x</span><span class=\"o\">)</span>\n    <span class=\"bp\">=</span>\n    <span class=\"o\">(</span><span class=\"bp\">∑</span> <span class=\"n\">j</span><span class=\"o\">,</span> <span class=\"n\">v</span> <span class=\"n\">t</span> <span class=\"n\">x</span> <span class=\"n\">j</span> <span class=\"bp\">*</span> <span class=\"n\">pderiv</span> <span class=\"n\">i</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"n\">t</span> <span class=\"bp\">·</span> <span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"n\">x</span><span class=\"o\">)</span>\n  <span class=\"o\">:=</span> <span class=\"gr\">sorry</span>\n    <span class=\"c1\">-- rewrite `v = ∇ φ` and swap partial derivatives</span>\n\n<span class=\"sd\">/-- Potential flow identity 2  `(v⬝∇)v = 1/2 * ∇ ‖v‖²` -/</span>\n<span class=\"kd\">theorem</span> <span class=\"n\">potential_flow_identity2</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span><span class=\"o\">)</span>\n  <span class=\"o\">:</span> <span class=\"n\">PotentialFlow</span> <span class=\"n\">v</span> <span class=\"bp\">→</span>\n      <span class=\"bp\">∀</span> <span class=\"n\">t</span> <span class=\"n\">x</span> <span class=\"n\">i</span><span class=\"o\">,</span>\n      <span class=\"o\">(</span><span class=\"bp\">∑</span> <span class=\"n\">j</span><span class=\"o\">,</span> <span class=\"n\">v</span> <span class=\"n\">t</span> <span class=\"n\">x</span> <span class=\"n\">j</span> <span class=\"bp\">*</span> <span class=\"n\">pderiv</span> <span class=\"n\">j</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"n\">t</span> <span class=\"bp\">·</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"n\">x</span><span class=\"o\">)</span>\n      <span class=\"bp\">=</span>\n      <span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"n\">pderiv</span> <span class=\"n\">i</span> <span class=\"o\">(</span><span class=\"bp\">‖</span><span class=\"n\">v</span> <span class=\"n\">t</span> <span class=\"bp\">·‖^</span><span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"n\">x</span>\n  <span class=\"o\">:=</span> <span class=\"gr\">sorry</span>\n    <span class=\"c1\">-- 1. differentiate through the norm</span>\n    <span class=\"c1\">-- 2. expand definition of the inner product</span>\n    <span class=\"c1\">-- 3. apply potential_flow_identity1</span>\n\n\n<span class=\"kd\">def</span> <span class=\"n\">EulerEquation</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">forces</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n  <span class=\"bp\">∀</span> <span class=\"n\">t</span> <span class=\"n\">x</span> <span class=\"n\">i</span><span class=\"o\">,</span>\n    <span class=\"c1\">-- ∂v/∂t               + (v⬝∇)v                                + ∇p                 + f = 0</span>\n    <span class=\"n\">fderiv</span> <span class=\"n\">ℝ</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"bp\">·</span> <span class=\"n\">x</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"n\">t</span> <span class=\"mi\">1</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"bp\">∑</span> <span class=\"n\">j</span><span class=\"o\">,</span> <span class=\"n\">v</span> <span class=\"n\">t</span> <span class=\"n\">x</span> <span class=\"n\">j</span> <span class=\"bp\">*</span> <span class=\"n\">pderiv</span> <span class=\"n\">j</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"n\">t</span> <span class=\"bp\">·</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"n\">pderiv</span> <span class=\"n\">i</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"n\">t</span> <span class=\"bp\">·</span><span class=\"o\">)</span> <span class=\"n\">x</span>  <span class=\"bp\">-</span> <span class=\"n\">forces</span> <span class=\"n\">t</span> <span class=\"n\">x</span> <span class=\"n\">i</span><span class=\"bp\">=</span> <span class=\"mi\">0</span>\n\n\n<span class=\"sd\">/-- Function with zero derivative everywhere is constant -/</span>\n<span class=\"kd\">def</span> <span class=\"n\">zero_pderiv_is_const</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span> <span class=\"bp\">→</span> <span class=\"n\">X</span><span class=\"o\">)</span>\n  <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"n\">x</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">pderiv</span> <span class=\"n\">i</span> <span class=\"n\">f</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"bp\">∃</span> <span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"n\">f</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">c</span> <span class=\"o\">:=</span> <span class=\"gr\">sorry</span>\n\n\n<span class=\"kd\">def</span> <span class=\"n\">BernoulliPrinciple</span>\n  <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span>\n  <span class=\"o\">(</span><span class=\"n\">V</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"c1\">-- external forces potential</span>\n  <span class=\"o\">:</span> <span class=\"n\">StationaryFlow</span> <span class=\"n\">v</span> <span class=\"bp\">→</span>\n    <span class=\"n\">PotentialFlow</span> <span class=\"n\">v</span> <span class=\"bp\">→</span>\n    <span class=\"n\">EulerEquation</span> <span class=\"n\">v</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"k\">fun</span> <span class=\"n\">t</span> <span class=\"n\">x</span> <span class=\"n\">i</span> <span class=\"bp\">=&gt;</span> <span class=\"bp\">-</span> <span class=\"n\">pderiv</span> <span class=\"n\">i</span> <span class=\"o\">(</span><span class=\"n\">V</span> <span class=\"n\">t</span> <span class=\"bp\">·</span><span class=\"o\">)</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">→</span>\n    <span class=\"bp\">∃</span> <span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">t</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"bp\">‖</span><span class=\"n\">v</span> <span class=\"n\">t</span> <span class=\"n\">x</span><span class=\"bp\">‖^</span><span class=\"mi\">2</span> <span class=\"bp\">+</span> <span class=\"n\">p</span> <span class=\"n\">t</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">V</span> <span class=\"n\">t</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">c</span>\n  <span class=\"o\">:=</span> <span class=\"gr\">sorry</span>\n  <span class=\"c1\">-- 1. stationary flow implies `∂v/∂t = 0`</span>\n  <span class=\"c1\">-- 2. potential flow implies  `(v⬝∇)v = 1/2 * ∇ ‖v‖²`</span>\n  <span class=\"c1\">-- 3. euler equation reduces to</span>\n  <span class=\"c1\">--    1/2 * ∇ ‖v‖² + ∇ p + ∇ V = 0</span>\n  <span class=\"c1\">-- 4. apply `zero_pderiv_is_const`</span>\n</code></pre></div>",
        "id": 375326864,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1689352922
    },
    {
        "content": "<p>Note that in mathlib <code>h • basis i</code> is usually written <code>Pi.single i h</code></p>",
        "id": 375330342,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1689353734
    },
    {
        "content": "<blockquote>\n<p><code>Warrning: Make sure that it is ‖·‖₂ norm and not ‖·‖∞ norm?</code></p>\n</blockquote>\n<p>It's the wrong norm, you need <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=EuclideanSpace#doc\">docs#EuclideanSpace</a> (<code>notation \" ℝ³ \" =&gt; EuclideanSpace (Fin 3) ℝ</code>)</p>",
        "id": 375330662,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1689353806
    },
    {
        "content": "<p>6 messages were moved here from <a class=\"stream-topic\" data-stream-id=\"395462\" href=\"/#narrow/stream/395462-Natural-sciences/topic/wrong.20formalization.20of.20boyle.27s.20law.20in.20lean\">#Natural sciences &gt; wrong formalization of boyle's law in lean</a> by <span class=\"user-mention silent\" data-user-id=\"424214\">Tyler Josephson ⚛️</span>.</p>",
        "id": 375390151,
        "sender_full_name": "Notification Bot",
        "timestamp": 1689369054
    },
    {
        "content": "<p>I like this! Indeed, Bernoulli's principle seems to apply only when viscous forces are negligible. <span class=\"user-mention\" data-user-id=\"587824\">@David⚛️</span>'s use of Bernoulli's principle in the Darcy-Weisbach equation is given in this way:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"o\">(</span><span class=\"n\">h₀</span><span class=\"o\">:</span> <span class=\"n\">H_loss</span> <span class=\"bp\">=</span> <span class=\"n\">p₁</span><span class=\"bp\">/</span><span class=\"o\">(</span><span class=\"n\">ρ</span><span class=\"bp\">*</span><span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"n\">u₁</span><span class=\"bp\">^</span><span class=\"mi\">2</span> <span class=\"bp\">/</span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"bp\">*</span><span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"n\">z₁</span> <span class=\"bp\">-</span> <span class=\"n\">p₂</span><span class=\"bp\">/</span><span class=\"o\">(</span><span class=\"n\">ρ</span><span class=\"bp\">*</span><span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"bp\">-</span> <span class=\"n\">u₂</span><span class=\"bp\">^</span><span class=\"mi\">2</span> <span class=\"bp\">/</span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"bp\">*</span><span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"bp\">-</span> <span class=\"n\">z₂</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Maybe this is where the \"semi-empirical\" part comes in? Bernoulli's principle is for the case in which H_loss = 0, or</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">p</span><span class=\"bp\">/</span><span class=\"o\">(</span><span class=\"n\">ρ</span><span class=\"bp\">*</span><span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"n\">u</span><span class=\"bp\">^</span><span class=\"mi\">2</span> <span class=\"bp\">/</span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"bp\">*</span><span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"n\">z</span> <span class=\"bp\">=</span> <span class=\"kd\">constant</span>\n</code></pre></div>\n<p>To connect a formally-derived Bernoulli's principle to the first equation, used in deriving Darcy-Weisbach, we'd need to figure out a way to smuggle a H_loss term in, maybe by way of an additional hypothesis.</p>",
        "id": 375391446,
        "sender_full_name": "Tyler Josephson ⚛️",
        "timestamp": 1689369515
    },
    {
        "content": "<p>Finally I have a little bit of understanding of the DW equation. You can analytically derive it from Navier-Stokes equation for laminar flow. In that case, it is known as Hagen–Poiseuille law. This should be easy to formalize.</p>\n<p>The empirical part is that the formula holds for other flows if you modify the viscosity based on the turbulence. There seems to be different empirical modifications based on the type of the flow. Actually, I do not see the connection between Bernoulli's principle and DW equation as one is talking about inviscid flow and the other about viscid flow. And I don't see how this can be formalized.</p>",
        "id": 375406023,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1689376127
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"346070\">Tomas Skrivan</span> <a href=\"#narrow/stream/395462-Natural-sciences/topic/Bernoulli's.20Principle/near/375406023\">said</a>:</p>\n<blockquote>\n<p>Finally I have a little bit of understanding of the DW equation. You can analytically derive it from Navier-Stokes equation for laminar flow. In that case, it is known as Hagen–Poiseuille law. This should be easy to formalize.</p>\n<p>The empirical part is that the formula holds for other flows if you modify the viscosity based on the turbulence. There seems to be different empirical modifications based on the type of the flow. Actually, I do not see the connection between Bernoulli's principle and DW equation as one is talking about inviscid flow and the other about viscid flow. And I don't see how this can be formalized.</p>\n</blockquote>\n<p>Yes, there is a connection between the Darcy-Weisbach equation and Bernoulli’s equation. The Darcy-Weisbach equation is used to calculate the head loss due to friction in a pipe. Bernoulli’s equation is used to calculate the pressure drop due to a change in the velocity of a fluid. The two equations are related because the head loss due to friction can be expressed as a function of the velocity of the fluid. This relationship is used to derive the Darcy-Weisbach equation from Bernoulli’s equation</p>",
        "id": 375435933,
        "sender_full_name": "David⚛️",
        "timestamp": 1689390349
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"346070\">@Tomas Skrivan</span>  The Darcy-Weisbach equation is commonly used to calculate the head loss or pressure drop in a pipe due to friction. It is based on the principle that energy is dissipated as fluid flows through a pipe, resulting in a loss of pressure. The connection between the Darcy-Weisbach equation and the Bernoulli equation lies in the fact that the head loss due to friction in the Darcy-Weisbach equation represents a form of energy dissipation.<br>\nIt is important to note that the Bernoulli equation does not explicitly account for head loss due to friction, whereas the Darcy-Weisbach equation is specifically designed to calculate this loss. By considering the connection between these equations, engineers can analyze fluid flow systems, taking into account both pressure changes due to potential energy and the effects of frictional losses.</p>",
        "id": 375436114,
        "sender_full_name": "David⚛️",
        "timestamp": 1689390470
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"346070\">Tomas Skrivan</span> <a href=\"#narrow/stream/395462-Natural-sciences/topic/Bernoulli's.20Principle/near/375326864\">said</a>:</p>\n<blockquote>\n<p><strong>edit</strong>: fixed <code>ℝ³</code> based on Eric's suggestion</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">Mathlib.Analysis.Calculus.FDeriv.Basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.Data.Real.Basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.Algebra.BigOperators.Basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.Analysis.InnerProductSpace.PiL2</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">BigOperators</span>\n\n<span class=\"kd\">notation</span> <span class=\"s2\">\" ℝ³ \"</span> <span class=\"bp\">=&gt;</span> <span class=\"n\">EuclideanSpace</span> <span class=\"n\">ℝ</span> <span class=\"o\">(</span><span class=\"n\">Fin</span> <span class=\"mi\">3</span><span class=\"o\">)</span>\n\n<span class=\"kd\">variable</span> <span class=\"o\">{</span><span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">_</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span> <span class=\"n\">X</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">NormedSpace</span> <span class=\"n\">ℝ</span> <span class=\"n\">X</span><span class=\"o\">]</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">basis</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">:</span> <span class=\"n\">Fin</span> <span class=\"mi\">3</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span> <span class=\"o\">:=</span> <span class=\"k\">fun</span> <span class=\"n\">j</span> <span class=\"bp\">=&gt;</span> <span class=\"k\">if</span> <span class=\"n\">i</span><span class=\"bp\">=</span><span class=\"n\">j</span> <span class=\"k\">then</span> <span class=\"mi\">1</span> <span class=\"k\">else</span> <span class=\"mi\">0</span>\n\n<span class=\"sd\">/-- Partial derivative -/</span>\n<span class=\"kd\">noncomputable</span>\n<span class=\"kd\">def</span> <span class=\"n\">pderiv</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">:</span> <span class=\"n\">Fin</span> <span class=\"mi\">3</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span> <span class=\"bp\">→</span> <span class=\"n\">X</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span> <span class=\"bp\">→</span> <span class=\"n\">X</span> <span class=\"o\">:=</span>\n  <span class=\"k\">fun</span> <span class=\"n\">x</span> <span class=\"bp\">=&gt;</span> <span class=\"n\">fderiv</span> <span class=\"n\">ℝ</span> <span class=\"o\">(</span><span class=\"k\">fun</span> <span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">=&gt;</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">h</span> <span class=\"bp\">•</span> <span class=\"n\">basis</span> <span class=\"n\">i</span><span class=\"o\">))</span> <span class=\"mi\">0</span> <span class=\"mi\">1</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">StationaryFlow</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"bp\">∀</span> <span class=\"n\">t</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"n\">v</span> <span class=\"n\">t</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">v</span> <span class=\"mi\">0</span> <span class=\"n\">x</span>\n<span class=\"kd\">def</span> <span class=\"n\">PotentialFlow</span>   <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"bp\">∃</span> <span class=\"n\">φ</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">t</span> <span class=\"n\">x</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">pderiv</span> <span class=\"n\">i</span> <span class=\"o\">(</span><span class=\"n\">φ</span> <span class=\"n\">t</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">v</span> <span class=\"n\">t</span> <span class=\"n\">x</span> <span class=\"n\">i</span>\n\n<span class=\"sd\">/-- Potential flow identity 1 `(v⬝∇)v = (∇v)^T v` -/</span>\n<span class=\"kd\">theorem</span> <span class=\"n\">potential_flow_identity1</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span><span class=\"o\">)</span>\n  <span class=\"o\">:</span> <span class=\"n\">PotentialFlow</span> <span class=\"n\">v</span> <span class=\"bp\">→</span> <span class=\"bp\">∀</span> <span class=\"n\">t</span> <span class=\"n\">x</span> <span class=\"n\">i</span><span class=\"o\">,</span>\n    <span class=\"o\">(</span><span class=\"bp\">∑</span> <span class=\"n\">j</span><span class=\"o\">,</span> <span class=\"n\">v</span> <span class=\"n\">t</span> <span class=\"n\">x</span> <span class=\"n\">j</span> <span class=\"bp\">*</span> <span class=\"n\">pderiv</span> <span class=\"n\">j</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"n\">t</span> <span class=\"bp\">·</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"n\">x</span><span class=\"o\">)</span>\n    <span class=\"bp\">=</span>\n    <span class=\"o\">(</span><span class=\"bp\">∑</span> <span class=\"n\">j</span><span class=\"o\">,</span> <span class=\"n\">v</span> <span class=\"n\">t</span> <span class=\"n\">x</span> <span class=\"n\">j</span> <span class=\"bp\">*</span> <span class=\"n\">pderiv</span> <span class=\"n\">i</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"n\">t</span> <span class=\"bp\">·</span> <span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"n\">x</span><span class=\"o\">)</span>\n  <span class=\"o\">:=</span> <span class=\"gr\">sorry</span>\n    <span class=\"c1\">-- rewrite `v = ∇ φ` and swap partial derivatives</span>\n\n<span class=\"sd\">/-- Potential flow identity 2  `(v⬝∇)v = 1/2 * ∇ ‖v‖²` -/</span>\n<span class=\"kd\">theorem</span> <span class=\"n\">potential_flow_identity2</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span><span class=\"o\">)</span>\n  <span class=\"o\">:</span> <span class=\"n\">PotentialFlow</span> <span class=\"n\">v</span> <span class=\"bp\">→</span>\n      <span class=\"bp\">∀</span> <span class=\"n\">t</span> <span class=\"n\">x</span> <span class=\"n\">i</span><span class=\"o\">,</span>\n      <span class=\"o\">(</span><span class=\"bp\">∑</span> <span class=\"n\">j</span><span class=\"o\">,</span> <span class=\"n\">v</span> <span class=\"n\">t</span> <span class=\"n\">x</span> <span class=\"n\">j</span> <span class=\"bp\">*</span> <span class=\"n\">pderiv</span> <span class=\"n\">j</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"n\">t</span> <span class=\"bp\">·</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"n\">x</span><span class=\"o\">)</span>\n      <span class=\"bp\">=</span>\n      <span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"n\">pderiv</span> <span class=\"n\">i</span> <span class=\"o\">(</span><span class=\"bp\">‖</span><span class=\"n\">v</span> <span class=\"n\">t</span> <span class=\"bp\">·‖^</span><span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"n\">x</span>\n  <span class=\"o\">:=</span> <span class=\"gr\">sorry</span>\n    <span class=\"c1\">-- 1. differentiate through the norm</span>\n    <span class=\"c1\">-- 2. expand definition of the inner product</span>\n    <span class=\"c1\">-- 3. apply potential_flow_identity1</span>\n\n\n<span class=\"kd\">def</span> <span class=\"n\">EulerEquation</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">forces</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n  <span class=\"bp\">∀</span> <span class=\"n\">t</span> <span class=\"n\">x</span> <span class=\"n\">i</span><span class=\"o\">,</span>\n    <span class=\"c1\">-- ∂v/∂t               + (v⬝∇)v                                + ∇p                 + f = 0</span>\n    <span class=\"n\">fderiv</span> <span class=\"n\">ℝ</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"bp\">·</span> <span class=\"n\">x</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"n\">t</span> <span class=\"mi\">1</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"bp\">∑</span> <span class=\"n\">j</span><span class=\"o\">,</span> <span class=\"n\">v</span> <span class=\"n\">t</span> <span class=\"n\">x</span> <span class=\"n\">j</span> <span class=\"bp\">*</span> <span class=\"n\">pderiv</span> <span class=\"n\">j</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"n\">t</span> <span class=\"bp\">·</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"n\">pderiv</span> <span class=\"n\">i</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"n\">t</span> <span class=\"bp\">·</span><span class=\"o\">)</span> <span class=\"n\">x</span>  <span class=\"bp\">-</span> <span class=\"n\">forces</span> <span class=\"n\">t</span> <span class=\"n\">x</span> <span class=\"n\">i</span><span class=\"bp\">=</span> <span class=\"mi\">0</span>\n\n\n<span class=\"sd\">/-- Function with zero derivative everywhere is constant -/</span>\n<span class=\"kd\">def</span> <span class=\"n\">zero_pderiv_is_const</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span> <span class=\"bp\">→</span> <span class=\"n\">X</span><span class=\"o\">)</span>\n  <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"n\">x</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">pderiv</span> <span class=\"n\">i</span> <span class=\"n\">f</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"bp\">∃</span> <span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"n\">f</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">c</span> <span class=\"o\">:=</span> <span class=\"gr\">sorry</span>\n\n\n<span class=\"kd\">def</span> <span class=\"n\">BernoulliPrinciple</span>\n  <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span>\n  <span class=\"o\">(</span><span class=\"n\">V</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"bp\">³</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"c1\">-- external forces potential</span>\n  <span class=\"o\">:</span> <span class=\"n\">StationaryFlow</span> <span class=\"n\">v</span> <span class=\"bp\">→</span>\n    <span class=\"n\">PotentialFlow</span> <span class=\"n\">v</span> <span class=\"bp\">→</span>\n    <span class=\"n\">EulerEquation</span> <span class=\"n\">v</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"k\">fun</span> <span class=\"n\">t</span> <span class=\"n\">x</span> <span class=\"n\">i</span> <span class=\"bp\">=&gt;</span> <span class=\"bp\">-</span> <span class=\"n\">pderiv</span> <span class=\"n\">i</span> <span class=\"o\">(</span><span class=\"n\">V</span> <span class=\"n\">t</span> <span class=\"bp\">·</span><span class=\"o\">)</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">→</span>\n    <span class=\"bp\">∃</span> <span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">t</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"bp\">‖</span><span class=\"n\">v</span> <span class=\"n\">t</span> <span class=\"n\">x</span><span class=\"bp\">‖^</span><span class=\"mi\">2</span> <span class=\"bp\">+</span> <span class=\"n\">p</span> <span class=\"n\">t</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">V</span> <span class=\"n\">t</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">c</span>\n  <span class=\"o\">:=</span> <span class=\"gr\">sorry</span>\n  <span class=\"c1\">-- 1. stationary flow implies `∂v/∂t = 0`</span>\n  <span class=\"c1\">-- 2. potential flow implies  `(v⬝∇)v = 1/2 * ∇ ‖v‖²`</span>\n  <span class=\"c1\">-- 3. euler equation reduces to</span>\n  <span class=\"c1\">--    1/2 * ∇ ‖v‖² + ∇ p + ∇ V = 0</span>\n  <span class=\"c1\">-- 4. apply `zero_pderiv_is_const`</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>still learning Lean4. What is <code>fun</code>?  Example of using it here: <code>fun h : ℝ =&gt; f (x + h • basis i)) 0 1</code> is it the same as the lambda operator in Lean3?</p>",
        "id": 376134298,
        "sender_full_name": "Max Bobbin",
        "timestamp": 1689620234
    },
    {
        "content": "<p>Yes. In lean 4 you can still replace <code>fun</code> with lambda</p>",
        "id": 376136164,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1689620663
    },
    {
        "content": "<p>Although I think from a programmer's perspective, it will confuse a lot of newcomers.</p>",
        "id": 376136273,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1689620700
    },
    {
        "content": "<p>By the way, is this pderiv used anywhere else? How does it work? (Been wanting partial derivatives for transport and thermodynamics for a long time)</p>",
        "id": 376192514,
        "sender_full_name": "Tyler Josephson ⚛️",
        "timestamp": 1689640588
    },
    {
        "content": "<p>I do not know how partial derivatives are done in mathlib. I just made this definition up, it is just a directional derivative in the coordinate direction.</p>",
        "id": 376207482,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1689647097
    }
]