[
    {
        "content": "<p>Hi everyone,</p>\n<p>I have currently enrolled in a Lean 4 Theorem Prover course in my institute.  As part of the course, I need to choose a project. <br>\nI’m considering <strong>formalizing the derivation of Hamilton's equation of motion from the Lagrangian formulation</strong> (in the way presented in <strong>Goldstein's Classical Mechanics</strong> Chapter 8 <em>The Hamilton Equations of Motion</em>). I am not sure whether we can do this to full generality because then this might become the problem in symbolic computation also. Maybe we have to take some system say Harmonic oscillator and then from the Lagrangian, we have to construct the Hamiltonian (Legendre transform of Lagrangian) and then proceed further.  </p>\n<p>From my search, I found the <strong>scilib</strong> library, which includes theorems on derivatives and calculus, but it seems to lack results on <strong>multivariable calculus</strong>.<br>\nGiven that this is a <strong>1-month project</strong>, I’d like to know how feasible this would be. Are there any major challenges I should expect?<br>\nAlso, if you have any <strong>suggestions for alternative project topics</strong>, I’d love to hear them! </p>\n<p>Thanks in advance.</p>",
        "id": 505077295,
        "sender_full_name": "Himanshu Jain",
        "timestamp": 1741772589
    },
    {
        "content": "<p>I think this should be possible and I'm willing to help. To get you started I wrote down the formal statement of Lagrange and Hamilton's equations:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">InnerProductSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CompleteSpace</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">]</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">RealInnerProductSpace</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">LagrangeEquations</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">gradient</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">v'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">v'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"c1\">-- d/dt (∂L/∂ẋ)</span>\n<span class=\"w\">       </span><span class=\"bp\">-</span>\n<span class=\"w\">       </span><span class=\"n\">gradient</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"n\">x'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\">                      </span><span class=\"c1\">-- ∂L/∂x</span>\n<span class=\"w\">       </span><span class=\"bp\">=</span>\n<span class=\"w\">       </span><span class=\"mi\">0</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">HamiltonEquations</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\">   </span><span class=\"n\">gradient</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">p'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">p'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span>\n<span class=\"w\">       </span><span class=\"bp\">∧</span>\n<span class=\"w\">       </span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">gradient</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"n\">x'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>As you can see, there is no need for explicit partial derivative/multivariate calculus. You just work with Lagrangian and Hamiltonian as a function of two argument <code>X → X → ℝ</code> and take corresponding derivatives w.r.t. the first or the second variable which effectively gives you partial derivatives.</p>\n<p>The function that obtains Hamiltonian from Lagrangian is:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">noncomputable</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">LtoH</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">gradient</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">v'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">v'</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">invFun</span><span class=\"w\"> </span><span class=\"n\">p</span>\n<span class=\"w\">  </span><span class=\"bp\">⟪</span><span class=\"n\">p</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"bp\">⟫</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">v</span>\n</code></pre></div>\n<p>where <code>let v := (gradient (fun v' =&gt; L q v')).invFun p</code> is inversion of the expression <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi><mo>=</mo><mfrac><mrow><mi mathvariant=\"normal\">∂</mi><mi>L</mi></mrow><mrow><mi mathvariant=\"normal\">∂</mi><mover accent=\"true\"><mi>q</mi><mo>˙</mo></mover></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\"> p = \\frac{\\partial L}{\\partial \\dot q}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.3612em;vertical-align:-0.4811em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8801em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\" style=\"margin-right:0.05556em;\">∂</span><span class=\"mord accent mtight\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6679em;\"><span style=\"top:-2.7em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">q</span></span><span style=\"top:-2.7em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"accent-body\" style=\"left:-0.0556em;\"><span class=\"mord mtight\">˙</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1944em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\" style=\"margin-right:0.05556em;\">∂</span><span class=\"mord mathnormal mtight\">L</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4811em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span> which is at the heart of Lagrange transform.</p>\n<p>Now we can state the main result,  if a trajectory <code>x : ℝ → X</code> satisfies Lagrange equation then it satisfies Hamilton's equations</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">LE_implies_HE</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LagrangeEquations</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">gradient</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">v'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">v'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">HamiltonEquations</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">LtoH</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>your task is to fill in the sorry. It is not provable as stated, you will need some technical conditions on <code>L</code> and <code>x</code> such as appropriate differentiability and some form of convexity of <code>L</code> in <code>v</code> argument.</p>\n<p>It would be nice to have the result also in revese:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">noncomputable</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">HtoL</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">HE_implies_LE</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LagrangeEquations</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">LagrangeEquations</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">HtoL</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>where <code>HtoL</code> is just analogous Legendre transform taking you from Hamiltonian to Lagrangian.</p>\n<hr>\n<p>I'm expecting that the hardest part will be reasoning about the function <code>gradient (fun v' =&gt; L q v')</code>. Under what conditions on <code>L</code> is it invertible? Under what conditions is the inverse differentiable and what is its derivative? </p>\n<p>I think a reasonable strategy would be to just assume all the steps involving inverse function, like <code>(f⁻¹)'(y) = 1/f'(f⁻¹(y))</code>, and get the main structure of the proof. Once that is done, you can maybe prove everything formally correct in case of <code>X = ℝ</code>. Doing it for general space <code>X</code> might be a bit challenging as, I think, the necessary theorems are not formulated in the most beginner friendly way.</p>",
        "id": 505131290,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1741785837
    },
    {
        "content": "<p>This would also make a nice PR to PhysLean, right? <span class=\"user-mention\" data-user-id=\"653351\">@Joseph Tooby-Smith</span></p>",
        "id": 505131988,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1741786007
    },
    {
        "content": "<p>Also, no matter what I would start with <code>X = ℝ</code>. In this case, <code>gradient</code> can be replaced with <code>deriv</code>. The reason is that <code>gradient</code> is relatively new  and I'm not sure if the API is well developed thus might be hard for a beginner to use.</p>",
        "id": 505132909,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1741786235
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"346070\">Tomas Skrivan</span> <a href=\"#narrow/channel/395462-Natural-sciences/topic/Dynamical.20Systems.20in.20Lean4/near/505131988\">said</a>:</p>\n<blockquote>\n<p>This would also make a nice PR to PhysLean, right? <span class=\"user-mention silent\" data-user-id=\"653351\">Joseph Tooby-Smith</span></p>\n</blockquote>\n<p>Indeed this would be a very nice PR to PhysLean. I actually started some basic stuff in the direction of classical mechanics yesterday, and indeed I did stuff related harmonic oscillator. See <a href=\"https://physlean.com/docs/PhysLean/ClassicalMechanics/HarmonicOscillator/Basic.html\">here</a>.  I only did the basics though: I wrote down the lagrangian and the solutions but did not connect the two with the Euler-Larange equations. So anything in this direction would be great :). I don't really plan to work more in the direction of classical mechanics for the time being.</p>",
        "id": 505134196,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1741786521
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"346070\">@Tomas Skrivan</span> , <span class=\"user-mention\" data-user-id=\"653351\">@Joseph Tooby-Smith</span> , Thanks a lot for your detailed response!</p>\n<p>I come from a scientific computing background, where I primarily work with numerical methods like Finite Differences to solve PDEs. When I first started learning Lean4 at my institute, I struggled with its proof-oriented paradigm—perhaps because I’ve been working with Python for so long. <br>\nWhen I first thought about formalizing physical concepts in Lean for my course project, I found it difficult to visualize how this would work. Initially, I assumed we might define a specific system, express the Lagrangian and Lagrange's equation symbolically (like in SymPy), and manipulate expressions to derive Hamilton’s equations. However, I wasn’t even clear on what the actual inputs and outputs of our Lean functions would be.</p>\n<p>From this discussion, I now understand that:</p>\n<ul>\n<li><strong>Input</strong>: Formal definitions of Lagrange’s equations, Hamilton’s equations, and the Legendre transform.</li>\n<li><strong>Output</strong>: A <strong>proof</strong> that, under certain conditions, if a function <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">x(t)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span> satisfies Lagrange's equations, then the corresponding <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>q</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">q(t)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">p(t)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span> satisfy Hamilton’s equations.</li>\n</ul>\n<p>Of course, we must assume constraints on the interaction potential of the system to ensure the Lagrangian is invertible. Does this interpretation align with what you had in mind?</p>\n<p>The project seems quite interesting, and I’d love to discuss it further with you to gain better insights!</p>",
        "id": 505365837,
        "sender_full_name": "Himanshu Jain",
        "timestamp": 1741857974
    },
    {
        "content": "<p>This does indeed seem like an interesting project :). </p>\n<p>I agree with your <em>input</em> and <em>output</em>, although I would be careful with the phrase <em>Lean functions</em>, as it is not like Lean has an explicit function that takes these inputs and gives this output. </p>\n<p>Also, in case you haven't seen it there is Zulip channel for PhysLean <a href=\"#narrow/channel/479953-PhysLean/\">here</a>.</p>",
        "id": 505369293,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1741858877
    },
    {
        "content": "<p>I'm not sure if I would call it input and output. In a way everything is an input, you have to write the statement and the proof, and the only thing Lean outputs is <em>yay or nay</em> based on the correctness of your proof.</p>",
        "id": 505383881,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1741862600
    },
    {
        "content": "<p>Well. There could be something to be said for actually writing \"implementations\" too. :) I mean, Lean does generate code. But that would be exceedingly hard to do with derivatives, real numbers, etc. all being noncomputable.</p>",
        "id": 505441481,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1741876935
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"346070\">Tomas Skrivan</span> <a href=\"#narrow/channel/395462-Natural-sciences/topic/Dynamical.20Systems.20in.20Lean4/near/505131290\">said</a>:</p>\n<blockquote>\n<p>I'm expecting that the hardest part will be reasoning about the function <code>gradient (fun v' =&gt; L q v')</code>. Under what conditions on <code>L</code> is it invertible? Under what conditions is the inverse differentiable and what is its derivative?</p>\n</blockquote>\n<p>I think this part is worth highlighting extra. A \"typical\" treatment of Hamiltonian/Lagrangian mechanics at the level of Goldstein's sort of throws out many of these assumptions. You're really working with the <a href=\"https://en.wikipedia.org/wiki/Legendre_transformation\">Legendre transform</a> here, which will require some assumptions about convexity and invertibility and so on if you want to get the proofs to check.</p>\n<p>I think that, <em>before</em> drafting the proofs in Lean, you should look at the book proofs you want to formalize, and think quite critically about what assumptions are needed on these solutions at each step.</p>",
        "id": 505442227,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1741877106
    },
    {
        "content": "<p>For instance: there's a classic example where a ball starts at rest atop a cone shaped like y = -x^(4/3). According to Hamilton's equations, there's an infinite number of solutions - at any time t, it could 'spontaneously' start rolling down the cone. (And in reverse, it could have been rolling up the cone and come to rest at any point in time in the past.) So, despite being a pretty nice differentiable potential, there is no uniqueness on the differential equations. You should think about how you'll handle that!</p>",
        "id": 505443968,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1741877515
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"448405\">Alex Meiburg</span> <a href=\"#narrow/channel/395462-Natural-sciences/topic/Dynamical.20Systems.20in.20Lean4/near/505442227\">said</a>:</p>\n<blockquote>\n<p>I think that, <em>before</em> drafting the proofs in Lean, you should look at the book proofs you want to formalize, and think quite critically about what assumptions are needed on these solutions at each step.</p>\n</blockquote>\n<p>I think the exact opposite of this approach should be doable too. I would write the proof the way you find it in standard physics textbook first and sorry all the assumptions of used theorems. After that I would inspect all the <code>sorry</code>, realized what assumptions do I need on the potential to allow me to remove every <code>sorry</code>.</p>",
        "id": 505459305,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1741880875
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"448405\">Alex Meiburg</span> <a href=\"#narrow/channel/395462-Natural-sciences/topic/Dynamical.20Systems.20in.20Lean4/near/505443968\">said</a>:</p>\n<blockquote>\n<p>For instance: there's a classic example where a ball starts at rest atop a cone shaped like y = -x^(4/3). According to Hamilton's equations, there's an infinite number of solutions - at any time t, it could 'spontaneously' start rolling down the cone. (And in reverse, it could have been rolling up the cone and come to rest at any point in time in the past.) So, despite being a pretty nice differentiable potential, there is no uniqueness on the differential equations. You should think about how you'll handle that!</p>\n</blockquote>\n<p>Yes this is indeed an issue but it is not related to the original problem:</p>\n<blockquote>\n<p>I’m considering <strong>formalizing the derivation of Hamilton's equation of motion from the Lagrangian formulation</strong></p>\n</blockquote>\n<p>Which, in my interpretation, boils down to showing that if a trajectory satisfies Lagrange equation then it satisfies Hamilton's equations. This is unrelated to the question about existence and uniqueness as you are given a solution as a hypothesis.</p>\n<p>I'm expecting that the only requirement will be:</p>\n<ul>\n<li>smoothness of Lagrangian  <code>ContDiff ℝ 2 (fun (x,v) =&gt; L x v))</code> </li>\n<li>strong convexity, expressed as positive definitness of the hessian:</li>\n</ul>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">dv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">fderiv</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">fderiv</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">dv</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">dv</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">dv</span><span class=\"bp\">‖^</span><span class=\"mi\">2</span>\n</code></pre></div>\n<p>I'm not sure if mathlib has theorems about functions that satisfy this kind of convexity and about positive definite bilinear forms. That is why I'm suggesting to omit those proofs and maybe prove them only in a special case <code>X = ℝ</code> where the convexity condition just says that <code>iteratedDeriv 2 (L x ·) v &gt; 0</code>.</p>\n<hr>\n<p>If we want to talk about local existence and uniqueness of the solution we can use Picard–Lindelöf theorem which requires that the equation is Lipschitz in space. In your example the energy is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>−</mo><mi mathvariant=\"normal\">∣</mi><mi>x</mi><msup><mi mathvariant=\"normal\">∣</mi><mfrac><mn>4</mn><mn>3</mn></mfrac></msup><mi mathvariant=\"normal\">‘</mi></mrow><annotation encoding=\"application/x-tex\">- |x|^{\\frac43}`</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.204em;vertical-align:-0.25em;\"></span><span class=\"mord\">−</span><span class=\"mord\">∣</span><span class=\"mord mathnormal\">x</span><span class=\"mord\"><span class=\"mord\">∣</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.954em;\"><span style=\"top:-3.363em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mopen nulldelimiter sizing reset-size3 size6\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8443em;\"><span style=\"top:-2.656em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">3</span></span></span></span><span style=\"top:-3.2255em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line mtight\" style=\"border-bottom-width:0.049em;\"></span></span><span style=\"top:-3.384em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">4</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.344em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter sizing reset-size3 size6\"></span></span></span></span></span></span></span></span></span></span><span class=\"mord\">‘</span></span></span></span> thus the force is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>−</mo><mfrac><mn>4</mn><mn>3</mn></mfrac><mfrac><mi>x</mi><mrow><mi mathvariant=\"normal\">∣</mi><mi>x</mi><msup><mi mathvariant=\"normal\">∣</mi><mfrac><mn>2</mn><mn>3</mn></mfrac></msup></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">- \\frac43 \\frac{x}{|x|^\\frac23}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.6873em;vertical-align:-0.8421em;\"></span><span class=\"mord\">−</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8451em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">3</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">4</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6954em;\"><span style=\"top:-2.3329em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">∣</span><span class=\"mord mathnormal mtight\">x</span><span class=\"mord mtight\"><span class=\"mord mtight\">∣</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.2245em;\"><span style=\"top:-3.4878em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mopen nulldelimiter sizing reset-size1 size6\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0314em;\"><span style=\"top:-2.468em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mtight\"><span class=\"mord mtight\">3</span></span></span><span style=\"top:-3.2255em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line mtight\" style=\"border-bottom-width:0.049em;\"></span></span><span style=\"top:-3.387em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.532em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter sizing reset-size1 size6\"></span></span></span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8421em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span> which is not Liptschitz thus not satisfying Picard–Lindelöf theorem.</p>\n<p>Under the <code>ContDiff ℝ 2 (fun (x,v) =&gt; L x v))</code> assumption you get Liptschitz condition immediately thus you are guaranteed local existence and uniqueness.</p>\n<p>Global existence would also require some integrability condition which I think is not yet in mathlib.</p>",
        "id": 505464766,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1741882066
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"448405\">Alex Meiburg</span> <a href=\"#narrow/channel/395462-Natural-sciences/topic/Dynamical.20Systems.20in.20Lean4/near/505441481\">said</a>:</p>\n<blockquote>\n<p>Well. There could be something to be said for actually writing \"implementations\" too. :) I mean, Lean does generate code. But that would be exceedingly hard to do with derivatives, real numbers, etc. all being noncomputable.</p>\n</blockquote>\n<p>This is what my project, <a href=\"https://github.com/lecopivo/SciLean\">SciLean</a>, is all about. Have a look at <a href=\"https://lecopivo.github.io/scientific-computing-lean/Examples/Harmonic-Oscillator/#Scientific-Computing-in-Lean--Examples--Harmonic-Oscillator\">here</a> for generating a numerical program from just specifying Hamiltonian.</p>",
        "id": 505465190,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1741882170
    }
]