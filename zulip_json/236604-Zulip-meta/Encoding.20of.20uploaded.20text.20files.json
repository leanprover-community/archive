[
    {
        "content": "<p>The text file from <a class=\"message-link\" href=\"/#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/527073571\">#Machine Learning for Theorem Proving &gt; MCP Tools for LLMs and Agentic Mathematics @ ðŸ’¬</a> is a normal utf-8 encoded text file with some higher Unicode characters. The server only serves it with <code>content-type: text/plain</code> though, which means that browsers (which usually display the text instead of downloading it) tend to guess the wrong encoding. Is there some way to fix this? (In this concrete case, calling the file <code>something.lean</code> would make the browser download it.)</p>\n<p>The only related issue I found was <a href=\"https://github.com/zulip/zulip/issues/22682\">https://github.com/zulip/zulip/issues/22682</a>, but when uploading such a text file, my browser doesn't send any encoding info in the headers in the first place. Forcing the browser to download the file using <code>content-disposition</code> would also fix this issue, though it'll be annoying for other kinds of files (images, videos, audio, ...).</p>",
        "id": 527126368,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1751615834
    },
    {
        "content": "<p>To save someone a click, the file is <a href=\"user_uploads/3121/Y8FcCTr653dlldtFhGJQe1K3/pabc_claude.lean.txt\">https://leanprover.zulipchat.com/user_uploads/3121/Y8FcCTr653dlldtFhGJQe1K3/pabc_claude.lean.txt</a></p>",
        "id": 527145472,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751622331
    },
    {
        "content": "<p>If the server sent a <code>content-type: text/plain; charset=utf-8</code> header then this would work correctly</p>",
        "id": 527146220,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751622598
    },
    {
        "content": "<p>It's up to debate whether that's always the right thing to do for <code>.txt</code> files, but certainly it is the right thing to do for <code>.lean</code> files</p>",
        "id": 527146289,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751622617
    },
    {
        "content": "<p>Most static server configurations have a way to set the content-type by extension</p>",
        "id": 527146358,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751622640
    },
    {
        "content": "<p>We don't want to assume <code>utf-8</code> for all <code>text/plain</code> files -- as common as it is, unilaterally adding that will break the rendering of files which are <em>not</em> in UTF-8.</p>\n<p>We trust the content-type of the browser when they upload a file.  Unfortunately, those content-types don't come with charsets.</p>\n<p>It's a little surprising to me that the default for Chrome (and Safari and Firefox) for <code>content-type: text/plain</code> with no explicit charset is <code>iso-8859-1</code>, and not <code>utf-8</code>.</p>",
        "id": 529306626,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1752766604
    },
    {
        "content": "<p>This came up recently on <a href=\"http://chat.zulip.org\">chat.zulip.org</a> -- you can follow the further discussion <a href=\"https://chat.zulip.org/#narrow/channel/9-issues/topic/Character.20set.20of.20text.2Fplain.20files/near/2223484\">there</a>.</p>",
        "id": 529306821,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1752766665
    },
    {
        "content": "<p>We've merged <a href=\"https://github.com/leanprover-community/mathlib4/pull/35334\">#35334</a> for this; it's not yet deployed to Zulip Cloud yet, but probably will be in the next week or so.</p>",
        "id": 530842675,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1753474713
    },
    {
        "content": "<p>Link to the correct repo: <a href=\"https://github.com/zulip/zulip/pull/35334\">https://github.com/zulip/zulip/pull/35334</a></p>",
        "id": 530843733,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1753475206
    }
]