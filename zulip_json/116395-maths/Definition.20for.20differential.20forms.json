[
    {
        "content": "<p>Hi, I'm pretty new to Lean. I've worked through all the exercises in the current version of  <em>Mathematics in Lean</em> and that's about it.</p>\n<p>With that out of the way, I'm mostly interested in differential geometry in Lean (partially to aid in my learning of DG), and I thought I'd have a go at defining cotangent spaces and bundles, and differential forms. Specifically, do these extra definitions for <code>geometry.manifold.basic_smooth_bundle</code> look about right?</p>\n<p>After the definition of <code>tangent_space</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">@[nolint unused_arguments, derive [has_coe_to_fun, semi_normed_group, semi_normed_space ùïú, normed_group, normed_space ùïú]</span><span class=\"o\">]</span>\n<span class=\"kd\">def</span> <span class=\"n\">cotangent_space</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">M</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span> <span class=\"o\">:=</span> <span class=\"n\">normed_space.dual</span> <span class=\"bp\">ùïú</span> <span class=\"n\">E</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">differential_form</span> <span class=\"o\">:=</span> <span class=\"bp\">Œ†</span> <span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">:</span> <span class=\"n\">M</span><span class=\"o\">),</span> <span class=\"n\">exterior_algebra</span> <span class=\"bp\">ùïú</span> <span class=\"o\">(</span><span class=\"n\">cotangent_space</span> <span class=\"n\">I</span> <span class=\"n\">x</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>After the definition of <code>tangent_bundle</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">@[nolint has_inhabited_instance, reducible]</span> <span class=\"c1\">-- is empty if the base manifold is empty</span>\n<span class=\"kd\">def</span> <span class=\"n\">cotangent_bundle</span> <span class=\"o\">:=</span> <span class=\"bp\">Œ£</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">M</span><span class=\"o\">),</span> <span class=\"n\">cotangent_space</span> <span class=\"n\">I</span> <span class=\"n\">x</span>\n</code></pre></div>",
        "id": 238803288,
        "sender_full_name": "Dylan Ede",
        "timestamp": 1621014149
    },
    {
        "content": "<p>My definition of <code>differential_form</code> looks like this now:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">@[derive [inhabited, semiring, ring, algebra ùïú]</span><span class=\"o\">]</span>\n<span class=\"kd\">def</span> <span class=\"n\">differential_form</span> <span class=\"o\">:=</span> <span class=\"bp\">Œ†</span> <span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">:</span> <span class=\"n\">M</span><span class=\"o\">),</span> <span class=\"n\">exterior_algebra</span> <span class=\"bp\">ùïú</span> <span class=\"o\">(</span><span class=\"n\">cotangent_space</span> <span class=\"n\">I</span> <span class=\"n\">x</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>In order for this to be useful, do I now need to wrap all of the results in <code>linear_algebra.exterior_algebra</code> so that they apply to <code>differential_form</code>?</p>",
        "id": 238842098,
        "sender_full_name": "Dylan Ede",
        "timestamp": 1621034408
    },
    {
        "content": "<p>I don't think this definition of <code>differential_form</code> is correct.</p>",
        "id": 238842338,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1621034575
    },
    {
        "content": "<p>All this is saying is that to each point <code>x</code> you assign some element (with no restrictions whatsoever!) in the exterior algebra of the dual of the tangent space at <code>x</code>.</p>",
        "id": 238842441,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1621034649
    },
    {
        "content": "<p>I'm an algebraic geometer so my inclination is to define things as sections of some sheaf, but I hope that someone who is more familiar with the manifolds library should be able to direct you to a better definition.</p>",
        "id": 238842536,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1621034726
    },
    {
        "content": "<p>OK, I thought there might be a problem since I was struggling with the definition of section to use. I was basing things on <a href=\"https://ncatlab.org/nlab/show/differential+form\">https://ncatlab.org/nlab/show/differential+form</a> and <a href=\"https://mathworld.wolfram.com/BundleSection.html\">https://mathworld.wolfram.com/BundleSection.html</a></p>",
        "id": 238842711,
        "sender_full_name": "Dylan Ede",
        "timestamp": 1621034878
    },
    {
        "content": "<p>As a toy example, perhaps it's worthwhile to write down the definition of a vector field as a section to the tangent bundle</p>",
        "id": 238844042,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1621035964
    },
    {
        "content": "<p>I've done a bit more reading, and it seems like the main (only?) thing missing is that some definitions require the section/map to be continuous. Indeed, that is what the Wikipedia definition requires. I had previously found a definition that suggested that sometimes you don't want to require that a differential form is continuous, but now I can't find it.</p>",
        "id": 238898642,
        "sender_full_name": "Dylan Ede",
        "timestamp": 1621085822
    },
    {
        "content": "<p>If you're working with <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>C</mi><mi>p</mi></msup></mrow><annotation encoding=\"application/x-tex\">C^p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.664392em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">p</span></span></span></span></span></span></span></span></span></span></span> manifolds, you would want to require the section to be <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>C</mi><mi>p</mi></msup></mrow><annotation encoding=\"application/x-tex\">C^p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.664392em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">p</span></span></span></span></span></span></span></span></span></span></span>. So when p is 0, that's continuity, and when p is infinity, that means smooth</p>",
        "id": 238899511,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1621086662
    },
    {
        "content": "<p>OK, thanks, I think I see what I need to do now. I think <code>differential_form</code> needs to look something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">def</span> <span class=\"n\">differential_form_bundle</span> <span class=\"o\">:=</span> <span class=\"bp\">Œ£</span> <span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">:</span> <span class=\"n\">M</span><span class=\"o\">),</span> <span class=\"n\">exterior_algebra</span> <span class=\"bp\">ùïú</span> <span class=\"o\">(</span><span class=\"n\">cotangent_space</span> <span class=\"n\">I</span> <span class=\"n\">x</span><span class=\"o\">)</span>\n<span class=\"kd\">def</span> <span class=\"n\">differential_form</span> <span class=\"o\">:=</span> <span class=\"n\">C</span><span class=\"bp\">^‚àû‚üÆ</span><span class=\"n\">I</span><span class=\"o\">,</span> <span class=\"n\">M</span><span class=\"bp\">;</span> <span class=\"n\">I</span><span class=\"o\">,</span> <span class=\"n\">differential_form_bundle</span> <span class=\"n\">I</span> <span class=\"n\">M</span><span class=\"bp\">‚üØ</span>\n</code></pre></div>\n<p>But of course that means that I need to implement all the necessary type classes on <code>differential_form_bundle</code>, and <code>contangent_bundle</code> as well, probably with definitions of <code>differential_form_bundle_core</code> and <code>cotangent_bundle_core</code> to help with that.</p>",
        "id": 238901530,
        "sender_full_name": "Dylan Ede",
        "timestamp": 1621088612
    },
    {
        "content": "<p>What's the status for differential forms nowadays? How far are we from a workable definition? (In or outside of mathlib.)</p>",
        "id": 472852387,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1727342770
    },
    {
        "content": "<p>There are have been discussion but I don‚Äôt think there is any concrete progress.</p>",
        "id": 472855395,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1727343734
    },
    {
        "content": "<p>Aha, that's sorta what I expected.</p>",
        "id": 472856237,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1727343999
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/stream/116395-maths/topic/Definition.20for.20differential.20forms/near/472855395\">said</a>:</p>\n<blockquote>\n<p>There are have been discussion but I don‚Äôt think there is any concrete progress.</p>\n</blockquote>\n<p>I was hoping to use these to define a connection on a principal bundle (where the forms are Lie algebra-valued).</p>",
        "id": 472870325,
        "sender_full_name": "Dominic Steinitz",
        "timestamp": 1727348749
    },
    {
        "content": "<p>I'm slowly pushing towards this goal, but I'm too busy at my day job.</p>",
        "id": 472888841,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1727355012
    },
    {
        "content": "<p>Computing de Rham cohomology of the n-sphere would be a really nice project.</p>",
        "id": 472975353,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1727385816
    },
    {
        "content": "<p>You could even imagine a top down approach.</p>",
        "id": 472975484,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1727385872
    },
    {
        "content": "<p>Next PR towards this goal: <a href=\"https://github.com/leanprover-community/mathlib4/pull/17200\">#17200</a></p>",
        "id": 473293116,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1727503331
    },
    {
        "content": "<p>The R algebra of differential forms can be a commutative differential graded algebra, but unless a connection is flat it  does not satisfy the square zero condition. </p>\n<p>We may want to decide what kind of thing the ring of differential forms is, taking cue from the work that <span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span>  and <span class=\"user-mention\" data-user-id=\"260507\">@Heather Macbeth</span>  did in Lean 3.</p>\n<p>If these are taken as R algebras (and R vector spaces for the connections) with the differential separate then this could allow one to form the full structure separately.</p>\n<p>The rings of smooth and holo<br>\norphic functions as R algebras could be good to start with, and then possibly Omega^1. Maybe Lambda^* for an A module as well. One could use tensor and kernel for these, and the R module for a free basis.</p>",
        "id": 473906385,
        "sender_full_name": "Norman Paskus",
        "timestamp": 1727747402
    },
    {
        "content": "<p>My current plan is to use a vector bundle of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ContinuousAlternatingMap#doc\">docs#ContinuousAlternatingMap</a> s</p>",
        "id": 473949295,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1727762184
    },
    {
        "content": "<p>This way the construction isn't tied to the finite dimensional case.</p>",
        "id": 473949341,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1727762215
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"214703\">@Yury G. Kudryashov</span> thanks for this. It seems like you and Dominic want to use vector bundles.</p>\n<p>There‚Äôs been a lot of interest recently in getting differential forms to work. Do you have some more extensive blueprints up? </p>\n<p>It would be really cool if the rw[] ends up producing some normal forms. I wanted to be able to do things with formal expressions vaguely like this:</p>\n<p>4 ^ (d x) ^ (d z)</p>\n<p>rw[pullback f]</p>\n<p>‚Ä¶</p>\n<p>so its formal algebra starting with bundles.</p>",
        "id": 474189684,
        "sender_full_name": "Norman Paskus",
        "timestamp": 1727843463
    },
    {
        "content": "<p>I don't have any blueprints, just some plans in my head.</p>",
        "id": 474190611,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1727844012
    },
    {
        "content": "<p>The next step towards the wedge product is to redefine <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AlternatingMap.domCoprod#doc\">docs#AlternatingMap.domCoprod</a> without tensor product, and probably without sticking to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Sum#doc\">docs#Sum</a> for the new index type. I think that the general definition should take 2 embeddings and a proof that their <code>Set.range</code>s are <code>IsCompl</code>.</p>",
        "id": 474190714,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1727844106
    },
    {
        "content": "<p>It should take a bilinear map as an argument instead.</p>",
        "id": 474190787,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1727844127
    },
    {
        "content": "<p>Similarly to how <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MeasureTheory.convolution#doc\">docs#MeasureTheory.convolution</a> is defined in Mathlib.</p>",
        "id": 474190818,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1727844166
    },
    {
        "content": "<p>Pullback is just <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ContinuousAlternatingMap.compContinuousLinearMap#doc\">docs#ContinuousAlternatingMap.compContinuousLinearMap</a></p>",
        "id": 474190902,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1727844238
    },
    {
        "content": "<p>What's the advantage of dropping <code>Sum</code>? That sounds like something the caller can translate through</p>",
        "id": 474320228,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1727881080
    },
    {
        "content": "<p>(I can see the argument that going through TensorProduct.lift is slow and probably awkward for typeclass reasons)</p>",
        "id": 474320381,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1727881118
    },
    {
        "content": "<p>Reason to drop <code>TensorProduct</code>: we don't have a topology on <code>TensorProduct</code>, and I want a version for <code>ContinuousAlternatingMap</code>s.</p>",
        "id": 474348222,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1727887404
    },
    {
        "content": "<p>Reason for generalizing codomain: the main application in analysis is going to use <code>Fin k</code>, <code>Fin l</code>, and <code>Fin n</code>, <code>n = k + l</code>.</p>",
        "id": 474348345,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1727887443
    },
    {
        "content": "<p>We can have a generic version <code>domCoprodOfIsCompl</code> and specializations to <code>Sum</code> and <code>Fin</code>.</p>",
        "id": 474348421,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1727887483
    },
    {
        "content": "<p>Why would you have more natural topologies on alternating maps than on tensor products?</p>",
        "id": 474488049,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1727936413
    },
    {
        "content": "<p>For <code>ContinuousAlternatingMap</code>s, the natural topology comes from the topology/norm on <code>ContinuousMultilinearMap</code>s.</p>",
        "id": 474488541,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1727936498
    },
    {
        "content": "<p>For the tensor product, there are multiple non-compatible topologies in the infinite dimensional space, and we haven't fixed one of them as \"the main one\" in Mathlib yet.</p>",
        "id": 474488885,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1727936549
    },
    {
        "content": "<p>Yes really it's just that we chose a defaut topology on continuous multilinear maps (that of bounded convergence) but we didn't do such a choice (and we probably don't want to ?) on the tensor product.</p>",
        "id": 474532866,
        "sender_full_name": "Anatole Dedecker",
        "timestamp": 1727946720
    }
]