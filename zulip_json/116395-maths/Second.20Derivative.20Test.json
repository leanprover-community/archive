[
    {
        "content": "<p>Where can I find the good old Second Derivative Test in Mathlib? Or the First Derivative Test?<br>\n<a href=\"https://www.moogle.ai/search/raw?q=derivative%20maximum\">Searching</a> only brought up the partial converse, Fermat's theorem.</p>",
        "id": 456989377,
        "sender_full_name": "Bjørn Kjos-Hanssen",
        "timestamp": 1722996022
    },
    {
        "content": "<p>Did you try <a href=\"https://leansearch.net/\">https://leansearch.net/</a>?</p>",
        "id": 457032853,
        "sender_full_name": "Ralf Stephan",
        "timestamp": 1723015582
    },
    {
        "content": "<p>Tried it now but the result is about the same for the query \"derivative maximum\" as on Moogle.AI</p>",
        "id": 457153898,
        "sender_full_name": "Bjørn Kjos-Hanssen",
        "timestamp": 1723049310
    },
    {
        "content": "<p>I don't know the calculus API but I don't see it myself either looking at <code>Mathlib/Analysis/Calculus/LocalExtr</code> which seems like where it might be. (I also don't know what generality it's true in? But it might be a decent exercise to prove it and see if someone comes along and gives tips if it needs generalizing.)</p>",
        "id": 457155221,
        "sender_full_name": "Julian Berman",
        "timestamp": 1723049838
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321696\">Julian Berman</span> <a href=\"#narrow/stream/116395-maths/topic/Second.20Derivative.20Test/near/457155221\">said</a>:</p>\n<blockquote>\n<p>I don't know the calculus API but I don't see it myself either looking at <code>Mathlib/Analysis/Calculus/LocalExtr</code> which seems like where it might be. (I also don't know what generality it's true in? But it might be a decent exercise to prove it and see if someone comes along and gives tips if it needs generalizing.)</p>\n</blockquote>\n<p>I proved a version of the First Derivative Test just now and indeed it was a fun exercise.</p>",
        "id": 457178517,
        "sender_full_name": "Bjørn Kjos-Hanssen",
        "timestamp": 1723057536
    },
    {
        "content": "<p>Nice. And ah ok so now that I was going to say \"maybe the undergrad.yml file has something\", I see it indeed has:</p>\n<div class=\"codehilite\" data-code-language=\"YAML\"><pre><span></span><code><span class=\"w\">    </span><span class=\"nt\">local extrema</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">'IsLocalMin.fderiv_eq_zero'</span>\n</code></pre></div>\n<p>i.e. <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsLocalMin.fderiv_eq_zero#doc\">docs#IsLocalMin.fderiv_eq_zero</a> -- just pointing that out as well in case you didn't see that (I glanced over it until now). Edit: you mentioned this in your original message, so I guess you did (and so must have I). Slow morning, forgive me :)</p>",
        "id": 457186230,
        "sender_full_name": "Julian Berman",
        "timestamp": 1723059319
    },
    {
        "content": "<p>Any progress on the second derivative test? Unless I'm missing something, it's still not in Mathlib, right?</p>",
        "id": 466002192,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1724934718
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"638715\">@Adomas Baliuka</span> Correct. I can send in the first derivative test as a first step. Are you thinking of working on the 2nd derivative test?</p>",
        "id": 466076315,
        "sender_full_name": "Bjørn Kjos-Hanssen",
        "timestamp": 1724953293
    },
    {
        "content": "<p>I certainly won't work on 2nd derivative test this week. Maybe I could look at it next week but I'm not sure how big a project that is (and what generality one would have to state this at; The application I wanted to have it for was just <code>Real -&gt; Real</code>).</p>\n<p>I guess the first step would be to merge the first derivative test. Actually, I'm not even sure what \"first derivative test\" means exactly. Is it (informally, for <code>Real -&gt; Real</code> at lest) <code>\"first derivative changes sign at x\"-&gt; \"x is extremal point\"</code>?</p>\n<p>Second derivative test would be (I assume) <code>f' x = 0 -&gt; f'' x &gt; 0 -&gt; \"local minimum at x\"</code> (and analogous thing for <code>f'' &gt; 0</code>)?</p>",
        "id": 466077224,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1724953563
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"638715\">Adomas Baliuka</span> <a href=\"#narrow/stream/116395-maths/topic/Second.20Derivative.20Test/near/466077224\">said</a>:</p>\n<blockquote>\n<p>I guess the first step would be to merge the first derivative test. Actually, I'm not even sure what \"first derivative test\" means exactly. Is it (informally, for <code>Real -&gt; Real</code> at lest) <code>\"first derivative changes sign at x\"-&gt; \"x is extremal point\"</code>?</p>\n</blockquote>\n<p>I have a couple of different statements depending on whether you have bounded intervals or not. For example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">first_derivative_test</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Continuous</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">g₀</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">g₁</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">h₀</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\">  </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">interior</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Icc</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">h₁</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\">  </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">interior</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Icc</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsLocalMax</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">b</span>\n</code></pre></div>\n<p>This one \"works\" in the sense that I can use it to prove <code>IsLocalMax Real.sin (Real.pi/2)</code> by invoking <code>apply first_derivative_test</code>.</p>",
        "id": 466092144,
        "sender_full_name": "Bjørn Kjos-Hanssen",
        "timestamp": 1724958027
    },
    {
        "content": "<p>If you're willing to assume the second derivative exists, and is positive, on <strong>some interval around</strong> <code>x</code>, then you should be able to show that <code>f' x = 0</code> implies <code>x</code> is a local minimum by combining 2 things that are already in mathlib:</p>\n<ul>\n<li><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=strictConvexOn_of_deriv2_pos#doc\">docs#strictConvexOn_of_deriv2_pos</a> to show that <code>f</code> is strictly convex on an interval around <code>x</code></li>\n<li><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=StrictConvexOn.deriv_lt_slope#doc\">docs#StrictConvexOn.deriv_lt_slope</a> and its mirror-image <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=StrictConvexOn.slope_lt_deriv#doc\">docs#StrictConvexOn.slope_lt_deriv</a> to show that <code>f y &gt; f x</code> for <code>y</code> slightly less than, resp. greater than, <code>x</code>.</li>\n</ul>",
        "id": 466094870,
        "sender_full_name": "David Loeffler",
        "timestamp": 1724958847
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"481963\">@David Loeffler</span>  Thanks, that looks like a quick way. And if we're not willing to assume all that then <a href=\"https://en.wikipedia.org/wiki/Derivative_test#Proof_of_the_second-derivative_test\">Wikipedia's proof</a> is rather short (although it does involve <code>ε</code>'s).</p>",
        "id": 466099674,
        "sender_full_name": "Bjørn Kjos-Hanssen",
        "timestamp": 1724960632
    },
    {
        "content": "<p>I submitted a PR now with this result (and the corresponding one for minima):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">first_derivative_test_max</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">g₀</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g₁</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ContinuousAt</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hd₀</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DifferentiableOn</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Ioo</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hd₁</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DifferentiableOn</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Ioo</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">h₀</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\">  </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Ioo</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">h₁</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\">  </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Ioo</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsLocalMax</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">b</span>\n</code></pre></div>\n<p>which matches the <a href=\"https://en.wikipedia.org/wiki/Derivative_test#Precise_statement_of_first-derivative_test\">statement on Wikipedia</a>.</p>",
        "id": 466598643,
        "sender_full_name": "Bjørn Kjos-Hanssen",
        "timestamp": 1725133370
    },
    {
        "content": "<p>This is the PR: <a href=\"https://github.com/leanprover-community/mathlib4/pull/16351\">https://github.com/leanprover-community/mathlib4/pull/16351</a></p>",
        "id": 466605641,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1725137633
    },
    {
        "content": "<p>Nice! I took a look at the first two lemmas. You are making proofs more complicated than they need to be. The first lemma can be proven by <code>  hd₀.differentiableAt &lt;| Ioo_mem_nhds hab.1 hab.2</code> which is short enough to be inlined in the proof of the second lemma which could be</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Ioo_union_right</span><span class=\"w\"> </span><span class=\"n\">g₀</span><span class=\"w\"> </span><span class=\"bp\">▸</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">elim</span>\n<span class=\"w\">     </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hd₀</span><span class=\"bp\">.</span><span class=\"n\">differentiableAt</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Ioo_mem_nhds</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">continuousAt</span><span class=\"bp\">.</span><span class=\"n\">continuousWithinAt</span><span class=\"o\">)</span>\n<span class=\"w\">     </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">mem_singleton_iff</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"bp\">▸</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">continuousWithinAt</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>(after opening the <code>Set</code> namespace).</p>",
        "id": 466610711,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1725141472
    },
    {
        "content": "<p>More seriously, I think those lemmas are too specialized, it would be nice to have more generic versions, at least involving the union of an open set and another set instead of the special case <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>a</mi><mo separator=\"true\">,</mo><mi>b</mi><mo stretchy=\"false\">]</mo><mo>=</mo><mo stretchy=\"false\">(</mo><mi>a</mi><mo separator=\"true\">,</mo><mi>b</mi><mo stretchy=\"false\">)</mo><mo>∪</mo><mo stretchy=\"false\">{</mo><mi>b</mi><mo stretchy=\"false\">}</mo></mrow><annotation encoding=\"application/x-tex\">(a, b] = (a, b) \\cup \\{b\\}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∪</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">}</span></span></span></span>.</p>",
        "id": 466610880,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1725141612
    },
    {
        "content": "<p>If you want to study the short proof above then it will probably help to start with the following expanded version:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">hx</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Ioo_union_right</span><span class=\"w\"> </span><span class=\"n\">g₀</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hx</span>\n<span class=\"w\">  </span><span class=\"n\">rcases</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">hx</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hd₀</span><span class=\"bp\">.</span><span class=\"n\">differentiableAt</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Ioo_mem_nhds</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">continuousAt</span><span class=\"bp\">.</span><span class=\"n\">continuousWithinAt</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mem_singleton_iff</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hx</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hx</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">continuousWithinAt</span>\n</code></pre></div>",
        "id": 466611159,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1725141822
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"110031\">@Patrick Massot</span> for the feedback! So similarly the third lemma is proved by</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">      </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Ioo_union_left</span><span class=\"w\"> </span><span class=\"n\">g₁</span><span class=\"w\"> </span><span class=\"bp\">▸</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">elim</span>\n<span class=\"w\">     </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hd₁</span><span class=\"bp\">.</span><span class=\"n\">differentiableAt</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Ioo_mem_nhds</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">continuousAt</span><span class=\"bp\">.</span><span class=\"n\">continuousWithinAt</span><span class=\"o\">)</span>\n<span class=\"w\">     </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">mem_singleton_iff</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"bp\">▸</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">continuousWithinAt</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Regarding the more generic version, do you have a specific statement in mind?</p>",
        "id": 466612555,
        "sender_full_name": "Bjørn Kjos-Hanssen",
        "timestamp": 1725143134
    },
    {
        "content": "<p>Here's a proof of the fourth lemma in your style:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">differentiableOn_neg_Ioo</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hd₀</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DifferentiableOn</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">DifferentiableOn</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">▸</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">DifferentiableOn</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">differentiableOn_neg</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">hd₀</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 466615121,
        "sender_full_name": "Bjørn Kjos-Hanssen",
        "timestamp": 1725145323
    },
    {
        "content": "<p>I’m sorry I’ve been very today, so I didn’t have time to follow up.  I’m happy to see you are having fun with proof terms and the rewriting triangle. Note that one you have a proof term you almost never need  a <code>show</code> in front. You can compress your last proof to <code> (differentiableOn_neg univ).comp hd₀ fun _ _ ↦ trivial</code>.</p>",
        "id": 466753657,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1725220167
    },
    {
        "content": "<p>Understanding this kind of proof style is useful and fun, but the next thing I want to say is more important. In <code>isLocalMax_of_mono_anti</code>, you are fighting against the library. It is written in the language of filters you are probably not familiar with (I certainly wasn’t when I started playing this game). So you unfold definitions and apply lemmas translating to more familiar grounds. But in the long run you will have a lot more fun if you learn this new language. Hopefully the topology chapter of MIL could help.</p>",
        "id": 466754327,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1725220443
    },
    {
        "content": "<p>In this specific case you can write</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Filter</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">isLocalMax_of_mono_anti</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LinearOrder</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">OrderClosedTopology</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Preorder</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g₀</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g₁</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">h₀</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MonotoneOn</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Ioc</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">h₁</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AntitoneOn</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Ico</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsLocalMax</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">mem_of_superset</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Ioo_mem_nhds</span><span class=\"w\"> </span><span class=\"n\">g₀</span><span class=\"w\"> </span><span class=\"n\">g₁</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">hx</span>\n<span class=\"w\">  </span><span class=\"n\">rcases</span><span class=\"w\"> </span><span class=\"n\">le_total</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">hx'</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">hx'</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">aesop</span>\n</code></pre></div>",
        "id": 466754419,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1725220481
    },
    {
        "content": "<p>(and you could merge the first two lines if you are really enthusiastic about code golf).</p>",
        "id": 466754486,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1725220514
    },
    {
        "content": "<p>Let me translate this. By definition, the statement says: the set of points <code>{x | f x ≤ f b}</code> is a neighborhood of <code>b</code>.  The term <code>Ioo_mem g₀ g₁</code> says <code>Ioo a c</code> is a neighborhood of <code>b</code>. And, crucially, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Filter.mem_of_superset#doc\">docs#Filter.mem_of_superset</a> says, in the particular case of the filter of neighborhoods of <code>b</code> that any set that contains a neighborhood of <code>b</code> is a neighborhood of <code>b</code>. So after this line <code>you only need to prove that </code>Ioo a c<code> is contained in </code>{x | f x ≤ f b}`. The required idea is to split the discussion using <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=le_total#doc\">docs#le_total</a>. Then automation takes over in both cases.</p>",
        "id": 466755143,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1725220803
    },
    {
        "content": "<p>Of course you can also go over the board with the full proof being</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">mem_of_superset</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Ioo_mem_nhds</span><span class=\"w\"> </span><span class=\"n\">g₀</span><span class=\"w\"> </span><span class=\"n\">g₁</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">le_total</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">elim</span><span class=\"w\">  </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">aesop</span>\n</code></pre></div>",
        "id": 466755604,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1725221002
    },
    {
        "content": "<p>That's a great proof of <code>isLocalMax_of_mono_anti</code>. Verbatim the same proof proves the <code>IsLocalMin</code> version as well.<br>\nAnd thanks for <a href=\"https://leanprover-community.github.io/mathematics_in_lean/C09_Topology.html\">MIL</a> which indeed explains very well why filters.</p>",
        "id": 466762787,
        "sender_full_name": "Bjørn Kjos-Hanssen",
        "timestamp": 1725225062
    },
    {
        "content": "<p><strong>Update</strong> --- the First Derivative Test is now <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Analysis/Calculus/FirstDerivativeTest.html\">in Mathlib</a><br>\nThanks to <span class=\"user-mention\" data-user-id=\"110031\">@Patrick Massot</span> and <span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span> for the help.</p>\n<p>I have also written a proof of the Second Derivative Test in the following surprisingly(?) clean form:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- The Second-Derivative Test from calculus. -/</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">isLocalMin_of_deriv_deriv_pos</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">x₀</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x₀</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hd</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x₀</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ContinuousAt</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x₀</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsLocalMin</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x₀</span>\n</code></pre></div>\n<p>Is the assumption <code>hc</code> needed?</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Spoiler</p>\n</div><div aria-hidden=\"true\" class=\"spoiler-content\">\n<p>Yes it is needed because<br>\n<a href=\"/user_uploads/3121/GCEwF4wcBN0bOzydcvSJ999Z/Screenshot-2024-10-26-at-7.01.19PM.png\">this function</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/GCEwF4wcBN0bOzydcvSJ999Z/Screenshot-2024-10-26-at-7.01.19PM.png\" title=\"this function\"><img data-original-dimensions=\"1176x1062\" src=\"/user_uploads/thumbnail/3121/GCEwF4wcBN0bOzydcvSJ999Z/Screenshot-2024-10-26-at-7.01.19PM.png/840x560.webp\"></a></div><p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math display=\"block\" xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><msup><mi>x</mi><mn>2</mn></msup><mo separator=\"true\">,</mo><mi>x</mi><mo>&lt;</mo><mn>0</mn><mtext> and </mtext><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>x</mi><mo>≥</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">f(x)=x^2, x&lt;0 \\text{ and } x^2+1,  x \\ge 0</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0585em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9474em;vertical-align:-0.0833em;\"></span><span class=\"mord\">0</span><span class=\"mord text\"><span class=\"mord\"> and </span></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8389em;vertical-align:-0.1944em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≥</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span></span></p>\n<p>has <code>∀ x, deriv f x = 2 * x</code> and hence   <code>deriv (deriv f) 0 &gt; 0</code> and <code>deriv f 0 = 0</code>.</p>\n</div></div>\n<p>I made a <a href=\"https://github.com/leanprover-community/mathlib4/pull/18266\">#18266</a><br>\nwith the comment that it is only a first draft and still needs to be optimized and reduced in size.</p>",
        "id": 479092959,
        "sender_full_name": "Bjørn Kjos-Hanssen",
        "timestamp": 1729992868
    },
    {
        "content": "<p>(don't write <code>PR#18266</code>, write <code>#18266</code>, else your link will pointing to PR number 18266 on the repository called PR, which doesn't exist)</p>",
        "id": 479112045,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1730013943
    },
    {
        "content": "<p>maybe we should rename mathlib to PR then?</p>",
        "id": 479199855,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1730093285
    },
    {
        "content": "<p>Actually Bhavik and I have a project that should be called PR, or maybe PRPR <span aria-label=\"grinning\" class=\"emoji emoji-1f600\" role=\"img\" title=\"grinning\">:grinning:</span></p>",
        "id": 479210184,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1730100024
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"425104\">@Johannes Riesterer</span></p>",
        "id": 480221762,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1730556129
    },
    {
        "content": "<p>Thoughts about <a href=\"https://github.com/leanprover-community/mathlib4/pull/18266\">#18266</a>?</p>",
        "id": 488756446,
        "sender_full_name": "Bjørn Kjos-Hanssen",
        "timestamp": 1734059355
    },
    {
        "content": "<p>I've left some comments, but probably I'll have a bunch more when I can sit down at a computer. </p>\n<p>But is there a reason we're doing only the single variable version of this? Was there a discussion already about that which I missed?</p>",
        "id": 489098945,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1734282720
    },
    {
        "content": "<p>Thanks for the comments!<br>\nI think multivariable versions would be harder to prove. <a href=\"#narrow/channel/287929-mathlib4/topic/second.20partial.20derivative.20test\">Recent thread about it</a><br>\nI suppose the single-variable version could be deleted if/when somebody generalizes it?</p>",
        "id": 489102555,
        "sender_full_name": "Bjørn Kjos-Hanssen",
        "timestamp": 1734285476
    },
    {
        "content": "<p>Okay, <span class=\"user-mention\" data-user-id=\"347475\">@Bjørn Kjos-Hanssen ☀️</span> , after having a more thorough look just now, I think there are a plethora of issues:</p>\n<ol>\n<li>Many of the lemmas have an extra <code>deriv</code> in them which is totally unnecessary. (e.g., <code>deriv_pos_of_lt_of_slope_pos</code>, <code>deriv_neg_of_gt_of_slope_pos</code>, <code>deriv_neg_of_deriv_deriv_pos</code>, <code>deriv_pos_of_deriv_deriv_pos</code>)</li>\n<li>you keep going to intervals, but you really want to continue working with neighborhood filters.</li>\n<li>It's handy to use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=SignType.sign#doc\">docs#SignType.sign</a> or <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Real.sign#doc\">docs#Real.sign</a> to indicate sign changes on either side of <code>x₀</code>.</li>\n<li>The main theorem should be proven using <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=isLocalMin_of_deriv#doc\">docs#isLocalMin_of_deriv</a></li>\n</ol>\n<p>So, I suggest you mostly scrap what's there. And instead take these results:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">pos_of_slope_pos</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hb</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x₀</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hbf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">slope</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x₀</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x₀</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp_all</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">slope</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"o\">]</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">neg_of_slope_neg</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hb</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">x₀</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hbf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">slope</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x₀</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x₀</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp_all</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">slope</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">neg_of_mul_pos_right</span><span class=\"w\"> </span><span class=\"n\">hbf</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">le_of_lt</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">inv_lt_zero</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">linarith</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">SignType</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">eventually_nhdsWithin_sign_eq_of_deriv_pos</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x₀</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x₀</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">∀ᶠ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">𝓝</span><span class=\"w\"> </span><span class=\"n\">x₀</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sign</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">sign</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">x₀</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">nhdsWithin_compl_singleton_sup_pure</span><span class=\"w\"> </span><span class=\"n\">x₀</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">eventually_sup</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"bp\">⟨?_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simpa</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h_tendsto</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">hasDerivAt_iff_tendsto_slope</span><span class=\"bp\">.</span><span class=\"n\">mp</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">differentiableAt_of_deriv_ne_zero</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">ne_of_gt</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">hasDerivAt</span>\n<span class=\"w\">  </span><span class=\"n\">filter_upwards</span><span class=\"w\"> </span><span class=\"o\">[(</span><span class=\"n\">h_tendsto</span><span class=\"bp\">.</span><span class=\"n\">eventually</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">eventually_gt_nhds</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"o\">),</span>\n<span class=\"w\">    </span><span class=\"n\">self_mem_nhdsWithin</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">hx₀</span><span class=\"w\"> </span><span class=\"n\">hx₁</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mem_compl_iff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mem_singleton_iff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Ne</span><span class=\"bp\">.</span><span class=\"n\">eq_def</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hx₁</span>\n<span class=\"w\">  </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx'</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">hx'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">hx₁</span><span class=\"bp\">.</span><span class=\"n\">lt_or_lt</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">sign_neg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">neg_of_slope_pos</span><span class=\"w\"> </span><span class=\"n\">hx'</span><span class=\"w\"> </span><span class=\"n\">hx₀</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">sign_neg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sub_neg</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"n\">hx'</span><span class=\"o\">)]</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">sign_pos</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">pos_of_slope_pos</span><span class=\"w\"> </span><span class=\"n\">hx'</span><span class=\"w\"> </span><span class=\"n\">hx₀</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">sign_pos</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sub_pos</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"n\">hx'</span><span class=\"o\">)]</span>\n</code></pre></div>\n<p>This should allow you to easily prove the second derivative test using <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=isLocalMin_of_deriv#doc\">docs#isLocalMin_of_deriv</a> (especially if you rewrite that lemma to take the <code>sign</code> version as a hypothesis, instead of the two separate pieces; although it would probably be good to provide a rewrite lemma to go between the two also).</p>",
        "id": 489113706,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1734295728
    },
    {
        "content": "<p>Of course, you'll want to have the symmetric variants of these results also.</p>",
        "id": 489113928,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1734295932
    },
    {
        "content": "<p>Does this line of attack make sense to you?</p>",
        "id": 489114084,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1734296107
    },
    {
        "content": "<p>Another option instead of <code>sign</code> would be to say that the product is positive. Same can go (with nonnegativity) for the first derivative test.</p>",
        "id": 489123490,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1734304603
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"197836\">@Jireh Loreaux</span> , yes it's hard to shake the habit of thinking in terms of intervals rather than filters <span aria-label=\"embarrassed\" class=\"emoji emoji-1f633\" role=\"img\" title=\"embarrassed\">:embarrassed:</span> Good point about the extra <code>deriv</code>'s, too.</p>",
        "id": 489125320,
        "sender_full_name": "Bjørn Kjos-Hanssen",
        "timestamp": 1734306505
    },
    {
        "content": "<p>I've fixed all that and switched to using filters throughout with no more <code>Ioo</code> in <a href=\"https://github.com/leanprover-community/mathlib4/pull/18266\">#18266</a>. <span class=\"user-mention\" data-user-id=\"197836\">@Jireh Loreaux</span>, thanks again for suggestions and help!</p>",
        "id": 495642140,
        "sender_full_name": "Bjørn Kjos-Hanssen",
        "timestamp": 1737699518
    }
]