[
    {
        "content": "<p>Currently in mathlib the <code>Asymptotics</code> library provides Landau notation of the following form <code>f =O[l] g</code> to express that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo>=</mo><mi>O</mi><mo stretchy=\"false\">(</mo><mi>g</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">f = O(g)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mclose\">)</span></span></span></span> (along the filter <code>l</code>) and similarly for little-o, big theta, etc. </p>\n<p>In Formal Conjectures we often face statements such as the <a href=\"https://www.erdosproblems.com/90\">unit distance problem</a>, where the big O appears embedded somewhere within the right-hand expression (<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>n</mi><mrow><mn>1</mn><mo>+</mo><mi>O</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mi mathvariant=\"normal\">/</mi><mi>log</mi><mo>⁡</mo><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">n^{1 + O(1/\\log\\log n)}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.888em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.888em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mbin mtight\">+</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen mtight\">(</span><span class=\"mord mtight\">1/</span><span class=\"mspace mtight\" style=\"margin-right:0.1952em;\"></span><span class=\"mop mtight\"><span class=\"mtight\">l</span><span class=\"mtight\">o</span><span class=\"mtight\" style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace mtight\" style=\"margin-right:0.1952em;\"></span><span class=\"mop mtight\"><span class=\"mtight\">l</span><span class=\"mtight\">o</span><span class=\"mtight\" style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace mtight\" style=\"margin-right:0.1952em;\"></span><span class=\"mord mathnormal mtight\">n</span><span class=\"mclose mtight\">)</span></span></span></span></span></span></span></span></span></span></span></span> in this example). AFAIK the current mathlib notation does not allow for big O to be embedded in the RHS like this. To get around this, we often employ the following pattern. To express something like <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span> is  <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>n</mi><mrow><mn>1</mn><mo>+</mo><mi>O</mi><mo stretchy=\"false\">(</mo><mi>g</mi><mo stretchy=\"false\">)</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">n ^ {1 + O(g)}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.888em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.888em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mbin mtight\">+</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">g</span><span class=\"mclose mtight\">)</span></span></span></span></span></span></span></span></span></span></span></span>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">he</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"n\">O</span><span class=\"o\">[</span><span class=\"n\">atTop</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">),</span>\n<span class=\"w\">  </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=ᶠ</span><span class=\"o\">[</span><span class=\"n\">atTop</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>See the <a href=\"https://github.com/google-deepmind/formal-conjectures/blob/a22f98abefe3790669d6c73066dafa7163bd8912/FormalConjectures/ErdosProblems/90.lean#L74-L77\">formal conjectures repo</a> for the unit distance example. </p>\n<ol>\n<li>Is this existential pattern the canonical way to express these problems currently? </li>\n<li>Or would it be better to normalise the RHS to be of the form <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo>=</mo><mi>O</mi><mo stretchy=\"false\">(</mo><mi>g</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">f = O(g)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mclose\">)</span></span></span></span> and use the standard Landau notation? </li>\n<li>Any other suggestions on best practices here would be very welcome!</li>\n</ol>",
        "id": 566500604,
        "sender_full_name": "Salvatore Mercuri",
        "timestamp": 1767689196
    },
    {
        "content": "<p>Have you seen <a href=\"https://github.com/google-deepmind/formal-conjectures/pull/1481\">FC#1481</a>? This might be a solution to this problem</p>",
        "id": 566502523,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1767690020
    },
    {
        "content": "<p>I do believe the existential pattern fully conveys the idea behind the notation <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>n</mi><mrow><mn>1</mn><mo>+</mo><mi>O</mi><mo stretchy=\"false\">(</mo><mi>g</mi><mo stretchy=\"false\">)</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">n^{1 + O(g)}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.888em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.888em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mbin mtight\">+</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">g</span><span class=\"mclose mtight\">)</span></span></span></span></span></span></span></span></span></span></span></span> and maybe you can even just write <code> f = fun n ↦ n ^ (1 + e n)</code> as <code>he</code> has already gave you the information about the tail behavior.</p>\n<p>Also if somebody want to work on <a href=\"https://github.com/google-deepmind/formal-conjectures/pull/1481\">FC#1481</a>, feel free to do so... I need to start to learn some metaprogramming before I can really finish that PR <span aria-label=\"melting face\" class=\"emoji emoji-1fae0\" role=\"img\" title=\"melting face\">:melting_face:</span></p>",
        "id": 566608614,
        "sender_full_name": "Yongxi Lin (Aaron)",
        "timestamp": 1767727809
    },
    {
        "content": "<p>This is how I view asymptotic notation, and these are used <em>a lot</em> in the areas I am active in (combinatorics and US-style theoretical computer science).</p>\n<p>As an aside, sometimes it is convenient to have big O notation apply <em>for all</em> inputs, or (in the case of natural numbers) for all positive inputs. Presumably this is supported by the current formalism.</p>\n<p>Finally, sometimes one is interested in the value of the constants.<br>\nFor example, Ramsey's theorem implies that every 2-coloring of a graph on _n_ vertices induces a monochromatic clique of size Ω(log _n_).<br>\nThe standard inductive proof gives one constant, but this was recently improved.<br>\nThe optimal constant isn't known.<br>\nHow does one express all this information in Mathlib?</p>\n<p>More generally, what should be done when some result is known with sub-optimal quantitative dependence, but is still useful?</p>",
        "id": 566614418,
        "sender_full_name": "Yuval Filmus",
        "timestamp": 1767730189
    },
    {
        "content": "<p>We have <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Asymptotics.IsBigOWith#doc\">docs#Asymptotics.IsBigOWith</a> for explicit estimates.</p>",
        "id": 566614587,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1767730265
    },
    {
        "content": "<p>You can prove it, then deduce <code>IsBigO</code> in 1 line.</p>",
        "id": 566614700,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1767730306
    },
    {
        "content": "<p>Also, if there is a trade-off between \"better constant\" vs \"maximal <code>n</code> that breaks the estimate\" and you want to preserve this information, then you can formulate a theorem like <code>exists_isClique_mul_log_le_card_of_le_card</code></p>",
        "id": 566614981,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1767730415
    },
    {
        "content": "<p>More generally, we definitely accept results that can be improved/generalized in the future.</p>",
        "id": 566615088,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1767730468
    },
    {
        "content": "<p>If someone formalizes a better version in the future, then they can replace what's currently in the library (with some deprecation period).</p>",
        "id": 566615179,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1767730504
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/116395-maths/topic/Use.20of.20embedded.20Landau.20notation/near/566502523\">said</a>:</p>\n<blockquote>\n<p>Have you seen <a href=\"https://github.com/google-deepmind/formal-conjectures/pull/1481\">FC#1481</a>? This might be a solution to this problem</p>\n</blockquote>\n<p>Could you elaborate on this inline?</p>",
        "id": 566783031,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1767806058
    },
    {
        "content": "<p>As a concrete action here; should we include <span class=\"user-mention\" data-user-id=\"650358\">@Salvatore Mercuri</span>'s example in the module docs for Landau notation?</p>",
        "id": 566783199,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1767806108
    },
    {
        "content": "<p>I would say the existential pattern is the best way, I've been using it since the unit-fractions project and also heavily in the exponential ramsey project and it works excellently. I've always viewed it as the obvious canonical choice, but I agree we should document it.</p>",
        "id": 566790160,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1767808308
    }
]