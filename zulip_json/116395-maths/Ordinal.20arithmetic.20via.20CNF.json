[
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>\n</code></pre></div>\n\n<p>Hey all, </p>\n<p>I’m a student relatively early in my math education and decided to go ‘all in’ on interactive theorem provers. <span class=\"user-mention\" data-user-id=\"252920\">@Alex Kontorovich</span>  has been getting me up to speed on Lean this summer, and I was hoping to formalize some results about ordinal numbers using the Cantor normal form. Unfortunately, the vast majority of the tooling needed to do so doesn’t exist, so I’ll have to make it first.</p>\n<p>It’s not lost on me that that is a big effort, but it looks like there are a few smaller tasks that I may be able to break off and tackle. To start, I was hoping to get some guidance/instruction on how to best implement ordinal arithmetic listed in the “to do” items <a href=\"https://github.com/leanprover-community/mathlib4/blob/07a0ae9126dff1d2838a59b03ac6763e22ed6cb4/Mathlib/SetTheory/Ordinal/CantorNormalForm.lean\">here</a>. As it stands I have a decent handle on the math, but lack the knowledge about how to write code/API’s that integrate well into the existing environment.</p>",
        "id": 463408620,
        "sender_full_name": "Eric Vergo",
        "timestamp": 1724075176
    },
    {
        "content": "<p>Maybe team up with <span class=\"user-mention\" data-user-id=\"459227\">@Violeta Hernández</span>? <a href=\"#narrow/stream/144837-PR-reviews/topic/.2315915.20Cantor.20Normal.20Form/near/463098320\">https://leanprover.zulipchat.com/#narrow/stream/144837-PR-reviews/topic/.2315915.20Cantor.20Normal.20Form/near/463098320</a></p>",
        "id": 463453487,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1724085692
    },
    {
        "content": "<p>Y'all move fast! closing this toping and will join in on the other threads.</p>",
        "id": 463459949,
        "sender_full_name": "Eric Vergo",
        "timestamp": 1724087214
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"624658\">Eric Vergo</span> has marked this topic as resolved.</p>",
        "id": 463459957,
        "sender_full_name": "Notification Bot",
        "timestamp": 1724087216
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"459227\">Violeta Hernández</span> has marked this topic as unresolved.</p>",
        "id": 463995647,
        "sender_full_name": "Notification Bot",
        "timestamp": 1724232694
    },
    {
        "content": "<p>I'm having some trouble and I wanted to ask for advice</p>",
        "id": 463995720,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724232715
    },
    {
        "content": "<p>I've defined <code>CNF_coeff b o : Ordinal →₀ Ordinal</code>, which corresponds to the finitely supported function assigning coefficients to each exponent in the base <code>b</code> Cantor normal form of <code>o</code></p>",
        "id": 463995883,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724232765
    },
    {
        "content": "<p>This has been pretty successful, and I've developed a decently large API for this.</p>",
        "id": 463996023,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724232821
    },
    {
        "content": "<p>The issue is that I want to prove two particular statements about <a href=\"https://en.wikipedia.org/wiki/Ordinal_arithmetic#Natural_operations\">natural operations</a>, namely that the natural sum adds together the base <code>ω</code> CNFs, and the natural product multiplies them as polynomials</p>",
        "id": 463996243,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724232896
    },
    {
        "content": "<p>I've already proven the first, and I have all the necessary lemmas to prove the second, but I'm having trouble even stating it</p>",
        "id": 463996323,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724232913
    },
    {
        "content": "<p>The \"product as polynomials\" refers to the product in <code>AddMonoidAlgebra ℕ NatOrdinal</code>, which is notably not equal to <code>Ordinal →₀ Ordinal</code></p>",
        "id": 463996497,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724232947
    },
    {
        "content": "<p>I can't even easily define the product manually. Since <code>Ordinal</code> isn't commutative, the sums that appear on <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AddMonoidAlgebra.hasMul#doc\">docs#AddMonoidAlgebra.hasMul</a> are not in general well-defined, even though of course the values in the base <code>ω</code> expansion are always naturals and thus do commute over addition and multiplication</p>",
        "id": 463996899,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724233030
    },
    {
        "content": "<p>And I can't easily cast <code>CNF_coeff ω o</code> into <code>AddMonoidAlgebra ℕ NatOrdinal</code> either. I know the coefficients are less than <code>ω</code> and thus equal to some natural, but this is nonconstructive. So I'd have to use <code>Classical.choice</code>, which means no nice def-eqs are possible.</p>",
        "id": 463997353,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724233160
    },
    {
        "content": "<p>I see two ways out of this. Option A is that I make a full API for <code>CNF_coeff_omega : Ordinal →₀ ℕ</code> and state the result in terms of that. That might be useful to someone else later down the line, but it does entail a lot of boilerplate.</p>",
        "id": 463997652,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724233271
    },
    {
        "content": "<p>Option B is to define the product on <code>Ordinal →₀ Ordinal</code> through choice shenanigans. Basically, I can noncomputably convert a finsupp's finset into a list, and use that to emulate <code>Finsupp.sum</code> without commutativity. Of course, it makes my proof pretty painful and probably useless to anyone else.</p>",
        "id": 463998142,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724233433
    },
    {
        "content": "<p>I'm leaning heavily towards option A, but I wanted to get some feedback since it might be hard to justify duplicating my results like that otherwise.</p>",
        "id": 463998249,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724233465
    },
    {
        "content": "<p>Well, I chose to take option A. I don't think the duplicated API is too much of an issue - it's actually kind of nice not having to pass arguments like <code>1 &lt; ω</code> or <code>Principal (· + ·) ω</code> manually</p>",
        "id": 464166002,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724273309
    },
    {
        "content": "<p>I think I've managed to prove everything I wanted to within <a href=\"https://github.com/leanprover-community/mathlib4/tree/vi.CNF\">my branch</a>. I characterized the addition of CNFs, as well as their natural addition and multiplication. I'll slowly PR all of this over the following weeks.</p>",
        "id": 464166177,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724273381
    },
    {
        "content": "<p>Something cool I realize I can now do is define the ordinal XOR, i.e. the sum of nim heaps</p>",
        "id": 464218480,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724293393
    },
    {
        "content": "<p>And yeah, that only works thanks to <code>CNF_coeff_omega</code></p>",
        "id": 464218497,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724293411
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"459227\">Violeta Hernández</span> <a href=\"#narrow/stream/116395-maths/topic/Ordinal.20arithmetic.20via.20CNF/near/463998249\">said</a>:</p>\n<blockquote>\n<p>I'm leaning heavily towards option A, but I wanted to get some feedback since it might be hard to justify duplicating my results like that otherwise.</p>\n</blockquote>\n<p>Option A is what I was thinking of doing; even though it seems like a heavy lift. I'm going to poke around your branch for a bit, and will likely come back with a bunch of questions.</p>\n<p>Curious to see what others say.</p>",
        "id": 464342201,
        "sender_full_name": "Eric Vergo",
        "timestamp": 1724325373
    },
    {
        "content": "<p>Thanks! I desperately need feedback on all of this</p>",
        "id": 464342363,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724325406
    },
    {
        "content": "<p>FWIW I wouldn't put any weight on my opinions. I've never worked on large software projects before, so I'm just guessing.</p>",
        "id": 464343469,
        "sender_full_name": "Eric Vergo",
        "timestamp": 1724325676
    },
    {
        "content": "<p>There's one particular thing that would help a lot. The names <code>CNF_coeff</code> and particularly <code>CNF_omega_coeff</code> are very wordy</p>",
        "id": 464492013,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724366310
    },
    {
        "content": "<p>Does anyone have a better idea? The former is the function <code>Ordinal →₀ Ordinal</code> mapping exponents to coefficients in a base <code>b</code> CNF, while the latter is for base <code>ω</code> and is specialized to <code>Ordinal →₀ ℕ</code>.</p>",
        "id": 464492101,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724366378
    },
    {
        "content": "<p>btw, my branch now contains a definition of the ordinal XOR and a proof of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.xor_trichotomy#doc\">docs#Nat.xor_trichotomy</a> for it!</p>",
        "id": 464506664,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724370413
    },
    {
        "content": "<p>This will allow us to state a more general form of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=SetTheory.PGame.grundyValue_nim_add_nim#doc\">docs#SetTheory.PGame.grundyValue_nim_add_nim</a></p>",
        "id": 464506836,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724370454
    },
    {
        "content": "<p>...PRing all of this might take a while<br>\n<a href=\"/user_uploads/3121/bFH16JCCShNDpMy6-zNTLLJf/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/bFH16JCCShNDpMy6-zNTLLJf/image.png\" title=\"image.png\"><img data-original-dimensions=\"555x44\" src=\"/user_uploads/thumbnail/3121/bFH16JCCShNDpMy6-zNTLLJf/image.png/840x560.webp\"></a></div>",
        "id": 464507078,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724370505
    }
]