[
    {
        "content": "<p>Is it ok to also post the link to the arXiv version of the article?</p>",
        "id": 426355990,
        "sender_full_name": "Florent Schaffhauser",
        "timestamp": 1710341066
    },
    {
        "content": "<p>Here the <a href=\"https://ujm.hal.science/ujm-04222610\">HAL</a> (but I think that <a href=\"https://dl.acm.org/doi/pdf/10.1145/3636501.3636942\">this</a> should be free)</p>",
        "id": 426356454,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1710341179
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"300245\">Filippo A. E. Nuccio</span> <a href=\"#narrow/stream/113486-announce/topic/Local.20fields.20in.20Lean.204/near/426356454\">said</a>:</p>\n<blockquote>\n<p>but I think that <a href=\"https://dl.acm.org/doi/pdf/10.1145/3636501.3636942\">this</a> should be free</p>\n</blockquote>\n<p>Only the abstract and reference list (for me right now, not on a university network).</p>",
        "id": 426356982,
        "sender_full_name": "Florent Schaffhauser",
        "timestamp": 1710341311
    },
    {
        "content": "<p>Long Live Free Repositories <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span> <span aria-label=\"free\" class=\"emoji emoji-1f193\" role=\"img\" title=\"free\">:free:</span></p>",
        "id": 426357074,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1710341336
    },
    {
        "content": "<p>This is great! We all know it‚Äôs no fun at all to return to some job that seemed finish and fight the system to port it.</p>",
        "id": 426362336,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1710342620
    },
    {
        "content": "<p>5 messages were moved here from <a class=\"stream-topic\" data-stream-id=\"113486\" href=\"/#narrow/stream/113486-announce/topic/Local.20fields.20in.20Lean.204\">#announce &gt; Local fields in Lean 4</a> by <span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span>.</p>",
        "id": 426365407,
        "sender_full_name": "Notification Bot",
        "timestamp": 1710343372
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"406490\">@Mar√≠a In√©s de Frutos Fern√°ndez</span> <span class=\"user-mention\" data-user-id=\"300245\">@Filippo A. E. Nuccio</span> Awesome! Great job! Looking forward to the PRs.</p>",
        "id": 426365484,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1710343395
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/stream/116395-maths/topic/Local.20fields.20in.20Lean.204/near/426365484\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"406490\">Mar√≠a In√©s de Frutos Fern√°ndez</span> <span class=\"user-mention silent\" data-user-id=\"300245\">Filippo A. E. Nuccio</span> Awesome! Great job! Looking forward to the PRs.</p>\n</blockquote>\n<p>Sure? We'll ping you for each of them... <span aria-label=\"wink\" class=\"emoji emoji-1f609\" role=\"img\" title=\"wink\">:wink:</span></p>",
        "id": 426365605,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1710343429
    },
    {
        "content": "<p>We are preparing a PR containing this (with all the sorries filled) into mathlib at the class field theory workshop at Oxford (with the help of Yakov and Kenny and others). I believe this stemmed from a secret negotiation between people who care about this the most so I assume people are already somewhat happy about it, but I shall post it here first to gather feedback. </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">IsNonarchLocalField</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ValuativeRel</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">UniformSpace</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">extends</span>\n<span class=\"w\">  </span><span class=\"n\">IsUniformAddGroup</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">ValuativeTopology</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">LocallyCompactSpace</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">ValuativeRel</span><span class=\"bp\">.</span><span class=\"n\">IsNontrivial</span><span class=\"w\"> </span><span class=\"n\">K</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">ValuativeRel</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">IsNonarchLocalField</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ValuativeRel</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">UniformSpace</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">IsNonarchLocalField</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsTopologicalDivisionRing</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstance</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CompactSpace</span><span class=\"w\"> </span><span class=\"n\">ùí™</span><span class=\"o\">[</span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsDiscreteValuationRing</span><span class=\"w\"> </span><span class=\"n\">ùí™</span><span class=\"o\">[</span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ValuativeRel</span><span class=\"bp\">.</span><span class=\"n\">IsDiscrete</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ValuativeRel</span><span class=\"bp\">.</span><span class=\"n\">IsRankLeOne</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CompleteSpace</span><span class=\"w\"> </span><span class=\"n\">ùí™</span><span class=\"o\">[</span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finite</span><span class=\"w\"> </span><span class=\"n\">ùìÄ</span><span class=\"o\">[</span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CompleteSpace</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">IsNonarchLocalField</span>\n</code></pre></div>",
        "id": 530522781,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1753352312
    },
    {
        "content": "<p>Should we ping the relevant people?</p>",
        "id": 530525304,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1753353149
    },
    {
        "content": "<p>(in particular we <em>believe</em> we can fill all the sorries here just with those 4 assumptions)</p>",
        "id": 530528296,
        "sender_full_name": "David Ang",
        "timestamp": 1753354266
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"464700\">David Ang</span> <a href=\"#narrow/channel/116395-maths/topic/Local.20fields.20in.20Lean.204/near/530528296\">said</a>:</p>\n<blockquote>\n<p>(in particular we <em>believe</em> we can fill all the sorries here just with those 4 assumptions)</p>\n</blockquote>\n<p>No they are actually sorry free.</p>",
        "id": 530532017,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1753355595
    },
    {
        "content": "<p>Ah, you managed to fill rank le one!</p>",
        "id": 530538057,
        "sender_full_name": "David Ang",
        "timestamp": 1753357197
    },
    {
        "content": "<p>Thank you for compiling all of this! Will there be a helper constructor for the instance that rather than take a LocallyCompactSpace argument, takes simpler ones like the various ValuativeRel instances + CompleteSpace? Because it seems challenging proving that, e. g. F((T)), is locally compact without first proving all of the conclusions listed.</p>",
        "id": 530548582,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1753359575
    },
    {
        "content": "<p>Or, more relevant to (L)CFT, K_v for K a number field and v a place.</p>",
        "id": 530556815,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1753361644
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"308899\">@Yakov Pechersky</span> sorry, could you be more specific on what the helper constructor should look like?</p>",
        "id": 530569216,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1753365170
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">IsNonarchLocalField</span><span class=\"bp\">.</span><span class=\"n\">mk'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ValuativeRel</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">UniformSpace</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsUniformAddGroup</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ValuativeTopology</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ValuativeRel</span><span class=\"bp\">.</span><span class=\"n\">IsNontrivial</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ValuativeRel</span><span class=\"bp\">.</span><span class=\"n\">IsDiscrete</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ValuativeRel</span><span class=\"bp\">.</span><span class=\"n\">IsRankLeOne</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CompleteSpace</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsNonarchLocalField</span><span class=\"w\">  </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"c1\">-- this one installs the topology and UniformSpace etc structure from `Valuation.subgroups_range_basis`, from #27314</span>\n<span class=\"c1\">-- https://github.com/leanprover-community/mathlib4/pull/27314/files#diff-e5cabd8cf65825ec8f06f06e9f50c80c48c36996bad6b09e6691642fc1506542R96</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">IsNonarchLocalField</span><span class=\"bp\">.</span><span class=\"n\">mk_with_uniformSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ValuativeRel</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ValuativeRel</span><span class=\"bp\">.</span><span class=\"n\">IsNontrivial</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ValuativeRel</span><span class=\"bp\">.</span><span class=\"n\">IsDiscrete</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ValuativeRel</span><span class=\"bp\">.</span><span class=\"n\">IsRankLeOne</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 530571311,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1753365719
    },
    {
        "content": "<p>Have you also proven <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/RingTheory/Valuation/Discrete/Basic.html#Valuation.IsRankOneDiscrete\">Valuation.IsRankOneDiscrete</a> for the  <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/RingTheory/Valuation/ValuativeRel.html#ValuativeRel.valuation\">ValuativeRel.valuation</a> (or more generally, for a compatible valuation)?</p>",
        "id": 530580296,
        "sender_full_name": "Mar√≠a In√©s de Frutos Fern√°ndez",
        "timestamp": 1753368182
    },
    {
        "content": "<p>Not yet tried. But I assume one should prove that for all <code>ValuativeRel.IsDiscrete K</code> + <code>ValuativeRel.IsRankLeOne K</code> (and perhaps + nontrivial).</p>",
        "id": 530592294,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1753371605
    },
    {
        "content": "<p>BTW it would be helpful if someone can first review/merge <a href=\"https://github.com/leanprover-community/mathlib4/pull/27430\">#27430</a> <span aria-label=\"wink\" class=\"emoji emoji-1f609\" role=\"img\" title=\"wink\">:wink:</span></p>",
        "id": 530601331,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1753374316
    },
    {
        "content": "<p>to recap, the above definition says:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">IsNonarchLocalField</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ValuativeRel</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">UniformSpace</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">extends</span>\n<span class=\"w\">  </span><span class=\"n\">IsUniformAddGroup</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">ValuativeTopology</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">LocallyCompactSpace</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">ValuativeRel</span><span class=\"bp\">.</span><span class=\"n\">IsNontrivial</span><span class=\"w\"> </span><span class=\"n\">K</span>\n</code></pre></div>",
        "id": 530731556,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1753435427
    },
    {
        "content": "<p>i have a question to ask the communtiy, because now we've removed a lot of axioms, and we've discovered that \"uniform space\" wasn't really used in the axioms</p>",
        "id": 530731656,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1753435457
    },
    {
        "content": "<p>I think we are doing </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">IsNonarchLocalField</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ValuativeRel</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">extends</span>\n<span class=\"w\">  </span><span class=\"n\">IsTopologicalAddGroup</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">ValuativeTopology</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">LocallyCompactSpace</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">ValuativeRel</span><span class=\"bp\">.</span><span class=\"n\">IsNontrivial</span><span class=\"w\"> </span><span class=\"n\">K</span>\n</code></pre></div>\n<p>instead</p>",
        "id": 530731914,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1753435531
    },
    {
        "content": "<p>yes, that's the alternative definition we want to propose, and then the plan is that whenever we need the uniform structure, we'll add that to the assumptions.</p>",
        "id": 530732045,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1753435578
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/27465\">#27465</a> (and in particular <a href=\"https://github.com/erdOne/mathlib4/blob/erd1/LocalField/Mathlib/NumberTheory/LocalField/Basic.lean\">this file</a>) contains the aforementioned definition and the instances.<br>\n(This depends on <a href=\"https://github.com/leanprover-community/mathlib4/pull/27412\">#27412</a> which depends on <a href=\"https://github.com/leanprover-community/mathlib4/pull/27430\">#27430</a>)</p>",
        "id": 530753965,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1753443312
    },
    {
        "content": "<p>I think being a topological group should follow from being a valuative topology, in case you want to minimize further!</p>",
        "id": 530761976,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1753446169
    },
    {
        "content": "<p>congrats on this work btw!</p>",
        "id": 530762061,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1753446193
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"243562\">Adam Topaz</span> <a href=\"#narrow/channel/116395-maths/topic/Local.20fields.20in.20Lean.204/near/530761976\">said</a>:</p>\n<blockquote>\n<p>I think being a topological group should follow from being a valuative topology, in case you want to minimize further!</p>\n</blockquote>\n<p>Valuative topology only describes the neighborhoods of 0 I think.</p>",
        "id": 530763644,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1753446668
    },
    {
        "content": "<p>oh youre right. maybe we should change it to describe the nbhds of any element?</p>",
        "id": 530789114,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1753454208
    },
    {
        "content": "<p>somehow in my mind being a topological group should follow from having the topology induced by the valuation, and, yes, for that we would need to say something about the nbhds of any point</p>",
        "id": 530789364,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1753454289
    },
    {
        "content": "<p>Equivalently you can add that translation are homeomorphisms.</p>",
        "id": 530789649,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1753454377
    },
    {
        "content": "<p>stated in terms of pushing nhd to nhd.</p>",
        "id": 530789755,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1753454405
    },
    {
        "content": "<blockquote>\n<p>translation are homeomorphisms.</p>\n</blockquote>\n<p>I think that is exactly <code>ContinuousAdd</code> (on groups)?</p>",
        "id": 530789948,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1753454461
    },
    {
        "content": "<p>No, ContinuousAdd asks that addition is continuous of both variables.</p>",
        "id": 530793570,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1753455502
    },
    {
        "content": "<p>If you simply take a random filter as neighborhoods of zero and carry it around by translation then you don‚Äôt always get a topological group, but translations will be ‚Äúhomeomorphisms‚Äù by construction.</p>",
        "id": 530794142,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1753455666
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AddGroupFilterBasis#doc\">docs#AddGroupFilterBasis</a> tells you what to ask about (a basis of) your filter to get a topology that is a group topology.</p>",
        "id": 530794460,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1753455767
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ContinuousConstVAdd#doc\">docs#ContinuousConstVAdd</a> gives you translations are homeomorphisms (is there a better way to state it?)</p>",
        "id": 530821810,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1753465754
    },
    {
        "content": "<p>so, for the sake of consensus, let me once again recap <a href=\"https://github.com/leanprover-community/mathlib4/pull/27465/files#diff-fc990e2b97d01375f025e109fdfcfe8d40aa659ea5a886f0faf274d8fb0598c6R41-R45\">the definition in Andrew's PR #27465</a>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">IsNonarchLocalField</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ValuativeRel</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">extends</span>\n<span class=\"w\">  </span><span class=\"n\">IsTopologicalAddGroup</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">ValuativeTopology</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">LocallyCompactSpace</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">ValuativeRel</span><span class=\"bp\">.</span><span class=\"n\">IsNontrivial</span><span class=\"w\"> </span><span class=\"n\">K</span>\n</code></pre></div>\n<p>Does anyone have any (significant) objection to this definition?</p>",
        "id": 531319716,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1753695136
    },
    {
        "content": "<p>You're bundling <code>IsTopologicalAddGroup</code> but when your space is also a <code>UniformSpace</code> you have to additionally state <code>IsUniformAddGroup</code> and then the <code>IsTopologicalAddGroup</code> forks is kind of useless</p>",
        "id": 531328422,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1753697819
    },
    {
        "content": "<p>I claim we seldom care / need that it is a uniform space in statements</p>",
        "id": 531334580,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1753699607
    },
    {
        "content": "<p>when we do analysis we want completeness right</p>",
        "id": 531336278,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1753699958
    },
    {
        "content": "<p>like exp</p>",
        "id": 531336307,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1753699961
    },
    {
        "content": "<p>but yeah i don't think this is a good enough reason (at least for me) to add IsUniformAddGroup to the assumptions</p>",
        "id": 531336536,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1753700017
    },
    {
        "content": "<p>There was some notation whose history I‚Äôm a bit confused about:</p>\n<ul>\n<li>We have <code>\\MCO K</code> for rings of integers of number fields and function fields and <code>\\McO[K]</code> for valuation rings of valued fields. Why square brackets for one and space for the other? Is the different font necessary because <code>\\MCO K_p</code> cannot be distinguished from <code>(\\MCO K)_p</code>? We should add module docstrings for these notations in any case.</li>\n<li>We have <code>\\McO[K]</code> in two different files <code>Topology.Algebra.Valued.ValuedField</code> and <code>Topology.Algebra.Valued.ValuativeRel</code>, so we can‚Äôt open both scopes but they‚Äôre both often used in the same file to get some instances. I think we should remove this duplication.</li>\n</ul>",
        "id": 531559796,
        "sender_full_name": "David Ang",
        "timestamp": 1753781549
    },
    {
        "content": "<p>Links:</p>\n<ul>\n<li><a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/NumberTheory/NumberField/Basic.html#NumberField.termùìû\">ùìû K for number field</a></li>\n<li><a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Topology/Algebra/Valued/ValuativeRel.html#ValuativeRel.¬´termùí™[_]¬ª\">ùí™[K] for valuative rel</a></li>\n</ul>",
        "id": 531560251,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1753781696
    },
    {
        "content": "<p>Removing the duplication of notation relies on getting rid of Valued. That is slowly in progress. The duplication of notation was added to help assist in the refactor.</p>",
        "id": 531571240,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1753784930
    },
    {
        "content": "<p>Is the plan still to replace <code>Valued</code> by <code>ValuativeRel</code>?  That was my impression, but I have been given conflicting answers about this. <br>\n<span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> <span class=\"user-mention\" data-user-id=\"243562\">@Adam Topaz</span></p>",
        "id": 531632110,
        "sender_full_name": "Mar√≠a In√©s de Frutos Fern√°ndez",
        "timestamp": 1753801076
    },
    {
        "content": "<p>I just want a definition of nonarch local field that everyone is happy with. We certainly need an API for ValuativeRel mimicking the Valued API but I don't see why we should delete Valued because perhaps sometimes you really do only care about one specific NNReal-valued valuation on a field and you can make a local instance or whatever if it's on a concrete object like Q or the splitting field of X^2+1 over Q_3 etc</p>",
        "id": 531639090,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1753802778
    },
    {
        "content": "<p>This contradicts the documentation on the <code>Mathlib.Topology.Algebra.Valued.ValuationTopology</code> file:</p>\n<blockquote>\n<p>The <code>Valued</code> class defined in this file will eventually get replaced with <code>ValuativeRel</code> from <code>Mathlib.RingTheory.Valuation.ValuativeRel</code>. New developments on valued rings/fields should take this into considation.</p>\n</blockquote>",
        "id": 531641120,
        "sender_full_name": "Mar√≠a In√©s de Frutos Fern√°ndez",
        "timestamp": 1753803280
    },
    {
        "content": "<p>I think we should get rid of Valued and just carry around a valuation that is <code>Compatible</code> in the case Kevin mentioned. I don‚Äôt think this is any more cumbersome. We might need a typeclass saying that a <code>Norm</code> instance is compatible with a valuation (or a <code>RankOne</code>) on it.</p>",
        "id": 531650764,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1753806035
    },
    {
        "content": "<p>I think that keeping <code>Valued</code> around is perfectly reasonable to do for now. Eventually we should probably phase it out and do things as Andrew suggests, but I understand that there was quite a lot of work done on top of <code>Valued</code> (some of which is not in mathlib), so I don't think we necessarily need to rush to delete <code>Valued</code> from the library.</p>",
        "id": 531659694,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1753808692
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/116395-maths/topic/Local.20fields.20in.20Lean.204/near/531319716\">said</a>:</p>\n<blockquote>\n<p>so, for the sake of consensus, let me once again recap <a href=\"https://github.com/leanprover-community/mathlib4/pull/27465/files#diff-fc990e2b97d01375f025e109fdfcfe8d40aa659ea5a886f0faf274d8fb0598c6R41-R45\">the definition in Andrew's PR #27465</a>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">IsNonarchLocalField</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ValuativeRel</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">extends</span>\n<span class=\"w\">  </span><span class=\"n\">IsTopologicalAddGroup</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">ValuativeTopology</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">LocallyCompactSpace</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">ValuativeRel</span><span class=\"bp\">.</span><span class=\"n\">IsNontrivial</span><span class=\"w\"> </span><span class=\"n\">K</span>\n</code></pre></div>\n<p>Does anyone have any (significant) objection to this definition?</p>\n</blockquote>\n<p>In terms of this, I think this is a perfectly reasonable definition. We should keep in mind that <code>ValuativeTopology</code> is only \"correct\" if we also assume <code>IsTopologicalAddGroup</code> (or something slightly weaker). The only change I would suggest is to redefine <code>ValuativeTopology</code> to say something about the nbhds of any point, as we discussed in the thread above. </p>\n<p>With such a change to <code>ValuativeTopology</code>, by assuming <code>[ValuativeTopology K] [UniformSpace K]</code> it would be possible to provide instances of <code>[IsTopologicalDivisionRing K]</code></p>",
        "id": 531660083,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1753808800
    },
    {
        "content": "<p>My proposal is to deprecate the construction of explicit <code>Valued</code> instances, and instead rely on the one we currently have implied by <code>ValuativeTopology</code>. That way, we can keep the Valued API without having competing instances.</p>",
        "id": 531662269,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1753809479
    },
    {
        "content": "<p>Oh ok I guess i can easily imagine a world with <code>Valued</code> gone one day, I think Adam's suggestion is perfectly viable and it could be a long-term project to just deprecate it?</p>",
        "id": 531697946,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1753822739
    },
    {
        "content": "<p>You can't use Valued.v but you can just use v instead</p>",
        "id": 531698042,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1753822774
    },
    {
        "content": "<p>following the discussion above, I will redefine <code>ValuativeTopology</code> today (cc <span class=\"user-mention\" data-user-id=\"308899\">@Yakov Pechersky</span> ). Is there anything I should look out for?</p>",
        "id": 532678413,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754297360
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/26845\">#26845</a> . Can you base your PR on top of that? Otherwise whichever PR of yours and mine lands first will cause problems for the other one.</p>",
        "id": 532720893,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1754311742
    },
    {
        "content": "<p>Why is this PR a month old?</p>",
        "id": 532721892,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754312080
    },
    {
        "content": "<p>Because I made a 3-line PR expecting it to go straight in, there was a pause while we waited for a reviewer, it was then pointed out that I hadn't deprecated the old version on the day I left for a family holiday, I was then on holiday for a week and then in Oxford for a week, and then I noticed it wasn't in and by this time the lemmas were accruing so it took me some time to re-do the PR.</p>",
        "id": 532723602,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1754312629
    },
    {
        "content": "<p>I have created <a href=\"https://github.com/leanprover-community/mathlib4/pull/27939\">#27939</a> and now I will implement the suggestions I received...</p>",
        "id": 532731875,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754315367
    },
    {
        "content": "<p>aha, I linked to <a href=\"https://github.com/leanprover-community/mathlib4/pull/26845\">#26845</a>, and then realised that it got merged just now <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 532742816,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754318919
    },
    {
        "content": "<p>It is now pre-merged <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span></p>",
        "id": 532809923,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754349587
    },
    {
        "content": "<p>I was <a href=\"https://github.com/leanprover-community/mathlib4/pull/27465/files#r2398256088\">suggested</a> by <span class=\"user-mention\" data-user-id=\"300245\">@Filippo A. E. Nuccio</span> to ask on the zulip (and especially <span class=\"user-mention\" data-user-id=\"110031\">@Patrick Massot</span>) about the design choice around <code>UniformSpace</code>.</p>\n<p>The current choice is </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">IsNonarchimedeanLocalField</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ValuativeRel</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">extends</span>\n<span class=\"w\">  </span><span class=\"n\">IsValuativeTopology</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">LocallyCompactSpace</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ValuativeRel</span><span class=\"bp\">.</span><span class=\"n\">IsNontrivial</span><span class=\"w\"> </span><span class=\"n\">K</span>\n</code></pre></div>\n<p>And the suggested alternative is </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">IsNonarchimedeanLocalField</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ValuativeRel</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">UniformSpace</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">extends</span>\n<span class=\"w\">  </span><span class=\"n\">IsUniformAddGroup</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">IsValuativeTopology</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">LocallyCompactSpace</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ValuativeRel</span><span class=\"bp\">.</span><span class=\"n\">IsNontrivial</span><span class=\"w\"> </span><span class=\"n\">K</span>\n</code></pre></div>\n<p>The reason why I prefer the former is:</p>\n<ol>\n<li>It enables us to talk about topological spaces being local fields without first putting on a uniform space structure. Although there is a unique sensible one, there might be multiple non-defeq ones. </li>\n<li>It is easier to prove <code>IsUniformAddGroup K</code> once you have <code>IsNonarchimedeanLocalField K</code>, instead of trying to prove them in one go. </li>\n<li>One loses no functionality as one could write <code>[IsNonarchimedeanLocalField K] [UniformSpace K] [IsUniformAddGroup K]</code> to recover the latter behaviour.</li>\n<li>One seldom needs a <code>UniformSpace</code> structure in statements so the invocation in the previous point is rare. </li>\n</ol>\n<p>And I personally don't see the benefit of the latter.</p>",
        "id": 542711300,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1759402367
    },
    {
        "content": "<p>Just for the context (and why I asked this in the first place), I would prefer bundling the uniform structure for three reasons:</p>\n<ol>\n<li>It aligns better with the suggestion in <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Topology/Algebra/IsUniformGroup/Defs.html#IsUniformGroup\">the docstring</a> where the uniform structure on a group is provided;</li>\n<li>It allows to manually add several calls of the form <code>letI := isUniformAddGroup_of_addCommGroup (G := K)</code> in proofs (like <a href=\"https://github.com/leanprover-community/mathlib4/pull/27465/files#diff-fc990e2b97d01375f025e109fdfcfe8d40aa659ea5a886f0faf274d8fb0598c6R68\">here</a>)</li>\n<li>From the forgetful inheritance perspective, it would be a bad practice to define a new instance (the uniformity) on such a field if it does not come from erasure of data.</li>\n</ol>",
        "id": 542712340,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1759402776
    },
    {
        "content": "<p>I agree because of 1.</p>",
        "id": 542716574,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759404308
    },
    {
        "content": "<p>The reason why I view these as non-benifits are</p>\n<ol>\n<li>\n<p>I think this question should be evaluated on its own merit, and the docstring should merely be a description of the best approach and could be easily changed if necessary. Of course there must be a reason why the docstring is written this way so I totally agree that asking on Zulip would be helpful. <br>\nIn particular I think the usual convention should be to only require¬†<code>UniformSpace</code>¬†when the statement requires it (e.g. we prefer assuming¬†<code>Finite</code>¬†and doing¬†<code>cases nonempty_fintype</code>¬†in proofs unless the statement requires¬†<code>Fintype</code>; especially for data carrying typeclasses).</p>\n</li>\n<li>\n<p>I don't think golfing has high priority when choosing definitions. And a big portion of them are actually symptoms of parts of mathlib superfluously requiring <code>UniformSpace</code> (e.g. <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Valued#doc\">docs#Valued</a>) </p>\n</li>\n<li>I don't understand this point fully. To me, forgetful inheritance seems to be implemented in both approaches allow arbitrary <code>UniformSpace</code> and <code>TopologicalSpace</code> structure.</li>\n</ol>",
        "id": 542716876,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1759404415
    },
    {
        "content": "<p>I guess after this I should clarify, I agree based on the reasoning provided in 1's docstring but I have not evaluated the claim of the docstring; that is to say, I would wait for Patrick to show up.</p>",
        "id": 542717320,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759404512
    },
    {
        "content": "<p>Certainly waiting for Patrick is a good idea! My two cents are that the claim in the docstring is not very far from my point 3, but at any rate I try to clarify what I meant.</p>\n<p>With the current design, you get a <code>UniformStructure</code> on a Local Field by <em>adding</em> some structure (the uniformity), although this is somewhat canonical; if you embed the <code>UniformStructure</code> in it, the arrow <code>NonArchLF -&gt; UniformSpace</code> becomes just an erasure. Am I missing something that you have in mind, <span class=\"user-mention\" data-user-id=\"439483\">@Andrew Yang</span> ?</p>",
        "id": 542751950,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1759414204
    },
    {
        "content": "<p>If I read correctly, the current design works fine with <code>[TopologicalSpace K]</code> around, while the new one will require <code>[UniformSpace K]</code> (which is a stronger assumption apparently, although they are in fact equivalent in this context). If that's indeed the case, I would prefer the current design because it requires less assumptions (and topological spaces are less scary than uniform spaces for many people). Do you need the uniform structure for the statement of many definitions / theorems (for instance in terms of completeness)?</p>",
        "id": 542757005,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1759415407
    },
    {
        "content": "<p>Yes, we need it all the time, because completeness is the key for many properties of nonarchimedean local fields.</p>",
        "id": 542757221,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1759415457
    },
    {
        "content": "<p>I don't think we need them in the <strong><em>statements</em></strong>, which is what S√©bastien was asking.</p>",
        "id": 542757678,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1759415554
    },
    {
        "content": "<p>But a locally compact topological field is automatically complete for its uniform structure, right? So the current set of assumptions already implies completeness. My question is really about the statements of theorems, not the proofs.</p>",
        "id": 542757843,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1759415591
    },
    {
        "content": "<p>OK, I see your (and Andrew's) point.</p>",
        "id": 542757973,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1759415625
    },
    {
        "content": "<p>And what about my point 3? One problem we encountered with <span class=\"user-mention\" data-user-id=\"406490\">@Mar√≠a In√©s de Frutos Fern√°ndez</span> is the following set-up: suppose that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>L</mi><mi mathvariant=\"normal\">/</mi><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">L/K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mord\">/</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span> is a finite extension of nonarchimedean fields, and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>F</mi></mrow><annotation encoding=\"application/x-tex\">F</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span></span></span></span> is an intermediate extension. You want type class inference to deduce that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>F</mi></mrow><annotation encoding=\"application/x-tex\">F</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span></span></span></span> is also a nonarchimedean field. If you only need to give it a topology, it will be the one induced from <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>L</mi></mrow><annotation encoding=\"application/x-tex\">L</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">L</span></span></span></span>, and now it will have two possible (equal, of course) uniformities, one from <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>L</mi></mrow><annotation encoding=\"application/x-tex\">L</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">L</span></span></span></span> and one since it is a loc. compact field. But if to prove it is a nonarchimedean field you need to fix the uniformity, no diamond can occur.</p>",
        "id": 542761061,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1759416344
    },
    {
        "content": "<p>I think I agree with Andrew here. If we use </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">IsNonarchimedeanLocalField</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ValuativeRel</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">extends</span>\n<span class=\"w\">  </span><span class=\"n\">IsValuativeTopology</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">LocallyCompactSpace</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ValuativeRel</span><span class=\"bp\">.</span><span class=\"n\">IsNontrivial</span><span class=\"w\"> </span><span class=\"n\">K</span>\n</code></pre></div>\n<p>and assume <code>[UniformSpace K]</code>, we can still talk about <code>[IsNonarchimedeanLocalField K]</code> since the topological space structure is inferred, we can provide an instance of <code>IsUniformAddGroup K</code> which is a <code>Prop</code>.</p>",
        "id": 542761152,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1759416364
    },
    {
        "content": "<p>I think our messages overlapped, it is still unclear to me how the intermediate field would not end up with two uniformities.</p>",
        "id": 542763018,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1759416832
    },
    {
        "content": "<p>I view this example as a support for the first approach though. In the second approach, If you prove that it is a local field with the first uniformity, then you are hard stuck if you somehow end up with the second uniformity. But with the first approach, you prove that the underlying topology gives you a local field, and then lemmas will work fine with both uniformities.</p>",
        "id": 542765568,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1759417367
    },
    {
        "content": "<p>wait which two uniformities can we have here</p>",
        "id": 542774347,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1759419548
    },
    {
        "content": "<p>we should always only have one uniformity</p>",
        "id": 542774438,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1759419566
    },
    {
        "content": "<p>You could have the left uniformity, the right uniformity, or the induced uniformity, which should all be equal but not necessarily defeq.</p>",
        "id": 542774951,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1759419696
    },
    {
        "content": "<p>One is <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=instUniformSpaceSubtype#doc\">docs#instUniformSpaceSubtype</a> and the other is <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsTopologicalGroup.toUniformSpace#doc\">docs#IsTopologicalGroup.toUniformSpace</a></p>",
        "id": 542774999,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1759419711
    },
    {
        "content": "<p>Why would you have <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsTopologicalGroup.toUniformSpace#doc\">docs#IsTopologicalGroup.toUniformSpace</a></p>",
        "id": 542775618,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1759419860
    },
    {
        "content": "<p>it's not an instance</p>",
        "id": 542775652,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1759419869
    },
    {
        "content": "<p>you will not have it</p>",
        "id": 542775772,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1759419905
    },
    {
        "content": "<p>I agree that it would not be there automatically, but it can be there.</p>",
        "id": 542775787,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1759419908
    },
    {
        "content": "<p>And I think this was the whole point of the docstring of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsTopologicalGroup.toUniformSpace#doc\">docs#IsTopologicalGroup.toUniformSpace</a></p>",
        "id": 542775924,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1759419949
    },
    {
        "content": "<p>well I think the only way it will be there is if you put it there and at that point it's kind of your own fault</p>",
        "id": 542775991,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1759419974
    },
    {
        "content": "<p>The problem is that if I need one at a certain point, I'll need to pick up one (both are equal mathematically) and there's no preferred choice.</p>",
        "id": 542776204,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1759420032
    },
    {
        "content": "<p>the solution is to add it to your assumptions at the top</p>",
        "id": 542776381,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1759420083
    },
    {
        "content": "<p>unless it doesn't appear in the statement in which case you shouldn't get a conflict (since it's not in the statement)</p>",
        "id": 542776464,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1759420114
    },
    {
        "content": "<p>Note that we have the tactic <code>borelize</code> which puts the standard Borel measure space structure on a topological space; maybe we need some analogous tactic putting the standard uniform space structure on a topological group for convenience in a proof. I am not as convinced as Aaron is that we won't randomly pick up random non-defeq uniform space instances, but as Sebastien points out if these things are not showing up in theorem statements (and I think they're not) then I'm also voting for the current design. I am acutely aware of the disruption that this is causing to Filippo and Maria Ines' work and this is not a decision I am taking lightly; I am also aware that this discussion has been going on for over a year now, and am happy to admit that I had absolutely no idea how complex the question \"how to define nonarchimedean local fields in mathlib\" would turn out to be. This was not a question I was taking too seriously for a long time, but it clearly needs to be taken very seriously, and has been taken seriously by the community over the last few months. I only hope that now we are near the end of the discussion, but I fear that there is still plenty of work to do ensuring that our ultimate decision is the right one.</p>\n<p>More generally discussions like this do I think reveal that our decisions about how to set up topology and algebra in mathlib (via typeclasses) have left us with very complex problems, which so far we have mostly solved, but we certainly have not solved completely; issue <a href=\"https://github.com/leanprover-community/mathlib4/pull/7152\">#7152</a> is an example of something which is still unresolved and is causing problems in FLT (perhaps because I am pig-headedly refusing to bow to the design decision of changing whether I write <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>A</mi><mo>‚äó</mo><mi>B</mi></mrow><annotation encoding=\"application/x-tex\">A\\otimes B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">A</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">‚äó</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span></span> or <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>B</mi><mo>‚äó</mo><mi>A</mi></mrow><annotation encoding=\"application/x-tex\">B\\otimes A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">‚äó</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">A</span></span></span></span> depending on whether I want this thing to be an <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi></mrow><annotation encoding=\"application/x-tex\">R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span></span>-module or an <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi></mrow><annotation encoding=\"application/x-tex\">S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span></span></span></span>-module, if <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi></mrow><annotation encoding=\"application/x-tex\">R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span></span> acts on <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>A</mi></mrow><annotation encoding=\"application/x-tex\">A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">A</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi></mrow><annotation encoding=\"application/x-tex\">S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span></span></span></span> acts on <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>B</mi></mrow><annotation encoding=\"application/x-tex\">B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span></span>). Our design choice to use data-carrying typeclasses have many benefits but also cause problems, as the discussion above clearly shows. But hopefully with local fields we are finally ready to make a decision and then to start dealing with the consequences.</p>",
        "id": 542906540,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1759484294
    },
    {
        "content": "<p>After all, I must say that I'm quite convinced by S√©bastien's, and Andrew's, arguments. Of course we will only be 100% sure once this is implemented, but I now think that some of the care we put in avoiding non-defeq uniformities was not needed, since indeed they very rarely show up in statements. I'm happy merging the current design ‚Äî I cannot <code>maintainer-merge</code> since this has alredy been done once, but IMHO we can move forward, time will tell better than too many discussions if this is the right approach.</p>",
        "id": 542922341,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1759490033
    },
    {
        "content": "<p>OK, let's merge this and see what happens. Thanks to all for your work!</p>",
        "id": 543151731,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1759658604
    },
    {
        "content": "<p>yay!</p>",
        "id": 543153103,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759660320
    }
]