[
    {
        "content": "<p>I am trying to define a linearly ordered comm group structure on a subgroup, but I fail miserably. What I am doing is the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib.Algebra.Order.Group.Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib.Algebra.Group.Subgroup.Basic</span>\n\n<span class=\"kd\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LinearOrderedCommGroup</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Subgroup</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">CG</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CommGroup</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstance</span>\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">LO</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LinearOrder</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstance</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">OCG</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">OrderedCommGroup</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"n\">where</span><span class=\"w\"> </span><span class=\"c1\">-- this cannot be found by class inference, and I define it</span>\n<span class=\"w\">  </span><span class=\"n\">mul_le_mul_left</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"o\">⟩</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">b</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"o\">⟩</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">c</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"o\">⟩</span>\n<span class=\"w\">    </span><span class=\"n\">simp_all</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Subtype.mk_le_mk</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Submonoid.mk_mul_mk</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_le_mul_iff_left</span><span class=\"o\">]</span>\n\n<span class=\"kd\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">OrderedCommGroup</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">OCG</span><span class=\"w\"> </span><span class=\"n\">H</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">LOCG</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LinearOrderedCommGroup</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"n\">where</span><span class=\"w\"> </span><span class=\"c1\">----after I type `where` Lean asks for the</span>\n<span class=\"c1\">-- fields `le_total` and `decidableLE` but already warns me that `the rfl tactic failed`.</span>\n</code></pre></div>\n<p>As written in the final comment, as soon as I try to start the construction, Lean understands the missing fields, but also that I will fail in producing them. The infoview contains some info: there are three errors like</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">The</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">Possible</span><span class=\"w\"> </span><span class=\"n\">reasons</span><span class=\"o\">:</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">The</span><span class=\"w\"> </span><span class=\"n\">goal</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">reflexive</span><span class=\"w\"> </span><span class=\"n\">relation</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">neither</span><span class=\"w\"> </span><span class=\"bp\">`=`</span><span class=\"w\"> </span><span class=\"n\">nor</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">relation</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"kd\">@[</span><span class=\"n\">refl</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kd\">lemma</span><span class=\"o\">)</span><span class=\"bp\">.</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">The</span><span class=\"w\"> </span><span class=\"n\">arguments</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">relation</span><span class=\"w\"> </span><span class=\"n\">are</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">equal</span><span class=\"bp\">.</span>\n<span class=\"n\">Try</span><span class=\"w\"> </span><span class=\"n\">using</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">reflexivity</span><span class=\"w\"> </span><span class=\"kd\">lemma</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">your</span><span class=\"w\"> </span><span class=\"n\">relation</span><span class=\"w\"> </span><span class=\"n\">explicitly</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">e.g</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"ss\">`exact</span><span class=\"w\"> </span><span class=\"n\">Eq.refl</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">or</span>\n<span class=\"ss\">`exact</span><span class=\"w\"> </span><span class=\"n\">HEq.rfl</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">etc</span><span class=\"bp\">.</span>\n\n<span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_1</span>\n<span class=\"n\">inst</span><span class=\"bp\">✝</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LinearOrderedCommGroup</span><span class=\"w\"> </span><span class=\"n\">G</span>\n<span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Subgroup</span><span class=\"w\"> </span><span class=\"n\">G</span>\n<span class=\"n\">a</span><span class=\"bp\">✝</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"bp\">✝</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">↥</span><span class=\"n\">H</span>\n<span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"n\">min</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">✝</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"bp\">✝</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">✝</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"bp\">✝</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">✝</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"bp\">✝</span>\n</code></pre></div>\n<p>(in the other two, the final <code>min</code> is replaced by <code>max</code> and by <code>compare</code>). Thus I tried to force the equality, by doing</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">LOCG</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LinearOrderedCommGroup</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">le_total</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">le_total</span>\n<span class=\"w\">  </span><span class=\"n\">decidableLE</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Classical.decRel</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">x_1</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">x_1</span>\n<span class=\"w\">  </span><span class=\"n\">min</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"w\">  </span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"n\">compare</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"n\">_</span>\n<span class=\"w\">    </span><span class=\"n\">constructor</span>\n</code></pre></div>\n<p>but this does not change anything.  Interestingly enough, when typing <code>where</code> there would also be a field <code>mul_le_mul_left</code> had I not declared the instance <code>OCG H</code>. Yet, this does not lead to any problem.</p>\n<p>I have the feeling that Lean is willing to check some compatibility between the different order structures, but</p>\n<ol>\n<li>Am I right?</li>\n<li>If yes, how can I get to a point where I can prove them?</li>\n</ol>",
        "id": 451764070,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1721137979
    },
    {
        "content": "<p>It seems like you have two <code>&lt;</code>, and <code>rfl</code> cannot prove <code>lt_iff...</code> or something like that.</p>",
        "id": 451768156,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1721139125
    },
    {
        "content": "<p>Maybe it's not that field, but lean is complaining that something it is usually proved automatically it's not in this case</p>",
        "id": 451768290,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1721139179
    },
    {
        "content": "<p>Where exactly?</p>",
        "id": 451768304,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1721139188
    },
    {
        "content": "<p>I mean, where do you <em>read this</em>?</p>",
        "id": 451768333,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1721139201
    },
    {
        "content": "<p>(I agree that this must be the problem, after all, but I cannot <em>see</em> it)</p>",
        "id": 451768389,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1721139221
    },
    {
        "content": "<p>I am not at the computer so I am just guessing,  but in the error it says <code>rfl</code> failed, and usually a lot of these fields are proved by <code>rfl</code></p>",
        "id": 451768552,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1721139269
    },
    {
        "content": "<p>Ah sure, I agree. I also somewhat agree that one of the several (automatically found!) instances must contain some non-defeq inequality relation, and I find this a bit worrying.</p>",
        "id": 451768744,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1721139331
    },
    {
        "content": "<p>(the only one I added is <code>Prop</code>-valued)</p>",
        "id": 451768822,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1721139359
    },
    {
        "content": "<p>I came up with this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib.Algebra.Order.Group.Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib.Algebra.Group.Subgroup.Basic</span>\n\n<span class=\"kd\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LinearOrderedCommGroup</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Subgroup</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">LOCG</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LinearOrderedCommGroup</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">mul_le_mul_left</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"o\">⟩</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">b</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"o\">⟩</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">c</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"o\">⟩</span>\n<span class=\"w\">    </span><span class=\"n\">simp_all</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Subtype.mk_le_mk</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Submonoid.mk_mul_mk</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_le_mul_iff_left</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">le_total</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">⟩</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">b</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">le_total</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"w\">  </span><span class=\"n\">decidableLE</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstance</span>\n<span class=\"w\">  </span><span class=\"n\">decidableEq</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstance</span>\n<span class=\"w\">  </span><span class=\"n\">decidableLT</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstance</span>\n<span class=\"w\">  </span><span class=\"n\">min_def</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">    </span><span class=\"n\">ext</span>\n<span class=\"w\">    </span><span class=\"n\">dsimp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">min</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">min_def</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">split_ifs</span><span class=\"w\"> </span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">contradiction</span><span class=\"w\"> </span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">contradiction</span><span class=\"w\"> </span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">  </span><span class=\"n\">max_def</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">    </span><span class=\"n\">ext</span>\n<span class=\"w\">    </span><span class=\"n\">dsimp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">max</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">max_def</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">split_ifs</span><span class=\"w\"> </span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">contradiction</span><span class=\"w\"> </span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">contradiction</span><span class=\"w\"> </span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">  </span><span class=\"n\">compare_eq_compareOfLessAndEq</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"w\">    </span><span class=\"n\">dsimp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">compare</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">compareOfLessAndEq</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LinearOrderedCommGroup.compare_eq_compareOfLessAndEq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">compareOfLessAndEq</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">split_ifs</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">try</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">    </span><span class=\"n\">any_goals</span><span class=\"w\"> </span><span class=\"n\">contradiction</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">assumption</span>\n<span class=\"w\">      </span><span class=\"n\">contradiction</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">congr_arg</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"n\">assumption</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"n\">contradiction</span>\n</code></pre></div>",
        "id": 451768828,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1721139360
    },
    {
        "content": "<p>Why not use <code>Subtype.coe_injective.linearOrderedCommGroup</code>?</p>",
        "id": 451768942,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1721139390
    },
    {
        "content": "<p>It seems that lean is defining <code>min a b</code> to be <code>\\&lt;min a.val b.val, ...\\&gt;</code>, so a lot of the automatic fields won't work.</p>",
        "id": 451769050,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1721139419
    },
    {
        "content": "<p>By \" automatic\"  you mean those that are automatically filled when typing <code>where</code>?</p>",
        "id": 451769215,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1721139475
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/stream/116395-maths/topic/LinearOrderedCommGroup.20on.20a.20subgroup/near/451768942\">said</a>:</p>\n<blockquote>\n<p>Why not use <code>Subtype.coe_injective.linearOrderedCommGroup</code>?</p>\n</blockquote>\n<p>One bad and one good reason:</p>\n<ul>\n<li>I had not found it yet</li>\n<li>I got trapped in understanding how <code>where</code> interplays with Subtypes, and the intial problem looked much less interesting all of a sudden</li>\n</ul>",
        "id": 451769384,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1721139520
    },
    {
        "content": "<p>I think the issue is that when you write <code>where</code> and try to omit fields, lean will try to fill in those fields with a default value (like <code>max_def</code>) with the default value (in the case of <code>max_def</code> is essentially <code>by intros ; rfl</code>), hence you see the error saying that <code>rfl</code> fails.</p>",
        "id": 451770316,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1721139780
    },
    {
        "content": "<p>The tactic <code>compareOfLessAndEq_rfl</code> is used to fill in <code>compare_eq_compareOfLessAndEq</code>, and this essentially uses <code>simp</code> and <code>rfl</code>, which I think is why you also see <code>simp made no progress</code></p>",
        "id": 451770593,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1721139845
    },
    {
        "content": "<p>Ok, so what I had tried in filling at least the <code>min</code> and <code>max</code> by hand was a good start but I did not push this far enough, right?</p>",
        "id": 451770836,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1721139920
    },
    {
        "content": "<p>Also, you changed the field to <code>min_def</code> instead of <code>min</code>: why/how is this supposed to work if the original field of the structure is called <code>min</code>?</p>",
        "id": 451770922,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1721139951
    },
    {
        "content": "<p>(likewise for max...)</p>",
        "id": 451770944,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1721139958
    },
    {
        "content": "<p>I think it's probably better to define <code>max</code> as <code>\\&lt;max a.val b.val, ...\\&gt;</code> as then the coercion is compatible with <code>max</code> by definition.</p>",
        "id": 451771105,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1721140004
    },
    {
        "content": "<p>I think that <code>max</code> is defined in the linear order instance which is inferred (not the default one)</p>",
        "id": 451771286,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1721140058
    },
    {
        "content": "<p>But my question was more synctatical: the field is called <code>max</code> and you gave it a <code>max_def</code>. How comes it accepts it?</p>",
        "id": 451771428,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1721140091
    },
    {
        "content": "<p>Or perhaps I do not understand your answer....</p>",
        "id": 451771519,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1721140122
    },
    {
        "content": "<p>Oh, I see. <code>max</code> does indeed have a default value, but I assume in this case it comes from an instance defined elsewhere. Now I'm also confused, as I don't know when lean decides to use the default value, and when it decides to use one inferred from an instance.</p>",
        "id": 451771737,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1721140200
    },
    {
        "content": "<p>Ah, note that <code>LinearOrder</code> is defined as follows:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">class</span><span class=\"w\"> </span><span class=\"n\">LinearOrder</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kd\">extends</span><span class=\"w\"> </span><span class=\"n\">PartialOrder</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Min</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Max</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Ord</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- A linear order is total. -/</span>\n<span class=\"w\">  </span><span class=\"n\">le_total</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- In a linearly ordered type, we assume the order relations are all decidable. -/</span>\n<span class=\"w\">  </span><span class=\"n\">decidableLE</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DecidableRel</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- In a linearly ordered type, we assume the order relations are all decidable. -/</span>\n<span class=\"w\">  </span><span class=\"n\">decidableEq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">decidableEqOfDecidableLE</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"n\">decidableLE</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- In a linearly ordered type, we assume the order relations are all decidable. -/</span>\n<span class=\"w\">  </span><span class=\"n\">decidableLT</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DecidableRel</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"bp\">@</span><span class=\"n\">decidableLTOfDecidableLE</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"n\">decidableLE</span>\n<span class=\"w\">  </span><span class=\"n\">min</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"w\">  </span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The minimum function is equivalent to the one you get from `minOfLe`. -/</span>\n<span class=\"w\">  </span><span class=\"n\">min_def</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">min</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"n\">intros</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The minimum function is equivalent to the one you get from `maxOfLe`. -/</span>\n<span class=\"w\">  </span><span class=\"n\">max_def</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"n\">intros</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">  </span><span class=\"n\">compare</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">compareOfLessAndEq</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- Comparison via `compare` is equal to the canonical comparison given decidable `&lt;` and `=`. -/</span>\n<span class=\"w\">  </span><span class=\"n\">compare_eq_compareOfLessAndEq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">compare</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">compareOfLessAndEq</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">    </span><span class=\"n\">compareOfLessAndEq_rfl</span>\n</code></pre></div>",
        "id": 451771999,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1721140280
    },
    {
        "content": "<p>Ahah!</p>",
        "id": 451772035,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1721140295
    },
    {
        "content": "<p>Good catch</p>",
        "id": 451772046,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1721140299
    },
    {
        "content": "<p>My <em>guess</em> is that since <code>Min</code> <code>Max</code> etc. are extended, when lean can find such an instance, it will use it, and when it can't, it will use the default value.</p>",
        "id": 451772075,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1721140308
    },
    {
        "content": "<p>And since <code>min_def</code> are \"normally\" filled in automatically by intros+rfl, if it cannot prove them it complains</p>",
        "id": 451772198,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1721140341
    },
    {
        "content": "<p>Whereas you proved them for it.</p>",
        "id": 451772215,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1721140349
    },
    {
        "content": "<p>So lean can find <code>Min H</code> and <code>Max H</code> with the definitions as <code>&lt;min a.val b.val, ...&gt;</code>, but you still have to prove <code>max_def</code> and <code>min_def</code> etc. since the default value for those won't work.</p>",
        "id": 451772284,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1721140371
    },
    {
        "content": "<p>Great! Thanks so much (and thanks to <span class=\"user-mention\" data-user-id=\"130384\">@Riccardo Brasca</span> who was also providing hints in a DM). Final question: how did <em>you</em> realize that the crucial points were <code>min_def</code> and <code>max_def</code>? By looking at the definition of <code>LinearOrder</code>?</p>",
        "id": 451772500,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1721140440
    },
    {
        "content": "<p>Or did you get some hints from somewhere else that those two were points that Lean was trying to fill automatically? Because after <code>where</code> I only got an error, with no clear explanation beside a vague \"probably you messed up min and max\".</p>",
        "id": 451772768,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1721140516
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"300245\">Filippo A. E. Nuccio</span> <a href=\"#narrow/stream/116395-maths/topic/LinearOrderedCommGroup.20on.20a.20subgroup/near/451772500\">said</a>:</p>\n<blockquote>\n<p>Great! Thanks so much (and thanks to <span class=\"user-mention silent\" data-user-id=\"130384\">Riccardo Brasca</span> who was also providing hints in a DM). Final question: how did <em>you</em> realize that the crucial points were <code>min_def</code> and <code>max_def</code>? By looking at the definition of <code>LinearOrder</code>?</p>\n</blockquote>\n<p>I just used the lightbulb to ask me to fill in all fields, then started deleting fields until lean complained, then I filled in the problematic fields... It's probably not the most principled way to go about such things :-/</p>",
        "id": 451773179,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1721140629
    },
    {
        "content": "<p>Ah ok, thanks!</p>",
        "id": 451773319,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1721140674
    },
    {
        "content": "<p>I think that now I'm ready to follow <span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span> 's suggestion <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span></p>",
        "id": 451773431,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1721140697
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"300245\">Filippo A. E. Nuccio</span> has marked this topic as resolved.</p>",
        "id": 451773450,
        "sender_full_name": "Notification Bot",
        "timestamp": 1721140705
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306577\">Matthew Ballard</span> has marked this topic as unresolved.</p>",
        "id": 451815023,
        "sender_full_name": "Notification Bot",
        "timestamp": 1721150543
    },
    {
        "content": "<p>Please thumbs up <a href=\"https://github.com/leanprover/lean4/pull/2950\">lean#2950</a></p>",
        "id": 451815079,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1721150558
    },
    {
        "content": "<p>Done!</p>",
        "id": 451978623,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1721203175
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"300245\">Filippo A. E. Nuccio</span> has marked this topic as resolved.</p>",
        "id": 451978635,
        "sender_full_name": "Notification Bot",
        "timestamp": 1721203180
    }
]