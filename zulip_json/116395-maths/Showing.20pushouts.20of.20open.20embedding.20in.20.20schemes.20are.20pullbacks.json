[
    {
        "content": "<p>I'm currently trying to formalize the following result:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">isPullback_of_isPushout_of_isOpenImmersion</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Scheme</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">}}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"bp\">⟶</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"bp\">⟶</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">⟶</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"bp\">⟶</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsPushout</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"n\">inr</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">IsOpenImmersion</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsOpenImmersion</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">IsPullback</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>Roughly speaking the idea is to use the <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/AlgebraicGeometry/OpenImmersion.html#AlgebraicGeometry.IsOpenImmersion.lift\">universal property of open immersions</a> to construct an arrow to show the diagram is a pullback. This reduces to a set-theoretic question and my proof has only one sorry remaining which is:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">range_inter</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"n\">inl</span><span class=\"bp\">.</span><span class=\"n\">base</span><span class=\"w\"> </span><span class=\"bp\">∩</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"n\">inr</span><span class=\"bp\">.</span><span class=\"n\">base</span><span class=\"w\"> </span><span class=\"bp\">⊆</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">range</span>\n<span class=\"w\">         </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">≫</span><span class=\"w\"> </span><span class=\"n\">inl</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">base</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>I know how to prove an analogue of this result for TopCat because I can use the fact that after applying the forgetful functor I still have a pushout diagram in types. For these kind of gluing pushouts in schemes, the underlying diagram of topological space/types is a pushout in top/type, but how do I show this in Lean? (I see there is some probably relevant stuff in glue data, but I am  hesitant/incompetent to use it.)</p>\n<p>Any thoughts/help would be great :)</p>",
        "id": 573692305,
        "sender_full_name": "Dhyan Aranha",
        "timestamp": 1770972630
    },
    {
        "content": "<p>This topic was moved here from <a class=\"stream-topic\" data-stream-id=\"116395\" href=\"/#narrow/channel/116395-maths/topic/Showing.20pushouts.20of.20open.20embedding.20i.20.20schemes.20are.20pullbacks\">#maths &gt; Showing pushouts of open embedding i  schemes are pullbacks</a> by <span class=\"user-mention silent\" data-user-id=\"751471\">Dhyan Aranha</span>.</p>",
        "id": 573692573,
        "sender_full_name": "Notification Bot",
        "timestamp": 1770972751
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"648495\">@Christian Merten</span> didn't we prove something like this at Loki some time ago?</p>",
        "id": 573708784,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1770978061
    },
    {
        "content": "<p>or no, i think that was something like \"open embeddings are preserved under pullback\"</p>",
        "id": 573708928,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1770978110
    },
    {
        "content": "<p>(i'm not sure, not quite my field)</p>",
        "id": 573709017,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1770978141
    },
    {
        "content": "<p>Does this help?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">universe</span><span class=\"w\"> </span><span class=\"n\">u</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span><span class=\"w\"> </span><span class=\"n\">Limits</span><span class=\"w\"> </span><span class=\"n\">AlgebraicGeometry</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Scheme</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">}}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"bp\">⟶</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"bp\">⟶</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsOpenImmersion</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">IsOpenImmersion</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">PreservesColimit</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">span</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Scheme</span><span class=\"bp\">.</span><span class=\"n\">forgetToTop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">change</span><span class=\"w\"> </span><span class=\"n\">PreservesColimit</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Scheme</span><span class=\"bp\">.</span><span class=\"n\">forgetToLocallyRingedSpace</span><span class=\"w\"> </span><span class=\"bp\">⋙</span>\n<span class=\"w\">    </span><span class=\"n\">LocallyRingedSpace</span><span class=\"bp\">.</span><span class=\"n\">forgetToSheafedSpace</span><span class=\"w\"> </span><span class=\"bp\">⋙</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">infer_instance</span>\n</code></pre></div>",
        "id": 573710370,
        "sender_full_name": "Christian Merten",
        "timestamp": 1770978598
    },
    {
        "content": "<p>(We should have the more general version of this for locally directed diagrams, which has exactly the same proof)</p>",
        "id": 573710526,
        "sender_full_name": "Christian Merten",
        "timestamp": 1770978647
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"648495\">@Christian Merten</span> <br>\nThis exactly what I needed, thanks! [edited: figured out what I needed to do!]</p>",
        "id": 574119213,
        "sender_full_name": "Dhyan Aranha",
        "timestamp": 1771251312
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"648495\">@Christian Merten</span> Sorry for this annoyance!  I bumped mathlib today and now a lot of my instances have broken. In particular the one you suggested:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span><span class=\"w\"> </span><span class=\"n\">AlgebraicGeometry</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Limits</span><span class=\"w\"> </span><span class=\"n\">Scheme</span><span class=\"w\"> </span><span class=\"n\">TopCat</span><span class=\"w\"> </span><span class=\"n\">Topology</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">LocallyRingedSpace</span><span class=\"bp\">.</span><span class=\"n\">IsOpenImmersion</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Scheme</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"bp\">⟶</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"bp\">⟶</span><span class=\"w\">  </span><span class=\"n\">Y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsOpenImmersion</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsOpenImmersion</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">PreservesColimit</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">span</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Scheme</span><span class=\"bp\">.</span><span class=\"n\">forgetToTop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">change</span><span class=\"w\"> </span><span class=\"n\">PreservesColimit</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Scheme</span><span class=\"bp\">.</span><span class=\"n\">forgetToLocallyRingedSpace</span><span class=\"w\"> </span><span class=\"bp\">⋙</span>\n<span class=\"w\">    </span><span class=\"n\">LocallyRingedSpace</span><span class=\"bp\">.</span><span class=\"n\">forgetToSheafedSpace</span><span class=\"w\"> </span><span class=\"bp\">⋙</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">infer_instance</span>\n</code></pre></div>\n<p>breaks now.</p>",
        "id": 574512323,
        "sender_full_name": "Dhyan Aranha",
        "timestamp": 1771422535
    },
    {
        "content": "<p>Can you try putting <code>set_option backward.isDefEq.respectTransparency false in</code> above the instance? There has been a Lean version bump yesterday which changed the behaviour of a def-eq check. It is still being discussed what to do about this.</p>",
        "id": 574534808,
        "sender_full_name": "Christian Merten",
        "timestamp": 1771428086
    },
    {
        "content": "<p>it works! Thanks!</p>",
        "id": 574535347,
        "sender_full_name": "Dhyan Aranha",
        "timestamp": 1771428220
    }
]