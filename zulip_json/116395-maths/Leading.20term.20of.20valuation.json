[
    {
        "content": "<p>In <a href=\"https://github.com/leanprover-community/mathlib4/pull/29687\">#29687</a> I prove that if the real numbers embed into a ring <code>K</code>, then for any two elements <code>x y : K</code> with equal <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ArchimedeanClass#doc\">docs#ArchimedeanClass</a>, there's a unique real number <code>r</code> such that <code>ArchimedeanClass.mk y &lt; ArchimedeanClass.mk (x - r * y)</code>.</p>\n<p><span class=\"user-mention\" data-user-id=\"873350\">@Weiyi Wang</span> suggested that this result might generalize. Specifically, for any (additive) valuation <code>v</code>, and two elements <code>x y : K</code> with the same valuation, there should exist a unique <code>r</code> in the residue field (?) such that <code>v y &lt; v (x - r * y)</code>. My questions are:</p>\n<ul>\n<li>Is this result true?</li>\n<li>Does this value <code>r</code> have a name?</li>\n<li>Does this exist in Mathlib?</li>\n</ul>",
        "id": 539653027,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1757973431
    },
    {
        "content": "<p>\"remainder\"?</p>",
        "id": 539653227,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757973566
    },
    {
        "content": "<p>I guess it needs a condition \"the residue field can be embedded back to K in a nice way \"</p>",
        "id": 539653240,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1757973572
    },
    {
        "content": "<p>I think \"nice way\" here should mean <code>v (f x) = 0 for x ‚â† 0</code></p>",
        "id": 539653350,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1757973636
    },
    {
        "content": "<p>sometimes it's an embedding but it doesn't respect the ring operations</p>",
        "id": 539653499,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757973717
    },
    {
        "content": "<p>Well in the PR I made I specifically needed <code>f : R -&gt;+* K</code> + strictly monotone</p>",
        "id": 539653579,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1757973769
    },
    {
        "content": "<p>Though it might be possible to relax strictly monotone to injective</p>",
        "id": 539653601,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1757973782
    },
    {
        "content": "<p>so we also want it to be a <code>RingHomClass</code>?</p>",
        "id": 539653638,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757973799
    },
    {
        "content": "<p>the embedding, I mean</p>",
        "id": 539653671,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757973816
    },
    {
        "content": "<p>I believe so</p>",
        "id": 539653762,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1757973855
    },
    {
        "content": "<p>actually, how about thinking \"how do we calculate r\". For now let's suppose K is a field, then x/y has multiplicative valuation 1 (or, x/y is in Valuation.valuationSubring if you relax the hypothesis like in your PR), and then IsLocalRing.residue outputs r</p>",
        "id": 539654366,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1757974138
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsLocalRing.residue#doc\">docs#IsLocalRing.residue</a></p>",
        "id": 539654765,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1757974378
    },
    {
        "content": "<p>You're saying this is the value I want?</p>",
        "id": 539655005,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1757974535
    },
    {
        "content": "<p>in the surreal case, I think this gives the \"omnific numbers mod w\" map</p>",
        "id": 539655101,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1757974603
    },
    {
        "content": "<p>It is not exactly yet because it is not In \\R. The next step would be: the residue field of ArchimedeanClass.addValuation is Archimedean, hence a subfield of \\R</p>",
        "id": 539655103,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1757974603
    },
    {
        "content": "<p>(I have that \"is a subfield of R\" PR opened somewhere...)</p>",
        "id": 539655235,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1757974697
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 539655236,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1757974697
    },
    {
        "content": "<p>Wait, but what's the local field in this context?</p>",
        "id": 539655287,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1757974727
    },
    {
        "content": "<p>Would it be the subfield of elements with nonnegative valuation?</p>",
        "id": 539655307,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1757974740
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"873350\">Weiyi Wang</span> <a href=\"#narrow/channel/116395-maths/topic/Leading.20term.20of.20valuation/near/539655235\">said</a>:</p>\n<blockquote>\n<p>(I have that \"is a subfield of R\" PR opened somewhere...)</p>\n</blockquote>\n<p>isn't that just <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearOrderedField.inducedOrderRingHom#doc\">docs#LinearOrderedField.inducedOrderRingHom</a></p>",
        "id": 539655347,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757974766
    },
    {
        "content": "<p>Oh right, my PR was to show that the map for group and map for ring coincide <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span>but that's likely unnecessary.</p>",
        "id": 539655449,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1757974826
    },
    {
        "content": "<p>Or perhaps <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Archimedean.embedReal#doc\">docs#Archimedean.embedReal</a> ?</p>",
        "id": 539655481,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1757974850
    },
    {
        "content": "<p>oh that one's weaker</p>",
        "id": 539655515,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1757974878
    },
    {
        "content": "<p>not a ring hom :(</p>",
        "id": 539655518,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757974880
    },
    {
        "content": "<p>yeah that's the group hom. You can upgrade it to ring hom</p>",
        "id": 539655543,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1757974891
    },
    {
        "content": "<p>Feels weird that we have these two ways of embedding a field into the reals and that they read so differently</p>",
        "id": 539655740,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1757975079
    },
    {
        "content": "<p>That's probably my bad. I didn't find the existing one when writing Archimedean.embedReal</p>",
        "id": 539655891,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1757975194
    },
    {
        "content": "<p>Wait</p>",
        "id": 539659630,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1757977760
    },
    {
        "content": "<p>Isnt the property that I want to prove basically that valuations give an Euclidean domain structure?</p>",
        "id": 539659646,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1757977780
    },
    {
        "content": "<p>From <a href=\"https://en.wikipedia.org/wiki/Euclidean_domain\">https://en.wikipedia.org/wiki/Euclidean_domain</a><br>\n\"Examples\"</p>\n<ul>\n<li>Any <a href=\"https://en.wikipedia.org/wiki/Discrete_valuation_ring\">discrete valuation ring</a>....</li>\n</ul>",
        "id": 539660033,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1757978000
    },
    {
        "content": "<p>A valuation ring with a value group isomorphic to the integers? That doesn't seem right.</p>",
        "id": 539660427,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1757978277
    },
    {
        "content": "<p>This one translates to requiring discrete ArchimedeanClass, though. There is likely something junky when ArchimedeanClass is not discrete</p>",
        "id": 539660436,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1757978283
    },
    {
        "content": "<p>Yeah it only applies to discrete case</p>",
        "id": 539660455,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1757978294
    },
    {
        "content": "<p>(In mathlib it is <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/RingTheory/Valuation/Discrete/Basic.html#Valuation.valuationSubring_isDiscreteValuationRing\">Valuation.valuationSubring_isDiscreteValuationRing</a>)</p>",
        "id": 539660505,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1757978337
    },
    {
        "content": "<p>This might be where ArchimedeanClass is special among arbitrary valuations. Its valuationSubring probably can be an Euclidean domain with weaker conditions</p>",
        "id": 539660782,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1757978569
    },
    {
        "content": "<p><code>Valuation.valuationSubring</code>: the valuation subring associated to a valuation</p>\n<p>wow thanks for nothing docstring</p>",
        "id": 539661015,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1757978730
    },
    {
        "content": "<p>Mathlib doesn't have <code>IsDiscreteValuationRing</code> -&gt; <code>EuclideanDomain</code>.. is it missing or wrong?</p>",
        "id": 539661076,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1757978773
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"873350\">Weiyi Wang</span> <a href=\"#narrow/channel/116395-maths/topic/Leading.20term.20of.20valuation/near/539660782\">said</a>:</p>\n<blockquote>\n<p>This might be where ArchimedeanClass is special among arbitrary valuations. Its valuationSubring probably can be an Euclidean domain with weaker conditions</p>\n</blockquote>\n<p>Wait, is this really the case? wouldn't it require  <code>ArchimedeanClass</code> to be well-ordered?</p>",
        "id": 539661238,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1757978911
    },
    {
        "content": "<p>Does it? Could you elaborate?</p>",
        "id": 539661337,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1757979004
    },
    {
        "content": "<p>Well, the Euclidean function in an Euclidean domain needs a well-founded codomain</p>",
        "id": 539661380,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1757979034
    },
    {
        "content": "<p>I'm not sure if we necessarily have that</p>",
        "id": 539661395,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1757979042
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"873350\">Weiyi Wang</span> <a href=\"#narrow/channel/116395-maths/topic/Leading.20term.20of.20valuation/near/539661076\">said</a>:</p>\n<blockquote>\n<p>Mathlib doesn't have <code>IsDiscreteValuationRing</code> -&gt; <code>EuclideanDomain</code>.. is it missing or wrong?</p>\n</blockquote>\n<p>well all the data involved there are highly noncanonical... maybe people just thought it wasn't a good idea</p>",
        "id": 539661571,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757979172
    },
    {
        "content": "<p>but I personally am not opposed to see a <code>def</code> (not <code>instance</code>)</p>",
        "id": 539661606,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757979192
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"459227\">Violeta Hern√°ndez</span> <a href=\"#narrow/channel/116395-maths/topic/Leading.20term.20of.20valuation/near/539661380\">said</a>:</p>\n<blockquote>\n<p>Well, the Euclidean function in an Euclidean domain needs a well-founded codomain</p>\n</blockquote>\n<p>Ah, I think you are right. I forgot the \"A well-founded relation on <code>R</code>, satisfying <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/EuclideanDomain/Defs.html#EuclideanDomain.r\">r</a> (a % b) b. This ensures that the GCD algorithm always terminates.\" part. So what we want is just a \"possibly non-terminating Euclidean domain\"</p>",
        "id": 539661778,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1757979321
    },
    {
        "content": "<p>Anyway, if we follow <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=EuclideanDomain#doc\">docs#EuclideanDomain</a>, <code>r</code> would be <code>quotient</code>, and <code>x - r * y</code> would be <code>remainder</code>, and when <code>FiniteArchimedeanClass</code> is, say, isomorphic to integers, then these concepts coincide</p>",
        "id": 539662631,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1757980039
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">section</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">IsDiscreteValuationRing</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsDomain</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsDiscreteValuationRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">quotient</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Classical</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">‚à£</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">choose</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">remainder</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">quotient</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">toWithBotNat</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithBot</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">addVal</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">toWithBotNat_zero</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">toWithBotNat</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">‚ä•</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">addVal_zero</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">toWithBotNat_eq_bot_iff</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">toWithBotNat</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">‚ä•</span><span class=\"w\"> </span><span class=\"bp\">‚Üî</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">addVal_eq_top_iff</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">bot_lt_toWithBotNat_iff</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚ä•</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">toWithBotNat</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚Üî</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚â†</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">bot_lt_iff_ne_bot</span><span class=\"o\">]</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">toWithBotNat_le_toWithBotNat_iff</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚â†</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hy</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">‚â†</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">toWithBotNat</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">toWithBotNat</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">‚Üî</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚à£</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">toWithBotNat</span>\n<span class=\"w\">  </span><span class=\"n\">generalize</span><span class=\"w\"> </span><span class=\"n\">hvx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">addVal</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">vx</span>\n<span class=\"w\">  </span><span class=\"n\">generalize</span><span class=\"w\"> </span><span class=\"n\">hvy</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">addVal</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">vy</span>\n<span class=\"w\">  </span><span class=\"n\">cases'</span><span class=\"w\"> </span><span class=\"n\">vx</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">vx</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">addVal_eq_top_iff</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hvx</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">tauto</span>\n<span class=\"w\">  </span><span class=\"n\">cases'</span><span class=\"w\"> </span><span class=\"n\">vy</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">vy</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">addVal_eq_top_iff</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hvy</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">tauto</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">addVal_le_iff_dvd</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hvx</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hvy</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">WithBot</span><span class=\"bp\">.</span><span class=\"n\">coe_le_coe</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"n\">WithTop</span><span class=\"bp\">.</span><span class=\"n\">coe_le_coe</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">dvd_of_toWithBotNat_le_toWithBotNat</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚â†</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hle</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">toWithBotNat</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">toWithBotNat</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚à£</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">by_cases</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hy</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hle</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">toWithBotNat_le_toWithBotNat_iff</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"n\">hle</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">toEuclideanDomain</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">EuclideanDomain</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">quotient</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">quotient</span>\n<span class=\"w\">  </span><span class=\"n\">remainder</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">remainder</span>\n<span class=\"w\">  </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">toWithBotNat</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">toWithBotNat</span><span class=\"w\"> </span><span class=\"n\">y</span>\n<span class=\"w\">  </span><span class=\"n\">r_wellFounded</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">WellFounded</span><span class=\"bp\">.</span><span class=\"n\">onFun</span><span class=\"w\"> </span><span class=\"n\">wellFounded_lt</span>\n<span class=\"w\">  </span><span class=\"n\">quotient_zero</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">quotient</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">remainder_lt</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">remainder</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">quotient</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">if_neg</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">split_ifs</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">hyx</span>\n<span class=\"w\">    </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">rwa</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">hyx</span><span class=\"bp\">.</span><span class=\"n\">choose_spec</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sub_self</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">toWithBotNat_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">bot_lt_toWithBotNat_iff</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mul_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sub_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">lt_iff_not_ge</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">mt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">dvd_of_toWithBotNat_le_toWithBotNat</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">hyx</span>\n<span class=\"w\">  </span><span class=\"n\">quotient_mul_add_remainder_eq</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">remainder</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">quotient</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">split_ifs</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">h‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">h‚ÇÇ</span>\n<span class=\"w\">    </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h‚ÇÅ</span><span class=\"o\">]</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">ring</span>\n<span class=\"w\">    </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">h‚ÇÇ</span><span class=\"bp\">.</span><span class=\"n\">choose_spec</span><span class=\"o\">]</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">ring</span>\n<span class=\"w\">    </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">ring</span>\n<span class=\"w\">  </span><span class=\"n\">mul_left_not_lt</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">by_cases</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">    </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hx</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">not_lt</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">toWithBotNat_le_toWithBotNat_iff</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mul_ne_zero</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"o\">)]</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">dvd_mul_right</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">IsDiscreteValuationRing</span>\n</code></pre></div>",
        "id": 539666529,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757983498
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/29693\">#29693</a></p>",
        "id": 539667407,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757984386
    },
    {
        "content": "<p>Regarding the original question, I would prefer a statement that there exists a unit r in the valuation ring (not the residue field) satisfying your condition. Then you could have a uniqueness statement asserting that any other such element is equivalent mod the maximal ideal.</p>",
        "id": 539667811,
        "sender_full_name": "Scott Carnahan",
        "timestamp": 1757984768
    },
    {
        "content": "<p>This avoids some of the messiness of lifting from the residue field.</p>",
        "id": 539668038,
        "sender_full_name": "Scott Carnahan",
        "timestamp": 1757984948
    },
    {
        "content": "<p>Wait... the EuclideanDomain stuff doesn't look right to me</p>",
        "id": 539668470,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1757985369
    },
    {
        "content": "<p>This code is basically saying the remainder is either x or 0???</p>",
        "id": 539668525,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1757985416
    },
    {
        "content": "<p>that's probably not right</p>",
        "id": 539668794,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757985708
    },
    {
        "content": "<p>I think you constructed... <em>a</em> EuclideanDomain, but not the EuclideanDomain I had in mind. Maybe this really just shows how non-canonical it is</p>",
        "id": 539668804,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1757985715
    },
    {
        "content": "<p>I'd like to define an EuclideanDomain on formal PowerSeries like example: <code>3 * x ^ 2 + 5 * x ^ 5 + 2 * x ^ 100 + ...</code> divided by <code>x^2 + x^5</code> should give quotient <code>3</code> and remainder <code>2 * x^5 + 2 * x ^ 100 + ...</code><br>\nYours: gives <code>quotient = 3  + 2 * x^3 - 2 * x^6 + 2 * x^9 + ...</code> and <code>remainder = 0</code></p>",
        "id": 539669145,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1757986072
    },
    {
        "content": "<p>I've got new doubts about my original statement. Consider the rationals with the 2-adic valuation. What would the statement even say? There isn't a ring homomorphism from ùîΩ‚ÇÇ ‚Üí ‚Ñö besides the trivial one.</p>",
        "id": 539669271,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1757986206
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"459227\">Violeta Hern√°ndez</span> <a href=\"#narrow/channel/116395-maths/topic/Leading.20term.20of.20valuation/near/539669271\">said</a>:</p>\n<blockquote>\n<p>There isn't a ring homomorphism from ùîΩ‚ÇÇ ‚Üí ‚Ñö besides the trivial one.</p>\n</blockquote>\n<p>There also isn't a trivial ring homomorphism</p>",
        "id": 539669350,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757986270
    },
    {
        "content": "<p>isn't mapping everything to 0 always a ring homomorphism?</p>",
        "id": 539669385,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1757986293
    },
    {
        "content": "<p>doesn't preserve 1</p>",
        "id": 539669391,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757986302
    },
    {
        "content": "<p>ah</p>",
        "id": 539669401,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1757986309
    },
    {
        "content": "<p>if there's a ring homomorphism then the characteristic of the codomain has to divide the characteristic of the domain</p>",
        "id": 539669479,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757986380
    },
    {
        "content": "<p>and <code>0 ‚à§ 2</code></p>",
        "id": 539669525,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757986417
    },
    {
        "content": "<p>why do we have <code>‚àâ</code> but we don't have <code>‚à§</code></p>",
        "id": 539669630,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757986517
    },
    {
        "content": "<p>in other words, I have no idea what the generalization of my <code>standardPart</code> construction even is anymore</p>",
        "id": 539670250,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1757987205
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"873350\">Weiyi Wang</span> <a href=\"#narrow/channel/116395-maths/topic/Leading.20term.20of.20valuation/near/539668804\">said</a>:</p>\n<blockquote>\n<p>Maybe this really just shows how non-canonical it is</p>\n</blockquote>\n<p>yeah...</p>",
        "id": 539700598,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1758007842
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"873350\">Weiyi Wang</span> <a href=\"#narrow/channel/116395-maths/topic/Leading.20term.20of.20valuation/near/539668525\">said</a>:</p>\n<blockquote>\n<p>the remainder is either x or 0???</p>\n</blockquote>\n<p>we're in a valuation ring, so either x|y or y|x, so the GCD can be computed in  \"1 step\"</p>",
        "id": 539700729,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1758007885
    },
    {
        "content": "<p>i just wrote the most efficient algorithm</p>",
        "id": 539700761,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1758007894
    },
    {
        "content": "<p>Question. Coming back to the original topic, do we have any other instances where the valuation theorem I mention is true?</p>",
        "id": 539822308,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758043521
    },
    {
        "content": "<p>Not just that there's an Euclidean division, but that the quotient is given as an element of some ring homomorphism</p>",
        "id": 539822514,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758043590
    },
    {
        "content": "<p>It should be true for PowerSeries / HahnSeries. Not sure if it is stated anywhere. (probably too trivial because it is just chopping off a term)<br>\nIt is also \"true\" for p-adic numbers in some sense, but that's not a ring hom</p>",
        "id": 539822966,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1758043750
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsLocalRing.residue#doc\">docs#IsLocalRing.residue</a> is a ring hom to a quotient, that I would call more of a \"trailing\" term rather than leading.</p>",
        "id": 539823052,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1758043794
    },
    {
        "content": "<p>Well, this standard part value in a sense is just encoding part of the Hahn embedding theorem</p>",
        "id": 539823450,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758043873
    },
    {
        "content": "<p>For p adics, embedding that back into the p adics is called <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=PadicInt.zmodRepr#doc\">docs#PadicInt.zmodRepr</a></p>",
        "id": 539823624,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1758043930
    },
    {
        "content": "<p>That is the thing that avoids the nastiness of lifting from the residue field, that Scott mentioned.</p>",
        "id": 539823728,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1758043977
    },
    {
        "content": "<p>Is there any way to generalize both the standard part and the p-adic constructions, though?</p>",
        "id": 539828977,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758045670
    },
    {
        "content": "<p>Like, from what I understand, my function <code>ArchimedeanClass.standardPart</code> is basically just a quotient, but there isn't really a single way to generalize this construction, and this construction doesn't even lead to something nice like an Euclidean domain in the general case.</p>",
        "id": 539832672,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758046957
    },
    {
        "content": "<p>I think <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsLocalRing.residue#doc\">docs#IsLocalRing.residue</a> is the generalization. It is unfortunately in the quotient space because not all valuation has a nicer construction</p>",
        "id": 539832861,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1758047032
    },
    {
        "content": "<p>Are the docs down? I can't open that page <span aria-label=\"frown\" class=\"emoji emoji-1f641\" role=\"img\" title=\"frown\">:frown:</span></p>",
        "id": 539833561,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758047325
    },
    {
        "content": "<p>It opens for me</p>",
        "id": 539833678,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1758047377
    },
    {
        "content": "<p>Oh, it works if I open it on mobile</p>",
        "id": 539834171,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758047541
    },
    {
        "content": "<p>Sorry, but I still don't get what <code>R</code> is in this case.</p>",
        "id": 539834198,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758047551
    },
    {
        "content": "<p>R is <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Valuation.valuationSubring#doc\">docs#Valuation.valuationSubring</a>, where x/y lives</p>",
        "id": 539834822,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1758047768
    },
    {
        "content": "<p>Ah!</p>",
        "id": 539834956,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758047809
    },
    {
        "content": "<p>So that's what the <code>v(y) ‚â§ v(x)</code>condition translates to</p>",
        "id": 539834992,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758047823
    },
    {
        "content": "<p>yep</p>",
        "id": 539835022,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1758047832
    },
    {
        "content": "<p>So you're right, what we want to do is show that the residue field is archimedean</p>",
        "id": 539836250,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758048263
    },
    {
        "content": "<p>An archimedean field has a <em>unique</em> embedding into ‚Ñù, right?</p>",
        "id": 539836362,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758048305
    },
    {
        "content": "<p>Right. Pretty sure that uniqueness is stated in mathlib</p>",
        "id": 539837268,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1758048710
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearOrderedField.uniqueOrderRingHom#doc\">docs#LinearOrderedField.uniqueOrderRingHom</a></p>",
        "id": 539837477,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1758048789
    },
    {
        "content": "<p>I think I understand now</p>",
        "id": 539894103,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758056931
    },
    {
        "content": "<p>I'll remake my <code>standardPart</code> PR using this</p>",
        "id": 539894123,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758056940
    },
    {
        "content": "<p>I think the definition should look something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">standardPart</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">ArchimedeanClass</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">inducedMap</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">residue</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"bp\">‚ü©</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div>",
        "id": 539894192,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758056980
    },
    {
        "content": "<p>What's the Mathlib name for \"the ring of elements of nonnegative valuation\"?</p>",
        "id": 539894839,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758057322
    },
    {
        "content": "<p>Is <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Valuation.integer#doc\">docs#Valuation.integer</a> what I want? Do I need to turn my <code>AddValuation</code> into a <code>Valuation</code> first?</p>",
        "id": 539894912,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758057360
    },
    {
        "content": "<p>I think so</p>",
        "id": 539895357,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1758057596
    },
    {
        "content": "<p>It's weird that we have <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Valuation.integer#doc\">docs#Valuation.integer</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Valuation.Integers#doc\">docs#Valuation.Integers</a></p>",
        "id": 539895409,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758057635
    },
    {
        "content": "<p>Both feel like they go against the Mathlib naming convention</p>",
        "id": 539895446,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758057654
    },
    {
        "content": "<p>At the very least the latter should be <code>Valuation.IsInteger</code></p>",
        "id": 539895554,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758057709
    },
    {
        "content": "<p>Oh nevermind, I want to use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Valuation.valuationSubring#doc\">docs#Valuation.valuationSubring</a> rather than <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Valuation.integer#doc\">docs#Valuation.integer</a></p>",
        "id": 539895995,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758057960
    },
    {
        "content": "<p>I am also going to complain about these two definitions that are essentially the same having such different names and not linking to each other</p>",
        "id": 539896030,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758057982
    },
    {
        "content": "<p>Wait a second</p>",
        "id": 539897817,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758058908
    },
    {
        "content": "<p>How do we define the ordering on the residue field?</p>",
        "id": 539897880,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758058936
    },
    {
        "content": "<p><span aria-label=\"grimacing\" class=\"emoji emoji-1f62c\" role=\"img\" title=\"grimacing\">:grimacing:</span>by... showing the quotient operation respect the linear order on the original field?</p>",
        "id": 539898012,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1758059006
    },
    {
        "content": "<p>That seems untrue</p>",
        "id": 539898047,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758059025
    },
    {
        "content": "<p>For instance, <code>residue œâ &lt; residue 1</code></p>",
        "id": 539898075,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758059038
    },
    {
        "content": "<p>I think what we need to show is that every nonzero element in the residue field has a unique representative with valuation zero</p>",
        "id": 539898141,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758059073
    },
    {
        "content": "<p>I am assuming \\omega here represents an infinitely large element, then residue omega isn't really defined? because residue can only be taken on all real elements or infinitesimal elements</p>",
        "id": 539898499,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1758059246
    },
    {
        "content": "<p>ah, dammit</p>",
        "id": 539898538,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758059269
    },
    {
        "content": "<p>the inverse ordering on <code>ArchimedeanClass</code> strikes again</p>",
        "id": 539898544,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758059275
    },
    {
        "content": "<p>so the linear order on residue is really saying \"linear order is preserved if you quotient away infinitesimal elements\"</p>",
        "id": 539898918,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1758059488
    },
    {
        "content": "<p>I guess you could define <code>&lt;</code> on the residue field as <code>x &lt; y</code> for all representatives <code>x</code> and <code>y</code></p>",
        "id": 539899008,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758059561
    },
    {
        "content": "<p><code>‚â§</code> is subtler, since you can have situations like <code>1 &lt; 1 + Œµ</code> but <code>residue 1 = residue (1 + Œµ)</code></p>",
        "id": 539899069,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758059603
    },
    {
        "content": "<p>I guess <code>¬¨ y &lt; x</code> would work to define <code>x ‚â§ y</code>, but this seems inelegant</p>",
        "id": 539899122,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758059635
    },
    {
        "content": "<p>I went into something very similar when originally defining the linear order on ArchimedeanClass</p>",
        "id": 539899509,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1758059880
    },
    {
        "content": "<p>Basically we want to say express \"a quotient collapse the linear order on the source type\"</p>",
        "id": 539899594,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1758059928
    },
    {
        "content": "<p>One bad way to do that is LinearOrder.lift' with Quotient.out, but it's ugly</p>",
        "id": 539899642,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1758059957
    },
    {
        "content": "<p>That would work yeah</p>",
        "id": 539899993,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758060129
    },
    {
        "content": "<p>I think the issue is that the order is preserved between different elements, but not within representatives for the same element</p>",
        "id": 539900042,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758060151
    },
    {
        "content": "<p>Right. Perhaps mathlib has this but I don't know the magic spell</p>",
        "id": 539900123,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1758060194
    },
    {
        "content": "<p>Actually, what about this?</p>",
        "id": 539900602,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758060482
    },
    {
        "content": "<ul>\n<li><code>residue x ‚â§ residue y</code> when either <code>residue x = residue y</code> or <code>x ‚â§ y</code></li>\n<li><code>residue x &lt; residue y</code> when both <code>residue x ‚â† residue y</code> and <code>x &lt; y</code></li>\n</ul>",
        "id": 539900674,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758060535
    },
    {
        "content": "<p>I think both of these are independent of representative</p>",
        "id": 539900690,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758060544
    },
    {
        "content": "<p>Yeah these can be defined as <code>Quotient.lift‚ÇÇ</code> on <code>Prop</code>. It leaves you to justify it is a LinearOrder</p>",
        "id": 539901678,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1758061151
    },
    {
        "content": "<p>I think this is all related to the following fact: if you take a quotient of a linear order, where every equivalence class is convex, you get another linear order</p>",
        "id": 539902526,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758061716
    },
    {
        "content": "<p>btw, this linear order can be generalized to quotient between any two <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Order/Archimedean/Class.html#ArchimedeanClass.addSubgroup\">ArchimedeanClass.addSubgroup</a>, and you can also conclude the ArchimedeanClass on the quotient is isomorphic to the difference between the classes of the two subgroup (after properly dealing with 0). I had it in a very old branch (using the ugly LinearOrder.lift' way)</p>",
        "id": 539902532,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1758061719
    },
    {
        "content": "<p>Oh yeah I think what you said is even more general</p>",
        "id": 539902586,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1758061751
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"459227\">Violeta Hern√°ndez</span> <a href=\"#narrow/channel/116395-maths/topic/Leading.20term.20of.20valuation/near/539902526\">said</a>:</p>\n<blockquote>\n<p>I think this is all related to the following fact: if you take a quotient of a linear order, where every equivalence class is convex, you get another linear order</p>\n</blockquote>\n<p>convex as in <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Set.OrdConnected#doc\">docs#Set.OrdConnected</a></p>",
        "id": 539902745,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1758061856
    },
    {
        "content": "<p>you wouldn't know from just the name</p>",
        "id": 539902814,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1758061894
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"644391\">@loogle</span> LinearOrder, Quotient</p>",
        "id": 539902815,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758061895
    },
    {
        "content": "<p><span aria-label=\"shrug\" class=\"emoji emoji-1f937\" role=\"img\" title=\"shrug\">:shrug:</span> nothing found</p>",
        "id": 539902818,
        "sender_full_name": "loogle",
        "timestamp": 1758061896
    },
    {
        "content": "<p>Just re-made my PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/29687\">#29687</a> using the <code>IsLocalRing.residue</code> approach</p>",
        "id": 540145038,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758170336
    },
    {
        "content": "<p>Still drafted, since it depends on three other PRs, one of which is still being actively discussed</p>",
        "id": 540145063,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758170359
    },
    {
        "content": "<p>I'm still a bit surprised by the fact you can define a real-valued standard part from an arbitrary linearly ordered field without knowing anything about how the reals may or may not embed into it</p>",
        "id": 540150195,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758174254
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"873350\">@Weiyi Wang</span> <del>doesn't <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearOrderedField.uniqueOrderRingHom#doc\">docs#LinearOrderedField.uniqueOrderRingHom</a> generalize where the domain is an Archimedean field, not necessarily conditionally complete?</del> nevermind, I was thinking of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=OrderRingHom.subsingleton#doc\">docs#OrderRingHom.subsingleton</a></p>",
        "id": 540554622,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758337022
    },
    {
        "content": "<p>I found something related to this</p>\n<p><a href=\"/user_uploads/3121/GUKqvTvNelZsCXzJTMGDrjTR/Screenshot-from-2025-09-24-21-59-17.png\">Screenshot from 2025-09-24 21-59-17.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/GUKqvTvNelZsCXzJTMGDrjTR/Screenshot-from-2025-09-24-21-59-17.png\" title=\"Screenshot from 2025-09-24 21-59-17.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"981x918\" src=\"/user_uploads/thumbnail/3121/GUKqvTvNelZsCXzJTMGDrjTR/Screenshot-from-2025-09-24-21-59-17.png/840x560.webp\"></a></div><p>Irving Kaplansky, Maximal Fields with Valuations</p>\n<p>(K is a field with valuation V. The fancy \"R\" is an arbitrary field, not necessarily real numbers)</p>",
        "id": 541356165,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1758765821
    }
]