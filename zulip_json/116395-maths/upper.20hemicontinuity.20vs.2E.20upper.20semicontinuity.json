[
    {
        "content": "<p>There is a standard fact in the theory of complex Banach algebras: the spectrum is <a href=\"https://en.wikipedia.org/wiki/Hemicontinuity#Upper_hemicontinuity\">upper hemicontinuous</a> (although sometimes in the literature on this subject it is also called <em>upper semicontinuous</em>). I just <em>assumed</em> that it should be possible to unify this with our current definition of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=UpperSemicontinuous#doc\">docs#UpperSemicontinuous</a>, which would give us access to all that API, but as it stands it is not quite so easy.</p>",
        "id": 462386166,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1723655050
    },
    {
        "content": "<p>For reference: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">UpperSemicontinuousAt</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">Œ≤</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Preorder</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ·∂†</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">nhds</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x'</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">y</span>\n</code></pre></div>",
        "id": 462386186,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1723655063
    },
    {
        "content": "<p>The definition of <code>f : Œ± ‚Üí Set Œ≥</code>being <em>upper hemicontinuous</em> at <code>a : Œ±</code> is that for every open set <code>u</code> with <code>f a ‚äÜ u</code>, there is a neighborhood <code>v ‚àà ùìù a</code> such that for every <code>x ‚àà v</code>, <code>f x ‚äÜ u</code>. Or, in the language of filters (this definition does not currently exist in Mathlib):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">UpperHemicontinuousAt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">Œ≥</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">Œ≥</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"n\">nhdsSet</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ·∂†</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">ùìù</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"n\">nhdsSet</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 462386205,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1723655074
    },
    {
        "content": "<p>And now you can see the similarity with the definition of upper semicontinuity (by choosing <code>Œ≤ := Set Œ≥</code> and <code>(s &lt; t) := (t ‚àà nhdsSet s)</code>). However, there are two problems with this.</p>\n<ol>\n<li><code>t ‚àà nhdsSet s</code> is definitely not the <code>LT</code> instance on <code>Set Œ≥</code></li>\n<li><code>t ‚àà nhdsSet s</code> doesn't correspond to the <code>&lt;</code> for some <code>Preorder</code> on <code>Set Œ≥</code> as it's not irreflexive (since <code>u ‚àà nhdsSet u</code> if <code>u</code> is open).</li>\n</ol>",
        "id": 462386227,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1723655086
    },
    {
        "content": "<p>There is one way to deal with the fact that it doesn't correspond to a <code>Preorder</code>: bundle <code>spectrum ‚ÑÇ</code> into a function from the complex Banach algebra <code>A</code> to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=TopologicalSpace.NonemptyCompacts#doc\">docs#TopologicalSpace.NonemptyCompacts</a> (here you need to assume <code>[Nontrivial A]</code> which is annoying), and then for <code>t s : NonemptyCompacts ‚ÑÇ</code>, the relation <code>(t : Set ‚ÑÇ) ‚àà nhdsSet (s : Set ‚ÑÇ)</code> <em>is</em> irreflexive, and so corresponds to the <code>&lt;</code> of a <code>Preorder</code>. However, <code>NonemptyCompacts</code> already has an ordering, and it's just the pullback from the coercion to <code>Set ‚ÑÇ</code>. So, (a) this only partially solves the problem, and (b) it still doesn't allow us to talk about hemicontinuity as semicontinuity more generally.</p>",
        "id": 462386252,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1723655097
    },
    {
        "content": "<p>Therefore, I wonder if we might replace the definition of <code>UpperSemicontinuousAt</code> (and friends) with:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">UpperSemicontinuousAt</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">Œ≤</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsTrans</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ·∂†</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">nhds</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">y</span>\n</code></pre></div>\n<p>I'm interested to hear comments on this. Another possibility would be to define <code>UpperSemicontinuousAtWith</code> as this more general version, and then let <code>UpperSemicontinuousAt</code> be an <code>abbrev</code> for this with <code>r</code> instantiated as <code>&lt;</code> and assuming a <code>Preorder Œ≤</code>.</p>",
        "id": 462386258,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1723655101
    },
    {
        "content": "<p>Of course, I could just define <code>UpperHemicontinuousAt</code>, but duplicating API makes me <span aria-label=\"mad\" class=\"emoji emoji-1f621\" role=\"img\" title=\"mad\">:mad:</span> and <span aria-label=\"cry\" class=\"emoji emoji-1f622\" role=\"img\" title=\"cry\">:cry:</span></p>",
        "id": 462386804,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1723655335
    },
    {
        "content": "<p>is it even \"upper\" anymore at that point? Presumably lower semicontinuous just uses &gt; instead of &lt;</p>",
        "id": 462387114,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1723655450
    },
    {
        "content": "<p>I was also thinking you could merge <code>r</code> and <code>f</code> into one relational argument <code>r' x y = r (f x) y</code>, since they don't appear separately</p>",
        "id": 462387226,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1723655497
    },
    {
        "content": "<p>fair point, we should remove the <code>Upper</code> in the name in that case.</p>",
        "id": 462387240,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1723655505
    },
    {
        "content": "<p>I <em>think</em> you don't want to merge <code>r</code> and <code>f</code>, because I think you still want to know that <code>r</code> itself is transitive, otherwise I <em>suspect</em> it will be relatively useless.</p>",
        "id": 462387521,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1723655606
    },
    {
        "content": "<p>is knowing r is transitive but f is not monotone good for anything?</p>",
        "id": 462387670,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1723655668
    },
    {
        "content": "<p>it might be worth doing some reverse math on theorems using this assumption</p>",
        "id": 462387737,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1723655703
    },
    {
        "content": "<p>I mean, <code>f := spectrum ‚ÑÇ</code> is certainly not monotone in any sense, so the answer to your question is definitely \"yes\"</p>",
        "id": 462387844,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1723655752
    },
    {
        "content": "<p>Many Banach algebra don't even <em>have</em> an ordering, and the ones that do (e.g., C‚ãÜ-algebras) don't make <code>spectrum ‚ÑÇ</code> monotone.</p>",
        "id": 462388018,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1723655798
    },
    {
        "content": "<p>in that case, it seems the useful application of transitivity in this context is <code>r (f x) y -&gt; r y z -&gt; r (f x) z</code>, and the equivalent of that for <code>r'</code> is <code>r' x y -&gt; r' x z</code> (or <code>\\forall x, r' x y -&gt; r' x z</code>) viewed as an inequality relation between y and z</p>",
        "id": 462390424,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1723656800
    },
    {
        "content": "<p>(which is, incidentally, transitive for any <code>r'</code>)</p>",
        "id": 462390592,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1723656874
    },
    {
        "content": "<p>Well, here's the other half of this: if I'm going to make this generalization, I want to make it as seamless as possible for the existing use case, which is <code>Preorder Œ≤</code>. Writing <code>SemicontinuousAtWith (¬∑ &lt; ¬∑) f</code>, while a <em>bit</em> annoying, wouldn't be nearly as bad as <code>SemicontinuousAtWith (¬∑ &lt; ¬∑) (stupid term proving ‚àÄ x, r' x y ‚Üí r' x z) f</code>. I guess if it's an <code>abbrev</code>, then maybe it's okay, but it's not my favorite thing unless we have yet another use case.</p>",
        "id": 462391411,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1723657219
    },
    {
        "content": "<p>I don't think the stupid term needs to be part of the definition, it would just be <code>SemicontinuousAtWith (f ¬∑ &lt; ¬∑)</code></p>",
        "id": 462392761,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1723657865
    },
    {
        "content": "<p>aha, I see.</p>",
        "id": 462392819,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1723657905
    },
    {
        "content": "<p>you would use the term when applying a theorem that actually uses transitivity in some way</p>",
        "id": 462392926,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1723657939
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"268315\">@Anatole Dedecker</span> and I had a discussion about this because we need a lot of semicontinuity for our proof of the von Neumann minimax theorem (Sion's theorem, actually), all of which I can remember is that mathlib's definition of semicontinuity is not the good one (only valid for real numbers) and that a naive extension (for nonlinear orders) is ridiculously uninteresting.</p>",
        "id": 462517795,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1723716861
    },
    {
        "content": "<p>Still, the thread is there: <a href=\"#narrow/stream/116395-maths/topic/Semicontinuity.20definition.20for.20non-linear.20orders/near/432898278\">https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Semicontinuity.20definition.20for.20non-linear.20orders/near/432898278</a></p>",
        "id": 462517931,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1723716906
    }
]