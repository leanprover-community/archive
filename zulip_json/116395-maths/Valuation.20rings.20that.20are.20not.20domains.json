[
    {
        "content": "<p>I am working on formalizing Kaplansky's theorem, which states that</p>\n<blockquote>\n<p>For commutative Noetherian R, R is a PIR iff every maximal ideal is principal.</p>\n</blockquote>\n<p>In fact, his theorem is a classification of noetherian commutative rings -- every such ring can be decomposed as a finite direct sum of integral domains and valuation rings (with DCC).<br>\n<a href=\"/user_uploads/3121/iuOrgqda-fpR1CBMXRGqQ0Km/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/iuOrgqda-fpR1CBMXRGqQ0Km/image.png\" title=\"image.png\"><img data-original-dimensions=\"1656x248\" src=\"/user_uploads/thumbnail/3121/iuOrgqda-fpR1CBMXRGqQ0Km/image.png/840x560.webp\"></a></div>",
        "id": 475984781,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1728520611
    },
    {
        "content": "<p>However, this classification is not possible to state in this manner in mathlib, since <code>ValuationRing</code> assumes <code>IsDomain</code>.</p>",
        "id": 475984845,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1728520650
    },
    {
        "content": "<p>There are rings that satisfy the axioms of <code>ValuationRing</code> that cannot satisfy <code>IsDomain</code>, and Mathlib knows about one such example: <code>K[X] / X^2</code> where <code>K</code> is a field. Formalized as the dual numbers over <code>K</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">RingTheory</span><span class=\"bp\">.</span><span class=\"n\">DualNumber</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">RingTheory</span><span class=\"bp\">.</span><span class=\"n\">Valuation</span><span class=\"bp\">.</span><span class=\"n\">ValuationRing</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">DualNumber</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span>\n\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">IsPrincipalIdealRing</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">[</span><span class=\"n\">ε</span><span class=\"o\">]</span>\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">LocalRing</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">[</span><span class=\"n\">ε</span><span class=\"o\">]</span>\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">IsBezout</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">[</span><span class=\"n\">ε</span><span class=\"o\">]</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">maximalIdeal_eq_span_singleton_eps</span><span class=\"w\"> </span><span class=\"c1\">-- maximal ideal is not bot; requirement for DVR</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">exists_mul_left_or_mul_right</span><span class=\"w\"> </span><span class=\"c1\">-- ∀ (a b : K[ε]), ∃ c, a * c = b ∨ b * c = a</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">ValuationRing</span><span class=\"bp\">.</span><span class=\"n\">cond'</span><span class=\"w\"> </span><span class=\"c1\">-- ∀ (a b : A), ∃ (c : A), a * c = b ∨ b * c = a</span>\n<span class=\"c1\">-- but we can't have IsDomain K[ε], since ε is nilpotent</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">isNilpotent_eps</span>\n</code></pre></div>",
        "id": 475985028,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1728520787
    },
    {
        "content": "<p>Can the _definition_ of <code>ValuationRing</code> (and possibly DVR) be loosened to not require <code>IsDomain</code>? A small number of theorems would also no longer require it. And it would allow me to state the classification. Otherwise, I'll have to express the classification as a direct sum of integral domains and rings-that-have-the-valuation-ring-condition-but-not-as-a-class.</p>",
        "id": 475985243,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1728520924
    },
    {
        "content": "<p>Weakening valuation ring sounds fine to me. I'm less sure about DVR. Is there literature on DVRs that are not domains? Would mathlib need a DVD concept?</p>",
        "id": 475990011,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1728522993
    },
    {
        "content": "<p>I guess for DVR, my only current argument is consistency with the VR definition</p>",
        "id": 475990743,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1728523306
    },
    {
        "content": "<p>Deligne has paper(s?) on \"truncated DVRs\"</p>",
        "id": 475991125,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1728523450
    },
    {
        "content": "<p>This one? <a href=\"https://github.com/riccardobrasca/kaplanski4/tree/master\">https://github.com/riccardobrasca/kaplanski4/tree/master</a></p>\n<p>Cc <span class=\"user-mention\" data-user-id=\"130384\">@Riccardo Brasca</span></p>",
        "id": 476036989,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1728539391
    },
    {
        "content": "<p>I think that we shouldn't deviate from the terminology used in the literature...</p>",
        "id": 476038391,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1728540045
    },
    {
        "content": "<p>I agree that we should not deviate from established names: I'd rather have <code>preDVR</code> and <code>DVR</code>, rather than using <code>DVD</code> for what everyone else calls a <code>DVR</code>.</p>",
        "id": 476039055,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1728540214
    },
    {
        "content": "<p>Right, but what about valuation ring?</p>",
        "id": 476045545,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1728541935
    },
    {
        "content": "<p>Maybe there should be a typeclass that only assumes <code>Mul</code>, since this seems to be all that <code>ValuationRing</code> actually uses?  And then we can reserve the <code>ValuationRing</code> name for the more restricted one?</p>",
        "id": 476046853,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1728542287
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/stream/116395-maths/topic/Valuation.20rings.20that.20are.20not.20domains/near/476036989\">said</a>:</p>\n<blockquote>\n<p>This one? <a href=\"https://github.com/riccardobrasca/kaplanski4/tree/master\">https://github.com/riccardobrasca/kaplanski4/tree/master</a></p>\n<p>Cc <span class=\"user-mention silent\" data-user-id=\"130384\">Riccardo Brasca</span></p>\n</blockquote>\n<p>I am not sure what \"this one\" refers to, but that repo contains a proof of the fact that an integral domain is a UFD if and only if every nonzero prime ideal contains a prime element. It is not directly related to DVRs.</p>",
        "id": 476065913,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1728546481
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/116395-maths/topic/Valuation.20rings.20that.20are.20not.20domains/near/476038391\">said</a>:</p>\n<blockquote>\n<p>I think that we shouldn't deviate from the terminology used in the literature...</p>\n</blockquote>\n<p>Ah, but the Kaplansky reference is part of the literature <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 476109988,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1728559935
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/17634\">https://github.com/leanprover-community/mathlib4/pull/17634</a></p>",
        "id": 476294923,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1728620355
    }
]