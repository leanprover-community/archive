[
    {
        "content": "<p>Have Euler-Maclaurin and Poisson summation already been formalized? If so, where, and in what generality?</p>\n<p>(Meta-question: how do I find this sort of thing out myself?)</p>",
        "id": 567379590,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1768125066
    },
    {
        "content": "<p>Helpful tools are Leansearch, <a href=\"https://deepwiki.com/leanprover-community/mathlib4\">https://deepwiki.com/leanprover-community/mathlib4</a> and <a href=\"https://www.leanexplore.com\">https://www.leanexplore.com</a><br>\ne.g.<br>\n<a href=\"https://leansearch.net/?q=poisson+summation\">https://leansearch.net/?q=poisson+summation</a></p>",
        "id": 567380509,
        "sender_full_name": "Matteo Cipollina",
        "timestamp": 1768126059
    },
    {
        "content": "<p>Thank you!</p>\n<p>I'm finding Poisson summation but not Euler-Maclaurin, oddly. Where is it hiding?</p>",
        "id": 567380653,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1768126188
    },
    {
        "content": "<p>It is not yet in mathlib, here is a step towards it:<br>\n<a href=\"https://github.com/leanprover-community/mathlib4/pull/32364\">https://github.com/leanprover-community/mathlib4/pull/32364</a></p>",
        "id": 567380880,
        "sender_full_name": "Matteo Cipollina",
        "timestamp": 1768126472
    },
    {
        "content": "<p>I'm not finding it. Do we at least have first-order Euler-Maclaurin? That's all I need.</p>",
        "id": 567380932,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1768126536
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"779253\">@Matteo Cipollina</span> That may have been on me - now I can see the thread. However, I cannot see a blueprint, or even Lean code. Sorry for the newbie question, but where do I find them? Where do I click?</p>",
        "id": 567388061,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1768135371
    },
    {
        "content": "<p>Sorry  if that was a bit cyptic, the lean code in that PR is mostly contained in <a href=\"https://github.com/leanprover-community/mathlib4/blob/e1d6e8b1a4986d981540529e60aa6dffa147c1f6/Mathlib/Analysis/Calculus/ContDiff/Polynomial.lean\">Mathlib.Analysis.Calculus.ContDiff.Polynomial</a>. No blueprint is provided for mathlib files, they tend to have self-contained doc-strings instead.</p>",
        "id": 567389208,
        "sender_full_name": "Matteo Cipollina",
        "timestamp": 1768136789
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"779253\">@Matteo Cipollina</span>  All I see is the statement that polynomials are smooth. I just want to know what I can assume in a blueprint. Do we have the following statement (first-order Euler-Maclaurin), or one very close to it? In the latter case, what is it exactly?</p>\n<p>Let $a,b\\in \\mathbb{R}$, $a&lt;b$. Let $f:[a,b]\\to \\mathbb{C}$ be absolutely continuous. Then<br>\n<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mo>∑</mo><mrow><mi>a</mi><mo>&lt;</mo><mi>n</mi><mo>≤</mo><mi>b</mi></mrow></msub><mi>f</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo><mo>=</mo><msubsup><mo>∫</mo><mi>a</mi><mi>b</mi></msubsup><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mi>d</mi><mi>x</mi><mo>−</mo><mo stretchy=\"false\">(</mo><mo stretchy=\"false\">(</mo><mo stretchy=\"false\">{</mo><mi>b</mi><mo stretchy=\"false\">}</mo><mo>−</mo><mn>1</mn><mi mathvariant=\"normal\">/</mi><mn>2</mn><mo stretchy=\"false\">)</mo><mi>f</mi><mo stretchy=\"false\">(</mo><mi>b</mi><mo stretchy=\"false\">)</mo><mo>−</mo><mo stretchy=\"false\">(</mo><mo stretchy=\"false\">{</mo><mi>a</mi><mo stretchy=\"false\">}</mo><mo>−</mo><mn>1</mn><mi mathvariant=\"normal\">/</mi><mn>2</mn><mo stretchy=\"false\">)</mo><mi>f</mi><mo stretchy=\"false\">(</mo><mi>a</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo><mo>+</mo><msubsup><mo>∫</mo><mi>a</mi><mi>b</mi></msubsup><mo stretchy=\"false\">(</mo><mo stretchy=\"false\">{</mo><mi>x</mi><mo stretchy=\"false\">}</mo><mo>−</mo><mn>1</mn><mi mathvariant=\"normal\">/</mi><mn>2</mn><mo stretchy=\"false\">)</mo><msup><mi>f</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mi>d</mi><mi>x</mi><mi mathvariant=\"normal\">.</mi></mrow><annotation encoding=\"application/x-tex\">\\sum_{a&lt;n\\leq b} f(n) = \\int_a^b f(x) dx - ((\\{b\\}-1/2) f(b) - (\\{a\\}-1/2) f(a)) + \\int_a^b (\\{x\\}-1/2) f&#x27;(x) dx.</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1449em;vertical-align:-0.3949em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1864em;\"><span style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"mrel mtight\">&lt;</span><span class=\"mord mathnormal mtight\">n</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathnormal mtight\">b</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3949em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.3998em;vertical-align:-0.3558em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"margin-right:0.19445em;position:relative;top:-0.0006em;\">∫</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.044em;\"><span style=\"top:-2.3442em;margin-left:-0.1945em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">a</span></span></span><span style=\"top:-3.2579em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">b</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3558em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(({</span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">}</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1/2</span><span class=\"mclose\">)</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">({</span><span class=\"mord mathnormal\">a</span><span class=\"mclose\">}</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1/2</span><span class=\"mclose\">)</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mclose\">))</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.3998em;vertical-align:-0.3558em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"margin-right:0.19445em;position:relative;top:-0.0006em;\">∫</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.044em;\"><span style=\"top:-2.3442em;margin-left:-0.1945em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">a</span></span></span><span style=\"top:-3.2579em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">b</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3558em;\"><span></span></span></span></span></span></span><span class=\"mopen\">({</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">}</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0019em;vertical-align:-0.25em;\"></span><span class=\"mord\">1/2</span><span class=\"mclose\">)</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">x</span><span class=\"mord\">.</span></span></span></span></p>",
        "id": 567390733,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1768138564
    },
    {
        "content": "<p>Unfortunately I suspect that the statement under the assumptions you need would require new infrastructure (either a new FTC/IBP theorem for absolutely continuous functions using an ae. derivative, or a refactor of Abel summation to accept ae. differentiability<br>\nThe below statement assuming continuously differentiable is possibly the closest that can be stated with available mathlib, still someone more familiar with the ongoing PRs may have a better picture of the situation:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">Real</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"o\">}</span>\n\n<span class=\"sd\">/-- **First-order Euler–Maclaurin with fractional part**</span>\n<span class=\"sd\">We assume `ContDiffOn ℝ 1 f (Icc a b)` (continuously differentiable),</span>\n<span class=\"sd\">which is sufficient for the first-order case.</span>\n<span class=\"sd\">-/</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">first_order_euler_maclaurin_fract</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hab</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ContDiffOn</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Icc</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"bp\">∑</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">Icc</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">floor</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">floor</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">..</span><span class=\"n\">b</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-</span>\n<span class=\"w\">        </span><span class=\"o\">(((</span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">fract</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">fract</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">+</span>\n<span class=\"w\">        </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">..</span><span class=\"n\">b</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">fract</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 567402091,
        "sender_full_name": "Matteo Cipollina",
        "timestamp": 1768150134
    },
    {
        "content": "<p>That's enough for the application I have in my hands right now, but IMHO we really need statements with weaker assumptions, in general (either AC or even BV).</p>",
        "id": 567402182,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1768150203
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"603502\">Harald Helfgott</span> <a href=\"#narrow/channel/423402-PrimeNumberTheorem.2B/topic/Euler-Maclaurin.2C.20Poisson.20summation/near/567390733\">said</a>:</p>\n<blockquote>\n<p>Do we have the following statement (first-order Euler-Maclaurin), or one very close to it? In the latter case, what is it exactly?</p>\n<p>Let $a,b\\in \\mathbb{R}$, $a&lt;b$. Let $f:[a,b]\\to \\mathbb{C}$ be absolutely continuous. Then<br>\n<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mo>∑</mo><mrow><mi>a</mi><mo>&lt;</mo><mi>n</mi><mo>≤</mo><mi>b</mi></mrow></msub><mi>f</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo><mo>=</mo><msubsup><mo>∫</mo><mi>a</mi><mi>b</mi></msubsup><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mi>d</mi><mi>x</mi><mo>−</mo><mo stretchy=\"false\">(</mo><mo stretchy=\"false\">(</mo><mo stretchy=\"false\">{</mo><mi>b</mi><mo stretchy=\"false\">}</mo><mo>−</mo><mn>1</mn><mi mathvariant=\"normal\">/</mi><mn>2</mn><mo stretchy=\"false\">)</mo><mi>f</mi><mo stretchy=\"false\">(</mo><mi>b</mi><mo stretchy=\"false\">)</mo><mo>−</mo><mo stretchy=\"false\">(</mo><mo stretchy=\"false\">{</mo><mi>a</mi><mo stretchy=\"false\">}</mo><mo>−</mo><mn>1</mn><mi mathvariant=\"normal\">/</mi><mn>2</mn><mo stretchy=\"false\">)</mo><mi>f</mi><mo stretchy=\"false\">(</mo><mi>a</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo><mo>+</mo><msubsup><mo>∫</mo><mi>a</mi><mi>b</mi></msubsup><mo stretchy=\"false\">(</mo><mo stretchy=\"false\">{</mo><mi>x</mi><mo stretchy=\"false\">}</mo><mo>−</mo><mn>1</mn><mi mathvariant=\"normal\">/</mi><mn>2</mn><mo stretchy=\"false\">)</mo><msup><mi>f</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mi>d</mi><mi>x</mi><mi mathvariant=\"normal\">.</mi></mrow><annotation encoding=\"application/x-tex\">\\sum_{a&lt;n\\leq b} f(n) = \\int_a^b f(x) dx - ((\\{b\\}-1/2) f(b) - (\\{a\\}-1/2) f(a)) + \\int_a^b (\\{x\\}-1/2) f&#x27;(x) dx.</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1449em;vertical-align:-0.3949em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1864em;\"><span style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"mrel mtight\">&lt;</span><span class=\"mord mathnormal mtight\">n</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathnormal mtight\">b</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3949em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.3998em;vertical-align:-0.3558em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"margin-right:0.19445em;position:relative;top:-0.0006em;\">∫</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.044em;\"><span style=\"top:-2.3442em;margin-left:-0.1945em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">a</span></span></span><span style=\"top:-3.2579em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">b</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3558em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(({</span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">}</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1/2</span><span class=\"mclose\">)</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">({</span><span class=\"mord mathnormal\">a</span><span class=\"mclose\">}</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1/2</span><span class=\"mclose\">)</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mclose\">))</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.3998em;vertical-align:-0.3558em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"margin-right:0.19445em;position:relative;top:-0.0006em;\">∫</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.044em;\"><span style=\"top:-2.3442em;margin-left:-0.1945em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">a</span></span></span><span style=\"top:-3.2579em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">b</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3558em;\"><span></span></span></span></span></span></span><span class=\"mopen\">({</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">}</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0019em;vertical-align:-0.25em;\"></span><span class=\"mord\">1/2</span><span class=\"mclose\">)</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">x</span><span class=\"mord\">.</span></span></span></span></p>\n</blockquote>\n<p>Yes, this was proved a while ago in PNT+, see <a href=\"https://alexkontorovich.github.io/PrimeNumberTheoremAnd/blueprint/sect0003.html#sum_eq_int_deriv\">Lemma 3.4.1</a></p>",
        "id": 567404050,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1768151934
    },
    {
        "content": "<p>Right, that's what Matteo just said; thanks. As I said, it would be best not to assume $C^1$ needlessly, but the function I am working with right now is in fact in $C^1$.</p>",
        "id": 567404083,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1768151980
    },
    {
        "content": "<p>Now there's an issue with Poisson summation. While the version in mathlib is labelled \"most general form\", it isn't, and, in particular, it's not general enough for the rather ordinary application I have in my hands. (Read: it won't be the last time this happens.) It would be good to have something like the version I'm attaching, from Montgomery-Vaughan, vol I, Appendix D. My f is actually compactly supported, but Montgomery-Vaughan's assumptions seem to me to have the right amount of generality. </p>\n<p>What to do then? The version in mathlib assumes $\\widehat{f}$ is summable (and that doesn't hold in general, or in my case).<br>\n<a href=\"/user_uploads/3121/u9XFQQuZ0gHSSUYgsCKoDy6k/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/u9XFQQuZ0gHSSUYgsCKoDy6k/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"730x921\" src=\"/user_uploads/thumbnail/3121/u9XFQQuZ0gHSSUYgsCKoDy6k/image.png/840x560.webp\"></a></div>",
        "id": 567405880,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1768153705
    },
    {
        "content": "<p>In the proof in M-V, (D.2) is just this: <br>\n<a href=\"/user_uploads/3121/IS0DFsfRTTtG4jCT_pyVWqXO/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/IS0DFsfRTTtG4jCT_pyVWqXO/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"700x134\" src=\"/user_uploads/thumbnail/3121/IS0DFsfRTTtG4jCT_pyVWqXO/image.png/840x560.webp\"></a></div>",
        "id": 567405904,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1768153739
    },
    {
        "content": "<p><a class=\"stream-topic\" data-stream-id=\"116395\" href=\"/#narrow/channel/116395-maths/topic/Euler-Maclaurin.20formula/with/561024647\">#maths &gt; Euler-Maclaurin formula</a></p>",
        "id": 567410714,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1768159137
    },
    {
        "content": "<p>Do you think we can issue this form of Poisson summation and its proof (as they stand in M-V) as a blueprint, or is more detail needed?</p>",
        "id": 567451809,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1768201405
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"603502\">Harald Helfgott</span> <a href=\"#narrow/channel/423402-PrimeNumberTheorem.2B/topic/Euler-Maclaurin.2C.20Poisson.20summation/near/567405880\">said</a>:</p>\n<blockquote>\n<p>Now there's an issue with Poisson summation. While the version in mathlib is labelled \"most general form\", it isn't, and, in particular, it's not general enough for the rather ordinary application I have in my hands. (Read: it won't be the last time this happens.) It would be good to have something like the version I'm attaching, from Montgomery-Vaughan, vol I, Appendix D. My f is actually compactly supported, but Montgomery-Vaughan's assumptions seem to me to have the right amount of generality. </p>\n<p>What to do then? The version in mathlib assumes $\\widehat{f}$ is summable (and that doesn't hold in general, or in my case).<br>\n<a href=\"/user_uploads/3121/u9XFQQuZ0gHSSUYgsCKoDy6k/image.png\">image.png</a></p>\n</blockquote>\n<p>I would like to push back slightly on the claim that the Mathlib version is not general. The theorem in MV is of a genuinely different nature, since the convergence of the Fourier coefficients there is not unconditional, whereas the Mathlib version assumes unconditional convergence. For this reason, I think it would be both nice and essentially important to eventually have both versions available in Mathlib.</p>",
        "id": 567690909,
        "sender_full_name": "Yongxi Lin (Aaron)",
        "timestamp": 1768285094
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"603502\">Harald Helfgott</span> <a href=\"#narrow/channel/423402-PrimeNumberTheorem.2B/topic/Euler-Maclaurin.2C.20Poisson.20summation/near/567451809\">said</a>:</p>\n<blockquote>\n<p>Do you think we can issue this form of Poisson summation and its proof (as they stand in M-V) as a blueprint, or is more detail needed?</p>\n</blockquote>\n<p>The version for functions of bounded variation is definitely not easy to formalize and I believe it should not be a single issue. I am pretty sure we don't have the theorem about the convergence of Fourier series (D.2 in the picture above) and integration by parts for functions of bounded variation in Mathlib.</p>",
        "id": 567691605,
        "sender_full_name": "Yongxi Lin (Aaron)",
        "timestamp": 1768285483
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"669043\">@Yongxi Lin (Aaron)</span> -</p>\n<blockquote>\n<p>I would like to push back slightly on the claim that the Mathlib version is not general. </p>\n</blockquote>\n<p>Let me reply equally gently. What I objected to was not the Mathlib version, or the claim that is general, but rather the claim in its description that it is <em>most</em> general.</p>\n<blockquote>\n<p>For this reason, I think it would be both nice and essentially important to eventually have both versions available in Mathlib.</p>\n</blockquote>\n<p>I agree.</p>",
        "id": 567719188,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1768296906
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"669043\">@Yongxi Lin (Aaron)</span> said:</p>\n<blockquote>\n<p>The version for functions of bounded variation is definitely not easy to formalize and I believe it should not be a &gt;single issue. I am pretty sure we don't have the theorem about the convergence of Fourier series (D.2 in the &gt;picture above) and integration by parts for functions of bounded variation in Mathlib.</p>\n</blockquote>\n<p>Then this is an excellent opportunity to formalize some basic analytic statements -- starting with the two you mention -- for functions of bounded variation.</p>\n<p>Yes, it is not a single issue: lots of folks will need statements in greater generality than $C^1$, and the natural setting for many statements is broader than $C^1$. This is not about pathological functions or edge cases. Plenty of bread-and-butter functions in analysis and applications of analysis -- say, to analytic number theory -- are not $C^1$.</p>\n<p>I think we have two options: either </p>\n<ol>\n<li>gradually generalize basic statements (integration by parts, Euler-Maclaurin, convergence of Fourier series, etc.) to a growing list of classes of functions (piecewise C^1 functions, functions with a finite number of points of discontinuity, etc.), or </li>\n<li>choose a broad class of functions that </li>\n</ol>\n<ul>\n<li>covers many such cases</li>\n<li>is natural from the point of view of the proofs.<br>\nOr two classes, say, at most; not more.</li>\n</ul>\n<p>To me, the second option seems clearly preferable, both from the point of view of proof and usage (or \"mathematics\" and \"engineering\" if you prefer).</p>\n<p>For this kind of practical statements in analysis, the two plausible candidates for such \"broad classes\" seem to me to be:</p>\n<ul>\n<li>functions of bounded variation, </li>\n<li>absolutely continuous functions.<br>\nPeople: if I am missing anything, please tell me. </li>\n</ul>\n<p>The function I'm dealing with right now ($1_{[a,b} t^{-s}$) is of bounded variation but not absolutely continuous, or even continuous. Functions like this come up all the time in analytic number theory.</p>\n<p>Since absolutely continuous functions <em>are</em> of bounded variation on compact intervals,  the simplest option seems to be to prove things with the condition:</p>\n<ul>\n<li>bounded variation on $[a,b]$<br>\nwhenever possible. This is often the weakest condition that makes a statement true and straightforward to prove. Then we can have additional conditions if they are really needed: AC, global BV (i.e., total variation $&lt;\\infty$ on all of $\\mathbb{R}$), etc.</li>\n</ul>\n<p>This would give us a stable class that would cover plenty of others, accommodating the smoother cases as special instances. Even for those special instances, it would be good  to settle on a small number of \"standard\" regimes, rather than multiplying them. One such regime is $C^1$, which is used in much of Mathlib already. Absolute continuity would be another sensible regime; often statements that are proved for piecewise $C^1$ functions, say, can be proved just as easily assuming AC.</p>",
        "id": 567725580,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1768298952
    },
    {
        "content": "<p>Current status of these things in Mathlib: We have functions of bounded variation (<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=BoundedVariationOn#doc\">docs#BoundedVariationOn</a>), with a basic API. So it could be used today to state and prove theorems (this would probably highlight a lot of gaps in the API, but this is well and good). We don't have absolutely continuous functions yet, but there is a series of PRs by <span class=\"user-mention\" data-user-id=\"246439\">@Yizheng Zhu</span> bringing them to mathlib (<a href=\"https://github.com/leanprover-community/mathlib4/pull/29092\">#29092</a> has been split into smaller pieces).</p>",
        "id": 567746544,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1768305916
    },
    {
        "content": "<p>Thank you, <span class=\"user-mention\" data-user-id=\"110050\">@Sébastien Gouëzel</span>.</p>\n<p>What may be more up for discussion is which condition (weaker than $C^k$) we should use when we want, say, Euler-Maclaurin to the $k$th order, or bounds such as $\\leq C_k/|t|^k$ on the Fourier transform. A natural candidate seems to be \"let $f\\in L^1$ be such that the $k$th distributional derivative $D^k$ is a finite signed measure\", but I'm all ears as to alternatives. </p>\n<p>For $k=2$, in particular, there is at least one alternative which is equivalent mathematically but not at the level of language. (I don't mean W^{2,1}, which is too restrictive.) Among choices of the right strength -- or what that amounts to: reusability -- we should probably use whatever makes proofs more natural. Note that both $k$th-order Euler Maclaurin and the above bound on the Fourier transform are proved by iteration.</p>",
        "id": 567770045,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1768312544
    }
]