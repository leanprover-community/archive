[
    {
        "content": "<p>I have been attempting to get a formalization of Appendix A in Montgomery–Vaughan, which sets up a basic Riemann–Stieltjes integration theory—good enough, I presume, for everything that Montgomery–Vaughan do, which is plenty. It will certainly enable us to integrate by parts when one function is of bounded variation and the other one is in <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>C</mi><mn>1</mn></msup></mrow><annotation encoding=\"application/x-tex\">C^1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span>, thus filling a yawning gap in the theory. In this way, for instance, it will finally let us prove the standard decay estimate for Fourier transforms of functions of bounded variation, the lack of which has been blocking progress in more than one place.</p>\n<p>Most of this work has been carried out using Aristotle, with a fair amount of prompt engineering (via item 3 in its menu). One thing that became clear is that coding this kind of low-level combinatorial infrastructure in Lean —interval partitions, refinements, unions, mesh estimates—is a particularly difficult regime for Aristotle (and other AIs?), especially compared with its successes in matters that naturally impress us much more as mathematicians. Progress on Theorem A.1 only became possible after iteratively refining prompts, backtracking whenever matters did not seem to converge towards a result. I am now carefully cleaning up and restructuring the generated code by hand.</p>\n<p>I should also say that I am still a beginner in Lean/Mathlib, and that I am getting plenty of help from AI tools (including ChatGPT and VS Code's own chatbot) as I try to understand what is going on and improve the code. Once I have something halfway satisfactory, I would like to post the <code>.lean</code> file so that others can help improve it further.</p>\n<p>At any rate, here comes the crucial part. Before going much further, I would really appreciate advice on two structural questions:<br>\n<strong>(1) Abstractions for partitions.</strong><br>\nI am currently working with a very simple structure <code>RSPartition</code> (a <code>Monotone</code> map <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo>:</mo><mrow><mi mathvariant=\"normal\">F</mi><mi mathvariant=\"normal\">i</mi><mi mathvariant=\"normal\">n</mi></mrow><mo stretchy=\"false\">(</mo><mi>n</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo><mo>→</mo><mi mathvariant=\"double-struck\">R</mi></mrow><annotation encoding=\"application/x-tex\">x : \\mathrm{Fin}(n+1) \\to \\mathbb{R}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">:</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathrm\">Fin</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">R</span></span></span></span> with specified endpoints). While the definition itself is trivial, proving even basic lemmas cleanly has been surprisingly painful. (Here I am speaking as the unelected representative of a team consisting of one hapless human and several AIs.) In particular, constructing a partition from a finite set of points (<code>RSPartition.fromPoints</code>) and then using it to define the union / refinement of partitions leads to a lot of code and code manipulations that I still find unintuitive.<br>\nIs there already an existing abstraction or API in Mathlib that I should be using instead of rolling this by hand?<br>\n<strong>(2) Interface with Mathlib’s Riemann integration.</strong><br>\nFor the theory to actually be useful, it seems essential to connect this mesh-based Riemann(-Stieltjes) theory with Mathlib’s existing Riemann integration framework (via <code>BoxIntegral</code>). I have asked about this before, but I would like to emphasize that we need an actual interface here, or the whole development risks remaining isolated. (More concretely: I would like to be able to use the fact that a bounded function on <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mi>a</mi><mo separator=\"true\">,</mo><mi>b</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">[a,b]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">]</span></span></span></span> that is continuous outside a set of measure <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span> is Riemann-integrable.) What is the recommended way to set up this bridge?</p>\n<p>Any pointers would be very welcome.</p>",
        "id": 570682680,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1769645081
    },
    {
        "content": "<p>Isn't the box integral framework already providing all the partitions you need? I.e., what do you need to develop which isn't already there?<br>\n<span class=\"user-mention\" data-user-id=\"214703\">@Yury G. Kudryashov</span> could probably say more, as the author of box integrals in Mathlib.</p>",
        "id": 570724499,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1769673289
    },
    {
        "content": "<p>Mathlib has box partitions of a box in <code>I -&gt; Real</code>, but has no specification to dimension one (at least, I didn't write any, but I didn't follow this folder since then).</p>",
        "id": 570724903,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769673430
    },
    {
        "content": "<p>Did you try building an equivalence to partitions of a box in <code>I -&gt; Real</code>? Also, <a href=\"https://aristotle.harmonic.fun/\">https://aristotle.harmonic.fun/</a> may be better in Lean than ChatGPT (but it has no interactive version yet, so it's more suitable for harder goals).</p>",
        "id": 570725297,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769673539
    },
    {
        "content": "<p>COI disclosure: I work for Harmonic</p>",
        "id": 570725361,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769673558
    },
    {
        "content": "<p>My question went partly in that direction (at least in my head): what can one get by specializing box integrals to dimension $1$?</p>\n<p>Yes, I've been using Aristotle throughout - I thought I had made it clear in the above. It is just that it got lost in the woods when proceeding on its own; things went forward only once I made ChatGPT (which was of limited utility on its own, in part due to its perception of Mathlib being rather impressionistic) draft scripts to give to Aristotle.</p>",
        "id": 570725930,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1769673697
    },
    {
        "content": "<p>I can post the .lean file here now (it still needs some golfing, and I also wanted to introduce some namespace discipline first). Then people can tell me whether this can all be done more easily through BoxIntegral.</p>\n<p>At the very least, however, building an equivalence should give the answer to (2). Can you give me a hand? I'm not even sure of where to find the formal definition of a partition of a box in BoxIntegral.</p>",
        "id": 570726345,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1769673827
    },
    {
        "content": "<p>By the way, as I've said elsewhere, I am very impressed with Aristotle - it managed to formalize chunks of a measure-theory/Fourier-analysis textbook (Wheeden-Zygmund), often with little or no human intervention.</p>",
        "id": 570726815,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1769673971
    },
    {
        "content": "<p>I think setting up a low-level combinatorial structure in Lean is the issue here. (I can sympathize with Aristotle, as it is not natural for me either.)</p>",
        "id": 570727192,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1769674092
    },
    {
        "content": "<p>See <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=BoxIntegral.Prepartition#doc\">docs#BoxIntegral.Prepartition</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=BoxIntegral.Prepartition.IsPartition#doc\">docs#BoxIntegral.Prepartition.IsPartition</a></p>",
        "id": 570758234,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769682882
    },
    {
        "content": "<p>Right; I can see that a BoxIntegral.Prepartition for n=1 must be mathematically equivalent to the definition IPartition I have in the file.</p>\n<p>All right - here is the Lean file (my first real Lean file — expect horrors).</p>\n<p>I don’t know whether the <code>RS.IPart</code> layer will eventually collapse completely into an existing Mathlib framework; I’m very much looking forward to hearing what <span class=\"user-mention\" data-user-id=\"214703\">@Yury G. Kudryashov</span> has to say about that. I am not placing my hopes on that, since if I understood correctly, the special case <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">n=1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> has not been worked out in particular in BoxIntegral, and there is much that works out differently or more simply for <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">n=1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>.</p>\n<p>What will be important going forward:<br>\n<strong>(a) A <em>need</em>: an interface to <code>BoxIntegral</code>.</strong><br>\nWhat I would like is the following workflow. Start with a function<br>\n<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo>:</mo><mo stretchy=\"false\">[</mo><mi>a</mi><mo separator=\"true\">,</mo><mi>b</mi><mo stretchy=\"false\">]</mo><mo>→</mo><mi mathvariant=\"double-struck\">R</mi></mrow><annotation encoding=\"application/x-tex\">f : [a,b] \\to \\mathbb{R}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">:</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">R</span></span></span></span>, assume it is bounded and continuous outside a set of Lebesgue measure zero. Use Mathlib’s existing theory (<code>BoxIntegral</code>) to obtain that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span> is Riemann integrable in the <em>BoxIntegral</em> sense — and then (this is the crucial interface) have this imply that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span> is Riemann integrable in the lightweight theory developed in this file.</p>\n<p>Conceptually this should be straightforward, but I don’t yet see the cleanest way to set up the bridge, and I’d be very grateful for advice from people familiar with <code>BoxIntegral</code> (especially its author <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span>).<br>\n<strong>(b) A <em>want</em>: simplifying “obvious” combinatorial lemmas.</strong><br>\nThere are several lemmas in <code>RS.IPart</code> that are mathematically trivial but turned out to be surprisingly painful to formalize — both for Aristotle and for a human beginner like myself. I suspect that some Mathlib machinery should make these much shorter and cleaner, but I don’t yet know how to use it properly.</p>\n<p>Examples include:</p>\n<ul>\n<li>\n<p><code>fromPoints</code></p>\n</li>\n<li>\n<p><code>points_fromPoints</code></p>\n</li>\n<li>\n<p><code>refinement_index_map</code></p>\n</li>\n<li>\n<p><code>sum_partition_blocks</code></p>\n</li>\n</ul>\n<p>If there are standard tricks, existing lemmas, or better abstractions that would let these collapse to a few lines, I’d love to learn about them.</p>\n<p>Any feedback — especially on structure, abstraction choices, or existing Mathlib APIs I may have missed — would be very welcome.<br>\n<a href=\"/user_uploads/3121/tSIlBwx9W44-blI0FplrJBk1/MyMV_A1.lean\">MyMV_A1.lean</a></p>",
        "id": 570770876,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1769686545
    },
    {
        "content": "<p>For (a), you can apply Mathlib API to the function <code>g : (Fin 1 → Real) → E</code> given by <code>g v = f (v 0)</code>. You'll have to manually transfer assumptions from <code>f</code> to <code>g</code>. This is not very convenient, but doable with the current Mathlib. For converting results about Bochner integral back and forth, see draft PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/34575\">#34575</a> (<strong>not ready for review yet</strong>). You may want to develop a similar API for box integrals.</p>",
        "id": 570816174,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769698297
    },
    {
        "content": "<p>It would be easier to review your code if you push it to Github.</p>",
        "id": 570816491,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769698369
    },
    {
        "content": "<p>Very well, I'll push it to GitHub. Can you give us a few more details as to (a)?</p>",
        "id": 570823678,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1769699917
    },
    {
        "content": "<p>Harald, the general mathlib way to say <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi mathvariant=\"double-struck\">R</mi><mi>n</mi></msup></mrow><annotation encoding=\"application/x-tex\">\\R^n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span></span></span></span></span></span></span> is <code>Fin n → Real</code> (an <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span>-tuple of real numbers is a map from <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mn>0</mn><mo separator=\"true\">,</mo><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mo separator=\"true\">,</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(0,...,n-1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">...</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span> to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">R</mi></mrow><annotation encoding=\"application/x-tex\">\\R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">R</span></span></span></span>). So if you just want one-variable, Yury is suggesting <code>Fin 1 → Real</code> for the domain.</p>",
        "id": 570916184,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1769730296
    },
    {
        "content": "<p>Since the translation between the <code>n</code>-dimensional theory and 1-dimensional theory is far from being automatic, it makes sense to add definitions about functions <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mspace></mspace><mspace width=\"0.1111em\"/><mo lspace=\"0em\" rspace=\"0.17em\"></mo><mtext> ⁣</mtext><mo lspace=\"0em\" rspace=\"0em\">:</mo><mspace width=\"0.3333em\"/><mi mathvariant=\"double-struck\">R</mi><mo>→</mo><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">f\\colon \\mathbb R \\to E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mspace nobreak\"></span><span class=\"mspace\" style=\"margin-right:0.1111em;\"></span><span class=\"mpunct\"></span><span class=\"mspace\" style=\"margin-right:-0.1667em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mrel\">:</span></span><span class=\"mspace\" style=\"margin-right:0.3333em;\"></span><span class=\"mord mathbb\">R</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span>, where <code>E</code> is a normed space, at least for notions like integrability and main theorems about it. I wouldn't translate boxes etc until you actually need them (and the proof can't be done in dimension <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span>, then specialized).</p>",
        "id": 570916527,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769730514
    },
    {
        "content": "<p>E.g., a function <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mspace></mspace><mspace width=\"0.1111em\"/><mo lspace=\"0em\" rspace=\"0.17em\"></mo><mtext> ⁣</mtext><mo lspace=\"0em\" rspace=\"0em\">:</mo><mspace width=\"0.3333em\"/><mi mathvariant=\"double-struck\">R</mi><mo>→</mo><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">f\\colon\\mathbb R\\to E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mspace nobreak\"></span><span class=\"mspace\" style=\"margin-right:0.1111em;\"></span><span class=\"mpunct\"></span><span class=\"mspace\" style=\"margin-right:-0.1667em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mrel\">:</span></span><span class=\"mspace\" style=\"margin-right:0.3333em;\"></span><span class=\"mord mathbb\">R</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span> is box integrable on <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mi>a</mi><mo separator=\"true\">,</mo><mi>b</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">[a, b]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">]</span></span></span></span>, if the function <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>g</mi><mi>f</mi></msub><mspace></mspace><mspace width=\"0.1111em\"/><mo lspace=\"0em\" rspace=\"0.17em\"></mo><mtext> ⁣</mtext><mo lspace=\"0em\" rspace=\"0em\">:</mo><mspace width=\"0.3333em\"/><msup><mi mathvariant=\"double-struck\">R</mi><mn>1</mn></msup><mo>→</mo><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">g_f\\colon \\mathbb R^1\\to E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1002em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10764em;\">f</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace nobreak\"></span><span class=\"mspace\" style=\"margin-right:0.1111em;\"></span><span class=\"mpunct\"></span><span class=\"mspace\" style=\"margin-right:-0.1667em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mrel\">:</span></span><span class=\"mspace\" style=\"margin-right:0.3333em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span> given by <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>g</mi><mi>f</mi></msub><mo stretchy=\"false\">(</mo><mi>v</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>f</mi><mo stretchy=\"false\">(</mo><msub><mi>v</mi><mn>0</mn></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">g_f(v)=f(v_0)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0361em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10764em;\">f</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> is integrable on <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mi mathvariant=\"normal\">const</mi><mo>⁡</mo><mi>a</mi><mo separator=\"true\">,</mo><mi mathvariant=\"normal\">const</mi><mo>⁡</mo><mi>b</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">[\\operatorname{const} a, \\operatorname{const} b]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mop\"><span class=\"mord mathrm\">const</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\"><span class=\"mord mathrm\">const</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">]</span></span></span></span>. In Lean, it's <code>fun _ : Fin 1 =&gt; a</code> and <code>fun _ : Fin 1 =&gt; b</code>. You can also use <code>![a]</code> and <code>![b]</code>. While they're equal to the constant functions, they aren't definitionally equal. I'm not sure which encoding will be more convenient down the path.</p>",
        "id": 570916722,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769730637
    },
    {
        "content": "<p>Come to think of it, is there not general Mathlib API for coercions between <code>Real</code> and <code>Fin 1 → Real</code>, and functions on such? I would think that would come in handy all over the place?</p>",
        "id": 570917132,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1769730902
    },
    {
        "content": "<p>We have them as <code>Equiv</code>s and some bundled equivalences (e.g., <code>MeasurableEquiv</code>s, <code>Homeomorph</code>s), but we don't have a good way to automatically transfer definitions/theorems along these equivalences.</p>",
        "id": 570917703,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769731281
    },
    {
        "content": "<p>Then it sounds like I've been proceeding correctly, no? I am working on <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">R</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{R}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">R</span></span></span></span>, and I'll call on the theory on <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi mathvariant=\"double-struck\">R</mi><mn>1</mn></msup></mrow><annotation encoding=\"application/x-tex\">\\mathbb{R}^1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span> at the last possible moment.</p>\n<p>What I need will be really something minimal: that, if a function <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo>:</mo><mi mathvariant=\"double-struck\">R</mi><mo>→</mo><mi mathvariant=\"double-struck\">C</mi></mrow><annotation encoding=\"application/x-tex\">f:\\mathbb{R}\\to \\mathbb{C}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">:</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">R</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">C</span></span></span></span> is continuous outside a set of Lebesgue measure zero, then it is Riemann-integrable in a very transparent sense (namely: I create a filter of meshes, and ask for the Riemann sums to converge). What one would do here would be to construct a function $g_f:\\mathbb{R}^1\\to \\mathbb{C}$, show it is continuous outside a set of Lebesgue measure zero (duh! but I imagine there's some trickery in proving this trivial fact), call a library function to show that it is Riemann-integrable in the <code>BoxIntegral</code> sense, and then show that this implies that it is Riemann-integrable in the \"very transparent\" sense (a special case of Riemann-Stieltjes: integrability with respect to dx). </p>\n<p>Incidentally, where and how do I push my code to GitHub? A kind soul told me at some point, but I've forgotten how. I take I can't just push it anywhere - I have to use a particular directory and so forth?</p>",
        "id": 570917867,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1769731336
    },
    {
        "content": "<p>You can look at <a href=\"https://tqft.net/mathlib4files/MeasureTheory/Integral/DivergenceTheorem\">file#MeasureTheory/Integral/DivergenceTheorem</a> for an example of transferring results about <code>Fin n -&gt; Real</code> to results about <code>Real</code> or <code>Prod Real Real</code> (<code>n = 2</code>).</p>",
        "id": 570917897,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769731357
    },
    {
        "content": "<p>You need to create a repository (a new project using <code>lake new</code>) or a fork of an existing project like PNT or Mathlib.</p>",
        "id": 570918071,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769731444
    },
    {
        "content": "<p>After creating an account, if you haven't done this yet.</p>",
        "id": 570918106,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769731468
    },
    {
        "content": "<p>An account on Github? Aha - what would be recommended protocol? It seems that we have by now some sort of ever-expanding analytic number theory project that is much wider than PNT+'s original purview, yet doesn't have the same goals or standards as Mathlib (though I take the aim is that whatever fits in Mathlib becomes part of Mathlib once it reaches Mathlib's standards).</p>",
        "id": 570918339,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1769731621
    },
    {
        "content": "<p>Harald, if you want, I can put the code into PNT+ for you - just email it to me</p>",
        "id": 570923485,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1769735471
    },
    {
        "content": "<p>Thanks, Alex, though a man should also learn to fish and so forth. </p>\n<p>Apparently I already have a Github account, and even my own fork created two weeks ago, somehow (<a href=\"https://github.com/Garald1/PrimeNumberTheoremAnd\">https://github.com/Garald1/PrimeNumberTheoremAnd</a>). Let me try to figure this out - I'll no doubt have questions. </p>\n<p>So what is the accepted procedure - I set up a Lean directory in my fork, upload my files to it, and then I request for them to go into PNT+ (meaning Alex's Github)?</p>",
        "id": 570961861,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1769759941
    },
    {
        "content": "<p>I'm reading Contributing.md - the following instructions are the relevant ones, no?<br>\n<a href=\"/user_uploads/3121/agVhVR0t2bU86RJnLpAuRAWf/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/agVhVR0t2bU86RJnLpAuRAWf/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1041x396\" src=\"/user_uploads/thumbnail/3121/agVhVR0t2bU86RJnLpAuRAWf/image.png/840x560.webp\"></a></div>",
        "id": 570962882,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1769760314
    },
    {
        "content": "<p>You make a checkout of your fork, add files there, then open a pull request.</p>",
        "id": 570963315,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769760464
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"603502\">@Harald Helfgott</span> I'm happy to jump on a quick call to teach you how to fish, if you'd like <span aria-label=\"fishing\" class=\"emoji emoji-1f3a3\" role=\"img\" title=\"fishing\">:fishing:</span></p>",
        "id": 571042801,
        "sender_full_name": "Aayush Rajasekaran",
        "timestamp": 1769783193
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"603502\">Harald Helfgott</span> <a href=\"#narrow/channel/423402-PrimeNumberTheorem.2B/topic/Formalizing.20Riemann-Stieltjes.20theory/near/570962882\">said</a>:</p>\n<blockquote>\n<p>I'm reading Contributing.md - the following instructions are the relevant ones, no?<br>\n<a href=\"/user_uploads/3121/agVhVR0t2bU86RJnLpAuRAWf/image.png\">image.png</a></p>\n</blockquote>\n<p>Those are more related to the specifics of any changes one is making -- they're not instructions for setting up your fork and opening Pull Requests.</p>",
        "id": 571043283,
        "sender_full_name": "Aayush Rajasekaran",
        "timestamp": 1769783293
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"983852\">@Aayush Rajasekaran</span> Thank you! I just have a single lean file to push - care to tell me how to do it? It contains the basics of Riemann -Stieltjes integration.</p>",
        "id": 571240784,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1769903208
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"603502\">Harald Helfgott</span> <a href=\"#narrow/channel/423402-PrimeNumberTheorem.2B/topic/Formalizing.20Riemann-Stieltjes.20theory/near/571240784\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"983852\">Aayush Rajasekaran</span> Thank you! I just have a single lean file to push - care to tell me how to do it? It contains the basics of Riemann -Stieltjes integration.</p>\n</blockquote>\n<p>You first need to check out your fork as Yury said above. If you've already done that, add the file to the appropriate folder, then run:</p>\n<ul>\n<li><code>git add &lt;name of the file&gt;</code></li>\n<li><code>git commit -m \"feat: Riemann-Stieltjes basics\"</code></li>\n<li><code>git push origin main</code>.</li>\n</ul>\n<p>If you haven't checked out your fork yet, there's a few steps you have to run first. I'm happy to jump on a quick call to walk you through it, or ChatGPT can probably help you too.</p>",
        "id": 571247593,
        "sender_full_name": "Aayush Rajasekaran",
        "timestamp": 1769911542
    },
    {
        "content": "<p>Oh, I have a fork now. Let me first finish getting a working proof of Theorem A.3 in Montgomery-Vaughan - then we can upload it.</p>",
        "id": 571248696,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1769913079
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"983852\">@Aayush Rajasekaran</span> I now have typechecked code for Theorems 1, 2 and 3a. Care to walk me through things? </p>\n<p>What is still unclear to me is what particular directory I should upload to - this is not a GitHub question, this is a question on what is the norm here.</p>",
        "id": 571412497,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1770033204
    },
    {
        "content": "<p>Right now we are placing all lean files in <code>PrimeNumberTheoremAnd</code>, though if there is a cluster of related Lean files it may be suitable for a subdirectory of that directory.  It is a relatively simple matter to reorganize these files later if needed.</p>",
        "id": 571503639,
        "sender_full_name": "Terence Tao",
        "timestamp": 1770058299
    },
    {
        "content": "<p>In the end, I will just need three facts about Riemann integrals on an interval [a,b]:<br>\n(a) if f is Riemann-integrable, then it is Lebesgue integrable, and its Riemann and Lebesgue integral are the same;<br>\n(b) if f is Riemann-integrable, then it is bounded;<br>\n(c) if f and g are Riemann-integrable, then f g is Riemann integrable.</p>\n<p>I imagine all of these are already in BoxIntegral? What are their names? (A brief Mathlib search yielded only confusion on my end, perhaps BoxIntegral.HasIntegral.integral_eq is (a)?)</p>\n<p>If that is the case, then all we need is to show that the \"naive\" definition of Riemann integral:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c\">/-</span>\n<span class=\"cm\">A Riemann-Stieltjes partition of [a, b] is a monotone map x : Fin (n+1) → ℝ with x(0) = a and x(n) = b.</span>\n<span class=\"cm\">-/</span>\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">IPartition</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span>\n<span class=\"w\">  </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span>\n<span class=\"w\">  </span><span class=\"n\">monotone</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Monotone</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">last</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">TaggedPartition</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">IPart</span><span class=\"bp\">.</span><span class=\"n\">IPartition</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">xi</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span>\n<span class=\"w\">  </span><span class=\"n\">h_xi</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"n\">castSucc</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">xi</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">xi</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"n\">succ</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">RSum</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TaggedPartition</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">∑</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"bp\">.</span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"bp\">.</span><span class=\"n\">xi</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">P</span><span class=\"bp\">.</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"bp\">.</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"n\">castSucc</span><span class=\"o\">))</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">HasRSIntegral</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">ε</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">δ</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TaggedPartition</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"bp\">.</span><span class=\"n\">mesh</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">δ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"n\">RSum</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">ε</span>\n</code></pre></div>\n<p>coincides with the BoxIntegral definition on one-dimensional intervals [a,b]. I imagine this is straightforward?</p>",
        "id": 571504893,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1770058814
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"214703\">@Yury G. Kudryashov</span> and everybody else: I have just uploaded files to Github - see <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/871\">https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/871</a>  I'd be interested in your feedback.</p>",
        "id": 571748972,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1770148151
    },
    {
        "content": "<p>I guess the main question for me is to what extent the main Riemann-Stieltjes integration by parts results (<code> Theorem_A2</code> of <code>MyMV_A3a.lean‎</code>, I guess) be usefully deployed to resolve tasks that are currently blocked by the need to do something like Riemann-Stieltjes integration by parts, such as <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/650\">PNT#650</a>, <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/562\">PNT#562</a>, or <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/563\">PNT#563</a>.  It may be that a lot more \"API\" connecting the RS integral in that file with more conventional Mathlib concepts, such as the Lebesgue-Stieltjes integral, may be needed.</p>",
        "id": 571804666,
        "sender_full_name": "Terence Tao",
        "timestamp": 1770171553
    },
    {
        "content": "<p>I believe we do not need much more than what we already have. Let me explain why.</p>\n<p>Once we have Theorem A3b, that is, the second half of Theorem A3 (we have got as far as the first half) we will just need a lemma identifying the Riemann integral as in this file (not the Riemann-Stieltjes integral in general) with the Riemann integral in <code>BoxIntegral</code>; that is the main missing step. Then, <em>thanks to the Mathlib lemmas that come with <code>BoxIntegral</code></em>, we will have that a Riemann-integrable function is Lebesgue-integrable, and that the two integrals then coincide. Once we have that, the entire theory is connected, and, in particular, PNT <a href=\"https://github.com/leanprover-community/mathlib4/pull/562\">#562</a> and similar statements (that is, decay estimates for the Fourier transforms of functions of bounded variation) should follow with only a little additional work.</p>\n<p>Now, to finish Theorem A3b, we can either go through a somewhat painful process (similar to what I've been through in the last few days to obtain Theorem A3a) or we can use the link to BoxIntegral we will need anyhow to obtain basic results that we would have to prove otherwise (a Riemann-integrable function is bounded, the product a Riemann-integrable and a continuous function is Riemann-integrable [in fact, the product of any two R-integrable functions is R-integrable]; I imagine these results, or others that imply them, are already in Mathlib, for Riemann integrals as defined in  <code>BoxIntegral</code> - that is why I have asked others to confirm this). I think the second course would be wiser.</p>\n<p>Let me reiterate: you don't need to have a link with the Lebesgue-Stieltjes theory; the \"edge that makes the graph connected\" is the edge between two definitions of the <em>Riemann</em> integral, namely, the one here (a _special case_ of RS) and the one in the library; once we have that the two definitions of \"Riemann integral\" are equivalent, the graph is connected, so to speak.</p>",
        "id": 571806673,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1770172959
    },
    {
        "content": "<p>OK. What are the plans for documenting these several thousand lines of Lean code?  We are using the blueprint to organize the rest of the PNT+ project, so one possibility is to attach some blueprint metadata to the most important theorems in these files (the ones other contributors would actually use for their purposes).  (Sublemmas that are only used internally within the file do not need to be blueprinted if they have already been formalized.)</p>\n<p>In the rest of the project we proceed in the other direction: we lay out the blueprint first, and then create Lean code for each of the components identified by the blueprint.  This generally makes it easier for other contributors to understand the structure of the files without having to directly read thousands of lines of Lean code.</p>",
        "id": 571807602,
        "sender_full_name": "Terence Tao",
        "timestamp": 1770173682
    },
    {
        "content": "<p>Well, my hope was that people would hack away at it and replace it by better code. I should say, however, that Aristotle has done a pretty good job of documenting its own code, or rather of describing what the lemma statements say. It is the proofs that are often ugly.</p>\n<p>I'll do a second pass of the Fejér file at some point. I find the structure of MyMVA3a.lean to be pretty readable, perhaps precisely because it was the outcome of lots of back-and-forth between Aristotle and myself (or shall I say my alter ego).</p>",
        "id": 571807977,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1770174011
    },
    {
        "content": "<p>Possibly all that is needed is some summary docstring at the top of the Lean file describing the main results and any general notes, similar to what is done in Mathlib Lean files (random example: <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/MeasureTheory/Measure/Stieltjes.html\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/MeasureTheory/Measure/Stieltjes.html</a> / <a href=\"https://github.com/leanprover-community/mathlib4/blob/be8defd50c175d2ce7598a43c1be199f53b7cae6/Mathlib/MeasureTheory/Measure/Stieltjes.lean\">https://github.com/leanprover-community/mathlib4/blob/be8defd50c175d2ce7598a43c1be199f53b7cae6/Mathlib/MeasureTheory/Measure/Stieltjes.lean</a> , which has a few paragraphs about the main definitions and implementation notes before diving into the lemmas and proofs).</p>",
        "id": 571808146,
        "sender_full_name": "Terence Tao",
        "timestamp": 1770174129
    },
    {
        "content": "<p>Sure, I can try adding that tomorrow. Let me understand that these are Aristotle and Dr. Gotthelf's first attempts, and that, even though they do typecheck, they are meant for others to improve (or replace) immediately - hopefully while giving us feedback.</p>",
        "id": 571808264,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1770174221
    },
    {
        "content": "<p>Well, I think there will be few volunteers to offer constructive feedback on a block of 1000+ lines of AI-generated code.  If there is a high-level structure that is described in a human-readable format and describes the results that would be most useful for applications, this would make it easier to review both at a high level, and at the low level of an individual lemma or other result identified in that structure.</p>",
        "id": 571808555,
        "sender_full_name": "Terence Tao",
        "timestamp": 1770174434
    },
    {
        "content": "<p>Sure. In a sense there is such a detailed, human-readable structure already: the files I've uploaded follow the relevant passages in Wheeden-Zygmund and Montgomery-Vaughan.</p>\n<p>It's 4:08am - let me document more tomorrow.</p>",
        "id": 571808662,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1770174518
    },
    {
        "content": "<p>In that case I would recommend tagging key theorems from WZ and MV with blueprint metadata, much as is done with other files in the blueprint that are following some literature source.</p>",
        "id": 571808719,
        "sender_full_name": "Terence Tao",
        "timestamp": 1770174569
    },
    {
        "content": "<p>Aha - how do I do that exactly? Should I do that within the lean file, or in some other format?</p>",
        "id": 571808741,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1770174599
    },
    {
        "content": "<p>That's done within the Lean file.  Example: <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/blob/main/PrimeNumberTheoremAnd/MobiusLemma.lean\">https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/blob/main/PrimeNumberTheoremAnd/MobiusLemma.lean</a> (compare with how the blueprint actually gets rendered at <a href=\"https://alexkontorovich.github.io/PrimeNumberTheoremAnd/blueprint/primary-chapter.html#a0000000032\">https://alexkontorovich.github.io/PrimeNumberTheoremAnd/blueprint/primary-chapter.html#a0000000032</a>).  (You need <code>import Architect</code> as a dependency of your file in order for the blueprint metadata to compile.)  There are a few other files that need to be tweaked in order for this metadata to actually show up in the PNT+ blueprint, but I can sort that out manually.</p>",
        "id": 571808904,
        "sender_full_name": "Terence Tao",
        "timestamp": 1770174748
    },
    {
        "content": "<p>OK, I'll look into this. It seems to me that you are asking for two levels of documentation (and that's completely reasonable): one, a very basic one, to enable others to use and perhaps build on the existing code; another, more thorough, to make it easier to edit the code or replace parts of it.</p>",
        "id": 571809051,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1770174878
    },
    {
        "content": "<p>I'm quite happy to see this as a ship of Theseus that actually floats but whose individual parts can and arguably should be replaced.</p>",
        "id": 571809099,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1770174921
    },
    {
        "content": "<p>Yeah, those are the two basic options (Mathlib style documentation, or blueprinting.)  In principle we could do both, but in practice we are using the blueprint only (and some minimal docstrings for each theorem, which Aristotle is already providing).</p>",
        "id": 571809171,
        "sender_full_name": "Terence Tao",
        "timestamp": 1770174973
    },
    {
        "content": "<p>This is what the lean documentation looks like right now for say your Mobius lemma: <a href=\"https://alexkontorovich.github.io/PrimeNumberTheoremAnd/docs/PrimeNumberTheoremAnd/MobiusLemma.html\">https://alexkontorovich.github.io/PrimeNumberTheoremAnd/docs/PrimeNumberTheoremAnd/MobiusLemma.html</a> .  It's very bare bones.  One could add more text to it, but because we have the blueprint, there really isn't a strong need to.</p>",
        "id": 571809274,
        "sender_full_name": "Terence Tao",
        "timestamp": 1770175087
    },
    {
        "content": "<p>I wouldn't quite speak of blueprinting here, since we are trying to explain something that already exists. At any rate what the experience has taught me is that, once AIs are in the picture, blueprinting is sometimes unnecessary (Aristotle can formalize some proofs in textbooks directly) and sometimes insufficient (there are spots where the AI goes badly astray).</p>",
        "id": 571809360,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1770175166
    },
    {
        "content": "<p>Blueprinting becomes more valuable when it isn't just a single human using AI to formalize a project, but many humans working together (either with AI tools, or manually).  So if the only objective is to document something that has already been formalized without any intention to modify the proofs further, a more bare-bones docstring would be fine, but if there are plans to refactor the code or to have different participants volunteer to work on different portions of the code, then the blueprint structure becomes quite useful.</p>",
        "id": 571809547,
        "sender_full_name": "Terence Tao",
        "timestamp": 1770175317
    },
    {
        "content": "<p>Right, blueprinting is meant more for humans, and we do want humans to look at this, but it's not meant quite for this situation. At any rate, we'll play this by ear. It could be an interesting experiment.</p>",
        "id": 571809635,
        "sender_full_name": "Harald Helfgott",
        "timestamp": 1770175384
    },
    {
        "content": "<p>Yeah, that's why I listed two separate options for how to document this code for others to be able to use.</p>",
        "id": 571809686,
        "sender_full_name": "Terence Tao",
        "timestamp": 1770175443
    }
]