[
    {
        "content": "<p>I am bumping mathlib in <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/178\">https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/178</a>, to use that mathlib knows that Fourier transform is a bijection on Schwartz space. The bump went really well thanks to deprecations (apart from the <code>nat_cast</code> renaming, on which we forgot to add deprecations). And Lean became more powerful at several places (less bugs in typeclass inference, <code>gcongr</code> more powerful), so most fixing was just removing things because the goal was already closed!</p>",
        "id": 441208798,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1716977736
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110050\">Sébastien Gouëzel</span> <a href=\"#narrow/stream/423402-PrimeNumberTheorem.2B/topic/mathlib.20bump/near/441208798\">said</a>:</p>\n<blockquote>\n<p>apart from the <code>nat_cast</code> renaming, on which we forgot to add deprecations</p>\n</blockquote>\n<p>Was this mine?</p>",
        "id": 441208950,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1716977785
    },
    {
        "content": "<p>Probably, yes. I'll look if I can generate the deprecations automatically.</p>",
        "id": 441210556,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1716978458
    },
    {
        "content": "<p>Deprecations in <a href=\"https://github.com/leanprover-community/mathlib4/pull/13368\">#13368</a> (around 275 deprecations...).</p>",
        "id": 441423930,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1717063372
    },
    {
        "content": "<p>Oh I see. Deprecations were not really \"forgotten\". Since there were so many of them and the name change was so mechanical, it was decided to not bother.</p>",
        "id": 441426150,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1717064241
    },
    {
        "content": "<p>Maybe you should have specified specific commits for Mathlib and the other dependencies  rather than just the master branch.  When I run make I get an error:<br>\nerror: ././.lake/packages/mathlib/lakefile.lean:86:2: error: unknown attribute [test_driver] <br>\nwhich I think is because Mathlib has now moved to Lean 4.9 but we're still on 4.8.</p>",
        "id": 443586287,
        "sender_full_name": "Alastair Irving",
        "timestamp": 1717932597
    },
    {
        "content": "<p>This is what the JSON file is for</p>",
        "id": 443587112,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1717933316
    },
    {
        "content": "<p>Preparing one now</p>",
        "id": 474680494,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1727989171
    },
    {
        "content": "<p><a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/192\">https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/192</a></p>",
        "id": 474686838,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1727992296
    },
    {
        "content": "<p>Darn, this broke again... (Building docs...) Any help?</p>",
        "id": 477017282,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1729006656
    },
    {
        "content": "<p>Sure, <code>doc-gen4</code> isn't in manifest. </p>\n<p>Fixed, tested locally and opened <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/195\">PR</a>.</p>",
        "id": 477031916,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1729011224
    },
    {
        "content": "<p>I believe there's no need to update the manifest, since <code>make doc</code> does that in CI (the last passing commit doesn't have <code>doc-gen4</code> in the manifest, for example). Pointing to the correct <code>doc-gen4</code> commit in <code>lakefile.lean</code> should suffice.</p>",
        "id": 477033983,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1729011923
    },
    {
        "content": "<p>When I locally run</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">lake -R -Kenv=dev build PrimeNumberTheoremAnd:docs</span>\n</code></pre></div>\n<p>It returns: </p>\n<div class=\"codehilite\" data-code-language=\"nothing\"><pre><span></span><code>error: dependency '«doc-gen4»' not in manifest; use `lake update «doc-gen4»` to add it\n</code></pre></div>\n<p>I tend to believe it's better to have all the dependencies in the manifest file, but I'm not sure.</p>",
        "id": 477035104,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1729012344
    },
    {
        "content": "<p>I don't mind either way, but CI doesn't run <code>lake</code> directly. It runs <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/blob/main/.github/workflows/push.yml#L117-L118\"><code>make LAKEBIN='~/.elan/bin/lake' doc</code></a>, and the Makefile takes care of running <code>$(LAKEBIN) -R -Kenv=dev update</code> before running a documentation build.</p>",
        "id": 477035600,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1729012503
    },
    {
        "content": "<p>I see... the PNT+ workflow is different from those I'm used to. </p>\n<p>Thanks <span class=\"user-mention\" data-user-id=\"325367\">@Mauricio Collares</span> for pointing that out.</p>",
        "id": 477035621,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1729012512
    },
    {
        "content": "<p>The changes in <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/195\">this PR</a> should work in any case.</p>",
        "id": 477035851,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1729012580
    },
    {
        "content": "<p>It worked! Thank you!!</p>",
        "id": 477040592,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1729014026
    },
    {
        "content": "<p>Not sure what's wrong with the CI in <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/203\">https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/203</a> ; it builds locally</p>",
        "id": 481090534,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1730976012
    },
    {
        "content": "<p>When I've seen errors like this, they're sometimes caused by the fact that even though a file builds locally, it somehow conflicts with another file in the repo which isn't imported. Can you get the error locally if you import the entire project all in one go?</p>",
        "id": 481091161,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1730976217
    },
    {
        "content": "<p>That shouldn't be it - I'm also running <code>lake build</code> locally. In fact, I did see that error before, but I fixed it by changing the version of mathlib I depended on</p>",
        "id": 481093274,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1730976915
    },
    {
        "content": "<p>Paging <span class=\"user-mention\" data-user-id=\"557226\">@Ian Jauslin</span> - any idea what's going on here?</p>",
        "id": 481133154,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1730989837
    },
    {
        "content": "<p>Note that <a href=\"https://github.com/Ruben-VandeVelde/PrimeNumberTheoremAnd/blob/WeakPNT_character/Makefile#L9-L12\">CI on PRs</a> essentially runs <code>lake update; lake exe cache get; lake build</code>. If your lakefile does not use a pinned commit, the <code>lake update</code> step could cause problems. CI on master does a similar thing.</p>\n<p>With this command I can reproduce the build failures in the PR because mathlib's v4.13.0 tag moved from <code>d5ab93e3a3afadaf265a583a92f7e7c47203b540</code> to <code>d7317655e2826dc1f1de9a0c138db2775c4bb841</code>.</p>",
        "id": 481134545,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1730990228
    },
    {
        "content": "<p>Ah, the same problem is being discussed at <a class=\"stream-topic\" data-stream-id=\"113488\" href=\"/#narrow/channel/113488-general/topic/v4.2E13.2E0.20discussion\">#general &gt; v4.13.0 discussion</a> I believe</p>",
        "id": 481134673,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1730990279
    },
    {
        "content": "<p>Oh, why is it doing that?</p>",
        "id": 481135411,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1730990501
    },
    {
        "content": "<p>Ack! Docs failing to build again...</p>",
        "id": 481147488,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1730994032
    },
    {
        "content": "<p>Oh, same issue</p>",
        "id": 481148326,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1730994269
    },
    {
        "content": "<p><a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/205\">https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/205</a>  - alternatively I can pin the lake commit in the lakefile.lean</p>",
        "id": 481149110,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1730994515
    },
    {
        "content": "<p>We are using a pinned commit, so <code>lake update</code> should not cause issues, as long as there is no inherent incompatibility with the version of mathlib that is pinned.<br>\nSo I'm adding lake update back into the workflow.</p>",
        "id": 481159316,
        "sender_full_name": "Ian Jauslin",
        "timestamp": 1730997716
    },
    {
        "content": "<p>The issue seems to be with the bump to version 4.13.0. Why is the bump needed? Should we revert to 4.12 for now?</p>",
        "id": 481161236,
        "sender_full_name": "Ian Jauslin",
        "timestamp": 1730998322
    },
    {
        "content": "<p>The issue is that a tag is not fixed, and the v4.13.0 tag changed after EulerProducts updated to it</p>",
        "id": 481161389,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1730998368
    },
    {
        "content": "<p>Why do you want to run <code>lake update</code>? What purpose does that serve?</p>",
        "id": 481161432,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1730998381
    },
    {
        "content": "<p>It downloads the appropriate versions of the dependencies, does it not?</p>",
        "id": 481161689,
        "sender_full_name": "Ian Jauslin",
        "timestamp": 1730998457
    },
    {
        "content": "<p>So if the tag is being moved, shouldn't we revert to 4.12 until things are settled?</p>",
        "id": 481162101,
        "sender_full_name": "Ian Jauslin",
        "timestamp": 1730998576
    },
    {
        "content": "<p>The tag was moved once to bump ProofWidgets (to get <a href=\"#narrow/channel/287929-mathlib4/topic/cache.20and.20proofwidgets\">this fix</a>), I don't think it's expected to change again. But since the tags point to master instead of a separate branch, applying the ProofWidgets bump meant picking up a bunch of unrelated commits as well.</p>",
        "id": 481162837,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1730998813
    },
    {
        "content": "<p>It seems that EulerProducts is not working properly with the newly tagged 4.13.0, as <span class=\"user-mention\" data-user-id=\"307953\">@Ruben Van de Velde</span> mentioned. I'm guessing we should revert to the commit that was previously tagged as 4.13.0? Or revert everything to how it was with 4.12.0?</p>",
        "id": 481165797,
        "sender_full_name": "Ian Jauslin",
        "timestamp": 1730999745
    },
    {
        "content": "<p>Why do you want to revert things? What purpose does that serve?</p>",
        "id": 481168957,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1731000803
    },
    {
        "content": "<p>The project currently does not compile</p>",
        "id": 481169012,
        "sender_full_name": "Ian Jauslin",
        "timestamp": 1731000832
    },
    {
        "content": "<p>What makes you say that?</p>",
        "id": 481169172,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1731000894
    },
    {
        "content": "<p>In the CI, if we don't run <code>lake update</code>, then it keeps the old versions of the dependencies that are cached. So not running <code>lake update</code> is not a fix: it just prevents the version of mathlib and EulerProducts that was cached from being updated to the versions in the lakefile. If you download a fresh version of the repo and try to compile it, it fails, with an error related to EulerProducts.</p>",
        "id": 481169488,
        "sender_full_name": "Ian Jauslin",
        "timestamp": 1731001017
    },
    {
        "content": "<p>That's not true</p>",
        "id": 481169555,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1731001048
    },
    {
        "content": "<p><code>lake build</code> will use the versions of dependencies that are listed in the JSON file</p>",
        "id": 481169628,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1731001080
    },
    {
        "content": "<p>Running <code>lake update</code> in CI will either do nothing or do the wrong thing</p>",
        "id": 481169727,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1731001113
    },
    {
        "content": "<p>But not the versions in the lakefile</p>",
        "id": 481169730,
        "sender_full_name": "Ian Jauslin",
        "timestamp": 1731001114
    },
    {
        "content": "<p>If <code>lake update</code> breaks the build, then there's a problem, wouldn't you agree?</p>",
        "id": 481169787,
        "sender_full_name": "Ian Jauslin",
        "timestamp": 1731001137
    },
    {
        "content": "<p>The JSON file is updated from the lake file locally</p>",
        "id": 481169795,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1731001141
    },
    {
        "content": "<p>No, that is expected</p>",
        "id": 481169812,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1731001148
    },
    {
        "content": "<p>Why should <code>lake update</code> break the build?</p>",
        "id": 481169853,
        "sender_full_name": "Ian Jauslin",
        "timestamp": 1731001163
    },
    {
        "content": "<p>Because it can change the versions of dependencies you're using - because that's its purpose</p>",
        "id": 481169934,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1731001200
    },
    {
        "content": "<p>And updating your dependencies will more likely than not break your build</p>",
        "id": 481170046,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1731001233
    },
    {
        "content": "<p>It changes the versions to those that are specified in the lakefile. We need to have a lakefile with the correct version.<br>\nIf we don't get lake update to work, then whenever we want to bump a version a mathlib, we need to edit the JSON file. That does not seem to be the best way to proceed</p>",
        "id": 481170112,
        "sender_full_name": "Ian Jauslin",
        "timestamp": 1731001273
    },
    {
        "content": "<p>In fact, the JSON file has the mathlib commit that used to be pointed at by 4.13. So if we revert to that commit in the lakefile, then everything should run.</p>",
        "id": 481170377,
        "sender_full_name": "Ian Jauslin",
        "timestamp": 1731001376
    },
    {
        "content": "<p>I think the simplest option is to bump mathlib forward to match EulerProducts. It requires no code changes. I will submit a PR.</p>",
        "id": 481170509,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1731001432
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"557226\">Ian Jauslin</span> <a href=\"#narrow/channel/423402-PrimeNumberTheorem.2B/topic/mathlib.20bump/near/481170377\">said</a>:</p>\n<blockquote>\n<p>In fact, the JSON file has the mathlib commit that used to be pointed at by 4.13. So if we revert to that commit in the lakefile, then everything should run.</p>\n</blockquote>\n<p>This will cause problems for people who don't have <code>npm</code> installed, since ProofWidgets is missing a cloud release for this version. See <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/cache.20and.20proofwidgets\">#mathlib4 &gt; cache and proofwidgets</a></p>",
        "id": 481170637,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1731001476
    },
    {
        "content": "<p>I just submitted the PR, after checking it works</p>",
        "id": 481170657,
        "sender_full_name": "Ian Jauslin",
        "timestamp": 1731001486
    },
    {
        "content": "<p>Yeah... The alternative I see is to revert to 4.12 while we wait for EulerProducts to be updated to the new 4.13? Is that right?</p>",
        "id": 481170783,
        "sender_full_name": "Ian Jauslin",
        "timestamp": 1731001545
    },
    {
        "content": "<p>I think EulerProducts will never be updated to the new 4.13 since it's already at 4.14.0-rc2. Is using only stable releases a hard requirement? Otherwise there is an easy solution, as I mentioned above.</p>",
        "id": 481171010,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1731001632
    },
    {
        "content": "<p>Ah, to bump to 4.14.0-rc2. Let me see if that compiles.</p>",
        "id": 481171118,
        "sender_full_name": "Ian Jauslin",
        "timestamp": 1731001681
    },
    {
        "content": "<p><a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/207\">https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/207</a> CI just finished successfully</p>",
        "id": 481172502,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1731002222
    },
    {
        "content": "<p>Great thanks!</p>",
        "id": 481172711,
        "sender_full_name": "Ian Jauslin",
        "timestamp": 1731002303
    },
    {
        "content": "<p>I should perhaps mention that EulerProducts is currently moving fairly fast, as I am PRing the orthogonality material to Mathlib (and update Mathlib in EulerProducts after each PR has been merged). I hope this will not cause further problems for PNT+.</p>",
        "id": 481180488,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1731005304
    },
    {
        "content": "<p>I would recommend <strong>not using <code>lake update</code></strong> in CI for contributor PRs. This is dangerous: it means you are moving to different versions of dependencies underneath your contributors, and they will see failures in their PRs which are unrelated to their changes.</p>",
        "id": 481203473,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731015186
    },
    {
        "content": "<p><code>lake build</code> is sufficient to bring the dependencies to the versions that are specified in the lake-manifest.json</p>",
        "id": 481203530,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731015216
    },
    {
        "content": "<p>Then <code>lake update</code> should be run by a human who is planning on handling the fallout of the upstream repositories changing (or by a bot which commits if all goes well, or asks for help if something goes wrong).</p>",
        "id": 481204254,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731015543
    },
    {
        "content": "<p>I now see two pull requests, <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/204\">PNT#204</a> and <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/208\">PNT#208</a>; are those safe to merge?</p>",
        "id": 481235113,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1731035662
    },
    {
        "content": "<p>Hold off on 208</p>",
        "id": 481235138,
        "sender_full_name": "Ian Jauslin",
        "timestamp": 1731035699
    },
    {
        "content": "<p>Let me rerun the checks on 204, to make sure they are compatible with the new version of mathlib</p>",
        "id": 481235252,
        "sender_full_name": "Ian Jauslin",
        "timestamp": 1731035772
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/423402-PrimeNumberTheorem.2B/topic/mathlib.20bump/near/481203473\">said</a>:</p>\n<blockquote>\n<p>I would recommend <strong>not using <code>lake update</code></strong> in CI for contributor PRs. This is dangerous: it means you are moving to different versions of dependencies underneath your contributors, and they will see failures in their PRs which are unrelated to their changes.</p>\n</blockquote>\n<p>I see. But if the contributors don't mess with the lakefile, then things should not break. And if they do mess with the lakefile in a way that breaks the compilation, shouldn't their PR be rejected?</p>",
        "id": 481235337,
        "sender_full_name": "Ian Jauslin",
        "timestamp": 1731035882
    },
    {
        "content": "<p>I only ever merge things with the green checkmark. Is CI on PR's somehow doing something different from compiling once its merged...?</p>",
        "id": 481235440,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1731035948
    },
    {
        "content": "<p>Yeah, the green checkmark should be good enough. In this case, because we bumped up the mathlib version after the PR was submitted, the checkmark was awarded on the old version of mathlib, so I just wanted to check that the bump doesn't break the PR.</p>",
        "id": 481235562,
        "sender_full_name": "Ian Jauslin",
        "timestamp": 1731036050
    },
    {
        "content": "<p>Looks like it's all good, so you can go ahead and merge PR 204. I canceled 208</p>",
        "id": 481235742,
        "sender_full_name": "Ian Jauslin",
        "timestamp": 1731036200
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"557226\">Ian Jauslin</span> <a href=\"#narrow/channel/423402-PrimeNumberTheorem.2B/topic/mathlib.20bump/near/481235337\">said</a>:</p>\n<blockquote>\n<p>But if the contributors don't mess with the lakefile, then things should not break.</p>\n</blockquote>\n<p>If the lakefile points exclusively to tags or commit SHAs, then <code>lake update</code> is a noop. Otherwise, if it points to branches, then it moves the upstream repos to different commits. That's the thing you don't want happening!</p>",
        "id": 481250189,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731047796
    },
    {
        "content": "<p>Right. That's why our lakefile points exclusively to tags and commit SHAs. So running <code>lake update</code> checks that the lake-manifest is the one corresponding to the lakefile, and wasn't changed manually. If we are doing version control through the lakefile and not the manifest, isn't that something we would want to check for? (Especially since running <code>lake update</code> does not have a downside given that we do not (and do not want to) point to branches?</p>",
        "id": 481315349,
        "sender_full_name": "Ian Jauslin",
        "timestamp": 1731072751
    },
    {
        "content": "<p>Yes, you're right. I'm sorry for jumping the gun and assuming that the lakefile was pointing to upstream branches (in my defense, it's pretty common!). You're doing it right. :-)</p>",
        "id": 481399024,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731106386
    },
    {
        "content": "<p>I started to look at what changes would be needed to bump to Mathlib 4.14 and the latest EulerProducts.  So far the biggest changes come from <a href=\"https://github.com/leanprover-community/mathlib4/pull/19442\">https://github.com/leanprover-community/mathlib4/pull/19442</a> which changes the notation for $C^\\infty$ functions but mostly that just means replacing the notation.  There's also various deprications which are easy to fix and one line which no longer compiles with Lean 4.14 (no idea why).</p>\n<p>Is this worth doing?  It would allow us to replace Abel summation in Consequences.lean with the one now in Mathlib and also keeping current with Mathlib seems like a good idea.  I'm happy to keep working on this and submit a PR if it would be helpful.</p>",
        "id": 491496678,
        "sender_full_name": "Alastair Irving",
        "timestamp": 1735734743
    },
    {
        "content": "<p>EulerProducts is at 4.14 already - do you mean 4.15?</p>",
        "id": 491498145,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1735736306
    },
    {
        "content": "<p>I think we'll definitely want to bump once 4.15 is officially released this week or next - but feel free to already make a PR with the changes you need so far</p>",
        "id": 491498194,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1735736358
    },
    {
        "content": "<p>Sorry, I wasn't clear.  I meant bumping the dependnecies of PNT to Mathlib 4.14 and to the latest EulerProducts (which as you say is already at 4.14).</p>",
        "id": 491528900,
        "sender_full_name": "Alastair Irving",
        "timestamp": 1735765734
    },
    {
        "content": "<p>Oh no, I just didn't read properly</p>",
        "id": 491529114,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1735765967
    },
    {
        "content": "<p>Yes, good idea</p>",
        "id": 491529143,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1735766005
    },
    {
        "content": "<p>Mathlib at version 4.14.0 should contain everything that PNT+ was using from EulerProducts, so you can probably remove EulerProducts as a dependency at this point.</p>",
        "id": 491533592,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1735770694
    },
    {
        "content": "<p>I've got everything working with Mathlib 4.14, see <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/214\">https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/214</a> for details.</p>",
        "id": 491909390,
        "sender_full_name": "Alastair Irving",
        "timestamp": 1736026001
    },
    {
        "content": "<p>If you tell me which parts of EulerProducts.Auxiliary you need, I can try to get them into Mathlib.</p>",
        "id": 491911218,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736027371
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479359\">Michael Stoll</span> <a href=\"#narrow/channel/423402-PrimeNumberTheorem.2B/topic/mathlib.20bump/near/491533592\">said</a>:</p>\n<blockquote>\n<p>Mathlib at version 4.14.0 should contain everything that PNT+ was using from EulerProducts, so you can probably remove EulerProducts as a dependency at this point.</p>\n</blockquote>\n<p>I did this in <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/225\">PNT#225</a>. I do need explicit permission from <span class=\"user-mention\" data-user-id=\"479359\">@Michael Stoll</span> and <span class=\"user-mention\" data-user-id=\"313038\">@Moritz Firsching</span> to relicense the last bit of code we depend on away from the GPL, though.</p>\n<p>I'll look at bumping after that</p>",
        "id": 498126993,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1738850361
    },
    {
        "content": "<p>Permission granted!</p>",
        "id": 498128249,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1738850674
    },
    {
        "content": "<p>Permission granted!</p>",
        "id": 498128641,
        "sender_full_name": "Moritz Firsching",
        "timestamp": 1738850786
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479359\">Michael Stoll</span> <a href=\"#narrow/channel/423402-PrimeNumberTheorem.2B/topic/mathlib.20bump/near/498128249\">said</a>:</p>\n<blockquote>\n<p>Permission granted!</p>\n</blockquote>\n<p>Would you mind writing that on the PR as well? :)</p>",
        "id": 498130877,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1738851370
    },
    {
        "content": "<p>Perfect, thank you!!</p>",
        "id": 498177311,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1738863681
    },
    {
        "content": "<p>And <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/226\">PNT#226</a> for the first bump</p>",
        "id": 498185954,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1738866549
    },
    {
        "content": "<p>And straight on to v4.16: <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/227\">PNT#227</a></p>",
        "id": 498291935,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1738919479
    },
    {
        "content": "<p>4.18: <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/248\">https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/248</a></p>\n<p>(Didn't debug why additive_combination broke)</p>",
        "id": 509430198,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1743508275
    },
    {
        "content": "<p>4.19: <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/252\">https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/252</a></p>",
        "id": 515570427,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1746128977
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span> could you take look at the deprecations in <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/253\">https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/253</a> (Nat.Icc_succ_left etc)? The replacements don't seem to work because of confusion between <code>SuccOrder.succ</code> and <code>Nat.succ</code></p>",
        "id": 521374451,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1748640634
    },
    {
        "content": "<p>Deprecating lemmas properly would have either involved significantly increasing imports or moving the deprecated lemmas elsewhere (mostly nullifying the point of deprecation)</p>",
        "id": 521374926,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1748640892
    },
    {
        "content": "<p>Therefore the deprecated lemmas point to the correct lemmas <em>up to <code>Order.succ n = n + 1</code></em></p>",
        "id": 521374976,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1748640925
    },
    {
        "content": "<p>If you replace <code>succ</code>/<code>pred</code> with <code>add_one</code>/<code>sub_one</code> in the relevant lemma names and add more imports if necessary, then everything will work as expected</p>",
        "id": 521375023,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1748640954
    },
    {
        "content": "<p>Oh, there's add_one variants too? Those might have been better deprecation targets. Thanks for the pointer!</p>",
        "id": 521411411,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1748669924
    },
    {
        "content": "<p>Also, should there be a lemma about what SuccOrder.succ means on Nat? I didn't find it</p>",
        "id": 521411428,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1748669967
    },
    {
        "content": "<p>It's <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.succ_eq_succ#doc\">docs#Nat.succ_eq_succ</a> or <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Order.succ_eq_add_one#doc\">docs#Order.succ_eq_add_one</a>, depending on what you want the RHS to be</p>",
        "id": 521411839,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1748670387
    },
    {
        "content": "<p>Wait, what's the relation between Order.succ and SuccOrder.succ?</p>",
        "id": 521412284,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1748670925
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=SuccOrder.succ#doc\">docs#SuccOrder.succ</a> is an implementation detail for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Order.succ#doc\">docs#Order.succ</a></p>",
        "id": 521412358,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1748670982
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/423402-PrimeNumberTheorem.2B/topic/mathlib.20bump/near/521374926\">said</a>:</p>\n<blockquote>\n<p>Deprecating lemmas properly would have either involved significantly increasing imports or moving the deprecated lemmas elsewhere (mostly nullifying the point of deprecation)</p>\n</blockquote>\n<p>I don't see why it forces either of those: the deprecation message can point to the lemma we actually want to deprecate in favour of, it doesn't need to import that one. (I also ran into the problem of these deprecations being unhelpful)</p>",
        "id": 521454055,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1748707041
    },
    {
        "content": "<p><a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/314\">https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/314</a> for 4.21</p>",
        "id": 526338757,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1751269750
    },
    {
        "content": "<p>Working on 4.22</p>",
        "id": 534465114,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1755172221
    },
    {
        "content": "<p><a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/371\">https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/371</a></p>",
        "id": 534481651,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1755177399
    },
    {
        "content": "<p>Thank you!</p>",
        "id": 534507135,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1755185309
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"252920\">@Alex Kontorovich</span> , could I have a review on <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/387\">https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/387</a> ?</p>",
        "id": 540576358,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1758364908
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/423402-PrimeNumberTheorem.2B/topic/mathlib.20bump/near/540576358\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"252920\">Alex Kontorovich</span> , could I have a review on <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/387\">https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/387</a> ?</p>\n</blockquote>\n<p>Ping</p>",
        "id": 542115901,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1759171895
    },
    {
        "content": "<p>Oh sorry, I left a whole bunch of notes in the review; did you have a chance to look through them? (Basically lots of non-terminal <code>simp</code>s)</p>",
        "id": 542357438,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1759262403
    },
    {
        "content": "<p>I don't see it - did you submit them? The nonterminal simps are mostly preexisting (as <code>field_simp</code>), and I was planning to fix them in a followup PR, but I can do them here as well if you prefer</p>",
        "id": 542514441,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1759329823
    },
    {
        "content": "<p>Strange; this is what I see on github; do you not see the same? <br>\n<a href=\"/user_uploads/3121/OE6pru0_Xu_Mf13r1ozZaUtq/image.png\">image.png</a><br>\nI don't think <code>field_simp</code> counts as a non-terminal <code>simp</code>, does it? I suppose it too could change in the future (and just did...), so it should also not be terminal. Anyway, if you're planning on fixing that in a follow-up, that's fine with me, I can merge as is; please let me know. Thanks!</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/OE6pru0_Xu_Mf13r1ozZaUtq/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"887x1254\" src=\"/user_uploads/thumbnail/3121/OE6pru0_Xu_Mf13r1ozZaUtq/image.png/840x560.webp\"></a></div>",
        "id": 542969127,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1759504817
    },
    {
        "content": "<p>The \"pending\" word next to your review messages means that you have not submitted your review yet, and they are only visible to you.</p>",
        "id": 542969511,
        "sender_full_name": "Rémy Degenne",
        "timestamp": 1759504922
    },
    {
        "content": "<p>Ha! :) What an idiot. One day I'll learn to use github....</p>",
        "id": 542971423,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1759505469
    },
    {
        "content": "<p>That tag could be more prominent :)</p>",
        "id": 542975479,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1759506582
    },
    {
        "content": "<p>I should have time to look at them tonight</p>",
        "id": 542975550,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1759506600
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"252920\">Alex Kontorovich</span> <a href=\"#narrow/channel/423402-PrimeNumberTheorem.2B/topic/mathlib.20bump/near/542971423\">said</a>:</p>\n<blockquote>\n<p>Ha! :)</p>\n</blockquote>\n<p>You're certainly not the only person to have done this! (indeed some of us have fallen into this trap more than once...)</p>",
        "id": 542988567,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1759510712
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"252920\">@Alex Kontorovich</span> should be better now</p>",
        "id": 543028742,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1759525260
    },
    {
        "content": "<p>4.24: <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/403\">https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/403</a></p>",
        "id": 545013340,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1760546136
    },
    {
        "content": "<p>Thank you!!</p>",
        "id": 545469372,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1760664787
    },
    {
        "content": "<p>4.25: <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/412\">https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/412</a> (wip; heading off now in case anyone wants to take a look)</p>",
        "id": 555694027,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1763162988
    },
    {
        "content": "<p>Should build now</p>",
        "id": 555736445,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1763204975
    },
    {
        "content": "<p>Great thank you!!</p>",
        "id": 556709294,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1763321450
    },
    {
        "content": "<p>Hoping <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/418\">https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/418</a> is the last one this cycle</p>",
        "id": 559139167,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1764014012
    },
    {
        "content": "<p>Something happened with the latest PR that's giving a strange error message: <code>error: could not download nonexistent lean version </code>leanprover/lean4:v4.25.1`` Can anyone please help figure out what went wrong? Thank you!</p>",
        "id": 560264236,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1764110078
    },
    {
        "content": "<p>Seems like someone deleted the tag - cc <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span></p>",
        "id": 560267755,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1764112250
    },
    {
        "content": "<p>The URL being downloaded from is very strange, it has <a href=\"https://releases.lean-lang.org/lean4/v4.25.1/lean-4.25.0-linux.tar.zst\">https://releases.lean-lang.org/lean4/v4.25.1/lean-4.25.0-linux.tar.zst</a> in it so something clearly is confused about the version number, but yeah it does seem clear that that URL worked previously in the last successful build.</p>",
        "id": 560268447,
        "sender_full_name": "Julian Berman",
        "timestamp": 1764112692
    },
    {
        "content": "<p>It's been fixed in the meantime. Sorry this caught you out. <span aria-label=\"woman facepalming\" class=\"emoji emoji-1f926-200d-2640\" role=\"img\" title=\"woman facepalming\">:woman_facepalming:</span></p>",
        "id": 560297207,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1764130300
    },
    {
        "content": "<p>No worries, thanks for your help! Rerunning failed jobs now...</p>",
        "id": 560305906,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1764133983
    },
    {
        "content": "<p>Oops now the error is: <code>uncaught exception: Failed to fetch ProofWidgets cloud release: lake failed with error code 1</code>?</p>",
        "id": 560306961,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1764134647
    },
    {
        "content": "<p>Can you tell us what state you're in? e.g. a commit at some repo, and a command to run to observe this error?</p>",
        "id": 560362105,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1764155025
    },
    {
        "content": "<p>This is the build on main: <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/\">https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/</a></p>",
        "id": 560386147,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1764162558
    },
    {
        "content": "<p>Here's the full error message: <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/actions/runs/19668741297/job/56413302297\">https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/actions/runs/19668741297/job/56413302297</a></p>",
        "id": 560386250,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1764162587
    },
    {
        "content": "<p>Thanks for your help!</p>",
        "id": 560386322,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1764162605
    },
    {
        "content": "<p>CCing <span class=\"user-mention\" data-user-id=\"557226\">@Ian Jauslin</span> as we have some non-standard features set up...</p>",
        "id": 560387280,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1764162886
    },
    {
        "content": "<p>I get the same error if I build locally.  There seems to be a confusion of tags between mathlib and proofwidgets and I haven't managed to find a combination which works:</p>\n<ul>\n<li>Currently PNT points at mathlib v4.25.1.  That tag no longer exists but we still have the hash in the lake-manifest.  However That mathlib version points at a proofwidgets for which there isn't a tagged release and that's why we're getting an error.</li>\n<li>I thought the fix should be to update to mathlib 4.25.2.  The v4.25.2 mathlib tag exists but points at a proofwidgets commit which has been force pushed over. There's also a branch of mathlib, releases/v4.25 which maybe points at a correct proof widgets.  That seems to work but it would maybe be best if the tag was updated and we used that rather than pointing at a branch.</li>\n</ul>",
        "id": 560461521,
        "sender_full_name": "Alastair Irving",
        "timestamp": 1764185276
    },
    {
        "content": "<p>It looks like @Kim Morrison fixed the tags, thank you.  I've ran lake update and created <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/422\">https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/422</a> which builds.</p>\n<p>I thought about bumping to V4.25.2 at the same time but that didn't work because there isn't a corresponding tag on Docgen4.</p>",
        "id": 560655940,
        "sender_full_name": "Alastair Irving",
        "timestamp": 1764268843
    },
    {
        "content": "<p>for docgen you should be able to use the v4.25.1 tag with few issues I would think</p>",
        "id": 560656417,
        "sender_full_name": "Eric Rodriguez",
        "timestamp": 1764269109
    },
    {
        "content": "<p>I don't know what the deal is this release cycle, but bumping to 4.25.2 fixes the cache for me locally - <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/425\">https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/425</a></p>",
        "id": 561029302,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1764534287
    },
    {
        "content": "<p><a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/429\">https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/429</a> is open for 4.26</p>",
        "id": 563876168,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1765817811
    },
    {
        "content": "<p>Should we switch PNT to using modules? I know its still experimental but it seems to be working well in Mathlib and the potential savings in memory consumption and not recompiling files would be very nice to have.</p>",
        "id": 565500415,
        "sender_full_name": "Alastair Irving",
        "timestamp": 1766827741
    },
    {
        "content": "<p>The module system will no longer be experimental after the next Lean release --- perhaps that is a reasonable time to switch?</p>",
        "id": 565510085,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1766840479
    },
    {
        "content": "<p>Also, at the moment there's no public automatic tooling for converting to the module system yet. I am sure this will change, but it might be easier to wait for it to be publically announced.</p>",
        "id": 565510103,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1766840508
    },
    {
        "content": "<p>(There was a tool, of course, to help with mathlib et al, but that was not meant for public use yet. I'm sure it will be made available, and am personally willing to wait for that before migrating any of the projects I manage.)</p>",
        "id": 565510134,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1766840555
    },
    {
        "content": "<p>Can you please say more? Where can I read about the module system? Maybe PNT+ can be a test case of the automation?</p>",
        "id": 565701371,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1767028838
    },
    {
        "content": "<p>See <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/Mathlib.20has.20moved.20to.20the.20new.20module.20system/with/565243828\">#mathlib4 &gt; Mathlib has moved to the new module system</a>; the last message contains a link to documentation about it.</p>",
        "id": 565711241,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1767034900
    },
    {
        "content": "<p>Opened <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/621\">PNT#621</a> for tag release purposes (<code>v4.27.0-rc1</code>) and <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/623\">PNT#623</a> to get <code>EisensteinSeries.tendsto_zero_inv_linear</code>.</p>",
        "id": 568322082,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1768515942
    }
]