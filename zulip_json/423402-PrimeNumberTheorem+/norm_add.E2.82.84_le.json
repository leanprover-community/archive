[
    {
        "content": "<p>With the new mathlib bump, my local copy of <code>ZetaBounds.lean</code> is longer compiling, because the theorem <code>norm_addâ‚„_le</code>defined in <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/blob/main/PrimeNumberTheoremAnd/ZetaBounds.lean#L1602\">https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/blob/main/PrimeNumberTheoremAnd/ZetaBounds.lean#L1602</a> is now already defined in Mathlib as of 5 days ago, see <a href=\"https://github.com/leanprover-community/mathlib4/commit/c605a8b4af261801243d4141c605c798f4933dbb\">https://github.com/leanprover-community/mathlib4/commit/c605a8b4af261801243d4141c605c798f4933dbb</a> .  I could probably fix this by removing the theorem from <code>ZetaBounds.lean</code>, but what puzzles me is that the mathlib bump seemed to pass CI without incident (and without any change to the actual Lean code), so is there a gap in the CI?</p>",
        "id": 571156242,
        "sender_full_name": "Terence Tao",
        "timestamp": 1769827671
    },
    {
        "content": "<p><code>lake-manifest</code> pins Mathlib to the parent of the commit that adds the lemma to Mathlib.</p>",
        "id": 571167274,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769839303
    },
    {
        "content": "<p>Probably, you've run <code>lake update</code> locally but didn't push the new <code>lake-manifest</code> to Github.</p>",
        "id": 571167297,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769839322
    },
    {
        "content": "<p>I did... but the problem seems to not be entirely local because <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/826\">PNT#826</a> is also broken</p>",
        "id": 571208341,
        "sender_full_name": "Terence Tao",
        "timestamp": 1769874092
    },
    {
        "content": "<p>That's just because you locally executed <code>lake update</code> and then pushed the updated <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd/pull/826/changes#diff-d2bbbefe896fa3db86583f19e6fb402ed9ba755d564f4de97f398b0596f4c2b8\"><code>lake-manifest.json</code></a>.</p>",
        "id": 571208463,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1769874170
    },
    {
        "content": "<p>Hmm... so I should abandon this branch and check out main again?</p>",
        "id": 571208531,
        "sender_full_name": "Terence Tao",
        "timestamp": 1769874216
    },
    {
        "content": "<p>If you want to keep the branch, you can just add <code>rev = \"v4.28.0-rc1\"</code> to the <code>lakefile.toml</code> for Mathlib, then run <code>lake update ; lake exe cache get ; lake build</code> and you should be fine.</p>",
        "id": 571208696,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1769874317
    },
    {
        "content": "<p>OK good to know in the future but I think this time I will simply cut and paste the PR changes into a new branch as there aren't that many of them</p>",
        "id": 571208780,
        "sender_full_name": "Terence Tao",
        "timestamp": 1769874380
    },
    {
        "content": "<p>Sure, as you prefer.</p>",
        "id": 571208816,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1769874419
    },
    {
        "content": "<p>Lake uses the following model: <code>lakefile.toml</code> (or <code>lakefile.lean</code>) specify revision or branch. When you run <code>lake update</code>, it records the actual SHA sum into <code>lake-manifest.json</code>. If your package is sensitive to the revision of the upstream package (which is usually the case), the recommended way is to specify <code>rev = </code>in the lakefile.</p>",
        "id": 571215679,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769879682
    },
    {
        "content": "<p>We used to record the Mathlib revision in the lakefile but we seem to have stoppped doing so recently.  Its possibly a good idea to put it back.</p>",
        "id": 571216611,
        "sender_full_name": "Alastair Irving",
        "timestamp": 1769880450
    },
    {
        "content": "<p>The rule is not to run <code>lake update</code> unless you know how to fix the resulting errors</p>",
        "id": 571219113,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1769882663
    },
    {
        "content": "<p>I'm not sure I saw why it was run in this thread</p>",
        "id": 571219134,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1769882683
    },
    {
        "content": "<p>It was complicated.  With the recent mathlib bump I accidentally started rebuilding all of mathlib.  I halted that and tried to grab the cache instead, but something went wrong (<code>C:\\Users\\teort\\.cache\\mathlib\\eb1600b86215baa3.ltar: The requested operation cannot be performed on a file with a user-mapped section open. (os error 1224)</code>) so I exited VSCode and tried to build lake from scratch, and at some point must have run <code>lake update</code> at a point where I should not have.  I <em>think</em> I have finally managed to disentangle myself from this mess by manually adding the <code>rev</code> entry to <code>lakefile.toml</code> as Pietro suggested.</p>",
        "id": 571219364,
        "sender_full_name": "Terence Tao",
        "timestamp": 1769882856
    },
    {
        "content": "<p>What's wrong with tracking <code>rev</code> in <code>lakefile.toml</code>? IMHO, -1 footgun is a good thing.</p>",
        "id": 571219450,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769882938
    },
    {
        "content": "<p>It causes more work for the people who have learned what the command does and confuses the people who haven't, depriving them of the chance to learn</p>",
        "id": 571221010,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1769884371
    }
]