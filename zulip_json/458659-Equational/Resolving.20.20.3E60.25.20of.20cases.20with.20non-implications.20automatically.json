[
    {
        "content": "<p>TL;DR: I believe I can resolve &gt;60% of the 4694^2 cases with \"A does not imply B\" via counterexample. But I'm not a mathematician so maybe I'm terribly misguided. I also don't know how turn my counterexamples into lean, so if someone does that, they'd solve half of the problems in one go. Maybe this is obvious? Not sure, I figured I'd write it down in case it's helpful.</p>\n<p>Let me first state my understanding of the problem that's being studied. If I'm wrong here you can stop reading here and everything else is incorrect. You have a list of 4694 possible equations that might hold true involving an operator <code>op</code> over some set <code>G</code>, regardless of what <code>op</code> and <code>G</code> you choose. You want to know which equations imply one another.</p>\n<p>(Equation A) implies (Equation B) if whenever (Equation A) is true, (Equation B) is also true. Proving that this is true is hard, because you have to show this for all operators and sets. But proving the negation is easier: all you have to do is find a single operator and set where (Equation A) is true, and (Equation B) is false.</p>\n<p>For example, if we take the operator to be op(a, b) = a*b, and the set GF(2), then the Equation 3, <code>x = op(x, x)</code> is true for all x,y \\in [0,1]. But Equation 4, <code>x = op(x, y)</code> is false, because <code>1 != 1*0</code>. Therefore (Equation 3) does not imply (Equation 4).</p>\n<p>Is my understanding here correct? (I hope so...)</p>\n<p>If you've got this far it means my math undergrad from ten years ago has served me well (yay!).</p>\n<p>I wrote a program to try and automatically brute-force potential counterexamples. To do this, I randomly generate second degree polynomials of the form op(x,y) = ax^2 + by^2 + cxy + dx + ey + f. Then, I choose G = Z/kZ for some small k.</p>\n<p>Now I can just run through each of the 4694 equations, and check which equations are true, and which equations are false. For example, if I take the equation</p>\n<p>op(x, y) = 4 * x<strong>2 + 4 * y</strong>2 + 4 * y + 2 * x * y over GF(5)</p>\n<p>then the following three equations are true:</p>\n<p>def Equation1 (G: Type*) [Magma G] := ∀ x : G, x = x</p>\n<p>def Equation151 (G: Type*) [Magma G] := ∀ x : G, x = (x ∘ x) ∘ (x ∘ x)</p>\n<p>def Equation159 (G: Type*) [Magma G] := ∀ x y : G, x = (x ∘ y) ∘ (y ∘ x)</p>\n<p>and all others are false. (This can be checked by brute force.) This lets me fill in 3*(4694-3) possible implications.</p>\n<p>Ideally we'll find some polynomials that are true often to get as many equations as possible. Indeed, the best operator for ruling out the most possible implications is just</p>\n<p>op(x, y) = 0 [1556 true]</p>\n<p>op(x, y) = x mod 2 [1214 true]</p>\n<p>op(x, y) = x+y mod 2 [663 true]</p>\n<p>As confirmation that I think I have this all correct, I can correctly refute every one of the non-implications already proven, and can't refute any of the implications already proven.</p>\n<p>Now here's where I'm stuck after a few hours. I've never used Lean before. And I have half a dozen papers I'm supposed to be writing, so I won't be able to learn it in the next week.</p>\n<p>What I have are a bunch of lines of the form</p>\n<p>Equations ['Equation1242', 'Equation211'] do not imply ['Equation3050', 'Equation99', 'Equation3862'] with op(x,y) = (8 * x + 3 * y + 9) % 11</p>\n<p>Equations ['Equation1285'] do not imply ['Equation513', 'Equation411'] with op(x,y) = (5 * x + 2 * y + 2) % 7</p>\n<p>Equations ['Equation1083'] do not imply ['Equation2441'] with op(x,y) = (1 * x + 2 * y + 4) % 9</p>\n<p>This lets me show that all of these implications can't be true (ordered by the problem index)<br>\n<a href=\"/user_uploads/3121/VrRAu274rTgcmzm0HwC8hhLC/fig1.png\">fig1.png</a><br>\nor if I re-order in easiesit-to-hardest<br>\n<a href=\"/user_uploads/3121/YbMvBiQJ98LAp9IDH4CiP-Ai/fig2.png\">fig2.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/VrRAu274rTgcmzm0HwC8hhLC/fig1.png\" title=\"fig1.png\"><img data-original-dimensions=\"640x480\" src=\"/user_uploads/thumbnail/3121/VrRAu274rTgcmzm0HwC8hhLC/fig1.png/840x560.webp\"></a></div><div class=\"message_inline_image\"><a href=\"/user_uploads/3121/YbMvBiQJ98LAp9IDH4CiP-Ai/fig2.png\" title=\"fig2.png\"><img data-original-dimensions=\"640x480\" src=\"/user_uploads/thumbnail/3121/YbMvBiQJ98LAp9IDH4CiP-Ai/fig2.png/840x560.webp\"></a></div><p>All to say: if anyone would like to take this dump and convert it all to lean, it'll give over half of the problems all at once.</p>",
        "id": 473025026,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727419306
    },
    {
        "content": "<p>Sounds fun! Guess what you are doing is a variant of what I suggested in <a href=\"#narrow/stream/113488-general/topic/Proposing.20a.20universal.20algebra.20exploration.20using.20Lean/near/472926804\">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Proposing.20a.20universal.20algebra.20exploration.20using.20Lean/near/472926804</a> but with a more specific operation, and larger carrier sets.</p>\n<p>I can have a look at how to move that to lean in an hour or so. Can you share your code?</p>",
        "id": 473026687,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727419901
    },
    {
        "content": "<p>How many operations do you have altogether? I wonder how much smaller the membership data (magma, equation) is than the implications data</p>",
        "id": 473026930,
        "sender_full_name": "Amir Livne Bar-on",
        "timestamp": 1727419954
    },
    {
        "content": "<p>It's a total of 482 equations that cover all the cases.</p>",
        "id": 473027060,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727420020
    },
    {
        "content": "<p><a href=\"https://github.com/carlini/equational_theories/tree/main/brute_force\">https://github.com/carlini/equational_theories/tree/main/brute_force</a></p>\n<p>Has my code for doing this.</p>\n<p><a href=\"https://github.com/carlini/equational_theories/blob/main/brute_force/output.txt\">https://github.com/carlini/equational_theories/blob/main/brute_force/output.txt</a> is a list of all of the invariances</p>",
        "id": 473028846,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727420684
    },
    {
        "content": "<p>Also, could you include in your output data also the values for the equation that refutes the one equation - presumably you have it and it shortens the proof time in lean.</p>",
        "id": 473028915,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727420720
    },
    {
        "content": "<p>If I generate this for all of the problems it'll be a few hundred megabyte file. The python code generates it here <a href=\"https://github.com/carlini/equational_theories/blob/cc6a670252f1ce2ae5adfbca1630b8dbb646984d/brute_force/show_out.py#L59\">https://github.com/carlini/equational_theories/blob/cc6a670252f1ce2ae5adfbca1630b8dbb646984d/brute_force/show_out.py#L59</a></p>",
        "id": 473029236,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727420798
    },
    {
        "content": "<p>Hmm, ok , I'll try first with that we have and see if it would make a significant difference</p>",
        "id": 473029473,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727420854
    },
    {
        "content": "<p>Of maybe independent interest, here are the \"hardest\" equations that imply \"almost nothing\". (All of these imply fewer than 5 other equations with my current set of invariances. The true set may be even smaller.)</p>\n<p>[   1 1832 4591 2238 4608   99   47 4598 4599 1020 4658 3253 4380 4605<br>\n 4276 4606  817 2441 1629 2847 4284 4343 4290 4321 4320 4293  203 4314<br>\n 3456 4065 3659 3862 2035 2644 4636 3050 1426  411  255 1223  151  614<br>\n 4275 3484 1238 1239 3458 4631  159 1248 1252 4635 3272 3079 4282 4283<br>\n 4270 3459 3457 2746 2736 3461 1075 3462 1036 1035 1028 4622 3464 1023<br>\n  167 3271 3472 3474 1109 4268 4269 4273 1038 4362 4316 3278  633 4585<br>\n 4584  632  622  620 4470 4472 4473 4480 4587  264 3112  513 3281 3316<br>\n 3315 3306  440  429  417  359 3068 3319 4307 4588 3343 4332 4341 4358<br>\n 4165  846  833  825  221 4369 2863 2866  639 2872 4398 4399 2903 4433<br>\n 4435 4442 4445 2946  669 3353 4590 4396 1315 1278 1322 2240 3887 2244<br>\n 2246 3915 2254 3925 1731 3675 3255 3674 3962 3880 3668 3256 3518 3667<br>\n 3665 3664 3662 4673   75 3661 3660 1657 1637 4677 3878 3877 3677 2050<br>\n 2063 3761 3759 2124 3752 3749 3748 3725 3724 3722 3721 3714 3712 3864<br>\n 3867 3868 3870 3687 1861 1860 3685 1857 3684 4684 1847 3678 2340 3258<br>\n  307 4666 1451 1429 1428 3261 4070 4073 4074 4083 4090 1454 4091 4118<br>\n 3522 4127 4647 3262 4128 4130 4131 3519 4093 4068 4071 3259 2457 2530<br>\n 2466 2444 2467 3152 2443 2506 2459 1631 4656 1488 2496  105 4067 4479<br>\n 1228 1026 3865 1721 1251 3482 3509 3511  427  414 3512 2088 4155 1313<br>\n 3318 4084 3481 2646 2293 3928 2266 3924 3918 3955 4405 4408  832 3556<br>\n  845 2910 2243 3888 1634 3881 1083  870 4080 1837 3475 4081 1848 1851<br>\n 2709 2503 1684 2043 3279 3139  107   50 3254  211  280 3269 1515 2543<br>\n 3115 2100 3058 1479 4583 1452 1049 2534  179 1444 1647 3346  108 3075<br>\n 3149 4272  378  160  127 2504 2128 2137  466 3308 1325 1934 3066 1519<br>\n 2699 4120 1122 1113 1850 1455 1658 2949 2939   56 4395 4389 4385 1434<br>\n  420 4383 4382  872  212  419 2294  842  117 3105 2044 1427 1229 2267<br>\n 2470  231 1279 1285 4436  323 2087 4432 2300  436  437 4158  906  209<br>\n 4409 4351 4406 4597 3726 1241 3728 3309  473 3723 3729 3680 4023 3943<br>\n 3935  879 3927 3414 3921 3670 3669 2256 2912 3666 3663 4291 1046 3873<br>\n 4629 3334 3467 3326  562 3323 2672 4512]</p>\n<p>Obviously (1) being the top makes sense. Several of the next others, too. But some after that start looking a tiny bit more interesting.</p>",
        "id": 473030275,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727421013
    },
    {
        "content": "<p>Ok, on it. I guess <code>refutations.txt</code> is the raw data I could convert to a lean file, and it lists those equations that the given magma does not satisfy (and implicitly, that it satisfies all others?)</p>",
        "id": 473034310,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727422281
    },
    {
        "content": "<p>I manually wrote the code that I think I’d be creating here. How does this look?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- While we explore things and the repo setup is in flux, let's copy some things here</span>\n<span class=\"c1\">-- Eventually these defintions should be provided by imports</span>\n\n<span class=\"kn\">universe</span><span class=\"w\"> </span><span class=\"n\">u</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Magma</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- `a ∘ b` computes a binary operation of `a` and `b`. -/</span>\n<span class=\"w\">  </span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">inherit_doc</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">infixl</span><span class=\"o\">:</span><span class=\"mi\">65</span><span class=\"w\"> </span><span class=\"s2\">\" ∘ \"</span><span class=\"w\">   </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Magma</span><span class=\"bp\">.</span><span class=\"n\">op</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Equation1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Magma</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Equation2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Magma</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">y</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Equation1629</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Magma</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n\n\n<span class=\"c1\">-- The following line produced by the tool</span>\n<span class=\"c1\">-- '(4 * x**2 + 4 * y**2 + 1 * x + 0 * y + 0 * x * y) % 6' (0, 1628, 3252, 3260, 3305, 3318, 3333, 4064, 4117)</span>\n<span class=\"c1\">-- would be translated to the following output</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"bp\">«</span><span class=\"n\">FinitePoly</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"n\">x</span><span class=\"bp\">²</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"n\">y</span><span class=\"bp\">²</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"bp\">»</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Magma</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"bp\">*</span><span class=\"n\">x</span><span class=\"bp\">*</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"bp\">*</span><span class=\"n\">y</span><span class=\"bp\">*</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">6</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"bp\">«</span><span class=\"n\">FinitePoly</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"n\">x</span><span class=\"bp\">²</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"n\">y</span><span class=\"bp\">²</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"n\">satisfies</span><span class=\"w\"> </span><span class=\"n\">Equation1</span><span class=\"bp\">»</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"bp\">@</span><span class=\"n\">Equation1</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">«</span><span class=\"n\">FinitePoly</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"n\">x</span><span class=\"bp\">²</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"n\">y</span><span class=\"bp\">²</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"bp\">»</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">Equation1</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">decide</span>\n\n<span class=\"c1\">-- and more</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"bp\">«</span><span class=\"n\">FinitePoly</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"n\">x</span><span class=\"bp\">²</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"n\">y</span><span class=\"bp\">²</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"n\">refutes</span><span class=\"w\"> </span><span class=\"n\">Equation1629</span><span class=\"bp\">»</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"bp\">¬</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">Equation1629</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">«</span><span class=\"n\">FinitePoly</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"n\">x</span><span class=\"bp\">²</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"n\">y</span><span class=\"bp\">²</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"bp\">»</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">Equation1629</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">decide</span>\n\n<span class=\"c1\">-- The following non-implications are now trivial combinations of the above,</span>\n<span class=\"c1\">-- we'll see if they are actually needed in the final repo setup</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Equation1_not_implies_Equation1629</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Magma</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">Equation1</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"w\"> </span><span class=\"n\">Equation1629</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">⟨_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">«</span><span class=\"n\">FinitePoly</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"n\">x</span><span class=\"bp\">²</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"n\">y</span><span class=\"bp\">²</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"n\">satisfies</span><span class=\"w\"> </span><span class=\"n\">Equation1</span><span class=\"bp\">»</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">«</span><span class=\"n\">FinitePoly</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"n\">x</span><span class=\"bp\">²</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"n\">y</span><span class=\"bp\">²</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"n\">refutes</span><span class=\"w\"> </span><span class=\"n\">Equation1629</span><span class=\"bp\">»</span><span class=\"w\"> </span><span class=\"bp\">⟩</span>\n</code></pre></div>",
        "id": 473037762,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727423431
    },
    {
        "content": "<p>Perhaps this should use <code>ZMod</code> and not <code>Fin</code>?</p>",
        "id": 473037930,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1727423497
    },
    {
        "content": "<p>I intentionally used <code>Fin</code> here because it means the files don’t have to import <code>Mathlib</code>. When we have hundrets of these files the additional processing speed may well be worth it.</p>",
        "id": 473038084,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727423539
    },
    {
        "content": "<p>And since all we care about are the final implications, it shouldn't matter how we construct the magma, should it?</p>",
        "id": 473038134,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727423560
    },
    {
        "content": "<p>(This assumes that eventually the definition of <code>Magma</code> for this project, and the list of equations, are also in a import-free file. But I see no reason why they can't)</p>",
        "id": 473038489,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727423668
    },
    {
        "content": "<p>I was working on something similar last night and just thought I'd note it here: instead of having X_not_implies_Y proofs, a general proof for a whole formula (e.g. Eq1 ∧ Eq2 ∧ ¬Eq3 ∧¬Eq4) takes O(M+N) time where there are M/N positive/negative terms, but proves M*N cases, so it scales very well if certain formulas are particularly general. (Perhaps this is obvious, but it was not how I initially started.)</p>",
        "id": 473040774,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1727424359
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"761294\">Nicholas Carlini</span> <a href=\"#narrow/stream/458659-Equational/topic/Resolving.20.20.3E60.25.20of.20cases.20with.20non-implications.20automatically/near/473030275\">said</a>:</p>\n<blockquote>\n<p>Of maybe independent interest, here are the \"hardest\" equations that imply \"almost nothing\". (All of these imply fewer than 5 other equations with my current set of invariances. The true set may be even smaller.)</p>\n<p>[  ... ]</p>\n<p>Obviously (1) being the top makes sense. Several of the next others, too. But some after that start looking a tiny bit more interesting.</p>\n</blockquote>\n<p>Do you happen to have data of how many magmas you found satisfying each of these?</p>",
        "id": 473041115,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1727424480
    },
    {
        "content": "<p>Ok, this doesn’t work :-D</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">~/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">equational_theories</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">du</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">sh</span><span class=\"w\">  </span><span class=\"n\">equational_theories</span><span class=\"bp\">/</span><span class=\"n\">FinitePoly</span>\n<span class=\"mi\">5</span><span class=\"o\">,</span><span class=\"mi\">8</span><span class=\"n\">G</span><span class=\"w\">    </span><span class=\"n\">equational_theories</span><span class=\"bp\">/</span><span class=\"n\">FinitePoly</span>\n</code></pre></div>",
        "id": 473042565,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727424873
    },
    {
        "content": "<p>What is the size from? Individual not_implies theorems, or?</p>",
        "id": 473044074,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1727425170
    },
    {
        "content": "<p>Ok, the file “works” now, but it seems we are stressing lean a bit too much, I get</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">equational_theories</span><span class=\"bp\">/</span><span class=\"n\">FinitePoly</span><span class=\"bp\">/</span><span class=\"n\">Refutation0</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">52813</span><span class=\"o\">:</span><span class=\"mi\">8</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">kernel</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">deep</span><span class=\"w\"> </span><span class=\"n\">recursion</span><span class=\"w\"> </span><span class=\"n\">detected</span>\n</code></pre></div>\n<p>(note the line number)</p>",
        "id": 473050473,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727426841
    },
    {
        "content": "<p>How many magmas are there? Perhaps you can split it to files based on the magma?</p>",
        "id": 473050761,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1727426914
    },
    {
        "content": "<p>It’s already one file per magma</p>",
        "id": 473050817,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727426925
    },
    {
        "content": "<p>It seems stupid to generate all the non-equations in every of these files. I think there needs to be a tool that identifies “interesting” non-implications (e.g. if a→b, then no point disproving c→a if we can disprove c→b), and also somehow tells the code generation which implications should be generated from which magma</p>",
        "id": 473051180,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727426994
    },
    {
        "content": "<p>If I remove the implications from the generated file, then one takes ~1min to process with lean, and is 800k in size, with 218 files generated, so still 90MB. I could compress the files a lot with a bit of metaprogramming, but whether that is useful depends a bit on how they will be integrated into the wider picture here.</p>",
        "id": 473051583,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727427071
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> <a href=\"#narrow/stream/458659-Equational/topic/Resolving.20.20.3E60.25.20of.20cases.20with.20non-implications.20automatically/near/473051180\">said</a>:</p>\n<blockquote>\n<p>It seems stupid to generate all the non-equations in every of these files. I think there needs to be a tool that identifies “interesting” non-implications (e.g. if a→b, then no point disproving c→a if we can disprove c→b), and also somehow tells the code generation which implications should be generated from which magma</p>\n</blockquote>\n<p>What are the rules of inference here? Did I miss something?</p>\n<ul>\n<li>If <code>a</code> implies <code>b</code> and <code>b</code> implies <code>c</code> then <code>a</code> implies <code>c</code></li>\n<li>If <code>a</code> implies <code>b</code> and <code>a</code> doesn't imply <code>c</code> then <code>b</code> doesn't imply <code>c</code></li>\n<li>If <code>a</code> doesn't imply <code>b</code> and <code>c</code> implies <code>b</code> then <code>a</code> doesn't imply <code>c</code></li>\n</ul>",
        "id": 473052516,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1727427253
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> <a href=\"#narrow/stream/458659-Equational/topic/Resolving.20.20.3E60.25.20of.20cases.20with.20non-implications.20automatically/near/473051583\">said</a>:</p>\n<blockquote>\n<p>If I remove the implications from the generated file, then one takes ~1min to process with lean, and is 800k in size, with 218 files generated, so still 90MB. I could compress the files a lot with a bit of metaprogramming, but whether that is useful depends a bit on how they will be integrated into the wider picture here.</p>\n</blockquote>\n<p>Is it possible to give an example of such a file? I'm having difficulty understanding what it looks like exactly</p>",
        "id": 473052587,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1727427269
    },
    {
        "content": "<p>See the example above, just with 4000 <code>implies</code> and <code>refutes</code> lemmas, and then non-implication-lemmas for all combinations  :-)</p>",
        "id": 473053742,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727427563
    },
    {
        "content": "<p>Ok, as I expeced I can cut the processing time by half by using <code>decide!</code>, a tactic I quickly hacked up that works like <code>decide</code> but doesn’t check the predicate, so it’s only checked once by the kernel. It’s something I meant to write anyways, and will probably propose to lean.</p>",
        "id": 473053966,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727427621
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"690858\">Daniel Weber</span> <a href=\"#narrow/stream/458659-Equational/topic/Resolving.20.20.3E60.25.20of.20cases.20with.20non-implications.20automatically/near/473052516\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> <a href=\"#narrow/stream/458659-Equational/topic/Resolving.20.20.3E60.25.20of.20cases.20with.20non-implications.20automatically/near/473051180\">said</a>:</p>\n<blockquote>\n<p>It seems stupid to generate all the non-equations in every of these files. I think there needs to be a tool that identifies “interesting” non-implications (e.g. if a→b, then no point disproving c→a if we can disprove c→b), and also somehow tells the code generation which implications should be generated from which magma</p>\n</blockquote>\n<p>What are the rules of inference here? Did I miss something?</p>\n<ul>\n<li>If <code>a</code> implies <code>b</code> and <code>b</code> implies <code>c</code> then <code>a</code> implies <code>c</code></li>\n<li>If <code>a</code> implies <code>b</code> and <code>a</code> doesn't imply <code>c</code> then <code>b</code> doesn't imply <code>c</code></li>\n<li>If <code>a</code> doesn't imply <code>b</code> and <code>c</code> implies <code>b</code> then <code>a</code> doesn't imply <code>c</code></li>\n</ul>\n</blockquote>\n<p>I think this means that if we look at the transitive reduction condensation graph of implications then \"interesting\" non-implications are non-implications from nodes to nodes with out-degree 0 which a direct ancestor of them can reach, but once we also add unknown relations that gets more complicated</p>",
        "id": 473054045,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1727427644
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> <a href=\"#narrow/stream/458659-Equational/topic/Resolving.20.20.3E60.25.20of.20cases.20with.20non-implications.20automatically/near/473053742\">said</a>:</p>\n<blockquote>\n<p>See the example above, just with 4000 <code>implies</code> and <code>refutes</code> lemmas, and then non-implication-lemmas for all combinations  :-)</p>\n</blockquote>\n<p>What I'm trying to see, is if you perform refutations like I mentioned above that turns M*N theorems into M+N theorems.</p>",
        "id": 473054180,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1727427680
    },
    {
        "content": "<p>I put my current work in progress in <a href=\"https://github.com/teorth/equational_theories/pull/19\">https://github.com/teorth/equational_theories/pull/19</a></p>",
        "id": 473057706,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727428561
    },
    {
        "content": "<p>I enabled CI on this PR to make sure you also have all the error info you might need from that</p>",
        "id": 473062086,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727429805
    },
    {
        "content": "<p>Also I think from this point you will get CI automatically</p>",
        "id": 473062964,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727429980
    },
    {
        "content": "<p>I still see “This workflow requires approval from a maintainer.”</p>",
        "id": 473076553,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727433827
    },
    {
        "content": "<p>Running</p>",
        "id": 473077611,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727434218
    },
    {
        "content": "<p>We need to set up a GitHub action for this and allow users to add labels like WIP and awaiting-review</p>",
        "id": 473078042,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727434395
    },
    {
        "content": "<p>Currently I am doing this manually</p>",
        "id": 473078064,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727434402
    },
    {
        "content": "<p>I put these extra file in to a non-default lake library, so that <code>lake build</code> doesn't take forever for unsuspecting users, and added it to the CI. can you allow it again?</p>",
        "id": 473078683,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727434610
    },
    {
        "content": "<p>(Although it might blow up the github runners, memory consumption is rather high for these files.)</p>",
        "id": 473080238,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727435167
    },
    {
        "content": "<p>Okay</p>",
        "id": 473086824,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727436861
    },
    {
        "content": "<p>Hmm, according to profiling, the majority of the time is spent is synthesizing <code>decidable</code> instances, and not in actually running them. Guess there are some perf improvements to be gained, if they become the bottleneck. But maybe first see if this is actually a direction that's welcome.</p>",
        "id": 473089954,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727438040
    },
    {
        "content": "<p>Couldn't resist. Replacing type class inference with simple <code>MetaM</code> code constructing the instance speeds up checking these files by about 2.5×. Now the kernel type checking is the bottleneck.</p>",
        "id": 473101501,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727441091
    },
    {
        "content": "<p>CI run started</p>",
        "id": 473103942,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727441839
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"761294\">@Nicholas Carlini</span> Just to confirm that I'm not mis-parsing this data, I found that there are 4,794,933 unique refutation pairs , which is ~21.7% of 4694^2. I just wanted to double check this with you to make sure I'm not making an error here. For the &gt;60% number I wonder if there could have been double counting to the inclusion of refutation pairs in multiple equations? Prior to running sort -u the number of cases was approximately 70% of 4694^2</p>",
        "id": 473116425,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1727445107
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"761203\">@Vlad Tsyrklevich</span> Sorry, I accidentally truncated a much shorter file than I intended to commit. Let me correct this.</p>",
        "id": 473118259,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727445583
    },
    {
        "content": "<p>Thanks for noticing; I've corrected this. Here's the bigger set that should work if you could please confirm. <a href=\"https://github.com/carlini/equational_theories/blob/main/brute_force/refutations_62percent.txt\">https://github.com/carlini/equational_theories/blob/main/brute_force/refutations_62percent.txt</a></p>",
        "id": 473119696,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727445949
    },
    {
        "content": "<p>Confirmed that it's now ~60% of all pairs and that it's a strict superset of the previous data. There are 13,633,461 total pairs.</p>",
        "id": 473123586,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1727447108
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"690858\">Daniel Weber</span> <a href=\"#narrow/stream/458659-Equational/topic/Resolving.20.20.3E60.25.20of.20cases.20with.20non-implications.20automatically/near/473041115\">said</a>:</p>\n<blockquote>\n<p>Do you happen to have data of how many magmas you found satisfying each of these?</p>\n</blockquote>\n<p>Here are counts for how many unique magmas refute each of these. Each of these are \"almost never true\". For example, the last few are only refuted by a very small number of magmas.</p>\n<p>Equation | num_uniqe_satisfying<br>\n4065 1483<br>\n3253 1470<br>\n3659 1162<br>\n3456 985<br>\n3862 961<br>\n4118 825<br>\n3319 819<br>\n[...]<br>\n2504 3<br>\n1279 3<br>\n2903 3<br>\n1313 2<br>\n2294 2</p>\n<p>Here are the refutations for the bottom few:</p>\n<p>1083 (0 * x<strong>2 + 0 * y</strong>2 + 1 * x + 2 * y + 0 * x * y) % 3<br>\n1083 (0 * x<strong>2 + 0 * y</strong>2 + 6 * x + 2 * y + 0 * x * y) % 7<br>\n1083 (0 * x<strong>2 + 3 * y</strong>2 + 4 * x + 2 * y + 6 * x * y) % 9</p>\n<p>1279 (0 * x<strong>2 + 0 * y</strong>2 + 2 * x + 4 * y + 0 * x * y) % 5<br>\n1279 (0 * x<strong>2 + 0 * y</strong>2 + 3 * x + 1 * y + 0 * x * y) % 7<br>\n1279 (0 * x<strong>2 + 0 * y</strong>2 + 4 * x + 4 * y + 0 * x * y) % 7</p>\n<p>1313 (0 * x<strong>2 + 0 * y</strong>2 + 1 * x + 2 * y + 0 * x * y) % 7<br>\n1313 (0 * x<strong>2 + 0 * y</strong>2 + 2 * x + 4 * y + 0 * x * y) % 5</p>\n<p>2294 (0 * x<strong>2 + 0 * y</strong>2 + 2 * x + 5 * y + 0 * x * y) % 7<br>\n2294 (0 * x<strong>2 + 0 * y</strong>2 + 4 * x + 2 * y + 0 * x * y) % 5</p>\n<p>2504 (0 * x<strong>2 + 0 * y</strong>2 + 2 * x + 1 * y + 0 * x * y) % 3<br>\n2504 (0 * x<strong>2 + 0 * y</strong>2 + 6 * x + 2 * y + 0 * x * y) % 7<br>\n2504 (6 * x<strong>2 + 0 * y</strong>2 + 2 * x + 4 * y + 3 * x * y) % 9</p>\n<p>2903 (0 * x<strong>2 + 0 * y</strong>2 + 2 * x + 1 * y + 0 * x * y) % 11<br>\n2903 (0 * x<strong>2 + 0 * y</strong>2 + 2 * x + 4 * y + 0 * x * y) % 5<br>\n2903 (0 * x<strong>2 + 0 * y</strong>2 + 4 * x + 4 * y + 0 * x * y) % 7</p>\n<p>2910 (0 * x<strong>2 + 0 * y</strong>2 + 1 * x + 4 * y + 0 * x * y) % 7<br>\n2910 (0 * x<strong>2 + 0 * y</strong>2 + 3 * x + 4 * y + 0 * x * y) % 7<br>\n2910 (0 * x<strong>2 + 0 * y</strong>2 + 4 * x + 2 * y + 0 * x * y) % 5</p>",
        "id": 473123857,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727447184
    },
    {
        "content": "<p>Is this interesting in and of itself? If so I can spin this out somewhere else. (I don't know how you all handle discussions on this thing; I've never used it before.)</p>",
        "id": 473123994,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727447228
    },
    {
        "content": "<p>For example, if you could show any of the following statement, we would have completely characterized the implications for these equations:</p>\n<p>Equation2746[x = ((y ∘ y) ∘ (y ∘ y)) ∘ x] =&gt; Equation2644[x = ((x ∘ x) ∘ (x ∘ x)) ∘ x]<br>\nEquation4283[x ∘ (x ∘ y) = x ∘ (y ∘ x)] =&gt; Equation4358[x ∘ (y ∘ z) = x ∘ (z ∘ y)]<br>\nEquation4282[x ∘ (x ∘ y) = x ∘ (x ∘ z)] =&gt; Equation4268[x ∘ (x ∘ x) = x ∘ (x ∘ y)]<br>\nEquation3271[x ∘ x = y ∘ (x ∘ (y ∘ x))] =&gt; Equation3253[x ∘ x = x ∘ (x ∘ (x ∘ x))]<br>\nEquation3272[x ∘ x = y ∘ (x ∘ (y ∘ y))] =&gt; Equation3253[x ∘ x = x ∘ (x ∘ (x ∘ x))]<br>\nEquation3278[x ∘ x = y ∘ (y ∘ (x ∘ x))] =&gt; Equation3253[x ∘ x = x ∘ (x ∘ (x ∘ x))]<br>\nEquation3281[x ∘ x = y ∘ (y ∘ (y ∘ x))] =&gt; Equation3253[x ∘ x = x ∘ (x ∘ (x ∘ x))]<br>\nEquation1109[x = y ∘ ((y ∘ (x ∘ x)) ∘ x)] =&gt; Equation1020[x = x ∘ ((x ∘ (x ∘ x)) ∘ x)]<br>\nEquation1238[x = x ∘ (((y ∘ x) ∘ x) ∘ x)] =&gt; Equation1223[x = x ∘ (((x ∘ x) ∘ x) ∘ x)]<br>\nEquation1239[x = x ∘ (((y ∘ x) ∘ x) ∘ y)] =&gt; Equation1223[x = x ∘ (((x ∘ x) ∘ x) ∘ x)]<br>\nEquation4316[x ∘ (y ∘ x) = x ∘ (z ∘ x)] =&gt; Equation4269[x ∘ (x ∘ x) = x ∘ (y ∘ x)]<br>\nEquation1248[x = x ∘ (((y ∘ y) ∘ x) ∘ x)] =&gt; Equation1223[x = x ∘ (((x ∘ x) ∘ x) ∘ x)]<br>\nEquation4472[x ∘ (y ∘ y) = (x ∘ y) ∘ x] =&gt; Equation4380[x ∘ (x ∘ x) = (x ∘ x) ∘ x]<br>\nEquation1252[x = x ∘ (((y ∘ y) ∘ y) ∘ y)] =&gt; Equation1223[x = x ∘ (((x ∘ x) ∘ x) ∘ x)]<br>\nEquation4473[x ∘ (y ∘ y) = (x ∘ y) ∘ y] =&gt; Equation4380[x ∘ (x ∘ x) = (x ∘ x) ∘ x]<br>\nEquation4584[(x ∘ x) ∘ x = (x ∘ y) ∘ x] =&gt; Equation4631[(x ∘ y) ∘ x = (x ∘ z) ∘ x]<br>\nEquation4585[(x ∘ x) ∘ x = (x ∘ y) ∘ y] =&gt; Equation4656[(x ∘ y) ∘ y = (x ∘ z) ∘ z]<br>\nEquation3306[x ∘ y = x ∘ (x ∘ (x ∘ y))] =&gt; Equation3253[x ∘ x = x ∘ (x ∘ (x ∘ x))]<br>\nEquation4587[(x ∘ x) ∘ x = (y ∘ x) ∘ x] =&gt; Equation4666[(x ∘ y) ∘ y = (z ∘ y) ∘ y]<br>\nEquation620[x = x ∘ (x ∘ ((y ∘ x) ∘ y))] =&gt; Equation614[x = x ∘ (x ∘ ((x ∘ x) ∘ x))]<br>\nEquation622[x = x ∘ (x ∘ ((y ∘ y) ∘ x))] =&gt; Equation614[x = x ∘ (x ∘ ((x ∘ x) ∘ x))]<br>\nEquation3315[x ∘ y = x ∘ (y ∘ (x ∘ x))] =&gt; Equation3253[x ∘ x = x ∘ (x ∘ (x ∘ x))]<br>\nEquation3316[x ∘ y = x ∘ (y ∘ (x ∘ y))] =&gt; Equation3253[x ∘ x = x ∘ (x ∘ (x ∘ x))]<br>\nEquation4470[x ∘ (y ∘ y) = (x ∘ x) ∘ y] =&gt; Equation4380[x ∘ (x ∘ x) = (x ∘ x) ∘ x]<br>\nEquation632[x = x ∘ (y ∘ ((x ∘ y) ∘ x))] =&gt; Equation614[x = x ∘ (x ∘ ((x ∘ x) ∘ x))]<br>\nEquation633[x = x ∘ (y ∘ ((x ∘ y) ∘ y))] =&gt; Equation614[x = x ∘ (x ∘ ((x ∘ x) ∘ x))]<br>\nEquation1023[x = x ∘ ((x ∘ (x ∘ y)) ∘ y)] =&gt; Equation1020[x = x ∘ ((x ∘ (x ∘ x)) ∘ x)]<br>\nEquation4480[x ∘ (y ∘ y) = (y ∘ x) ∘ y] =&gt; Equation4380[x ∘ (x ∘ x) = (x ∘ x) ∘ x]</p>",
        "id": 473126396,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727447997
    },
    {
        "content": "<p>(There are 195 equations left with only one implication to resolve, and 55 with 2 to resolve, 76 with 3 to resolve.)</p>",
        "id": 473126719,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727448097
    },
    {
        "content": "<p>Isn't the first one completely trivial by setting <code>y = x</code>?</p>",
        "id": 473126801,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1727448119
    },
    {
        "content": "<p>I haven't checked any of these by hand. It's just whether or not it's automatically found a refutation.</p>",
        "id": 473126953,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727448155
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 473126976,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1727448163
    },
    {
        "content": "<p>Should I make this its own thing for \"statements that are almost finished resolving?\" This approach already completely resolves 42 of the equations finding a counterexample for every one of them (except for x=&gt;x and itself). Are these the \"prime\" equations?</p>",
        "id": 473127508,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727448331
    },
    {
        "content": "<p>I’ve thrown in the larger files into my lean PR, but processing all these files does take a long time, now that we have Z/8Z, so an equation with four variables has 4096 instantiations.</p>\n<p>I expect we need some selection of the data, i.e. which magmas tell us an interesting antiimplication (one not already implied by the known ones), and for a given magma only prove (or refute) those equations that help us to show these antiimplications. No need to prove that a certain equation holds or doesn’t hold if we are not using that result.</p>",
        "id": 473139822,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727451601
    },
    {
        "content": "<p>I have work duties that will not allow me to get back to this project for several horus, but just wanted to say that this is fantastic progress, will try to catch up on it later!</p>",
        "id": 473143131,
        "sender_full_name": "Terence Tao",
        "timestamp": 1727452144
    },
    {
        "content": "<p>4 messages were moved from this topic to <a class=\"stream-topic\" data-stream-id=\"458659\" href=\"/#narrow/stream/458659-Equational/topic/Refutations.20using.20Z3\">#Equational &gt; Refutations using Z3</a> by <span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span>.</p>",
        "id": 473172380,
        "sender_full_name": "Notification Bot",
        "timestamp": 1727459540
    },
    {
        "content": "<p>I've tried various hacks, and can slightly increase the number of refutations, by maybe 1% or so (which is I guess a large number in absolute terms) but straightforward tricks aren't successfully brining me beyond 63%. So I think the initial run basically saturates what you can do without something more clever.</p>",
        "id": 473293592,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727503558
    },
    {
        "content": "<p>Before merging this I’d like to reduce the amount of work done. In particular, for a magma that satisfies equations <code>[1,2,3]</code> and refutes <code>[4,5,6]</code>, if we know the implication <code>2 → 3</code> and <code>4→5</code>, I’d like to only include <code>[1,2]</code> and <code>[5,6]</code> in the set of equations to test in the proof. </p>\n<p>For that I need a file with a list of implications that we know already. Is that stored or accessible already somewhere, or is that still coming?</p>\n<p>(Probably this is much more useful after <a href=\"https://github.com/teorth/equational_theories/pull/23\">equational#23</a> is merged, which adds a huge number of implications.)</p>",
        "id": 473352253,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727532792
    },
    {
        "content": "<p>I guess <a href=\"https://github.com/teorth/equational_theories/pull/29\">equational#29</a> has the latest on this</p>",
        "id": 473352436,
        "sender_full_name": "Terence Tao",
        "timestamp": 1727532939
    },
    {
        "content": "<p>Thanks! I’ll wait for that to resolve.</p>",
        "id": 473352748,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727533191
    },
    {
        "content": "<p>relatedly, i think there are some implications in the <code>Subgraph.lean</code> file that are implied by other implications in the file. for example, the implications <code>2-&gt;3</code>, <code>3-&gt;8</code> and <code>2-&gt;8</code> all exist... should we try and make sure these triangles don't occur in the Subgraph subproject?</p>",
        "id": 473353274,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1727533481
    },
    {
        "content": "<p>There is no PR on that issue yet</p>",
        "id": 473353499,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727533578
    },
    {
        "content": "<p>There could be a linter for that, as well as for making sure that conjectures don't create contradictions</p>",
        "id": 473353523,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1727533602
    },
    {
        "content": "<p>introducing an additional node will usually do this, should we aim to cleanup in the same PR that adds the implications?</p>",
        "id": 473353741,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1727533780
    },
    {
        "content": "<p>How do we check for redundant non-implications?</p>",
        "id": 473353869,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1727533861
    },
    {
        "content": "<p>we have <code>implicit_refutations = implicit_implicationsᵗ explicit_refutations implicit_implicationsᵗ</code> (this is matrix multiplication over the boolean semiring), if I'm not mistaken, but I'm not sure how to minimize <code>explicit_refutations</code> there</p>",
        "id": 473354065,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1727534018
    },
    {
        "content": "<p>if a non-implication is of the form <code>not n -&gt; m</code>, then for the \"smallest\" <code>k</code> with  <code>k -&gt; n</code> and <code>k -&gt; m</code>, <code>k -&gt; n</code> must be minimal. (otherwise an implication must be missing)</p>",
        "id": 473354384,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1727534255
    },
    {
        "content": "<p>i'm not sure this is a sufficient condition to the not-implication being non-redundant, however...</p>",
        "id": 473354485,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1727534322
    },
    {
        "content": "<p>We can create two copies of the equations, and build a graph by:</p>\n<ul>\n<li>For an implication <code>a -&gt; b</code>, add <code>copy1(b) -&gt; copy1(a)</code> and <code>copy2(b) -&gt; copy2(a)</code></li>\n<li>For an non-implication <code>not (a -&gt; b)</code> add <code>copy1(a) -&gt; copy2(b)</code></li>\n</ul>\n<p>And I'm pretty sure the implicit implications/non-implications are exactly the transitive closure of this (so for non-redundancy we want it to be transitively reduced)</p>",
        "id": 473354639,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1727534431
    },
    {
        "content": "<p>Hi Team! I'm doing something very similar, namely, exactly what Joachim suggested. Here's a short writeup: <a href=\"https://github.com/teorth/equational_theories/issues/50\">https://github.com/teorth/equational_theories/issues/50</a></p>\n<p>Have you settled on the best way for interfacing between the two worlds? My counterexamples take the form of small (currently 2x2 or 3x3) multiplication tables. How hard would it be to turn those into Lean proofs?</p>",
        "id": 473384052,
        "sender_full_name": "Dániel Varga",
        "timestamp": 1727556374
    },
    {
        "content": "<p>I also don't know Lean at all, and so what I did was just generate my counterexamples and say \"Here they are!\" and the wonderful people who understand this Lean stuff figured out a way to turn them into formalizable objects. One thing that will probably be useful to start is to split out refutations on a per-table basis, and keep only the tables that are needed for that. </p>\n<p>Also: What do you mean by \"multiplication tables\"? You mean just the operator is a lookup into the table?</p>",
        "id": 473384338,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727556637
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"761294\">Nicholas Carlini</span> <a href=\"#narrow/stream/458659-Equational/topic/Resolving.20.20.3E60.25.20of.20cases.20with.20non-implications.20automatically/near/473384338\">said</a>:</p>\n<blockquote>\n<p>Also: What do you mean by \"multiplication tables\"? You mean just the operator is a lookup into the table?</p>\n</blockquote>\n<p>Yes, if I understand your terminology correctly. For example this 3x3 matrix defines the operation x+y := x if y=0 else 0.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">implied</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"n\">magmas</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"bp\">-</span><span class=\"n\">magmas</span><span class=\"bp\">.</span>\n<span class=\"n\">counterexample</span><span class=\"o\">:</span>\n<span class=\"o\">[[</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">]</span>\n<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">]</span>\n<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">]]</span>\n</code></pre></div>",
        "id": 473385279,
        "sender_full_name": "Dániel Varga",
        "timestamp": 1727557474
    },
    {
        "content": "<p>Oh got it okay. I've brute forced up to all 4x4 tables and found they were almost completely a subset of the initial \"generating random polynomials\". Your ocde would be great way to double check that we've got the same values for n=3</p>",
        "id": 473385606,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727557756
    },
    {
        "content": "<p>My run has only included equations with up to 4 variables. I intend to re-run it with the full set of equations, and then we can directly compare, but in the meanwhile, here are some stats:</p>\n<p>S matrix about which 3-magma satisfies which equation: (4347, 19683) matrix with 508228 true elements.<br>\nNumber of true implications for 3-magmas: 7082298 out of 4347*4347=18896409, a ratio of 0.6252 falsified.</p>\n<p>S matrix about which 2-magma satisfies which equation: (4347, 16) matrix with 9446 true elements.<br>\nNumber of true implications for 2-magmas: 7785726 out of 4347*4347=18896409, a ratio of 0.5880 falsified.</p>",
        "id": 473386491,
        "sender_full_name": "Dániel Varga",
        "timestamp": 1727558603
    },
    {
        "content": "<p>By the way are you only considering one magma from each isomorphism class?  This may slightly speed up the runtime, and there is no point considering multiple magmas from a given class as they won't eliminate any new implications.</p>",
        "id": 473386619,
        "sender_full_name": "Terence Tao",
        "timestamp": 1727558713
    },
    {
        "content": "<p>I just brute forced over all 4^(4*4) tables.... computers are fast, coding is slow(er)</p>",
        "id": 473386655,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727558758
    },
    {
        "content": "<p>(This will not work at n=5)</p>",
        "id": 473386705,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727558772
    },
    {
        "content": "<p>I think the links in <a href=\"https://oeis.org/A001329\">https://oeis.org/A001329</a> might lead to a list of magmas up to isomorphism up to a given size, but I haven't checked</p>",
        "id": 473386843,
        "sender_full_name": "Terence Tao",
        "timestamp": 1727558906
    },
    {
        "content": "<p>Though, given that even after isomorphism there are still 2483527537094825 different magmas of order 5, brute force here is never going to be feasible</p>",
        "id": 473387151,
        "sender_full_name": "Terence Tao",
        "timestamp": 1727559216
    },
    {
        "content": "<p>Yes, I've brute forced n=3, and postponed n=4 because my computer is probably slower than Nicholas'. :) The 120-fold speedup at n=5 does not buy us anything.</p>",
        "id": 473387160,
        "sender_full_name": "Dániel Varga",
        "timestamp": 1727559230
    },
    {
        "content": "<p>It could maybe be possible if one fixes the equation X first and then searches over magmas that obey X, then see what other equations Y they fail to obey.  The constraint X may allow for quite a pruning of the tree of possible magmas.</p>",
        "id": 473387283,
        "sender_full_name": "Terence Tao",
        "timestamp": 1727559350
    },
    {
        "content": "<p>(This is hard to code though.)</p>",
        "id": 473387294,
        "sender_full_name": "Terence Tao",
        "timestamp": 1727559360
    },
    {
        "content": "<p>In any case, randomly generating say 10000 magmas may already get 95% of the anti-implications that are attainable with this approach.  (It's the last 5% which are probably the most interesting, where there is a counterexample but it is highly structured and not visible from a random search.)</p>",
        "id": 473387461,
        "sender_full_name": "Terence Tao",
        "timestamp": 1727559487
    },
    {
        "content": "<p>At some point I could imagine reinforcement learning being deployed on the most stubborn anti-implications, but it will be a while before we have boiled off enough of the easy ones that we can locate those ones</p>",
        "id": 473387487,
        "sender_full_name": "Terence Tao",
        "timestamp": 1727559529
    },
    {
        "content": "<p>I can try to find which of the relations are most interesting, in that they're only solved by a small number of magmas.</p>",
        "id": 473387598,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727559634
    },
    {
        "content": "<p>If Nicholas' operation is defined by a 2-variable polynomial, then an equation is equivalent to a system of polynomial equations over the coefficients, right? Could we solve those using Grobner bases?</p>",
        "id": 473388384,
        "sender_full_name": "Dániel Varga",
        "timestamp": 1727560494
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"761294\">@Nicholas Carlini</span> You mentioned earlier you generated another ~3% of refutations, is that correct? Could you share those new equations?</p>",
        "id": 473391761,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1727564047
    },
    {
        "content": "<p>I think it's ~1%, but, these are all in very different weird formats though. Some have conditionals, some have some binary operators, some are from tables... I'm not sure if you want them all because they're not just polynomials like the current set</p>",
        "id": 473391790,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727564107
    },
    {
        "content": "<p>For 1% and the additional work it's probably not worth it. Mostly I was going to just update my pairs to avoid iterating over while bruteforcing, and maybe trying to visualize some things</p>",
        "id": 473391814,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1727564155
    },
    {
        "content": "<p>I'm trying to do a cleaner version of these (e.g., going through my brute forced 4x4 tables) and will try to collect these well at some point in the future</p>",
        "id": 473391870,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727564203
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"657719\">Terence Tao</span> <a href=\"#narrow/stream/458659-Equational/topic/Resolving.20.20.3E60.25.20of.20cases.20with.20non-implications.20automatically/near/473387461\">said</a>:</p>\n<blockquote>\n<p>(It's the last 5% which are probably the most interesting, where there is a counterexample but it is highly structured and not visible from a random search.)</p>\n</blockquote>\n<p>If we define a relationship as \"interesting\" whenever there's only one magma that shows a=/&gt;b, then there are a lot of \"boring\" \"interesting\" relationships. This is true because there are several equations where only one magma satisfies them. For example,  Equation2613 <code>x = (y ∘ ((z ∘ z) ∘ w)) ∘ x</code> is only satisfied by f(a,b)=b. And so it has many interesting outgoing edges even though they're all just because this is a boring equation.</p>\n<p>Maybe there's a better definition of interesting? If there are two equations A,B where A is true on many magmas, and B is false on many, but A=/&gt;B is only true for a small number? Something else that makes it interesting?</p>",
        "id": 473393772,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727566356
    },
    {
        "content": "<p>Yeah, as a first approximation I guess one wants P( A true and B false ) to be positive, but much smaller than P(A true ) * P(B false), to qualify as \"interesting\".</p>",
        "id": 473394349,
        "sender_full_name": "Terence Tao",
        "timestamp": 1727567103
    },
    {
        "content": "<p>The C code to brute force the 4696 * 2^32 tables is considerably faster than the python code to just load the processed outputs... Preliminarily, here's a fun one. Equation3066 =/&gt; Equation4585 </p>\n<p>Equation3066[x = (((x ∘ y) ∘ x) ∘ x) ∘ y] <br>\nEquation4585[(x ∘ x) ∘ x = (x ∘ y) ∘ y] </p>\n<p>differ in exactly two tables, even though the Equation3066 is true in 10,053 cases</p>\n<p>3 0 2 1<br>\n1 2 0 3<br>\n0 3 1 2<br>\n2 1 3 0</p>\n<p>and</p>\n<p>3 1 0 2<br>\n0 2 3 1<br>\n2 0 1 3<br>\n1 3 2 0</p>",
        "id": 473397905,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727570692
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"761294\">Nicholas Carlini</span> <a href=\"#narrow/stream/458659-Equational/topic/Resolving.20.20.3E60.25.20of.20cases.20with.20non-implications.20automatically/near/473391790\">said</a>:</p>\n<blockquote>\n<p>I think it's ~1%, but, these are all in very different weird formats though. Some have conditionals, some have some binary operators, some are from tables... I'm not sure if you want them all because they're not just polynomials like the current set</p>\n</blockquote>\n<p>The mention of conditionals here made me wonder if these old runs may have some current unknowns. The formula to solve <a href=\"#narrow/stream/458659-Equational/topic/1648.20!.3D.3E.20206\">https://leanprover.zulipchat.com/#narrow/stream/458659-Equational/topic/1648.20!.3D.3E.20206</a> was so trivial, that I was really quite surprised that it hadn't been discovered already. I remembered that you had mentioned conditionals, so it made me wonder if you may have hit this refutation yourself before. If the data is available and it's not too much trouble, you're welcome to upload it here or somewhere else and I'd be happy to comb through it if you're busy. No worries if it's lost to time, I may look at doing a simple tool myself to look for cases like this.</p>",
        "id": 476831241,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1728928609
    },
    {
        "content": "<p>The new example is an infinite model, though.  Not sure if there is a finite version, it seems to be important that the underlying group is totally ordered.</p>",
        "id": 476833057,
        "sender_full_name": "Terence Tao",
        "timestamp": 1728929520
    },
    {
        "content": "<p>Indeed, I had forgotten that the original work was operating over finite magmas. That makes sense, otherwise it would be more involved to test for symbolic equality.</p>",
        "id": 476833235,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1728929620
    }
]