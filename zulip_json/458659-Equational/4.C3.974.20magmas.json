[
    {
        "content": "<p>I just saw that <span class=\"user-mention\" data-user-id=\"761294\">@Nicholas Carlini</span>’s exhaustive data about 4×4 magmas has landed in <a href=\"https://github.com/teorth/equational_theories/pull/150\">https://github.com/teorth/equational_theories/pull/150</a>, so PR <a href=\"https://github.com/teorth/equational_theories/pull/172\">https://github.com/teorth/equational_theories/pull/172</a> adds it to lean.</p>\n<p><span class=\"user-mention\" data-user-id=\"761294\">@Nicholas Carlini</span> , how useful are the polynomial based examples now that we have the 4×4? Worth keeping? Worth reducing that dataset to new results?</p>",
        "id": 474054354,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727793571
    },
    {
        "content": "<p>Also, in terms of smaller proofs, could you adjust your 4×4 dump to include 2×2 and 3×3 as well, and first? Presumably that also refutes a fair number of implications, and is faster to check, and that means we have to check fewer 4×4 magmas.</p>",
        "id": 474054643,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727793643
    },
    {
        "content": "<p>Someone else has already done the 3x3 work. I could generate it too, but let me comment there and see if they want to merge their 3x3 version in first since they brought it up first.</p>",
        "id": 474056833,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727794221
    },
    {
        "content": "<p>I don’t think it makes sense to maintain two separate code bases for the same task (enumerating magmas). The faster implementation of the two should prevail. Also having it all in one <code>refutation.txt</code> (or at least same-format files) makes pruning-while-generating-lean easier.</p>",
        "id": 474057093,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727794294
    },
    {
        "content": "<p>OK</p>",
        "id": 474057194,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727794321
    },
    {
        "content": "<p>I'll edit mine to generate 2x2 and 3x3 tables too and submit that, probably tomorrow though.</p>",
        "id": 474057451,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727794375
    },
    {
        "content": "<p>Great, I’ll wait with <a href=\"https://github.com/leanprover-community/mathlib4/pull/172\">#172</a> then until it’s in then, please ping me then.</p>",
        "id": 474057898,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727794488
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span> it's in now, <a href=\"https://github.com/leanprover-community/mathlib4/pull/187\">#187</a></p>",
        "id": 474198035,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727848731
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 474213336,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727853042
    },
    {
        "content": "<p>It's actually not better</p>",
        "id": 474213402,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727853069
    },
    {
        "content": "<p>I think I have a bug that's missing some magmas improperly. I don't know why right now, but I should sleep, I have a run going to diagnose.</p>",
        "id": 474213478,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727853091
    },
    {
        "content": "<p>(Glass half full: either the code is right, or we're going to get a bunch more refutations!)</p>",
        "id": 474214138,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727853295
    },
    {
        "content": "<p>Mind if I merge the leanification of the 4×4 magmas then, so that these results show up? Happy to help adjusting it to more files later, of course.</p>",
        "id": 474214183,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727853312
    },
    {
        "content": "<p>Of course that's fine yeah. It'll only get better if I find more by brute forcing harder.</p>",
        "id": 474214266,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727853336
    },
    {
        "content": "<p>It looks like it's unlikely that you'll want to remove any 4x4 magmas from the 3x3 set anyway, if anything you'll want to do the reverse because the 4x4s almost cover the 3x3s but the reverse is not true</p>",
        "id": 474214596,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727853408
    },
    {
        "content": "<p>Unless the 3×3 are so much faster to process (if 3<em>3</em>3<em>… is much smaller than 4</em>4*4…). But yes, just a matter of the order the script looks at the files, so I can just try once they are there.</p>",
        "id": 474215148,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727853489
    },
    {
        "content": "<p>Are the 4x4 magmas reduced by isomorphism? In principle that offers a roughly 4!=24 speedup after a one time preprocessing.</p>",
        "id": 474297460,
        "sender_full_name": "Terence Tao",
        "timestamp": 1727875613
    },
    {
        "content": "<p>At least the lean proofs we generated are implicit reduced, because we only add those that add new counter-examples, so isomorphic ones are dropped along the way. I don’t think Nichola’s C code tries to avoid isomorphism.</p>\n<p>Is this true: If we only look at tables where the first occurrences of elements 1, 2,3 and 4 are in that order, then we look at each isomorphism class once?</p>",
        "id": 474315355,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727879744
    },
    {
        "content": "<p>I don't think it's that simple, because isomorphism permutes the locations of the table entries as well as the values of the table, so the notion of \"first occurence\" gets messed up by the isomorphism.</p>\n<p>Perhaps the fastest way to enumerate up to isomorphism is to have an dictionary of size 4^{4*4} associated to all 4 x 4 magmas, and enumerate along this dictionary, creating the indicated magma (if the dictionary entry is not already filled), generating its 4!-1=23 permutations (in some cases fewer due to symmetries of the magma),  and adding a dictionary entry for each of the permutations indicating that it is a permutation and so can be skipped over when one encounters it the enumeration.  This will naturally generate a list of magmas up to equivalence, with each equivalence class represented by its earliest member in the dictionary.  This should take roughly 4^{4*4} time and space (each new class requires 4! or so operations, but the number of classes is roughly 4^{4*4}/4!, so it cancels out).</p>",
        "id": 474317634,
        "sender_full_name": "Terence Tao",
        "timestamp": 1727880373
    },
    {
        "content": "<p>The one catch with this approach is that the memory required is equal to the size 4^{4*4} of the total set of magmas, not the set quotiented out by equivalence.  For 4x4 this isn't a serious problem but may be a concern when enumerating larger classes of magmas quotiented out by larger sets of symmetries (e.g., the 5!=120-element group of permutations on five elements).  A hash table may be a better solution here, but could require more effort to implement.</p>",
        "id": 474318322,
        "sender_full_name": "Terence Tao",
        "timestamp": 1727880561
    },
    {
        "content": "<p>Already <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>4</mn><mrow><mn>4</mn><mo>⋅</mo><mn>4</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">4^{4 \\cdot 4}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord\">4</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">4</span><span class=\"mbin mtight\">⋅</span><span class=\"mord mtight\">4</span></span></span></span></span></span></span></span></span></span></span></span> will take up ~ 8GB right? If we use 2 bytes for the label of a magma...<br>\nSo doable, but not something you want to do too often.</p>",
        "id": 474329262,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1727882787
    },
    {
        "content": "<p>Computing the isomorphism classes only has to be done once, and the data file can be deleted afterwards.  This data set may also already exist online, for instance one of the links at <a href=\"https://oeis.org/A001329\">https://oeis.org/A001329</a> may already contain it (but I haven't checked).</p>",
        "id": 474339797,
        "sender_full_name": "Terence Tao",
        "timestamp": 1727885394
    },
    {
        "content": "<p>The blueprint says</p>\n<blockquote>\n<p>Sep 29, 2024: <a href=\"https://teorth.github.io/equational_theories/equational_theories/Generated/All4x4Tables\">13.7m implications were conjectured to be refused by a collection of 515 magmas</a>, collected by enumerating all 4^(4*4) operators and reducing to a covering set.</p>\n</blockquote>\n<p>but these are proven, aren’t they?</p>",
        "id": 474639240,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727974465
    },
    {
        "content": "<p>I think they have since been</p>",
        "id": 474639578,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727974568
    },
    {
        "content": "<p>(I think the status just needs to be updated, since first they were conjectured, then proven)</p>",
        "id": 474640461,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727974861
    },
    {
        "content": "<p>Indeed. The final count is 13.8mil btw (13,842,823 precisely, soon to increase to 13,845,779 as I manually constructed some more 6x6-9x9 cancellative magmas which settle a few more cases, but I'm probably in diminishing returns with this particular approach so won't try further).</p>",
        "id": 474641090,
        "sender_full_name": "Zoltan A. Kocsis (Z.A.K.)",
        "timestamp": 1727975073
    },
    {
        "content": "<p>I'll update the README to reflect the new status and slightly improved statistics.</p>",
        "id": 474662133,
        "sender_full_name": "Terence Tao",
        "timestamp": 1727981583
    },
    {
        "content": "<p>Shameless advertising - between the time I tested the Progress badge locally and when it was integrated in the main repo it grew from 86.9% to 87.6%. this is probably due to the additional counter-examples from larger magmas.</p>",
        "id": 474662847,
        "sender_full_name": "Amir Livne Bar-on",
        "timestamp": 1727981860
    },
    {
        "content": "<p>I made an attempt to naively port the transitive closure pruning script (<code>generate_lean.py</code>) to make it compatible with the cancellative 5x5s <a href=\"https://github.com/zaklogician/equational_theories/commit/63355c23bbcbb0d9ac16951ebf27ff2dca6a6c0a\">in this commit</a>.</p>\n<p>At first everything seemed to work, the proof goes through. However, inspecting the output of <code>lake exe extract_implications outcomes --hist</code> shows that we lose quite a few refutations!</p>\n<p>Alas there are way too many places where things could go wrong, including in the original script, one of my changes, or even in the Lean code which counts/constructs the implicit refutations :( I won't have spare capacity to look into this any time soon, so I created <a href=\"https://github.com/teorth/equational_theories/issues/265\">Issue #265</a>.</p>",
        "id": 474709115,
        "sender_full_name": "Zoltan A. Kocsis (Z.A.K.)",
        "timestamp": 1728006659
    },
    {
        "content": "<p>I think I see the (or at least one) typo</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">    </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">prune</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">implications</span>\n<span class=\"w\">    </span><span class=\"n\">satisfied</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">set</span><span class=\"o\">()</span>\n<span class=\"w\">    </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"o\">[</span><span class=\"s2\">\"satisfied\"</span><span class=\"o\">]:</span>\n<span class=\"w\">        </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">already</span><span class=\"w\"> </span><span class=\"n\">implied</span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">implying</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span><span class=\"bp\">.</span><span class=\"n\">intersection</span><span class=\"o\">(</span><span class=\"n\">satisfied</span><span class=\"o\">):</span>\n<span class=\"w\">          </span><span class=\"n\">continue</span>\n<span class=\"w\">        </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">remove</span><span class=\"w\"> </span><span class=\"n\">all</span><span class=\"w\"> </span><span class=\"n\">implied</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">this</span>\n<span class=\"w\">        </span><span class=\"n\">satisfied</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">satisfied</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">impliedBy</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">satisfied</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">refuted</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">set</span><span class=\"o\">()</span>\n<span class=\"w\">    </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"o\">[</span><span class=\"s2\">\"refuted\"</span><span class=\"o\">]:</span>\n<span class=\"w\">        </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">already</span><span class=\"w\"> </span><span class=\"n\">ruled</span><span class=\"w\"> </span><span class=\"n\">out</span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">impliedBy</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span><span class=\"bp\">.</span><span class=\"n\">intersection</span><span class=\"o\">(</span><span class=\"n\">refuted</span><span class=\"o\">):</span>\n<span class=\"w\">          </span><span class=\"n\">continue</span>\n<span class=\"w\">        </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">remove</span><span class=\"w\"> </span><span class=\"n\">all</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">ruling</span><span class=\"w\"> </span><span class=\"n\">out</span>\n<span class=\"w\">        </span><span class=\"n\">refuted</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">refuted</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">impliedBy</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">refuted</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>The last <code>impliedBy</code> should be <code>implying</code>. I’ll make a PR fixing this in the existing code. Sorry for that.</p>",
        "id": 474763288,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1728028461
    },
    {
        "content": "<p>Hmm, I’m confused. It looks like on <code>main</code> the file <code>equational_theories/Generated/All4x4Tables/Refutation0.lean</code> contains a 2×2 magma, but the <code>generate_lean.py</code> script only handles 4×4 magmas. This came in <span class=\"user-mention\" data-user-id=\"763356\">@Zoltan A. Kocsis (Z.A.K.)</span> ’s <a href=\"https://github.com/teorth/equational_theories/pull/224\">https://github.com/teorth/equational_theories/pull/224</a></p>\n<p>I’m a bit confused by that PR. It seems that in that PR you are generating the lean files not with <code>generate_lean.py</code>, but something else, but left the python script in there? I’m also confused about the README, it mentions <code>refutations.txt</code> but that file does not exist anymore.</p>",
        "id": 474767268,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1728029744
    },
    {
        "content": "<p>Now it bites that we don’t have CI set up that checks that all generated lean files can be reproduced from the corresponding (calculated) data files :-/</p>",
        "id": 474767845,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1728029903
    },
    {
        "content": "<p>Fix in <a href=\"https://github.com/teorth/equational_theories/pull/271\">https://github.com/teorth/equational_theories/pull/271</a>. The <code>unknown</code> count still goes up, so there might be another issue somewhere in the pipeline. But it’s still a worthwhile bug fix, so once someone had a look I think we should merge this.</p>",
        "id": 474771104,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1728030932
    },
    {
        "content": "<p>Sorry if something's unclear <span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span>, indeed things have changed a bit with 224.</p>\n<p>The <code>Refutation*.lean</code> files in the current <code>main</code> are generated using the <a href=\"https://github.com/zaklogician/equational_theories/blob/finite_magma_tools/equational_theories/Generated/All4x4Tables/src/generate_5x5_refutations.sh\">generate_5x5_refutations.sh</a> bash script from the file <a href=\"https://github.com/zaklogician/equational_theories/blob/finite_magma_tools/equational_theories/Generated/All4x4Tables/data/plan-5x5.txt\">plan-5x5.txt</a> (itself generated from other files by a heap of tools starting with Mace4, but it's not important: the <code>plan-5x5.txt</code> output is included in the distribution and needs no updates rn).</p>\n<p>The bash script itself calls out to a Haskell tool, <code>gen-refutations</code> in <code>finite_magma_tools</code> which parses <code>plan-5x5.txt</code> and emits Lean.</p>\n<p>However, <code>gen-refutations</code> does not read <code>implications.json</code> and does not do pruning - it's a throwaway tool, meant to eventually be replaced by an updated <code>generate_lean.py</code> which can handle something like <code>plan-5x5.txt</code>.I made an attempt at doing precisely that in the repo linked in that issue, but gave up since the implication counts didn't match.</p>\n<p>Hope this makes more sense now.</p>",
        "id": 474773053,
        "sender_full_name": "Zoltan A. Kocsis (Z.A.K.)",
        "timestamp": 1728031635
    },
    {
        "content": "<blockquote>\n<p>I’m also confused about the README, it mentions <code>refutations.txt</code> but that file does not exist anymore.</p>\n</blockquote>\n<p>NB <code>refutations.txt</code> did exist back when 224 was made, it was removed later on when <a href=\"https://github.com/teorth/equational_theories/pull/187\">#187</a> was merged.</p>",
        "id": 474774759,
        "sender_full_name": "Zoltan A. Kocsis (Z.A.K.)",
        "timestamp": 1728032234
    },
    {
        "content": "<p>Ah, ok, so that PR is the one that would have broke the CI that I wish we had :-D. Sorry for the pointing fingers in the wrong direction.</p>",
        "id": 474775597,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1728032490
    },
    {
        "content": "<p>No worries. I'll eliminate mentions of <code>refutations.txt</code> from both the readme and the bash script tomorrow.</p>",
        "id": 474776206,
        "sender_full_name": "Zoltan A. Kocsis (Z.A.K.)",
        "timestamp": 1728032676
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"763356\">Zoltan A. Kocsis (Z.A.K.)</span> <a href=\"#narrow/stream/458659-Equational/topic/4.C3.974.20magmas/near/474773053\">said</a>:</p>\n<blockquote>\n<p>I made an attempt at doing precisely that in the repo linked in that issue, but gave up since the implication counts didn't match.</p>\n</blockquote>\n<p>I’d say go ahead. The issue is already in the repo somewhere, and my <a href=\"https://github.com/teorth/equational_theories/pull/271\">https://github.com/teorth/equational_theories/pull/271</a> fixes at least part of the problem, so your change is not a regression. And with your update we have more uniformity in how we generate the lean files, so less moving parts to debug, and easier to fix when it’s fixed.</p>",
        "id": 474776216,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1728032679
    },
    {
        "content": "<p>This is now <a href=\"https://github.com/teorth/equational_theories/pull/275\">PR #275</a>, ready to merge.</p>\n<p><span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span> I didn't touch the <code>generate_lean.py</code> in <code>Generated/FinSearch</code>: there's currently a different hardcoded path in each of the two <code>generate_lean.py</code> files, and I didn't want to implement argument parsing as part of this PR (there is some urgency since it's techincally fixing a regression; we don't want people going on wild goose chases refuting stuff that's already known to be refuted).</p>",
        "id": 474809937,
        "sender_full_name": "Zoltan A. Kocsis (Z.A.K.)",
        "timestamp": 1728043967
    },
    {
        "content": "<p>I added more counterexamples at <a href=\"https://github.com/Command-Master/equational_theories/tree/VP-cex2/equational_theories/Generated/VampireProven\">https://github.com/Command-Master/equational_theories/tree/VP-cex2/equational_theories/Generated/VampireProven</a>, after giving it more time to run. How do I move them to All4x4Tables/data/vampire_generated.txt?</p>",
        "id": 475079758,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1728206502
    },
    {
        "content": "<p>You can commit them as Disproofs.lean for now, and I'll move them tomorrow, along with other tables others asked for.</p>\n<p>There's a PR coming, hoepfully tomorrow, which will make adding stuff to All4x4Tables much much easier, so there's not much point in me explaining the currenr process now.</p>",
        "id": 475081277,
        "sender_full_name": "Zoltan A. Kocsis (Z.A.K.)",
        "timestamp": 1728207388
    },
    {
        "content": "<p>The current process is:</p>\n<ol>\n<li>putting them into vampire-generated.txt in the same format as the others there (this is not automated yet)</li>\n<li>deleting plan.txt,</li>\n<li>rerunning the shell script in src (this'll take 35mins or so to finish now), and then puthon3 generate_lean.py</li>\n</ol>",
        "id": 475081465,
        "sender_full_name": "Zoltan A. Kocsis (Z.A.K.)",
        "timestamp": 1728207580
    },
    {
        "content": "<p>But again, there's no point in learning this now, it's gonna be easy easy soon</p>",
        "id": 475081475,
        "sender_full_name": "Zoltan A. Kocsis (Z.A.K.)",
        "timestamp": 1728207600
    }
]