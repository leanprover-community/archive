[
    {
        "content": "<p>I tried to equip an agent with tools and a prompt. I guess the prompt is far from perfect. How about we add this kind of prompt file to the repo so that everyone could - to a certain extent  - reproduce the thought process used in this project using bots?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Initialize</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">generators</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">free</span><span class=\"w\"> </span><span class=\"n\">magma</span><span class=\"w\"> </span><span class=\"n\">M</span>\n<span class=\"n\">G</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">g1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">g2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">...</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">gn</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">FreeMagma</span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"o\">)</span>\n\n<span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Define</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">theory</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">laws</span><span class=\"w\"> </span><span class=\"n\">L</span>\n<span class=\"n\">L</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">law1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">law2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">...</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">lawN</span><span class=\"w\"> </span><span class=\"o\">}</span>\n\n<span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Derive</span><span class=\"w\"> </span><span class=\"n\">rewrite</span><span class=\"w\"> </span><span class=\"n\">rules</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">laws</span><span class=\"w\"> </span><span class=\"n\">L</span>\n<span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">deriveRewriteRules</span><span class=\"o\">(</span><span class=\"n\">L</span><span class=\"o\">)</span>\n\n<span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Initialize</span><span class=\"w\"> </span><span class=\"n\">implications</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">anti</span><span class=\"bp\">-</span><span class=\"n\">implications</span><span class=\"w\"> </span><span class=\"n\">AI</span>\n<span class=\"n\">I</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">implication1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">implication2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">...</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">implicationM</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"n\">AI</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">antiImplication1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">antiImplication2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">...</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">antiImplicationK</span><span class=\"w\"> </span><span class=\"o\">}</span>\n\n<span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Initialize</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"bp\">-</span><span class=\"n\">Graph</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">elements</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">M</span>\n<span class=\"n\">EGraph</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">EGraph</span><span class=\"o\">()</span>\n<span class=\"n\">EGraph</span><span class=\"bp\">.</span><span class=\"n\">addElements</span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"bp\">.</span><span class=\"n\">elements</span><span class=\"o\">)</span>\n\n<span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Equality</span><span class=\"w\"> </span><span class=\"n\">Saturation</span><span class=\"w\"> </span><span class=\"n\">Loop</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">Rewriting</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">Implications</span>\n<span class=\"k\">do</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"n\">changes</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span>\n\n<span class=\"w\">    </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Apply</span><span class=\"w\"> </span><span class=\"n\">simple</span><span class=\"w\"> </span><span class=\"n\">rewriting</span><span class=\"w\"> </span><span class=\"n\">rules</span>\n<span class=\"w\">    </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">each</span><span class=\"w\"> </span><span class=\"n\">rule</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">EGraph</span><span class=\"bp\">.</span><span class=\"n\">apply</span><span class=\"o\">(</span><span class=\"n\">rule</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">            </span><span class=\"n\">changes</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"w\">        </span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">}</span>\n\n<span class=\"w\">    </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Apply</span><span class=\"w\"> </span><span class=\"n\">implications</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">introduce</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">equalities</span>\n<span class=\"w\">    </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">each</span><span class=\"w\"> </span><span class=\"n\">implication</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">EGraph</span><span class=\"bp\">.</span><span class=\"n\">apply</span><span class=\"o\">(</span><span class=\"n\">implication</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">            </span><span class=\"n\">changes</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"w\">        </span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">}</span>\n\n<span class=\"w\">    </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Prevent</span><span class=\"w\"> </span><span class=\"n\">invalid</span><span class=\"w\"> </span><span class=\"n\">reductions</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">anti</span><span class=\"bp\">-</span><span class=\"n\">implications</span>\n<span class=\"w\">    </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">each</span><span class=\"w\"> </span><span class=\"n\">antiImplication</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">AI</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">EGraph</span><span class=\"bp\">.</span><span class=\"n\">detect</span><span class=\"o\">(</span><span class=\"n\">antiImplication</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">            </span><span class=\"n\">EGraph</span><span class=\"bp\">.</span><span class=\"n\">prevent</span><span class=\"o\">(</span><span class=\"n\">antiImplication</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">}</span>\n\n<span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">while</span><span class=\"w\"> </span><span class=\"n\">changes</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">true</span>\n\n<span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Handle</span><span class=\"w\"> </span><span class=\"n\">infinite</span><span class=\"w\"> </span><span class=\"n\">models</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">processing</span><span class=\"w\"> </span><span class=\"n\">finite</span><span class=\"w\"> </span><span class=\"n\">subsets</span>\n<span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"bp\">.</span><span class=\"n\">isInfinite</span><span class=\"o\">()</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"n\">subsets</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"bp\">.</span><span class=\"n\">generateFiniteSubsets</span><span class=\"o\">()</span>\n<span class=\"w\">    </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">each</span><span class=\"w\"> </span><span class=\"n\">subset</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">subsets</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">        </span><span class=\"n\">processFiniteSubset</span><span class=\"o\">(</span><span class=\"n\">subset</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">}</span>\n<span class=\"o\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">For</span><span class=\"w\"> </span><span class=\"n\">finite</span><span class=\"w\"> </span><span class=\"n\">magmas</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">find</span><span class=\"w\"> </span><span class=\"n\">normal</span><span class=\"w\"> </span><span class=\"n\">forms</span><span class=\"w\"> </span><span class=\"n\">directly</span>\n<span class=\"w\">    </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">each</span><span class=\"w\"> </span><span class=\"n\">element</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">        </span><span class=\"n\">normalForm</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">EGraph</span><span class=\"bp\">.</span><span class=\"n\">findNormalForm</span><span class=\"o\">(</span><span class=\"n\">element</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"n\">print</span><span class=\"o\">(</span><span class=\"s2\">\"Normal form of\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">element</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"is\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">normalForm</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">}</span>\n<span class=\"o\">}</span>\n\n<span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"w\"> </span><span class=\"n\">Definitions</span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">deriveRewriteRules</span><span class=\"o\">(</span><span class=\"n\">L</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">empty</span><span class=\"w\"> </span><span class=\"n\">set</span>\n<span class=\"w\">    </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">each</span><span class=\"w\"> </span><span class=\"n\">law</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">        </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Convert</span><span class=\"w\"> </span><span class=\"n\">laws</span><span class=\"w\"> </span><span class=\"n\">into</span><span class=\"w\"> </span><span class=\"n\">bidirectional</span><span class=\"w\"> </span><span class=\"n\">rewrite</span><span class=\"w\"> </span><span class=\"n\">rules</span>\n<span class=\"w\">        </span><span class=\"n\">R</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"o\">(</span><span class=\"n\">convertToRewriteRule</span><span class=\"o\">(</span><span class=\"n\">law</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">R</span>\n<span class=\"o\">}</span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">processFiniteSubset</span><span class=\"o\">(</span><span class=\"n\">subset</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Create</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"bp\">-</span><span class=\"n\">Graph</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">subset</span>\n<span class=\"w\">    </span><span class=\"n\">localEGraph</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">EGraph</span><span class=\"o\">()</span>\n<span class=\"w\">    </span><span class=\"n\">localEGraph</span><span class=\"bp\">.</span><span class=\"n\">addElements</span><span class=\"o\">(</span><span class=\"n\">subset</span><span class=\"bp\">.</span><span class=\"n\">elements</span><span class=\"o\">)</span>\n\n<span class=\"w\">    </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Repeat</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">equality</span><span class=\"w\"> </span><span class=\"n\">saturation</span><span class=\"w\"> </span><span class=\"n\">loop</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">subset</span>\n<span class=\"w\">    </span><span class=\"k\">do</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">        </span><span class=\"n\">localChanges</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span>\n\n<span class=\"w\">        </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Apply</span><span class=\"w\"> </span><span class=\"n\">rewriting</span><span class=\"w\"> </span><span class=\"n\">rules</span>\n<span class=\"w\">        </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">each</span><span class=\"w\"> </span><span class=\"n\">rule</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">localEGraph</span><span class=\"bp\">.</span><span class=\"n\">apply</span><span class=\"o\">(</span><span class=\"n\">rule</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">                </span><span class=\"n\">localChanges</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"w\">            </span><span class=\"o\">}</span>\n<span class=\"w\">        </span><span class=\"o\">}</span>\n\n<span class=\"w\">        </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Apply</span><span class=\"w\"> </span><span class=\"n\">implications</span>\n<span class=\"w\">        </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">each</span><span class=\"w\"> </span><span class=\"n\">implication</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">localEGraph</span><span class=\"bp\">.</span><span class=\"n\">apply</span><span class=\"o\">(</span><span class=\"n\">implication</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">                </span><span class=\"n\">localChanges</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"w\">            </span><span class=\"o\">}</span>\n<span class=\"w\">        </span><span class=\"o\">}</span>\n\n<span class=\"w\">        </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Handle</span><span class=\"w\"> </span><span class=\"n\">anti</span><span class=\"bp\">-</span><span class=\"n\">implications</span>\n<span class=\"w\">        </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">each</span><span class=\"w\"> </span><span class=\"n\">antiImplication</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">AI</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">localEGraph</span><span class=\"bp\">.</span><span class=\"n\">detect</span><span class=\"o\">(</span><span class=\"n\">antiImplication</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">                </span><span class=\"n\">localEGraph</span><span class=\"bp\">.</span><span class=\"n\">prevent</span><span class=\"o\">(</span><span class=\"n\">antiImplication</span><span class=\"o\">)</span>\n<span class=\"w\">            </span><span class=\"o\">}</span>\n<span class=\"w\">        </span><span class=\"o\">}</span>\n\n<span class=\"w\">    </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">while</span><span class=\"w\"> </span><span class=\"n\">localChanges</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">true</span>\n\n<span class=\"w\">    </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Find</span><span class=\"w\"> </span><span class=\"n\">normal</span><span class=\"w\"> </span><span class=\"n\">forms</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">subset</span>\n<span class=\"w\">    </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">each</span><span class=\"w\"> </span><span class=\"n\">element</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">subset</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">        </span><span class=\"n\">normalForm</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">localEGraph</span><span class=\"bp\">.</span><span class=\"n\">findNormalForm</span><span class=\"o\">(</span><span class=\"n\">element</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"n\">print</span><span class=\"o\">(</span><span class=\"s2\">\"Normal form of\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">element</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"in subset is\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">normalForm</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">}</span>\n<span class=\"o\">}</span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">convertToRewriteRule</span><span class=\"o\">(</span><span class=\"n\">law</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Convert</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">law</span><span class=\"w\"> </span><span class=\"n\">into</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">pair</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">rewrite</span><span class=\"w\"> </span><span class=\"n\">rules</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">forward</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">backward</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">ruleForward</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">createRule</span><span class=\"o\">(</span><span class=\"n\">law</span><span class=\"bp\">.</span><span class=\"n\">leftSide</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">law</span><span class=\"bp\">.</span><span class=\"n\">rightSide</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">ruleBackward</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">createRule</span><span class=\"o\">(</span><span class=\"n\">law</span><span class=\"bp\">.</span><span class=\"n\">rightSide</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">law</span><span class=\"bp\">.</span><span class=\"n\">leftSide</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">ruleForward</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ruleBackward</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"o\">}</span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">createRule</span><span class=\"o\">(</span><span class=\"n\">pattern</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">replacement</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Create</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">rewrite</span><span class=\"w\"> </span><span class=\"n\">rule</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">pattern</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">replacement</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">RewriteRule</span><span class=\"o\">(</span><span class=\"n\">pattern</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">replacement</span><span class=\"o\">)</span>\n<span class=\"o\">}</span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">EGraph</span><span class=\"bp\">.</span><span class=\"n\">apply</span><span class=\"o\">(</span><span class=\"n\">rule</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Apply</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">rewrite</span><span class=\"w\"> </span><span class=\"n\">rule</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">implication</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"bp\">-</span><span class=\"n\">Graph</span>\n<span class=\"w\">    </span><span class=\"n\">applied</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"w\">    </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">each</span><span class=\"w\"> </span><span class=\"n\">equivalenceClass</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">EGraph</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">equivalenceClass</span><span class=\"bp\">.</span><span class=\"n\">matches</span><span class=\"o\">(</span><span class=\"n\">rule</span><span class=\"bp\">.</span><span class=\"n\">pattern</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">            </span><span class=\"n\">equivalenceClass</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"o\">(</span><span class=\"n\">rule</span><span class=\"bp\">.</span><span class=\"n\">replacement</span><span class=\"o\">)</span>\n<span class=\"w\">            </span><span class=\"n\">applied</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"w\">        </span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">applied</span>\n<span class=\"o\">}</span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">EGraph</span><span class=\"bp\">.</span><span class=\"n\">detect</span><span class=\"o\">(</span><span class=\"n\">antiImplication</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Detect</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">an</span><span class=\"w\"> </span><span class=\"n\">anti</span><span class=\"bp\">-</span><span class=\"n\">implication</span><span class=\"w\"> </span><span class=\"n\">pattern</span><span class=\"w\"> </span><span class=\"n\">exists</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"bp\">-</span><span class=\"n\">Graph</span>\n<span class=\"w\">    </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">each</span><span class=\"w\"> </span><span class=\"n\">equivalenceClass</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">EGraph</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">equivalenceClass</span><span class=\"bp\">.</span><span class=\"n\">matches</span><span class=\"o\">(</span><span class=\"n\">antiImplication</span><span class=\"bp\">.</span><span class=\"n\">pattern</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">            </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"w\">        </span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"o\">}</span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">EGraph</span><span class=\"bp\">.</span><span class=\"n\">prevent</span><span class=\"o\">(</span><span class=\"n\">antiImplication</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Prevent</span><span class=\"w\"> </span><span class=\"n\">certain</span><span class=\"w\"> </span><span class=\"n\">reductions</span><span class=\"w\"> </span><span class=\"n\">based</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">anti</span><span class=\"bp\">-</span><span class=\"n\">implications</span>\n<span class=\"w\">    </span><span class=\"n\">EGraph</span><span class=\"bp\">.</span><span class=\"n\">removePattern</span><span class=\"o\">(</span><span class=\"n\">antiImplication</span><span class=\"bp\">.</span><span class=\"n\">pattern</span><span class=\"o\">)</span>\n<span class=\"o\">}</span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">EGraph</span><span class=\"bp\">.</span><span class=\"n\">findNormalForm</span><span class=\"o\">(</span><span class=\"n\">element</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Find</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">simplest</span><span class=\"w\"> </span><span class=\"n\">form</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">an</span><span class=\"w\"> </span><span class=\"n\">element</span><span class=\"w\"> </span><span class=\"n\">based</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"bp\">-</span><span class=\"n\">Graph</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">element</span><span class=\"bp\">.</span><span class=\"n\">getMinimalRepresentative</span><span class=\"o\">()</span>\n<span class=\"o\">}</span>\n</code></pre></div>",
        "id": 478158139,
        "sender_full_name": "Michael Bucko",
        "timestamp": 1729548230
    }
]