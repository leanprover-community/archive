[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"556875\">@Pietro Monticone</span> I noticed that the build task is not triggered for external PRs, only internal commits. Can this be changed?</p>",
        "id": 472969691,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727382948
    },
    {
        "content": "<p>Sure, I'll do it in a few minutes.</p>",
        "id": 472970811,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1727383511
    },
    {
        "content": "<p>Done, from now on the same <code>Compile Blueprint</code> workflow will be triggered  on PRs targeting the <code>main</code> branch.</p>",
        "id": 472971258,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1727383742
    },
    {
        "content": "<p>Please test it and tell me if everything works fine for you.</p>",
        "id": 472971343,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1727383782
    },
    {
        "content": "<p>I'll try a test PR now</p>",
        "id": 472971362,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727383793
    },
    {
        "content": "<p>The check was triggered.</p>",
        "id": 472972125,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727384096
    },
    {
        "content": "<p>does it also cancel previous ongoing builds on a new commit?</p>",
        "id": 472972313,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727384188
    },
    {
        "content": "<p>Not at the moment, but I can add it with <code>concurrency</code>. I'll do it in a few minutes.</p>",
        "id": 472972658,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1727384391
    },
    {
        "content": "<p>maybe this workflow can also add and remove the <code>awaiting-CI</code> label</p>",
        "id": 472972754,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727384418
    },
    {
        "content": "<p>The build process for building docs is taking suspiciously long: <a href=\"https://github.com/teorth/equational_theories/actions/runs/11060090774/job/30729877250?pr=9\">https://github.com/teorth/equational_theories/actions/runs/11060090774/job/30729877250?pr=9</a></p>",
        "id": 472973004,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727384530
    },
    {
        "content": "<p>In fact it seems to have rebuilt all mathlib docs. Is this normal? I recall mathlib PRs not taking this long for the docs.</p>",
        "id": 472973061,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727384561
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"556875\">Pietro Monticone</span> <a href=\"#narrow/stream/458659-Equational/topic/CI.20build.20task/near/472972658\">said</a>:</p>\n<blockquote>\n<p>Not at the moment, but I can add it with <code>concurrency</code>. I'll do it in a few minutes.</p>\n</blockquote>\n<p>Done.</p>",
        "id": 472973378,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1727384760
    },
    {
        "content": "<p>I manually cancelled the run for my test PR</p>",
        "id": 472973611,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727384871
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"657719\">@Terence Tao</span> :  It seems for the commit adding the eq6_equivalence there is no lean code, so the build CI will fail</p>",
        "id": 472973962,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727385048
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/stream/458659-Equational/topic/CI.20build.20task/near/472972754\">said</a>:</p>\n<blockquote>\n<p>maybe this workflow can also add and remove the <code>awaiting-CI</code> label</p>\n</blockquote>\n<p>Working on it here <a href=\"https://github.com/teorth/equational_theories/pull/10\">https://github.com/teorth/equational_theories/pull/10</a>. </p>\n<p>I think it should work now. Just waiting to see if the bot removes the label correctly.</p>",
        "id": 472982070,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1727389355
    },
    {
        "content": "<p>okay. I think the other PR is stuck on not being able to upload to github pages because of some API token issue</p>",
        "id": 472982127,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727389398
    },
    {
        "content": "<p>So once that's gone through, we might get a second test of the label feature</p>",
        "id": 472982188,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727389441
    },
    {
        "content": "<p>If we merge main into that PR</p>",
        "id": 472982258,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727389469
    },
    {
        "content": "<p>It worked as expected <a href=\"https://github.com/teorth/equational_theories/pull/10\">https://github.com/teorth/equational_theories/pull/10</a></p>",
        "id": 472982443,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1727389585
    },
    {
        "content": "<p>it seems the CI fails when trying to update the github pages (due to some token not having write access?)... i'm pretty certain that's not to do with changes i made...</p>",
        "id": 472985857,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1727391654
    },
    {
        "content": "<p>Yeah it isn't. Some GitHub pages API key stuff.</p>",
        "id": 472985904,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727391696
    },
    {
        "content": "<p>I first observed it in PR 11 which happened before the merging of PR 10</p>",
        "id": 472986040,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727391767
    },
    {
        "content": "<p>for whatever reason, this step does seem to succeed for commits on the master branch?</p>",
        "id": 472986201,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1727391883
    },
    {
        "content": "<p>fwiw, i think it would make sense that that step should only run when the commit is on master</p>",
        "id": 472986338,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1727391981
    },
    {
        "content": "<p>You're right. <span class=\"user-mention\" data-user-id=\"556875\">@Pietro Monticone</span> is handling CI workflow. So he's the right person to ask about this</p>",
        "id": 472986913,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727392420
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/stream/458659-Equational/topic/CI.20build.20task/near/472986338\">said</a>:</p>\n<blockquote>\n<p>fwiw, i think it would make sense that that step should only run when the commit is on master</p>\n</blockquote>\n<p>Yes, exactly. I had forgotten to add the </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">if</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">event_name</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">push'</span><span class=\"w\"> </span><span class=\"bp\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">event</span><span class=\"bp\">.</span><span class=\"n\">pull_request</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">null</span>\n</code></pre></div>\n<p>Added now.</p>",
        "id": 472987119,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1727392571
    },
    {
        "content": "<p>The <code>awaiting-CI</code> label <a href=\"https://github.com/teorth/equational_theories/pull/14\">here</a> isn't added because of GITHUB_TOKEN permission issues. It requires the personal access token to make it work for PRs coming from forks as far as I know.</p>",
        "id": 472987282,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1727392717
    },
    {
        "content": "<p>Done. It works as expected <a href=\"https://github.com/teorth/equational_theories/pull/11\">https://github.com/teorth/equational_theories/pull/11</a></p>",
        "id": 472988519,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1727393656
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"556875\">Pietro Monticone</span> has marked this topic as resolved.</p>",
        "id": 473578620,
        "sender_full_name": "Notification Bot",
        "timestamp": 1727671360
    }
]