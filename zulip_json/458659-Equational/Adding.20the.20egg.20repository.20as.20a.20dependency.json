[
    {
        "content": "<p>I am working on a PR to add the egg repository to the main repo if this is welcome</p>",
        "id": 472927149,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727365758
    },
    {
        "content": "<p>OK but I may switch to a new repository soon, I am trying to set up a blueprint CI using <span class=\"user-mention\" data-user-id=\"556875\">@Pietro Monticone</span> 's instructions and the instructions require creating a new repo rather than developing an existing one</p>",
        "id": 472927336,
        "sender_full_name": "Terence Tao",
        "timestamp": 1727365814
    },
    {
        "content": "<p>I think it is one step</p>",
        "id": 472927853,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727365981
    },
    {
        "content": "<p>using this repo : <a href=\"https://github.com/pitmonticone/LeanProject\">https://github.com/pitmonticone/LeanProject</a> as a template</p>",
        "id": 472927875,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727365988
    },
    {
        "content": "<p>It might make more sense for me to make the PR to the new repo</p>",
        "id": 472927923,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727366007
    },
    {
        "content": "<p>Using the \"use this template\" button <a href=\"/user_uploads/3121/LU_9IQdFltJ78L7eIUPW5a8u/Screenshot-from-2024-09-26-17-53-49.png\">Screenshot from 2024-09-26 17-53-49.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/LU_9IQdFltJ78L7eIUPW5a8u/Screenshot-from-2024-09-26-17-53-49.png\" title=\"Screenshot from 2024-09-26 17-53-49.png\"><img data-original-dimensions=\"3820x1214\" src=\"/user_uploads/thumbnail/3121/LU_9IQdFltJ78L7eIUPW5a8u/Screenshot-from-2024-09-26-17-53-49.png/840x560.webp\"></a></div>",
        "id": 472928028,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727366042
    },
    {
        "content": "<p>Yes I have done that and am currently running the <code>leanblueprint new</code> script.  It is downloading Mathlib I think right now.</p>\n<p><a href=\"/user_uploads/3121/8wqTGKzr8En5jnVtN35t_F3d/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/8wqTGKzr8En5jnVtN35t_F3d/image.png\" title=\"image.png\"><img data-original-dimensions=\"1723x274\" src=\"/user_uploads/thumbnail/3121/8wqTGKzr8En5jnVtN35t_F3d/image.png/840x560.webp\"></a></div>",
        "id": 472928597,
        "sender_full_name": "Terence Tao",
        "timestamp": 1727366217
    },
    {
        "content": "<p>ah right. Once your new repository is up, I can also add the gitpod config to make contributing simpler</p>",
        "id": 472929012,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727366333
    },
    {
        "content": "<p>OK I completed the setup at <a href=\"https://github.com/teorth/equational_theories\">https://github.com/teorth/equational_theories</a> .  Will move the files over now.</p>",
        "id": 472930087,
        "sender_full_name": "Terence Tao",
        "timestamp": 1727366639
    },
    {
        "content": "<p>The first PR is in</p>",
        "id": 472930150,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727366648
    },
    {
        "content": "<p>I'll add a few commits and confirm that it can be merged in a moment</p>",
        "id": 472930359,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727366713
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"657719\">@Terence Tao</span>  : sorry there was a one character typo. Another PR coming in to fix it</p>",
        "id": 472930641,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727366801
    },
    {
        "content": "<p>Ready</p>",
        "id": 472930840,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727366867
    },
    {
        "content": "<p>I can confirm that gitpod works with PR 2</p>",
        "id": 472931082,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727366948
    },
    {
        "content": "<p>PR no. 3 adds egg as a dependency: <a href=\"https://github.com/teorth/equational_theories/pull/3\">https://github.com/teorth/equational_theories/pull/3</a></p>",
        "id": 472932965,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727367591
    },
    {
        "content": "<p>It builds sucessfully after a lake update</p>",
        "id": 472933173,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727367641
    },
    {
        "content": "<p>Both PRs 2 and 3 are ready for merge</p>",
        "id": 472933997,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727367917
    },
    {
        "content": "<p>Hey, I maintain the <code>egg</code> tactic together with <span class=\"user-mention\" data-user-id=\"315434\">@Andrés Goens</span>. I'm looking into trying out the tactic on some of the theorems. My hope is that we can solve theorems by just <code>egg [*]</code>. For example, the following works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- This proof is from https://mathoverflow.net/a/450905/766 -/</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Equation387_implies_Equation43</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Magma</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Equation387</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Equation43</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">egg</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">*</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>A major caveat to this approach is that equality saturation cannot handle equations where the quantified variables do not satisfy the subset relation in either direction of the equality. So an equation like <code>Equation2</code> (<code>∀ x y : G, x = y</code>) cannot be used for rewriting. We might be able to partially brute force our way out of that problem though by instantiating such quantified variables with terms from the local context.</p>",
        "id": 473116602,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1727445150
    },
    {
        "content": "<p>or alternatively, using <code>egg calc</code> which implements the guided equality saturation idea: essentially tring to replicate an \"informal computation\" from a blackboard</p>",
        "id": 473119115,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1727445785
    },
    {
        "content": "<p>Using <code>lake exe extract_implications</code> causes <code>egg/egg_for_lean.static</code> to run</p>",
        "id": 473288854,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1727500543
    },
    {
        "content": "<p>that's weird, I wonder if it's picking it up from that <code>compile_time_search_path%</code>? Doesn't sound like it should</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">unsafe</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"n\">args</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"ss\">`equational_theories.Subgraph</span>\n<span class=\"w\">  </span><span class=\"n\">searchPathRef</span><span class=\"bp\">.</span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">compile_time_search_path</span><span class=\"bp\">%</span>\n\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">output</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Output</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">withImportModules</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[{</span><span class=\"n\">module</span><span class=\"o\">}]</span><span class=\"w\"> </span><span class=\"o\">{}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">trustLevel</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1024</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n</code></pre></div>",
        "id": 473306281,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1727509523
    },
    {
        "content": "<p>It also happened when I attempted to create a new <code>lean_exe</code></p>",
        "id": 473306407,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1727509557
    },
    {
        "content": "<p>Hm, maybe lake links all dependencies statically? I'm out of my depth here</p>",
        "id": 473306676,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1727509643
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"690858\">@Daniel Weber</span> what happens exactly (how do you see it)? when I run <code>lake exe extract_implications</code> it seems to just work</p>",
        "id": 473307047,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1727509832
    },
    {
        "content": "<p>oh, nvm I see what you say, the first line is</p>\n<div class=\"codehilite\" data-code-language=\"Text output\"><pre><span></span><code><span class=\"go\">ℹ [39/44] Ran egg/egg_for_lean.static</span>\n</code></pre></div>",
        "id": 473307094,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1727509872
    },
    {
        "content": "<p>Yes, and earlier I didn't have rust installed so it just gave an error and didn't work (now I installed it)</p>",
        "id": 473307132,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1727509920
    },
    {
        "content": "<p>I tried an empty script that does nothing and it happens there too, I guess it's lake because it's declared as a dependency that treats it like a global dependency for executables</p>",
        "id": 473308591,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1727510751
    },
    {
        "content": "<p>not sure if there's a way to make it only a dependency of the lib</p>",
        "id": 473308671,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1727510765
    },
    {
        "content": "<p>Should we remove the egg dependency from the lakefile until it is actually used?</p>",
        "id": 473352680,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727533108
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"372804\">Marcus Rossel</span> <a href=\"#narrow/stream/458659-Equational/topic/Adding.20the.20egg.20repository.20as.20a.20dependency/near/473116602\">said</a>:</p>\n<blockquote>\n<p>Hey, I maintain the <code>egg</code> tactic together with <span class=\"user-mention silent\" data-user-id=\"315434\">Andrés Goens</span>. I'm looking into trying out the tactic on some of the theorems. My hope is that we can solve theorems by just <code>egg [*]</code>. For example, the following works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- This proof is from https://mathoverflow.net/a/450905/766 -/</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Equation387_implies_Equation43</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Magma</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Equation387</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Equation43</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">egg</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">*</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>A major caveat to this approach is that equality saturation cannot handle equations where the quantified variables do not satisfy the subset relation in either direction of the equality. So an equation like <code>Equation2</code> (<code>∀ x y : G, x = y</code>) cannot be used for rewriting. We might be able to partially brute force our way out of that problem though by instantiating such quantified variables with terms from the local context.</p>\n</blockquote>\n<p>we started trying this out (and by we, I mean <span class=\"user-mention\" data-user-id=\"372804\">@Marcus Rossel</span> fixed things and I've just played around with it a bit now)</p>\n<p>It looks relatively promising: It seems we can prove a bunch of implications that are not in <code>Subgraph.lean</code> (and we can't prove a few that are), with a timeout of 1s. Here's a diff for the implications that <code>extract_implications</code> gives (computing the transitive closure):</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>implications diff</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Diff\"><pre><span></span><code>equational_theories git:(eggxplosion) diff implications_egg_sorted.txt implications_subgraph_sorted.txt\n<span class=\"gu\">1,2d0</span>\n<span class=\"gd\">&lt; Equation14 → Equation1</span>\n<span class=\"gd\">&lt; Equation14 → Equation23</span>\n<span class=\"gu\">4,9c2,25</span>\n<span class=\"gd\">&lt; Equation14 → Equation8</span>\n<span class=\"gd\">&lt; Equation1689 → Equation1</span>\n<span class=\"gd\">&lt; Equation168 → Equation1</span>\n<span class=\"gd\">&lt; Equation23 → Equation1</span>\n<span class=\"gd\">&lt; Equation28393 → Equation1</span>\n<span class=\"gd\">&lt; Equation29 → Equation1</span>\n<span class=\"gs\">---</span>\n<span class=\"gi\">&gt; Equation1689 → Equation168</span>\n<span class=\"gi\">&gt; Equation1689 → Equation2</span>\n<span class=\"gi\">&gt; Equation1689 → Equation23</span>\n<span class=\"gi\">&gt; Equation1689 → Equation3</span>\n<span class=\"gi\">&gt; Equation1689 → Equation38</span>\n<span class=\"gi\">&gt; Equation1689 → Equation387</span>\n<span class=\"gi\">&gt; Equation1689 → Equation39</span>\n<span class=\"gi\">&gt; Equation1689 → Equation4</span>\n<span class=\"gi\">&gt; Equation1689 → Equation40</span>\n<span class=\"gi\">&gt; Equation1689 → Equation41</span>\n<span class=\"gi\">&gt; Equation1689 → Equation42</span>\n<span class=\"gi\">&gt; Equation1689 → Equation43</span>\n<span class=\"gi\">&gt; Equation1689 → Equation45</span>\n<span class=\"gi\">&gt; Equation1689 → Equation4512</span>\n<span class=\"gi\">&gt; Equation1689 → Equation4513</span>\n<span class=\"gi\">&gt; Equation1689 → Equation4522</span>\n<span class=\"gi\">&gt; Equation1689 → Equation4564</span>\n<span class=\"gi\">&gt; Equation1689 → Equation4579</span>\n<span class=\"gi\">&gt; Equation1689 → Equation4582</span>\n<span class=\"gi\">&gt; Equation1689 → Equation46</span>\n<span class=\"gi\">&gt; Equation1689 → Equation5</span>\n<span class=\"gi\">&gt; Equation1689 → Equation6</span>\n<span class=\"gi\">&gt; Equation1689 → Equation7</span>\n<span class=\"gi\">&gt; Equation1689 → Equation8</span>\n11,14d26\n<span class=\"gd\">&lt; Equation29 → Equation23</span>\n<span class=\"gd\">&lt; Equation29 → Equation8</span>\n<span class=\"gd\">&lt; Equation2 → Equation1</span>\n<span class=\"gd\">&lt; Equation2 → Equation14</span>\n16d27\n<span class=\"gd\">&lt; Equation2 → Equation1689</span>\n18,19d28\n<span class=\"gd\">&lt; Equation2 → Equation28393</span>\n<span class=\"gd\">&lt; Equation2 → Equation29</span>\n21,23d29\n<span class=\"gd\">&lt; Equation2 → Equation3722</span>\n<span class=\"gd\">&lt; Equation2 → Equation3744</span>\n<span class=\"gd\">&lt; Equation2 → Equation374794</span>\n25d30\n<span class=\"gd\">&lt; Equation2 → Equation381</span>\n42d46\n<span class=\"gd\">&lt; Equation2 → Equation5105</span>\n46,47d49\n<span class=\"gd\">&lt; Equation3722 → Equation1</span>\n<span class=\"gd\">&lt; Equation3744 → Equation1</span>\n50,53d51\n<span class=\"gd\">&lt; Equation3744 → Equation4512</span>\n<span class=\"gd\">&lt; Equation374794 → Equation1</span>\n<span class=\"gd\">&lt; Equation381 → Equation1</span>\n<span class=\"gd\">&lt; Equation387 → Equation1</span>\n55d52\n<span class=\"gd\">&lt; Equation38 → Equation1</span>\n57,58d53\n<span class=\"gd\">&lt; Equation39 → Equation1</span>\n<span class=\"gd\">&lt; Equation39 → Equation381</span>\n60d54\n<span class=\"gd\">&lt; Equation3 → Equation1</span>\n62d55\n<span class=\"gd\">&lt; Equation3 → Equation3722</span>\n64,67d56\n<span class=\"gd\">&lt; Equation40 → Equation1</span>\n<span class=\"gd\">&lt; Equation41 → Equation1</span>\n<span class=\"gd\">&lt; Equation41 → Equation3722</span>\n<span class=\"gd\">&lt; Equation41 → Equation3744</span>\n69d57\n<span class=\"gd\">&lt; Equation41 → Equation381</span>\n83d70\n<span class=\"gd\">&lt; Equation42 → Equation1</span>\n85,87d71\n<span class=\"gd\">&lt; Equation43 → Equation1</span>\n<span class=\"gd\">&lt; Equation4512 → Equation1</span>\n<span class=\"gd\">&lt; Equation4513 → Equation1</span>\n89d72\n<span class=\"gd\">&lt; Equation4522 → Equation1</span>\n92,97d74\n<span class=\"gd\">&lt; Equation4564 → Equation1</span>\n<span class=\"gd\">&lt; Equation4564 → Equation4512</span>\n<span class=\"gd\">&lt; Equation4579 → Equation1</span>\n<span class=\"gd\">&lt; Equation4579 → Equation4512</span>\n<span class=\"gd\">&lt; Equation4579 → Equation4564</span>\n<span class=\"gd\">&lt; Equation4582 → Equation1</span>\n103,104d79\n<span class=\"gd\">&lt; Equation45 → Equation1</span>\n<span class=\"gd\">&lt; Equation45 → Equation381</span>\n106,108d80\n<span class=\"gd\">&lt; Equation46 → Equation1</span>\n<span class=\"gd\">&lt; Equation46 → Equation3722</span>\n<span class=\"gd\">&lt; Equation46 → Equation3744</span>\n110d81\n<span class=\"gd\">&lt; Equation46 → Equation381</span>\n124d94\n<span class=\"gd\">&lt; Equation4 → Equation1</span>\n126d95\n<span class=\"gd\">&lt; Equation4 → Equation28393</span>\n128,129d96\n<span class=\"gd\">&lt; Equation4 → Equation3722</span>\n<span class=\"gd\">&lt; Equation4 → Equation3744</span>\n131d97\n<span class=\"gd\">&lt; Equation4 → Equation381</span>\n137,138d102\n<span class=\"gd\">&lt; Equation5105 → Equation1</span>\n<span class=\"gd\">&lt; Equation5 → Equation1</span>\n141,143d104\n<span class=\"gd\">&lt; Equation5 → Equation3722</span>\n<span class=\"gd\">&lt; Equation5 → Equation3744</span>\n<span class=\"gd\">&lt; Equation5 → Equation381</span>\n147,148d107\n<span class=\"gd\">&lt; Equation5 → Equation4564</span>\n<span class=\"gd\">&lt; Equation5 → Equation4579</span>\n150,151d108\n<span class=\"gd\">&lt; Equation6 → Equation1</span>\n<span class=\"gd\">&lt; Equation6 → Equation14</span>\n153d109\n<span class=\"gd\">&lt; Equation6 → Equation1689</span>\n156,157d111\n<span class=\"gd\">&lt; Equation6 → Equation28393</span>\n<span class=\"gd\">&lt; Equation6 → Equation29</span>\n159,161d112\n<span class=\"gd\">&lt; Equation6 → Equation3722</span>\n<span class=\"gd\">&lt; Equation6 → Equation3744</span>\n<span class=\"gd\">&lt; Equation6 → Equation374794</span>\n163d113\n<span class=\"gd\">&lt; Equation6 → Equation381</span>\n180d129\n<span class=\"gd\">&lt; Equation6 → Equation5105</span>\n183,184d131\n<span class=\"gd\">&lt; Equation7 → Equation1</span>\n<span class=\"gd\">&lt; Equation7 → Equation14</span>\n186d132\n<span class=\"gd\">&lt; Equation7 → Equation1689</span>\n189,190d134\n<span class=\"gd\">&lt; Equation7 → Equation28393</span>\n<span class=\"gd\">&lt; Equation7 → Equation29</span>\n192,194d135\n<span class=\"gd\">&lt; Equation7 → Equation3722</span>\n<span class=\"gd\">&lt; Equation7 → Equation3744</span>\n<span class=\"gd\">&lt; Equation7 → Equation374794</span>\n196d136\n<span class=\"gd\">&lt; Equation7 → Equation381</span>\n213d152\n<span class=\"gd\">&lt; Equation7 → Equation5105</span>\n216d154\n</code></pre></div>\n</div></div>\n<p>It seems like we can't handle equation 1689 well, the one from the paper of Kisielewicz. I'll play around with it a a bit, but ofc the point is also that some ingenuity is required for these implications, so it's maybe not as suprising. The cool thing is we have a bunch of equations that are new! I have added them in a PR draft here for now: <a href=\"https://github.com/teorth/equational_theories/pull/200\">equational#200</a></p>\n<p>The issue remains with the rust requirement creeping into the script, so not sure if we want to merge it like it is (although it's a shame since the proofs are a one-liner with the <code>egg</code> tactic). I can just take out the proofs (e.g. just use <code>by?</code> and copy the term or something, or maybe using <span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span> 's calcify tactic, I quite like that one for these kind of things). Would that be welcome (a PR with just the new subgraph proofs)?</p>\n<p>I think <span class=\"user-mention\" data-user-id=\"372804\">@Marcus Rossel</span> is also playing around with the tactic a bit more so maybe we'll get nicer results on AllEquations :)</p>",
        "id": 474354870,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1727889762
    },
    {
        "content": "<p>(it seems it's 86 new implications in the transitive closure over what is currently in <code>Supgraph.lean</code>)</p>",
        "id": 474355331,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1727889938
    },
    {
        "content": "<p>Does <code>calcify</code> produce good results from <code>egg</code> proofs? That might a nice and pretty option!</p>",
        "id": 474357210,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727890301
    },
    {
        "content": "<blockquote>\n<p>Would that be welcome (a PR with just the new subgraph proofs)?</p>\n</blockquote>\n<p>Certainly, I think; why not (if the proofs are somewhat reasonable, i.e. not a 1MB dump of the raw proof term :-)</p>",
        "id": 474357611,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727890369
    },
    {
        "content": "<p>I am wary of making a working local rust toolchain a requirement for people to work on this project. Not sure what to do about this.</p>",
        "id": 474357797,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727890405
    },
    {
        "content": "<p>How hard would it be to modify <code>egg</code> such that it only builds itself if the tactic is executed?</p>",
        "id": 474358795,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1727890573
    },
    {
        "content": "<p>yeah, when the proof terms are reasonably small, calcify results are nice (sometimes egg finds unnecessarily long proof terms though), but I'd shorten that manually for a PR <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 474359307,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1727890672
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"690858\">Daniel Weber</span> <a href=\"#narrow/stream/458659-Equational/topic/Adding.20the.20egg.20repository.20as.20a.20dependency/near/474358795\">said</a>:</p>\n<blockquote>\n<p>How hard would it be to modify <code>egg</code> such that it only builds itself if the tactic is executed?</p>\n</blockquote>\n<p>that's more of a lake than an egg issue if I'm not mistaken</p>",
        "id": 474359520,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1727890704
    },
    {
        "content": "<p>it's already like that for libraries, but for am executable (in particular the extract _implications script) it doesn't</p>",
        "id": 474359706,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1727890767
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"315434\">Andrés Goens</span> <a href=\"#narrow/stream/458659-Equational/topic/Adding.20the.20egg.20repository.20as.20a.20dependency/near/474354870\">said</a>:</p>\n<blockquote>\n<p>It seems like we can't handle equation 1689 well, the one from the paper of Kisielewicz. </p>\n</blockquote>\n<p>The corresponding theorem can be solved by:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Equation1689_implies_Equation2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Magma</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Equation1689</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Equation2</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">egg</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">*</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">_;</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">egg</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">*</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>(Which then also means that we don't need all of the preceding lemmas)</p>",
        "id": 474359756,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1727890787
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"372804\">Marcus Rossel</span> <a href=\"#narrow/stream/458659-Equational/topic/Adding.20the.20egg.20repository.20as.20a.20dependency/near/474359756\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"315434\">Andrés Goens</span> <a href=\"#narrow/stream/458659-Equational/topic/Adding.20the.20egg.20repository.20as.20a.20dependency/near/474354870\">said</a>:</p>\n<blockquote>\n<p>It seems like we can't handle equation 1689 well, the one from the paper of Kisielewicz. </p>\n</blockquote>\n<p>That can be solved by</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Equation1689_implies_Equation2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Magma</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Equation1689</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Equation2</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">egg</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">*</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">_;</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">egg</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">*</span><span class=\"o\">]</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>probably the timeout of 1s was not enough then on my potato</p>",
        "id": 474359913,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1727890827
    },
    {
        "content": "<p>By the way, is there already a file listing all the known and open implications for the subgraph?  It would be nice to list that on the front page of the project (under \"statistics and data files from a given point in time\").</p>",
        "id": 474362625,
        "sender_full_name": "Terence Tao",
        "timestamp": 1727891822
    },
    {
        "content": "<p>If dependency and compile time is an issue, one could generate two output files, one a list of lean proofs using the egg dependency, and one just a list of conjectures for the same implications with no egg dependency.</p>",
        "id": 474362892,
        "sender_full_name": "Terence Tao",
        "timestamp": 1727891914
    },
    {
        "content": "<p>I started going through the new implications that we found this way, here's some results so far:</p>\n<ul>\n<li>a few of the equations were redundant even though I computed the (alphabetically sorted) diff of the transitive closure generated from <code>extract_implications</code>, for example a bunch of them were just that some equations imply <code>Equation1</code> which is a tautology. I imagine the <code>extract_implications</code> script is not picking up some of these</li>\n<li>some implications are new and interesting! The proofs that we find with our tactic are also mostly quite small and <code>calcify</code> seems to work well in a lot of them (although one I was getting a pretty nasty term and by manually looking at it, it was easy to express it as a simple <code>rw</code>). It's not straightforward to go through them, so I'll start doing that slowly, sounds like a good way to get some more intuition myself, I don't want to just let automated tools have all the fun!</li>\n<li>I've made a PR (<a href=\"https://github.com/teorth/equational_theories/pull/207\">equational#207</a>) with the first three non-trivial equations that I got this way, it's quite late over here so I might not do much more of that today</li>\n</ul>",
        "id": 474379228,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1727896927
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"315434\">@Andrés Goens</span> you can get calcify's suggestion using <code>egg?</code> now.</p>",
        "id": 474384783,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1727898649
    },
    {
        "content": "<p>nice!</p>",
        "id": 474384991,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1727898714
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"372804\">Marcus Rossel</span> <a href=\"#narrow/stream/458659-Equational/topic/Adding.20the.20egg.20repository.20as.20a.20dependency/near/474384783\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"315434\">Andrés Goens</span> you can get calcify's suggestion using <code>egg?</code> now.</p>\n</blockquote>\n<p>hm, I get <code>error loading library, libCalcify-Basic-1.so: cannot open shared object file: No such file or directory</code> (even if I just try it out on the <code>lean-egg</code> repo standalone)</p>",
        "id": 474386829,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1727899219
    },
    {
        "content": "<p>(ok nvm, just a clean build works)</p>",
        "id": 474387277,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1727899376
    },
    {
        "content": "<p>I'd be interested in examples where you expect calcify to do better! Maybe file issues if you don't mind</p>",
        "id": 474388542,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727899809
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> <a href=\"#narrow/stream/458659-Equational/topic/Adding.20the.20egg.20repository.20as.20a.20dependency/near/474388542\">said</a>:</p>\n<blockquote>\n<p>I'd be interested in examples where you expect calcify to do better! Maybe file issues if you don't mind</p>\n</blockquote>\n<p>I think right now it'll be difficult to find examples of that, because the problem is firmly on the side of egg's proof generation. But there are plans to improve that in the future and then we might find some work for you <span aria-label=\"wink\" class=\"emoji emoji-1f609\" role=\"img\" title=\"wink\">:wink:</span></p>",
        "id": 474388849,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1727899954
    },
    {
        "content": "<p>yeah I did think it might be the proof terms that are a bit janky, but I wonder how much more could <code>calcify</code> do. In particular, I'm not sure if using <code>rw</code> to justify steps would be in scope of it (would def. work great with egg proofs which are all about <code>rw</code>s), but kind of an inverse of <code>rw</code> sounds pretty non-trivial</p>",
        "id": 474389278,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1727900132
    },
    {
        "content": "<p><code>calcify</code> does clean up the mess that <code>simp</code> does, so maybe it could clean after <code>egg</code> as well (but I haven't looked at the proof terms, so I shouldn't be too bold).</p>\n<p>A <code>rwify</code> tactic might also be useful if you are looking for smaller proofs.</p>",
        "id": 474389799,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727900329
    },
    {
        "content": "<p>the mess that <code>egg</code> does is inspired by <code>simp</code>s :)</p>",
        "id": 474389939,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1727900380
    },
    {
        "content": "<p>Ah, and yes, calcify could certainly try to use more concise proofs at each step. That wasn't a focus so far.</p>",
        "id": 474389944,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727900382
    },
    {
        "content": "<p>so in principle it should be similar</p>",
        "id": 474390103,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1727900422
    },
    {
        "content": "<p>doesn't hurt to add the issues and if it turns out they're out of scope/too messy, you can just close them</p>",
        "id": 474390168,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1727900460
    },
    {
        "content": "<p>To be more precise, our proof gen is pretty much just mathlib's <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Tactic/TermCongr.html#congr-congruence-quotations\">congruence quotations</a> glued together with transitivity. We need that (I think) because we support rewriting under binders. Is calcify supposed to support that?</p>",
        "id": 474540959,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1727948894
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"315434\">Andrés Goens</span> <a href=\"#narrow/stream/458659-Equational/topic/Adding.20the.20egg.20repository.20as.20a.20dependency/near/474379228\">said</a>:</p>\n<blockquote>\n<ul>\n<li>I've made a PR (<a href=\"https://github.com/teorth/equational_theories/pull/207\">equational#207</a>) with the first three non-trivial equations that I got this way, it's quite late over here so I might not do much more of that today</li>\n</ul>\n</blockquote>\n<p>the rest of these (non-trivial, new) equations for Subgraph.lean are now in a PR: <a href=\"https://github.com/teorth/equational_theories/pull/232\">equational#232</a> </p>\n<p>I used <code>calcify</code> and manually cleaned up a bit more, but <code>calcify</code> already produces pretty nice proofs for a lot of the cases! (and eliminates the need for a rust toolchain installed for others) there are some interesting examples it found, I was expecting the proofs to be a lot larger, but I guess for these simple examples <a href=\"https://ieeexplore.ieee.org/document/10026585\">Flatt et al's algorithm</a> works quite well!</p>",
        "id": 474615118,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1727967907
    }
]