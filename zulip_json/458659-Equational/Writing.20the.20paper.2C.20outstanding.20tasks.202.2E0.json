[
    {
        "content": "<p>After some hiatus, I am trying to return to wrap up the final core component of the Equational Theories Project, which is to write up the paper reporting on both the mathematics and the workflow of the project, with a tentative plan to submit to the <a href=\"https://afm.episciences.org/\">Annals of Formalized Mathematics</a>.</p>\n<p>The current draft of the paper is <a href=\"https://teorth.github.io/equational_theories/paper.pdf\">here</a> (note - due to some weird Akamai issue, an error message may temporarily appear before the PDF is accessed).  Much of it is in good shape, but certain tasks are still outstanding:</p>\n<ul>\n<li><a href=\"https://github.com/teorth/equational_theories/pull/873\">equational#873</a> <a href=\"https://github.com/teorth/equational_theories/pull/1038\">equational#1038</a> Complete Section 4 \"Project Management\".  Claimed by <span class=\"user-mention\" data-user-id=\"466334\">@Shreyas Srinivas</span> </li>\n<li><a href=\"https://github.com/teorth/equational_theories/pull/922\">equational#922</a>  Complete Section 9 \"Higman-Neumann laws\".  Claimed by <span class=\"user-mention\" data-user-id=\"761825\">@Jose Brox</span> </li>\n<li><a href=\"https://github.com/teorth/equational_theories/pull/926\">equational#926</a> Expand Section 6.3 \"Confluence\".  Claimed by <span class=\"user-mention\" data-user-id=\"116028\">@Cody Roux</span> </li>\n<li><a href=\"https://github.com/teorth/equational_theories/pull/956\">equational#956</a> Expand Section 5.6 \"Modifying base magma\".  Claimed by <span class=\"user-mention\" data-user-id=\"341148\">@Douglas McNeil</span> </li>\n<li><a href=\"https://github.com/teorth/equational_theories/pull/924\">equational#924</a> Write Section 8 \"Implications for the finite graph\".  <strong>Currently unclaimed</strong></li>\n</ul>\n<p>(There was also <a href=\"https://github.com/teorth/equational_theories/pull/1029\">equational#1029</a> to create a section on the full spectrum problem, but perhaps in the interest of getting the paper over the finish line, this can be set aside (or diverted to the blueprint) unless someone volunteers to write it.)</p>\n<p>There also are a number of smaller issues (marked in orange text boxes in the paper) that I will try to look at later today.  Anyway, if contributors who had claimed these sections can report on how they are proceeding, that would be great.  And we still need someone to write up the results for the finite implication graph!</p>\n<p>In addition to the writing, the affiliations of contributors at <a href=\"https://github.com/teorth/equational_theories/blob/main/paper/contributions.tex\">https://github.com/teorth/equational_theories/blob/main/paper/contributions.tex</a> , as well as the contriubtions matrix at <a href=\"https://github.com/teorth/equational_theories/blob/main/paper/contributions.md\">https://github.com/teorth/equational_theories/blob/main/paper/contributions.md</a> , are still quite incomplete.  If your affiliation or contributions are not correctly reported there, please either submit a PR to update them, or message me so that I can do so directly.</p>\n<p>And of course any proofreading, comments, or feedback on the paper by any of the contributors (or other observers) would be very welcome!</p>",
        "id": 524073672,
        "sender_full_name": "Terence Tao",
        "timestamp": 1749916983
    },
    {
        "content": "<p>Okay, finally got my few paragraphs edited, and tracked down references for PySAT/glucose (+minisat which the glucose guys say to reference as well.)  They were used in 3475, the one where Terry hit an obstruction and by complete coincidence it found a counterexample just a few hours later, so I remembered. :-)</p>\n<p>Not obvious to me where a reference should go to it, as there are a lot of TODOs in automated.tex.  I think it most naturally fits in <code>Semi-Automated Counterexample Guidance</code>, IMHO, where we could also mention our use of vampire in the solver mode and mace4, as opposed to vampire/prover9.</p>",
        "id": 524084521,
        "sender_full_name": "Douglas McNeil",
        "timestamp": 1749930518
    },
    {
        "content": "<p>I will try to report by Friday night German time. I should be able to find time to write a substantial portion by then</p>",
        "id": 524084820,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1749930963
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"341148\">@Douglas McNeil</span> The most important thing is to get the content in the paper; moving it to a different section is relatively easy if it turns out that it flows better, but we can decide upon that once we see how it looks.</p>\n<p>I went through the paper and removed some of the less essential TODOs, but several do remain, particularly some requests for screenshots and examples in the automated section, and some further data for things like the twisting semigroup method which are only briefly described currently.</p>",
        "id": 524085248,
        "sender_full_name": "Terence Tao",
        "timestamp": 1749931488
    },
    {
        "content": "<p>I'm afraid I'm in a slightly more embarrassing situation: I've written something up for the paper wrt confluence, and it's all correct (and well-known standard stuff) with regards to rewrite theory.</p>\n<p><em>However</em>. What the actual development uses in <code>Confluence.lean</code> is <em>not</em> proving confluence of a rewrite system. Rather it is proving the existence of a <em>canonizer</em>, which is a function <code>NF : Term -&gt; Term</code> which has the properties:</p>\n<ol>\n<li><code>NF(t) ~ t</code></li>\n<li><code>t ~ u -&gt; NF(t) = NF(u)</code></li>\n</ol>\n<p>where that last equality is syntactic over terms. This suffices to show that <code>NF</code> is idempotent (and almost the converse, which needs a tiny bit more which appears in the Lean). This can now be used to <em>disprove</em> <code>t ~ u</code>.</p>\n<p>I'm not sure this is equivalent to confluence, though the approach is quite similar. At any rate I haven't been able to reduce the latter to the former (though the other direction is easy, simply take <code>NF</code> to be the normal form by reduction of a terminating confluent system).</p>\n<p>So. What I wrote is different from what is proven. I can see 4 paths forward:</p>\n<ol>\n<li>Somehow tie the knot by proving the equivalence. I'm not sure I personally am able to do this, especially in the time alloted.</li>\n<li>Scrap the existing text and talk about what's done in code.</li>\n<li>Talk about both, leaving the relationship open for now.</li>\n<li>(the easiest, I guess) Do nothing.</li>\n</ol>\n<p>What do you all think?</p>",
        "id": 524160543,
        "sender_full_name": "Cody Roux",
        "timestamp": 1750028433
    },
    {
        "content": "<p>Maybe I should add, I can have options 2-4 done by end of business week, but not much sooner I'm afraid.</p>",
        "id": 524160646,
        "sender_full_name": "Cody Roux",
        "timestamp": 1750028530
    },
    {
        "content": "<p>One way : write about the existing code as in point 2. Make the description of confluence brief and refer to a standard source for more (maybe Nipkow’s book? You  would know better)</p>",
        "id": 524160732,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750028689
    },
    {
        "content": "<p>The discussion of confluence would serve as background material for comparison with what you have done.</p>",
        "id": 524160768,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750028726
    },
    {
        "content": "<p>I guess we've been using the terminology \"confluence\" rather loosely and imprecisely in our project, but in the paper we should get it right.  I agree that option 2 sounds best.  Perhaps one can open the section by saying that a well known property of theories that allows for an easy description of a complete rewrite system is confluence (and give references), but that we found it convenient within the project to work instead with a slightly different property, namely existence of a canonizer, and then leave as an open question to determine the precise logical relationship between the two.</p>",
        "id": 524160955,
        "sender_full_name": "Terence Tao",
        "timestamp": 1750029027
    },
    {
        "content": "<p>Ok thanks for the feedback, I'll try to have something in a day or 2.</p>\n<p>I admit that it bugs me to not really understand what's going on with this idempotence: Why is that sufficient here?</p>\n<p>I think the trick is that the relation (called <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">b</mi><mi mathvariant=\"normal\">u</mi></mrow><mrow><mi mathvariant=\"normal\">r</mi><mi mathvariant=\"normal\">w</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{bu}_{\\mathrm{rw}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">bu</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathrm mtight\" style=\"margin-right:0.01389em;\">rw</span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> in <code>Confluence.lean</code>) is sandwiched between <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>→</mo></mrow><annotation encoding=\"application/x-tex\">\\rightarrow</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.3669em;\"></span><span class=\"mrel\">→</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mo>→</mo><mo>∗</mo></msup></mrow><annotation encoding=\"application/x-tex\">\\rightarrow^*</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6887em;\"></span><span class=\"mrel\"><span class=\"mrel\">→</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6887em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">∗</span></span></span></span></span></span></span></span></span></span></span>, where <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>→</mo></mrow><annotation encoding=\"application/x-tex\">\\rightarrow</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.3669em;\"></span><span class=\"mrel\">→</span></span></span></span> is the \"directed\" version of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>≃</mo></mrow><annotation encoding=\"application/x-tex\">\\simeq</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4637em;\"></span><span class=\"mrel\">≃</span></span></span></span>. In this case, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mrow><mi mathvariant=\"normal\">b</mi><mi mathvariant=\"normal\">u</mi></mrow><mrow><mi mathvariant=\"normal\">r</mi><mi mathvariant=\"normal\">w</mi></mrow><mo>∗</mo></msubsup></mrow><annotation encoding=\"application/x-tex\">\\mathrm{bu}_{\\mathrm{rw}}^*</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.02em;vertical-align:-0.247em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">bu</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.773em;\"><span style=\"top:-2.453em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathrm mtight\" style=\"margin-right:0.01389em;\">rw</span></span></span></span></span><span style=\"top:-3.1473em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">∗</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span></span></span></span> is <em>equal</em> to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mo>→</mo><mo>∗</mo></msup></mrow><annotation encoding=\"application/x-tex\">\\rightarrow^*</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6887em;\"></span><span class=\"mrel\"><span class=\"mrel\">→</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6887em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">∗</span></span></span></span></span></span></span></span></span></span></span>, and idempotence means it merely needs to be applied once.</p>\n<p>Is that right?</p>",
        "id": 524172374,
        "sender_full_name": "Cody Roux",
        "timestamp": 1750043026
    },
    {
        "content": "<p>Rather than completely scrapping the text on confluence, it makes sense to put it in the blueprint perhaps?  This will also make it easier to answer your question.</p>",
        "id": 524178774,
        "sender_full_name": "Bruno Le Floch",
        "timestamp": 1750049654
    },
    {
        "content": "<p>Sorry for the confusion: looking at the output of <code>git blame</code>, I think <span class=\"user-mention\" data-user-id=\"116028\">@Cody Roux</span> is talking about the <strong>existing</strong> section \"6.3. Confluence\" in the <a href=\"https://teorth.github.io/equational_theories/paper.pdf\">paper</a>.</p>",
        "id": 524267989,
        "sender_full_name": "Bruno Le Floch",
        "timestamp": 1750083547
    },
    {
        "content": "<p>Correct</p>",
        "id": 524283330,
        "sender_full_name": "Cody Roux",
        "timestamp": 1750088337
    },
    {
        "content": "<p>Ok I think I finally cracked it! This was bugging me greatly. Basically the <code>Confluence.lean</code> code introduces a function <code>R : Free -&gt; Free</code>, with a curious property: <code>R w</code> is always a sub-word of <code>w</code>. I'm tempted to call this \"weakly collapsing\".</p>\n<p>It then defines a function <code>bu R : Free -&gt; Free</code> which is the bottom-up application of <code>R</code>, and proves (somewhat painstakingly) that such a function is idempotent. Huh.</p>\n<p>Finally it proves that for a bunch of specific <code>R</code>s, they are weakly collapsing, and <code>bu R</code> sends related terms to \"on the nose\" equal terms:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">   </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">bu</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">bu</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">w'</span>\n</code></pre></div>\n<p>Only this last property really matters to refute equalities, by contraposition. So why the emphasis on idempotence? I know that canonizers, which send elements of an equivalence class to a unique representative, are idempotent. But this is not a sufficient condition!</p>\n<p>What I've figured out is that with a few additional hypotheses on <code>R</code>, this _can_ be made sufficient! And it turns out that in each individual example, these hypotheses are true (I think).</p>\n<p>The hypotheses I came up with:</p>\n<ol>\n<li><code>R</code> sends terms to one in the class: <code>R w ~ w</code>.</li>\n<li><code>R</code> is weakly collapsing.</li>\n<li>if <code>w ~ w'</code>, and _every subterm_ of <code>w</code> and <code>w'</code> is a fixed point for <code>R</code>, then <code>R w = R w'</code> \"on the nose\". I'd call this a \"weak canonizer\".</li>\n</ol>\n<p>Then <code>bu R</code> is a canonizer for <code>~</code>, and preserves equivalence classes.</p>\n<p>This seems all a bit messy, though it seems like a new observation. It's quite a bit easier to prove that <code>R</code> is a weak canonizer than a full one.</p>\n<p>I intend to write this up briefly, but I can also ditch all this and simply say that we somehow build canonizers for a bunch of equations.</p>",
        "id": 525237611,
        "sender_full_name": "Cody Roux",
        "timestamp": 1750632211
    },
    {
        "content": "<p>What does this have to do with confluence? I'm not sure, but if you take <code>R</code> to be the rule that sends the LHS to the RHS of an equation, then I think being a weak canonizer implies some sort of non-overlap which should imply confluence, maybe.</p>",
        "id": 525237710,
        "sender_full_name": "Cody Roux",
        "timestamp": 1750632348
    },
    {
        "content": "<p>So I'm trying to extract the \"executive summary\" here.  If I understand correctly, confluence is a standard property that permits the construction of a complete rewriting system, and hence the ability to prove or refute all implications out of a given law; but we chose (for whatever reason) to work with a slightly different property (having a weak canonizer) that has similar consequences, but we do not know if it is logically equivalent to confluence.  We could pose the logical relationship between the two properties as an open question.  (It sounds like there are several other variations on these properties that could be discussed, but confluence is the most popular one in the literature, so it makes sense to focus primarily on the relationship with that one.)</p>",
        "id": 525244288,
        "sender_full_name": "Terence Tao",
        "timestamp": 1750642217
    },
    {
        "content": "<p>I guess I agree with that summary. I'm a little mystified with what's going on in <code>Confluence.lean</code>, and <code>Confluence1.lean</code> etc., and why they're called Confluence at all.</p>\n<p>The above theorem is how I make sense of it. As I've noted, a confluent and normalizing system trivially gives rise to a canonizer, since normal forms are unique.</p>\n<p>In retrospect it's actually a little too bad we didn't formalize the standard notion confluence, since it could have handled other systems, like the \"putnam\" system <code>x (y x) ~ y</code>.</p>\n<p>And in retrospect I'm sorry I took this task way back without actually understanding what was being done in the code. I feel like I dropped the ball there.</p>",
        "id": 525246414,
        "sender_full_name": "Cody Roux",
        "timestamp": 1750644927
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 525425957,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750725965
    },
    {
        "content": "<p>I'll ask the question tomorrow again, with more clarity</p>",
        "id": 525426351,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750726386
    },
    {
        "content": "<p>Ok, for what I hope is the last time: I am pretty sure I now understand what is going on in the <code>Confluence_i.lean</code> files, and (mostly) how it relates to actual confluence as usually understood in the theory of TRSes.</p>\n<p>Basically all the equations considered can be oriented and shown to be \"non self overlapping\" and this is sufficient to show that the <code>bu R</code> defined in <code>Confluence.lean</code> is a canonizer by induction on derivations.</p>\n<p>I have a latex proof that I've written up, but I'm gonna try to write it in Lean for peace of mind.</p>\n<p>What a relief! I'll submit a PR tonight with the Latex stuff though.</p>\n<p>Edit: I have a lean proof! ish. The termination checker doesn't much like induction on dependent families...</p>",
        "id": 525617920,
        "sender_full_name": "Cody Roux",
        "timestamp": 1750812742
    },
    {
        "content": "<p><strong>Quick note: </strong> Table 2 has a huge horizontal overflow. I suggest contracting the size of this overflow by using a multiline header row which specifies the units and order of magnitude. It will make the table cleaner and fit inside the pagewidth.</p>",
        "id": 526696063,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751412129
    },
    {
        "content": "<p>I have pushed more material on <a href=\"https://github.com/teorth/equational_theories/pull/1038\">equational#1038</a>. The primary goal of the uploaded content is to describe why project management is needed in the first place. The biggest part of it describes what it means to trust lean and what the limitations are. I am trying to keep dangerous words like \"types\" out of the description. A secondary goal is to explain this stuff to mathematicians through a math venue that they can refer and cite later. I felt this was relevant since there are loads of mathy people interested in lean who are unaware of these basic things and aren't on Zulip. Further, the stuff I described is basically folklore for ITP users but recent interactions with the outside world have taught me that there is very little understanding of what lean is actually doing out there. </p>\n<p>The only thing that remains is describing the project dashboard, CI, use of Zulip, and all that. I will push those tomorrow. I will also review and shorten the story I have written so far.</p>",
        "id": 526698009,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751413853
    },
    {
        "content": "<p>Sounds good so far!  Feel free to adjust the table as part of your PR.</p>",
        "id": 526708897,
        "sender_full_name": "Terence Tao",
        "timestamp": 1751422683
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"657719\">Terence Tao</span> <a href=\"#narrow/channel/458659-Equational/topic/Writing.20the.20paper.2C.20outstanding.20tasks.202.2E0/near/524073672\">ha dicho</a>:</p>\n<blockquote>\n<ul>\n<li><a href=\"https://github.com/teorth/equational_theories/pull/922\">equational#922</a> Complete Section 9 \"Higman-Neumann laws\". Claimed by @Jose Brox</li>\n</ul>\n</blockquote>\n<p>Hi again! Sorry for my delay in answering (as <span class=\"user-mention\" data-user-id=\"466334\">@Shreyas Srinivas</span> mentioned elsewhere, the other tasks I had postponed to work on this finally caught up with me, along with the end of the academic year, then holidays, then the start of the new academic year).</p>\n<p><span class=\"user-mention\" data-user-id=\"773643\">@Bruno Le Floch</span> and I just started planning the writing of the Higman-Neumann section, I hope we will have it ready soon.</p>",
        "id": 540971994,
        "sender_full_name": "Jose Brox",
        "timestamp": 1758620971
    }
]