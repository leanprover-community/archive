[
    {
        "content": "<p>I'm struggling to formalize <code>1701_not_implies_4587</code>. I have to go into deeply nested <code>match ... with</code> statements, and then the Lean tactics just seem to give up (I think it's a less artificial version of <a href=\"https://github.com/leanprover/lean4/issues/3935\">this issue</a>).</p>\n<p>I did hit the same issue in <code>1661</code> but I could work around it by proving strategic lemmata  and using them in preemptive rewrites. But that doesn't work here: I hit \"(deterministic) timeout at <code>elaborator</code>, maximum number of heartbeats (200000) has been reached\" even when trying to use the <code>exact</code> tactic to prove a term with <em>no</em> free variables.</p>\n<p>Is it acceptable to use <code>set_option maxHeartbeats &lt;num&gt;</code> to increase the limit? (And if I do it, will it affect the whole project, or just the current file, or just the next proof, or what? The <a href=\"https://leanprover.github.io/reference/other_commands.html\">docs</a> proved surprisingly useless for answering this question.)</p>",
        "id": 476532441,
        "sender_full_name": "Zoltan A. Kocsis (Z.A.K.)",
        "timestamp": 1728747423
    },
    {
        "content": "<p>You can use <code>set_option maxHeartbearts 400000 in theorem ...</code>, and then it's only that theorem</p>",
        "id": 476532547,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1728747538
    },
    {
        "content": "<p>Thanks! Can this come back to bite me later in some way (I assume it was set at the current number for a reason)?</p>",
        "id": 476532590,
        "sender_full_name": "Zoltan A. Kocsis (Z.A.K.)",
        "timestamp": 1728747586
    },
    {
        "content": "<p>I think it mostly has its value to prevent proofs getting stuck in really long loops, and to encourage people to split slow theorems to multiple ones. If you can't/it will be a lot of effort to split the theorem to lemmas I think it's best to just increase <code>maxHeartbearts</code></p>",
        "id": 476533305,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1728748239
    },
    {
        "content": "<p>It will increase the elaboration time of the proof, but if you can't avoid it then do please use the local option Daniel has suggested</p>",
        "id": 476536010,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1728750770
    },
    {
        "content": "<p>Is this an auto-generated proof?</p>",
        "id": 476536036,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1728750785
    },
    {
        "content": "<p>Also, if you use <code>set_option trace.profiler true</code> you might be able to find out which parts are time consuming.</p>",
        "id": 476536167,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1728750962
    },
    {
        "content": "<blockquote>\n<p>Is this an auto-generated proof?</p>\n</blockquote>\n<p>No, it just naturally falls into a lot of case distinctions. If you look in <a href=\"https://github.com/teorth/equational_theories/blob/main/equational_theories/InfModel_1661.lean\">InfModel_1661</a> you'll see a similar argument. There, I could get around the issue by creating a couple of the lemmas that I used in my initial pen-and-paper sketch of the argument (<code>op_right_even </code> and the ilk), and use them in strategic rewrites, which cuts down the work enough that I don't get the elaborator heartbeat error.</p>\n<p>Unfortunately, this approach does not work in the more complicated case distinctions required for this case of 1701. I introduced a lot of small lemmas to speed things up. But it didn't work:  I gave up when even trying to do an <code>rw</code> with</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">op_left_cache</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">op_1701_4587</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">op_1701_4587</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">op_1701_4587</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>which, as you see, does not have free variables, triggered the error.</p>\n<blockquote>\n<p>It will increase the elaboration time of the proof, but if you can't avoid it then do please use the local option Daniel has suggested</p>\n</blockquote>\n<p>I think what I want to do is \"tell Lean to check the cases\" here, really. The insight was in the construction, not in the particular verification, and spending too much time writing the proofs would take time away from finding new ones, which is more productive at this stage. The long-term solution is probably a custom macro or a custom tactic, but I can do proof engineering work later, when the implications are resolved. So unless there are other objections, I'll go with \"shorter proofs, more heartbeats\" for now, and maybe create an issue to find better ways to do this proof./</p>\n<p>Thanks for your help both!</p>",
        "id": 476557832,
        "sender_full_name": "Zoltan A. Kocsis (Z.A.K.)",
        "timestamp": 1728773310
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"763356\">Zoltan A. Kocsis (Z.A.K.)</span> has marked this topic as resolved.</p>",
        "id": 476557835,
        "sender_full_name": "Notification Bot",
        "timestamp": 1728773314
    },
    {
        "content": "<p>Let me check this lemma and see if I can reduce the proof length time.</p>",
        "id": 476559304,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1728775172
    },
    {
        "content": "<p>*proof elaborating time</p>",
        "id": 476559309,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1728775185
    },
    {
        "content": "<p>Which PR is this?</p>",
        "id": 476559379,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1728775236
    },
    {
        "content": "<p>Much appreciated, but it's not a PR yet (only 2 of the 3 proofs are finished). It'll be a PR in about 10 hours, as I have something else to do this morning.</p>",
        "id": 476559850,
        "sender_full_name": "Zoltan A. Kocsis (Z.A.K.)",
        "timestamp": 1728775827
    },
    {
        "content": "<p>I'll ping you when it's up!</p>",
        "id": 476559853,
        "sender_full_name": "Zoltan A. Kocsis (Z.A.K.)",
        "timestamp": 1728775840
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"466334\">@Shreyas Srinivas</span> I put up the currently completed proofs <a href=\"https://github.com/zaklogician/equational_theories/tree/no_1701\">here</a> so that you can take a look in the meantime if you're feeling up for it.</p>\n<p>They're in <code>equational_theories/InfModel_1701.lean</code>, it is <code>private theorem op_1701_4587_satisfies_1701</code> which is causing me trouble.</p>",
        "id": 476560530,
        "sender_full_name": "Zoltan A. Kocsis (Z.A.K.)",
        "timestamp": 1728776524
    },
    {
        "content": "<p>I didn't have time to rebase over current main, but I expect no issues.</p>",
        "id": 476560560,
        "sender_full_name": "Zoltan A. Kocsis (Z.A.K.)",
        "timestamp": 1728776595
    },
    {
        "content": "<p>thanks. let's see if I have any luck with it</p>",
        "id": 476560579,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1728776628
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"766836\">ChunHao Peng</span> has marked this topic as unresolved.</p>",
        "id": 476561706,
        "sender_full_name": "Notification Bot",
        "timestamp": 1728777911
    },
    {
        "content": "<p>have these proofs landed yet, or are they on a branch? I can take a look if you have a messy proof you are having performance problems with</p>",
        "id": 476819997,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1728923160
    },
    {
        "content": "<p>Yeah they have landed</p>",
        "id": 476820068,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1728923174
    },
    {
        "content": "<p>See : <a href=\"https://github.com/teorth/equational_theories/blob/main/equational_theories/InfModel_1701.lean\">https://github.com/teorth/equational_theories/blob/main/equational_theories/InfModel_1701.lean</a></p>",
        "id": 476820233,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1728923233
    },
    {
        "content": "<p>Specifically here : <a href=\"https://github.com/teorth/equational_theories/blob/a7ada1c2a4979134357893fef2239abde6d2eba1/equational_theories/InfModel_1701.lean#L352\">https://github.com/teorth/equational_theories/blob/a7ada1c2a4979134357893fef2239abde6d2eba1/equational_theories/InfModel_1701.lean#L352</a></p>",
        "id": 476820282,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1728923251
    },
    {
        "content": "<p>Meanwhile I will shorten the counterexample proofs in <a href=\"https://github.com/teorth/equational_theories/pull/573\">equational#573</a></p>",
        "id": 476820434,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1728923304
    },
    {
        "content": "<p>Also <span class=\"user-mention\" data-user-id=\"763356\">@Zoltan A. Kocsis (Z.A.K.)</span> : I would like to move the files you have created inside the ManuallyProved folder</p>",
        "id": 476820801,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1728923438
    },
    {
        "content": "<p>is there a high level explanation of the proof? The comments seem to refer to one</p>",
        "id": 476820839,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1728923455
    },
    {
        "content": "<p>(Again, this should probably move to a different thread, I propose this one:<br>\n<a class=\"stream-topic\" data-stream-id=\"458659\" href=\"/#narrow/stream/458659-Equational/topic/A.20question.20about.20Lean.3A.20maxHeartbeats\">#Equational &gt; A question about Lean: maxHeartbeats</a></p>",
        "id": 476821125,
        "sender_full_name": "Zoltan A. Kocsis (Z.A.K.)",
        "timestamp": 1728923551
    },
    {
        "content": "<p>(you can move messages)</p>",
        "id": 476821162,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1728923568
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> : Thanks for looking into this. In an ideal world, there would not be much to any of the proofs in <code>InfModel_XXXX.lean</code> (including the one in <a href=\"https://github.com/leanprover-community/PR/pull/573\">PR#573</a>). All of these results can be proven by</p>\n<ol>\n<li>Do a case analysis on both arguments. There are some special cases (those constants which appear in the definition of the op). Do a case analysis on the parities of both arguments.</li>\n<li>Compute using the parities and the op.</li>\n</ol>",
        "id": 476821471,
        "sender_full_name": "Zoltan A. Kocsis (Z.A.K.)",
        "timestamp": 1728923707
    },
    {
        "content": "<p>9 messages were moved here from <a class=\"stream-topic\" data-stream-id=\"458659\" href=\"/#narrow/stream/458659-Equational/topic/1648.20.21.3D.3E.20206\">#Equational &gt; 1648 !=&gt; 206</a> by <span class=\"user-mention silent\" data-user-id=\"763356\">Zoltan A. Kocsis (Z.A.K.)</span>.</p>",
        "id": 476821615,
        "sender_full_name": "Notification Bot",
        "timestamp": 1728923771
    },
    {
        "content": "<p>3 messages were moved here from <a class=\"stream-topic\" data-stream-id=\"458659\" href=\"/#narrow/stream/458659-Equational/topic/A.20question.20about.20Lean.3A.20maxHeartbeats\">#Equational &gt; A question about Lean: maxHeartbeats</a> by <span class=\"user-mention silent\" data-user-id=\"763356\">Zoltan A. Kocsis (Z.A.K.)</span>.</p>",
        "id": 476821679,
        "sender_full_name": "Notification Bot",
        "timestamp": 1728923807
    },
    {
        "content": "<p>3 messages were moved here from <a class=\"stream-topic\" data-stream-id=\"458659\" href=\"/#narrow/stream/458659-Equational/topic/1648.20.21.3D.3E.20206\">#Equational &gt; 1648 !=&gt; 206</a> by <span class=\"user-mention silent\" data-user-id=\"763356\">Zoltan A. Kocsis (Z.A.K.)</span>.</p>",
        "id": 476821742,
        "sender_full_name": "Notification Bot",
        "timestamp": 1728923841
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> : Advance warning just in case you decided to work on these, PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/579\">#579</a> will move the <code>InfModel_*.lean</code> files to the <code>ManuallyProved/</code> directory.</p>",
        "id": 476831503,
        "sender_full_name": "Zoltan A. Kocsis (Z.A.K.)",
        "timestamp": 1728928764
    }
]