[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"556875\">@Pietro Monticone</span> has created a new script, <a href=\"https://github.com/teorth/equational_theories/blob/main/scripts/run_before_push.sh\"><code>run_before_push.sh</code></a> (see <a href=\"https://github.com/teorth/equational_theories/pull/238\">equational#238</a>) to allow one to locally run most (though not all) of the CI checks in advance of a PR.  It can be run from the top level directory of the local copy of the repository.</p>\n<p>I have just recently implemented branch protection to try to force myself to not abuse admin privileges by pushing to the main branch directly.  Ironically in my experiments to do so I have still accidentally broken the build at least once today by clicking on the wrong button, but hopefully this will all get worked out soon.</p>",
        "id": 474686557,
        "sender_full_name": "Terence Tao",
        "timestamp": 1727992143
    },
    {
        "content": "<p>Added the related warning in the relevant section of the contributing guide.</p>\n<p><a href=\"/user_uploads/3121/YShkVzp4flT1bjaBKYdeE1yA/CONTRIBUTING-WARNING.png\">CONTRIBUTING-WARNING.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/YShkVzp4flT1bjaBKYdeE1yA/CONTRIBUTING-WARNING.png\" title=\"CONTRIBUTING-WARNING.png\"><img data-original-dimensions=\"1784x536\" src=\"/user_uploads/thumbnail/3121/YShkVzp4flT1bjaBKYdeE1yA/CONTRIBUTING-WARNING.png/840x560.webp\"></a></div>",
        "id": 474688553,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1727993171
    },
    {
        "content": "<p>I applaud this effort. In practice I expect mixed results because a lot of people have a set up where they automatically keep pushing commits.</p>",
        "id": 474688783,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727993292
    },
    {
        "content": "<p>You can have your editor of choice handle this automatically, only asking for a commit message from the user.</p>",
        "id": 474688818,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727993320
    },
    {
        "content": "<p>Vscode encourages this in particular if one uses the included git GUI</p>",
        "id": 474689108,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727993518
    },
    {
        "content": "<p>What we need to do is embed your script as a git pre-push hook : <a href=\"https://stackoverflow.com/questions/4196148/git-pre-push-hooks\">https://stackoverflow.com/questions/4196148/git-pre-push-hooks</a></p>",
        "id": 474689210,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727993575
    },
    {
        "content": "<p>Better source: <a href=\"https://git-scm.com/book/ms/v2/Customizing-Git-Git-Hooks\">https://git-scm.com/book/ms/v2/Customizing-Git-Git-Hooks</a></p>",
        "id": 474689868,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727993919
    },
    {
        "content": "<p>Seems a good idea. Let me test it.</p>",
        "id": 474692188,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1727995229
    },
    {
        "content": "<p>Done.</p>",
        "id": 474692974,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1727995637
    },
    {
        "content": "<p>I have tested on VS Code, Git CLI and GitHub Desktop. It seems to work everywhere.</p>",
        "id": 474693376,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1727995898
    },
    {
        "content": "<p>If I understand correctly git hooks work only locally. Therefore I need to add another paragraph to the CONTRIBUTING guide.</p>",
        "id": 474693895,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1727996185
    },
    {
        "content": "<p>I don't want this script as a mandatory requirement before pushing. It's quite long, and it's doing the same as the CI already running on PRs, right?</p>",
        "id": 474694853,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1727996629
    },
    {
        "content": "<p>Something less than that</p>",
        "id": 474695088,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727996736
    },
    {
        "content": "<p>Much less. </p>\n<p>It ensures that the key components of the Lean project are functional before changes are pushed to the repository by checking that:</p>\n<ol>\n<li>You are in the correct directory;</li>\n<li>The project builds successfully;</li>\n<li>The blueprint is successfully generated in both PDF and web versions;</li>\n<li>LaTeX declarations in the blueprint match Lean declarations in the codebase.</li>\n</ol>\n<p>It takes seconds, not minutes.</p>",
        "id": 474695094,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1727996741
    },
    {
        "content": "<p>It doesn't compile docs</p>",
        "id": 474695095,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727996743
    },
    {
        "content": "<p>It doesn't do Jekyll compilation</p>",
        "id": 474695104,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727996758
    },
    {
        "content": "<p>But it covers basically all errors I have manually fixed in different PR branches</p>",
        "id": 474695162,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1727996775
    },
    {
        "content": "<p>It seems to be a decent tradeoff.</p>",
        "id": 474695213,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1727996799
    },
    {
        "content": "<p>Does the git hook get pushed to GitHub?</p>",
        "id": 474695415,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727996930
    },
    {
        "content": "<p>Okay it doesn't</p>",
        "id": 474695620,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727997074
    },
    {
        "content": "<p>No no, but I wrote the installation script. It's coming.</p>",
        "id": 474695646,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1727997099
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 474695650,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727997100
    },
    {
        "content": "<p>the reply here gives a way to add it to the repository which is then very easy to enable by each user that wants it: <a href=\"https://stackoverflow.com/questions/3462955/putting-git-hooks-into-a-repository\">https://stackoverflow.com/questions/3462955/putting-git-hooks-into-a-repository</a></p>",
        "id": 474695952,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1727997268
    },
    {
        "content": "<p>Done <a href=\"https://github.com/teorth/equational_theories/pull/256/\">https://github.com/teorth/equational_theories/pull/256/</a></p>",
        "id": 474695985,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1727997293
    },
    {
        "content": "<p><a href=\"https://stackoverflow.com/questions/427207/can-git-hook-scripts-be-managed-along-with-the-repository/37861972#37861972\">https://stackoverflow.com/questions/427207/can-git-hook-scripts-be-managed-along-with-the-repository/37861972#37861972</a></p>",
        "id": 474696120,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727997370
    },
    {
        "content": "<p>Oh okay</p>",
        "id": 474696134,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727997382
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"556875\">Pietro Monticone</span> <a href=\"#narrow/stream/458659-Equational/topic/New.20script.3A.20run_before_push.2Esh/near/474695094\">said</a>:</p>\n<blockquote>\n<p>It takes seconds, not minutes.</p>\n</blockquote>\n<p>If you can build this project in seconds, I am very interested to know what hardware you're running, because I would also like a 10-100x speedup in my Lean compilation time. For me it takes <code>6m15.691s</code> to run the script (and this number likely grows as the repository grows).</p>",
        "id": 474696281,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1727997471
    },
    {
        "content": "<p>Btw, Floris, the end user still has the option to not run the install script</p>",
        "id": 474696438,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727997564
    },
    {
        "content": "<p>What Pietro has implemented is close to the solution in your link and it requires user action on the client side to enable the hook</p>",
        "id": 474696526,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1727997611
    },
    {
        "content": "<p>I know, but thanks for the reminder.</p>",
        "id": 474696535,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1727997616
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"111080\">Floris van Doorn</span> <a href=\"#narrow/stream/458659-Equational/topic/New.20script.3A.20run_before_push.2Esh/near/474696281\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"556875\">Pietro Monticone</span> <a href=\"#narrow/stream/458659-Equational/topic/New.20script.3A.20run_before_push.2Esh/near/474695094\">said</a>:</p>\n<blockquote>\n<p>It takes seconds, not minutes.</p>\n</blockquote>\n<p>If you can build this project in seconds, I am very interested to know what hardware you're running, because I would also like a 10-100x speedup in my Lean compilation time. For me it takes <code>6m15.691s</code> to run the script (and this number likely grows as the repository grows).</p>\n</blockquote>\n<p>I am confused here. I might have run after some <code>lake exe cache get</code> and <code>lake build</code>...</p>",
        "id": 474696649,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1727997709
    },
    {
        "content": "<p>Of course I did not have a fresh build</p>",
        "id": 474697636,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1727998319
    },
    {
        "content": "<p>I will remove the \"strongly recommended\" in the CONTRIBUTING guide and offer the 3 alternatives: </p>\n<ul>\n<li>installing the hook </li>\n<li>running the script</li>\n<li>waiting for the CI</li>\n</ul>",
        "id": 474697708,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1727998351
    },
    {
        "content": "<p>Done</p>",
        "id": 474699304,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1727999505
    },
    {
        "content": "<p>Updated the <a href=\"https://github.com/teorth/equational_theories/blob/main/CONTRIBUTING.md#3-working-on-the-task\">warning block</a>. </p>\n<p><a href=\"/user_uploads/3121/ns_aJfudkD6IFjRf75NXGoJL/Screenshot-2024-10-04-at-02.02.02.png\">Screenshot 2024-10-04 at 02.02.02.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/ns_aJfudkD6IFjRf75NXGoJL/Screenshot-2024-10-04-at-02.02.02.png\" title=\"Screenshot 2024-10-04 at 02.02.02.png\"><img data-original-dimensions=\"1814x950\" src=\"/user_uploads/thumbnail/3121/ns_aJfudkD6IFjRf75NXGoJL/Screenshot-2024-10-04-at-02.02.02.png/840x560.webp\"></a></div>",
        "id": 474699509,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1727999653
    },
    {
        "content": "<p>Cool! Thanks for all the hard work! I think we'll need many more devops before the AI overlords take us...</p>",
        "id": 474705634,
        "sender_full_name": "Cody Roux",
        "timestamp": 1728004025
    }
]