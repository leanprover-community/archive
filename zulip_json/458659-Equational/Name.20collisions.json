[
    {
        "content": "<p>Currently you can't <code>import Mathlib</code> in equational_theories because of a name conflict on <code>FreeMagma</code>. Perhaps we can use namespaces more consistently?</p>",
        "id": 479176541,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730074246
    },
    {
        "content": "<p>Huh, I had no idea <code>FreeMagma</code> already existed in Mathlib.  Perhaps we can refactor our current code to use the Mathlib version?  The label names are slightly different but its essentially the identical concept.</p>\n<p>Perhaps it's time to have the broader discussion of how/whether to import our magma machinery to Mathlib.  It seems like for the <code>FreeMagma</code> code at least we would need to perform the above refactoring first.</p>",
        "id": 479177028,
        "sender_full_name": "Terence Tao",
        "timestamp": 1730074677
    },
    {
        "content": "<p><a href=\"#narrow/stream/458659-Equational/topic/MATHLIB.3A.20What.20Should.20We.20Upstream.3F\">Here</a> is the related topic.</p>",
        "id": 479177303,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730074894
    },
    {
        "content": "<p>I'm guessing that the FreeMagma definition in ET is incompatible with mathlib's, since it uses a different <code>Magma</code> definition with a custom operator instead of <code>*</code></p>",
        "id": 479177616,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730075125
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=FreeMagma#src\">src#FreeMagma</a></p>",
        "id": 479177748,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730075207
    },
    {
        "content": "<p>We could import Mathlib's <code>FreeMagma</code> and give it an instance of <code>Magma</code> (which would be identical except for the operator symbol to the instance of <code>Mul</code> that it already has).</p>",
        "id": 479178453,
        "sender_full_name": "Terence Tao",
        "timestamp": 1730075743
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/458659-Equational/topic/Name.20collisions/near/479177616\">said</a>:</p>\n<blockquote>\n<p>I'm guessing that the FreeMagma definition in ET is incompatible with mathlib's, since it uses a different <code>Magma</code> definition with a custom operator instead of <code>*</code></p>\n</blockquote>\n<p>I think this isn't an incompatibility - as Terence says we can provide the (other) <code>Magma</code> instance, and because of the scopes <a href=\"https://github.com/teorth/equational_theories/blob/main/equational_theories/Magma.lean\">here</a>, there shouldn't be any problems unless those scopes are opened</p>",
        "id": 479183059,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1730079792
    },
    {
        "content": "<p>Unless someone is really willing to get into all the autogenerated folders, refactoring everything to Mathlib's variant could be a bit painful.  Instead I suggest we follow what Terence says. This doesn't solve the namespace clash for which there are two solutions in greatly decreasing order of preference:</p>\n<ol>\n<li>Namespace all project files into a namespace like <code>EqTheories</code>. </li>\n<li>Namespace Mathlib's FreeMagma in the Mathlib namespace. I know this one is less likely to be accepted, but in general I  feel Mathlib leaks too many names and symbols into the global namespace.</li>\n</ol>",
        "id": 479276661,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730122363
    },
    {
        "content": "<p>I think taking every opportunity to put more Mathlib things into the Mathlib namespace makes mathlib more easily usable in the long run.</p>",
        "id": 479276886,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730122432
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"657719\">Terence Tao</span> <a href=\"#narrow/channel/458659-Equational/topic/Name.20collisions/near/479178453\">said</a>:</p>\n<blockquote>\n<p>We could import Mathlib's <code>FreeMagma</code> and give it an instance of <code>Magma</code> (which would be identical except for the operator symbol to the instance of <code>Mul</code> that it already has).</p>\n</blockquote>\n<p>This is going to be a bit annoying, because then you need to decide whether the simp-normal form is <code>*</code> or the notation <code>Magma</code> currently uses; or you have to repeat every lemma from one spelling for the other</p>",
        "id": 479276893,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1730122433
    },
    {
        "content": "<p><code>Equational</code> leaks quite a lot, I don't think people are following good naming practices here (because it wasn't a priority, which is fine)</p>",
        "id": 479277043,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730122469
    },
    {
        "content": "<p>Equational is a downstream project</p>",
        "id": 479277093,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730122483
    },
    {
        "content": "<p>downstream is relative</p>",
        "id": 479277162,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730122503
    },
    {
        "content": "<p>Fwiw, I am in favour of every project being namespaced by the project's name by default.</p>",
        "id": 479277245,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730122534
    },
    {
        "content": "<p>I think you mean to say it's an \"endpoint project\" i.e. no one is expected to be able to import it</p>",
        "id": 479277248,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730122536
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/458659-Equational/topic/Name.20collisions/near/479277248\">said</a>:</p>\n<blockquote>\n<p>I think you mean to say it's an \"endpoint project\" i.e. no one is expected to be able to import it</p>\n</blockquote>\n<p>Yes. This is what I mean.</p>",
        "id": 479277291,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730122549
    },
    {
        "content": "<p>it's generally better for endpoint projects to just use some uniform namespacing convention, because it doesn't matter as much as for mathlib</p>",
        "id": 479277515,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730122608
    },
    {
        "content": "<p>I can open a PR to namespace mathlib's FreeMagma later in the evening. I have a talk to record now.</p>",
        "id": 479277660,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730122648
    },
    {
        "content": "<p>I don't think ET has a better global claim to the name than mathlib</p>",
        "id": 479277880,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730122700
    },
    {
        "content": "<p>Yeah, but as you said, it's an endpoint project. I just see every chance to namespace something in mathlib as an opportunity</p>",
        "id": 479277999,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730122735
    },
    {
        "content": "<p>it's not though, that's a decision for mathlib maintainers</p>",
        "id": 479278168,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730122793
    },
    {
        "content": "<p>and I at least would be opposed to it</p>",
        "id": 479278296,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730122820
    },
    {
        "content": "<p><a href=\"https://github.com/teorth/equational_theories/issues/751\">If someone wants to namespace this project that's a task I can just put up for claiming.</a></p>",
        "id": 479278600,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730122911
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/458659-Equational/topic/Name.20collisions/near/479278168\">said</a>:</p>\n<blockquote>\n<p>it's not though, that's a decision for mathlib maintainers</p>\n</blockquote>\n<p>Agreed. But I am hoping that after the last mathlib meeting some might support it. Just a fleeting hope</p>",
        "id": 479278792,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730122961
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/458659-Equational/topic/Name.20collisions/near/479278600\">said</a>:</p>\n<blockquote>\n<p><a href=\"https://github.com/teorth/equational_theories/issues/751\">If someone wants to namespace this project that's a task I can just put up for claiming.</a></p>\n</blockquote>\n<p>This task could be a pain because all the scripts and tools that are not lean based also need fixing. I don't know how some of the visualisation tools like <code>equation explorer</code> and<code>Graphiti</code> handle errors and declaration names.</p>",
        "id": 479278969,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730123005
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/458659-Equational/topic/Name.20collisions/near/479277880\">said</a>:</p>\n<blockquote>\n<p>I don't think ET has a better global claim to the name than mathlib</p>\n</blockquote>\n<p>upstream libraries being namespaced properly makes downstream use easier.</p>",
        "id": 479279468,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730123130
    },
    {
        "content": "<p>As a narrow short term patch for the \"can't import Mathlib\" problem, we could just namespace Equational's <code>FreeMagma</code> specifically, which I think impacts relatively few Lean files and almost no autogenerated files.  This could be a down payment for a more comprehensive namespacing later.</p>\n<p>In retrospect, when we were debating what foundational definition to use for magmas, perhaps it would have had been good to go with the option to have both <code>[Magma]</code> and <code>[Mul]</code>, with API to convert back and forth, and appropriate namespacing for the former, and have all the \"front end\" theorems of the project (such as <code>EquationX_implies_EquationY</code> or <code>Facts</code>) use our custom class <code>[Magma]</code> with no intention of upstreaming them to Mathlib (in particular allowing for isolating those results as standalone Lean statements with minimal imports), but all the \"back end\" theorems (such as the theory of free magmas) use <code>[Mul]</code> and other Mathlib classes, with the intention of upstreaming them to Mathlib at the end.  At the time, that sounded like an overengineered option, but perhaps it would have saved us some future upstreaming headaches.</p>",
        "id": 479298938,
        "sender_full_name": "Terence Tao",
        "timestamp": 1730128448
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/458659-Equational/topic/Name.20collisions/near/479278969\">said</a>:</p>\n<blockquote>\n<p>don't know how some of the visualisation tools like <code>equation explorer</code> and<code>Graphiti</code> handle errors and declaration names</p>\n</blockquote>\n<p>They don't even see the declarations, they consume graph edges directly from <code>lake exe extract_implications</code>. As long as EquationXYZ isn't renamed Equational.EquationXYZ in the output I don't think anything changes for them. (Also many individual implications/non-implications are already namespaced as is.)</p>",
        "id": 479310680,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1730131649
    },
    {
        "content": "<p>Yeah, it was a good idea to have all the secondary analytic tools pass through <code>extract_implications</code>, this makes refactoring easier.</p>\n<p>We implemented namespacing for implications early on to avoid collisions between different contributors.  Didn't think to also do this to avoid collisions between us and Mathlib, but in retrospect that would have made a lot of sense.  Maybe in our paper we can recommend using namespaces by default in downstream projects, even when there is no immediate need to do so because \"everything is working fine without them\"?</p>",
        "id": 479311295,
        "sender_full_name": "Terence Tao",
        "timestamp": 1730131785
    },
    {
        "content": "<p>I don't know. Personally I have considered the lack of at least package level namespacing by default in lean a mistake, and always  used namespaces in my projects as they are.</p>",
        "id": 479312915,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730132203
    },
    {
        "content": "<p>Secondly, upstream libraries have a moral (in the sense used in PL) responsibility to not flood the global namespace with names and symbols. Endpoint projects don't have a similar moral obligation.</p>",
        "id": 479326049,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730136160
    },
    {
        "content": "<p>I think it is the role of the standard library to provide the centralized names</p>",
        "id": 479326123,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730136195
    },
    {
        "content": "<p>yes, but it must allow end users to pick and choose</p>",
        "id": 479326169,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730136216
    },
    {
        "content": "<p>We also had this issue with notation. I brought this up in the community meeting.</p>",
        "id": 479326213,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730136228
    },
    {
        "content": "<p>no, the philosophy of mathlib is to centralize on having single definitions for things in order to maximize interoperability</p>",
        "id": 479326363,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730136268
    },
    {
        "content": "<p>that's internal to mathlib. That can still be achieved within a \"Mathlib\" namespace</p>",
        "id": 479326444,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730136300
    },
    {
        "content": "<p>External users should not be forced to jump through hoops to find names and symbols that mathlib hasn't already used</p>",
        "id": 479326484,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730136317
    },
    {
        "content": "<p>Especially since mathlib is so large and users might only care about a fraction  of it in practice and yet want to <code>import Mathlib</code></p>",
        "id": 479326540,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730136339
    },
    {
        "content": "<p>so it is very much by design that when we define the real numbers we stake a claim on the global name, because we want it to be a global convention to the extent we have influence over it</p>",
        "id": 479326543,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730136341
    },
    {
        "content": "<p>there are other proof assistant libraries which take a different approach to things, but this is a core part of mathlib's value proposition</p>",
        "id": 479326699,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730136384
    },
    {
        "content": "<p>One of the reasons  we used <code>\\dimw</code>was David found it to be one of the symbols that didn't clash with anything else in mathlib (using priority for already used notation blew up CI time)</p>",
        "id": 479326870,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730136440
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/458659-Equational/topic/Name.20collisions/near/479326543\">said</a>:</p>\n<blockquote>\n<p>so it is very much by design that when we define the real numbers we stake a claim on the global name, because we want it to be a global convention to the extent we have influence over it</p>\n</blockquote>\n<p>Yeah I think that's going to make it hard for downstream users to build on top of it</p>",
        "id": 479326957,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730136472
    },
    {
        "content": "<p>In this case, the name collision was actually on the same object for the same purpose. It is going against the grain to define a second equivalent thing, because it's creating an island which will make interoperation harder</p>",
        "id": 479327059,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730136494
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/458659-Equational/topic/Name.20collisions/near/479326957\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/458659-Equational/topic/Name.20collisions/near/479326543\">said</a>:</p>\n<blockquote>\n<p>so it is very much by design that when we define the real numbers we stake a claim on the global name, because we want it to be a global convention to the extent we have influence over it</p>\n</blockquote>\n<p>Yeah I think that's going to make it hard for downstream users to build on top of it</p>\n</blockquote>\n<p>No, it makes it hard for downstream users to ignore it and build their own isomorphic copy without reference to the original, which is by design</p>",
        "id": 479327267,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730136561
    },
    {
        "content": "<p>Sometimes users want to write their own definitions by design. They are simply using mathlib but have no interest in upstreaming to Mathlib.</p>",
        "id": 479333154,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730138670
    },
    {
        "content": "<p>I don't see why mathlib should stop anybody from doing that</p>",
        "id": 479333177,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730138678
    },
    {
        "content": "<p>It doesn't stop them:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">IDontNeedYourReal</span>\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Float</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">oops</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mf\">0.1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mf\">0.2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mf\">0.3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">IDontNeedYourReal</span>\n</code></pre></div>",
        "id": 479333644,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1730138855
    },
    {
        "content": "<p>It stops them when notation is involved</p>",
        "id": 479334337,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730139096
    },
    {
        "content": "<p>(And priority incurs build time costs)</p>",
        "id": 479334362,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730139109
    },
    {
        "content": "<p>This conversation partially belongs elsewhere. Let's keep this thread for discussing what should be done in Equational theories.</p>",
        "id": 479334534,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730139177
    },
    {
        "content": "<p>the task here is <a href=\"https://github.com/teorth/equational_theories/pull/751\">equational#751</a></p>",
        "id": 479334570,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730139192
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/458659-Equational/topic/Name.20collisions/near/479333644\">said</a>:</p>\n<blockquote>\n<p>It doesn't stop them:</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">IDontNeedYourReal</span>\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Float</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">oops</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mf\">0.1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mf\">0.2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mf\">0.3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">IDontNeedYourReal</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Further, while namespacing is fine, the onus should be on upstream libraries to do this and avoid forcing downstream users through hoops.</p>",
        "id": 479339098,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730140914
    },
    {
        "content": "<p>I think what could help future projects with interoperability and reusability (SW-wise) is an assistant that could help users make Lean software design decisions.  </p>\n<p>The good news is: v 0.1 can be done very quickly using GPTs. We can just feed a GPT with a pdf of the docs, and get it to respond, and evaluate. Eventually, the v1 could be a custom VSCode / Cursor plugin-assistant (that uses a combination of sparse and dense embeddings in the backend), or a (better) knowledge base search engine on the website.</p>\n<p>Perhaps LeanDojo could eventually take over this responsibility?  (an LLM-driven copilot for theorem proving)</p>\n<p>Side-note: I asked ChatGPT to propose magmas and it gave me <code>has_mul</code>, <code>has_add</code>, <code>semigroup</code>, <code>monoid</code>, <code>group</code>. Then I checked in Cursor with Claude - it gave me <code>Mul</code>, <code>Add</code>, <code>Semigroup</code>, <code>Monoid</code>.</p>\n<p>But I love the idea of being able to deeply integrate a valuable math project into one global math library. The deeper the integration will be, the easier it will be for future AI to create new knowledge.</p>",
        "id": 479353197,
        "sender_full_name": "Michael Bucko",
        "timestamp": 1730146604
    }
]