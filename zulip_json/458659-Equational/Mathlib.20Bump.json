[
    {
        "content": "<p>The <code>update-dependencies</code> workflow raised an issue (<a href=\"https://github.com/teorth/equational_theories/pull/733\">equational#733</a>). </p>\n<p>Opened <a href=\"https://github.com/teorth/equational_theories/pull/734\">equational#734</a> to fix it.</p>",
        "id": 478884700,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1729850634
    },
    {
        "content": "<p>The <code>update-dependencies</code> workflow raised an issue (<a href=\"https://github.com/teorth/equational_theories/pull/775\">equational#775</a>).</p>\n<p>All <code>Generated</code> files are involved. It should probably be fixed by some working with ATPs.</p>",
        "id": 480076575,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730477037
    },
    {
        "content": "<p>To fix it you should: </p>\n<ul>\n<li>Run <code>scripts/update_mathlib.sh</code></li>\n<li>Run <code>lake build</code> </li>\n<li>Debug</li>\n</ul>",
        "id": 480076823,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730477124
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 480077093,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730477220
    },
    {
        "content": "<p>Unfortunately I can't do it because I have not worked with these <code>Generated</code> files so I am not familiar enough.</p>",
        "id": 480077287,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730477286
    },
    {
        "content": "<p>I will try to fix everything tomorrow, but then the ATP people should adapt their scripts to the changes, run them again and open a new PR.</p>",
        "id": 480078289,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730477678
    },
    {
        "content": "<p>Fixed. The PR will be ready in a few minutes.</p>",
        "id": 480130646,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730503769
    },
    {
        "content": "<p>Opened <a href=\"https://github.com/teorth/equational_theories/pull/778\">equational#778</a></p>",
        "id": 480130785,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730503881
    },
    {
        "content": "<p><code>lean4checker</code> found a problem in <code>equational_theories.Equations.LawsComplete</code> <a href=\"https://github.com/teorth/equational_theories/actions/runs/11637793883/job/32412150941#step:8:28\">here</a>: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">uncaught</span><span class=\"w\"> </span><span class=\"n\">exception</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">kernel</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">unknown</span><span class=\"w\"> </span><span class=\"n\">declaration</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">testLawsUpto4_computation</span><span class=\"bp\">._</span><span class=\"n\">nativeDecide_1'</span>\n</code></pre></div>",
        "id": 480134799,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730507541
    },
    {
        "content": "<p>Well, why is native decide showing up there in the first place?</p>",
        "id": 480134965,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730507734
    },
    {
        "content": "<p>Proofs shouldn't use native decide</p>",
        "id": 480134970,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730507744
    },
    {
        "content": "<p>The docstring says </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/--</span>\n<span class=\"sd\">Here we do the actual computation. For now using `native_decide`, more serious</span>\n<span class=\"sd\">engineering is necessary if we insist on using `by decide` here.</span>\n<span class=\"sd\">-/</span>\n</code></pre></div>",
        "id": 480135035,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730507786
    },
    {
        "content": "<p><a href=\"https://github.com/teorth/equational_theories/blob/4f4be0058ae5372bd8d738e93428b85ef6845d8e/equational_theories/Equations/LawsComplete.lean#L317\">https://github.com/teorth/equational_theories/blob/4f4be0058ae5372bd8d738e93428b85ef6845d8e/equational_theories/Equations/LawsComplete.lean#L317</a></p>",
        "id": 480135077,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730507852
    },
    {
        "content": "<p>CC: <span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span></p>",
        "id": 480135164,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730507958
    },
    {
        "content": "<p>But it worked before this bump, right?</p>",
        "id": 480135240,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730508020
    },
    {
        "content": "<p>We use the lean-action script for lean4checker so it should be downloading a lean4checker with a matching tag</p>",
        "id": 480135363,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730508170
    },
    {
        "content": "<p>That being said, using native_decide is always a red flag</p>",
        "id": 480135384,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730508212
    },
    {
        "content": "<p>Ah, this is my fault for introducing the finite includes everywhere--sorry for the trouble. I'm not very familiar with Lean/Mathlib convention, does it make sense to include <code>Mathlib.Data.Finite</code> instead of <code>Mathlib.Data.Finite.Prod</code> everywhere to avoid future breakage? I suppose it impacts build times slightly, but avoids having to encounter this issue again.</p>",
        "id": 480198331,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1730536937
    },
    {
        "content": "<p>We download mathlib's cache, so build times should not be affected at all. I don't see how this causes the native_decide issue</p>",
        "id": 480198736,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730537320
    },
    {
        "content": "<p>native_decide trusts the compiler (the one that produces executable bytecode) to be faithful in, for example translating Nats. This can create false proofs iirc.</p>",
        "id": 480199284,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730537777
    },
    {
        "content": "<p>Yes, I think native_decide is separate</p>",
        "id": 480199664,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1730538095
    },
    {
        "content": "<p>Btw, I am waiting for Joachim to respond because he would know better why lean4checker is flagging native_decide now</p>",
        "id": 480245046,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730576247
    },
    {
        "content": "<p>I came across a thread where <span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> (CC) was discussing this with Joachim. @Mario: I can't pinpoint why this failure is showing up only now.</p>",
        "id": 480245159,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730576339
    },
    {
        "content": "<p>I think lean4checker should be able to handle proofs by native_decide</p>",
        "id": 480250110,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730581345
    },
    {
        "content": "<p>lean4lean definitely can't though</p>",
        "id": 480250114,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730581352
    },
    {
        "content": "<p>Sorry, missing context here.  so after a mathlib bump lean4checker (not lean4lean, right?) is unhappy with the files? Assuming everything was proper before this could be an issue with lean4checker, maybe an incompatibility with the latest lean (which may be lean's fault).</p>\n<p>Ah, I see the workflow has both lean4checker and lean4lean. But the <code>native_decide</code> isn’t new… <span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> , does lean4lean silently accept proofs by native_decide, or does that mean that the lean4lean CI check was ineffective?</p>\n<p>I’ll have a closer look.</p>\n<p>Ok, can be reproduced locally, after building <code>lean4checker</code> using</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">~/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">equational_theories</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"n\">lean4checker</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">lean4checker</span><span class=\"w\"> </span><span class=\"n\">equational_theories</span><span class=\"bp\">.</span><span class=\"n\">Equations</span><span class=\"bp\">.</span><span class=\"n\">LawsComplete</span>\n<span class=\"n\">lean4checker</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">problem</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">equational_theories</span><span class=\"bp\">.</span><span class=\"n\">Equations</span><span class=\"bp\">.</span><span class=\"n\">LawsComplete</span>\n<span class=\"n\">uncaught</span><span class=\"w\"> </span><span class=\"n\">exception</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">kernel</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">unknown</span><span class=\"w\"> </span><span class=\"n\">declaration</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">testLawsUpto4_computation</span><span class=\"bp\">._</span><span class=\"n\">nativeDecide_1'</span>\n</code></pre></div>\n<p>but the definition is there  (if I check with <code>#print</code> inside the file), so given that it worked before, and because <code>lean4</code> didn’t change a lot, I suspect an issue with some of these changes:<br>\n<a href=\"https://github.com/leanprover/lean4checker/compare/v4.13.0-rc3..v4.13.0\">https://github.com/leanprover/lean4checker/compare/v4.13.0-rc3..v4.13.0</a><br>\nOTOH, with the above command line, this should just do <code>replayFromImports m</code> in both cases. Curious.</p>",
        "id": 480253952,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1730585298
    },
    {
        "content": "<p>Ah! It also happens on <code>main</code>, if I pass the module name directly! So I conclude that the CI setup was broken before (i.e. not checking all the files the way we were expecting), and due to the above fixes to lean4checker the CI setup became more thorough.</p>\n<p><span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> , are you sure that <code>lean4checker</code> can handle <code>native_decide</code>?</p>",
        "id": 480255304,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1730586696
    },
    {
        "content": "<p>should be, it's using the kernel function which has no special option for disabling native_decide</p>",
        "id": 480255387,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730586748
    },
    {
        "content": "<p>Ah, of course the current CI setup with</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">~/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"n\">lean4checker</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">lean4checker</span><span class=\"w\"> </span><span class=\"n\">equational_theories</span>\n</code></pre></div>\n<p>only checked that single module (which doesn’t define anything new); only since lean4checker 4.13.0 this means “check every module with <code>equational_theories</code> as the prefix”</p>",
        "id": 480255393,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1730586755
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/458659-Equational/topic/Mathlib.20Bump/near/480255387\">said</a>:</p>\n<blockquote>\n<p>should be, it's using the kernel function which has no special option for disabling native_decide</p>\n</blockquote>\n<p>And the whole machinery to run native code is available?</p>",
        "id": 480255427,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1730586792
    },
    {
        "content": "<p>aha, actually maybe not</p>",
        "id": 480255435,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730586805
    },
    {
        "content": "<p>the interpreter might not have been set up correctly by the mechanism lean4checker uses</p>",
        "id": 480255443,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730586827
    },
    {
        "content": "<p>(Although even then I’d expect a different error message; the declaration <code>testLawsUpto4_computation._nativeDecide_1</code> is the argument to <code>ofReduceBool</code>)</p>",
        "id": 480255454,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1730586838
    },
    {
        "content": "<p>still, it's a weird error message in that case</p>",
        "id": 480255458,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730586842
    },
    {
        "content": "<p>you would expect something like \"IR check failed, missing definition _nativeDecide_1\"</p>",
        "id": 480255508,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730586876
    },
    {
        "content": "<p>There was a recent change about the way lean4checker works. But that's not what changed I believe. I copied the mathlib setup</p>",
        "id": 480255509,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730586877
    },
    {
        "content": "<p>That is what has changed, see the diff I linked above.</p>",
        "id": 480255515,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1730586890
    },
    {
        "content": "<p>Ok, so TL;DR:</p>\n<ul>\n<li>The lean4checker CI setup was not doing what it should be doing, but happens to be doing it now.</li>\n<li>lean4checker (likely) doesn’t support <code>native_decide</code>, so one has to either drop the proofs, drop the check, or restructure the repo to be able to check the proofs that don't use <code>native_decide</code>.</li>\n</ul>",
        "id": 480255550,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1730586934
    },
    {
        "content": "<p>Previously lean4checker would check all files inside lake search path</p>",
        "id": 480255562,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730586947
    },
    {
        "content": "<p>it would be good to confirm this first though</p>",
        "id": 480255568,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730586956
    },
    {
        "content": "<p>Now it only checks the .build path</p>",
        "id": 480255572,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730586961
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/458659-Equational/topic/Mathlib.20Bump/near/480255562\">said</a>:</p>\n<blockquote>\n<p>Previously lean4checker would check all files inside lake search path</p>\n</blockquote>\n<p>That would be true if <code>--fresh</code> was passed (or no module name was passed), but that flag is not passed, the script says:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">~/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"n\">lean4checker</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">lean4checker</span><span class=\"w\"> </span><span class=\"n\">equational_theories</span>\n</code></pre></div>",
        "id": 480255623,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1730586982
    },
    {
        "content": "<p>Anyways, off to bed, hope this investigation was useful</p>",
        "id": 480255636,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1730587010
    },
    {
        "content": "<p>No wait. There were three different things:</p>\n<ol>\n<li>With no module specified lean4checker would check everything. </li>\n<li>With a module specified lean4checker would only check that module and its submodules.</li>\n<li>With a module specified and --fresh, lean4checker would check all dependencies again</li>\n</ol>",
        "id": 480255698,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730587082
    },
    {
        "content": "<p>That’s the new behavior. Before the bump, it was</p>\n<ol start=\"2\">\n<li>With a module specified lean4checker would only check that module<br>\nand the module <code>equational_theories</code> of course doesn’t contain anything interesting.</li>\n</ol>",
        "id": 480255746,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1730587110
    },
    {
        "content": "<p>I recall that the change is that </p>\n<ol>\n<li>By default lean4checker only checks the top level module</li>\n</ol>",
        "id": 480255784,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730587185
    },
    {
        "content": "<p>Look at a current run on <code>main</code>: <br>\n<a href=\"https://github.com/teorth/equational_theories/actions/runs/11643750505/job/32424852116\">https://github.com/teorth/equational_theories/actions/runs/11643750505/job/32424852116</a><br>\n 4s to check all proofs? Clearly this was never doing any real work.</p>",
        "id": 480255785,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1730587185
    },
    {
        "content": "<p>Did you look at the diff that I posted? Both the changes to the documentation and the code are rather clear.</p>",
        "id": 480255837,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1730587212
    },
    {
        "content": "<p>(looking at this log, 44s for lean4lean are also implausible.)</p>",
        "id": 480255866,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1730587244
    },
    {
        "content": "<p>I'll look at it. For now: The CI works correctly for lean4checker now, am I correct?</p>",
        "id": 480255890,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730587284
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> <a href=\"#narrow/channel/458659-Equational/topic/Mathlib.20Bump/near/480255866\">said</a>:</p>\n<blockquote>\n<p>(looking at this log, 44s for lean4lean are also implausible.)</p>\n</blockquote>\n<p>(we've known about that for a while but I haven't had time to look into the issue)</p>",
        "id": 480255894,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730587289
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/458659-Equational/topic/Mathlib.20Bump/near/480255890\">said</a>:</p>\n<blockquote>\n<p>I'll look at it. For now: The CI works correctly for lean4checker now, am I correct?</p>\n</blockquote>\n<p>Yes, I believe so: It checks every module it finds in the search path that has <code>equational_theories</code> as a prefix.</p>",
        "id": 480255987,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1730587363
    },
    {
        "content": "<p>So previously there was no way to only check the current project at all?</p>",
        "id": 480256131,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730587538
    },
    {
        "content": "<p>Yes, using some combination of <code>find</code> to run it on each file individually.</p>",
        "id": 480256201,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1730587592
    },
    {
        "content": "<p>I thought lean4lean and lean4checker had the same interface</p>",
        "id": 480256209,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730587603
    },
    {
        "content": "<p>(I'm currently working on updating lean4lean to include the changes; as usual no one pinged me regarding changes so I have to fix this stuff after the fact)</p>",
        "id": 480256252,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730587659
    },
    {
        "content": "<p>lean4lean should now do the new lean4checker behavior as well</p>",
        "id": 480256424,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730587895
    },
    {
        "content": "<p>Currently lean4lean is run in the following way:<br>\nThe script clones the main branch of lean4lean and if the toolchains don't match, it fails silently</p>",
        "id": 480256503,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730587960
    },
    {
        "content": "<p>If toolchains match and build succeeds it runs lean4lean on <code>equational_theories</code></p>",
        "id": 480256582,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730588020
    },
    {
        "content": "<p>The <code>native_decide</code> proof that is being flagged is in the <code>LawsComplete</code> file</p>",
        "id": 480256635,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730588056
    },
    {
        "content": "<p>Fwiw, the lean4checker change that you are linking to landed 3 weeks ago. I requested it</p>",
        "id": 480256699,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730588148
    },
    {
        "content": "<p>It should have been already running correctly</p>",
        "id": 480256708,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730588159
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4checker/pull/26\">https://github.com/leanprover/lean4checker/pull/26</a></p>",
        "id": 480256772,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730588196
    },
    {
        "content": "<p>Here's a basic test for native decide:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"n\">Lean4CheckerTests</span><span class=\"bp\">/</span><span class=\"n\">NativeDecide</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">obvious</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">native_decide</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">Lean4CheckerTests</span><span class=\"bp\">.</span><span class=\"n\">NativeDecide</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">lean4checker</span><span class=\"w\"> </span><span class=\"n\">Lean4CheckerTests</span><span class=\"bp\">.</span><span class=\"n\">NativeDecide</span>\n<span class=\"n\">lean4checker</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">problem</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">Lean4CheckerTests</span><span class=\"bp\">.</span><span class=\"n\">NativeDecide</span>\n<span class=\"n\">uncaught</span><span class=\"w\"> </span><span class=\"n\">exception</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">kernel</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">unknown</span><span class=\"w\"> </span><span class=\"n\">declaration</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">obvious</span><span class=\"bp\">._</span><span class=\"n\">nativeDecide_1'</span>\n</code></pre></div>",
        "id": 480257043,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730588509
    },
    {
        "content": "<p>Here's what lean4checker is doing, broken down in this simple case:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"n\">run_cmd</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getEnv</span>\n<span class=\"w\">  </span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Command</span><span class=\"bp\">.</span><span class=\"n\">elabCommand</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"o\">(</span><span class=\"n\">mkIdent</span><span class=\"w\"> </span><span class=\"ss\">`obvious</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">native_decide</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">env'</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getEnv</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">defnInfo</span><span class=\"w\"> </span><span class=\"n\">ci</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">env'</span><span class=\"bp\">.</span><span class=\"n\">find?</span><span class=\"w\"> </span><span class=\"ss\">`obvious._nativeDecide_1</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">throwError</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">ok</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"bp\">.</span><span class=\"n\">addDecl</span><span class=\"w\"> </span><span class=\"o\">{}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">defnDecl</span><span class=\"w\"> </span><span class=\"n\">ci</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">throwError</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span>\n<span class=\"w\">  </span><span class=\"n\">assert!</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"bp\">.</span><span class=\"n\">contains</span><span class=\"w\"> </span><span class=\"ss\">`obvious._nativeDecide_1</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">thmInfo</span><span class=\"w\"> </span><span class=\"n\">ci</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">env'</span><span class=\"bp\">.</span><span class=\"n\">find?</span><span class=\"w\"> </span><span class=\"ss\">`obvious</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">throwError</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">other</span><span class=\"w\"> </span><span class=\"n\">hi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"bp\">.</span><span class=\"n\">addDecl</span><span class=\"w\"> </span><span class=\"o\">{}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">thmDecl</span><span class=\"w\"> </span><span class=\"n\">ci</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">throwError</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span>\n<span class=\"w\">  </span><span class=\"n\">println!</span><span class=\"w\"> </span><span class=\"n\">hi</span><span class=\"w\"> </span><span class=\"c1\">-- unknown declaration 'obvious._nativeDecide_1'</span>\n</code></pre></div>",
        "id": 480258065,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730589561
    },
    {
        "content": "<p>what is interesting here is that it does in fact have <code>obvious._nativeDecide_1</code> in the environment, and also that it is using the <code>.other</code> kernel exception, which the kernel itself doesn't really use, which suggests this is an IR exception being filtered through the kernel</p>",
        "id": 480258130,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730589612
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/458659-Equational/topic/Mathlib.20Bump/near/480256708\">said</a>:</p>\n<blockquote>\n<p>It should have been already running correctly</p>\n</blockquote>\n<p>Then how else do you explain the changes with the bump? Note that the lean4checker ci script checks out the revision matching the toolchain</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">checkout</span><span class=\"w\"> </span><span class=\"s2\">\"$toolchain_version\"</span>\n</code></pre></div>\n<p>and we are on 4.13.0-rc3 on <code>main</code> and 4.13.0 on the <a href=\"https://github.com/teorth/equational_theories/pull/775\">equational#775</a>, and the changes are included in between these two tags.</p>\n<p>(Sorry for being grumpy, I’m sleepy and tired, but may I kindly ask you to be more generous with the benfit of doubt. Off to bed, now for good.)</p>",
        "id": 480258401,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1730589958
    },
    {
        "content": "<p>Ah right. The PR was merged but the tag wasn't updated</p>",
        "id": 480258451,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730589985
    },
    {
        "content": "<p>In hindsight it makes sense that the tag wasn't updated</p>",
        "id": 480258500,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730590053
    },
    {
        "content": "<p>The lean4checker script in this repo is a slightly modified version of the one from lean-action</p>",
        "id": 480258648,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730590125
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"556875\">@Pietro Monticone</span> : <a href=\"https://github.com/teorth/equational_theories/pull/778\">equational#778</a> will fail until <a href=\"https://github.com/teorth/equational_theories/pull/780\">equational#780</a> is completed and merged</p>",
        "id": 480258807,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730590288
    },
    {
        "content": "<p>here's what you have to do to make native_decide work:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"n\">run_cmd</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getEnv</span>\n<span class=\"w\">  </span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Command</span><span class=\"bp\">.</span><span class=\"n\">elabCommand</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"o\">(</span><span class=\"n\">mkIdent</span><span class=\"w\"> </span><span class=\"ss\">`obvious</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">native_decide</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">env'</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getEnv</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">defnInfo</span><span class=\"w\"> </span><span class=\"n\">ci</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">env'</span><span class=\"bp\">.</span><span class=\"n\">find?</span><span class=\"w\"> </span><span class=\"ss\">`obvious._nativeDecide_1</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">throwError</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">ok</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"bp\">.</span><span class=\"n\">addDecl</span><span class=\"w\"> </span><span class=\"o\">{}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">defnDecl</span><span class=\"w\"> </span><span class=\"n\">ci</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">throwError</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span>\n<span class=\"w\">  </span><span class=\"n\">assert!</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"bp\">.</span><span class=\"n\">contains</span><span class=\"w\"> </span><span class=\"ss\">`obvious._nativeDecide_1</span>\n\n<span class=\"w\">  </span><span class=\"c1\">-- steps lean4checker doesn't do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">defnInfo</span><span class=\"w\"> </span><span class=\"n\">ci</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">env'</span><span class=\"bp\">.</span><span class=\"n\">find?</span><span class=\"w\"> </span><span class=\"ss\">`obvious._nativeDecide_1._cstage1</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">throwError</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">ok</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"bp\">.</span><span class=\"n\">addDecl</span><span class=\"w\"> </span><span class=\"o\">{}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">defnDecl</span><span class=\"w\"> </span><span class=\"n\">ci</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">throwError</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">decl</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">IR</span><span class=\"bp\">.</span><span class=\"n\">findEnvDecl</span><span class=\"w\"> </span><span class=\"n\">env'</span><span class=\"w\"> </span><span class=\"ss\">`obvious._nativeDecide_1</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">throwError</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">IR</span><span class=\"bp\">.</span><span class=\"n\">declMapExt</span><span class=\"bp\">.</span><span class=\"n\">addEntry</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">env</span><span class=\"bp\">.</span><span class=\"n\">addExtraName</span><span class=\"w\"> </span><span class=\"n\">decl</span><span class=\"bp\">.</span><span class=\"n\">name</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">decl</span>\n\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">thmInfo</span><span class=\"w\"> </span><span class=\"n\">ci</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">env'</span><span class=\"bp\">.</span><span class=\"n\">find?</span><span class=\"w\"> </span><span class=\"ss\">`obvious</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">throwError</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span>\n<span class=\"w\">  </span><span class=\"n\">ofExceptKernelException</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">env</span><span class=\"bp\">.</span><span class=\"n\">addDecl</span><span class=\"w\"> </span><span class=\"o\">{}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">thmDecl</span><span class=\"w\"> </span><span class=\"n\">ci</span><span class=\"o\">))</span>\n</code></pre></div>",
        "id": 480258991,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730590448
    },
    {
        "content": "<p>so in summary this is indeed an IR check error</p>",
        "id": 480259014,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730590492
    },
    {
        "content": "<p>Great analysis! So probably a bug that's to be fixed in lean4's <code>Replay</code> module? (Maybe guarded by a flag - maybe some users of <code>lean4checker</code> don't want the checked file to run arbitrary code.)</p>",
        "id": 480259228,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1730590740
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> Why is <code>Lean.Replay</code> in lean instead of lean4checker now? It would be easier to fix this from lean4checker?</p>",
        "id": 480259234,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730590747
    },
    {
        "content": "<p>(I don't think <code>Lean.Replay</code> can be used for anything except doing literally lean4checker as is.)</p>",
        "id": 480259253,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730590785
    },
    {
        "content": "<p>even lean4lean can't reuse that function</p>",
        "id": 480259263,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730590800
    },
    {
        "content": "<p>We should leave a summary of what happened for <span class=\"user-mention\" data-user-id=\"657719\">@Terence Tao</span> 's notes:</p>\n<p>Basically, my lean4checker PR had a mistake. It is three weeks now, so my memory is a bit hazy, but the cause must have  been some combination of \"I assumed I was already using the changes of lean4checker's update from 3 weeks ago\" and \"I assumed lean4checker worked on a similar interface as lean4lean\". However the lean-action script was fetching a specific tag of lean4checker from before this update, namely <code>v4.13.0-rc3</code> and thus not including <a href=\"https://github.com/leanprover-community/lean4checker/pull/26\">lean4checker#26</a> . </p>\n<p>The requested change landed in toolchain 4.13.0, and automatically lean4checker started running correctly with the repository's toolchain bump. It caught the use of <code>native_decide</code> in <code>equational_theories.Equations.LawsComplete</code>. <span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span> figured out that prior to the toolchain update lean4checker had been running incorrectly, and we discussed and figured out the rest.</p>\n<p>@Mario believes that lean4checker ought to be able to handle <code>native_decide</code> and has a fix</p>",
        "id": 480260104,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730591688
    },
    {
        "content": "<p>(apologies for my mistake btw)</p>",
        "id": 480260118,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730591713
    },
    {
        "content": "<p>I don't have a fix</p>",
        "id": 480260138,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730591743
    },
    {
        "content": "<p>I have concepts of a plan</p>",
        "id": 480260143,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730591751
    },
    {
        "content": "<p>TBH I would really love to be able to evaluate native_decide in lean4lean. But this requires extracting a specification from the compiler, which is very hard</p>",
        "id": 480260203,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730591826
    },
    {
        "content": "<p>This is primarily a long term issue though regarding whether we can generate a fully validated Lean proof of our impicatoin graph, right?  In the short term we could just disable the leanchecker if needed, presumably.</p>",
        "id": 480260296,
        "sender_full_name": "Terence Tao",
        "timestamp": 1730591931
    },
    {
        "content": "<p>or just comment out that proof in lawscomplete</p>",
        "id": 480260308,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730591945
    },
    {
        "content": "<p><a href=\"https://github.com/teorth/equational_theories/pull/780\">equational#780</a></p>",
        "id": 480260492,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730592075
    },
    {
        "content": "<p>But this PR uses the earlier toolchain so lean4checker is still not running correctly</p>",
        "id": 480260624,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730592160
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"657719\">Terence Tao</span> <a href=\"#narrow/channel/458659-Equational/topic/Mathlib.20Bump/near/480260296\">said</a>:</p>\n<blockquote>\n<p>This is primarily a long term issue though regarding whether we can generate a fully validated Lean proof of our impicatoin graph, right?  In the short term we could just disable the leanchecker if needed, presumably.</p>\n</blockquote>\n<p>It’s not even the implication graph, it’s just the theorem “all canonical size-4 equations are in our list”</p>",
        "id": 480260727,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1730592254
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/458659-Equational/topic/Mathlib.20Bump/near/480260624\">said</a>:</p>\n<blockquote>\n<p>But this PR uses the earlier toolchain so lean4checker is still not running correctly</p>\n</blockquote>\n<p>Plus it doesn’t work :-). Ignore this PR for now, that’s why it's a draft</p>\n<p>Oh, it actually passed the build step in 4mins. That’s someting … not really tenable yet, but it’s a start.</p>",
        "id": 480260749,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1730592287
    },
    {
        "content": "<p>Where did it fail? I see that lean4lean appears to be running correctly (it fetches master after all)</p>",
        "id": 480261377,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730592873
    },
    {
        "content": "<p>But the check wasn't completed</p>",
        "id": 480261381,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730592882
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/458659-Equational/topic/Mathlib.20Bump/near/480260308\">said</a>:</p>\n<blockquote>\n<p>or just comment out that proof in lawscomplete</p>\n</blockquote>\n<p>I prefer this.</p>",
        "id": 480267410,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730598910
    },
    {
        "content": "<p>Sorry, but it’s been a very busy day and I’ve not been able to interact on Zulip. </p>\n<p>Tomorrow I can comment out the proof in LawsComplete in the Bump PR <a href=\"https://github.com/teorth/equational_theories/pull/778\">equational#778</a> if you all agree.</p>",
        "id": 480267532,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730599039
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> : Since the update lean4lean has been failing on all CI runs</p>",
        "id": 480267550,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730599074
    },
    {
        "content": "<p>you should comment it out and make a PR turning it back on</p>",
        "id": 480267598,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730599111
    },
    {
        "content": "<p>that CI step was never properly tested to begin with</p>",
        "id": 480267604,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730599123
    },
    {
        "content": "<p>It's a bit late for me so i can't look into it now, but that's basically what I plan to do.</p>",
        "id": 480267612,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730599129
    },
    {
        "content": "<p>I think the error might be in my script. lean4lean seems to be launching its own process.</p>",
        "id": 480267739,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730599239
    },
    {
        "content": "<p>and my process quits separately</p>",
        "id": 480267770,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730599273
    },
    {
        "content": "<p>Ok, so tomorrow I’ll comment it out, merge and then wait for the new PR by <span class=\"user-mention\" data-user-id=\"466334\">@Shreyas Srinivas</span>.</p>",
        "id": 480267852,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730599344
    },
    {
        "content": "<p>Merged the commented out version</p>",
        "id": 480270248,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730601655
    },
    {
        "content": "<p>This one is for fixing the lean4lean checker: <a href=\"https://github.com/teorth/equational_theories/pull/782\">https://github.com/teorth/equational_theories/pull/782</a></p>",
        "id": 480270495,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730601868
    },
    {
        "content": "<p>the script directly returns the return code of lean4lean directly. So if lean4lean fails, then the bug isn't in the script.</p>",
        "id": 480270633,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730602014
    },
    {
        "content": "<p>The check appears to have succeeded</p>",
        "id": 480271366,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730602756
    },
    {
        "content": "<p>On the other hand, I am not convinced with the verbose output. On a successful run I get 25k lines:<br>\n<a href=\"https://github.com/teorth/equational_theories/actions/runs/11647804605/job/32433484220?pr=782#step:13:25134\">https://github.com/teorth/equational_theories/actions/runs/11647804605/job/32433484220?pr=782#step:13:25134</a></p>",
        "id": 480271668,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730603035
    },
    {
        "content": "<p><del>However the \"failed\" run ended like this : <a href=\"https://github.com/teorth/equational_theories/actions/runs/11647168925/job/32432114332#step:13:49020\">https://github.com/teorth/equational_theories/actions/runs/11647168925/job/32432114332#step:13:49020</a> </del><br>\nNvm it seems fine now</p>",
        "id": 480271722,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730603071
    },
    {
        "content": "<p>14 messages were moved from this topic to <a class=\"stream-topic\" data-stream-id=\"458659\" href=\"/#narrow/channel/458659-Equational/topic/LawsComplete.20by.20proof.20term.20generation\">#Equational &gt; LawsComplete by proof term generation</a> by <span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span>.</p>",
        "id": 480297904,
        "sender_full_name": "Notification Bot",
        "timestamp": 1730631019
    },
    {
        "content": "<p>I have merged main into <a href=\"https://github.com/teorth/equational_theories/pull/778\">equational#778</a> and now is ready to be merged.</p>",
        "id": 480300913,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730633993
    },
    {
        "content": "<p>Let's hold on that</p>",
        "id": 480300979,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730634027
    },
    {
        "content": "<p>Have we commented out the theorem using native decide for now?</p>",
        "id": 480301012,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730634068
    },
    {
        "content": "<p>Also why have so many files changed?</p>",
        "id": 480301033,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730634107
    },
    {
        "content": "<p>We know that Finite.Basic vs Finite.Prod wasn't the issue right?</p>",
        "id": 480301090,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730634142
    },
    {
        "content": "<p>Mostly due to the deletion of the Mathlib.Data.Finite.Basic from the new Mathlib version</p>",
        "id": 480301115,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730634177
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/stream/458659-Equational/topic/Mathlib.20Bump/near/480301012\">said</a>:</p>\n<blockquote>\n<p>Have we commented out the theorem using native decide for now?</p>\n</blockquote>\n<p>This issue has been solved by Mario’s PR I merged before updating the “fix-bump” branch.</p>",
        "id": 480301184,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730634257
    },
    {
        "content": "<p>Is this <a href=\"https://github.com/teorth/equational_theories/pull/784\">equational#784</a>?</p>",
        "id": 480301190,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730634273
    },
    {
        "content": "<p>I thought that was still a WIP</p>",
        "id": 480301199,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730634284
    },
    {
        "content": "<p>Well in that case I guess we should merge 778</p>",
        "id": 480301217,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730634313
    },
    {
        "content": "<p>There is WIP on LawsComplete (see related thread), but it’s enough to merge the fixed bump. I’m going to merge it now.</p>",
        "id": 480301326,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730634414
    },
    {
        "content": "<p>Okay <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span></p>",
        "id": 480301338,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730634438
    },
    {
        "content": "<p>Done <span aria-label=\"check\" class=\"emoji emoji-2705\" role=\"img\" title=\"check\">:check:</span></p>",
        "id": 480301426,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730634493
    },
    {
        "content": "<p>The good news is that both lean4checker and lean4lean appear to be working correctly now.</p>",
        "id": 480302161,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730635225
    },
    {
        "content": "<p>The (not too) bad news is that CI times will go up substantially. Lean4lean takes 15 mins</p>",
        "id": 480302226,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730635278
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"556875\">@Pietro Monticone</span>  The CI fails on an invalid header. I am surprised by this since it worked well on your PR and because this error is usually caused by mismatched toolchains, which doesn't appear to be the case</p>",
        "id": 480304666,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730637763
    },
    {
        "content": "<p>I have re-run the CI for now</p>",
        "id": 480304684,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730637792
    },
    {
        "content": "<p>It fails only when it retrieves from cache. </p>\n<p>I have deleted the cache just to show that CI will succeed in this case (both in <code>main</code> and in the latest Mario's PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/788\">#788</a>).</p>",
        "id": 480307169,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730640229
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/458659-Equational/topic/Mathlib.20Bump/near/480256252\">said</a>:</p>\n<blockquote>\n<p>(I'm currently working on updating lean4lean to include the changes; as usual no one pinged me regarding changes so I have to fix this stuff after the fact)</p>\n</blockquote>\n<p>Sorry, didn't realise you were using the same CLI interface. Could you put a note somewhere in lean4checker (either README or probably better where the CLI interface is defined) reminding any future author of changes to either ping lean4lean or PR corresponding changes there?</p>",
        "id": 480345738,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1730675439
    },
    {
        "content": "<p>The <code>update-dependencies</code> workflow raised an issue (<a href=\"https://github.com/teorth/equational_theories/pull/790\">equational#790</a>).</p>\n<p>These are the files involved:</p>\n<ul>\n<li><code>equational_theories.DecideBang</code></li>\n<li><code>equational_theories.Equations.Command</code></li>\n<li><code>equational_theories.LiftingMagmaFamilies</code>.</li>\n</ul>",
        "id": 480728965,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730815633
    },
    {
        "content": "<p>Opened draft PR <a href=\"https://github.com/teorth/equational_theories/pull/793\">equational#793</a></p>",
        "id": 480730868,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730816147
    },
    {
        "content": "<p>I have upgraded all the deprecated lemmas and solved the problem in <code>equational_theories.LiftingMagmaFamilies</code>.</p>\n<p>Regarding <code>equational_theories.DecideBang</code>, <a href=\"https://github.com/teorth/equational_theories/blob/0417d1e4a4006c968601be0d596d20ef881282cb/equational_theories/DecideBang.lean#L32\">here</a> and <a href=\"https://github.com/teorth/equational_theories/blob/0417d1e4a4006c968601be0d596d20ef881282cb/equational_theories/DecideBang.lean#L80\">here</a> we get the following error: </p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">invalid `do` notation, expected type is not a monad application</span>\n<span class=\"go\">  Name → TacticM Expr</span>\n<span class=\"go\">You can use the `do` notation in pure code by writing `Id.run do` instead of `do`, where `Id` is the identity monad.</span>\n</code></pre></div>\n<p>Does anybody know how to solve them?</p>",
        "id": 480732691,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730816671
    },
    {
        "content": "<p>Regarding <code>equational_theories.Equations.Command</code>, <a href=\"https://github.com/teorth/equational_theories/blob/0417d1e4a4006c968601be0d596d20ef881282cb/equational_theories/Equations/Command.lean#L98\">here</a> we get </p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">unknown identifier 'getDeclarationRange'</span>\n</code></pre></div>",
        "id": 480733359,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730816882
    },
    {
        "content": "<p>Maybe a missing <code>?</code>? <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Elab.getDeclarationRange%3F#doc\">docs#Lean.Elab.getDeclarationRange?</a></p>",
        "id": 480733799,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730817004
    },
    {
        "content": "<p>Yes, but then we get a type mismatch</p>",
        "id": 480733892,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730817024
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"644391\">@loogle</span> getDeclarationRange</p>",
        "id": 480733928,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730817036
    },
    {
        "content": "<p><span aria-label=\"exclamation\" class=\"emoji emoji-2757\" role=\"img\" title=\"exclamation\">:exclamation:</span> unknown identifier 'getDeclarationRange'<br>\nDid you mean <a href=\"https://loogle.lean-lang.org/?q=%22getDeclarationRange%22\"><code>\"getDeclarationRange\"</code></a>?</p>",
        "id": 480733929,
        "sender_full_name": "loogle",
        "timestamp": 1730817037
    },
    {
        "content": "<p>Try wrapping inside a <code>(&lt;- get...).getD default</code> and see if it works?</p>",
        "id": 480734039,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730817068
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">invalid field 'getD', the environment does not contain 'Lean.Syntax.getD'</span>\n<span class=\"go\">  __do_lift✝</span>\n<span class=\"go\">has type</span>\n<span class=\"go\">  Syntax</span>\n</code></pre></div>",
        "id": 480734307,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730817140
    },
    {
        "content": "<p>There has been some renaming of array and list functions</p>",
        "id": 480734461,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730817181
    },
    {
        "content": "<p>Check the release notes of 4.14.0-rc1</p>",
        "id": 480734495,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730817194
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"644391\">@loogle</span> getD</p>",
        "id": 480734550,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730817214
    },
    {
        "content": "<p><span aria-label=\"exclamation\" class=\"emoji emoji-2757\" role=\"img\" title=\"exclamation\">:exclamation:</span> unknown identifier 'getD'<br>\nDid you mean <a href=\"https://loogle.lean-lang.org/?q=%22getD%22\"><code>\"getD\"</code></a>, <a href=\"https://loogle.lean-lang.org/?q=Array.getD\"><code>Array.getD</code></a>, or <a href=\"https://loogle.lean-lang.org/?q=getD\">something else</a>?</p>",
        "id": 480734554,
        "sender_full_name": "loogle",
        "timestamp": 1730817215
    },
    {
        "content": "<p>I meant <code>(← getDeclarationRange (← getRef)).getD default</code>: is this what you tried?</p>",
        "id": 480734707,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730817246
    },
    {
        "content": "<p>Using <code>getD</code> on the whole call, not just the internal variable.</p>",
        "id": 480734833,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730817285
    },
    {
        "content": "<p>Now </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">ranges</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getDeclarationRange</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getRef</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">getD</span><span class=\"w\"> </span><span class=\"n\">default</span>\n<span class=\"w\">    </span><span class=\"n\">selectionRange</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getDeclarationRange</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"n\">eqStx</span><span class=\"w\"> </span><span class=\"o\">}</span>\n</code></pre></div>\n<p>returns: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">mismatch</span>\n<span class=\"w\">  </span><span class=\"bp\">__</span><span class=\"n\">do_lift</span><span class=\"bp\">✝</span>\n<span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">DeclarationRange</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">DeclarationRange</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n</code></pre></div>",
        "id": 480735290,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730817419
    },
    {
        "content": "<p>Is it maybe referring to the next <code>selectionRange</code> line now, where a similar workaround may work?</p>",
        "id": 480735446,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730817461
    },
    {
        "content": "<p>Yes, thanks.</p>",
        "id": 480735737,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730817538
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"556875\">Pietro Monticone</span> <a href=\"#narrow/channel/458659-Equational/topic/Mathlib.20Bump/near/480732691\">said</a>:</p>\n<blockquote>\n<p>I have upgraded all the deprecated lemmas and solved the problem in <code>equational_theories.LiftingMagmaFamilies</code>.</p>\n<p>Regarding <code>equational_theories.DecideBang</code>, <a href=\"https://github.com/teorth/equational_theories/blob/0417d1e4a4006c968601be0d596d20ef881282cb/equational_theories/DecideBang.lean#L32\">here</a> and <a href=\"https://github.com/teorth/equational_theories/blob/0417d1e4a4006c968601be0d596d20ef881282cb/equational_theories/DecideBang.lean#L80\">here</a> we get the following error: </p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">invalid `do` notation, expected type is not a monad application</span>\n<span class=\"go\">  Name → TacticM Expr</span>\n<span class=\"go\">You can use the `do` notation in pure code by writing `Id.run do` instead of `do`, where `Id` is the identity monad.</span>\n</code></pre></div>\n<p>Does anybody know how to solve them?</p>\n</blockquote>\n<p><code>closeMainGoalUsing</code> passes an extra argument to it's argument now, which we can ignore. Add an <code>_</code> to the <code>fun</code> (don't recall if it goes before or after <code>expectedType</code>).</p>\n<p>Also, <code>decide!</code> has been upstreamed, and can be removed here. <code>decideFin!</code> has to remain.</p>",
        "id": 480735744,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1730817541
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">closeMainGoalUsing</span><span class=\"w\"> </span><span class=\"ss\">`decideFin</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">expectedType</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">...</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>Worked. Thank you <span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span></p>",
        "id": 480736132,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730817656
    },
    {
        "content": "<p>Ok, just fixed all the remaining errors. </p>\n<p>Now it's awaiting for CI and then it'll be ready to be merged.</p>\n<p>Thank you <span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> and <span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span> for your help.</p>",
        "id": 480738718,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730818388
    },
    {
        "content": "<p>Oh no... </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Running</span><span class=\"w\"> </span><span class=\"n\">lean4checker</span>\n<span class=\"w\">  </span><span class=\"n\">lean4checker</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">problem</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">equational_theories</span><span class=\"bp\">.</span><span class=\"n\">Closure</span>\n<span class=\"w\">  </span><span class=\"n\">uncaught</span><span class=\"w\"> </span><span class=\"n\">exception</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">read</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"bp\">'././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">equational_theories</span><span class=\"bp\">/</span><span class=\"n\">Closure</span><span class=\"bp\">.</span><span class=\"n\">olean'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">incompatible</span><span class=\"w\"> </span><span class=\"n\">header</span>\n</code></pre></div>\n<p>Maybe we should comment out the Lean4Checker and Lean4Lean steps for now <span class=\"user-mention\" data-user-id=\"466334\">@Shreyas Srinivas</span></p>",
        "id": 480745004,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730819953
    },
    {
        "content": "<p>Has lean4checker been updated?</p>",
        "id": 480745305,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730820032
    },
    {
        "content": "<p>It could be a simple toolchain mismatch issue</p>",
        "id": 480745345,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730820044
    },
    {
        "content": "<p>Also lean4lean is independent</p>",
        "id": 480745379,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730820057
    },
    {
        "content": "<p>In any case, I think that we can comment it out for the moment and re-enable it at the end.</p>",
        "id": 480745473,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730820094
    },
    {
        "content": "<p>Also this error is definitely not occurring for the first time</p>",
        "id": 480745529,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730820113
    },
    {
        "content": "<p>What was our fix last time?</p>",
        "id": 480745559,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730820120
    },
    {
        "content": "<p>It was <code>invalid header</code>, not <code>incompatible header</code></p>",
        "id": 480745669,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730820144
    },
    {
        "content": "<p>I want to resist the urge to turn off external checkers every time we run into an issue with them</p>",
        "id": 480745995,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730820244
    },
    {
        "content": "<p>The \"fix\" last time was to remove the saved cache and re-run all action jobs. Just done it again.</p>",
        "id": 480746115,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730820283
    },
    {
        "content": "<p>I think we should clear the cache on each version bump</p>",
        "id": 480746194,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730820303
    },
    {
        "content": "<p>Github caching doesn't \"understand\" lean's version issues</p>",
        "id": 480746287,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730820335
    },
    {
        "content": "<p>Yes, and it should do it...</p>",
        "id": 480746306,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730820339
    },
    {
        "content": "<p>Oh... it's because of the <code>restore-key</code> stuff.</p>",
        "id": 480746453,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730820376
    },
    {
        "content": "<p>Let me fix it.</p>",
        "id": 480746599,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730820423
    },
    {
        "content": "<p>Let's document this issue in the paper plan. It can be an example of the kind of strange issues one can run into on these projects</p>",
        "id": 480746644,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730820434
    },
    {
        "content": "<p>Can you do it? I don't have time now.</p>",
        "id": 480746756,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730820466
    },
    {
        "content": "<p>Sure. I'll do it in the next two days</p>",
        "id": 480746798,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730820479
    },
    {
        "content": "<p>The concept of stale caches is not unknown, nor are github cache issues, but we are in a sense describing our experience</p>",
        "id": 480747045,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730820529
    },
    {
        "content": "<p>Fixed.</p>",
        "id": 480747049,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730820530
    },
    {
        "content": "<p>New error! This time in <code>Generate home_page/dashboard.md</code>: </p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">2m 57s</span>\n<span class=\"go\">Run pip install pillow</span>\n<span class=\"go\">Defaulting to user installation because normal site-packages is not writeable</span>\n<span class=\"go\">Collecting pillow</span>\n<span class=\"go\">  Downloading pillow-11.0.0-cp310-cp310-manylinux_2_28_x86_64.whl (4.4 MB)</span>\n<span class=\"go\">     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 4.4/4.4 MB 42.2 MB/s eta 0:00:00</span>\n<span class=\"go\">Installing collected packages: pillow</span>\n<span class=\"go\">Successfully installed pillow-11.0.0</span>\n<span class=\"go\">extracting histogram...</span>\n<span class=\"go\">Traceback (most recent call last):</span>\n<span class=\"go\">  File \"/home/runner/work/equational_theories/equational_theories/scripts/generate_dashboard.py\", line 43, in &lt;module&gt;</span>\n<span class=\"go\">    hist_result = subprocess.run(</span>\n<span class=\"go\">  File \"/usr/lib/python3.10/subprocess.py\", line 526, in run</span>\n<span class=\"go\">    raise CalledProcessError(retcode, process.args,</span>\n<span class=\"go\">subprocess.CalledProcessError: Command '['/home/runner/.elan/bin/lake', 'exe', 'extract_implications', 'outcomes', 'equational_theories', '--hist']' returned non-zero exit status 1.</span>\n</code></pre></div>\n<p>I don't have time to fix it directly at the moment.</p>",
        "id": 480759094,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730824105
    },
    {
        "content": "<p>Sounds like the first place to check is the extract_implications lean tool. Probably a toolchain issue.</p>",
        "id": 480759510,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730824213
    },
    {
        "content": "<p>I do have a question though. Do we really want to have his constant toolchain bumping? It seems we don't substantially benefit from a weekly toolchain bump</p>",
        "id": 480762550,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730825245
    },
    {
        "content": "<p>Perhaps reduce it to monthly?</p>",
        "id": 480762772,
        "sender_full_name": "Terence Tao",
        "timestamp": 1730825302
    },
    {
        "content": "<p>Updating to stable toolchains and cleaning up the incompatibilities seems better. That's a once in a month thing</p>",
        "id": 480762780,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730825306
    },
    {
        "content": "<p>Yes exactly. stable toolchains are released once a month.</p>",
        "id": 480762823,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730825319
    },
    {
        "content": "<p>I don't buy into the mathlib philosophy that we need the latest and greatest toolchain when we don't substantially benefit from it and we have to deal with these breakages every week. EDIT: Unless the changes are essential bug fixes or offer new lemmas/tactics we can use.</p>",
        "id": 480762989,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730825386
    },
    {
        "content": "<p>As I suspected, there is an error in the function argument of <code>mapIdx</code> which is now expecting an Nat parameter, and not a fin Parameter</p>",
        "id": 480765662,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730826365
    },
    {
        "content": "<p>HashMap's mapIdx function's index parameter changed from Fin to Nat from 4.13.0 to 4.14.0-rc1</p>",
        "id": 480766446,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730826638
    },
    {
        "content": "<p>I have just run: </p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>lake<span class=\"w\"> </span>exe<span class=\"w\"> </span>extract_implications<span class=\"w\"> </span>outcomes<span class=\"w\"> </span>equational_theories<span class=\"w\"> </span>--hist\n</code></pre></div>\n<p>It returns: </p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">uncaught exception: failed to read file '././.lake/build/lib/equational_theories.olean', invalid header</span>\n</code></pre></div>",
        "id": 480809168,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730845235
    },
    {
        "content": "<p>You need to build the project first</p>",
        "id": 480809209,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730845263
    },
    {
        "content": "<p>Then you will get the error that in <code>equational_theories/Closure.lean</code>  <code>i.val</code> isn't a thing anymore</p>",
        "id": 480809350,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730845336
    },
    {
        "content": "<p>The solution is to simply use <code>i</code></p>",
        "id": 480809369,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730845350
    },
    {
        "content": "<p>But this is not supposed to throw any error, right? </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">DenseNumbering.fromArray</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">BEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Hashable</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">elts</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DenseNumbering</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Std.HashMap.ofList</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">elts.mapIdx</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">i.val</span><span class=\"o\">)))</span><span class=\"bp\">.</span><span class=\"n\">toList</span>\n<span class=\"w\">  </span><span class=\"o\">⟨</span><span class=\"n\">elts</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"o\">⟩</span>\n</code></pre></div>",
        "id": 480809592,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730845469
    },
    {
        "content": "<p>Change <code>i.val</code> to <code>i</code></p>",
        "id": 480809638,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730845503
    },
    {
        "content": "<p>But that will introduce an error in the last <code>index</code>.</p>",
        "id": 480809707,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730845535
    },
    {
        "content": "<p>If you hover the mouse over <code>elts.mapIdx</code> you will see that it's type signature has changed</p>",
        "id": 480809713,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730845542
    },
    {
        "content": "<p>It won't. I am guessing they changed it to use get_elem_tactic automatically</p>",
        "id": 480809798,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730845575
    },
    {
        "content": "<p>Indeed: </p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">application type mismatch</span>\n<span class=\"go\">  { in_order := elts, index := index }</span>\n<span class=\"go\">argument</span>\n<span class=\"go\">  index</span>\n<span class=\"go\">has type</span>\n<span class=\"go\">  Std.HashMap α (Fin elts.size) : Type</span>\n<span class=\"go\">but is expected to have type</span>\n<span class=\"go\">  Std.HashMap α ℕ : Type</span>\n</code></pre></div>",
        "id": 480809829,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730845605
    },
    {
        "content": "<p>Btw, I am quite sure that's the only difference. I didn't make a PR, but I got as far as running the script successfully</p>",
        "id": 480809992,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730845693
    },
    {
        "content": "<p>Maybe consider pushing directly to <a href=\"https://github.com/teorth/equational_theories/pull/793\">equational#793</a></p>",
        "id": 480810131,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730845796
    },
    {
        "content": "<p>Sure</p>",
        "id": 480810194,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730845811
    },
    {
        "content": "<p>Please run <code>run_before_push.sh</code> before pushing to the <code>fix-bump</code> branch.</p>",
        "id": 480810507,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730846030
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 480811380,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730846525
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/458659-Equational/topic/Mathlib.20Bump/near/480810194\">said</a>:</p>\n<blockquote>\n<p>Sure</p>\n</blockquote>\n<p>Fixed.</p>",
        "id": 480812605,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730847305
    },
    {
        "content": "<p>There is an even bigger issue</p>",
        "id": 480812844,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730847446
    },
    {
        "content": "<p>The closure file is not imported in <code>equational_theories.lean</code></p>",
        "id": 480812864,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730847462
    },
    {
        "content": "<p>This is why it doesn't show up in the build</p>",
        "id": 480812873,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730847468
    },
    {
        "content": "<p>Anyway. Some fixes landing in a few minutes</p>",
        "id": 480812892,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730847477
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span>  : Why is lean4checker so much faster than lean4lean?</p>",
        "id": 480816224,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730849634
    },
    {
        "content": "<p>last time I benchmarked it it was about a 20-30% slowdown</p>",
        "id": 480816291,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730849661
    },
    {
        "content": "<p><a href=\"https://github.com/teorth/equational_theories/actions/runs/11693290732/job/32564528425\">https://github.com/teorth/equational_theories/actions/runs/11693290732/job/32564528425</a></p>",
        "id": 480816311,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730849684
    },
    {
        "content": "<p>lean4checker ~9 minutes and lean4lean ~15:30 minutes</p>",
        "id": 480816369,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730849717
    },
    {
        "content": "<p>you did run it in verbose mode...</p>",
        "id": 480816406,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730849748
    },
    {
        "content": "<p>oh yeah that's fair.</p>",
        "id": 480816482,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730849779
    },
    {
        "content": "<p>You can also run it in <code>--compare</code> mode, in which case any time lean4lean is more than 2x slower to check a definition compared to lean4checker (and also more than 1 second to check) it will print it out</p>",
        "id": 480816493,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730849791
    },
    {
        "content": "<p>(this makes it even slower though, since it has to run both checkers)</p>",
        "id": 480816551,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730849839
    },
    {
        "content": "<p>Merged <a href=\"https://github.com/teorth/equational_theories/pull/793\">equational#793</a> bumping to <code>v4.14.0-rc1</code></p>",
        "id": 480820133,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730852155
    },
    {
        "content": "<p>Merged <a href=\"https://github.com/teorth/equational_theories/pull/798\">equational#798</a> bumping to <code>v4.14.0-rc2</code></p>",
        "id": 481023275,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730939476
    },
    {
        "content": "<p>Can we please not update to every rc release?</p>",
        "id": 481023303,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730939502
    },
    {
        "content": "<p>Maybe we need to change the update frequency in the CI?</p>",
        "id": 481023369,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730939525
    },
    {
        "content": "<p>We can point the mathlib dependency ref to the stable branch to ensure this</p>",
        "id": 481023428,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730939576
    },
    {
        "content": "<p>Maybe we should keep the same <code>update-dependencies</code> schedule, but effectively update only when it fails and automatically opens an issue.</p>",
        "id": 481023726,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730939771
    },
    {
        "content": "<p>What does it mean to effectively update? There wouldn't be any extra failures unless we update</p>",
        "id": 481023797,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730939821
    },
    {
        "content": "<p>By \"effectively update\" I mean: </p>\n<ol>\n<li>Noticing the \"failure issue\"</li>\n<li>Bumping manually</li>\n<li>Fixing what needs to be fixed manually</li>\n<li>Pushing or opening the related PR</li>\n</ol>",
        "id": 481023966,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730939918
    },
    {
        "content": "<p>I am proposing that we don't update at all and avoid the issues until the once a month stable release. The whole point is to not fix breakages every week</p>",
        "id": 481024038,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730939964
    },
    {
        "content": "<p>I sincerely believe that the average bumping pain after a week is high enough to justify such a frequency. </p>\n<p>The more we wait, the higher and potentially more intricate will be the necessary fixes.</p>",
        "id": 481024184,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730940029
    },
    {
        "content": "<p>That's not necessarily true. It is easier to fix breakages that updates introduce in one go.</p>",
        "id": 481024312,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730940107
    },
    {
        "content": "<p>Also rc changes sometimes introduce regressions and bugs that get fixed in stable releases</p>",
        "id": 481024411,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730940148
    },
    {
        "content": "<p>It's not necessarily true, but very likely (in my humble experience).</p>",
        "id": 481024440,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730940164
    },
    {
        "content": "<p>I would prefer updating to stable releases overall. I have found it less painful</p>",
        "id": 481024496,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730940199
    },
    {
        "content": "<p>Ok ok, let me change the schedule then.</p>",
        "id": 481024537,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730940230
    },
    {
        "content": "<p>What's the schedule of stable releases?</p>",
        "id": 481024697,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730940314
    },
    {
        "content": "<p>Approximately once a month</p>",
        "id": 481024925,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730940434
    },
    {
        "content": "<p>If we pin mathlib's dependency in lakefile.lean to stable then the updates automatically happen from stable toolchain to stable toolchain</p>",
        "id": 481024953,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730940467
    },
    {
        "content": "<p>There was some talk of changing this but I don't think it materialised yet</p>",
        "id": 481025048,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730940502
    },
    {
        "content": "<p>Opened PR <a href=\"https://github.com/teorth/equational_theories/pull/800\">equational#800</a>. </p>\n<p>It will run on the first day of each month.</p>",
        "id": 481025073,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730940526
    },
    {
        "content": "<p>Let's also pin the dependency branch to stable</p>",
        "id": 481025233,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730940638
    },
    {
        "content": "<p>This way we skip the RCs</p>",
        "id": 481025246,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730940648
    },
    {
        "content": "<p>Do you mean like this?</p>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"k\">[[require]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"mathlib\"</span>\n<span class=\"n\">git</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/leanprover-community/mathlib4.git\"</span>\n<span class=\"n\">rev</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"stable\"</span>\n</code></pre></div>",
        "id": 481025682,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730940940
    },
    {
        "content": "<p>Yes</p>",
        "id": 481025699,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730940955
    },
    {
        "content": "<p>Done. Feel free to merge.</p>",
        "id": 481025810,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730941004
    },
    {
        "content": "<p>Do keep in mind that this will result in downgrade to 4.13.0</p>",
        "id": 481025821,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730941010
    },
    {
        "content": "<p>But and that we will have to change <code>i</code> to <code>i.val</code> again in Closure.lean</p>",
        "id": 481025875,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730941043
    },
    {
        "content": "<p>Maybe it's better to do this from <code>4.14.0</code> onward</p>",
        "id": 481026211,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730941253
    },
    {
        "content": "<p>I'd prefer to go ahead with it now. We don't know how many RCs will be made before 4.14.0 lands and how many times we have to put out fires</p>",
        "id": 481026328,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730941323
    },
    {
        "content": "<p>I'm going to merge <a href=\"https://github.com/teorth/equational_theories/pull/800\">equational#800</a> without the <code>rev = \"stable\"</code> for now and go to bed. I'll take a look at it tomorrow (later).</p>",
        "id": 481026538,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730941462
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"556875\">Pietro Monticone</span> <a href=\"#narrow/stream/458659-Equational/topic/Mathlib.20Bump/near/481025073\">said</a>:</p>\n<blockquote>\n<p>Opened PR <a href=\"https://github.com/teorth/equational_theories/pull/800\">equational#800</a>. </p>\n<p>It will run on the first day of each month.</p>\n</blockquote>\n<p>Maybe the 5th is a bit safer. The release might not happen on the 1st, eg if the month starts with a weekend...</p>",
        "id": 481039256,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1730951242
    },
    {
        "content": "<p>probably the 15th is best if you want to avoid edge effects</p>",
        "id": 481039350,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730951319
    },
    {
        "content": "<p>There's a big advantage to bumping downstream projects to both stable and release candidate tags of Mathlib, not just the stable tags!</p>\n<p>If you go from e.g. <code>v4.13.0</code> to <code>v4.14.0</code> in one go, then you have to deal with both how Mathlib changed over a month, and how Lean changed over that month in one go.</p>\n<p>If you go from <code>v4.13.0</code> to <code>v4.14.0-rc1</code> and then to <code>v4.14.0</code>, then in the first step you <em>just</em> see the changes to the Lean (and how Mathlib had to change to cope) --- because typically these tags are only a day or two apart in time --- and in the second step you <em>just</em> see how Mathlib evolved over a month with the language held fixed.</p>",
        "id": 481044825,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1730955124
    },
    {
        "content": "<p>The decision as to which one is better for a given project depends on how tightly coupled with Mathlib / evolving language features it is. But in the highly coupled case, I recommend bumping via the release candidates for a more digestible experience. :-)</p>",
        "id": 481044860,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1730955172
    },
    {
        "content": "<p>Sure, but I think this project is not necessarily benefiting from keeping up with the latest and greatest mathlib RC release</p>",
        "id": 481060911,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730965370
    },
    {
        "content": "<p>It is only piling up weekly maintenance issues. The cost-benefit ratio is definitely much greater than 1</p>",
        "id": 481060965,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730965403
    },
    {
        "content": "<p>In other words, there is some coupling with Lean's core and a bit of batteries and a little bit of Mathlib, but not much</p>",
        "id": 481061088,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730965466
    },
    {
        "content": "<p>Thanks for your comments and recommendations! A good compromise could be to set a frequency of 2 weeks or something.</p>",
        "id": 481061126,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730965491
    },
    {
        "content": "<p>Amd pin to stable please</p>",
        "id": 481061151,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730965504
    },
    {
        "content": "<p>Fine, I’ll do it later. Let me just stress once again that I don’t think it is a great choice <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 481061465,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730965680
    },
    {
        "content": "<p>I take responsibility for the once in a month patching</p>",
        "id": 481061786,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730965853
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/458659-Equational/topic/Mathlib.20Bump/near/481025875\">said</a>:</p>\n<blockquote>\n<p>But and that we will have to change <code>i</code> to <code>i.val</code> again in Closure.lean</p>\n</blockquote>\n<p>There would be much more to change than that. Unfortunately I have no time at the moment to revert everything.</p>",
        "id": 481065793,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730967561
    },
    {
        "content": "<p>I'll do that in the evening then</p>",
        "id": 481065951,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730967611
    },
    {
        "content": "<p>Changed the workflow so that it runs 15th day of each month.</p>",
        "id": 481065993,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730967628
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/458659-Equational/topic/Mathlib.20Bump/near/481065951\">said</a>:</p>\n<blockquote>\n<p>I'll do that in the evening then</p>\n</blockquote>\n<p>Thanks a lot.</p>",
        "id": 481066015,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730967640
    },
    {
        "content": "<p>You can run your project how you like, but as an independent observer it seems crazy to undo a bunch of changes for a pretty flimsy reason (\"we need to move to stable now rather than next month and in particular we need to move backwards, despite having been on non-stable for the entireity of the project so far\") when you know you'll have to redo them later.</p>",
        "id": 481077908,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1730971944
    },
    {
        "content": "<p>I know it sounds like that, but the cost is offset by the number of times we will have to deal with breakages this month. We have already had to deal with it twice and we are just on RC 1 of v4.14</p>",
        "id": 481078910,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730972298
    },
    {
        "content": "<p>I know it sounds like that, but the cost is offset by the number of times we will have to deal with breakages this month. We have already had to deal with it twice and we are just on RC 1 of v4.14</p>",
        "id": 481079113,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730972385
    },
    {
        "content": "<p>This way, I am almost certain that the next time I deal with this issue will be on Dec 15</p>",
        "id": 481079247,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730972420
    },
    {
        "content": "<p>I'm just observing that explicitly going backwards sounds nuts. Why not just stay on whatever you're on right now and then go forwards to the next stable?</p>",
        "id": 481080128,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1730972752
    },
    {
        "content": "<p>Because staying on it means going through each RC release</p>",
        "id": 481080413,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730972833
    },
    {
        "content": "<p>What I'm implicitly worried about is that on Dec 15th you'll discover how much work is involved trying to move forwards by a long way all in one go, and give up, thus putting the project in a worse state. Have you seen how much work it is keeping mathlib up to date? I know this project is smaller but I'm concerned that you're just saying \"I will take this job on\" without really understanding what it entails.</p>",
        "id": 481080468,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1730972855
    },
    {
        "content": "<p>Although one workaround is to turn off auto update until 15 and pin to stable on a closer date</p>",
        "id": 481080647,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730972903
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/458659-Equational/topic/Mathlib.20Bump/near/481080413\">said</a>:</p>\n<blockquote>\n<p>Because staying on it means going through each RC release</p>\n</blockquote>\n<p>I'm suggesting that the next bump you do is not to rc37 but forwards to the next stable. I'm not suggesting you keep up with all the rcs. This way you'll have to do less work, but even this smaller amount of work might be a surprisingly large amount of work.</p>",
        "id": 481080759,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1730972948
    },
    {
        "content": "<p>I think the trade off is we are fixing breakages once or twice a week at times and at a schedule dictated by RC releases</p>",
        "id": 481080761,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730972948
    },
    {
        "content": "<p>Okay that's a fair point. Let's stay on rc1</p>",
        "id": 481080850,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730972980
    },
    {
        "content": "<p>We’re are on RC2 already btw.</p>",
        "id": 481080934,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730973006
    },
    {
        "content": "<p>And turn off the update script. Then we pin to stable on Dec 14th</p>",
        "id": 481080955,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730973013
    },
    {
        "content": "<p>This sounds like a much better idea!</p>",
        "id": 481081003,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1730973026
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"556875\">Pietro Monticone</span> <a href=\"#narrow/stream/458659-Equational/topic/Mathlib.20Bump/near/481080934\">said</a>:</p>\n<blockquote>\n<p>We’re are on RC2 already btw.</p>\n</blockquote>\n<p>Ah so three fixes in the last week alone</p>",
        "id": 481081009,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730973028
    },
    {
        "content": "<p>Although rc2 was less effort</p>",
        "id": 481081045,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730973046
    },
    {
        "content": "<p>No, for RC2 no fixes were required. That’s the point.</p>",
        "id": 481081072,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730973055
    },
    {
        "content": "<p>I prefer to have much more control over small, temporally distributed fixes…</p>",
        "id": 481081193,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730973100
    },
    {
        "content": "<p>That's good. But last week's update issues hit us back to back</p>",
        "id": 481081423,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730973170
    },
    {
        "content": "<p>I want to avoid that and prefer a more predictable breakage schedule</p>",
        "id": 481081714,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730973256
    },
    {
        "content": "<p>Not really, just a few import issues, a few deprecated lemmas, a few signature changes.</p>",
        "id": 481081742,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730973270
    },
    {
        "content": "<p>For this project, we won't be suffering like Mathlib. Mostly our issues will be tactic changes, stuff moving to core, and api changes</p>",
        "id": 481081907,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730973327
    },
    {
        "content": "<p>So the total work we do for updates will be more or less the same.</p>",
        "id": 481082069,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730973377
    },
    {
        "content": "<p>I am just bunching up the changes to a more predictable schedule</p>",
        "id": 481082109,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730973390
    },
    {
        "content": "<p>Ofc this means that once a month, I spend half a day making fixes</p>",
        "id": 481082196,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730973419
    },
    {
        "content": "<p>I don’t know how anyone can confidently predict that, honestly.</p>",
        "id": 481082224,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730973427
    },
    {
        "content": "<p>One can't. One can look at past experience and extrapolate</p>",
        "id": 481082315,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730973459
    },
    {
        "content": "<p>If I do that, I arrive at the opposite conclusion <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span>. I think I’m not completely miscalibrated having managed all the updates in the project so far…</p>",
        "id": 481083015,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730973638
    },
    {
        "content": "<p>I really tend to prefer avoiding the surprises we could get after a month.</p>",
        "id": 481083368,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730973725
    },
    {
        "content": "<p>Maybe we can vote on this</p>",
        "id": 481083595,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730973799
    },
    {
        "content": "<p>I'll leave it to you then. But in my experience, working simultaneously on 4 projects, I was spending an awful lot of time fixing update breakages than actually adding content. Since I started keeping them on stable, things have gotten much better</p>",
        "id": 481083823,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730973878
    },
    {
        "content": "<p>And what's worse is there is no pattern to the release time of these RCs. They strike like lightning <span aria-label=\"high voltage\" class=\"emoji emoji-26a1\" role=\"img\" title=\"high voltage\">:high_voltage:</span></p>",
        "id": 481084193,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730974011
    },
    {
        "content": "<p>This is fine for the purpose they serve, but not ideal for working efficiently on projects and keeping them reasonably up to date</p>",
        "id": 481084435,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730974083
    },
    {
        "content": "<p>Since we’re going to upstream more things to Mathlib soon, we will need to bump it in order to use it and remove the local version. </p>\n<p>Moreover, while proving we want to LeanSearch the latest version of Mathlib in order to avoid duplicates, etc.</p>",
        "id": 481084950,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730974253
    },
    {
        "content": "<p>How frequently is LeanSearch's model retrained?</p>",
        "id": 481085454,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730974425
    },
    {
        "content": "<p>Presumably not once a week?</p>",
        "id": 481085501,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730974441
    },
    {
        "content": "<p>If that's the case then what is gained w.r.t leansearch by updating more frequently?</p>",
        "id": 481085789,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730974533
    },
    {
        "content": "<p>I mentioned LeanSearch, but of course the same would be the case for Docs, Loogle, etc. </p>\n<p>We don’t want to duplicate work and if a useful lemma has been added to Mathlib, we want to be able to use it. </p>\n<p>When we upstream something to Mathlib we want to be able to import it and remove the local version quickly.</p>",
        "id": 481086412,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730974718
    },
    {
        "content": "<p>I think the benefits of high-frequency (&lt; 1 week) updates outweigh the costs</p>",
        "id": 481086586,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730974777
    },
    {
        "content": "<p>Imho upstreaming should happen when a project is near completion and mostly stable</p>",
        "id": 481086599,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730974782
    },
    {
        "content": "<p>At least in CS venues, the code contributions are usually part of the artefact, so it you upstream and import them, they dont get evaluated</p>",
        "id": 481086765,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730974842
    },
    {
        "content": "<p>If the declarations we want to upstream are sufficiently self-contained, there is no reason to wait. </p>\n<p>It happens very often with small lemmas which are missing in Mathlib.</p>",
        "id": 481086787,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730974853
    },
    {
        "content": "<p>This is ofc subject to some level of interpretation across venues</p>",
        "id": 481086798,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730974857
    },
    {
        "content": "<p>About what the core contribution is</p>",
        "id": 481086840,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730974872
    },
    {
        "content": "<p>When we upstream we keep track of the project origin.</p>",
        "id": 481086868,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730974884
    },
    {
        "content": "<p>Sure, but the upstreamed code isn't part of the artefact submission</p>",
        "id": 481086927,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730974911
    },
    {
        "content": "<p>Should we care about that in our case?</p>",
        "id": 481087070,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730974956
    },
    {
        "content": "<p>Again, this is beside the point. It you are happy to deal with RC breakages, I am fine. Last week we were fixing problems on two days past midnight</p>",
        "id": 481087091,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730974961
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/stream/458659-Equational/topic/Mathlib.20Bump/near/481086927\">said</a>:</p>\n<blockquote>\n<p>Sure, but the upstreamed code isn't part of the artefact submission</p>\n</blockquote>\n<p>Imho yes. It's about ensuring correct academic attribution of the code.</p>",
        "id": 481087325,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730975033
    },
    {
        "content": "<p>Ok, I would keep it high-frequency for this month. Let’s see…</p>",
        "id": 481087650,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1730975112
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/458659-Equational/topic/Mathlib.20Bump/near/481084193\">said</a>:</p>\n<blockquote>\n<p>And what's worse is there is no pattern to the release time of these RCs. They strike like lightning <span aria-label=\"high voltage\" class=\"emoji emoji-26a1\" role=\"img\" title=\"high voltage\">:high_voltage:</span></p>\n</blockquote>\n<p>Keep in mind that RC releases (past rc1) are usually because we discovered some really important regression and patched it, so it might be a good idea to upgrade as soon as possible depending on what the bug is. (e.g. that one time when lake would delete your project...)</p>",
        "id": 481157585,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730997149
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/458659-Equational/topic/Mathlib.20Bump/near/481157585\">said</a>:</p>\n<blockquote>\n<p>(e.g. that one time when lake would delete your project...)</p>\n</blockquote>\n<p>Will this enter the mythodology of the lean community, similar to that old GHC bug where <a href=\"https://gitlab.haskell.org/ghc/ghc/-/issues/163\">it would delete source files it found type-incorrect</a>?</p>",
        "id": 481157823,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1730997228
    },
    {
        "content": "<p>wait that was a bug and not an easter egg?</p>",
        "id": 481157909,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730997244
    },
    {
        "content": "<p>That was from way before my time, but the hearsay that I got always referred to it as a bug</p>",
        "id": 481158081,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1730997304
    },
    {
        "content": "<p>This I know. But these are usually buggy features for the next release. that is why I said they serve their purpose well. But it is also why migrating through RCs is not super useful always</p>",
        "id": 481158248,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730997362
    },
    {
        "content": "<p>While migrating between stable versions may not necessarily be the easiest thing, I think the combined expected effort of working through the corresponding RC releases would be higher than just one bump to stabke</p>",
        "id": 481158476,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730997438
    },
    {
        "content": "<p>After all it isn't like fresh new features are being introduced in each RC of a release as a matter of principle (might be different in practice)</p>",
        "id": 481158604,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730997483
    },
    {
        "content": "<p>In fact that 4.1 RC bug is one reason I initially started avoiding them as much as possible</p>",
        "id": 481158790,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1730997536
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/458659-Equational/topic/Mathlib.20Bump/near/481086599\">said</a>:</p>\n<blockquote>\n<p>Imho upstreaming should happen when a project is near completion and mostly stable</p>\n</blockquote>\n<p>This is a recipe for disaster. Please please do not do this.</p>",
        "id": 481205301,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731016011
    },
    {
        "content": "<p>Why? Isn't this usual? The bits and pieces that get upstreamed will have to be adapted for mathlib, which is extra work. Instead by putting off upstreaming we can save work and continue to use convenient definitions and theorems</p>",
        "id": 481206005,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731016334
    },
    {
        "content": "<p>In fact, iirc, the project on godel's first incompleteness theorem  as well as the one on flow matrices was already done before they started upstreaming PRs.</p>",
        "id": 481206611,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731016658
    },
    {
        "content": "<p>From experience the issue is mainly that if you put off upstreaming until the end of the project, it will never actually happen. When the project ends, the interest of the participants decreases a lot, and moving things to Mathlib is not nearly as fun as doing new, other things. Also you'll have accrued a lot of stuff that will need constant adaptations during the move, and upstreaming will be a huge task.<br>\nCombine a huge task and participants that are not very interested anymore, and you get a project that forever stays in its own repository.</p>",
        "id": 481206768,
        "sender_full_name": "Rémy Degenne",
        "timestamp": 1731016739
    },
    {
        "content": "<p>Fwiw the upstreaming PRs are already being worked on. In this case we went ahead with our own definition of free magmas so every upstreaming PR is already starting on a big disadvantage. </p>\n<p>Further I am thinking about this from the project's perspective. I know that CPP and ITP follow single blind reviewing so pointing to upstream content in your papers is not a big deal, but in strongly double blinded venues pointing to publicly hosted code with commit history and authorship headers will be a problem</p>",
        "id": 481207246,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731016958
    },
    {
        "content": "<p>I'm sorry, Shreyas, I'm not interested in arguing with you on this one, I'm just going to leave my advice as above.</p>",
        "id": 481209537,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731018262
    },
    {
        "content": "<p>I'm interested to know what you mean by \"recipe for disaster\" though; did you mean worse consequences than what <span class=\"user-mention silent\" data-user-id=\"350992\">Rémy Degenne</span> outlined?</p>",
        "id": 481209762,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1731018385
    },
    {
        "content": "<p>I wouldn't exactly classify that as a disaster, if you are not particularly motivated to get things in mathlib in the first place</p>",
        "id": 481209845,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1731018434
    },
    {
        "content": "<p>Sorry, nothing more than what Remy says.</p>",
        "id": 481210283,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731018641
    },
    {
        "content": "<p>I brought up that freemagma point because freely importing Mathlib is already not an option. No one has taken up the namespacing task I posted one or two weeks ago. So the project cannot necessarily easily import something that is upstreamed. The coupling with Mathlib is looser with this project than usual. Of course this shouldn't stop interested contributors from upstreaming stuff but most of that stuff is not likely to feed back into the project (ignoring the anonymity concerns above for the sake of discussion)</p>",
        "id": 481211758,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731019538
    },
    {
        "content": "<p>So there is bound to be some divergence between what mathlib eventually gets and what the project uses anyway. And then there is the time the PR will spend on the queue. This alone will mean that the people making upstreaming PRs will have to stay motivated for a while and make changes as lean and mathlib get updates and as reviews come in.</p>",
        "id": 481211930,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731019642
    },
    {
        "content": "<p>(Since this is the closest thing to a \"lean4checker thread\") in <a href=\"https://github.com/teorth/equational_theories/pull/829\">equational#829</a> I wanted to use native_decide, not because it was faster than decide (decide would be fast enough) but because there's a bad decidability instance <code>Multiset.decidableForallMultiset</code>. Of course ultimately it would be good to fix all the bad decidability instances in Mathlib ( <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span> ) but in the meantime, lean4checker means that it won't build. Is there anyway around this in the medium term?</p>",
        "id": 482271011,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1731535883
    },
    {
        "content": "<p>the conclusion above was that lean4checker and lean4lean both need substantial modification to allow native_decide</p>",
        "id": 482271173,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731535952
    },
    {
        "content": "<p>Is there some attribute I can put on the relevant theorem, <code>all_Magma_Fin2</code>, to tell lean4checker to skip it? Like could I marking <code>unsafe</code> to get it skipped? Nothing else is depending on it.</p>",
        "id": 482271304,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1731536029
    },
    {
        "content": "<p>(That was a hypothetical - I know that there's no such thing as <code>unsafe theorem</code> - but I'm asking for something analogous)</p>",
        "id": 482271460,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1731536085
    },
    {
        "content": "<p>I don't know for certain, but I am going to make a guess that there isn't because the whole purpose of lean4checker is to disallow false environment manipulations.</p>",
        "id": 482271579,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731536148
    },
    {
        "content": "<p>And removing a theorem from being checked appears to be basically just that. It is another matter that there is no downstream uses of it.</p>",
        "id": 482271710,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731536201
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"448405\">Alex Meiburg</span> <a href=\"#narrow/channel/458659-Equational/topic/Mathlib.20Bump/near/482271304\">said</a>:</p>\n<blockquote>\n<p>Is there some attribute I can put on the relevant theorem, <code>all_Magma_Fin2</code>, to tell lean4checker to skip it? Like could I marking <code>unsafe</code> to get it skipped? Nothing else is depending on it.</p>\n</blockquote>\n<p>axiom</p>",
        "id": 482273237,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731536985
    },
    {
        "content": "<p>Doesn't the blueprint CI include a check for axioms?</p>",
        "id": 482273341,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731537019
    },
    {
        "content": "<p>Perhaps, but you could whitelist them one at a time</p>",
        "id": 482273645,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731537153
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">two_plus_two</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">4</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">type_of</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">two_plus_two</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">native_decide</span>\n</code></pre></div>\n<p>seems like a safe enough way to handle it</p>",
        "id": 482273667,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731537164
    },
    {
        "content": "<p>Which I assume succeeds in hiding <code>native_decide</code> from <code>lean_checker</code></p>",
        "id": 482273725,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731537196
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"448405\">Alex Meiburg</span> <a href=\"#narrow/channel/458659-Equational/topic/Mathlib.20Bump/near/482271011\">said</a>:</p>\n<blockquote>\n<p>but because there's a bad decidability instance <code>Multiset.decidableForallMultiset</code></p>\n</blockquote>\n<p>Is there a thread or issue about this?</p>",
        "id": 482273771,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731537224
    },
    {
        "content": "<p>If this is not a hurry, and Mathlib will ship a new instance in a reasonable time frame, I would prefer to wait for it</p>",
        "id": 482273888,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731537279
    },
    {
        "content": "<p>Also the linkifier is just <a href=\"https://github.com/teorth/equational_theories/pull/761\">equational#761</a></p>",
        "id": 482273981,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731537327
    },
    {
        "content": "<p>Changing it from <code>theorem</code> to <code>unsafe def</code> makes lean check the correctness of the proof and lean4checker OKs it, so that's what I'll do for now. But I guess that leaves the separate question if it's okay to merge like that? Thoughts?</p>",
        "id": 482274411,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1731537552
    },
    {
        "content": "<p>I'd rather wait. In this particular instance it is fine insofar as no downstream theorem is using it. But this is about setting a precedent that can become unmanageable at scale.</p>",
        "id": 482274662,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731537696
    },
    {
        "content": "<p>But yeah do ping as soon as the mathlib change is ready and available and you can circumvent native_decide</p>",
        "id": 482274756,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731537730
    },
    {
        "content": "<p>Your point about waiting because it would be unmanageable at scale makes sense -- but I see that <span class=\"user-mention\" data-user-id=\"657719\">@Terence Tao</span> just merged it actually, heh - maybe I should have marked as draft. Well, maybe we'll leave it merged, but yes it makes sense to avoid this as a pattern en large.</p>",
        "id": 482275052,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1731537893
    },
    {
        "content": "<p>I mean I'll defer to the maintainers</p>",
        "id": 482275236,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1731537966
    },
    {
        "content": "<p>I do think a build should flag <code>unsafe def</code>s that are <code>Prop</code>s, to manage the scale issue</p>",
        "id": 482275408,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731538053
    },
    {
        "content": "<p>I think it's fine to have some less important side results that are explicitly marked as not subject to leanchecker so long as there is some way to still collect and flag them for future resolution. Though I agree that we don't want to start making a flood of such exemptions.</p>",
        "id": 482275572,
        "sender_full_name": "Terence Tao",
        "timestamp": 1731538113
    },
    {
        "content": "<p>Unfortunately I don't think there is any well known way to have lean flag this one later</p>",
        "id": 482275657,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731538160
    },
    {
        "content": "<p>That's why I am hesitant about this PR</p>",
        "id": 482275681,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731538171
    },
    {
        "content": "<p>We could open a low-priority issue to resolve it?</p>",
        "id": 482275708,
        "sender_full_name": "Terence Tao",
        "timestamp": 1731538188
    },
    {
        "content": "<p>I am not confident that we will remember to address it when the necessary mathlib changes arrive. Maybe we could use the roadmap feature of the project dashboard to remind us about this</p>",
        "id": 482275851,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731538242
    },
    {
        "content": "<p>Is there some command like <code>#lint \"This should be a theorem\"</code> to just issue a lint warning 'manually' at build time?</p>",
        "id": 482276104,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1731538356
    },
    {
        "content": "<p><a href=\"https://github.com/marketplace/actions/issue-duedate-reminder\">https://github.com/marketplace/actions/issue-duedate-reminder</a></p>",
        "id": 482276175,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731538389
    },
    {
        "content": "<p>We could use that action to remind us to check this low priority issue</p>",
        "id": 482276245,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731538427
    },
    {
        "content": "<p>OK.  So we open an issue and also set some reminder to bring it up again on the Zulip after some fixed time or something?</p>",
        "id": 482276570,
        "sender_full_name": "Terence Tao",
        "timestamp": 1731538568
    },
    {
        "content": "<p>As one other option: if we set the proof to be <code>first | decide | native_decide</code>, then it will switch to using \"decide\" whenever that compiles. There might be a linter option to detect <code>unsafe</code> defs that don't need to be unsafe, which would then fire</p>",
        "id": 482276729,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1731538647
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"657719\">Terence Tao</span> <a href=\"#narrow/channel/458659-Equational/topic/Mathlib.20Bump/near/482276570\">said</a>:</p>\n<blockquote>\n<p>OK.  So we open an issue and also set some reminder to bring it up again on the Zulip after some fixed time or something?</p>\n</blockquote>\n<p>Sounds like a viable idea</p>",
        "id": 482295496,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731549807
    },
    {
        "content": "<p>Opened <a href=\"https://github.com/teorth/equational_theories/pull/834\">equational#834</a> for this.</p>",
        "id": 482296959,
        "sender_full_name": "Terence Tao",
        "timestamp": 1731550854
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"448405\">Alex Meiburg</span> <a href=\"#narrow/channel/458659-Equational/topic/Mathlib.20Bump/near/482271011\">said</a>:</p>\n<blockquote>\n<p>but because there's a bad decidability instance <code>Multiset.decidableForallMultiset</code></p>\n</blockquote>\n<p>You can fix this yourself you know, just make an instance which overrides the original</p>",
        "id": 482320299,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1731567180
    },
    {
        "content": "<p>my inclination would be to put in workarounds to get it to compute with <code>decide</code> and avoid the mess that <code>native_decide</code> implicates</p>",
        "id": 482320444,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1731567257
    },
    {
        "content": "<p>and then pursue a mathlib PR to remove the workarounds</p>",
        "id": 482320462,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1731567272
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"448405\">@Alex Meiburg</span> : Could you make a PR like this please</p>",
        "id": 482348880,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731577731
    },
    {
        "content": "<p>Good point Mario, this genuinely hadn't occurred to me as a possibility <span aria-label=\"man facepalming\" class=\"emoji emoji-1f926-200d-2642\" role=\"img\" title=\"man facepalming\">:man_facepalming:</span> Will do!</p>",
        "id": 482395613,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1731592110
    },
    {
        "content": "<p>Okay, I've been staring at this for an hour and I don't see any way to do it. (Since this isn't specific to Equational in any way, I'll start a thread in a different channel and then link here)</p>\n<p>Link: <a href=\"#narrow/channel/287929-mathlib4/topic/Fixing.20bad.20Decidable.20instances.20for.20quotient.20types/near/482430599\">https://leanprover.zulipchat.com/#narrow/channel/287929-mathlib4/topic/Fixing.20bad.20Decidable.20instances.20for.20quotient.20types/near/482430599</a></p>",
        "id": 482424615,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1731599516
    },
    {
        "content": "<p>Alright, I'm embarrassed, turns out the issue was actually with my own instance, not mathlib's, so it was an easy fix. Should be fixed with <a href=\"https://github.com/teorth/equational_theories/pull/836\">equational#836</a>. I guess I am not as capable of understanding <code>decide</code>'s error logs as I thought I was.</p>",
        "id": 482448141,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1731606090
    },
    {
        "content": "<p>The <code>update-dependencies</code> workflow raised an issue (<a href=\"https://github.com/teorth/equational_theories/pull/840\">equational#840</a>). </p>\n<p>Opened <a href=\"https://github.com/teorth/equational_theories/pull/847\">equational#847</a> to fix it.</p>",
        "id": 483036301,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1731940039
    },
    {
        "content": "<p>Upstream import changes?</p>",
        "id": 483038657,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731940623
    },
    {
        "content": "<p>I was debugging what turned out to be a trivial import issue from this mathlib bump, though it took me a while to figure it out. What is the usual way of debugging an issue like this? I thought about just using an 'import Mathlib' to see if I'm missing some obvious import (or if it's a deeper issue), but our instance of FreeMagmas conflict so that approach didn't work.</p>",
        "id": 483111473,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1731959880
    },
    {
        "content": "<p>Usually search the \"unknown id\" on the loogle extension or mathlib docs</p>",
        "id": 483111987,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731960041
    },
    {
        "content": "<p>So in this case the specific error was that I was failing to synthesize a [Finite G-&gt;G] when I had a [Finite G], and that seems hard to search for? Is there a trick there?</p>",
        "id": 483113178,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1731960434
    },
    {
        "content": "<p>I think there is a #synth or #synthInstance command</p>",
        "id": 483113298,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731960478
    },
    {
        "content": "<p>And then import Mathlib when you do it</p>",
        "id": 483113454,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731960505
    },
    {
        "content": "<p>Even if you get other errors, you will get the instance you are looking for and you can ctrl Click and find it</p>",
        "id": 483113494,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731960524
    },
    {
        "content": "<p>I haven't used this command ever, so I would recommend looking around on this zulip for examples of correct usage</p>",
        "id": 483113624,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1731960575
    },
    {
        "content": "<p>Thanks, I got that to work with some prodding and found the instance I think I needed though I'm still confused by what it actually does.</p>",
        "id": 483115140,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1731961111
    },
    {
        "content": "<p>Yep, bumping on a weekly basis is definitely nicer <span aria-label=\"wink\" class=\"emoji emoji-1f609\" role=\"img\" title=\"wink\">:wink:</span> (<a href=\"https://github.com/teorth/equational_theories/pull/1237\">equational#1237</a>).</p>",
        "id": 520298458,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1748184393
    }
]