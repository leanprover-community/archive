[
    {
        "content": "<p>I am undertaking the refactoring using equation command. One thing right off the bat is that docstring comments don't recognise the <code>equation</code> command as a valid declaration succeeding a docstring.</p>",
        "id": 474930942,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1728091296
    },
    {
        "content": "<p>Is there a quick fix for this?</p>",
        "id": 474931070,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1728091348
    },
    {
        "content": "<p>See PR <a href=\"https://github.com/teorth/equational_theories/pull/295\">equational#295</a></p>",
        "id": 474932468,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1728092315
    },
    {
        "content": "<p>Actually now that we fixed the conflict with the function composition operator, I would suggest to remove the <code>equation</code> command completely and go back to normal lean definitions.</p>",
        "id": 474932785,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1728092658
    },
    {
        "content": "<p>Given that the main motivation for the command was to work around the slow elaboration</p>",
        "id": 474932800,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1728092695
    },
    {
        "content": "<p><a href=\"https://github.com/teorth/equational_theories/issues/290\">https://github.com/teorth/equational_theories/issues/290</a><br>\nThe issue description says this is to collect these equations easily</p>",
        "id": 474932835,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1728092729
    },
    {
        "content": "<p>Although the command itself at present only creates abbrevs</p>",
        "id": 474932849,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1728092748
    },
    {
        "content": "<p>I guess that later the command can  be modified to add the equations to an external database automatically</p>",
        "id": 474932907,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1728092781
    },
    {
        "content": "<p>One reason I thought <code>equation</code> might still be useful is when we finally link up \"shallow\" <code>EquationX</code> propositions with \"deep\" <code>LawX</code> objects of type <code>MagmaLaw</code>, since one could use metaprogramming to define both automatically.  But I guess we could just autogenerate both lists once by some external script and not have any metaprogramming for this.  But it might also help with the hypothetical Equation&lt;-&gt;Law tactics in <a href=\"https://github.com/teorth/equational_theories/issues/147\">https://github.com/teorth/equational_theories/issues/147</a> .  These in turn could help implement duality within Lean, rather than through implicit implications.</p>",
        "id": 474932950,
        "sender_full_name": "Terence Tao",
        "timestamp": 1728092818
    },
    {
        "content": "<p>But perhaps there are better ways to establish all this.  In particular I have no experience with metaprogramming and tactic writing, so I don't know what is the most feasible path here.</p>",
        "id": 474933015,
        "sender_full_name": "Terence Tao",
        "timestamp": 1728092882
    },
    {
        "content": "<p>Sure, that might be useful (although maybe more naturally done as an attribute). I'm just a bit wary of (now) unnecessary extra layers of complexity. I think either path is reasonable, and it doesn't matter much either way</p>",
        "id": 474933151,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1728093008
    },
    {
        "content": "<p>I like the equation command. If only someone can help me make docstrings work with it</p>",
        "id": 474933183,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1728093045
    },
    {
        "content": "<p>One minor nice thing about the <code>equation</code> approach is (once the docstring issue is solved) that it becomes really easy to move an equation from <code>AllEquations.lean</code> to <code>Equations.lean</code>.  I guess if we instead spell out <code>EquationX</code> and <code>LawX</code> directly (with all attendant attributes, and API to convert back and forth) one just cut and pastes ten lines instead of one, so it's sort of the same, but I like the current elegant look of <code>AllEquations.lean</code></p>",
        "id": 474933312,
        "sender_full_name": "Terence Tao",
        "timestamp": 1728093165
    },
    {
        "content": "<p>That file is rather large and some renumbering will be needed to move its contents into Equations.lean</p>",
        "id": 474933483,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1728093331
    },
    {
        "content": "<p>I think it is best to leave that file as is</p>",
        "id": 474933495,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1728093342
    },
    {
        "content": "<p>I don't plan to move all 4694 equations into Equations.lean.  Only the ones for which we have specialized theorems about, which can be proved by just loading Equations.lean and not AllEquations.lean</p>",
        "id": 474933563,
        "sender_full_name": "Terence Tao",
        "timestamp": 1728093375
    },
    {
        "content": "<p>Okay I see what you mean now.</p>",
        "id": 474933655,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1728093465
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/stream/458659-Equational/topic/Refactoring.20with.20Equation.20Command/near/474933183\">said</a>:</p>\n<blockquote>\n<p>I like the equation command. If only someone can help me make docstrings work with it</p>\n</blockquote>\n<p>On the phone and sleepless in the bed right now, so can't hack on it, but maybe look at similar commands on mathlib, like <code>lemma</code>, and cargo cult. Probably just a matter of adding the right non-terminal to the syntax and including it in the final command splice</p>",
        "id": 474934029,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1728093794
    },
    {
        "content": "<p>lemma uses a macro and the others use <code>leading_parser</code></p>",
        "id": 474935341,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1728095085
    },
    {
        "content": "<p>I will look into this after getting a night's sleep. If someone wishes to try the file to modify is <code>equational_theories/EquationsCommand.lean</code></p>",
        "id": 474935367,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1728095118
    },
    {
        "content": "<p>This is done</p>",
        "id": 474986872,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1728139303
    },
    {
        "content": "<p>I upgraded the <code>equation</code> command to handle docstrings thanks to @Yury</p>",
        "id": 474986950,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1728139337
    }
]