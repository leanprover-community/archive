[
    {
        "content": "<p>Things are falling into place. With the <code>equations_result</code> attribute now existing, and added to the autogenerated files, including those that prove trivial implications, I can now prune the auto-generated counter-examples using that data, and it’s very effective:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Pruning</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">implication</span><span class=\"w\"> </span><span class=\"n\">removed</span><span class=\"w\"> </span><span class=\"mi\">476896</span><span class=\"w\"> </span><span class=\"n\">facts</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">check</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">down</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"mi\">511646</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">leaving</span><span class=\"w\"> </span><span class=\"mf\">34750.</span>\n</code></pre></div>\n<p>That’s down by 93%!</p>\n<p>(Assuming I didn’t make a mistake here, or got the implications wrong).</p>\n<p>So strongly suggest that everyone working on counter-examples prunes the generated lean files this way, to keep project  processing time down.</p>",
        "id": 473683437,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727693050
    },
    {
        "content": "<p>See <a href=\"https://github.com/nomeata/equational_theories/blob/finite_poly_refutation/equational_theories/Generated/FinitePoly/src/finite_poly_generate_lean.py\">https://github.com/nomeata/equational_theories/blob/finite_poly_refutation/equational_theories/Generated/FinitePoly/src/finite_poly_generate_lean.py</a> for how I read the implications.json, calculate the transitive closure using adjacency sets (not lists!) relatively efficiently and then prune the data using this logic:</p>\n<div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"k\">def</span> <span class=\"nf\">prune_row</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">):</span>\n    <span class=\"n\">satisfied</span> <span class=\"o\">=</span> <span class=\"nb\">set</span><span class=\"p\">()</span>\n    <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"p\">[</span><span class=\"s2\">\"satisfied\"</span><span class=\"p\">]:</span>\n        <span class=\"c1\"># already implied</span>\n        <span class=\"k\">if</span> <span class=\"n\">implying</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">intersection</span><span class=\"p\">(</span><span class=\"n\">satisfied</span><span class=\"p\">):</span>\n          <span class=\"k\">continue</span>\n        <span class=\"c1\"># remove all implied by this</span>\n        <span class=\"n\">satisfied</span> <span class=\"o\">=</span> <span class=\"n\">satisfied</span> <span class=\"o\">-</span> <span class=\"n\">impliedBy</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span>\n        <span class=\"n\">satisfied</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">)</span>\n    <span class=\"n\">refuted</span> <span class=\"o\">=</span> <span class=\"nb\">set</span><span class=\"p\">()</span>\n    <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"p\">[</span><span class=\"s2\">\"refuted\"</span><span class=\"p\">]:</span>\n        <span class=\"c1\"># already ruled out</span>\n        <span class=\"k\">if</span> <span class=\"n\">impliedBy</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">intersection</span><span class=\"p\">(</span><span class=\"n\">refuted</span><span class=\"p\">):</span>\n          <span class=\"k\">continue</span>\n        <span class=\"c1\"># remove all that this is ruling out</span>\n        <span class=\"n\">refuted</span> <span class=\"o\">=</span> <span class=\"n\">refuted</span> <span class=\"o\">-</span> <span class=\"n\">impliedBy</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span>\n        <span class=\"n\">refuted</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">)</span>\n</code></pre></div>",
        "id": 473684675,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727693322
    },
    {
        "content": "<p>Also, with the generated implications the data is now so large that the code I found in the <code>scipts</code> directory to calculate the transitive closure was too slow. This worked well and results in a maybe more convenient representation as adjacency sets in both directions:</p>\n<div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"c1\"># we have 4694 equations</span>\n<span class=\"n\">full</span> <span class=\"o\">=</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">4694</span><span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n\n<span class=\"k\">with</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">\"</span><span class=\"si\">{</span><span class=\"nb\">dir</span><span class=\"si\">}</span><span class=\"s2\">/src/implications.json\"</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n  <span class=\"n\">implications</span> <span class=\"o\">=</span> <span class=\"n\">json</span><span class=\"o\">.</span><span class=\"n\">load</span><span class=\"p\">(</span><span class=\"n\">f</span><span class=\"p\">)[</span><span class=\"s2\">\"implications\"</span><span class=\"p\">]</span>\n<span class=\"n\">implications</span> <span class=\"o\">=</span> <span class=\"p\">[</span> <span class=\"p\">(</span><span class=\"nb\">int</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">[</span><span class=\"s2\">\"lhs\"</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">removeprefix</span><span class=\"p\">(</span><span class=\"s2\">\"Equation\"</span><span class=\"p\">)),</span> <span class=\"nb\">int</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">[</span><span class=\"s2\">\"rhs\"</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">removeprefix</span><span class=\"p\">(</span><span class=\"s2\">\"Equation\"</span><span class=\"p\">)))</span> <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"n\">implications</span> <span class=\"p\">]</span>\n\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">\"Number of implications:\"</span><span class=\"p\">,</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">implications</span><span class=\"p\">))</span>\n\n<span class=\"n\">impliedBy</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"n\">i</span> <span class=\"p\">:</span> <span class=\"nb\">set</span><span class=\"p\">()</span> <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"n\">full</span> <span class=\"p\">}</span>\n<span class=\"n\">implying</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"n\">j</span> <span class=\"p\">:</span> <span class=\"nb\">set</span><span class=\"p\">()</span> <span class=\"k\">for</span> <span class=\"n\">j</span> <span class=\"ow\">in</span> <span class=\"n\">full</span> <span class=\"p\">}</span>\n\n<span class=\"k\">for</span> <span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"n\">j</span> <span class=\"ow\">in</span> <span class=\"n\">implications</span><span class=\"p\">:</span>\n  <span class=\"n\">impliedBy</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">j</span><span class=\"p\">)</span>\n  <span class=\"n\">impliedBy</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span> <span class=\"o\">|=</span> <span class=\"n\">impliedBy</span><span class=\"p\">[</span><span class=\"n\">j</span><span class=\"p\">]</span>\n  <span class=\"n\">implying</span><span class=\"p\">[</span><span class=\"n\">j</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">)</span>\n  <span class=\"n\">implying</span><span class=\"p\">[</span><span class=\"n\">j</span><span class=\"p\">]</span> <span class=\"o\">|=</span> <span class=\"n\">implying</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span>\n</code></pre></div>",
        "id": 473690170,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727694640
    },
    {
        "content": "<p>There's also code in <a href=\"https://github.com/teorth/equational_theories/pull/126\">equational#126</a> for transitive closure</p>",
        "id": 473690378,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1727694701
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> <a href=\"#narrow/stream/458659-Equational/topic/Pruning.20counter.20examples.20based.20on.20implications/near/473690170\">said</a>:</p>\n<blockquote>\n<p>Also, with the generated implications the data is now so large that the code I found in the <code>scipts</code> directory to calculate the transitive closure was too slow. This worked well and results in a maybe more convenient representation as adjacency sets in both directions:</p>\n<p><div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"c1\"># we have 4694 equations</span>\n<span class=\"n\">full</span> <span class=\"o\">=</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">4694</span><span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n\n<span class=\"k\">with</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">\"</span><span class=\"si\">{</span><span class=\"nb\">dir</span><span class=\"si\">}</span><span class=\"s2\">/src/implications.json\"</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n  <span class=\"n\">implications</span> <span class=\"o\">=</span> <span class=\"n\">json</span><span class=\"o\">.</span><span class=\"n\">load</span><span class=\"p\">(</span><span class=\"n\">f</span><span class=\"p\">)[</span><span class=\"s2\">\"implications\"</span><span class=\"p\">]</span>\n<span class=\"n\">implications</span> <span class=\"o\">=</span> <span class=\"p\">[</span> <span class=\"p\">(</span><span class=\"nb\">int</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">[</span><span class=\"s2\">\"lhs\"</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">removeprefix</span><span class=\"p\">(</span><span class=\"s2\">\"Equation\"</span><span class=\"p\">)),</span> <span class=\"nb\">int</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">[</span><span class=\"s2\">\"rhs\"</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">removeprefix</span><span class=\"p\">(</span><span class=\"s2\">\"Equation\"</span><span class=\"p\">)))</span> <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"n\">implications</span> <span class=\"p\">]</span>\n\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">\"Number of implications:\"</span><span class=\"p\">,</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">implications</span><span class=\"p\">))</span>\n\n<span class=\"n\">impliedBy</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"n\">i</span> <span class=\"p\">:</span> <span class=\"nb\">set</span><span class=\"p\">()</span> <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"n\">full</span> <span class=\"p\">}</span>\n<span class=\"n\">implying</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"n\">j</span> <span class=\"p\">:</span> <span class=\"nb\">set</span><span class=\"p\">()</span> <span class=\"k\">for</span> <span class=\"n\">j</span> <span class=\"ow\">in</span> <span class=\"n\">full</span> <span class=\"p\">}</span>\n\n<span class=\"k\">for</span> <span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"n\">j</span> <span class=\"ow\">in</span> <span class=\"n\">implications</span><span class=\"p\">:</span>\n  <span class=\"n\">impliedBy</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">j</span><span class=\"p\">)</span>\n  <span class=\"n\">impliedBy</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span> <span class=\"o\">|=</span> <span class=\"n\">impliedBy</span><span class=\"p\">[</span><span class=\"n\">j</span><span class=\"p\">]</span>\n  <span class=\"n\">implying</span><span class=\"p\">[</span><span class=\"n\">j</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">)</span>\n  <span class=\"n\">implying</span><span class=\"p\">[</span><span class=\"n\">j</span><span class=\"p\">]</span> <span class=\"o\">|=</span> <span class=\"n\">implying</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>If you're talking about the ruby code, it's fast enough if you first run the transitive reduction (I should have made that necessary, but I just left it as a comment in case others wanted to not run reduction twice)</p>",
        "id": 473692035,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1727695163
    },
    {
        "content": "<p>Not the ruby code, I found this elegant snippet to be too slow:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">transitive_closure</span><span class=\"o\">(</span><span class=\"n\">pairs</span><span class=\"o\">):</span>\n<span class=\"w\">    </span><span class=\"n\">new_pairs</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">set</span><span class=\"o\">(</span><span class=\"n\">pairs</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">while</span><span class=\"w\"> </span><span class=\"n\">new_pairs</span><span class=\"o\">:</span>\n<span class=\"w\">        </span><span class=\"n\">new_pairs</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">            </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">)</span>\n<span class=\"w\">            </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">new_pairs</span>\n<span class=\"w\">            </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">pairs</span>\n<span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">c</span>\n<span class=\"w\">        </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">closure</span>\n<span class=\"w\">        </span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"bp\">|=</span><span class=\"w\"> </span><span class=\"n\">new_pairs</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">closure</span>\n</code></pre></div>",
        "id": 473699617,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727696674
    },
    {
        "content": "<p>How fast do you need it to be? I'm currently trying to optimize the lean code, and I'm not sure how much to optimize it---the current bottleneck is collecting the edges, not computing the closure itself</p>",
        "id": 473700666,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1727696880
    },
    {
        "content": "<p>Gotcha. One more questions, I'm not actually clear what you're doing to reduce the number of counterexamples to search. Is it just that you're subtracting the closure of implications, or something else?  Just based on the number you gave above, I would have thought the search space would be greater than that, e.g. down from ~7m -&gt; ~3.5m. Or perhaps I am just not up to date with how many refutations are now proven.</p>",
        "id": 473702056,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1727697082
    },
    {
        "content": "<p>I now extended the script to prune some more, and do not include equations in the <code>Facts</code> to check that would not tell us anything new, given the previous examples into  account. This is my code. I guess the first laf is “subtracting the closure of implications”?</p>\n<div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"k\">def</span> <span class=\"nf\">prune_row</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">):</span>\n    <span class=\"n\">stats</span><span class=\"p\">[</span><span class=\"s2\">\"total\"</span><span class=\"p\">]</span> <span class=\"o\">+=</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">[</span><span class=\"s2\">\"satisfied\"</span><span class=\"p\">])</span> <span class=\"o\">+</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">[</span><span class=\"s2\">\"refuted\"</span><span class=\"p\">])</span>\n\n    <span class=\"c1\"># prune by implications</span>\n    <span class=\"n\">satisfied</span> <span class=\"o\">=</span> <span class=\"nb\">set</span><span class=\"p\">()</span>\n    <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"p\">[</span><span class=\"s2\">\"satisfied\"</span><span class=\"p\">]:</span>\n        <span class=\"c1\"># already implied</span>\n        <span class=\"k\">if</span> <span class=\"n\">implying</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">intersection</span><span class=\"p\">(</span><span class=\"n\">satisfied</span><span class=\"p\">):</span>\n          <span class=\"k\">continue</span>\n        <span class=\"c1\"># remove all implied by this</span>\n        <span class=\"n\">satisfied</span> <span class=\"o\">=</span> <span class=\"n\">satisfied</span> <span class=\"o\">-</span> <span class=\"n\">impliedBy</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span>\n        <span class=\"n\">satisfied</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">)</span>\n    <span class=\"n\">refuted</span> <span class=\"o\">=</span> <span class=\"nb\">set</span><span class=\"p\">()</span>\n    <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"p\">[</span><span class=\"s2\">\"refuted\"</span><span class=\"p\">]:</span>\n        <span class=\"c1\"># already ruled out</span>\n        <span class=\"k\">if</span> <span class=\"n\">impliedBy</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">intersection</span><span class=\"p\">(</span><span class=\"n\">refuted</span><span class=\"p\">):</span>\n          <span class=\"k\">continue</span>\n        <span class=\"c1\"># remove all that this is ruling out</span>\n        <span class=\"n\">refuted</span> <span class=\"o\">=</span> <span class=\"n\">refuted</span> <span class=\"o\">-</span> <span class=\"n\">impliedBy</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span>\n        <span class=\"n\">refuted</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">)</span>\n    <span class=\"n\">stats</span><span class=\"p\">[</span><span class=\"s2\">\"removed_by_implication\"</span><span class=\"p\">]</span> <span class=\"o\">+=</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">[</span><span class=\"s2\">\"satisfied\"</span><span class=\"p\">])</span> <span class=\"o\">+</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">[</span><span class=\"s2\">\"refuted\"</span><span class=\"p\">])</span> <span class=\"o\">-</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">satisfied</span><span class=\"p\">)</span> <span class=\"o\">-</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">refuted</span><span class=\"p\">)</span>\n\n    <span class=\"c1\"># prune by earlier examples</span>\n    <span class=\"n\">satisfied_</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"n\">i</span> <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"n\">satisfied</span> <span class=\"k\">if</span> <span class=\"n\">refuted</span> <span class=\"o\">-</span> <span class=\"n\">notImpliedBy</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span> <span class=\"p\">}</span>\n    <span class=\"n\">refuted_</span>   <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"n\">j</span> <span class=\"k\">for</span> <span class=\"n\">j</span> <span class=\"ow\">in</span> <span class=\"n\">refuted</span>   <span class=\"k\">if</span> <span class=\"n\">satisfied</span> <span class=\"o\">-</span> <span class=\"n\">notImplying</span><span class=\"p\">[</span><span class=\"n\">j</span><span class=\"p\">]</span> <span class=\"p\">}</span>\n\n    <span class=\"n\">stats</span><span class=\"p\">[</span><span class=\"s2\">\"removed_by_covering\"</span><span class=\"p\">]</span> <span class=\"o\">+=</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">satisfied</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">refuted</span><span class=\"p\">)</span> <span class=\"o\">-</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">satisfied_</span><span class=\"p\">)</span> <span class=\"o\">-</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">refuted_</span><span class=\"p\">)</span>\n    <span class=\"n\">satisfied</span><span class=\"p\">,</span> <span class=\"n\">refuted</span> <span class=\"o\">=</span> <span class=\"n\">satisfied_</span><span class=\"p\">,</span> <span class=\"n\">refuted_</span>\n\n    <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"n\">satisfied</span><span class=\"p\">:</span>\n      <span class=\"k\">for</span> <span class=\"n\">j</span> <span class=\"ow\">in</span> <span class=\"n\">refuted</span><span class=\"p\">:</span>\n        <span class=\"n\">notImpliedBy</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">j</span><span class=\"p\">)</span>\n        <span class=\"n\">notImplying</span><span class=\"p\">[</span><span class=\"n\">j</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">)</span>\n\n    <span class=\"n\">data</span><span class=\"p\">[</span><span class=\"s2\">\"satisfied\"</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"nb\">sorted</span><span class=\"p\">(</span><span class=\"n\">satisfied</span><span class=\"p\">)</span>\n    <span class=\"n\">data</span><span class=\"p\">[</span><span class=\"s2\">\"refuted\"</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"nb\">sorted</span><span class=\"p\">(</span><span class=\"n\">refuted</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">data</span>\n</code></pre></div>",
        "id": 473705521,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727697603
    },
    {
        "content": "<p>The second check was less effective than I was hoping for:</p>\n<blockquote>\n<p>Out of 619608 facts to check, pruning by implication removed 577899 facts (93.27%) to check, pruning by covering removed 3219 facts (0.52%), leaving 38490 facts to check.</p>\n</blockquote>",
        "id": 473705689,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727697637
    },
    {
        "content": "<p>I think we can merge <a href=\"https://github.com/teorth/equational_theories/pull/19\">https://github.com/teorth/equational_theories/pull/19</a> now. If we then also merge <a href=\"https://github.com/teorth/equational_theories/pull/130\">https://github.com/teorth/equational_theories/pull/130</a> then these antiimplications will show up in the script that collects our results, and that will answer your question of how fast it needs to be – fast enough to handle that data :-)</p>",
        "id": 473706032,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727697722
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> <a href=\"#narrow/stream/458659-Equational/topic/Pruning.20counter.20examples.20based.20on.20implications/near/473699617\">said</a>:</p>\n<blockquote>\n<p>Not the ruby code, I found this elegant snippet to be too slow:</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">transitive_closure</span><span class=\"o\">(</span><span class=\"n\">pairs</span><span class=\"o\">):</span>\n<span class=\"w\">    </span><span class=\"n\">new_pairs</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">set</span><span class=\"o\">(</span><span class=\"n\">pairs</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">while</span><span class=\"w\"> </span><span class=\"n\">new_pairs</span><span class=\"o\">:</span>\n<span class=\"w\">        </span><span class=\"n\">new_pairs</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">            </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">)</span>\n<span class=\"w\">            </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">new_pairs</span>\n<span class=\"w\">            </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">pairs</span>\n<span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">c</span>\n<span class=\"w\">        </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">closure</span>\n<span class=\"w\">        </span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"bp\">|=</span><span class=\"w\"> </span><span class=\"n\">new_pairs</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">closure</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>For what it's worth, the reason it's slow is the iteration \"for c, d in pairs if b == c\". If we had defined</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">pairs_idx</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">defaultdict</span><span class=\"o\">(</span><span class=\"n\">list</span><span class=\"o\">)</span>\n<span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">pairs</span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">pairs_idx</span><span class=\"o\">[</span><span class=\"n\">a</span><span class=\"o\">]</span><span class=\"bp\">.</span><span class=\"n\">append</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>this could be replaced with \"for d in pairs_idx[b]\".</p>\n<p>I made this change locally when the number of implications grew, but thought it's too minor to push. If anyone is interested, this is called the semi-naive algorithm, at least in the DataLog literature.</p>",
        "id": 473706358,
        "sender_full_name": "Amir Livne Bar-on",
        "timestamp": 1727697794
    },
    {
        "content": "<p>Right, a dict-of-dict (or dict-of-list) data sturcture works bettter, probably also why my code is fast enough. Feel free to push it, before someone else uses or copied that code :-)</p>",
        "id": 473706994,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727697950
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> <a href=\"#narrow/stream/458659-Equational/topic/Pruning.20counter.20examples.20based.20on.20implications/near/473699617\">schrieb</a>:</p>\n<blockquote>\n<p>Not the ruby code, I found this elegant snippet to be too slow:</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">transitive_closure</span><span class=\"o\">(</span><span class=\"n\">pairs</span><span class=\"o\">):</span>\n<span class=\"w\">    </span><span class=\"n\">new_pairs</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">set</span><span class=\"o\">(</span><span class=\"n\">pairs</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">while</span><span class=\"w\"> </span><span class=\"n\">new_pairs</span><span class=\"o\">:</span>\n<span class=\"w\">        </span><span class=\"n\">new_pairs</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">            </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">)</span>\n<span class=\"w\">            </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">new_pairs</span>\n<span class=\"w\">            </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">pairs</span>\n<span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">c</span>\n<span class=\"w\">        </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">closure</span>\n<span class=\"w\">        </span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"bp\">|=</span><span class=\"w\"> </span><span class=\"n\">new_pairs</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">closure</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Did you try something closer to DFS? </p>\n<div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"kn\">from</span> <span class=\"nn\">collections</span> <span class=\"kn\">import</span> <span class=\"n\">defaultdict</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">transitive_closure</span><span class=\"p\">(</span><span class=\"n\">pairs</span><span class=\"p\">):</span>\n    <span class=\"n\">graph</span> <span class=\"o\">=</span> <span class=\"n\">defaultdict</span><span class=\"p\">(</span><span class=\"nb\">set</span><span class=\"p\">)</span>\n    <span class=\"k\">for</span> <span class=\"n\">a</span><span class=\"p\">,</span> <span class=\"n\">b</span> <span class=\"ow\">in</span> <span class=\"n\">pairs</span><span class=\"p\">:</span>\n        <span class=\"n\">graph</span><span class=\"p\">[</span><span class=\"n\">a</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">b</span><span class=\"p\">)</span>\n    <span class=\"n\">closure</span> <span class=\"o\">=</span> <span class=\"nb\">set</span><span class=\"p\">()</span>\n    <span class=\"k\">for</span> <span class=\"n\">a</span> <span class=\"ow\">in</span> <span class=\"n\">graph</span><span class=\"p\">:</span>\n        <span class=\"n\">visited</span> <span class=\"o\">=</span> <span class=\"nb\">set</span><span class=\"p\">()</span>\n        <span class=\"n\">stack</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">a</span><span class=\"p\">]</span>\n        <span class=\"k\">while</span> <span class=\"n\">stack</span><span class=\"p\">:</span>\n            <span class=\"n\">node</span> <span class=\"o\">=</span> <span class=\"n\">stack</span><span class=\"o\">.</span><span class=\"n\">pop</span><span class=\"p\">()</span>\n            <span class=\"k\">if</span> <span class=\"n\">node</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">visited</span><span class=\"p\">:</span>\n                <span class=\"n\">visited</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">node</span><span class=\"p\">)</span>\n                <span class=\"n\">closure</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">((</span><span class=\"n\">a</span><span class=\"p\">,</span> <span class=\"n\">node</span><span class=\"p\">))</span>\n                <span class=\"n\">stack</span><span class=\"o\">.</span><span class=\"n\">extend</span><span class=\"p\">(</span><span class=\"n\">graph</span><span class=\"p\">[</span><span class=\"n\">node</span><span class=\"p\">]</span> <span class=\"o\">-</span> <span class=\"n\">visited</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">closure</span>\n</code></pre></div>",
        "id": 473708334,
        "sender_full_name": "Michael Bucko",
        "timestamp": 1727698298
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> <a href=\"#narrow/stream/458659-Equational/topic/Pruning.20counter.20examples.20based.20on.20implications/near/473706032\">said</a>:</p>\n<blockquote>\n<p>I think we can merge <a href=\"https://github.com/teorth/equational_theories/pull/19\">https://github.com/teorth/equational_theories/pull/19</a> now. If we then also merge <a href=\"https://github.com/teorth/equational_theories/pull/130\">https://github.com/teorth/equational_theories/pull/130</a> then these antiimplications will show up in the script that collects our results, and that will answer your question of how fast it needs to be – fast enough to handle that data :-)</p>\n</blockquote>\n<p>Currently it takes about 6 seconds, let's see what happens after <a href=\"https://github.com/teorth/equational_theories/pull/19\">equational#19</a></p>",
        "id": 473708624,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1727698380
    },
    {
        "content": "<p>I’m using this which works well enough for now and is quite elegant (I think),  no need to discuss variants here :-)</p>\n<div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"n\">impliedBy</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"n\">i</span> <span class=\"p\">:</span> <span class=\"nb\">set</span><span class=\"p\">()</span> <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"n\">full</span> <span class=\"p\">}</span>\n<span class=\"n\">implying</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"n\">j</span> <span class=\"p\">:</span> <span class=\"nb\">set</span><span class=\"p\">()</span> <span class=\"k\">for</span> <span class=\"n\">j</span> <span class=\"ow\">in</span> <span class=\"n\">full</span> <span class=\"p\">}</span>\n\n<span class=\"k\">for</span> <span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"n\">j</span> <span class=\"ow\">in</span> <span class=\"n\">implications</span><span class=\"p\">:</span>\n  <span class=\"n\">impliedBy</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">j</span><span class=\"p\">)</span>\n  <span class=\"n\">impliedBy</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span> <span class=\"o\">|=</span> <span class=\"n\">impliedBy</span><span class=\"p\">[</span><span class=\"n\">j</span><span class=\"p\">]</span>\n  <span class=\"n\">implying</span><span class=\"p\">[</span><span class=\"n\">j</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">)</span>\n  <span class=\"n\">implying</span><span class=\"p\">[</span><span class=\"n\">j</span><span class=\"p\">]</span> <span class=\"o\">|=</span> <span class=\"n\">implying</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span>\n</code></pre></div>\n<p><strong>Update:</strong> This is not only elegant and fast, but also wrong. Ignore me.</p>",
        "id": 473708677,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727698397
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"690858\">Daniel Weber</span> <a href=\"#narrow/stream/458659-Equational/topic/Pruning.20counter.20examples.20based.20on.20implications/near/473708624\">said</a>:</p>\n<blockquote>\n<p>Currently it takes about 6 seconds, let's see what happens after <a href=\"https://github.com/teorth/equational_theories/pull/19\">equational#19</a></p>\n</blockquote>\n<p>There is certainly a lot of data there now:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">~/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">equational_theories</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">extract_implications</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"n\">wc</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">l</span>\n<span class=\"mi\">88066</span>\n</code></pre></div>",
        "id": 473710103,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727698788
    },
    {
        "content": "<p>That's only the direct implications, isn't it?</p>",
        "id": 473710336,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1727698846
    },
    {
        "content": "<p>The transitive closure had about 8M implications/non-implications</p>",
        "id": 473710423,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1727698872
    },
    {
        "content": "<p>Yes, the <code>extract_implication</code> scripts just collects the “raw data” of the proven theorems; further downstream scrips should calculate the transitive closure or reduction as needed.</p>",
        "id": 473710796,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727698975
    },
    {
        "content": "<p>Just merged <a href=\"https://github.com/teorth/equational_theories/pull/19\">equational#19</a>. Enjoy :-)</p>",
        "id": 473713164,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727699587
    },
    {
        "content": "<p>I think it's <a href=\"https://github.com/teorth/equational_theories/pull/19\">equational#19</a> you mean</p>",
        "id": 473717497,
        "sender_full_name": "Leo Shine",
        "timestamp": 1727700484
    },
    {
        "content": "<p>Keep getting that wrong :-)</p>",
        "id": 473717590,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727700501
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> <a href=\"#narrow/stream/458659-Equational/topic/Pruning.20counter.20examples.20based.20on.20implications/near/473713164\">said</a>:</p>\n<blockquote>\n<p>Just merged <a href=\"https://github.com/teorth/equational_theories/pull/19\">equational#19</a>. Enjoy :-)</p>\n</blockquote>\n<p>Now it finds 18M implications/refutations in 14 seconds</p>",
        "id": 473718477,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1727700635
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> <a href=\"#narrow/stream/458659-Equational/topic/Pruning.20counter.20examples.20based.20on.20implications/near/473710796\">said</a>:</p>\n<blockquote>\n<p>Yes, the <code>extract_implication</code> scripts just collects the “raw data” of the proven theorems; further downstream scrips should calculate the transitive closure or reduction as needed.</p>\n</blockquote>\n<p>Does tooling to consume the JSON which this emits already exist?</p>",
        "id": 473733842,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1727703430
    },
    {
        "content": "<p>(E.g., if I wanted to witness the 18M figure quoted above.)</p>",
        "id": 473734119,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1727703485
    },
    {
        "content": "<p>You can use <a href=\"https://github.com/teorth/equational_theories/pull/126\">equational#126</a> to see it, although it doesn't output as JSON because Lean's <code>toJson</code> stack-overflowed</p>",
        "id": 473734623,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1727703565
    },
    {
        "content": "<p>If someone could provide a standalone example showing the stack overflow, that would be great (unless someone is already on fixing it!)</p>",
        "id": 473735774,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1727703777
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> <a href=\"#narrow/stream/458659-Equational/topic/Pruning.20counter.20examples.20based.20on.20implications/near/473735774\">said</a>:</p>\n<blockquote>\n<p>If someone could provide a standalone example showing the stack overflow, that would be great (unless someone is already on fixing it!)</p>\n</blockquote>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">toJson</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Array</span><span class=\"bp\">.</span><span class=\"n\">mkArray</span><span class=\"w\"> </span><span class=\"mi\">70000</span><span class=\"w\"> </span><span class=\"s2\">\"string1\"</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>outputs</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Stack</span><span class=\"w\"> </span><span class=\"n\">overflow</span><span class=\"w\"> </span><span class=\"n\">detected</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">Aborting</span><span class=\"bp\">.</span>\n</code></pre></div>\n<p>I assume that might be system-dependent, I'm on Ubuntu 22.04.5</p>",
        "id": 473738204,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1727704289
    },
    {
        "content": "<p>I analysed the implications graph. We have 3557 equivalence classes. Of the 12M implications between them, 2.5% are know to hold and 72% are known not to hold.<br>\nI reduced the remaining conjectures and got 15501 irreducible implications.</p>",
        "id": 473745267,
        "sender_full_name": "Amir Livne Bar-on",
        "timestamp": 1727705432
    },
    {
        "content": "<p>So we are ¾ done? Great, so one more day to go.</p>",
        "id": 473745502,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727705488
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"302984\">Amir Livne Bar-on</span> <a href=\"#narrow/stream/458659-Equational/topic/Pruning.20counter.20examples.20based.20on.20implications/near/473745267\">said</a>:</p>\n<blockquote>\n<p>I analysed the implications graph. We have 3557 equivalence classes. Of the 12M implications between them, 2.5% are know to hold and 72% are known not to hold.<br>\nI reduced the remaining conjectures and got 15501 irreducible implications.</p>\n</blockquote>\n<p>Do you happen to have the graph in a form Nauty is able to process? I wonder if there are interesting symmetries</p>",
        "id": 473746116,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1727705617
    },
    {
        "content": "<p>Do you mean after reducing to equivalence classes? The original graph can be parsed directly from <code>lake exe extract_implications</code></p>",
        "id": 473747726,
        "sender_full_name": "Amir Livne Bar-on",
        "timestamp": 1727705909
    },
    {
        "content": "<p>Yes</p>",
        "id": 473748026,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1727705949
    },
    {
        "content": "<p>Do you have a link that explains what the format is? Anyway should be easy to generate.<br>\nIf anyone wants to have a look, my code is here:<br>\n<a href=\"https://github.com/teorth/equational_theories/pull/144\">https://github.com/teorth/equational_theories/pull/144</a></p>",
        "id": 473748538,
        "sender_full_name": "Amir Livne Bar-on",
        "timestamp": 1727706016
    },
    {
        "content": "<p>There's <a href=\"https://pypi.org/project/pynauty/\">https://pypi.org/project/pynauty/</a> , although I'm not sure what's the output format</p>",
        "id": 473749578,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1727706173
    },
    {
        "content": "<p>It's a bit strange to think about this as a graph. The implications form a poset, we only use graphs as light-weight representation</p>",
        "id": 473756524,
        "sender_full_name": "Amir Livne Bar-on",
        "timestamp": 1727707393
    },
    {
        "content": "<p>Posets are graphs <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 473760804,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1727708261
    },
    {
        "content": "<p>I ran some more analyses on the data. I'm less certain of these, but:</p>\n<ul>\n<li>3557 is the current number of equivalence classes, but when more implications are proved this may go down. The lower limit we have established is 845</li>\n<li>The current longest provable path of non-equivalent implications is of length 10. An example of such a path is <code>2 =&gt; 41 =&gt; 374 =&gt; 4117 =&gt; 38 =&gt; 311 =&gt; 309 =&gt; 3467 =&gt; 3458 =&gt; 3456 =&gt; 1</code></li>\n<li>If there are no other true implications beside what's proven in the repo now, the longest path of non-equivalent implications has length 19</li>\n<li>I don't know what the maximum length would be if arbitrary subsets of the unknown implications hold, it's plausible to get longer chains than 19</li>\n</ul>\n<p>[EDIT: changed the numbers after bugfixes]</p>",
        "id": 473824062,
        "sender_full_name": "Amir Livne Bar-on",
        "timestamp": 1727721890
    },
    {
        "content": "<p>so in theory we might be able to make do with 18 counterexamples? <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 473824550,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1727721997
    },
    {
        "content": "<p>Actually I think my conclusions are inconsistent... There must be fewer equivalence classes if the longest path gets shorter.</p>\n<p>EDIT: On third thought, it's possible to imagine situations where adding implications would lengthen the path without joining equivalence classes. If the Hesse diagram of A, B, C, D is a diamond with B&amp;C incomparable, adding an edge between B and C would increase the longest path.</p>",
        "id": 473824989,
        "sender_full_name": "Amir Livne Bar-on",
        "timestamp": 1727722129
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"302984\">Amir Livne Bar-on</span> <a href=\"#narrow/stream/458659-Equational/topic/Pruning.20counter.20examples.20based.20on.20implications/near/473745267\">said</a>:</p>\n<blockquote>\n<p>I analysed the implications graph. We have 3557 equivalence classes. Of the 12M implications between them, 2.5% are know to hold and 72% are known not to hold.<br>\nI reduced the remaining conjectures and got 15501 irreducible implications.</p>\n</blockquote>\n<p>The script had a bug, it chose the wrong subset of implications. If anyone relied on it, please re-run the script from the branch. You should get 24283 irreducible implications.</p>",
        "id": 473852009,
        "sender_full_name": "Amir Livne Bar-on",
        "timestamp": 1727729177
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"690858\">Daniel Weber</span> <a href=\"#narrow/stream/458659-Equational/topic/Pruning.20counter.20examples.20based.20on.20implications/near/473738204\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/458659-Equational/topic/Pruning.20counter.20examples.20based.20on.20implications/near/473735774\">said</a>:</p>\n<blockquote>\n<p>If someone could provide a standalone example showing the stack overflow, that would be great (unless someone is already on fixing it!)</p>\n</blockquote>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">toJson</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Array</span><span class=\"bp\">.</span><span class=\"n\">mkArray</span><span class=\"w\"> </span><span class=\"mi\">70000</span><span class=\"w\"> </span><span class=\"s2\">\"string1\"</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>outputs</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Stack</span><span class=\"w\"> </span><span class=\"n\">overflow</span><span class=\"w\"> </span><span class=\"n\">detected</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">Aborting</span><span class=\"bp\">.</span>\n</code></pre></div>\n<p>I assume that might be system-dependent, I'm on Ubuntu 22.04.5</p>\n</blockquote>\n<p>Tracking at <a href=\"https://github.com/leanprover/lean4/pull/5548\">lean#5548</a>, but I don't immediately understand what is wrong.</p>",
        "id": 473901839,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1727745609
    },
    {
        "content": "<p>I found out that when using <code>.compress</code> it doesn't happen, so that's what I'll do for now</p>",
        "id": 473901885,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1727745636
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span> My processing of Nicholas' original data set had ~13.6m refutations, and Daniel posted in another thread that his tool calculated <code>implicit_proof_false: 12764328</code>. I don't have a way to calculate this myself right now, and was curious if we proved less than what Nicholas originally calculated, or if my or Daniel's numbers are wrong</p>",
        "id": 473954851,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1727763780
    },
    {
        "content": "<p>I think you just have to add <code>explicit_proof_false</code> from my numbers, as they're counted separately</p>",
        "id": 473955629,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1727764001
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"690858\">@Daniel Weber</span> Thanks! So this get me up to 13,503,535 where as my list of the refutations Nicholas generated has 13,633,461</p>",
        "id": 473955976,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1727764102
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> <a href=\"#narrow/stream/458659-Equational/topic/Pruning.20counter.20examples.20based.20on.20implications/near/473708677\">said</a>:</p>\n<blockquote>\n<p>I’m using this which works well enough for now and is quite elegant (I think),  no need to discuss variants here :-)</p>\n<p><div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"n\">impliedBy</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"n\">i</span> <span class=\"p\">:</span> <span class=\"nb\">set</span><span class=\"p\">()</span> <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"n\">full</span> <span class=\"p\">}</span>\n<span class=\"n\">implying</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"n\">j</span> <span class=\"p\">:</span> <span class=\"nb\">set</span><span class=\"p\">()</span> <span class=\"k\">for</span> <span class=\"n\">j</span> <span class=\"ow\">in</span> <span class=\"n\">full</span> <span class=\"p\">}</span>\n\n<span class=\"k\">for</span> <span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"n\">j</span> <span class=\"ow\">in</span> <span class=\"n\">implications</span><span class=\"p\">:</span>\n  <span class=\"n\">impliedBy</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">j</span><span class=\"p\">)</span>\n  <span class=\"n\">impliedBy</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span> <span class=\"o\">|=</span> <span class=\"n\">impliedBy</span><span class=\"p\">[</span><span class=\"n\">j</span><span class=\"p\">]</span>\n  <span class=\"n\">implying</span><span class=\"p\">[</span><span class=\"n\">j</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">)</span>\n  <span class=\"n\">implying</span><span class=\"p\">[</span><span class=\"n\">j</span><span class=\"p\">]</span> <span class=\"o\">|=</span> <span class=\"n\">implying</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>The reason it’s elegant and fast is because it’s wrong. A bit embarrassing.</p>",
        "id": 474252439,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727863929
    },
    {
        "content": "<p>Is this the source of the discrepancy in refutation numbers?</p>",
        "id": 474253717,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1727864358
    },
    {
        "content": "<p>I don’t think so, this only caused too large <code>Facts</code> statements in the generated lean code, but didn’t affect the raw numbers reported by various people.</p>",
        "id": 474253902,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727864426
    },
    {
        "content": "<p>I am now using this code, based on <span class=\"user-mention\" data-user-id=\"302984\">@Amir Livne Bar-on</span> ’s code, slightly optimized a bit futher:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">transitive_closure</span><span class=\"o\">(</span><span class=\"n\">pairs</span><span class=\"o\">):</span>\n<span class=\"w\">    </span><span class=\"n\">pairs_idx</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">defaultdict</span><span class=\"o\">(</span><span class=\"n\">list</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">pairs</span><span class=\"o\">:</span>\n<span class=\"w\">        </span><span class=\"n\">pairs_idx</span><span class=\"o\">[</span><span class=\"n\">a</span><span class=\"o\">]</span><span class=\"bp\">.</span><span class=\"n\">append</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">set</span><span class=\"o\">()</span>\n<span class=\"w\">    </span><span class=\"n\">new_pairs</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">list</span><span class=\"o\">(</span><span class=\"n\">pairs</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">while</span><span class=\"w\"> </span><span class=\"n\">new_pairs</span><span class=\"o\">:</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">new_pairs</span><span class=\"bp\">.</span><span class=\"n\">pop</span><span class=\"o\">()</span>\n<span class=\"w\">        </span><span class=\"n\">closure</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"o\">((</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">))</span>\n<span class=\"w\">        </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">pairs_idx</span><span class=\"o\">[</span><span class=\"n\">b</span><span class=\"o\">]:</span>\n<span class=\"w\">          </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">closure</span><span class=\"o\">:</span>\n<span class=\"w\">            </span><span class=\"n\">new_pairs</span><span class=\"bp\">.</span><span class=\"n\">append</span><span class=\"o\">((</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">closure</span>\n</code></pre></div>\n<p><a href=\"https://github.com/teorth/equational_theories/pull/196\">https://github.com/teorth/equational_theories/pull/196</a></p>",
        "id": 474254697,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727864733
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"761203\">Vlad Tsyrklevich</span> <a href=\"#narrow/stream/458659-Equational/topic/Pruning.20counter.20examples.20based.20on.20implications/near/473955976\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"690858\">Daniel Weber</span> Thanks! So this get me up to 13,503,535 where as my list of the refutations Nicholas generated has 13,633,461</p>\n</blockquote>\n<p>So do you know what this discrepancy is from? Is this expected, or not?</p>",
        "id": 474259129,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1727866389
    },
    {
        "content": "<p>It would be nice if the statistics portion of README.md was updated with some of these stats. Presumably we are close to having this done automatically but having some early data points recorded will be nice for the time series visualizations.</p>",
        "id": 474298599,
        "sender_full_name": "Terence Tao",
        "timestamp": 1727875908
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"761203\">Vlad Tsyrklevich</span> <a href=\"#narrow/stream/458659-Equational/topic/Pruning.20counter.20examples.20based.20on.20implications/near/474259129\">said</a>:</p>\n<blockquote>\n<p>So do you know what this discrepancy is from? Is this expected, or not?</p>\n</blockquote>\n<p>Not an answer to your question, but I'm finding that it's difficult to keep track of my own sets of \"A =/&gt; B\" where as I process them I'm losing some refutations. This sadly isn't something Lean can help with (it'll only show the set we give it is correct, not that others could have been given), and I wonder if there's some process that would help make sure this happens less often. e.g., right now I'm going to try and find some problem where it looks like I've lost some 4x4 magmas along the way and I'm not sure where they went.</p>",
        "id": 474317633,
        "sender_full_name": "Nicholas Carlini",
        "timestamp": 1727880373
    }
]