[
    {
        "content": "<p>I'm trying to prove the following theorem, but I'm not sure how to formalize the proof in Lean.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">IsAcyclic_of_fromRel</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">^</span><span class=\"o\">[</span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">IsAcyclic</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">fromRel</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">generalize</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">fromRel</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">G</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">hp</span>\n\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>semi-formally, a proof is:<br>\nwe call the edges in the walk <code>(a, b)</code> up if <code>b = f a</code>, and down if <code>a = f b</code>. Note that a down edge can't be followed by an up edge, as that would violate <code>edges_nodup</code>. This means the walk can be split to some number of up edges followed by some number of down edges. If both numbers are positive then the first and last edges are equal, and otherwise <code>hf</code> implies that the walk must be empty, both of which give a contradiction.</p>\n<p>How could I formalize this proof, in particular the part of splitting the cycle to an up walk and a down walk?</p>",
        "id": 463630599,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1724142705
    },
    {
        "content": "<p>Perhaps I could use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.takeWhile#doc\">docs#List.takeWhile</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.dropWhile#doc\">docs#List.dropWhile</a> on <code>p.darts</code>?</p>",
        "id": 463633908,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1724143693
    },
    {
        "content": "<p>If you have a cycle starting at x  then you have a walk of some length n back to X, and therefore there exists an n <code>f^[n](x) = x</code>. And by hypothesis hf, you have a self loop. </p>\n<p>That being said, I don't understand what you mean by \"an up edge cannot be followed by a down edge\"</p>",
        "id": 463654362,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724147970
    },
    {
        "content": "<p>an edge could be both up and down if you have f(a) = b and f(b) = a.</p>",
        "id": 463657650,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724149028
    },
    {
        "content": "<p>The lemma seems to be mis-stated. Perhaps you want to add <code>0 &lt; n</code> as a hypothesis in <code>hf</code>? Right now, <code>hf</code> is equivalent to <code>forall x, f x = x</code> since substituting in <code>n = 0</code>, <code>f^[0] x = x</code> reduces to <code>x = x</code>.</p>",
        "id": 463763578,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1724174503
    },
    {
        "content": "<p>Yes, I fixed it and managed to prove it on <a href=\"https://github.com/leanprover-community/mathlib4/pull/16009\">#16009</a>, but it's very long and there are lemmas I need to move to other files</p>",
        "id": 463764039,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1724174639
    }
]