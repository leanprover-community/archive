[
    {
        "content": "<p>Does anyone have an idea about linting for unclosed sections? They are quite common in Mathlib, and they are tedious to encounter when doing minimizations.</p>",
        "id": 448502287,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1719896000
    },
    {
        "content": "<p>Oh, that's a challenge!</p>",
        "id": 448510477,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1719900581
    },
    {
        "content": "<p>Should they be closed at the end of file?</p>",
        "id": 448510568,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1719900618
    },
    {
        "content": "<p>They should be closed before the scope that contains them is closed. This containing scope could be a file/namespace/section.</p>",
        "id": 448510892,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1719900793
    },
    {
        "content": "<p>Ok, I meant to say \"they should be closed at the latest point where it is legal to do so\"?</p>",
        "id": 448510969,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1719900837
    },
    {
        "content": "<p>An alternative being \"the earliest place where the file still builds\".</p>",
        "id": 448511041,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1719900865
    },
    {
        "content": "<p>Well, I think you are going one step beyond, and thinking already about a refactor tool.<br>\nAs a first step it would of course already be useful to have the warning.</p>",
        "id": 448511608,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1719901062
    },
    {
        "content": "<p>Ok, I'll think about this.  I've been indeed also thinking of producing the refactor tool with every linter, but not actively writing one for every linter.</p>",
        "id": 448511943,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1719901157
    },
    {
        "content": "<p>I'll have to see how/if sections leave traces in <code>Scope</code> (or elsewhere).</p>",
        "id": 448512039,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1719901186
    },
    {
        "content": "<p>\"Anonymous\" sections (as in <code>section</code>) leave very little trace, while \"named\" sections (as in <code>section Easy_lemmas</code>) do modify the \"header\".  What do you think of linting against anonymous <code>section</code>s and then catching missing <code>end section</code>?</p>",
        "id": 448517561,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1719903037
    },
    {
        "content": "<p>How many anonymous sections are there in mathlib?<br>\nJust to be sure: you are proposing that they all become named, right?</p>",
        "id": 448518344,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1719903475
    },
    {
        "content": "<p>I have not checked how many unnamed sections there are and yes, the linter would ask to name them.</p>",
        "id": 448518475,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1719903514
    },
    {
        "content": "<p>Technically, this is not needed, as I can simply begin linting for the named ones and then think about the unnamed ones.</p>",
        "id": 448518530,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1719903534
    },
    {
        "content": "<p>However, unnamed sections are a little weird anyway...</p>",
        "id": 448518568,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1719903553
    },
    {
        "content": "<p>Please let's not do anything disruptive like forbidding anonymous sections!</p>",
        "id": 448518589,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1719903561
    },
    {
        "content": "<p>I just want to warn on unclosed sections (named or not) at EOF.</p>",
        "id": 448518657,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1719903595
    },
    {
        "content": "<p>The problem is that when minimising, we copy one file into another and unclosed sections need to be repaired.</p>",
        "id": 448518748,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1719903618
    },
    {
        "content": "<p>Ok, grepping suggests that there are close to 2k unnamed sections.  I will think of how to handle them without flagging them.</p>",
        "id": 448518999,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1719903721
    },
    {
        "content": "<p>You can probably write a simple-minded text-based linter for this, right? As in, ignore multi-line comments and keep a stack of all open sections and namespace, which you update as you encounter them. (No time until end of this week, but I could also try writing the latter.)</p>",
        "id": 448533453,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1719907925
    },
    {
        "content": "<p>Yes, I am trying exactly this at the moment.</p>",
        "id": 448543758,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1719910448
    },
    {
        "content": "<p>Oh, actually it seems that the only way to have open namespaces/sections is if they accumulate at the end of a file.  So the only thing to do is check that the last command of each file closes everything!</p>",
        "id": 448544219,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1719910587
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/287929-mathlib4/topic/linting.20for.20unclosed.20sections.3F/near/448518657\">said</a>:</p>\n<blockquote>\n<p>I just want to warn on unclosed sections (named or not) at EOF.</p>\n</blockquote>\n<p>Could this warning be built into lean core?</p>",
        "id": 448547822,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1719911620
    },
    {
        "content": "<p>It seems like the existing section elaborator would know if there are unclosed sections (it surely did in lean 3), and so it could emit the lint warning itself rather than in a dedicated linter</p>",
        "id": 448548010,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1719911675
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/287929-mathlib4/topic/linting.20for.20unclosed.20sections.3F/near/448518748\">said</a>:</p>\n<blockquote>\n<p>The problem is that when minimising, we copy one file into another and unclosed sections need to be repaired.</p>\n</blockquote>\n<p>An alternative solution would be to allow</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">outer</span>\n\n<span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">unclosed</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">outer</span>\n</code></pre></div>\n<p>which means you can assemble your mwe by adding <code>section my_file</code> around the entire file contents. This feels like something you might already want to do today to insulate <code>variable</code>s and <code>set_option</code>s</p>",
        "id": 448548490,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1719911791
    },
    {
        "content": "<p>I'd prefer not to touch any core behaviour here. This would add work for me rather than save it. I know Mario has expressed a desire for the opposite convention in Batteries (leave out all unnecessary <code>end</code> at EOF).</p>",
        "id": 448548923,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1719911911
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/14352\">#14352</a> -- let's see if it works!</p>",
        "id": 448585285,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1719920610
    },
    {
        "content": "<p>It looks like there might be ~1k files with missing <code>end</code>: should I add the ending <code>end</code>s?</p>",
        "id": 448590947,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1719922339
    },
    {
        "content": "<p>Ouch. I would like this, but maybe we should get some +1s before proceeding.</p>",
        "id": 448591699,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1719922578
    },
    {
        "content": "<p>I thought \"you don't have to end sections now\" was a feature not a bug, and IIRC this was the sort of change from Lean 3 that the devs were loving. Are we saying that this is no longer considered good style in mathlib?</p>",
        "id": 448594408,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1719923370
    },
    {
        "content": "<p>My understanding is that Mathlib has for the most part been closing sections, but that it has not been consistent.</p>",
        "id": 448594696,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1719923466
    },
    {
        "content": "<p>I think Damiano's number says that roughly 80% of files close their sections.</p>",
        "id": 448594741,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1719923486
    },
    {
        "content": "<p>keep in mind that 80% of files are from lean 3 which required sections to be closed</p>",
        "id": 448594775,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1719923508
    },
    {
        "content": "<p><code>noncomputable section</code> is not a section that should need to be closed</p>",
        "id": 448594856,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1719923525
    },
    {
        "content": "<p>It was easy enough to add the first layer of <code>end</code>: 936 files.</p>",
        "id": 448594941,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1719923556
    },
    {
        "content": "<p>Admittedly copilot usually manages to write the <code>end</code> statements for me when I am minimizing and this causes an error.</p>",
        "id": 448594942,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1719923556
    },
    {
        "content": "<p>surely copilot doesn't have enough context length to get <code>end</code> right?</p>",
        "id": 448595026,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1719923585
    },
    {
        "content": "<p>It reads the error message</p>",
        "id": 448595052,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1719923595
    },
    {
        "content": "<p>(I think???)</p>",
        "id": 448595089,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1719923606
    },
    {
        "content": "<p>ok we should clearly make autocomplete better there</p>",
        "id": 448595100,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1719923610
    },
    {
        "content": "<p>(also, my script is actually closing <code>noncomputable section</code>s, I think.)</p>",
        "id": 448595226,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1719923652
    },
    {
        "content": "<p>and we could definitely have a code action at global scope to close the last section/namespace</p>",
        "id": 448595227,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1719923654
    },
    {
        "content": "<p>(Btw, I am not particularly invested in this: I went for a quick hack to get missing <code>end</code>s and I do not have a strong opinion on whether I am happy or not with the change!)</p>",
        "id": 448595754,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1719923849
    },
    {
        "content": "<p>In case anyone is curious, the linter is happy with <a href=\"https://github.com/leanprover-community/mathlib4/pull/14352\">#14352</a></p>",
        "id": 448637219,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1719934342
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> how does this linter handle <code>noncomputable section</code>? Mario asked that that be allowed with a corresponding <code>end</code>, and this seems quite reasonable to me.</p>",
        "id": 448732337,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1719969175
    },
    {
        "content": "<p>The linter treats <code>noncomputable section</code> like any other <code>section</code> and asks to close it.</p>",
        "id": 448746963,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1719978162
    },
    {
        "content": "<p>What should it do with</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">section</span>\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">section</span>\n<span class=\"kn\">end</span>\n<span class=\"kn\">end</span>\n</code></pre></div>\n<p>?</p>\n<p>Are both final ends optional?  Or should only an \"outermost\" <code>noncomputable section</code> be allowed to not <code>end</code>?</p>",
        "id": 448747136,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1719978260
    },
    {
        "content": "<p>I adapted the linter.  The behaviour now should be that the linter asks to close all dangling <code>section</code>s/<code>namespace</code>s, with the exception of the \"outermost\" <code>noncomputable section</code>, regardless of whether or not it is named.</p>",
        "id": 448759748,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1719984432
    },
    {
        "content": "<p>I imagine that it is never the case that there is a <code>noncomputable section</code> nested inside a <code>noncomputable section</code>, but I am not sure and the linter does not check this.</p>",
        "id": 448759804,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1719984480
    },
    {
        "content": "<p>I am trying out the \"new\" linter that allows dangling <code>noncomputable section</code> to be left open in <a href=\"https://github.com/leanprover-community/mathlib4/pull/14378\">#14378</a>.</p>\n<p>There are only 200 files in <code>Mathlib/*</code> that need an <code>end</code> to please the \"<code>noncomputable</code>-admitting linter\", as opposed to the ~900 files that the stricter linter flagged.</p>",
        "id": 448781584,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1719993380
    },
    {
        "content": "<p>TIL: did you know that</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">.</span><span class=\"n\">B</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">B</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">A</span>\n</code></pre></div>\n<p>is valid?</p>",
        "id": 448781824,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1719993459
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/14378\">#14378</a> added <code>end</code>s to 212 files and passed CI.  No outmost open <code>noncomputable section</code> has been closed.</p>",
        "id": 448793037,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1719997090
    },
    {
        "content": "<p>I did! I think I used this behaviour exactly once so far, though <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 448796859,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1719998272
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/stream/287929-mathlib4/topic/linting.20for.20unclosed.20sections.3F/near/448781824\">said</a>:</p>\n<blockquote>\n<p>TIL: did you know that</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">.</span><span class=\"n\">B</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">B</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">A</span>\n</code></pre></div>\n<p>is valid?</p>\n</blockquote>\n<p>It works the other way around as well, I think. You can probably even <code>section a.b; section c.d.e; end a.b.c; end d.e</code> if you are feeling antisocial!</p>",
        "id": 448797203,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1719998362
    },
    {
        "content": "<p>an even more amusing variant of this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">section</span>\n<span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">Foo</span>\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"bp\">«».</span><span class=\"n\">Foo</span>\n</code></pre></div>",
        "id": 448806587,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1720000633
    },
    {
        "content": "<p>Btw, the linter is no longer going to allow this feature:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">section</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"kn\">section</span>\n</code></pre></div>",
        "id": 448854042,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1720014295
    },
    {
        "content": "<p>(Mathlib has this twice.)</p>",
        "id": 448854226,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1720014358
    },
    {
        "content": "<p>Given that this is silly and should be removed, I think it's great that we can lint for it!</p>",
        "id": 448907784,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1720026915
    },
    {
        "content": "<p>Is the consensus that the \"strict\" linter that also wants to close <code>noncomputable section</code>s is not desired?</p>\n<p>If this is the case, I will close that PR (<a href=\"https://github.com/leanprover-community/mathlib4/pull/14352\">#14352</a>) and leave just the one with the \"permissive\" linter (<a href=\"https://github.com/leanprover-community/mathlib4/pull/14378\">#14378</a>) and the discussion can continue about that one.</p>",
        "id": 448917552,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1720030097
    },
    {
        "content": "<p>I for one wouldn't mind requiring <code>noncomputable section</code> to be closed. But I don't have a strong opinion about it.</p>",
        "id": 449021961,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1720078712
    },
    {
        "content": "<p>The way the linter is set up, to not allow dangling <code>noncomputable section</code>s it suffices to remove <a href=\"https://github.com/leanprover-community/mathlib4/pull/14378/files#diff-58fcfeaf03590610a5fa5761814c31bca69c4dc9bfb2d97791579919cb880622R152\">this line</a> (and then deal with adding <code>end</code>s wherever the linter tells you to).</p>\n<p>As allowing dangling <code>noncomputable</code>s is probably less controversial than not allowing them, I have closed the other PR anyway.  I can always re-open it later, or simply remove the line, re-run the linter and the autocorrection and prepare a fresh one!</p>",
        "id": 449031328,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1720081253
    },
    {
        "content": "<p>Are there any more thoughts on <a href=\"https://github.com/leanprover-community/mathlib4/pull/14378\">#14378</a>?</p>\n<p>It is a bit insidious to maintain, since splitting a file need not trigger a merge conflict, but might make the linter unhappy with merging master.</p>",
        "id": 449512654,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1720280387
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"634338\">@Michael Rothgang</span> <span class=\"user-mention\" data-user-id=\"385895\">@Jon Eugster</span> could one of you maybe review this please?</p>",
        "id": 449523615,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1720283754
    },
    {
        "content": "<p>Sure - I'll try to review this by Wednesday. (Might happen sooner, but no promises: I'm decompressing from having my thesis submitted, so am taking things slightly slower.)</p>",
        "id": 449564611,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1720302773
    },
    {
        "content": "<p>I'm on vacation until the 18th, sorry. I'd take a look if it still remains open by then</p>",
        "id": 449789968,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1720422389
    },
    {
        "content": "<p>How do I disable this linter? I tried putting <code> ⟨</code>linter.endOf, false⟩<code> in </code>leanOptions` in my lakefile.lean, but that yielded</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">invalid</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"n\">parameter</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">unknown</span><span class=\"w\"> </span><span class=\"n\">configuration</span><span class=\"w\"> </span><span class=\"n\">option</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">endOf'</span>\n</code></pre></div>",
        "id": 451108843,
        "sender_full_name": "David Renshaw",
        "timestamp": 1720834926
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"243791\">David Renshaw</span> <a href=\"#narrow/stream/287929-mathlib4/topic/linting.20for.20unclosed.20sections.3F/near/451108843\">said</a>:</p>\n<blockquote>\n<p>How do I disable this linter? I tried putting <code> ⟨</code>linter.endOf, false⟩<code> in </code>leanOptions` in my lakefile.lean, but that yielded</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">invalid</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"n\">parameter</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">unknown</span><span class=\"w\"> </span><span class=\"n\">configuration</span><span class=\"w\"> </span><span class=\"n\">option</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">endOf'</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>You're in a project depending on mathlib, right? Short answer, as far as I know is \"lobby the lint author to restrict the lint to mathlib\".</p>",
        "id": 451109666,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1720835475
    },
    {
        "content": "<p>yes, for a project that depends on mathlib</p>",
        "id": 451109800,
        "sender_full_name": "David Renshaw",
        "timestamp": 1720835544
    },
    {
        "content": "<p>Longer answer: AFAIK, only built-in linters can be disabled in the lakefile (that's <a href=\"https://github.com/leanprover/lean4/pull/3403\">lean4#3403</a>, feel free to upvote if you care about this). The endOf linter is defined in mathlib, hence is not built in.</p>",
        "id": 451109877,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1720835588
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/14696\">#14696</a> deactivates the linter outside of mathlib - for discussion.<br>\nThat said: is simply complying by the linter onerous for you? <a href=\"https://github.com/leanprover-community/mathlib4/pull/14378\">#14378</a> has a shell script to automatically fix all errors.</p>",
        "id": 451113807,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1720837841
    },
    {
        "content": "<p>I ran that script and it added a bunch of spurious sorries</p>",
        "id": 451116898,
        "sender_full_name": "David Renshaw",
        "timestamp": 1720839100
    },
    {
        "content": "<p>in any file that had a sorry, it added its own sorry, causing an error</p>",
        "id": 451116974,
        "sender_full_name": "David Renshaw",
        "timestamp": 1720839122
    },
    {
        "content": "<p>This is in <a href=\"https://github.com/dwrensha/compfiles\">Compfiles</a>, where every file has a single namespace (so unclosed namespaces pose no danger to refactoring), and I want to avoid extra clutter</p>",
        "id": 451117179,
        "sender_full_name": "David Renshaw",
        "timestamp": 1720839206
    },
    {
        "content": "<p>The script was written assuming that the build would only report warnings from the linter.  I can adapt it to be more robust, if that is desirable, or, if you prefer to use <code>refactor</code>, a better solution would be using that.</p>",
        "id": 451117543,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1720839475
    },
    {
        "content": "<p>(The issue is that <code>refactor</code> is still a PR.)</p>",
        "id": 451117600,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1720839492
    },
    {
        "content": "<p>The script below should be more robust:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code><span class=\"nb\">eval</span><span class=\"w\"> </span><span class=\"s2\">\"</span><span class=\"k\">$(</span>\n<span class=\"w\">  </span>lake<span class=\"w\"> </span>build<span class=\"w\"> </span><span class=\"p\">|</span>\n<span class=\"w\">  </span>sed<span class=\"w\"> </span>-z<span class=\"w\"> </span><span class=\"s1\">'s=\\n\\nend=\\\\n\\\\nend=g; s='</span><span class=\"s2\">\"'\"</span><span class=\"s1\">'\\n=\\\\n&amp;=g'</span><span class=\"w\"> </span><span class=\"p\">|</span>\n<span class=\"w\">  </span>awk<span class=\"w\"> </span>-F:<span class=\"w\"> </span><span class=\"s1\">'/^warning.*unclosed sections or namespaces; expected:/ {</span>\n<span class=\"s1\">    line=$0</span>\n<span class=\"s1\">    gsub(/^.*unclosed sections or namespaces; expected: /, \"\", line)</span>\n<span class=\"s1\">    printf(\"printf %s &gt;&gt; %s\\n\", line, $2)</span>\n<span class=\"s1\">  }'</span>\n<span class=\"k\">)</span><span class=\"s2\">\"</span>\n</code></pre></div>",
        "id": 451119277,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1720841078
    },
    {
        "content": "<p>Thanks. That works, though I would still prefer to be able to disable the linter.</p>",
        "id": 451156278,
        "sender_full_name": "David Renshaw",
        "timestamp": 1720867920
    },
    {
        "content": "<p>I agree that it would be useful to set global options in projects: the issue about this is <a href=\"https://github.com/leanprover/lean4/pull/3403\">lean4#3403</a>.</p>",
        "id": 451165946,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1720872793
    },
    {
        "content": "<p>Thinking about this again, I'm still not very happy with the name <code>endOf</code>: what do you think about renaming it to <code>unclosedScope</code>? (Yes, the word \"scope\" is jargon, but I find the new name less cryptic that <code>endOf</code>.)</p>",
        "id": 451347658,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1720957751
    },
    {
        "content": "<p>I'm happy to change name, other options: <code>missingEnd</code> or <code>openSection</code> (even though a <code>namespace</code> might also be open)?</p>",
        "id": 451353692,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1720963141
    },
    {
        "content": "<p>Namespaces can also be open. <code>openSectionOrNamespace</code> feel a bit clunky for me.</p>",
        "id": 451356096,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1720965147
    },
    {
        "content": "<p>I like <code>missingEnd</code>.</p>",
        "id": 451359224,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1720967951
    },
    {
        "content": "<p>Filed <a href=\"https://github.com/leanprover-community/mathlib4/pull/14758\">#14758</a> doing the rename.</p>",
        "id": 451487929,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1721047062
    }
]