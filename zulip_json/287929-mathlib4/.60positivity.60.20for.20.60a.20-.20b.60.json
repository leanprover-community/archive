[
    {
        "content": "<p>What do we need to get the following to work?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">positivity</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">positivity</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">positivity</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">positivity</span>\n</code></pre></div>",
        "id": 537684539,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1756995674
    },
    {
        "content": "<p>We would have to implement <a href=\"https://github.com/leanprover-community/mathlib4/pull/2427\">#2427</a>. There is a student that is coming to Bonn in the fall, <span class=\"user-mention\" data-user-id=\"726531\">@Pan Lin</span>, that is working on this/planning to work on this.</p>",
        "id": 537685022,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1756995810
    },
    {
        "content": "<p>in <a href=\"https://github.com/leanprover-community/mathlib4/pull/2427\">#2427</a>, <span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span> suggests that the hypothesis <code>a &lt; b</code> needs to be explicitly passed to <code>positivity</code>, instead of being taken from the context. I don't really understand why we would treat these differently from the usual <code>0 &lt; x</code> hypotheses that are taken from the environment.</p>",
        "id": 537685897,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1756996028
    },
    {
        "content": "<p>Note that <a href=\"https://github.com/leanprover-community/mathlib/pull/16632\">!3#16632</a> was my implementation of the extension as you expect it, but <span class=\"user-mention\" data-user-id=\"260507\">@Heather Macbeth</span> argued that it wasn't \"structural\" and therefore shouldn't be an extension</p>",
        "id": 537686109,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1756996081
    },
    {
        "content": "<p>A use case I want is using <code>field_simp</code> on <code>x / ‖a - b‖</code>, with <code>h : a ≠ b</code> in the context.</p>",
        "id": 537687038,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1756996292
    },
    {
        "content": "<p>So if this isn't possible because it isn't \"structural\" then that is sad.</p>",
        "id": 537687284,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1756996348
    },
    {
        "content": "<p>I agree. I'm not the one that needs convincing <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span></p>",
        "id": 537690552,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1756997194
    },
    {
        "content": "<p>Oh and the same idea should work for <code>dist a b</code>, if <code>a ≠ b</code>.</p>",
        "id": 537691616,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1756997515
    },
    {
        "content": "<p>Actually, I can see Heather's point for the goal <code>0 &lt; a - b</code>, because then one could expect that it would try to (structurally) show that <code>a</code> is positive and <code>b</code> is negative. But my use case is for <code>a - b ≠ 0</code>. So maybe that can be a compromise: only use this to show nonzero-ness.</p>",
        "id": 537698353,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1756999299
    },
    {
        "content": "<p>I can see the theoretical argument against, but then there's the practical argument that it's be really nice to have this :)</p>",
        "id": 537702800,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1757000626
    },
    {
        "content": "<p>For now <code>bound</code> can do some of these (first two, not last two).</p>",
        "id": 537714086,
        "sender_full_name": "Geoffrey Irving",
        "timestamp": 1757004364
    },
    {
        "content": "<p>This is the second time someone suggested me <code>bound</code> over <code>positivity</code>. See also <a href=\"#narrow/channel/287929-mathlib4/topic/.60positivity.60.20for.20things.20at.20least.201/with/528564382\">https://leanprover.zulipchat.com/#narrow/channel/287929-mathlib4/topic/.60positivity.60.20for.20things.20at.20least.201/with/528564382</a></p>\n<p>It is unfortunate that there are two tactics for mostly the same thing. And <code>positivity</code> is the one used as a standard discharger.</p>",
        "id": 537741809,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1757015845
    },
    {
        "content": "<p>They do it in very different ways, and it appears to be very difficult to extend <code>positivity</code> to do things <code>bound</code> can easily do. Or at least blocked. :)</p>",
        "id": 537743639,
        "sender_full_name": "Geoffrey Irving",
        "timestamp": 1757016407
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"197836\">Jireh Loreaux</span> <a href=\"#narrow/channel/113488-general/topic/.22Missing.20Tactics.22.20list/near/516741394\">said</a>:</p>\n<blockquote>\n<p>I want a <code>positivity + gcongr + (limited) linarith</code> tactic (yes, I realize that <code>gcongr</code> calls <code>positivity</code> as a discharger). Potentially, this could be achieved with a <em>moderate</em> amount of scope creep for both <code>positivity</code> and <code>gcongr</code>, and I think it should not affect performance much if so. As an example of the kind of goal I would want it to solve, consider this (which I came across while reviewing a PR):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ht</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ht_pos</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">linarith</span>\n<span class=\"w\">  </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">mul_nonneg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">positivity</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">?_</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">sub_nonneg</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">gcongr</span>\n</code></pre></div>\n<p>My claim is that this expression is still \"structurally positive\" in some sense, and so should be solved by <code>positivity</code>. The idea is that <code>positivity</code> looks at this and applies <code>mul_nonneg</code>, then it shows <code>0 ≤ t ^ p</code> and it needs to show <code>0 ≤ t⁻¹ - (t + x)⁻¹</code>. It first looks in the local context for this, and if it were successful, it uses that (<code>positivity</code> of course already does this). Otherwise, it applies <code>sub_nonneg</code> and calls <code>gcongr</code> to solve <code>(t + x)⁻¹ ≤ t⁻¹</code>. Since both <code>gcongr</code> and <code>positivity</code> are fast tactics, this shouldn't be too burdensome, and it would only kick in when the default approach fails. Potentially, this could be a <code>positivity!</code> variant that appeals to this call to <code>gcongr</code>.</p>\n<p>However, in this case, <code>gcongr</code> fails because after applying <code>inv_anti₀</code> (calling <code>positivity</code> to solve the <code>0 ≤ t</code> goal), we're left with the goal <code>t ≤ t + x</code>, which is not a <code>gcongr</code> goal because the head symbols don't match. In truth, it's a <code>linarith</code> goal, but only one of the simplest kinds. In fact, if the goal were instead <code>t + 0 ≤ t + x</code>, then it <em>would</em> be a <code>gcongr</code> goal. </p>\n<p>In fact, this has bothered me several times (i.e., I have to apply <code>mul_one</code> or <code>one_mul</code> or <code>zero_add</code> or <code>add_zero</code> <em>in reverse</em>, which means I need to supply the argument, just so that I can apply <code>gcongr</code>). So, perhaps <code>gcongr</code> could, when the head expressions don't match, if the head expression  on one of the sides is <code>+</code> or <code>*</code> (or potentially any other operation with an identity) it checks to see if one of the arguments to this function is (reducibly) defeq to the one on the other side of the inequality, then it applies the appropriate identity lemma to turn it into a valid <code>gcongr</code> goal.</p>\n</blockquote>\n<p>I want to point out this message, because I think it points to exactly the kind of thing we'd be looking for. It is a terminal tactic that can do everything that <code>positivity</code> does and everything that <code>gcongr</code> does, and some things in between. It could for example have the lemma <code>le_add_left</code> be tagged. This isn't a <code>gcongr</code> lemma nor a <code>positivity</code> lemma, but something in between.</p>",
        "id": 537826135,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1757063436
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Shorten.20positivity/near/534313549\">said</a>:</p>\n<blockquote>\n<p>I'm still hoping we will get <code>grind</code> to cover everything <code>positivity</code> does</p>\n</blockquote>\n<p>Also, I'm not sure how seriously to take this.</p>",
        "id": 537826196,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1757063462
    },
    {
        "content": "<p>Note that now that we have <code>grw</code>, Jireh's example there is solved by</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ht</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ht_pos</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">grw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span>\n</code></pre></div>",
        "id": 537829451,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1757064519
    }
]