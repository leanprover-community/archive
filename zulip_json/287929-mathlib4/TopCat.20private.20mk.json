[
    {
        "content": "<p><code>TopCat</code> is defined in the following way in mathlib:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- The category of semirings. -/</span>\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">TopCat</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"bp\">::</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The underlying type. -/</span>\n<span class=\"w\">  </span><span class=\"n\">carrier</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">str</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">carrier</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>My question is: why is the <code>mk</code> made private here? A bit below a constructor <code>of</code> is defined as follows:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- The object in `TopCat` associated to a type equipped with the appropriate</span>\n<span class=\"sd\">typeclasses. This is the preferred way to construct a term of `TopCat`. -/</span>\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TopCat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">⟨</span><span class=\"n\">X</span><span class=\"bp\">⟩</span>\n</code></pre></div>\n<p>I do not see what the difference between <code>of</code> and <code>mk</code> is, so why is <code>mk</code> not just renamed to <code>of</code> (and not made private)?</p>",
        "id": 555563444,
        "sender_full_name": "Calle Sönne",
        "timestamp": 1763119285
    },
    {
        "content": "<p>I just made this <a href=\"https://github.com/leanprover-community/mathlib4/pull/31622\">#31622</a> to see what happens</p>",
        "id": 555568079,
        "sender_full_name": "Calle Sönne",
        "timestamp": 1763120865
    },
    {
        "content": "<p><code>TopCat.mk</code> has different parameters as implicit and explicit IIRC.</p>",
        "id": 555568159,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1763120891
    },
    {
        "content": "<p>It looks like both are explicit to me (I also thought this might be the case at first)</p>",
        "id": 555568278,
        "sender_full_name": "Calle Sönne",
        "timestamp": 1763120924
    },
    {
        "content": "<p>Ok, then I can't think of a reason either! :)</p>",
        "id": 555568419,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1763120969
    },
    {
        "content": "<p>If we do make this change, then we should do the same for other categories.</p>",
        "id": 555568581,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1763121021
    },
    {
        "content": "<p>For quite a few of these <code>Cat</code> structures there is a difference in implicit/explicit arguments. I think there is still a fix by writing specifying the explicit arguments via <code>of (..) ::</code> but this requires moving some variables into the structure declaration and there is a bunch of places where this could be done which seems very fiddly so I decided not to. Basically, I implemented this change only in files where it was trivial to do so, and mainly to prevent other people from becoming slightly confused like I did above.</p>",
        "id": 555573859,
        "sender_full_name": "Calle Sönne",
        "timestamp": 1763122717
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"132603\">Calle Sönne</span> <a href=\"#narrow/channel/287929-mathlib4/topic/TopCat.20private.20mk/near/555568278\">said</a>:</p>\n<blockquote>\n<p>It looks like both are explicit to me (I also thought this might be the case at first)</p>\n</blockquote>\n<p>Did this change? I am quite sure the difference in explicitness was the reason for the additional <code>of</code> constructor.</p>",
        "id": 555581707,
        "sender_full_name": "Christian Merten",
        "timestamp": 1763125328
    },
    {
        "content": "<p>This <a href=\"https://github.com/leanprover-community/mathlib4/pull/19065#discussion_r1847447502\">https://github.com/leanprover-community/mathlib4/pull/19065#discussion_r1847447502</a> is the corresponding discussion.</p>",
        "id": 555582006,
        "sender_full_name": "Christian Merten",
        "timestamp": 1763125421
    },
    {
        "content": "<p>I am confused:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">FooCat</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"bp\">::</span>\n<span class=\"w\">  </span><span class=\"n\">carrier</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">info: FooCat.of {X : Type} (carrier : Type) : FooCat X</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">FooCat</span><span class=\"bp\">.</span><span class=\"n\">of</span>\n</code></pre></div>\n<p>seems to suggest the explicitness is still the same (<code>X</code> is implicit, but it should be explicit).</p>",
        "id": 555582473,
        "sender_full_name": "Christian Merten",
        "timestamp": 1763125569
    },
    {
        "content": "<p>Oh, sorry. I understand now. This of course only matters for relative categories, but not for <code>TopCat</code> which does not have a parameter.</p>",
        "id": 555582776,
        "sender_full_name": "Christian Merten",
        "timestamp": 1763125657
    },
    {
        "content": "<p>Yeah exactly, I assume it's there because it was needed in a lot of other cases</p>",
        "id": 555582902,
        "sender_full_name": "Calle Sönne",
        "timestamp": 1763125698
    },
    {
        "content": "<p>Anyways the PR is ready to go now, it compiles and doesn't affect peformance.</p>",
        "id": 555583024,
        "sender_full_name": "Calle Sönne",
        "timestamp": 1763125742
    },
    {
        "content": "<p>I tried to do this once to another concrete category and the objection I got during the review was \"we prefer global uniformity over local optimisations\". Do we still care?</p>",
        "id": 555583476,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1763125885
    },
    {
        "content": "<p>I vote for caring because this made me confused enough to post on zulip. The other alternative is to add a docstring explaining why we do it this way.</p>",
        "id": 555583805,
        "sender_full_name": "Calle Sönne",
        "timestamp": 1763125979
    },
    {
        "content": "<p>Also I do think basically all of these cases can nowadays be made with the single constructor <code>of</code>. For example in <span class=\"user-mention\" data-user-id=\"648495\">@Christian Merten</span>s example above we can nowadays write:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">FooCat</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">::</span>\n<span class=\"w\">  </span><span class=\"n\">carrier</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n</code></pre></div>",
        "id": 555584059,
        "sender_full_name": "Calle Sönne",
        "timestamp": 1763126045
    },
    {
        "content": "<p>So we could have global uniformity, but I was not motivated enough to also do it in these slightly trickier cases (especially as it involves moving such parameters into the definition of the structure itself, this would not work if <code>X</code> was a variable).</p>",
        "id": 555584194,
        "sender_full_name": "Calle Sönne",
        "timestamp": 1763126085
    },
    {
        "content": "<p>Oh that is valid syntax now? Then I would vote for switching everything to <code>of ::</code>. I think it would be very useful to have the <code>⟨X⟩</code> notation available.</p>",
        "id": 555587335,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1763126911
    },
    {
        "content": "<p>Maybe I can try to fix this as well (but in another PR, as this one is getting merged)</p>",
        "id": 555608902,
        "sender_full_name": "Calle Sönne",
        "timestamp": 1763132239
    },
    {
        "content": "<p>oh wow this was my <a href=\"https://github.com/leanprover/lean4/pull/3574\">lean4#3574</a> and Eric's <a href=\"https://github.com/leanprover/lean4/pull/9072\">lean4#9072</a> , I also had not internalised that it actually existed now.</p>",
        "id": 555635157,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1763138918
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"439483\">Andrew Yang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/TopCat.20private.20mk/near/555587335\">said</a>:</p>\n<blockquote>\n<p>Oh that is valid syntax now? Then I would vote for switching everything to <code>of ::</code>. I think it would be very useful to have the <code>⟨X⟩</code> notation available.</p>\n</blockquote>\n<p>Is this supposed to work when you have multiple explicit arguments? For example take <code>AlgCat</code> where an algebra <code>X</code> also requires a base ring <code>R</code>. It seems to me that if I change <code>mk</code> to make <code>R</code> explicit then <code>⟨X⟩</code> fails (as it is now expecting two arguments). So my question is: is there syntax for using <code>⟨ ⟩</code> with multiple arguments?</p>",
        "id": 555638439,
        "sender_full_name": "Calle Sönne",
        "timestamp": 1763139941
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/TopCat.20private.20mk/near/555635157\">said</a>:</p>\n<blockquote>\n<p>oh wow this was my <a href=\"https://github.com/leanprover/lean4/pull/3574\">lean4#3574</a> and Eric's <a href=\"https://github.com/leanprover/lean4/pull/9072\">lean4#9072</a> , I also had not internalised that it actually existed now.</p>\n</blockquote>\n<p>This means we have been able to remove many typeclasses fields like <code>foo'</code>, see <a href=\"https://github.com/leanprover-community/mathlib4/pull/26468\">#26468</a> or <a href=\"https://github.com/leanprover-community/mathlib4/pull/26252\">#26252</a> for example.</p>",
        "id": 555642273,
        "sender_full_name": "Joël Riou",
        "timestamp": 1763141275
    },
    {
        "content": "<blockquote>\n<p>So my question is: is there syntax for using <code>⟨ ⟩</code> with multiple arguments?</p>\n</blockquote>\n<p>Did you try <code>⟨R, X⟩</code>? It's also possible to write <code>@⟨_, _⟩</code> but then you need to specify all implicit arguments. The <code>(_ := _)</code> syntax is probably not available for the anonymous constructor ⟨ ⟩.</p>",
        "id": 555643556,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1763141711
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"224323\">Junyan Xu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/TopCat.20private.20mk/near/555643556\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>So my question is: is there syntax for using <code>⟨ ⟩</code> with multiple arguments?</p>\n</blockquote>\n<p>Did you try <code>⟨R, X⟩</code>? It's also possible to write <code>@⟨_, _⟩</code> but then you need to specify all implicit arguments. The <code>(_ := _)</code> syntax is probably not available for the anonymous constructor ⟨ ⟩.</p>\n</blockquote>\n<p>Yes I did try <code>⟨R, X⟩</code>, which gives an error saying that the expected type is not inductive. <code>@⟨_, _⟩</code> also does not seem to work for similar reasons.</p>",
        "id": 555644678,
        "sender_full_name": "Calle Sönne",
        "timestamp": 1763142108
    },
    {
        "content": "<p>So do we need to make a new issue in Lean, since this notation doesn't work?</p>",
        "id": 555645248,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1763142353
    },
    {
        "content": "<p>Possibly yeah, but is it expected that it should work with multiple arguments like this? Should the expected behaviour be that writing <code>⟨ ⟩</code> makes the extra argument implicit (so that you only need to provide one thing)? Presumably when using this notation you know the target type (e.g. <code>AlgCat R</code>) so you should be able to infer <code>R</code>.</p>",
        "id": 555645788,
        "sender_full_name": "Calle Sönne",
        "timestamp": 1763142592
    },
    {
        "content": "<p>Yes, I would expect that changing implicitness in the constructor does not change the syntax of the (nameless) constructor notation.</p>",
        "id": 555683054,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1763156803
    }
]