[
    {
        "content": "<p>I'd like to start a discussion about the possible deprecation of the tactic <code>induction'</code> and its replacement with <code>induction</code> in Mathlib.</p>\n<p>Recently, I submitted a few PRs to replace usages of the tactic <code>induction'</code> with <code>induction</code> (with the plan of automating it via <code>lake exe refactor</code> in the medium term). The motivation behind this change was based on information I received from a few maintainers who suggested that <code>induction'</code> is soon to be deprecated and that <code>induction</code> should be used in all cases going forward (but of course I might have misunderstood completely). Moreover, in my experience with several PRs, reviewers have consistently recommended using <code>induction</code> over <code>induction'</code>, leading me to believe that this was the preferred practice and possibly the direction Mathlib was heading.</p>\n<p>However, during the review process of my latest <a href=\"https://github.com/leanprover-community/mathlib4/pull/16182\">PR</a>, it was pointed out by <span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span> that there might not be a consensus or a concrete plan to deprecate <code>induction'</code>. </p>\n<p>This raises a few questions in my opinion: </p>\n<ol>\n<li>Is there an official plan or ongoing discussion to deprecate <code>induction'</code> in favour of <code>induction</code>?</li>\n<li>Are there specific situations or cases where <code>induction'</code> is to be preferred or necessary over <code>induction</code>?</li>\n<li>More basically, what are the key differences between <code>induction</code> and <code>induction'</code>, and why might one be favoured over the other in practice?</li>\n</ol>",
        "id": 465553445,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1724789475
    },
    {
        "content": "<p>Controversial opinion: if we require <code>induction</code> in Mathlib, we should also change the standard recursor so that the case names are math-idiomatic:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"sd\">/-- Alternative recursor for `Nat` with idiomatic case names. -/</span>\n<span class=\"kd\">@[</span><span class=\"n\">elab_as_elim</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">induction_eliminator</span><span class=\"kd\">]</span>\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">recPretty</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">baseCase</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">inductiveStep</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">rec</span><span class=\"w\"> </span><span class=\"n\">baseCase</span><span class=\"w\"> </span><span class=\"n\">inductiveStep</span><span class=\"w\"> </span><span class=\"n\">t</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"o\">:</span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">∣</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">baseCase</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">decide</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">inductiveStep</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">IH</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ha</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">IH</span>\n<span class=\"w\">    </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">    </span><span class=\"n\">linear_combination</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">ha</span>\n</code></pre></div>",
        "id": 465559724,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1724791131
    },
    {
        "content": "<p>(But more seriously, I think there is probably no consensus on this, and no harm in allowing for author preference.)</p>",
        "id": 465560020,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1724791208
    },
    {
        "content": "<p>I would understand this request if we were stuck with <code>n.succ</code>, but this is no longer true. So I don’t quite understand. In a teaching context I would understand.</p>",
        "id": 465562575,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1724791664
    },
    {
        "content": "<p>I think we should switch to <code>induction</code>. As far as I know, the natural number case is the only one were <code>induction'</code> is not clearly worse, and consistency is nice.</p>",
        "id": 465562931,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1724791712
    },
    {
        "content": "<p>I prefer <code>induction</code>, certainly for new code, less strongly for large-scale refactors (because those are fairly disruptive)</p>",
        "id": 465563871,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1724791871
    },
    {
        "content": "<p>In <a href=\"https://github.com/leanprover-community/mathlib4/pull/16198\">#16198</a> I replace <code>induction'</code> and <code>cases'</code> in files that directly import <code>Tactic.Cases</code> so that that import may be removed. (Thus a file in the main folder, if it imports <code>Tactic.Cases</code>, now does so transitively by <code>Tactic.Common</code>)</p>",
        "id": 465566664,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1724792629
    },
    {
        "content": "<p>Is core willing to absorb <code>induction'</code>? My worry is something breaks it at some point and creates a significant burden on whomever has to fix it. The ergonomics seems within tolerance now.</p>",
        "id": 465569000,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1724793617
    },
    {
        "content": "<p>I would love it if we could get <code>induction'</code> to support a more rcases-like syntax, with <code>|</code> and possibly <code>\\&lt;\\&gt;</code>. I think that's the prinicpal readability issue with it, and making that modification wouldn't block its usage in NNG et al.</p>",
        "id": 465577889,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724796547
    },
    {
        "content": "<p>There are <strong>3672</strong> uses of <code>induction'</code> and <code>cases'</code> throughout the repository. It is feasible that we can replace them all with <code>induction/cases/rcases/obtain</code></p>",
        "id": 465602284,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1724808749
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"598052\">Jeremy Tan</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Deprecation.20and.20Replacement.20of.20.60induction'.60.3F/near/465602284\">said</a>:</p>\n<blockquote>\n<p>There are <strong>3672</strong> uses of <code>induction'</code> and <code>cases'</code> throughout the repository</p>\n</blockquote>\n<p>Regarding these uses: 60 are in my PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/16198\">#16198</a>, 75 are in my PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/16189\">#16189</a> and 41 are in Pietro's PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/16182\">#16182</a>. I have more removals stashed locally</p>",
        "id": 465812604,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1724863565
    },
    {
        "content": "<p>I'm surprised that we seem to be replacing <code>induction'</code> in dozens of files at a time without reaching a conclusion in this thread</p>",
        "id": 465939959,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1724919287
    },
    {
        "content": "<p>Here's my attempt at summarising</p>\n<ul>\n<li>it would be nice to have a variant of <code>induction'</code> that supports rcases-like syntax, but no one is actively working on this.</li>\n<li>there is some concern about the maintainability of <code>induction'</code></li>\n<li>there doesn't seem to be an urgent need to get rid of <code>induction'</code> or <code>cases'</code></li>\n<li>but there is little to no downside if someone wants to go to the effort of replacing them locally</li>\n</ul>",
        "id": 465946691,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724921085
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/iMRsEBB0mLZmlLhYkCGjF1CC/image.png\">image.png</a><br>\n<span aria-label=\"idea\" class=\"emoji emoji-1f4a1\" role=\"img\" title=\"idea\">:idea:</span></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/iMRsEBB0mLZmlLhYkCGjF1CC/image.png\" title=\"image.png\"><img data-original-dimensions=\"804x327\" src=\"/user_uploads/thumbnail/3121/iMRsEBB0mLZmlLhYkCGjF1CC/image.png/840x560.webp\"></a></div>",
        "id": 467408126,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1725423308
    },
    {
        "content": "<p>(Just joining this thread) One feature I noticed that <code>induction'</code> has that <code>induction</code> doesn't is <code>induction' h : x</code> syntax, which is useful if <code>x</code> isn't just a local variable. I think <code>induction</code> could support this syntax, so if refactoring is continuing, please be sure not to eliminate <code>induction' h : x</code>.</p>",
        "id": 467408571,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1725423605
    },
    {
        "content": "<p>My open PRs relating to this: <a href=\"https://github.com/leanprover-community/mathlib4/pull/16451\">#16451</a>, <a href=\"https://github.com/leanprover-community/mathlib4/pull/16250\">#16250</a>, <a href=\"https://github.com/leanprover-community/mathlib4/pull/16470\">#16470</a></p>",
        "id": 467409035,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1725423936
    }
]