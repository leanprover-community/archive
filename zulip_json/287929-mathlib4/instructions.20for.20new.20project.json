[
    {
        "content": "<p>I tried to follow the instructions for <a href=\"https://github.com/leanprover-community/mathlib4/wiki/Using-mathlib4-as-a-dependency\">Using mathlib4 as a dependency</a> and something didn't happen as indicated.<br>\nAfter the initial <code>lake +leanprover… new … math</code> command,  the <code>lake exe cache get</code> command gave me an error message, and I had to go straight away to the next phase, starting with <code>lake update</code>.<br>\nIs this normal?</p>",
        "id": 375701127,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1689497222
    },
    {
        "content": "<p>No, this isn't normal, you shouldn't see any error message. Could you tell us more about that error message?</p>",
        "id": 375701423,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1689497319
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">cloning</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github.com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4.git</span> <span class=\"n\">to</span> <span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"n\">lakefile.lean</span><span class=\"o\">:</span><span class=\"mi\">18</span><span class=\"o\">:</span><span class=\"mi\">2</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">unknown</span> <span class=\"kn\">attribute</span> <span class=\"o\">[</span><span class=\"kd\">def</span>\n<span class=\"n\">ault_target</span><span class=\"o\">]</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"n\">lakefile.lean</span><span class=\"o\">:</span><span class=\"mi\">22</span><span class=\"o\">:</span><span class=\"mi\">2</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">unknown</span> <span class=\"kn\">attribute</span> <span class=\"o\">[</span><span class=\"n\">default_target</span><span class=\"o\">]</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"n\">lakefile.lean</span><span class=\"o\">:</span> <span class=\"n\">package</span> <span class=\"n\">configuration</span> <span class=\"n\">has</span> <span class=\"n\">errors</span>\n</code></pre></div>",
        "id": 375701930,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1689497495
    },
    {
        "content": "<p>What does <code>elan show</code> say?</p>",
        "id": 375707147,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1689499170
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"o\">(</span><span class=\"mi\">10</span><span class=\"o\">:</span><span class=\"mi\">54</span><span class=\"o\">)</span> <span class=\"n\">pro</span><span class=\"bp\">-</span><span class=\"n\">acl</span> <span class=\"bp\">&gt;</span> <span class=\"n\">elan</span> <span class=\"k\">show</span>\n<span class=\"n\">installed</span> <span class=\"n\">toolchains</span>\n<span class=\"c1\">--------------------</span>\n\n<span class=\"n\">stable</span>\n<span class=\"n\">nightly</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">44</span><span class=\"bp\">.</span><span class=\"mi\">1</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">48</span><span class=\"bp\">.</span><span class=\"mi\">0</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">49</span><span class=\"bp\">.</span><span class=\"mi\">0</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">49</span><span class=\"bp\">.</span><span class=\"mi\">1</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">50</span><span class=\"bp\">.</span><span class=\"mi\">2</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">50</span><span class=\"bp\">.</span><span class=\"mi\">3</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">51</span><span class=\"bp\">.</span><span class=\"mi\">1</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">nightly</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">nightly</span><span class=\"bp\">-</span><span class=\"mi\">2022</span><span class=\"bp\">-</span><span class=\"mi\">12</span><span class=\"bp\">-</span><span class=\"mi\">13</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">nightly</span><span class=\"bp\">-</span><span class=\"mi\">2022</span><span class=\"bp\">-</span><span class=\"mi\">12</span><span class=\"bp\">-</span><span class=\"mi\">16</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">nightly</span><span class=\"bp\">-</span><span class=\"mi\">2023</span><span class=\"bp\">-</span><span class=\"mi\">02</span><span class=\"bp\">-</span><span class=\"mi\">04</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">nightly</span><span class=\"bp\">-</span><span class=\"mi\">2023</span><span class=\"bp\">-</span><span class=\"mi\">05</span><span class=\"bp\">-</span><span class=\"mi\">16</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">nightly</span><span class=\"bp\">-</span><span class=\"mi\">2023</span><span class=\"bp\">-</span><span class=\"mi\">05</span><span class=\"bp\">-</span><span class=\"mi\">31</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">nightly</span><span class=\"bp\">-</span><span class=\"mi\">2023</span><span class=\"bp\">-</span><span class=\"mi\">06</span><span class=\"bp\">-</span><span class=\"mi\">07</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">nightly</span><span class=\"bp\">-</span><span class=\"mi\">2023</span><span class=\"bp\">-</span><span class=\"mi\">06</span><span class=\"bp\">-</span><span class=\"mi\">10</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">nightly</span><span class=\"bp\">-</span><span class=\"mi\">2023</span><span class=\"bp\">-</span><span class=\"mi\">06</span><span class=\"bp\">-</span><span class=\"mi\">20</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">nightly</span><span class=\"bp\">-</span><span class=\"mi\">2023</span><span class=\"bp\">-</span><span class=\"mi\">07</span><span class=\"bp\">-</span><span class=\"mi\">12</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">stable</span> <span class=\"o\">(</span><span class=\"n\">default</span><span class=\"o\">)</span>\n\n<span class=\"n\">active</span> <span class=\"n\">toolchain</span>\n<span class=\"c1\">----------------</span>\n\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">nightly</span><span class=\"bp\">-</span><span class=\"mi\">2023</span><span class=\"bp\">-</span><span class=\"mi\">07</span><span class=\"bp\">-</span><span class=\"mi\">12</span> <span class=\"o\">(</span><span class=\"n\">overridden</span> <span class=\"kd\">by</span> <span class=\"bp\">'/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">chambert</span><span class=\"bp\">/</span><span class=\"n\">Documents</span><span class=\"bp\">/</span><span class=\"n\">Lean4</span><span class=\"bp\">/</span><span class=\"n\">Jordan</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">toolchain'</span><span class=\"o\">)</span>\n<span class=\"n\">Lean</span> <span class=\"o\">(</span><span class=\"n\">version</span> <span class=\"mi\">4</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">-</span><span class=\"n\">nightly</span><span class=\"bp\">-</span><span class=\"mi\">2023</span><span class=\"bp\">-</span><span class=\"mi\">07</span><span class=\"bp\">-</span><span class=\"mi\">12</span><span class=\"o\">,</span> <span class=\"n\">commit</span> <span class=\"mi\">6</span><span class=\"n\">e904421304c</span><span class=\"o\">,</span> <span class=\"n\">Release</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 375708948,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1689499727
    },
    {
        "content": "<p>(I'd be glad to be taught how to delete obsolete toolchains…)</p>",
        "id": 375709091,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1689499770
    },
    {
        "content": "<p>Curious. Old Lakes don't understand <code>[default_target]</code>, but apparently your Lake should not be old at all. What does <code>lake --version</code> say?</p>",
        "id": 375710767,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1689500237
    },
    {
        "content": "<p>I never know whether having stable as default is a bad idea. Isn't stable very old now?</p>",
        "id": 375721125,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1689503326
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"o\">(</span><span class=\"mi\">11</span><span class=\"o\">:</span><span class=\"mi\">28</span><span class=\"o\">)</span> <span class=\"n\">pro</span><span class=\"bp\">-</span><span class=\"n\">acl</span> <span class=\"bp\">&gt;</span> <span class=\"n\">lake</span> <span class=\"c1\">--version</span>\n<span class=\"n\">Lake</span> <span class=\"n\">version</span> <span class=\"mi\">4</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">-</span><span class=\"n\">pre</span> <span class=\"o\">(</span><span class=\"n\">Lean</span> <span class=\"n\">version</span> <span class=\"mi\">4</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">-</span><span class=\"n\">nightly</span><span class=\"bp\">-</span><span class=\"mi\">2023</span><span class=\"bp\">-</span><span class=\"mi\">07</span><span class=\"bp\">-</span><span class=\"mi\">12</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 375724049,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1689504316
    },
    {
        "content": "<p>When you are outside of that directory (e.g. in the parent directory) so <code>lake --version</code> say something else?</p>",
        "id": 375726621,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1689505067
    },
    {
        "content": "<p>(I'm imagining that an old <code>lake</code> was used to create the project, and so made a <code>lakefile.lean</code> with old syntax, but then once you're inside the project this is obscured because the <code>lean-toolchain</code> causes a newer <code>lake</code> to be used.)</p>",
        "id": 375726813,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1689505108
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"o\">(</span><span class=\"mi\">12</span><span class=\"o\">:</span><span class=\"mi\">59</span><span class=\"o\">)</span> <span class=\"n\">pro</span><span class=\"bp\">-</span><span class=\"n\">acl</span> <span class=\"bp\">&gt;</span> <span class=\"n\">pwd</span>\n<span class=\"bp\">/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">chambert</span><span class=\"bp\">/</span><span class=\"n\">Documents</span>\n<span class=\"o\">(</span><span class=\"mi\">13</span><span class=\"o\">:</span><span class=\"mi\">00</span><span class=\"o\">)</span> <span class=\"n\">pro</span><span class=\"bp\">-</span><span class=\"n\">acl</span> <span class=\"bp\">&gt;</span> <span class=\"n\">lake</span> <span class=\"c1\">--version</span>\n<span class=\"n\">Lake</span> <span class=\"n\">version</span> <span class=\"mi\">4</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">0</span> <span class=\"o\">(</span><span class=\"n\">Lean</span> <span class=\"n\">version</span> <span class=\"mi\">4</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"o\">,</span> <span class=\"n\">commit</span> <span class=\"mi\">7</span><span class=\"n\">dbfaf9b751917a7fe020485bf57f41fdddcaafa</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"mi\">13</span><span class=\"o\">:</span><span class=\"mi\">00</span><span class=\"o\">)</span> <span class=\"n\">pro</span><span class=\"bp\">-</span><span class=\"n\">acl</span> <span class=\"bp\">&gt;</span> <span class=\"n\">cd</span> <span class=\"n\">Lean4</span>\n<span class=\"o\">(</span><span class=\"mi\">13</span><span class=\"o\">:</span><span class=\"mi\">00</span><span class=\"o\">)</span> <span class=\"n\">pro</span><span class=\"bp\">-</span><span class=\"n\">acl</span> <span class=\"bp\">&gt;</span> <span class=\"n\">lake</span> <span class=\"c1\">--version</span>\n<span class=\"n\">Lake</span> <span class=\"n\">version</span> <span class=\"mi\">4</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">0</span> <span class=\"o\">(</span><span class=\"n\">Lean</span> <span class=\"n\">version</span> <span class=\"mi\">4</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"o\">,</span> <span class=\"n\">commit</span> <span class=\"mi\">7</span><span class=\"n\">dbfaf9b751917a7fe020485bf57f41fdddcaafa</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"mi\">13</span><span class=\"o\">:</span><span class=\"mi\">00</span><span class=\"o\">)</span> <span class=\"n\">pro</span><span class=\"bp\">-</span><span class=\"n\">acl</span> <span class=\"bp\">&gt;</span> <span class=\"n\">cd</span> <span class=\"n\">Jordan</span>\n<span class=\"o\">(</span><span class=\"mi\">13</span><span class=\"o\">:</span><span class=\"mi\">00</span><span class=\"o\">)</span> <span class=\"n\">pro</span><span class=\"bp\">-</span><span class=\"n\">acl</span> <span class=\"bp\">&gt;</span> <span class=\"n\">lake</span> <span class=\"c1\">--version</span>\n<span class=\"n\">Lake</span> <span class=\"n\">version</span> <span class=\"mi\">4</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">-</span><span class=\"n\">pre</span> <span class=\"o\">(</span><span class=\"n\">Lean</span> <span class=\"n\">version</span> <span class=\"mi\">4</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">-</span><span class=\"n\">nightly</span><span class=\"bp\">-</span><span class=\"mi\">2023</span><span class=\"bp\">-</span><span class=\"mi\">07</span><span class=\"bp\">-</span><span class=\"mi\">12</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 375727297,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1689505240
    },
    {
        "content": "<p>On the other hand : </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"o\">(</span><span class=\"mi\">13</span><span class=\"o\">:</span><span class=\"mi\">00</span><span class=\"o\">)</span> <span class=\"n\">pro</span><span class=\"bp\">-</span><span class=\"n\">acl</span> <span class=\"bp\">&gt;</span> <span class=\"n\">cd</span>\n<span class=\"o\">(</span><span class=\"mi\">13</span><span class=\"o\">:</span><span class=\"mi\">01</span><span class=\"o\">)</span> <span class=\"n\">pro</span><span class=\"bp\">-</span><span class=\"n\">acl</span> <span class=\"bp\">&gt;</span> <span class=\"n\">which</span> <span class=\"n\">lake</span>\n<span class=\"bp\">/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">chambert</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">lake</span>\n<span class=\"o\">(</span><span class=\"mi\">13</span><span class=\"o\">:</span><span class=\"mi\">01</span><span class=\"o\">)</span> <span class=\"n\">pro</span><span class=\"bp\">-</span><span class=\"n\">acl</span> <span class=\"bp\">&gt;</span> <span class=\"n\">cd</span> <span class=\"n\">Documents</span><span class=\"bp\">/</span><span class=\"n\">Lean4</span><span class=\"bp\">/</span><span class=\"n\">Jordan</span>\n<span class=\"o\">(</span><span class=\"mi\">13</span><span class=\"o\">:</span><span class=\"mi\">01</span><span class=\"o\">)</span> <span class=\"n\">pro</span><span class=\"bp\">-</span><span class=\"n\">acl</span> <span class=\"bp\">&gt;</span> <span class=\"n\">which</span> <span class=\"n\">lake</span>\n<span class=\"bp\">/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">chambert</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">lake</span>\n</code></pre></div>",
        "id": 375727468,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1689505295
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"130609\">@Antoine Chambert-Loir</span>, replying to something above, you can clean  up your toolchains by deleting some or all of <code>.elan/toolchain</code>.</p>",
        "id": 375728053,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1689505473
    },
    {
        "content": "<p>That commit is from a year ago, so perhaps this is the problem. I would at this point just recommend deleting <code>~/.elan</code>, reinstalling <code>elan</code>, and hoping that you can no longer reproduce the problem. :-)</p>",
        "id": 375728291,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1689505551
    },
    {
        "content": "<p>The core issue seems to be that the default toolchain somehow is used inside the project directory... sometimes. Updating or removing the default toolchain should not really solve the issue.</p>",
        "id": 375728695,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1689505675
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"130609\">@Antoine Chambert-Loir</span> I'm assuming <code>lake build</code> fails the same way? But <code>update</code> didn't? And all these were run from the same directory?</p>",
        "id": 375728844,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1689505706
    },
    {
        "content": "<p>I deleted my <code>.elan</code> directory, ran <code>brew upgrade elan</code> (because <code>elan self update</code> apparently does not work when <code>elan</code>has been installed by <code>brew</code>), and now everything works as indicated.</p>",
        "id": 375730842,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1689506311
    },
    {
        "content": "<p>Reviving this thread to report my experience with trying to follow <a href=\"https://github.com/leanprover-community/mathlib4/wiki/Using-mathlib4-as-a-dependency\">https://github.com/leanprover-community/mathlib4/wiki/Using-mathlib4-as-a-dependency</a>: After</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>&gt;<span class=\"w\"> </span>elan<span class=\"w\"> </span>self<span class=\"w\"> </span>update\ninfo:<span class=\"w\"> </span>checking<span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span>self-updates\ninfo:<span class=\"w\"> </span>downloading<span class=\"w\"> </span>self-update\ninfo:<span class=\"w\"> </span>elan<span class=\"w\"> </span>updated<span class=\"w\"> </span>successfully<span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"m\">2</span>.0.1\n&gt;<span class=\"w\"> </span>lake<span class=\"w\"> </span>+leanprover-community/mathlib4:lean-toolchain<span class=\"w\"> </span>new<span class=\"w\"> </span>seminar2023<span class=\"w\"> </span>math\ninfo:<span class=\"w\"> </span>downloading<span class=\"w\"> </span>component<span class=\"w\"> </span><span class=\"s1\">'lean'</span>\n<span class=\"m\">178</span>.9<span class=\"w\"> </span>MiB<span class=\"w\"> </span>/<span class=\"w\"> </span><span class=\"m\">178</span>.9<span class=\"w\"> </span>MiB<span class=\"w\"> </span><span class=\"o\">(</span><span class=\"m\">100</span><span class=\"w\"> </span>%<span class=\"o\">)</span><span class=\"w\">   </span><span class=\"m\">3</span>.0<span class=\"w\"> </span>MiB/s<span class=\"w\"> </span>ETA:<span class=\"w\">   </span><span class=\"m\">0</span><span class=\"w\"> </span>s\ninfo:<span class=\"w\"> </span>installing<span class=\"w\"> </span>component<span class=\"w\"> </span><span class=\"s1\">'lean'</span>\n&gt;<span class=\"w\"> </span><span class=\"nb\">cd</span><span class=\"w\"> </span>seminar2023/\nseminar2023&gt;<span class=\"w\"> </span>lake<span class=\"w\"> </span>exe<span class=\"w\"> </span>cache<span class=\"w\"> </span>get\n</code></pre></div>\n<p>I got the message</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>error:<span class=\"w\"> </span>dependency<span class=\"w\"> </span>mathlib<span class=\"w\"> </span>of<span class=\"w\"> </span>seminar2023<span class=\"w\"> </span>not<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>manifest,<span class=\"w\"> </span>use<span class=\"w\"> </span><span class=\"sb\">`</span>lake<span class=\"w\"> </span>update<span class=\"sb\">`</span><span class=\"w\"> </span>to<span class=\"w\"> </span>update\n</code></pre></div>\n<p>Then</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>seminar2023&gt;<span class=\"w\"> </span>lake<span class=\"w\"> </span>update\ncloning<span class=\"w\"> </span>https://github.com/leanprover-community/mathlib4.git<span class=\"w\"> </span>to<span class=\"w\"> </span>lake-packages/mathlib\nerror:<span class=\"w\"> </span>./lake-packages/mathlib/lakefile.lean:30:2:<span class=\"w\"> </span>error:<span class=\"w\"> </span><span class=\"s1\">'weakLeanArgs'</span><span class=\"w\"> </span>is<span class=\"w\"> </span>not<span class=\"w\"> </span>a<span class=\"w\"> </span>field<span class=\"w\"> </span>of<span class=\"w\"> </span>structure<span class=\"w\"> </span><span class=\"s1\">'Lake.LeanLibConfig'</span>\nerror:<span class=\"w\"> </span>./lake-packages/mathlib/lakefile.lean:53:2:<span class=\"w\"> </span>error:<span class=\"w\"> </span><span class=\"s1\">'weakLeanArgs'</span><span class=\"w\"> </span>is<span class=\"w\"> </span>not<span class=\"w\"> </span>a<span class=\"w\"> </span>field<span class=\"w\"> </span>of<span class=\"w\"> </span>structure<span class=\"w\"> </span><span class=\"s1\">'Lake.LeanLibConfig'</span>\nerror:<span class=\"w\"> </span>./lake-packages/mathlib/lakefile.lean:<span class=\"w\"> </span>package<span class=\"w\"> </span>configuration<span class=\"w\"> </span>has<span class=\"w\"> </span>errors\n</code></pre></div>\n<p>So I tried the next item on the list, which finally did work:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>seminar2023&gt;<span class=\"w\"> </span>curl<span class=\"w\"> </span>-L<span class=\"w\"> </span>https://raw.githubusercontent.com/leanprover-community/mathlib4/master/lean-toolchain<span class=\"w\"> </span>-o<span class=\"w\"> </span>lean-toolchain\n<span class=\"w\">  </span>%<span class=\"w\"> </span>Total<span class=\"w\">    </span>%<span class=\"w\"> </span>Received<span class=\"w\"> </span>%<span class=\"w\"> </span>Xferd<span class=\"w\">  </span>Average<span class=\"w\"> </span>Speed<span class=\"w\">   </span>Time<span class=\"w\">    </span>Time<span class=\"w\">     </span>Time<span class=\"w\">  </span>Current\n<span class=\"w\">                                 </span>Dload<span class=\"w\">  </span>Upload<span class=\"w\">   </span>Total<span class=\"w\">   </span>Spent<span class=\"w\">    </span>Left<span class=\"w\">  </span>Speed\n<span class=\"m\">100</span><span class=\"w\">    </span><span class=\"m\">28</span><span class=\"w\">  </span><span class=\"m\">100</span><span class=\"w\">    </span><span class=\"m\">28</span><span class=\"w\">    </span><span class=\"m\">0</span><span class=\"w\">     </span><span class=\"m\">0</span><span class=\"w\">    </span><span class=\"m\">300</span><span class=\"w\">      </span><span class=\"m\">0</span><span class=\"w\"> </span>--:--:--<span class=\"w\"> </span>--:--:--<span class=\"w\"> </span>--:--:--<span class=\"w\">   </span><span class=\"m\">304</span>\nseminar2023&gt;<span class=\"w\"> </span>lake<span class=\"w\"> </span>update\nmathlib:<span class=\"w\"> </span>URL<span class=\"w\"> </span>has<span class=\"w\"> </span>changed<span class=\"p\">;</span><span class=\"w\"> </span>deleting<span class=\"w\"> </span><span class=\"s1\">'./lake-packages/mathlib'</span><span class=\"w\"> </span>and<span class=\"w\"> </span>cloning<span class=\"w\"> </span>again\ncloning<span class=\"w\"> </span>https://github.com/leanprover-community/mathlib4.git<span class=\"w\"> </span>to<span class=\"w\"> </span>./lake-packages/mathlib\ncloning<span class=\"w\"> </span>https://github.com/EdAyers/ProofWidgets4<span class=\"w\"> </span>to<span class=\"w\"> </span>./lake-packages/proofwidgets\ncloning<span class=\"w\"> </span>https://github.com/mhuisi/lean4-cli.git<span class=\"w\"> </span>to<span class=\"w\"> </span>./lake-packages/Cli\ncloning<span class=\"w\"> </span>https://github.com/gebner/quote4<span class=\"w\"> </span>to<span class=\"w\"> </span>./lake-packages/Qq\ncloning<span class=\"w\"> </span>https://github.com/JLimperg/aesop<span class=\"w\"> </span>to<span class=\"w\"> </span>./lake-packages/aesop\ncloning<span class=\"w\"> </span>https://github.com/leanprover/std4<span class=\"w\"> </span>to<span class=\"w\"> </span>./lake-packages/std\nseminar2023&gt;<span class=\"w\"> </span>lake<span class=\"w\"> </span>exe<span class=\"w\"> </span>cache<span class=\"w\"> </span>get\ninfo:<span class=\"w\"> </span>Downloading<span class=\"w\"> </span>proofwidgets/v0.0.13/linux-64.tar.gz\ninfo:<span class=\"w\"> </span>Unpacking<span class=\"w\"> </span>proofwidgets/v0.0.13/linux-64.tar.gz\ninfo:<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">1</span>/9<span class=\"o\">]</span><span class=\"w\"> </span>Building<span class=\"w\"> </span>Cache.IO\ninfo:<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">2</span>/9<span class=\"o\">]</span><span class=\"w\"> </span>Compiling<span class=\"w\"> </span>Cache.IO\ninfo:<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">2</span>/9<span class=\"o\">]</span><span class=\"w\"> </span>Building<span class=\"w\"> </span>Cache.Hashing\ninfo:<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">3</span>/9<span class=\"o\">]</span><span class=\"w\"> </span>Compiling<span class=\"w\"> </span>Cache.Hashing\ninfo:<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">3</span>/9<span class=\"o\">]</span><span class=\"w\"> </span>Building<span class=\"w\"> </span>Cache.Requests\ninfo:<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">5</span>/9<span class=\"o\">]</span><span class=\"w\"> </span>Compiling<span class=\"w\"> </span>Cache.Requests\ninfo:<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">5</span>/9<span class=\"o\">]</span><span class=\"w\"> </span>Building<span class=\"w\"> </span>Cache.Main\ninfo:<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">7</span>/9<span class=\"o\">]</span><span class=\"w\"> </span>Compiling<span class=\"w\"> </span>Cache.Main\ninfo:<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">9</span>/9<span class=\"o\">]</span><span class=\"w\"> </span>Linking<span class=\"w\"> </span>cache\nleantar<span class=\"w\"> </span>is<span class=\"w\"> </span>too<span class=\"w\"> </span>old<span class=\"p\">;</span><span class=\"w\"> </span>downloading<span class=\"w\"> </span>more<span class=\"w\"> </span>recent<span class=\"w\"> </span>version\nAttempting<span class=\"w\"> </span>to<span class=\"w\"> </span>download<span class=\"w\"> </span><span class=\"m\">3683</span><span class=\"w\"> </span>file<span class=\"o\">(</span>s<span class=\"o\">)</span>\nDownloaded:<span class=\"w\"> </span><span class=\"m\">3683</span><span class=\"w\"> </span>file<span class=\"o\">(</span>s<span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span>attempted<span class=\"w\"> </span><span class=\"m\">3683</span>/3683<span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">100</span>%<span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"m\">100</span>%<span class=\"w\"> </span>success<span class=\"o\">)</span>\nDecompressing<span class=\"w\"> </span><span class=\"m\">3683</span><span class=\"w\"> </span>file<span class=\"o\">(</span>s<span class=\"o\">)</span>\nunpacked<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"m\">10652</span><span class=\"w\"> </span>ms\n</code></pre></div>\n<p>Is this normal (this is on Linux OpenSuSE Tumbleweed)? If so, it would help to modify the instructions accordingly.</p>",
        "id": 387693826,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1693236725
    },
    {
        "content": "<p>I see slightly different results (on macos):</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">%</span> <span class=\"n\">elan</span> <span class=\"c1\">--version</span>\n<span class=\"n\">elan</span> <span class=\"mi\">2</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">1</span> <span class=\"o\">(</span> <span class=\"o\">)</span>\n<span class=\"bp\">%</span> <span class=\"n\">lake</span> <span class=\"bp\">+</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"o\">:</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">toolchain</span> <span class=\"n\">new</span> <span class=\"n\">seminar2023</span> <span class=\"n\">math</span>\n<span class=\"bp\">%</span> <span class=\"n\">cd</span> <span class=\"n\">seminar2023</span>\n<span class=\"bp\">%</span> <span class=\"n\">lake</span> <span class=\"n\">exe</span> <span class=\"n\">cache</span> <span class=\"n\">get</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">no</span> <span class=\"n\">default</span> <span class=\"n\">toolchain</span> <span class=\"n\">configured.</span> <span class=\"n\">run</span> <span class=\"bp\">`</span><span class=\"n\">elan</span> <span class=\"n\">default</span> <span class=\"n\">nightly</span><span class=\"bp\">`</span> <span class=\"n\">to</span> <span class=\"n\">install</span> <span class=\"bp\">&amp;</span> <span class=\"n\">configure</span> <span class=\"n\">the</span> <span class=\"n\">latest</span> <span class=\"n\">Lean</span> <span class=\"mi\">4</span> <span class=\"n\">nightly</span> <span class=\"n\">release.</span>\n<span class=\"bp\">%</span> <span class=\"n\">elan</span> <span class=\"n\">default</span> <span class=\"n\">nightly</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">syncing</span> <span class=\"n\">channel</span> <span class=\"n\">updates</span> <span class=\"n\">for</span> <span class=\"bp\">'</span><span class=\"n\">nightly'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">latest</span> <span class=\"n\">update</span> <span class=\"n\">on</span> <span class=\"n\">nightly</span><span class=\"o\">,</span> <span class=\"n\">lean</span> <span class=\"n\">version</span> <span class=\"n\">nightly</span><span class=\"bp\">-</span><span class=\"mi\">2023</span><span class=\"bp\">-</span><span class=\"mi\">08</span><span class=\"bp\">-</span><span class=\"mi\">28</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">downloading</span> <span class=\"n\">component</span> <span class=\"bp\">'</span><span class=\"n\">lean'</span>\n<span class=\"n\">Total</span><span class=\"o\">:</span> <span class=\"mi\">174</span><span class=\"bp\">.</span><span class=\"mi\">4</span> <span class=\"n\">MiB</span> <span class=\"n\">Speed</span><span class=\"o\">:</span>  <span class=\"mi\">10</span><span class=\"bp\">.</span><span class=\"mi\">7</span> <span class=\"n\">MiB</span><span class=\"bp\">/</span><span class=\"n\">s</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">installing</span> <span class=\"n\">component</span> <span class=\"bp\">'</span><span class=\"n\">lean'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">default</span> <span class=\"n\">toolchain</span> <span class=\"n\">set</span> <span class=\"n\">to</span> <span class=\"bp\">'</span><span class=\"n\">nightly'</span>\n\n  <span class=\"n\">nightly</span> <span class=\"n\">installed</span> <span class=\"bp\">-</span> <span class=\"n\">Lean</span> <span class=\"o\">(</span><span class=\"n\">version</span> <span class=\"mi\">4</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">-</span><span class=\"n\">nightly</span><span class=\"bp\">-</span><span class=\"mi\">2023</span><span class=\"bp\">-</span><span class=\"mi\">08</span><span class=\"bp\">-</span><span class=\"mi\">28</span><span class=\"o\">,</span> <span class=\"n\">commit</span> <span class=\"mi\">7</span><span class=\"n\">ee7595637dc</span><span class=\"o\">,</span> <span class=\"n\">Release</span><span class=\"o\">)</span>\n\n<span class=\"bp\">%</span> <span class=\"n\">lake</span> <span class=\"n\">exe</span> <span class=\"n\">cache</span> <span class=\"n\">get</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">dependency</span> <span class=\"bp\">'</span><span class=\"n\">mathlib'</span> <span class=\"n\">of</span> <span class=\"bp\">'</span><span class=\"n\">seminar2023'</span> <span class=\"n\">not</span> <span class=\"k\">in</span> <span class=\"n\">manifest</span><span class=\"o\">,</span> <span class=\"n\">use</span> <span class=\"bp\">`</span><span class=\"n\">lake</span> <span class=\"n\">update</span><span class=\"bp\">`</span> <span class=\"n\">to</span> <span class=\"n\">update</span>\n<span class=\"bp\">%</span> <span class=\"n\">lake</span> <span class=\"n\">update</span>\n<span class=\"n\">cloning</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github.com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4.git</span> <span class=\"n\">to</span> <span class=\"bp\">./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span>\n<span class=\"n\">cloning</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github.com</span><span class=\"bp\">/</span><span class=\"n\">EdAyers</span><span class=\"bp\">/</span><span class=\"n\">ProofWidgets4</span> <span class=\"n\">to</span> <span class=\"bp\">./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">proofwidgets</span>\n<span class=\"n\">cloning</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github.com</span><span class=\"bp\">/</span><span class=\"n\">mhuisi</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"bp\">-</span><span class=\"n\">cli.git</span> <span class=\"n\">to</span> <span class=\"bp\">./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">Cli</span>\n<span class=\"n\">cloning</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github.com</span><span class=\"bp\">/</span><span class=\"n\">gebner</span><span class=\"bp\">/</span><span class=\"n\">quote4</span> <span class=\"n\">to</span> <span class=\"bp\">./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">Qq</span>\n<span class=\"n\">cloning</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github.com</span><span class=\"bp\">/</span><span class=\"n\">JLimperg</span><span class=\"bp\">/</span><span class=\"n\">aesop</span> <span class=\"n\">to</span> <span class=\"bp\">./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">aesop</span>\n<span class=\"n\">cloning</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github.com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">std4</span> <span class=\"n\">to</span> <span class=\"bp\">./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">std</span>\n</code></pre></div>",
        "id": 387788013,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1693272925
    },
    {
        "content": "<p>I would have hoped that <code>lake +leanprover-community/mathlib4:lean-toolchain new seminar2023 math</code> would create a directory containing a <code>lean-toolchain</code>, but apparently it doesn't.</p>",
        "id": 387788116,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1693272965
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span> do you have a suggestion here? Clearly something, instructions or otherwise, needs fixing here.</p>",
        "id": 387788149,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1693272989
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Scott Morrison</span> I have not been able to get <code>lake +leanprover-community/mathlib4:lean-toolchain</code> working on my system -- even in WSL -- despite elan claiming to be on version 2.0.1, so I can't test this at the moment. However, the only reason Lake should skip creating a <code>lean-toolchain</code> toolchain is if the <code>Lean.toolchain</code> of the Lean Lake was built with was not set to anything.</p>",
        "id": 387789247,
        "sender_full_name": "Mac Malone",
        "timestamp": 1693273519
    },
    {
        "content": "<p>One thing to check is what does <code>echo \"#eval Lean.toolchain\" | lean +leanprover-community/mathlib4:lean-toolchain --stdin</code> give?</p>",
        "id": 387789510,
        "sender_full_name": "Mac Malone",
        "timestamp": 1693273644
    },
    {
        "content": "<p>Indeed:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>%<span class=\"w\"> </span><span class=\"nb\">echo</span><span class=\"w\"> </span><span class=\"s2\">\"#eval Lean.toolchain\"</span><span class=\"w\"> </span><span class=\"p\">|</span><span class=\"w\"> </span>lean<span class=\"w\"> </span>+leanprover-community/mathlib4:lean-toolchain<span class=\"w\"> </span>--stdin\n<span class=\"s2\">\"\"</span>\n</code></pre></div>",
        "id": 387789556,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1693273672
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>%<span class=\"w\"> </span>lean<span class=\"w\"> </span>--version\nLean<span class=\"w\"> </span><span class=\"o\">(</span>version<span class=\"w\"> </span><span class=\"m\">4</span>.0.0-nightly-2023-08-28,<span class=\"w\"> </span>commit<span class=\"w\"> </span>7ee7595637dc,<span class=\"w\"> </span>Release<span class=\"o\">)</span>\n</code></pre></div>",
        "id": 387789641,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1693273696
    },
    {
        "content": "<p>So a problem in how we release nightlies?</p>",
        "id": 387789785,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1693273783
    },
    {
        "content": "<p>what does <code>lean +leanprover-community/mathlib4:lean-toolchain --version</code> give?</p>",
        "id": 387789789,
        "sender_full_name": "Mac Malone",
        "timestamp": 1693273787
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>%<span class=\"w\"> </span>lean<span class=\"w\"> </span>+leanprover-community/mathlib4:lean-toolchain<span class=\"w\"> </span>--version\nLean<span class=\"w\"> </span><span class=\"o\">(</span>version<span class=\"w\"> </span><span class=\"m\">4</span>.0.0,<span class=\"w\"> </span>commit<span class=\"w\"> </span>216d2460e0ad,<span class=\"w\"> </span>Release<span class=\"o\">)</span>\n</code></pre></div>",
        "id": 387789894,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1693273824
    },
    {
        "content": "<p>And what does<code> echo \"#eval Lean.toolchain\" | lean --stdin</code> give.</p>",
        "id": 387789914,
        "sender_full_name": "Mac Malone",
        "timestamp": 1693273835
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>%<span class=\"w\"> </span><span class=\"nb\">echo</span><span class=\"w\"> </span><span class=\"s2\">\"#eval Lean.toolchain\"</span><span class=\"w\"> </span><span class=\"p\">|</span><span class=\"w\"> </span>lean<span class=\"w\"> </span>--stdin\n<span class=\"s2\">\"leanprover/lean4:nightly-2023-08-28\"</span>\n</code></pre></div>",
        "id": 387789997,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1693273874
    },
    {
        "content": "<p>Ok, so your system Lean is fine. The <code>mathlib4:lean-toolchain</code> Lean is not properly versioned however.</p>",
        "id": 387790047,
        "sender_full_name": "Mac Malone",
        "timestamp": 1693273904
    },
    {
        "content": "<p>It could be because it is uses <code>rc?</code> and that did not get versioned correctly when built.</p>",
        "id": 387790180,
        "sender_full_name": "Mac Malone",
        "timestamp": 1693273954
    },
    {
        "content": "<p>Last night I moved Mathlib's <code>lean-toolchain</code> to </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">%</span> <span class=\"n\">cat</span> <span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">toolchain</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4.0.0</span><span class=\"bp\">-</span><span class=\"n\">rc2</span>\n</code></pre></div>",
        "id": 387790405,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1693274066
    },
    {
        "content": "<p>Yeah, it seems that the rc2 release tag was not built with proper version information. How was it built?</p>",
        "id": 387790617,
        "sender_full_name": "Mac Malone",
        "timestamp": 1693274184
    },
    {
        "content": "<p>The \"usual\" way: I just pushed a tag to <code>leanprover/lean</code> and waited for CI.</p>",
        "id": 387790657,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1693274214
    },
    {
        "content": "<p>Oh, yeah, that will not work. That will create a source build.</p>",
        "id": 387790691,
        "sender_full_name": "Mac Malone",
        "timestamp": 1693274234
    },
    {
        "content": "<p>Note the <a href=\"https://github.com/leanprover/lean4/blob/f7bff16c9a36baa91847cfb2f609084a43bcc9a1/.github/workflows/ci.yml#L35\"><code>LEAN_VERSION_STRING=...</code></a> in the CI for nightly builds.</p>",
        "id": 387790880,
        "sender_full_name": "Mac Malone",
        "timestamp": 1693274331
    },
    {
        "content": "<p>I think it is </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"k\">if</span> <span class=\"o\">[[</span> <span class=\"bp\">-</span><span class=\"n\">n</span> <span class=\"bp\">'$</span><span class=\"o\">{{</span> <span class=\"n\">matrix.release</span> <span class=\"o\">}}</span><span class=\"bp\">'</span> <span class=\"bp\">&amp;&amp;</span> <span class=\"bp\">-</span><span class=\"n\">n</span> <span class=\"bp\">'$</span><span class=\"o\">{{</span> <span class=\"n\">needs.set</span><span class=\"bp\">-</span><span class=\"n\">nightly.outputs.nightly</span> <span class=\"o\">}}</span><span class=\"bp\">'</span> <span class=\"o\">]]</span><span class=\"bp\">;</span> <span class=\"k\">then</span>\n  <span class=\"n\">OPTIONS</span><span class=\"bp\">+=</span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"n\">DLEAN_SPECIAL_VERSION_DESC</span><span class=\"bp\">=$</span><span class=\"o\">{{</span> <span class=\"n\">needs.set</span><span class=\"bp\">-</span><span class=\"n\">nightly.outputs.nightly</span> <span class=\"o\">}})</span>\n<span class=\"n\">fi</span>\n</code></pre></div>\n<p>where it actually happens.</p>",
        "id": 387791117,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1693274452
    },
    {
        "content": "<p>Interesting, looking back, some the old milestone releases also don't have proper version info (e.g., <code>m4</code>).</p>",
        "id": 387791156,
        "sender_full_name": "Mac Malone",
        "timestamp": 1693274466
    },
    {
        "content": "<p>If we want tags to work, the CI will need to parse the tag and set the relevant version definitions accordingly.</p>",
        "id": 387791448,
        "sender_full_name": "Mac Malone",
        "timestamp": 1693274614
    },
    {
        "content": "<p>Yes. I think I want this to be driven by pushing a tag. So the CI needs some work today. :-)</p>",
        "id": 387791568,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1693274668
    },
    {
        "content": "<p>Okay, I've written said CI in <a href=\"https://github.com/leanprover/lean4/pull/2472\">lean4#2472</a>.</p>",
        "id": 387794899,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1693276612
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"479359\">@Michael Stoll</span>, thank you very much for your bug report (even if we are actually solving a different problem by now!), and sorry for hijacking your thread.</p>",
        "id": 387795031,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1693276694
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Scott Morrison</span> No problem; it wasn't my thread to begin with...</p>",
        "id": 387895761,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1693319849
    }
]