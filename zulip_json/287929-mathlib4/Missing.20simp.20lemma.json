[
    {
        "content": "<p>Note the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"c1\">-- leaves `2⁻¹ + 2⁻¹ = 1`</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"n\">one_div</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"c1\">-- succeeds using `add_halves`</span>\n</code></pre></div>\n<p>So it seems that we need <code>2⁻¹ + 2⁻¹ = 1</code> as a simp lemma. It currently exists only for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ENNReal#doc\">docs#ENNReal</a> , for whatever strange reason:</p>\n<p><span class=\"user-mention\" data-user-id=\"644391\">@loogle</span> 2⁻¹ + 2⁻¹ = 1</p>",
        "id": 525220141,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1750607592
    },
    {
        "content": "<p><span aria-label=\"search\" class=\"emoji emoji-1f50d\" role=\"img\" title=\"search\">:search:</span> <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/ENNReal/Inv.html#ENNReal.inv_two_add_inv_two\">ENNReal.inv_two_add_inv_two</a></p>",
        "id": 525220142,
        "sender_full_name": "loogle",
        "timestamp": 1750607594
    },
    {
        "content": "<p><code>norm_num</code> should be sufficient, no?</p>",
        "id": 525220205,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1750607692
    },
    {
        "content": "<p>But we still want <code>simp</code> to be confluent.</p>",
        "id": 525220217,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1750607712
    },
    {
        "content": "<p>Yeah, good point</p>",
        "id": 525220225,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1750607723
    },
    {
        "content": "<p>Yeah we should probably have <code>2⁻¹ + 2⁻¹ = 1</code> and <code>3⁻¹ + 3⁻¹ + 3⁻¹ = 1</code> corresponding to <code>add_halves</code> and <code>add_thirds</code></p>",
        "id": 525220306,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1750607846
    },
    {
        "content": "<p>Apparently asking that simp be confluent is asking too much in general?</p>",
        "id": 525221906,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1750609857
    },
    {
        "content": "<p>It is, but we should still aim for it</p>",
        "id": 525222423,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1750610543
    },
    {
        "content": "<p>I got annoyed that <code>sin (π / 2) = 1</code> but <code>sin (π * 2⁻¹) = 1</code> wasn't so I filed <a href=\"https://github.com/leanprover-community/mathlib4/pull/25912\">#25912</a> and <span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span>  suggested I could try making  the reverse of <code>div_eq_mul_inv</code> a simp lemma. <del>This would mean that <code>2⁻¹</code> would simplify to <code>1 / 2</code></del>. Perhaps at that point we could make <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Field/Basic.html#div_add_div_same\">div_add_div_same</a> a simp lemma to make <code>2⁻¹ + 2⁻¹ -&gt; 1/2 + 1/2 -&gt; 1+1/2 -&gt; 1</code> happen automatically.</p>",
        "id": 525223477,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1750611952
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"282271\">Bolton Bailey</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Missing.20simp.20lemma/near/525223477\">said</a>:</p>\n<blockquote>\n<p>This would mean that <code>2⁻¹</code> would simplify to <code>1 / 2</code>.</p>\n</blockquote>\n<p>What?</p>",
        "id": 525223592,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1750612116
    },
    {
        "content": "<p>Oh sorry, maybe I am still stuck on my earlier misunderstanding of what you were saying, you were saying that <code>a * b.inv</code> should simplify to <code>a / b</code>, but that <code>a.inv</code> shouldn't simplify to <code>1/a</code> right? My bad.</p>",
        "id": 525223695,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1750612252
    },
    {
        "content": "<p>Anyway, I had thought it was cleaner to make <code>a⁻¹</code> simplify to <code>1 / a</code>, which would just remove expressions involving <code>⁻¹</code> from simp normal form entirely. I guess this would mean making <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Group/Defs.html#inv_eq_one_div\">inv_eq_one_div</a> simp too</p>",
        "id": 525223965,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1750612559
    },
    {
        "content": "<p>Yes, no, that's a step too far IMO</p>",
        "id": 525224217,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1750612880
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Missing.20simp.20lemma/near/525221906\">said</a>:</p>\n<blockquote>\n<p>Apparently asking that simp be confluent is asking too much in general?</p>\n</blockquote>\n<p>Why?</p>",
        "id": 525224541,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1750613338
    },
    {
        "content": "<p>Yeah I was surprised by this but a few months ago I was suggesting some trig lemmas to make simp confluent and this was the response I got. I can't find the thread right now because I'm travelling and on mobile which no longer has a search function?</p>",
        "id": 525224640,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1750613455
    },
    {
        "content": "<p>I deliberately blocked the update to the new mobile Zulip because of teething issues like that (and losing LaTeX). Their release notes tell you how to manually install the old version</p>",
        "id": 525225986,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1750615302
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"282271\">Bolton Bailey</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Missing.20simp.20lemma/near/525223965\">said</a>:</p>\n<blockquote>\n<p>I guess this would mean making <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Group/Defs.html#inv_eq_one_div\">inv_eq_one_div</a> simp too</p>\n</blockquote>\n<p>I think we should make it simp in the reverse direction</p>",
        "id": 525226074,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1750615374
    },
    {
        "content": "<p>The <code>one_div</code>s are quite annoying when using PiLp</p>",
        "id": 525226114,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1750615403
    },
    {
        "content": "<p>I think either way we'll end up having to change/add a lot of simp lemmas</p>",
        "id": 525226137,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1750615428
    },
    {
        "content": "<p>I don't see the harm of starting with 2^-1 + 2^-1 = 1</p>",
        "id": 525226151,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1750615438
    }
]