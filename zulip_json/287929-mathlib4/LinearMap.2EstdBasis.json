[
    {
        "content": "<p>Still trying to explain linear algebra, I have to face the canonical basis mess. Part of this mess comes from infinite dimensional vector spaces. I think there is not much we can do about the parallel existence of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Finsupp.basisSingleOne#doc\">docs#Finsupp.basisSingleOne</a><br>\nand <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Pi.basisFun#doc\">docs#Pi.basisFun</a> since in general functions and finitely supported functions are different types (but those two declarations could have more similar names and cross reference each others in their docstrings). However there is also <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearMap.stdBasis#doc\">docs#LinearMap.stdBasis</a> whose name is infinitely more discoverable than the other two but simply has nothing to do with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Basis#doc\">docs#Basis</a> (which should probably be in the <code>Module</code> namespace by the way). </p>\n<p>Does anyone has comments about this before I try to open a PR? A suggestion for a better name for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearMap.stdBasis#doc\">docs#LinearMap.stdBasis</a> would be fantastic.</p>",
        "id": 457515331,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723152073
    },
    {
        "content": "<p>We could just delete <code>LinearMap.stdBasis</code>, as it's already just a synonym for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearMap.single#doc\">docs#LinearMap.single</a></p>",
        "id": 457515510,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723152159
    },
    {
        "content": "<p>Maybe the naming there isn't ideal either, but it's at least used consistently with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AddMonoidHom.single#doc\">docs#AddMonoidHom.single</a> etc</p>",
        "id": 457515554,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723152183
    },
    {
        "content": "<p>Grepping suggests this is used a lot in Mathlib, so it won’t be fun, but it seems very reasonable (and gets rid of the super confusing name).</p>",
        "id": 457515978,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723152383
    },
    {
        "content": "<p>I wasn't brave enough to remove stdBasis when I cleaned up all the other <code>single</code> API in mathlib 3, so good luck!</p>",
        "id": 457516216,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723152509
    },
    {
        "content": "<p>I guess we now have deprecations, which we didn't at the time.</p>",
        "id": 457516241,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723152527
    },
    {
        "content": "<p>The painful part is that the duplicated declaration have (again) different implicit arguments.</p>",
        "id": 459422354,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723196183
    },
    {
        "content": "<p>They also have different simp-normal forms I think</p>",
        "id": 459423153,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723196404
    },
    {
        "content": "<p>How far is <code>lake exe refactor</code> from allowing to change a binder type? I want <code>lake exe refactor \"make φ explicit in LinearMap.single\"</code>.</p>",
        "id": 459423951,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723196673
    },
    {
        "content": "<p>I am not yet familiar with large scale uses of <code>deprecated</code>. What should I do with the statements all the duplicated lemmas. You I restate them in terms of the new definition or silence the deprecated linter and keep their old statements?</p>",
        "id": 459424528,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723196861
    },
    {
        "content": "<p>I think the idea is to make the change that doesn't break existing downstream code; so silence the linter and keep their old statements, applying <code>@[deprecated]</code> to those too</p>",
        "id": 459427252,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723197579
    },
    {
        "content": "<p>Let me check I understand before modifying hundreds of lines. Should the new beginning of the stdBasis file be</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- The standard basis of the product of `φ`. -/</span>\n<span class=\"kd\">@[</span><span class=\"n\">deprecated</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">single</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">since</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"08/09/2024\"</span><span class=\"o\">)</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">stdBasis</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">φ</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">→ₗ</span><span class=\"o\">[</span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">φ</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">single</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">φ</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">deprecated</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kd\">@[</span><span class=\"n\">deprecated</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">single_apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">since</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"08/09/2024\"</span><span class=\"o\">)</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">stdBasis_apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">φ</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stdBasis</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">φ</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">update</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">φ</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">deprecated</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">deprecated</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">single_apply'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">since</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"08/09/2024\"</span><span class=\"o\">)</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">stdBasis_apply'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">i'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">stdBasis</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">i'</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">ite</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">i'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">stdBasis_apply</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">update_apply</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Pi</span><span class=\"bp\">.</span><span class=\"n\">zero_apply</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">congr</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">eq_iff_iff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">eq_comm</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 459427851,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723197716
    },
    {
        "content": "<p>The date format should be <code>\"2024-08-09\"</code>, but otherwise that looks right to me</p>",
        "id": 459429261,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723197988
    },
    {
        "content": "<p>(I didn't think a year in the US would be enough for you to switch to their date format!)</p>",
        "id": 459429551,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723198037
    },
    {
        "content": "<p>I tried switching, I put the month before the day!</p>",
        "id": 459429961,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723198097
    },
    {
        "content": "<p>Some of these lemmas might not be worth copying across to <code>LinearMap.single</code> at all; you could argue that the API should only be about unfolding to <code>Pi.single</code>, and let the <code>Pi.single</code> lemmas take it from there.</p>",
        "id": 459430103,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723198123
    },
    {
        "content": "<p>What should I do with lemmas that I don’t copy?</p>",
        "id": 459430198,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723198151
    },
    {
        "content": "<p><code>stdBasis_apply'</code>could have <code>@[deprecated \"use `LinearMap.single_apply` then `Pi.single_apply` instead\"]</code> or similar</p>",
        "id": 459430526,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723198240
    },
    {
        "content": "<p>And do you agree that I should make <code>R</code> and <code>φ</code> explicit in <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearMap.single#doc\">docs#LinearMap.single</a> ?</p>",
        "id": 459430586,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723198256
    },
    {
        "content": "<p>That sounds reasonable to me</p>",
        "id": 459430689,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723198279
    },
    {
        "content": "<p>It matches <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MonoidHom.single#doc\">docs#MonoidHom.single</a></p>",
        "id": 459430704,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723198286
    },
    {
        "content": "<p>It also matches <code>stdBasis</code>…</p>",
        "id": 459430846,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723198332
    },
    {
        "content": "<p>I opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/15660\">#15660</a>, but I’m not yet sure it will pass CI.</p>",
        "id": 459573115,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723235889
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> <a href=\"https://github.com/leanprover-community/mathlib4/pull/15660\">#15660</a> is now ready for review (and touches 21 files).</p>",
        "id": 459690762,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723293208
    },
    {
        "content": "<p>I left a few comments, all on the same idea</p>",
        "id": 459691646,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723293653
    },
    {
        "content": "<p>Note that I didn’t introduce any lemma in this PR, so everything that you find strange was already strange (but this is not an argument to keep it).</p>",
        "id": 459692749,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723294492
    },
    {
        "content": "<p>I am not super convinced that every lemma should be a simp lemma. The changes that you suggest would make rewriting with <code>rw</code> impossible.</p>",
        "id": 459692923,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723294535
    },
    {
        "content": "<p>I mean the changes where <code>LinearMap.single</code> appear in LHS.</p>",
        "id": 459693187,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723294612
    },
    {
        "content": "<p>That being said I don’t have any strong feeling here (except of course the feeling that <code>stdBasis</code> is a horribly confusing name).</p>",
        "id": 459693225,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723294653
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/stream/287929-mathlib4/topic/LinearMap.2EstdBasis/near/459692749\">said</a>:</p>\n<blockquote>\n<p>(but this is not an argument to keep it).</p>\n</blockquote>\n<p>I suppose it might be an argument to declare it out of scope for your PR</p>",
        "id": 459693481,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723294824
    },
    {
        "content": "<blockquote>\n<p>The changes that you suggest would make rewriting with <code>rw</code> impossible.</p>\n</blockquote>\n<p>it would just mean to have to start by rewriting with <code>LinearMap.coe_single</code></p>",
        "id": 459693517,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723294856
    },
    {
        "content": "<p>That’s true.</p>",
        "id": 459693545,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723294879
    },
    {
        "content": "<p>But I suspect that most of the proofs that would need to do that would no longer need to if their statement was also changed to use <code>Pi.single</code></p>",
        "id": 459693573,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723294902
    },
    {
        "content": "<p>Maybe I should simply try to implement those suggestions and see how they affect existing proofs.</p>",
        "id": 459693586,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723294915
    },
    {
        "content": "<p>I am a bit tired of this PR, but this is useful maintenance work.</p>",
        "id": 459693646,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723294950
    },
    {
        "content": "<p>I pushed a commit with those suggestions, we’ll see how CI likes it.</p>",
        "id": 459696366,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723296346
    },
    {
        "content": "<p>I pushed a few more</p>",
        "id": 459711157,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723302854
    },
    {
        "content": "<p>CI will surely be unhappy, but I think the fixes downstream will be trivial</p>",
        "id": 459712114,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723303155
    },
    {
        "content": "<p>Eric, are you still working on this or should I continue this effort?</p>",
        "id": 459731192,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723311027
    },
    {
        "content": "<p>Sorry, was offline for a bit. Feel free to push as needed to fix CI issues if I don't get there first</p>",
        "id": 459746788,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723317607
    },
    {
        "content": "<p>Could you cleanup the docstring in StdBasis.lean to reflect what you want to write about in MIL?</p>",
        "id": 459746874,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723317645
    },
    {
        "content": "<p>In the mean time I got required by my family. I am not sure when I'll be available again.</p>",
        "id": 459758224,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723322572
    },
    {
        "content": "<p>Nevermind, I just pushed the removal of <code>stdBasis</code> from the docstring</p>",
        "id": 459758354,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723322719
    },
    {
        "content": "<p>I think this is probably ready to go now, but you should look over the changes I pushed</p>",
        "id": 459758364,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723322728
    },
    {
        "content": "<p>Great! Thanks for all your help!</p>",
        "id": 459874528,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723372854
    },
    {
        "content": "<p>Will <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix.stdBasisMatrix#doc\">docs#Matrix.stdBasisMatrix</a> be next to fall?</p>",
        "id": 459881051,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723374980
    },
    {
        "content": "<p>That one is much less surprising.</p>",
        "id": 459887020,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723379687
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/15693\">#15693</a> has a small related cleanup</p>",
        "id": 459888153,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723380649
    },
    {
        "content": "<p>(it had a TODO suggesting we reintroduce <code>stdBasis</code> as <code>std_basis_vec</code>!)</p>",
        "id": 459888173,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723380674
    }
]