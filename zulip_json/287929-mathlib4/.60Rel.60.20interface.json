[
    {
        "content": "<p>This describes a couple of suggestions for the <code>Rel</code> API. If (variations on) any of these are useful, I would be happy to implement them.</p>\n<ol>\n<li>\n<p>According to its documentation, <code>Rel α β</code> also represents set-valued functions. While these are definitionally equal, using <code>Rel α β</code> = <code>α → β → Prop</code> as <code>α → Set β</code> conflates sets with predicates. Would adding simple functions to convert between them, such as <code>Rel.imageAt : Rel α β → α → Set β</code> and <code>Set.memAt : (α → Set β) → Rel α β</code> (dually <code>Rel.preimageAt : Rel α β → β → Set α</code> and <code>Set.memAtInv : (α → Set β) → Rel β α</code>), be useful?</p>\n</li>\n<li>\n<p><code>Function.graph</code>, which returns a relation, is inconsistent with similar functions in other namespaces:</p>\n<ul>\n<li>In <code>PFun</code>, <code>graph</code> returns a set of pairs and <code>graph'</code> returns a <code>Rel</code>.</li>\n<li>In <code>LinearMap</code>, <code>LinearPMap</code>, <code>Finsupp</code>, and <code>Tuple</code>, <code>graph</code> returns a collection of pairs.</li>\n<li>In <code>Set</code>, <code>graphOn</code> returns a set of pairs.</li>\n</ul>\n<p>In my experience, the graph of a function usually refers to a set of pairs, which is consistent with all of the above except <code>Function.graph</code>. Would having <code>Function.graph</code> return a set of pairs and <code>Function.graph'</code> return a relation, like <code>PFun</code>, be a good idea? I am not familiar enough with the category theory library to know if this would cause problems there. In the same vein, adding <code>Rel.graph : Rel α β → Set (α × β)</code> and  <code>Set.graph' : Set (α × β) → Rel α β</code> seems useful.</p>\n</li>\n<li>\n<p>Currently, <code>Rel</code> only has instances for <code>CompleteLattice</code> and <code>Inhabited</code>. There are other relevant typeclasses, for instance <code>CompleteAtomicBooleanLattice</code> and <code>CanLift</code>, that it could have instances of.</p>\n</li>\n</ol>",
        "id": 478598022,
        "sender_full_name": "Evan Bailey",
        "timestamp": 1729725345
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"516492\">Evan Bailey</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60Rel.60.20interface/near/478598022\">said</a>:</p>\n<blockquote>\n<p>Would adding simple functions to convert between them, such as <code>Rel.imageAt : Rel α β → α → Set β</code> and <code>Set.memAt : (α → Set β) → Rel α β</code></p>\n</blockquote>\n<p>I think these would normally be written <code>{b | r a b}</code> and <code>(· ∈ f ·)</code> respectively.</p>",
        "id": 478598976,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729725915
    },
    {
        "content": "<p>But also, I don't really understand what the API of <code>Rel</code> is supposed to be; unlike <code>Set</code> it doesn't introduce a new kind of notation for evaluation, so it looks like it could be demoted to an <code>abbrev</code> or dropped entirely</p>",
        "id": 478599085,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729725984
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60Rel.60.20interface/near/478598976\">said</a>:</p>\n<blockquote>\n<p>I think these would normally be written <code>{b | r a b}</code> and <code>(· ∈ f ·)</code> respectively.</p>\n</blockquote>\n<p>That's true, but the same could be said for <code>Function.graph</code> (<code>(f · = ·)</code>), <code>Set.preimage</code> (<code>{x | f x ∈ ·}</code>), etc.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60Rel.60.20interface/near/478599085\">said</a>:</p>\n<blockquote>\n<p>But also, I don't really understand what the API of <code>Rel</code> is supposed to be; unlike <code>Set</code> it doesn't introduce a new kind of notation for evaluation, so it looks like it could be demoted to an <code>abbrev</code> or dropped entirely</p>\n</blockquote>\n<p>I can't speak to its use in the category theory library, but outside that, this makes sense. The common notation <code>↠</code> or <code>⇉</code> for set-valued functions could be added at some point (it isn't hard to implement) and composition already exists, but none of those require <code>Rel</code> to exist.</p>\n<p>Regardless, relations are common enough that even if <code>Rel</code> as a type doesn't need to exist, it seems that some version of the functions in the <code>Rel</code> namespace should.</p>",
        "id": 478601455,
        "sender_full_name": "Evan Bailey",
        "timestamp": 1729727469
    },
    {
        "content": "<p>I agree with Eric. Can't we just remove <code>Rel</code></p>",
        "id": 478636598,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1729748811
    },
    {
        "content": "<p>To clarify, is the suggestion just to remove the type <code>Rel</code> and some unnecessary definitions or the <code>Rel</code> namespace as a whole?</p>\n<p>It seems that the two typeclass instances and <code>inv</code> (<code>flip</code> exists) would become unnecessary (barring the latter being used in category theory). The rest seem useful enough to be kept in some form.</p>\n<p>Also, I would imagine that converting between set-valued functions, sets of pairs, and relations is common enough that some version of the conversion functions I mentioned in (1.) could still be useful.</p>\n<p>For an example application, I'm currently working on a result in topology involving a correspondence. The correspondence must be closed as a set of ordered pairs and obey certain properties pointwise as a set-valued function. It would be a lot nicer to state these as e.g. <code>IsClosed (Rel.graph r)</code> and <code>∀ x, ContractibleSpace ↥(Rel.imageAt r x)</code> instead of <code>IsClosed {(x, y) | r x y}</code> or <code>∀ x, ContractibleSpace {y // r x y}</code>. The former has (slightly) less mental overhead and makes it less likely that different results will express common properties in different ways.</p>",
        "id": 478752480,
        "sender_full_name": "Evan Bailey",
        "timestamp": 1729786188
    },
    {
        "content": "<p>Given that <code>(Rel.graph r)</code> is not much shorter to type than <code>{(a, b) | r a b}</code>, I think it can go away</p>",
        "id": 478767489,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1729791137
    },
    {
        "content": "<p>To clarify, <code>Rel.graph</code> doesn't currently exist; it was a suggestion. If <code>Rel</code> is being removed anyway, I suppose that does make the suggestion unnecessary, since the most significant benefit would have been dot-access.</p>\n<p>Also, does changing either <code>Function.graph</code> or <code>PFun.graph</code> and <code>PFun.graph'</code> to be consistent seem reasonable?</p>",
        "id": 478768441,
        "sender_full_name": "Evan Bailey",
        "timestamp": 1729791517
    },
    {
        "content": "<p>I had never seen <code>Rel</code> before. I thought we were all in agreement that <code>α → β → Prop</code> was the way to denote relations.</p>",
        "id": 478782034,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1729796978
    },
    {
        "content": "<p>I'm not even opposed to changing all the instances of <code>α → β → Prop</code> into <code>Rel α β</code>, but that seems like a huge refactor with dubious benefits besides \"beginners have one small thing less to worry about\"</p>",
        "id": 478782178,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1729797022
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"516492\">Evan Bailey</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60Rel.60.20interface/near/478768441\">said</a>:</p>\n<blockquote>\n<p>To clarify, <code>Rel.graph</code> doesn't currently exist; it was a suggestion. If <code>Rel</code> is being removed anyway, I suppose that does make the suggestion unnecessary, since the most significant benefit would have been dot-access.</p>\n<p>Also, does changing either <code>Function.graph</code> or <code>PFun.graph</code> and <code>PFun.graph'</code> to be consistent seem reasonable?</p>\n</blockquote>\n<p>There's also <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Set.graphOn#doc\">docs#Set.graphOn</a> to consider. I've seen people use <code>Set.graphOn f univ</code> for the graph of <code>f</code>. Maybe we should introduce <code>Set.graph</code> in its place and deprecate <code>Function.graph</code> entirely?</p>",
        "id": 478783117,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1729797440
    },
    {
        "content": "<p><code>PFun.graph</code> can stay as is</p>",
        "id": 478783127,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1729797446
    }
]