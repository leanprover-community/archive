[
    {
        "content": "<p>there's <a href=\"https://github.com/leanprover-community/mathlib4/pull/22517\">#22517</a> but from what I can gather from an old topic on here it seems to have been abandoned for performance reasons as well as that it is rather annoying to have another power to implement everywhere. has anyone been thinking about new approaches since then/is the old one still considered more-or-less viable? I'd like to work on some semigroup theory but it's quite hard without basics like this nailed down</p>",
        "id": 539097995,
        "sender_full_name": "Uni Marx",
        "timestamp": 1757691313
    },
    {
        "content": "<p>+1, I recently \"gave up\" on formalizing a big results because it was a bunch of terrible working with semigroup powers. (We're proving a weaker result that it's only true on monoids.)</p>",
        "id": 539109274,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1757693156
    },
    {
        "content": "<p>I wonder whether we should just basically merge <a href=\"https://github.com/leanprover-community/mathlib4/pull/22517\">#22517</a> and take the hit.</p>",
        "id": 539144549,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1757702412
    },
    {
        "content": "<p>I think this is a good opportunity to unbundle <code>npow</code> from <code>Monoid</code>.</p>",
        "id": 539149392,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1757704636
    },
    {
        "content": "<p>I think there needn't be any change to existing classes: you can just define <code>class SemigroupPNatPow</code> like the <code>class MonoidNPow</code> I extract <a href=\"https://github.com/leanprover-community/mathlib4/pull/29605/files#diff-b0633945066967f025793780617bc4bf036f0f076b498290a1db92acdb2b0f90R580-R586\">here</a>.</p>",
        "id": 539153490,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1757706582
    },
    {
        "content": "<p>the issue with that is that it's a bit unclear (at least to me) where to insert the extra [MonoidNPow] hypothesis for defeq or extensionality reasons</p>",
        "id": 539153850,
        "sender_full_name": "Uni Marx",
        "timestamp": 1757706771
    },
    {
        "content": "<p>you write <br>\n<code>theorem blah [Monoid M] (x : M) : x^n = 1</code> and specialize it to the integers or whatever, then get potentially confused about mismatching instances, right? not as huge of a deal for semigroups since PNat powers are going to be way less prevalent, but important to keep in mind</p>",
        "id": 539154215,
        "sender_full_name": "Uni Marx",
        "timestamp": 1757706948
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=NatPow#doc\">docs#NatPow</a></p>",
        "id": 539154759,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1757707181
    },
    {
        "content": "<p>What about it?</p>",
        "id": 539155155,
        "sender_full_name": "Uni Marx",
        "timestamp": 1757707349
    },
    {
        "content": "<p>what's the argument for unbundling npow from Monoid?</p>",
        "id": 539159520,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757709486
    },
    {
        "content": "<p>I think there is little value beyond unbundling the data. I started an attempt at factoring out as a parent <a href=\"https://github.com/leanprover-community/mathlib4/pull/29482\">29482</a> but then noticed that elaboration helper class in core.</p>",
        "id": 539159549,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1757709501
    },
    {
        "content": "<p>Inlined data is more likely to get unfolded unnecessarily.</p>",
        "id": 539160128,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1757709796
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Any.20news.20on.20semigroup.20powers.3F/near/539144549\">said</a>:</p>\n<blockquote>\n<p>I wonder whether we should just basically merge <a href=\"https://github.com/leanprover-community/mathlib4/pull/22517\">#22517</a> and take the hit.</p>\n</blockquote>\n<p>It's picked up conflicts <del>with Kim's work to use a repeated-squaring power implementation by default</del></p>",
        "id": 539165573,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757712791
    },
    {
        "content": "<p>Is it understood what causes the big performace hit?</p>",
        "id": 540581096,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1758370280
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"306577\">@Matthew Ballard</span> said on GitHub:</p>\n<blockquote>\n<p>I wonder if extending a new PNatPow class would be better. I have been playing around with this for Monoid but don't have the bandwidth to get things building completely. This might be a more targeted test ground.</p>\n</blockquote>\n<p>Why do you think this would be significantly better?</p>",
        "id": 540585730,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1758374785
    },
    {
        "content": "<p>Iâ€™ve seen these provided as inlined lambdas for the existing pow fields. Those can be more aggressively unfolded. Separately, when autoparams inject something compared to you building it by hand, Lean might need to work to figure they are defeq. </p>\n<p>Will it be significantly better? Probably not. Most likely it just becomes another field that needs to be checked when Lean has to unify two instances. </p>\n<p>Why does it end up here so often? Better diagnostics would be nice. </p>\n<p>Even so gating data carrying stuff to be filled out by typeclass synthesis with actual classes seems like good hygiene regardless. Autoparams can be set in the child classes if desired.</p>",
        "id": 540590004,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1758379156
    }
]