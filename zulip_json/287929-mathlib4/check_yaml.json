[
    {
        "content": "<p>In <a href=\"https://github.com/leanprover-community/mathlib4/pull/18884\">#18884</a>, the <code>check_yaml.sh</code> script failed me, apparently because I used 4 levels of indentation for some declarations instead of exactly 3. Can this be fixed? I do want the extra level of indentation here</p>",
        "id": 481811281,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1731360141
    },
    {
        "content": "<p>Of course it <em>can</em> be fixed!  <span aria-label=\"wink\" class=\"emoji emoji-1f609\" role=\"img\" title=\"wink\">:wink:</span></p>",
        "id": 481811380,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731360186
    },
    {
        "content": "<p>Thanks Damiano for volunteering <span aria-label=\"heart\" class=\"emoji emoji-2764\" role=\"img\" title=\"heart\">:heart:</span></p>",
        "id": 481811595,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1731360285
    },
    {
        "content": "<p><span aria-label=\"speak no evil\" class=\"emoji emoji-1f64a\" role=\"img\" title=\"speak no evil\">:speak_no_evil:</span></p>",
        "id": 481811653,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731360314
    },
    {
        "content": "<p>What exactly should be the checked format, then?</p>",
        "id": 481811687,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731360333
    },
    {
        "content": "<p>The script has these lines consecutively:</p>\n<div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"n\">overview_decls</span> <span class=\"o\">=</span> <span class=\"n\">tiered_extract</span><span class=\"p\">(</span><span class=\"n\">overview</span><span class=\"p\">)</span>\n<span class=\"k\">assert</span> <span class=\"nb\">all</span><span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">n</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">3</span> <span class=\"k\">for</span> <span class=\"n\">n</span><span class=\"p\">,</span> <span class=\"n\">_</span> <span class=\"ow\">in</span> <span class=\"n\">overview_decls</span><span class=\"p\">)</span>\n<span class=\"n\">overview_decls</span> <span class=\"o\">=</span> <span class=\"n\">flatten_names</span><span class=\"p\">(</span><span class=\"n\">overview_decls</span><span class=\"p\">)</span>\n\n<span class=\"n\">undergrad_decls</span> <span class=\"o\">=</span> <span class=\"n\">tiered_extract</span><span class=\"p\">(</span><span class=\"n\">undergrad</span><span class=\"p\">)</span>\n<span class=\"k\">assert</span> <span class=\"nb\">all</span><span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">n</span><span class=\"p\">)</span> <span class=\"o\">&gt;=</span> <span class=\"mi\">3</span> <span class=\"k\">for</span> <span class=\"n\">n</span><span class=\"p\">,</span> <span class=\"n\">_</span> <span class=\"ow\">in</span> <span class=\"n\">undergrad_decls</span><span class=\"p\">)</span>\n<span class=\"n\">undergrad_decls</span> <span class=\"o\">=</span> <span class=\"n\">flatten_names</span><span class=\"p\">(</span><span class=\"n\">undergrad_decls</span><span class=\"p\">)</span>\n</code></pre></div>\n<p>and the middle check of the first block is the failing one.</p>",
        "id": 481811919,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731360436
    },
    {
        "content": "<p>Changing the check to match <code>&gt;= 3</code> as in the second would likely make CI pass your current test, but I am not completely sure of the implications that this has.</p>",
        "id": 481812005,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731360478
    },
    {
        "content": "<p>Looking at the two files that are checked by this action, it looks reasonable to me to allow the \"at least 3 tiers\" in both.</p>",
        "id": 481812807,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731360840
    },
    {
        "content": "<p>However, it may be good to hear an opinion of someone who did not just look at the two files for the first time in years...</p>",
        "id": 481812911,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731360885
    },
    {
        "content": "<p>Btw, I think that you may get this error, once you get past the limit of 3:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Entries</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"ss\">`docs</span><span class=\"bp\">/</span><span class=\"n\">overview</span><span class=\"bp\">.</span><span class=\"n\">yaml</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">refer</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">declarations</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">don't</span><span class=\"w\"> </span><span class=\"n\">exist</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">Please</span><span class=\"w\"> </span><span class=\"n\">correct</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">following</span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">Combinatorics</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">Ramsey</span><span class=\"w\"> </span><span class=\"n\">theory</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">Hindman's</span><span class=\"w\"> </span><span class=\"kn\">theorem</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FS_partition_regular</span>\n</code></pre></div>",
        "id": 481813524,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731361144
    },
    {
        "content": "<p>I don't understand why the <code>lean</code> script does the right thing with the <code>undergrad</code> file, but gets confused by the <code>overview</code> file.</p>",
        "id": 481814623,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731361657
    },
    {
        "content": "<p>Oh, is it maybe <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Hindman.FS_partition_regular#doc\">docs#Hindman.FS_partition_regular</a> ?</p>",
        "id": 481816601,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731362525
    },
    {
        "content": "<p>So, the modified script may have found a bug in the PR!</p>",
        "id": 481816633,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731362543
    },
    {
        "content": "<p>So, if you merge <a href=\"https://github.com/leanprover-community/mathlib4/tree/test%2Fcombinatorics_overview\">branch#test/combinatorics_overview</a> into your PR, CI should pass.</p>",
        "id": 481817159,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731362767
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span>, it works! Could you open a PR?</p>",
        "id": 481918278,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1731409135
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/18910\">#18910</a></p>",
        "id": 481938355,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731415290
    },
    {
        "content": "<p>The relevant question is: do we really want such nesting? This is meant to be a very high level overview. Maybe you’re putting too many details.</p>",
        "id": 481993934,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1731430360
    },
    {
        "content": "<p>Since this doesn’t seem to trigger much discussion, let me be more explicit: I am rather skeptical that this is needed. Other areas of math don’t seem to need it.</p>",
        "id": 482044955,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1731448066
    },
    {
        "content": "<p>An arguement for 4 is: If we were to follow MSC to organise the overview, then the declarations will naturally be living in the 4-th layer.</p>",
        "id": 482051923,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1731451035
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/stream/287929-mathlib4/topic/check_yaml/near/481993934\">said</a>:</p>\n<blockquote>\n<p>The relevant question is: do we really want such nesting? This is meant to be a very high level overview. Maybe you’re putting too many details.</p>\n<p>Other areas of math don't seem to need it.</p>\n</blockquote>\n<p>From your request earlier, I gathered that there  were not enough results mentioned in the overview. Hence I do not really think that other areas of maths having less results mentioned and not as many nestings is an indication that I have done something wrong.</p>",
        "id": 482119429,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1731488004
    },
    {
        "content": "<p>You can mention more results without increasing depth.</p>",
        "id": 482453373,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1731607789
    },
    {
        "content": "<p>Working on the automated deprecation removal PR (<a href=\"https://github.com/leanprover-community/mathlib4/pull/35335\">#35335</a>) made me realize that <code>check-yaml.lean</code> doesn't complain if the declarations mentioned in our overview, undergrad, etc. YAML files get deprecated. Would this be easy to add?</p>",
        "id": 573978887,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1771164182
    },
    {
        "content": "<p>It would be nice indeed.</p>",
        "id": 574095475,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1771243958
    },
    {
        "content": "<p>The check-yaml file claims to perform the check:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>It<span class=\"w\"> </span>verifies<span class=\"w\"> </span>that<span class=\"w\"> </span>the<span class=\"w\"> </span>referenced<span class=\"w\"> </span>declarations<span class=\"w\"> </span>exist,<span class=\"w\"> </span>and<span class=\"w\"> </span>prints<span class=\"w\"> </span>an<span class=\"w\"> </span>error<span class=\"w\"> </span>otherwise.\n</code></pre></div>\n<p>However, I don't think that it checks that the environment created by <code>import Mathlib</code> actually contains this check.</p>",
        "id": 574101926,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1771246137
    },
    {
        "content": "<p>In particular, the check-yaml file, although a Lean file, does not import <code>Mathlib</code>, but parses the json-converted yaml files with the various \"undergrad et al\" files.</p>",
        "id": 574102107,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1771246194
    },
    {
        "content": "<p>Maybe the check-yaml file could <code>import Mathlib</code> and actually check that the environment contains the given declarations.</p>",
        "id": 574102268,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1771246252
    },
    {
        "content": "<p>I could be misunderstanding you since I'm not fully awake yet, but I think it does currently check that the environment contains the declarations in the YAML files (or at least <a href=\"https://github.com/leanprover-community/mathlib4/actions/runs/22033131182/job/63663377360\">this log</a> contained a complaint that made me think so...) What I would like is for it to also throw an error if the declarations in it were deprecated.</p>",
        "id": 574102803,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1771246415
    },
    {
        "content": "<p>Oh, I edited locally the json file and then ran the .lean file again, but it did not complain...</p>",
        "id": 574103220,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1771246534
    },
    {
        "content": "<p>Let me figure out what it is that I did!</p>",
        "id": 574103244,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1771246542
    }
]