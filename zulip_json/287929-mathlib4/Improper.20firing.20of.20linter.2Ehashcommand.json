[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib.Data.Real.Sqrt</span>\n\n<span class=\"c\">/-</span>\n<span class=\"cm\">`#`-commands, such as '#guard', are not allowed in 'Mathlib'</span>\n<span class=\"cm\">note: this linter can be disabled with `set_option linter.hashCommand false`</span>\n<span class=\"cm\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard</span><span class=\"w\"> </span><span class=\"s2\">\"hello, \"</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"s2\">\"world\"</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"hello, world\"</span>\n</code></pre></div>",
        "id": 456896966,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1722961003
    },
    {
        "content": "<p>This seems all correct: what is the issue?</p>",
        "id": 456897220,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1722961072
    },
    {
        "content": "<p>The linter.hashcommand may be necessary for Mathlib development, but it is unlikely to be needed for <strong>all</strong> files importing Mathlib.</p>",
        "id": 456897347,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1722961102
    },
    {
        "content": "<p>I found it annoying that this linter fired when just importing Mathlib.</p>",
        "id": 456897470,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1722961141
    },
    {
        "content": "<p>Can't we separate the 'developer's linter for a specific library' from the 'linter for users'?</p>",
        "id": 456898321,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1722961330
    },
    {
        "content": "<p>I know that it is possible to disable this linter in the options settings. That is not the question I want to ask.</p>",
        "id": 456898624,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1722961385
    },
    {
        "content": "<p>You should import mathlib <em>and</em> be in a file whose path starts with <code>Mathlib</code>.</p>",
        "id": 456898629,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1722961386
    },
    {
        "content": "<p>Otherwise the linter should be quiet.</p>",
        "id": 456898664,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1722961399
    },
    {
        "content": "<blockquote>\n<p>You should import mathlib <em>and</em> be in a file whose path starts with <code>Mathlib</code>.<br>\nOtherwise the linter should be quiet.</p>\n</blockquote>\n<p>Is it not possible to read the lakefile configuration and branch by the name of the package?</p>",
        "id": 456898914,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1722961446
    },
    {
        "content": "<p>Ah, no, this one may only be quiet in tests.</p>",
        "id": 456898954,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1722961453
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span>, is it expected that this fires in the web editor?</p>",
        "id": 456899697,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1722961621
    },
    {
        "content": "<p>It is designed to be active on any file whose path does not start with <code>test</code>, except for the test file of the linter itself.</p>",
        "id": 456902531,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1722962324
    },
    {
        "content": "<p>I thought that it had been silenced on files that were not in mathlib, but I must be confusing it with some of the other linters.</p>",
        "id": 456902773,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1722962372
    },
    {
        "content": "<p>In any case, I think that there are always competing desires: projects downstream of mathlib may want to pick and choose which linters they want active and different projects will have different choices.  So, neither making the linters always active not always inactive is a good decision.</p>",
        "id": 456903655,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1722962554
    },
    {
        "content": "<p>The new option-setting is just for the command-line <code>lake build</code>, right?</p>",
        "id": 456903733,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1722962573
    },
    {
        "content": "<p>So, that is also not really going to solve this issue, I think.</p>",
        "id": 456903817,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1722962591
    },
    {
        "content": "<p>Maybe there should be a \"linter options\" file that contains the default value of each linter and each linter reads off from there its default setting.</p>",
        "id": 456904229,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1722962664
    },
    {
        "content": "<p>So, rather than embedding the <code>defValue</code> of each linter in the option for the linter, that is something that can be configured independently.</p>",
        "id": 456904503,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1722962717
    },
    {
        "content": "<p>Why not leave it disabled by default and enable it in the Mathlib lakefile?</p>",
        "id": 456904972,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1722962797
    },
    {
        "content": "<p>I do not think that you can enable or disable linters from the lakefile.</p>",
        "id": 456905100,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1722962821
    },
    {
        "content": "<p>Otherwise, this would have been the case for all linters, I think.</p>",
        "id": 456905256,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1722962850
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Improper.20firing.20of.20linter.2Ehashcommand/near/456905100\">said</a>:</p>\n<blockquote>\n<p>I do not think that you can enable or disable linters from the lakefile.</p>\n</blockquote>\n<p>I think this is new in 4.11?</p>",
        "id": 456906512,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1722963088
    },
    {
        "content": "<p>It could be: I never used it yet, but it was not clear to me that this was not something that could only be set as an option to <code>lake build</code>.</p>",
        "id": 456906770,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1722963142
    },
    {
        "content": "<p>Add <code>linter.missingDocs</code> to here works for me....</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"bp\">«</span><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"bp\">»</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">leanOptions</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span>\n<span class=\"w\">    </span><span class=\"o\">⟨</span><span class=\"ss\">`autoImplicit</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"o\">⟩,</span>\n<span class=\"w\">    </span><span class=\"o\">⟨</span><span class=\"ss\">`relaxedAutoImplicit</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"o\">⟩,</span>\n<span class=\"w\">    </span><span class=\"o\">⟨</span><span class=\"ss\">`linter.missingDocs</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">⟩</span>\n<span class=\"w\">  </span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 456906805,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1722963156
    },
    {
        "content": "<p>Ah, but those are the \"built-in\" linters.  Those you can always set in the lakefile.</p>",
        "id": 456906863,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1722963181
    },
    {
        "content": "<p>Ok, if it works, then this solves all problems!</p>",
        "id": 456906907,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1722963204
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/3403\">lean4#3403</a> was the tracking issue for this not working until very recently</p>",
        "id": 456907106,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1722963275
    },
    {
        "content": "<p>It would be a solution if any linter could be configured in the lakefile as well as the built-in linter.</p>",
        "id": 456907116,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1722963282
    },
    {
        "content": "<p>so now this issue can be solved?</p>",
        "id": 456907213,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1722963323
    },
    {
        "content": "<p>Ok, so now everyone is free to set their linter options in the lakefile?</p>",
        "id": 456907260,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1722963338
    },
    {
        "content": "<p>Time to clean up all the \"look for the path and cripple the linter\"!</p>",
        "id": 456907318,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1722963359
    },
    {
        "content": "<p>So nice! <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span>  <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span>  This new feature is awesome...! It is a time to a little celebrate dance ₍₍ (ง ˘ω˘ )ว ⁾⁾</p>",
        "id": 456907862,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1722963509
    },
    {
        "content": "<p>It might even be a policy that every linter's default is <code>false</code> and each project is expected to opt in in the lakefile.</p>",
        "id": 456908207,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1722963622
    },
    {
        "content": "<p>Some linters would like it to be enabled by default. ex: <code>unusedVariable</code></p>",
        "id": 456908408,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1722963671
    },
    {
        "content": "<p>The danger with using the new <code>weak</code> arguments if that if you typo a linter name then it doesn't run at all</p>",
        "id": 456908430,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1722963676
    },
    {
        "content": "<p>(or more realistically, if mathlib decides to rename the linter)</p>",
        "id": 456908491,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1722963696
    },
    {
        "content": "<p>Maybe a deprecation system could be enforced</p>",
        "id": 456908571,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1722963716
    },
    {
        "content": "<p>A possible solution is to specify the location where the linter is defined in <code>lakefile</code> and to make an error if the file is reached but there is no linter...</p>",
        "id": 456909161,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1722963860
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Improper.20firing.20of.20linter.2Ehashcommand/near/456907318\">said</a>:</p>\n<blockquote>\n<p>Time to clean up all the \"look for the path and cripple the linter\"!</p>\n</blockquote>\n<p>Feel free to push <a href=\"https://github.com/leanprover-community/mathlib4/pull/15521\">#15521</a> to completion :-)</p>",
        "id": 456953467,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1722977545
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Improper.20firing.20of.20linter.2Ehashcommand/near/456908491\">said</a>:</p>\n<blockquote>\n<p>(or more realistically, if mathlib decides to rename the linter)</p>\n</blockquote>\n<p>You phrased that like it could be an issue for downstream users but why would they need <code>weak</code> in that case? If they want to use a linter, shouldn't they make sure to import it everywhere in their project?</p>",
        "id": 456953699,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1722977643
    },
    {
        "content": "<p>To clarify: <em>in mathlib</em>, you would need to put <code>weak.linter.longLine</code>. Projects downstream of it can/should be able to simply use <code>linter.longLine</code>.</p>",
        "id": 456953850,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1722977730
    },
    {
        "content": "<p>(future improvements that could allow linters to be used without being imported notwithstanding)</p>",
        "id": 456953852,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1722977730
    },
    {
        "content": "<p>Ah, I think I misunderstood how name resolution worked for options, indeed if this only affects mathlib itself then there is much less to worry about</p>",
        "id": 457052443,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723020765
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Improper.20firing.20of.20linter.2Ehashcommand/near/456908207\">said</a>:</p>\n<blockquote>\n<p>It might even be a policy that every linter's default is <code>false</code> and each project is expected to opt in in the lakefile.</p>\n</blockquote>\n<p>No, I think it is usually pretty clear when a linter should be default on or default on only in mathlib. Linters which are useful generally and try to improve code quality should be enabled by default, and linters which try to maintain mathlib quality standards or enforce \"house rules\" of mathlib should be disabled by default and enabled in the mathlib lakefile.</p>\n<p>Here's my triage of which is which:</p>\n<p>Global:</p>\n<ul>\n<li><code>globalAttributeIn</code></li>\n<li><code>haveLetLinter</code></li>\n<li><code>dupNamespace</code></li>\n<li><code>unusedTacticLinter</code></li>\n</ul>\n<p>Mathlib local:</p>\n<ul>\n<li><code>hashCommandLinter</code></li>\n<li><code>missingEndLinter</code></li>\n<li><code>cdotLinter</code></li>\n<li><code>longLineLinter</code></li>\n<li><code>oldObtainLinter</code> (unless this is supposed to be a deprecation warning?)</li>\n<li><code>refineLinter</code> (although maybe it can be made global if we get <code>refine?</code>)</li>\n<li><code>setOptionLinter</code></li>\n</ul>",
        "id": 457284896,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1723101234
    },
    {
        "content": "<p>Ok, sounds great!</p>",
        "id": 457292676,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723103357
    },
    {
        "content": "<p>Yeah, I think old obtain should warn on dependencies so we can remove it</p>",
        "id": 457307937,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1723107244
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/15616\">#15616</a></p>",
        "id": 457365637,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723122312
    }
]