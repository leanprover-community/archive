[
    {
        "content": "<p>Here's part of the definition of <code>BoundedFormula</code> from Mathlib.ModelTheory.Syntax, which has a <code>Nat</code> parameter indicating how many free variables the formula is allowed to quantify over. (Those free variables are then represented by members of <code>Fin n</code>, and there's notation set up somewhere so that <code>&amp;0</code> for example refers to the free variable <code>0 : Fin n</code>.)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">BoundedFormula</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">u'</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">falsum</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BoundedFormula</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">imp</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f1</span><span class=\"w\"> </span><span class=\"n\">f2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BoundedFormula</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BoundedFormula</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">all</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BoundedFormula</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BoundedFormula</span><span class=\"w\"> </span><span class=\"n\">n</span>\n</code></pre></div>\n<p>The <code>all</code> constructor is meant to be interpreted as quantifying over the free variable with largest de Bruijn index (i.e. <code>n : Fin (n + 1)</code>). I have been finding it very confusing to keep the quantifiers straight in my head, though, so I'd like to adjust the definition to allow quantifying over <em>any</em> de Bruijn index (and in particular to be explicit about which variable is being quantified over):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">BoundedFormula</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">u'</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">falsum</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BoundedFormula</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">imp</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f1</span><span class=\"w\"> </span><span class=\"n\">f2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BoundedFormula</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BoundedFormula</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">all</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BoundedFormula</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BoundedFormula</span><span class=\"w\"> </span><span class=\"n\">n</span>\n</code></pre></div>\n<p>so that we can now write <code>all &amp;0 (imp &amp;0 &amp;1)</code> (where the only free variable is now the <code>&amp;1</code>, which is represented by the member <code>0 : Fin 1</code>, because our original <code>&amp;0</code> has been quantified over and has caused all the larger free variable indices to be bumped down by one).</p>\n<p>However, this is a problem for the existing unary notation:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">scoped</span><span class=\"o\">[</span><span class=\"n\">FirstOrder</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">prefix</span><span class=\"o\">:</span><span class=\"mi\">110</span><span class=\"w\"> </span><span class=\"s2\">\"∀'\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">FirstOrder</span><span class=\"bp\">.</span><span class=\"n\">Language</span><span class=\"bp\">.</span><span class=\"n\">BoundedFormula</span><span class=\"bp\">.</span><span class=\"n\">all</span>\n</code></pre></div>\n<p>In my new world, ideally this would implicitly take the argument <code>n : Fin (n + 1)</code> (for whatever <code>n</code> is inferred from the fact that we require a <code>Fin (n + 1)</code>) so that I didn't break existing call sites, and we could keep having the unary operator. Is it possible to do that?</p>",
        "id": 462585087,
        "sender_full_name": "Patrick Stevens",
        "timestamp": 1723738302
    },
    {
        "content": "<p>Would this work?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">scoped</span><span class=\"o\">[</span><span class=\"n\">FirstOrder</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">prefix</span><span class=\"o\">:</span><span class=\"mi\">110</span><span class=\"w\"> </span><span class=\"s2\">\"∀'\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">FirstOrder</span><span class=\"bp\">.</span><span class=\"n\">Language</span><span class=\"bp\">.</span><span class=\"n\">BoundedFormula</span><span class=\"bp\">.</span><span class=\"n\">all</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">last</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 462592492,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1723740715
    },
    {
        "content": "<p>Ah that's perfect, thanks! (Didn't even occur to me <span aria-label=\"oh no\" class=\"emoji emoji-1f615\" role=\"img\" title=\"oh no\">:oh_no:</span>)</p>",
        "id": 462594113,
        "sender_full_name": "Patrick Stevens",
        "timestamp": 1723741285
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"117987\">Patrick Stevens</span> has marked this topic as resolved.</p>",
        "id": 462594123,
        "sender_full_name": "Notification Bot",
        "timestamp": 1723741288
    }
]