[
    {
        "content": "<p>In analysis, one often works with functions that are well-defined only almost everywhere. On a set of measure 0 we might take integrals of non-integrable functions, supremums over values that are not bounded and things like that.<br>\nFor example in the Carleson project we define the Hardy-Littlewood maximal function (<a href=\"https://florisvandoorn.com/carleson/docs/find/?pattern=maximalFunction#doc\">carleson#maximalFunction</a>). This takes functions into <code>ENNReal</code>, because <code>ENNReal</code>-valued suprema are nicer to work with, and on a set of measure 0 the maximal function can be infinite. <br>\nFor the functions we are considering, we do want to prove that being infinite only happens on a set of measure 0. The typical proof goes as follows: <br>\n(1) We prove that if the input function is <code>L^1</code> (<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MeasureTheory#doc\">docs#MeasureTheory</a>.Memℒp) then the output function is weak-L^1 (<a href=\"https://florisvandoorn.com/carleson/docs/Carleson/WeakType.html#MeasureTheory.MemW%E2%84%92p\">link</a>).<br>\n(2) If a function is weak-L^1, then it is almost everywhere not equal to infinity.</p>\n<p>Now even stating step 2 requires some care: the linked version of weak-L^p above follows Mathlib's examples of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MeasureTheory.eLpNorm#doc\">docs#MeasureTheory.eLpNorm</a> and many similar definitions to consider maps from a measurable space to a normed space. Using such a codomain, we already have to turn our map into a map into <code>Real</code> by using <code>ENNReal.toReal</code> (see e.g. <a href=\"https://florisvandoorn.com/carleson/docs/find/?pattern=HasWeakType.MB_one#doc\">carleson#HasWeakType.MB_one</a>), and then we have lost information about where this map is infinity.</p>\n<p>To fix this, <span class=\"user-mention\" data-user-id=\"556875\">@Pietro Monticone</span> and I have defined a slightly more general version of definitions like L^p-norm, being L^p, weak-L^p, etc. in <a href=\"https://github.com/fpvandoorn/carleson/blob/004e1262a1d0b8a7871df02e80905ab771b2ef39/Carleson/ToMathlib/ENorm.lean\">this file</a>. For these definitions, the only thing we need is a map from the codomain to <code>ENNReal</code>, so we define a class doing exactly that:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">ENorm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">enorm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"bp\">≥</span><span class=\"mi\">0</span><span class=\"bp\">∞</span>\n</code></pre></div>\n<p>Compare <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Norm#doc\">docs#Norm</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=NNNorm#doc\">docs#NNNorm</a>. <br>\nWe have two natural instances: the identity function on <code>ENNReal</code> and </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NNNorm</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ENorm</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">enorm</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">‖·‖₊</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"bp\">≥</span><span class=\"mi\">0</span><span class=\"bp\">∞</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>My concrete suggestion is to add the <code>ENorm</code> class to Mathlib, and generalize definitions like Integrable/Memℒp/eLpNorm/... to use this definition. I think the fallout of this will be minimal, except that we will replace some uses of a lemma about <code>coe_nnnorm</code> with the corresponding lemma about <code>enorm</code>.</p>\n<p>Two remarks:</p>\n<ul>\n<li>An alternative approach is to duplicate the definitions: have one version of Banach-space-valued functions and one for ENNReal-valued functions (which we do for e.g. integration). I don't like this duplication, and this problem might get worse when we consider a predicate on an operator stating that it sends <code>L^p</code> maps to <code>L^p</code> maps. Then we might potentially need 4 versions of such a predicate.</li>\n<li>In this proposal I am suggesting to not suggesting to generalize many lemmas: anything that mentions addition on the Banach space will still be stated using Banach spaces for a while. We can consider later to also generalize some lemmas, but that would require classes that state the relation between <code>enorm</code> and algebraic operations, the topology, etc. I'm not sure what these classes should be precisely (e.g.: the topology on <code>ENNReal</code> is not given by the standard metric on <code>ENNReal</code>). I added something (<code>ENormedAddMonoid</code>) in the linked file above, but the intention is <em>not</em> to port that to Mathlib at first.</li>\n</ul>\n<p>Thoughts?</p>",
        "id": 483009333,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1731933139
    },
    {
        "content": "<p>i guess you can compare mathlibs <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=EDist#doc\">docs#EDist</a> / <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=NNDist#doc\">docs#NNDist</a> / <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Dist#doc\">docs#Dist</a> design to decide how this might fit in with the rest. See also <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=EMetricSpace#doc\">docs#EMetricSpace</a> / <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MetricSpace#doc\">docs#MetricSpace</a> for how this example uses forgetful inheritance.</p>",
        "id": 483011419,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1731933710
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"214703\">@Yury G. Kudryashov</span> I just saw that <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ENorm#doc\">docs#ENorm</a> exists in Mathlib. It was apparently defined in 2020, but still a leaf file of Mathlib.<br>\nCan we rename it to <code>ENormedSpace</code> so that <code>ENorm</code> becomes available for just the class defining the notation?<br>\nOr maybe more radically: should this be removed?</p>",
        "id": 488634489,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1734010424
    },
    {
        "content": "<p>I thought that it will be useful to define Lp spaces, but it was never used there.</p>",
        "id": 488739403,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1734047717
    },
    {
        "content": "<p>You may deprecate the whole file and/or rename any parts of it.</p>",
        "id": 488739424,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1734047728
    },
    {
        "content": "<p>I have no other plans for this structure.</p>",
        "id": 488739443,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1734047743
    }
]