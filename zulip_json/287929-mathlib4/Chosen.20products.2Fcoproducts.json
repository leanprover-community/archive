[
    {
        "content": "<p>I was wondering if it would make sense to include chosen products/coproducts into Mathlib, since I need chosen coproducts for my work on programming language formalization. I've got a rough implementation in <a href=\"https://github.com/imbrem/discretion\">https://github.com/imbrem/discretion</a>, and was thinking of adding <code>AddMonoidalCategory</code>, which would just wrap <code>MonoidalCategory</code> but with an alternative additive syntax, and having <code>ChosenCoproducts</code> extend it. <code>ChosenProducts</code>, if necessary, can extend <code>MonoidalCategory</code>.</p>\n<p>My personal use for doing so would be as a stepping stone towards formalizing distributive categories and Conway iteration operators. While this could be done using <code>coprod.desc</code>, this has the issue of not working nicely with subcategories, where we would like the coproduct of the subcategory to agree.  Eventually, this may also allow us to formalize e.g. rig categories, though I'm personally not currently interested in that.</p>",
        "id": 498208591,
        "sender_full_name": "Jad Ghalayini",
        "timestamp": 1738875176
    },
    {
        "content": "<p>Are you aware of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CategoryTheory.ChosenFiniteProducts#doc\">docs#CategoryTheory.ChosenFiniteProducts</a> and <a href=\"https://github.com/leanprover-community/mathlib4/pull/20182\">#20182</a>?</p>",
        "id": 498259540,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1738903256
    },
    {
        "content": "<p>I think if we go with <code>ChosenProducts</code>, then we should go all the way and have <code>ChosenProductsOfShape X</code> for some type <code>X</code>, <code>ChosenProductsOfSize</code> defined as <code>ChosenProductsOfShape X</code> for all <code>X : Type u</code> for some <code>u</code>, etc.</p>",
        "id": 498417740,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1738958671
    },
    {
        "content": "<p>Then <code>ChosenFiniteProducts</code> could be refactored to become <code>Forall n, ChosenProductsOfShape (Fin n)</code>, or something like that. (edit: on second thought, it's quite convenient to have chosen binary products in <code>Type u</code> being defeq to the type theoretic product, so maybe that last point needs more thought.)</p>",
        "id": 498417807,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1738958703
    },
    {
        "content": "<p>I think we should consider <code>ChosenFiniteProducts</code> as a proxy for a construction of a monoidal category structure, so we should keep the definition with binary products and the terminal object. (For the application to simplicial sets, that simplicies in a tensor product are just tuples is <strong>very convenient</strong>!)</p>",
        "id": 498430771,
        "sender_full_name": "Jo√´l Riou",
        "timestamp": 1738964389
    },
    {
        "content": "<p>Chosen finite products could have a built in binary product, terminal object, <em>and</em> products indexed by an arbitrary finite type. There was some discussion previously about doing something for n-fold tensor products in a monoidal category.</p>",
        "id": 498432024,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1738964963
    },
    {
        "content": "<p>We could have another class which extends <code>ChosenFiniteProducts</code>, but I am not sure we need to do this.<br>\nI agree that in a <em>general</em> monoidal category <code>C</code>, we should be able to consider the tensor product of a list of objects, and that there are variations on this theme in the symmetric case.</p>",
        "id": 498435358,
        "sender_full_name": "Jo√´l Riou",
        "timestamp": 1738966522
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"260921\">Markus Himmel</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Chosen.20products.2Fcoproducts/near/498259540\">said</a>:</p>\n<blockquote>\n<p>Are you aware of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CategoryTheory.ChosenFiniteProducts#doc\">docs#CategoryTheory.ChosenFiniteProducts</a> and <a href=\"https://github.com/leanprover-community/mathlib4/pull/20182\">#20182</a>?</p>\n</blockquote>\n<p>Yes, though I forgot about it at the time; what I need is <code>ChosenFiniteCoproducts</code>, essentially. Would a PR implementing that be welcome?</p>",
        "id": 498504590,
        "sender_full_name": "Jad Ghalayini",
        "timestamp": 1739023239
    },
    {
        "content": "<p>It would also be _really_ nice if we had some notation for these coproducts</p>",
        "id": 498504620,
        "sender_full_name": "Jad Ghalayini",
        "timestamp": 1739023260
    },
    {
        "content": "<p>I don't know if <code>‚äï</code> would work since we use that for types, or <code>+</code> since using <code>Add</code> that way is slightly weird</p>",
        "id": 498504666,
        "sender_full_name": "Jad Ghalayini",
        "timestamp": 1739023289
    },
    {
        "content": "<p>My thoughts about <code>AddMonoidalCategory</code> were basically on whether the notation should be for coproducts specifically or a \"coproduct flavor\" symmetric monoidal structure, since the latter would allow us to work towards formalizing rig categories, which are cool (but not necessary for my work so I'm happy either way)</p>",
        "id": 498504761,
        "sender_full_name": "Jad Ghalayini",
        "timestamp": 1739023351
    },
    {
        "content": "<p>I do somewhat like the analogy between e.g. <code>Monoid</code> and <code>AddMonoid</code>, <code>MonoidalCategory</code> and <code>AddMonoidalCategory</code></p>",
        "id": 498504784,
        "sender_full_name": "Jad Ghalayini",
        "timestamp": 1739023378
    },
    {
        "content": "<p>Most of the theorems would just be renamings, and could eventually even be handled with an <code>AddMonoid</code> like <code>to_additive</code> macro if we decide to go down that route</p>",
        "id": 498504809,
        "sender_full_name": "Jad Ghalayini",
        "timestamp": 1739023403
    },
    {
        "content": "<p>That said that's a lot of work and <code>ChosenFiniteCoproducts</code> is quite easy so I'd rather just start doing that as a PR if that seems likely to be accepted</p>",
        "id": 498504835,
        "sender_full_name": "Jad Ghalayini",
        "timestamp": 1739023432
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"461231\">Jad Ghalayini</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Chosen.20products.2Fcoproducts/near/498504666\">said</a>:</p>\n<blockquote>\n<p>I don't know if <code>‚äï</code> would work since we use that for types, or <code>+</code> since using <code>Add</code> that way is slightly weird</p>\n</blockquote>\n<p>Could also use something else if anyone has any suggestions. In <code>discretion</code> we use</p>\n<ul>\n<li><code>+‚Çí</code> for adding objects</li>\n<li><code>ùüò_ C</code> for the monoidal unit, which for the chosen coproducts case is the initial object of <code>C</code></li>\n<li><code>‚óÅ‚Å∫</code> and <code>‚ñ∑‚Å∫</code> for additive whiskering</li>\n<li><code>+‚Çï</code> for adding morphisms</li>\n<li><code>Œ±‚Å∫</code> for the additive associator</li>\n<li><code>Œª‚Å∫</code> and <code>œÅ‚Å∫</code> for the additive unitors</li>\n<li><code>œÉ‚Å∫</code> for the additive symmetry, but this is a local convention, for Mathlib I'd want to be more consistent and e.g. use <code>Œ≤‚Å∫</code><br>\n   (for simplicity we just assume an <code>AddMonoidalCategory</code> is symmetric, since it is in all the cases we care about)</li>\n</ul>",
        "id": 498505157,
        "sender_full_name": "Jad Ghalayini",
        "timestamp": 1739023700
    },
    {
        "content": "<p>I've made a PR here, please let me know if it's any good: <a href=\"https://github.com/leanprover-community/mathlib4/pull/21603\">https://github.com/leanprover-community/mathlib4/pull/21603</a></p>",
        "id": 498612184,
        "sender_full_name": "Jad Ghalayini",
        "timestamp": 1739117631
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"459699\">Jo√´l Riou</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Chosen.20products.2Fcoproducts/near/498435358\">said</a>:</p>\n<blockquote>\n<p>We could have another class which extends <code>ChosenFiniteProducts</code>, but I am not sure we need to do this.<br>\nI agree that in a <em>general</em> monoidal category <code>C</code>, we should be able to consider the tensor product of a list of objects, and that there are variations on this theme in the symmetric case.</p>\n</blockquote>\n<p>I think this is called \"unbiased monoidal category\" in the 2-category literature. See </p>\n<ul>\n<li>Leinster, 2004: Operads in higher-dimensional category theory, Sec 1.2: Unbiased bicategories (<a href=\"https://arxiv.org/abs/math/0011106\">arxiv</a>)</li>\n</ul>\n<p>And the category of unbiased monoidal categories can be obtained as the category of strict/pseudo/lax algebras for the usual free monoid construction on the 2-category Cat. </p>\n<p>I've recently started a formalization project which involves virtual double categories and the unbiased theme is very much there as well. But, maybe a good idea to do unbiased monoidal cats as first step? </p>\n<p>(sorry, did not want to detract too much from the main point of this PR about <code>ChosenFiniteCoproducts</code>)</p>",
        "id": 499335785,
        "sender_full_name": "Sina Hazratpour ìÉµ",
        "timestamp": 1739397317
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"420917\">@Sina Hazratpour ìÉµ</span> that's fine; I've also looked at your PR for distributive categories, and what I would really like for my thesis is for distributive categories to use chosen coproducts rather than the choice-based ones</p>",
        "id": 499531782,
        "sender_full_name": "Jad Ghalayini",
        "timestamp": 1739466449
    },
    {
        "content": "<p>And also of course to be based on premonoidal rather than monoidal categories</p>",
        "id": 499531846,
        "sender_full_name": "Jad Ghalayini",
        "timestamp": 1739466467
    },
    {
        "content": "<p>Would it make sense to make a PR which depends on both our PRs and does this?</p>",
        "id": 499532052,
        "sender_full_name": "Jad Ghalayini",
        "timestamp": 1739466515
    },
    {
        "content": "<p>Interesting! For applications I had in mind and i guess consistent with the rest of mathlib i went for <code>HasBinaryCoproducts</code> instead of <code>ChosenFiniteCoproducts</code>. I think our motivations are quite different, but to give you some context i basically followed </p>\n<ol>\n<li>\n<p>Hans-Joachim Baues, Mamuka Jibladze, Andy Tonks, Cohomology of<br>\n monoids in monoidal categories, in: Operads: Proceedings of Renaissance<br>\n Conferences, Contemporary Mathematics 202, AMS (1997) 137-166</p>\n</li>\n<li>\n<p>Carboni et al, Introduction to extensive and distributive categories</p>\n</li>\n<li>\n<p>J.R.B.Cockett, Introduction to distributive categories, 1992</p>\n</li>\n</ol>\n<p>Note that <code>HasBinaryCoproducts</code> is slightly more general than <code>ChosenFiniteCoproducts</code> since I am not assuming the existence of an initial object, thought in its presence you can prove more. I think if you go full bimonoidal (aka rig-category), it does not make sense to assume existence of an initial object, unless you work in the less general case of semicartesian bimonoidal or some such thing.</p>\n<p><span class=\"user-mention\" data-user-id=\"459699\">@Jo√´l Riou</span> has been reviewing my PR (<a href=\"https://github.com/leanprover-community/mathlib4/pull/20182\">#20182</a>). I'd wait to see what he has to say.</p>",
        "id": 499536475,
        "sender_full_name": "Sina Hazratpour ìÉµ",
        "timestamp": 1739467653
    },
    {
        "content": "<p>One solution that comes to my mind: define rig-categories first, similar to distributive categories but with a second monoidal structure replacing coproducts. Then the second monoidal structure can come from <code>ChosenFiniteCoproducts</code> in the co-cartesian case.  Then this will be consistent with <code>ChosenFiniteCoproducts</code>¬†as a proxy for a construction of a the second cocartesian monoidal¬†category¬†structure.</p>",
        "id": 499538117,
        "sender_full_name": "Sina Hazratpour ìÉµ",
        "timestamp": 1739468092
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"461231\">Jad Ghalayini</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Chosen.20products.2Fcoproducts/near/499531846\">said</a>:</p>\n<blockquote>\n<p>And also of course to be based on premonoidal rather than monoidal categories</p>\n</blockquote>\n<p>i have not checked, do we have premonoidal stuff in mathlib?</p>",
        "id": 499545196,
        "sender_full_name": "Sina Hazratpour ìÉµ",
        "timestamp": 1739469981
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"420917\">@Sina Hazratpour ìÉµ</span> I have a PR open for premonoidal stuff here: <a href=\"https://github.com/leanprover-community/mathlib4/pull/21488\">https://github.com/leanprover-community/mathlib4/pull/21488</a></p>",
        "id": 499748586,
        "sender_full_name": "Jad Ghalayini",
        "timestamp": 1739541371
    },
    {
        "content": "<p>I was thinking of doing the rig approach; the other alternative is to separate out chosen finite (co)products from choices of initial/terminal object; maybe do ChosenBinary(Co)products for just the products without the objects?</p>",
        "id": 499748766,
        "sender_full_name": "Jad Ghalayini",
        "timestamp": 1739541414
    },
    {
        "content": "<p>The issue is that's a lot more changes and tbf I want distributive premonoidal categories ASAP since I'm using them to formalize my thesis and currently using my own implementation, which is a bit irritating</p>",
        "id": 499748903,
        "sender_full_name": "Jad Ghalayini",
        "timestamp": 1739541449
    },
    {
        "content": "<p>How would you feel about <code>ChosenBinaryCoproducts</code> and <code>ChosenInitialObject</code> classes, with <code>ChosenFiniteCoproducts</code> just extending both of those? Then likewise for products</p>",
        "id": 499749206,
        "sender_full_name": "Jad Ghalayini",
        "timestamp": 1739541506
    },
    {
        "content": "<p>For the rig category stuff I proposed <code>AddMonoidalCategory</code> but again seems like a big change</p>",
        "id": 499749275,
        "sender_full_name": "Jad Ghalayini",
        "timestamp": 1739541525
    },
    {
        "content": "<p>Wouldn't distributive premonoidal categories be more general than distributive monoidal categories? So, maybe a separate development in a premonoidal directory  would be justified? Again, I am not a maintainer, so it would be better if one of the maintainers added a comment on this.</p>",
        "id": 499749435,
        "sender_full_name": "Sina Hazratpour ìÉµ",
        "timestamp": 1739541568
    },
    {
        "content": "<p>I have no idea how to get projects like this merged tbf, not really used to contributing to mathlib as I've mainly just done stuff in my own dependent libraries, but excited to get some of this work upstream (all this stuff is formalized in <a href=\"https://github.com/imbrem/discretion\">https://github.com/imbrem/discretion</a>)</p>",
        "id": 499749478,
        "sender_full_name": "Jad Ghalayini",
        "timestamp": 1739541576
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"420917\">Sina Hazratpour ìÉµ</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Chosen.20products.2Fcoproducts/near/499749435\">said</a>:</p>\n<blockquote>\n<p>Wouldn't distributive premonoidal categories be more general than distributive monoidal categories? So, maybe a separate development in a premonoidal directory  would be justified? Again, I am not a maintainer, so it would be better if one of the maintainers added a comment on this.</p>\n</blockquote>\n<p>Well a distributive monoidal category is just a distributive premonoidal category where everything is central</p>",
        "id": 499749625,
        "sender_full_name": "Jad Ghalayini",
        "timestamp": 1739541607
    },
    {
        "content": "<p>For example in my PR I just changed the definition for BraidedCategory to require only premonoidal category + the braiding is central and things work just fine (the default tactic for the central field is <code>infer_instance</code>, and I added an instance so that for a monoidal category everything is central)</p>",
        "id": 499749838,
        "sender_full_name": "Jad Ghalayini",
        "timestamp": 1739541658
    },
    {
        "content": "<p>If you look in <code>discretion</code> distributive categories are the same way; you just have fields telling you coproducts preserve centrality and injections are central (this implies the distributor + inverse distributor are central) filled in automatically</p>",
        "id": 499750057,
        "sender_full_name": "Jad Ghalayini",
        "timestamp": 1739541710
    },
    {
        "content": "<p>Most of the theory goes through the same way (with perhaps a sprinkling of <code>Central</code> instances), and anything that doesn't can just replace the <code>PremonoidalCategory</code> instance with a <code>MonoidalCategory</code> instance</p>",
        "id": 499750283,
        "sender_full_name": "Jad Ghalayini",
        "timestamp": 1739541754
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"461231\">Jad Ghalayini</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Chosen.20products.2Fcoproducts/near/499749206\">said</a>:</p>\n<blockquote>\n<p>How would you feel about <code>ChosenBinaryCoproducts</code> and <code>ChosenInitialObject</code> classes, with <code>ChosenFiniteCoproducts</code> just extending both of those? Then likewise for products</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"260921\">@Markus Himmel</span> do you have thoughts on this? I recall you feeling strongly that these shouldn't be made, but this was quite a while ago</p>",
        "id": 499845694,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1739573501
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"548696\">@Micha≈Ç Mruga≈Ça</span> and I are reaching a point in Toric where it would be really convenient to have a <code>ChosenFiniteCoproduct</code> API. We want to write Spec as a contravariant functor from <code>R</code>-Hopf algebras to group schemes over <code>Spec R</code>, whose type would tentatively be <code>(Hopf_ (Under R))·µí·µñ ‚•§ Grp_ (Over (Spec R))</code>.</p>",
        "id": 505976249,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1742145329
    },
    {
        "content": "<p>I think it would be easier to use Grp_ ((Under R)^op) instead. Which also doesn‚Äôt need ChosenFiniteCoproduct</p>",
        "id": 505979642,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1742147621
    },
    {
        "content": "<p>Then you're only looking at affine schemes not schemes, right?</p>",
        "id": 505979812,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1742147749
    },
    {
        "content": "<p>Yeah I would argue that the ‚Äúright‚Äù way to think about Hopf algebras is as group objects in affine schemes.</p>",
        "id": 505980135,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1742147963
    },
    {
        "content": "<p>I assume we know that the functor from affine schemes to schemes preserves finite products, and that any functor that preserves finite products induces a functor on group objects, so that way you can also obtain a group schemes easily</p>",
        "id": 505980345,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1742148096
    },
    {
        "content": "<p>The one thing I would change with this whole setup is to <em>define</em> the category of affine schemes as <code>CommRing^op</code>.</p>",
        "id": 505980665,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1742148287
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"439483\">Andrew Yang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Chosen.20products.2Fcoproducts/near/505979642\">said</a>:</p>\n<blockquote>\n<p>I think it would be easier to use Grp_ ((Under R)^op) instead. Which also doesn‚Äôt need ChosenFiniteCoproduct</p>\n</blockquote>\n<p>Okay sure, but then how do I solve</p>\n<div class=\"codehilite\" data-code-language=\"import\"><pre><span></span><code>import Mathlib.CategoryTheory.Monoidal.Grp_\n\nimport Toric.Mathlib.CategoryTheory.ChosenFiniteProducts.Over\n\nopen AlgebraicGeometry CategoryTheory\n\nattribute [local instance] Over.chosenFiniteProducts -- From #21399\n\nvariable {R : CommRingCat}\n\n-- works\nexample : Grp_ (Over R·µí·µñ) ‚•§ Grp_ (Over &lt;| Spec R) := sorry\n\n-- failed to synthesize\n-- ¬†ChosenFiniteProducts (Under R)·µí·µñ\nexample : Grp_ (Under R)·µí·µñ ‚•§ Grp_ (Over &lt;| Spec R) := sorry\n</code></pre></div>",
        "id": 505981666,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1742148963
    },
    {
        "content": "<p>Are we going to duplicate every single <code>ChosenFiniteProducts (Construction C)</code> instance to <code>ChosenFiniteProducts (Coconstruction C)·µí·µñ</code>?</p>",
        "id": 505981733,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1742149048
    },
    {
        "content": "<p>I don't really how this is better than duplicating to <code>ChosenFiniteCoproducts (Coconstruction C)</code></p>",
        "id": 505983528,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1742150160
    },
    {
        "content": "<p>I'm not sure what you need to duplicate. You would want <code>ChosenFiniteProducts (Under R)·µí·µñ</code> to be formed by tensor products for the defeqs and there is nothing to generalize here.</p>",
        "id": 506017533,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1742172756
    },
    {
        "content": "<p>But I was mainly saying that probably we don't want/need <code>Hopf_</code> (or <code>CoGrp_</code>).</p>",
        "id": 506018141,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1742173090
    }
]