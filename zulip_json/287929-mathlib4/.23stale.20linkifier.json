[
    {
        "content": "<p>I just discovered there is a #stale linkifier, pointing to <a href=\"https://github.com/leanprover-community/mathlib4/pulls?q=is%3Aopen%20is%3Apr%20-label%3Ahelp-wanted%20-label%3Aawaiting-review%20draft%3Afalse%20-label%3Ablocked-by-other-PR%20-label%3Aafter-port%20-label%3Aforward-port-placeholder%20sort%3Aupdated-asc\">the github query</a> <code>is:open is:pr -label:help-wanted -label:awaiting-review draft:false -label:blocked-by-other-PR -label:after-port -label:forward-port-placeholder sort:updated-asc</code>. I would like to add a similar dashboard to the queueboard (on the triage page, presumably). I'm looking for feedback on the best query to use.</p>",
        "id": 512417217,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1744752824
    },
    {
        "content": "<p>More specifically, the current linkifier has a few interesting choices</p>\n<ul>\n<li>the labels awaiting-review, after-port and forward-port-placeholder are not used any more. (No open PRs carry them, or have been tagged with them in a year or so.) Would a maintainer like to remove them from the query?</li>\n<li>the query excludes PRs with help-wanted is excluded, but allows PRs with please-adopt</li>\n<li>the query excludes draft PRs, but shows WIP PRs<br>\nThe latter two seem inconsistent.</li>\n</ul>",
        "id": 512417266,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1744752842
    },
    {
        "content": "<p>I would like your, yes your, input:</p>\n<ul>\n<li>do you know if there was a reason for the choices above? If you remember, I'm interested in the answer :-)</li>\n<li>what's a good choice for (2)? I'd tend to exclude PRs with either label. (There is already <a href=\"https://leanprover-community.github.io/queueboard/help_out.html#needs-owner\">a dashboard</a> for those: the stale dashboard would show PRs that are \"working\" in principle.)</li>\n<li>what's a good choice for (3)? I'd rather hide both, for the same reason.</li>\n<li>should the dashboard also hide PRs with failing CI? (One could argue for yes. Another option is not prescribing this (i.e., allowing more PRs) --- on the grounds that WIP could represent a PR being functionally very incomplete, but failing CI could just be a minor issue. That's a bit of a blurry line.)</li>\n</ul>",
        "id": 512417304,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1744752847
    },
    {
        "content": "<blockquote>\n<p>the labels awaiting-review, after-port and forward-port-placeholder <br>\nare not used any more. (No open PRs carry them, or have been tagged with<br>\n them in a year or so.) Would a maintainer like to remove them from the <br>\nquery?</p>\n</blockquote>\n<p>fixed</p>",
        "id": 512419371,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744753839
    },
    {
        "content": "<p>note, the name is <a href=\"https://github.com/leanprover-community/mathlib4/pulls?q=is%3Aopen+is%3Apr+-label%3Ahelp-wanted+draft%3Afalse+-label%3Ablocked-by-other-PR+sort%3Aupdated-asc\">#stalled</a> not #stale (should it be #stale?)</p>",
        "id": 512419383,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744753847
    },
    {
        "content": "<p>(My current proposal would be <a href=\"https://github.com/leanprover-community/mathlib4/pulls?q=is%3Apr%20is%3Aopen%20draft%3Afalse%20-label%3AWIP%20-label%3Ahelp-wanted%20-label%3Aplease-adopt%20-label%3Ablocked-by-other-PR%20-label%3Ablocked-by-core-PR%20-label%3Ablocked-by-batt-PR%20draft%3Afalse%20\">this query</a> - I'd add filtering for \"last update was at least a month\" or so.)</p>",
        "id": 512419435,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1744753882
    },
    {
        "content": "<p>How does this list differ from the query used by the triage bot?</p>",
        "id": 512419575,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744753947
    },
    {
        "content": "<p>I don't have any direct answers to your questions yet, but there was some discussion in the maintainer channel a while back about stale PRs and we even went so far as to put together some <a href=\"https://github.com/leanprover-community/mathlib4/blob/2f52b383d1f6521b1414cc72a3da00a9f83017e5/.github/workflows/stale.yml\">test automation for it</a> which uses yet another query (though it is basically just picking up PRs which are old and not on the queue).</p>\n<p>I'll see if I can put together a summary of the maintainer discussion and post it here later tonight.</p>",
        "id": 512419775,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1744754047
    },
    {
        "content": "<p>I would really like to see a bot in place that:</p>\n<ul>\n<li>after 1 month of inactivity on any PR that doesn't qualify for <a href=\"https://leanprover-community.github.io/queue-redirect\">#queue</a>, adds the <code>stale</code> label to a PR, and posts a message politely reminding the author that they may need to address CI issues, or respond to <code>awaiting-author</code> queries, and give hints about how to ask for help via Zulip</li>\n<li>clears <code>stale</code> labels when there is new activity</li>\n<li>closes PRs that have been `stale for 1 month, with a polite reminder that they are welcome to reopen the PR at any time, and again invite discussion at the Zulip.</li>\n</ul>",
        "id": 512433602,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1744761248
    },
    {
        "content": "<p>I don't think it's a good idea if a bot closes any PRs automatically, and 1+1 months seems a very tight timeline given the current speed the queue is going.</p>\n<p>Also, I think the requirement should probably not be the complement of <a href=\"https://leanprover-community.github.io/queue-redirect\">#queue</a> but rather a subset thereof: <code>blocked-by-xxx</code>, <code>merge-conflict</code>, <code>wip</code>, <code>help-wanted</code>, <code>please-adopt</code>, (and maybe more), should imo not cause a PR to be closed automatically.</p>\n<p>Closing only stale PRs which have <code>awaiting-author</code> or <code>awaiting-zulip</code> seem more reasonable to me.</p>",
        "id": 512455059,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1744775142
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"123965\">Bryan Gin-ge Chen</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.23stale.20linkifier/near/512419775\">said</a>:</p>\n<blockquote>\n<p>I'll see if I can put together a summary of the maintainer discussion and post it here later tonight.</p>\n</blockquote>\n<p>Looking over the thread, most of the previous discussion was in a maintainer meeting that I couldn't immediately dig up notes for. However, there was general agreement via a few informal polls that: </p>\n<ul>\n<li>stale = no activity and not blocked on another PR, and there were both votes for and against letting PRs on the queue become stale</li>\n<li>no activity = a tie between 30 days or 60 days, so I went with 60 days in the PR</li>\n<li>the bot should post (at least one) gentle warning first, and then only close after a much longer period (6 months was the most popular option and double the stale period was the second most popular option)</li>\n</ul>\n<p>All of the above is of course subject to further discussion / refinement; for one, at the time, the queueboard was still in its infancy, so we could potentially cook up something more sophisticated than the action we were originally thinking of using.</p>",
        "id": 512460062,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1744778203
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"385895\">@Jon Eugster</span>, can you point out some examples of PRs that you think shouldn't be closed, but would be by the 1+1 suggestion?</p>",
        "id": 512469448,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1744783565
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"385895\">Jon Eugster</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.23stale.20linkifier/near/512455059\">said</a>:</p>\n<blockquote>\n<p>given the current speed the queue is going.</p>\n</blockquote>\n<p>Let's not plan around it always being as bad as it is today. :-)</p>",
        "id": 512469550,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1744783628
    },
    {
        "content": "<p><code>merge-conflict</code> for &gt;2 months (or &gt;n months, I don't really mind the value) should not be an exception</p>",
        "id": 512469697,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1744783683
    },
    {
        "content": "<p>but I agree that <code>blocked-by-xxx</code>, <code>wip</code> should inhibit (or totally disable) automatic closure of stale PRs.</p>",
        "id": 512469742,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1744783708
    },
    {
        "content": "<p>Stale delegated PRs should probably be completed :-)</p>",
        "id": 512472743,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1744785057
    },
    {
        "content": "<p>Same for maintainer merged ones (if they ever go that stale)</p>",
        "id": 512472828,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1744785089
    },
    {
        "content": "<p>I think it helps to group this discussion by a PR's state. FWIW, <a href=\"https://github.com/leanprover-community/queueboard/blob/41d6c7fd325f73d9a29ac269a8b404761707ae64/classify_pr_state.py#L91\">these</a> are the possible values the queueboard uses.</p>",
        "id": 512476311,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1744786345
    },
    {
        "content": "<p>Going through that list, I think</p>\n<ul>\n<li>\"stale\" PRs on the queue should just get reviewed :-) (There are some which have been waiting for 30 or 60 days. If these are awaiting a maintainer decision, a decision should be made, not the PR closed.)</li>\n<li>stale maintainer merged: same thing, and hopefully they take less than a week</li>\n<li>stale awaiting-zulip: imho, a better outcome would be for somebody to drive the discussion on zulip there. (I think mathlib needs a project manager :-))</li>\n<li>stale blocked-on-another-PR: ignore (and look at the dependent PRs, if any)</li>\n<li>a fair number of stale awaiting-author PRs are in fact awaiting-zulip: I can imagine the label just didn't exist then. If a revisit mean re-tagging them, that's good</li>\n</ul>",
        "id": 512476367,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1744786360
    },
    {
        "content": "<ul>\n<li>stale with \"just a merge conflict\": I think master should be merged and the PR reviewed. (If the PR is clearly not appropriate any more, it can probably be closed.) I'd rather have people ping those PRs to make sure master gets merged</li>\n</ul>",
        "id": 512476462,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1744786401
    },
    {
        "content": "<ul>\n<li>I guess there are at least a handful for stale draft PRs that can just be closed. But I'm not sure if auto-closing is good, or just using best judgement at identifying them is better.</li>\n</ul>",
        "id": 512476498,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1744786420
    },
    {
        "content": "<p>Related, but: perhaps we should establish some kind of etiquette for picking up old PRs. I don't care which reasonable rule we pick, if it's \"you can ask the author, and after one month of no response push to their PR\" or \"file a new PR with the initial author as co-author\". I notice that sometimes I'm shy to do something because I don't know what is okay. Going over stale PRs, there are certainly a few would I'd like to carry over the line instead of closing.</p>",
        "id": 512476513,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1744786427
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.23stale.20linkifier/near/512469448\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"385895\">Jon Eugster</span>, can you point out some examples of PRs that you think shouldn't be closed, but would be by the 1+1 suggestion?</p>\n</blockquote>\n<p>what about <a href=\"https://github.com/leanprover-community/mathlib4/pull/8435\">#8435</a> for example?</p>\n<p>Generally, I've been looking at <a href=\"https://github.com/leanprover-community/mathlib4/pulls?page=1&amp;q=is%3Aopen+is%3Apr+draft%3Afalse+-label%3AWIP%2Cblocked-by-other-PR%2Chelp-wanted%2Cmaintainer-merge%2Cdelegated+sort%3Aupdated-asc\">this query</a> and there are plenty PR's where it's not clear that they should be closed automatically. For example I've randomly clicked on <a href=\"https://github.com/leanprover-community/mathlib4/pull/14444\">#14444</a> and it seems that it is a valid bug-fix that could be merged and it just got forgotten because additional tests were requested.</p>",
        "id": 512504141,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1744795163
    },
    {
        "content": "<blockquote>\n<p>what about <a href=\"https://github.com/leanprover-community/mathlib4/pull/8435\">#8435</a> for example?</p>\n</blockquote>\n<p>Isn't this an ideal example of something that should long ago have been closed? The author has abandoned it, it's not a great implementation, and it's not valuable to work on <code>hint</code> at the moment because <code>try?</code> is coming soon which will replace it.</p>",
        "id": 512750069,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1744872065
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.23stale.20linkifier/near/512476367\">said</a>:</p>\n<blockquote>\n<ul>\n<li>(I think mathlib needs a project manager :-))</li>\n</ul>\n</blockquote>\n<p>We are trying very hard to make something like this happen.</p>\n<p>But in the meantime, I think it's important that we do <em>something</em> with PRs which don't have any owner (in particular, because the author is absent). I don't think it makes sense to say \"someone should drive a conversation on zulip\" or \"someone should merge master\", because there's no one that \"someone\" points to. If we can produce such a someone, of course that is better than closing.</p>",
        "id": 512750557,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1744872258
    },
    {
        "content": "<p>I definitely agree that we should formulate and publicize a policy that allows/invites anyone to take over a stale PR.</p>",
        "id": 512750607,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1744872287
    },
    {
        "content": "<p>Allowing anyone to become that someone, under well-defined conditions, is the first step - agreed!</p>",
        "id": 512755992,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1744874350
    },
    {
        "content": "<p>One pipe dream of mine is to set up a \"triage team\" which does this, say, one hour a week. (This won't do wonders, but will help if done consistently.) Basically, by publically saying \"I'm doing this one hour a week, would somebody like to join me on a rotation?\". Then, it becomes \"put in one hour every N weeks\", which doesn't seem as bad.</p>\n<p>(I've done such work on an ad hoc basis, but institutionalising it could help.)</p>",
        "id": 512756246,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1744874448
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.23stale.20linkifier/near/512755992\">said</a>:</p>\n<blockquote>\n<p>Allowing anyone to become that someone, under well-defined conditions, is the first step - agreed!</p>\n</blockquote>\n<p>time to write some PR piracy guidelines <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 512772450,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1744879853
    }
]