[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib.Tactic</span>\n\n<span class=\"kd\">set_option</span><span class=\"w\"> </span><span class=\"n\">linter.style.multiGoal</span><span class=\"w\"> </span><span class=\"n\">true</span>\n\n<span class=\"kd\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">  </span><span class=\"n\">ring_nf</span>\n\n<span class=\"w\">  </span><span class=\"n\">generalize</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n<span class=\"w\">  </span><span class=\"c\">/-</span>\n<span class=\"cm\">  There are 2 unclosed goals before 'linarith' and at least one remaining goal afterwards.</span>\n<span class=\"cm\">  Please focus on the current goal, for instance using `Â·` (typed as \"\\.\").</span>\n<span class=\"cm\">  note: this linter can be disabled with `set_option linter.style.multiGoal false`</span>\n<span class=\"cm\">  -/</span>\n<span class=\"w\">  </span><span class=\"n\">fail_if_success</span><span class=\"w\"> </span><span class=\"n\">linarith</span>\n\n<span class=\"w\">  </span><span class=\"n\">omega</span>\n</code></pre></div>",
        "id": 478017903,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1729506746
    },
    {
        "content": "<p>There is only one unclosed goals before <code>linarith</code>.</p>",
        "id": 478018044,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1729506803
    },
    {
        "content": "<p>I'll look at this when I'm at a computer, but my initial reaction would be that the linter should ignore <code>fail_if_success</code> and friends.</p>",
        "id": 478018438,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1729506926
    },
    {
        "content": "<p>Also, thanks for the report!</p>",
        "id": 478018561,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1729506962
    },
    {
        "content": "<p>I'm also curious to understand why the linter thinks that there are two goals before <code>linarith</code>.</p>",
        "id": 478019205,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1729507180
    },
    {
        "content": "<p>I think that I know what is going on: the linter is \"doubling up\" as the <code>unusedTactic</code> linter (and merging the two was on my list anyway, once they were both in mathlib).</p>\n<p>The reason why it reports that there are 2 goals, rather than only one, is that the logic of the \"metavariable-tracking\" makes it look for goals before and after that are <em>equal</em>, assume that they were not the target of the tactic, so that there must have been another somewhere (hinging on the <code>unusedTactic</code> linter for taking care of \"useless\" tactics) and therefore report one more goal.</p>",
        "id": 478052146,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1729515071
    },
    {
        "content": "<p>Briefly, I will silence the linter on <code>fail_if_success</code> and the other similar tactics, since this is what it should do anyway.  If I actually merge the multi-goal and unused tactic linter, that silencing will be the same that is already in place for the unused tactic.</p>",
        "id": 478052373,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1729515124
    },
    {
        "content": "<p>Btw, this is already enough to show the same issue:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Linter</span><span class=\"bp\">.</span><span class=\"n\">Multigoal</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">fail_if_success</span><span class=\"w\"> </span><span class=\"n\">done</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">intro</span>\n</code></pre></div>",
        "id": 478053025,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1729515309
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/18063\">#18063</a></p>",
        "id": 478269723,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1729599072
    }
]