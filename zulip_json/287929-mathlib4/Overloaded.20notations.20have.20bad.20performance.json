[
    {
        "content": "<p>I was reading the discussion at <a href=\"https://github.com/leanprover-community/mathlib4/pull/22698\">#22698</a> which seemed to imply that overloading notations was having quite a performance hit.<br>\nSo in <a href=\"https://github.com/leanprover-community/mathlib4/pull/25922\">#25922</a> conducted a little experiment with an other famous overloaded notation: <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CategoryTheory.MonoidalCategoryStruct.tensorHom#doc\">docs#CategoryTheory.MonoidalCategoryStruct.tensorHom</a>, which has the same notation as <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CategoryTheory.MonoidalCategoryStruct.tensorObj#doc\">docs#CategoryTheory.MonoidalCategoryStruct.tensorObj</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CategoryTheory.MonoidalCategory.tensorIso#doc\">docs#CategoryTheory.MonoidalCategory.tensorIso</a>.</p>\n<p>I changed the tensor product of maps from <code>⊗</code> to <code>⊝</code> and the tensor product of isos to <code>⊖</code>, played build error whack-a-mole for half an hour and benched it, the result is a -<code>0.10%</code> on the whole build, with big improvement in files related to monoidal categories.</p>\n<p>I don’t have any opinion about changing these notations, because the current ones are both convenient and close to the common mathematical practice, but I feel that this is good data to have at hand.</p>",
        "id": 524143607,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1750006399
    },
    {
        "content": "<p>I should add that unification with those overloaded notations is very poor, to the point where I now reflexively replace with <code>tensorHom</code>/<code>tensorIso</code> when building a term, so that I can see what's going on in the infoview</p>",
        "id": 524143731,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1750006529
    },
    {
        "content": "<p>I would be happy with notations like <code>⊗ₘ</code> (for <code>ₘ</code>orphism) and <code>⊗ᵢ</code> (for <code>ᵢ</code>so)</p>",
        "id": 524143891,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1750006684
    },
    {
        "content": "<p>Just to be clear: the diff for this PR seems to indicate that it is literally only changing notation? And the bench is</p>\n<div class=\"codehilite\" data-code-language=\"Diff\"><pre><span></span><code><span class=\"gi\">+ ~Mathlib.CategoryTheory.Localization.Monoidal       instructions   -23.7%</span>\n<span class=\"gi\">+ ~Mathlib.CategoryTheory.Monoidal.Category           instructions   -21.1%</span>\n<span class=\"gi\">+ ~Mathlib.CategoryTheory.Monoidal.Mon_               instructions   -13.0%</span>\n<span class=\"gi\">+ ~Mathlib.Tactic.CategoryTheory.Monoidal.Normalize   instructions   -40.7%</span>\n</code></pre></div>\n<p>?!</p>",
        "id": 524145315,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1750008208
    },
    {
        "content": "<p>Yes Kevin, this is only a notation change.</p>",
        "id": 524145393,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1750008326
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Overloaded.20notations.20have.20bad.20performance/near/524143891\">said</a>:</p>\n<blockquote>\n<p>I would be happy with notations like <code>⊗ₘ</code> (for <code>ₘ</code>orphism) and <code>⊗ᵢ</code> (for <code>ᵢ</code>so)</p>\n</blockquote>\n<p>Seems like a good idea. Especially if we record a todo note to revisit this if the elaborator is improved in this area.</p>",
        "id": 524207759,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1750063837
    },
    {
        "content": "<p>Okay, does <span class=\"user-mention\" data-user-id=\"286014\">@Robin Carlier</span> want to update <a href=\"https://github.com/leanprover-community/mathlib4/pull/25922\">#25922</a> accordingly?</p>",
        "id": 524208983,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1750064237
    },
    {
        "content": "<p>I don’t mind running <code>sed</code> to change the notations again in the actual lean code, but this PR did not touch any docstrings and this might be more of a massive pain to go and change all of them everywhere, and I feel like this should be done if we change the notations, even if they’re still \"understandable\" with the old notations.<br>\nSo basically I’m okay updating if someone lends a hand for the docstring editions.</p>",
        "id": 524209732,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1750064481
    },
    {
        "content": "<p>Sure, happy to do that</p>",
        "id": 524209930,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1750064547
    },
    {
        "content": "<p>great, I’ll run the sed and give you access to my fork</p>",
        "id": 524210011,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1750064575
    },
    {
        "content": "<p>I should have access to that branch already unless you've unticked the box when opening the PR <span aria-label=\"wink\" class=\"emoji emoji-1f609\" role=\"img\" title=\"wink\">:wink:</span></p>",
        "id": 524210126,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1750064618
    },
    {
        "content": "<p>Oh right! even better.</p>",
        "id": 524210157,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1750064633
    },
    {
        "content": "<p>alright, I pushed the new notations, hopefully the autoreplace went well</p>",
        "id": 524211268,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1750065005
    },
    {
        "content": "<p>aaaand it rot already :D</p>",
        "id": 524211423,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1750065061
    },
    {
        "content": "<p>Should be ok now, have fun!</p>",
        "id": 524215091,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1750066371
    },
    {
        "content": "<p>Oh actually I can't seem to be able to push to your fork for some reason</p>",
        "id": 524231013,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1750071932
    },
    {
        "content": "<p>Wait no I did push. It's just the UI that complained about nothing</p>",
        "id": 524231144,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1750071976
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Overloaded.20notations.20have.20bad.20performance/near/524143891\">said</a>:</p>\n<blockquote>\n<p>I would be happy with notations like <code>⊗ₘ</code> (for <code>ₘ</code>orphism) and <code>⊗ᵢ</code> (for <code>ᵢ</code>so)</p>\n</blockquote>\n<p>Are these also notations for <code>TensorProduct.map</code> and <code>TensorProduct.congr</code>?</p>",
        "id": 524232121,
        "sender_full_name": "Jz Pan",
        "timestamp": 1750072307
    },
    {
        "content": "<p>I did not touch the notations outside of monoidal categories, so the current algebra notations are unchanged yet. If these are also duplicated, it’s worth investigating the perf drawback they bring.</p>",
        "id": 524232359,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1750072388
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"286014\">Robin Carlier</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Overloaded.20notations.20have.20bad.20performance/near/524232359\">said</a>:</p>\n<blockquote>\n<p>so the current algebra notations are unchanged yet.</p>\n</blockquote>\n<p>No I think currently there are no notations for them yet.</p>",
        "id": 524233043,
        "sender_full_name": "Jz Pan",
        "timestamp": 1750072619
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span> for going through the docstrings! I’ll format the PR body/title and  I think we’re good to go.</p>",
        "id": 524234208,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1750073041
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Overloaded.20notations.20have.20bad.20performance/near/524207759\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Overloaded.20notations.20have.20bad.20performance/near/524143891\">said</a>:</p>\n<blockquote>\n<p>I would be happy with notations like <code>⊗ₘ</code> (for <code>ₘ</code>orphism) and <code>⊗ᵢ</code> (for <code>ᵢ</code>so)</p>\n</blockquote>\n<p>Seems like a good idea. Especially if we record a todo note to revisit this if the elaborator is improved in this area.</p>\n</blockquote>\n<p>Did you also add some such todo? I couldn't quickly find it in the diff</p>",
        "id": 524241122,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1750075607
    },
    {
        "content": "<p>Nope, did not add any yet. I’ll add something about it soon and keep the PR tagged \"WIP\" untill it’s done</p>",
        "id": 524242089,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1750075955
    },
    {
        "content": "<p>Thanks! Please ping me when it's ready</p>",
        "id": 524242180,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1750075979
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Overloaded.20notations.20have.20bad.20performance/near/524242180\">said</a>:</p>\n<blockquote>\n<p>Thanks! Please ping me when it's ready</p>\n</blockquote>\n<p><span aria-label=\"ping pong\" class=\"emoji emoji-1f3d3\" role=\"img\" title=\"ping pong\">:ping_pong:</span></p>",
        "id": 524269746,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1750084083
    },
    {
        "content": "<p>ping-pong -- syn-ack -- <span aria-label=\"peace sign\" class=\"emoji emoji-270c\" role=\"img\" title=\"peace sign\">:peace_sign:</span></p>",
        "id": 524269952,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1750084153
    }
]