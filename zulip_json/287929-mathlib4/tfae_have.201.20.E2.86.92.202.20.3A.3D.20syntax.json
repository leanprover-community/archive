[
    {
        "content": "<p>This is a tiny feature request for the <code>tfae</code> tactic suite, and it isn't a particularly urgent one.</p>\n<p>The current syntax for <code>tfae_have</code> is</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code>  <span class=\"n\">tfae_have</span> <span class=\"mi\">1</span> <span class=\"bp\">→</span> <span class=\"mi\">2</span>\n  <span class=\"bp\">·</span> <span class=\"c1\">-- some proof</span>\n</code></pre></div>\n<p>For the sake of consistency and brevity, I think it would be great to be able to write</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code>  <span class=\"n\">tfae_have</span> <span class=\"mi\">1</span> <span class=\"bp\">→</span> <span class=\"mi\">2</span> <span class=\"o\">:=</span> <span class=\"c1\">-- some proof *term*</span>\n  <span class=\"n\">tfae_have</span> <span class=\"mi\">2</span> <span class=\"bp\">→</span> <span class=\"mi\">3</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n    <span class=\"c1\">-- some proof</span>\n</code></pre></div>",
        "id": 421976739,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1708146721
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/10653\">#10653</a> :)</p>",
        "id": 421993364,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1708159302
    },
    {
        "content": "<p>(This is an easy change, so I thought I might as well Just Do It. I'm not <em>officially</em> putting it out for review yet until I look it over tomorrow, but given that the change is relatively small, if someone wants to review it and put it on the queue, feel free. :) )</p>",
        "id": 421993974,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1708159592
    },
    {
        "content": "<p>(Ok, now it's out for review—note that half of the PR is just changes to the docs!)</p>",
        "id": 422048898,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1708210574
    },
    {
        "content": "<p>Question: should it support <code>tfae_have 1 → 2 := f ?a ?b</code> like <code>have</code> does to prevent any unexpected jolts? I have a commit ready to go which does this, it just complicates things a little.</p>",
        "id": 422050243,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1708212277
    },
    {
        "content": "<p>Is there a reason it can't fallback to the have tactic and inherit the behavior?</p>",
        "id": 422050340,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1708212382
    },
    {
        "content": "<p>Let me see if we can do it without losing the monadic version of the tactic.</p>",
        "id": 422050533,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1708212631
    },
    {
        "content": "<p>Perhaps also worth noting that the <code>have h : P; tactic</code> syntax seems to be on its way out, in case dropping that makes things notably easier for you</p>",
        "id": 422050622,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1708212764
    },
    {
        "content": "<p>I think I would be sad to see that syntax be completely removed. I'm happy with a style guide saying that it shouldn't be used. But I can imagine situations where you want to assert 5 <code>have</code>s without proof, and then hand over to a single tactic that works on all goals simultaneously.</p>",
        "id": 422065395,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1708230770
    },
    {
        "content": "<p>As a datapoint, <a href=\"https://github.com/leanprover-community/mathlib4/pull/10640\">#10640</a> (ready for review, will rot very quickly) is eliminating almost all uses of the old-fashioned <code>have</code>, <code>suffices</code> and <code>replace</code> throughout the library. Among these (2000 lines changed in 438 files), there are exactly zero fancy uses of the kind you're mentioning.</p>\n<p>In fact, I would argue against this use, because it would feel to me to be favoring golfing and obfuscation over readability (but I know not everyone shares my feeling against golfing).</p>",
        "id": 422080303,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1708245989
    },
    {
        "content": "<p>I thought it might make sense to actually just refactor <code>tfae_have</code> completely in terms of <code>have</code>. This means we have a couple ugly parsers up front to get the parsing to work—but these are almost identical to the ones for <code>have</code> except for simple, obvious changes, so they should be easy to check. (Likewise, later on, what seems like a chunky block of code is actually just repeating very similar one- or two-liners for the different parsing possibilities, completely formulaically.)</p>\n<p>This means we now get matching (for <code>→</code>) and destructuring (for <code>Iff</code>) basically for free.</p>\n<p>I also thought it made sense to change <code>tfae_have 1 → 2 ...</code> to <code>tfae_have : 1 → 2</code>. (<code>1 → 2</code> does represent the type, after all!) There were 207 instances of these, so that makes up the bulk of the numbers you see on the top of the PR; I got to remove some code from the actual tactic file. (This could also be changed pretty easily.)</p>\n<p>Anyway, this is all just an experiment (and the \"Mathlib <code>have</code>\" behavior is relegated to a single commit, so can be easily excluded if we like). Let me know what you like and/or don't like. :)</p>",
        "id": 422082936,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1708248521
    },
    {
        "content": "<p>Well, <code>1 → 2</code> is not a type, right? Maybe if you change the syntax to <code>have : tfae($1 → $2)</code> then you can start arguing it's a type.</p>",
        "id": 422083241,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1708248824
    },
    {
        "content": "<p>We write <code>tfae_have h : 1 → 2</code>, though.</p>",
        "id": 422083321,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1708248895
    },
    {
        "content": "<p>Does <code>1 → 2</code> make sense as anything else but (local) notation for a type?</p>",
        "id": 422083368,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1708248953
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"548935\">Thomas Murrills</span> <a href=\"#narrow/stream/287929-mathlib4/topic/tfae_have.201.20.E2.86.92.202.20.3A.3D.20syntax/near/422083321\">said</a>:</p>\n<blockquote>\n<p>We write <code>tfae_have h : 1 → 2</code>, though.</p>\n</blockquote>\n<p>Your message above says <code>tfae_have h : 1 → 2</code> is the syntax you want to migrate to? So I assume it's not current syntax.</p>",
        "id": 422083491,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1708249044
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"548935\">Thomas Murrills</span> <a href=\"#narrow/stream/287929-mathlib4/topic/tfae_have.201.20.E2.86.92.202.20.3A.3D.20syntax/near/422083368\">said</a>:</p>\n<blockquote>\n<p>Does <code>1 → 2</code> make sense as anything else but (local) notation for a type?</p>\n</blockquote>\n<p>In a combinatorics class it would most certainly denote <code>Fin 1 → Fin 2</code> (or rather <code>{1} → {1, 2}</code>, but that's beside the point).</p>",
        "id": 422083575,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1708249108
    },
    {
        "content": "<p>No, it is current syntax; that's not the syntax we're migrating to. <code>tfae_have 1 → 2</code> and <code>tfae_have h : 1 → 2</code> are the current syntax options. I'm saying we should migrate to <code>tfae_have : 1 → 2</code> and <code>tfae_have h : 1 → 2</code>.</p>",
        "id": 422083579,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1708249112
    },
    {
        "content": "<p>My point is that here, by writing <code>1 → 2</code>, you really are gesturing to the type <code>P1 → P2</code> for the propositions <code>P1</code>, <code>P2</code> in your TFAE, so this really does amount to a (very) local notation for a type!</p>",
        "id": 422083747,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1708249275
    },
    {
        "content": "<p>I am claiming that you should use quotes if you really want this analogy to work</p>",
        "id": 422083852,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1708249373
    },
    {
        "content": "<p>Why?</p>",
        "id": 422083876,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1708249401
    },
    {
        "content": "<p>(Though, btw, I have found a grand total of 0 extant uses of <code>tfae_have h : 1 → 2</code>, so it may as well not exist. :P That's besides the point anyway, though.)</p>",
        "id": 422083971,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1708249480
    },
    {
        "content": "<p>because everywhere else in Lean the <code>: α</code> syntax means that <code>α</code> is a type, and <code>1 → 2</code> is <em>not</em> a type. It's a type after \"processing\" it and replacing the <code>1</code> and <code>2</code> by actual propositions, but it's not a type. And incidentally that \"processing, replacing some subexpressions by other subexpressions\" sounds exactly like something a quote would do.</p>",
        "id": 422084365,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1708249859
    },
    {
        "content": "<p>It sounds to me exactly like something <em>notation</em> would do. :)</p>",
        "id": 422084501,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1708249989
    },
    {
        "content": "<p>Like, I guess the thing for me is that it doesn't seem like a technicality: both \"spiritually\" and literally, <code>1 → 2</code> seems like notation for <code>P1 → P2</code>. It undoubtedly gestures to the type <code>P1 → P2</code>, with <code>1</code> gesturing to <code>P1</code> and <code>2</code> gesturing to <code>P2</code> (in this context, anyway—but we're allowed to use the context for interpreting notation!); but also, in a literal sense, we elaborate the <code>num</code> syntax into these expressions.</p>",
        "id": 422085258,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1708250686
    },
    {
        "content": "<p>What I can see is that maybe having notation that's only active in a type annotation for <code>tfae_have</code> feels unsavory—personally I'd prioritize communicating the roles of things over banishing \"invisible\" scopes (<code>tfae_have</code> is indeed <em>there</em>, so it's not totally invisible, but I can still understand its type annotation \"feeling unconstrained\" by <code>tfae_have</code>, unlike <code>tfae(something)</code>...), but that's ultimately a matter of aesthetics/preferences, and both views are reasonable, I think. :)</p>",
        "id": 422085694,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1708251079
    },
    {
        "content": "<p><del>(Which is why the only solution is to create local <code>OfNat Prop</code> instances.)</del> (I am kidding here, that sounds extremely cursed.)</p>",
        "id": 422085921,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1708251250
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/stream/287929-mathlib4/topic/tfae_have.201.20.E2.86.92.202.20.3A.3D.20syntax/near/422065395\">said</a>:</p>\n<blockquote>\n<p>I think I would be sad to see that syntax be completely removed. I'm happy with a style guide saying that it shouldn't be used. But I can imagine situations where you want to assert 5 <code>have</code>s without proof, and then hand over to a single tactic that works on all goals simultaneously.</p>\n</blockquote>\n<p><code>have : P := ?p</code> should still work for this use-case</p>",
        "id": 422133120,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1708293934
    },
    {
        "content": "<p>By the way, I think at some point there was some mismatch between the numbering inside the proof (starting at 1) and the numbering in <code>TFAE.out</code> (starting at 0). Is that still the case?</p>",
        "id": 422133816,
        "sender_full_name": "Anatole Dedecker",
        "timestamp": 1708294489
    },
    {
        "content": "<p>It looks like it, unfortunately. Btw, <span class=\"user-mention\" data-user-id=\"197836\">@Jireh Loreaux</span> and I are trying to implement a nice interface for accessing and using <code>TFAE</code> statements (see <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/stream/287929-mathlib4/topic/TFAE.20discussion\">#mathlib4 &gt; TFAE discussion</a>), so that you can simply write something like <code>infer : foo → bar</code> and the right lemma will be extracted for you, so hopefully <code>TFAE.out</code> won't need to be used directly. (We're also eventually considering proposing a change to the <code>TFAE</code> type itself so that it doesn't have to be a simple list, and the lemmas can actually have names, though that's a secondary goal.) Early days, but happening! :)</p>",
        "id": 422134672,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1708295188
    },
    {
        "content": "<p>Btw, re: tfae tactic syntax, if we're talking ideals: there's also the option of soon just abandoning <code>tfae_have</code> in favor of some kind of block tactic and/or term, like</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code>  <span class=\"n\">tfae</span>\n  <span class=\"bp\">|</span> <span class=\"mi\">1</span> <span class=\"bp\">→</span> <span class=\"mi\">2</span> <span class=\"bp\">=&gt;</span> <span class=\"n\">pq</span>\n  <span class=\"bp\">|</span> <span class=\"mi\">2</span> <span class=\"bp\">→</span> <span class=\"mi\">1</span> <span class=\"bp\">=&gt;</span> <span class=\"n\">qp</span>\n  <span class=\"bp\">|</span> <span class=\"mi\">2</span> <span class=\"bp\">↔</span> <span class=\"mi\">3</span> <span class=\"bp\">=&gt;</span> <span class=\"n\">qr</span>\n</code></pre></div>\n<p>or something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code>  <span class=\"n\">tfae_where</span>\n    <span class=\"mi\">1</span> <span class=\"bp\">→</span> <span class=\"mi\">2</span> <span class=\"o\">:=</span> <span class=\"n\">pq</span>\n    <span class=\"mi\">2</span> <span class=\"bp\">→</span> <span class=\"mi\">1</span> <span class=\"o\">:=</span> <span class=\"n\">qp</span>\n    <span class=\"mi\">2</span> <span class=\"bp\">↔</span> <span class=\"mi\">3</span> <span class=\"o\">:=</span> <span class=\"n\">qr</span>\n</code></pre></div>\n<p>The first looks nicer imo, but the second is really more in keeping with the typical meaning of lean syntax: we're not matching on anything like <code>1 → 2</code> (or even a term of that type) and using it in the body; instead, we're providing something like <code>1 → 2</code> (like <code>:=</code> does).  Also, in practice a lot of <code>tfae_have</code>s are followed by <code>intro a b c</code> or <code>exact fun a b c ...</code>, and now we can just write <code>tfae_have : 1 → 2 | a, b, c =&gt; ...</code> (with a newline, typically). That's more compatible with the where-like syntax than the <code>=&gt;</code> syntax. (<code>tfae where</code> is not a great initial token, though. Maybe just <code>tfae</code>? This could also be given syntax like a structure instance, e.g. <code>TFAE{ 1 → 2 := pq, 2 → 1 := qp .... }</code>. No solid proposal here, just some thoughts.)</p>\n<p>It looks like almost every <code>TFAE</code> proves goals in this manner anyway, without using other tactics on the main goal besides <code>tfae_have</code>s before <code>tfae_finish</code>.</p>\n<p>This could initially be just a macro over <code>tfae_have</code> and <code>tfae_finish</code>, but could later be optimized further since we have access to all the indices used at once (and don't need to search through the local context).</p>",
        "id": 422135630,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1708296137
    },
    {
        "content": "<p>AFAIR, one of these syntaxes was suggested when <code>tfae</code> was ported, but we decided to go with mathlib3 syntax for compatibility reasons.</p>",
        "id": 422141420,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1708301822
    },
    {
        "content": "<p>yes, I think it is safe to migrate from <code>tfae_have</code> / <code>tfae_finish</code> to a single <code>tfae</code> tactic now that the port is done</p>",
        "id": 422587772,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1708511772
    },
    {
        "content": "<p>Ok! Given that we want to migrate to a block tactic, there's not really any point in using <code>tfae_have :</code> over <code>tfae_have</code>. As such, I've reverted that change in <a href=\"https://github.com/leanprover-community/mathlib4/pull/10653\">#10653</a>.</p>\n<p>Currently <a href=\"https://github.com/leanprover-community/mathlib4/pull/10653\">#10653</a> still supports the \"Mathlib have\"/\"old style\" syntax. I wonder how we should handle deprecating that syntax (and for that matter, deprecating the old-style <code>have</code> syntax) without causing too much strife for anyone downstream. It does de-document the old-style syntax (i.e. removes mention of it from the dosctring), though.</p>\n<p>Likewise, I wonder how to \"deprecate\" <code>tfae_have</code>/<code>tfae_finish</code> when moving to a block tactic. Currently I simply put a note at the start of the docstring of the old tactics stating that the block tactic is preferred. Maybe that's the best we can do for now? Open to suggestions.</p>",
        "id": 423536904,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1709012967
    },
    {
        "content": "<p>Thanks for all your work on this!</p>\n<p>Can code actions transform one tactic script to another?</p>",
        "id": 423537043,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1709013080
    },
    {
        "content": "<p>The sequence of PR's is currently:</p>\n<ul>\n<li><a href=\"https://github.com/leanprover-community/mathlib4/pull/10653\">#10653</a> (awaiting-review): introduce <code>tfae_have ... :=</code> syntax</li>\n<li><a href=\"https://github.com/leanprover-community/mathlib4/pull/11000\">#11000</a> (awaiting-review): banish \"old-style\" <code>tfae_have</code> syntax from mathlib</li>\n<li><a href=\"https://github.com/leanprover-community/mathlib4/pull/10991\">#10991</a> (awaiting-review): introduce a (simply-implemented) <code>tfae</code> block tactic</li>\n<li><a href=\"https://github.com/leanprover-community/mathlib4/pull/11003\">#11003</a> (awaiting-review): transition mathlib to a block tactic</li>\n</ul>\n<p>(Note that none of these actually remove functionality.)</p>",
        "id": 423537323,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1709013260
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/stream/287929-mathlib4/topic/tfae_have.201.20.E2.86.92.202.20.3A.3D.20syntax/near/423537043\">said</a>:</p>\n<blockquote>\n<p>Thanks for all your work on this!</p>\n<p>Can code actions transform one tactic script to another?</p>\n</blockquote>\n<p>In principle! Hmm...if we wanted a code action coming from <code>tfae_have</code>, the issue might be that we'd have to reach up from the <code>tfae_have</code> syntax to get the rest of the syntax, and organize it all at once. This isn't necessarily an insurmountable issue, though.</p>",
        "id": 423537578,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1709013427
    },
    {
        "content": "<p>The syntax I settled on for the block tactic so far is</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code>  <span class=\"n\">tfae</span>\n    <span class=\"mi\">1</span> <span class=\"bp\">→</span> <span class=\"mi\">2</span> <span class=\"o\">:=</span> <span class=\"c\">/-</span><span class=\"cm\"> proof of `P₁ → P₂` -/</span>\n    <span class=\"mi\">2</span> <span class=\"bp\">→</span> <span class=\"mi\">3</span> <span class=\"o\">:=</span> <span class=\"c\">/-</span><span class=\"cm\"> proof of `P₂ → P₃` -/</span>\n    <span class=\"mi\">3</span> <span class=\"bp\">→</span> <span class=\"mi\">1</span> <span class=\"o\">:=</span> <span class=\"c\">/-</span><span class=\"cm\"> proof of `P₃ → P₁` -/</span>\n</code></pre></div>\n<p>I figured the simplest-possible initial token plus the most semantically consistent field notation was the best bet (see above), but I'm open to other opinions! :)</p>",
        "id": 423539959,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1709014948
    },
    {
        "content": "<p>I've been employed and inactive for the past few months, but now that my contract's up (and I've had a bit of a break), I've freshened these PRs, and hope to add to them soon. :)</p>\n<p>(I figure the code actions and deprecation are best done in subsequent PRs to keep the PRs (relatively) small and single-purpose, so I've only modified these PRs very slightly.)</p>",
        "id": 470060546,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1726267701
    },
    {
        "content": "<p>I'm wondering what the best way to deprecate the old-style tactic syntax is here.</p>\n<p>In general, when deprecating syntax, there's a spectrum from \"more graceful/lenient deprecation\" to \"hard deprecation\"/\"completely breaking change\".</p>\n<p>We can do a lot to be graceful if we want; the <em>most</em> graceful deprecation <strong>(A)</strong>, I think, involves</p>\n<ol>\n<li>Preserving the old syntax and implementation in the same import, so old-style code logs a warning but doesn't break</li>\n<li>Providing a <code>set_option</code> to turn off the warning</li>\n<li>Providing a code action to transform the syntax</li>\n</ol>\n<p>A less graceful deprecation <strong>(B)</strong> might involve eliminating A.2 and/or A.3, or might look like</p>\n<ol>\n<li>Moving the old-style implementation to a new file, but</li>\n<li>Preserving the old syntax in the current import so that it parses, and logging a warning that instructs the user to import the new file if they wish to use it. (This will break the rest of the proof, but still be visible to the user.)</li>\n</ol>\n<p>I'm using the term \"hard deprecation\" <strong>(C)</strong> to refer to removing both the old syntax and the old implementation from the import hierarchy in such a way that proofs break (fail to parse) with no informative message.</p>\n<p>This may or may not also involve maintaining the old-style syntax and implementation in a \"leaf\" file outside the import hierarchy, like Mathlib-style <code>have</code>.</p>\n<p>Note that a staggered deprecation (a graceful deprecation which warns of an impending hard deprecation) is also an option. These possibilities can, of course, be mixed and matched to some extent.</p>\n<hr>\n<p>I thought I'd outline these options both to make it easier to choose a deprecation path for old-style <code>tfae_have</code> syntax and to provide some public consideration of options for deprecating syntax in general.</p>",
        "id": 471638953,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1726815542
    },
    {
        "content": "<p>So, do people have an opinion on how we should deprecate the old-style <code>tfae_have</code> (which is like Mathlib <code>have</code>) in favor of <code>tfae_have ... :=</code>?</p>\n<p><code>tfae_have</code> is, er, not exactly a contender for \"most-used tactic\", to say the least—so, for example, less graceful deprecations seem to be more acceptable in this instance when balanced against the cost of more graceful deprecations.</p>\n<p>There seems to be <a href=\"https://github.com/leanprover-community/mathlib4/pull/10653#discussion_r1764252119\">support</a> on <a href=\"https://github.com/leanprover-community/mathlib4/pull/10653\">#10653</a> for moving old-style <code>tfae_have</code> to its own file, which might suggest options (B) or (C). But it's not too onerous to provide option A (excluding A.3—it's a little awkward to provide a reliable code action for this case, since there's no guarantee on how the goals will be handled. You don't even have to prove them immediately!). </p>\n<p>After reflection I think I might lean towards A.1 and A.2 instead of what I suggested on the PR.</p>\n<p>Thoughts?</p>",
        "id": 471639112,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1726815591
    },
    {
        "content": "<p>I think that A.1 and A.2 are good choices.</p>",
        "id": 471641626,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1726816283
    },
    {
        "content": "<p>I do not use <code>tfae</code> at all in the course that I teach, but, if I did, it would be really helpful to get hints on how to modify code so that it keeps working, when updating for the new year.</p>",
        "id": 471641672,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1726816297
    },
    {
        "content": "<p>How about</p>\n<ol>\n<li><del>Land the new syntax next to the old one, no warnings</del> (done in <a href=\"https://github.com/leanprover-community/mathlib4/pull/10653\">#10653</a>)</li>\n<li>In one or more PRs, replace the uses in mathlib</li>\n<li>Add a warning for downstream projects</li>\n<li>Wait six months</li>\n<li>Remove the old syntax</li>\n</ol>",
        "id": 471641936,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1726816379
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/stream/287929-mathlib4/topic/tfae_have.201.20.E2.86.92.202.20.3A.3D.20syntax/near/471641936\">said</a>:</p>\n<blockquote>\n<p>How about</p>\n<ol start=\"4\">\n<li>Wait <del>six months</del> a year?</li>\n</ol>\n</blockquote>\n<p>Most teaching is year-based, so six months would unlikely be helpful for updating a course.</p>",
        "id": 471642161,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1726816451
    },
    {
        "content": "<p>Read \"at least\" before \"six months\" :)</p>",
        "id": 471643401,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1726816868
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/stream/287929-mathlib4/topic/tfae_have.201.20.E2.86.92.202.20.3A.3D.20syntax/near/471642161\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/stream/287929-mathlib4/topic/tfae_have.201.20.E2.86.92.202.20.3A.3D.20syntax/near/471641936\">said</a>:</p>\n<blockquote>\n<p>How about</p>\n<ol start=\"4\">\n<li>Wait <del>six months</del> a year?</li>\n</ol>\n</blockquote>\n<p>Most teaching is year-based, so six months would unlikely be helpful for updating a course.</p>\n</blockquote>\n<p>I think people are going to have to get used to bumping to intermediate versions. (e.g. using the <code>v4.X.0</code> tags on Mathlib). That is too long for us to currently keep deprecations / warnings around.</p>",
        "id": 471816762,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726861163
    },
    {
        "content": "<p>Is it?</p>\n<p>But yeah, going version by version makes sense</p>",
        "id": 471828936,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1726864530
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/287929-mathlib4/topic/tfae_have.201.20.E2.86.92.202.20.3A.3D.20syntax/near/471816762\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/stream/287929-mathlib4/topic/tfae_have.201.20.E2.86.92.202.20.3A.3D.20syntax/near/471642161\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/stream/287929-mathlib4/topic/tfae_have.201.20.E2.86.92.202.20.3A.3D.20syntax/near/471641936\">said</a>:</p>\n<blockquote>\n<p>How about</p>\n<ol start=\"4\">\n<li>Wait <del>six months</del> a year?</li>\n</ol>\n</blockquote>\n<p>Most teaching is year-based, so six months would unlikely be helpful for updating a course.</p>\n</blockquote>\n<p>I think people are going to have to get used to bumping to intermediate versions. (e.g. using the <code>v4.X.0</code> tags on Mathlib). That is too long for us to currently keep deprecations / warnings around.</p>\n</blockquote>\n<p>What does this mean in practical terms for deprecating syntax? Jump straight to a hard deprecation, or provide a warning until some future version?</p>",
        "id": 471977555,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1726955018
    },
    {
        "content": "<p>I think a deprecation is fine; I don't see why we should treat tactic deprecations that differently to lemma renames</p>",
        "id": 471984980,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1726962148
    },
    {
        "content": "<p>Do lemma renames typically get a <code>@[deprecated]</code> attribute? (If so, then you mean we should at least log a deprecation warning to treat them similarly, right?)</p>",
        "id": 471985359,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1726962575
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"548935\">Thomas Murrills</span> <a href=\"#narrow/stream/287929-mathlib4/topic/tfae_have.201.20.E2.86.92.202.20.3A.3D.20syntax/near/471977555\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/287929-mathlib4/topic/tfae_have.201.20.E2.86.92.202.20.3A.3D.20syntax/near/471816762\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/stream/287929-mathlib4/topic/tfae_have.201.20.E2.86.92.202.20.3A.3D.20syntax/near/471642161\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/stream/287929-mathlib4/topic/tfae_have.201.20.E2.86.92.202.20.3A.3D.20syntax/near/471641936\">said</a>:</p>\n<blockquote>\n<p>How about</p>\n<ol start=\"4\">\n<li>Wait <del>six months</del> a year?</li>\n</ol>\n</blockquote>\n<p>Most teaching is year-based, so six months would unlikely be helpful for updating a course.</p>\n</blockquote>\n<p>I think people are going to have to get used to bumping to intermediate versions. (e.g. using the <code>v4.X.0</code> tags on Mathlib). That is too long for us to currently keep deprecations / warnings around.</p>\n</blockquote>\n<p>What does this mean in practical terms for deprecating syntax? Jump straight to a hard deprecation, or provide a warning until some future version?</p>\n</blockquote>\n<p>It means that if v4.11 doesn't support the new syntax yet, v4.12 should print a helpful warning on the old syntax, and it should not be removed before v4.13. Then a downstream project can update from 11 to 12, see and address the warning, and can safely update to 13 without worrying whether the old syntax still works</p>",
        "id": 472018338,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1726986667
    },
    {
        "content": "<p>Ah, ok, sounds good. Is there some way of \"scheduling\" a PR/issue for a later version, or does someone just have to remember to address it again after a while? :)</p>",
        "id": 472022062,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1726989618
    },
    {
        "content": "<p>theres a label <code>blocked-by-core-release</code>. Maybe lets try to use that and specify in the PR description that it should be merged \"after the <code>v4.12.0</code> bump\".</p>",
        "id": 472030365,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1726996358
    },
    {
        "content": "<p>I decided to split off the deprecation PR from the syntax migration PR; <a href=\"https://github.com/leanprover-community/mathlib4/pull/11000\">#11000</a> only modifies proof syntax (and can be safely merged without causing any warnings/breakages downstream), and <a href=\"https://github.com/leanprover-community/mathlib4/pull/17045\">#17045</a> is responsible for actually causing a deprecation warning to be logged. (Wow, 6000+ PRs in between those two!)</p>\n<p>Should that warning include something like \"this syntax will be removed/moved to its own file(?) when Mathlib bumps to v4.13.0\"?</p>\n<p>(Am I understanding correctly that adding the deprecation warning on the old syntax (which currently exists alongside the new syntax) in <a href=\"https://github.com/leanprover-community/mathlib4/pull/17045\">#17045</a> should also occur on or near a bump if possible? Or is that alright to merge now?)</p>",
        "id": 472151981,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1727076610
    },
    {
        "content": "<p>No, add the warning asap once mathlib doesn't trigger it anymore</p>",
        "id": 472155924,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1727077842
    },
    {
        "content": "<p>Okay, in that case <a href=\"https://github.com/leanprover-community/mathlib4/pull/11000\">#11000</a> and <a href=\"https://github.com/leanprover-community/mathlib4/pull/17045\">#17045</a> should be merged closely together. :)</p>",
        "id": 472156112,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1727077911
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> mentioned on <a href=\"https://github.com/leanprover-community/mathlib4/pull/17045\">#17045</a> that old-style <code>have</code> is not actually deprecated (and is used in a couple of places), so we shouldn’t deprecate old-style <code>tfae_have</code>.</p>\n<p>Here are the options as I see them:</p>\n<ol>\n<li>Leave the old-style <code>tfae_have</code> syntax in place and not deprecated, possibly with documentation expressing that it’s discouraged.</li>\n<li>Move the syntax and implementation to its own file off the import hierarchy like Mathlib <code>have</code>, with a warning that this will happen until we do.</li>\n<li>Just be inconsistent in how we treat <code>tfae_have</code> and <code>have</code> (and deprecate old-style <code>tfae_have</code>) especially since <code>tfae_have</code> is used far less.</li>\n<li>Deprecate (or simply warn against) <em>both</em> Mathlib <code>have</code> and old-style <code>tfae_have</code>—possibly just in Mathlib, possibly everywhere.</li>\n</ol>",
        "id": 472324532,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1727123054
    },
    {
        "content": "<p>Old-style <code>tfae_have</code> syntax is beginning to creep back into Mathlib! <span aria-label=\"grimacing\" class=\"emoji emoji-1f62c\" role=\"img\" title=\"grimacing\">:grimacing:</span></p>\n<p>I propose merging <a href=\"https://github.com/leanprover-community/mathlib4/pull/17045\">#17045</a> as-is (up to potential review comments): it deprecates the old-style syntax via deprecation warning (preserving functionality) but provides an option to turn the deprecation warning off.</p>\n<p>I think providing the ability to use a <code>set_option</code> to turn off the deprecation warning provides enough of an escape hatch (equivalent to sequestering old-style <code>have</code> in its own import) if it's ever truly necessary to use the old-style syntax.</p>",
        "id": 477082400,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1729032289
    },
    {
        "content": "<p>I'm happy to make a poll if there's still disagreement, though. (Just thumbs-up this message. :) <del>I'll wait a day for objections then remove the <code>awaiting-zulip</code> tag.</del> Okay, I've removed the tag.)</p>",
        "id": 477082718,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1729032460
    },
    {
        "content": "<p>Gently pinging this PR, since even more old-style syntax has crept in since the last time it crept in. :)</p>",
        "id": 479971032,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1730415564
    }
]