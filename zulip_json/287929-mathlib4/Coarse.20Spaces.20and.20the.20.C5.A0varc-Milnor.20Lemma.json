[
    {
        "content": "<p>Hello all,</p>\n<p>I've been working on a geometric group theory library for Lean using a coarse spaces approach. You can find the repositoryÂ <a href=\"https://github.com/koly777/GeometricGroupTheoryLean\">here</a>. The first milestone is complete: theÂ <strong>Å varc-Milnor Lemma</strong>Â (~6,900 lines total and documented).</p>\n<h2>Coarse space recap</h2>\n<p>A coarse space is a collection of \"controlled\" entourages (subsets ofÂ <code>X Ã— X</code>) that capture the notion of \"bounded distance\" without reference to a metric. One can think of an entourage as points with uniformly bounded distance (this analogy is explicit in theÂ <code>Metric/Basic.lean</code>Â file where we define the basic controlled entourages as follows:Â <code>E</code>Â is controlled iffÂ <code>âˆƒ r : â„â‰¥0, âˆ€ x y, (x, y) âˆˆ E â†’ edist x y â‰¤ r</code>). The axioms come in two flavors:<br>\n<em>Metric axioms lifted to sets:</em></p>\n<ul>\n<li>The diagonal is controlled (points are close to themselves)</li>\n<li>\n<p>Controlled sets are symmetric and closed under composition<br>\n<em>Bornology-like axioms:</em></p>\n</li>\n<li>\n<p>Subsets and finite unions of controlled sets are controlled</p>\n</li>\n</ul>\n<p>I created a generalÂ <code>Entourage</code>Â API for this, since Mathlib's existingÂ <code>SetRel</code>Â infrastructure is better suited to uniform spaces as opposed to coarse spaces.</p>\n<p>Two functionsÂ <code>f g : Î± â†’ X</code>Â areÂ <strong>close</strong>Â (notationÂ <code>f =á¶œ g</code>) if the setÂ <code>{(f a, g a) | a : Î±}</code>Â is controlledâ€”i.e., they're uniformly within bounded distance of each other. AÂ <strong>controlled map</strong>Â (standard terminology:Â <em>bornologous</em>) sends controlled sets to controlled sets (the analogue of being coarsely Lipschitz). AÂ <strong>coarsely proper map</strong>Â has the property that preimages of coarsely bounded sets are coarsely bounded. AÂ <strong>coarse map</strong>Â is both controlled and coarsely proper. AÂ <strong>coarse equivalence</strong>Â is a pair of coarse maps that are mutually inverse up to closenessâ€”this is the coarse analogue of quasi-isometry, but without explicit constants.</p>\n<p>The formalization of coarse spaces is based on J. Roe, <em>Lectures on Coarse Geometry</em>, University Lecture Series 31, AMS, 2003</p>\n<h2>The coarse space approach</h2>\n<p>After a lot of experimenting, I settled on coarse spaces as the foundation rather than the traditional route via word metrics and quasi-isometries. A few advantages:</p>\n<ol>\n<li>\n<p><strong>Canonical instance on groups.</strong>Â Different generating sets yield different (but quasi-isometric) word metrics, so one cannot place a singleÂ <code>MetricSpace</code>Â instance on a group. The coarse approach allows a single canonicalÂ <code>CoarseSpace</code>Â instance independent of generating set.</p>\n</li>\n<li>\n<p><strong>Avoiding the word metric.</strong>Â One goal of GGT is showing that under suitable geometric conditions, the word problem is decidable and distance becomes computable. If we construct a generic word metric it would need to be non computable to work over all groups. Furthermore, many groups already come with natural metrics that may or may not coincide with some word metricâ€”forcing Å varc-Milnor through a word metric construction felt architecturally unclean.</p>\n</li>\n<li>\n<p><strong>Avoiding geodesics/length spaces.</strong>Â I don't know what use cases Mathlib needs these for or what the best architecture would be for future directions, so I avoided formalizing them.</p>\n</li>\n</ol>\n<h2>Library structure</h2>\n<p>The library mirrors Mathlib's topology hierarchy (ignoring Entourage, QuasiIsometry, and ApproximateMidpoints files which ought to be moved elsewhere since they don't involve coarse spaces directly):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">CoarseSpace</span><span class=\"bp\">/</span>\n<span class=\"bp\">â”œâ”€â”€</span><span class=\"w\"> </span><span class=\"n\">Entourage</span><span class=\"bp\">/</span>\n<span class=\"bp\">â”‚</span><span class=\"w\">   </span><span class=\"bp\">â””â”€â”€</span><span class=\"w\"> </span><span class=\"n\">Basic</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"w\">            </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Entourage</span><span class=\"w\"> </span><span class=\"n\">API</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">composition</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">â—‹</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">inverse</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">symmetrization</span>\n<span class=\"bp\">â”œâ”€â”€</span><span class=\"w\"> </span><span class=\"n\">Defs</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"w\">                 </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">CoarseSpace</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">IsControlled</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Coarse</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Controlled</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">CoarselyProper</span>\n<span class=\"bp\">â”œâ”€â”€</span><span class=\"w\"> </span><span class=\"n\">Basic</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"w\">                </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Core</span><span class=\"w\"> </span><span class=\"n\">lemmas</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">API</span>\n<span class=\"bp\">â”œâ”€â”€</span><span class=\"w\"> </span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"w\">                </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Complete</span><span class=\"w\"> </span><span class=\"n\">lattice</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">coarse</span><span class=\"w\"> </span><span class=\"n\">structures</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">generateFrom</span>\n<span class=\"bp\">â”œâ”€â”€</span><span class=\"w\"> </span><span class=\"n\">Constructions</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"w\">        </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Products</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">subspaces</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">induced</span><span class=\"bp\">/</span><span class=\"n\">coinduced</span><span class=\"w\"> </span><span class=\"n\">structures</span>\n<span class=\"bp\">â”œâ”€â”€</span><span class=\"w\"> </span><span class=\"n\">Connected</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"w\">            </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Coarsely</span><span class=\"w\"> </span><span class=\"n\">connected</span><span class=\"w\"> </span><span class=\"n\">spaces</span>\n<span class=\"bp\">â”œâ”€â”€</span><span class=\"w\"> </span><span class=\"n\">Finiteness</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"w\">           </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Finitely</span><span class=\"w\"> </span><span class=\"n\">generated</span><span class=\"w\"> </span><span class=\"n\">coarse</span><span class=\"w\"> </span><span class=\"n\">spaces</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FG</span><span class=\"o\">)</span>\n<span class=\"bp\">â”œâ”€â”€</span><span class=\"w\"> </span><span class=\"n\">CoarseEquiv</span><span class=\"bp\">/</span>\n<span class=\"bp\">â”‚</span><span class=\"w\">   </span><span class=\"bp\">â”œâ”€â”€</span><span class=\"w\"> </span><span class=\"n\">Defs</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"w\">             </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">CoarseEquiv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">â‰ƒá¶œ</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">refl</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">symm</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">trans</span>\n<span class=\"bp\">â”‚</span><span class=\"w\">   </span><span class=\"bp\">â”œâ”€â”€</span><span class=\"w\"> </span><span class=\"n\">Lemmas</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"w\">           </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Transferring</span><span class=\"w\"> </span><span class=\"n\">coarse</span><span class=\"w\"> </span><span class=\"n\">properties</span><span class=\"w\"> </span><span class=\"n\">across</span><span class=\"w\"> </span><span class=\"n\">coarse</span><span class=\"w\"> </span><span class=\"n\">equivs</span>\n<span class=\"bp\">â”‚</span><span class=\"w\">   </span><span class=\"bp\">â””â”€â”€</span><span class=\"w\"> </span><span class=\"n\">TransferInstance</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Transfer</span><span class=\"w\"> </span><span class=\"n\">coarse</span><span class=\"w\"> </span><span class=\"n\">structures</span><span class=\"w\"> </span><span class=\"n\">across</span><span class=\"w\"> </span><span class=\"n\">equivalences</span>\n<span class=\"bp\">â”œâ”€â”€</span><span class=\"w\"> </span><span class=\"n\">QuasiIsometry</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"w\">        </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">QuasiIsometryWith</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">QuasiIsometry</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">QuasiIsometryEquiv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">â‰ƒ</span><span class=\"n\">qi</span><span class=\"o\">)</span>\n<span class=\"bp\">â”œâ”€â”€</span><span class=\"w\"> </span><span class=\"n\">ApproximateMidpoints</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">HasCoarseMidpoints</span>\n<span class=\"bp\">â”œâ”€â”€</span><span class=\"w\"> </span><span class=\"n\">CoarseSMul</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"w\">           </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Coarse</span><span class=\"w\"> </span><span class=\"n\">group</span><span class=\"w\"> </span><span class=\"n\">actions</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">coarse</span><span class=\"w\"> </span><span class=\"bp\">Å </span><span class=\"n\">varc</span><span class=\"bp\">-</span><span class=\"n\">Milnor</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"bp\">â‰ƒá¶œ</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span>\n<span class=\"bp\">â”œâ”€â”€</span><span class=\"w\"> </span><span class=\"n\">Group</span><span class=\"bp\">/</span>\n<span class=\"bp\">â”‚</span><span class=\"w\">   </span><span class=\"bp\">â”œâ”€â”€</span><span class=\"w\"> </span><span class=\"n\">Basic</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"w\">            </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Left</span><span class=\"bp\">-</span><span class=\"n\">multiplication</span><span class=\"w\"> </span><span class=\"n\">coarse</span><span class=\"w\"> </span><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">groups</span>\n<span class=\"bp\">â”‚</span><span class=\"w\">   </span><span class=\"bp\">â”œâ”€â”€</span><span class=\"w\"> </span><span class=\"n\">LeftInvariant</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"w\">    </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Left</span><span class=\"bp\">-</span><span class=\"n\">invariant</span><span class=\"w\"> </span><span class=\"n\">metrics</span><span class=\"w\"> </span><span class=\"bp\">â†”</span><span class=\"w\"> </span><span class=\"n\">coarse</span><span class=\"w\"> </span><span class=\"n\">structures</span>\n<span class=\"bp\">â”‚</span><span class=\"w\">   </span><span class=\"bp\">â””â”€â”€</span><span class=\"w\"> </span><span class=\"n\">SvarcMilnor</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"w\">      </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Full</span><span class=\"w\"> </span><span class=\"bp\">Å </span><span class=\"n\">varc</span><span class=\"bp\">-</span><span class=\"n\">Milnor</span><span class=\"w\"> </span><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"bp\">â‰ƒ</span><span class=\"n\">qi</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span>\n<span class=\"bp\">â””â”€â”€</span><span class=\"w\"> </span><span class=\"n\">Metric</span><span class=\"bp\">/</span>\n<span class=\"w\">    </span><span class=\"bp\">â”œâ”€â”€</span><span class=\"w\"> </span><span class=\"n\">Basic</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"w\">            </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Metric</span><span class=\"w\"> </span><span class=\"n\">spaces</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"n\">coarse</span><span class=\"w\"> </span><span class=\"n\">spaces</span>\n<span class=\"w\">    </span><span class=\"bp\">â””â”€â”€</span><span class=\"w\"> </span><span class=\"n\">TransferQI</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"w\">       </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Coarse</span><span class=\"w\"> </span><span class=\"n\">equivalence</span><span class=\"w\"> </span><span class=\"bp\">â†”</span><span class=\"w\"> </span><span class=\"n\">quasi</span><span class=\"bp\">-</span><span class=\"n\">isometry</span><span class=\"w\"> </span><span class=\"n\">bridge</span>\n</code></pre></div>\n<p>The parallel withÂ <code>Mathlib.Topology</code>:</p>\n<ul>\n<li><code>Defs</code>Â /Â <code>Basic</code>Â â€” core definitions and API (cf.Â <code>Topology.Basic</code>)</li>\n<li><code>Order</code>Â â€” (cf.Â <code>Topology.Order</code>)</li>\n<li><code>Constructions</code>Â â€” products, subspaces, induced/coinduced (cf.Â <code>Topology.Constructions</code>)</li>\n<li><code>Connected</code>Â â€”  (cf.Â <code>Topology.Connected</code>)</li>\n</ul>\n<h2>Bridging coarse and metric worlds</h2>\n<p>While I didn't formalize the word metric, I did formalize quasi-isometries so one can pass back and forth between coarse equivalences and classical quasi-isometries (seeÂ <code>Metric/TransferQI.lean</code>):</p>\n<ul>\n<li><strong>Quasi-isometry â†’ Coarse equivalence:</strong>Â Always possible.</li>\n<li><strong>Coarse equivalence â†’ Quasi-isometry:</strong>Â Requires a purely metric condition: both spaces must haveÂ <em>coarse midpoints</em>.<br>\n<strong>Coarse midpoints.</strong>Â A metric space has coarse midpoints if there exists a constantÂ <code>Îµ â‰¥ 0</code>Â such that for every pair of pointsÂ <code>x, y</code>, there is a pointÂ <code>m</code>Â with</li>\n</ul>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">dist</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"n\">dist</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">Îµ</span>\n<span class=\"n\">dist</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"n\">dist</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">Îµ</span>\n</code></pre></div>\n<p>This is a coarse version of the approximate midpoint property in length spaces.</p>\n<h2>Statement of Å varc-Milnor</h2>\n<p>The proof proceeds in two stages:<br>\n<strong>1. Coarse Å varc-Milnor</strong>Â (seeÂ <code>CoarseSMul.lean</code>): IfÂ <code>G</code>Â acts on a coarse spaceÂ <code>X</code>Â such that the action is uniformly controlled, coarse, and cocompact, then the orbit map is a coarse equivalenceÂ <code>G â‰ƒá¶œ X</code>. This requires no metric assumptions, it's pure coarse geometry and based on the paper: N. Brodskiy, J. Dydak, A. Mitra, \"Coarse structures and group actions\" ( found <a href=\"https://arxiv.org/abs/math/0607568\">here</a>).<br>\n<strong>2. Classical Å varc-Milnor</strong>Â (seeÂ <code>Group/SvarcMilnor.lean</code>): The classical statement drops out as a corollary via the coarse-to-QI bridge. We add metric hypotheses to both sides:</p>\n<ul>\n<li><code>G</code>Â has aÂ <code>PseudoMetricSpace</code>Â structure with left-invariant metric (<code>IsIsometricSMul G G</code>)</li>\n<li><code>G</code>Â is aÂ <code>ProperSpace</code>Â withÂ <code>DiscreteTopology</code></li>\n<li>BothÂ <code>G</code>Â andÂ <code>X</code>Â satisfyÂ <code>HasCoarseMidpoints</code></li>\n</ul>\n<p>Any word metric automatically satisfies these assumptions, so this formulation generalizes the classical statement.</p>\n<p>Under these hypotheses, ifÂ <code>G</code>Â acts properly discontinuously, cocompactly, and by isometries on a proper metric spaceÂ <code>X</code>, then the orbit map is a quasi-isometry equivalenceÂ <code>G â‰ƒqi X</code>.</p>\n<hr>\n<p>Is there interest in having coarse geometry infrastructure in Mathlib as the way to do GGT?</p>",
        "id": 569297317,
        "sender_full_name": "Saif Ghobash",
        "timestamp": 1769012453
    },
    {
        "content": "<p>Not an expert myself but let me tag <span class=\"user-mention\" data-user-id=\"263407\">@Laurent Bartholdi</span>, <span class=\"user-mention\" data-user-id=\"461830\">@RÃ©mi Bottinelli</span>, <span class=\"user-mention\" data-user-id=\"466727\">@Jim Fowler</span> and <span class=\"user-mention\" data-user-id=\"466209\">@Georgi Kocharyan</span> from previous work / discussions <a class=\"message-link\" href=\"/#narrow/channel/113489-new-members/topic/svarc-milnor/near/290218305\">#new members &gt; svarc-milnor @ ğŸ’¬</a> and <a class=\"message-link\" href=\"/#narrow/channel/113489-new-members/topic/Word.20metric.20on.20group.20--.20a.20new.20attempt/near/290363767\">#new members &gt; Word metric on group -- a new attempt @ ğŸ’¬</a>.</p>",
        "id": 569305526,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1769014412
    },
    {
        "content": "<p>I would <em>love</em> to see coarse geometry in Mathlib, and reading your description above (without yet looking at the code), I think your approach makes sense. I would be happy to review PRs on this topic. I think <span class=\"user-mention\" data-user-id=\"268315\">@Anatole Dedecker</span> might also be interested here.</p>",
        "id": 569352262,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1769028338
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"197836\">@Jireh Loreaux</span> Wonderful! yes the coarse approach makes a lot of sense architecturally, and the nice thing is that growth, amenability etc can be phrased coarsely too. Other things like hyperbolic groups can just be phrased as the coarse structure on G is coarsely equivalent to a hyperbolic metric space and one can work \"metrically\" in that way, so not much needs to be added to the coarse space side. That way we're not  just recreating the metric space library for coarse spaces. </p>\n<p>As for PR's I'm glad you'd be willing to review, I tried to keep the code structure clean, readable, modular, and fitting mathlibs existing patterns to make it easier for review (along with following PR guidelines). There's just a few tweaks I am going to make tomorrow (some variables are implicit where it makes more sense to be explicit, so nothing major). As for actually submitting a PR, should it be staged?  (Note: I've never submitted a PR, so not sure about how best to do so.) </p>\n<p>Grouping as follows?</p>\n<ol>\n<li>Quasi Isometries, approximate midpoint file as purely metric files, Entourage API since its standalone</li>\n<li>Defs, Basic, Constructions, Order, Finiteness, Connected as the foundation for coarse spaces</li>\n<li>CoarseEquiv files </li>\n<li>Metric files for metric coarse structure and CoarseEquiv-QI bridge</li>\n<li>CoarseSMul: Coarse Å varc-Milnor Lemma</li>\n<li>Group files: Coarse structure on groups and classic Å varc-Milnor Lemma</li>\n</ol>",
        "id": 569357236,
        "sender_full_name": "Saif Ghobash",
        "timestamp": 1769029991
    },
    {
        "content": "<p>Yes, you should <em>definitely</em> split it into small chunks. Especially for the early PRs, I want you to keep them as small as is reasonably possible (say &lt;200 lines). You may find that despite your efforts to keep things up to Mathlib standards, there may still be lots of changes required to get it into Mathlib.</p>",
        "id": 569358817,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1769030556
    },
    {
        "content": "<p>Thanks for tagging me Jireh, I am definitely interested. I am not working with coarse spaces directly but some of my colleagues do and Iâ€™ve long considered it might be a good formalization target. Iâ€™ll read this thread more carefully soon.</p>",
        "id": 569359165,
        "sender_full_name": "Anatole Dedecker",
        "timestamp": 1769030680
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"197836\">@Jireh Loreaux</span> Alright, I'll try to refactor into smaller chunks for the early PRs, I am opening to making changes, that's fine with me. Also for &lt;200 lines are we counting documentation?</p>",
        "id": 569359680,
        "sender_full_name": "Saif Ghobash",
        "timestamp": 1769030846
    },
    {
        "content": "<p>Yes, counting documentation. Sometimes we merge larger PRs, but I would never recommend that for a first-time contribution.</p>",
        "id": 569359978,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1769030957
    },
    {
        "content": "<p>Okay, thanks for letting me know, Ill get started working on the refactor for the PR tomorrow hopefully, will keep this thread updated.</p>",
        "id": 569360255,
        "sender_full_name": "Saif Ghobash",
        "timestamp": 1769031050
    },
    {
        "content": "<p>I had a quick look at the code, this looks quite good! A few remarks that I would like to make:</p>\n<ol>\n<li>I would have hoped to emphasize that coarse structures are to bornologies what uniform structures are to topologies. (EDIT: This turns out not to be so true, see below). In particular:</li>\n</ol>\n<ul>\n<li>Instead of your <code>IsCoarselyBounded</code>, <code>CoarselyBoundedSpace</code> and <code>CoarselyProper</code> definitions, I would expect an instance of <code>CoarseSpace --&gt; Bornology</code> and the a use of bornological definitions</li>\n<li>Analogously to how our <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Bornology#doc\">docs#Bornology</a> is defined in terms of its filter at infinity, you could define a coarse structure on <code>X</code> as a filter on <code>X Ã— X</code> corresponding to pairs of points which go further and further away from each other. The axioms then become that this filter is invariant under swapping coordinates, that eventually the two coordinates are different, and that if <code>x</code> and <code>z</code> go far away from each other, then either <code>x</code> and <code>y</code> or <code>y</code> and <code>z</code> do. While I'm not sure this should be taken as a <em>definition</em> (but I would at least consider it), I think some part of the API may be nice to see from this point of view.</li>\n</ul>\n<ol start=\"2\">\n<li>I'm skeptical of your <code>Entourage</code> abbreviation, and I think Mathlib avoids this kind of \"duplication for the sake of terminology\". One thing I will say is, I think <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=SetRel.image#doc\">docs#SetRel.image</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=SetRel.preimage#doc\">docs#SetRel.preimage</a> should be called \"left/right thickenings\" instead, and we should have \"left/right balls\" for general <code>SetRel</code>s.</li>\n<li>There is currently an issue in your code because you have instances of <code>CoarseSpace</code> for both groups and metric spaces. However they have no reason to coincide (definitionally, or even propositionally) whenever you have a group with a distance, which is quite common. I would suggest removing the \"Group --&gt; CoarseSpace\" instance in favor of a <code>Prop</code>-valued <code>IsLeftCoarseGroup</code> typeclss or something like this.</li>\n<li>Related to the above, there is a question regarding forgetful inheritance (see <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LibraryNote.forgetful_inheritance#doc\">docs#LibraryNote.forgetful_inheritance</a>). I think <code>CoarseSpace</code> should extend <code>Bornology</code> in the same way <code>UniformSpace</code> extends <code>TopologicalSpace</code>. Should <code>MetricSpace</code> extend <code>CoarseSpace</code> instead of <code>Bornology</code>? Or should there be no <code>MetricSpace --&gt; CoarseSpace</code> instance but an <code>IsMetricCoarseSpace</code>?</li>\n</ol>\n<p>Sorry if this is a bit too much, I've been abstractly thinking about this for a while. For now I have to go but I'm happy to elaborate on anything tomorrow.</p>",
        "id": 569371989,
        "sender_full_name": "Anatole Dedecker",
        "timestamp": 1769035599
    },
    {
        "content": "<p>Re point 2: see <a href=\"https://github.com/leanprover-community/mathlib4/pull/33077\">#33077</a></p>",
        "id": 569373815,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1769036380
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"268315\">@Anatole Dedecker</span> Thanks for looking at the code! I actually did go for a bornology on X times X approach initially, it was a pain to work with (since you'd have a bornology on X times X and that itself induces a bornology on X via the coarsely bounded notions which then induces a bornology on the product via the existing instance in Mathlib, so you're juggling different bornologies). </p>\n<p>Secondly it severely limits the class of coarse spaces one can actually talk about, indeed the standard definition is almost a bornology, and in fact induces a bornology on X precisely when X is coarsely connected. While I understand the appeal of working via filters which are arguably more Mathlib centric, I don't really know how (and if) it should be taken as the approach for coarse spaces.  </p>\n<p>I understand the skepticism on the entourage abbreviation, I'm open to changing it to work with set rels. I used the entourage version since I wanted to define entourage products as the standard product instance on entourages which is in fact already defined in the uniformity file via <code>entourageProd</code>, so it is mainly cosmetic. But again, I dont mind refactoring in favor of set rels. </p>\n<p>I have instances for groups and metric spaces, and you're right there is no reason for them to coincide (they do in fact coincide for proper left invariant metrics that generate the discrete topology which is proved in the file <code>Group/LeftInvariant.lean</code>). I see your point however in that generically for groups with distances you'd get two different coarse structure instances, so it makes sense to have something like <code>IsLeftCoarseGroup</code>, <code>IsMetricCoarseSpace</code>.</p>\n<p>I appreciate your comments :)</p>",
        "id": 569374500,
        "sender_full_name": "Saif Ghobash",
        "timestamp": 1769036688
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"370446\">Saif Ghobash</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Coarse.20Spaces.20and.20the.20.C5.A0varc-Milnor.20Lemma/near/569374500\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"268315\">Anatole Dedecker</span> Thanks for looking at the code! I actually did go for a bornology on X times X approach initially, it was a pain to work with (since you'd have a bornology on X times X and that itself induces a bornology on X via the coarsely bounded notions which then induces a bornology on the product via the existing instance in Mathlib, so you're juggling different bornologies). </p>\n</blockquote>\n<p>oh no don't implement is as a bornology on X times X</p>",
        "id": 569375052,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1769036938
    },
    {
        "content": "<p>get a filter on X times X (the filter of cocontrolled sets) and have stuff in terms of that</p>",
        "id": 569375163,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1769036987
    },
    {
        "content": "<p>Yes sorry, I was just in the process of realizing that coarse spaces do not actually induce a bornology on their own in general, I am too used to \"nice\" coarse spaces. Sorry for this, it is too late for me to think properly.</p>",
        "id": 569375252,
        "sender_full_name": "Anatole Dedecker",
        "timestamp": 1769037025
    },
    {
        "content": "<p>Bornology on X times X was not what I was suggesting, and indeed I would assume it to be very painful.</p>",
        "id": 569375473,
        "sender_full_name": "Anatole Dedecker",
        "timestamp": 1769037116
    },
    {
        "content": "<p>But I had not anticipated the fact that coarse =&gt; bornology was not automatic, I feel a bit stupid (I've told that \"coarse/bornology is just like uniform/topology\" story a few times, turns out I should have checked the axioms)...</p>",
        "id": 569375629,
        "sender_full_name": "Anatole Dedecker",
        "timestamp": 1769037202
    },
    {
        "content": "<p>haha don't worry, I dont blame you for going that route, it definitely feels like it ought to be the case at least intuitively</p>",
        "id": 569375840,
        "sender_full_name": "Saif Ghobash",
        "timestamp": 1769037290
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"816344\">@Aaron Liu</span> interesting, I'll see if I can work out the details via the filter axioms, and see if it makes life any easier</p>",
        "id": 569375914,
        "sender_full_name": "Saif Ghobash",
        "timestamp": 1769037331
    },
    {
        "content": "<p>For anyone wondering, the issue is clear on the case of a coarse space with only subsets of the diagonal being controlled. Then any singleton is coarsely bounded but no two-element set is.</p>",
        "id": 569375980,
        "sender_full_name": "Anatole Dedecker",
        "timestamp": 1769037364
    },
    {
        "content": "<p>I <em>designed</em> <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=SetRel#doc\">docs#SetRel</a> to be used for entourages, so I don't see the point of the abbrev</p>",
        "id": 569376513,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1769037588
    },
    {
        "content": "<p>Maybe we should call the usual notion of coarse spaces an <code>ECoarseSpace</code> and coarsely-connected ones <code>CoarseSpaces</code>? By analogy with <code>EMetricSpace</code>/<code>MetricSpace</code>? Just throwing the idea in case people like it.</p>",
        "id": 569376677,
        "sender_full_name": "Anatole Dedecker",
        "timestamp": 1769037665
    },
    {
        "content": "<p>fair point, I don't think it would be too difficult to swap it out for SetRels</p>",
        "id": 569376721,
        "sender_full_name": "Saif Ghobash",
        "timestamp": 1769037693
    },
    {
        "content": "<p>(Note that <code>EMetricSpace</code>s do not induce bornologies for the exact same reason: if two bounded sets are infinitely far from each other, their union is not bounded)</p>",
        "id": 569376803,
        "sender_full_name": "Anatole Dedecker",
        "timestamp": 1769037730
    },
    {
        "content": "<p>With that said, I have to go to bed.</p>",
        "id": 569376821,
        "sender_full_name": "Anatole Dedecker",
        "timestamp": 1769037741
    },
    {
        "content": "<p><strong>Coarse spaces: rewritten library + Å varcâ€“Milnor lemma</strong></p>\n<p>I've rewritten my coarse geometry library from the ground up. The main changes:</p>\n<p>â€¢ Everything is now built on a <code>SetRel</code> API, with the coarse space axioms stated filter-theoretically via a <em>cocontrolled filter</em>, directly mirroring Mathlib's uniformity. </p>\n<p>â€¢ The Å varcâ€“Milnor lemma is proved in a general coarse setting (~70 lines of code), then specialized to metric spaces. The key abstraction is <em>uniformly controlled actions</em> (generalizing isometric actions): rather than requiring a specific coarse structure on the group, we only ask that whatever structure it carries admits a uniformly controlled action on itself. </p>\n<p>â€¢ The whole library is ~1,000 lines with module docs throughout (each file at most 200 lines). Quasi-isometries, monogenicity of coarse structures, connectedness, and approximate / coarse midpoints are saved for a later PR.</p>\n<p>File structure:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">ForMathlib</span><span class=\"bp\">/</span>\n<span class=\"w\">  </span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">Rel</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"w\">  </span><span class=\"n\">Topology</span><span class=\"bp\">/</span><span class=\"n\">MetricSpace</span><span class=\"bp\">/</span><span class=\"n\">IsometricSMul</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"n\">CoarseSpace</span><span class=\"bp\">/</span>\n<span class=\"w\">  </span><span class=\"n\">Defs</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"w\">  </span><span class=\"n\">Basic</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"w\">  </span><span class=\"n\">CoarseEquiv</span><span class=\"bp\">/</span><span class=\"n\">Defs</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"w\">  </span><span class=\"n\">Algebra</span><span class=\"bp\">/</span><span class=\"n\">UniformlyControlledSMul</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"w\">  </span><span class=\"n\">Metric</span><span class=\"bp\">/</span><span class=\"n\">Basic</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"w\">  </span><span class=\"n\">Metric</span><span class=\"bp\">/</span><span class=\"n\">SvarcMilnor</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n</code></pre></div>\n<p>I've also written a companion document walking through the design decisions and some proofs, intended to help reviewers: <a href=\"https://github.com/koly777/GeometricGroupTheoryLean/blob/main/coarsespacelibdocs.pdf\">here</a></p>\n<p>[Repo here] (<a href=\"https://github.com/koly777/GeometricGroupTheoryLean\">https://github.com/koly777/GeometricGroupTheoryLean</a>)</p>\n<p>Feedback on the API design, naming, and overall approach is very welcome. Happy to split into PRs if reviewers have a preferred order.</p>",
        "id": 575124153,
        "sender_full_name": "Saif Ghobash",
        "timestamp": 1771721344
    }
]