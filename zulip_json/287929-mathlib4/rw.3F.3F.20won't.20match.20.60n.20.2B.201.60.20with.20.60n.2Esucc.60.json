[
    {
        "content": "<p>Maybe we could include special casing for this, like in <code>match</code> pattern?</p>\n<p>In the below code, shift+click on <code>List.range (n + 1)</code>, it won't find <code>List.range n ++ [n]</code> as possible rewrite. It does, if you replace <code>n + 1</code> with <code>n.succ</code>.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">range_succ</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw??</span>\n</code></pre></div>",
        "id": 564901455,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1766332671
    },
    {
        "content": "<p>Or maybe it's API issue and we should have <code>List.range (n + 1) = List.range n ++ [n]</code> instead of <code>List.range n.succ = List.range n ++ [n]</code> in the API, because <code>simp</code> simplifies <code>n.succ</code> to <code>n + 1</code>.</p>",
        "id": 564901536,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1766332792
    },
    {
        "content": "<p>Btw, <code>rw?</code> is able to find <code>List.range_succ</code>, so it seems <code>rw?</code> can see past defeq but <code>rw??</code> doesn't?</p>",
        "id": 564901584,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1766332847
    },
    {
        "content": "<p>This is certainly an API issue. I would not expect to match<code>n + 1</code> with <code>n.succ</code>, because this requires unfolding <code>Nat.add</code>.</p>\n<p>However, <code>Nat.add</code> gets special treatment by some metaprogramming functions, which is why the rewrite works in the first place.</p>\n<p>The discrimination tree used by <code>rw??</code> does not treat <code>Nat.succ</code> or <code>Nat.add</code> specially in this regard, so they are indexed as different patterns.</p>",
        "id": 564917327,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1766354006
    },
    {
        "content": "<p>I have now created <a href=\"https://github.com/leanprover/lean4/pull/11768\">lean#11768</a> to replace the <code>range_succ</code> lemmas by <code>range_add_one</code></p>",
        "id": 565008854,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1766411882
    },
    {
        "content": "<p><del>That's wrong PR number I think?</del> Now it's ok. :)</p>",
        "id": 565008959,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1766411919
    },
    {
        "content": "<p>I think the naming convention in mathlib is to write <code>succ</code> in the name of the theorem, yet use <code>n + 1</code> in the statement? Maybe name it to <code>range_succ'</code> and after the deprecated <code>range_succ</code> is deleted we can rename <code>range_succ'</code> to <code>range_succ</code>?</p>",
        "id": 565010352,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1766412340
    },
    {
        "content": "<p>See the other Zulip conversation that I linked in the PR: <a class=\"message-link\" href=\"/#narrow/channel/287929-mathlib4/topic/Naming.20convention.3A.20succ.20vs.2E.20add_one/near/537179763\">#mathlib4 &gt; Naming convention: succ vs. add_one @ ðŸ’¬</a> </p>\n<p>My conclusion is that we want to move away from <code>succ</code> in the name.</p>",
        "id": 565012493,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1766412971
    },
    {
        "content": "<p>Ah, yeah, I saw that conversation before, but forgot about it.</p>",
        "id": 565013564,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1766413333
    }
]