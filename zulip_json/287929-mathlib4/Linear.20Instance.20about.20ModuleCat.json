[
    {
        "content": "<p>Hello, I met a problem about conflict of instance.<br>\nFor a <code>R</code>-algebra <code>S</code>, we have <code>ModuleCat S</code> is <code>R</code>-linear, together with module instance on element of <code>ModuleCat S</code>.<br>\nHowever if the element is of the form <code>ModuleCat.of S M</code>and <code>M</code> come with a <code>R</code>-module instance already, there is also an instance straight from <code>Module R M</code>.<br>\nI tried to set the former one a higher priority, but it still end up with the later instance, how can I resolve this?</p>",
        "id": 545929889,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1760954296
    },
    {
        "content": "<p>They are actually the same, however currently I can only use <code>@</code> and fill it in manually.</p>",
        "id": 545930022,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1760954335
    },
    {
        "content": "<p>In a given file you can deactivate one instance writing</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n</code></pre></div>",
        "id": 545930780,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1760954526
    },
    {
        "content": "<p>But of course the point is that we have a diamond here, and we should think about it.</p>",
        "id": 545930900,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1760954556
    },
    {
        "content": "<p>The problem here is a bit more complicated here, the other instance is needed in the same statement, as we have <code>Ext(M,N)</code>, <code>M</code> need the module instance from inside, <code>N</code> need it from outside...<br>\nAs we are considering <code>Ext</code> commute with localization, we need to consider the <code>R</code>-linear structure on <code>ModuleCat R_p</code>, so this need the module instance from outside.</p>",
        "id": 545933108,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1760955142
    },
    {
        "content": "<p>Can you write precisely which are the two instances?</p>",
        "id": 545933499,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1760955248
    },
    {
        "content": "<p>In your first message it is not clear if you are speaking about an <code>R</code>-module instance or an <code>S</code>-module instance</p>",
        "id": 545933671,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1760955291
    },
    {
        "content": "<p>Sorry, I'll make it clear here. For <code>R</code>-algebra <code>S</code> and <code>M</code> equiped with <code>[inst1 : Module R M]</code> <code>[Module S M]</code> <code>[IsScalarTower R S M]</code>, for <code>ModuleCat.of S M</code>, the first <code>Module R (ModuleCat.of S M)</code> instance come from <code>ModuleCat.Algebra.instModuleCarrier</code>, the second come from <code>inst1</code></p>",
        "id": 545934224,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1760955438
    },
    {
        "content": "<p>Well, I think that <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Category/ModuleCat/Basic.html#ModuleCat.Algebra.instModuleCarrier\">ModuleCat.Algebra.instModuleCarrier</a> is not an instance for this precise reason.</p>",
        "id": 545936124,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1760956040
    },
    {
        "content": "<p>Anyway there is now to make the two action defeq, you literally assume they're equal</p>",
        "id": 545936216,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1760956068
    },
    {
        "content": "<p>Maybe you can play with restric scalars?</p>",
        "id": 545936245,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1760956078
    },
    {
        "content": "<p>Howevr to deal with <code>R</code>-linear structure on <code>ModuleCat S</code> I need this definitely.</p>",
        "id": 545937643,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1760956489
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130384\">Riccardo Brasca</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Linear.20Instance.20about.20ModuleCat/near/545936216\">說</a>：</p>\n<blockquote>\n<p>Anyway there is now to make the two action defeq, you literally assume they're equal</p>\n</blockquote>\n<p>Sorry what do you mean by this? I know they both form scalar tower with the same <code>S</code> action, what can I do with this?</p>",
        "id": 545937787,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1760956532
    },
    {
        "content": "<p>Just that you cannot expect <code>rfl</code> to be able to prove</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsScalarTower</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ModuleCat</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">instModuleCarrier</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ModuleCat</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 545940540,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1760957303
    },
    {
        "content": "<p>One more question, how can I use this equation?</p>",
        "id": 545941286,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1760957489
    },
    {
        "content": "<p>We probably need to see a <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a> to completely understand your problem.</p>",
        "id": 545942509,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1760957806
    },
    {
        "content": "<p>I suspect the answer is you shouldn't use that equation at all</p>",
        "id": 545942636,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760957847
    },
    {
        "content": "<p>I agree, we need to see the whole code.</p>",
        "id": 545944535,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1760958368
    },
    {
        "content": "<p>I'm thinking it might be coming from a functor</p>",
        "id": 545944951,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760958490
    },
    {
        "content": "<p>I guess there's no way to tell without seeing the code</p>",
        "id": 545945414,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760958614
    },
    {
        "content": "<p>I have a mwe.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"n\">ModuleCat</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">Shrink</span>\n\n<span class=\"kn\">universe</span><span class=\"w\"> </span><span class=\"n\">v</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">ModuleCat</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ModuleCat</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstance</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ModuleCat</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ModuleCat</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">→ₗ</span><span class=\"o\">[</span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">foo1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ModuleCat</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">IsScalarTower</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Small</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">→ₗ</span><span class=\"o\">[</span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ModuleCat</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Shrink</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">f'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">LinearMap</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">RingHom</span><span class=\"bp\">.</span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ModuleCat</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Shrink</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">      </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">instModuleCarrier</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"c1\">--#check foo f</span>\n<span class=\"w\">  </span><span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">f'</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">ModuleCat</span>\n</code></pre></div>\n<p>as we can see <code>foo f'</code> work but <code>foo f</code> fail</p>",
        "id": 545945626,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1760958681
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Linear.20Instance.20about.20ModuleCat/near/545944951\">說</a>：</p>\n<blockquote>\n<p>I'm thinking it might be coming from a functor</p>\n</blockquote>\n<p>Yes, my problem originate from a need of extend scalars is linear, the <code>foo</code> here is the thing needing it (I wrote it in some separate place, so a bit hard to show here).</p>",
        "id": 545945832,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1760958740
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"749361\">Nailin Guan</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Linear.20Instance.20about.20ModuleCat/near/545945626\">said</a>:</p>\n<blockquote>\n<p><code>noncomputable local instance (N : ModuleCat.{v} S) : Module R N := inferInstance</code></p>\n</blockquote>\n<p>this line is bad, i think, you should use a functor and not abuse defeq, you should treat them as different objects</p>",
        "id": 545946137,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760958830
    },
    {
        "content": "<p>So where can the functor come form? I didn't see how it can be there.</p>",
        "id": 545946588,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1760958945
    },
    {
        "content": "<p>Also without this <code>foo</code> is not even able to state, how should I resolve this?</p>",
        "id": 545947075,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1760959086
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Category/ModuleCat/ChangeOfRings.html#ModuleCat.restrictScalars\">ModuleCat.restrictScalars</a> is the functor</p>",
        "id": 545947461,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760959193
    },
    {
        "content": "<p>What we are saying is that you should think that <code>N</code> as <code>S</code>-module and <code>N</code> as <code>R</code>-module are two (related but) <em>different</em> objects. In particular, don't put an <code>R</code>-structure on <code>N</code>, use <code>RestrictScalars R S N</code>.</p>",
        "id": 545948002,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1760959342
    },
    {
        "content": "<p>Maybe there is a deeper problem for me, how do you expect me to fix this statement?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Ext</span><span class=\"bp\">.</span><span class=\"n\">isLocalizedModule</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsNoetherianRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ModuleCat</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">Finite</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">Finite</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">MS</span><span class=\"w\"> </span><span class=\"n\">NS</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ModuleCat</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v'</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">→ₗ</span><span class=\"o\">[</span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">MS</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">isl1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsLocalizedModule</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"bp\">→ₗ</span><span class=\"o\">[</span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">NS</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">isl2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsLocalizedModule</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">IsLocalizedModule</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Ext</span><span class=\"bp\">.</span><span class=\"n\">isLocalizedModule_map</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v'</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">isl1</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">isl2</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 545948239,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1760959410
    },
    {
        "content": "<p>f and g are wrong, see above comment</p>",
        "id": 545948325,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760959437
    },
    {
        "content": "<p>OK, this problem here is solved, I'll have a try.</p>",
        "id": 545949212,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1760959689
    },
    {
        "content": "<p>Sorry, two more question.<br>\n1: is it safe to open <code>ModuleCat.Algebra</code> to use the scoped inctance inside?<br>\n2: if not, how should I obtain the <code>R</code>-linear structure on <code>ModuleCat S</code> when <code>S</code> is <code>R</code>-algebra?</p>",
        "id": 545950025,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1760959895
    },
    {
        "content": "<p>1: no; 2: use the functor I linked, or the spelling Riccardo suggested</p>",
        "id": 545951148,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760960242
    },
    {
        "content": "<p>Really, just think like this: if <code>N</code> is a <code>S</code>-module there is <em>no</em> <code>R</code>-module structure on <code>N</code> (you can write this using category theory, it's the same). The <code>R</code>-module that on paper is again denoted <code>N</code> is <code>RestrictScalar R S N</code>.</p>",
        "id": 545951525,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1760960349
    },
    {
        "content": "<p>Of course under the wood <code>RestricScalar R S N</code> is defined to be <code>N</code>, but this is an implementation detail that should be ignored. If you use it you are \"abusing defeq\", and 99% of the time it's a bad idea.</p>",
        "id": 545951860,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1760960446
    },
    {
        "content": "<p>OK, I know what is correct, but the problem is here: I want a <code>R</code>-linear map between <code>Ext</code> over different <code>R</code>-linear category <code>C</code> and <code>D</code> (see <a href=\"https://github.com/leanprover-community/mathlib4/pull/30676\">#30676</a>), when applied to extend scalars how can I get the <code>R</code>-linear structure? Or is this a bad idea from the start?</p>",
        "id": 545952377,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1760960593
    },
    {
        "content": "<p>i'm a bit confused, R-linear category means that the homs are R-modules right, so where does this problem come from, could you please specify everything precisely, what categories, what extend scalars, what R-linear structure</p>",
        "id": 545954706,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760961248
    },
    {
        "content": "<p>At the beginning, for an additive  exact functor <code>F : C =&gt; D</code> we have </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Functor</span><span class=\"bp\">.</span><span class=\"n\">mapExtAddHom</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">HasExt</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">w</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">HasExt</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">w'</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Ext</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">w</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→+</span><span class=\"w\"> </span><span class=\"n\">Ext</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">w'</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">n</span>\n</code></pre></div>\n<p>Then if <code>C </code> and <code>D</code> is <code>R</code>-linear, we have.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Functor</span><span class=\"bp\">.</span><span class=\"n\">mapExtLinearMap</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">HasExt</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">w</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">HasExt</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">w'</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Ext</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">w</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→ₗ</span><span class=\"o\">[</span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Ext</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">w'</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">n</span>\n</code></pre></div>\n<p>Then I would like to apply this map to <code>ModuleCat.extendScalars (algebraMap R S)</code> when <code>S</code> is flat over <code>R</code>, then we need <code>ModuleCat S</code>is <code>R</code>-linear, but it is stored in <code>ModuleCat.Algebra</code> namespace as a def <code>ModuleCat.Algebra.instLinear</code></p>",
        "id": 545955637,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1760961472
    },
    {
        "content": "<p>This is indeed quite tricky. I think here is it reasonable to turn on <code>ModuleCat.Algebra.instLinear</code> because there usually will not be a better <code>SMul R (Ext.{w'} (F.obj X) (F.obj Y) n)</code> instance.</p>",
        "id": 545957148,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1760961852
    },
    {
        "content": "<p>But you need to have a good control (or at least a good idea) about where has been contaminated by this instance. For example a choice would be do have an</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Ext</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">w'</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">extendScalars</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">extendScalars</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>globally, and have a def</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">...</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">extMapExtendScalars</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Ext</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">w</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→ₗ</span><span class=\"o\">[</span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Ext</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">w'</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">extendScalars</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">extendScalars</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Functor</span><span class=\"bp\">.</span><span class=\"n\">mapExtLinearMap</span><span class=\"w\"> </span><span class=\"bp\">..</span>\n</code></pre></div>\n<p>and not turn it on anywhere else.</p>",
        "id": 545959177,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1760962343
    },
    {
        "content": "<p>You mean only open it locally unless unsed? I'll have a try.</p>",
        "id": 545961460,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1760962955
    },
    {
        "content": "<p>I think I am still needing the module structure on <code>hom</code> as proof of <code>0</code> passes through it.</p>",
        "id": 545973923,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1760965843
    },
    {
        "content": "<p>but 0 is from the add group structure not the module structure</p>",
        "id": 545974407,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760965949
    },
    {
        "content": "<p>Sorry I didn't make it clear, I when considering <code>Ext _ _ 0</code></p>",
        "id": 545977140,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1760966562
    },
    {
        "content": "<p>The proof is already reaching maximal heartbeat so I want to separarte it out, but need module instance to state.</p>",
        "id": 545977577,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1760966663
    },
    {
        "content": "<p>it's still a separate question, the hom stuff is not from \"ModuleCat.of\" etc, so it should be safe</p>",
        "id": 545978346,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760966841
    },
    {
        "content": "<p>or you mean the hom itself needs R-module</p>",
        "id": 545978495,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760966871
    },
    {
        "content": "<p>nope I don't see it, it's S-hom on the RHS</p>",
        "id": 545978599,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760966896
    },
    {
        "content": "<p>to be clearer what i mean, i mean that <code>Module S M -&gt; Module R M</code> is not safe, but <code>Module R (M →ₗ[S] N)</code> is safe</p>",
        "id": 545978864,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760966944
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Linear.20Instance.20about.20ModuleCat/near/545978346\">說</a>：</p>\n<blockquote>\n<p>it's still a separate question, the hom stuff is not from \"ModuleCat.of\" etc, so it should be safe</p>\n</blockquote>\n<p>I know this is a different problem. You are right, I think <code>ofHom</code> will stop the bad things.</p>",
        "id": 545978869,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1760966946
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Linear.20Instance.20about.20ModuleCat/near/545978864\">說</a>：</p>\n<blockquote>\n<p>to be clearer what i mean, i mean that <code>Module S M -&gt; Module R M</code> is not safe, but <code>Module R (M →ₗ[S] N)</code> is safe</p>\n</blockquote>\n<p>I am exacty needing a similar <code>Module R (M \\hom N)</code> for <code>M</code> and <code>N</code> <code>ModuleCat S</code></p>",
        "id": 545979086,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1760966998
    },
    {
        "content": "<p>yes, and the point is that this is different from a general rule of \"S-module produces R-module\"</p>",
        "id": 545979602,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760967107
    },
    {
        "content": "<p>in fact <code>M →ₗ[S] N</code> counts as a <em>specific module</em></p>",
        "id": 545979660,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760967122
    },
    {
        "content": "<p>I haven't fully understood yet, but as you say it is OK I'll use it for now. There are enough time for me to figure it out after fixing all the stuffs.</p>",
        "id": 545980082,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1760967219
    },
    {
        "content": "<p>Another question, is it safe to unfold these kind of definitions in proof? Or better not?</p>\n<p><span class=\"user-mention silent\" data-user-id=\"439483\">Andrew Yang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Linear.20Instance.20about.20ModuleCat/near/545959177\">說</a>：</p>\n<blockquote>\n<p>But you need to have a good control (or at least a good idea) about where has been contaminated by this instance. For example a choice would be do have an</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Ext</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">w'</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">extendScalars</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">extendScalars</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>globally, and have a def</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">...</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">extMapExtendScalars</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Ext</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">w</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→ₗ</span><span class=\"o\">[</span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Ext</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">w'</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">extendScalars</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">extendScalars</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Functor</span><span class=\"bp\">.</span><span class=\"n\">mapExtLinearMap</span><span class=\"w\"> </span><span class=\"bp\">..</span>\n</code></pre></div>\n<p>and not turn it on anywhere else.</p>\n</blockquote>",
        "id": 545981438,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1760967550
    },
    {
        "content": "<p>yes</p>",
        "id": 545982228,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760967739
    },
    {
        "content": "<p>Sorry, back to a problem far high up : I want to state the following fact: for <code>R</code>-algebra <code>S</code>, <code>M</code> is <code>ModuleCat R</code> and <code>N</code> is <code>ModuleCat S</code>, I want a linear map <code>f : M =&gt;[R] N</code> to state <code>IsBaseChange S f</code>, how should I use <code>RestrictScalars</code> in this particulat place?</p>",
        "id": 545983305,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1760967971
    },
    {
        "content": "<p>change the type of <code>f</code> to <code>M \\rl[R] RestrictScalars R N</code></p>",
        "id": 545983937,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760968105
    },
    {
        "content": "<p>then how should I obtain <code>Module S</code> and <code>IsScalarTower R S</code>? (i.e. should I turn on <code>RestrictScalars.moduleOrig</code>?)</p>",
        "id": 545984642,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1760968271
    },
    {
        "content": "<p>hmm, i suppose you would do that, but i'm not sure</p>",
        "id": 545985432,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760968446
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"749361\">Nailin Guan</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Linear.20Instance.20about.20ModuleCat/near/545981438\">said</a>:</p>\n<blockquote>\n<p>Another question, is it safe to unfold these kind of definitions in proof? Or better not?</p>\n</blockquote>\n<p>I don't think it is too safe. Do you really need to do this if you add the lemma that it coerced to an addmonoidhom is <code>Functor.mapExtAddHom</code>?</p>",
        "id": 545990935,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1760969570
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"749361\">Nailin Guan</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Linear.20Instance.20about.20ModuleCat/near/545983305\">said</a>:</p>\n<blockquote>\n<p>Sorry, back to a problem far high up : I want to state the following fact: for <code>R</code>-algebra <code>S</code>, <code>M</code> is <code>ModuleCat R</code> and <code>N</code> is <code>ModuleCat S</code>, I want a linear map <code>f : M =&gt;[R] N</code> to state <code>IsBaseChange S f</code>, how should I use <code>RestrictScalars</code> in this particulat place?</p>\n</blockquote>\n<p>I think this depends on what <code>f</code> you want to apply to. Another choice is unbundle things more, e.g. assume <code>[Module R N] [IsScalarTower R S N]</code> directly in your statement.</p>",
        "id": 545991396,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1760969666
    },
    {
        "content": "<p>I second Andrew's last comment: this <code>[Module R N] [IsScalarTower R S N]</code> trick is a great trick (i.e. add more data into the typeclass system and then claim that the data is uniquely determined so you didn't really make any new assumptions at all).</p>",
        "id": 545998095,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1760971225
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"439483\">Andrew Yang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Linear.20Instance.20about.20ModuleCat/near/545990935\">說</a>：</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"749361\">Nailin Guan</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Linear.20Instance.20about.20ModuleCat/near/545981438\">said</a>:</p>\n<blockquote>\n<p>Another question, is it safe to unfold these kind of definitions in proof? Or better not?</p>\n</blockquote>\n<p>I don't think it is too safe. Do you really need to do this if you add the lemma that it coerced to an addmonoidhom is <code>Functor.mapExtAddHom</code>?</p>\n</blockquote>\n<p>I this coercion would fix all the things, thanks for this idea.</p>",
        "id": 546012422,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1760974142
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"439483\">Andrew Yang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Linear.20Instance.20about.20ModuleCat/near/545991396\">說</a>：</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"749361\">Nailin Guan</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Linear.20Instance.20about.20ModuleCat/near/545983305\">said</a>:</p>\n<blockquote>\n<p>Sorry, back to a problem far high up : I want to state the following fact: for <code>R</code>-algebra <code>S</code>, <code>M</code> is <code>ModuleCat R</code> and <code>N</code> is <code>ModuleCat S</code>, I want a linear map <code>f : M =&gt;[R] N</code> to state <code>IsBaseChange S f</code>, how should I use <code>RestrictScalars</code> in this particulat place?</p>\n</blockquote>\n<p>I think this depends on what <code>f</code> you want to apply to. Another choice is unbundle things more, e.g. assume <code>[Module R N] [IsScalarTower R S N]</code> directly in your statement.</p>\n</blockquote>\n<p>I have both version now for the commute of flat base change and <code>Ext</code> when ring noetherian and module fg, it seems your suggestions to unbundle work perfectly for my applications. Thank you very much.</p>",
        "id": 546226676,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1761050797
    },
    {
        "content": "<p>And thanks for all the helps!</p>",
        "id": 546226841,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1761050849
    },
    {
        "content": "<p>I would like to introduce <a href=\"mailto:cszcsz123@outlook.com\">cszcsz123@outlook.com</a>, who has thoroughly understood this proof and is currently learning Lean under the guidance of Jujian Zhang.</p>",
        "id": 546490344,
        "sender_full_name": "Nick Adfor",
        "timestamp": 1761147309
    }
]