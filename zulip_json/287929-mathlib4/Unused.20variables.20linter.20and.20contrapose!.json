[
    {
        "content": "<p>Consider the following.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Defs</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Contrapose</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">contrapose!</span><span class=\"w\"> </span><span class=\"n\">h'</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">le_mul_of_pos_right</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>\n<p>The \"unused variables\" linter complains about <code>h'</code> in the <code>contrapose! h'</code> line, presumably because the new <code>h'</code> generated by the tactic (which just states <code>¬False</code>) is not used in the proof. However, it is <em>necessary</em> to tell <code>contrapose!</code> which hypothesis it should use.  It would be nice if the linter could be silenced without having to use <code>set_option linter.unusedVariables false in</code>. I guess one way would be to allow <code>contrapose</code> to accept two arguments, where the second one is used to name the new hypothesis (and defaults to the first one). Then one could write <code>contrapose! h' _</code>, and it should be OK.</p>",
        "id": 474047096,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1727791575
    },
    {
        "content": "<p>You mean</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">contrapose!</span><span class=\"w\"> </span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">h</span>\n</code></pre></div>\n<p>?</p>",
        "id": 474047656,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1727791733
    },
    {
        "content": "<p>Should have looked at the docs first ...</p>",
        "id": 474047785,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1727791778
    },
    {
        "content": "<p>(This came up when updating Mathlib in a fairly old project (on lean 4.6); the linter was apparently not active at the time...)</p>",
        "id": 474048262,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1727791901
    },
    {
        "content": "<p>Doesn't seem to work with just <code>_</code>; might be possible to add for someone who's motivated</p>",
        "id": 474048373,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1727791928
    },
    {
        "content": "<p>The same issue occurred in the carleson project, with recent Lean: <a href=\"https://github.com/fpvandoorn/carleson/pull/127\">https://github.com/fpvandoorn/carleson/pull/127</a> by <span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span> van Doorn disables the <code>unusedVariables</code> linter in one file, for this reason.</p>",
        "id": 474071781,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1727798512
    },
    {
        "content": "<p>The linter will likely be limited in <a href=\"https://github.com/leanprover/lean4/pull/5338\">lean#5338</a> in a way that will not complain about such tactic uses anymore (by default)</p>",
        "id": 474076900,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1727800224
    }
]