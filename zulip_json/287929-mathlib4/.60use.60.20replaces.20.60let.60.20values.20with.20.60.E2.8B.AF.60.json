[
    {
        "content": "<p>If you look at the state after the <code>use</code> here:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">easy</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>you get the nonsense goal</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⋯</span>\n<span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n</code></pre></div>\n<p>which is clearly not useful. This seems to be a regression since 4.17.0, though I haven't tried to bisect.</p>",
        "id": 539030637,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757672828
    },
    {
        "content": "<p>cc <span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> , since I think you shipped the <code>⋯</code> feature</p>",
        "id": 539030697,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757672854
    },
    {
        "content": "<p><code>set_option pp.showLetValues.threshold 3</code> seems to be enough to fix it</p>",
        "id": 539031219,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757673012
    },
    {
        "content": "<p>Is this a problem with <code>use</code>? What happens if you <code>refine</code>?</p>",
        "id": 539031928,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757673264
    },
    {
        "content": "<p><code>refine ⟨n, ?_⟩</code> is ok</p>",
        "id": 539032468,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757673450
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">easy</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"bp\">?_</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>is also fine</p>",
        "id": 539032716,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757673549
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60use.60.20replaces.20.60let.60.20values.20with.20.60.E2.8B.AF.60/near/539030637\">said</a>:</p>\n<blockquote>\n<p>If you look at the state after the <code>use</code> here:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">easy</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n</blockquote>\n<p><code>omega</code> or <code>simp +zetaDelta</code> still works?</p>",
        "id": 539032730,
        "sender_full_name": "Edison Xie",
        "timestamp": 1757673554
    },
    {
        "content": "<p>Sure, the goal is still provable with <code>rfl</code>, but the information to know this is invisible</p>",
        "id": 539032796,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757673586
    },
    {
        "content": "<p>Is it the infoview that you're complaining?</p>",
        "id": 539032836,
        "sender_full_name": "Edison Xie",
        "timestamp": 1757673598
    },
    {
        "content": "<p>Yes, but I think <code>use</code> is probably inserting / failing to insert some metadata</p>",
        "id": 539032892,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757673614
    },
    {
        "content": "<p><code>use</code> probably produces non-synthetic-opaque goals</p>",
        "id": 539033360,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1757673787
    },
    {
        "content": "<p>A message was moved from this topic to <a href=\"#narrow/channel/270676-lean4/topic/.60constructor.60.20replaces.20.60let.60.20values.20with.20.60.E2.8B.AF.60\">#lean4 &gt; &#96;constructor&#96; replaces &#96;let&#96; values with &#96;⋯&#96;</a> by <span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span>.</p>",
        "id": 539033600,
        "sender_full_name": "Notification Bot",
        "timestamp": 1757673880
    },
    {
        "content": "<p>(moving to <a class=\"stream\" data-stream-id=\"270676\" href=\"/#narrow/channel/270676-lean4\">#lean4</a> now that this is mathlib-free)</p>",
        "id": 539033694,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757673910
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60use.60.20replaces.20.60let.60.20values.20with.20.60.E2.8B.AF.60/near/539030637\">said</a>:</p>\n<blockquote>\n<p>you get the nonsense goal</p>\n</blockquote>\n<p>You can hover over the missing value, correct?</p>",
        "id": 539094596,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1757690791
    },
    {
        "content": "<p>Not if using lean from the command line :)</p>",
        "id": 539109345,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757693167
    },
    {
        "content": "<p>I figured it was something like that; but if this counts as a 'nonsense goal' without additional context I think it's worth pointing that out.</p>\n<p>If you hover over the dots, it tells you about <code>pp.showLetValues</code>. You can do <code>set_option pp.showLetValues true</code> to disable omitting let values completely. If you want to adjust the threshold, I'd suggest using a much larger value than 3, unless experimentally you find that to be sufficient somehow. The max is 255 I believe.</p>",
        "id": 539135265,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1757698172
    },
    {
        "content": "<p>Regarding regressions: yes, this is an intentional regression. It makes it much clearer that certain tactics have been creating the wrong kinds of metavariables for goals.</p>\n<p>Unfortunately it's annoying to actually fix those tactics, since it tends to break lots of proofs. We're planning on finding a way to address this next quarter I believe.</p>",
        "id": 539135809,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1757698420
    },
    {
        "content": "<p>Is there a stupid fix for these tactics, which is \"run <code>refine ?_</code> on all resulting goals before continuing\"?</p>",
        "id": 539136160,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757698572
    },
    {
        "content": "<p>I've got a fix for <code>rw</code> I need to check on, and I can do something similar to <code>use</code> and <code>constructor</code>, as a stop-gap.</p>\n<p>It's \"make all new proof goals be synthetic opaque\". That itself causes a few regressions here and there, but they're not so bad to fix.</p>\n<p>That avoids the bigger issue where tactic proofs are solving for the data goals by unification sometimes...</p>",
        "id": 539136395,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1757698678
    },
    {
        "content": "<p>(Here's the part of the <code>rw</code> change to address this issue: <a href=\"https://github.com/leanprover/lean4/pull/10306/files#diff-addc6c602e8da96e45b088d1e0ee928b6009240f91fac6c277384ef080ce686fR45\">https://github.com/leanprover/lean4/pull/10306/files#diff-addc6c602e8da96e45b088d1e0ee928b6009240f91fac6c277384ef080ce686fR45</a>)</p>",
        "id": 539136559,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1757698749
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60use.60.20replaces.20.60let.60.20values.20with.20.60.E2.8B.AF.60/near/539033694\">said</a>:</p>\n<blockquote>\n<p>(moving to <a class=\"stream\" data-stream-id=\"270676\" href=\"/#narrow/channel/270676-lean4\">#lean4</a> now that this is mathlib-free)</p>\n</blockquote>\n<p>Just mentioning that it seems discussion is now happening in both threads rather than just one!</p>",
        "id": 539207334,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1757739003
    }
]