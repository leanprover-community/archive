[
    {
        "content": "<p>I think it makes more sense for <code>trans</code> tactic to place subgoals from synthetic holes first. In the first example below the goal for the <code>?m.8</code> is placed last. Can you think of a case where having synthetic goals first be undesired?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">opaque</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"bp\">?_</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span>\n<span class=\"cm\">  3 goals</span>\n<span class=\"cm\">  ⊢ 1 = foo ?m.8</span>\n<span class=\"cm\">  ⊢ foo ?m.8 = 2</span>\n<span class=\"cm\">  ⊢ ℕ</span>\n<span class=\"cm\">  -/</span>\n<span class=\"w\">  </span><span class=\"n\">rotate_left</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"w\"> </span><span class=\"bp\">?_</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span>\n<span class=\"cm\">  3 goals</span>\n<span class=\"cm\">  case refine_1</span>\n<span class=\"cm\">  ⊢ ℕ</span>\n<span class=\"cm\">  ⊢ 1 = foo ?refine_1</span>\n<span class=\"cm\">  ⊢ foo ?refine_1 = 2</span>\n<span class=\"cm\">  -/</span>\n</code></pre></div>",
        "id": 566633808,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1767740101
    },
    {
        "content": "<p>This is by design.</p>",
        "id": 566634303,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1767740441
    },
    {
        "content": "<p>This is the design of how synthetic holes work for all tactics, right? Or do you mean that this behaviour was deliberately picked for <code>trans</code>? Maybe we could change this behaviour for <code>trans</code> if there's evidence it's more desirable?</p>",
        "id": 566634567,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1767740641
    },
    {
        "content": "<p>The same thing happens with <code>rw [foo ?_]</code>, and I also prefer for the hole to be first, to let the main proof continue unindented after resolving the hole with a cdot</p>",
        "id": 566635137,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1767741074
    },
    {
        "content": "<p>Yes, this was deliberately picked for trans, so you could fill in the value of the hole via the proof terms.</p>",
        "id": 566637263,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1767742525
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> What you're saying makes sense for argument-free <code>trans</code>, but for <code>trans foo ?_</code>, I think it's a synthetic opaque metavariable, so not assignable by unifications during elaboration. It's just assignable in unifications done by tactics after elaboration is complete; e.g. <code>refine</code> can assign to it.</p>",
        "id": 566638219,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1767743207
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60trans.60.20should.20place.20synthetic.20subgoals.20first/near/566637263\">said</a>:</p>\n<blockquote>\n<p>Yes, this was deliberately picked for trans, so you could fill in the value of the hole via the proof terms.</p>\n</blockquote>\n<p>I see. I think it's more readable code to set it explicitly, but I'll try following that convention.</p>",
        "id": 566638957,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1767743767
    }
]