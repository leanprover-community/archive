[
    {
        "content": "<p>For people looking for a nice meta-project in order to kill time until next year, it seems <a href=\"https://github.com/leanprover-community/mathlib4/blob/master/Mathlib/Tactic/SuccessIfFailWithMsg.lean\">https://github.com/leanprover-community/mathlib4/blob/master/Mathlib/Tactic/SuccessIfFailWithMsg.lean</a> misses a code action proposing to fix the message when the target tactic fails but with an unexpected message. This would align nicely with what <code>guard_msgs</code> is doing for instance.</p>",
        "id": 491419115,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1735662665
    },
    {
        "content": "<p>For inspiration, the corresponding code for <code>guard_msgs</code> is at <a href=\"https://github.com/leanprover/lean4/blob/master/src/Lean/Elab/GuardMsgs.lean#L177-L210\">https://github.com/leanprover/lean4/blob/master/src/Lean/Elab/GuardMsgs.lean#L177-L210</a></p>",
        "id": 491419714,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1735663046
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/Lean/Meta/Tactic/TryThis.html#Lean.Meta.Tactic.TryThis.addSuggestion\">Lean.Meta.Tactic.TryThis.addSuggestion</a> seems relevant too</p>",
        "id": 491419994,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1735663206
    },
    {
        "content": "<p>I think a code action is enough here, although I would be happy with a try this widget if you fancy doing that.</p>",
        "id": 491420074,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1735663274
    },
    {
        "content": "<p>right, these are different things <span aria-label=\"idea\" class=\"emoji emoji-1f4a1\" role=\"img\" title=\"idea\">:idea:</span></p>",
        "id": 491420731,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1735663731
    },
    {
        "content": "<p>One is contained in the other: <code>addSuggestion</code> does create a code action in addition to the widget.</p>",
        "id": 491422323,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1735664752
    },
    {
        "content": "<p>doing this is a bit troublesome: it seems to require either nailing down <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Mathlib.Tactic.successIfFailWithMessage#doc\">docs#Mathlib.Tactic.successIfFailWithMessage</a> to some meta monad (i'm guessing <code>TacticM</code>), or parsing an error message to recover the concrete message, or messing about with custom infotree nodes?</p>",
        "id": 491427819,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1735668480
    },
    {
        "content": "<p>option 2 is definitely <em>bad</em>, option 1 might cause some breakage but is doable i think, and i'm not very knowledgable w/r/t dealing with infotree manipulation, so i'm wary of myself doing option 3...</p>",
        "id": 491427970,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1735668575
    },
    {
        "content": "<p>Its in the tactic namespace, so option 1 seems reasonable?</p>",
        "id": 491490494,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1735728615
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/20378\">#20378</a> implements option 1</p>",
        "id": 491497456,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1735735596
    },
    {
        "content": "<p>(now with less pinning down, more <code>MonadLiftT</code>)</p>",
        "id": 491497909,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1735736073
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 491505991,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1735743498
    },
    {
        "content": "<p>It has landed in master, for those interested</p>",
        "id": 492710390,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1736426002
    },
    {
        "content": "<p>If requests for additional code actions are tempting, one for <code>extract_goal</code> (which adds the lemma above the current declaration) seems like it also might be nice to have as well. CC <span class=\"user-mention\" data-user-id=\"246273\">@Bhavik Mehta</span></p>",
        "id": 494226206,
        "sender_full_name": "Julian Berman",
        "timestamp": 1737058682
    },
    {
        "content": "<p>And it should replace the <code>extract_goal</code> call with <code>apply extracted_lemma</code>.</p>",
        "id": 494296135,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1737097992
    },
    {
        "content": "<p>Also, <code>extract_goal</code> doesn't make use of the existing <code>variable</code>s and it has a lot of <code>[_inst_37 : SomeClass X Y Z]</code> assumptions that shouldn't have the <code>_isnt_37 : </code>.</p>",
        "id": 494296249,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1737098045
    },
    {
        "content": "<p>I noticed actually that <code>LeanAide</code>'s autoformalized statements also have lots of the unwanted <code>_inst_37</code>s. (<span class=\"user-mention\" data-user-id=\"266304\">@Siddhartha Gadgil</span>). Perhaps there is a common fix.</p>",
        "id": 494296626,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1737098250
    },
    {
        "content": "<p>LeanAide uses (at least most of the time) the Lean commands <code>delab</code>, <code>ppExpr</code> and <code>ppTerm</code> to generate the strings shown. Perhaps one of these is the source of the <code>inst_37</code>s.</p>",
        "id": 494301522,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1737100667
    }
]