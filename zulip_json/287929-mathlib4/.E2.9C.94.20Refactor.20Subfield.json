[
    {
        "content": "<p>Current <code>Subfield</code> in <code>mathlib</code> is defined over <code>DivisonRing</code>, I want to refactor it to </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">SubField</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommSemiring</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">Subalgebra</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">mul_comm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">âˆ€</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">carrier</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">carrier</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"n\">inverse</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">âˆ€</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">carrier</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">â‰ </span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"bp\">âˆƒ</span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">carrier</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>so that the current version becomes <code>SubField â„¤ D</code>. The reason being is that I want to prove bunch of results about central simple algebras that uses <code>SubField</code> following this <a href=\"https://www.math.stonybrook.edu/~aknapp/download/a2-alg-inside.pdf\">book</a>, if people have any suggestions they are very welcome! <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 510555957,
        "sender_full_name": "Edison Xie",
        "timestamp": 1743999197
    },
    {
        "content": "<p>cc <span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span>  <span class=\"user-mention\" data-user-id=\"224323\">@Junyan Xu</span>  <span class=\"user-mention\" data-user-id=\"439483\">@Andrew Yang</span>  <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span>  <span class=\"user-mention\" data-user-id=\"387244\">@YaÃ«l Dillies</span></p>",
        "id": 510556132,
        "sender_full_name": "Edison Xie",
        "timestamp": 1743999306
    },
    {
        "content": "<p>This should replace <code>IntermediateField</code> instead of <code>Subfield</code>.</p>",
        "id": 510556308,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1743999436
    },
    {
        "content": "<p>I feel like <code>InteremediateField</code> should remain the text book definition due to the naming</p>",
        "id": 510556439,
        "sender_full_name": "Edison Xie",
        "timestamp": 1743999513
    },
    {
        "content": "<p>But if there's any good reasons I'm happy to do it</p>",
        "id": 510556491,
        "sender_full_name": "Edison Xie",
        "timestamp": 1743999546
    },
    {
        "content": "<p>The point is that <code>Subfield</code>  right now only eats one type, not two. I don't see any reason why <code>IntermediateField</code> can't be refactored to apply in this more general situation although what you seem to have defined is <code>IntermediateDivisionRing</code></p>",
        "id": 510568240,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744005970
    },
    {
        "content": "<p>Fun fact: <code>Subfield</code> is in fact division subring, and <code>IsField</code> is in fact \"is division ring\", both of them are not requiring commutativity.</p>",
        "id": 510580998,
        "sender_full_name": "Jz Pan",
        "timestamp": 1744010700
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Refactor.20Subfield/near/510568240\">said</a>:</p>\n<blockquote>\n<p>The point is that <code>Subfield</code>  right now only eats one type, not two. I don't see any reason why <code>IntermediateField</code> can't be refactored to apply in this more general situation although what you seem to have defined is <code>IntermediateDivisionRing</code></p>\n</blockquote>\n<p>I thought <code>mul_comm</code> is the part that requires commutativity?</p>",
        "id": 510584150,
        "sender_full_name": "Edison Xie",
        "timestamp": 1744011605
    },
    {
        "content": "<p>Oh yeah you're right. I shouldnt be reading zulip on mobile without my glasses :-)</p>",
        "id": 510588420,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744012758
    },
    {
        "content": "<p>okay so the plan is now to refactor <code>IntermediateField</code> but since it's now over algebras and I've got results for that, what do I do to the current properties proved over field? Do I split the file?</p>",
        "id": 510593946,
        "sender_full_name": "Edison Xie",
        "timestamp": 1744014193
    },
    {
        "content": "<p>Should it still be under <code>FieldTheory</code>?</p>",
        "id": 510593991,
        "sender_full_name": "Edison Xie",
        "timestamp": 1744014207
    },
    {
        "content": "<p>maybe I should move it to <code>Mathlib/Algebra</code>?</p>",
        "id": 510594061,
        "sender_full_name": "Edison Xie",
        "timestamp": 1744014224
    },
    {
        "content": "<p>Splitting the file sounds right.</p>",
        "id": 510597865,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1744015139
    },
    {
        "content": "<p>Because it's gonna be a big PR, do I do it in one PR or do I give it a temporary other name, define it first and then change the current <code>IntermediateField</code>?</p>",
        "id": 510598220,
        "sender_full_name": "Edison Xie",
        "timestamp": 1744015229
    },
    {
        "content": "<blockquote>\n<p><code>Subfield</code> is in fact division subring</p>\n</blockquote>\n<p>This is true.</p>\n<blockquote>\n<p>and <code>IsField</code> is in fact \"is division ring\", both of them are not requiring commutativity.</p>\n</blockquote>\n<p>Nope, <code>IsField</code> requires <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsField.mul_comm#doc\">docs#IsField.mul_comm</a>. Rather, it's \"is semifield\", see <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsField.toSemifield#doc\">docs#IsField.toSemifield</a>.</p>",
        "id": 510600327,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1744015735
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/23765\">#23765</a></p>",
        "id": 510614786,
        "sender_full_name": "Edison Xie",
        "timestamp": 1744019312
    },
    {
        "content": "<p>This has been discussed in the past at <a class=\"message-link\" href=\"/#narrow/channel/287929-mathlib4/topic/subfields.20are.20not.20fields/near/477814458\">#mathlib4 &gt; subfields are not fields @ ðŸ’¬</a> . Some observations:</p>\n<ul>\n<li>If we \"remove\" (intermediate) subdivisionrings, we should probably add them back with a different name</li>\n<li>If we're adding commutative subdivisionrings, should we also be adding commutative subrings / submonoids?</li>\n<li>If we're removing the requirement for the ambient type to have inv, should we do the same for Subgroup?</li>\n</ul>",
        "id": 510621078,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744020797
    },
    {
        "content": "<p>These are good questions. And I think we should try to find a balance between:</p>\n<ul>\n<li>uniform answers that apply to all examples equally</li>\n<li>pragmatic answers that focus on how specific are used in practice</li>\n</ul>",
        "id": 510622650,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1744021205
    },
    {
        "content": "<p>For my second point, I believe we already have a solution is the form of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Subgroup.IsCommutative#doc\">docs#Subgroup.IsCommutative</a></p>",
        "id": 510623900,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744021548
    },
    {
        "content": "<p>Regarding the third, we already have quite a lot of submonoids (eg <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=unitary#doc\">docs#unitary</a>) which we manually attach an inverse to later.</p>",
        "id": 510624336,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744021666
    },
    {
        "content": "<p>What exactly is needed about them in practice?<br>\nDo you care about e.g. the lattice of (commutative) intermediate fields between rings?</p>",
        "id": 510624931,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1744021818
    },
    {
        "content": "<p>Yeah I'm wondering whether you really need the type of intermediate fields (of a CSA). Can you use <code>S : Subalgebra K A</code> together with <code>IsField S</code>?</p>",
        "id": 510626262,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1744022183
    },
    {
        "content": "<p>To talk about maximal subfields you can use <code>Maximal (IsField Â·) S</code>, I think.</p>",
        "id": 510626650,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1744022283
    },
    {
        "content": "<p>hmmm are you saying that <code>SubField</code> should not be a separate definition?</p>",
        "id": 510629154,
        "sender_full_name": "Edison Xie",
        "timestamp": 1744022993
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"224323\">Junyan Xu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Refactor.20Subfield/near/510626650\">said</a>:</p>\n<blockquote>\n<p>To talk about maximal subfields you can use <code>Maximal (IsField Â·) S</code>, I think.</p>\n</blockquote>\n<p>But in this case I'll have to add <code>letI : Field S := IsField.toField hS</code>  everytime I want to use simplicity</p>",
        "id": 510629709,
        "sender_full_name": "Edison Xie",
        "timestamp": 1744023123
    },
    {
        "content": "<p>I think in all cases the interesting property is being a maximal commutative subalgebra; in a finite-dimensional division ring over a field, <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/RingTheory/IntegralClosure/IsIntegralClosure/Basic.html#IsIntegral.inv_mem\">IsIntegral.inv_mem</a> is always satisfied. You can impose the maximality condition as <code>Maximal (@Std.Commutative Â· Mul.mul) S</code>. In a CSA, the maximal commutative subalgebras that are fields are interesting, e.g. (screenshot from Lorenz's Algebra II)<br>\n<a href=\"/user_uploads/3121/H7AJ9zK841Hxk7nHN5uY_bgU/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/H7AJ9zK841Hxk7nHN5uY_bgU/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1151x477\" src=\"/user_uploads/thumbnail/3121/H7AJ9zK841Hxk7nHN5uY_bgU/image.png/840x560.webp\"></a></div><p>I'm not sure whether maximal subfields in a CSA are interesting; if F is algebraically closed then F is surely maximal in Mâ‚‚(F), but it's not a maximal commutative subalgebra.</p>",
        "id": 510635907,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1744024654
    },
    {
        "content": "<p>Yeah so I had never noticed this; maximal subfields of a division ring are important (for example the quadratic extensions of a char 0 field which split a quaternion algebra are up to isomorphism exactly the maximal subfields) but it had not occurred to me that they were the same as maximal commutative subalgebras. Although I know nothing about Azumaya algebras it would not surprise me if this were the correct generalization!</p>",
        "id": 510651243,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744028270
    },
    {
        "content": "<blockquote>\n<p>it had not occurred to me that they were the same as maximal commutative subalgebras.</p>\n</blockquote>\n<p>So the issue is probably whether we should define CommSubalgebra or we should be satisfied with <code>Maximal (@Std.Commutative Â· Mul.mul) S</code>.</p>\n<blockquote>\n<p>Although I know nothing about Azumaya algebras it would not surprise me if this were the correct generalization!</p>\n</blockquote>\n<p>It seems we need to include a separability condition, see <a href=\"http://www.sajm-online.com/uploads/sajm2-3-11.pdf\">this paper</a> (found by Googling \"maximal commutative subalgebra of azumaya\").</p>\n<p><a href=\"/user_uploads/3121/nZL6k-DnK1N2QOGdchBZHrTw/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/nZL6k-DnK1N2QOGdchBZHrTw/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"969x174\" src=\"/user_uploads/thumbnail/3121/nZL6k-DnK1N2QOGdchBZHrTw/image.png/840x560.webp\"></a></div>",
        "id": 510659443,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1744030062
    },
    {
        "content": "<p>We should never write <code>Mul.mul</code>, as <code>*</code> is <code>HMul.hMul</code></p>",
        "id": 510659642,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744030089
    },
    {
        "content": "<p>A class for spelling commutativity of multiplication is being discussed at <a class=\"message-link\" href=\"/#narrow/channel/287929-mathlib4/topic/Abelian.20extension/near/510231162\">#mathlib4 &gt; Abelian extension @ ðŸ’¬</a></p>",
        "id": 510660296,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1744030213
    },
    {
        "content": "<p>Yes I agree with <span class=\"user-mention\" data-user-id=\"224323\">@Junyan Xu</span> since most of the time I am indeed dealing with maximal subfield of a division ring, I think we do need <code>CommSubalgebra</code></p>",
        "id": 510808332,
        "sender_full_name": "Edison Xie",
        "timestamp": 1744082571
    },
    {
        "content": "<p>so i will close <a href=\"https://github.com/leanprover-community/mathlib4/pull/23765\">#23765</a> and open a new PR about <code>CommSubalgebra</code></p>",
        "id": 510840913,
        "sender_full_name": "Edison Xie",
        "timestamp": 1744090218
    },
    {
        "content": "<p>I'm not sure what <span class=\"user-mention\" data-user-id=\"224323\">@Junyan Xu</span> said above implies that we need <code>CommSubalgebra</code>?</p>",
        "id": 510841004,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1744090283
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"224323\">Junyan Xu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Refactor.20Subfield/near/510659443\">said</a>:</p>\n<blockquote>\n<p>So the issue is probably whether we should define CommSubalgebra or we should be satisfied with <code>Maximal (@Std.Commutative Â· Mul.mul) S</code>.<br>\n</p>\n</blockquote>\n<p>I think the former is better?</p>",
        "id": 510841312,
        "sender_full_name": "Edison Xie",
        "timestamp": 1744090466
    },
    {
        "content": "<p>The former sounds like a lot more work for what I expect to be fairly marginal gain. I think it would be better to make do with the latter, and evaluate introducing <code>CommSubalgebra</code> only one we have some existing code that would benefit from it</p>",
        "id": 510866842,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744099979
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"699016\">Edison Xie</span> has marked this topic as resolved.</p>",
        "id": 510929976,
        "sender_full_name": "Notification Bot",
        "timestamp": 1744118086
    }
]