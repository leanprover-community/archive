[
    {
        "content": "<p>After updating Lean from v4.24.0 to v4.27.0-rc1 and mathlib from a77a0aea to 1723eba8, tactic rw! started failing with <code>unknown free variable _fvar.423</code></p>\n<p>MWE:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib.Tactic</span>\n\n<span class=\"kd\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">â„•</span><span class=\"w\"> </span><span class=\"bp\">Ã—</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hâ‚</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">xs.map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">Â·.</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">])</span>\n<span class=\"o\">(</span><span class=\"n\">hâ‚‚</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">xs.map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">Â·.</span><span class=\"mi\">1</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hâ‚ƒ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">xs.map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">Â·.</span><span class=\"mi\">1</span><span class=\"o\">))[</span><span class=\"mi\">0</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hâ‚</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">hâ‚ƒ</span><span class=\"w\"> </span><span class=\"c1\">-- unknown free variable `_fvar.423`</span>\n</code></pre></div>",
        "id": 566618647,
        "sender_full_name": "Shubakur Mitra",
        "timestamp": 1767732031
    },
    {
        "content": "<p>A bit more minimized:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">DepRewrite</span>\n\n<span class=\"sd\">/-- error: unknown free variable `_fvar.28` -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw!</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>\n<p>cc <span class=\"user-mention\" data-user-id=\"816344\">@Aaron Liu</span></p>",
        "id": 566619695,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1767732484
    },
    {
        "content": "<p>oh I'll take a look</p>",
        "id": 566624421,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767734697
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"128280\">@ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’</span> might want to take a look too</p>",
        "id": 566624461,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767734718
    },
    {
        "content": "<p>looks like it's a problem with cleanup casts</p>",
        "id": 566624638,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767734794
    },
    {
        "content": "<p>until it's fixed you can use <code>rewrite!</code> instead</p>",
        "id": 566624673,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767734812
    },
    {
        "content": "<p>ah I fixed it</p>",
        "id": 566625346,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767735136
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/33686\">#33686</a></p>",
        "id": 566625868,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767735418
    }
]