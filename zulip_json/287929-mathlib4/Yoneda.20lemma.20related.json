[
    {
        "content": "<p>Hello folks,</p>\n<p>I'd like to contribute to mathlib4.<br>\nMore precisely, in short, I have proved a specific Yoneda<br>\nlemma (for, what I call, Functional Categories), that I want<br>\nto make part of mathlib4.</p>\n<p>So, naturally, I had a look at<br>\n<a href=\"https://github.com/leanprover-community/mathlib4/blob/master/Mathlib/CategoryTheory/Yoneda.lean\">https://github.com/leanprover-community/mathlib4/blob/master/Mathlib/CategoryTheory/Yoneda.lean</a>.</p>\n<p>The code contains an overwhelming amount of Yoneda-related theorems.</p>\n<p>I may be wrong, but I did not find the theorem that I thought<br>\nwas the Yoneda lemma I knew.</p>\n<p>I saw <code>coyonedaEquiv</code> which is really cool!</p>\n<p>But </p>\n<ol>\n<li>\n<p><code>coyonedaEquiv</code> does not explicitly prove that <br>\n<code>fun _ x ‚Ü¶ F.map x Œæ</code> is a natural transformation.<br>\nAgain, I may be wrong, maybe it somehow proves it implicitly.</p>\n</li>\n<li>\n<p><code>coyonedaEquiv</code> does not really deals with <em>how</em><br>\nboth sides of the bijection relate to each other.</p>\n</li>\n</ol>\n<p>The code below deals with both 1. and 2. .</p>\n<p>If the Mathlib experts know that the code is already dealt<br>\nwith by the (overwhelming amount of) Yoneda-related theorems,<br>\nthen, <em>really</em>, sorry for posting all this.</p>\n<p>If not, then I would be more than willing to, somehow, add them to<br>\nmathlib4. Perhaps as a pull request?</p>\n<p>Here is my code</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Code listing</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Functor</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Functor</span><span class=\"bp\">.</span><span class=\"n\">Hom</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Opposite</span><span class=\"w\"> </span><span class=\"n\">Category</span><span class=\"w\"> </span><span class=\"n\">Functor</span>\n\n<span class=\"kn\">universe</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">u‚ÇÅ</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u‚ÇÅ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v‚ÇÅ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span>\n\n<span class=\"c\">/-</span>\n<span class=\"cm\">This (slightly changed) definition is part of Mathlib.</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simps</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">coYoneda</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"bp\">·µí·µñ</span><span class=\"w\"> </span><span class=\"bp\">‚•§</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">‚•§</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"n\">Zop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">unop</span><span class=\"w\"> </span><span class=\"n\">Zop</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">Y</span>\n<span class=\"w\">      </span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x2y</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">x2y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">x2y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">y2x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x2y</span><span class=\"bp\">.</span><span class=\"n\">unop</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y2x</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"bp\">¬∑</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">}</span>\n\n<span class=\"c\">/-</span>\n<span class=\"cm\">This (slightly changed) definition is part of Mathlib.</span>\n\n<span class=\"cm\">It defines a bijection (via 'toFun' and 'invFun')</span>\n\n<span class=\"cm\">between</span>\n\n<span class=\"cm\">natural transformations</span>\n<span class=\"cm\">from 'coYoneda.obj (op Z)' (the coYoneda functor for Z)</span>\n<span class=\"cm\">to a preSheaf (a Type-valued functor)</span>\n\n<span class=\"cm\">and</span>\n\n<span class=\"cm\">values of Type 'preSheaf.obj Z'</span>\n<span class=\"cm\">-/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">coyonedaEquiv</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">preSheaf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">‚•§</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">coYoneda</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">preSheaf</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ</span>\n<span class=\"w\">    </span><span class=\"n\">preSheaf</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">natTransf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">coYoneda</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">preSheaf</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">preSheaf_Z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">preSheaf</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">      </span><span class=\"n\">natTransf</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">preSheaf_Z</span>\n<span class=\"w\">  </span><span class=\"n\">invFun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">preSheaf_Z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">preSheaf</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">natTransf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">coYoneda</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">preSheaf</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">      </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">z2y</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"n\">preSheaf</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">z2y</span><span class=\"w\"> </span><span class=\"n\">preSheaf_Z</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"n\">natTransf</span>\n<span class=\"w\">  </span><span class=\"n\">left_inv</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">natTransf</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">dsimp</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">FunctorToTypes</span><span class=\"bp\">.</span><span class=\"n\">naturality</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"n\">right_inv</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">preSheaf_Z</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span>\n\n<span class=\"c\">/-</span>\n<span class=\"cm\">This theorem is not part of Mathlib.</span>\n\n<span class=\"cm\">It proves an equality</span>\n<span class=\"cm\">defining *how* a natural transformation</span>\n<span class=\"cm\">from 'coYoneda.obj (op Z)' (the coYoneda functor for Z)</span>\n<span class=\"cm\">to a preSheaf (a Type-valued functor)</span>\n<span class=\"cm\">can be defined in terms of a value of type 'preSheaf.obj Z'</span>\n\n<span class=\"cm\">The proof uses</span>\n<span class=\"cm\">'congr_fun (natTransf.naturality z2y) (ùüô Z)'</span>\n<span class=\"cm\">-/</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">coyoneda_1</span>\n<span class=\"w\">    </span><span class=\"c1\">-- if given</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">preSheaf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">‚•§</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">natTransf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">coYoneda</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">preSheaf</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"c1\">-- then forall</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">z2y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n\n<span class=\"w\">  </span><span class=\"n\">natTransf</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">z2y</span>\n<span class=\"w\">    </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">preSheaf</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">z2y</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">natTransf</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">coYoneda_Z</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">coYoneda</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">)</span>\n\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">preSheaf_Z</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">natTransf</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">)</span>\n\n<span class=\"w\">    </span><span class=\"k\">calc</span>\n\n<span class=\"w\">      </span><span class=\"n\">natTransf</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">z2y</span>\n<span class=\"w\">        </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">natTransf</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">z2y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"c1\">-- z2y = ùüô Z ‚â´ z2y</span>\n\n<span class=\"w\">    </span><span class=\"bp\">_</span><span class=\"w\">   </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">coYoneda_Z</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">z2y</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">natTransf</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">        </span><span class=\"n\">rfl</span>\n\n<span class=\"w\">    </span><span class=\"bp\">_</span><span class=\"w\">   </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">natTransf</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">preSheaf</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">z2y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">        </span><span class=\"n\">congr_fun</span><span class=\"w\"> </span><span class=\"c1\">-- F.map f ‚â´ app Y = app X ‚â´ G.map f</span>\n<span class=\"w\">          </span><span class=\"o\">(</span><span class=\"n\">natTransf</span><span class=\"bp\">.</span><span class=\"n\">naturality</span><span class=\"w\"> </span><span class=\"n\">z2y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">)</span>\n\n<span class=\"w\">    </span><span class=\"bp\">_</span><span class=\"w\">   </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">preSheaf</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">z2y</span><span class=\"w\"> </span><span class=\"n\">preSheaf_Z</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">        </span><span class=\"n\">rfl</span>\n\n<span class=\"c\">/-</span>\n<span class=\"cm\">This theorem proves that a transformation</span>\n<span class=\"cm\">defined in terms of a value of type 'preSheaf.obj Z'</span>\n<span class=\"cm\">(as in coyoneda_1 above)</span>\n<span class=\"cm\">is a natural transformation</span>\n<span class=\"cm\">(as in coyoneda_1 above)</span>\n\n<span class=\"cm\">-/</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">coyoneda_2</span>\n<span class=\"w\">    </span><span class=\"c1\">-- if given</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">preSheaf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">‚•§</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">preSheaf_Z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">preSheaf</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"c1\">-- then forall</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">y2x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">z2y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n\n<span class=\"w\">  </span><span class=\"o\">((</span><span class=\"n\">preSheaf</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">preSheaf_Z</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">preSheaf</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">y2x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">z2y</span>\n<span class=\"w\">    </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">coYoneda</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">y2x</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"n\">preSheaf</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">preSheaf_Z</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"n\">z2y</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">coYoneda_Z</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">coYoneda</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">)</span>\n\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">transf_Z_Y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">preSheaf</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">z2y</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"n\">preSheaf</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">z2y</span><span class=\"w\"> </span><span class=\"n\">preSheaf_Z</span>\n\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">transf_Z_X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">preSheaf</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">z2x</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"n\">preSheaf</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">z2x</span><span class=\"w\"> </span><span class=\"n\">preSheaf_Z</span>\n\n<span class=\"w\">  </span><span class=\"k\">calc</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">transf_Z_Y</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">preSheaf</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">y2x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">z2y</span>\n<span class=\"w\">     </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">preSheaf</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">y2x</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">preSheaf</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">z2y</span><span class=\"w\"> </span><span class=\"n\">preSheaf_Z</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">     </span><span class=\"n\">rfl</span>\n\n<span class=\"w\">  </span><span class=\"bp\">_</span><span class=\"w\">  </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">preSheaf</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">z2y</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">y2x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">preSheaf_Z</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"c1\">-- map (f ‚â´ g) = map f ‚â´ map g</span>\n\n<span class=\"w\">  </span><span class=\"bp\">_</span><span class=\"w\">  </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">coYoneda_Z</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">y2x</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">transf_Z_X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">z2y</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">     </span><span class=\"n\">rfl</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span>\n</code></pre></div>\n</div></div>",
        "id": 542327629,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1759252138
    },
    {
        "content": "<p>No need to apologize, the Zulip is the right place to ask given you already browsed the library. <a class=\"stream\" data-stream-id=\"217875\" href=\"/#narrow/channel/217875-Is-there-code-for-X.3F\">#Is there code for X?</a> may be even better.</p>",
        "id": 542369171,
        "sender_full_name": "Lawrence Wu (llllvvuu)",
        "timestamp": 1759267027
    },
    {
        "content": "<p>The first two definitions exist in mathlib, as you note yourself.<br>\nYour <code>coyoneda_1</code> can be proven by</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">FunctorToTypes</span><span class=\"bp\">.</span><span class=\"n\">naturality</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>and your <code>coyoneda_2</code> can be proven by</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">simp</span>\n</code></pre></div>",
        "id": 542370159,
        "sender_full_name": "Christian Merten",
        "timestamp": 1759267470
    },
    {
        "content": "<p>Christian Merten, thx, I'll give it a try. </p>\n<p>Anyway, the general Yoneda Lemma was just a first try. <br>\nMy main goal is to write my specific Yoneda Lemma (for Functional Categories) in Lean.</p>\n<p>Thanks for the constructive answer. Much appreciated.</p>",
        "id": 542370686,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1759267703
    },
    {
        "content": "<p>Christian Merten,</p>\n<p>Thanks so much. You are my hero!</p>\n<p>The code below, more in sync with the<br>\nMathlib naming conventions, indeed, does the trick.</p>\n<p>Impressive!</p>\n<p>Frankly, with all those (co)yoneda theorems in<br>\nMathlib/CategoryTheory/Yoneda.lean<br>\nit does not really come as a surprise<br>\nthat my two theorems do not need a <code>calc</code> proof.</p>\n<p>Do you think it is useful to add them to<br>\nMathlib/CategoryTheory/Yoneda.lean<br>\nanyway (perhaps with a more approriate comment)?</p>\n<p>Agreed, they deal with the <em>how</em>, while most other<br>\nones deal with the <em>what</em>.</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Code listing</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Functor</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Yoneda</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Opposite</span><span class=\"w\"> </span><span class=\"n\">Category</span><span class=\"w\"> </span><span class=\"n\">Functor</span>\n\n<span class=\"kn\">universe</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">u‚ÇÅ</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u‚ÇÅ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v‚ÇÅ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span>\n\n<span class=\"c\">/-</span>\n<span class=\"cm\">This theorem proves an equality</span>\n<span class=\"cm\">defining *how* a natural transformation</span>\n<span class=\"cm\">from 'coyoneda.obj (op Z)' (the coyoneda functor for Z)</span>\n<span class=\"cm\">to a presheaf (a Type-valued functor)</span>\n<span class=\"cm\">can be defined in terms of a value of type 'F.obj Z'</span>\n<span class=\"cm\">-/</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">coyoneda_1</span>\n<span class=\"w\">    </span><span class=\"c1\">-- if given</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">‚•§</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Œ∑</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">coyoneda</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"c1\">-- then forall</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">z2y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n\n<span class=\"w\">  </span><span class=\"n\">Œ∑</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">z2y</span>\n<span class=\"w\">    </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">z2y</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ∑</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">FunctorToTypes</span><span class=\"bp\">.</span><span class=\"n\">naturality</span><span class=\"o\">]</span>\n\n<span class=\"c\">/-</span>\n<span class=\"cm\">This theorem proves that a transformation</span>\n\n<span class=\"cm\">defined in terms of a value of type 'F.obj Z'</span>\n<span class=\"cm\">as in coyoneda_1 above</span>\n<span class=\"cm\">is a natural transformation</span>\n<span class=\"cm\">-/</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">coyoneda_2</span>\n<span class=\"w\">    </span><span class=\"c1\">-- if given</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">‚•§</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">F_Z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"c1\">-- then forall</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">y2x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">z2y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n\n<span class=\"w\">  </span><span class=\"o\">((</span><span class=\"n\">F</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">F_Z</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">y2x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">z2y</span>\n<span class=\"w\">    </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">coyoneda</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">y2x</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">F_Z</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"n\">z2y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span>\n</code></pre></div>\n</div></div>\n<p>The formulation and proof of my own specific<br>\ncoyoneda will be another challenge ... .</p>\n<p>I'll start with <code>calc</code> proofs and extract as many<br>\nintermediate lemmas as possible.</p>",
        "id": 542375332,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1759270251
    },
    {
        "content": "<p>If these lemmas appeared to be super useful in order to prove other significant things, they could be considered for inclusion, but so far, I do not think there is a need for the addition of these two lemmas.</p>",
        "id": 542451847,
        "sender_full_name": "Jo√´l Riou",
        "timestamp": 1759311911
    },
    {
        "content": "<p>Christian and Jo√´l, </p>\n<p>Greetings from the Lean workshop.</p>\n<p>Thanks for your comments.</p>\n<p>No my lemmas are not  super useful in order to prove significant things that<br>\ncannot be proven by the existing ones.</p>\n<p>However, the second one, slightly changed, (see code below) proves that <code>invFun Œæ</code> <em>satisfies the natural transformation law</em>. As far as I understand, <code>coyonedaEquiv</code>, only deals with the \"two-sided inverse\" aspect. </p>\n<p>But, then again, maybe some other theorem in the <code>Yoneda.lean</code> file already, explicitly or implicitly,  proves that <code>invFun Œæ</code> satisfies the natural transformation law.</p>\n<p>Btw, I would have expected that I needed to help <code>simp</code> with <code>Functor.map_comp</code>, but it does not seem to be necessary.</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Code listing</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Functor</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Yoneda</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Opposite</span><span class=\"w\"> </span><span class=\"n\">Category</span><span class=\"w\"> </span><span class=\"n\">Functor</span>\n\n<span class=\"kn\">universe</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">u‚ÇÅ</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u‚ÇÅ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v‚ÇÅ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span>\n\n<span class=\"c\">/-</span>\n<span class=\"cm\">def coyonedaEquiv {Z : C} {F : C ‚•§ Type v‚ÇÅ} : (coyoneda.obj (op Z) ‚ü∂ F) ‚âÉ F.obj Z where</span>\n<span class=\"cm\">  toFun Œ∑ := Œ∑.app Z (ùüô Z)</span>\n<span class=\"cm\">  invFun Œæ := { app := fun _ x ‚Ü¶ F.map x Œæ }</span>\n<span class=\"cm\">  left_inv := fun Œ∑ ‚Ü¶ by</span>\n<span class=\"cm\">    ext Y (_ : Z ‚ü∂ Y)</span>\n<span class=\"cm\">    dsimp</span>\n<span class=\"cm\">    rw [‚Üê FunctorToTypes.naturality]</span>\n<span class=\"cm\">    simp</span>\n<span class=\"cm\">  right_inv := by intro Œæ; simp</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">equivNaturality</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">y2x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">z2y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">‚•§</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Œæ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">invFun</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">NatTrans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">coyoneda</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">Œæ</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">Œæ</span><span class=\"w\"> </span><span class=\"o\">}</span>\n\n<span class=\"w\">  </span><span class=\"o\">((</span><span class=\"n\">invFun</span><span class=\"w\"> </span><span class=\"n\">Œæ</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">y2x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">z2y</span>\n<span class=\"w\">    </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">coyoneda</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">y2x</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">invFun</span><span class=\"w\"> </span><span class=\"n\">Œæ</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">z2y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span>\n</code></pre></div>\n</div></div>",
        "id": 542747248,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1759413086
    },
    {
        "content": "<p>I do not know what you are trying to say, but in the definition of <code>coyonedaEquiv</code>, the line <code>invFun Œæ := { app := fun _ x ‚Ü¶ F.map x Œæ }</code> construct a natural transformation: the code only gives the data of the <code>app</code> field, because the proof of the <code>naturality</code> field is filled automatically. There is no point stating this as a separate lemma.</p>",
        "id": 542750939,
        "sender_full_name": "Jo√´l Riou",
        "timestamp": 1759413964
    },
    {
        "content": "<p>Thanks so much Jo√´l,</p>\n<p>So do you mean that the fact the <em>signature</em> of my <code>invFun</code> definition mentions <code>NaTrans</code>automatically (not to say automagically) <em>proves</em> that the naturality law is satified? I was not aware of that specific power of <code>Lean</code>. I am relatively new.</p>",
        "id": 542808179,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1759430350
    },
    {
        "content": "<p>The <code>naturality</code> is part of the \"axioms\" that are satisfied by any object of type <code>NatTrans F G</code>. If one constructs something in <code>NatTrans F G</code>, then it must be a <em>natural</em> transformation.<br>\nIn the category theory part of mathlib, many obvious and not so obvious commutativity of diagrams are proven automatically.</p>",
        "id": 542809059,
        "sender_full_name": "Jo√´l Riou",
        "timestamp": 1759430629
    },
    {
        "content": "<p>OK, poof by construction at type level. Cool.</p>",
        "id": 542809339,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1759430730
    },
    {
        "content": "<p>To answer the \"automatically\" question a bit more, in Lean you can in a typeclass definition specify a tactic that will be tried by default when not otherwise specified. Much of the category theory in Mathlib does this. To be specific in the above example, <code>NatTrans</code> is given some specified data <code>app</code>, and the <code>naturality</code> field is inferred by a tactic <code>cat_disch</code> that will call automation like <code>aesop</code> and <code>simp</code>.</p>",
        "id": 542810064,
        "sender_full_name": "Chris Henson",
        "timestamp": 1759431014
    },
    {
        "content": "<p>Ok, I saw this <code>cat_dish</code> several times when browsing the source code, but I was not aware of its power. Thanks again Chris and Jo√´l. I am still learning while trying, at the same time, to be creative as well. For my own specific Yoneda-like lemma for <code>FunctionalCategory</code> I can then, most probably, do similar things. Anyway, I will first start with a \"low profile\" <code>calc</code> based proof and then provide as much \"high profile\"  features Ihat I understand. You are my heros.</p>",
        "id": 542811667,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1759431559
    },
    {
        "content": "<p>Hello, folks,</p>\n<p>I am a little bit ashamed to ask this question.</p>\n<p>I thought I was becoming an experienced <code>calc</code><br>\nbased theorem prover, but now I am stuck with<br>\n(what I thought of as) two easy <code>have</code>'s.</p>\n<p>The MWE code below starts with minimal \"low-profile\"<br>\n<code>Category</code> and <code>Functor</code> stuff, and continues with my own<br>\nminimal <code>PreFunctionalCategory</code>.</p>\n<p>I prove a <code>theorem</code> using the two <code>have</code>'s<br>\n(they use <code>sorry</code>). </p>\n<p>The first <code>have</code> corresponds to the definition of<br>\n<code>toGlobal</code>, so I would expect to be able to replace <br>\n<code>sorry</code> by <code>rfl</code>. </p>\n<p>The second <code>have</code> uses the <code>instance : Category function</code>,<br>\nand I would also expect to be able to replace <code>sorry</code><br>\nby <code>rfl</code>. </p>\n<p>All comments are welcome.</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Code listing</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Question</span>\n\n<span class=\"k\">#eval</span><span class=\"w\"> </span><span class=\"s2\">\"- begin -\"</span>\n\n<span class=\"n\">abbrev</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÄ</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÅ</span>\n\n<span class=\"n\">abbrev</span><span class=\"w\"> </span><span class=\"n\">unaryTypeConstructor</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n\n<span class=\"n\">abbrev</span><span class=\"w\"> </span><span class=\"n\">binaryTypeConstructor</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n\n<span class=\"n\">abbrev</span><span class=\"w\"> </span><span class=\"n\">Global</span><span class=\"o\">(</span><span class=\"n\">btc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">binaryTypeConstructor</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">btc</span><span class=\"w\"> </span><span class=\"n\">Unit</span>\n\n<span class=\"kd\">class</span><span class=\"w\"> </span><span class=\"n\">Category</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">btc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">binaryTypeConstructor</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">where</span>\n\n<span class=\"w\">  </span><span class=\"n\">Œπ</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">btc</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">t</span>\n\n<span class=\"w\">  </span><span class=\"n\">andThen</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">t‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">btc</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÅ</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">btc</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÇ</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">btc</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÇ</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Category</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œπ</span><span class=\"w\"> </span><span class=\"n\">andThen</span><span class=\"o\">)</span>\n\n<span class=\"kd\">infixr</span><span class=\"o\">:</span><span class=\"mi\">80</span><span class=\"w\"> </span><span class=\"s2\">\" ‚â´ \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">andThen</span>\n\n<span class=\"kd\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">Category</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span>\n\n<span class=\"w\">    </span><span class=\"n\">Œπ</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">      </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">         </span><span class=\"n\">id</span>\n\n<span class=\"w\">    </span><span class=\"n\">andThen</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">t‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">      </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÅ</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÇ</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">        </span><span class=\"bp\">Œª</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÄ2t‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÅ2t‚ÇÇ</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÅ2t‚ÇÇ</span><span class=\"w\"> </span><span class=\"bp\">‚àò</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÄ2t‚ÇÅ</span>\n<span class=\"w\">  </span><span class=\"o\">}</span>\n\n<span class=\"kd\">class</span><span class=\"w\"> </span><span class=\"n\">Functor</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">btc‚ÇÄ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">binaryTypeConstructor</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">btc‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">binaryTypeConstructor</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">utc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unaryTypeConstructor</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">where</span>\n\n<span class=\"w\">  </span><span class=\"n\">œÜ</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">t‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">btc‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÅ</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">btc‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">utc</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÄ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">utc</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÅ</span><span class=\"o\">)</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Functor</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">œÜ</span><span class=\"o\">)</span>\n\n<span class=\"kd\">class</span><span class=\"w\"> </span><span class=\"n\">FunctorLaws</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">btc‚ÇÄ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">binaryTypeConstructor</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">btc‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">binaryTypeConstructor</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">utc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unaryTypeConstructor</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Category</span><span class=\"w\"> </span><span class=\"n\">btc‚ÇÄ</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Category</span><span class=\"w\"> </span><span class=\"n\">btc‚ÇÅ</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">functor</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Functor</span><span class=\"w\"> </span><span class=\"n\">btc‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">btc‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">utc</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"n\">where</span>\n\n<span class=\"w\">  </span><span class=\"n\">functor_sequential</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">t‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span>\n<span class=\"w\">      </span><span class=\"o\">{</span><span class=\"n\">t‚ÇÄ2t‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">btc‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÅ</span><span class=\"o\">}</span>\n<span class=\"w\">      </span><span class=\"o\">{</span><span class=\"n\">t‚ÇÅ2t‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">btc‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÇ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">functor.œÜ</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÄ2t‚ÇÅ</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">functor.œÜ</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÅ2t‚ÇÇ</span>\n<span class=\"w\">      </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">functor.œÜ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t‚ÇÄ2t‚ÇÅ</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÅ2t‚ÇÇ</span><span class=\"o\">)</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">FunctorLaws</span><span class=\"w\"> </span><span class=\"o\">(</span>\n<span class=\"w\">  </span><span class=\"n\">functor_sequential</span>\n<span class=\"o\">)</span>\n\n<span class=\"kd\">class</span><span class=\"w\"> </span><span class=\"n\">PreFunctionalCategory</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">btc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">binaryTypeConstructor</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"kd\">extends</span><span class=\"w\"> </span><span class=\"n\">Category</span><span class=\"w\"> </span><span class=\"n\">btc</span><span class=\"w\"> </span><span class=\"n\">where</span>\n\n<span class=\"w\">  </span><span class=\"c1\">-- function as morphism</span>\n<span class=\"w\">  </span><span class=\"n\">F2BTC</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Functor</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">btc</span><span class=\"w\"> </span><span class=\"n\">Id</span>\n\n<span class=\"w\">  </span><span class=\"c1\">-- value to global value</span>\n<span class=\"w\">  </span><span class=\"n\">toGlobal</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v‚Çú</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">btc</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">      </span><span class=\"n\">F2BTC.œÜ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">v‚Çú</span><span class=\"o\">)</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">PreFunctionalCategory</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F2BTC</span><span class=\"w\"> </span><span class=\"n\">toGlobal</span><span class=\"o\">)</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"n\">pointfreeApplication</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">btc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">binaryTypeConstructor</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">PreFunctionalCategory</span><span class=\"w\"> </span><span class=\"n\">btc</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">preFunctionalCategory</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PreFunctionalCategory</span><span class=\"w\"> </span><span class=\"n\">btc</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">functionCategory</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Category</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">FunctorLaws</span><span class=\"w\"> </span><span class=\"n\">preFunctionalCategory.F2BTC</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">t‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">t‚ÇÄ2t‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÅ</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">v‚Çú‚ÇÄ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÄ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">toGlobal</span><span class=\"w\"> </span><span class=\"n\">v‚Çú‚ÇÄ</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">F2BTC.œÜ</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÄ2t‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Global</span><span class=\"w\"> </span><span class=\"n\">btc</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÅ</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">toGlobal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t‚ÇÄ2t‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">v‚Çú‚ÇÄ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">v‚Çú</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">toGlobal</span><span class=\"w\"> </span><span class=\"n\">v‚Çú</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">btc</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">F2BTC.œÜ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">v‚Çú</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">v‚Çõ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s2t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">v‚Çõ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">s2t</span>\n<span class=\"w\">      </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">s2t</span><span class=\"w\"> </span><span class=\"n\">v‚Çõ</span>\n<span class=\"w\">      </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"w\">  </span><span class=\"k\">calc</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">toGlobal</span><span class=\"w\"> </span><span class=\"n\">v‚Çú‚ÇÄ</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">F2BTC.œÜ</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÄ2t‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Global</span><span class=\"w\"> </span><span class=\"n\">btc</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÅ</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">F2BTC.œÜ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">v‚Çú‚ÇÄ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">F2BTC.œÜ</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÄ2t‚ÇÅ</span>\n<span class=\"w\">      </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">congrArg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">F2BTC.œÜ</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÄ2t‚ÇÅ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">_</span><span class=\"w\">   </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">F2BTC.œÜ</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">v‚Çú‚ÇÄ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÄ2t‚ÇÅ</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">functor_sequential</span>\n<span class=\"w\">  </span><span class=\"n\">_</span><span class=\"w\">   </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">F2BTC.œÜ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">t‚ÇÄ2t‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">v‚Çú‚ÇÄ</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">congrArg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F2BTC.œÜ</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">h'</span>\n<span class=\"w\">  </span><span class=\"n\">_</span><span class=\"w\">   </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">toGlobal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t‚ÇÄ2t‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">v‚Çú‚ÇÄ</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Eq.symm</span><span class=\"w\"> </span><span class=\"n\">h</span>\n\n<span class=\"k\">#eval</span><span class=\"w\"> </span><span class=\"s2\">\"-- end --\"</span>\n\n<span class=\"kd\">end</span><span class=\"w\"> </span><span class=\"n\">Question</span>\n</code></pre></div>\n</div></div>",
        "id": 544758874,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1760450695
    },
    {
        "content": "<p>FYI : I could solve the problem using two sub-optimal hacks. I'll post the code tomorrow. I'm gonna  <span aria-label=\"sleeping\" class=\"emoji emoji-1f634\" role=\"img\" title=\"sleeping\">:sleeping:</span> now</p>",
        "id": 544843795,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1760479292
    }
]