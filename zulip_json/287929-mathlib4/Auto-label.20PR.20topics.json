[
    {
        "content": "<p>Following on the <a href=\"#narrow/stream/287929-mathlib4/topic/Topic.20label.20for.20.22data.22.3F\">conversation about PR labels</a>, does the list below seem like a good choice of auto-labels?</p>\n<p><code>CI</code><br>\n<code>t-algebra</code><br>\n<code>t-algebraicgeometry</code><br>\n<code>t-algebraictopology</code><br>\n<code>t-analysis</code><br>\n<code>t-categorytheory</code><br>\n<code>t-combinatorics</code><br>\n<code>t-computability</code><br>\n<code>t-condensed</code><br>\n<code>t-control</code><br>\n<code>t-data</code><br>\n<code>t-deprecated</code><br>\n<code>t-dynamics</code><br>\n<code>t-fieldtheory</code><br>\n<code>t-geometry</code><br>\n<code>t-grouptheory</code><br>\n<code>t-informationtheory</code><br>\n<code>t-init</code><br>\n<code>t-lean</code><br>\n<code>t-linearalgebra</code><br>\n<code>t-logic</code><br>\n<code>t-mathport</code><br>\n<code>t-measuretheory</code><br>\n<code>t-modeltheory</code><br>\n<code>t-numbertheory</code><br>\n<code>t-order</code><br>\n<code>t-probability</code><br>\n<code>t-representationtheory</code><br>\n<code>t-ringtheory</code><br>\n<code>t-settheory</code><br>\n<code>t-tactic</code><br>\n<code>t-testing</code><br>\n<code>t-topology</code><br>\n<code>t-util</code></p>",
        "id": 462329243,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723636446
    },
    {
        "content": "<p>These are just the root dirs inside of Mathlib, plus <code>CI</code>.  I could also add <code>t-archive</code> and <code>t-counterexamples</code>, though those are probably rarer.</p>",
        "id": 462329688,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723636657
    },
    {
        "content": "<p>Can we get an <code>-</code> in the middle, so <code>t-set-theory</code> rather than <code>t-settheory</code>?</p>",
        "id": 462332227,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1723637593
    },
    {
        "content": "<p>Also, those are not really topics but, so maybe <code>f-folder-name</code> is better than <code>t-folder-name</code></p>",
        "id": 462332275,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1723637616
    },
    {
        "content": "<p>If you prefer, I can also just add <code>f-FolderName</code> with the same capitalization as the folder.</p>",
        "id": 462333850,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723638047
    },
    {
        "content": "<p>I think that I like the idea of the bot posting the folder names, since that is useful information and also indisputable!  How about the bot labeling with the subset of</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"ss\">`CI</span><span class=\"bp\">`</span><span class=\"w\">                    </span><span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">Init</span><span class=\"bp\">`</span>\n<span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">Algebra</span><span class=\"bp\">`</span><span class=\"w\">             </span><span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">Lean</span><span class=\"bp\">`</span>\n<span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">AlgebraicGeometry</span><span class=\"bp\">`</span><span class=\"w\">           </span><span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">LinearAlgebra</span><span class=\"bp\">`</span>\n<span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">AlgebraicTopology</span><span class=\"bp\">`</span><span class=\"w\">           </span><span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">Logic</span><span class=\"bp\">`</span>\n<span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">Analysis</span><span class=\"bp\">`</span><span class=\"w\">                </span><span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">Mathport</span><span class=\"bp\">`</span>\n<span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">Archive</span><span class=\"bp\">`</span><span class=\"w\">             </span><span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">MeasureTheory</span><span class=\"bp\">`</span>\n<span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">`</span><span class=\"w\">          </span><span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">ModelTheory</span><span class=\"bp\">`</span>\n<span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">Combinatorics</span><span class=\"bp\">`</span><span class=\"w\">           </span><span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">NumberTheory</span><span class=\"bp\">`</span>\n<span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">Computability</span><span class=\"bp\">`</span><span class=\"w\">           </span><span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">Order</span><span class=\"bp\">`</span>\n<span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">Condensed</span><span class=\"bp\">`</span><span class=\"w\">               </span><span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">Probability</span><span class=\"bp\">`</span>\n<span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">Control</span><span class=\"bp\">`</span><span class=\"w\">             </span><span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">RepresentationTheory</span><span class=\"bp\">`</span>\n<span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">Data</span><span class=\"bp\">`</span><span class=\"w\">                </span><span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">RingTheory</span><span class=\"bp\">`</span>\n<span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">Deprecated</span><span class=\"bp\">`</span><span class=\"w\">              </span><span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">scripts</span><span class=\"bp\">`</span>\n<span class=\"ss\">`f</span><span class=\"bp\">-.</span><span class=\"n\">docker</span><span class=\"bp\">`</span><span class=\"w\">             </span><span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">SetTheory</span><span class=\"bp\">`</span>\n<span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">docs</span><span class=\"bp\">`</span><span class=\"w\">                </span><span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">Tactic</span><span class=\"bp\">`</span>\n<span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">Dynamics</span><span class=\"bp\">`</span><span class=\"w\">                </span><span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">test</span><span class=\"bp\">`</span>\n<span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">FieldTheory</span><span class=\"bp\">`</span><span class=\"w\">             </span><span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">Testing</span><span class=\"bp\">`</span>\n<span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">Geometry</span><span class=\"bp\">`</span><span class=\"w\">                </span><span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">Topology</span><span class=\"bp\">`</span>\n<span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">GroupTheory</span><span class=\"bp\">`</span><span class=\"w\">             </span><span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">Util</span><span class=\"bp\">`</span>\n<span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">InformationTheory</span><span class=\"bp\">`</span><span class=\"w\">           </span><span class=\"ss\">`f</span><span class=\"bp\">-</span><span class=\"n\">widget</span><span class=\"bp\">`</span>\n</code></pre></div>\n<p>that contains modified files?</p>",
        "id": 462367550,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723648781
    },
    {
        "content": "<p>Sounds like it's going to be a lot of noise for not much gain</p>",
        "id": 462367719,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1723648830
    },
    {
        "content": "<p>Ok, so then there is the need to figure out the topic from the PR automatically.</p>",
        "id": 462367838,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723648871
    },
    {
        "content": "<p>I mean you could also keep the topic labels roughly as they are right now and just asign at least one based on the folders modified.<br>\nand put most of the \"random\" folders (like mathport) either into <code>t-meta</code> or ignore them.</p>\n<p>e.g. <code>t-algebra</code> would comprise quite some folders here</p>",
        "id": 462371971,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1723650119
    },
    {
        "content": "<p>I support <code>t-settheory</code> since it always feels weird tagging PRs about ordinals or games with <code>t-logic</code></p>",
        "id": 462389791,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1723656547
    },
    {
        "content": "<p>I guess the latter could be <code>t-combinatorics</code>, but the former is just its own thing</p>",
        "id": 462389843,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1723656570
    },
    {
        "content": "<p>The current <code>t-something</code> labels are <em>not quite</em> identical to the root folders: for instance,</p>\n<ul>\n<li>there are <code>t-euclidean-geometry</code> and <code>t-differential-geometry</code> (which both are subfolders under <code>Geometry</code></li>\n<li>there is <code>t-measure-proabibility</code>, which comprises measure theory and probability (as these are often related)<br>\nI'd rather map to existing labels, than changing the labels to fix into some very simple automatic structure.</li>\n</ul>",
        "id": 462517765,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1723716851
    },
    {
        "content": "<p>The current labels do not cover every folder. We could either</p>\n<ul>\n<li>have an \"uncategorized\" label</li>\n<li>have the bot post \"I couldn't label this, please do so by hand\")</li>\n<li>for some PRs, the folder alone is not sufficiently telling. <code>scripts</code> could be <code>CI</code> or <code>linter</code> (or probably, also something else), and this needs manual inspection.</li>\n</ul>",
        "id": 462518146,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1723716966
    },
    {
        "content": "<p>I think that even having a loose <code>root-dir</code> to <code>t-label</code> correspondence that maybe maps (a subset of) root-dirs to (a subset of) <code>t-label</code>s could potentially be useful (and easy enough to implement).</p>",
        "id": 462530339,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723721035
    },
    {
        "content": "<p>Ok, since we are now thinking about the implementation details; my proposal is to use the following mapping (and then maybe just assign 1 label automatically based on which folder has the most changes):</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>label-to-folder mapping</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<ul>\n<li>t-algebra<ul>\n<li>Algebra</li>\n<li>FieldTheory</li>\n<li>RingTheory</li>\n<li>GroupTheory</li>\n<li>RepresentationTheory</li>\n<li>LinearAlgebra</li>\n</ul>\n</li>\n<li>t-algebraic-geometry<ul>\n<li>AlgebraicGeometry</li>\n<li>Geometry.RingedSpace <del>(and maybe the default for Geometry.* if there's no better place?)</del></li>\n</ul>\n</li>\n<li>t-euclidean-geometry<ul>\n<li>Geometry.Euclidean</li>\n</ul>\n</li>\n<li>t-differential-geometry<ul>\n<li>Geometry.Manifold</li>\n</ul>\n</li>\n<li>t-analysis<ul>\n<li>Analysis</li>\n</ul>\n</li>\n<li>t-category-theory<ul>\n<li>CategoryTheory</li>\n</ul>\n</li>\n<li>t-combinatorics<ul>\n<li>Combinatorics</li>\n</ul>\n</li>\n<li>t-computability<ul>\n<li>Computability</li>\n</ul>\n</li>\n<li>t-condensed<ul>\n<li>Condensed</li>\n</ul>\n</li>\n<li>t-data<ul>\n<li>Data</li>\n</ul>\n</li>\n<li>t-dynamics<ul>\n<li>Dynamics</li>\n</ul>\n</li>\n<li>t-linter<ul>\n<li>Tactic.Linter</li>\n</ul>\n</li>\n<li>t-logic<ul>\n<li>SetTheory (--&gt; create a new <code>t-set-theory</code>)</li>\n<li>Logic</li>\n<li>ModelTheory</li>\n<li><del>InformationTheory</del></li>\n</ul>\n</li>\n<li>t-measure-probability<ul>\n<li>MeasureTheory</li>\n<li>Probability</li>\n<li><em>InformationTheory</em></li>\n</ul>\n</li>\n<li>t-meta<ul>\n<li>Tactic (without Tactic.Linter)</li>\n<li>Lean</li>\n<li>Init</li>\n<li>Util</li>\n<li>Mathport</li>\n<li>Control</li>\n<li>Testing</li>\n</ul>\n</li>\n<li>t-number-theory<ul>\n<li>NumberTheory</li>\n</ul>\n</li>\n<li>t-order<ul>\n<li>Order</li>\n</ul>\n</li>\n<li>\n<p>t-topology</p>\n<ul>\n<li>Topology</li>\n<li>AlgebraicTopology</li>\n</ul>\n</li>\n<li>\n<p>ignored:</p>\n<ul>\n<li>Deprecated</li>\n<li><em>other Geometry._</em></li>\n</ul>\n</li>\n</ul>\n</div></div>",
        "id": 462530813,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1723721246
    },
    {
        "content": "<p>Sounds very good. One small suggestion:<br>\nI would rather say \"unknown\" for Geometry.* by default. There's a PR adding <code>HyperbolicGeometry</code>, which is most definitely not <code>t-algebraic-geometry</code>.</p>",
        "id": 462531039,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1723721339
    },
    {
        "content": "<p>I am happy with the suggestion: a first attempt might even be more conservative and apply a label only when a single label is valid, before looking for more heuristics.</p>",
        "id": 462531063,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723721350
    },
    {
        "content": "<p>So, the bot would just add a single label and only when a single label applies.</p>",
        "id": 462531115,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723721382
    },
    {
        "content": "<p>Looks nice, but why is information theory under logic? I think it should be under combinatorics (or maybe probability?)</p>",
        "id": 462587740,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1723739091
    },
    {
        "content": "<p>Information theory should definitely be under the same label as probability.</p>",
        "id": 462589943,
        "sender_full_name": "Frédéric Dupuis",
        "timestamp": 1723739665
    },
    {
        "content": "<p>updated the list above, thanks for looking at it</p>",
        "id": 462591688,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1723740374
    },
    {
        "content": "<p>Let's see if this works!  <a href=\"https://github.com/leanprover-community/mathlib4/pull/15848\">#15848</a></p>",
        "id": 462611360,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723746075
    },
    {
        "content": "<p>You can see the tests at <a href=\"https://github.com/leanprover-community/mathlib4/pull/15849\">#15849</a>.</p>",
        "id": 462613027,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723746507
    },
    {
        "content": "<p>The test PR shows:</p>\n<ul>\n<li>add a new file in <code>Analysis</code> and the bot adds the label <code>t-analysis</code> (which I then remove);</li>\n<li><em>move</em> the new file to <code>AlgebraicGeometry</code> and the bot adds the label <code>t-algebraic-geometry</code> (which I then remove);</li>\n<li>finally duplicate the new file in the two folders and the bot does nothing, since there isn't a single option.</li>\n</ul>\n<p>Looking at the PR, you can also see that when there is no label with the given modifications, then the bot also does nothing.</p>",
        "id": 462614051,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723746827
    },
    {
        "content": "<p>I'm not sure if mapping <code>Init</code> to <code>t-meta</code> makes sense: I'd rather leave that unmapped and print a \"I don't know\" notice.</p>",
        "id": 462622659,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1723749987
    },
    {
        "content": "<p>I left a few comments on the script: I'd need more time to wrap my head around the awk/looking over that part would be appreciated.</p>",
        "id": 462625924,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1723751048
    },
    {
        "content": "<p>After thinking about this a bit, the only external input to the script is the output of <code>git diff</code>: I'm probably going to reimplement the action in lean tomorrow, so no need to look at the <code>awk</code> part.</p>",
        "id": 462636191,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723754208
    },
    {
        "content": "<p>I re-implemented the label-adding script (mostly) in Lean: all the decision of which labels are applicable is done in Lean.  However, actually applying the label to the PR in a workflow is done by a small amount of bash-glue.</p>",
        "id": 463197561,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723997376
    },
    {
        "content": "<p>As is, the PR is already long, even though there are approximately about 100 lines of actual code: the rest is documentation, tests, the CI action and the actual labels mentioned above.</p>",
        "id": 463197739,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723997448
    },
    {
        "content": "<p>I think that a huge improvement over the shell script is the potential for extensibility and maintainability of the Lean code.</p>",
        "id": 463197825,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723997483
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span> you introduced</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">scripts</span><span class=\"bp\">/</span><span class=\"n\">autolabel</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">following</span><span class=\"w\"> </span><span class=\"n\">paths</span><span class=\"w\"> </span><span class=\"n\">inside</span><span class=\"w\"> </span><span class=\"ss\">`Mathlib</span><span class=\"bp\">/`</span><span class=\"w\"> </span><span class=\"n\">are</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">covered</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">any</span><span class=\"w\"> </span><span class=\"n\">label</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Geometry</span><span class=\"bp\">/</span><span class=\"n\">Group</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Please</span><span class=\"w\"> </span><span class=\"n\">modify</span><span class=\"w\"> </span><span class=\"ss\">`AutoLabel.mathlibLabels</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">accordingly!</span>\n</code></pre></div>\n<p>warnings on every PR</p>",
        "id": 489857735,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1734563601
    },
    {
        "content": "<p>Uh oh! I am already asleep, but I can have a look tomorrow</p>",
        "id": 489857947,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1734563737
    },
    {
        "content": "<p>FWIW I don't know what label I would give. Geometric group theory is not quite geometry, it's not quite algebra either. Maybe it should be a new label?</p>",
        "id": 489858093,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1734563815
    },
    {
        "content": "<p>How did this happen? Is there some new top-level dir?</p>",
        "id": 489925859,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1734602688
    },
    {
        "content": "<p>No, it's a new second level dir</p>",
        "id": 489925952,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1734602718
    },
    {
        "content": "<p>Oh, this is one of the tests that checks whether every dir is accounted for, whether explicitly labeled or explicitly ignored.</p>",
        "id": 489926157,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1734602780
    },
    {
        "content": "<p>Hmm, so we need a CI check that helps us not merge PRs that break that check</p>",
        "id": 489926339,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1734602850
    },
    {
        "content": "<p>Rather than failing CI, maybe we can add a label such as <code>adds-dir</code>?</p>",
        "id": 489926491,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1734602895
    },
    {
        "content": "<p>perhaps this can hitch off of the decl-diff CI?</p>",
        "id": 489926498,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1734602899
    },
    {
        "content": "<p>Yeah, why is that on the PR CI at all?</p>",
        "id": 489926660,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1734602959
    },
    {
        "content": "<p>It's rare enough that a non-covered folder is created (this is literally the first time, right?) that it could be a weekly check instead, like leanchecker</p>",
        "id": 489926807,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1734603004
    },
    {
        "content": "<blockquote>\n<p>you introduced</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">scripts</span><span class=\"bp\">/</span><span class=\"n\">autolabel</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">following</span><span class=\"w\"> </span><span class=\"n\">paths</span><span class=\"w\"> </span><span class=\"n\">inside</span><span class=\"w\"> </span><span class=\"ss\">`Mathlib</span><span class=\"bp\">/`</span><span class=\"w\"> </span><span class=\"n\">are</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">covered</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">any</span><span class=\"w\"> </span><span class=\"n\">label</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Geometry</span><span class=\"bp\">/</span><span class=\"n\">Group</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Please</span><span class=\"w\"> </span><span class=\"n\">modify</span><span class=\"w\"> </span><span class=\"ss\">`AutoLabel.mathlibLabels</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">accordingly!</span>\n</code></pre></div>\n<p>warnings on every PR</p>\n</blockquote>\n<p>If this is the consequence of merging a PR, then I think we should really have a check that fails CI.</p>",
        "id": 489926826,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1734603012
    },
    {
        "content": "<p>The check is done as a part of the autolabel script, that runs once a PR is open.</p>",
        "id": 489926828,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1734603013
    },
    {
        "content": "<p>Because then suddenly x00 PRs get warnings, and actually they shouldn't need to do anything</p>",
        "id": 489926934,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1734603054
    },
    {
        "content": "<p>My claim is that the warnings should not be on the PRs at all, but rather posted somewhere on Zulip</p>",
        "id": 489927021,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1734603088
    },
    {
        "content": "<p>Ok, I think that I was a little skeptical about the check when Jon introduced it, but seeing it working now, it is very easy to miss the introduction of a new dir and hence of possible auto-labels.</p>",
        "id": 489927028,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1734603091
    },
    {
        "content": "<p>This check does nothing to improve the quality of _mathlib_. Instead it does something to improve the quality of reviewing PRs</p>",
        "id": 489927198,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1734603132
    },
    {
        "content": "<p>I also see Yaël's point: the decision of what label to assign to a newly created dir may not be in scope for the creation of the dir, although this is not so clear.</p>",
        "id": 489927238,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1734603152
    },
    {
        "content": "<p>The options so far seem to be:</p>\n<ul>\n<li>make CI fail if a new dir is created and no label applies to it;</li>\n<li>add a label to PRs that add an unlabeled dir;</li>\n<li>post on Zulip when a PR adds an unlabeled dir.</li>\n</ul>\n<p>Anything else?</p>",
        "id": 489927592,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1734603271
    },
    {
        "content": "<ul>\n<li>Move the check to a separate CI workflow that runs once a week. The reviewer team can then create a PR to update the auto-labeler.</li>\n</ul>",
        "id": 489928154,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1734603463
    },
    {
        "content": "<p>Should we poll?  I think that my preference is to make CI fail and get the addition of the dir also come with a choice of auto-label.</p>",
        "id": 489928315,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1734603506
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Auto-label.20PR.20topics/near/489928154\">said</a>:</p>\n<blockquote>\n<ul>\n<li>Move the check to a separate CI workflow that runs once a week. The reviewer team can then create a PR to update the auto-labeler.</li>\n</ul>\n</blockquote>\n<p>that option still causes the warning on open PRs when the \"bad\" PR is merged, no?</p>",
        "id": 489928363,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1734603522
    },
    {
        "content": "<p>After all, a PR adding a dir should not be doing much else and taking care of recreating a good working environment seems in scope.</p>",
        "id": 489928432,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1734603549
    },
    {
        "content": "<p>so maybe a \"nolint\" approach to silencing that might be good</p>",
        "id": 489928477,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1734603568
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Auto-label.20PR.20topics/near/489928363\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Auto-label.20PR.20topics/near/489928154\">said</a>:</p>\n<blockquote>\n<ul>\n<li>Move the check to a separate CI workflow that runs once a week. The reviewer team can then create a PR to update the auto-labeler.</li>\n</ul>\n</blockquote>\n<p>that option still causes the warning on open PRs when the \"bad\" PR is merged, no?</p>\n</blockquote>\n<p>I think that the proposal is to not perform the check in regular CI, but only perform the check once a week on master.</p>",
        "id": 489928536,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1734603588
    },
    {
        "content": "<p>I don't really care which option. As long as other PRs don't have to worry about the new dir, and don't see warnings about it.</p>",
        "id": 489928698,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1734603630
    },
    {
        "content": "<p>Since this is not something that happens very often, how about we implement the \"CI fails if an unlabeled dir is created\" and the next time that this happens, we review our decision, in case we dislike it?</p>",
        "id": 489929307,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1734603827
    },
    {
        "content": "<p>Fine with me</p>",
        "id": 489931349,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1734604542
    },
    {
        "content": "<p>Should the label be a new <code>t-geometric-group-theory</code> label?</p>",
        "id": 489931640,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1734604635
    },
    {
        "content": "<p>That was my suggestion as well <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span> <span aria-label=\"point down\" class=\"emoji emoji-1f447\" role=\"img\" title=\"point down\">:point_down:</span> <br>\n<span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Auto-label.20PR.20topics/near/489858093\">said</a>:</p>\n<blockquote>\n<p>FWIW I don't know what label I would give. Geometric group theory is not quite geometry, it's not quite algebra either. Maybe it should be a new label?</p>\n</blockquote>",
        "id": 489931758,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1734604682
    },
    {
        "content": "<p>First, the simple fix: <a href=\"https://github.com/leanprover-community/mathlib4/pull/20061\">#20061</a> makes autolabel aware of <code>geometric-group-theory</code>.</p>",
        "id": 489932709,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1734604997
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Auto-label.20PR.20topics/near/489931640\">said</a>:</p>\n<blockquote>\n<p>Should the label be a new <code>t-geometric-group-theory</code> label?</p>\n</blockquote>\n<p>I feel like this is way too specific - we don't have, for example, <code>algebraic-number-theory</code>, or <code>analytic-number-theory</code></p>",
        "id": 489969029,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1734616300
    },
    {
        "content": "<p>No, and as a result I have to label all my algebraic number theory PRs as <code>t-algebra</code> <em>and</em> <code>t-number-theory</code></p>",
        "id": 489976950,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1734618850
    },
    {
        "content": "<p>Given that now the auto-labelling has been tested and seems to be working well, we can revise the decision to either add more than one label, or expand the pool of <code>t-</code> labels (or both!).</p>",
        "id": 489977135,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1734618934
    },
    {
        "content": "<p>To me it makes perfect sense that as different/more advanced material gets formalized that the subject labels should adapt.</p>",
        "id": 489977344,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1734619003
    },
    {
        "content": "<p>The current number theory hack suggests that Yael should be labelling their PRs <code>t-geometry</code> and <code>t-group-theory</code> but I think that expanding the list of labels is probably a more sensible reaction?</p>",
        "id": 489977487,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1734619069
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Auto-label.20PR.20topics/near/489976950\">said</a>:</p>\n<blockquote>\n<p>No, and as a result I have to label all my algebraic number theory PRs as <code>t-algebra</code> and <code>t-number-theory</code></p>\n</blockquote>\n<p>So you're claiming it should exist? Interesting. What is the cost of having many labels? Is it just that people might miss relevant labels?</p>",
        "id": 489977492,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1734619070
    },
    {
        "content": "<p>I'm just saying that already our system is a bit weird here. Note that the t-number theory description explicitly asks people to do this.</p>",
        "id": 489977596,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1734619099
    },
    {
        "content": "<p>The <code>t-geometric-group-theory</code> label and autolabel has been merged, so, going forwards, we should decide whether we like to have more and more descriptive label, or we should stick to few labels and mix and match.</p>",
        "id": 489979678,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1734619785
    },
    {
        "content": "<p>I personally have a preference for more descriptive labels, as I do not really think that there is a cost to having many labels and scanning through the PRs I find it more useful to read <code>algebraic-number-theory</code>, than the combination of <code>algebra</code> and <code>number-theory</code>.</p>",
        "id": 489979948,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1734619869
    },
    {
        "content": "<p>If, conversely, combining fewer labels is preferred, then I also think that the autolabelling should be allowed to add multiple labels.</p>",
        "id": 489980244,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1734619963
    },
    {
        "content": "<p>Is it still true that PRs with not exactly one <code>t-something</code> label will show up in the \"generic\" thread (on mathlib reviewers) when maintainer merged/delegated? This is the reason why I stopped adding <code>t-algebra</code> or <code>t-analysis</code> to my number theory related PRs.</p>",
        "id": 490006916,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1734626797
    },
    {
        "content": "<p>Yes, this is still true: all the autolabel automation revolves around the underlying assumption that there is a single applicable label.  As soon as there is more than one, PRs are treated as \"generic\".</p>",
        "id": 490017777,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1734629948
    },
    {
        "content": "<p>This decision was taken to avoid making autolabels too intrusive.</p>",
        "id": 490017855,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1734629992
    },
    {
        "content": "<p>However, to me it looks like they are working well and the scope could be extended.</p>",
        "id": 490017940,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1734630016
    },
    {
        "content": "<p>Partly prompted by <a class=\"stream\" data-stream-id=\"455414\" href=\"/#narrow/channel/455414-Infinity-Cosmos\">#Infinity-Cosmos</a>, I wonder if there are any improvements/changes that would be desired for the auto-label action.</p>",
        "id": 495236158,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1737538448
    },
    {
        "content": "<p>I personally find that it works well, but there are several projects downstream of mathlib (e.g. <a class=\"stream\" data-stream-id=\"455414\" href=\"/#narrow/channel/455414-Infinity-Cosmos\">#Infinity-Cosmos</a> , but also <a class=\"stream\" data-stream-id=\"458659\" href=\"/#narrow/channel/458659-Equational\">#Equational</a>, <a class=\"stream\" data-stream-id=\"416277\" href=\"/#narrow/channel/416277-FLT\">#FLT</a>, <a class=\"stream\" data-stream-id=\"442935\" href=\"/#narrow/channel/442935-Carleson\">#Carleson</a>, <a class=\"stream\" data-stream-id=\"423402\" href=\"/#narrow/channel/423402-PrimeNumberTheorem.2B\">#PrimeNumberTheorem+</a> and others that do not necessarily have a dedicated Zulip channel) that may benefit from having some form of autolabel applied to mark PRs as \"coming from\" that specific project.</p>",
        "id": 495236171,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1737538451
    },
    {
        "content": "<p>Should there be some discussion of whether an automatic labelling of such PRs is a good idea and, if so, how to make the bot pick up such PRs?</p>",
        "id": 495236172,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1737538453
    },
    {
        "content": "<p>Here is a proposal: the auto-label bot stays as is and manages the <code>t-topic</code> labels with its current logic.</p>\n<p>A <em>separate</em> action is triggered by some catch-phrase in the PR description and, based on that, applies a (probably not <code>t-topic</code>) label to the PR.</p>\n<p>So, we could have</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>PR<span class=\"w\"> </span>XXX\nWe<span class=\"w\"> </span>improve<span class=\"w\"> </span>the<span class=\"w\"> </span>API<span class=\"w\"> </span>around<span class=\"w\"> </span>enriched<span class=\"w\"> </span>categories.\n\nProject:<span class=\"w\"> </span>Infinity-cosmos\n</code></pre></div>\n<p>and the bot sees <code>Project: Infinity-cosmos</code> and adds a further label, on top of whatever <code>t-topic</code> label it would have applied already.</p>",
        "id": 495237800,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1737538928
    },
    {
        "content": "<p>isn't writing <code>Project: Infinity-cosmos</code> just as much effort as manually adding the label though? Or is the idea that a standardised <code>Project:</code> in the commit message helps people analysing how many commits were made from a specific project?</p>",
        "id": 495239427,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1737539436
    },
    {
        "content": "<p>Yes, <code>Project</code> would be the catch-phrase for the bot that can be reused for each project.  I agree that it is as much work as adding the label, but it would also help to have a standardized way of marking a PR in the PR description.</p>",
        "id": 495240177,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1737539663
    },
    {
        "content": "<p>An alternative would be that adding the label for a project edits the PR description and writes <code>Project: whatever</code>!</p>",
        "id": 495240358,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1737539718
    },
    {
        "content": "<p>Also, as a personal comment, I find it easier to remember about adding stuff to the PR description than later remembering about labels.</p>",
        "id": 495241014,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1737539912
    },
    {
        "content": "<p>So, for me, writing a comment in the PR description that triggers the label is a safer way to ensure that the label gets added.</p>",
        "id": 495241016,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1737539913
    },
    {
        "content": "<p>Maybe it was just a random glitch, but the auto-label run just failed on <a href=\"https://github.com/leanprover-community/mathlib4/pull/23207\">#23207</a>: <a href=\"https://github.com/leanprover-community/mathlib4/actions/runs/14000264140/job/39204909640?pr=23207\">https://github.com/leanprover-community/mathlib4/actions/runs/14000264140/job/39204909640?pr=23207</a></p>\n<p>For what it's worth, I had already applied the CI label to the PR when I created it.</p>\n<p><strong>edit</strong>: oddly enough, the run above, which was triggered by the \"push\" event failed, but there was also a run triggered by \"pull_request\" that succeeded: <a href=\"https://github.com/leanprover-community/mathlib4/actions/runs/14000463302/job/39205512624?pr=23207\">https://github.com/leanprover-community/mathlib4/actions/runs/14000463302/job/39205512624?pr=23207</a></p>",
        "id": 507364029,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1742589780
    },
    {
        "content": "<p>Just from reading your message I would guess that on \"push\" it fails because it gets no (or an invalid) PR number to apply the label to.</p>\n<p>I think you could (A) check the script is really supposed to run on that initial \"push\" - probably it's not? - and (b) add some test which actually verifies the PR number is valid and only tries to apply the labels if so</p>",
        "id": 507370608,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1742592450
    },
    {
        "content": "<p>i think the script is supposed to run only on PR creation plus when the scrip's Lean file itself has been modified.</p>\n<p>Sorry I'm not on the computer, would check myself otherwise</p>",
        "id": 507370879,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1742592556
    },
    {
        "content": "<p>Thanks! I would have thought if that was the case more people would have run into this, but maybe I'm just the first to complain... I'll also see if I can check later.</p>",
        "id": 507372171,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1742593195
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"123965\">@Bryan Gin-ge Chen</span> we use reviewdog, right? We must rotate all secrets immediately!</p>",
        "id": 507401336,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1742611376
    },
    {
        "content": "<p>(And maybe buy a plan from StepSecurity)</p>",
        "id": 507401565,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1742611543
    },
    {
        "content": "<p>(<a href=\"https://github.com/reviewdog/reviewdog/security/advisories/GHSA-qmg3-hpqr-gqvc\">security advisory</a>) I'm investigating <code>@reviewdog/action-suggester</code> now - it isn't reported as a compromised package, but an initial search reveals that the action does depend on the compromised repository in its installation script.</p>",
        "id": 507403247,
        "sender_full_name": "Tristan Figueroa-Reid",
        "timestamp": 1742612856
    },
    {
        "content": "<p><a href=\"https://github.com/reviewdog/action-suggester/commit/f15869749549df04613f2d4ea896d871c7808f33\">It is likely that <code>mathlib4</code> was compromised if @reviewdog/reviewdog as a repository was compromised.</a></p>",
        "id": 507403383,
        "sender_full_name": "Tristan Figueroa-Reid",
        "timestamp": 1742612973
    },
    {
        "content": "<p>Where's a maintainer to help us?</p>",
        "id": 507403666,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1742613181
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"767695\">Tristan Figueroa-Reid</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Auto-label.20PR.20topics/near/507403383\">said</a>:</p>\n<blockquote>\n<p><a href=\"https://github.com/reviewdog/action-suggester/commit/f15869749549df04613f2d4ea896d871c7808f33\">It is likely that <code>mathlib4</code> was compromised if @reviewdog/reviewdog as a repository was compromised.</a></p>\n</blockquote>\n<p>The if here might be false! Taking a look at wiz's writeup, <a href=\"https://github.com/reviewdog/action-setup/commit/f0d342\">the malicious commit in question</a> did not affect the reviewdog installation script <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span></p>",
        "id": 507403764,
        "sender_full_name": "Tristan Figueroa-Reid",
        "timestamp": 1742613249
    },
    {
        "content": "<p>But still, better buy that enterprise plan</p>",
        "id": 507403832,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1742613319
    },
    {
        "content": "<p>Of course, this depends on whether that was the only malicious commit in <code>reviewdog</code>. It seems that while it is still a good idea to rotate secrets in case of insufficient investigation on the reviewdog's part, it isn't urgent.</p>",
        "id": 507403847,
        "sender_full_name": "Tristan Figueroa-Reid",
        "timestamp": 1742613338
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"598052\">Jeremy Tan</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Auto-label.20PR.20topics/near/507403832\">said</a>:</p>\n<blockquote>\n<p>But still, better buy that enterprise plan</p>\n</blockquote>\n<p>As far as I know, any report officially integrated with GitHub's security reporting system should give a security alert in any associated repository.</p>",
        "id": 507403863,
        "sender_full_name": "Tristan Figueroa-Reid",
        "timestamp": 1742613354
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/gPyHfTErlTPqSHU_DpYvzJyF/image.png\">image.png</a><br>\n(An example of one of my personal repositories)</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/gPyHfTErlTPqSHU_DpYvzJyF/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1417x441\" src=\"/user_uploads/thumbnail/3121/gPyHfTErlTPqSHU_DpYvzJyF/image.png/840x560.webp\"></a></div>",
        "id": 507403951,
        "sender_full_name": "Tristan Figueroa-Reid",
        "timestamp": 1742613410
    },
    {
        "content": "<p>I am partially annoyed by <code>reviewdog</code> here because if they tagged all of their vulnerable repositories with the security advisory, it would have alerted everyone who was using said vulnerable repository rather than just their parent repository.</p>",
        "id": 507404084,
        "sender_full_name": "Tristan Figueroa-Reid",
        "timestamp": 1742613527
    },
    {
        "content": "<p>This is possibly the next Solarwinds, we have to take action immediately</p>",
        "id": 507404588,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1742614007
    },
    {
        "content": "<p>Hi, thanks for the ping. First, based on the results of <a href=\"https://github.com/search?q=org%3Aleanprover-community++%28reviewdog%2Faction-setup%40v1+OR+reviewdog%2Faction-shellcheck+OR+reviewdog%2Faction-composite-template+OR+reviewdog%2Faction-staticcheck+OR+reviewdog%2Faction-ast-grep+OR+reviewdog%2Faction-typos%29+AND+secrets.+language%3Ayaml+path%3A%2F%5E%5C.github%5C%2Fworkflows%5C%2F%2F&amp;type=code\">the GitHub query</a> provided in <a href=\"https://www.wiz.io/blog/new-github-action-supply-chain-attack-reviewdog-action-setup#which-actions-should-security-teams-take-17\">the security advisory</a>, it looks like there's no evidence that we were affected at this time. </p>\n<p>However, out of an abundance of caution, I have disabled all of our workflows that use reviewdog actions temporarily while we review logs to make sure that none of our keys were exposed. We'll also look into rotating our secrets ASAP as well.</p>",
        "id": 507407278,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1742616429
    }
]