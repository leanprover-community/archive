[
    {
        "content": "<p>I think it might be worth reorganizing the contents of Mathlib/Lean/, or at least setting up stronger guidance on what should be where. Most of the content there extends the meta API, and so I'd also like to discuss here how we organize the meta API in mathlib in general.</p>\n<p>I found this relevant thread from 2022: <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/Mathlib.2FLean.2F.20vs.20Mathlib.2FUtil.2F/with/290977142\">#mathlib4 &gt; Mathlib/Lean/ vs Mathlib/Util/</a>; Kim says of Mathlib/Lean:</p>\n<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Mathlib.2FLean.2F.20vs.20Mathlib.2FUtil.2F/near/290976103\">said</a>:</p>\n<blockquote>\n<p>My attempt:</p>\n<ul>\n<li><code>Mathlib/Lean/</code>: should contain helper functions which live in the <code>Lean</code> namespace, and add functionality (or merely dot-notation) to things defined in core Lean 4. In some sense this is a <code>for_core</code> directory, containing only definitions which are reasonable candidates for moving to the core library.</li>\n</ul>\n</blockquote>\n<p>I think it might be useful to come down on one of these properties or another. Sometimes we want something in the <code>Lean</code> namespace, but are not seriously considering upstreaming to core. Likewise, it might make sense to organize/declare the serious upstreaming candidates somehow.</p>\n<p>Are there any other guidelines documenting the intentions for these folders, or any other relevant discussions?</p>\n<p>Here are a couple of issues with the current state of affairs:</p>\n<ul>\n<li>\n<p>We have a couple of different ways to create locations for files, it seems:</p>\n<ul>\n<li>we have standalone files like <code>Mathlib.Lean.Name</code> which start with a header of the form \"Additional functions on <code>Lean.Name</code>\"</li>\n<li>we also attempt to mirror the directory structure for core to some extent, and locate our new declarations in the file it \"would\" be in. But this latter principle is only loosely enforced; <code>Mathlib.Lean.Meta.Basic</code> imports <code>Lean.Meta.AppBuilder</code>, whereas the dependency goes in the other direction in Lean core (<code>Lean.Meta.AppBuilder</code> imports <code>Lean.Meta.Basic</code>).</li>\n<li>we have some scattered meta API in Mathlib/Util, such as <code>Mathlib.Util.Tactic</code> which contains only meta API declarations on modifying the local context. We also have some commands which are imported by <code>Mathlib.Tactic.Common</code> like <code>whatsnew</code>, and some which are more generally applicable, like <code>notation3</code>.</li>\n</ul>\n</li>\n<li>\n<p>It's easy for these files to get out of date, too: <code>Mathlib.Lean.LocalContext</code> is now only imported by <code>Mathlib.lean</code> itself.</p>\n</li>\n<li>\n<p>It's not always easy to access these when metaprogramming; ideally, all (theory-free) additions to the meta API could be imported all at once, at least during editing.</p>\n</li>\n</ul>\n<p>Mario says of Mathlib/Util/:<br>\n<span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Mathlib.2FLean.2F.20vs.20Mathlib.2FUtil.2F/near/290976994\">said</a>:</p>\n<blockquote>\n<p><code>Util</code> is more for tactics that are not intended for the usual proving stuff but are either meta-programming tools like <code>TermUnsafe</code> and <code>MemoFix</code> or debugging commands like <code>#time</code></p>\n</blockquote>\n<p>Which makes sense to me, but it might be worth pinning Util down a bit more.</p>\n<ul>\n<li>Should <code>Util</code>s be imported in low-down files like <code>Mathlib.Tactic.Common</code>?</li>\n<li>When is something a <code>Util</code>, and when is it just a command in <code>Mathlib.Tactic</code>?</li>\n<li>Do we want extensions to the meta API to be in <code>Util</code>? If so, which go in Mathlib/Util, which in Mathlib/Lean, and which in Mathlib/Tactic?</li>\n</ul>\n<hr>\n<p>Generally, I think it makes sense to ask ourselves what purpose we want to serve by whatever organization scheme we use. That is, which should we prioritize, and to what extent?</p>\n<ul>\n<li>discoverability/accessibility of utilities when metaprogramming in mathlib</li>\n<li>ease of upstreaming to core</li>\n<li>providing a (simple|broad|predictable|?) meta API</li>\n<li>something else?</li>\n</ul>\n<p>Thoughts? :)</p>",
        "id": 544246511,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1760129998
    },
    {
        "content": "<p>How many files are we talking about? I was under the impression that Mathlib.Lean and Mathlib.Util both contain very few files (10-20 in total?)</p>",
        "id": 544289573,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1760159915
    },
    {
        "content": "<p>I'm counting 31 <code>.lean</code> files in Mathlib/Lean/, 30 in Mathlib/Util/. It's (ostensibly) a home for meta API, so I'd like it to be nicely organized regardless of the absolute quantity! :)</p>\n<p>(I'm also thinking about the process of deciding where to put meta API during review/contribution; it would be nice to have this be a little more purposeful.)</p>",
        "id": 544290023,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1760160477
    }
]