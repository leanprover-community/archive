[
    {
        "content": "<p>When <code>@[simps]</code> generates lemmas abut <code>symm</code> it <em>appends</em> <code>symm</code>, as in, <code>foo_symm_apply</code> or <code>foo_symm</code>. However, this essentially treats <code>symm</code> as if it were an infix operator, but it's not. Moreover, when we write lemmas about <code>symm</code> by hand, we (try to) express <code>foo.symm</code> as <code>symm_foo</code> in the declaration name because that's our rule for dot notation.</p>\n<p>What do we want to do about this? I think the discrepancy causes inconsistency across the library, even in lemmas named manually, whether they correspond to <code>simps</code> lemmas or not.</p>",
        "id": 553667635,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1762275626
    },
    {
        "content": "<p>It is possible to change this in <code>@[simps]</code>, with e.g. <code>initialize_simps_projections Equiv (as_prefix symm)</code>, so it is purely a question what we want the naming to be.<br>\nI write <code>Equiv.symm e</code> usually using projection notation, i.e. <code>e.symm</code> and so far we have not made firm rules whether such names should be written as prefix or as postfix.</p>",
        "id": 553685130,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1762280202
    },
    {
        "content": "<p>I must say that I've gotten very used to <code>foo_apply</code> and <code>foo_symm_apply</code>, and that changing it will be a big change.</p>",
        "id": 553685406,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1762280277
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"197836\">Jireh Loreaux</span> <a href=\"#narrow/channel/287929-mathlib4/topic/naming.20convention.3A.20.60symm.60.20in.20lemmas.20generated.20by.20.60.40.5Bsimps.5D.60/near/553667635\">said</a>:</p>\n<blockquote>\n<p>we (try to) express <code>foo.symm</code> as <code>symm_foo</code> in the declaration name because that's our rule for dot notation.</p>\n</blockquote>\n<p>Have we made this into a firm rule by now?</p>",
        "id": 553685496,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1762280302
    },
    {
        "content": "<p>I thought this was pretty much decided, yes.</p>",
        "id": 553685627,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1762280352
    },
    {
        "content": "<p>(Note that we could also have <code>@[simps]</code> generate the old naming as an alias and tag it as deprecated in favor of the new naming, so that this change is no worse than deprecating a bunch of lemmas :) )</p>",
        "id": 553685647,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1762280358
    },
    {
        "content": "<blockquote>\n<p>I thought this was pretty much decided, yes.</p>\n</blockquote>\n<p>Is this true? </p>\n<p>As in, yes in general dot notations do not affect naming conventions but there are some exceptions in practice. In particular, the <code>.symm</code> I see are almost always treated as suffixes. Do we have a consensus in this particular case?</p>",
        "id": 553702570,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1762286513
    },
    {
        "content": "<p>I think given we have an exception for <code>_injective</code> we could also have one for <code>symm</code></p>",
        "id": 553732240,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1762297346
    },
    {
        "content": "<p>Note that there are quite a lot of exceptions to \"dot notation is prefix\" in practice, some because of <code>simps</code> and many predating it, eg <code>Functor.obj</code> and <code>Functor.map</code> are always written \"infix\". Looking through mathlib, it certainly seems that the vast majority of hand-written lemmas about <code>foo.symm</code> are named <code>foo_symm</code>; and of course the [simps]-generated ones are written this way too, out of the first 50 files which contained \"symm_\" I looked at, I could only find two where the \"prefix rule\" was ever followed, and the first 200 searches in loogle for \"symm_\" are almost all actually using it as a suffix, with <code>symm_mk</code> cases as the only exceptions.</p>\n<p>Based on the patterns used in practice in mathlib, and the fact that dot notation is here to stay, I think we should reconsider if prefix-only should really be applied in every case.</p>",
        "id": 553762433,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1762317082
    },
    {
        "content": "<p>I think you'll find that there are a bunch of inconsistencies. In particular, I think that the simp lemmas involving <code>Equiv.toWeakerEquiv.symm</code> are mostly named with prefix notation. </p>\n<p>So, my primary issue with making <code>symm</code> an exception is that ... it's an exception. It's one more extra rule to remember. If we had a reasonably reliable automatic declaration naming tool into which we could program all these exceptions, then this wouldn't be so much of a problem, but we don't.</p>\n<p>But admittedly, I think <code>symm</code> makes more sense as an exception than <code>injective</code>.</p>",
        "id": 553764649,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1762318828
    },
    {
        "content": "<p>I don't disagree that there are inconsistencies, but I think they are proportionally very rare: every search I can think to do shows overwhelming majority for suffix notation. For instance, lemmas about <code>MulEquiv.symm</code>, especially those coercing to Equiv first, use suffix notation on the whole: <a href=\"https://loogle.lean-lang.org/?q=Equiv.symm%2C+MulEquiv%2C+%22symm%22\">https://loogle.lean-lang.org/?q=Equiv.symm%2C+MulEquiv%2C+%22symm%22</a>, whereas looking at a pattern which I think captures what you describe only shows a small number of examples: <a href=\"https://loogle.lean-lang.org/?q=%22.symm_%22%2C+Equiv.symm+_+%3D+_\">https://loogle.lean-lang.org/?q=%22.symm_%22%2C+Equiv.symm+_+%3D+_</a>. But maybe I'm misunderstanding what you mean? I'd be very interested to see figures backing up some of these claims.</p>\n<blockquote>\n<p>If we had a reasonably reliable automatic declaration naming tool into which we could program all these exceptions, then this wouldn't be so much of a problem, but we don't.</p>\n</blockquote>\n<p>I would argue that <code>@[simps]</code> is this naming tool! <br>\nMy preference is that we should name according to the order the pretty-printer displays things, since this is closer to left-to-right, easier for beginners, and closer to what mathlib mostly does already, especially for projections.</p>",
        "id": 553766717,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1762320263
    },
    {
        "content": "<p>I think our life would be much simpler if we had no exception. Dot notation is a function application, so I'd put it in the usual way we write function applications, i.e., to the left, with prefix notation. And I'd be very very happy to kill the exceptions we have for monotone, injective and friends, for which I don't see any good reason.</p>",
        "id": 553787580,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1762330102
    },
    {
        "content": "<p>I also think that \"I am used to X\" is a weak argument for not changing X -- for example I was used to Lean 3's capitalisation conventions but nobody was arguing that we should keep them in mathlib4.</p>",
        "id": 553847292,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1762347394
    },
    {
        "content": "<p>Bhavik, I will certainly admit that postfix <code>symm</code> is more prevalent, especially due to <code>simps</code>. And yes, <code>simps</code> can be used to help with consistency, but it doesn't satisfy my requirements because we still manually name lemmas not generated by it. </p>\n<p>But the question is not, \"what do we currently do?\", it's \"what should we do?\". And, like <span class=\"user-mention silent\" data-user-id=\"110050\">S√©bastien Gou√´zel</span>, I would prefer if we had no exceptions.</p>",
        "id": 553857043,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1762349944
    },
    {
        "content": "<p>But to give an example of what I meant: we have <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ContinuousLinearEquiv.toLinearEquiv_symm#doc\">docs#ContinuousLinearEquiv.toLinearEquiv_symm</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ContinuousLinearEquiv.symm_toLinearEquiv#doc\">docs#ContinuousLinearEquiv.symm_toLinearEquiv</a> which are the exact same statement but the latter is deprecated.</p>",
        "id": 553860023,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1762350376
    },
    {
        "content": "<p>And I think this is a perfect example of why there should be no exception. If you create an exception for <code>symm</code> would to also want it for <code>toLinearEquiv</code>? And if not, what is the correct name of the lemma above?</p>",
        "id": 553861013,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1762350529
    },
    {
        "content": "<p>We decided to use prefix for dot notation (even specifically in reference to <code>symm</code>!) in the thread where we decided the simp normal form for these kinds of lemmas (i.e., whether the <code>symm</code> moves inside or outside).</p>",
        "id": 553861287,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1762350599
    },
    {
        "content": "<p>My argument is as follows:</p>\n<ul>\n<li>The convention that I'm in favour of is \"read left-to-right of what the pretty-printer says\". Currently <code>symm</code> as prefix is an exception to this, and I'm arguing that this exception should be removed, for exactly the reasons described above. </li>\n<li>The proposed alternative convention \"function application order\" already has an exception for infix notation, so it would end up with more exceptions than the reading order convention.</li>\n<li>Changing mathlib lemmas to be \"function application order\" convention would involve _massive_ amounts of deprecation, particularly in category theory where the left-to-right convention is used almost exclusively.</li>\n<li>The left-to-right convention is easier for beginners to read, since it's trivial to read off from a human-written or Lean pretty-printed declaration.</li>\n</ul>\n<p>It's clear I'm outvoted here, so I won't press on this much further, but I'm really struggling to parse the arguments I'm being presented with. <br>\nIf the argument is \"there shouldn't be exceptions\", it seems to me that the clear winner is \"left-to-right\" rather than \"suffixes except when it's an infix notation\", especially since notation can be scoped. <br>\nIf the argument is that \"we shouldn't change things\", the only explicitly written rule in the mathlib convention is that infix notation is named infix, that predicates are written prefix, and that some dot-notation predicates are written suffix. All of these are consistent with the \"left-to-right\" convention, and become justified. The rule used in practice in mathlib, as I mentioned above, is more commonly to use left-to-right rather than to special-case dot notation to be written as prefix. This applies even to the case that Jireh mentions, where <code>symm</code> is special-cased in the minority of cases to be prefixed, and I think this prefix special case is what we should eliminate. And this applies especially in category theory, where things like Functor.obj is <em>never</em> written as a prefix.</p>",
        "id": 553933752,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1762367185
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"246273\">Bhavik Mehta</span> <a href=\"#narrow/channel/287929-mathlib4/topic/naming.20convention.3A.20.60symm.60.20in.20lemmas.20generated.20by.20.60.40.5Bsimps.5D.60/near/553933752\">said</a>:</p>\n<blockquote>\n<ul>\n<li>The left-to-right convention is easier for beginners to read, since it's trivial to read off from a human-written or Lean pretty-printed declaration.</li>\n</ul>\n</blockquote>\n<p>The pretty printer doesn't always agree with what the human writes though</p>",
        "id": 553935917,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762367873
    },
    {
        "content": "<p>That's fair, but in the vast majority of cases it does, and the convention is still unambiguous.</p>",
        "id": 553936091,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1762367930
    },
    {
        "content": "<p>I don't know about that</p>",
        "id": 553939191,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762368695
    },
    {
        "content": "<p>the pretty printer isn't exactly something I would call consistent</p>",
        "id": 553939288,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762368730
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"246273\">@Bhavik Mehta</span>,  how would you call the following lemma?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">factorial</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>It pretty-prints as <code>(m + n).factorial = 0</code>, so should it be <code>add_factorial</code>? And then when you open <code>Nat</code> it pretty-prints as <code>(m+n) ! = 0</code>, and then there's no way to know if factorial is prefix or postfix. I'd say that <code>factorial_add</code> is better, whatever the pretty-printer says, because it's the function <code>factorial</code> applied to an addition.</p>",
        "id": 553952592,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1762373255
    },
    {
        "content": "<p>I would name it <code>add_factorial</code>, which is consistent with what the pretty printer says in both scopes.</p>",
        "id": 553953066,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1762373364
    },
    {
        "content": "<p>In particular, I think the rule \"functions are prefix, except for infix notation which is infix\" is an exception which we don't need to have, and complicates things.</p>",
        "id": 553953271,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1762373425
    },
    {
        "content": "<p>I remember opening a thread the other day about naming for dot notation and the consensus there was always writing as prefix regardless how it is pretty printed. Let me find it...</p>",
        "id": 553954426,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1762373854
    },
    {
        "content": "<p>I realise my opinion may be a minority one, so I won't block things. But the new convention being proposed here has quite a few more exceptions, requires parsing the statement, and will require thousands of deprecations, and it's not clear to me that all of these are worth it.</p>",
        "id": 553954654,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1762373939
    },
    {
        "content": "<p>For another somewhat artifical example, mixing usual functions and dot notation,</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>It would feel very strange to me to name this <code>log_add_factorial_le_add</code> and not <code>log_factorial_add_le_add</code>.</p>",
        "id": 553954952,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1762374049
    },
    {
        "content": "<p>Bhavik, I'm not sure whether yours in the minority opinion or not. It's simply not clear to me. And even if it is the minority opinion, I still (even <em>especially</em>) want to hear it from you.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"246273\">Bhavik Mehta</span> <a href=\"#narrow/channel/287929-mathlib4/topic/naming.20convention.3A.20.60symm.60.20in.20lemmas.20generated.20by.20.60.40.5Bsimps.5D.60/near/553933752\">said</a>:</p>\n<blockquote>\n<ul>\n<li>The proposed alternative convention \"function application order\" already has an exception for infix notation, so it would end up with more exceptions than the reading order convention.</li>\n</ul>\n</blockquote>\n<p>The difference with infix notation, in my opinion, is that there is essentially no easy way to write it in prefix notation. E.g., to write <code>a + b</code>, you would have to know that <code>+</code> is not just <code>add</code> or even <code>Add.add</code>, but <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=HAdd.hAdd#doc\">docs#HAdd.hAdd</a>, and so I consider this an implementation detail. In contrast, <code>Equiv.symm f</code>, <code>f.symm</code> and, if the expected type is known, <code>.symm f</code> are all valid spellings, even if the <code>f.symm</code> is the most commonly used.</p>",
        "id": 553955522,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1762374242
    },
    {
        "content": "<p>(The other thread I had <a href=\"#narrow/channel/287929-mathlib4/topic/Naming.20convention.3A.20function.20application/with/533593944\">https://leanprover.zulipchat.com/#narrow/channel/287929-mathlib4/topic/Naming.20convention.3A.20function.20application/with/533593944</a>)</p>",
        "id": 553955744,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1762374313
    },
    {
        "content": "<p>Factorial is a bit of an odd beast because it's one of the few postfix notations. However, unlike <code>‚Åª¬π</code>, which has the same issues the infix notations, it's just scoped notation, so I think it makes sense to refer to it in prefix form (although I can sympathize with people reading it at the end and then putting it there).</p>",
        "id": 553956422,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1762374524
    },
    {
        "content": "<p>Interestingly, we have <code>star</code> which is one of the few \"notation typeclasses\" without any associated notation, even though normally on paper it receives a postfix notation. As a result, we refer to it in prefix notation in declaration names.</p>",
        "id": 553956754,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1762374649
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"197836\">Jireh Loreaux</span> <a href=\"#narrow/channel/287929-mathlib4/topic/naming.20convention.3A.20.60symm.60.20in.20lemmas.20generated.20by.20.60.40.5Bsimps.5D.60/near/553955522\">said</a>:</p>\n<blockquote>\n<p>The difference with infix notation, in my opinion, is that there is essentially no easy way to write it in prefix notation. E.g., to write <code>a + b</code>, you would have to know that <code>+</code> is not just <code>add</code> or even <code>Add.add</code>, but <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=HAdd.hAdd#doc\">docs#HAdd.hAdd</a>, and so I consider this an implementation detail. In contrast, <code>Equiv.symm f</code>, <code>f.symm</code> and, if the expected type is known, <code>.symm f</code> are all valid spellings, even if the <code>f.symm</code> is the most commonly used.</p>\n</blockquote>\n<p>I'm not sure this pattern applies in every case: <code>HAdd.hAdd a b</code> vs <code>a + b</code> seems about the same compared to <code>Functor.obj F X</code> vs <code>F.obj X</code>, and as you say the dot-notation one is used far more often in practice. And for many infix notations, particularly those not powered by notation typeclasses, the difference seems even smaller to me, eg <code>Matrix.mulVec</code>. Note that the same \"easy way to write it\" discussion was mentioned last time: <a class=\"message-link\" href=\"/#narrow/channel/287929-mathlib4/topic/Naming.20convention.20for.20structure.20projections.20and.20dot.20notation/near/512419031\">#mathlib4 &gt; Naming convention for structure projections and dot notation @ üí¨</a>; although the definition of Functor has changed since then, so it's not clear if my counterargument is as strong</p>",
        "id": 553958241,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1762375178
    },
    {
        "content": "<p>If nothing else, this entire discussion has convinced me that we don't follow any of our own rules! This is somewhat tongue-in-cheek, of course.</p>",
        "id": 553959776,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1762375804
    },
    {
        "content": "<p>Can I propose the rule to be \"function composition order unless clearly documented in the docstring to be otherwise\", at least for now? This should be far easier to achieve (requiring way less renames) and is already substantially better than the status quo.</p>",
        "id": 553960499,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1762376083
    },
    {
        "content": "<p>Does that mean adding this documentation to (almost) all the projections currently fed into simps? I agree this requires way less renames, but it's still not a small or local change, there's still quite a lot of things to adjust.</p>",
        "id": 553963915,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1762377359
    },
    {
        "content": "<p>Or perhaps we could do \"function composition order except structure projections unless clearly documented in the docstring to be otherwise\".<br>\nMy point is I that I haven't seen a universal convention that is satisfying (to me) in this thread and it seems quite likely to me that this conversation will die down before such an ideal convention is reached. So to me it seems more useful to think instead about whether there are (perhaps suboptimal) rules that people can agree to easily and is easily enforceable and can drastically improve the status quo already.</p>",
        "id": 553965992,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1762378145
    },
    {
        "content": "<p>It seems to me that at least we have general consensus on removing the exceptions for the prominent violations of Andrew's suggested rule: The suffixing of <code>_injective</code>, <code>_surjective</code>, <code>_montone</code>, etc. that are documented in <a href=\"https://leanprover-community.github.io/contribute/naming.html#predicates-as-suffixes\">https://leanprover-community.github.io/contribute/naming.html#predicates-as-suffixes</a>. Is this correct?</p>",
        "id": 553980722,
        "sender_full_name": "Christian Merten",
        "timestamp": 1762385641
    },
    {
        "content": "<p>what is function composition order?</p>",
        "id": 553980856,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1762385712
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"648495\">@Christian Merten</span> I will have a detailed proposal tomorrow.</p>",
        "id": 553984476,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1762387818
    },
    {
        "content": "<p>For anyone who hasn't read <a class=\"message-link\" href=\"/#narrow/channel/287929-mathlib4/topic/Naming.20convention.20for.20structure.20projections.20and.20dot.20notation/near/512419031\">#mathlib4 &gt; Naming convention for structure projections and dot notation @ üí¨</a> which is a recent, but older thread on essentially the same topic, please do so.</p>\n<p>Yesterday I had a bit of a back-and-forth with Bhavik about this. By the end of it, I think I/we managed to come up with a set of guidelines which we might be able to canonize in the naming conventions on the website, if there is consensus here.</p>\n<h2>The suggested convention</h2>\n<p>Functions, whether structure projections, expressed as dot notation, or otherwise, are included in declaration names in prefix form subject to the following exceptions regarding notation.</p>\n<ol>\n<li><em>Globally</em> available infix/postfix notations are written in infix/postfix form in declaration names. Common examples include <code>+</code> or <code>‚Åª¬π</code>.</li>\n<li><em>Scoped</em> infix/postfix notations are written in infix/postfix form <strong>if and only if</strong> the docstring for the declaration (and also the notation) explicitly specifies this.</li>\n<li><em>Local</em> infix/postfix notations are always written in prefix form, so this is not an exception to the rule.</li>\n</ol>\n<p>The purpose of the rule for scoped notations is to strike a balance between the following competing interests:</p>\n<ul>\n<li>some declarations (e.g., <code>Matrix.mulVec</code>) are almost never written without their (scoped) notation, and so it would be counterintuitive to write them in prefix form.</li>\n<li>in an ideal world, whether or not a given scope is open shouldn't dictate naming conventions, especially since newcomers may not even know about the existence of such a scope.</li>\n</ul>\n<p>In addition, by requiring scoped notations to opt-in to being written in infix/postfix form in declaration names, it allows for community discussion (in the form of the PR review process) about whether any particular notation should be granted that status.</p>\n<p>Finally, the opt-in requirement prevents the necessity of renaming thousands of lemmas only to introduce some new scoped infix/postfix notation for something with a large existing API. For example, suppose that at some point we introduce some scoped notation for <code>star</code>. We could choose <em>not</em> to opt-in to naming it with postfix form, and thereby not need to rename all existing lemmas about <code>star</code> (which currently use it in prefix form because it has no scoped or global notation).</p>\n<h2>Some potential issues</h2>\n<h3>Infix operators without notation</h3>\n<p><span class=\"user-mention silent\" data-user-id=\"246273\">Bhavik Mehta</span> said:</p>\n<blockquote>\n<p>What happens for operators which are used as infix, but without notation, such as <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.choose#doc\">docs#Nat.choose</a>, or <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Finset.image%3F#doc\">docs#Finset.image?</a> In other words, these are often written as <code>n.choose m</code> or <code>s.image f</code>. My worry with this direction is that we end up with a ton of exceptions.</p>\n<p>The other issue I have with this is that names end up longer, because of _left _right showing up, eg <code>(a+b).choose a</code> and <code>c.choose (a+b)</code> would be <code>choose_add_left</code> and <code>choose_add_right</code>, instead of <code>add_choose</code> vs <code>choose_add</code></p>\n</blockquote>\n<p>The answer here is that we don't make exceptions for things like <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.choose#doc\">docs#Nat.choose</a>, but optionally, one could introduce scoped notation for <code>Nat.choose</code>, and then opt-in to writing it in infix form in docstrings.</p>\n<h3>Thousands of deprecations</h3>\n<p>As has been pointed out earlier in this thread, making a change of this sort would lead to hundreds or maybe even thousands of deprecations (e.g., fixing all the <code>symm</code> lemmas generated by <code>simps</code>). While this is a real cost, I think at some point we'll have to pay it in the name of consistency (for whatever direction we end up choosing).</p>\n<h3>Postfix, and at least one existing exception</h3>\n<p>While Bhavik and I mostly agreed on the above ideas for infix notation, we thought that postfix notations might be a bit different (despite the fact that in the proposal above I included them). For instance, <code>‚Åª¬π</code>/<code>inv</code> is always postfix in naming, but <code>·∂ú</code>/<code>compl</code> is often prefix in naming, despite the fact that it is globally available. Likewise, I'm not sure whether we refer to <code>À£</code>/<code>units</code> as prefix or postfix in naming. I think that it doesn't actually arise that often because the type is implicit / unnamed. Postfix notations are much less common, so we could opt not to specify their behavior, but I think this is just a recipe for inconsistency, which is why I included them in the proposal above.</p>",
        "id": 554239472,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1762491989
    },
    {
        "content": "<p>One note: personally, I would prefer if we could abolish the existing explicit exceptions to the prefix rule, namely, <code>injective</code>, <code>inj</code>, <code>surjective</code>, <code>bijective</code>, <code>monotone</code>, <code>mono</code>, <code>strictMono</code>, <code>antitone</code>, <code>strictAnti</code>. However, we could also choose to leave these in place (or at least defer abolishing them to a later date).</p>",
        "id": 554240299,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1762492631
    },
    {
        "content": "<p>Could you say explicitely what the proposed convention says about <code>symm</code> or <code>toLinearEquiv</code> or things like that? They're not notation, so maybe they're just not in the scope of the proposal?</p>",
        "id": 554257529,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1762501967
    },
    {
        "content": "<p>I believe this falls in the \"Infix operators without notation\" category? But I agree less with this decision (in an otherwise great proposal!). I think it is useful to allow the same flexibility as scoped notations here.</p>",
        "id": 554316529,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1762520478
    },
    {
        "content": "<p>That's handled in the first sentence: they get prefix naming.</p>",
        "id": 554316594,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1762520495
    },
    {
        "content": "<p>I am not trying to bikeshed with the following comment, rather, provide context. If I recall correctly, one reason that we had the postfix use of injective etc is so that completion assistance (from the editor) provides a way to see what types of declarations are available for some construction/definition. If I have a frobinate function, typing frobin... gives completion suggestions which help with discoverability of the API landscape. Specifically, characterizations of a function's injectivity etc are such basic elements of the API that discoverability via completion is a boon.</p>\n<p>That being said, one can make the argument that prefix naming consistency would also achieve discoverability by the virtue of: if frobinate is injective, you can be sure it is declared as injective_frobinate.</p>",
        "id": 554316913,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1762520590
    },
    {
        "content": "<p>The <em>only</em> way to get an exception to the prefix rule under the proposal is to have an associated notation which is either globally available, or scoped and opted-in</p>",
        "id": 554317228,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1762520686
    },
    {
        "content": "<p>Yes, I was just trying to explain my understanding of the history of how we got to the current exceptions.</p>",
        "id": 554317653,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1762520807
    },
    {
        "content": "<p>Sorry, I was still answering S√©bastien's question</p>",
        "id": 554318499,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1762521034
    },
    {
        "content": "<p>Symm does have a postfix notation, when considering automorphisms</p>",
        "id": 554319176,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1762521236
    },
    {
        "content": "<p>That's not literally notation for <code>symm</code> though, but<code>inv</code>, right?</p>",
        "id": 554325969,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1762523204
    },
    {
        "content": "<p>While I don't think this is the optimal convention (eg it doesn't address the salience/discoverability points made by Yakov and Johan), it's certainly better than what we currently have, so thanks for writing it up! And I think it's clearly better to have something agreed upon than nothing at all.</p>\n<p>My only comment is on </p>\n<blockquote>\n<p>making a change of this sort would lead to hundreds or maybe even thousands of deprecations (e.g., fixing all the¬†<code>symm</code>¬†lemmas generated by¬†<code>simps</code>). While this is a real cost, I think at some point we'll have to pay it in the name of consistency (for whatever direction we end up choosing).</p>\n</blockquote>\n<p>where I think it's worth noting that this is very easily in the thousands, since just the two data fields for CategoryTheory.Functor together give 4000 deprecations: <a href=\"https://loogle.lean-lang.org/?q=%22_obj%22%2C+CategoryTheory.Functor.obj\">https://loogle.lean-lang.org/?q=%22_obj%22%2C+CategoryTheory.Functor.obj</a>; <a href=\"https://loogle.lean-lang.org/?q=%22_map%22%2C+CategoryTheory.Functor.map\">https://loogle.lean-lang.org/?q=%22_map%22%2C+CategoryTheory.Functor.map</a>. As such, I'd be interested to hear from some of the current frequent users of the category theory library on this change.</p>",
        "id": 554507786,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1762632734
    },
    {
        "content": "<p>Note that the issues in <code>CategoryTheory</code> goes beyond just <code>Functor</code>. The fields of eg <code>Iso</code> and <code>NatTrans</code>, and many other structures that appears in this part of the library are usually written as postfix in declaration names (partly because we rely extremely heavily on <code>[simps]</code>, and I imagine try to be consistent with what it generates). </p>\n<p>At this point, we're probably talking about deprecating <em>almost all</em> of the names in that part of the library.</p>",
        "id": 554515478,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1762641123
    },
    {
        "content": "<p><code>Prod.fst</code> and <code>Prod.snd</code> have no special notation, although it feels like they do, since they're most commonly written as <code>.1</code> and <code>.2</code>. Do we want to keep naming these two declarations with the postfix naming scheme? (I hope yes.)</p>",
        "id": 563786997,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1765795131
    }
]