[
    {
        "content": "<p><strong>Background for the non-maintainers.</strong> Mathlib has a very general notion of \"manifolds with boundary and corners\". It allows boundaryless manifolds, manifolds with boundary, corners of any order (e.g., modelled on any Euclidean quadrant) and more. This is slightly different from most textbooks, in that mathlib's definition is just putting in \"these are the minimal properties we need\" (and extending this list as we realise more conditions are needed) as opposed to demanding a particular model.</p>\n<p><strong>Impetus.</strong> Specifically, mathlib's current definition of models with corners is wrong, in the sense of being too general. A complex manifold (of current mathlib) need not be a real manifold. (The reason is that the condition <code>UniqueDiffOn C target</code> does not imply <code>UniqueDiffOn R target</code>; unique differentiability over C is a weaker condition.) That is very undesirable, so we'd like to add another condition. This was discussed in <a href=\"https://github.com/leanprover-community/mathlib4/pull/18403\">#18403</a>; <span class=\"user-mention\" data-user-id=\"110050\">@Sébastien Gouëzel</span> proposed that we add the requirement \"the interior of <code>range I</code> is convex\". In <a href=\"https://github.com/leanprover-community/mathlib4/pull/23657\">#23657</a> (a pre-requisite to <a href=\"https://github.com/leanprover-community/mathlib4/pull/23658\">#23658</a> which makes that change), he proposed dropping the \"interior\" in that statement.</p>\n<p><strong>New discovery.</strong> However, since then <span class=\"user-mention silent\" data-user-id=\"111080\">Floris van Doorn</span> and I realised that this condition is too strong. There is a notion of (finite-dimensional) complex manifolds with boundary (see <a href=\"https://math.stackexchange.com/questions/1957840/what-is-the-definition-of-a-complex-manifold-with-boundary/1958392#1958392\">Jack Lee's stackoverflow answer</a> <a href=\"https://math.stackexchange.com/a/3340426\">and a follow-up</a> for a definition). In short, the proper definition is to allow models with range $${z\\in U \\colon\\; f(z)\\leq 0\\}$, where <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>U</mi><mo>⊂</mo><msup><mi mathvariant=\"double-struck\">C</mi><mi>n</mi></msup></mrow><annotation encoding=\"application/x-tex\">U\\subset\\mathbb{C}^n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7224em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">⊂</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span></span></span></span></span></span></span> is open and $$f\\colon U\\to\\mathbb{R}$ is a smooth submersion. This range, however, need not be convex.</p>\n<p><strong>What to do?</strong> Floris and I wondered if we can make this the general definition. To boot, this raises a few questions:</p>\n<ul>\n<li>\n<p>how to define complex manifolds with corners? We certainly would like to have them in mathlib, so we can take finite products of manifolds.<br>\nA first naive definition is \"the model has range $$f^{-1}((-\\infty,0])\\cap g^{-1}((-\\infty,0])$\", where $f,g\\colon U\\to\\mathbb{R}$ are two real submersions (and similarly for higher-order corners).<br>\nThis is not correct yet, as it would e.g. allow ${z: Im z = 0}$ as a complex manifold with corners (via the submersions <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mi>z</mi><mo stretchy=\"false\">)</mo><mo>:</mo><mo>=</mo><mi>R</mi><mi>e</mi><mi>z</mi></mrow><annotation encoding=\"application/x-tex\">f(z):= Re z</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">:=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">ez</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi><mo>=</mo><mo>−</mo><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">g = -f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\">−</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span>). We need to add some non-degeneracy condition. </p>\n</li>\n<li>\n<p>what about Banach manifolds with corners? Many textbooks (e.g. Lang or <a href=\"https://arxiv.org/pdf/2112.08114.pdf\">Schmeding</a>) do not speak about this. <a href=\"https://shop.elsevier.com/books/differential-topology/margalef-roig/978-0-444-88434-3\">Roig-Dominguez</a> define Banach manifolds with boundary and corners, in a similar way as above: you can take <code>k</code> linearly independent linear functionals <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">f_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> on your model space, and consider models with range <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mo>⋂</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>k</mi></msubsup><msubsup><mi>f</mi><mi>i</mi><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><mo stretchy=\"false\">(</mo><mo stretchy=\"false\">[</mo><mn>0</mn><mo separator=\"true\">,</mo><mi mathvariant=\"normal\">∞</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\bigcap_{i=1}^k f_i^{-1}([0,\\infty))</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.2887em;vertical-align:-0.2997em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">⋂</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.989em;\"><span style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.2029em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2997em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8542em;\"><span style=\"top:-2.4231em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span><span style=\"top:-3.1031em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2769em;\"><span></span></span></span></span></span></span><span class=\"mopen\">([</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">∞</span><span class=\"mclose\">))</span></span></span></span>.</p>\n</li>\n</ul>\n<p><strong>New proposal.</strong> Thus, here is a strawman proposal. We add a new constraint to the definition of models with corners modelled over an <code>RCLike</code> field, consisting of</p>\n<ul>\n<li>data: a finite set of maps <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mi>i</mi></msub><mspace></mspace><mspace width=\"0.1111em\"/><mo lspace=\"0em\" rspace=\"0.17em\"></mo><mtext> ⁣</mtext><mo lspace=\"0em\" rspace=\"0em\">:</mo><mspace width=\"0.3333em\"/><mi>E</mi><mo>→</mo><mi mathvariant=\"double-struck\">R</mi></mrow><annotation encoding=\"application/x-tex\">f_i\\colon E\\to\\mathbb{R}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace nobreak\"></span><span class=\"mspace\" style=\"margin-right:0.1111em;\"></span><span class=\"mpunct\"></span><span class=\"mspace\" style=\"margin-right:-0.1667em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mrel\">:</span></span><span class=\"mspace\" style=\"margin-right:0.3333em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">R</span></span></span></span></li>\n<li>a proof that all these maps are submersions,</li>\n<li>a non-degeneracy condition: for each <code>z</code> in the range of the model, if precisely <code>k</code> of our submersions vanish at <code>z</code>, then their differentials at <code>z</code> are linearly independent (as vectors in the space of real linear maps <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi><mo>→</mo><mi mathvariant=\"double-struck\">R</mi></mrow><annotation encoding=\"application/x-tex\">E\\to\\mathbb{R}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">R</span></span></span></span>). (If all submersions are linear, this is precisely \"all submersions are linearly independent.)</li>\n<li>the condition that our model with corners have range <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mo>⋂</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>k</mi></msubsup><msubsup><mi>f</mi><mi>i</mi><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><mo stretchy=\"false\">(</mo><mo stretchy=\"false\">[</mo><mn>0</mn><mo separator=\"true\">,</mo><mi mathvariant=\"normal\">∞</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\bigcap_{i=1}^k f_i^{-1}([0,\\infty))</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.2887em;vertical-align:-0.2997em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">⋂</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.989em;\"><span style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.2029em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2997em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8542em;\"><span style=\"top:-2.4231em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span><span style=\"top:-3.1031em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2769em;\"><span></span></span></span></span></span></span><span class=\"mopen\">([</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">∞</span><span class=\"mclose\">))</span></span></span></span> (or perhaps, considering suitable restrictions of <code>f_i</code> instead)</li>\n</ul>\n<p>This proposal</p>\n<ul>\n<li>allows for complex manifolds with boundary and also allows corners there</li>\n<li>is, over the real numbers, equivalent to the standard definition using Euclidean quadrants. (This requires a little work to prove, but follows since in suitable charts, submersions are just a coordinate projection.)</li>\n<li>implies the range is \"large\": its interior is dense in the range, and</li>\n<li>and implies the unique differentiability condition over R or C.</li>\n</ul>\n<p>It also ensures complex manifolds are always real manifolds (as complex linearly independent vectors are also real linearly independent).</p>\n<p>Tagging <span class=\"user-mention\" data-user-id=\"110050\">@Sébastien Gouëzel</span> (whom else?)</p>",
        "id": 515049529,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1745929857
    },
    {
        "content": "<p>If the issue is that complex manifolds are not always real manifolds, can't you just demand that, in the RCLike case, the range has UniqueDiffOn for R?</p>",
        "id": 515051359,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1745930292
    },
    {
        "content": "<p>I'd like to fix the definition of model spaces, instead of playing this game \"let's work with the weakest definition of model spaces that can prove theorems <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo separator=\"true\">,</mo><mo>…</mo><mo separator=\"true\">,</mo><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">1, \\ldots, N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span></span> and if theorem <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>N</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">N+1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> requires an additional condition on model spaces, then we change its definition.\"</p>\n<p>Michael mentioned the collar neighbourhood theorem recently, which probably also requires an additional condition on model spaces for real manifold with boundaries (without corners). Another example: I'm not sure if we can prove with the current definition that the boundary of a p-adic manifold is empty.</p>\n<p>So Michael's proposal is a proposal to significantly restrict model spaces, while supporting all model spaces that I'm currently aware exist in the literature (which might not be exhaustive, of course). <br>\nIn fact, maybe we should go one step further: if <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">k</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{k}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">k</span></span></span></span> is a field extension of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">R</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{R}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">R</span></span></span></span> (or maybe if  <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">k</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{k}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">k</span></span></span></span> is RC-like?) then we add the boundary data as in Michael's proposal, and otherwise we require that the model has range <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span>, so that we also get nice model spaces for e.g. the p-adics.<br>\nIf we do that, we can get rid of the unique differentiability condition and the condition that the interior is dense, since that follows from these conditions.</p>",
        "id": 515059471,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1745932306
    },
    {
        "content": "<p>I'm definitely on par with enforcing that the range is <code>univ</code> when the field is not RCLike. </p>\n<p>For RCLike fields, though, the definition proposed by Michael looks very specific. I'm not saying we should be general for the sake of being general, but rather for the sake of clarifying the picture and simplifying the proofs: Often, focusing on specific details hides the big picture of what is really going on, and tends to make proofs harder because you have too many things available and you don't know which tool to use.</p>\n<p>For more specific theorems, of course, you will need more specific assumptions. For instance, the collar theorem only makes sense for manifolds with boundary, not manifolds with corners, because you need the boundary to be a manifold in itself.</p>",
        "id": 515063247,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1745933171
    },
    {
        "content": "<p>This being said, we could change the definition to be whatever definition you like, prove from it the basic properties (the range is UniqueDiffOn, the interior of the range is dense, whatever) and then only use these properties when building the theory. I wouldn't mind at all. What I'm afraid of is that users of the library would try to come back to the initial very specific definition too often, and would get lost in it. But this could be avoided by a thorough docstring saying: \"don't use this definition unless really necessary, use the API provided by such and such\".</p>",
        "id": 515064009,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1745933358
    },
    {
        "content": "<p>If you're mostly worried about discovery of the important properties of model spaces, then I'm definitely happy to add in docstrings/module docs text of the form \"these 2+ properties are often the only properties you need to do basic manifold theory\" and prove these properties early.</p>",
        "id": 515065523,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1745933727
    },
    {
        "content": "<p>(Note that the definition of complex manifold with boundary pointed by Michael can not be implemented in current Mathlib, as the model space would have to depend on the point you're looking at in the manifold, while we're working with a fixed model space all over the place).</p>",
        "id": 515065625,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1745933760
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110050\">Sébastien Gouëzel</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Fixing.20the.20definition.20of.20models.20with.20corners/near/515065625\">said</a>:</p>\n<blockquote>\n<p>(Note that the definition of complex manifold with boundary pointed by Michael can not be implemented in current Mathlib, as the model space would have to depend on the point you're looking at in the manifold, while we're working with a fixed model space all over the place).</p>\n</blockquote>\n<p>I have no idea how difficult implementing this generalization would be, but it would be very useful when we want to construct smooth manifolds attached to smooth schemes over the complex numbers (or over the reals). Otherwise, we would need equidimensional assumptions, which would be very annoying.</p>",
        "id": 515067128,
        "sender_full_name": "Joël Riou",
        "timestamp": 1745934113
    },
    {
        "content": "<p>To be honest, I am not convinced yet that there is anything to be gained by changing the definition (apart from requiring that over C there is also real UniqueDiffOn for the range over the reals, but even for that it could even be better to have this as an additional typeclass over <code>I</code> added when needed, instead of being part of the definition). I think that to be convinced I just need to be shown a theorem where this is important.</p>",
        "id": 515067364,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1745934169
    },
    {
        "content": "<p>Smooth manifolds in mathlib are indeed constant-dimensional globally, otherwise it's just a nightmare.</p>",
        "id": 515067612,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1745934236
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110050\">Sébastien Gouëzel</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Fixing.20the.20definition.20of.20models.20with.20corners/near/515065625\">said</a>:</p>\n<blockquote>\n<p>(Note that the definition of complex manifold with boundary pointed by Michael can not be implemented in current Mathlib, as the model space would have to depend on the point you're looking at in the manifold, while we're working with a fixed model space all over the place).</p>\n</blockquote>\n<p>True, although that design decision is orthogonal to this one.</p>",
        "id": 515067627,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1745934240
    },
    {
        "content": "<p>In the same way, vector bundles have fixed dimension of the fiber.</p>",
        "id": 515068017,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1745934330
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110050\">Sébastien Gouëzel</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Fixing.20the.20definition.20of.20models.20with.20corners/near/515067364\">said</a>:</p>\n<blockquote>\n<p>To be honest, I am not convinced yet that there is anything to be gained by changing the definition (apart from requiring that over C there is also real UniqueDiffOn for the range over the reals, but even for that it could even be better to have this as an additional typeclass over <code>I</code> added when needed, instead of being part of the definition). I think that to be convinced I just need to be shown a theorem where this is important.</p>\n</blockquote>\n<p>That is another route we could take. Michael's definition does simplify the definition manifold with boundary without corner (or with <code>n</code>-corners but no <code>(n+1)</code>-corners): you can just say that any point is in at most <code>n</code> zero sets. But another option is to just have a type-class \"this manifold has a nice smooth boundary and (therefore) no corners\" and prove theorems that need that using that class.</p>",
        "id": 515068907,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1745934536
    },
    {
        "content": "<p>We definitely need a class for model with corners with nice boundary, because they are needed to endow the boundary with a manifold structure, which should be available to typeclass inference.</p>",
        "id": 515069337,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1745934639
    },
    {
        "content": "<p>I guess using the current (general) definition the interior + boundary of the Koch snowflake is a manifold (I believe). Do we care about that?</p>",
        "id": 515069449,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1745934665
    },
    {
        "content": "<p>It's not a smooth manifold, so no problem here as far as I can see.</p>",
        "id": 515069779,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1745934736
    },
    {
        "content": "<p>Is it not? It is a model space, and I can use 1 chart to model it.</p>",
        "id": 515069953,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1745934780
    },
    {
        "content": "<p>Ah, for this weird model with corners yes, definitely. But the weird model with corners doesn't have a nice boundary.</p>",
        "id": 515073536,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1745935554
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"459699\">@Joël Riou</span> maybe for the analytic space associated to a scheme of finite type over <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">C</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{C}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">C</span></span></span></span> we need some new definition then? e.g. complex analytic spaces? And then maybe in the smooth case we show that their components are manifolds?</p>",
        "id": 515074712,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1745935821
    },
    {
        "content": "<p>If we're not uncomfortable with the fact that Mathlib has smooth manifolds with fractal boundary, then I can also live with adding Michael's conditions as a type-class on top of <code>ModelWithCorners</code>. <br>\nHowever, I would be happier to go in that direction if there is an actual use-case of the current <code>ModelWithCorners</code> besides being general for the sake of being general.</p>",
        "id": 515083158,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1745937734
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110050\">Sébastien Gouëzel</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Fixing.20the.20definition.20of.20models.20with.20corners/near/515069337\">said</a>:</p>\n<blockquote>\n<p>We definitely need a class for model with corners with nice boundary, because they are needed to endow the boundary with a manifold structure, which should be available to typeclass inference.</p>\n</blockquote>\n<p>By the way, <a href=\"https://github.com/leanprover-community/mathlib4/pull/22059\">#22059</a> is my current proposal in that area. It carries data (but that should be fine, given that we don't care about the particular choice of data, but merely about the existence of such data). The code is not maximally polished: it depends on a few not-yet-merged PRs, as a few sorries for unused PRs, and the last 200 lines can probably be ignored --- but this could give a first idea.<br>\nBefore landing that in mathlib, we should probably merge a definition of smooth embeddings first (which I'm also working on).</p>\n<p>Note that is a typeclass on the manifold, <em>not</em> the model with corners.</p>",
        "id": 515084844,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1745938112
    },
    {
        "content": "<p>I think a statement \"if M is a real manifold modelled on the upper half space in R^n, then its boundary is a smooth real manifold\" is false without additional assumptions. To start, note that M could be boundaryless (e.g., if M is in fact modelled on an open ball in the interior of the model's range). For an actual counterexample, let $n=2$ and let $M$ be the top right quadrant in R² (which has boundary and a corner). We embed M into the upper half space so the corner is on the real line. I believe that currently, this is allowed.</p>",
        "id": 515085327,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1745938218
    },
    {
        "content": "<p>I don't get your example. To me, if you have a smooth real manifold modelled on the upper half space of dimension <code>n+1</code>, then its boundary is definitely a smooth real manifold (of dimension <code>n</code>, without boundary). Sketch of proof: at a point <code>x</code> of the boundary, the corresponding chart <code>c</code> of <code>M</code> sends a neighborhood of this point to some set in the upper half space, and a neighborhood of <code>∂M</code> around <code>x</code> to a subset of <code>ℝ^n</code>. The restriction of <code>c</code> to <code>∂M</code> is your chart, taking values in <code>ℝ^n</code>. The change of coordinates are smooth, everything looks fine to me. Am I overlooking something?</p>",
        "id": 515090342,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1745938934
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Fixing.20the.20definition.20of.20models.20with.20corners/near/515074712\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"459699\">Joël Riou</span> maybe for the analytic space associated to a scheme of finite type over <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">C</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{C}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">C</span></span></span></span> we need some new definition then? e.g. complex analytic spaces? And then maybe in the smooth case we show that their components are manifolds?</p>\n</blockquote>\n<p>Yes, anyways, we will have to introduce a new definition so as to include singularities.</p>",
        "id": 515091972,
        "sender_full_name": "Joël Riou",
        "timestamp": 1745939264
    },
    {
        "content": "<p>But as far as I understand all this is blocked until we have invariance of domain, anyway.</p>",
        "id": 515093319,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1745939615
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110050\">@Sébastien Gouëzel</span> what is it specifically that makes the theory of manifolds a nightmare is the dimension, resp the local type, is not constant?</p>",
        "id": 515157182,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1745960687
    },
    {
        "content": "<p>Honestly, I haven't even tried, since I avoid dependent type hell whenever I can. The issue is that, if the type of the model space, the charts, the model with corner, and so on, depend on the point of the manifold, then rewriting becomes impossible (well, not impossible, but a much more complicated dance).</p>",
        "id": 515219638,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1745995379
    }
]