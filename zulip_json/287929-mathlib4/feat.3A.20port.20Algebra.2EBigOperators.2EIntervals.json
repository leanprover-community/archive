[
    {
        "content": "<p>in <a href=\"https://github.com/leanprover-community/mathlib4/pull/1901\">mathlib4#1901</a>, <br>\nI'm stuck here: <br>\n<a href=\"https://github.com/leanprover-community/mathlib4/blob/168aabd8e9e8c5b9a9a39bac66aad8ba5bf2f87a/Mathlib/Algebra/BigOperators/Intervals.lean#L298\">https://github.com/leanprover-community/mathlib4/blob/168aabd8e9e8c5b9a9a39bac66aad8ba5bf2f87a/Mathlib/Algebra/BigOperators/Intervals.lean#L298</a></p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">conv</span> <span class=\"bp\">=&gt;</span> <span class=\"n\">pattern</span> <span class=\"o\">(</span><span class=\"n\">occs</span> <span class=\"o\">:=</span> <span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"n\">f</span> <span class=\"n\">_</span> <span class=\"bp\">•</span> <span class=\"n\">g</span> <span class=\"n\">_</span> <span class=\"bp\">&lt;;&gt;</span> <span class=\"o\">(</span><span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"bp\">←</span> <span class=\"n\">sum_range_succ_sub_sum</span> <span class=\"n\">g</span><span class=\"o\">])</span>\n</code></pre></div>\n<p>This was</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code> <span class=\"n\">conv</span> <span class=\"o\">{</span> <span class=\"n\">for</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">_</span> <span class=\"bp\">•</span> <span class=\"n\">g</span> <span class=\"n\">_</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"o\">]</span> <span class=\"o\">{</span> <span class=\"n\">rw</span> <span class=\"bp\">←</span> <span class=\"n\">sum_range_succ_sub_sum</span> <span class=\"n\">g</span> <span class=\"o\">}</span> <span class=\"o\">},</span>\n</code></pre></div>\n<p>before and is supposed to change the occurances of <code>g k</code> in the rhs of the goal</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">f</span> <span class=\"n\">m</span> <span class=\"bp\">•</span> <span class=\"n\">g</span> <span class=\"n\">m</span> <span class=\"bp\">+</span> <span class=\"n\">Finset.sum</span> <span class=\"o\">(</span><span class=\"n\">Ico</span> <span class=\"o\">(</span><span class=\"n\">m</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"k\">fun</span> <span class=\"n\">k</span> <span class=\"bp\">=&gt;</span> <span class=\"n\">f</span> <span class=\"n\">k</span> <span class=\"bp\">•</span> <span class=\"n\">g</span> <span class=\"n\">k</span>\n</code></pre></div>\n<p>I get two <code>unknown metavariable '?_uniq.95707'</code> error.<br>\nI tried already changing the line to</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">conv</span> <span class=\"bp\">=&gt;</span> <span class=\"n\">pattern</span> <span class=\"o\">(</span><span class=\"n\">occs</span> <span class=\"o\">:=</span> <span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">_</span><span class=\"o\">)</span> <span class=\"bp\">•</span> <span class=\"o\">(</span><span class=\"n\">g</span> <span class=\"n\">_</span><span class=\"o\">)</span> <span class=\"bp\">;</span> <span class=\"o\">(</span><span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"bp\">←</span> <span class=\"n\">sum_range_succ_sub_sum</span> <span class=\"n\">g</span><span class=\"o\">])</span>\n</code></pre></div>\n<p>but it didn't help.<br>\nHow to fix it best?</p>",
        "id": 324298843,
        "sender_full_name": "Moritz Firsching",
        "timestamp": 1674915514
    },
    {
        "content": "<p>That looks to me like a bug in <code>conv</code>.</p>\n<p>This seems to work:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code>  <span class=\"k\">have</span> <span class=\"n\">h₃</span><span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">Finset.sum</span> <span class=\"o\">(</span><span class=\"n\">Ico</span> <span class=\"o\">(</span><span class=\"n\">m</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"k\">fun</span> <span class=\"n\">i</span> <span class=\"bp\">=&gt;</span> <span class=\"n\">f</span> <span class=\"n\">i</span> <span class=\"bp\">•</span> <span class=\"n\">g</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"bp\">=</span>\n             <span class=\"o\">(</span><span class=\"n\">Finset.sum</span> <span class=\"o\">(</span><span class=\"n\">Ico</span> <span class=\"o\">(</span><span class=\"n\">m</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"k\">fun</span> <span class=\"n\">i</span> <span class=\"bp\">=&gt;</span>\n                <span class=\"n\">f</span> <span class=\"n\">i</span> <span class=\"bp\">•</span> <span class=\"o\">((</span><span class=\"n\">Finset.sum</span> <span class=\"o\">(</span><span class=\"n\">Finset.range</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span><span class=\"o\">))</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"bp\">-</span>\n                        <span class=\"o\">(</span><span class=\"n\">Finset.sum</span> <span class=\"o\">(</span><span class=\"n\">Finset.range</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"n\">g</span><span class=\"o\">)))</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">congr</span><span class=\"bp\">;</span> <span class=\"n\">funext</span><span class=\"bp\">;</span> <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"bp\">←</span> <span class=\"n\">sum_range_succ_sub_sum</span> <span class=\"n\">g</span><span class=\"o\">]</span>\n  <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">h₃</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 324323468,
        "sender_full_name": "David Renshaw",
        "timestamp": 1674924983
    },
    {
        "content": "<p>Great, thanks <span class=\"user-mention\" data-user-id=\"243791\">@David Renshaw</span> , I put you as a co-author for that commit. <br>\nI had to do the same thing for a second <code>conv</code> in the proof and left porting notes saying <code>conv</code> was removed.<br>\nI think this is good for the port of the file at hand.<br>\nPerhaps it is worth looking into what exactly goes wrong with <code>conv</code> here, possibly constructing a MWE...</p>",
        "id": 324339779,
        "sender_full_name": "Moritz Firsching",
        "timestamp": 1674933497
    }
]