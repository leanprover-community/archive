[
    {
        "content": "<p>We have a <code>proof_wanted</code> keyword for theorem statements that we wish to assert without affecting the proof environment; a <code>proof_wanted</code> claim cannot be used to prove other claims.  This turned out to be important in an unanticipated use case of the PFR repository, in which a placeholder statement of the form <code>theorem &lt;theorem_name&gt; : 0 = 1 := by sorry</code> was used by an automated theorem prover to \"prove\" several other statements.  Replacing this with <code>proof_wanted &lt;theorem_name&gt; : 0 = 1</code> or <code>proof_wanted &lt;theorem_name&gt; : (sorry:Prop)</code> removes this exploit.</p>\n<p>Is it possible to also have a <code>definition_wanted</code> keyword that is a placeholder for a definition, and allows the definition to be used in notation and in subsequent <code>proof_wanted</code> statements, but cannot be used in actual <code>theorem</code>s?  The existing technique <code>def &lt;definition name&gt; : &lt;definition type&gt; := sorry</code> has the unintended consequence that downstream theorems using that definition can be artificially solved using tactics such as <code>rfl</code>.  Here is a concrete example from (an outdated version of) PFR, discovered by an automated theorem prover:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">multiDist</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"o\">:</span><span class=\"n\">‚Ñï</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Œ©</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hŒ©</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">:</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">MeasureSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ©</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ©</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">inherit_doc</span><span class=\"w\"> </span><span class=\"n\">multiDist</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"n\">notation3</span><span class=\"o\">:</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"s2\">\"D[\"</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"s2\">\" ; \"</span><span class=\"w\"> </span><span class=\"n\">hŒ©</span><span class=\"w\"> </span><span class=\"s2\">\"]\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">multiDist</span><span class=\"w\"> </span><span class=\"n\">hŒ©</span><span class=\"w\"> </span><span class=\"n\">X</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">multiDist_copy</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"o\">:</span><span class=\"n\">‚Ñï</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Œ©</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Œ©'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hŒ©</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">MeasureSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ©</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hŒ©'</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">MeasureSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ©'</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ©</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ©'</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hident</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">IdentDistrib</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X'</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hŒ©</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">volume</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hŒ©'</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">volume</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">D</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">hŒ©</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">[</span><span class=\"n\">X'</span><span class=\"w\"> </span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">hŒ©'</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>Ideally, I would like instead to write</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"n\">definition_wanted</span><span class=\"w\"> </span><span class=\"n\">multiDist</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"o\">:</span><span class=\"n\">‚Ñï</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Œ©</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hŒ©</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">:</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">MeasureSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ©</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ©</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">inherit_doc</span><span class=\"w\"> </span><span class=\"n\">multiDist</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"n\">notation3</span><span class=\"o\">:</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"s2\">\"D[\"</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"s2\">\" ; \"</span><span class=\"w\"> </span><span class=\"n\">hŒ©</span><span class=\"w\"> </span><span class=\"s2\">\"]\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">multiDist</span><span class=\"w\"> </span><span class=\"n\">hŒ©</span><span class=\"w\"> </span><span class=\"n\">X</span>\n\n<span class=\"n\">proof_wanted</span><span class=\"w\"> </span><span class=\"n\">multiDist_copy</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"o\">:</span><span class=\"n\">‚Ñï</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Œ©</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Œ©'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hŒ©</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">MeasureSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ©</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hŒ©'</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">MeasureSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ©'</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ©</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ©'</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hident</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">IdentDistrib</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X'</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hŒ©</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">volume</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hŒ©'</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">volume</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">D</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">hŒ©</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">[</span><span class=\"n\">X'</span><span class=\"w\"> </span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">hŒ©'</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>but to not permit <code>multiDist</code> (or <code>D[X; hŒ©]</code>) to be used in any actual theorem statements or proofs.  Is such a syntax even possible in Lean?</p>",
        "id": 477260277,
        "sender_full_name": "Terence Tao",
        "timestamp": 1729097781
    },
    {
        "content": "<p>One solution might be <code>opaque def</code>, which seals up the definition completely, but, unlike <code>axiom</code>, it still ensures you can't prove falsehoods since it requires that there exist <em>some</em> definition with the type, using the <code>Nonempty</code> typeclass.</p>\n<p>In this case, making <code>multiDist</code> be <code>opaque</code> would prevent <code>D[X ; hŒ©] = D[X' ; hŒ©']</code> from being solved by <code>rfl</code>.</p>",
        "id": 477261679,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1729098313
    },
    {
        "content": "<p>So <code>opaque def multiDist {m:‚Ñï} {Œ©: Fin m ‚Üí Type*} /- etc -/ : ‚Ñù := sorry</code></p>",
        "id": 477272327,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729102140
    },
    {
        "content": "<p>Though this leaves a trap for an unsuspecting mathematician who fills in the sorry and doesn't understand why they can't prove anything about <code>multiDist</code> (answer: they must delete <code>opaque</code>)</p>",
        "id": 477272491,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729102202
    },
    {
        "content": "<p>So this is why I propose a custom <code>definition_wanted</code> keyword, which could be as simple as an alias for <code>opaque def ... := sorry</code>, but which forces the mathematician filling in the sorry to replace that keyword with an actual <code>def</code> with non-sorry content (and presumably this mathematician would not also supply an <code>opaque</code> modifier).</p>",
        "id": 477278178,
        "sender_full_name": "Terence Tao",
        "timestamp": 1729104163
    },
    {
        "content": "<p>A long time ago I wanted to change <code>sorry</code> so that every sorry is unique, which prevents this class of gotchas entirely.  Maybe it's too much of a breaking change to do that in core, but you could always add new syntax for it, analogously to <code>Type*</code> vs. <code>Type</code>.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Meta</span>\n\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"sorry*\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"bp\">&lt;=</span><span class=\"w\"> </span><span class=\"n\">expectedType</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">toExpr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">mkFreshUserName</span><span class=\"w\"> </span><span class=\"ss\">`sorry</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">fvs</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">getLCtx</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">getFVars</span><span class=\"bp\">.</span><span class=\"n\">mapM</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">getFVarLocalDecl</span><span class=\"w\"> </span><span class=\"bp\">¬∑</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toList</span><span class=\"bp\">.</span><span class=\"n\">dropWhile</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">¬∑.</span><span class=\"n\">isImplementationDetail</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toArray</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">¬∑.</span><span class=\"n\">toExpr</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">ty</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mkForall</span><span class=\"w\"> </span><span class=\"ss\">`h</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">default</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">mkEq</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">mkForallFVars</span><span class=\"w\"> </span><span class=\"n\">fvs</span><span class=\"w\"> </span><span class=\"n\">expectedType</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">mkAppN</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">mkSorry</span><span class=\"w\"> </span><span class=\"n\">ty</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">synthetic</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">mkEqRefl</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">fvs</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">norm1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"bp\">*</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">norm2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"bp\">*</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">norm1</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">norm1</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"c1\">-- fails</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">norm1</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">norm2</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"c1\">-- fails</span>\n</code></pre></div>",
        "id": 477287818,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1729107730
    },
    {
        "content": "<p>One could perhaps implement both ideas: an (optional) more \"secure\" version <code>sorry*</code> of <code>sorry</code>, and make <code>definition_wanted</code> syntactic sugar for <code>opaque def ... := sorry*</code>.  (One could also update other tactics such as <code>stop</code> to incorporate this version of <code>sorry</code>, as a precaution, even if I can't directly think of an exploit here.)</p>",
        "id": 477288232,
        "sender_full_name": "Terence Tao",
        "timestamp": 1729107922
    },
    {
        "content": "<p>Isn't <code>opaque</code> a bit too stringent? Assume Kevin wants to state that two groups are isomorphic and also state that such an isomorphism commutes with some other operations. I would expect he does something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">definition_wanted</span><span class=\"w\"> </span><span class=\"n\">iso</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"bp\">=~*</span><span class=\"w\"> </span><span class=\"n\">G'</span>\n\n<span class=\"n\">proof_wanted</span><span class=\"w\"> </span><span class=\"n\">iso_comp_f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">iso</span><span class=\"w\"> </span><span class=\"bp\">\\</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">g</span>\n</code></pre></div>\n<p>But now he has to prove that <code>G =~* G'</code> is nonempty! That goes against the point.</p>",
        "id": 477292816,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1729109710
    },
    {
        "content": "<p>The way <code>proof_wanted</code> works is that it creates an axiom, but inside a block that (by force) does not change the environment. To use a similar approach across multiple declarations like this, one would need to have a whole section that doesn't modify the environment. I don't know if we have anything that can be used to accomplish this. The function that's used for <code>proof_wanted</code> is <a href=\"https://leanprover-community.github.io/mathlib4_docs/Lean/MonadEnv.html#Lean.withoutModifyingEnv\">Lean.withoutModifyingEnv</a>.</p>",
        "id": 477297308,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1729111454
    },
    {
        "content": "<p>one could imagine syntax roughly as follows:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">throwaway</span><span class=\"w\"> </span><span class=\"kn\">section</span>\n\n<span class=\"n\">definition_wanted</span><span class=\"w\"> </span><span class=\"n\">foobar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">Baz</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GroupCat</span>\n\n<span class=\"n\">proof_wanted</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">False</span>\n\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 477297461,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1729111514
    },
    {
        "content": "<p>But I also don't see how to ensure that <code>definition_wanted</code> and <code>proof_wanted</code> are only used in a throwaway section.</p>",
        "id": 477297704,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1729111602
    },
    {
        "content": "<p>Wait, wouldn't the point of <code>throwaway section</code> be to use plain old <code>def</code> and <code>theorem</code> inside?</p>",
        "id": 477299627,
        "sender_full_name": "Vincent Beffara",
        "timestamp": 1729112408
    },
    {
        "content": "<p>With what as body?</p>",
        "id": 477299710,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1729112441
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Is.20a.20.60definition_wanted.60.20keyword.20possible.3F/near/477299710\">said</a>:</p>\n<blockquote>\n<p>With what as body?</p>\n</blockquote>\n<p><code>sorry*</code></p>",
        "id": 477299850,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1729112501
    },
    {
        "content": "<p>With <code>sorry</code> if necessary, since there is no danger of spilling out?</p>",
        "id": 477299860,
        "sender_full_name": "Vincent Beffara",
        "timestamp": 1729112504
    },
    {
        "content": "<p>yes, if we implement <code>throwaway section</code>, then you can do whatever you want in there.</p>",
        "id": 477300019,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1729112551
    },
    {
        "content": "<p>Maybe it's much easier than I had envisioned: </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"n\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"throwaway\"</span><span class=\"w\"> </span><span class=\"n\">cmds</span><span class=\"o\">:</span><span class=\"n\">command</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"s2\">\"catch\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">withoutModifyingEnv</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">cmds</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"n\">Elab.Command.elabCommand</span><span class=\"w\"> </span><span class=\"n\">cmd</span>\n\n<span class=\"n\">throwaway</span>\n\n<span class=\"kd\">axiom</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"n\">catch</span>\n</code></pre></div>",
        "id": 477302788,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1729113765
    },
    {
        "content": "<p>I think that this may have some issues: for instance, you cannot define <code>notation</code> among the <code>cmds</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">throwaway</span>\n\n<span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"‚Ñï\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"sd\">/-- error: unknown identifier '¬´‚Ñï¬ª' -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span>\n\n<span class=\"n\">catch</span>\n</code></pre></div>",
        "id": 477305427,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1729114973
    },
    {
        "content": "<p>Maybe that is not a huge limitation, but \"sequential parsing of commands\" is not the same as \"parsing a file\".</p>",
        "id": 477305455,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1729114992
    },
    {
        "content": "<p>(I knew about this, because of <a href=\"#narrow/stream/270676-lean4/topic/parsing.20two.20.28or.20more.29.20commands\">that</a>).</p>",
        "id": 477305692,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1729115097
    },
    {
        "content": "<p>I see. And looking at the other thread, there is no easy solution that would make this approach work.</p>",
        "id": 477306636,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1729115568
    },
    {
        "content": "<p>It'd take a core change, but it seems like it would be possible to make a <code>throwaway section ... end</code> command, that has the same effect as Adam's command, but which would allow new syntaxes in the interim.</p>",
        "id": 477316609,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1729119998
    },
    {
        "content": "<p>On a slightly different note: it appears that <code>linter.unusedVariables</code> complains when a <code>proof_wanted</code> statement involves variables that are not used in the (non-existent) proof.  Is there a way to disable this linter for <code>proof_wanted</code> statements by default?</p>",
        "id": 477325788,
        "sender_full_name": "Terence Tao",
        "timestamp": 1729126322
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"657719\">@Terence Tao</span> Turned out to be doable: <a href=\"https://github.com/leanprover-community/batteries/pull/997\">batteries#997</a></p>",
        "id": 477327153,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1729127301
    },
    {
        "content": "<p>Taking note for the future: Don't open an issue, bother Kyle directly <span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span></p>",
        "id": 477378306,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1729151596
    },
    {
        "content": "<p>I tried out <span class=\"user-mention\" data-user-id=\"110043\">@Gabriel Ebner</span>'s proposal, but it turns out there's a gotcha when it comes to section variables. Likely you want to use <code>sorry</code> for definitions, and in that case <code>sorry</code> will include all section variables into the type of the definition automatically.</p>\n<p>I'm experimenting in <a href=\"https://github.com/leanprover/lean4/pull/5757\">lean4#5757</a> with making sorries unique at least in the sense that each <code>sorry</code> that appears in the source is not defeq to any other, so for example <code>(rfl : (sorry : Nat) = sorry)</code> fails to typecheck. The <code>norm1 x = norm1 y</code> example is still a defeq, but at least the <code>norm1 x = norm2 x</code> one fails.</p>\n<p>If we had a <code>revert_all</code> tactic, then one could implement Gabriel's <code>sorry*</code> as a macro for <code>by revert_all; sorry</code></p>",
        "id": 477538442,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1729207176
    },
    {
        "content": "<p><code>revert_all</code> didn't make sense as a tactic with the pre-4.11.0 inclusion mechanism, right?</p>",
        "id": 477546152,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729212635
    },
    {
        "content": "<p>Am I now right in saying it is always safe in <code>by</code> blocks, or is it only after theorem statements that the context is frozen?</p>",
        "id": 477546238,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729212686
    },
    {
        "content": "<p>Just theorems</p>",
        "id": 477546570,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1729212897
    },
    {
        "content": "<p>Update: we added unique <code>sorry</code>s to core Lean <span class=\"user-mention\" data-user-id=\"657719\">@Terence Tao</span>. They will show up in a few weeks in the release candidate for the next version. <a class=\"message-link\" href=\"/#narrow/channel/116290-rss/topic/Recent.20Commits.20to.20lean4.3Amaster/near/488529000\">#rss &gt; Recent Commits to lean4:master @ üí¨</a></p>\n<p>It still takes a little bit of care to use it ‚Äî this is not the context-capturing <code>sorry</code> that Gabriel proposed. Instead, it's a <code>sorry</code> that is different from any other sorry. For example, given</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>then <code>x</code> and <code>y</code> are not definitionally equal. No need for the <code>opaque</code> trick. (These also have a feature that if the <code>sorry</code> ever shows up in the Infoview, you can \"go to definition\" on them to see where they came from.)</p>\n<p>To use it correctly, rather than</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">multiDist</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"o\">:</span><span class=\"n\">‚Ñï</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Œ©</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hŒ©</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">:</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">MeasureSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ©</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ©</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>you would write</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">multiDist</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"o\">:</span><span class=\"n\">‚Ñï</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Œ©</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hŒ©</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">:</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">MeasureSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ©</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ©</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>The first form gives a <code>sorry : ‚Ñù</code> that's unique to <code>multiDist</code>, so the gotcha is <code>multiDist</code> is a constant function. The second form makes <code>multiDist</code> a parameterized family of <code>sorry</code>s, so if the arguments are different the <code>sorry</code> is different, so to speak.</p>\n<p>It should be possible to make a <code>definition_wanted</code> macro that does the transformation into the correct form.</p>\n<p>Something that might also be helpful is this macro</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">macro</span><span class=\"w\"> </span><span class=\"s2\">\"sorry \"</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"o\">:</span><span class=\"n\">arg</span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">ty</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"bp\">.</span><span class=\"n\">foldrM</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">init</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"o\">)))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">ty</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">ty</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"bp\">`</span><span class=\"o\">((</span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">ty</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">args</span><span class=\"bp\">*</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>to let you specify what the <code>sorry</code> is supposed to depend on.</p>\n<p>For example,</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">multiDist</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"o\">:</span><span class=\"n\">‚Ñï</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Œ©</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hŒ©</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">:</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">MeasureSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ©</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ©</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">Œ©</span><span class=\"w\"> </span><span class=\"n\">hŒ©</span><span class=\"w\"> </span><span class=\"n\">X</span>\n</code></pre></div>\n<p>This is a manual version of Gabriel's <code>sorry*</code>.</p>",
        "id": 488531917,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1733965281
    },
    {
        "content": "<p>Will the last macro also be in core? If not, then we should probably add it to <code>mathlib</code>.</p>",
        "id": 488545147,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1733974869
    },
    {
        "content": "<p>That last macro is not part of <a href=\"https://github.com/leanprover/lean4/pull/5757\">lean#5757</a>, no.</p>",
        "id": 488546388,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733975798
    }
]