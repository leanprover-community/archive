[
    {
        "content": "<p>There are few theorems which relates <code>Measure</code> or <code>Integral</code> with <code>WithLp (\\a \\times \\b)</code>. One notable example is the integral in the product <code>WithLp</code> space:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">MeasureTheory</span>\n\n<span class=\"c1\">-- Fubini's theorem on `WithLp` space</span>\n<span class=\"c1\">-- This is not good as the theorem uses `MeasureTheory.Measure.prod`.</span>\n<span class=\"c1\">-- Instead `hf` should use a product of measures designed for `WithLp`.</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">WithLp</span><span class=\"bp\">.</span><span class=\"n\">integral_prod</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MeasurableSpace</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MeasurableSpace</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ENNReal</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fact</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)]</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Measure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithLp</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SFinite</span><span class=\"w\"> </span><span class=\"n\">μ</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">ν</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Measure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithLp</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SFinite</span><span class=\"w\"> </span><span class=\"n\">ν</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithLp</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithLp</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">WithLp</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Integrable</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">μ</span><span class=\"bp\">.</span><span class=\"n\">prod</span><span class=\"w\"> </span><span class=\"n\">ν</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithLp</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithLp</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">WithLp</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)),</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">∂</span><span class=\"n\">μ</span><span class=\"bp\">.</span><span class=\"n\">prod</span><span class=\"w\"> </span><span class=\"n\">ν</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">    </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithLp</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithLp</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">∂</span><span class=\"n\">ν</span><span class=\"w\"> </span><span class=\"bp\">∂</span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">integral_prod</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">hf</span>\n</code></pre></div>\n<p>I strongly believe that removing the diamond is necessary to prove theorems about <code>EuclideanSpace</code> without similar problems.</p>",
        "id": 509087613,
        "sender_full_name": "Jihoon Hyun",
        "timestamp": 1743387459
    },
    {
        "content": "<p>There was a recent discussion of this topic.</p>",
        "id": 509088633,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743388008
    },
    {
        "content": "<p>What exactly are you trying to prove?</p>",
        "id": 509088804,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743388099
    },
    {
        "content": "<p>What are <code>α</code> and <code>β</code> in the case you care about?</p>",
        "id": 509088882,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743388151
    },
    {
        "content": "<p>It's strange to see <code>WithLp p (WithLp p α × WithLp p β)</code>. Does it naturally appear in some context?</p>",
        "id": 509088911,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743388176
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Lacking.20theorems.20involving.20.60Measure.60.2C.20.60Prod.60.20and.20.60WithLp.60/near/509088911\">말함</a>:</p>\n<blockquote>\n<p>It's strange to see <code>WithLp p (WithLp p α × WithLp p β)</code>. Does it naturally appear in some context?</p>\n</blockquote>\n<p>This happens when multiplying two Euclidean spaces, so <code>WithLp p _</code> are <code>PiLp</code>s.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Lacking.20theorems.20involving.20.60Measure.60.2C.20.60Prod.60.20and.20.60WithLp.60/near/509088804\">말함</a>:</p>\n<blockquote>\n<p>What exactly are you trying to prove?</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"242240\">@Jineon Baek</span> , <span class=\"user-mention\" data-user-id=\"870984\">@Jaehyeon Seo</span> , <span class=\"user-mention\" data-user-id=\"471358\">@Hyojae Lim</span> , I, and several others are currently formalizing the Brunn-Minkowski theorem <a href=\"https://github.com/Brunn-Minkowski-in-Lean/BrunnMinkowski\">here</a>. Specifically, I'm proving the Prekopa-Leindler theorem, which uses the induction on dimension of Euclidean space. However I'm having a hard time proving it, mainly due to integrals and products of <code>EuclideanSpace</code>. As the formalization is almost done except my part, I'm asking if more helper theorems about <code>WithLp</code> (or <code>EuclideanSpace</code>) involving <code>Prod</code> and <code>Measure</code> can be proved.</p>",
        "id": 509090357,
        "sender_full_name": "Jihoon Hyun",
        "timestamp": 1743389064
    },
    {
        "content": "<p>Re: strange <code>WithLp</code>s: I see.</p>",
        "id": 509091709,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743390016
    },
    {
        "content": "<p>What measure on <code>WithLp</code> do you have (coming from other parts of your construction)?</p>",
        "id": 509091747,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743390049
    },
    {
        "content": "<p>Is it <code>volume</code> on <code>EuclideanSpace</code>?</p>",
        "id": 509091766,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743390060
    },
    {
        "content": "<p>If yes, then you need a lemma saying that this measure is equal to the product of <code>volume</code>s.</p>",
        "id": 509091839,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743390114
    },
    {
        "content": "<p>(probably, with some no-op <code>Measure.map</code>s here and there)</p>",
        "id": 509091895,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743390127
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Lacking.20theorems.20involving.20.60Measure.60.2C.20.60Prod.60.20and.20.60WithLp.60/near/509091766\">말함</a>:</p>\n<blockquote>\n<p>Is it <code>volume</code> on <code>EuclideanSpace</code>?</p>\n</blockquote>\n<p>Yes, and the only measure appearing in the theorem is <code>volume</code> (whatever the type is).</p>",
        "id": 509091919,
        "sender_full_name": "Jihoon Hyun",
        "timestamp": 1743390142
    },
    {
        "content": "<p>Then you need the following statement: if <code>E</code> and <code>F</code> are finite dimensional inner product spaces, then the volume on <code>WithLp 2 (E × F)</code> is the product of their <code>volume</code>s.</p>",
        "id": 509092005,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743390199
    },
    {
        "content": "<p>(up to a <code>map</code> along <code>WithLp.equiv</code>)</p>",
        "id": 509092032,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743390219
    },
    {
        "content": "<p>It would be nice to have a similar statement about <code>PiLp</code> of a family of inner product spaces too.</p>",
        "id": 509092119,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743390252
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Lacking.20theorems.20involving.20.60Measure.60.2C.20.60Prod.60.20and.20.60WithLp.60/near/509092005\">말함</a>:</p>\n<blockquote>\n<p>Then you need the following statement: if <code>E</code> and <code>F</code> are finite dimensional inner product spaces, then the volume on <code>WithLp 2 (E × F)</code> is the product of their <code>volume</code>s.</p>\n</blockquote>\n<p>That's one of the lemmas I was looking for. As you suggested, I'll try to prove that again, but wouldn't that lead to the diamond?</p>",
        "id": 509092546,
        "sender_full_name": "Jihoon Hyun",
        "timestamp": 1743390537
    },
    {
        "content": "<p>E.g., you can choose an orthonormal basis in each space, then use them to construct an orthonormal basis on the product space. Both measures are Haar measures, and they will be equal to one on the parallelepiped corresponding to this basis, hence they're equal.</p>",
        "id": 509092598,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743390563
    },
    {
        "content": "<p>There is no diamond here, as <code>E × F</code> and <code>WithLp 2 (E × F)</code> are different spaces for the typeclass search.</p>",
        "id": 509092705,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743390606
    },
    {
        "content": "<p>(and I think that we should turn <code>WithLp</code> into a 1-field <code>structure</code>)</p>",
        "id": 509092733,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743390626
    },
    {
        "content": "<p>How about making a product which we are able to set the norm, and define the (currently normal) product as a specialization with an infinite norm?</p>",
        "id": 509100708,
        "sender_full_name": "Jihoon Hyun",
        "timestamp": 1743396444
    },
    {
        "content": "<p>How will it help? The volume on a euclidean space comes from an unspecified orthonormal basis.</p>",
        "id": 509101975,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743397198
    },
    {
        "content": "<p>I thought about it for a bit, and now I also think that my idea above won't help much.</p>",
        "id": 509825918,
        "sender_full_name": "Jihoon Hyun",
        "timestamp": 1743645385
    },
    {
        "content": "<p>We need the Prod version of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=PiLp.volume_preserving_equiv#doc\">docs#PiLp.volume_preserving_equiv</a></p>",
        "id": 509826113,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1743645515
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Lacking.20theorems.20involving.20.60Measure.60.2C.20.60Prod.60.20and.20.60WithLp.60/near/509092733\">말함</a>:</p>\n<blockquote>\n<p>(and I think that we should turn <code>WithLp</code> into a 1-field <code>structure</code>)</p>\n</blockquote>\n<p>So is there a plan to refactor <code>WithLp</code> and eventually remove a diamond?<br>\nThis diamond will appear as mathlib grows, and if there is a clear insight that instance problems will disappear after the refactorization, then I'd like to work on it soon.</p>",
        "id": 511076232,
        "sender_full_name": "Jihoon Hyun",
        "timestamp": 1744174908
    },
    {
        "content": "<p>Making it a structure will not affect whether there is a diamond in mathlib, it will only make it harder for end users to introduce the diamond themselves by accident</p>",
        "id": 511103250,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744185789
    },
    {
        "content": "<p>Also, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=PiLp.volume_preserving_equiv#doc\">docs#PiLp.volume_preserving_equiv</a> should be generalized to an indexed product of any inner product spaces, not necessarily <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi mathvariant=\"double-struck\">R</mi><mi>n</mi></msup></mrow><annotation encoding=\"application/x-tex\">\\mathbb R^n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span></span></span></span></span></span></span>.</p>",
        "id": 511753333,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1744415782
    }
]