[
    {
        "content": "<p>I noticed that <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=PosMulMono.toCovariantClass#doc\">docs#PosMulMono.toCovariantClass</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=PosMulMono.to_covariantClass_pos_mul_le#doc\">docs#PosMulMono.to_covariantClass_pos_mul_le</a> are duplicates. One is declared with <code>extends</code> and the other with <code>instance</code>.</p>\n<p>Should the <code>extends</code> be replaced with a <code>def</code>? (in <a href=\"https://github.com/leanprover-community/mathlib4/pull/22090\">#22090</a>, it was changed from an <code>abbrev</code> to an <code>extends</code> by <span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span>)</p>",
        "id": 507087961,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1742510443
    },
    {
        "content": "<p>Dropping the explicit <code>instance</code> one would be consistent with the goal of <a href=\"https://github.com/leanprover-community/mathlib4/pull/22090\">#22090</a></p>",
        "id": 507091157,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1742512254
    },
    {
        "content": "<p>The goal of <a href=\"https://github.com/leanprover-community/mathlib4/pull/22090\">#22090</a> was to stop <code>PosMulMono</code> from unfolding into <code>CovariantClass ..</code> during type class search. This goal is also achieved if we use a <code>def</code> instead of an <code>abbrev</code></p>",
        "id": 507091416,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1742512414
    },
    {
        "content": "<p>I'm not sure there is any benefit to using a <code>def</code> though, usually we do that as a compromise when the <code>class</code> is too problematic</p>",
        "id": 507093453,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1742513559
    },
    {
        "content": "<p>Here I think <span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span> forgot to clean up the duplicate when he introduces the <code>extends</code> instance</p>",
        "id": 507093488,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1742513578
    },
    {
        "content": "<p>I think it's not his fault, because those duplicates were already unnecessary from the start.</p>",
        "id": 507093551,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1742513624
    },
    {
        "content": "<p>Also I didn't realize it isn't possible to mark a <code>def</code> as a <code>class</code>, so keeping the <code>extends</code> instances is the way.</p>",
        "id": 507093879,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1742513782
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479299\">Jovan Gerbscheid</span> <a href=\"#narrow/channel/287929-mathlib4/topic/duplicate.20instances.20of.20.60PosMulMono.60.20and.20friends/near/507093551\">said</a>:</p>\n<blockquote>\n<p>I think it's not his fault, because those duplicates were already unnecessary from the start.</p>\n</blockquote>\n<p>I would guess then that actually that PR was unecessary (but perhaps a good idea anyway), and the performance issue is the instance you identified.</p>",
        "id": 507096803,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1742515492
    },
    {
        "content": "<p>The performance issue was that <code>CovariantClass α≥0 α (fun x y =&gt; y * x) (· ≤ ·)</code> has bad discrimination tree keys, and this problem was definitely resolved by that PR.</p>\n<p>Though there is a chance that removing these extra instances will also give a performace improvement.</p>",
        "id": 507097206,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1742515690
    },
    {
        "content": "<p>(if I remember correctly)</p>",
        "id": 507097304,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1742515756
    },
    {
        "content": "<p>Oh, one instance is talking about the type <code>α≥0</code> and the other about <code>α&gt;0</code>, my mistake.</p>",
        "id": 507103790,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1742519503
    }
]