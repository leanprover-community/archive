[
    {
        "content": "<p>I recently <a href=\"https://github.com/leanprover-community/mathlib4/pull/25417#discussion_r2127908093\">encountered</a> that Mathlib doesn't provide a Module over the reals, given a module over RCLike.</p>\n<p>This instance is totally possible, but before PRing I wanted to make sure that it wasn't deliberately omitted for some reason. More broadly, the fact that an <code>Algebra A B</code> and <code>Module B C</code> is enough to get a <code>Module A C</code> seems absent from Mathlib, which is a lot more surprising, and I wonder if I'm missing some more general version</p>",
        "id": 522644579,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1749146340
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">Module</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommSemiring</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÅ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÇ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÇ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n\n<span class=\"c1\">--Can't be instance because it depends on R‚ÇÇ, so there's no instantiation order</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">of_Algebra_Module</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">smul</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">algebraMap</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">e</span>\n<span class=\"w\">  </span><span class=\"n\">zero_smul</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">algebraMap</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÇ</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"n\">one_smul</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">algebraMap</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÇ</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"n\">smul_zero</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">smul_zero</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">  </span><span class=\"n\">smul_add</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">smul_add</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">  </span><span class=\"n\">mul_smul</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">algebraMap</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">algebraMap</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">algebraMap</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">map_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_smul</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">add_smul</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">algebraMap</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">algebraMap</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">algebraMap</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">map_add</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">add_smul</span><span class=\"o\">]</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">of_Algebra_Module_smul</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÅ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">of_Algebra_Module</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÇ</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">algebraMap</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">of_Algebra_Module_smul_one</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÅ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">of_Algebra_Module</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÇ</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R‚ÇÇ</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">of_Algebra_Module_smul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">algebraMap_eq_smul_one</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">]</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Module</span>\n\n<span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">RCLike</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">RCLike</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">error: failed to synthesize</span>\n<span class=\"sd\">  Module ‚Ñù E</span>\n\n<span class=\"sd\">Additional diagnostic information may be available using the `set_option diagnostics true` command.</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"n\">E</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">of_Algebra_Module</span><span class=\"w\"> </span><span class=\"n\">ùïú</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">RCLike</span><span class=\"bp\">.</span><span class=\"n\">real_smul_Module</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsScalarTower</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">smul_assoc</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">RCLike</span><span class=\"bp\">.</span><span class=\"n\">real_smul_eq_coe_mul</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_smul</span><span class=\"o\">]</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ContinuousSMul</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ContinuousSMul</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">continuous_smul</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">continuous_smul</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"bp\">√ó</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">algebraMap</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"n\">fun_prop</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">RCLike</span>\n</code></pre></div>",
        "id": 522644601,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1749146351
    },
    {
        "content": "<p>This is <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=RestrictScalars.module#doc\">docs#RestrictScalars.module</a> or similar</p>",
        "id": 522645019,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749146502
    },
    {
        "content": "<p>Or more generally, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Module.compHom#doc\">docs#Module.compHom</a></p>",
        "id": 522645155,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749146541
    },
    {
        "content": "<p>Ah, there we go, thanks. <br>\nWell, the RCLike one still seems good to have, should I PR it?</p>",
        "id": 522646097,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1749146885
    },
    {
        "content": "<p>No, it's not good, because when <code>ùïú = ‚Ñù</code> (which is definitely possible), it would give a second non-defeq instance of <code>Module ‚Ñù E</code>.</p>",
        "id": 522646792,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1749147144
    },
    {
        "content": "<p>Ohh right.<br>\nShoot</p>",
        "id": 522646923,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1749147201
    },
    {
        "content": "<p>Okay, so if I'm doing a proof where I need the real module structure on E from the k-module structure..  I should just locally add the instances I need? Via RestrictScalars.module?</p>",
        "id": 522647253,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1749147346
    },
    {
        "content": "<p>No, you can just do</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 522647352,
        "sender_full_name": "Fr√©d√©ric Dupuis",
        "timestamp": 1749147389
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110050\">S√©bastien Gou√´zel</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60Module.20.E2.84.9D.20E.60.20from.20.60.5BRCLike.20.F0.9D.95.9C.5D.20.5BModule.20.F0.9D.95.9C.20E.5D.60/near/522646792\">said</a>:</p>\n<blockquote>\n<p>No, it's not good, because when <code>ùïú = ‚Ñù</code> (which is definitely possible), it would give a second non-defeq instance of <code>Module ‚Ñù E</code>.</p>\n</blockquote>\n<p>Would it be non-defeq? Which part fails to unify?</p>",
        "id": 522647470,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1749147432
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"311453\">Fr√©d√©ric Dupuis</span> <a href=\"#narrow/stream/287929-mathlib4/topic/.60Module.20.E2.84.9D.20E.60.20from.20.60.5BRCLike.20.F0.9D.95.9C.5D.20.5BModule.20.F0.9D.95.9C.20E.5D.60/near/522647352\">said</a>:</p>\n<blockquote>\n<p>No, you can just do</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Oh. Yes that makes sense. Silly me haha</p>",
        "id": 522647981,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1749147669
    },
    {
        "content": "<p>Don't forget the <code>[IsScalarTower ‚Ñù ùïú E]</code></p>",
        "id": 522651783,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1749149246
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60Module.20.E2.84.9D.20E.60.20from.20.60.5BRCLike.20.F0.9D.95.9C.5D.20.5BModule.20.F0.9D.95.9C.20E.5D.60/near/522647470\">said</a>:</p>\n<blockquote>\n<p>Would it be non-defeq?</p>\n</blockquote>\n<p>You'd have to convince yourself this for every possible choice of <code>E</code>, each of which implements the instance in a way of its choosing</p>",
        "id": 522653569,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749150081
    },
    {
        "content": "<p>If your <em>statement</em> does not involve the reals, it's definitely better to introduce the real structure as an auxiliary device in the proof.</p>",
        "id": 522653622,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1749150109
    },
    {
        "content": "<p>Ah, okay. Yeah, this would be entirely interior to the proof</p>",
        "id": 522659396,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1749152802
    },
    {
        "content": "<p>I checked, it actually seems like <a href=\"https://live.lean-lang.org/#codez=JYWwDg9gTgLgBAWQIYwBYBtgCMBQODOApgMYzAQB2iEAJgK7qF4BuSUwSWjcA3gEqBAgjgBROAC44AFQCeYQgCoAvnAAUfQEEE4qbIUBKOAG0AwhBAgAyoRDB2FAOZxBAXUOXrthxpcGAgujuEWFBIjkJehj40NCZmCJQQwDQi3nH03BrJeAC0WUZIFADk8FiEcMAU+DD5xKUlxEh0RGXwNIRyFDT4cJSO6gA0cPgQcGiEUIQFXRTD5ZX5ZCjkVNCtUDitAGbUaYQAdBAbAPp+AUFIh6kMpRKX6UKiAO6oY0xwgyAMcFBw1wC8qkh/IFgsgwKFel99IAiAh+ODeAC8xhBDvgPugfuJ/vhUBAHgCgWdQeCMgAGaEY/4kuBYaSDUBgOHdCiEFFojFiLE4vEqQGnEFIMGCCEARnJpX+tVp+HpjNRDEOiKgwywmPe8sVw0OsrRhyQUTgAA8MVsOWr0Lr9Yc4FatW8dXL0UbaX9Blz8XykEShRkVEb5HBpLoxXB/jyCfzBWFNAbySowx6vVGA2L9DTGW9peAmehaQYQALDmiBva0U5GXqaKzPk72Zzce7gZ6BcTNL64ABqZPB0O8xuJiExuAw0qd+N95vezSBocYtNvDP07O5/NgC00AYVqvoMs4UbQKzbK77I4nRsXWhXLeqb4SQT6FTXET6MTpuCMeBWm4Xu4iVW3PYHMc4bnP+vQANxfDO4oNoSE5JlAwamnOXwbOgeB7uMICHowx5AR6547FuhyUKUKg3qE96PsIz6vu+1paKBQqiKa/64aeZwEVc4GQcOIbXjOKjCloGhBlBqrIZmYIGKxgHscEnGMFuAxyUguy9rBq6EAAjkRJFfDuhAdNhTAECQZA9HwRgADLAAA1iZrDsJw3A8IArBuADq7v4SDIchKIYlk2fZcAed4kTRKYIBxNMiTJIYoEeZkOAAPQ5DgYxKlAEgbEgwCMEkMDDPg0gUKM0qIoyoGALiEIh4GFwDmRQgJwDQHB2NMlTAMQZQUBs0D5g1cD5rSJRwEgrC5c5pSNOUDijHAAAGRAwMRYADS1SBtRAHXEF0MBQHQhDzXAxARfkNC7DgWRJTgADEdh0GwlYgPgdhdOUt1FSVqDGXA1XCHgsxVBQNSONZdl7IDmAbDA/58IQTVfjsv1ef8MknsBCmlB5eAAAIGJJZYYQeAXg7s4yAkRoFkVolWUVo1FaN8vGhuRHmIf8yFQKhAMVEDIMSAAkvg5j1OgbCSLiYzIwljzPOM2rykg+BDF1NYujSdJZgYJP2WT8Pmg6hzaYcJ0smyTrFvKDo7oD1SlAYEuQOgEB2J1gLmGASAg8I3gmCV5R0BAjTmAgnwyy4Eh+2QFCB8Hofon9cBPC8jInf7MdB/gV5IdIr4CmAObHZQ0ex1nDq7CdWYqAAGqq1UAOtPqoJr/BsdBUEagBlhDBEbS55Bq7MKAwDwATEGr5txQhxgEqDJpUZOsmTkkjPF8hD4Aw0cOCA37r0yv5sKUmzabuzz7lhMDrzAcNNTwzHaL5yi+FEMSRfEMU+4YWBK4QAu8wxu9kafwkN/Igf9Kh8UXrsSGwBoaw31qoBKppabiVzm8LmaFLpZDmgAIjmB0R6ODur4JBoAIEJRpdBCDvJGEBmBS2qsALox8tIjGGFDLeIxV7zVAuQ0hR0CoLSqnAPhAwCoQFPoQc+Iwr4xALoQI0EhAZ/2ZFAAACkqegpAPZe0IDfdAsjGADwKqBf4UCYFwN3noxBnlkHPg5mglCaEgA\">they are all</a> defeq:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">--The resulting modules on E are defeq</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">testReal</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">baseInst</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">baseInst</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">RCLike</span><span class=\"bp\">.</span><span class=\"n\">instliftModuleReal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n\n<span class=\"c1\">--the \"standard\" instance ‚ÑÇ as a module over ‚Ñù is defeq to lifting the `Module ‚ÑÇ ‚ÑÇ` to `Module ‚Ñù ‚ÑÇ`, too</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">testComplex</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">instInnerProductSpaceRealComplex</span><span class=\"bp\">.</span><span class=\"n\">toModule</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">    </span><span class=\"n\">RCLike</span><span class=\"bp\">.</span><span class=\"n\">instliftModuleReal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n</code></pre></div>",
        "id": 522673151,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1749159633
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 522674862,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749160568
    },
    {
        "content": "<p>That's a good start, but isn't enough to demonstrate no diamonds.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">testArbitraryEWithExistingModule</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">‚Äπ</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"bp\">‚Ä∫</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">RCLike</span><span class=\"bp\">.</span><span class=\"n\">instliftModuleReal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"c1\">-- this is not rfl in the general case, you have to check every value of `E` separately.</span>\n</code></pre></div>\n<p>demonstrates that you can't demonstrate this without exhaustively enumerating all complex-module structures in mathlib</p>",
        "id": 522675175,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749160784
    },
    {
        "content": "<p><del>(the above is almost certainly true propositionally, at least)</del></p>",
        "id": 522675244,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749160819
    }
]