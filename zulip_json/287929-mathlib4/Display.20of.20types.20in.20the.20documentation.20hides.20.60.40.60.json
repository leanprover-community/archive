[
    {
        "content": "<p>For exampe, <a href=\"https://github.com/leanprover-community/mathlib4/blob/8fb3ba5590417b2c6ef947c8de206a5dde10aa63/Mathlib/Topology/Order.lean#L596\">nhds_mono</a> is defined as </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">nhds_mono</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">t₁</span><span class=\"w\"> </span><span class=\"n\">t₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t₁</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">t₂</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">     </span><span class=\"bp\">@</span><span class=\"n\">nhds</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">t₁</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">nhds</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">t₂</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n</code></pre></div>\n<p>but the <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Topology/Order.html#nhds_mono\">docs</a> display it as</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">nhds_mono</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">t₁</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">t₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t₁</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">t₂</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">nhds</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">nhds</span><span class=\"w\"> </span><span class=\"n\">a</span>\n</code></pre></div>\n<p>Is it \"obvious from the context\" (not the same as \"can be figured out from the context\") what the two sides of the comparison mean here and everything is as it should be? Or is this unfortunate but a tradeoff that must be accepted? Or could this be improved?</p>",
        "id": 451508691,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1721052487
    },
    {
        "content": "<p>This is a limitation of the pretty printer. The <code>@</code> annotation is not preserved during elaboration, and the pretty printer would have to guess to make certain arguments explicit. Printing it as <code>nhds a ≤ nhds a</code> is wrong, but a human reader might be able to figure out what it's supposed to be.</p>\n<p>Potentially the pretty printer could guess to make <code>@nhds α t₁ a</code> explicit since <code>nhds a</code> elaborates to <code>@nhds α t₂ a</code></p>",
        "id": 451536573,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1721059960
    },
    {
        "content": "<p>How about this heuristic: if an argument <code>a</code> of a function <code>f</code> does not appear in any later argument of <code>f</code>, then it should be displayed explicitly. This would make <code>t₁</code> and <code>t₂</code> above explicit, but not <code>α</code>.</p>\n<p>I imagine this heuristic might be overzealous in some situations, but it is at least always clear.</p>",
        "id": 451544235,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1721061529
    },
    {
        "content": "<p>That would make <code>a + b</code> print as <code>@HAdd.hAdd _ _ _ someInstExpression a b</code>, right?</p>",
        "id": 451566399,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1721064972
    },
    {
        "content": "<p>True, add an exception for instance arguments. <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 451571875,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1721065818
    },
    {
        "content": "<p>But isn't the case in the OP an instance argument?</p>",
        "id": 451572665,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1721065954
    },
    {
        "content": "<p>The Ideal Algorithm would be to resynthesize each instance argument to obtain the canonical instance, and then checking whether the provided instance is defeq to the canonical one. However, this would make pretty printing a lot slower.</p>\n<p>I could see doing an approximation for <em>just</em> local instances. It'd help a lot with this Order module.</p>",
        "id": 451574928,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1721066329
    }
]