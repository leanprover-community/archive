[
    {
        "content": "<p>Suppose we are given two comm rings (or whatever) <code>R</code> and <code>S</code>, together with a ring hom <code>σ : R →+* S</code>. Fix also an <code>R</code>-module <code>M</code>, an <code>S</code>-module <code>N</code> and an <em>additive</em> map <code>f : M →+ N</code> that is <code>σ</code>-semilinear.</p>\n<p>Given any submodule <code>p ⊆ M</code>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Submodule.map#doc\">docs#Submodule.map</a> defines its image as a submodule of <code>N</code>, <em>under the assumption</em> that  <code>σ</code> is surjective. This is in contrast with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Ideal.map#doc\">docs#Ideal.map</a>, that defines the (ideal structure on the) image of an ideal simply by taking the span of the image. The reason is clear: if we want to define the carrier as simply being the image, we need surjectivity of the ring hom to ensure that the gadget is smul-closed.  On the other hand, it is very easy to prove that if we rather define <code>p.map f</code> to be <code>Submodule.span S (f '' p)</code>, this is always well defined and coincides with the current definition in the case that <code>σ</code> is surjective.</p>\n<p>So I wonder why the definition was chosen to be as it is and if we should not revert things.</p>\n<p>Let me add that reverting things would need to add the <code>import Mathlib.LinearAlgebra.Span.Defs</code>to <code>Mathlib.Algebra.Module.Submodule.Map</code> but this seems hardly problematic. Also, the copyright dates back to 2017, so there might simply be a historical reason.</p>",
        "id": 561848817,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1764846258
    },
    {
        "content": "<p>I think we care a little about the carrier being defea to set image</p>",
        "id": 561850686,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764846889
    },
    {
        "content": "<p>Well, I'm not 100% convinced. I agree this could be nice, but the price we're paying is too high especially since we've developped a good deal of the linear algebra library using semilinear maps, and for something as basic as the image of a submodule we need to add surjectivity...</p>",
        "id": 561855713,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1764848534
    },
    {
        "content": "<p>I agree it would be nice to change the definition. The only way to know if there are places where the defeq is important is to try the refactor!</p>",
        "id": 561862376,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1764850558
    },
    {
        "content": "<p>OK, I'm happy then to start and try it.</p>",
        "id": 561869550,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1764852627
    },
    {
        "content": "<p>I think the reason is historical: for ideals it is clear that you need the span, as you point out. But in the \"ordinary case\" where <code>M</code> and <code>N</code> are two <code>R</code>-modules, and <code>\\sigma = id</code>, then you don't need the span. And that's the case that is basically always treated in the informal literature.</p>\n<p>I think this is a cool realization. I for one always thought that \"ideals are just submodules of the ring itself\" was a slightly bad heuristic because of \"yes, but <code>map</code> is different\"!</p>\n<p>But you are telling me that <code>map</code> shouldn't be different at all! I like that.</p>",
        "id": 561871444,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1764853153
    },
    {
        "content": "<p>I 100% agree with <span class=\"user-mention\" data-user-id=\"112680\">@Johan Commelin</span> ! I used a lot that part of the library, and if we are able to get rid of <code>Ideal.map</code> (in the sense that it becomes a special case of <code>Submodule.map</code>) it would be great!</p>",
        "id": 561872220,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1764853391
    },
    {
        "content": "<p>OK, just to sum up: <span class=\"user-mention\" data-user-id=\"112680\">@Johan Commelin</span> and <span class=\"user-mention\" data-user-id=\"130384\">@Riccardo Brasca</span> you also agree if I start the refactor (and in particular refactor <code>Ideal.map</code> to be a special case)?</p>",
        "id": 561872512,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1764853468
    },
    {
        "content": "<p>I'm working on the refactor: following what has recently been agreed upon concerning morphism hierarchy, I am planning to change the variable</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SemilinearMapClass</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">σ₁₂</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"n\">M₂</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>to <code>variable (f : M →ₛₗ[σ₁₂] M₂)</code> in all definitions and in all lemmas that actually coerce, in their statement, <code>f : F</code> to something else than a bare function (e.g. to either a semilinear map, or to an additive one), like <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Submodule.mem_map#doc\">docs#Submodule.mem_map</a> or <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Module/Submodule/Map.html#MonoidHom.coe_toAdditive_map\">MonoidHom.coe_toAdditive_map</a>. On the other hand, I can keep/reintroduce the class variable in things like <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Module/Submodule/Map.html#Submodule.apply_coe_mem_map\">Submodule.apply_coe_mem_map</a>. Is this OK?</p>",
        "id": 563900347,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1765825376
    },
    {
        "content": "<p>No, <code>Submodule.apply_coe_mem_map</code> has <code>f</code> appearing in <code>Submodule.map</code>. Therefore it must be <code>f : M →ₛₗ[σ₁₂] M₂</code>.</p>",
        "id": 563904406,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1765825679
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"300245\">Filippo A. E. Nuccio</span> <a href=\"#narrow/channel/287929-mathlib4/topic/on.20the.20definition.20of.20Submodule.2Emap/near/561848817\">said</a>:</p>\n<blockquote>\n<p>On the other hand, it is very easy to prove that if we rather define <code>p.map f</code> to be <code>Submodule.span S (f '' p)</code>,</p>\n</blockquote>\n<p>If we did this, then presumably we would not even require that <code>f</code> is a bundled function?</p>",
        "id": 563904638,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1765825773
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/on.20the.20definition.20of.20Submodule.2Emap/near/563904638\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"300245\">Filippo A. E. Nuccio</span> <a href=\"#narrow/channel/287929-mathlib4/topic/on.20the.20definition.20of.20Submodule.2Emap/near/561848817\">said</a>:</p>\n<blockquote>\n<p>On the other hand, it is very easy to prove that if we rather define <code>p.map f</code> to be <code>Submodule.span S (f '' p)</code>,</p>\n</blockquote>\n<p>If we did this, then presumably we would not even require that <code>f</code> is a bundled function?</p>\n</blockquote>\n<p>Oh right!</p>",
        "id": 563914836,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1765829206
    }
]