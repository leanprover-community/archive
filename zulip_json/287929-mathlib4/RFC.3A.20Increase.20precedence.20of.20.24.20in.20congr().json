[
    {
        "content": "<p>I often find myself wanting to turn an equality <code>h : a = b</code> into a new equality <code>h' : a.foo = b.foo</code>. <code>congr()</code> is an amazing tool for this, except that its syntax is quite disappointing when it comes to projections: One cannot simply write <code>congr($h.foo)</code> as it gets parsed as <code>congr($(h.foo))</code> but instead one needs the slightly mouthful <code>congr(($h).foo)</code>.</p>",
        "id": 545747989,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1760785492
    },
    {
        "content": "<p>There are very few times where one would quote a proof with dots in (in fact, it has yet to happen to me!). The cases I can think of are:</p>\n<ol>\n<li>Lemmas with dot notation with a single argument and which returns an equality. The only such lemma I can find is <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Eq.symm#doc\">docs#Eq.symm</a>.</li>\n<li>Declarations proving an equality in an unopened namespace. Empirically, it seems to be very rare to want to quote a global declaration, probably because <code>congr()</code> is a great way to prove easy corollaries, and easy corollaries of existing declarations in mathlib are usually already stated next to them.</li>\n</ol>",
        "id": 545748456,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1760785734
    },
    {
        "content": "<p>Therefore I would like to suggest swapping the precedence of <code>$</code> and <code>.</code> in <code>congr()</code>. What do people think? Concretely, here's an example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Factorial</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">TermCongr</span>\n\n<span class=\"c1\">-- works, but so many brackets!</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"n\">factorial</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">factorial</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">congr</span><span class=\"o\">((</span><span class=\"bp\">$</span><span class=\"n\">h</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">factorial</span><span class=\"o\">)</span>\n\n<span class=\"c1\">-- doesn't work, but I would like it to</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"n\">factorial</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">factorial</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">congr</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">factorial</span><span class=\"o\">)</span>\n<span class=\"c\">/-</span>\n<span class=\"cm\">Invalid field `factorial`: The environment does not contain `Eq.factorial`</span>\n<span class=\"cm\">  h</span>\n<span class=\"cm\">has type</span>\n<span class=\"cm\">  m + 1 = n + 1</span>\n<span class=\"cm\">-/</span>\n</code></pre></div>",
        "id": 545748618,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1760785885
    },
    {
        "content": "<p>well, personal experience is not a good indicator, can you search <code>/congr\\(.+\\$\\w+\\.\\w+/</code> vs <code>/congr\\(.+\\$\\w+\\)\\.\\w+/</code> on github?</p>",
        "id": 545751389,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760788994
    },
    {
        "content": "<p>I think it would be confusing to change the precedence in <code>congr()</code> without also doing other antiquotations like <code>q()</code> and <code> `() </code></p>",
        "id": 545751549,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1760789156
    },
    {
        "content": "<p>(which makes this a Lean RFC)</p>",
        "id": 545751579,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1760789180
    }
]