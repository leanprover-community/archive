[
    {
        "content": "<p>Hello! I'm trying to show this lemma holds of a finite set, and was wondering if there are some useful Mathlib theorems or lemmas (the \"API\" of Mathlib in some sense) to prove this with? I'm also not sure what's the best way to identify which parts of Mathlib will help me with this lemma below, and also was wondering if anyone has any pointers on how navigate Mathlib for this. </p>\n<p>This is the idea of what I want to show: </p>\n<p>Consider a finite set <code>s</code> of <code>n</code> number of elements <code>x</code> that satisfy Prop <code>p</code>. If I know that from Prop <code>q</code> on <code>x</code>, I have <code>p</code> on <code>x</code> (<code>q x -&gt; p x</code>, a potentially stricter restriction <code>q</code>), then I want to show the set <code>t</code> of <code>x</code> where <code>x</code> satisfies Prop <code>q</code> is a finite set of <code>m</code> elements that is either less than or equal to <code>n</code>. </p>\n<p>And this is the lemma in a MWE left open: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">equiv_fin_impl_equiv_fin'</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">himpl</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">≃</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"o\">({</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">≃</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 526156209,
        "sender_full_name": "An Qi Zhang",
        "timestamp": 1751061365
    },
    {
        "content": "<p>You can use the API around <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Finite#doc\">docs#Finite</a></p>",
        "id": 526157657,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751062568
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"515324\">@An Qi Zhang</span> apart from the above excellent answer, I think I'd be interested to know what the context is.</p>",
        "id": 526160071,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751064904
    },
    {
        "content": "<p>The local context around my question is: <br>\nI have this finite set <code>s</code>, of elements <code>y</code> that satisfy Prop <code>p</code>. I'm now declaring a set <code>t</code> of elements <code>x</code>, where <code>x</code> is in <code>s</code>, and <code>x</code> satisfies a Prop <code>q</code>. I also know any <code>x</code> satisfying Prop <code>q</code> satisfies Prop <code>p</code>, as <code>q</code> has  more restrictions than <code>p</code>. Now because <code>s</code> is finite, <code>t</code> is also finite, since <code>q</code> can only restrict the elements of <code>s</code>.</p>\n<p>The outer context around my question is:<br>\nThis lemma will help me show <code>t</code> is also finite, by using the <code>mpr</code> of <code>finite_iff_exists_equiv_fin</code>. But I need to figure out how to show <code>∃ m, m ≤ n ∧ Nonempty ({x // q x} ≃ Fin m)</code>. Though it's not clear to me from the theorems in <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Finite/Defs.html#Finite\">docs#Finite</a>.</p>\n<p>I want this finite \"subset\" <code>t</code>so I can then convert it into a list, sort it, and reason about the elements in the list.</p>",
        "id": 526166228,
        "sender_full_name": "An Qi Zhang",
        "timestamp": 1751072284
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"515324\">@An Qi Zhang</span> What is the context of the finite set <code>s</code>?</p>",
        "id": 526166251,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751072317
    },
    {
        "content": "<p>I'm asking because for almost any answer you can give me, I'm going to say that <code>Finset</code> is a better option</p>",
        "id": 526166262,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751072341
    },
    {
        "content": "<p>Or <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Set.Finite#doc\">docs#Set.Finite</a></p>",
        "id": 526166279,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751072363
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span>  Consider <code>s</code> to a Trace I'm reasoning about. I don't see an issue with it being a <code>Finset</code>. If I declare it as a <code>Finset</code>, how do I declare a Finset of elements of <code>s</code>? I think if define <code>t</code> with the set builder notation <code>{x | x \\in s}</code> it'll get treated as a Set, and I'm back to square one:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"c1\">-- failed to synthesize Fintype ℕ</span>\n</code></pre></div>",
        "id": 526166777,
        "sender_full_name": "An Qi Zhang",
        "timestamp": 1751072974
    },
    {
        "content": "<p>Do <code>{x ∈ s | condition}</code></p>",
        "id": 526166806,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751073034
    },
    {
        "content": "<p>You still get a <code>Finset Nat</code> out at the end though</p>",
        "id": 526166820,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751073053
    },
    {
        "content": "<p>If you want a <code>Finset s</code> you can do <code>{x : s | condition}</code></p>",
        "id": 526166828,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751073067
    },
    {
        "content": "<p>what do you mean by trace?</p>",
        "id": 526166844,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751073082
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"816344\">@Aaron Liu</span> That works, but if my Type is a subtype (instead of just Nat), then is there a similar analogue to get it to work for a subtype?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">greater</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">}</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">greater</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">greater</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"c1\">-- failed to synthesize Fintype m.greater</span>\n</code></pre></div>",
        "id": 526167335,
        "sender_full_name": "An Qi Zhang",
        "timestamp": 1751073648
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span> Ah I mean a collection/set of operations, that apply/have some effect</p>",
        "id": 526167378,
        "sender_full_name": "An Qi Zhang",
        "timestamp": 1751073700
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"515324\">An Qi Zhang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Show.20set.20with.20stricter.20restriction.20on.20finite.20set.20is.20finite/near/526167335\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> That works, but if my Type is a subtype (instead of just Nat), then is there a similar analogue to get it to work for a subtype?</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">greater</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">}</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">greater</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">greater</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"c1\">-- failed to synthesize Fintype m.greater</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>To compute a <code>Finset</code> you need an \"algorithm\" for listing out all the elements. What's the \"algorithm\" you want to use here?</p>",
        "id": 526167450,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751073802
    },
    {
        "content": "<p>I'm asking because there are two ways you can do this:</p>\n<ul>\n<li>construct <code>t</code>, the <code>Finset</code> of <code>Nat</code>s at most <code>m</code>, then take <code>s</code> and subtract out <code>t</code></li>\n<li>go through <code>s</code> and only keep the elements which are more than <code>m</code>, and discard the rest</li>\n</ul>",
        "id": 526167798,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751074218
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"816344\">@Aaron Liu</span>  Here I don't have an \"algorithm\", I'm assuming the set is <code>Finite</code>, then apply <code>Set.Finite.toFinset</code> to get a Finset (like below). I suppose that means I have to use the second approach? </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">greater</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">}</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Nats</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">ns</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"w\">  </span><span class=\"n\">finite</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finite</span><span class=\"w\"> </span><span class=\"n\">ns</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nats</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">greater</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">greater</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Finite</span><span class=\"bp\">.</span><span class=\"n\">toFinset</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">finite</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"c1\">-- failed to synthesize Fintype m.greater</span>\n</code></pre></div>",
        "id": 526167883,
        "sender_full_name": "An Qi Zhang",
        "timestamp": 1751074339
    }
]