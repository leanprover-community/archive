[
    {
        "content": "<p>I'm trying to bump FLT and this is timing out for me:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">IsDedekindDomain</span><span class=\"w\"> </span><span class=\"n\">HeightOneSpectrum</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsDedekindDomain</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsFractionRing</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HeightOneSpectrum</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span>\n\n<span class=\"c1\">-- w-adic completion of L is a field</span>\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">adicCompletion</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">)</span>\n\n<span class=\"c\">/-</span>\n<span class=\"cm\">(deterministic) timeout at `isDefEq`, maximum number of heartbeats (200000) has been reached</span>\n<span class=\"cm\">-/</span>\n<span class=\"c1\">-- example (a b : adicCompletion L w) : a * b = b * a := mul_comm a b</span>\n\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">CommMagma</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">adicCompletion</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- times out</span>\n</code></pre></div>\n<p>I'm out and about with a laptop and bad internet so I can't check whether this is failing on mathlib master and if so whether it was still failing in v4.15...</p>",
        "id": 494017397,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1736975416
    },
    {
        "content": "<p>Yes, this seems quite bad on master. The boundary seems <code>CommMonoid</code> and <code>CommSemigroup</code></p>",
        "id": 494024992,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1736978545
    },
    {
        "content": "<p>Fails on the web editor (almost master) and on the stable web editor (4.15.0)</p>",
        "id": 494025001,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736978550
    },
    {
        "content": "<p>Removing the heartbeat limits, I cannot get it to return</p>",
        "id": 494025033,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1736978568
    },
    {
        "content": "<p>This seems to be the problematic step:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">adicCompletion</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- OK</span>\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">NonUnitalCommRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">adicCompletion</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- times out</span>\n</code></pre></div>",
        "id": 494029188,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736980388
    },
    {
        "content": "<p>The trace for <code>NonUnitalCommRing</code> ends with</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>  [] üí•Ô∏è apply @NumberField.instNormedFieldValuedAdicCompletion to NormedField (adicCompletion L w) ‚ñº\n  [tryResolve] üí•Ô∏è NormedField (adicCompletion L w) ‚âü NormedField (adicCompletion L ?m.4778)\n</code></pre></div>",
        "id": 494029337,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736980457
    },
    {
        "content": "<p>I wonder whether that huge PR which separates topology from algebra type classes fixes it? I'm quite busy this week because of LT25 :-/</p>",
        "id": 494078184,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1737011046
    },
    {
        "content": "<p>If you want a spot fix, you can de-instance locally or otherwise the one <span class=\"user-mention\" data-user-id=\"479359\">@Michael Stoll</span> references above.</p>",
        "id": 494127121,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1737028686
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/13020\">#13020</a> made <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsDedekindDomain.HeightOneSpectrum.adicCompletion#doc\">docs#IsDedekindDomain.HeightOneSpectrum.adicCompletion</a> an <code>abbrev</code>. It didn't change any of the instances below, eg <code>Field</code>, which can now be <code>inferInstance</code>. Was there a reason for this?</p>",
        "id": 494153150,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1737035983
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/20796\">#20796</a> seems to fix things.</p>",
        "id": 494170733,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1737040335
    },
    {
        "content": "<p>Can you test against the FLT bump branch?</p>",
        "id": 494182652,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1737043513
    },
    {
        "content": "<p>Not until later, maybe tomorrow at the worst</p>",
        "id": 494182798,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1737043555
    },
    {
        "content": "<p>In theory you just need to sprinkle <code>dsimp only [adicCompletion]</code> for anything that breaks. If you want a low-thought-expenditure \"fix\"</p>",
        "id": 494184346,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1737043977
    },
    {
        "content": "<p>Many thanks Matt! I really don't have much time this week because of trying to do my job and running LT24 and moving my daughter back to college so there is definitely no hurry here. It will be top priority for me on Monday.</p>",
        "id": 494187698,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1737044857
    },
    {
        "content": "<p>Thanks! I've got BaseChange.lean compiling in FLT, will push in a bit</p>",
        "id": 494336846,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1737112290
    },
    {
        "content": "<p><a href=\"https://github.com/ImperialCollegeLondon/FLT/pull/313\">FLT#313</a></p>",
        "id": 494341307,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1737113919
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/adic.20completion.20is.20commutative/near/494078184\">said</a>:</p>\n<blockquote>\n<p>that huge PR which separates topology from algebra type classes fixes it?</p>\n</blockquote>\n<p>Do you mean analysis (<code>NormedAddCommGroup</code> etc) from algebra typeclasses? I think topology and algebra are already separate</p>",
        "id": 494357280,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1737119362
    },
    {
        "content": "<p>While the patch is principled, Lean shouldn't be crashing out on this synthesis problem.</p>",
        "id": 494364275,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1737121555
    }
]