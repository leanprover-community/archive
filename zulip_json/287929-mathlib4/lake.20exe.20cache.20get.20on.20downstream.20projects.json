[
    {
        "content": "<p>I am on <a href=\"https://github.com/plp127/combinatorial-games\">my fork</a> of the <a href=\"https://github.com/vihdzp/combinatorial-games\">combinatorial games repo</a>. I want to get the mathlib cache so I don't have to build mathlib myself.<br>\nI ran <code>lake exe cache get</code> and it printed the error</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>info: mathlib: checking out revision '3675c9af6ec591616ef1e99f6046fd8e52d133eb'\nerror: external command 'git' exited with code 128\n</code></pre></div>\n<p>I ran lake clean and it printed the error</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>error: external command 'git' exited with code 128\n</code></pre></div>\n<p>I deleted the <code>.lake</code> file and ran <code>lake exe cache get</code> again and got</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>info: mathlib: URL has changed; you might need to delete 'C:\\Users\\aaron\\lean\\combinatorial-games\\.lake/packages\\mathlib' manually\ninfo: mathlib: checking out revision '3675c9af6ec591616ef1e99f6046fd8e52d133eb'\nerror: external command 'git' exited with code 128\n</code></pre></div>\n<p>I ran <code>lake clean</code> again and got</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>info: mathlib: URL has changed; you might need to delete 'C:\\Users\\aaron\\lean\\combinatorial-games\\.lake/packages\\mathlib' manually\ninfo: mathlib: checking out revision '3675c9af6ec591616ef1e99f6046fd8e52d133eb'\nerror: external command 'git' exited with code 128\n</code></pre></div>\n<p>At this point I'm really not sure what to do so I go the my local copy of mathlib and checkout <code>3675c9af6ec591616ef1e99f6046fd8e52d133eb</code> so I can run <code>lake exe cache get</code> there, and it works. I then go back to combinatorial games and do <code>lake exe cache get</code> again and get</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>info: mathlib: cloning https://github.com/leanprover-community/mathlib4\ninfo: mathlib: checking out revision '3675c9af6ec591616ef1e99f6046fd8e52d133eb'\ninfo: plausible: cloning https://github.com/leanprover-community/plausible\ninfo: plausible: checking out revision 'fde3fc21dd68a10791dea22b6f5b53c5a5a5962d'\ninfo: LeanSearchClient: cloning https://github.com/leanprover-community/LeanSearchClient\ninfo: LeanSearchClient: checking out revision '6c62474116f525d2814f0157bb468bf3a4f9f120'\ninfo: importGraph: cloning https://github.com/leanprover-community/import-graph\ninfo: importGraph: checking out revision '856a8cb8908af109aac3ce13e2b4f866f3d75199'\ninfo: proofwidgets: cloning https://github.com/leanprover-community/ProofWidgets4\ninfo: proofwidgets: checking out revision '2d6d124aedc3023506a67e50bfd5582384d6bd17'\ninfo: aesop: cloning https://github.com/leanprover-community/aesop\ninfo: aesop: checking out revision 'a1b5d59f433c6ec2b318192bd910c257a3c62be8'\ninfo: Qq: cloning https://github.com/leanprover-community/quote4\ninfo: Qq: checking out revision '56047303fce0d07dcae7e3e91b17eef67d11f6f4'\ninfo: batteries: cloning https://github.com/leanprover-community/batteries\ninfo: batteries: checking out revision '3613427d66262c4e25e19b40a6a49242e94ba072'\ninfo: Cli: cloning https://github.com/leanprover/lean4-cli\ninfo: Cli: checking out revision '1604206fcd0462da9a241beeac0e2df471647435'\nCurrent branch: HEAD\nWarning: Some Mathlib ecosystem tools assume that the git remote for `leanprover-community/mathlib4` is named `upstream`. You have named it `origin` instead. We recommend changing the name to `upstream`. Moreover, `origin` should point to your own fork of the mathlib4 repository. You can set this up with `git remote add upstream https://github.com/leanprover-community/mathlib4.git`.\n`git for-each-ref --contains 3675c9af6ec591616ef1e99f6046fd8e52d133eb refs/remotes/origin/pr/* --format=%(refname)` returned:\n         with exit code 0 and stderr: .\n`git for-each-ref --contains 3675c9af6ec591616ef1e99f6046fd8e52d133eb refs/remotes/origin/pr/* --format=\"%(refname)\"` returned:\n         with exit code 0 and stderr: .\nIs origin a remote URL? false\nExtracted repo from remote URL:\nUsing cache from origin: leanprover-community/mathlib4\nNo files to download\nDecompressing 6895 file(s)\nUnpacked in 131015 ms\nCompleted successfully!\n</code></pre></div>\n<p>In the end I didn't have to build mathlib myself but that really could have been easier. What have I been doing wrong?</p>",
        "id": 526987447,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751546471
    },
    {
        "content": "<p>What does <code>git remote -v</code> print in your state?</p>",
        "id": 526988225,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1751546727
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">origin</span><span class=\"w\">  </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">plp127</span><span class=\"bp\">/</span><span class=\"n\">combinatorial</span><span class=\"bp\">-</span><span class=\"n\">games</span><span class=\"bp\">.</span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">fetch</span><span class=\"o\">)</span>\n<span class=\"n\">origin</span><span class=\"w\">  </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">plp127</span><span class=\"bp\">/</span><span class=\"n\">combinatorial</span><span class=\"bp\">-</span><span class=\"n\">games</span><span class=\"bp\">.</span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">push</span><span class=\"o\">)</span>\n<span class=\"n\">upstream</span><span class=\"w\">        </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">vihdzp</span><span class=\"bp\">/</span><span class=\"n\">combinatorial</span><span class=\"bp\">-</span><span class=\"n\">games</span><span class=\"bp\">.</span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">fetch</span><span class=\"o\">)</span>\n<span class=\"n\">upstream</span><span class=\"w\">        </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">vihdzp</span><span class=\"bp\">/</span><span class=\"n\">combinatorial</span><span class=\"bp\">-</span><span class=\"n\">games</span><span class=\"bp\">.</span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">push</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 526988316,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751546749
    },
    {
        "content": "<p>Seems very normal</p>",
        "id": 526988347,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751546755
    },
    {
        "content": "<p>Does this mean that you are not using ssh?</p>",
        "id": 526988441,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1751546786
    },
    {
        "content": "<p>I don't know why I should use ssh</p>",
        "id": 526988490,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751546800
    },
    {
        "content": "<p>It works fine on my copy of mathlib</p>",
        "id": 526988527,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751546815
    },
    {
        "content": "<p>Ok, whenever something changes my remotes to https, I get in a confusing state and I only get back to what feels normal by going back to ssh.</p>",
        "id": 526988654,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1751546856
    },
    {
        "content": "<p>I don't know how to do that</p>",
        "id": 526988691,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751546867
    },
    {
        "content": "<p>Anyway, I don't know if this should affect anything here, I was just surprised.</p>",
        "id": 526988711,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1751546872
    },
    {
        "content": "<p><code>Current branch: HEAD</code> this is not handled at all at the moment</p>",
        "id": 526988784,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1751546896
    },
    {
        "content": "<p>What does that mean?</p>",
        "id": 526988857,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751546920
    },
    {
        "content": "<p>Ok, it really means that there should better checks to handle detached head. But the current workaround is to use <code>lake exe cache --repo=owner/repoName get</code></p>",
        "id": 526989136,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1751547007
    },
    {
        "content": "<p>(In case you want to set up ssh, this is probably what you should do:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>git<span class=\"w\"> </span>remote<span class=\"w\"> </span>set-url<span class=\"w\"> </span>origin<span class=\"w\"> </span>git@github.com:plp127/combinatorial-games.git\n</code></pre></div>\n<p>and I imagine similarly for <code>upstream</code>.  But, if it worked for you before, maybe keep your original setup!)</p>",
        "id": 526989174,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1751547020
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306577\">Matthew Ballard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/lake.20exe.20cache.20get.20on.20downstream.20projects/near/526989136\">said</a>:</p>\n<blockquote>\n<p>Ok, it really means that there should better checks to handle detached head. But the current workaround is to use <code>lake exe cache --repo=owner/repoName get</code></p>\n</blockquote>\n<p>I don't think I was on detached head though?</p>",
        "id": 526989246,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751547040
    },
    {
        "content": "<p>Hmm. Give me a short list of steps to get into this state and I will look into it.</p>\n<p>Also, the behavior would depend on the version of cache in the project.</p>",
        "id": 526989453,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1751547112
    },
    {
        "content": "<p>I'm having a similar issue to Aaron here, I cloned a new copy of <a href=\"https://github.com/nomeata/loogle\">nomeata/loogle</a>, and every time I run <code>lake update</code> I get</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">external</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">git'</span><span class=\"w\"> </span><span class=\"n\">exited</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mi\">128</span>\n</code></pre></div>\n<p>I've also had similar problems with PhysLean - everything appears really slow and temperamental all of a sudden, and it seems to be independent of the wifi I'm on.</p>",
        "id": 527274216,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1751716081
    },
    {
        "content": "<p>(I actually kept running <code>lake update</code> and it finally worked)</p>",
        "id": 527274876,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1751716797
    }
]