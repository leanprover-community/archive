[
    {
        "content": "<p>Nowadays every teaching or propaganda file that I write starts with </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">PrettyPrinter</span><span class=\"w\"> </span><span class=\"n\">Delaborator</span><span class=\"w\"> </span><span class=\"n\">SubExpr</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kd\">@[</span><span class=\"n\">app_delab</span><span class=\"w\"> </span><span class=\"n\">Max</span><span class=\"bp\">.</span><span class=\"n\">max</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">delabMax</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Delab</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getExpr</span>\n<span class=\"w\">  </span><span class=\"n\">guard</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">isAppOfArity</span><span class=\"w\"> </span><span class=\"ss\">``Max.max</span><span class=\"w\"> </span><span class=\"mi\">4</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mkIdent</span><span class=\"w\"> </span><span class=\"ss\">`max</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">withNaryArg</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"n\">delab</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">withNaryArg</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"n\">delab</span>\n<span class=\"w\">  </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"o\">))</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">PrettyPrinter</span><span class=\"w\"> </span><span class=\"n\">Delaborator</span><span class=\"w\"> </span><span class=\"n\">SubExpr</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kd\">@[</span><span class=\"n\">app_delab</span><span class=\"w\"> </span><span class=\"n\">Min</span><span class=\"bp\">.</span><span class=\"n\">min</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">delabMin</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Delab</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getExpr</span>\n<span class=\"w\">  </span><span class=\"n\">guard</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">isAppOfArity</span><span class=\"w\"> </span><span class=\"ss\">``Min.min</span><span class=\"w\"> </span><span class=\"mi\">4</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mkIdent</span><span class=\"w\"> </span><span class=\"ss\">`min</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">withNaryArg</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"n\">delab</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">withNaryArg</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"n\">delab</span>\n<span class=\"w\">  </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>Is it already somewhere in Mathlib but scoped?</p>",
        "id": 500693957,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1739983044
    },
    {
        "content": "<p>For people who are not used to delaborators: the purpose of this snippet is to bring back <code>max x y</code> in the infoview instead of the lattice notation for sup.</p>",
        "id": 500694162,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1739983104
    },
    {
        "content": "<p>I'm quite sure it's not, but I think it would be nice to have as scoped delaborators!</p>",
        "id": 500694428,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1739983186
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> do you prefer to fix my delaborators here or on GitHub?</p>",
        "id": 500695066,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1739983352
    },
    {
        "content": "<p>I think these could be unscoped if they tried to synth a <code>LinearOrder</code></p>",
        "id": 500701449,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1739985174
    },
    {
        "content": "<p>Arguably we should be adjusting <a href=\"https://github.com/leanprover-community/mathlib4/blob/16a1c5cebbf76fcbea57a380669e60224207be98/Mathlib/Order/Notation.lean#L57-L61\">the <code>sup</code> and <code>inf</code> delaborators</a> to not replace the default one though</p>",
        "id": 500701584,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1739985214
    },
    {
        "content": "<p>Let's make an option that conditionally enables/disables the linked sup/inf delaborators. That will work better than creating a delaborator that creates application syntax</p>",
        "id": 500705351,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1739986309
    },
    {
        "content": "<p>This would mean</p>\n<ul>\n<li>changing those <code>infix</code> commands to be equivalent <code>syntax</code>es</li>\n<li>creating a new option (<code>pp.mathlib.minMaxAsLattice</code>?)</li>\n<li>writing a delaborator for these notations and make them conditional on the option</li>\n</ul>\n<p>For the third point, we can't use an app unexpanders since they currently can't be conditional on options. For the first, we don't currently have <code>infixl:69 (print := false) \" ⊓ \" =&gt; Min.min</code> notation (but we ought to!)</p>",
        "id": 500707034,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1739986867
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/max.20and.20min.20delaborators/near/500701449\">said</a>:</p>\n<blockquote>\n<p>I think these could be unscoped if they tried to synth a <code>LinearOrder</code></p>\n</blockquote>\n<p>I've implemented this here: <a href=\"https://github.com/leanprover-community/mathlib4/pull/23558\">#23558</a></p>",
        "id": 509518551,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1743531375
    },
    {
        "content": "<p>That's very cool but I wonder if it will cause more confusion?</p>",
        "id": 509551311,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1743543101
    },
    {
        "content": "<p>Well, the status quo is already confusing.</p>\n<p>Do you have a suggestion for what to add to the doc-strings to make the new delaborator less confusing?</p>",
        "id": 509552362,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1743543534
    },
    {
        "content": "<p>The docstrings for <code>sup</code> or for <code>max</code>?</p>",
        "id": 509552958,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1743543831
    },
    {
        "content": "<p>It is true that the status quo (with many <code>sup</code>/<code>inf</code> lemmas still named using \"max\"/\"min\") is confusing.<br>\nIf we want to keep these naming conventions (which I think we do??) then this delaborator might actually make the lemma names less confusing. I'm getting less skeptical about this delaborator by the minute :-)</p>",
        "id": 509553079,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1743543874
    },
    {
        "content": "<p>5 messages were moved here from <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/.02klzzwxh.3A0000.03.2F.02klzzwxh.3A0001.03.20or.20.02klzzwxh.3A0002.03.2F.02klzzwxh.3A0003.03.20for.20set.20interval.20lemmas.3F\">#mathlib4 &gt; <code>sup</code>/<code>inf</code> or <code>max</code>/<code>min</code> for set interval lemmas?</a> by <span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span>.</p>",
        "id": 509553532,
        "sender_full_name": "Notification Bot",
        "timestamp": 1743544074
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/max.20and.20min.20delaborators/near/509552958\">said</a>:</p>\n<blockquote>\n<p>The docstrings for <code>sup</code> or for <code>max</code>?</p>\n</blockquote>\n<p>Well, any of them. But probably the <code>sup</code>/<code>inf</code> one should say something about how its delaborator works? I already gave them new doc-strings in the PR (which don't yet mention the delaboration).</p>",
        "id": 509554291,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1743544409
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/max.20and.20min.20delaborators/near/509551311\">said</a>:</p>\n<blockquote>\n<p>That's very cool but I wonder if it will cause more confusion?</p>\n</blockquote>\n<p>cc <span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span>, since we had exactly the same debate (we landed on the same conclusion that the delaborator was good, provided there's enough documentation about it, but at the time neither of us knew how to write it!). Is it possible for hovering on the notation to mention the delaborator (probably not by name), and the docstring on result of ctrl+click to mention this (whichever of <code>sup</code> or <code>max</code> it ends up being)? What I'd love is to give a beginner every opportunity to figure out what's going on by themselves.</p>",
        "id": 509556652,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1743545513
    },
    {
        "content": "<p>The docstring on the <code>syntax</code> command is what you see when hovering, and the <code>syntax</code> command is also where a ctrl+click leads to. So we need that to have a good doc-string.</p>",
        "id": 509557054,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1743545700
    },
    {
        "content": "<p>But of course, we can't have the <code>max</code> docstring say anything useful, because it lives in core which can't assume that mathlib exists</p>",
        "id": 509557240,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1743545785
    },
    {
        "content": "<p>(or did the extra docstring feature land?)</p>",
        "id": 509557246,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1743545790
    },
    {
        "content": "<p>It's possible to override the hover text of notations these days, in case that's helpful here.</p>\n<p>Example code:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">PrettyPrinter</span><span class=\"w\"> </span><span class=\"n\">Delaborator</span><span class=\"w\"> </span><span class=\"n\">SubExpr</span>\n\n<span class=\"kn\">macro</span><span class=\"w\"> </span><span class=\"s2\">\"baz \"</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">t</span><span class=\"o\">)</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">app_delab</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">delab_baz</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Delab</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">withOverApp</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">guard</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getExpr</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">getArg!</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">isConstOf</span><span class=\"w\"> </span><span class=\"ss\">``Nat</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">getNatValue?</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getExpr</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">appArg!</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">failure</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">nstx</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">withAppArg</span><span class=\"w\"> </span><span class=\"n\">delab</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">annotateCurPos</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">baz</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">nstx</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">addDelabTermInfo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getPos</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getExpr</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">docString?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"This is `baz` applied to the natural number {n}\"</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">stx</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"mi\">3</span>\n</code></pre></div>\n<p><a href=\"/user_uploads/3121/QngRfgOnhgsMjUtPwBAEVMby/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/QngRfgOnhgsMjUtPwBAEVMby/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"716x168\" src=\"/user_uploads/thumbnail/3121/QngRfgOnhgsMjUtPwBAEVMby/image.png/840x560.webp\"></a></div>",
        "id": 509564104,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1743549198
    },
    {
        "content": "<p>Does this replace the docstring that would be found normally?</p>",
        "id": 509564244,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1743549264
    },
    {
        "content": "<p>Yes</p>",
        "id": 509564257,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1743549271
    },
    {
        "content": "<p>So I guess if you want the original, you should read it from the environment and append?</p>",
        "id": 509564317,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1743549307
    },
    {
        "content": "<p>Yeah, that can be done. For example</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">app_delab</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">delab_baz</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Delab</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">withOverApp</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">guard</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getExpr</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">getArg!</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">isConstOf</span><span class=\"w\"> </span><span class=\"ss\">``Nat</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">getNatValue?</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getExpr</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">appArg!</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">failure</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">nstx</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">withAppArg</span><span class=\"w\"> </span><span class=\"n\">delab</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">annotateCurPos</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">baz</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">nstx</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">docString?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">findDocString?</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getEnv</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"ss\">``id</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s!</span><span class=\"s2\">\"</span><span class=\"se\">\\n\\n</span><span class=\"s2\">----</span><span class=\"se\">\\n\\n</span><span class=\"s2\">{·}\"</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">getD</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span>\n<span class=\"w\">  </span><span class=\"n\">addDelabTermInfo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getPos</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getExpr</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">docString?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"This is `baz` applied to the natural number {n}.{docString?}\"</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">stx</span>\n</code></pre></div>\n<p><a href=\"/user_uploads/3121/e_zTMSNQxwSI-P17iL0tSjDJ/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/e_zTMSNQxwSI-P17iL0tSjDJ/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"732x392\" src=\"/user_uploads/thumbnail/3121/e_zTMSNQxwSI-P17iL0tSjDJ/image.png/840x560.webp\"></a></div>",
        "id": 509564573,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1743549447
    },
    {
        "content": "<p>A downside to this is that the string will be computed even if it's never actually used</p>",
        "id": 509564605,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1743549462
    },
    {
        "content": "<p>Should <code>docstring?</code> be changed to be <code>CoreM (Option String)</code>?</p>",
        "id": 509565094,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1743549737
    },
    {
        "content": "<p>I guess that would make the infotree more than just data...</p>",
        "id": 509565165,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1743549782
    },
    {
        "content": "<p>The docstring here also doesn't need to be dynamic, if there are just a few options. it could be stored on a dummy definition.</p>",
        "id": 509565377,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1743549889
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">PrettyPrinter</span><span class=\"w\"> </span><span class=\"n\">Delaborator</span><span class=\"w\"> </span><span class=\"n\">SubExpr</span>\n\n<span class=\"kn\">macro</span><span class=\"w\"> </span><span class=\"s2\">\"baz \"</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">t</span><span class=\"o\">)</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">app_delab</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">delab_baz</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Delab</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">withOverApp</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">guard</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getExpr</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">getArg!</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">isConstOf</span><span class=\"w\"> </span><span class=\"ss\">``Nat</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">getNatValue?</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getExpr</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">appArg!</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">failure</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">nstx</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">withAppArg</span><span class=\"w\"> </span><span class=\"n\">delab</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">annotateCurPos</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">baz</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">nstx</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">docString?</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">findDocString?</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getEnv</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Name</span><span class=\"bp\">.</span><span class=\"n\">mkSimple</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"baz_docstring_{n}\"</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">addDelabTermInfo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getPos</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getExpr</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">docString?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">docString?</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">stx</span>\n\n<span class=\"sd\">/-- This is baz applied to 2. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">baz_docstring_2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">()</span>\n<span class=\"sd\">/-- This is baz applied to 3. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">baz_docstring_3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">()</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"mi\">3</span>\n</code></pre></div>",
        "id": 509565715,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1743550050
    },
    {
        "content": "<p>It would involve keeping some docstrings in sync though, assuming the idea is to have a docstring for Min/Max that appears in the inf/sup notation.</p>",
        "id": 509565826,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1743550099
    },
    {
        "content": "<p>What is this idea for de docstring on the inf/sup notation? Can't we just use a normal doc-string on the notation/syntax?</p>",
        "id": 509565960,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1743550179
    },
    {
        "content": "<p>The string could say something like \"The infimimum, which is notation for <code>min</code> when there is no linear order.\"</p>",
        "id": 509566096,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1743550249
    },
    {
        "content": "<p>I'm just mentioning this to give options. I have no idea if you need it. This lets you make the string depend on any specific information that was acted upon during elaboration.</p>",
        "id": 509566229,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1743550324
    },
    {
        "content": "<p>In this case we already get a different doc-string for <code>max</code> (the one from Lean core) and <code>⊔</code> (the one from the syntax command) without special support.</p>",
        "id": 509566970,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1743550765
    },
    {
        "content": "<p>Kyle's approach lets you have different docstrings in the infoview and the editor</p>",
        "id": 509570210,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1743552474
    },
    {
        "content": "<p>Which is not necessarily to say that we want that</p>",
        "id": 509570266,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1743552487
    },
    {
        "content": "<p>I now have the following doc-strings</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/--</span>\n<span class=\"sd\">The supremum/join operation: `x ⊔ y`. It is notation for `max x y`</span>\n<span class=\"sd\">and should be used when the type is not a linear order.</span>\n<span class=\"sd\">-/</span>\n<span class=\"kn\">syntax</span><span class=\"o\">:</span><span class=\"mi\">68</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"o\">:</span><span class=\"mi\">68</span><span class=\"w\"> </span><span class=\"s2\">\" ⊔ \"</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"o\">:</span><span class=\"mi\">69</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">The infimum/meet operation: `x ⊓ y`. It is notation for `min x y`</span>\n<span class=\"sd\">and should be used when the type is not a linear order.</span>\n<span class=\"sd\">-/</span>\n<span class=\"kn\">syntax</span><span class=\"o\">:</span><span class=\"mi\">69</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"o\">:</span><span class=\"mi\">69</span><span class=\"w\"> </span><span class=\"s2\">\" ⊓ \"</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"o\">:</span><span class=\"mi\">70</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span>\n</code></pre></div>\n<p>And some more explanation in the module doc-string of <code>Mathlib.Order.Notation</code>.</p>\n<p>However, it seems that ctrl+click on the notation sends you to the definition of <code>max</code>/<code>min</code>, instead of the <code>⊔</code> and <code>⊓</code> syntax. <span aria-label=\"oh no\" class=\"emoji emoji-1f615\" role=\"img\" title=\"oh no\">:oh_no:</span></p>",
        "id": 509573737,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1743554362
    },
    {
        "content": "<p>It's unclear whether this is a good idea, but it's possible to override the location for the syntax too:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">PrettyPrinter</span><span class=\"w\"> </span><span class=\"n\">Delaborator</span><span class=\"w\"> </span><span class=\"n\">SubExpr</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">Baz</span>\n<span class=\"sd\">-/</span>\n<span class=\"kn\">macro</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">bazStx</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"baz \"</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">t</span><span class=\"o\">)</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">app_delab</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">delab_baz</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Delab</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">withOverApp</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">guard</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getExpr</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">getArg!</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">isConstOf</span><span class=\"w\"> </span><span class=\"ss\">``Nat</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">nstx</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">withAppArg</span><span class=\"w\"> </span><span class=\"n\">delab</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">annotateCurPos</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">baz</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">nstx</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">findModuleOf?</span><span class=\"w\"> </span><span class=\"ss\">``bazStx</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">getD</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getEnv</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mainModule</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">findDeclarationRanges?</span><span class=\"w\"> </span><span class=\"ss\">``bazStx</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">failure</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">location</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DeclarationLocation</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">range</span><span class=\"bp\">.</span><span class=\"n\">selectionRange</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"n\">addDelabTermInfo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getPos</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getExpr</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">location?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">location</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">stx</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n</code></pre></div>",
        "id": 509574729,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1743554806
    },
    {
        "content": "<p>I <em>think</em> this is a good idea for <code>⊔</code> and <code>⊓</code> notation.</p>",
        "id": 509575857,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1743555412
    },
    {
        "content": "<p>Kyle, which wizard school did you go to?</p>",
        "id": 509630376,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1743581819
    },
    {
        "content": "<p>It's called MIT, where they teach straight from the <a href=\"https://en.wikipedia.org/wiki/Structure_and_Interpretation_of_Computer_Programs\">wizard book</a></p>",
        "id": 509643069,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1743585447
    },
    {
        "content": "<p>I heard it’s some school in Boston.</p>",
        "id": 509643142,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1743585472
    },
    {
        "content": "<p>And Johan also heard that rumor and was quicker.</p>",
        "id": 509643237,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1743585494
    },
    {
        "content": "<p>We could go a step further here and make the sup notation (in the source, as opposed to the delaborator) emit a warning if a linear order is found</p>",
        "id": 509649852,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1743587287
    },
    {
        "content": "<p>Would that be done with a custom <del>d</del>elaborator instead of the <code>macro_rules</code>?</p>",
        "id": 509650281,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1743587415
    },
    {
        "content": "<p>This would be good as a follow-up PR</p>",
        "id": 509650430,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1743587460
    },
    {
        "content": "<p><strong>e</strong>laborator, yes</p>",
        "id": 509660703,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1743590727
    },
    {
        "content": "<p>I added the <code>withGoToDef</code> function</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- Annotate the syntax `stx` with the go-to-def information of `target`. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">withGoToDef</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Term</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Name</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DelabM</span><span class=\"w\"> </span><span class=\"n\">Term</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">annotateCurPos</span><span class=\"w\"> </span><span class=\"n\">stx</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">findModuleOf?</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">getD</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getEnv</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mainModule</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">findDeclarationRanges?</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">failure</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">location</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">range</span><span class=\"bp\">.</span><span class=\"n\">selectionRange</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"n\">addDelabTermInfo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getPos</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getExpr</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">location?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">location</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">stx</span>\n</code></pre></div>\n<p>And used it to have the <code>⊔</code> and <code>⊓</code> go to their notation when ctrl+clicking in the infoview. On the other hand, when ctrl+clicking in the editor, it leads to the <code>macro_rules</code>.</p>",
        "id": 509661727,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1743591025
    },
    {
        "content": "<p>When hovering over <code>a ⊔ b</code>, the pop-up shows something like <code>@max α SemilatticeSup.toMax a b : α</code>, so you can still ctrl+click on the <code>@max</code> if you want.</p>",
        "id": 509663014,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1743591413
    },
    {
        "content": "<p>Is this still waiting for something? <span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span>, I think you have been assigned as a maintainer. (<a href=\"https://github.com/leanprover-community/mathlib4/pull/23558\">#23558</a>)</p>",
        "id": 513014920,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1744974769
    }
]