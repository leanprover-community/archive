[
    {
        "content": "<p>MWE</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Lift</span>\n\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">MyNat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ℕ</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hn</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">lift</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">MyNat</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">hn</span>\n<span class=\"w\">  </span><span class=\"c1\">-- type of `n` is `ℕ` instead of `MyNat`, in the goal state</span>\n<span class=\"w\">  </span><span class=\"n\">trivial</span>\n</code></pre></div>",
        "id": 449439667,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1720242824
    },
    {
        "content": "<p>This means that we can not use dot-notation on <code>n</code> for all the juicy decls in the <code>MyNat</code> namespace.</p>",
        "id": 449439731,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1720242858
    },
    {
        "content": "<p>Does this work using <code>def</code>?</p>",
        "id": 449462914,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1720256824
    },
    {
        "content": "<p><del>This works fine for me with <code>example</code> on a recent master...</del>(oh I see, it's supposed to compile). The same phenomenon occurs with <code>def</code>.</p>",
        "id": 449467379,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1720258781
    },
    {
        "content": "<p>You can always do this</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Lift</span>\n\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">MyNat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ℕ</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hn</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">lift</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">MyNat</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">hn</span>\n<span class=\"w\">  </span><span class=\"n\">change</span><span class=\"w\"> </span><span class=\"n\">MyNat</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"n\">trivial</span>\n</code></pre></div>\n<p>but it's annoying</p>",
        "id": 449468470,
        "sender_full_name": "Vincent Beffara",
        "timestamp": 1720259385
    },
    {
        "content": "<p>Right but I would imagine that this still counts as a minor bug.</p>",
        "id": 449475266,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1720262594
    },
    {
        "content": "<p>Right, I am using <code>change</code> right now. But it shouldn't be needed.</p>",
        "id": 449523314,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1720283663
    },
    {
        "content": "<p>I was trying to step through what <code>lift</code> roughly does, but the way I'm doing it preserves <code>MyNat</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">MyNat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ℕ</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hn</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">CanLift</span><span class=\"bp\">.</span><span class=\"n\">prf</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"w\"> </span><span class=\"n\">MyNat</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">hn</span>\n<span class=\"w\">  </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">n'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hn'</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">this</span>\n<span class=\"w\">  </span><span class=\"n\">subst</span><span class=\"w\"> </span><span class=\"n\">hn'</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span>\n<span class=\"cm\">  n' : MyNat</span>\n<span class=\"cm\">  hn : ↑n' ≥ 0</span>\n<span class=\"cm\">  ⊢ True</span>\n<span class=\"cm\">  -/</span>\n</code></pre></div>\n<p>I'm not sure what the deal is exactly.</p>",
        "id": 449540733,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1720289819
    },
    {
        "content": "<p>I noticed that <code>lift</code> uses <code>simp</code> to substitute away the variable. That can be done more efficiently and accurately with <code>subst</code></p>",
        "id": 449540882,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1720289883
    },
    {
        "content": "<p>Filed as</p>\n<blockquote>\n<p>lift tactic does not respect abbreviations <a href=\"https://github.com/leanprover-community/mathlib4/pull/15865\">#15865</a></p>\n</blockquote>",
        "id": 462734892,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1723794900
    }
]