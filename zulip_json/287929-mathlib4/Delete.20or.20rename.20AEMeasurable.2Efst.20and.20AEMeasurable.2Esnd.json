[
    {
        "content": "<p>In an effort to make <code>fun_prop</code> better at proving <code>AEMeasurable</code> I want to add the lambda theorems <code>AEMeasurable.fst</code> and <code>AEMeasurable.snd</code> in the form they are given here: <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Tactic/FunProp.html\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/Tactic/FunProp.html</a>. Note this is also the form that <code>Measurable.fst</code>, <code>Measurable.snd</code> (and other <code>fun_prop</code>) theorems take. Currently <code>AEMeasurable.fst</code> and <code>AEMeasurable.snd</code> express a different theorem (which can't even be used by <code>fun_prop</code>). I would like to remove or rename these theorems but wanted to check if this was ok first. All of its uses can be easily replaced by <code>fun_prop</code>. Perhaps sometimes the proof term is preferable though? If you think I should just rename the theorems let me know what I should rename them to (I don't believe the corresponding theorem exists for any of the other <code>fun_prop</code> theorems as far as I could tell). I have a draft <a href=\"https://github.com/leanprover-community/mathlib4/pull/24273\">#24273</a> which removes all uses.</p>",
        "id": 513773254,
        "sender_full_name": "David Ledvinka",
        "timestamp": 1745382944
    },
    {
        "content": "<p>They should be renamed to <code>comp_fst</code>/<code>comp_snd</code>.</p>",
        "id": 513773459,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1745383071
    },
    {
        "content": "<p>Same for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AEStronglyMeasurable.fst#doc\">docs#AEStronglyMeasurable.fst</a>. I have a WIP PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/24248\">#24248</a> that needs them and adds versions for <code>Integrable</code> (under certain assumptions).</p>",
        "id": 513773632,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1745383167
    },
    {
        "content": "<p>BTW, please make the new <code>fst</code>/<code>snd</code> theorems <code>protected</code>.</p>",
        "id": 513773663,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1745383199
    },
    {
        "content": "<p>Ok I changed the name for <code>AEStronglyMeasurable</code> and <code>StronglyMeasurable</code> as well and then proved the appropriate lambda lemmas for both these classes.</p>",
        "id": 513794648,
        "sender_full_name": "David Ledvinka",
        "timestamp": 1745392981
    },
    {
        "content": "<p>I've left some minor comments on Github.</p>",
        "id": 514011677,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1745470283
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Delete.20or.20rename.20AEMeasurable.2Efst.20and.20AEMeasurable.2Esnd/near/513773459\">said</a>:</p>\n<blockquote>\n<p>They should be renamed to <code>comp_fst</code>/<code>comp_snd</code>.</p>\n</blockquote>\n<p>Are you suggesting that the majority of the *able API should gain <code>comp_</code> in it's name?</p>",
        "id": 514100998,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1745495561
    },
    {
        "content": "<p>E.g <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Differentiable.fst#doc\">docs#Differentiable.fst</a></p>",
        "id": 514101082,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1745495588
    },
    {
        "content": "<p>Ah nevermind, I guess the rule you propose is only to do so for precomposition</p>",
        "id": 514101268,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1745495645
    },
    {
        "content": "<p>Currently for some of these APIs .fst and .snd mean precomposition and sometimes it means postcomposition, so the goal of this PR is to standardize it.</p>",
        "id": 514113563,
        "sender_full_name": "David Ledvinka",
        "timestamp": 1745498240
    },
    {
        "content": "<p>E.g., for continuity we have <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=continuous_fst#doc\">docs#continuous_fst</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Continuous.fst#doc\">docs#Continuous.fst</a>, and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Continuous.fst%27#doc\">docs#Continuous.fst'</a></p>",
        "id": 514121392,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1745500133
    },
    {
        "content": "<p>We should choose a naming scheme here and follow it for all properties. I have no preference on which of the natural naming schemes is used.</p>",
        "id": 514121627,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1745500188
    },
    {
        "content": "<p>I'm happy with the <code>comp_fst</code>/<code>comp_snd</code> naming scheme.</p>",
        "id": 514140790,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1745504497
    },
    {
        "content": "<p>So the proposal is: </p>\n<p><code>xable_fst : Xable Prod.fst</code><br>\n<code>Xable.fst : Xable (fun x  =&gt; (f x).1)</code><br>\n<code>Xable.comp_fst  : Xable (fun x  =&gt; f x.1)</code></p>\n<p>Should I deprecate <code>Continuous.fst'</code> and make it an alias of <code>Continuous.comp_fst</code>?</p>",
        "id": 514181700,
        "sender_full_name": "David Ledvinka",
        "timestamp": 1745515164
    },
    {
        "content": "<p>Ì don't think that's so good, because you're losing out on the new anonymous dot notation possibilities</p>",
        "id": 514181915,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1745515214
    },
    {
        "content": "<p>What about</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">fst</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"n\">fst</span>\n<span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">fst_comp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\">  </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">1</span>\n<span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">comp_fst</span><span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\">  </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">1</span>\n</code></pre></div>",
        "id": 514182093,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1745515275
    },
    {
        "content": "<p>That is probably the most sensible name-wise but would be a much larger change (I think all of the <code>xable_fst</code>examples are currently consistent with the proposal I mentioned). I can work on this if people think its worth it though.</p>",
        "id": 514182789,
        "sender_full_name": "David Ledvinka",
        "timestamp": 1745515496
    },
    {
        "content": "<p>How should we name lemmas like <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MeasureTheory.integral_prod_swap#doc\">docs#MeasureTheory.integral_prod_swap</a> <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MeasureTheory.integral_fun_fst#doc\">docs#MeasureTheory.integral_fun_fst</a> <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MeasureTheory.integral_fn_integral_add#doc\">docs#MeasureTheory.integral_fn_integral_add</a> ?</p>",
        "id": 514281258,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1745556789
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Delete.20or.20rename.20AEMeasurable.2Efst.20and.20AEMeasurable.2Esnd/near/514182093\">said</a>:</p>\n<blockquote>\n<p>What about</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">fst</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"n\">fst</span>\n<span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">fst_comp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\">  </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">1</span>\n<span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">comp_fst</span><span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\">  </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">1</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>The lemmas <code>Foo.fst_comp</code> are the most useful, so I would prefer to have the shortest names for them.<br>\nAlso dot notation for <code>Foo Prod.fst</code> isn't that useful, since you usually want to compose it with other <code>Foo</code>-lemmas, and <code>.fst.fst_comp</code> (in your naming scheme) doesn't elaborate correctly, since Lean doesn't know the type of the <code>.fst</code>.</p>",
        "id": 514322892,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1745570512
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"223948\">David Ledvinka</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Delete.20or.20rename.20AEMeasurable.2Efst.20and.20AEMeasurable.2Esnd/near/514181700\">said</a>:</p>\n<blockquote>\n<p>So the proposal is: </p>\n<p><code>xable_fst : Xable Prod.fst</code><br>\n<code>Xable.fst : Xable (fun x  =&gt; (f x).1)</code><br>\n<code>Xable.comp_fst  : Xable (fun x  =&gt; f x.1)</code></p>\n<p>Should I deprecate <code>Continuous.fst'</code> and make it an alias of <code>Continuous.comp_fst</code>?</p>\n</blockquote>\n<p>What about the case where <code>xable</code> is a def like <code>deriv</code> or <code>integral</code> (as Yury asked above), and there is no namespace to hide in to disambiguate the first two?</p>",
        "id": 514372641,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1745585377
    },
    {
        "content": "<p>I was only thinking about function properties but it does appear fderiv uses this as well. <code>fderiv_fst</code> gives the theorem about the derivative of <code>Prod.fst</code>, whereas <code>fderiv.fst</code> gives the theorem about the derivative of <code>(fun x =&gt; (f x).1)</code></p>",
        "id": 514375141,
        "sender_full_name": "David Ledvinka",
        "timestamp": 1745586072
    },
    {
        "content": "<p>I think <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=fderiv.fst#doc\">docs#fderiv.fst</a> goes against <a href=\"https://leanprover-community.github.io/contribute/naming.html\">#naming</a> in that <code>.</code> is not appropriate here</p>",
        "id": 514376401,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1745586467
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"111080\">Floris van Doorn</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Delete.20or.20rename.20AEMeasurable.2Efst.20and.20AEMeasurable.2Esnd/near/514322892\">said</a>:</p>\n<blockquote>\n<p>dot notation for <code>Foo Prod.fst</code> isn't that useful, since you usually want to compose it with other <code>Foo</code>-lemmas</p>\n</blockquote>\n<p>FWIW that's not really my experience. My code was littered with <code>continous_id.neg</code> at some point</p>",
        "id": 514414296,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1745598063
    },
    {
        "content": "<p>So should we go with  <span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span>  suggestion? should I make some sort of poll? I have no strong opinions and my main desire is to get </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">AEMeasurable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\">  </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"o\">)</span>\n<span class=\"n\">AEMeasurable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\">  </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>as theorems in Mathlib so that I can use them with <code>fun_prop</code>, but I am happy to work on a refactor if we can come to a consensus.</p>",
        "id": 514682674,
        "sender_full_name": "David Ledvinka",
        "timestamp": 1745786578
    },
    {
        "content": "<p>I am happy with my own suggestion <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 514682721,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1745786612
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Delete.20or.20rename.20AEMeasurable.2Efst.20and.20AEMeasurable.2Esnd/near/514414296\">said</a>:</p>\n<blockquote>\n<p>FWIW that's not really my experience. My code was littered with <code>continous_id.neg</code> at some point</p>\n</blockquote>\n<p>I don't think that's disagreeing with Floris' point (and I agree with his point), the idea is that <code>Foo Prod.fst : Foo.fst</code> would correspond to <code>continuous_id : Continuous id</code> here, and changing to <code>Continuous.id</code> would be <code>.id.neg</code>, which in your situation wouldn't have worked.</p>",
        "id": 514684937,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1745788282
    },
    {
        "content": "<p>No, the idea is that <code>Continuous.neg</code> would mean <code>Continuous fun x ↦ -x</code> and then my <code>continous_id.neg</code> would have been <code>.neg</code>.</p>",
        "id": 514685735,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1745788827
    }
]