[
    {
        "content": "<p>Currently, in mathlib, we have smooth manifolds, and analytic manifolds, separately. Most of the API is only for smooth manifolds (for instance, we have smooth vector bundles, but no analytic vector bundles).</p>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/19696\">#19696</a> (WIP, but builds) merges the two, so that we only have one typeclass <code>ContMDiffManifoldWithCorners I n M</code>, where <code>I</code> is the model with corners, <code>n : WithTop ℕ∞</code> is the smoothness class (an integer, or ∞, or ω), and <code>M</code> is the space (which already has a charted space structure, so <code>ContMDiffManifoldWithCorners I n M</code> is Prop-valued).</p>\n<p>Since it is a big revamp of the manifold library, it's probably the right time to discuss the design decisions and naming. Here are a few questions in this respect.</p>",
        "id": 485812135,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1733221771
    },
    {
        "content": "<ul>\n<li>The name <code>ContMDiffManifoldWithCorners</code>, although coherent with the library, is way too long. I would go for just <code>IsManifold</code>. <span class=\"user-mention\" data-user-id=\"634338\">@Michael Rothgang</span> suggests <code>IsManifoldWithCorners</code>.</li>\n<li>For Lie groups and friends, should we have an arbitrary smoothness index <code>n : WithTop ℕ∞</code>, or should we just go for analytic? All the applications I know are in the analytic framework.</li>\n<li>I've deleted the file <code>AnalyticManifold</code>, as it's superseded by the new construction. Is that ok for everyone?</li>\n</ul>",
        "id": 485812765,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1733221939
    },
    {
        "content": "<p>I'd be especially interested in opinions of <span class=\"user-mention\" data-user-id=\"260507\">@Heather Macbeth</span> , <span class=\"user-mention\" data-user-id=\"110031\">@Patrick Massot</span> , <span class=\"user-mention\" data-user-id=\"634338\">@Michael Rothgang</span> , <span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span> , <span class=\"user-mention\" data-user-id=\"240862\">@Oliver Nash</span> , <span class=\"user-mention\" data-user-id=\"514145\">@Geoffrey Irving</span> , as these changes are quite disruptive. There is no hurry to get this in, but in the long run I think it's a big improvement over the current situation.</p>",
        "id": 485813297,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1733222098
    },
    {
        "content": "<p>Don't we need the distinction between smooth and analytic Lie groups, just to be able to state that the BCH formula shows they are the same?</p>",
        "id": 485824103,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733225111
    },
    {
        "content": "<p>I like <code>IsManifold</code> as the name. If the docstring states that it can be with corners, that seems good enough to me.<br>\nI'll take a look at the other things later.</p>",
        "id": 485865309,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1733235760
    },
    {
        "content": "<p>I don't feel strongly over <code>IsManifold</code> or <code>IsManifoldWithCorners</code>: basically, a convention \"all manifolds have boundary and/or corners unless mentioned otherwise\" is also fine with me, provided the doc-string is clear.</p>",
        "id": 485882256,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1733239706
    },
    {
        "content": "<p>This change means topological manifolds are (finally) integrated in this hierarchy as well, right? (I think this is a good change. Long-term, we'll want to have topological manifolds without smooth structures.)</p>",
        "id": 485883737,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1733240056
    },
    {
        "content": "<p>Yes, topological manifolds are also part of the new hierarchy, as <code>IsManifold I 0 M</code>. In a sense, they were already there, though, since <code>ChartedSpace H M</code> already contains the information that the change of coordinates are continuous.</p>",
        "id": 485885518,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1733240507
    },
    {
        "content": "<p>i.e., <code>IsManifold I 0 M</code> is always true once <code>ChartedSpace H M</code> holds. I should probably register the instance, by the way.</p>",
        "id": 485885779,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1733240562
    },
    {
        "content": "<p>I'll need a little more time to study this but I'm certainly a fan of <code>IsManifold</code> as the name.</p>",
        "id": 485957033,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1733261368
    },
    {
        "content": "<p>If <code>IsManifoldWithCorners</code> means \"I definitely have corners\" then that's great, but if it means \"I might have corners\" then I think <code>IsManifold</code> is a better name for it. There will be plenty of manifolds in parts of the proof of FLT but none will have any corners, so you just say it's a manifold and then you say however you say there are no corners and it's less confusing.</p>",
        "id": 485961122,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733262924
    },
    {
        "content": "<p>It means \"I might have corners\". It seems there is a consensus on the naming, so I've switched to <code>IsManifold</code>. The PR is still marked as WIP, I'll wait for the end of the discussion before cleaning it up and changing its status.</p>",
        "id": 486040185,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1733302376
    },
    {
        "content": "<p>On the Lie group point, if we demand analyticity definitionally, it will make it harder to prove certain  objects are Lie groups, right? E.g., say I wanted to prove that the holonomy group of a Riemannian manifold was a Lie group?</p>",
        "id": 486042272,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1733303023
    },
    {
        "content": "<p>I suppose in an ideal world we would have a custom constructor which provided a Lie group which was definitionally analytic but which demanded only C^1 (or whatever weakest condition suffices). Maybe until that constructor exists, we maintain the smoothness class as a parameter?</p>",
        "id": 486042299,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1733303033
    },
    {
        "content": "<p>How does the new type cover analytic manifolds in the infinite dimensional case?</p>\n<p>For the finite dimensional case I have a proof of Osgood’s theorem and such in my Mandelbrot repo, so I can recover what I need from IsManifold. I suppose this is the best way if we care only about finite dimensions.</p>",
        "id": 486043425,
        "sender_full_name": "Geoffrey Irving",
        "timestamp": 1733303378
    },
    {
        "content": "<p>Oh, sorry, I missed the double with-top setup. All good!</p>",
        "id": 486043596,
        "sender_full_name": "Geoffrey Irving",
        "timestamp": 1733303428
    },
    {
        "content": "<p>Here is an update on the PR status: as a result of the above discussion, I've switched to <code>IsManifold</code> and kept the smoothness index in Lie groups and friends. The PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/19696\">#19696</a> is now almost ready for review -- I've extracted the bits that could be made independent in <a href=\"https://github.com/leanprover-community/mathlib4/pull/19807\">#19807</a>, which has been <code>maintainer delegated</code> by <span class=\"user-mention\" data-user-id=\"634338\">@Michael Rothgang</span> (but not yet merged). </p>\n<p>Once this is in, <a href=\"https://github.com/leanprover-community/mathlib4/pull/19696\">#19696</a> will be painful to review (+1400/-1000, has to be done in one go) but there is mostly no mathematical content, it's just adapting a lot of docstrings (I'm sure I missed some, but I've already fixed a big lot of them) and changing <code>ℕ∞</code> to <code>WithTop ℕ∞</code> in many places and fixing the breakage.</p>",
        "id": 486787548,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1733678909
    },
    {
        "content": "<p>Thank you so much for this significant refactor! I'm very happy to see the generalisation and retirement of the name <code>SmoothManifoldWithCorners</code>. Is <code>ContMDiff</code> going to generalise to <code>WithTop ℕ∞</code>, too?</p>",
        "id": 486935370,
        "sender_full_name": "Winston Yin (尹維晨)",
        "timestamp": 1733733639
    },
    {
        "content": "<p>Yes, that's part of the refactor, and done in <a href=\"https://github.com/leanprover-community/mathlib4/pull/19696\">#19696</a>.</p>",
        "id": 486946434,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1733736814
    },
    {
        "content": "<p>Copying what I wrote on github: I can review the rest of <a href=\"https://github.com/leanprover-community/mathlib4/pull/19696\">#19696</a>/re-review it on (probably) Tuesday or Wednesday.</p>",
        "id": 486989106,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1733749198
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110050\">Sébastien Gouëzel</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Extend.20manifold.20smoothness/near/486946434\">said</a>:</p>\n<blockquote>\n<p>Yes, that's part of the refactor, and done in <a href=\"https://github.com/leanprover-community/mathlib4/pull/19696\">#19696</a>.</p>\n</blockquote>\n<p>How did I miss that! Thanks for doing all this.</p>",
        "id": 487088584,
        "sender_full_name": "Winston Yin (尹維晨)",
        "timestamp": 1733774903
    },
    {
        "content": "<p>I notice that you've registered instances to help typeclass inference for <code>IsManifold I ∞ M → IsManifold I n M</code> where <code>n ≤ ∞</code> (for which you introduced a new class <code>LEInfty</code>); <code>ω → n</code> where <code>n : WithTop N∞</code>; <code>n → 0</code> where <code>n : WithTop N∞</code>; and an ad hoc <code>2 → 1</code>. I believe we need to generalise that last one to <code>n → 1</code> where <code>[NeZero n]</code> for all differentiable manifolds, because many results (e.g. for the tangent space or integral curves) are stated for (at least) <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>C</mi><mn>1</mn></msup></mrow><annotation encoding=\"application/x-tex\">C^1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span> manifolds, but there is currently no easy way for Lean to infer the <code>IsManifold I 1 M</code> instance from an <code>IsManifold I 42 M</code> manifold. Am I missing something?</p>",
        "id": 489131433,
        "sender_full_name": "Winston Yin (尹維晨)",
        "timestamp": 1734311991
    },
    {
        "content": "<p>I guess we could either state the results generally for <code>[IsManifold I n M] [NeZero n]</code> or for <code>[IsManifold I 1 M]</code> and rely on typeclass inference. The latter seems to be the approach being taken here.</p>",
        "id": 489131632,
        "sender_full_name": "Winston Yin (尹維晨)",
        "timestamp": 1734312139
    },
    {
        "content": "<p>This would also address Michael's comment in <code>Geometry/Manifold/ContMDiffMFDeriv.lean</code> by doing <code>haveI : NeZero n</code> instead (untested).</p>",
        "id": 489131999,
        "sender_full_name": "Winston Yin (尹維晨)",
        "timestamp": 1734312423
    },
    {
        "content": "<p>Unfortunately, an instance like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NeZero</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsManifold</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsManifold</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">M</span>\n</code></pre></div>\n<p>can not work: if you're looking for <code>IsManifold I 1 M</code>, there is no way Lean could guess a suitable value of <code>n</code> out of thin air to apply the instance (contrary to fixed values of <code>n</code> like 2 or infinity).</p>\n<p>That's the reason why, in the PR, the results about the existence of a topology on the tangent space, and the existence of integral curves, are stated assuming <code>IsManifold I 1 M</code>: because otherwise there would be an <code>n</code> that couldn't be determined from the conclusion of the theorem and that Lean would never be able to guess.</p>",
        "id": 489156453,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1734330639
    },
    {
        "content": "<p>Thanks for the explanation. I suspected there must've been a catch somewhere!</p>",
        "id": 489171629,
        "sender_full_name": "Winston Yin (尹維晨)",
        "timestamp": 1734336905
    }
]