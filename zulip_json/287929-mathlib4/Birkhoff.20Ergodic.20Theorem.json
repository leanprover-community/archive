[
    {
        "content": "<p>I'm creating this topic to discuss a possible PR of the proof of pointwise Birkhoff to mathlib. The complete proof I have can be found <a href=\"https://github.com/lucasvreis/BirkhoffErgodicThm/tree/main\">here</a>. Under the <a href=\"https://github.com/lucasvreis/BirkhoffErgodicThm/tree/main/BirkhoffErgodicThm\">library folder</a>, there are three files with some results that I think should go into other existing files in mathlib. I have not contributed to mathlib before other than during the mathport, so some help is very appreciated :)</p>\n<p>Some relevant comments:</p>\n<ul>\n<li>Should everything in the <a href=\"https://github.com/lucasvreis/BirkhoffErgodicThm/blob/main/BirkhoffErgodicThm.lean\">main file</a> stay in a single file? It feels like the bit about the sigma algebra of invariant sets could live in another file;</li>\n<li>Docstrings are missing;</li>\n<li>The results in <a href=\"https://github.com/lucasvreis/BirkhoffErgodicThm/blob/main/BirkhoffErgodicThm/BirkhoffSumPR.lean\">BirkhoffSumPR</a> are specialized to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">R</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{R}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">R</span></span></span></span> because I had a hard time figuring out the most general type classes while also keeping the <code>simp</code> + <code>linarith</code> proofs;</li>\n<li>On this <a href=\"https://github.com/lucasvreis/BirkhoffErgodicThm/blob/edb110ec025f00bd95e3fbeb326f3be777a6ff1b/BirkhoffErgodicThm.lean#L222\">line</a> I need to assume <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>φ</mi></mrow><annotation encoding=\"application/x-tex\">\\varphi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">φ</span></span></span></span> is integrable <em>and</em> measurable. It seems like being <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/MeasureTheory/Function/StronglyMeasurable/Basic.html#MeasureTheory.AEStronglyMeasurable\">AEStronglyMeasurable</a> is not enough but perhaps it is;</li>\n<li>Not sure to which file <a href=\"https://github.com/lucasvreis/BirkhoffErgodicThm/blob/edb110ec025f00bd95e3fbeb326f3be777a6ff1b/BirkhoffErgodicThm.lean#L255\">this</a> basic lemma should go;</li>\n<li>Is <a href=\"https://github.com/lucasvreis/BirkhoffErgodicThm/blob/edb110ec025f00bd95e3fbeb326f3be777a6ff1b/BirkhoffErgodicThm.lean#L306\">this</a> lemma about a sigma-algebra being a subset of its null set completion really missing? I could not find it</li>\n</ul>\n<p><span class=\"user-mention\" data-user-id=\"110050\">@Sébastien Gouëzel</span>  <span class=\"user-mention\" data-user-id=\"556875\">@Pietro Monticone</span></p>",
        "id": 446448385,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1719164014
    },
    {
        "content": "<p>Anytime you think something could go in a separate file, you are probably right. :-) Also, this will need to be multiple PRs, and do this \"file at a time\" is often a good approach.</p>",
        "id": 446490160,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1719187801
    },
    {
        "content": "<p>A few comments:</p>\n<ul>\n<li>More files is almost always better. So I think the definition of the invariant sigma algebra should definitely go into its own file. But note that this is already in Mathlib, in <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MeasurableSpace.invariants#doc\">docs#MeasurableSpace.invariants</a> (with a small API around it).</li>\n<li>The most efficient way is indeed to PR one file at a time, because it's much easier for reviewers (and also you will learn some tricks along the process, so later PRs will be smoother).</li>\n<li>Indeed, typeclasses will need to be generalized in BirkhoffSumPR. <code>linarith</code> shouldn't be relevant -- the assumptions should essentially be the same as in the definition of Birkhoff averages.</li>\n<li>Integrability of the function should indeed be enough, you shouldn't need to assume measurability in addition. However, if it is more convenient for some auxiliary lemmas, you can definitely prove them with the additional assumption, and then drop it in the final version of the interesting results by reducing to the measurable case.</li>\n<li>The basic lemma you mentions already exists, as <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=abs_le_max_abs_abs#doc\">docs#abs_le_max_abs_abs</a> (I found it just by doing <code>by exact?</code> on your lemma).</li>\n</ul>",
        "id": 446569382,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1719223063
    },
    {
        "content": "<blockquote>\n<ul>\n<li>The basic lemma you mentions already exists</li>\n</ul>\n</blockquote>\n<p>Oh, I did try <code>exact?</code> first but it failed since it was stated with <code>⊔</code> instead of <code>max</code>.</p>",
        "id": 446620404,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1719237182
    },
    {
        "content": "<blockquote>\n<p><code>linarith</code> shouldn't be relevant</p>\n</blockquote>\n<p>Yes, I was just lazy at the time to find the proofs without it.</p>",
        "id": 446620936,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1719237346
    },
    {
        "content": "<p>Hi all! sorry for the hiatus. I went to my family home to do a small dental surgery and then to Italy. The ICTP school is over so I can have more time for it now.</p>",
        "id": 459479978,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1723211617
    },
    {
        "content": "<p>The proof is now using <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MeasurableSpace.invariants#doc\">docs#MeasurableSpace.invariants</a>, I'm now working in dropping the stricter measurability assumption. It seems the easiest way is to drop it in the final version of the theorem, because some theorem related to restriction of measures requires strict measurability of some sets. Before travelling I attempted to drop the assumption everywhere and got stuck. I can't remember which one it was right now and I'm still away from the desktop computer in which the attempt was made.</p>",
        "id": 459494825,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1723215014
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"613177\">@Oliver Butterley</span> here is a quick proposal for a plan:</p>\n<ul>\n<li>update the repository to latest mathlib and lean</li>\n<li>write the lemmas in the <code>*PR.lean</code> files in their full generality, then create branches and PR them to mathlib</li>\n<li>discuss how to remove the measurability assumption of the observable in the main file and remove it</li>\n<li>create a branch and a PR for the main file</li>\n</ul>",
        "id": 519446867,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1747764424
    },
    {
        "content": "<p>in the \"create a branch\" steps also adequate the code to match mathlib convention and style</p>",
        "id": 519447300,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1747764620
    },
    {
        "content": "<p>That sounds great! I ready to help with whatever task where you think I could be useful. Feel free to assign me tasks. I'm curious about the measurability issue but I suspect it doesn't make sense to discuss the details until everything is updated.</p>",
        "id": 519452979,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1747766707
    },
    {
        "content": "<p>feel free to start with the first two points, I can talk here and merge PRs but I'll not be working on them the next days myself</p>",
        "id": 519453479,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1747766895
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"571941\">Lua Viana Reis</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Birkhoff.20Ergodic.20Theorem/near/519453479\">said</a>:</p>\n<blockquote>\n<p>feel free to start with the first two points, I can talk here and merge PRs but I'll not be working on them the next days myself</p>\n</blockquote>\n<p>OK, I'll do that.</p>",
        "id": 519453567,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1747766932
    },
    {
        "content": "<p>Updating the code from one year ago was hard work! Many things have been deprecated or modified since then. The git <code>-S</code> helped a lot to find the deprecations deep in the git history. <span aria-label=\"persevere\" class=\"emoji emoji-1f623\" role=\"img\" title=\"persevere\">:persevere:</span><br>\nI did a PR to the <a href=\"https://github.com/lucasvreis/BirkhoffErgodicThm/tree/main\">repo</a> with the updated code. There are still 3 sorrys left but it had already taken hours to do all the other corrections required by the update so I didn't have time today for these.</p>",
        "id": 519563237,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1747819142
    },
    {
        "content": "<p>thank you :) I fixed the sorries and merged</p>",
        "id": 519735075,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1747881188
    },
    {
        "content": "<p>I made a start of generalizing the partialSups lemmas. </p>\n<p>It is work in progress but I opened a PR so you can see exactly how things stand and I won't be able to do more until tomorrow. I hope I didn't miss something obvious but it became rather involved because it seems some relatively standard results aren't available in full generality.</p>",
        "id": 519802630,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1747910671
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"571941\">Lua Viana Reis</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Birkhoff.20Ergodic.20Theorem/near/519735075\">said</a>:</p>\n<blockquote>\n<p>thank you :) I fixed the sorries and merged</p>\n</blockquote>\n<p>That's great!</p>",
        "id": 519802768,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1747910725
    },
    {
        "content": "<p>I believe all the lemmas in the *PR files are in reasonable generality now after my latest updates. <span class=\"user-mention\" data-user-id=\"571941\">@Lua Viana Reis</span> let me know if there is something in those files that is still not the way it should be.</p>",
        "id": 521850427,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1748900935
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"571941\">Lua Viana Reis</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Birkhoff.20Ergodic.20Theorem/near/519446867\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"613177\">Oliver Butterley</span> here is a quick proposal for a plan:</p>\n<ul>\n<li>update the repository to latest mathlib and lean</li>\n<li>write the lemmas in the <code>*PR.lean</code> files in their full generality, then create branches and PR them to mathlib</li>\n<li>discuss how to remove the measurability assumption of the observable in the main file and remove it</li>\n<li>create a branch and a PR for the main file</li>\n</ul>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"571941\">@Lua Viana Reis</span> I'm not a mathlib expert but I believe that now is a good time for creating branches of mathlib and preparing the PRs for things like the lemmas to add to BirkhoffSum, to BirkhoffAverage and to PatialSups. Moreover, arranged as PRs (even as drafts) it's much easier for others to give feedback and suggestions.</p>",
        "id": 521939956,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1748939976
    },
    {
        "content": "<p>Concerning the issue of removing the measurability assumption of the observable, I believe (as Sebastien wrote) that it is good to keep this as an assumption for most the lemmas and then argue at the end of the proof how this isn't actually required.</p>\n<p>We should ask <span class=\"user-mention\" data-user-id=\"630496\">@Marco Lenci</span> about this because I'm fairly sure he thought about this previously and understood how to do it. I think he also explained to me and then I forgot. Marco, would you be able to give a few comments about how the assumption can be dropped in the final part of the proof?</p>",
        "id": 522060656,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1748940257
    },
    {
        "content": "<p>Isn't the argument just that if <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>φ</mi></mrow><annotation encoding=\"application/x-tex\">\\varphi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">φ</span></span></span></span> is integrable and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span> measure-preserving, then you can apply the current version with the completion of the sigma-algebra (<code>NullMeasurableSpace</code>) and then prove that the \"ae\" quantifier and both sides of the equation are still equal to the original? (better said than done, probably)</p>",
        "id": 522176076,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1748970340
    },
    {
        "content": "<p>I will take a look at your PR today, in the last weeks I was working on making the infoview work in emacs (<a class=\"stream-topic\" data-stream-id=\"270676\" href=\"/#narrow/channel/270676-lean4/topic/need.20help.20setting.20up.20lean4-infoview/with/518855559\">#lean4 &gt; need help setting up lean4-infoview</a>)</p>",
        "id": 522176603,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1748970519
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"571941\">Lua Viana Reis</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Birkhoff.20Ergodic.20Theorem/near/522176603\">said</a>:</p>\n<blockquote>\n<p>in the last weeks I was working on making the infoview work in emacs (<a class=\"stream-topic\" data-stream-id=\"270676\" href=\"/#narrow/channel/270676-lean4/topic/need.20help.20setting.20up.20lean4-infoview/with/518855559\">#lean4 &gt; need help setting up lean4-infoview</a>)</p>\n</blockquote>\n<p><span aria-label=\"rofl\" class=\"emoji emoji-1f923\" role=\"img\" title=\"rofl\">:rofl:</span> the sort of unexpectedly huge technical task that I'm normally attracted to. Good luck with it! For lean vscode is very well supported and on this I'm lazy!</p>",
        "id": 522185811,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1748973502
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"571941\">Lua Viana Reis</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Birkhoff.20Ergodic.20Theorem/near/522176076\">said</a>:</p>\n<blockquote>\n<p>Isn't the argument just that if <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>φ</mi></mrow><annotation encoding=\"application/x-tex\">\\varphi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">φ</span></span></span></span> is integrable and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span> measure-preserving, then you can apply the current version with the completion of the sigma-algebra (<code>NullMeasurableSpace</code>) and then prove that the \"ae\" quantifier and both sides of the equation are still equal to the original? (better said than done, probably)</p>\n</blockquote>\n<p>That is completely convincing mathematically! Maybe it works nicely as a <code>wlog</code> in the last part.</p>",
        "id": 522186326,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1748973674
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"613177\">Oliver Butterley</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Birkhoff.20Ergodic.20Theorem/near/522060656\">said</a>:</p>\n<blockquote>\n<p>We should ask @Marco Lenci about this because I'm fairly sure he thought about this previously and understood how to do it. I think he also explained to me and then I forgot. Marco, would you be able to give a few comments about how the assumption can be dropped in the final part of the proof?</p>\n</blockquote>\n<p>Hello both,<br>\nI'm confused as to why I've been summoned from Lean obscurity. <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span> If the issue is what formalization is preferable in terms of the hypothesis on the observable, I'm not sure I can help. (Even on the purely mathematical side, I never went into the fine details of differentiating between measurable and strongly measurable.)</p>\n<p>What I mentioned to <span class=\"user-mention\" data-user-id=\"613177\">@Oliver Butterley</span> once was that the Katok-Hasselblatt proof of the Birkhoff Ergodic Theorem is rather convenient for Lean too because, save for the last few lines, it provides the explicit invariant zero-measure set in the complement of which the Birkhoff average exists (this formulation is not 100% correct, but it should point you close enough to what I mean). That way, the complications due to the fact the the Birkhoff average only exists almost everywhere are dealt with in Lean with minimal effort.</p>",
        "id": 522417501,
        "sender_full_name": "Marco Lenci",
        "timestamp": 1749059156
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"571941\">Lua Viana Reis</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Birkhoff.20Ergodic.20Theorem/near/522176603\">said</a>:</p>\n<blockquote>\n<p>I will take a look at your PR today, in the last weeks I was working on making the infoview work in emacs (<a class=\"stream-topic\" data-stream-id=\"270676\" href=\"/#narrow/channel/270676-lean4/topic/need.20help.20setting.20up.20lean4-infoview/with/518855559\">#lean4 &gt; need help setting up lean4-infoview</a>)</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"571941\">@Lua Viana Reis</span>  Were the generalised lemmas as you wanted? Any further changes I should make?</p>",
        "id": 523247439,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1749547971
    },
    {
        "content": "<p>In preparation for dropping the measurability assumption in the main theorem of BET I started on some of the required lemmas. <a href=\"https://github.com/leanprover-community/mathlib4/pull/26074\">#26074</a> includes the lemma that the <code>birkhoffAverage</code> of an integrable observable is equal to the <code>birkhoffAverage</code> of the measurable version of the observable (<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MeasureTheory.AEStronglyMeasurable.mk#doc\">docs#MeasureTheory.AEStronglyMeasurable.mk</a>).</p>",
        "id": 524657972,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1750236592
    },
    {
        "content": "<p>I <a href=\"https://github.com/estradilua/pointwise-birkhoff/pull/4\">added the argument</a> which proves the measurability of the observable assumption to be dropped in the final statement.</p>",
        "id": 524832458,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1750319237
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"571941\">Lua Viana Reis</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Birkhoff.20Ergodic.20Theorem/near/519446867\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"613177\">Oliver Butterley</span> here is a quick proposal for a plan:</p>\n<ul>\n<li>update the repository to latest mathlib and lean</li>\n<li>write the lemmas in the <code>*PR.lean</code> files in their full generality, then create branches and PR them to mathlib</li>\n<li>discuss how to remove the measurability assumption of the observable in the main file and remove it</li>\n<li>create a branch and a PR for the main file</li>\n</ul>\n</blockquote>\n<p>We are doing well on the plan! There are small improvements to be made to the main proof but it is a complete argument. It's time to PR some of the parts and proceed refining everything.  </p>\n<p><span class=\"user-mention\" data-user-id=\"571941\">@Lua Viana Reis</span> how would you like to proceed? Shall I start with doing the PRs to mathlib for the <code>*PR.lean</code> files?</p>",
        "id": 524833632,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1750319765
    },
    {
        "content": "<p>Hi Oliver, that's a lot of progress, thanks! Sorry for the delay, I think I'll just merge your PR; you probably had more time to think it through than I have now. In any case I'll read it and post relevant comments there</p>",
        "id": 524885373,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1750339364
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"613177\">Oliver Butterley</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Birkhoff.20Ergodic.20Theorem/near/524833632\">said</a>:</p>\n<blockquote>\n<p>how would you like to proceed? Shall I start with doing the PRs to mathlib for the <code>*PR.lean</code> files?</p>\n</blockquote>\n<p>If you prefer I can create them this afternoon</p>",
        "id": 524926942,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1750354652
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"571941\">Lua Viana Reis</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Birkhoff.20Ergodic.20Theorem/near/524926942\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"613177\">Oliver Butterley</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Birkhoff.20Ergodic.20Theorem/near/524833632\">said</a>:</p>\n<blockquote>\n<p>how would you like to proceed? Shall I start with doing the PRs to mathlib for the <code>*PR.lean</code> files?</p>\n</blockquote>\n<p>If you prefer I can create them this afternoon</p>\n</blockquote>\n<p>That would be great! My working day finished an hour ago so I won't do anything until tomorrow. If you leave me a message with instructions I can carry on the work when I wake up.</p>",
        "id": 524927635,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1750355077
    },
    {
        "content": "<p><span class=\"topic-mention\">@topic</span> are these small lemmas worth PRing to <code>.Filter.Basic</code>? They make <a href=\"https://github.com/estradilua/pointwise-birkhoff/blob/fc06094ca0506d8d74eba8b45b34882ce5930bf4/BirkhoffErgodicThm.lean#L295-L302\">this</a> <code>calc</code> proof more readable by allowing dot notation</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Filter</span><span class=\"bp\">.</span><span class=\"n\">EventuallyEq</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Filter</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f₁</span><span class=\"w\"> </span><span class=\"n\">f₂</span><span class=\"w\"> </span><span class=\"n\">f₃</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Mul</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">]</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">to_additive</span><span class=\"kd\">]</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">mul_right</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f₁</span><span class=\"w\"> </span><span class=\"bp\">=ᶠ</span><span class=\"o\">[</span><span class=\"n\">f</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">f₂</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f₁</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">f₃</span><span class=\"w\"> </span><span class=\"bp\">=ᶠ</span><span class=\"o\">[</span><span class=\"n\">f</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">f₂</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">f₃</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mul</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"o\">)</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">to_additive</span><span class=\"kd\">]</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">mul_left</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f₁</span><span class=\"w\"> </span><span class=\"bp\">=ᶠ</span><span class=\"o\">[</span><span class=\"n\">f</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">f₂</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f₃</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">f₁</span><span class=\"w\"> </span><span class=\"bp\">=ᶠ</span><span class=\"o\">[</span><span class=\"n\">f</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">f₃</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">f₂</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mul</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>",
        "id": 524979007,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1750396277
    },
    {
        "content": "<p>(most importantly, nested dot notation like <code>h.add_right.neg.add_left</code> to apply h to a term inside the expression --- perhaps there is some sort of <code>conv</code> that does this for filters?)</p>",
        "id": 524979286,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1750396591
    },
    {
        "content": "<p>My personal opinion is that <code>mul_right</code> and <code>mul_left</code>  could be added to <code>Mathlib.Order.Filter.Basic</code> but I'm not a mathlib expert. </p>\n<p>From a practical point of view I would suggest opening the small PR to mathlib which adds these two lemmas. As a PR it is much easier for experts to give feedback.</p>",
        "id": 524997930,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1750407847
    },
    {
        "content": "<p>Is there any convention on the order in which theorems appear in a file? (my intuition was to group with related statements if possible) </p>\n<p>And in the use of <code>theorem</code> vs <code>lemma</code>?</p>",
        "id": 525097176,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1750449566
    },
    {
        "content": "<p>it is my experience that <code>lemma</code> has the best ease of typing to rejection ratio</p>",
        "id": 525099393,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1750450966
    },
    {
        "content": "<p>thing is, the whole (existing) file is just <code>theorem</code>s and I think it gonna look akward to have my new statements be the only <code>lemma</code>s</p>",
        "id": 525099594,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1750451102
    },
    {
        "content": "<p>(All code translated from lean 3 used <code>theorem</code>.)</p>",
        "id": 525105386,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1750454883
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Birkhoff.20Ergodic.20Theorem/near/525105386\">said</a>:</p>\n<blockquote>\n<p>(All code translated from lean 3 used <code>theorem</code>.)</p>\n</blockquote>\n<p>Still, I think talking about it in the contributing guidelines would be good... I remember the instructions were very detailed for the mathport, so now the freedom makes me insecure</p>",
        "id": 525107311,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1750456013
    },
    {
        "content": "<p>I'm of the opinion that in code, if there is a semantically meaningless difference, then better have no difference at all (so no <code>lemma</code>). I probably have to find the topic discussing why it was brought back</p>",
        "id": 525108064,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1750456557
    },
    {
        "content": "<p>It seems that there is a big split of opinion here between those with a more CS background (who want an algorithm and are confused about the fact that there are two options) and mathematicians (who have just been solving this problem by vibes for centuries and can't see what the fuss is about)</p>",
        "id": 525164566,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1750518738
    },
    {
        "content": "<p>I'm a mathematician :p and I do like writing <code>lemma</code>s, just not in software! :)</p>\n<p>I think the nicest option would be an attribute like <code>@[important]</code>, signaling that some theorem is one of the main things in the file</p>",
        "id": 525164718,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1750518929
    },
    {
        "content": "<p>Since previous theorems were not turned into lemmas after mathport, the current situation looks like a big mess to me</p>",
        "id": 525164777,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1750519016
    },
    {
        "content": "<p>I agree that the port was a setback to the whole vibes thing but we're doing our best to insert new vibes back into mathlib4 and will probably continue to do so until we're forcibly stopped</p>",
        "id": 525164885,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1750519154
    },
    {
        "content": "<p>Does it even matter?</p>",
        "id": 525164946,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1750519227
    },
    {
        "content": "<p>it does in the sense it is meant to convey some _meaning_, but this is not enforced (and currently, the use does not reflect the intended meaning)</p>",
        "id": 525165016,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1750519303
    },
    {
        "content": "<p>if we used an attribute like <code>@[important]</code> or <code>@[main_result]</code>, then this intended meaning could be used to automatically extract actual stuff like a \"list of main results\"</p>",
        "id": 525165165,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1750519457
    },
    {
        "content": "<p>I was thinking recently, it would be very nice if we used more attributes to tag informal/cultural information for theorems in mathlib. We could have attributes like <code>@[informal_name \"Birkhoff Ergodic Theorem\"]</code> (or even a list of such informal names) that would be very very useful for docs and search tools</p>",
        "id": 525165765,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1750520181
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"571941\">Lua Viana Reis</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Birkhoff.20Ergodic.20Theorem/near/525165765\">said</a>:</p>\n<blockquote>\n<p>or even a list of such informal names</p>\n</blockquote>\n<p>The <a href=\"https://github.com/leanprover-community/mathlib4/blob/master/docs/1000.yaml\">1000+ theorem list</a> occasionally served this purpose for me</p>",
        "id": 525166288,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1750520748
    },
    {
        "content": "<p>Also about lemma vs theorem, I would find it more useful if it is reflected in the doc. Currently it seems all lemma is displayed as theorem in the doc</p>",
        "id": 525166377,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1750520869
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"873350\">@Weiyi Wang</span> exactly! A list like that could easily be automatically generated if we tagged more information on the theorems, and the docs could reflect this information. I was also thinking about more editor tooling, e.g. \"jump to theorem\" where you can write the informal name</p>",
        "id": 525166940,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1750521600
    },
    {
        "content": "<p>I think I'll put a proof-of-concept library for this in my todo list</p>",
        "id": 525167296,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1750521952
    },
    {
        "content": "<p>There's been lots of previous discussion on the lemma-vs-theorem issue. A few incremental improvements that are possible already are:</p>\n<ul>\n<li>if something should be a theorem, make sure it has a doc-string (this was one of the proposals from these threads, I don't think it's enforced yet)</li>\n<li>there's an informal preference that named theorems should have their name in bold (as in <code>the **central limit theorem**</code>; PRs adding this are welcome)</li>\n<li>I think the 1000+ theorems list could serve the purpose of a lookup table: making it more useful rests on making the table more complete. More specifically, help that does<ul>\n<li>add missing entries to the wikipedia list (see <a href=\"https://github.com/1000-plus/1000-plus.github.io/issues/32\">here</a> for some inspiration)</li>\n<li>ask very nicely so <span class=\"user-mention\" data-user-id=\"217807\">@Freek Wiedijk</span> updates the list of theorems tracked by the project. (This is auto-generated by a script, so in principle very possible. Knowing \"Wikipedia's list just got <em>much</em> better\" could be a reason to spend the time on an update. Also tracked <a href=\"https://github.com/1000-plus/1000-plus.github.io/issues/20\">here</a> on the 1000+ theorems repository)</li>\n<li>help with filling in the Lean data for formalised theorems. My guess is that the current list is fairly complete; new entries to the list will change this, of course.</li>\n</ul>\n</li>\n</ul>",
        "id": 525308595,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1750677642
    },
    {
        "content": "<p>All of this is incremental, so even small contributions in the right direction can be helpful.</p>",
        "id": 525308645,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1750677659
    },
    {
        "content": "<p>Oh, and I forgot: convince people in the Isabelle/Rocq/Metamath community that this list is cool, so they should be adding data about their formalisations :-)</p>",
        "id": 525308715,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1750677684
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Birkhoff.20Ergodic.20Theorem/near/525308595\">said</a>:</p>\n<blockquote>\n<p>- add missing entries to the wikipedia list (see [here] for some inspiration)</p>\n</blockquote>\n<p>Where? Which wikipedia list?</p>",
        "id": 525451653,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1750747850
    },
    {
        "content": "<p><a href=\"https://en.wikipedia.org/wiki/List_of_theorems\">https://en.wikipedia.org/wiki/List_of_theorems</a> ?</p>",
        "id": 525457672,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1750750587
    },
    {
        "content": "<p>The list of missing items is <a href=\"https://github.com/1000-plus/1000-plus.github.io/issues/32\">https://github.com/1000-plus/1000-plus.github.io/issues/32</a>. Sorry for sending this too early.</p>",
        "id": 525472308,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1750755741
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"571941\">Lua Viana Reis</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Birkhoff.20Ergodic.20Theorem/near/524926942\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"613177\">Oliver Butterley</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Birkhoff.20Ergodic.20Theorem/near/524833632\">said</a>:</p>\n<blockquote>\n<p>how would you like to proceed? Shall I start with doing the PRs to mathlib for the <code>*PR.lean</code> files?</p>\n</blockquote>\n<p>If you prefer I can create them this afternoon</p>\n</blockquote>\n<p>Hi <span class=\"user-mention\" data-user-id=\"571941\">@Lua Viana Reis</span>, I got distracted away from the main purpose here. Are there some more things I can help with in the process of PRing your proof of Birkhoff's ergodic thm? My impression is that:</p>\n<ul>\n<li>There are many small lemmas in the separate files which which are in a good state and need to have mathlib PRs done. </li>\n<li>Then there is the main file of the proof which is mostly in a good condition. I think there could be some tidying of the file, renaming of the statements, complete doc string for the main statement, etc. Possibly also the use of  <code>ℝ</code> in <code>{φ : α → ℝ}</code> can be slightly generalised. <br>\nGive me instructions if there is something I can do.</li>\n</ul>",
        "id": 526847430,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1751476486
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"613177\">@Oliver Butterley</span>, yes, I've been juggling a few different things in life and was not able to allocate time to the birkhoff PR. I'm without a fixed source of income and not yet sure where I'll do my PhD, so this situation may continue in the next months. I've also forbidden myself from working on the computer at night like I used to do, for health-related reasons. But please note that it's all open sourced, so there is no problem if you want to do it yourself :)</p>",
        "id": 526894373,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1751499466
    },
    {
        "content": "<p>I'm sorry for you, that's not a very comfortable position to be in. I hope you find a great solution soon! Very wise to reduce night time use of computers, I learnt this only a short time ago. <span aria-label=\"healthier\" class=\"emoji emoji-2764-200d-1fa79\" role=\"img\" title=\"healthier\">:healthier:</span> <span aria-label=\"happy\" class=\"emoji emoji-1f600\" role=\"img\" title=\"happy\">:happy:</span> </p>\n<p>I would happily support your application for a PhD at my university but, given your interests and skills, I suspect another university would be a far better choice for you. Let me know if I can help with anything connected to this. Good luck with it all!</p>",
        "id": 526934879,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1751528473
    },
    {
        "content": "<p>You did a great work with the proof of Birkhoff's ET. I'll proceed with doing the PRs and any final tidying. I'm doing some other stuff which builds on BET so it will be convenient to have BET finalized.</p>",
        "id": 526935222,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1751528614
    },
    {
        "content": "<p>I prepared the PR for the main theorem: <a href=\"https://github.com/leanprover-community/mathlib4/pull/26923\">#26923</a> and multiple PRs for all the little lemmas that belong somewhere else in mathlib. The changes I made compared to your version <span class=\"user-mention\" data-user-id=\"571941\">@Lua Viana Reis</span> were mostly things to match mathlib style, e.g., replacing <code>cases'</code>, etc.</p>",
        "id": 527832478,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1752049222
    },
    {
        "content": "<p>Conversation continues in the PR reviews channels: <a class=\"stream-topic\" data-stream-id=\"144837\" href=\"/#narrow/channel/144837-PR-reviews/topic/.2326923.20The.20pointwise.20ergodic.20theorem.20.28Birkhoff.27s.29/with/527835158\">#PR reviews &gt; #26923 The pointwise ergodic theorem (Birkhoff's)</a></p>",
        "id": 527837567,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1752050779
    }
]