[
    {
        "content": "<p>I am currently working with sheaves of abelian groups on a topological space and would like to use the fact that they form an abelian category.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TopCat</span><span class=\"o\">)</span>\n\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">Abelian</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Sheaf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Opens</span><span class=\"bp\">.</span><span class=\"n\">grothendieckTopology</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">AddCommGrpCat</span><span class=\"o\">)</span>\n\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">Abelian</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TopCat</span><span class=\"bp\">.</span><span class=\"n\">Sheaf</span><span class=\"w\"> </span><span class=\"n\">AddCommGrpCat</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Currently the first #synth works but the second does not, even though they are the same by definition. I changed the definition of TopCat.Sheaf from a def to an abbrev in mathlib and it fixed this issue and I was still able to build mathlib. Is this a reasonable change? I know I can just write an instance of </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Abelian</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TopCat</span><span class=\"bp\">.</span><span class=\"n\">Sheaf</span><span class=\"w\"> </span><span class=\"n\">AddCommGrpCat</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>but I figure this change might help with other type inferences.</p>",
        "id": 568513474,
        "sender_full_name": "Brian Nugent",
        "timestamp": 1768593572
    },
    {
        "content": "<p>I think <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=TopCat.Sheaf.presheaf#doc\">docs#TopCat.Sheaf.presheaf</a> shouldn't be an <code>abbrev</code> if <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=TopCat.Sheaf#doc\">docs#TopCat.Sheaf</a> is a <code>def</code></p>",
        "id": 568513779,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1768593675
    },
    {
        "content": "<p>so making <code>TopCat.Sheaf</code> also an <code>abbrev</code> would fix this</p>",
        "id": 568514240,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1768593832
    },
    {
        "content": "<p>I would think that most of the API about sheaves on topological spaces should be abbreviations referring to the more general notions for sites. However, there is still one aspect of the formalization of sheaves on topological spaces for which we do not have a complete general API yet: this is the functor of stalks and its properties (even though I have recently introduced the notion of point of a site <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/CategoryTheory/Sites/Point/Basic.html\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/CategoryTheory/Sites/Point/Basic.html</a>).</p>",
        "id": 568518687,
        "sender_full_name": "JoÃ«l Riou",
        "timestamp": 1768595514
    },
    {
        "content": "<p>Ok, I've opened a PR to change some of them. <a href=\"https://github.com/leanprover-community/mathlib4/pull/34094\">#34094</a></p>",
        "id": 568636975,
        "sender_full_name": "Brian Nugent",
        "timestamp": 1768712325
    },
    {
        "content": "<p>Sorry, a bit late to the party. There is value in preserving an API barrier between sheaves on a topological space and the general notion. It allows users to use the <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=TopCat.Sheaf#doc\">docs#TopCat.Sheaf</a> API without knowing about Grothendieck topologies. Making it an <code>abbrev</code> means that the site API will leak through more easily.</p>",
        "id": 568655660,
        "sender_full_name": "Christian Merten",
        "timestamp": 1768733685
    }
]