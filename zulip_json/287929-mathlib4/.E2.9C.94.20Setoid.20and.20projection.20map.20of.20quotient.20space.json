[
    {
        "content": "<p>Hi, I currently have this piece of code.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">r_trivial</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">True</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">r_trivial2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">y</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">eq_trivial</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Equivalence</span><span class=\"w\"> </span><span class=\"n\">r_trivial</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">    </span><span class=\"n\">trivial</span>\n<span class=\"w\">  </span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">    </span><span class=\"n\">trivial</span>\n<span class=\"w\">  </span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">    </span><span class=\"n\">trivial</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">eq_trivial2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Equivalence</span><span class=\"w\"> </span><span class=\"n\">r_trivial2</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">    </span><span class=\"n\">trivial</span>\n<span class=\"w\">  </span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n<span class=\"w\">  </span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"n\">h₁</span><span class=\"w\"> </span><span class=\"n\">h₂</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">h₁</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"n\">h₂</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">setoid_ℝ_trivial</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Setoid</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">iseqv</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">eq_trivial</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">setoid_ℝ_trivial2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Setoid</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">iseqv</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">eq_trivial2</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">quotient_ℝ_trivial</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Quotient</span><span class=\"w\"> </span><span class=\"n\">setoid_ℝ_trivial</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">quotient_ℝ_trivial2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Quotient</span><span class=\"w\"> </span><span class=\"n\">setoid_ℝ_trivial2</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">proj_ℝ_trivial</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">quotient_ℝ_trivial</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Quotient</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">setoid_ℝ_trivial</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">proj_ℝ_trivial2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">quotient_ℝ_trivial2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Quotient</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">setoid_ℝ_trivial2</span>\n</code></pre></div>\n<p>My questions are:</p>\n<ol>\n<li>Why do we have to separate Setoid and Equivalence?</li>\n<li>Why can't we get the projection map from <code>quotient_ℝ_intdiff</code> (or, maybe equivalently, why isn't <code>Quotient setoid_ℝ_trivial</code> already having/automatically generating/providing the computation for the projection map)? Doing <code>Quotient.mk setoid_ℝ_trivial</code> feels redundant.</li>\n<li>If I were to replace <code>Quotient.mk setoid_ℝ_trivial</code> with <code>Quotient.mk'</code>, then it would fail because it recognizes the trivial2 instance instead of the trivial instance for <code>Setoid ℝ</code>. Couldn't things be automatically resolved since we already specified <code>quotient_ℝ_trivial</code> (and so things should tied back to <code>setoid_ℝ_trivial</code>)?</li>\n</ol>",
        "id": 496261911,
        "sender_full_name": "The-Anh Vu-Le",
        "timestamp": 1738043038
    },
    {
        "content": "<p>Typeclass interference is designed under the assumption \"one instance per class\" and your two instances of <code>Setoid \\R</code> break this assumption</p>",
        "id": 496267685,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738046916
    },
    {
        "content": "<p>Does this mean there should only be one instance of Setoid \\R? But there can be a lot of equivalence relation on \\R. Am I using it wrong?</p>",
        "id": 496270691,
        "sender_full_name": "The-Anh Vu-Le",
        "timestamp": 1738048702
    },
    {
        "content": "<p>Yes I agree that there can be more than one equivalence relation on a type and I've always been confused about why <code>Setoid</code> is a class. Compare with the class <code>Group</code> where there can in theory be two different multiplications on a type but 99% of the time there isn't, and the fact that <code>Group</code> is a class makes <code>a * b</code> unambiguous. But when quotienting out a group by two normal subgroups one is naturally led to two different equivalence relations on a group. I guess they're just not registered as instances of <code>Setoid</code>.</p>",
        "id": 496271193,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738048980
    },
    {
        "content": "<p>Indeed <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=QuotientGroup.leftRel#doc\">docs#QuotientGroup.leftRel</a> is a <code>def</code> not an <code>instance</code>.</p>",
        "id": 496271691,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738049221
    },
    {
        "content": "<p>I think this resolves my 3rd question. My conclusiom is <code>def</code> should be used to make setoid instances and <code>Quotient.mk'</code> should not be used but rather <code>Quotient.mk</code> to explicitly specify the setoid instance we want.</p>",
        "id": 496330370,
        "sender_full_name": "The-Anh Vu-Le",
        "timestamp": 1738069540
    },
    {
        "content": "<p>Right, this is why we have several variants of the <code>Quotient</code> API.</p>",
        "id": 496344124,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738073513
    },
    {
        "content": "<p>The answer to your first question is perhaps \"<code>Equivalence</code> is a structure, <code>Setoid</code> is a class, and both are useful\". For your second question I suspect that if you replaced <code>def quotient_ℝ_trivial</code> with <code>abbrev quotient_ℝ_trivial</code> (or maybe you don't even need to do this) then <code>Quotient.mk _</code> might work.</p>",
        "id": 496344722,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738073666
    },
    {
        "content": "<p>Yes, it does work (even without <code>abbrev</code>). Somehow, something like <code>quotient_ℝ_trivial.mk</code> sounds better in my mind. But maybe I'm not considering other use-cases. Thanks.</p>",
        "id": 496418057,
        "sender_full_name": "The-Anh Vu-Le",
        "timestamp": 1738095864
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"750932\">The-Anh Vu-Le</span> has marked this topic as resolved.</p>",
        "id": 496418087,
        "sender_full_name": "Notification Bot",
        "timestamp": 1738095882
    }
]