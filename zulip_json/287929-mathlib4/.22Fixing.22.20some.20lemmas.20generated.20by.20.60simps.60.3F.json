[
    {
        "content": "<p>Looking at <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CategoryTheory.prodOpEquiv_counitIso#doc\">docs#CategoryTheory.prodOpEquiv_counitIso</a> (a lemma auto-generated by <code>simps</code>), the statement is quite ugly, and is one big <code>Iso.refl</code>, which should simplify further to <code>ùüô _</code>.  I am a bit confused as I thought <code>simps</code> was calling <code>simp</code> on the rhs to have it in a simplified form. How come?<br>\nAs it contains proof terms, it might also potentially run into the problem described in <a class=\"stream-topic\" data-stream-id=\"270676\" href=\"/#narrow/channel/270676-lean4/topic/dsimp.20simplifies.20proofs.2C.20which.20is.20slow/with/497950830\">#lean4 &gt; dsimp simplifies proofs, which is slow</a> . In this case, there is an easy fix (just write the \"right\" lemma with a better rhs). But is there a way to actually automate this? I ran into similar-looking troubles in <a href=\"https://github.com/leanprover-community/mathlib4/pull/22278\">#22278</a>, and had to manually add some of the lemmas.</p>",
        "id": 502030867,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1740571670
    },
    {
        "content": "<p>In this case <code>@[simps!]</code> gives better results. Then you get <code>counitIso_hom_app</code>¬†and <code>counitIso_inv_app</code>. You can even go further and pass it the names of the lemmas you want it to generate (try for example <code>@[simps!? counitIso_hom_app_fst]</code> -- just to see what I mean, in this case I think you'd rather want <code>counitIso_hom_app</code>)</p>",
        "id": 502041018,
        "sender_full_name": "Dagur Asgeirsson",
        "timestamp": 1740574786
    },
    {
        "content": "<p>I know about <code>simps!</code>, but in general, even the <code>simps!</code> ones might have issues (to un#xy, in <a href=\"https://github.com/leanprover-community/mathlib4/pull/22278\">#22278</a>, a full <code>[@simps! counitIso_hom_app</code>] on <code>Sum.functorEquiv</code>gives a term that contains some <code>(NatIso.ofComponents (fun x ‚Ü¶ Iso.refl _ )).hom</code> and that should definitely simplify more), so I guess my question is rather whether or not there is any way we can give \"hints\" to <code>simps</code> or <code>simps!</code> to control the terms it generates (aside from just specifying which terms we want to generate).</p>",
        "id": 502042769,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1740575304
    }
]