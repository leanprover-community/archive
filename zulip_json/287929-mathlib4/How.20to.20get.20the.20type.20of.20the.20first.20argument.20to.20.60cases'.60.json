[
    {
        "content": "<p>The code defining <code>cases'</code> in mathlib is as follows.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">cases'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"cases' \"</span><span class=\"w\"> </span><span class=\"n\">tgts</span><span class=\"o\">:(</span><span class=\"n\">Parser</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">casesTarget</span><span class=\"o\">,</span><span class=\"bp\">+</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">usingArg</span><span class=\"o\">:((</span><span class=\"s2\">\" using \"</span><span class=\"w\"> </span><span class=\"n\">ident</span><span class=\"o\">)</span><span class=\"bp\">?</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">withArg</span><span class=\"o\">:((</span><span class=\"s2\">\" with\"</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ppSpace</span><span class=\"w\"> </span><span class=\"n\">colGt</span><span class=\"w\"> </span><span class=\"n\">binderIdent</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"o\">)</span><span class=\"bp\">?</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">targets</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">toTag</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">elabCasesTargets</span><span class=\"w\"> </span><span class=\"n\">tgts</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">.</span><span class=\"n\">getSepArgs</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">gs</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getUnsolvedGoals</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">throwNoGoalsToBeSolved</span>\n<span class=\"w\">  </span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"n\">withContext</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">elimInfo</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getElimNameInfo</span><span class=\"w\"> </span><span class=\"n\">usingArg</span><span class=\"w\"> </span><span class=\"n\">targets</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">targets</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">addImplicitTargets</span><span class=\"w\"> </span><span class=\"n\">elimInfo</span><span class=\"w\"> </span><span class=\"n\">targets</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">withRef</span><span class=\"w\"> </span><span class=\"n\">tgts</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">ElimApp</span><span class=\"bp\">.</span><span class=\"n\">mkElimApp</span><span class=\"w\"> </span><span class=\"n\">elimInfo</span><span class=\"w\"> </span><span class=\"n\">targets</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"n\">getTag</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">elimArgs</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"bp\">.</span><span class=\"n\">elimApp</span><span class=\"bp\">.</span><span class=\"n\">getAppArgs</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">targets</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">elimInfo</span><span class=\"bp\">.</span><span class=\"n\">targetsPos</span><span class=\"bp\">.</span><span class=\"n\">mapM</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">instantiateMVars</span><span class=\"w\"> </span><span class=\"n\">elimArgs</span><span class=\"o\">[</span><span class=\"bp\">·</span><span class=\"o\">]</span><span class=\"bp\">!</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">elimArgs</span><span class=\"o\">[</span><span class=\"n\">elimInfo</span><span class=\"bp\">.</span><span class=\"n\">motivePos</span><span class=\"o\">]</span><span class=\"bp\">!</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">generalizeTargetsEq</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">inferType</span><span class=\"w\"> </span><span class=\"n\">motive</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">targets</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">targetsNew</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"n\">introN</span><span class=\"w\"> </span><span class=\"n\">targets</span><span class=\"bp\">.</span><span class=\"n\">size</span>\n<span class=\"w\">    </span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"n\">withContext</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">      </span><span class=\"n\">ElimApp</span><span class=\"bp\">.</span><span class=\"n\">setMotiveArg</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">motive</span><span class=\"bp\">.</span><span class=\"n\">mvarId!</span><span class=\"w\"> </span><span class=\"n\">targetsNew</span>\n<span class=\"w\">      </span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"n\">assign</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"bp\">.</span><span class=\"n\">elimApp</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">subgoals</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">ElimApp</span><span class=\"bp\">.</span><span class=\"n\">evalNames</span><span class=\"w\"> </span><span class=\"n\">elimInfo</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"bp\">.</span><span class=\"n\">alts</span><span class=\"w\"> </span><span class=\"n\">withArg</span>\n<span class=\"w\">         </span><span class=\"o\">(</span><span class=\"n\">numEqs</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">targets</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">toClear</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">targetsNew</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">toTag</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">toTag</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"n\">setGoals</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">subgoals</span><span class=\"bp\">.</span><span class=\"n\">toList</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">gs</span>\n</code></pre></div>\n<p>How could I modify this code to print out (using <code>logInfo</code>) the type of the head of the first argument passed to <code>cases'</code>? For example with <code>cases' eq_or_lt_of_le (hz i hi) with hz hz</code> I want <code>Or</code> to be printed out, for <code>cases' i with j</code> with <code>i</code> a <code>Nat</code> I want <code>Nat</code> to be printed out, etc.</p>",
        "id": 467746106,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1725521616
    },
    {
        "content": "<p>And if it is a type with explicit constructors (i.e. <code>cases'</code> generates one case called <code>intro</code>) I want to be able to know that as well</p>",
        "id": 467748711,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1725522305
    },
    {
        "content": "<p>Is <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Meta.inferType#doc\">docs#Lean.Meta.inferType</a> what you are looking for?</p>",
        "id": 467752461,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1725523264
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/stream/287929-mathlib4/topic/How.20to.20get.20the.20type.20of.20the.20first.20argument.20to.20.60cases'.60/near/467752461\">said</a>:</p>\n<blockquote>\n<p>Is <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Meta.inferType#doc\">docs#Lean.Meta.inferType</a> what you are looking for?</p>\n</blockquote>\n<p>No:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">application</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">mismatch</span>\n<span class=\"w\">  </span><span class=\"n\">inferType</span><span class=\"w\"> </span><span class=\"n\">tgts</span><span class=\"bp\">.</span><span class=\"n\">raw</span><span class=\"bp\">.</span><span class=\"n\">getSepArgs</span>\n<span class=\"n\">argument</span>\n<span class=\"w\">  </span><span class=\"n\">tgts</span><span class=\"bp\">.</span><span class=\"n\">raw</span><span class=\"bp\">.</span><span class=\"n\">getSepArgs</span>\n<span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Syntax</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n</code></pre></div>",
        "id": 467753482,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1725523494
    },
    {
        "content": "<p>Furthermore the output type of <code>inferType</code>, <code>MetaM Expr</code>, cannot be printed</p>",
        "id": 467753770,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1725523573
    },
    {
        "content": "<p>Why are you apply <code>getSetArgs</code> before applying <code>inferType</code>? Also surely <code>Expr</code> <em>can</em> be printed? and you get that when binding a <code>MetaM Expr</code></p>",
        "id": 467754845,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1725523806
    },
    {
        "content": "<p>What is binding?</p>",
        "id": 467755451,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1725523878
    },
    {
        "content": "<p>If you have <code>e : MetaM Expr</code>, then doing <code>let e' ← e</code> inside a <code>do</code> block \"binds\" <code>e'</code> to <code>e</code>, in the sense that it's applying the <a href=\"https://en.wikipedia.org/wiki/Monad_(functional_programming)#Overview\">monadic bind</a>.</p>",
        "id": 467757119,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1725524096
    },
    {
        "content": "<p>This does compile, but I need to get the number of subgoals generated by each and every use of <code>cases'</code> first before seeing if it gets me the head of the type properly</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">zzz</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">inferType</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">targets</span><span class=\"bp\">.</span><span class=\"n\">get!</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"n\">logInfoAt</span><span class=\"w\"> </span><span class=\"n\">tgts</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"{zzz} {targets} {subgoals.toList.length}\"</span>\n</code></pre></div>",
        "id": 467757382,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1725524175
    },
    {
        "content": "<p>(A Lean modification is running right now)</p>",
        "id": 467757824,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1725524310
    },
    {
        "content": "<p>All right <span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span>, but how do I disable pretty printing when logging <code>zzz</code> above?</p>",
        "id": 467763891,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1725525372
    },
    {
        "content": "<p>oh</p>",
        "id": 467764275,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1725525438
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">zzz</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">inferType</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">targets</span><span class=\"bp\">.</span><span class=\"n\">get!</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"n\">logInfoAt</span><span class=\"w\"> </span><span class=\"n\">tgts</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"{zzz.setPPExplicit true} {targets} {subgoals.toList.length}\"</span>\n</code></pre></div>",
        "id": 467764808,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1725525523
    }
]