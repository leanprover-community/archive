[
    {
        "content": "<p>I thought that <code>abbrev</code> was supposed to be transparent for most things, but it turns out it is not the case for <code>fun_prop</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MeasurableSpace</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Measurable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">fun_prop</span><span class=\"w\"> </span><span class=\"c1\">-- works</span>\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">my_id</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MeasurableSpace</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">id</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Measurable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">my_id</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">fun_prop</span><span class=\"w\"> </span><span class=\"c1\">-- fails</span>\n</code></pre></div>\n<p>Is that something that can/should be fixed? <span class=\"user-mention\" data-user-id=\"346070\">@Tomas Skrivan</span> , what do you think?</p>",
        "id": 467853504,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1725541695
    },
    {
        "content": "<p>Yes this should be fixed, transparency is something I struggle with all the time.</p>",
        "id": 467857171,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1725542457
    },
    {
        "content": "<p>probably just missing a <code>whnfR</code> somewhere.</p>",
        "id": 467889674,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1725548455
    },
    {
        "content": "<p>Fixed in <a href=\"https://github.com/leanprover-community/mathlib4/pull/16512\">#16512</a></p>",
        "id": 467906879,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1725551970
    },
    {
        "content": "<p>Ugh a test broke, I know what is going on but it will take some time to fix it.</p>",
        "id": 467929752,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1725557472
    },
    {
        "content": "<p>The fix passes CI now :)</p>",
        "id": 467962666,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1725564768
    },
    {
        "content": "<p>While we are at fixing <code>fun_prop</code>. Can I get attention/review to <a href=\"https://github.com/leanprover-community/mathlib4/pull/16371\">#16371</a> which fixes some issues with let bindings and free variables.</p>",
        "id": 468020893,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1725585263
    }
]