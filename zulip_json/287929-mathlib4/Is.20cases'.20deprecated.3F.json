[
    {
        "content": "<p>I looked in the style guide but I didn't see any mention of whether <code>cases'</code> is still an OK tactic to use. I just saw an instance of it in <a href=\"https://github.com/leanprover-community/mathlib4/pull/12156\">#12156</a>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">theorem</span> <span class=\"n\">zero_of_hom_zero</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"bp\">Γ₀</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">hx</span> <span class=\"o\">:</span> <span class=\"n\">IsRankOne.hom</span> <span class=\"n\">v</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"k\">have</span> <span class=\"n\">hx0</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">x</span> <span class=\"o\">:=</span> <span class=\"n\">zero_le'</span>\n  <span class=\"n\">cases'</span> <span class=\"n\">le_iff_lt_or_eq.mp</span> <span class=\"n\">hx0</span> <span class=\"k\">with</span> <span class=\"n\">h_lt</span> <span class=\"n\">h_eq</span>\n  <span class=\"bp\">·</span> <span class=\"k\">have</span> <span class=\"n\">hs</span> <span class=\"o\">:=</span> <span class=\"n\">IsRankOne.strictMono</span> <span class=\"n\">v</span> <span class=\"n\">h_lt</span>\n    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">_root_.map_zero</span><span class=\"o\">,</span> <span class=\"n\">hx</span><span class=\"o\">]</span> <span class=\"n\">at</span> <span class=\"n\">hs</span>\n    <span class=\"n\">exact</span> <span class=\"n\">absurd</span> <span class=\"n\">hs</span> <span class=\"n\">not_lt_zero'</span>\n  <span class=\"bp\">·</span> <span class=\"n\">exact</span> <span class=\"n\">h_eq.symm</span>\n</code></pre></div>\n<p>and here both hypotheses need to be named, so if you do <code>cases</code> then must you end up with a longer proof and/or longer lines? I was reluctant to suggest that the author change it to <code>cases</code> when I couldn't make it more compact as well.</p>",
        "id": 433616450,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1713305997
    },
    {
        "content": "<p>I would personally not use <code>cases'</code>, but I don't think there's yet a consensus. <code>cases</code> would take one more line. If you want compact, try <code>.symm &lt;| hx0.eq_or_lt.resolve_left ...</code></p>",
        "id": 433617183,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1713306464
    },
    {
        "content": "<p>It isn't deprecated, perhaps mostly out of hope that one day we will have a tool for automatic replacement. I think it would be reasonable to have a rule against new uses, in any case.</p>",
        "id": 433639958,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1713323065
    },
    {
        "content": "<p>An intermediate style that I like to use if I don't want to figure out the names of the constructors is</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">theorem</span> <span class=\"n\">zero_of_hom_zero</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"bp\">Γ₀</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">hx</span> <span class=\"o\">:</span> <span class=\"n\">IsRankOne.hom</span> <span class=\"n\">v</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"k\">have</span> <span class=\"n\">hx0</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">x</span> <span class=\"o\">:=</span> <span class=\"n\">zero_le'</span>\n  <span class=\"n\">cases</span> <span class=\"n\">le_iff_lt_or_eq.mp</span> <span class=\"n\">hx0</span>\n  <span class=\"n\">next</span> <span class=\"n\">h_lt</span> <span class=\"bp\">=&gt;</span>\n    <span class=\"k\">have</span> <span class=\"n\">hs</span> <span class=\"o\">:=</span> <span class=\"n\">IsRankOne.strictMono</span> <span class=\"n\">v</span> <span class=\"n\">h_lt</span>\n    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">_root_.map_zero</span><span class=\"o\">,</span> <span class=\"n\">hx</span><span class=\"o\">]</span> <span class=\"n\">at</span> <span class=\"n\">hs</span>\n    <span class=\"n\">exact</span> <span class=\"n\">absurd</span> <span class=\"n\">hs</span> <span class=\"n\">not_lt_zero'</span>\n  <span class=\"n\">next</span> <span class=\"n\">h_eq</span> <span class=\"bp\">=&gt;</span>\n    <span class=\"n\">exact</span> <span class=\"n\">h_eq.symm</span>\n</code></pre></div>\n<p>That said, I don't think we need a rule against <code>cases'</code>. It's fair to suggest alternatives  however.</p>",
        "id": 433641388,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1713324197
    },
    {
        "content": "<p>That suggestion is even two lines longer than the <code>cases'</code> variant</p>",
        "id": 433649081,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1713329634
    },
    {
        "content": "<p>The \"return\" key on most keyboards is pretty durable, Kevin. :-)</p>",
        "id": 433659502,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1713330676
    },
    {
        "content": "<p>(That is, number of lines is not something we should be optimising for. It's structurally the same proof, so the only relevant questions are maintainability / readability.)</p>",
        "id": 433661599,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1713330749
    },
    {
        "content": "<p><code>rcases</code> is often a much smaller diff from <code>cases'</code>, and it's available in core</p>",
        "id": 433664653,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713332466
    },
    {
        "content": "<p>I think we can deprecate <code>cases'</code> in favor of <code>rcases</code>, <code>obtain</code>, <code>cases</code>. I think there are no cases where <code>cases'</code> is actually better than all three of those alternatives</p>",
        "id": 433664804,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713332555
    },
    {
        "content": "<p>Now if only <code>cases</code> supported <code>rcases</code> patterns :)</p>",
        "id": 433711220,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1713345878
    },
    {
        "content": "<p>I'm visiting Johan today and we had a discussion about this during which he revealed that he didn't use <code>rcases</code> because it wasn't an English word and so it made the code look more confusing. He convinced me that <code>obtain</code> is best.</p>",
        "id": 433733936,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1713353843
    },
    {
        "content": "<p>I deeply agree with Johan on this</p>",
        "id": 433734236,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1713353932
    },
    {
        "content": "<p>I also agree, I prefer <code>obtain</code> over <code>rcases</code>, not just because of the non-word but also because the argument order is more sensible. There are some cases where you might prefer <code>rcases</code> argument order, e.g. if it's a really big or complex match, but in those cases you are probably better off using <code>cases</code> or <code>match</code> with their more heavyweight (but better documenting) syntax</p>",
        "id": 433736895,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713354835
    },
    {
        "content": "<p>(in case you weren't aware, <code>obtain</code> and <code>rcases</code> are basically the same tactic, they just have slightly different syntax to the same backend)</p>",
        "id": 433737205,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713354923
    },
    {
        "content": "<p>Things would be simpler if <code>intro</code> and <code>have</code> were invisibly upgraded to their more powerful variants in mathlib (<code>rintro</code> &amp; <code>obtain</code>). I'm guessing mathlib doesn't want to diverge from standard lean? I know <code>have</code> can be used in term mode, so perhaps it would be confusing if its behavior was different between the two modes.</p>",
        "id": 433743883,
        "sender_full_name": "Richard Osborn",
        "timestamp": 1713356920
    },
    {
        "content": "<p>it's not quite as simple as that, <code>intro</code> and <code>have</code> have also leveled up in lean 4 and the grammar is incomparable with rcases patterns</p>",
        "id": 433745876,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713357518
    },
    {
        "content": "<p>for example you can write <code>have (a, b) := c</code> but that's not legal <code>obtain</code> syntax</p>",
        "id": 433745926,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713357539
    },
    {
        "content": "<p>I'd say the optimal solution would be that core lean adopts a syntax for have, cases, intro and suffices that supports all use cases that are currently supported in the r* variants</p>",
        "id": 433746534,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1713357730
    },
    {
        "content": "<p>I have also switched from <code>rcases</code> to <code>obtain</code> in all situations for readability purposes.</p>",
        "id": 433757205,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1713360598
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Is.20cases'.20deprecated.3F/near/433746534\">said</a>:</p>\n<blockquote>\n<p>I'd say the optimal solution would be that core lean adopts a syntax for have, cases, intro and suffices that supports all use cases that are currently supported in the r* variants</p>\n</blockquote>\n<p>The issue here is that <code>have</code>, <code>let</code>, and <code>match</code> get their flexibility by allowing a <code>term</code> for the pattern, which is powerful but also limiting because it means you have less ability to have specialized syntax (like the <code>-</code> rcases pattern for clearing assumptions) without polluting the term category for everything else</p>",
        "id": 433769268,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713362514
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Is.20cases'.20deprecated.3F/near/433745876\">said</a>:</p>\n<blockquote>\n<p>it's not quite as simple as that, <code>intro</code> and <code>have</code> have also leveled up in lean 4 and the grammar is incomparable with rcases patterns</p>\n</blockquote>\n<p>Is there a path to making <code>obtain</code> a strict superset of <code>have</code>?</p>",
        "id": 433770478,
        "sender_full_name": "Richard Osborn",
        "timestamp": 1713362644
    },
    {
        "content": "<p>How many use cases are there in practice for non-trivial term patterns (that aren't simple variants of rcases patterns)? Because if there aren't too many, it might be an idea to put them behind some flag or switch.</p>",
        "id": 433770700,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1713362670
    },
    {
        "content": "<p>I use <code>have/let ⟨a, b⟩ := c</code> all the time</p>",
        "id": 433776533,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713363322
    },
    {
        "content": "<p>(I use those keywords basically in free variation, since it doesn't matter, they both act like <code>have</code> when doing destructuring)</p>",
        "id": 433776765,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713363349
    },
    {
        "content": "<p>an example of a nontrivial pattern which isn't covered by <code>rcases</code> is <code>let a :: l := l'</code>, which you will be surprised to know is actually legal sometimes</p>",
        "id": 433777510,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713363429
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">example</span> <span class=\"o\">{</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">β</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">l</span> <span class=\"o\">:</span> <span class=\"n\">List</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">l.map</span> <span class=\"n\">f</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">length</span> <span class=\"bp\">=</span> <span class=\"mi\">4</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">True</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"k\">let</span> <span class=\"n\">a</span> <span class=\"o\">::</span> <span class=\"n\">l</span> <span class=\"o\">:=</span> <span class=\"n\">l</span>\n  <span class=\"n\">trivial</span>\n</code></pre></div>",
        "id": 433778113,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713363498
    },
    {
        "content": "<p>What is going on there that Lean knows this is legal?</p>",
        "id": 433778363,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1713363527
    },
    {
        "content": "<p>it desugars to a <code>match</code> expression with <code>(generalizing := true)</code>, and so in the missing match arm lean tries to prove the context is inconsistent via <code>injection</code></p>",
        "id": 433778700,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713363568
    },
    {
        "content": "<p><span aria-label=\"astonished\" class=\"emoji emoji-1f632\" role=\"img\" title=\"astonished\">:astonished:</span> that's some black magic.</p>",
        "id": 433779526,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1713363662
    },
    {
        "content": "<p>Conversely, a case where lean's pattern matching is less powerful than rcases's is <code>fun rfl</code> vs <code>rintro rfl</code>, because the former will not generalize variables not participating in the match. This one is specifically problematic for unification of the two syntaxes because they are both using the same syntax</p>",
        "id": 433780185,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713363740
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">example</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"mi\">4</span> <span class=\"bp\">→</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"mi\">8</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"n\">refine</span> <span class=\"k\">fun</span> <span class=\"bp\">|</span> <span class=\"n\">rfl</span> <span class=\"bp\">=&gt;</span> <span class=\"bp\">?</span><span class=\"n\">_</span>\n  <span class=\"c1\">-- ⊢ a + a = 8</span>\n\n<span class=\"kd\">example</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"mi\">4</span> <span class=\"bp\">→</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"mi\">8</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"n\">rintro</span> <span class=\"n\">rfl</span>\n  <span class=\"c1\">-- ⊢ 4 + 4 = 8</span>\n</code></pre></div>",
        "id": 433781132,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713363848
    },
    {
        "content": "<p>Could we change the <code>rcases</code> syntax? I know some people have wanted <code>rcases</code> to support <code>←</code> and  <code>→</code> for rewriting.<br>\ni.e. <code>obtain → : some_prop := by proof</code> instead of <code>rw [show some_prop by proof]</code>.</p>",
        "id": 433788117,
        "sender_full_name": "Richard Osborn",
        "timestamp": 1713364656
    },
    {
        "content": "<p>that syntax makes no sense at all to me</p>",
        "id": 433791827,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713365061
    },
    {
        "content": "<p>what is being rewritten and where?</p>",
        "id": 433792048,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713365085
    },
    {
        "content": "<p>I think the idea is that <code>some_prop</code> is an equality or iff, and you are immediately rewriting with it in the goal.</p>",
        "id": 433792532,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1713365141
    },
    {
        "content": "<p>Rocq has something similar to this, and it came up at LftCM</p>",
        "id": 433792717,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1713365162
    },
    {
        "content": "<p>yes, rintro patterns are very similar to (a small subset of) intro patterns in ssreflect</p>",
        "id": 433793020,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713365194
    },
    {
        "content": "<p>I do get worried about the readability aspect of these extensions though</p>",
        "id": 433793366,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713365233
    },
    {
        "content": "<p>from a technical standpoint there is no obstruction to doing this</p>",
        "id": 433793600,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713365259
    },
    {
        "content": "<p>it an example of how not using <code>term</code> gives us more flexibility to do these things</p>",
        "id": 433794258,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713365334
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">example</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"mi\">4</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"mi\">8</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"c1\">-- assume h is a long proof</span>\n  <span class=\"c1\">-- obtain → : a = 4 := h</span>\n  <span class=\"n\">rewrite</span> <span class=\"o\">[</span><span class=\"k\">show</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"mi\">4</span> <span class=\"kd\">by</span> <span class=\"n\">exact</span> <span class=\"n\">h</span><span class=\"o\">]</span>\n  <span class=\"c1\">-- ⊢ 4 + 4 = 8</span>\n</code></pre></div>",
        "id": 433795672,
        "sender_full_name": "Richard Osborn",
        "timestamp": 1713365491
    },
    {
        "content": "<p>I agree that readability could be a concern, but <code>rfl</code> in <code>rcases</code> doesn't seem to impact readability negatively, so I can't imagine <code>←</code> and <code>→</code> to be worse.</p>",
        "id": 433796918,
        "sender_full_name": "Richard Osborn",
        "timestamp": 1713365624
    },
    {
        "content": "<p><code>rfl</code> is actually a pattern though</p>",
        "id": 433798803,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713365824
    },
    {
        "content": "<p>which is to say, it makes sense as a term that we are matching against</p>",
        "id": 433798955,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713365840
    },
    {
        "content": "<p>The thing that struck me about the ssreflect syntax was the tight integration. It seemed to me that many of the specialized features in one tactic were available in other tactics <em>with the same syntax</em>. However, if only one specialized feature is available in one tactic and a different one in another, then it gets hard to remember.</p>",
        "id": 433799651,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1713365914
    },
    {
        "content": "<p>well rcases patterns are used by several tactics, so it's not that crazy</p>",
        "id": 433799871,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713365939
    },
    {
        "content": "<p>but indeed it sucks that we have <del>three</del> four separate pattern languages:</p>\n<ol>\n<li><code>have</code>, <code>let</code>, <code>match</code>, <code>intro</code>, <code>fun</code>: uses terms as patterns</li>\n<li><code>obtain</code>, <code>rcases</code>, <code>rintro</code>, <code>ext</code>, <code>rcongr</code>/ <code>congr!</code>, <code>convert</code>: uses rcases patterns</li>\n<li><code>cases</code>, <code>induction</code>: uses binder names as patterns</li>\n<li><code>match_expr</code>, <code>let_expr</code>: uses constants</li>\n</ol>",
        "id": 433802047,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713366166
    },
    {
        "content": "<p>Sure, I'm not necessarily saying it's bad, but I think this kind of tight integration is what we should be striving for. So, medium-term, it would be great if we could, for example, unify <code>have</code> and <code>obtain</code> (possibly with a term flag) and obliterate <code>rcases</code>. Obviously this is a bit tricky, but I believe it's a good goal. <span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> mentioned a while ago that the fewer the tactics the better, and I have come to agree with that.</p>",
        "id": 433802483,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1713366211
    },
    {
        "content": "<p>No, I mean that the so called \"tight integration\" is in fact provided by the fact that there are many tactics that use the same pattern language as <code>rcases</code>, so if you learn rcases patterns you can use them in all of those cases</p>",
        "id": 433805049,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713366489
    },
    {
        "content": "<p>the trouble is that 1 and 2 are incompatible approaches and both have significant uptake in lean</p>",
        "id": 433805300,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713366518
    },
    {
        "content": "<p>4 looks like a slightly lazy tactic implementation so I'm not too worried about it, but 3 also has its strengths and weaknesses over the others so I'm not sure what we can do</p>",
        "id": 433805773,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713366572
    },
    {
        "content": "<p>I worry though that if we just directly overload e.g. <code>have</code> and <code>obtain</code> it will become more confusing, not less, because sometimes you will be getting 1 and other times 2 and there isn't a clear indication of which is which</p>",
        "id": 433806519,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713366655
    },
    {
        "content": "<p>Is there any symbol that <code>term</code>s can't start with, that could be used as a sigil to indicate that what follows is an rcases pattern?</p>",
        "id": 433823855,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1713369728
    },
    {
        "content": "<p>How about as a start we see if we can largely remove uses of <code>rcases</code> in favour of <code>obtain</code>, since it seems everyone likes that direction?</p>",
        "id": 433893175,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1713398390
    },
    {
        "content": "<p>I think both of these (<code>cases'</code> -&gt; <code>rcases</code>, <code>rcases</code> -&gt; <code>obtain</code>) should wait until we have the global refactor tool, as this is a perfect use case for it</p>",
        "id": 433917370,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713416201
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Is.20cases'.20deprecated.3F/near/433823855\">said</a>:</p>\n<blockquote>\n<p>Is there any symbol that <code>term</code>s can't start with, that could be used as a sigil to indicate that what follows is an rcases pattern?</p>\n</blockquote>\n<p><code>$</code>?</p>",
        "id": 433939640,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1713420890
    },
    {
        "content": "<p>Ah sorry that would rather be to show rhat something <em>isn't</em> a <code>rcases</code> pattern</p>",
        "id": 433939960,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1713420919
    },
    {
        "content": "<p>Ooh, that might also work.</p>",
        "id": 433944034,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1713421286
    },
    {
        "content": "<p>Funnily enough, $ is the one character basically <em>anything</em> in Lean can start with, because of syntax quotations. At least when followed by an ident or open paren.</p>",
        "id": 433946560,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1713421512
    },
    {
        "content": "<p>But an <code>rcases</code> pattern can not start with it. So the strategy could be \"if the argument starts with <code>$</code> then strip it off and treat the remainder as a <code>term</code> pattern like <code>have</code> does; otherwise, treat the argument as <code>rcases</code> pattern\"</p>",
        "id": 433948592,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1713421692
    },
    {
        "content": "<p>no, rcases patterns can start with <code>$</code></p>",
        "id": 433966240,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713423965
    },
    {
        "content": "<p>sebastian is right, <code>$</code> is a uniquely bad option because <code>$</code> can be the start of an antiquotation in any syntax category</p>",
        "id": 433966687,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713424005
    },
    {
        "content": "<p>note, this is valid lean syntax</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">example</span> <span class=\"o\">:=</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"kd\">by</span> <span class=\"n\">rcases</span> <span class=\"n\">x</span> <span class=\"k\">with</span> <span class=\"bp\">$</span><span class=\"n\">pat</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 433966952,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1713424029
    },
    {
        "content": "<p>I'm not sure I like using obtain instead of rcases in all situations. When there's an actual case split going on, <code>rcases</code> sounds more natural I think.</p>",
        "id": 433981213,
        "sender_full_name": "Frédéric Dupuis",
        "timestamp": 1713425515
    },
    {
        "content": "<p>Maybe € instead of $, then</p>",
        "id": 433986007,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1713427071
    },
    {
        "content": "<p>I think this is very well worth thinking about there is <del>already a topic about this: <a href=\"#narrow/stream/287929-mathlib4/topic/Is.20cases'.20deprecated.3F/near/433757205\">Zulip topic</a></del> (I posted to the wrong topic, maybe they should be merged anyways?)</p>\n<p>Some summary from that topic:</p>\n<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Is.20cases'.20deprecated.3F/near/433639958\">said</a>:</p>\n<blockquote>\n<p>[<code>cases'</code>] isn't deprecated, perhaps mostly out of hope that one day we will have a tool for automatic replacement. I think it would be reasonable to have a rule against new uses, in any case.</p>\n</blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Is.20cases'.20deprecated.3F/near/433664804\">said</a>:</p>\n<blockquote>\n<p>I think we can deprecate <code>cases'</code> in favor of <code>rcases</code>, <code>obtain</code>, <code>cases</code>. I think there are no cases where <code>cases'</code> is actually better than all three of those alternatives</p>\n</blockquote>\n<p><em>Many people (including Yael, Johan, Jireh, Ruben - and I'd include myself too) express there opinion about <code>obtain</code> being better than <code>rcases</code></em></p>\n<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Is.20cases'.20deprecated.3F/near/433893175\">said</a>:</p>\n<blockquote>\n<p>How about as a start we see if we can largely remove uses of <code>rcases</code> in favour of <code>obtain</code>, since it seems everyone likes that direction?</p>\n</blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Is.20cases'.20deprecated.3F/near/433661599\">said</a>:</p>\n<blockquote>\n<p>[...] number of lines is not something we should be optimising for. It [an example provided] is structurally the same proof, so the only relevant questions are maintainability / readability.</p>\n</blockquote>\n<p>From that topic the conclusion seems to be that <code>cases'</code> and <code>rcases</code> would ideally not be used in favour of <del><code>rcases</code></del> <strong><code>obtain</code> (! I cannot type)</strong>, but maybe that could be discussed here again.</p>\n<p><span class=\"user-mention\" data-user-id=\"598052\">@Jeremy Tan</span> maybe you could make a poll here whether that's indeed what we want and also how rigorous we should address this.</p>",
        "id": 468135132,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1725615553
    },
    {
        "content": "<p>/poll Should cases' and rcases be deprecated in favour of obtain and cases?<br>\nYes<br>\ncases' only<br>\nNo</p>",
        "id": 468136854,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1725616055
    },
    {
        "content": "<p>I'm in favour of deprecating for new code, less excited about going around changing existing code</p>",
        "id": 468142989,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1725617716
    },
    {
        "content": "<p>I was thinking of slightly more refined options, but I guess this is a valid response for the prompt I've given <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 468191569,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1725629769
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"311453\">Frédéric Dupuis</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Is.20cases'.20deprecated.3F/near/433981213\">said</a>:</p>\n<blockquote>\n<p>I'm not sure I like using obtain instead of rcases in all situations. When there's an actual case split going on, <code>rcases</code> sounds more natural I think.</p>\n</blockquote>\n<p>I was neutral on this question until recently, when I heard Johan argue that <code>obtain</code> might be preferred to <code>rcases</code> on the basis that <code>obtain</code> is an actual word basically being used to mean something which it means in regular English, whereas <code>rcases</code> is not a word and something which we've just become used to as a community. I don't think I've used <code>rcases</code> ever since. But I still don't really have a strong opinion about what to make the community do, I just currently have a personal preference.</p>",
        "id": 468196035,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1725631030
    },
    {
        "content": "<p>Deprecated in what sense? Will old proofs break after lake update or will mathlib PRs be required to avoid using <code>cases'</code>?</p>",
        "id": 468199295,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1725631923
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Is.20cases'.20deprecated.3F/near/468199295\">said</a>:</p>\n<blockquote>\n<p>Deprecated in what sense? Will old proofs break after lake update or will mathlib PRs be required to avoid using <code>cases'</code>?</p>\n</blockquote>\n<p>I envision <code>cases'</code> being <em>first</em> deprecated like normal declarations are, and <em>then</em> finally removed from mathlib</p>",
        "id": 468205106,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1725633548
    },
    {
        "content": "<p>Why break proofs outside mathlib, when you can just lint out its uses inside mathlib?</p>",
        "id": 468232402,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1725640380
    },
    {
        "content": "<p>To be specific, I'd say, let the tactic remain, but lint out its uses inside mathlib. This way downstream users don't get bothered needlessly.</p>",
        "id": 468232712,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1725640471
    },
    {
        "content": "<p>I'm all for removing redundancy, and the argument about <code>rcases</code> being a meaningless word is pretty compelling too. But unless there's a nontrivial maintenance cost I think it should only be linted within Mathlib, at least for the near future.</p>",
        "id": 468258634,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1725646727
    },
    {
        "content": "<p>There's also the question here of whether <code>obtain</code> actually needs to exist at all in the presence of <code>have</code> pattern matching - should core expand its pattern-matching dialect to absorb \"obtain/rcases\" patterns?</p>",
        "id": 468291679,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1725658244
    },
    {
        "content": "<p>I think that would be great, though I understood that there's some incompatible overlap between the <del>sunglasses</del> syntaxes</p>",
        "id": 468307779,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1725664885
    },
    {
        "content": "<p>It seems quite a few things have an \"only be linted within Mathlib\" conclusion. Is there a simple way for a non-mathlib project to put something in lakefile.toml to opt into all such lints, present and future, without needing to hardcode a list (for projects that aim to put their code into mathlib or the mathlib archive, so want all mathlib-only lints applied now rather than only discovering issues later at the point of PRing to mathlib)?</p>",
        "id": 468315171,
        "sender_full_name": "Joseph Myers",
        "timestamp": 1725669845
    },
    {
        "content": "<p>All right, <a href=\"https://github.com/leanprover-community/mathlib4/pull/16526\">#16526</a> constitutes the first automated replacement of cases' in mathlib</p>",
        "id": 468319340,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1725672937
    },
    {
        "content": "<p>There are about 1800 uses right now and this PR removes about 450 of them</p>",
        "id": 468319423,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1725672975
    },
    {
        "content": "<p>I don't see any consensus reached yet. Why the urgency for the PR?</p>",
        "id": 468321566,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1725674440
    },
    {
        "content": "<p>There is a consensus, as shown by the poll, that <code>cases'</code> must go</p>",
        "id": 468324920,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1725676461
    },
    {
        "content": "<p>There is no consensus on the form the deprecation should take</p>",
        "id": 468328433,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1725677827
    },
    {
        "content": "<p>Because that was not asked in the poll</p>",
        "id": 468328470,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1725677839
    },
    {
        "content": "<p>Of course I think the votes so far indicate that the uses of <code>cases'</code> within mathlib should be removed</p>",
        "id": 468328755,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1725677947
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"598052\">Jeremy Tan</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Is.20cases'.20deprecated.3F/near/468324920\">said</a>:</p>\n<blockquote>\n<p>There is a consensus, as shown by the poll</p>\n</blockquote>\n<p>Usually it's best to leave polls for (at least) a few days before declaring consensus.</p>",
        "id": 468355171,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1725690414
    },
    {
        "content": "<p>Also, consensus implies that everyone agrees. There are a few different opinions that are being discussed</p>",
        "id": 468361287,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1725692616
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"266253\">@Joseph Myers</span> I think there should be a <code>set_option linter.style.all true</code> (or something thelike) which enables all mathlib-only style linters. It might not exist yet, but it would certainly be useful to have, and I'll make a PR eventually if nobody else does it first. (but that's a different topic)</p>",
        "id": 468372649,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1725697142
    },
    {
        "content": "<p>derprecating/removing the tactic itself is a bad idea, as people mentioned, because of the usage in downstream projects. And we do have tactics in mathlib which are essentially not used in code but they are still exist for people's convenience. The modified <code>have</code> is such an example. Most primed tactics would probably fit well on this list too.</p>",
        "id": 468375856,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1725697882
    },
    {
        "content": "<p>For a starter, Jeremy's <a href=\"https://github.com/leanprover-community/mathlib4/pull/16526\">#16526</a> does seem like a strict improvement; I would have chosen <code>obtain h | h := .....</code> instead, but again that's currently only a \"preferred style\"</p>",
        "id": 468375884,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1725697896
    },
    {
        "content": "<p>I really wish I had noticed when this thread was active, because I would have argued quite militantly for leaving <code>cases'</code> alone!</p>\n<p><code>cases'</code> is useful when </p>\n<ul>\n<li>you have a custom recursor you want to use (this automatically excludes everything based on <code>rcases</code>, which is nearly everything outside of core)</li>\n<li>the custom recursor only has a single case</li>\n<li>you want to name the resulting parameters</li>\n</ul>\n<p>In this scenario, there is still no satisfactory replacement for <code>cases'</code>; the closest is </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">recOn_foo</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n</code></pre></div>\n<p>which is a) incredibly ugly and b) requires you to remember and include the specific name of the constructor, which is otherwise zero-data.</p>",
        "id": 509846836,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1743657919
    },
    {
        "content": "<p>In general, I'm not sure why we should go out of our way to be deprecating/discouraging tactics like this at all, rather than just letting people use what they find comfortable; the question of maintainability is one that should be resolved by ensuring that similar tactics are in fact just different front-ends to the same internal machinery, rather than insisting that we have exactly one set of external interfaces that necessarily does not cover all uses. Having primed tactics is something I considered a <em>strength</em> of Mathlib.</p>",
        "id": 509847102,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1743658065
    },
    {
        "content": "<p>I think it is very much worth the trouble to reduce the number of tactics used in Mathlib. They create a big barrier to entry for very little added value. There is a lot of nearly duplicated tactics for historical reasons.</p>",
        "id": 509860811,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1743664520
    },
    {
        "content": "<p>Note that nobody is preventing anyone from using cases' in projects depending on mathlib. But having a more uniform style (and formatting, etc) is very much worth it.</p>\n<p>Disallowing basically synonymous tactics, if they are not used, feels worth the uniformity benefits to me.</p>",
        "id": 509886016,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1743672040
    },
    {
        "content": "<p>That said: if there I'd a way to make cases/obtain/rcases look nice in the setting you describe, I believe many people would be happy to see that.</p>",
        "id": 509886364,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1743672135
    },
    {
        "content": "<p>Do you have some idea how often this occurs in mathlib?</p>",
        "id": 509886488,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1743672182
    },
    {
        "content": "<p>I have been using <code>rcases</code> a lot. How might using <code>obtain</code> in place of <code>rcases</code> look like? Any example will be greatly appreciated.</p>",
        "id": 509898023,
        "sender_full_name": "Kevin Cheung",
        "timestamp": 1743675614
    },
    {
        "content": "<p><code>rcases proof with patt</code> becomes <code>obtain patt := proof</code></p>",
        "id": 509898111,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1743675641
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"359992\">Robert Maxton</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Is.20cases'.20deprecated.3F/near/509846836\">said</a>:</p>\n<blockquote>\n<p>I really wish I had noticed when this thread was active, because I would have argued quite militantly for leaving <code>cases'</code> alone!</p>\n<p><code>cases'</code> is useful when </p>\n<ul>\n<li>you have a custom recursor you want to use (this automatically excludes everything based on <code>rcases</code>, which is nearly everything outside of core)</li>\n<li>the custom recursor only has a single case</li>\n<li>you want to name the resulting parameters</li>\n</ul>\n<p>In this scenario, there is still no satisfactory replacement for <code>cases'</code>; the closest is </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">recOn_foo</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n</code></pre></div>\n<p>which is a) incredibly ugly and b) requires you to remember and include the specific name of the constructor, which is otherwise zero-data.</p>\n</blockquote>\n<p>Minor point: I think this works, so you don't need to remember the constructor name: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">recOn_foo</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n</code></pre></div>",
        "id": 509912875,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1743680114
    },
    {
        "content": "<p>For a one-line version, I'd recommend <code>cases x using recOn_foo with | _ x y =&gt; ?_</code>. That makes it be a single tactic rather than have any nesting.</p>\n<p>I think in core we're moving to allow <code>cases x using recOn_foo with | _ x y</code> to make it a little easier to type.</p>",
        "id": 509996574,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1743700639
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Is.20cases'.20deprecated.3F/near/509860811\">said</a>:</p>\n<blockquote>\n<p>I think it is very much worth the trouble to reduce the number of tactics used in Mathlib. They create a big barrier to entry for very little added value. There is a lot of nearly duplicated tactics for historical reasons.</p>\n</blockquote>\n<p>Do they, though? I think this is mostly an artifact of the lack of good (esp. good \"canonical\") documentation for tactics. To my knowledge the only way of getting any sort of systematic coverage of what tactics are available is through <a href=\"https://github.com/haruhisa-enomoto/mathlib4-all-tactics/blob/main/all-tactics.md\">Haruhisa's trick</a>, which yes, results in a big barrier to entry that scales with the number of tactics. But if we had, in any of our three major documentation sources, a guide to the most common/\"center path\" tactics that work most of the time in each field, then having variants IMO ceases to be a barrier to entry; new users should follow the documentation and use the rarely-changing shortlist of common tactics to get started, and treat the variants as \"advanced usage.\"</p>\n<p>... Actually, do the various textbooks take PRs? Because I might just contribute an appendix somewhere myself.</p>",
        "id": 510047295,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1743719270
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Is.20cases'.20deprecated.3F/near/509886364\">said</a>:</p>\n<blockquote>\n<p>That said: if there I'd a way to make cases/obtain/rcases look nice in the setting you describe, I believe many people would be happy to see that.</p>\n</blockquote>\n<p><code>rcases</code> etc would work great, aesthetically speaking; the problem is that for reasons I admittedly don't really understand, the <code>rcases</code> machinery (and therefore everything derived from it) can't hook into the same <code>elab_as_elim, cases_eliminator</code> setup that the core <code>cases</code> does, so it's just not applicable. If we could write</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">rcases</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">casesOn_foo</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">...⟩</span>\n</code></pre></div>\n<p>I'd have no further objections; my objection is to deprecating <code>cases'</code> without a satisfactory replacement. (The \"dangling single case\" doesn't count, especially with the extra unnamed metavariable.)</p>",
        "id": 510047714,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1743719515
    },
    {
        "content": "<p>It's not that it can't hook in, it's just that it hasn't, mostly because the framework for <code>cases</code>/<code>induction</code> hasn't been made into an API yet.</p>\n<p>There's a hack in place right now so that <code>rcases</code> etc. use the custom eliminator for <code>Nat</code>, which is why everything is in terms of <code>0</code> and <code>n + 1</code> instead of <code>Nat.zero</code> and <code>Nat.succ n</code>.</p>",
        "id": 510048584,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1743719992
    },
    {
        "content": "<p>Mm. Could you go into detail somewhere? I'd be willing to put my time toward fixing that, if there isn't a major theoretical obstacle.</p>",
        "id": 510048750,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1743720060
    },
    {
        "content": "<p>I don't think this is something the FRO would want from an external contributor, sorry, but I think that it's possible that we could see progress here. The biggest challenge will be the time to fix mathlib, since I have to imagine that a lot of mathlib would break...</p>\n<p>The core of this is that the <code>rcases</code> family uses <code>Lean.MVarId.cases</code>, which is really meant for low-level casing. I tried making it use the <code>cases_eliminator</code>, but it breaks Lean internals catastrophically (e.g. the processing of <code>match</code> expressions, and generating equation lemmas). We need to expose a version of the <code>cases</code> tactic frontend that isn't so tied to the <code>cases</code> tactic.</p>\n<p>(By the way, <code>elab_as_elim</code> is not relevant. That's a way to get the app elaborator to elaborate the arguments using the expected type in a different way.)</p>",
        "id": 510049891,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1743720723
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Is.20cases'.20deprecated.3F/near/510049891\">said</a>:</p>\n<blockquote>\n<p>I don't think this is something the FRO would want from an external contributor, sorry, but I think that it's possible that we could see progress here. The biggest challenge will be the time to fix mathlib, since I have to imagine that a lot of mathlib would break...</p>\n</blockquote>\n<p>Mm. Unfortunate, but I'll keep watching, I guess. Let me know if there's anything I can do to help.</p>\n<blockquote>\n<p>The core of this is that the <code>rcases</code> family uses <code>Lean.MVarId.cases</code>, which is really meant for low-level casing. I tried making it use the <code>cases_eliminator</code>, but it breaks Lean internals catastrophically (e.g. the processing of <code>match</code> expressions, and generating equation lemmas). We need to expose a version of the <code>cases</code> tactic frontend that isn't so tied to the <code>cases</code> tactic.</p>\n</blockquote>\n<p>How does <code>cases</code> itself do it, then?</p>",
        "id": 510050904,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1743721283
    },
    {
        "content": "<p>It's mostly in this file, and here's the entry point: <a href=\"https://github.com/leanprover/lean4/blob/29303b37b8f8b7f2f92057cf07b1800d374c7487/src/Lean/Elab/Tactic/Induction.lean#L932\">https://github.com/leanprover/lean4/blob/29303b37b8f8b7f2f92057cf07b1800d374c7487/src/Lean/Elab/Tactic/Induction.lean#L932</a></p>",
        "id": 510051245,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1743721471
    }
]