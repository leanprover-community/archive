[
    {
        "content": "<p>Is there an option so that pretty printing preserves all coercion information?</p>",
        "id": 516073416,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1746396362
    },
    {
        "content": "<p>ie if you elaborate the pretty printed string you get the original type</p>",
        "id": 516073469,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1746396380
    },
    {
        "content": "<p>There is <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.pp.coercions.types#doc\">docs#Lean.pp.coercions.types</a></p>",
        "id": 516073953,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1746396786
    },
    {
        "content": "<p>See also other <code>pp</code> options there.</p>",
        "id": 516073982,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1746396830
    },
    {
        "content": "<p>Having 100% fidelity is pretty hard though</p>",
        "id": 516074039,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1746396853
    },
    {
        "content": "<p>thx! Are there any other corner cases that could cause the pretty printed string to elaborate to a different type.</p>",
        "id": 516074043,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1746396858
    },
    {
        "content": "<p>The round-trip with pretty printing is not 100% accurate, but there are some <code>pp</code> options that improve it.</p>",
        "id": 516074068,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1746396894
    },
    {
        "content": "<p>For example, if a non-canonical instance was used</p>",
        "id": 516074077,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1746396899
    },
    {
        "content": "<p>Or some universe metavariables are not solved for</p>",
        "id": 516074097,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1746396920
    },
    {
        "content": "<p>(or other implicit argument was supplied via <code>@mythm</code> or <code>mythm (n := _)</code>)</p>",
        "id": 516074109,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1746396933
    },
    {
        "content": "<p>maybe there's a way that everytime you a apply a macro rule for pretty printing you could check if it preserves teh type and if not you don't apply that particular rule or smth. But that would involve changing how the pretty printer works</p>",
        "id": 516074114,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1746396941
    },
    {
        "content": "<p>Also, if your expression is complicated enough, Lean may fail to elaborate it using the default elaboration order.</p>",
        "id": 516074192,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1746397003
    },
    {
        "content": "<p>The broader motivation is that I think being able to extract tactic states as synthetic lemmas is useful for both model parrallelism and the ability to be able to use whole proof models as <code>exact?</code> style tactics</p>",
        "id": 516074220,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1746397030
    },
    {
        "content": "<p>E.g., I wouldn't try to round-trip a term you get from a <code>simp</code> call.</p>",
        "id": 516074225,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1746397040
    },
    {
        "content": "<p>my point is that if you can't pretty print it you just print the raw expr</p>",
        "id": 516074378,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1746397185
    },
    {
        "content": "<p>so you start printing the raw expr at the first level where the pretty print breaks the type correctness</p>",
        "id": 516074443,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1746397226
    },
    {
        "content": "<p>i think for tactic states this should be fine</p>",
        "id": 516074451,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1746397236
    },
    {
        "content": "<p>except for when you use <code>simp</code> or smth to make a member of <code>Fin n</code> or some other subtype. But we can probably make an exception for propositions because of prop extensionality anyways</p>",
        "id": 516074513,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1746397292
    }
]