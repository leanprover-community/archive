[
    {
        "content": "<p>Dear community,<br>\nI have some questions in the two captioned topics that could really use your wisdom. <br>\nThey are recorded in the comments of the following code snippet that I wrote.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">ModelTheory</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">ModelTheory</span><span class=\"bp\">.</span><span class=\"n\">Syntax</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">ModelTheory</span><span class=\"bp\">.</span><span class=\"n\">Semantics</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Combinatorics</span><span class=\"bp\">.</span><span class=\"n\">Quiver</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">unusedVariables</span><span class=\"w\"> </span><span class=\"n\">false</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">FirstOrder</span>\n<span class=\"kn\">universe</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“›</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Language</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">T</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ğ“›</span><span class=\"bp\">.</span><span class=\"n\">Theory</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Î²</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)(</span><span class=\"n\">Î³</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">)(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)[</span><span class=\"n\">ğ“›</span><span class=\"bp\">.</span><span class=\"n\">Structure</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"bp\">Î </span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)[</span><span class=\"n\">ğ“›</span><span class=\"bp\">.</span><span class=\"n\">Structure</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">][</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"bp\">âŠ¨</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">],</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">)</span>\n<span class=\"c\">/-</span><span class=\"cm\"> A term of the type above is a dependent type function that given any ğ“› Structure N modeling T,</span>\n<span class=\"cm\">returns a set of maps N â†’ N. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Trivial_Func</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">Î </span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)[</span><span class=\"n\">ğ“›</span><span class=\"bp\">.</span><span class=\"n\">Structure</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">][</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"bp\">âŠ¨</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">],</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">)</span>\n<span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">Î»</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">N</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">âˆ…</span>\n\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"bp\">Î£</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">)</span>\n<span class=\"c\">/-</span><span class=\"cm\"> A term of this type is a dependent-type pair. However: -/</span>\n<span class=\"c\">/-</span><span class=\"cm\">! #check Î£ (N : Type x)[ğ“›.Structure N][N âŠ¨ T], Set (N â†’ N)</span>\n<span class=\"cm\">Question 1: The line above gets Unexpected token `[`.</span>\n<span class=\"cm\">How do I make a dependent-type pair that successfully imposes some conditions</span>\n<span class=\"cm\">on the 1st component, if possible? -/</span>\n\n\n<span class=\"c\">/-</span><span class=\"cm\"> Question 2: I am also confused about why the assertion</span>\n<span class=\"cm\">\"an instance ğ“œ of `ğ“› structure defined on M` models the ğ“› theory T\"</span>\n<span class=\"cm\">is not a well-typed Proposition. That is,</span>\n<span class=\"cm\">why do the last lines below get \"overloaded errors\" and how to fix?</span>\n<span class=\"cm\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">âŠ¨</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">T</span><span class=\"bp\">.</span><span class=\"n\">Model</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c\">/-</span><span class=\"cm\">Prop.</span>\n<span class=\"cm\">- As declared in Line 9 above, `A` is promised to assume a certain ğ“› Structure. -/</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“œ</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ğ“›</span><span class=\"bp\">.</span><span class=\"n\">Structure</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c\">/-</span><span class=\"cm\"> ğ“œ is an ğ“›.Structure defined on M-/</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">ğ“œ</span><span class=\"bp\">.</span><span class=\"n\">funMap</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">ğ“œ</span><span class=\"bp\">.</span><span class=\"n\">RelMap</span>\n<span class=\"c\">/-</span><span class=\"cm\">! #check ğ“œ âŠ¨ T</span>\n<span class=\"cm\">#check T.Model ğ“œ both got \"overloaded errors.\" Shouldn't ğ“œ âŠ¨ T make sense?</span>\n\n<span class=\"cm\">Question 2.5: If it is preferred to declare ğ“›-structures using brackets like</span>\n<span class=\"cm\">`variable (A: Type w)[ğ“›.Structure A]` rather than `ğ“œ: ğ“›.Structure M`, which seems to be</span>\n<span class=\"cm\">what most theorems in `Mathlib.ModelTheory.Semantics` are doing, how to avoid caveats</span>\n<span class=\"cm\">like \"can't pass constraint to 1st component\" in Question 1? -/</span>\n</code></pre></div>\n<p>Any help or advice would be greatly appreciated. Thanks!</p>",
        "id": 449237952,
        "sender_full_name": "Shaopeng",
        "timestamp": 1720164136
    },
    {
        "content": "<p>Question 1: you can use  any of the following. I strongly recommend the last option, since it immediately gives you names to all 4 components.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"bp\">Î£'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ğ“›</span><span class=\"bp\">.</span><span class=\"n\">Structure</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"bp\">âŠ¨</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">)</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"bp\">Î£</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ğ“›</span><span class=\"bp\">.</span><span class=\"n\">Structure</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">),</span><span class=\"w\">  </span><span class=\"o\">{</span><span class=\"bp\">_</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"bp\">âŠ¨</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">}</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"n\">str</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ğ“›</span><span class=\"bp\">.</span><span class=\"n\">Structure</span><span class=\"w\"> </span><span class=\"n\">N</span>\n<span class=\"w\">  </span><span class=\"n\">mySet</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">hyp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"bp\">âŠ¨</span><span class=\"w\"> </span><span class=\"n\">T</span>\n</code></pre></div>",
        "id": 449255458,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1720169265
    },
    {
        "content": "<p>Question 2: use <code>#check M âŠ¨ T</code>.</p>",
        "id": 449256217,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1720169416
    },
    {
        "content": "<p>Note: the <code>(ğ“œ: ğ“›.Structure M)</code> is typically left unnamed, and you should not have to use a name for it.</p>",
        "id": 449256565,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1720169519
    },
    {
        "content": "<p>I hope that also answers question 2.5?</p>",
        "id": 449256712,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1720169549
    },
    {
        "content": "<p>Thank you so much for your clarification on both questions, Professor Doorn. <br>\nI'm still a bit unclear about Question 2:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">ModelTheory</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">ModelTheory</span><span class=\"bp\">.</span><span class=\"n\">Syntax</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">ModelTheory</span><span class=\"bp\">.</span><span class=\"n\">Semantics</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Combinatorics</span><span class=\"bp\">.</span><span class=\"n\">Quiver</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">unusedVariables</span><span class=\"w\"> </span><span class=\"n\">false</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“›</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Language</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">T</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ğ“›</span><span class=\"bp\">.</span><span class=\"n\">Theory</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">)(</span><span class=\"n\">ğ“œâ‚</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ğ“›</span><span class=\"bp\">.</span><span class=\"n\">Structure</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)(</span><span class=\"n\">ğ“œâ‚‚</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ğ“›</span><span class=\"bp\">.</span><span class=\"n\">Structure</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">âŠ¨</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"c\">/-</span><span class=\"cm\"> Prop -/</span>\n</code></pre></div>\n<p>But which structure is it checking? <br>\nSay instead of just declaring the names, I defined <code>ğ“œâ‚</code> and <code>ğ“œâ‚‚</code> <br>\nby explicitly giving their respective <code>funMap</code> and <code>RelMap</code>s so that first order<br>\ntheory of <code>ğ“œâ‚</code> agrees with <code>T </code>and  theory of <code>ğ“œâ‚‚</code> does not, which structure is<br>\nused when evaluating <code>M âŠ¨ T </code>?</p>",
        "id": 449258864,
        "sender_full_name": "Shaopeng",
        "timestamp": 1720170277
    },
    {
        "content": "<p>You should avoid having two <code>L</code>-structures on the same type. If you have 2 structures on 2 different types, then there is no ambiguity. If you absolutely need to have more than 1 L-structure on the same type, then there are ways around it (usually by introducing a type synonym).<br>\nPlease read <br>\n<a href=\"https://leanprover-community.github.io/mathematics_in_lean/C06_Structures.html\">https://leanprover-community.github.io/mathematics_in_lean/C06_Structures.html</a><br>\nfor more information about classes.</p>",
        "id": 449264255,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1720171343
    },
    {
        "content": "<p>Thank you so much for your further clarification, Professor van Doorn. Now I see. <br>\nAlso thank you very much for the book!</p>",
        "id": 449267237,
        "sender_full_name": "Shaopeng",
        "timestamp": 1720172018
    }
]