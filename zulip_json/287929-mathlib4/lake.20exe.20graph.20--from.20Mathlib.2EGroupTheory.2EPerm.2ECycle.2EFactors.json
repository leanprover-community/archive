[
    {
        "content": "<p>Today's unreasonable looking import chain:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">graph</span><span class=\"w\"> </span><span class=\"c1\">--from Mathlib.GroupTheory.Perm.Cycle.Factors --to Mathlib.RingTheory.TensorProduct.Basic cyclefactors.png</span>\n</code></pre></div>\n<p><a href=\"/user_uploads/3121/-xvhuay2QiRHdvHxJckWXri6/cyclefactors.png\">cyclefactors.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/-xvhuay2QiRHdvHxJckWXri6/cyclefactors.png\" title=\"cyclefactors.png\"><img data-original-dimensions=\"991x827\" src=\"/user_uploads/thumbnail/3121/-xvhuay2QiRHdvHxJckWXri6/cyclefactors.png/840x560.webp\"></a></div><p>Anyone feel like cutting that one?</p>",
        "id": 467399457,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725419031
    },
    {
        "content": "<p>Let's have a look</p>",
        "id": 467408296,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1725423396
    },
    {
        "content": "<p>In fact, if you drop the <code>--to ..</code> flag, you get a graph with 1008 nodes, of which 801 are gray! <span aria-label=\"open mouth\" class=\"emoji emoji-1f62e\" role=\"img\" title=\"open mouth\">:open_mouth:</span></p>",
        "id": 467408796,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1725423767
    },
    {
        "content": "<p>Actually, <code>LinearAlgebra.FiniteDimensional.Defs</code> is basically deprecated since <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=FiniteDimensional#doc\">docs#FiniteDimensional</a> has been made an <code>abbrev</code> of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Module.Finite#doc\">docs#Module.Finite</a>, so the correct thing to do here is to cut the<code>LinearAlgebra.FiniteDimensional.Defs</code> → <code>RingTheory.TensorProduct.Basic</code> import, which was only needed for a deprecated lemma!</p>",
        "id": 467413526,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1725425931
    },
    {
        "content": "<p>PR up at <a href=\"https://github.com/leanprover-community/mathlib4/pull/16468\">#16468</a>. Definitely easier than I thought it would be <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 467414197,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1725426096
    },
    {
        "content": "<p>A back-of-the-bash-script calculation shows that this reduces the number of gray nodes downstream from ~80% to ~76%.</p>",
        "id": 467433581,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1725433344
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>Checking grayfitti for filter: Data\nNumber of files: 538\n\nGrayfitti: Mathlib.CategoryTheory.GlueData 83%\nGrayfitti: Mathlib.Data.Analysis.Filter 86%\nGrayfitti: Mathlib.Data.Analysis.Topology 85%\nGrayfitti: Mathlib.Data.Array.Defs 88%\nGrayfitti: Mathlib.Data.Array.ExtractLemmas 88%\nGrayfitti: Mathlib.Data.Array.Lemmas 100%\nGrayfitti: Mathlib.Data.BitVec 88%\nGrayfitti: Mathlib.Data.Bool.AllAny 90%\nGrayfitti: Mathlib.Data.Bool.Basic 84%\nGrayfitti: Mathlib.Data.Bool.Count 86%\nGrayfitti: Mathlib.Data.Bool.Set 82%\nGrayfitti: Mathlib.Data.Bracket 90%\nGrayfitti: Mathlib.Data.Bundle 93%\nGrayfitti: Mathlib.Data.ByteArray 88%\nGrayfitti: Mathlib.Data.Char 94%\nGrayfitti: Mathlib.Data.Complex.Abs 71%\nGrayfitti: Mathlib.Data.Complex.Basic 67%\nGrayfitti: Mathlib.Data.Complex.BigOperators 75%\nGrayfitti: Mathlib.Data.Complex.Cardinality 65%\nGrayfitti: Mathlib.Data.Complex.Determinant 65%\n</code></pre></div>",
        "id": 467434859,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1725433751
    },
    {
        "content": "<p>It takes about 20~30s per file, on my machine</p>",
        "id": 467434932,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1725433769
    },
    {
        "content": "<p>I pushed the script to <a href=\"https://github.com/leanprover-community/mathlib4/tree/jmc-grayfitti\">branch#jmc-grayfitti</a></p>",
        "id": 467439130,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1725434890
    },
    {
        "content": "<p>It is probably a lot more efficient to do this in one go for an entire import tree. But I just wanted to get some first stats.</p>",
        "id": 467439214,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1725434918
    },
    {
        "content": "<p>Looks like <em>many</em> import graphs in <code>Mathlib/Data</code> have 60~90% of their nodes colored gray.</p>",
        "id": 467439307,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1725434953
    },
    {
        "content": "<p>Things like <code>Data.Bundle</code> or <code>Data.Char</code> I have never even heard of</p>",
        "id": 467439458,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1725434991
    },
    {
        "content": "<p>Note however that those things might be needed for tactics, and that's a valid use case which you would accidentally flag</p>",
        "id": 467439680,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1725435041
    },
    {
        "content": "<p>Yes, true. This can definitely use some tweaking</p>",
        "id": 467440592,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1725435233
    },
    {
        "content": "<p>Wait, <code>Data.Bundle</code> <em>is</em> about fiber bundles?! Why is it under Data?</p>",
        "id": 467441488,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1725435484
    },
    {
        "content": "<p>I am really confused where <code>Grayfitti: Mathlib.Data.Char 94%</code> comes from given that the only file that imports it is <code>Data.String.Basic</code> (and that one isn't imported anywhere. That still wouldn't explain it, but are you making sure not to count <code>Mathlib.lean</code> in your calculations?</p>",
        "id": 467441826,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1725435608
    },
    {
        "content": "<p>I am taking the <code>xdot_json</code> file produced by <code>lake exe graph</code> and counting the percentage of <code>e0e0e0</code> strings compared to <code>Mathlib</code> strings in that file.</p>",
        "id": 467483622,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1725444656
    },
    {
        "content": "<p>I admit this is maybe not the most robust way of measuring...</p>",
        "id": 467483717,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1725444681
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/stream/287929-mathlib4/topic/lake.20exe.20graph.20--from.20Mathlib.2EGroupTheory.2EPerm.2ECycle.2EFactors/near/467441488\">said</a>:</p>\n<blockquote>\n<p>Wait, <code>Data.Bundle</code> <em>is</em> about fiber bundles?! Why is it under Data?</p>\n</blockquote>\n<p>Probably for the same reason that <code>Complex.Exponential</code> is under Data?</p>",
        "id": 467483841,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1725444712
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/stream/287929-mathlib4/topic/lake.20exe.20graph.20--from.20Mathlib.2EGroupTheory.2EPerm.2ECycle.2EFactors/near/467483622\">said</a>:</p>\n<blockquote>\n<p>I am taking the <code>xdot_json</code> file produced by <code>lake exe graph</code> and counting the percentage of <code>e0e0e0</code> strings compared to <code>Mathlib</code> strings in that file.</p>\n</blockquote>\n<p>For <code>Data.Char</code>, I would expect either 0% or 50%, as explained above, not 94%. So I think something is going wrong but I'm not sure what</p>",
        "id": 467487186,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1725445392
    },
    {
        "content": "<p>Let me say once a again that I think a lot of things in <code>Data</code> make no sense in this place and should move to another folder.</p>",
        "id": 467492961,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1725446836
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/stream/287929-mathlib4/topic/lake.20exe.20graph.20--from.20Mathlib.2EGroupTheory.2EPerm.2ECycle.2EFactors/near/467408796\">said</a>:</p>\n<blockquote>\n<p>In fact, if you drop the <code>--to ..</code> flag, you get a graph with 1008 nodes, of which 801 are gray! <span aria-label=\"open mouth\" class=\"emoji emoji-1f62e\" role=\"img\" title=\"open mouth\">:open_mouth:</span></p>\n</blockquote>\n<p>Is that true? I thought without a <code>--to</code> flag you should get no grey nodes at all.</p>",
        "id": 467605704,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1725468986
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 467614131,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1725470920
    },
    {
        "content": "<p>aah, I guess I was dropping <code>--from</code> <span aria-label=\"see no evil\" class=\"emoji emoji-1f648\" role=\"img\" title=\"see no evil\">:see_no_evil:</span></p>",
        "id": 467719115,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1725512445
    }
]