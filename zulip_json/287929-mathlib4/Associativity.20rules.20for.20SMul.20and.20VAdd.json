[
    {
        "content": "<p>Apparently, <code>SMul</code> and <code>VAdd</code> have different associativity rules. This makes it harder to additivize some stuff. But maybe I'm wrong.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Group</span><span class=\"bp\">.</span><span class=\"n\">Defs</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Mul</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SMul</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Add</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">VAdd</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- g • h • x : X</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"c1\">-- (g * h) • x : X</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+ᵥ</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"c1\">-- a + b +ᵥ s : S</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+ᵥ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+ᵥ</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- a +ᵥ (b +ᵥ s) : S</span>\n</code></pre></div>",
        "id": 483350063,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1732049156
    },
    {
        "content": "<p>The relevant priorities and associativities are:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">inherit_doc</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">infixl</span><span class=\"o\">:</span><span class=\"mi\">65</span><span class=\"w\"> </span><span class=\"s2\">\" + \"</span><span class=\"w\">   </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">HAdd</span><span class=\"bp\">.</span><span class=\"n\">hAdd</span>\n<span class=\"kd\">@[</span><span class=\"n\">inherit_doc</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">infixl</span><span class=\"o\">:</span><span class=\"mi\">70</span><span class=\"w\"> </span><span class=\"s2\">\" * \"</span><span class=\"w\">   </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">HMul</span><span class=\"bp\">.</span><span class=\"n\">hMul</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">inherit_doc</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">infixl</span><span class=\"o\">:</span><span class=\"mi\">65</span><span class=\"w\"> </span><span class=\"s2\">\" +ᵥ \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">HVAdd</span><span class=\"bp\">.</span><span class=\"n\">hVAdd</span>\n<span class=\"kd\">@[</span><span class=\"n\">inherit_doc</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">infixr</span><span class=\"o\">:</span><span class=\"mi\">73</span><span class=\"w\"> </span><span class=\"s2\">\" • \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">HSMul</span><span class=\"bp\">.</span><span class=\"n\">hSMul</span>\n</code></pre></div>",
        "id": 483418314,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732086702
    },
    {
        "content": "<p>There are indeed some asymmetries here.<br>\nI think <code>+ᵥ</code> should associate to the right instead of left.</p>\n<p>And we should document our choice of priority and associativity, just like we did for the big operators <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>∑</mo></mrow><annotation encoding=\"application/x-tex\">\\sum</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∑</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>∏</mo></mrow><annotation encoding=\"application/x-tex\">\\prod</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∏</span></span></span></span></p>",
        "id": 483418975,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732087021
    },
    {
        "content": "<p>I wouldn't dare trying to change the <code>infixl</code> into an <code>infixr</code> here, or conversely, in fear that it breaks everything. Does one know whether this is a deliberate choice or a mere accident of code.</p>",
        "id": 483428924,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1732091477
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> Do you know the reasoning behind these choices?</p>",
        "id": 483431781,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732092500
    },
    {
        "content": "<p>I think VAdd is more <span class=\"user-mention\" data-user-id=\"214703\">@Yury G. Kudryashov</span>'s domain</p>",
        "id": 483444143,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1732096265
    },
    {
        "content": "<p>I feel like the left-associativity of <code>VAdd</code> is just a mistake. <code>a +ᵥ (b +ᵥ s)</code> seems to make sense a lot of the time (only needs one <code>VAdd</code> instance) while <code>(a +ᵥ b) +ᵥ s</code> only rarely makes sense (needs two <code>VAdd</code> instances). But maybe I don't know its uses well enough.</p>",
        "id": 483451995,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1732098809
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130609\">Antoine Chambert-Loir</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Associativity.20rules.20for.20SMul.20and.20VAdd/near/483350063\">said</a>:</p>\n<blockquote>\n<p>This makes it harder to additivize some stuff. </p>\n</blockquote>\n<p>I don't think the notation precedence has any effect on <code>to_additive</code>, if that's what you mean</p>",
        "id": 483453455,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1732099287
    },
    {
        "content": "<p>Correct, <code>to_additive</code> doesn't care about notation precedences (or even whether you use notation). Reordering the arguments would make it significantly harder to additivize stuff (and so <code>to_additive</code> can only additive a fraction of power-lemmas to smul-lemmas).</p>",
        "id": 483454026,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1732099445
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span> you are saying \"would\". So that's not the issue here? But notation also isn't the issue...<br>\nDo I understand that correctly?</p>",
        "id": 483455325,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732099880
    },
    {
        "content": "<p>I'm not sure I understand what you mean, <span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span>. The only thing I can tell is that I had to additivize a lemma by hand (for reasons I don't understand), hence I copy-pasted the proof of the multiplicative case, and this is how I discovered the problem with associativity, because even after changing <code>smul</code> to <code>vadd</code> and similar other modifications, lean wasn't understanding the terms as I expected.</p>",
        "id": 483457349,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1732100555
    },
    {
        "content": "<p>If changing the notation means that lemmas are going to state different things (i.e. they are elaborated to different expressions), then sure, that would impact <code>to_additive</code> (and break proof for reasons unrelated to <code>to_additive</code>).</p>\n<p><span class=\"user-mention\" data-user-id=\"130609\">@Antoine Chambert-Loir</span>: is this on a branch of Mathlib? If so, could you link it so that I can take a look? <br>\nI can tell you it has nothing to do with the notation, but it could be <a href=\"https://github.com/leanprover-community/mathlib4/pull/10830\">#10830</a> or the fact that you are (also) working with an abstract ring in the lemma.</p>",
        "id": 483458788,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1732101026
    },
    {
        "content": "<p>This is either in <a href=\"https://github.com/leanprover-community/mathlib4/pull/19171\">#19171</a> or more likely in <a href=\"https://github.com/leanprover-community/mathlib4/pull/12052\">#12052</a>.</p>",
        "id": 483462105,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1732102144
    },
    {
        "content": "<p>(One complicated issue in <a href=\"https://github.com/leanprover-community/mathlib4/pull/12052\">#12052</a> is that one defines a <code>Group</code> of  additive automorphisms in the context of <code>AddGroup</code>, but <code>@[to_additive]</code> should not make this group an <code>AddGroup</code>. Because of that, possibly, one has to do the things by hand.)</p>",
        "id": 483462332,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1732102222
    },
    {
        "content": "<p>(line 279 of <a href=\"https://github.com/leanprover-community/mathlib4/pull/12052/files#diff-901c1c2f0aea0a5c5b781f7ab5b017046be878428ffc40b9f18484fcc31b679f\">Mathlib/GroupTheory/GroupAction/Blocks.lean</a>)</p>",
        "id": 483463273,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1732102553
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130609\">Antoine Chambert-Loir</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Associativity.20rules.20for.20SMul.20and.20VAdd/near/483462332\">said</a>:</p>\n<blockquote>\n<p>(One complicated issue in <a href=\"https://github.com/leanprover-community/mathlib4/pull/12052\">#12052</a> is that one defines a <code>Group</code> of  additive automorphisms in the context of <code>AddGroup</code>, but <code>@[to_additive]</code> should not make this group an <code>AddGroup</code>. Because of that, possibly, one has to do the things by hand.)</p>\n</blockquote>\n<p>Yes, that was indeed the problem. <a href=\"https://github.com/leanprover-community/mathlib4/pull/19297\">#19297</a> adds a new attribute for <code>to_additive</code> that says that operations on that type should not be additivized. Beware: you will have to specify the name manually if you want to keep a multiplicative name.</p>",
        "id": 483520390,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1732118825
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Associativity.20rules.20for.20SMul.20and.20VAdd/near/483444143\">said</a>:</p>\n<blockquote>\n<p>I think VAdd is more <span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span>'s domain</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"266253\">@Joseph Myers</span> added <code>AddTorsor</code>s in <a href=\"https://github.com/leanprover-community/mathlib/pull/2720\">!3#2720</a></p>",
        "id": 483567752,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1732135191
    },
    {
        "content": "<p>When I defined <code>+ᵥ</code> I took the priority and use of <code>infix</code> from <code>+</code> (Lean 3 subsequently changed <code>+</code> from <code>infix</code> to <code>infixl</code>, not sure what semantic difference, if any, that involved).</p>\n<p>It was subsequently decided that <code>+ᵥ</code> should act with the vector on the left rather than the right, so I made the corresponding change to that PR. I didn't think at the time to reverse associativity when reversing which side the action was on, but maybe that was when it should have changed.</p>",
        "id": 483594335,
        "sender_full_name": "Joseph Myers",
        "timestamp": 1732148354
    },
    {
        "content": "<p>If we do change associativity, I hope we have tools to verify that all lemma types are syntactically equal before and after the change: that the change doesn't result in any unintentional changes to what is proved.</p>",
        "id": 483594532,
        "sender_full_name": "Joseph Myers",
        "timestamp": 1732148469
    },
    {
        "content": "<p>Sadly I don't think we have those tools right now</p>",
        "id": 483594667,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1732148539
    },
    {
        "content": "<p>leaff might have been up to the job, but it wouldn't surprise me if its stuck on an old lean version</p>",
        "id": 483594719,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1732148575
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"266253\">@Joseph Myers</span> Thanks for clearing up the history of how this came to be.</p>",
        "id": 483617290,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732164613
    },
    {
        "content": "<p>There are 141 lines in mathlib that contain more than one occurence of <code>+ᵥ</code>. Not all of them are assocs, some of them occur on different sides of <code>=</code>. But there might be assoc situations that span multiple lines.</p>\n<p>Anyway, I think the best we can do is to just change the associativity, and take a very careful look at all 500+ lines where <code>+ᵥ</code> shows up.</p>",
        "id": 483617491,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732164815
    },
    {
        "content": "<p>Well, we can do better. Even if we don't have <code>leaff</code> we can ask Lean to print a list of all declarations where assoc plays a role.</p>",
        "id": 483617639,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732164941
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> That shouldn't be too hard, right?</p>",
        "id": 483617648,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732164952
    },
    {
        "content": "<p>Do I understand correctly that</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- Mathlib/Algebra/Group/Action/Opposite.lean -- L94,99</span>\n<span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">notation3</span><span class=\"o\">:</span><span class=\"mi\">74</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">:</span><span class=\"mi\">75</span><span class=\"w\"> </span><span class=\"s2\">\" +ᵥ&gt; \"</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">:</span><span class=\"mi\">74</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">+ᵥ</span><span class=\"w\"> </span><span class=\"n\">m</span>\n<span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">notation3</span><span class=\"o\">:</span><span class=\"mi\">73</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">:</span><span class=\"mi\">73</span><span class=\"w\"> </span><span class=\"s2\">\" &lt;+ᵥ \"</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">:</span><span class=\"mi\">74</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">AddOpposite</span><span class=\"bp\">.</span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">+ᵥ</span><span class=\"w\"> </span><span class=\"n\">m</span>\n</code></pre></div>\n<p>have their associativities set as intended?</p>\n<p>I would expect both lines to use the same numbers....</p>",
        "id": 483617941,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732165190
    },
    {
        "content": "<p>Hmmm, and also that they would be much closer to the 65 that <code>+ᵥ</code> uses</p>",
        "id": 483618094,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732165269
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/19321\">#19321</a> (+41/-38)</p>",
        "id": 483621280,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732167882
    },
    {
        "content": "<p>The question here is to look for all <code>HVAdd.hVAdd</code> applications that have an <code>HVAdd.hVAdd</code> application inside them in all theorem statements, right?</p>",
        "id": 483628826,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732172736
    },
    {
        "content": "<p>(And this may still be too many, but would not miss any possibility.)</p>",
        "id": 483628853,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732172759
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Associativity.20rules.20for.20SMul.20and.20VAdd/near/483617941\">said</a>:</p>\n<blockquote>\n<p>Do I understand correctly that</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- Mathlib/Algebra/Group/Action/Opposite.lean -- L94,99</span>\n<span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">notation3</span><span class=\"o\">:</span><span class=\"mi\">74</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">:</span><span class=\"mi\">75</span><span class=\"w\"> </span><span class=\"s2\">\" +ᵥ&gt; \"</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">:</span><span class=\"mi\">74</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">+ᵥ</span><span class=\"w\"> </span><span class=\"n\">m</span>\n<span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">notation3</span><span class=\"o\">:</span><span class=\"mi\">73</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">:</span><span class=\"mi\">73</span><span class=\"w\"> </span><span class=\"s2\">\" &lt;+ᵥ \"</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">:</span><span class=\"mi\">74</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">AddOpposite</span><span class=\"bp\">.</span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">+ᵥ</span><span class=\"w\"> </span><span class=\"n\">m</span>\n</code></pre></div>\n<p>have their associativities set as intended?</p>\n<p>I would expect both lines to use the same numbers....</p>\n</blockquote>\n<p>Yes, it is so that <code>a +ᵥ&gt; b &lt;+ᵥ c</code> means <code>(a +ᵥ&gt; b) &lt;+ᵥ c</code>, not <code>a +ᵥ&gt; (b &lt;+ᵥ c)</code></p>",
        "id": 483634315,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1732175374
    },
    {
        "content": "<p>I feel like in such situations I would prefer if <code>a +ᵥ&gt; b &lt;+ᵥ c</code> would give an \"Ambiguous parsing error\", and would force us to add parens.</p>",
        "id": 483687789,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732193319
    },
    {
        "content": "<p>Hasn't that ship sailed with <code>a + b + c</code>?</p>",
        "id": 483694051,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1732195227
    },
    {
        "content": "<p>Nah, I think we can distinguish between \"well-known\" operators and \"not so well-known\".</p>",
        "id": 483839488,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732253087
    },
    {
        "content": "<p>Also, that's twice the same operator. And <code>+</code> is usually associative.</p>",
        "id": 483839525,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732253125
    },
    {
        "content": "<p>Maybe you say that <code>a +ᵥ&gt; b &lt;+ᵥ c</code> is evil if there is no <code>VAddAssoc</code> instance floating around? I could live with that.</p>",
        "id": 483839599,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732253164
    },
    {
        "content": "<p>In the same way as <code>a * b * c</code> is evil if multiplication is not associative</p>",
        "id": 483883193,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1732272269
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Associativity.20rules.20for.20SMul.20and.20VAdd/near/483839599\">said</a>:</p>\n<blockquote>\n<p>Maybe you say that <code>a +ᵥ&gt; b &lt;+ᵥ c</code> is evil if there is no <code>VAddAssoc</code> instance floating around?</p>\n</blockquote>\n<p><code>VAddCommClass</code> actually, but yeah</p>",
        "id": 483888661,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1732274241
    },
    {
        "content": "<p>I would be very happy if <code>a * b * c</code> printed with parens in the non-associative case.<br>\nI will confess that I'm not often working with non-associative <code>*</code>.</p>",
        "id": 484031922,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732337405
    },
    {
        "content": "<p>Maybe more importantly, I would really like our source files to contain parens in those cases.</p>",
        "id": 484031974,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732337456
    },
    {
        "content": "<p>Anyway, what do people think of</p>\n<blockquote>\n<p>chore: change associativity of <code>+ᵥ</code> and <code>-ᵥ</code> from infixl to infixr <a href=\"https://github.com/leanprover-community/mathlib4/pull/19321\">#19321</a></p>\n</blockquote>",
        "id": 484035859,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732341410
    },
    {
        "content": "<p>Should we change the priority of <code>-ᵥ</code> to remove half of the parens again?</p>",
        "id": 484035880,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732341437
    },
    {
        "content": "<p>I've just noticed that this now fails with a very confusing error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">AddTorsor</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddTorsor</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">)</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">-ᵥ</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+ᵥ</span><span class=\"w\"> </span><span class=\"n\">c</span>\n</code></pre></div>",
        "id": 492542218,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736354560
    },
    {
        "content": "<p>I would guess this is because you can't have two notations with the same precedence where one is <code>infixr</code> but the other is <code>infixl</code>?</p>",
        "id": 492542374,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736354606
    }
]