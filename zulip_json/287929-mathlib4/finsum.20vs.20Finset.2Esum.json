[
    {
        "content": "<p>Which of these is preferred in which situations?</p>\n<p>My application: I want to define a <a href=\"https://ncatlab.org/nlab/show/formally+real+algebra\">formally real ring</a>.</p>",
        "id": 491102146,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1735401742
    },
    {
        "content": "<p>It is probably best to use an arbitrarily indexed finite sum, which is expressed as follows:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"bp\">∑</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">i</span>\n</code></pre></div>\n<p>Under the hood, this is using a <code>Finset.sum</code> over <code>Set.univ : Set ι</code>.</p>",
        "id": 491102764,
        "sender_full_name": "Mitchell Lee",
        "timestamp": 1735402327
    },
    {
        "content": "<p>Or you could state your results using this more general construction, which might actually be preferable:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"bp\">∑</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">i</span>\n</code></pre></div>",
        "id": 491102918,
        "sender_full_name": "Mitchell Lee",
        "timestamp": 1735402497
    },
    {
        "content": "<p>It is probably not recommended to use <code>Finsupp.sum</code> unless you already have a term of type <code>Finsupp</code>. Also, if you are going to use <code>Finset.sum</code>, it is better to use the sigma notation rather than writing it out.</p>",
        "id": 491103210,
        "sender_full_name": "Mitchell Lee",
        "timestamp": 1735402803
    },
    {
        "content": "<p>Not <code>Set.univ</code>, <code>Finset.univ</code></p>",
        "id": 491103270,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1735402854
    },
    {
        "content": "<p>Yes, good point</p>",
        "id": 491103283,
        "sender_full_name": "Mitchell Lee",
        "timestamp": 1735402869
    },
    {
        "content": "<p>I'm wondering if there is any solid consensus on this, since I seem to have got a different answer each time I have asked.</p>",
        "id": 491103317,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1735402922
    },
    {
        "content": "<p>In the definition you wouldn't want to introduce a free type, and you also wouldn't want to use a Finset in α since the elements may be repeated. Therefore I suggest the following definition:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">IsFormallyRealSemiring</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">formally_real</span><span class=\"w\"> </span><span class=\"o\">⦃</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Multiset</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">⦄</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">eq_zero_of_finsetSum_eq_zero</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsFormallyRealSemiring</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ι</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∑</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hi</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">IsFormallyRealSemiring</span><span class=\"bp\">.</span><span class=\"n\">formally_real</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rwa</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">map_map</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">sum_eq_multiset_sum</span><span class=\"o\">])</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">mem_map_of_mem</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">hi</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 491103732,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1735403292
    },
    {
        "content": "<p>Thanks. I forgot about the issues with free universe variables.</p>",
        "id": 491104214,
        "sender_full_name": "Mitchell Lee",
        "timestamp": 1735403767
    },
    {
        "content": "<p>oops, I meant <code>finsum</code> not <code>Finsupp.sum</code>! ie, having the finiteness fact be <code>Prop</code>-valued rather than data</p>",
        "id": 491105568,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1735405164
    },
    {
        "content": "<p>Can <code>eq_zero_of_hasSum_zero</code> (in terms of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=HasSum#doc\">docs#HasSum</a>)  be derived from your definition <span class=\"user-mention\" data-user-id=\"224323\">@Junyan Xu</span>? If not, is that consistent with whether that property is true in formally real semirings?</p>",
        "id": 491106260,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1735405846
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=finsum#doc\">docs#finsum</a> is barely used, so I would usually not recommend it</p>",
        "id": 491107561,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1735407214
    },
    {
        "content": "<p>right -- my understanding was that <code>finsum</code> was preferred, but it looks like I am wrong<br>\n(also <a href=\"https://github.com/leanprover-community/mathlib4/pull/19495\">#19495</a> -- the \"image of submonoid closure\" PR -- used <code>finsum</code>)</p>",
        "id": 491107664,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1735407318
    },
    {
        "content": "<p>why are there like 20 different ways to do a finite sum, anyway?</p>",
        "id": 491107740,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1735407377
    },
    {
        "content": "<p>I don't see any <code>finsum</code>/<code>finprod</code> in <a href=\"https://github.com/leanprover-community/mathlib4/pull/19495\">#19495</a> ?</p>",
        "id": 491108199,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1735407872
    },
    {
        "content": "<p>uses <code>Finsupp.sum/prod</code><br>\nwhich is like<br>\nthe same thing, with the finiteness assumption rolled in</p>",
        "id": 491108254,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1735407933
    },
    {
        "content": "<p>I guess in that specific case it's a bit cleaner to talk about <code>f : ι →₀ ℤ</code> rather than <code>f : ι → ℤ</code> + <code>s : Finset ι</code> because the latter allows junk values for <code>f</code> outside of <code>s</code></p>",
        "id": 491109560,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1735409172
    },
    {
        "content": "<p>yep<br>\nwhat I mean is, I thought of this / looked into this because of that PR</p>",
        "id": 491109732,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1735409384
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> I'm not assuming any order or topology in the definition (so doesn't nLab). Maybe with a topology and some compatibility conditions one can derive the HasSum version from this definition?</p>",
        "id": 491111193,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1735410862
    },
    {
        "content": "<p>yes, this is for any ring<br>\nwith how sums are defined, any commutative ring</p>",
        "id": 491111532,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1735411219
    },
    {
        "content": "<p>Sums don't require the ring be commutative</p>",
        "id": 491111578,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1735411277
    },
    {
        "content": "<p><code>finsum</code> and <code>Finset.sum</code> are both over <code>AddCommMonoid</code></p>",
        "id": 491111656,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1735411342
    },
    {
        "content": "<p>because the index set doesn't have an ordering<br>\nsums on lists don't require commutativity</p>",
        "id": 491111676,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1735411379
    },
    {
        "content": "<p>I think usually \"commutative ring\" refers to commutativity of <code>*</code> not <code>+</code></p>",
        "id": 491111709,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1735411415
    },
    {
        "content": "<p>oh yeah oops haha<br>\nyou're so right</p>",
        "id": 491113266,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1735413022
    },
    {
        "content": "<p>so yes, any ring</p>",
        "id": 491113293,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1735413051
    }
]