[
    {
        "content": "<p>Here's a little brain puzzle : </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"n\">Cat</span>\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span>\n<span class=\"kn\">universe</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">u</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Cat</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">,</span><span class=\"n\">u</span><span class=\"o\">})</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">one_Bop_asfctr</span><span class=\"w\">  </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">๐</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"bp\">แตแต</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"bp\">แตแต</span><span class=\"w\"> </span><span class=\"bp\">โฅค</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"bp\">แตแต</span><span class=\"w\"> </span><span class=\"o\">)</span>\n</code></pre></div>\n<p>yields the error </p>\n<blockquote>\n<p>type mismatch<br>\n๐ (โB)แตแต<br>\nhas type<br>\n(โB)แตแต โถ (โB)แตแต : Type ?u.347<br>\nbut is expected to have type<br>\n(โB)แตแต โฅค (โB)แตแต : Type (max v u)</p>\n</blockquote>\n<hr>\n<p>What are we looking at  in the definition ? </p>\n<p><code>๐ (Bแตแต)</code> is the identity in <code>Cat</code>, the category of categories, for the object <code>Bแตแต โ Cat</code> .<br>\nThis is <code>๐</code>  with some white in the middle which stands for <a href=\"https://github.com/leanprover-community/mathlib4/blob/ee220ded614597f6ff66a559a47fb3dbe137c11f/Mathlib/CategoryTheory/Category/Basic.lean#L87\">CategoryStruct.id</a> field in <code>Mathlib/CategoryTheory/Category/Basic.lean</code></p>\n<p>So this is really an arrow of <code>Cat</code> and indeed,  this term yields no error</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">one_Bop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">๐</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"bp\">แตแต</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"bp\">แตแต</span><span class=\"w\"> </span><span class=\"bp\">โถ</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"bp\">แตแต</span><span class=\"w\"> </span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Of course the identity in the category <code>Cat</code> is defined to be equal to the identity functor defined by <code>๐ญ (Bแตแต)</code> and which yields a functor. This is bold <code>๐ญ</code> with no white in the middle,  which stand for <a href=\"https://github.com/leanprover-community/mathlib4/blob/ee220ded614597f6ff66a559a47fb3dbe137c11f/Mathlib/CategoryTheory/Functor/Basic.lean#L72\">Functor.id</a><br>\n in  <code>Mathlib/CategoryTheory/Functor/Basic.lean</code>  </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">id_Bop</span><span class=\"w\">    </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">๐ญ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"bp\">แตแต</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"bp\">แตแต</span><span class=\"w\"> </span><span class=\"bp\">โฅค</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"bp\">แตแต</span><span class=\"w\"> </span><span class=\"o\">)</span>\n</code></pre></div>\n<p>But for some reason,  the identity arrow in <code>Cat</code> for <code>Bแตแต</code> is not the identity functor for <code>Bแตแต</code>, because of this universe thingy.</p>\n<p>And of course if we don't <code>op</code>, everything works, the <code>๐</code> is the <code>๐ญ</code></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">one_B_asfctr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">๐</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">โฅค</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 459698550,
        "sender_full_name": "Nicolas Rolland",
        "timestamp": 1723297286
    },
    {
        "content": "<p>PS : is there a way to opt-out of the universe discipline for some section ?  the rest of the code would have to trust that the inside of the section has not any paradoxical stuff.</p>\n<p>most of the time, universe error message hide some real issue in the code, which has nothing to do with universe.</p>",
        "id": 459699733,
        "sender_full_name": "Nicolas Rolland",
        "timestamp": 1723297852
    },
    {
        "content": "<p>You can prove the universes are a distraction by using the same one everywhere:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"n\">Cat</span>\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span>\n<span class=\"kn\">universe</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">u</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Cat</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"n\">u</span><span class=\"o\">})</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">one_Bop_asfctr</span><span class=\"w\">  </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"mi\">๐</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"bp\">แตแต</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"bp\">แตแต</span><span class=\"w\"> </span><span class=\"bp\">โถ</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"bp\">แตแต</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Functor</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"bp\">แตแต</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"bp\">แตแต</span><span class=\"w\"> </span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 459700199,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723298258
    },
    {
        "content": "<p>Oh good tip. I thought universe were the pb here (!)</p>\n<p>So now this boils down to</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">mismatch</span>\n<span class=\"mi\">๐</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">โ</span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"bp\">แตแต</span>\n<span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"o\">(</span><span class=\"bp\">โ</span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"bp\">แตแต</span><span class=\"w\"> </span><span class=\"bp\">โถ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">โ</span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"bp\">แตแต</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span>\n<span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"o\">(</span><span class=\"bp\">โ</span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"bp\">แตแต</span><span class=\"w\"> </span><span class=\"bp\">โฅค</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">โ</span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"bp\">แตแต</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span>\n</code></pre></div>",
        "id": 459704107,
        "sender_full_name": "Nicolas Rolland",
        "timestamp": 1723299881
    },
    {
        "content": "<p>The issue is that the first arrow is an arrow in <code>Type</code>, whereas the functor arrow is defeq to an arrow in <code>Cat</code></p>",
        "id": 459716361,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1723305102
    },
    {
        "content": "<p>This is because <code>Bแตแต</code> is a type, not a category</p>",
        "id": 459716529,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1723305130
    },
    {
        "content": "<p>this works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">one_Bop_asfctr</span><span class=\"w\">  </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">((</span><span class=\"mi\">๐</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Cat</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"bp\">แตแต</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Cat</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"bp\">แตแต</span><span class=\"w\"> </span><span class=\"bp\">โถ</span><span class=\"w\"> </span><span class=\"n\">Cat</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"bp\">แตแต</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Functor</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"bp\">แตแต</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"bp\">แตแต</span><span class=\"w\"> </span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 459716604,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1723305155
    }
]