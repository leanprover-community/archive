[
    {
        "content": "<p>The following gives an unused variable on <code>G</code> (and removing it gives errors for obvious reasons). My meta-programming skills  are still a little lacking to de-mathlibify this mwe, but maybe someone else can? I have checked it on <a href=\"http://live.lean-lang.org\">live.lean-lang.org</a> with v4.11.0-rc3</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Combinatorics</span><span class=\"bp\">.</span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">Path</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">oddVerts</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">ConnectedComponent</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">}</span>\n</code></pre></div>",
        "id": 466492483,
        "sender_full_name": "Pim Otte",
        "timestamp": 1725094188
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> do you know what is going on?</p>",
        "id": 467112960,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1725339191
    },
    {
        "content": "<p>I've seen this issue before -- in the macro expansion, you have <code>match (c : SimpleGraph.ConnectedComponent G) with ...</code>, and for some reason type ascriptions in <code>match</code> statement discriminants don't appear to elaborate correctly, or at least terminfo is missing (try hovering over the type in the type ascription; you don't get any hover information!)</p>\n<p>A fix is to avoid using this particular notation and instead use the basic set separation notation:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">oddVerts</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">ConnectedComponent</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">}</span>\n</code></pre></div>\n<p>We should probably extend basic set separation notation to accept parentheses here, since the parenthesis notation gives a surprising expansion anyway.</p>",
        "id": 467292768,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1725377527
    },
    {
        "content": "<p>I don't think it's match statement discriminants, but rather type ascriptions in match patterns</p>",
        "id": 467675597,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1725490711
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">            </span><span class=\"c1\">-- ^ this has hover info</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">         </span><span class=\"c1\">-- ^ this doesn't</span>\n</code></pre></div>",
        "id": 467675902,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1725490856
    },
    {
        "content": "<p>the same issue appears in anything that desugars to <code>match</code> statements, including pattern matching in <code>let</code> and <code>have</code></p>",
        "id": 467676002,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1725490914
    },
    {
        "content": "<p>this is <a href=\"https://github.com/leanprover/lean4/pull/3955\">lean4#3955</a></p>",
        "id": 467676132,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1725490979
    }
]