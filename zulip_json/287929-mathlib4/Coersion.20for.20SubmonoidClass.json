[
    {
        "content": "<p>Is there an reason why we don't have <code>CoeOut A (Submonoid G)</code> when instance <code>[SubmonoidClass A G]</code>, same for <code>SubgroupClss</code>. Thank you.</p>",
        "id": 499144302,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1739333284
    },
    {
        "content": "<p>I don't know that's possible, as <code>A</code> doesn't get mentioned in the second argument?</p>",
        "id": 499162511,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1739344322
    },
    {
        "content": "<p>And there are many classes which might want such an instance</p>",
        "id": 499162599,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1739344350
    },
    {
        "content": "<p>I already writen it and CI passed:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">to_additive</span><span class=\"kd\">]</span>\n<span class=\"kd\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">priority</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">SubmonoidClass.toSubmonoid</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SetLike</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">SubmonoidClass</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CoeOut</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Submonoid</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">‚ü®</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"o\">‚ü®‚ü®</span><span class=\"n\">S</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">MulMemClass.mul_mem</span><span class=\"o\">‚ü©,</span><span class=\"w\"> </span><span class=\"n\">OneMemClass.one_mem</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">‚ü©‚ü©</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">to_additive</span><span class=\"kd\">]</span>\n<span class=\"kd\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">priority</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">SubgroupClass.toSubgroup</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SetLike</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">SubgroupClass</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CoeOut</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Subgroup</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">‚ü®</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"o\">‚ü®‚ü®‚ü®</span><span class=\"n\">S</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">MulMemClass.mul_mem</span><span class=\"o\">‚ü©,</span><span class=\"w\"> </span><span class=\"n\">OneMemClass.one_mem</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">‚ü©,</span><span class=\"w\"> </span><span class=\"n\">InvMemClass.inv_mem</span><span class=\"o\">‚ü©‚ü©</span>\n</code></pre></div>",
        "id": 499180452,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1739351240
    },
    {
        "content": "<p>do both these instances trigger? there might be an issue because the second argument to <code>CoeOut</code> is a <code>semiOutParam</code>...</p>",
        "id": 499185072,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1739352716
    },
    {
        "content": "<p>they do... i guess i don't quite understand what the difference between <code>OutParam</code> and <code>semiOutParam</code> is</p>",
        "id": 499185696,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1739352901
    },
    {
        "content": "<p>Suppose we have a <code>Class ?X ?Y</code> goal, then:</p>\n<ul>\n<li>\n<p>if <code>?Y</code> is a <code>semiOutParam</code>, Lean will start synthesizing instances even if the value for <code>?Y</code> is not yet known</p>\n</li>\n<li>\n<p>if <code>?Y</code> is marked with an <code>outParam</code>, Lean will start synthesizing instances only if the value for <code>X</code> is known, and always replace <code>?Y</code> with a new metavariable before starting synthesis</p>\n</li>\n</ul>\n<p>Basically, <code>semiOutParam</code> promises that this value will be determined if the values for the other parameters are known, and <code>outParam</code> requires that this value must be determined by the values for the other parameters.</p>",
        "id": 499189666,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1739354047
    },
    {
        "content": "<p>One important difference is that <code>outParam</code> means the first instance that works for <code>X</code> is always chosen (and causes an error if <code>Y</code> doesn't unify), and <code>semiOutParam</code> will continue searching if <code>Y</code> doesn't unify.</p>",
        "id": 499189884,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1739354121
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"238446\">Anne Baanen</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Coersion.20for.20SubmonoidClass/near/499189666\">said</a>:</p>\n<blockquote>\n<p>Basically, <code>semiOutParam</code> promises that this value will be determined if the values for the other parameters are known,</p>\n</blockquote>\n<p>so then the suggested instances are <em>not</em> good design?</p>",
        "id": 499190783,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1739354387
    },
    {
        "content": "<p>because there is no way to choose between <code>Subgroup M</code> and <code>Submonoid M</code>?</p>",
        "id": 499190929,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1739354417
    },
    {
        "content": "<p>Indeed, there is some debate on whether we want these coercions at all: <a class=\"message-link\" href=\"/#narrow/channel/287929-mathlib4/topic/too.20many.20FunLikes/near/428230309\">#mathlib4 &gt; too many FunLikes @ üí¨</a></p>",
        "id": 499192694,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1739354903
    },
    {
        "content": "<p>Most of the coercions for <code>FunLike</code>s use <code>CoeTC</code> which is an implementation detail that we started using in the Lean 4 port and nobody has taken time to replace with the user-facing classes.</p>",
        "id": 499193304,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1739355092
    },
    {
        "content": "<p>I <em>think</em> in this case <code>CoeOut</code> is okay, since it will find the right instance if we know whether we want a <code>Subgroup</code> or a <code>Submonoid</code>.</p>",
        "id": 499193600,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1739355173
    },
    {
        "content": "<p>I've opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/22230\">#22230</a>, see channel PR review for later discussion.</p>",
        "id": 502957844,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1740987118
    }
]