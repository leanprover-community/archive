[
    {
        "content": "<p>I just noticed the following. In the example below, the <code>unusedSimpArgs</code> linter complains, but leaving the argument out shows that it is indeed necessary.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"c\">/-</span><span class=\"cm\"> This simp argument is unused:</span>\n<span class=\"cm\">  Nat.factorial_ne_zero k -/</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">field</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">factorial_ne_zero</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">]</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">field</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span><span class=\"cm\"> 1 goal left : ↑k ! / ↑k ! = 1 -/</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n\n<span class=\"c\">/-</span><span class=\"cm\"> no warning -/</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">field</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">factorial_ne_zero</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">]</span>\n\n<span class=\"c\">/-</span><span class=\"cm\"> also works -/</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">field</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>The warning goes away when removing the minus signs. A bit surprisingly, when replacing <code>ℂ</code> by <code>ℝ</code>, the warning is correct. I have no idea what is going on here. <span class=\"user-mention\" data-user-id=\"260507\">@Heather Macbeth</span> ?</p>",
        "id": 554591681,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1762722263
    },
    {
        "content": "<p>this is a known problem</p>",
        "id": 554591774,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762722374
    },
    {
        "content": "<p>found it <a href=\"https://github.com/leanprover-community/mathlib4/pull/29041\">#29041</a></p>",
        "id": 554591909,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762722512
    },
    {
        "content": "<p>This still does not explain the difference between <code>ℂ</code> and <code>ℝ</code>, though...</p>",
        "id": 554592024,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1762722633
    },
    {
        "content": "<p>maybe because the reals are ordered?</p>",
        "id": 554595991,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762726855
    },
    {
        "content": "<p>It should only matter that <code>k !</code> is nonzero, regardless of the field (as long as it is of char 0).</p>",
        "id": 554670957,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1762772336
    },
    {
        "content": "<p>The <code>field_simp</code> discharger works a bit differently on <code>ℂ</code> compared to on ordered fields such as <code>ℝ</code>. On ordered fields, it uses <code>positivity</code>; on <code>ℂ</code>, <code>positivity</code> is not available (although <span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span> may have a student working on this) and so, for now, we sometimes need lemmas like <code>Nat.factorial_ne_zero</code> to \"fake\" it.</p>",
        "id": 554671798,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1762772568
    },
    {
        "content": "<p>By the way, here are also a few <code>show_term</code> surprises:</p>\n<ul>\n<li>it times out on the first proof;</li>\n<li>shows nothing after a long time on the middle two proofs;</li>\n<li>works on the last.</li>\n</ul>",
        "id": 554672253,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1762772705
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"726531\">@Pan Lin</span> is indeed working currently working on <code>positivity</code> supporting nonzeroness on non-partial orders.</p>",
        "id": 554679500,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1762774976
    }
]