[
    {
        "content": "<p>Hi, I am in the final stages of the proof. Three sorries are remaining. </p>\n<p>Given these definitions:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">car_at</span><span class=\"w\"> </span><span class=\"n\">left</span>\n<span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">pick_door</span><span class=\"w\"> </span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"bp\">∩</span><span class=\"w\"> </span><span class=\"n\">host_opens</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"bp\">∪</span><span class=\"w\"> </span><span class=\"n\">pick_door</span><span class=\"w\"> </span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"bp\">∩</span><span class=\"w\"> </span><span class=\"n\">host_opens</span><span class=\"w\"> </span><span class=\"n\">middle</span>\n</code></pre></div>\n<p>I don't know how to calculate these probabilities:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Prob</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"bp\">∩</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">3</span>\n<span class=\"n\">Prob</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\">   </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">3</span>\n</code></pre></div>\n<p>Maybe someone with knowledge about the API of the uniform probability density in Mathlib4 has an idea about which tactic I should use?</p>\n<p>The full code is <a href=\"https://github.com/wvhulle/riddle-proofs/blob/uniform-density/RiddleProofs/MontyHall.lean\">here</a>.</p>",
        "id": 526262323,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1751194979
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"928352\">Willem vanhulle</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Calculating.20probability.20proving.20optimal.20strategy.20Monty.20Hall/near/526262323\">ha scritto</a>:</p>\n<blockquote>\n<p>Hi, I am in the final stages of the proof. Three sorries are remaining. </p>\n<p>Given these definitions:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">car_at</span><span class=\"w\"> </span><span class=\"n\">left</span>\n<span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">pick_door</span><span class=\"w\"> </span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"bp\">∩</span><span class=\"w\"> </span><span class=\"n\">host_opens</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"bp\">∪</span><span class=\"w\"> </span><span class=\"n\">pick_door</span><span class=\"w\"> </span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"bp\">∩</span><span class=\"w\"> </span><span class=\"n\">host_opens</span><span class=\"w\"> </span><span class=\"n\">middle</span>\n</code></pre></div>\n<p>I don't know how to calculate these probabilities:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Prob</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"bp\">∩</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">3</span>\n<span class=\"n\">Prob</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\">   </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">3</span>\n</code></pre></div>\n<p>Maybe someone with knowledge about the API of the uniform probability density in Mathlib4 has an idea about which tactic I should use?</p>\n<p>The full code is <a href=\"https://github.com/wvhulle/riddle-proofs/blob/uniform-density/RiddleProofs/MontyHall.lean\">here</a>.</p>\n</blockquote>\n<p>I think there is an issue in the file: you are counting outcomes combinatorially - in a space of all possible game histories -  instead of using Bayesian Inference, ie update a prior belief with new information. eg PMF.uniformOfFinset valid_games_finset  assumes that <em>every valid game history is equally likely</em>, which  is not true.</p>",
        "id": 526265548,
        "sender_full_name": "Matteo Cipollina",
        "timestamp": 1751198687
    },
    {
        "content": "<p>Yes, I noticed that as well. I will push the previous version instead which some more decision logic.</p>\n<p>I guess this would be better?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">game_weight</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ω</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Game</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">ω</span><span class=\"bp\">.</span><span class=\"n\">host</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">ω</span><span class=\"bp\">.</span><span class=\"n\">pick</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\">     </span><span class=\"c1\">-- Host never opens the picked door.</span>\n<span class=\"w\">  </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">ω</span><span class=\"bp\">.</span><span class=\"n\">host</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">ω</span><span class=\"bp\">.</span><span class=\"n\">car</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"c1\">-- Host never opens the car door.</span>\n<span class=\"w\">  </span><span class=\"k\">else</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">ω</span><span class=\"bp\">.</span><span class=\"n\">car</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">ω</span><span class=\"bp\">.</span><span class=\"n\">pick</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\">    </span><span class=\"c1\">-- Contestant chose the car. Host chooses from 2 doors.</span>\n<span class=\"w\">    </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\">                      </span><span class=\"c1\">-- Contestant chose a goat. Host is forced to open the only other goat door.</span>\n</code></pre></div>",
        "id": 526265640,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1751198779
    },
    {
        "content": "<p>that seems correct, though I'd still use a more bayesian approach, where the sample space is only the unknown state of the world, and information is used to update beliefs about that state, and where the host is modeled by a likelihood function, rather than a weighting function. It's a more general approach that can be extended to continuous scenarios and handle better more complex sample space (where your approach can become unwiely for more complex problems) . But your approach with this revised defintion should work too</p>",
        "id": 526267815,
        "sender_full_name": "Matteo Cipollina",
        "timestamp": 1751201300
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"779253\">Matteo Cipollina</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Calculating.20probability.20proving.20optimal.20strategy.20Monty.20Hall/near/526267815\">zei</a>:</p>\n<blockquote>\n<p>I'd still use a more bayesian approach, where the sample space is only the unknown state of the world, and information is used to update beliefs about that state, and where the host is modeled by a likelihood function, rather than a weighting function. It's a more general approach that can be extended to continuous scenarios and handle better more complex sample space (where your approach can become unwiely for more complex problems) . But your approach with this revised defintion should work too</p>\n</blockquote>\n<p>Ah, well I haven't really used the Bayesian approach yet. Do you recommend learning about it directly trying to apply it? I have trouble computing the probability of the winning strategy.</p>",
        "id": 526268509,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1751202132
    },
    {
        "content": "<p>Is my impression correct that this part of Lean (probability theory, Bayesian statistics) is not very developped?</p>",
        "id": 526269923,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1751203732
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"928352\">Willem vanhulle</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Calculating.20probability.20proving.20optimal.20strategy.20Monty.20Hall/near/526269923\">ha scritto</a>:</p>\n<blockquote>\n<p>Is my impression correct that this part of Lean (probability theory, Bayesian statistics) is not very developped?</p>\n</blockquote>\n<p>Not directly developed, but  you can find most of general tools needed to model a theory of conditional probability built on kernels and measure theory , and with it to build the Bayesian update you need.</p>",
        "id": 526273066,
        "sender_full_name": "Matteo Cipollina",
        "timestamp": 1751207090
    },
    {
        "content": "<p>Could you help me with the first steps? Or maybe give a reference that I could read?</p>",
        "id": 526273455,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1751207444
    },
    {
        "content": "<p>I spent a week on this problem already on the classical approach (which I can show).</p>",
        "id": 526273608,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1751207590
    },
    {
        "content": "<p>I almost have the full proof for the Monty Hall dilemma but started doubting my model again. For some reason <code>Prob[host_opens host | (car_at pick)ᶜ] = 1/2</code> does not hold. Instead <code>Prob[host_opens host | (car_at pick)ᶜ] = 1/4</code> which breaks the main theorem.</p>\n<p>Does anyone know what I did wrong? Did I use the wrong assumptions or model?</p>\n<p>Source code: <a href=\"https://github.com/wvhulle/learn-lean-riddles/blob/f1e612fe6c1bdea8cf30d43d97d7172a99092227/RiddleProofs/MontyHall/Basic.lean#L146\">GitHub</a></p>",
        "id": 530851054,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1753478743
    },
    {
        "content": "<p>it seems your lean code and 1/4 outcome is  correct within your model, but your model does not represent the correct sample space and probability measure of the actual scenario. If I understand correctly, for the sample space you assume  the set of all possible valid final states (car, pick, host), and assume that each of those tuples is equally likely. But the sample space Ω should be based on the initial, random events: the car location and player's initial choice, which are independent and uniform. The host's choice is a function that depends on the outcome (car, choice) ∈ Ω</p>",
        "id": 530853914,
        "sender_full_name": "Matteo Cipollina",
        "timestamp": 1753480291
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"779253\">@Matteo Cipollina</span>, oh thanks! So you would recommend removing host as a field from the Game structure? How can I condition at the end on the pick of the host after the hosts decision is not anymore a field of the Game structure?</p>",
        "id": 530909734,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1753516035
    },
    {
        "content": "<p>I've made a PR to your repo with the Bayesian version of Monty Hall, leveraging the Kernel.Posterior.lean in mathlib (adapted to singletons). While unneccesarily powerful for this 'simple' combiantorial problem, I think it is the most general, elegant and interesting way to frame it mathematically. The framework can be easily adapted to much more complex real-world problems, by varying the sample space (eg non Uniform), likelihood function etc. I think it can help you understand how Bayesian inference can work in real practice in lean and how to better frame your combinatorial formalization, so you can have both in the repo :)</p>\n<p><a href=\"https://github.com/wvhulle/learn-lean-riddles/pull/26/files\">https://github.com/wvhulle/learn-lean-riddles/pull/26/files</a></p>",
        "id": 531120628,
        "sender_full_name": "Matteo Cipollina",
        "timestamp": 1753615438
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"779253\">@Matteo Cipollina</span> Wow! Thanks! I was struggling with this problem for weeks, so this is very helpful of you :). I'll have a look at it.</p>",
        "id": 531123789,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1753616639
    }
]