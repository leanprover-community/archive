[
    {
        "content": "<p>Do we have the following version of the Gelfand-Mazur theorem? </p>\n<p><em>The only complete archimedean fields are (up to iso)</em> <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">R</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">R</span></span></span></span> <em>and</em> <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">C</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">C</span></span></span></span>.</p>\n<p>This would be helpful in the next step of showing that absolute values on complete fields lift uniquely to finite extensions...</p>",
        "id": 492981860,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736525744
    },
    {
        "content": "<p>not that I know of, but we do have this version: <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=NormedRing.algEquivComplexOfComplete#doc\">docs#NormedRing.algEquivComplexOfComplete</a>, which could help proving it.</p>",
        "id": 492983046,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1736526136
    },
    {
        "content": "<p>Thanks. The missing step seems to be that a nontrivially archimedean normed complete field such that the canonical map from the reals into it is not surjective must actually be a ‚ÑÇ-algebra. Is there anything I can use for that?<br>\nI'm looking at Theorem 6.2 in <a href=\"http://math.stanford.edu/~conrad/676Page/handouts/ostrowski.pdf\">these notes</a>. The proof says \"... Using a little complex analysis, it is shown in Theorem 2.3 and Corollary 2.4 in Ch. XII in Lang‚Äôs Algebra (3rd ed.) that F must be <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">R</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">R</span></span></span></span>-isomorphic to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">C</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">C</span></span></span></span> as a field ...\", which is not so helpful. I can look up Lang's Algebra, of course.</p>",
        "id": 492984625,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736526651
    },
    {
        "content": "<p>How are you ruling out some larger formally real field with infinitely big/small elements like some completion of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">R</mi><mo stretchy=\"false\">(</mo><mi>œµ</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\mathbb{R}(\\epsilon)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathbb\">R</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">œµ</span><span class=\"mclose\">)</span></span></span></span>? Oh is the idea that the norm is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">R</mi></mrow><annotation encoding=\"application/x-tex\">\\R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">R</span></span></span></span>-valued?</p>",
        "id": 492986833,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1736527429
    },
    {
        "content": "<p>There is also an archimedean included in the conditions.</p>",
        "id": 492988774,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736528137
    },
    {
        "content": "<p>Maybe I don't know what that word means :-) (I recall some rant in Wikipedia about how it means several things)</p>",
        "id": 492989748,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1736528437
    },
    {
        "content": "<p>In my courses I usually define \"archimedean\" to mean \"not non-archimedean\" (I am serious)</p>",
        "id": 492989884,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1736528488
    },
    {
        "content": "<p>That's what it means here <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 492990053,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736528534
    },
    {
        "content": "<p>Well |1+1|&gt;|1| so the completion of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">R</mi><mo stretchy=\"false\">(</mo><mi>œµ</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\R(\\epsilon)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathbb\">R</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">œµ</span><span class=\"mclose\">)</span></span></span></span> looks archimedean to me :-/</p>",
        "id": 492990221,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1736528605
    },
    {
        "content": "<p>Basically I'm saying that I would happily think about the question but I don't know what the question is.</p>",
        "id": 492990317,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1736528638
    },
    {
        "content": "<p>The norms are indeed real-valued here.</p>",
        "id": 492995102,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736530393
    },
    {
        "content": "<p>One thing that seems necessary is the implication \"positive characteristic ==&gt; absolute value is nonarchimedean\". I don't think this is in Mathlib (but would be delighted to learn otherwise). This can be done via<br>\n<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi>lim</mi><mo>‚Å°</mo></mrow><mrow><mi>r</mi><mo>‚Üí</mo><mi mathvariant=\"normal\">‚àû</mi></mrow></msub><mo stretchy=\"false\">(</mo><msup><mi>x</mi><mi>r</mi></msup><mo>+</mo><msup><mi>y</mi><mi>r</mi></msup><msup><mo stretchy=\"false\">)</mo><mrow><mn>1</mn><mi mathvariant=\"normal\">/</mi><mi>r</mi></mrow></msup><mo>‚â§</mo><mi>max</mi><mo>‚Å°</mo><mo stretchy=\"false\">{</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">}</mo></mrow><annotation encoding=\"application/x-tex\">\\lim_{r \\to \\infty} (x^r + y^r)^{1/r} \\le \\max\\{x,y\\}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\"><span class=\"mop\">lim</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span><span class=\"mrel mtight\">‚Üí</span><span class=\"mord mtight\">‚àû</span></span></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.138em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span></span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.888em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1/</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">‚â§</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">max</span><span class=\"mopen\">{</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">}</span></span></span></span><br>\n(for real <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo>‚â•</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">x, y \\ge 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8304em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">‚â•</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>), but loogle does not come up with something useful along these lines:<br>\n<span class=\"user-mention\" data-user-id=\"644391\">@loogle</span> ((?x ^ (?r : ‚Ñù)) + (?y ^?r)) ^ _</p>",
        "id": 493015643,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736538499
    },
    {
        "content": "<p><span aria-label=\"search\" class=\"emoji emoji-1f50d\" role=\"img\" title=\"search\">:search:</span> <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Analysis/MeanInequalitiesPow.html#NNReal.rpow_add_rpow_le_add\">NNReal.rpow_add_rpow_le_add</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Analysis/MeanInequalitiesPow.html#ENNReal.rpow_add_rpow_le_add\">ENNReal.rpow_add_rpow_le_add</a>, and <a href=\"https://loogle.lean-lang.org/?q=%28%28%3Fx%20%5E%20%28%3Fr%20%3A%20%E2%84%9D%29%29%20%2B%20%28%3Fy%20%5E%3Fr%29%29%20%5E%20_\">7 more</a></p>",
        "id": 493015646,
        "sender_full_name": "loogle",
        "timestamp": 1736538500
    },
    {
        "content": "<p>These statements all do not contain limits..</p>",
        "id": 493015683,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736538524
    },
    {
        "content": "<p>I think I proved something related in <a href=\"https://github.com/leanprover-community/mathlib4/pull/15077\">#15077</a>?</p>",
        "id": 493017458,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1736539349
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Gelfand-Mazur.20theorem/near/492990221\">said</a>:</p>\n<blockquote>\n<p>Well |1+1|&gt;|1| so the completion of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">R</mi><mo stretchy=\"false\">(</mo><mi>œµ</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\R(\\epsilon)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathbb\">R</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">œµ</span><span class=\"mclose\">)</span></span></span></span> looks archimedean to me :-/</p>\n</blockquote>\n<p>But <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">Z</mi><mo>‚ãÖ</mo><mi>œµ</mi></mrow><annotation encoding=\"application/x-tex\"> \\mathbb{Z}\\cdot \\epsilon </annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">Z</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">‚ãÖ</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">œµ</span></span></span></span> is bounded (and it not being bounded is the definition I was given of archimedean)</p>",
        "id": 493018039,
        "sender_full_name": "Luigi Massacci",
        "timestamp": 1736539641
    },
    {
        "content": "<p>Yes, that's another definition.</p>",
        "id": 493018905,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1736540030
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"308899\">Yakov Pechersky</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Gelfand-Mazur.20theorem/near/493017458\">said</a>:</p>\n<blockquote>\n<p>I think I proved something related in <a href=\"https://github.com/leanprover-community/mathlib4/pull/15077\">#15077</a>?</p>\n</blockquote>\n<p>Thanks, this helps!<br>\n(Nit: The second <code>isUltrametricDist</code> in <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsUltrametricDist.isUltrametricDist_iff_isNonarchimedean_norm#doc\">docs#IsUltrametricDist.isUltrametricDist_iff_isNonarchimedean_norm</a> etc. seems to be unnecessary.)</p>",
        "id": 493018930,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736540039
    },
    {
        "content": "<p>Here is an approach:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AbsoluteValue</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">}</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">IsUltrametricDist</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">charZero_of_archimedean</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬¨</span><span class=\"w\"> </span><span class=\"n\">IsNonarchimedean</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CharZero</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">contrapose!</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ringChar</span><span class=\"w\"> </span><span class=\"n\">F</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CharP</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithAbs</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ringChar</span><span class=\"bp\">.</span><span class=\"n\">charP</span><span class=\"w\"> </span><span class=\"n\">F</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">NeZero</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">mt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">CharP</span><span class=\"bp\">.</span><span class=\"n\">ringChar_zero_iff_CharZero</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">‚ü©</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚Äñ</span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithAbs</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"bp\">‚Äñ</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">œÜ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ZMod</span><span class=\"bp\">.</span><span class=\"n\">castHom</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">dvd_rfl</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithAbs</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hB</span><span class=\"bp\">‚ü©</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÉ</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ZMod</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚Äñ</span><span class=\"n\">œÜ</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">‚Äñ</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Finite</span><span class=\"bp\">.</span><span class=\"n\">exists_le</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">    </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">le_of_forall_pos_le_add</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">Œµ</span><span class=\"w\"> </span><span class=\"n\">hŒµ</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"bp\">?_</span>\n<span class=\"w\">    </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">m</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hm</span><span class=\"bp\">‚ü©</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">pow_unbounded_of_one_lt</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">lt_add_of_pos_right</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">hŒµ</span>\n<span class=\"w\">    </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">pow_le_pow_iff_left‚ÇÄ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">norm_nonneg</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">linarith</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"n\">zero_ne_add_one</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"bp\">?_</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">norm_pow</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pow_succ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">Œµ</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">cast_pow</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">map_natCast</span><span class=\"w\"> </span><span class=\"n\">œÜ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">mul_one</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">‚Äñ_‚Äñ</span><span class=\"o\">)]</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hŒµ'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">lt_add_of_pos_right</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">hŒµ</span><span class=\"w\"> </span><span class=\"c1\">-- for `gcongr` below</span>\n<span class=\"w\">    </span><span class=\"n\">gcongr</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hB</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"n\">hm</span><span class=\"bp\">.</span><span class=\"n\">le</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">isUltrametricDist_iff_isNonarchimedean_norm</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span>\n<span class=\"w\">    </span><span class=\"n\">isUltrametricDist_of_forall_norm_natCast_le_one</span><span class=\"w\"> </span><span class=\"n\">H</span>\n</code></pre></div>",
        "id": 493026552,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736543666
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Gelfand-Mazur.20theorem/near/492989884\">said</a>:</p>\n<blockquote>\n<p>In my courses I usually define \"archimedean\" to mean \"not non-archimedean\" (I am serious)</p>\n</blockquote>\n<p>Aren't the definitions equivalent (for normed fields)?<br>\nR(œµ) doesn't have an R-valued norm.</p>",
        "id": 493061415,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1736568437
    },
    {
        "content": "<p>It wouldn't surprise me. I was just very confused above</p>",
        "id": 493068775,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1736575987
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/IIntg4ic1FrB_f-O4LeY0RYJ/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/IIntg4ic1FrB_f-O4LeY0RYJ/image.png\" title=\"image.png\"><img data-original-dimensions=\"593x306\" src=\"/user_uploads/thumbnail/3121/IIntg4ic1FrB_f-O4LeY0RYJ/image.png/840x560.webp\"></a></div>",
        "id": 493087771,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1736593889
    },
    {
        "content": "<p>I'm going to add that.</p>",
        "id": 493110840,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736614642
    },
    {
        "content": "<p>I'm running into the following problem.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"bp\">.</span><span class=\"n\">AbsoluteValue</span>\n<span class=\"c1\">-- `real` is the standard absolute value on `‚Ñö`</span>\n\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">real</span><span class=\"bp\">.</span><span class=\"n\">Completion</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- fails :-(</span>\n<span class=\"c1\">-- The relevant instance is</span>\n<span class=\"c\">/-</span>\n<span class=\"cm\">instance UniformSpace.Completion.instField {K : Type u_1} [Field K] [UniformSpace K]</span>\n<span class=\"cm\">    [TopologicalDivisionRing K] [CompletableTopField K] [UniformAddGroup K] :</span>\n<span class=\"cm\">    Field (UniformSpace.Completion K)</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithAbs</span><span class=\"w\"> </span><span class=\"n\">real</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- OK</span>\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">UniformSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithAbs</span><span class=\"w\"> </span><span class=\"n\">real</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- OK</span>\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">TopologicalDivisionRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithAbs</span><span class=\"w\"> </span><span class=\"n\">real</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- OK</span>\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">CompletableTopField</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithAbs</span><span class=\"w\"> </span><span class=\"n\">real</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- fails :-(</span>\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">UniformAddGroup</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithAbs</span><span class=\"w\"> </span><span class=\"n\">real</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- OK</span>\n\n<span class=\"c\">/-</span>\n<span class=\"cm\">class CompletableTopField (K : Type u_1) [Field K] [UniformSpace K] extends T0Space K :</span>\n<span class=\"cm\">Prop</span>\n\n<span class=\"cm\">A topological field is completable if it is separated and the image under the mapping x ‚Ü¶ x‚Åª¬π of every Cauchy filter (with respect to the additive uniform structure) which does not have a cluster point at 0 is a Cauchy filter (with respect to the additive uniform structure). This ensures the completion is a field.</span>\n\n<span class=\"cm\">    t0 ‚¶Éx y : K‚¶Ñ : Inseparable x y ‚Üí x = y</span>\n<span class=\"cm\">    nice (F : Filter K) : Cauchy F ‚Üí nhds 0 ‚äì F = ‚ä• ‚Üí Cauchy (Filter.map (fun (x : K) =&gt; x‚Åª¬π) F)</span>\n<span class=\"cm\">-/</span>\n<span class=\"c1\">-- the only relevant instance is</span>\n<span class=\"c\">/-</span>\n<span class=\"cm\">@[instance 100]</span>\n<span class=\"cm\">instance Valued.completable {K : Type u_1} [Field K] {Œì‚ÇÄ : Type u_2}</span>\n<span class=\"cm\">    [LinearOrderedCommGroupWithZero Œì‚ÇÄ] [hv : Valued K Œì‚ÇÄ] :</span>\n<span class=\"cm\">    CompletableTopField K</span>\n<span class=\"cm\">-/</span>\n<span class=\"c1\">-- but</span>\n<span class=\"c\">/-</span>\n<span class=\"cm\">class Valued (R : Type u) [Ring R] (Œì‚ÇÄ : outParam (Type v))</span>\n<span class=\"cm\">    [LinearOrderedCommGroupWithZero Œì‚ÇÄ] extends UniformSpace R, UniformAddGroup R where</span>\n<span class=\"cm\">  v : Valuation R Œì‚ÇÄ</span>\n<span class=\"cm\">  is_topological_valuation : ‚àÄ s, s ‚àà ùìù (0 : R) ‚Üî ‚àÉ Œ≥ : Œì‚ÇÄÀ£, { x : R | v x &lt; Œ≥ } ‚äÜ s</span>\n\n<span class=\"cm\">structure Valuation extends R ‚Üí*‚ÇÄ Œì‚ÇÄ where</span>\n<span class=\"cm\">  /-- The valuation of a a sum is less that the sum of the valuations -/</span>\n<span class=\"cm\">  map_add_le_max' : ‚àÄ x y, toFun (x + y) ‚â§ max (toFun x) (toFun y)</span>\n<span class=\"cm\">-/</span>\n</code></pre></div>\n<p>Note that the docstring is wrong: it should say \"less than the max of\"</p>\n<p>Anyway, this prevents the <code>Field</code> instance to fire when the valuation is archimedean. (There is also the added complication that <code>‚Ñù</code> is not a <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearOrderedCommGroupWithZero#doc\">docs#LinearOrderedCommGroupWithZero</a> .)</p>\n<p>So my question is: How can I fill in the <code>sorry</code> below?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AbsoluteValue</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">}</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CompletableTopField</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithAbs</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">t0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">inferInstanceAs</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">T0Space</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">t0</span>\n<span class=\"w\">  </span><span class=\"n\">nice</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">hc</span><span class=\"w\"> </span><span class=\"n\">hn</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>Unfortunately, I have next to no idea how to work with Cauchy filters and uniformities...</p>",
        "id": 493124035,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736626036
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"400289\">Artie Khovanov</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Gelfand-Mazur.20theorem/near/493087771\">said</a>:</p>\n<blockquote>\n<p><a href=\"/user_uploads/3121/IIntg4ic1FrB_f-O4LeY0RYJ/image.png\">image.png</a></p>\n</blockquote>\n<p>should I bother sourcing stuff like this btw<br>\nor does it not matter bc it's folklore</p>",
        "id": 493124826,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1736626856
    },
    {
        "content": "<p>Is there something like a \"topological ring isomorphism\" in Mathlib? It doesn't look like it:<br>\n<span class=\"user-mention\" data-user-id=\"644391\">@loogle</span> RingEquiv, Homeomorph</p>",
        "id": 493125332,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736627306
    },
    {
        "content": "<p><span aria-label=\"search\" class=\"emoji emoji-1f50d\" role=\"img\" title=\"search\">:search:</span> <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Topology/LocallyConstant/Algebra.html#LocallyConstant.congrLeftRingEquiv\">LocallyConstant.congrLeftRingEquiv</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Topology/LocallyConstant/Algebra.html#LocallyConstant.congrLeftRingEquiv_apply_apply\">LocallyConstant.congrLeftRingEquiv_apply_apply</a>, and <a href=\"https://loogle.lean-lang.org/?q=RingEquiv%2C%20Homeomorph\">1 more</a></p>",
        "id": 493125334,
        "sender_full_name": "loogle",
        "timestamp": 1736627309
    },
    {
        "content": "<p>These are not what I was hoping to see...</p>",
        "id": 493125367,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736627343
    },
    {
        "content": "<p><a href=\"https://en.wikipedia.org/wiki/XY_problem\">#xy</a>: I would like to show that the completions of a field <code>F</code> w.r.t. two equivalent absolute values are isomorphic as topological fields (for the fact that they are fields I need the <code>sorry</code> above) and I'm trying to figure out how to write down the statement.</p>",
        "id": 493125482,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736627423
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479359\">Michael Stoll</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Gelfand-Mazur.20theorem/near/493110840\">said</a>:</p>\n<blockquote>\n<p>I'm going to add that.</p>\n</blockquote>\n<p>There is now</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AbsoluteValue</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">}</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">le_one_on_nat_of_isNonarchimedean</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nontrivial</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsNonarchimedean</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">le_one_on_nat_of_bounded</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nontrivial</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AbsoluteValue</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">}</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">isNonarchimedean_of_le_one_on_nat</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsNonarchimedean</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">isNonarchimedean_of_bounded_on_nat</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsNonarchimedean</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n\n<span class=\"sd\">/-- An absolute value on a field is nonarchimedean if and only if it is bounded by `1`</span>\n<span class=\"sd\">on the image of `‚Ñï`. -/</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">isNonarchimedean_iff_le_one_on_nat</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsNonarchimedean</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">‚Üî</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n</code></pre></div>\n<p>in <a href=\"https://github.com/MichaelStollBayreuth/Heights/blob/master/Heights/Auxiliary.lean\">Heights.Auxiliary</a> .</p>",
        "id": 493126068,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736628058
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479359\">Michael Stoll</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Gelfand-Mazur.20theorem/near/493125482\">said</a>:</p>\n<blockquote>\n<p><a href=\"https://en.wikipedia.org/wiki/XY_problem\">#xy</a>: I would like to show that the completions of a field <code>F</code> w.r.t. two equivalent absolute values are isomorphic as topological fields (for the fact that they are fields I need the <code>sorry</code> above) and I'm trying to figure out how to write down the statement.</p>\n</blockquote>\n<p>I got stuck on the same problem last summer when I was working on Ostrowski for number fields. Then, I stumbled upon <a href=\"https://github.com/leanprover-community/mathlib4/pull/16483\">#16483</a> which I thought could be helpful but it was under review and constantly changing so I decided to wait for it to settle and be merged.</p>",
        "id": 493126393,
        "sender_full_name": "Fabrizio Barroero",
        "timestamp": 1736628429
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479359\">Michael Stoll</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Gelfand-Mazur.20theorem/near/493125332\">said</a>:</p>\n<blockquote>\n<p>Is there something like a \"topological ring isomorphism\" in Mathlib? It doesn't look like it:<br>\n<span class=\"user-mention silent\" data-user-id=\"644391\">loogle</span> RingEquiv, Homeomorph</p>\n</blockquote>\n<p>I think it would be helpful to have  something like that...</p>\n<p>This was my attempt for <code>MulRingNorm</code></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">NormHom</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NonAssocRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MulRingNorm</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NonAssocRing</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MulRingNorm</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">S</span>\n<span class=\"w\">  </span><span class=\"n\">map_norm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">‚àò</span><span class=\"w\"> </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">MulRingNormHom</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NonAssocRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MulRingNorm</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NonAssocRing</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MulRingNorm</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">extends</span>\n<span class=\"w\">  </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">‚Üí+*</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">NormHom</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">MulRingNormIso</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NonAssocRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MulRingNorm</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NonAssocRing</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MulRingNorm</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">extends</span>\n<span class=\"w\">  </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ+*</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">NormHom</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">NormHomEquiv</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NonAssocRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MulRingNorm</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NonAssocRing</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MulRingNorm</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">S</span>\n<span class=\"w\">  </span><span class=\"n\">map_norm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÉ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">‚àß</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">‚àò</span><span class=\"w\"> </span><span class=\"n\">toFun</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">MulRingNormHomEquiv</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NonAssocRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MulRingNorm</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NonAssocRing</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MulRingNorm</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">extends</span>\n<span class=\"w\">  </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">‚Üí+*</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">NormHomEquiv</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">MulRingNormIsoEquiv</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NonAssocRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MulRingNorm</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NonAssocRing</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MulRingNorm</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">extends</span>\n<span class=\"w\">  </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ+*</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">NormHomEquiv</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span>\n</code></pre></div>",
        "id": 493126841,
        "sender_full_name": "Fabrizio Barroero",
        "timestamp": 1736628884
    },
    {
        "content": "<p>The problem with that (i.e., <a href=\"https://github.com/leanprover-community/mathlib4/pull/16483\">#16483</a>) is that a <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=NumberField.InfinitePlace#doc\">docs#NumberField.InfinitePlace</a> comes already packaged with a homomorphism into a normed field (the complex numbers), which is then used to get the <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CompletableTopField#doc\">docs#CompletableTopField</a> instance. In the general setting I am in, we don't know a priori that such a target field exists.</p>",
        "id": 493126849,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736628898
    },
    {
        "content": "<p>Your <code>NormHom</code> etc. is too rigid (the norms are not necessarily the same, but the induced topologies are).</p>",
        "id": 493126957,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736629017
    },
    {
        "content": "<p>But of course one could just bundle <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=RingEquiv#doc\">docs#RingEquiv</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Homeomorph#doc\">docs#Homeomorph</a> together.</p>",
        "id": 493127001,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736629081
    },
    {
        "content": "<p>But this would entail writing a bunch of API lemmas...</p>",
        "id": 493127049,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736629103
    },
    {
        "content": "<p>So I was hoping that something like that already exists.</p>",
        "id": 493127064,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736629133
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479359\">Michael Stoll</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Gelfand-Mazur.20theorem/near/493127064\">said</a>:</p>\n<blockquote>\n<p>So I was hoping that something like that already exists.</p>\n</blockquote>\n<p>Indeed, it is quite surprising there's nothing like that in Mathlib</p>",
        "id": 493127098,
        "sender_full_name": "Fabrizio Barroero",
        "timestamp": 1736629175
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479359\">Michael Stoll</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Gelfand-Mazur.20theorem/near/493124035\">said</a>:</p>\n<blockquote>\n<p>So my question is: How can I fill in the <code>sorry</code> below?</p>\n</blockquote>\n<p>Here is a solution (that goes back to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Œµ</mi></mrow><annotation encoding=\"application/x-tex\">\\varepsilon</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">Œµ</span></span></span></span> s and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Œ¥</mi></mrow><annotation encoding=\"application/x-tex\">\\delta</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03785em;\">Œ¥</span></span></span></span> s):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AbsoluteValue</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">}</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CompletableTopField</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithAbs</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">t0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">inferInstanceAs</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">T0Space</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">t0</span>\n<span class=\"w\">  </span><span class=\"n\">nice</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">hc</span><span class=\"w\"> </span><span class=\"n\">hn</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Metric</span><span class=\"bp\">.</span><span class=\"n\">cauchy_iff</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hc</span><span class=\"w\"> </span><span class=\"bp\">‚ä¢</span>\n<span class=\"w\">    </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">hf‚ÇÅ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hf‚ÇÇ</span><span class=\"bp\">‚ü©</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">hc</span>\n<span class=\"w\">    </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">Filter</span><span class=\"bp\">.</span><span class=\"n\">map_neBot</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">?_‚ü©</span>\n<span class=\"w\">    </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">U</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hU</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hV</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hUV</span><span class=\"bp\">‚ü©</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Filter</span><span class=\"bp\">.</span><span class=\"n\">inf_eq_bot_iff</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"n\">hn</span>\n<span class=\"w\">    </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">Œµ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hŒµ‚ÇÄ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hŒµ</span><span class=\"bp\">‚ü©</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Metric</span><span class=\"bp\">.</span><span class=\"n\">mem_nhds_iff</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"n\">hU</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">Œ¥</span><span class=\"w\"> </span><span class=\"n\">hŒ¥‚ÇÄ</span>\n<span class=\"w\">    </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">t</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ht‚ÇÅ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ht‚ÇÇ</span><span class=\"bp\">‚ü©</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">hf‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ¥</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Œµ</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">positivity</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">‚à©</span><span class=\"w\"> </span><span class=\"n\">V</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">dist</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">Œ¥</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Œµ</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">      </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span>\n<span class=\"w\">        </span><span class=\"n\">ht‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">mem_of_mem_inter_left</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">mem_of_mem_inter_left</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Filter</span><span class=\"bp\">.</span><span class=\"n\">mem_map</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"o\">(</span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"bp\">‚Åª¬π</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Åª¬π'</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">inv_preimage</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">inv_inv</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">Filter</span><span class=\"bp\">.</span><span class=\"n\">inter_mem</span><span class=\"w\"> </span><span class=\"n\">ht‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">hV</span><span class=\"o\">,</span>\n<span class=\"w\">      </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"bp\">?_‚ü©</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">inv_preimage</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">mem_inv</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"n\">hy</span>\n<span class=\"w\">    </span><span class=\"n\">specialize</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">‚Åª¬π</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">‚Åª¬π</span><span class=\"w\"> </span><span class=\"n\">hy</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">dist_eq_norm_sub</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">‚ä¢</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h‚ÇÄ</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithAbs</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hz</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"bp\">‚Åª¬π</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">‚â†</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">rintro</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">inv_zero</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hz</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">mem_empty_iff_false</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span>\n<span class=\"w\">        </span><span class=\"n\">hUV</span><span class=\"w\"> </span><span class=\"bp\">‚ñ∏</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">mem_inter</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hŒµ</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Metric</span><span class=\"bp\">.</span><span class=\"n\">mem_ball_self</span><span class=\"w\"> </span><span class=\"n\">hŒµ‚ÇÄ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">mem_of_mem_inter_right</span><span class=\"w\"> </span><span class=\"n\">hz</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">HŒµ</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithAbs</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hz</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"bp\">‚Åª¬π</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚Äñ</span><span class=\"n\">z</span><span class=\"bp\">‚Äñ</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">Œµ</span><span class=\"bp\">‚Åª¬π</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"bp\">‚Åª¬π</span><span class=\"w\"> </span><span class=\"bp\">‚àâ</span><span class=\"w\"> </span><span class=\"n\">Metric</span><span class=\"bp\">.</span><span class=\"n\">ball</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">Œµ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">        </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">mem_empty_iff_false</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span>\n<span class=\"w\">          </span><span class=\"n\">hUV</span><span class=\"w\"> </span><span class=\"bp\">‚ñ∏</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">mem_inter</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hŒµ</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">mem_of_mem_inter_right</span><span class=\"w\"> </span><span class=\"n\">hz</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Metric</span><span class=\"bp\">.</span><span class=\"n\">mem_ball</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">dist_zero_right</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">norm_inv</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">not_lt</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">this</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">le_inv_of_le_inv‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">hŒµ‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">this</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hx‚ÇÄ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">hx</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hy‚ÇÄ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">hy</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hxŒµ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">HŒµ</span><span class=\"w\"> </span><span class=\"n\">hx</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hyŒµ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">HŒµ</span><span class=\"w\"> </span><span class=\"n\">hy</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">‚Åª¬π</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">‚Åª¬π</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">field_simp</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">norm_div</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">norm_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">norm_sub_rev</span><span class=\"o\">,</span>\n<span class=\"w\">      </span><span class=\"n\">div_lt_iff‚ÇÄ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hx‚ÇÄ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hy‚ÇÄ</span><span class=\"o\">])]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">trans_le</span><span class=\"w\"> </span><span class=\"bp\">?_</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mul_assoc</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">conv_rhs</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">mul_one</span><span class=\"w\"> </span><span class=\"n\">Œ¥</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">gcongr</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">sq</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"k\">calc</span><span class=\"w\"> </span><span class=\"n\">Œµ</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Œµ</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">‚Äñ</span><span class=\"n\">x</span><span class=\"bp\">‚Äñ</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">‚Äñ</span><span class=\"n\">y</span><span class=\"bp\">‚Äñ</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">Œµ</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Œµ</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œµ</span><span class=\"bp\">‚Åª¬π</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Œµ</span><span class=\"bp\">‚Åª¬π</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">gcongr</span>\n<span class=\"w\">    </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">field_simp</span>\n</code></pre></div>\n<p>I invite our <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Filter#doc\">docs#Filter</a> aficionados to improve on that <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 493133398,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736635539
    },
    {
        "content": "<p>(The idea is clear: if <code>x</code> and <code>y</code> are uniformly close and away from zero, then their inverses are also uniformly close. But the proof feels a bit clumsy.)</p>",
        "id": 493133471,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736635609
    },
    {
        "content": "<p>Can you use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsUniformInducing.completableTopField#doc\">docs#IsUniformInducing.completableTopField</a> with the absolute value?</p>",
        "id": 493139113,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1736641220
    },
    {
        "content": "<p>Ah, that presupposes Field already.</p>",
        "id": 493139177,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1736641288
    },
    {
        "content": "<p>This is not the problem; rather, the problem is that the absolute value is not a ring homomorphism.</p>",
        "id": 493170005,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736671446
    },
    {
        "content": "<p>In any case, my proof above works with <code>[NormedField F]</code> for <code>F</code> in place of <code>WithAbs v</code>. </p>\n<p>I think that <code>NormedField.toCompletableTopField</code> is a missing instance in Mathlib and should be added. I'd just like to have a more idiomatic proof...</p>\n<p>Note that the following loogle query does not turn up something like that:<br>\n<span class=\"user-mention\" data-user-id=\"644391\">@loogle</span> ‚ä¢ CompletableTopField _</p>",
        "id": 493170291,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736671769
    },
    {
        "content": "<p><span aria-label=\"search\" class=\"emoji emoji-1f50d\" role=\"img\" title=\"search\">:search:</span> <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Topology/Algebra/UniformField.html#completableTopField_of_complete\">completableTopField_of_complete</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Topology/Algebra/UniformField.html#Subfield.completableTopField\">Subfield.completableTopField</a>, and <a href=\"https://loogle.lean-lang.org/?q=%E2%8A%A2%20CompletableTopField%20_\">3 more</a></p>",
        "id": 493170293,
        "sender_full_name": "loogle",
        "timestamp": 1736671771
    },
    {
        "content": "<p>(The other three are <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CompletableTopField.mk#doc\">docs#CompletableTopField.mk</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsUniformInducing.completableTopField#doc\">docs#IsUniformInducing.completableTopField</a> mentioned by Yakov above, and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Valued.completable#doc\">docs#Valued.completable</a> mentioned by me earlier.)</p>",
        "id": 493170357,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736671825
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/20686\">#20686</a> adds the missing instance.</p>",
        "id": 493194350,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736692529
    },
    {
        "content": "<p>It's not the topic here, but I'd like to point out an elementary proof (three, in fact) of Gelfand Mazur that avoids a lot of stuff. They might be easier to formalize.</p>",
        "id": 493195292,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1736693287
    },
    {
        "content": "<p><a href=\"https://projecteuclid.org/journalArticle/Download?urlid=10.1307%2Fmmj%2F1028998012\">https://projecteuclid.org/journalArticle/Download?urlid=10.1307%2Fmmj%2F1028998012</a></p>",
        "id": 493195794,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1736693735
    },
    {
        "content": "<p><a href=\"https://www.jstage.jst.go.jp/article/jmath1948/4/1/4_1_96/_pdf\">https://www.jstage.jst.go.jp/article/jmath1948/4/1/4_1_96/_pdf</a></p>",
        "id": 493195909,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1736693825
    },
    {
        "content": "<p><a href=\"https://projecteuclid.org/journals/michigan-mathematical-journal/volume-1/issue-1/Normed-fields-over-the-real-and-complex-fields/10.1307/mmj/1028989727.full\">https://projecteuclid.org/journals/michigan-mathematical-journal/volume-1/issue-1/Normed-fields-over-the-real-and-complex-fields/10.1307/mmj/1028989727.full</a></p>",
        "id": 493196080,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1736693980
    },
    {
        "content": "<p>Does <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=uniformContinuous_div_const%27#doc\">docs#uniformContinuous_div_const'</a> help at all?</p>",
        "id": 493202239,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1736699244
    },
    {
        "content": "<p>Or not, since you have to vary both x and y simultaneously?</p>",
        "id": 493202328,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1736699296
    },
    {
        "content": "<p>That has a fixed denominator, so it is basically multiplication by a constant...</p>",
        "id": 493202341,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736699322
    },
    {
        "content": "<p>You'd need <code>x ‚Ü¶ x‚Åª¬π</code> to be uniformly continuous on the complement of any given neighborhood of zero.</p>",
        "id": 493202394,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736699379
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"644391\">@loogle</span> ‚ä¢ UniformContinuous .., ?x‚Åª¬π</p>",
        "id": 493202792,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736699675
    },
    {
        "content": "<p><span aria-label=\"search\" class=\"emoji emoji-1f50d\" role=\"img\" title=\"search\">:search:</span> <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Topology/Algebra/UniformGroup/Defs.html#uniformContinuous_inv\">uniformContinuous_inv</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Topology/Algebra/UniformGroup/Defs.html#UniformContinuous.inv\">UniformContinuous.inv</a>, and <a href=\"https://loogle.lean-lang.org/?q=%E2%8A%A2%20UniformContinuous%20..%2C%20%3Fx%E2%81%BB%C2%B9\">1 more</a></p>",
        "id": 493202794,
        "sender_full_name": "loogle",
        "timestamp": 1736699676
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Real.uniformContinuous_inv#doc\">docs#Real.uniformContinuous_inv</a> is the last one; it has something like the correct statement for the reals. Perhaps one can use that one via pulling back...?</p>",
        "id": 493202847,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736699748
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"479359\">@Michael Stoll</span> What is the Lean statement of Gelfand-Mazur that you are going for? There is also the short proof <a href=\"https://mathoverflow.net/a/420803\">https://mathoverflow.net/a/420803</a> that seems quite similar to one of the proofs Antoine linked to. (But maybe even a bit more streamlined.)</p>",
        "id": 493325463,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1736767538
    },
    {
        "content": "<p>Something along the lines of the following.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nontrivial</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">OrderedSemiring</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"sd\">/-- The restriction to a field `F` of an absolute value on an `F`-algebra `R`. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">AbsoluteValue</span><span class=\"bp\">.</span><span class=\"n\">restrict</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AbsoluteValue</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AbsoluteValue</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">v</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">RingHom</span><span class=\"bp\">.</span><span class=\"n\">injective</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">algebraMap</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">))</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">gelfand_mazur</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AbsoluteValue</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CompleteSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithAbs</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬¨</span><span class=\"w\"> </span><span class=\"n\">IsNonarchimedean</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"bp\">‚àÉ</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ+*</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">letI</span><span class=\"w\"> </span><span class=\"n\">alg</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">toRingHom</span><span class=\"bp\">.</span><span class=\"n\">toAlgebra</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"bp\">.</span><span class=\"n\">restrict</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"bp\">‚âà</span><span class=\"w\"> </span><span class=\"n\">AbsoluteValue</span><span class=\"bp\">.</span><span class=\"n\">abs</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚à®</span>\n<span class=\"w\">      </span><span class=\"bp\">‚àÉ</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ+*</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">letI</span><span class=\"w\"> </span><span class=\"n\">alg</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">toRingHom</span><span class=\"bp\">.</span><span class=\"n\">toAlgebra</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"bp\">.</span><span class=\"n\">restrict</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"w\"> </span><span class=\"bp\">‚âà</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">abs</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>(<code>AbsoluteValue.restrict</code> is in <a href=\"https://github.com/MichaelStollBayreuth/Heights\">Heights</a>.)<br>\nThe most convenient way of writing it will depend on how I can use it to show that if <code>L/K</code> is a (finite) extension of fields with <code>K</code> complete w.r.t. an archimedean absolute value <code>v</code>, then <code>v</code> can be extended to <code>L</code> (which the theorem would reduce to basically three cases).</p>",
        "id": 493359323,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736776929
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"406490\">@Mar√≠a In√©s de Frutos Fern√°ndez</span> did your work on the nonarchimedean version of this cover this case?</p>",
        "id": 493364772,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1736778269
    },
    {
        "content": "<p>I formalized that if <code>K</code> is a field complete with respect to a nonarchimedean real-valued norm, and  <code>L/K</code> is an algebraic field extension, then there is a unique norm on <code>L</code> extending the given norm on <code>K</code>, but the proof I followed (from BGR) would not apply in the archimedean case. At the time where I formalized this I thought about whether it was possibly to unify the proofs in the archimedean and nonarchimedean cases, but there is a step of the proof that I formalized that uses the nonarchimedean property in a way that I did not see how to avoid.</p>",
        "id": 493370005,
        "sender_full_name": "Mar√≠a In√©s de Frutos Fern√°ndez",
        "timestamp": 1736779683
    },
    {
        "content": "<p>Is this available somewhere? I will need this (plus the archimedean counterpart and then the classification of extensions of the absolute value in a general finite field extension) to show that an family of absolute values with product formula can be extended to a finite extension, so it would be good to have it available in Mathlib.</p>\n<p>This is likely closely related to showing that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"double-struck\">A</mi><mi>K</mi></msub><msub><mo>‚äó</mo><mi>K</mi></msub><mi>L</mi><mo>‚âÖ</mo><msub><mi mathvariant=\"double-struck\">A</mi><mi>L</mi></msub></mrow><annotation encoding=\"application/x-tex\">{\\mathbb A}_K \\otimes_K L \\cong {\\mathbb A}_L</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8389em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathbb\">A</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">K</span></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\"><span class=\"mbin\">‚äó</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">K</span></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">‚âÖ</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8389em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathbb\">A</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">L</span></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>, so maybe I should look at the FLT project. Pointers appreciated!</p>",
        "id": 493375310,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736780973
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"406490\">@Mar√≠a In√©s de Frutos Fern√°ndez</span> There is <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ContinuousAlgHom#doc\">docs#ContinuousAlgHom</a> (which, I think, you introduced), but apparently the corrsesponding notion of \"topological algebra equivalence\" is missing. Are there plans to add it?</p>\n<p>This would be very convenient in order to state that the completions of a field <code>F</code> w.r.t. two equivalent absolute values are isomorphic as topological algebras over <code>F </code>.</p>",
        "id": 493444901,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736801101
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/20609\">#20609</a> (this was a coincidence, not a response to this conversation; I needed it for FLT)</p>",
        "id": 493450133,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1736802719
    },
    {
        "content": "<p>I'll have a <span aria-label=\"eyes\" class=\"emoji emoji-1f440\" role=\"img\" title=\"eyes\">:eyes:</span> tomorrow (it is getting late and there is snooker again...).</p>",
        "id": 493454268,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736804112
    },
    {
        "content": "<p>Do we know that <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=UniformSpace.Completion.mapRingHom#doc\">docs#UniformSpace.Completion.mapRingHom</a> is compatible with compositions (i.e., that <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=UniformSpace.Completion#doc\">docs#UniformSpace.Completion</a> is a functor)?</p>",
        "id": 493455093,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1736804416
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479359\">Michael Stoll</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Gelfand-Mazur.20theorem/near/493375310\">said</a>:</p>\n<blockquote>\n<p>Is this available somewhere?</p>\n</blockquote>\n<p>You can find it <a href=\"https://github.com/mariainesdff/LocalClassFieldTheory/blob/22ce0b81b5ce5e75bdbad858dd1472adf1aa5826/LocalClassFieldTheory/FromMathlib/SpectralNormUnique.lean\">here</a>. I am working on PRing this to Mathlib, but it is going a slowly (and I am currently at a conference, so I have not been able to update my open PRs in the last few days).</p>",
        "id": 494088232,
        "sender_full_name": "Mar√≠a In√©s de Frutos Fern√°ndez",
        "timestamp": 1737015710
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"406490\">@Mar√≠a In√©s de Frutos Fern√°ndez</span> I see that you use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MulRingNorm#doc\">docs#MulRingNorm</a>. Did you see <a href=\"#narrow/channel/287929-mathlib4/topic/MulRingNorm.20vs.2E.20AbsoluteValue/near/491324423\">this recent thread</a>? The consensus there was to discourage use of <code>MulRingNorm R</code> in favor of <code>AbsoluteValue R Real</code>, to avoid duplicating stuff.</p>\n<p>In any case, thanks for the pointer!</p>",
        "id": 494130550,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1737029743
    },
    {
        "content": "<p>Yes, I saw that thread, but I have not updated the code yet (I finished this in 2022).</p>",
        "id": 494140912,
        "sender_full_name": "Mar√≠a In√©s de Frutos Fern√°ndez",
        "timestamp": 1737032593
    },
    {
        "content": "<p>After a fairly long pause, I've come back to this. I realized that one of my problems was that the various proofs I was looking at (and the result in Mathlib) were requiring a normed algebra structure over <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">C</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">C</span></span></span></span>. But in my case, I only have an absolute value whose restriction to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">C</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">C</span></span></span></span> is <em>equivalent</em> to the standard one, so the normed algebra structure I would get would be over <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">C</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">C</span></span></span></span> with some power of the standard absolute value. So I looked more closely and found a useful result: if I have two fields <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>F</mi></mrow><annotation encoding=\"application/x-tex\">F</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>F</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">‚Ä≤</mo></msup></mrow><annotation encoding=\"application/x-tex\">F&#x27;</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span> such that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>F</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">‚Ä≤</mo></msup></mrow><annotation encoding=\"application/x-tex\">F&#x27;</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span> is an <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>F</mi></mrow><annotation encoding=\"application/x-tex\">F</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span></span></span></span>-algebra, and I have absolute values <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span> on <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>F</mi></mrow><annotation encoding=\"application/x-tex\">F</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>v</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">‚Ä≤</mo></msup></mrow><annotation encoding=\"application/x-tex\">v&#x27;</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span> on <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>F</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">‚Ä≤</mo></msup></mrow><annotation encoding=\"application/x-tex\">F&#x27;</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span> such that the restriction of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>v</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">‚Ä≤</mo></msup></mrow><annotation encoding=\"application/x-tex\">v&#x27;</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span> to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>F</mi></mrow><annotation encoding=\"application/x-tex\">F</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span></span></span></span> is <em>equivalent</em> to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span>, then there is an equivalent absolute value <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>v</mi><mrow><mo mathvariant=\"normal\">‚Ä≤</mo><mo mathvariant=\"normal\">‚Ä≤</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">v&#x27;&#x27;</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">‚Ä≤‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span> on <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>F</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">‚Ä≤</mo></msup></mrow><annotation encoding=\"application/x-tex\">F&#x27;</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span> whosse restriction to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>F</mi></mrow><annotation encoding=\"application/x-tex\">F</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span></span></span></span> is <em>equal</em> to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span>. I've formalized this and used it to deal with the complex case:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">GelfandMazur</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AbsoluteValue</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">hv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">restrict</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">‚âà</span><span class=\"w\"> </span><span class=\"n\">NormedField</span><span class=\"bp\">.</span><span class=\"n\">toAbsoluteValue</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CompleteSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithAbs</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"bp\">‚àÉ</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"bp\">.</span><span class=\"n\">comap</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">toRingEquiv</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithAbs</span><span class=\"bp\">.</span><span class=\"n\">equiv</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">toRingHom</span><span class=\"w\"> </span><span class=\"bp\">‚âà</span><span class=\"w\"> </span><span class=\"n\">NormedField</span><span class=\"bp\">.</span><span class=\"n\">toAbsoluteValue</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>Now I need to deal with the real case. The argument in the literature is either \"adjoin a square root of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>‚àí</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">‚àí</span><span class=\"mord\">1</span></span></span></span> (if not already present) to get a <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">C</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">C</span></span></span></span>-algebra and thus reduce to the complex case\" or (in one case) a rather complicated computation that looks like a pain to formalize.</p>\n<p>So I would like to use the first approach. I think I'm OK in the case that my field <code>F</code> does contain a square root of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>‚àí</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">‚àí</span><span class=\"mord\">1</span></span></span></span>. So let's assume this is not the case. I basically see two approaches.</p>\n<ol>\n<li><code>F' := AdjoinRoot (X ^ 2 + 1 : Polynomial F)</code></li>\n<li><code>F' := TensorProduct ‚Ñù ‚ÑÇ F</code></li>\n</ol>\n<p>I need to show that <code>F'</code> is a field and that I can give it a structure as normed <code>‚ÑÇ</code>-algebra (that is compatible with the normed <code>‚Ñù</code>-algebra structure I have on <code>F</code>). I know how to get that <code>F'</code> is a field with the first approach (show that <code>X ^ 2 + 1</code> is irreducible), but not with the second approach. And there seem to be no results in Mathlib that give me a <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=NormedAlgebra#doc\">docs#NormedAlgebra</a> structure on either <code>AdjoinRoot _</code> or <code>TensorProduct ‚Ñù ‚ÑÇ F</code>.  The \"obvious\" way in the first approach would be to say \"write <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo>=</mo><msub><mi>x</mi><mn>0</mn></msub><mo>+</mo><msub><mi>x</mi><mn>1</mn></msub><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">x = x_0 + x_1 i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8095em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\">i</span></span></span></span> and define <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">‚à•</mi><mi>x</mi><mi mathvariant=\"normal\">‚à•</mi><mo>=</mo><msqrt><mrow><mi mathvariant=\"normal\">‚à•</mi><msub><mi>x</mi><mn>0</mn></msub><msup><mi mathvariant=\"normal\">‚à•</mi><mn>2</mn></msup><mo>+</mo><mi mathvariant=\"normal\">‚à•</mi><msub><mi>x</mi><mn>1</mn></msub><msup><mi mathvariant=\"normal\">‚à•</mi><mn>2</mn></msup></mrow></msqrt></mrow><annotation encoding=\"application/x-tex\">\\|x\\| = \\sqrt{\\|x_0\\|^2 + \\|x_1\\|^2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">‚à•</span><span class=\"mord mathnormal\">x</span><span class=\"mord\">‚à•</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.24em;vertical-align:-0.305em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.935em;\"><span class=\"svg-align\" style=\"top:-3.2em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"mord\" style=\"padding-left:1em;\"><span class=\"mord\">‚à•</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord\">‚à•</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">‚à•</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord\">‚à•</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-2.895em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"hide-tail\" style=\"min-width:1.02em;height:1.28em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.28em\" viewBox=\"0 0 400000 1296\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M263,681c0.7,0,18,39.7,52,119\nc34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120\nc340,-704.7,510.7,-1060.3,512,-1067\nl0 -0\nc4.7,-7.3,11,-11,19,-11\nH40000v40H1012.3\ns-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232\nc-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1\ns-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26\nc-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z\nM1001 80h400000v40h-400000z\"/></svg></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.305em;\"><span></span></span></span></span></span></span></span></span>\" (where <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> is a root of the polynomial in <code>F'</code>). But then I need to show that this norm is multiplicative and sub-additive etc., for which I think I'll need to know how (addition and) multiplication in <code>F'</code> works in terms of the <code>F</code>-basis <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>i</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(1, i)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">)</span></span></span></span>. I can <em>define</em> a linear equivalence with <code>Fin 2 ‚Üí F</code> as</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">noncomputable</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">xyz</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AdjoinRoot</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Polynomial</span><span class=\"bp\">.</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚Çó</span><span class=\"o\">[</span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">letI</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span><span class=\"bp\">.</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hp‚ÇÄ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">‚â†</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span><span class=\"bp\">.</span><span class=\"n\">Monic</span><span class=\"bp\">.</span><span class=\"n\">ne_zero</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">p</span><span class=\"o\">]</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">monicity!</span>\n<span class=\"w\">  </span><span class=\"n\">letI</span><span class=\"w\"> </span><span class=\"n\">pb</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">AdjoinRoot</span><span class=\"bp\">.</span><span class=\"n\">powerBasis</span><span class=\"w\"> </span><span class=\"n\">hp‚ÇÄ</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hpb</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">pb</span><span class=\"bp\">.</span><span class=\"n\">dim</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">pb</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">compute_degree!</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hpb</span><span class=\"w\"> </span><span class=\"bp\">‚ñ∏</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">AdjoinRoot</span><span class=\"bp\">.</span><span class=\"n\">powerBasis</span><span class=\"w\"> </span><span class=\"n\">hp‚ÇÄ</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">basis</span><span class=\"bp\">.</span><span class=\"n\">repr</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">trans</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Finsupp</span><span class=\"bp\">.</span><span class=\"n\">linearEquivFunOnFinite</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>but I'm failing miserably at</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">xyz_mul</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AdjoinRoot</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Polynomial</span><span class=\"bp\">.</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">xyz</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"o\">[</span><span class=\"n\">xyz</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">xyz</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">xyz</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">xyz</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span>\n<span class=\"w\">                    </span><span class=\"n\">xyz</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">xyz</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">xyz</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">xyz</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>Is there any kind of API that helps with explicit computations in <code>AdjoinRoot</code>?<br>\nOr is there some reasonable way to get it done via tensor products?</p>",
        "id": 524085415,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1749931719
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"238446\">@Anne Baanen</span> <span class=\"user-mention\" data-user-id=\"534091\">@Alain Chavarri Villarello</span> can't some of your methods/tactics help with computations in a basis of an algebra? Is that available in mathlib?</p>",
        "id": 524225568,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1750070086
    },
    {
        "content": "<p>I should say that I've switched to plan C now, which is coming up with a variant of the proof given by Peter Scholze on MathOverflow that Johan linked to earlier that works over the reals, and formalizing that. This looks lilke it's more fun <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span>, but I may run into other problems instead -- watch this place!</p>\n<p>This being said, it would still be nice to have a convenient way of doing computations in rings obtained by <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AdjoinRoot#doc\">docs#AdjoinRoot</a> .</p>",
        "id": 524267608,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1750083425
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"479359\">@Michael Stoll</span> Didn't that one also assume complexes as base field?</p>",
        "id": 524267927,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1750083526
    },
    {
        "content": "<p>I'm saying \"a variant that works over the reals\" <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 524268032,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1750083558
    },
    {
        "content": "<p>/me should learn to read</p>",
        "id": 524268270,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1750083632
    },
    {
        "content": "<p>Most of the fun was actually coming up with this variant (though I don't know if it's really new).</p>",
        "id": 524268401,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1750083673
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Gelfand-Mazur.20theorem/near/524225568\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"238446\">Anne Baanen</span> <span class=\"user-mention silent\" data-user-id=\"534091\">Alain Chavarri Villarello</span> can't some of your methods/tactics help with computations in a basis of an algebra? Is that available in mathlib?</p>\n</blockquote>\n<p>We had <a href=\"https://github.com/lean-forward/class-group-and-mordell-equation/blob/main/src/number_theory/quad_ring/basic.lean\"><code>quad_ring</code></a> in Lean 3, a two-field structure which generalizes <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Zsqrtd#doc\">docs#Zsqrtd</a> and can compute by <code>simp; ring</code> or <code>decide</code>. This never ended up being ported to Mathlib or Lean 4. We also have some representations of polynomials and algebra elements by lists in Lean 4: <a href=\"https://github.com/alainchmt/RingOfIntegersProject/blob/main/DedekindProject4/CertifyAdjoinRoot.lean#L376\">https://github.com/alainchmt/RingOfIntegersProject/blob/main/DedekindProject4/CertifyAdjoinRoot.lean#L376</a></p>",
        "id": 524491175,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1750178142
    },
    {
        "content": "<p>The desire to have an implementation of quadratic rings (in the correct generality) seems to be a recurring theme. Somebody just has to do it ...</p>",
        "id": 524502488,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1750182881
    },
    {
        "content": "<p><a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Z.5B.281.2Bsqrt.281.2B4k.29.29.2F2.5D\">#Is there code for X? &gt; Z&#91;(1+sqrt(1+4k))/2&#93;</a></p>",
        "id": 524502609,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1750182931
    },
    {
        "content": "<p>After some more tinkering, I now have a complete formalization of the variant of Gelfand-Mazur I wanted:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">GelfandMazur</span><span class=\"bp\">.</span><span class=\"n\">nonempty_algEquiv_or</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedField</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAlgebra</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚Çê</span><span class=\"o\">[</span><span class=\"n\">‚Ñù</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚à®</span><span class=\"w\"> </span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚Çê</span><span class=\"o\">[</span><span class=\"n\">‚Ñù</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n</code></pre></div>\n<p>See <a href=\"https://github.com/MichaelStollBayreuth/Heights/blob/master/Heights/GelfandMazur.lean\">GelfandMazur.lean</a> in my <a href=\"https://github.com/MichaelStollBayreuth/Heights\">Heights</a> repo.</p>\n<p>Since I found it very convenient, I'm introducing a predicate <code>Polynomial.IsMonicOfDegree p n</code> that states that <code>p</code> is a monic polynomial of degree <code>n</code>, together with some API (in a separate file <a href=\"https://github.com/MichaelStollBayreuth/Heights/blob/master/Heights/IsMonicOfDegree.lean\">IsMonicOfDegree.lean</a>). Modulo that and some further auxiliary lemmas, the proof of Gelfand-Mazur needs about 300 lines. For a comparison, I have also formalized the complex version; this is about 100 lines (in the same file).</p>\n<p>Unless there are objections, I'm planning to first PR the material on <code>IsMonicOfDegree</code> and then the real version of G-M. (A stronger form of the complex version is already there, so this part was just for fun.)</p>",
        "id": 525404185,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1750711003
    },
    {
        "content": "<p>I've found a considerable simplification of my proof that reduces the formalization (modulo API) from ~300 to ~200 lines. There's always more to learn...</p>",
        "id": 525967528,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1750965579
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479359\">Michael Stoll</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Gelfand-Mazur.20theorem/near/524502488\">said</a>:</p>\n<blockquote>\n<p>The desire to have an implementation of quadratic rings (in the correct generality) seems to be a recurring theme. Somebody just has to do it ...</p>\n</blockquote>\n<p>I proposed something for the Lean 2025 conference at the Simons Foundation. Maybe I should go on. For the moment, it just defines quadratic algebras mimicking the first half of the file defining <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ZSqrtd#doc\">docs#ZSqrtd</a></p>",
        "id": 526064090,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1751023798
    },
    {
        "content": "<p>After some more streamlining, I'm now quite satisfied.<br>\n<a href=\"https://github.com/leanprover-community/mathlib4/pull/26507\">#26507</a> is a first PR; it adds <code>IsMonicOfDegree</code> and API for it.</p>",
        "id": 526262793,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1751195509
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> Assuming <a href=\"https://github.com/leanprover-community/mathlib4/pull/26507\">#26507</a> gets merged eventually, would it be possible to extend the <code>monicity</code> tactic to work on goals of the form <code>IsMonicOfDegree _ _</code> without too much effort?</p>",
        "id": 526268507,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1751202129
    },
    {
        "content": "<p>That would be really easy.  Is there a lemma saying that <code>IsMonivODegree</code> follows from <code>natDegree = ...</code> and <code>Monic ...</code>?  Once that is in, the tactic should simply be told that when the goal is <code>IsMonicOfDegree</code>, then it should apply this lemma and then <code>compute_degree</code> and <code>monicity</code> on the two branches.</p>",
        "id": 526280760,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1751215162
    },
    {
        "content": "<p>There is</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">isMonicOfDegree_iff</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nontrivial</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">IsMonicOfDegree</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚Üî</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">natDegree</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚àß</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">coeff</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n</code></pre></div>\n<p>and the definition:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- This says that `p` has `natDegree` `n` and is monic. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">IsMonicOfDegree</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">natDegree</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚àß</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">Monic</span>\n</code></pre></div>\n<p>Depending on what would be most convenient for the tactic, I can also add another characterization.</p>",
        "id": 526284749,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1751219729
    },
    {
        "content": "<p>I had in mind the version below, but it can go in the in-tactic lemmas, since it is mostly to get the right goals, from the right shape.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">IsMonicOfDegree</span><span class=\"bp\">.</span><span class=\"n\">of_natDegree_of_monic</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">natDegree</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">Monic</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">IsMonicOfDegree</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 526371911,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1751280490
    },
    {
        "content": "<p>So, basically, once <code>IsMonicOfDegree</code> is in Mathlib, I would add the lemma above to the <code>ComputeDegree</code> tactic and the very small addition that will make the tactic aware of <code>IsMonicOfDegree</code>.</p>",
        "id": 526372097,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1751280549
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> I realized that in order for this to work, I cannot import <code>compute_degree</code> and friends in the new file. So I'm making a PR that removes the import (and replaces the use of <code>compute_degree</code> with more pedestrian proofs): <a href=\"https://github.com/leanprover-community/mathlib4/pull/26759\">#26759</a> (and I have requested your review; I hope this is OK).</p>",
        "id": 527214200,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1751648731
    },
    {
        "content": "<p>How about moving just the definition of <code>IsMonicOfDegree</code> to an earlier file and keeping the new file with the lemmas?</p>",
        "id": 527214784,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1751649082
    },
    {
        "content": "<p>In any case, the tactic does not need to import <code>IsMonicOfDegree</code> to be able to discriminate based on it, although it would make sense if it did.</p>",
        "id": 527214788,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1751649083
    },
    {
        "content": "<p>Spelling out the proofs is not so bad, actually.</p>",
        "id": 527214924,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1751649164
    },
    {
        "content": "<p>Ok, I may not make the tactic import that file either, just to avoid adding unnecessary imports to the <code>compute_degree</code> tactic (and I prefer to have all these tactics in the same file, for simplicity).</p>",
        "id": 527215181,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1751649279
    },
    {
        "content": "<p>Given how this is evolving, I am wondering if <code>compute_degree</code> and <code>monicity</code> should be merged into a single tactic, since the internal logic is essentially the same.</p>",
        "id": 527221349,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1751653445
    },
    {
        "content": "<p>That sounds like a good idea. The question is, what should this single tactic be called? <span aria-label=\"smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 527222068,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1751653949
    },
    {
        "content": "<p>Yes, I also think that right now that is the hardest step in the process.</p>",
        "id": 527222286,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1751654155
    },
    {
        "content": "<p>just merge them and have <code>compute_degree_monotonicity</code></p>",
        "id": 527222363,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751654222
    },
    {
        "content": "<p><code>poly_prop</code>?</p>",
        "id": 527222401,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1751654250
    },
    {
        "content": "<p><code>aesopoly</code>?  <span aria-label=\"lol\" class=\"emoji emoji-1f606\" role=\"img\" title=\"lol\">:lol:</span></p>",
        "id": 527222428,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1751654276
    },
    {
        "content": "<p>Maybe <code>poly_simp</code> or <code>simp_poly</code> could work?</p>",
        "id": 527222453,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1751654317
    },
    {
        "content": "<p>(Although the tactic is nothing like <code>simp</code> internally.)</p>",
        "id": 527222463,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1751654333
    },
    {
        "content": "<p>Just <code>poly</code></p>",
        "id": 527222545,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1751654400
    },
    {
        "content": "<p>What about making them simprocs? Then no new tactic needed</p>",
        "id": 527223142,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1751654894
    },
    {
        "content": "<p>I am not familiar enough with simprocs to know if they replace <code>compute_degree</code>.</p>",
        "id": 527223179,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1751654939
    },
    {
        "content": "<p>How would a simproc know to compute the degree of <code>X + 1</code>?</p>",
        "id": 527223207,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1751654959
    },
    {
        "content": "<p>(Right now, <code>compute_degree</code> reduces this to computing the <code>max</code> of the degree of <code>X</code> and of <code>1</code> and similarly for all ring operations.)</p>",
        "id": 527223306,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1751655047
    },
    {
        "content": "<p>I imagine it would rewrite <code>degree (X + 1)</code> into <code>max (degree X) (degree 1)</code></p>",
        "id": 527223451,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751655164
    },
    {
        "content": "<p>You can plug any metaprogram into a simproc, so long as the metaprogram produces an equality of terms</p>",
        "id": 527223525,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1751655234
    },
    {
        "content": "<p>oh I guess that works too</p>",
        "id": 527223574,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751655275
    },
    {
        "content": "<p>it feels like everything is turning into a simproc</p>",
        "id": 527223591,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751655293
    },
    {
        "content": "<p>I personally believe that everything* that rewrites should be turned into a simproc</p>\n<p>*unless it loops or has a very generic LHS</p>",
        "id": 527223646,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1751655352
    },
    {
        "content": "<p>Coming back to the orignal topic: I have made <a href=\"https://github.com/leanprover-community/mathlib4/pull/26766\">#26766</a>, which adds some convenience lemmas related to bounded sets.</p>",
        "id": 527224495,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1751656040
    },
    {
        "content": "<p>Two more small PRs with convenience lemmas:</p>\n<ul>\n<li><a href=\"https://github.com/leanprover-community/mathlib4/pull/29214\">#29214</a> adds two lemmas on <code>(x ¬± r ‚Ä¢ 1)^2</code></li>\n</ul>",
        "id": 537242169,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1756804350
    },
    {
        "content": "<ul>\n<li><a href=\"https://github.com/leanprover-community/mathlib4/pull/29218\">#29218</a> adds one lemma on <code>‚Äñx ‚Ä¢ 1‚Äñ</code>.</li>\n</ul>",
        "id": 537242252,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1756804377
    },
    {
        "content": "<p>Coming back to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsMonicOfDegree#doc\">docs#IsMonicOfDegree</a> :<br>\nI would like to add two results (on factorization of monic polynomials over algebraically closed fields and over the reals), which need heavier imports, so they shouldn't go into the current file <code>Mathlib.Algebra.Polynomial.Degree.IsMonicOfDegree</code>. So a new file seems to be required. Should this be something like <code>Mathlib.Algebra.Polynomial.Degree.IsMonicOfDegreeFactorization</code>, or is it better to add a subdirectory <code>Mathlib.Algebra.Polynomial.Degree.IsMonicOfDegree</code>, move the original file to <code>...Basic</code> and have another file <code>...Factorization</code> in there?</p>",
        "id": 537286568,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1756819557
    },
    {
        "content": "<p>In any case, I get the warning</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>warning: Mathlib/Algebra/Polynomial/Degree/IsMonicOfDegreeFactorization.lean:9:0:\n   Modules starting with Mathlib.Algebra are not allowed to import modules starting with Mathlib.Geometry.\n   This module depends on Mathlib.Geometry.Convex.Cone.Basic\nwhich is imported by Mathlib.Analysis.Convex.Cone.Extension,\nwhich is imported by Mathlib.Analysis.NormedSpace.HahnBanach.Extension,\nwhich is imported by Mathlib.Analysis.Normed.Module.Dual,\nwhich is imported by Mathlib.MeasureTheory.Integral.IntervalIntegral.FundThmCalculus,\nwhich is imported by Mathlib.Analysis.SpecialFunctions.NonIntegrable,\nwhich is imported by Mathlib.MeasureTheory.Integral.CircleIntegral,\nwhich is imported by Mathlib.Analysis.Complex.CauchyIntegral,\nwhich is imported by Mathlib.Analysis.Complex.Liouville,\nwhich is imported by Mathlib.Analysis.Complex.Polynomial.Basic,\nwhich is imported by this module. (Exceptions can be added to `overrideAllowedImportDirs`.)\n</code></pre></div>\n<p>Should I add an exception? Or should the material go under <code>Analysis</code> somewhere?</p>",
        "id": 537291227,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1756820906
    },
    {
        "content": "<p>FWIW, I added the line </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">directoryDependency</span><span class=\"w\"> </span><span class=\"n\">false</span>\n</code></pre></div>\n<p>suggested by the warning message to the file, but it <em>still</em> produces the same warning.<br>\nSo how can I silence the linter without modifying the exceptions file?</p>",
        "id": 537292802,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1756821419
    },
    {
        "content": "<p>For the time being, I have moved the file to <code>Analysis.Polynomial.Factorization</code>. See <a href=\"https://github.com/leanprover-community/mathlib4/pull/29249\">#29249</a> .</p>\n<p>The first result is purely algebraic (but needs algebraically closed fields), whereas the second one needs the fact that irreducible polynomials over the reals have degree at most two, which comes down to the fact that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">C</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">C</span></span></span></span> is algebraically closed and thus uses analysis.</p>",
        "id": 537299217,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1756823310
    },
    {
        "content": "<p>Does the silencing work if you write</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">style</span><span class=\"bp\">.</span><span class=\"n\">header</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">directoryDependency</span><span class=\"w\"> </span><span class=\"n\">false</span>\n</code></pre></div>\n<p>between the last import and the first module doc?</p>",
        "id": 537338738,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1756835897
    },
    {
        "content": "<p>I wonder if the directoryDependency linter should adopt some mechanism to only emit its warning on the first non-module-doc command, unless that command is <code>set_option linter.directoryDependency false</code>.</p>",
        "id": 537338979,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1756835987
    },
    {
        "content": "<p>I had it after the module docstring. I didn't try to move it to right after the imports (before them would not work, I think, because of some other linter).</p>\n<p>If a consensus emerges to move the file back into Algebra, I can try your suggestion.</p>",
        "id": 537339712,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1756836271
    },
    {
        "content": "<p>Before the imports would not work, since there cannot be an <code>import</code> command after a non-<code>import</code> command.</p>",
        "id": 537339889,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1756836345
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/29649\">#29649</a> now adds my versions of Gelfand-Mazur (~250 LOC plus docstrings). Reviews welcome!</p>",
        "id": 539436433,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1757880840
    }
]