[
    {
        "content": "<p>The following doesn't work as I expected</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FaithfulSMul</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Polynomial</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">RatFunc</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstance</span><span class=\"w\"> </span><span class=\"c1\">-- error</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FaithfulSMul</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Polynomial</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">RatFunc</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">RatFunc</span><span class=\"bp\">.</span><span class=\"n\">faithfulSMul</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"c1\">-- error</span>\n</code></pre></div>\n<p>Is this not right mathematically, or something else is happening?</p>",
        "id": 546950278,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1761327793
    },
    {
        "content": "<p>why does the statement of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=RatFunc.faithfulSMul#doc\">docs#RatFunc.faithfulSMul</a> work</p>",
        "id": 546950911,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761328060
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span><span class=\"bp\">.</span><span class=\"n\">algebra</span>\n</code></pre></div>\n<p>and </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/--</span>\n<span class=\"sd\">error: Tactic `rfl` failed: The left-hand side</span>\n<span class=\"sd\">  Polynomial.algebra R R</span>\n<span class=\"sd\">is not definitionally equal to the right-hand side</span>\n<span class=\"sd\">  Algebra.id (Polynomial R)</span>\n\n<span class=\"sd\">K : Type u_1</span>\n<span class=\"sd\">inst✝¹ : Field K</span>\n<span class=\"sd\">R : Type u_2</span>\n<span class=\"sd\">inst✝ : CommSemiring R</span>\n<span class=\"sd\">⊢ Polynomial.algebra R R = Algebra.id (Polynomial R)</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">error</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommSemiring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span><span class=\"bp\">.</span><span class=\"n\">algebra</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">id</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">Polynomial</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">with_unfolding_all</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>",
        "id": 546955116,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1761329727
    },
    {
        "content": "<p>Is it because there are two possibly different instances of <code>[Field K]</code> in the statement of <code>RatFunc.faithfulSMul K K</code>?</p>",
        "id": 546958156,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1761330975
    },
    {
        "content": "<p>it's because there are two different instances of <code>Algebra (Polynomial R) (Polynomial R)</code></p>",
        "id": 546964669,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761333744
    },
    {
        "content": "<p>Note that this is explained in the doc of <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/RingTheory/PolynomialAlgebra.html#Polynomial.algebra\">Polynomial.algebra</a>.</p>",
        "id": 546990792,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1761335652
    },
    {
        "content": "<p>So what should I do?<br>\nThe real lemma I want is just <code>(algebraMap K[X] (RatFunc K)) q ≠ 0 -&gt; q ≠ 0</code>, in case there is an easy way</p>",
        "id": 546997589,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1761338841
    },
    {
        "content": "<p>are there two instances of SMul K[X] K(X) as well?</p>",
        "id": 546997863,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761338973
    },
    {
        "content": "<p>if there's only one then what you should do is just state the faithfulsmul instance</p>",
        "id": 546997890,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761338990
    },
    {
        "content": "<p>you only get the diamond if you opt-in to it</p>",
        "id": 546997947,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761339022
    },
    {
        "content": "<p>and it does give you two instances of <code>SMul K[X] K(X)</code> as well</p>",
        "id": 546997987,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761339042
    },
    {
        "content": "<p>and if we dont opt in?</p>",
        "id": 546998014,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761339064
    },
    {
        "content": "<p>then you get one instance of <code>SMul K[X] K(X)</code></p>",
        "id": 546998041,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761339080
    },
    {
        "content": "<p>then the problem is solved</p>",
        "id": 546998071,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761339096
    },
    {
        "content": "<p>Sorry I don't follow. I haven't opt-in anything. The code on the top doesn't work on its own</p>",
        "id": 546998129,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1761339122
    },
    {
        "content": "<p>that's because there's no instance</p>",
        "id": 546998165,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761339136
    },
    {
        "content": "<p>sure, you won't use a standard lemma, just prove it yourself</p>",
        "id": 546998173,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761339141
    },
    {
        "content": "<p>no one wrote the instance for this</p>",
        "id": 546998184,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761339146
    },
    {
        "content": "<p>alright, thanks for confirming at least this looks correct in math</p>",
        "id": 546998328,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1761339228
    },
    {
        "content": "<p>you can probably conclude it from <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=RatFunc.faithfulSMul#doc\">docs#RatFunc.faithfulSMul</a></p>",
        "id": 546998592,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761339380
    },
    {
        "content": "<p>That's literally the problematic code on the top</p>",
        "id": 546998643,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1761339411
    },
    {
        "content": "<p>yeah it's not directly</p>",
        "id": 546998826,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761339521
    },
    {
        "content": "<p>you need some lemma</p>",
        "id": 546998833,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761339525
    },
    {
        "content": "<p>like this</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span>\n\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FaithfulSMul</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Polynomial</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">RatFunc</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span><span class=\"bp\">.</span><span class=\"n\">algebra</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Polynomial</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">algebra_ext</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">RatFunc</span><span class=\"bp\">.</span><span class=\"n\">faithfulSMul</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">K</span>\n</code></pre></div>",
        "id": 546999213,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761339692
    },
    {
        "content": "<p>Oh, I get it! Basically I need to \"fix\" that wrong Algebra instance</p>",
        "id": 546999310,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1761339739
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 546999328,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1761339748
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60FaithfulSMul.20.28Polynomial.20K.29.20.28RatFunc.20K.29.60.20doesn't.20work/near/546999213\">said</a>:</p>\n<blockquote>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span><span class=\"bp\">.</span><span class=\"n\">algebra</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Polynomial</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">algebra_ext</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>we probably should have this part separately</p>",
        "id": 546999336,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761339752
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130384\">Riccardo Brasca</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60FaithfulSMul.20.28Polynomial.20K.29.20.28RatFunc.20K.29.60.20doesn't.20work/near/546990792\">said</a>:</p>\n<blockquote>\n<p>Note that this is explained in the doc of <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/RingTheory/PolynomialAlgebra.html#Polynomial.algebra\">Polynomial.algebra</a>.</p>\n</blockquote>\n<p>Not very well; the docs there are describing a diamond that doesn't commute at all. This thread is about one that doesn't commute definitionally, which we should also warn about.</p>",
        "id": 547011273,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1761348595
    }
]