[
    {
        "content": "<p>Hi everyone!</p>\n<p>We've been working on formalizing two theorems from classical complex<br>\nanalysis:</p>\n<ul>\n<li>The Poisson integral formula for harmonic functions on the unit disc.</li>\n<li>Building on that, we derive the Herglotz-Riesz representation theorem for positive harmonic functions on the unit disc. The proof uses complex analysis and measure theory (Riesz-Markov-Kakutani representation).</li>\n</ul>\n<p>Proposed location: Mathlib/Analysis/Complex/Harmonic/</p>\n<p>Github repo: <a href=\"https://github.com/seb488/LeanComplexAnalysis\">https://github.com/seb488/LeanComplexAnalysis</a></p>\n<p>We have tried to follow mathlib conventions, but we'd appreciate<br>\nfeedback on whether the file organization makes sense before opening a<br>\nPR.</p>\n<p>Is this the kind of contribution that would be welcome in mathlib? Any<br>\nadvice on next steps would be greatly appreciated!</p>\n<p>Thanks! <span aria-label=\"folded hands\" class=\"emoji emoji-1f64f\" role=\"img\" title=\"folded hands\">:folded_hands:</span></p>",
        "id": 569515264,
        "sender_full_name": "seb488",
        "timestamp": 1769094583
    },
    {
        "content": "<p>These topics would definitely be great additions to Mathlib! Could you tell us a little bit how you've proceeded, and in particular which LLMs you've used if any? They're often very handy to get working code, but require a little bit more of cleanup afterwards.</p>",
        "id": 569557165,
        "sender_full_name": "SÃ©bastien GouÃ«zel",
        "timestamp": 1769104988
    },
    {
        "content": "<p>You would have to make it complete and remove axioms like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c\">/-</span><span class=\"cm\"> # Assumption -/</span>\n\n<span class=\"c\">/-</span>\n<span class=\"cm\">The property that for any function g in class Î£ with expansion g(z) = z + h(1/z)</span>\n<span class=\"cm\">we have |h'(0)| &lt;= 1 is treated as an axiom. (A consequence of GrÃ¶nwall's area theorem.)</span>\n<span class=\"cm\">-/</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">SigmaCoeffBound</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"bp\">âˆ€</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„‚</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">â„‚</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">classSigma</span><span class=\"w\"> </span><span class=\"bp\">â†’</span>\n<span class=\"w\">  </span><span class=\"bp\">âˆ€</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„‚</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">â„‚</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">AnalyticOn</span><span class=\"w\"> </span><span class=\"n\">â„‚</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ball</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â†’</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"bp\">âˆ€</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"bp\">â€–</span><span class=\"n\">z</span><span class=\"bp\">â€–</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"bp\">â€–</span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"bp\">â€–</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n</code></pre></div>\n<p>In<br>\nComplexAnalysis/UnivalentFunctions/BieberbachSecondCoeff.lean</p>",
        "id": 569626654,
        "sender_full_name": "Yan Yablonovskiy ðŸ‡ºðŸ‡¦",
        "timestamp": 1769136974
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"773147\">Yan Yablonovskiy ðŸ‡ºðŸ‡¦</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Possible.20PR.3A.20Poisson.20integral.20and.20Herglotz.20representation/near/569626654\">schrieb</a>:</p>\n<blockquote>\n<p>You would have to make it complete and remove axioms like</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c\">/-</span><span class=\"cm\"> # Assumption -/</span>\n\n<span class=\"c\">/-</span>\n<span class=\"cm\">The property that for any function g in class Î£ with expansion g(z) = z + h(1/z)</span>\n<span class=\"cm\">we have |h'(0)| &lt;= 1 is treated as an axiom. (A consequence of GrÃ¶nwall's area theorem.)</span>\n<span class=\"cm\">-/</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">SigmaCoeffBound</span><span class=\"w\"> </span><span class=\"o\">:</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p><span aria-label=\"thank you\" class=\"emoji emoji-1f64f\" role=\"img\" title=\"thank you\">:thank_you:</span> True. We are working on that one, but it might take many (?) other formalizations. (In particular, Green's theorem, which relates a line integral around a simple closed curve to a double integral over the plane region.) For mathlib, for the time being, we were only thinking about the more fundamental Poisson integral and Herglotz-Riesz integral.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"110050\">SÃ©bastien GouÃ«zel</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Possible.20PR.3A.20Poisson.20integral.20and.20Herglotz.20representation/near/569557165\">schrieb</a>:</p>\n<blockquote>\n<p>These topics would definitely be great additions to Mathlib! Could you tell us a little bit how you've proceeded, and in particular which LLMs you've used if any? They're often very handy to get working code, but require a little bit more of cleanup afterwards.</p>\n</blockquote>\n<p><span aria-label=\"thank you\" class=\"emoji emoji-1f64f\" role=\"img\" title=\"thank you\">:thank_you:</span><br>\n<strong>Help from AI:</strong><br>\nPoisson integral formula: We primarily used Claude.<br>\nHerglotz-Riesz representation theorem: We split the proof into smaller steps, following a proof described in Section 3 of Garnett's \"Bounded Analytic Functions\". We used Aristotle to prove several of these steps, which we then simplified and refactored with assistance from Claude and ChatGPT.</p>\n<p>Do you directly spot any necessary cleanup we should address?</p>",
        "id": 569700227,
        "sender_full_name": "seb488",
        "timestamp": 1769170366
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"1018575\">seb488</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Possible.20PR.3A.20Poisson.20integral.20and.20Herglotz.20representation/near/569700227\">said</a>:</p>\n<blockquote>\n<p>Do you directly spot any necessary cleanup we should address?</p>\n</blockquote>\n<p>Unfortunately, yes. LLM code quality is for now very far from the code quality we expect in Mathlib: the proofs are often way too long because the goal of the LLM is just to get there, not get there in the elegant and natural way. Also, the statements are often not in the right generality: looking at the first lemma <code>cauchy_integral_formula_unitDisc</code>, it is written for functions taking values in <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">C</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{C}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">C</span></span></span></span> while it should be written for functions in any complex normed space. <code>Real.pi</code> should be written <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Ï€</mi></mrow><annotation encoding=\"application/x-tex\">\\pi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">Ï€</span></span></span></span> (opening the <code>Real</code> scope), notations should be used for neighborhoods, the proof starts with <code>norm_num at *</code> which is just crazy, and so on.</p>\n<p>I am sorry if I sound a little bit negative. LLMs are great to get hints at ways to get a working proof, and to find the relevant lemmas in the library, but in the current state of things it is much much more efficient to write proofs by hand to get good quality code.</p>",
        "id": 569703507,
        "sender_full_name": "SÃ©bastien GouÃ«zel",
        "timestamp": 1769171480
    },
    {
        "content": "<p>We will look into what changes can be made in these directions. </p>\n<p>Thanks for your quick response!</p>",
        "id": 569714990,
        "sender_full_name": "seb488",
        "timestamp": 1769174998
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110050\">SÃ©bastien GouÃ«zel</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Possible.20PR.3A.20Poisson.20integral.20and.20Herglotz.20representation/near/569703507\">schrieb</a>:</p>\n<blockquote>\n<p>Also, the statements are often not in the right generality: looking at the first lemma <code>cauchy_integral_formula_unitDisc</code>, it is written for functions taking values in <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">C</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{C}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">C</span></span></span></span> while it should be written for functions in any complex normed space. <code>Real.pi</code> should be written <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Ï€</mi></mrow><annotation encoding=\"application/x-tex\">\\pi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">Ï€</span></span></span></span> (opening the <code>Real</code> scope), notations should be used for neighborhoods, the proof starts with <code>norm_num at *</code> which is just crazy, and so on.</p>\n</blockquote>\n<p>We have updated the file <a href=\"https://github.com/seb488/LeanComplexAnalysis/blob/main/ComplexAnalysis/Harmonic/PoissonIntegral.lean\">https://github.com/seb488/LeanComplexAnalysis/blob/main/ComplexAnalysis/Harmonic/PoissonIntegral.lean</a>:</p>\n<ul>\n<li>The lemmas/theorems are stated for functions taking values in <code>{E : Type*} [NormedAddCommGroup E] [NormedSpace â„‚ E]</code> (with Â <code>[CompleteSpace E]</code> if necessary). Only at the end, when using <code>harmonic_is_realOfHolomorphic</code>, we consider functions with values in <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">C</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{C}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">C</span></span></span></span> or <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">R</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{R}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">R</span></span></span></span>.</li>\n<li>We have tried to get rid of all \"overkill tactics\". [By using <code>#count_heartbeats in</code> with <code>set_option Elab.async false</code>, we get that each proof takes approx. 10,000 heartbeats.]</li>\n</ul>\n<p>Are these the right steps towards a cleanup? Any further comments are welcome.</p>",
        "id": 570307139,
        "sender_full_name": "seb488",
        "timestamp": 1769516917
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"1018575\">seb488</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Possible.20PR.3A.20Poisson.20integral.20and.20Herglotz.20representation/near/570307139\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p><code>Real.pi</code> should be written Ï€ (opening the <code>Real</code> scope), notations should be used for neighborhoods</p>\n</blockquote>\n</blockquote>\n<p>These are things that could be linted for, right? We really need to be turning everything lintable into linters.</p>",
        "id": 570437390,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1769554050
    },
    {
        "content": "<p>Writing an extensible 'use notation' linter shouldn't be that hard, right? I might give it a try if nobody else is working on it</p>",
        "id": 570438175,
        "sender_full_name": "Moritz Doll",
        "timestamp": 1769554524
    },
    {
        "content": "<p>I wonder if we should just tell people with partly AI-written proofs that they have to make sure no lemma is longer than 10 lines...</p>\n<p>Obviously 10 lines is overkill, but it is cheap advice and otherwise painful to explain the importance of extracting lemmas.</p>",
        "id": 570439276,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1769555075
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Possible.20PR.3A.20Poisson.20integral.20and.20Herglotz.20representation/near/570439276\">schrieb</a>:</p>\n<blockquote>\n<p>I wonder if we should just tell people with partly AI-written proofs that they have to make sure no lemma is longer than 10 lines...</p>\n<p>Obviously 10 lines is overkill, but it is cheap advice and otherwise painful to explain the importance of extracting lemmas.</p>\n</blockquote>\n<p><span aria-label=\"thank you\" class=\"emoji emoji-1f64f\" role=\"img\" title=\"thank you\">:thank_you:</span> We have split the proofs into several smaller lemmas (<a href=\"https://github.com/seb488/LeanComplexAnalysis/blob/main/ComplexAnalysis/Harmonic/PoissonIntegral.lean\">https://github.com/seb488/LeanComplexAnalysis/blob/main/ComplexAnalysis/Harmonic/PoissonIntegral.lean</a>).  </p>\n<p>Is this purely a software engineering best practice (modularity, reviewability), or are there performance or technical reasons intrinsic to Lean's design that make smaller proofs better?</p>",
        "id": 570888260,
        "sender_full_name": "seb488",
        "timestamp": 1769718152
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"1018575\">seb488</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Possible.20PR.3A.20Poisson.20integral.20and.20Herglotz.20representation/near/570888260\">said</a>:</p>\n<blockquote>\n<p>a software engineering best practice (modularity, reviewability)</p>\n</blockquote>\n<p><span aria-label=\"point up\" class=\"emoji emoji-1f446\" role=\"img\" title=\"point up\">:point_up:</span></p>",
        "id": 570924673,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1769736433
    },
    {
        "content": "<p>There's a recent PR with 500 line proofs... <em>shudders</em></p>",
        "id": 571042681,
        "sender_full_name": "Violeta HernÃ¡ndez",
        "timestamp": 1769783166
    },
    {
        "content": "<p>Please review asking them to break out more lemmas! :-)</p>",
        "id": 571064551,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1769788317
    },
    {
        "content": "<p>I did, if Violeta was thinking of the same one</p>",
        "id": 571088004,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1769794606
    }
]