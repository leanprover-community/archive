[
    {
        "content": "<p>In proving that the product of a continuous function by a positive constant is continuous, in an experimental real number game, my summer project student <span class=\"user-mention\" data-user-id=\"931898\">@Ronit Sachdeva</span> is faced with this goal:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">ε</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hε</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">ε</span><span class=\"o\">)</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">ε</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">ε</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>We do not really want to have to teach the users this sort of nonsense:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">mul_sub</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">abs_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">abs_of_pos</span><span class=\"w\"> </span><span class=\"n\">hc</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">rwa</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">lt_div_iff₀</span><span class=\"w\"> </span><span class=\"n\">hc</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_comm</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>\n<p>because this involves teaching five \"completely obvious to a schoolchild\" and thus completely unnecessary lemmas just to finish the job. Is there a tactic which can take it from here because we'd far rather teach that tactic! </p>\n<p>This question stems from the philosophy that Heather taught me -- that we should really be pushing to teach tactics in this sort of environment, rather than explicit lemmas (of which there are a gazillion and they're hard to remember and look up within the game framework).</p>",
        "id": 532690506,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1754301083
    },
    {
        "content": "<p>In fact here's an even easier one:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"bp\">|-</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">|</span>\n</code></pre></div>\n<p>Do we have a tactic that can deal with this? If not, I'm wondering if we should make a bespoke tactic for the game which will just pwn these goals.</p>",
        "id": 532691651,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1754301419
    },
    {
        "content": "<p>One tactic I don't know, but <code>congr; ring</code> should work.</p>",
        "id": 532692370,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1754301603
    },
    {
        "content": "<p>I am not sure which goal you're talking about but if it's the second one then <code>congr</code> leads to a false goal because <code>abs_sub_comm</code> has not yet been applied.</p>",
        "id": 532695338,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1754302648
    },
    {
        "content": "<p>Is this the sort of goal which a hammer would demolish?</p>",
        "id": 532695765,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1754302855
    },
    {
        "content": "<p>Yes I was talking about the second. Probably <code>congr 1; ring</code> would work then.</p>",
        "id": 532696066,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1754302983
    },
    {
        "content": "<p>You have to use <code>abs_sub_comm</code> before this is a goal which <code>ring</code> can solve and neither of the tactics you're suggesting will run this</p>",
        "id": 532696198,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1754303034
    },
    {
        "content": "<p>Oh you're right <span aria-label=\"man facepalming\" class=\"emoji emoji-1f926-200d-2642\" role=\"img\" title=\"man facepalming\">:man_facepalming:</span> sorry for the noise</p>",
        "id": 532696637,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1754303194
    },
    {
        "content": "<p>Rather annoyingly, the Lean game framework is on Lean v4.21.0 but LeanHammer is on v4.20.0 and I don't know how to make them both work at the same time. I don't know if a hammer is a viable solution for a lean game either (I have no clue how long it takes to run <code>hammer</code>)</p>",
        "id": 532696986,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1754303309
    },
    {
        "content": "<p>Would be cool if <code>field_simp [hc] at h</code> worked</p>",
        "id": 532703065,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1754305384
    },
    {
        "content": "<p>And then maybe if grind was taught about abs... There was a comment about that elsewhere on zulip recently</p>",
        "id": 532703197,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1754305433
    },
    {
        "content": "<p>We're going to make a bespoke tactic :-)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">abs_lt'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"n\">a</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">macro</span><span class=\"w\"> </span><span class=\"s2\">\"absarith\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">try</span><span class=\"w\"> </span><span class=\"n\">repeat</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">abs_lt'</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"bp\">*;</span>\n<span class=\"w\">   </span><span class=\"n\">try</span><span class=\"w\"> </span><span class=\"n\">repeat</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">lt_div_iff₀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">assumption</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"bp\">*;</span>\n<span class=\"w\">   </span><span class=\"n\">constructor</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span>\n<span class=\"w\">   </span><span class=\"n\">nlinarith</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">config</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">splitHypotheses</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">})))</span>\n</code></pre></div>",
        "id": 532715296,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1754309812
    },
    {
        "content": "<p>Lots of good <code>grind</code> goals lurking here. The only thing I've got to work so far is</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">ε</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">ε</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">grind</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">_=_</span><span class=\"w\"> </span><span class=\"n\">mul_sub</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">abs_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">abs_of_pos</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>(Note inequalities replaced by <code>=</code>.) I hope we can improve <code>grind</code> so it can deal with the inequalities here. Both <code>abs_mul</code> and <code>abs_of_pos</code> are probably suitable for <code>@[grind]</code> annotations.</p>\n<p>However calling <code>grind</code> with <code>_=_ mul_sub</code> is very hacky and inadvisable (because we are telling grind to start doing ring arithmetic \"with its bare hands\", rather than via normalization). Unfortunately there's no good way to tell <code>grind</code>'s ring module \"please, if you see a way to write this as a product, let us know, so we can apply <code>abs_mul</code>.</p>",
        "id": 532728211,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1754314209
    }
]