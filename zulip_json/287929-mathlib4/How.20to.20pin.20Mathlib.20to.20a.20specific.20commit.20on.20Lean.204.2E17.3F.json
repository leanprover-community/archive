[
    {
        "content": "<p>Hi everyone,</p>\n<p>I'm new to Lean 4 and currently using Lean 4.17 (downloaded from the official source). I need to use Mathlib at a specific commit, 8f013c457aea2ea1b0156c0c98043c9ed018529f, but Lean 4.17 keeps pulling in a different Mathlib version automatically. I've tried several approaches—mostly guided by ChatGPT—but none of them have worked, and I'm getting quite confused.</p>\n<p>Initially, my lakefile.toml only contained:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">[[</span><span class=\"n\">require</span><span class=\"o\">]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"mathlib\"</span>\n<span class=\"n\">scope</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"leanprover-community\"</span>\n</code></pre></div>\n<p>Following ChatGPT's advice, I changed it to:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">[[</span><span class=\"n\">require</span><span class=\"o\">]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"mathlib\"</span>\n<span class=\"n\">origin</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"git\"</span>\n<span class=\"n\">url</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/leanprover-community/mathlib4.git\"</span>\n<span class=\"n\">rev</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"8f013c457aea2ea1b0156c0c98043c9ed018529f\"</span>\n</code></pre></div>\n<p>But running <code>lake update</code> threw an error. I tried a few other suggestions from ChatGPT, which also failed. Then it told me to remove the <code>lakefile.toml</code> and create a <code>lakefile.lean</code> containing:</p>\n<div class=\"codehilite\" data-code-language=\"import\"><pre><span></span><code>open Lake DSL\n\npackage «2025-02-24_try»\n\nrequire mathlib from git\n  \"https://github.com/leanprover-community/mathlib4.git\"\n  @ \"8f013c457aea2ea1b0156c0c98043c9ed018529f\"\n</code></pre></div>\n<p>However, after doing so, I ran into even more errors, particularly involving <code>proofwidgets</code>:</p>\n<div class=\"codehilite\" data-code-language=\"error\"><pre><span></span><code>  inputFile (widgetDir / { toString := \"package.json\" })\nhas type\n  Bool → SpawnM (Job FilePath)\nbut is expected to have type\n  FetchM ?m.644\n...\nerror: package configuration has errors\n</code></pre></div>\n<p>Now I'm stuck and not sure how to proceed. Any help on how to properly pin Mathlib to the <code>8f013c457...</code> commit in Lean 4.17 without running into these errors would be greatly appreciated! <span aria-label=\"star struck\" class=\"emoji emoji-1f929\" role=\"img\" title=\"star struck\">:star_struck:</span></p>",
        "id": 501832026,
        "sender_full_name": "Ceiling Ge",
        "timestamp": 1740496885
    },
    {
        "content": "<p>In the toml version</p>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"k\">[[require]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"mathlib\"</span>\n<span class=\"n\">git</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/leanprover-community/mathlib4.git\"</span>\n<span class=\"n\">rev</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"8f013c457aea2ea1b0156c0c98043c9ed018529f\"</span>\n</code></pre></div>\n<p>should work</p>",
        "id": 501832645,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1740497035
    },
    {
        "content": "<p>See <a href=\"https://lean-lang.org/doc/reference/latest/Build-Tools-and-Distribution/Lake/#The-Lean-Language-Reference--Build-Tools-and-Distribution--Lake--Configuration-File-Format--Declarative-TOML-Format--Dependencies\">https://lean-lang.org/doc/reference/latest/Build-Tools-and-Distribution/Lake/#The-Lean-Language-Reference--Build-Tools-and-Distribution--Lake--Configuration-File-Format--Declarative-TOML-Format--Dependencies</a></p>",
        "id": 501833263,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1740497185
    },
    {
        "content": "<p>That commit requires Lean 4.5.0-rc1, not 4.17.0 : <a href=\"https://github.com/leanprover-community/mathlib4/blob/8f013c457aea2ea1b0156c0c98043c9ed018529f/lean-toolchain\">https://github.com/leanprover-community/mathlib4/blob/8f013c457aea2ea1b0156c0c98043c9ed018529f/lean-toolchain</a></p>",
        "id": 501833548,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1740497244
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"354934\">@David Thrane Christiansen</span> I built the above url by inspecting the id of that section. Is there a better way?</p>",
        "id": 501833590,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1740497254
    },
    {
        "content": "<p>You can't pick and choose your Lean and mathlib version separately, and if you use <code>elan</code> it solves these problems for you</p>",
        "id": 501833849,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1740497304
    },
    {
        "content": "<p>I think that pinning the mathlib commit and using <code>lake update</code> will set the correct Lean version for the project.</p>",
        "id": 501834047,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1740497353
    },
    {
        "content": "<p>My understanding from \"downloaded from the official source)\" is that <span class=\"user-mention\" data-user-id=\"880693\">@Ceiling Ge</span> has opted to install  Lean manually and not use elan, <del>assuming I am not confusing them with another recent poster.</del> (edit: I am)</p>",
        "id": 501834461,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1740497442
    },
    {
        "content": "<p>Oh I see. Then they are on their own I guess.</p>",
        "id": 501835099,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1740497603
    },
    {
        "content": "<p>But also, I'd be surprised if <code>lake update</code> has two years of backwards compatibility</p>",
        "id": 501835202,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1740497636
    },
    {
        "content": "<p>I’d be surprised if it had two months of backward compatibility.</p>",
        "id": 501839563,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1740498456
    },
    {
        "content": "<p>Thank you all <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> <span class=\"user-mention\" data-user-id=\"110031\">@Patrick Massot</span>  so much for your quick and detailed help! This was my first time asking a question here, and I’m really touched by how responsive everyone is. I followed your advice (installed elan, pinned Mathlib properly, etc.) and now everything is working great. I’ll keep learning Lean 4, and hopefully one day I can pay it forward and help others the way you helped me. Wishing you all the best! <span aria-label=\"grinning\" class=\"emoji emoji-1f600\" role=\"img\" title=\"grinning\">:grinning:</span></p>",
        "id": 501898399,
        "sender_full_name": "Ceiling Ge",
        "timestamp": 1740513254
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/channel/287929-mathlib4/topic/How.20to.20pin.20Mathlib.20to.20a.20specific.20commit.20on.20Lean.204.2E17.3F/near/501833590\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"354934\">David Thrane Christiansen</span> I built the above url by inspecting the id of that section. Is there a better way?</p>\n</blockquote>\n<p>In general, yes - right now, not for that one.</p>\n<p>Over many of the page elements, including but not limited to headers, hovering gets you a little floating link icon from which you can copy a permalink that will be stable across manual revisions, even as content is reorganized. This section hasn't been assigned one yet, but it will get one soon. </p>\n<p>For an example of what this looks like, see e.g. <a href=\"https://lean-lang.org/doc/reference/latest/find/?domain=Verso.Genre.Manual.doc&amp;name=Functor\"><code>Functor</code></a>. This link will keep working as long as there's documentation for something called <code>Functor</code>, no matter where in the book it is.</p>",
        "id": 501924294,
        "sender_full_name": "David Thrane Christiansen",
        "timestamp": 1740523679
    },
    {
        "content": "<p>Does this mean that there is a mechanism to prevent the same thing being included into multiple documents?</p>",
        "id": 501924764,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1740523867
    },
    {
        "content": "<p>There is not. Once cross-document cross-references get implemented, links will link to the current document by default, or to another one if explicitly specified.</p>",
        "id": 501924934,
        "sender_full_name": "David Thrane Christiansen",
        "timestamp": 1740523950
    },
    {
        "content": "<p>What does the link above do if there are multiple matches?</p>",
        "id": 501926759,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1740524772
    },
    {
        "content": "<p>There's two components in it: a \"domain\" that's like a domain of discourse, and a specific item in that domain. Each item in the domain is mapped to a set of locations that document it in an internal table. Right now, the permalink mechanism only generates the link if that set is a singleton. Eventually, for most domains, it'll become a documentation-build-time error that can be disabled.</p>",
        "id": 501927053,
        "sender_full_name": "David Thrane Christiansen",
        "timestamp": 1740524933
    },
    {
        "content": "<p>If you're writing Verso code that uses this feature, you can also do things like allowing a local override of the name used for a documentation item to allow two separate permalinks</p>",
        "id": 501927522,
        "sender_full_name": "David Thrane Christiansen",
        "timestamp": 1740525187
    },
    {
        "content": "<p>Or require that they be specified manually - that's why some sections in the reference don't yet have permalinks, because manually naming them ensures that they have a stable identity that can be preserved across revisions</p>",
        "id": 501927581,
        "sender_full_name": "David Thrane Christiansen",
        "timestamp": 1740525230
    }
]