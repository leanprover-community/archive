[
    {
        "content": "<p>Hi! When using closure_induction on subfields, I encountered this error message:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">(</span><span class=\"n\">deterministic</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">timeout</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"ss\">`whnf</span><span class=\"bp\">`</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">maximum</span><span class=\"w\"> </span><span class=\"n\">number</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">heartbeats</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">200000</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">been</span><span class=\"w\"> </span><span class=\"n\">reached</span>\n<span class=\"n\">Use</span><span class=\"w\"> </span><span class=\"ss\">`set_option</span><span class=\"w\"> </span><span class=\"n\">maxHeartbeats</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"n\">num</span><span class=\"bp\">&gt;`</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"bp\">.</span>\n<span class=\"n\">Additional</span><span class=\"w\"> </span><span class=\"n\">diagnostic</span><span class=\"w\"> </span><span class=\"n\">information</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">available</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"ss\">`set_option</span><span class=\"w\"> </span><span class=\"n\">diagnostics</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"bp\">.</span>\n</code></pre></div>\n<p>Here's a minimal working example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">cyclotomic_degree_real_2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n_gt_2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">Ï†</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">pi</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„‚</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Ï†</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">I</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">Î²</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„‚</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">cos</span><span class=\"w\"> </span><span class=\"n\">Ï†</span>\n\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">â„š_in_â„‚</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"o\">{(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"o\">)}</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">â„š_in_â„‚</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î±</span><span class=\"o\">})</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">â„š_in_â„‚</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î²</span><span class=\"o\">})</span>\n\n<span class=\"w\">  </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intros</span><span class=\"w\"> </span><span class=\"n\">Ï†</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"n\">Î²</span><span class=\"w\"> </span><span class=\"n\">â„š_in_â„‚</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">G</span>\n\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">G'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">comap</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">subtype</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">G</span>\n\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">F_spanner</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">F'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Submodule</span><span class=\"bp\">.</span><span class=\"n\">span</span><span class=\"w\"> </span><span class=\"n\">G'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"n\">F_spanner</span><span class=\"o\">)</span>\n\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">F1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span>\n\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">h3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure_induction</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"n\">F'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">F1</span><span class=\"o\">)</span>\n\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>I wonder why it's happening?</p>",
        "id": 486573917,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733510304
    },
    {
        "content": "<p>This generally means that you're either typing something incorrectly, or that you're not giving Lean enough information to understand what you mean. In this case, giving one type annotation helps Lean figure out what you mean:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">h3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure_induction</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">F1</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 486603004,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1733523405
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"782502\">aprilgrimoire</span> has marked this topic as resolved.</p>",
        "id": 486662782,
        "sender_full_name": "Notification Bot",
        "timestamp": 1733572284
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"111080\">Floris van Doorn</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.E2.9C.94.20Timeout.20at.20.60whnf.60.20with.20let.20expression/near/486603004\">said</a>:</p>\n<blockquote>\n<p>This generally means that you're either typing something incorrectly, or that you're not giving Lean enough information to understand what you mean. In this case, giving one type annotation helps Lean figure out what you mean:</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">h3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure_induction</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">F1</span><span class=\"o\">)</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Thanks! Why do I sometimes get a clear 'Failed to synthesize' error, for example in `let (x : Int) := 1.5, but not this time?</p>",
        "id": 486664226,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733573374
    },
    {
        "content": "<p>Because higher order unification is complicated? Here instance synthesis is not failing, it's just taking too long because Lean is (unfortunately) open to the idea that there could be a coercion from <code>Submodule â†¥G' â†¥F</code> to <code>Set X</code> for values of <code>X</code> other than <code>â†¥F</code>. In general my experience is that typeclass inference has a hard time dealing with such coercions, and I try to avoid these coercions from subobjects to types whenever possible. You can see the pain in the trace: trying to unify the submodule with the \"obvious\" subset is taking a huge amount of time (the numbers in square brackets are times taken in seconds; you can see these with</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">profiler</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"k\">in</span>\n</code></pre></div>\n<p>before your definition:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">isDefEq</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">9.294118</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">ğŸ’¥ï¸</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">delta</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">9.294086</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">ğŸ’¥ï¸</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">  </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">9.294045</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">ğŸ’¥ï¸</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">  </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">9.293852</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">ğŸ’¥ï¸</span><span class=\"w\"> </span><span class=\"n\">sInf</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"n\">sInf</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">  </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">9.292594</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">ğŸ’¥ï¸</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">instInfSet</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">instInfSet</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">  </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">9.292538</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">ğŸ’¥ï¸</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">sInf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">}),</span>\n<span class=\"w\">      </span><span class=\"n\">inv_mem'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">â‹¯</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">sInf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">}),</span><span class=\"w\"> </span><span class=\"n\">inv_mem'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">â‹¯</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">  </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">9.292353</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">ğŸ’¥ï¸</span><span class=\"w\"> </span><span class=\"n\">sInf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"n\">sInf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">  </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">9.287276</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">ğŸ’¥ï¸</span><span class=\"w\"> </span><span class=\"n\">Subring</span><span class=\"bp\">.</span><span class=\"n\">instInfSet</span><span class=\"bp\">.</span><span class=\"m\">1</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"n\">Subring</span><span class=\"bp\">.</span><span class=\"n\">instInfSet</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">  </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">9.287204</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">ğŸ’¥ï¸</span><span class=\"w\"> </span><span class=\"n\">Subring</span><span class=\"bp\">.</span><span class=\"n\">mk'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">â‹‚</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">t</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">â¨…</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">toSubmonoid</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">â¨…</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">toAddSubgroup</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â‹¯</span>\n<span class=\"w\">      </span><span class=\"bp\">â‹¯</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"n\">Subring</span><span class=\"bp\">.</span><span class=\"n\">mk'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">â‹‚</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">t</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">â¨…</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">toSubmonoid</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">â¨…</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">toAddSubgroup</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â‹¯</span><span class=\"w\"> </span><span class=\"bp\">â‹¯</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">delta</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">7.817641</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âŒï¸</span><span class=\"w\"> </span><span class=\"n\">Subring</span><span class=\"bp\">.</span><span class=\"n\">mk'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">â‹‚</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">t</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">â¨…</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">toSubmonoid</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">â¨…</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">toAddSubgroup</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â‹¯</span>\n<span class=\"w\">      </span><span class=\"bp\">â‹¯</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"n\">Subring</span><span class=\"bp\">.</span><span class=\"n\">mk'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">â‹‚</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">t</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">â¨…</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">toSubmonoid</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">â¨…</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">toAddSubgroup</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â‹¯</span><span class=\"w\"> </span><span class=\"bp\">â‹¯</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">  </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">1.469507</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">ğŸ’¥ï¸</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">__</span><span class=\"n\">src</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">â¨…</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">toSubmonoid</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">copy</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"bp\">â‹‚</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â‹¯;</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">__</span><span class=\"n\">src_1</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">â¨…</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">toAddSubgroup</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">copy</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"bp\">â‹‚</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â‹¯;</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">toSubmonoid</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">__</span><span class=\"n\">src</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">add_mem'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">â‹¯</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">zero_mem'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">â‹¯</span><span class=\"o\">,</span>\n<span class=\"w\">      </span><span class=\"n\">neg_mem'</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">        </span><span class=\"bp\">â‹¯</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">__</span><span class=\"n\">src</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">â¨…</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">toSubmonoid</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">copy</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"bp\">â‹‚</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â‹¯;</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">__</span><span class=\"n\">src_1</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">â¨…</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">toAddSubgroup</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">copy</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"bp\">â‹‚</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â‹¯;</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">toSubmonoid</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">__</span><span class=\"n\">src</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">add_mem'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">â‹¯</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">zero_mem'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">â‹¯</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">neg_mem'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">â‹¯</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n</code></pre></div>\n<p>Once you have understood that this sort of thing can be problematic you become used to the idea of giving all the coercions manually.</p>",
        "id": 486666918,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733575621
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.E2.9C.94.20Timeout.20at.20.60whnf.60.20with.20let.20expression/near/486666918\">said</a>:</p>\n<blockquote>\n<p>Because higher order unification is complicated? Here instance synthesis is not failing, it's just taking too long because Lean is (unfortunately) open to the idea that there could be a coercion from <code>Submodule â†¥G' â†¥F</code> to <code>Set X</code> for values of <code>X</code> other than <code>â†¥F</code>. In general my experience is that typeclass inference has a hard time dealing with such coercions, and I try to avoid these coercions from subobjects to types whenever possible. You can see the pain in the trace: trying to unify the submodule with the \"obvious\" subset is taking a huge amount of time (the numbers in square brackets are times taken in seconds; you can see these with</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">profiler</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"k\">in</span>\n</code></pre></div>\n<p>before your definition:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">isDefEq</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">9.294118</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">ğŸ’¥ï¸</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">delta</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">9.294086</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">ğŸ’¥ï¸</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">  </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">9.294045</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">ğŸ’¥ï¸</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">  </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">9.293852</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">ğŸ’¥ï¸</span><span class=\"w\"> </span><span class=\"n\">sInf</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"n\">sInf</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">  </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">9.292594</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">ğŸ’¥ï¸</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">instInfSet</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">instInfSet</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">  </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">9.292538</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">ğŸ’¥ï¸</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">sInf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">}),</span>\n<span class=\"w\">      </span><span class=\"n\">inv_mem'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">â‹¯</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">sInf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">}),</span><span class=\"w\"> </span><span class=\"n\">inv_mem'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">â‹¯</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">  </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">9.292353</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">ğŸ’¥ï¸</span><span class=\"w\"> </span><span class=\"n\">sInf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"n\">sInf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">  </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">9.287276</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">ğŸ’¥ï¸</span><span class=\"w\"> </span><span class=\"n\">Subring</span><span class=\"bp\">.</span><span class=\"n\">instInfSet</span><span class=\"bp\">.</span><span class=\"m\">1</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"n\">Subring</span><span class=\"bp\">.</span><span class=\"n\">instInfSet</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">  </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">9.287204</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">ğŸ’¥ï¸</span><span class=\"w\"> </span><span class=\"n\">Subring</span><span class=\"bp\">.</span><span class=\"n\">mk'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">â‹‚</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">t</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">â¨…</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">toSubmonoid</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">â¨…</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">toAddSubgroup</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â‹¯</span>\n<span class=\"w\">      </span><span class=\"bp\">â‹¯</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"n\">Subring</span><span class=\"bp\">.</span><span class=\"n\">mk'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">â‹‚</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">t</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">â¨…</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">toSubmonoid</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">â¨…</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">toAddSubgroup</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â‹¯</span><span class=\"w\"> </span><span class=\"bp\">â‹¯</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">delta</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">7.817641</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âŒï¸</span><span class=\"w\"> </span><span class=\"n\">Subring</span><span class=\"bp\">.</span><span class=\"n\">mk'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">â‹‚</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">t</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">â¨…</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">toSubmonoid</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">â¨…</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">toAddSubgroup</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â‹¯</span>\n<span class=\"w\">      </span><span class=\"bp\">â‹¯</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"n\">Subring</span><span class=\"bp\">.</span><span class=\"n\">mk'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">â‹‚</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">t</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">â¨…</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">toSubmonoid</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">â¨…</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">toAddSubgroup</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â‹¯</span><span class=\"w\"> </span><span class=\"bp\">â‹¯</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">  </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">1.469507</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">ğŸ’¥ï¸</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">__</span><span class=\"n\">src</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">â¨…</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">toSubmonoid</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">copy</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"bp\">â‹‚</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â‹¯;</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">__</span><span class=\"n\">src_1</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">â¨…</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">toAddSubgroup</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">copy</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"bp\">â‹‚</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">17116</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â‹¯;</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">toSubmonoid</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">__</span><span class=\"n\">src</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">add_mem'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">â‹¯</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">zero_mem'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">â‹¯</span><span class=\"o\">,</span>\n<span class=\"w\">      </span><span class=\"n\">neg_mem'</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">        </span><span class=\"bp\">â‹¯</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">__</span><span class=\"n\">src</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">â¨…</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">toSubmonoid</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">copy</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"bp\">â‹‚</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â‹¯;</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">__</span><span class=\"n\">src_1</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">â¨…</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">toAddSubgroup</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">copy</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"bp\">â‹‚</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">toSubring</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">16707</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">S</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"bp\">â†‘</span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â‹¯;</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">toSubmonoid</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">__</span><span class=\"n\">src</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">add_mem'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">â‹¯</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">zero_mem'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">â‹¯</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">neg_mem'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">â‹¯</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n</code></pre></div>\n<p>Once you have understood that this sort of thing can be problematic you become used to the idea of giving all the coercions manually.</p>\n</blockquote>\n<p>Thanks. Now I've reached a point that simply checking something yields 'timed out at whnf', but increasing the maxHeartbeats from <code>200000</code> to <code>500000</code> worked out. Am I doing anything wrong?</p>\n<p><a href=\"/user_uploads/3121/zcd276cJKTQHsyvinCTqrsv7/Basic.lean\">Basic.lean</a></p>\n<p>EDIT: sorry I forgot to save the file in vscode first before uploading</p>",
        "id": 486667469,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733576132
    },
    {
        "content": "<p>I would first fix all the non-terminal <code>simp</code>s. <code>simp</code> is a closing tactic; it is supposed to close a goal. <code>unfold</code> is also not idiomatic Lean, it indicates that there are missing lemmas. </p>\n<p>But the main problem is that your code syle is a bit of a disaster; you have one definition which is now over 200 lines long. This should be 30 sublemmas each of which are a few lines long. You will definitely face more and more timeouts if you write this kind of code. Here is another way of writing it, where instead of one gigantic object which Lean has to process all in one breath, you break things up into easily-processed chunks each of which can be done independently.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"n\">suppress_compilation</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span>\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"Ï†\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">pi</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"Î±\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Ï†</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">I</span><span class=\"o\">)</span>\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"Î²\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">cos</span><span class=\"w\"> </span><span class=\"n\">Ï†</span>\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"â„š_in_â„‚\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"o\">{(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"o\">)}</span>\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"F\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"o\">({</span><span class=\"n\">Î±</span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"c1\">-- this definition would be much easier to work with</span>\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"G\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"o\">({(</span><span class=\"n\">Î²</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„‚</span><span class=\"o\">)})</span><span class=\"w\"> </span><span class=\"c1\">-- similarly</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">hÎ±_inv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"bp\">â»Â¹</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"n\">Ï†</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">symm</span>\n<span class=\"w\">  </span><span class=\"n\">convert</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">exp_neg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">â†‘</span><span class=\"n\">Ï†</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"w\">  </span><span class=\"bp\">Â·</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"bp\">Â·</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n\n<span class=\"c1\">-- Lean can now breathe</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">hÎ±_in_F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">mem_closure</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"c1\">-- and breathe again</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">hÎ±_inv_in_F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"bp\">â»Â¹</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">inv_mem'</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hÎ±_in_F</span><span class=\"w\"> </span><span class=\"n\">n</span>\n\n<span class=\"c1\">-- etc</span>\n</code></pre></div>",
        "id": 486668773,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733577113
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.E2.9C.94.20Timeout.20at.20.60whnf.60.20with.20let.20expression/near/486668773\">said</a>:</p>\n<blockquote>\n<p>I would first fix all the non-terminal <code>simp</code>s. <code>simp</code> is a closing tactic; it is supposed to close a goal. <code>unfold</code> is also not idiomatic Lean, it indicates that there are missing lemmas. </p>\n<p>But the main problem is that your code syle is a bit of a disaster; you have one definition which is now over 200 lines long. This should be 30 sublemmas each of which are a few lines long. You will definitely face more and more timeouts if you write this kind of code. Here is another way of writing it, where instead of one gigantic object which Lean has to process all in one breath, you break things up into easily-processed chunks each of which can be done independently.</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"n\">suppress_compilation</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span>\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"Ï†\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">pi</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"Î±\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Ï†</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">I</span><span class=\"o\">)</span>\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"Î²\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">cos</span><span class=\"w\"> </span><span class=\"n\">Ï†</span>\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"â„š_in_â„‚\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"o\">{(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"o\">)}</span>\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"F\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"o\">({</span><span class=\"n\">Î±</span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"c1\">-- this definition would be much easier to work with</span>\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"G\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"o\">({(</span><span class=\"n\">Î²</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„‚</span><span class=\"o\">)})</span><span class=\"w\"> </span><span class=\"c1\">-- similarly</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">hÎ±_inv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"bp\">â»Â¹</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"n\">Ï†</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">symm</span>\n<span class=\"w\">  </span><span class=\"n\">convert</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">exp_neg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">â†‘</span><span class=\"n\">Ï†</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"w\">  </span><span class=\"bp\">Â·</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"bp\">Â·</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n\n<span class=\"c1\">-- Lean can now breathe</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">hÎ±_in_F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">mem_closure</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"c1\">-- and breathe again</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">hÎ±_inv_in_F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"bp\">â»Â¹</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">inv_mem'</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hÎ±_in_F</span><span class=\"w\"> </span><span class=\"n\">n</span>\n\n<span class=\"c1\">-- etc</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Thanks. I'm a bit confused. In traditional programming, I was encouraged to encapsulate as much things as possible. What's the advantage of using notations instead of let expressions? Is there a 'Good practices in Lean4' kind of thing?</p>",
        "id": 486669136,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733577459
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.E2.9C.94.20Timeout.20at.20.60whnf.60.20with.20let.20expression/near/486668773\">said</a>:</p>\n<blockquote>\n<p>I would first fix all the non-terminal <code>simp</code>s. <code>simp</code> is a closing tactic; it is supposed to close a goal. <code>unfold</code> is also not idiomatic Lean, it indicates that there are missing lemmas. </p>\n<p>But the main problem is that your code syle is a bit of a disaster; you have one definition which is now over 200 lines long. This should be 30 sublemmas each of which are a few lines long. You will definitely face more and more timeouts if you write this kind of code. Here is another way of writing it, where instead of one gigantic object which Lean has to process all in one breath, you break things up into easily-processed chunks each of which can be done independently.</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"n\">suppress_compilation</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span>\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"Ï†\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">pi</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"Î±\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Ï†</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">I</span><span class=\"o\">)</span>\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"Î²\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">cos</span><span class=\"w\"> </span><span class=\"n\">Ï†</span>\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"â„š_in_â„‚\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"o\">{(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"o\">)}</span>\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"F\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"o\">({</span><span class=\"n\">Î±</span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"c1\">-- this definition would be much easier to work with</span>\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"G\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"o\">({(</span><span class=\"n\">Î²</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„‚</span><span class=\"o\">)})</span><span class=\"w\"> </span><span class=\"c1\">-- similarly</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">hÎ±_inv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"bp\">â»Â¹</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"n\">Ï†</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">symm</span>\n<span class=\"w\">  </span><span class=\"n\">convert</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">exp_neg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">â†‘</span><span class=\"n\">Ï†</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"w\">  </span><span class=\"bp\">Â·</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"bp\">Â·</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n\n<span class=\"c1\">-- Lean can now breathe</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">hÎ±_in_F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">mem_closure</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"c1\">-- and breathe again</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">hÎ±_inv_in_F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"bp\">â»Â¹</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">inv_mem'</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hÎ±_in_F</span><span class=\"w\"> </span><span class=\"n\">n</span>\n\n<span class=\"c1\">-- etc</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>By writing in this style, I have to write <code>n</code> in many places. Is this encouraged?</p>",
        "id": 486669415,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733577693
    },
    {
        "content": "<p>I agree that the dependence on n is not ideal. Try </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">}</span>\n</code></pre></div>\n<p>at the start, and then </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">hÎ±_inv_in_F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"bp\">â»Â¹</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">inv_mem'</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hÎ±_in_F</span>\n</code></pre></div>\n<p>works fine.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"782502\">aprilgrimoire</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.E2.9C.94.20Timeout.20at.20.60whnf.60.20with.20let.20expression/near/486669136\">said</a>:</p>\n<blockquote>\n<p>Thanks. I'm a bit confused. In traditional programming, I was encouraged to encapsulate as much things as possible. What's the advantage of using notations instead of let expressions? Is there a 'Good practices in Lean4' kind of thing?</p>\n</blockquote>\n<p>Surely you were also taught that it's better to write short modular code than one 200-line function?</p>\n<p>I am also completely unclear about what you are hoping to define here with your</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">cyclotomic_degree_real_2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n_gt_2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n</code></pre></div>\n<p>Are you sure you're making a definition? Basically you have been writing an extremely long sentence for a while now, and you still never got to the end of it. Are you sure that this should not be a <code>theorem</code>? You have never even written the type of the term you are defining, as far as I can see.</p>",
        "id": 486669807,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733578019
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"111080\">Floris van Doorn</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.E2.9C.94.20Timeout.20at.20.60whnf.60.20with.20let.20expression/near/486603004\">said</a>:</p>\n<blockquote>\n<p>This generally means that you're either typing something incorrectly, or that you're not giving Lean enough information to understand what you mean. In this case, giving one type annotation helps Lean figure out what you mean:</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">h3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure_induction</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">F1</span><span class=\"o\">)</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Thanks. I didn't know about the 'variable' mechanism and chose this perverse way of encapsulation.</p>\n<p>Regarding 'def, lemma, theorem', I have not yet decided what the final result type should be, so I left it as <code>def</code> for now. Should I use 'lemma' or 'theorem' always when the return type is a <code>Prop</code>?</p>\n<p>Regarding 'Simp': In many occasions I have a new equivalent intermediate form in mind which should be relatable by simple laws (comm, assoc, etc.) or definitions. In such cases, what's the recommended way to proceed? Should I use 'have' to state the equivalence explicitly and use <code>simp</code> to close the <code>have</code> statement, or should I manually perform each step?</p>",
        "id": 486673905,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733581205
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.E2.9C.94.20Timeout.20at.20.60whnf.60.20with.20let.20expression/near/486669807\">said</a>:</p>\n<blockquote>\n<p>I agree that the dependence on n is not ideal. Try </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">}</span>\n</code></pre></div>\n<p>at the start, and then </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">hÎ±_inv_in_F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"bp\">â»Â¹</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">inv_mem'</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hÎ±_in_F</span>\n</code></pre></div>\n<p>works fine.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"782502\">aprilgrimoire</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.E2.9C.94.20Timeout.20at.20.60whnf.60.20with.20let.20expression/near/486669136\">said</a>:</p>\n<blockquote>\n<p>Thanks. I'm a bit confused. In traditional programming, I was encouraged to encapsulate as much things as possible. What's the advantage of using notations instead of let expressions? Is there a 'Good practices in Lean4' kind of thing?</p>\n</blockquote>\n<p>Surely you were also taught that it's better to write short modular code than one 200-line function?</p>\n<p>I am also completely unclear about what you are hoping to define here with your</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">cyclotomic_degree_real_2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n_gt_2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n</code></pre></div>\n<p>Are you sure you're making a definition? Basically you have been writing an extremely long sentence for a while now, and you still never got to the end of it. Are you sure that this should not be a <code>theorem</code>? You have never even written the type of the term you are defining, as far as I can see.</p>\n</blockquote>\n<p>I think many of lemmas are implementation details and should not be exposed. Should I write them in the global section anyway?</p>",
        "id": 486673977,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733581282
    },
    {
        "content": "<p>Yes definitely <code>def</code> is not a good idea if you are proving a theorem; when you finally state what you're doing probably a linter will kick in and tell you that it's not a def.</p>\n<p><code>simp</code> in the middle of a proof (i.e. a simp call which does not close a goal) should be replaced with <code>simp?</code> and then <code>simp only [the list which was output]</code>. Or you can use <code>suffices [what you want the goal to be] by simpa</code> if you know where you want to go.</p>\n<p>As for your last question, this is difficult to answer because it depends on why you're writing your code. If you don't want to expose a lemma outside a file you can make it <code>private lemma ...</code>.</p>",
        "id": 486674446,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733581605
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.E2.9C.94.20Timeout.20at.20.60whnf.60.20with.20let.20expression/near/486669807\">said</a>:</p>\n<blockquote>\n<p>I agree that the dependence on n is not ideal. Try </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">}</span>\n</code></pre></div>\n<p>at the start, and then </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">hÎ±_inv_in_F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"bp\">â»Â¹</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">inv_mem'</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hÎ±_in_F</span>\n</code></pre></div>\n<p>works fine.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"782502\">aprilgrimoire</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.E2.9C.94.20Timeout.20at.20.60whnf.60.20with.20let.20expression/near/486669136\">said</a>:</p>\n<blockquote>\n<p>Thanks. I'm a bit confused. In traditional programming, I was encouraged to encapsulate as much things as possible. What's the advantage of using notations instead of let expressions? Is there a 'Good practices in Lean4' kind of thing?</p>\n</blockquote>\n<p>Surely you were also taught that it's better to write short modular code than one 200-line function?</p>\n<p>I am also completely unclear about what you are hoping to define here with your</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">cyclotomic_degree_real_2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n_gt_2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n</code></pre></div>\n<p>Are you sure you're making a definition? Basically you have been writing an extremely long sentence for a while now, and you still never got to the end of it. Are you sure that this should not be a <code>theorem</code>? You have never even written the type of the term you are defining, as far as I can see.</p>\n</blockquote>\n<p>I recognized that when using <code>def</code> instead of <code>let</code>, I'm facing more requirements, for example I need to mark things as <code>noncomputable</code> everywhere. Is there a shortcut to mark everything as noncomputable?</p>",
        "id": 486674486,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733581637
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.E2.9C.94.20Timeout.20at.20.60whnf.60.20with.20let.20expression/near/486674446\">said</a>:</p>\n<blockquote>\n<p>Yes definitely <code>def</code> is not a good idea if you are proving a theorem; when you finally state what you're doing probably a linter will kick in and tell you that it's not a def.</p>\n<p><code>simp</code> in the middle of a proof (i.e. a simp call which does not close a goal) should be replaced with <code>simp?</code> and then <code>simp only [the list which was output]</code>. Or you can use <code>suffices [what you want the goal to be] by simpa</code> if you know where you want to go.</p>\n<p>As for your last question, this is difficult to answer because it depends on why you're writing your code. If you don't want to expose a lemma outside a file you can make it <code>private lemma ...</code>.</p>\n</blockquote>\n<p>Currently I use <code>G_leq_F</code> as the return type, which is a prop, but the linter said nothing about it.<br>\nIn type theorem, a theorem is just a special <code>def</code>?</p>",
        "id": 486674598,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733581711
    },
    {
        "content": "<blockquote>\n<p>Is there a shortcut to mark everything as noncomputable?</p>\n</blockquote>\n<p>Does <code>suppress_compilation</code> work? That was what I used in my example above.</p>\n<blockquote>\n<p>In type theorem, a theorem is just a specialÂ <code>def</code>?</p>\n</blockquote>\n<p>Yes, basically. Maybe a computer scientist will be quick to point out some explicit list of differences but whatever is going on internally, the rule is clear: <code>theorem</code> or <code>lemma</code> for proofs, <code>def</code> for everything else.</p>",
        "id": 486674645,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733581773
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.E2.9C.94.20Timeout.20at.20.60whnf.60.20with.20let.20expression/near/486674645\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>Is there a shortcut to mark everything as noncomputable?</p>\n</blockquote>\n<p>Does <code>suppress_compilation</code> work? That was what I used in my example above.</p>\n<blockquote>\n<p>In type theorem, a theorem is just a specialÂ <code>def</code>?</p>\n</blockquote>\n<p>Yes, basically. Maybe a computer scientist will be quick to point out some explicit list of differences but whatever is going on internally, the rule is clear: <code>theorem</code> or <code>lemma</code> for proofs, <code>def</code> for everything else.</p>\n</blockquote>\n<p>Variables behaved unexpectedly, and I think I don't understand them very well:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"n\">suppress_compilation</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n_gt_2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">}</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Ï†</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">pi</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„‚</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Ï†</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">I</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Why is this incorrect?</p>",
        "id": 486675375,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733582310
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.E2.9C.94.20Timeout.20at.20.60whnf.60.20with.20let.20expression/near/486674645\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>Is there a shortcut to mark everything as noncomputable?</p>\n</blockquote>\n<p>Does <code>suppress_compilation</code> work? That was what I used in my example above.</p>\n<blockquote>\n<p>In type theorem, a theorem is just a specialÂ <code>def</code>?</p>\n</blockquote>\n<p>Yes, basically. Maybe a computer scientist will be quick to point out some explicit list of differences but whatever is going on internally, the rule is clear: <code>theorem</code> or <code>lemma</code> for proofs, <code>def</code> for everything else.</p>\n</blockquote>\n<p>It doesn't work either if I use <code>()</code> instead of <code>{}</code>.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"n\">suppress_compilation</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n_gt_2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Ï†</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">pi</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„‚</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Ï†</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">I</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 486675579,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733582504
    },
    {
        "content": "<p>I would avoid mentioning <code>(n_gt_2 : n &gt; 2)</code> until the moment you need it. If you're going to use <code>(n : â„•)</code> then <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Ï•</mi></mrow><annotation encoding=\"application/x-tex\">\\phi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Ï•</span></span></span></span> is really <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>Ï•</mi><mi>n</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\phi_n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">Ï•</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> so you will need to write <code>Ï† n</code>.</p>",
        "id": 486676594,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733583222
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.E2.9C.94.20Timeout.20at.20.60whnf.60.20with.20let.20expression/near/486676594\">said</a>:</p>\n<blockquote>\n<p>I would avoid mentioning <code>(n_gt_2 : n &gt; 2)</code> until the moment you need it. If you're going to use <code>(n : â„•)</code> then <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Ï•</mi></mrow><annotation encoding=\"application/x-tex\">\\phi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Ï•</span></span></span></span> is really <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>Ï•</mi><mi>n</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\phi_n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">Ï•</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> so you will need to write <code>Ï† n</code>.</p>\n</blockquote>\n<p>I thought variables could help me automatically pass those things around. If not, what's the point of it? Without <code>n_gt_2</code>, <code>Ï†</code> feels strange. Then should I use <code>(n : â„•)</code> here? Why doesn't it work either?</p>",
        "id": 486676831,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733583406
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Ï†</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">pi</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">n</span>\n</code></pre></div>\n<p>is the same as</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Ï†</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">pi</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">n</span>\n</code></pre></div>\n<p>Does this answer your question?</p>",
        "id": 486676907,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1733583472
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">YaÃ«l Dillies</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.E2.9C.94.20Timeout.20at.20.60whnf.60.20with.20let.20expression/near/486676907\">said</a>:</p>\n<blockquote>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Ï†</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">pi</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">n</span>\n</code></pre></div>\n<p>is the same as</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Ï†</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">pi</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">n</span>\n</code></pre></div>\n<p>Does this answer your question?</p>\n</blockquote>\n<p>Thanks. Yeah. So writing them as let statements inside of a function is the only way to avoid passing <code>n</code> around?</p>",
        "id": 486677012,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733583531
    },
    {
        "content": "<p>Or using notation, as I showed in my code above.</p>",
        "id": 486677733,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733584098
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.E2.9C.94.20Timeout.20at.20.60whnf.60.20with.20let.20expression/near/486677733\">said</a>:</p>\n<blockquote>\n<p>Or using notation, as I showed in my code above.</p>\n</blockquote>\n<p>So in the recommended coding style, I still need to pass <code>n</code> around manually?</p>",
        "id": 486677879,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733584228
    },
    {
        "content": "<p>If you don't want to, then just use notation like I did? I don't know what you mean by \"recommended coding style\". There's lots of notation in mathlib.</p>",
        "id": 486679164,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733585301
    },
    {
        "content": "<p>In Lean 3 there was another solution involving <code>parameter</code> but for some reason this was removed in Lean 4.</p>",
        "id": 486679245,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733585386
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.E2.9C.94.20Timeout.20at.20.60whnf.60.20with.20let.20expression/near/486676594\">said</a>:</p>\n<blockquote>\n<p>I would avoid mentioning <code>(n_gt_2 : n &gt; 2)</code> until the moment you need it. If you're going to use <code>(n : â„•)</code> then <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Ï•</mi></mrow><annotation encoding=\"application/x-tex\">\\phi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Ï•</span></span></span></span> is really <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>Ï•</mi><mi>n</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\phi_n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">Ï•</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> so you will need to write <code>Ï† n</code>.</p>\n</blockquote>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">hÎ±_inv_in_F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"bp\">â»Â¹</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">inv_mem'</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hÎ±_in_F</span><span class=\"w\"> </span><span class=\"n\">n</span>\n</code></pre></div>\n<p>Seems <code>n</code> still needs to be passed around. How would <code>notation</code> deal with <code>n_gt_2</code>?</p>",
        "id": 486679922,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733585893
    },
    {
        "content": "<blockquote>\n<p>SeemsÂ <code>n</code>Â still needs to be passed around</p>\n</blockquote>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">hÎ±_in_F</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">mem_closure</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<blockquote>\n<p>How wouldÂ <code>notation</code>Â deal withÂ <code>n_gt_2</code>?</p>\n</blockquote>\n<p>You definitely need to pass that around in all the lemmas that need it.</p>",
        "id": 486680567,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733586414
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.E2.9C.94.20Timeout.20at.20.60whnf.60.20with.20let.20expression/near/486680567\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>SeemsÂ <code>n</code>Â still needs to be passed around</p>\n</blockquote>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">hÎ±_in_F</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"bp\">.</span><span class=\"n\">mem_closure</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<blockquote>\n<p>How wouldÂ <code>notation</code>Â deal withÂ <code>n_gt_2</code>?</p>\n</blockquote>\n<p>You definitely need to pass that around in all the lemmas that need it.</p>\n</blockquote>\n<p>Writing nested functions seems like the most natural thing to me. Can you teach me more about why I shouldn't do it? Will the linter be updated to support such styles in the future?</p>",
        "id": 486681429,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733587052
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"782502\">@aprilgrimoire</span> By the way, you don't need to quote reply literally every message. Especially when the message you are replying to is much longer than your response, this is a waste of space and makes it harder for people to read your remark. If the thing you are replying to is the immediately previous message, there is no need to quote at all. If it is from farther up in the backscroll or you are only replying to part of a post, you should use quote reply but then edit the quote to only include the sentence or portion of the post you want to highlight. If you leave the \"said\" link in people can follow it to read the full context.</p>",
        "id": 486681886,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733587371
    },
    {
        "content": "<p>Regarding your question, I would agree with Kevin that writing <code>let</code>s in the statement of the theorem/def is highly unidiomatic because it causes problems for later use of the theorem/def</p>",
        "id": 486682568,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733587867
    },
    {
        "content": "<p>Having them in the body is more okay</p>",
        "id": 486682617,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733587887
    },
    {
        "content": "<p>Having 200 line definitions is very unusual for mathlib, but it's domain dependent whether it's usual for what you are doing</p>",
        "id": 486682648,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733587915
    },
    {
        "content": "<p>I think I also agree with Kevin that this is difficult to answer because you never really gave the main part of the expression. Maybe you could give the math version of the definition and we can recommend how to formalize it?</p>",
        "id": 486682835,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733588010
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> </p>\n<p>The cyclotomic field of order <code>n</code> is a degree <code>2</code> extension of its intersection with <code>â„</code>. (when <code>n &gt; 2</code>)</p>",
        "id": 486682941,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733588079
    },
    {
        "content": "<p>with a statement like that, I would expect the formalization to have approximately the shape</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">cyclotomic_field</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"w\"> </span><span class=\"n\">â„‚</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">reals</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"w\"> </span><span class=\"n\">â„‚</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">is_extension_of_degree</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"w\"> </span><span class=\"n\">â„‚</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">cyclotomic_degree_real_2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n_gt_2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">is_extension_of_degree</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">cyclotomic_field</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">cyclotomic_field</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">âŠ“</span><span class=\"w\"> </span><span class=\"n\">reals</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 486683531,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733588495
    },
    {
        "content": "<p>I met several difficulties formulating this statement, since mathlib4 doesn't have a concept of degree of field extension, let alone cyclotomic fields. (Even though lean4 have a concept of rank for modules, it doesn't require the module to be free, but is defined for any module as the maximal cardinality of a linearly independent set. To express the concept accurately, you are right that I should have made some auxiliary defs outside the main theorem.)</p>",
        "id": 486683635,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733588598
    },
    {
        "content": "<p>I don't know this corner of the library well but I guess the first two sorries exist already</p>",
        "id": 486683649,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733588613
    },
    {
        "content": "<p>not sure about the third but I think there is something similar</p>",
        "id": 486683663,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733588625
    },
    {
        "content": "<p>In particular, I want you to observe that this theorem statement doesn't have any alpha and beta in it. That's going to be part of the proof, but the statement is just about cyclotomic fields as stated</p>",
        "id": 486683760,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733588695
    },
    {
        "content": "<p>Actually I need to prove <code>[â„š[Î±]:â„š[Î²]]=2</code>. Sorry for reformulating it in a (mathematically) more traditional way.</p>",
        "id": 486683910,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733588804
    },
    {
        "content": "<p>in that case I would skip the lets entirely in the statement, since presumably the values of alpha and beta are relevant to the caller:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">adjoin_root</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„‚</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"w\"> </span><span class=\"n\">â„‚</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">is_extension_of_degree</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Subfield</span><span class=\"w\"> </span><span class=\"n\">â„‚</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">cyclotomic_degree_real_2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n_gt_2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">is_extension_of_degree</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">adjoin_root</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">pi</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">I</span><span class=\"o\">)))</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">adjoin_root</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">cos</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">pi</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 486684184,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733589025
    },
    {
        "content": "<p>depending on how long lived these expressions are you may want to make them into defs</p>",
        "id": 486684223,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733589065
    },
    {
        "content": "<p>In the library, there is the concept of a cyclotomic field, but it is defined as an abstract field, not being a subfield of <code>â„‚</code>.</p>",
        "id": 486684263,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733589089
    },
    {
        "content": "<p>Actually I think no one will ever call these functions. I'm trying to get a part time job producing training data for an AI-for-math program. (I'm a bachelor student in mathematics interested in the foundation of mathematics and programming.)</p>",
        "id": 486684378,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733589153
    },
    {
        "content": "<p>with defs for the sequences it looks like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Ï†</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">pi</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„‚</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Ï†</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">I</span><span class=\"o\">)</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Î²</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„‚</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">cos</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Ï†</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">cyclotomic_degree_real_2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n_gt_2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">is_extension_of_degree</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">adjoin_root</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">adjoin_root</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Î²</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 486684531,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733589255
    },
    {
        "content": "<p>The natural language version of this statement has <code>Î±,Î²</code>in it, so I think I should mimic it and stick with these notations.</p>",
        "id": 486684536,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733589260
    },
    {
        "content": "<p>Does the natural language version also have a let statement in it?</p>",
        "id": 486684590,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733589312
    },
    {
        "content": "<p>otherwise I guess the theorem isn't true</p>",
        "id": 486684609,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733589321
    },
    {
        "content": "<p>defs usually work better than lets when it comes to abstracting the same expression across multiple theorems</p>",
        "id": 486684705,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733589382
    },
    {
        "content": "<p>Thanks. Oh I forgot the original natural language version, which was written badly:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>    Show that [Q(Ï‰):Q(cosâ¡2Ï€/n)]=2[Q(Ï‰):Q(cos2Ï€/n)]=2.\n</code></pre></div>\n<p>Where <code>Ï‰</code> doesn't even have <code>n</code> included. Don't know if it will be revised before being fed into the AI.</p>",
        "id": 486684799,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733589473
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> <br>\nI've now refactored my code into a style of multiple lemmas. However, I still got a <code>whnf</code> error. I tried option diagnostics, however, the diagnostic info didn't include which line was causing the trouble. How should I interpret such info? I suspect this is not the item related to the timeout, but I didn't find a more related one.</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>[reduction] unfolded declarations (max: 19516, num: 77): â–¶\n[reduction] unfolded instances (max: 23187, num: 314): â–¶\n[reduction] unfolded reducible declarations (max: 29101, num: 86): â–¶\n[type_class] used instances (max: 105, num: 33): â–¶\n[type_class] max synth pending failures (maxSynthPendingDepth: 1), use `set_option maxSynthPendingDepth &lt;limit&gt;` â–¶\n[def_eq] heuristic for solving `f a =?= f b` (max: 4617, num: 79): â–¶\n[kernel] unfolded declarations (max: 17948, num: 187): â–¶\nuse `set_option diagnostics.threshold &lt;num&gt;` to control threshold for reporting counters\n</code></pre></div>",
        "id": 486704255,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733605418
    },
    {
        "content": "<p>No idea. Post code so I can see the error at my end?</p>",
        "id": 486704376,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733605501
    },
    {
        "content": "<p>Is <code>simp?</code> specifically very demanding on heartbeats?</p>",
        "id": 486704431,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733605533
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/gKz-upFrbQfQrJnSZfEF8dw5/Basic.lean\">Basic.lean</a><br>\nSure. Thank you!</p>",
        "id": 486704451,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733605556
    },
    {
        "content": "<p>You are writing huge proofs with lots of non-terminal simps and making Lean time out. That's your problem. Squeeze your simps?</p>",
        "id": 486704794,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733605817
    },
    {
        "content": "<p>Do you mean replacing them with 'simp only ...'?</p>",
        "id": 486704823,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733605852
    },
    {
        "content": "<p>Or just increase all your heartbeat timeouts and battle through the pain of every line of code taking an age to compile with</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">synthInstance</span><span class=\"bp\">.</span><span class=\"n\">maxHeartbeats</span><span class=\"w\"> </span><span class=\"mi\">200000</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">maxHeartbeats</span><span class=\"w\"> </span><span class=\"mi\">2000000</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">F_spanner_full</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F'</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">âŠ¤</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n</code></pre></div>",
        "id": 486704839,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733605864
    },
    {
        "content": "<p>But really you don't want to be writing proofs which are more than 10 or so lines, there is no need. Prove lemmas in small chunks.</p>",
        "id": 486704861,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733605890
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">F_spanner_linear_indep</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n_gt_2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LinearIndependent</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G'</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F_spanner</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">linearIndependent_fin2</span><span class=\"bp\">.</span><span class=\"n\">mpr</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">F_spanner</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">And</span><span class=\"bp\">.</span><span class=\"n\">intro</span>\n<span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">coe_ne_coe</span><span class=\"bp\">.</span><span class=\"n\">mp</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ï†</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Ioo</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">pi</span>\n<span class=\"w\">    </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">mem_Ioo</span><span class=\"bp\">.</span><span class=\"n\">mpr</span>\n<span class=\"w\">      </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">And</span><span class=\"bp\">.</span><span class=\"n\">intro</span>\n<span class=\"w\">      </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">Ï†</span>\n<span class=\"w\">        </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">div_pos</span>\n<span class=\"w\">        </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">mul_pos</span>\n<span class=\"w\">        </span><span class=\"n\">simp</span>\n<span class=\"w\">        </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">pi_pos</span>\n<span class=\"o\">[</span><span class=\"mi\">70</span><span class=\"w\"> </span><span class=\"n\">more</span><span class=\"w\"> </span><span class=\"n\">lines</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"n\">omitted</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>If you start a proof like this, then beyond this point the simplifier will go through all 50,000 or however many simp lemmas there are in mathlib, three times, every time you press a button on your keyboard. That is not a sensible way to use the simplifier. The job of the simplifier in its bare format <code>simp</code> is to close goals, not make partial progress towards closing them.</p>",
        "id": 486704999,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733606002
    },
    {
        "content": "<p>Also every <code>unfold</code> indicates poor planning. If you want to unfold <code>F_spanner</code> then either write a lemma saying <code>F_spanner = [definition of F_spanner]</code>, prove it with <code>rfl</code> and rewrite it (and tag it with <code>@[simp]</code> if you want the simplifier to use it), or just don't even define <code>F_spanner</code>, what is the point of having it if you just keep unfolding it?</p>\n<p>[actually looking at the definition, it's long, so you probably want it, but you don't want to keep unfolding it, not least because you have made quite a messy definition]</p>",
        "id": 486705137,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733606137
    },
    {
        "content": "<p>Do you mean I should separate out the arguments of the closure_induction?</p>\n<p>Because there would be many lemmas with F_spanner being a part of their return type. Making this definition would make them look clearer.</p>",
        "id": 486705254,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733606246
    },
    {
        "content": "<p>What's the point of having a lemma doing the same thing as unfold? For it to be used by simp?</p>",
        "id": 486705338,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733606303
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.E2.9C.94.20Timeout.20at.20.60whnf.60.20with.20let.20expression/near/486704999\">said</a>:</p>\n<blockquote>\n<p>If you start a proof like this, then beyond this point the simplifier will go through all 50,000 or however many simp lemmas there are in mathlib, three times, every time you press a button on your keyboard. That is not a sensible way to use the simplifier. The job of the simplifier in its bare format <code>simp</code> is to close goals, not make partial progress towards closing them.</p>\n</blockquote>\n<p>BTW I'm not currently working on that lemma. Does this mean its calculations are cached and not redo every time the file is modified?</p>",
        "id": 486705396,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733606364
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- make the proofs separate -- two short proofs are better than one long proof</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">F_spanner_aux_one</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">F_spanner_aux_two</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">sin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Ï†</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"c1\">-- nice short definition</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">F_spanner</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">!</span><span class=\"o\">[</span><span class=\"bp\">âŸ¨</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">F_spanner_aux_one</span><span class=\"bp\">âŸ©</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"o\">(</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">sin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Ï†</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">I</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">F_spanner_aux_two</span><span class=\"bp\">âŸ©</span><span class=\"o\">]</span>\n\n<span class=\"c1\">-- Don't ever unfold `F_spanner`, write the lemmas about it which you need</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">F_spanner_zero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F_spanner</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">F_spanner_one</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F_spanner</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">sin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Ï†</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„‚</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"c1\">-- and now rewrite with these lemmas instead of `unfold`</span>\n</code></pre></div>",
        "id": 486705540,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733606482
    },
    {
        "content": "<blockquote>\n<p>BTW I'm not currently working on that lemma. Does this mean its calculations are cached and not redo every time the file is modified?</p>\n</blockquote>\n<p>I mean that when you wrote that 70 line proof you used a lot of unnecessary CPU cycles because of all the non-terminal simps evaluated again and again and again. Break your proofs up into small modular pieces and don't use expensive tactics unless they close goals.</p>",
        "id": 486705636,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733606554
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.E2.9C.94.20Timeout.20at.20.60whnf.60.20with.20let.20expression/near/486705636\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>BTW I'm not currently working on that lemma. Does this mean its calculations are cached and not redo every time the file is modified?</p>\n</blockquote>\n<p>I mean that when you wrote that 70 line proof you used a lot of unnecessary CPU cycles because of all the non-terminal simps evaluated again and again and again. Break your proofs up into small modular pieces and don't use expensive tactics unless they close goals.</p>\n</blockquote>\n<p>Understood. But does the linter caches result from unmodified lemmas?</p>",
        "id": 486705679,
        "sender_full_name": "aprilgrimoire",
        "timestamp": 1733606591
    },
    {
        "content": "<p>I don't know anything about linters or how things work, I'm just saying try not to write long proofs and try not to use expensive tactics because it makes using Lean more fun.</p>",
        "id": 486705789,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733606673
    }
]