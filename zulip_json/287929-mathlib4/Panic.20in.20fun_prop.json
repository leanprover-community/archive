[
    {
        "content": "<p>In the following example, <code>fun_prop</code> causes a <code>PANIC at Lean.Meta.whnfEasyCases Lean.Meta.WHNF:381:22: loose bvar in expression</code> instead of failing:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">FunProp</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">fun_prop</span><span class=\"kd\">]</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Unit</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">fun_prop</span><span class=\"kd\">]</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">f</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">fun_prop</span>\n</code></pre></div>",
        "id": 547153113,
        "sender_full_name": "Attila Gáspár",
        "timestamp": 1761505740
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"346070\">@Tomas Skrivan</span> may be the relevant person to help?</p>",
        "id": 547412226,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761628605
    },
    {
        "content": "<p>It should definitely not panic, and with a quick look I couldn't figure out why it is happening. </p>\n<p>Also on my recent refactor of <code>fun_prop</code> it does not throw anymore but it might be some time before I finish it. Is this blocking you from doing some work and you need a fix? or is this just something you have encountered?</p>",
        "id": 547456408,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1761647360
    },
    {
        "content": "<p>While I was experimenting with <code>measurability</code>, I found that <code>fun_prop</code> gives this error when it tries to use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Multiset.aestronglyMeasurable_prod#doc\">docs#Multiset.aestronglyMeasurable_prod</a>. I've made PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/31001\">#31001</a> to fix the panic, but unfortunately it doesn't make <code>aestronglyMeasurable_prod</code> usable by <code>fun_prop</code>. But so far it hasn't caused any issues, so it's not urgent.</p>",
        "id": 547464632,
        "sender_full_name": "Attila Gáspár",
        "timestamp": 1761649707
    }
]