[
    {
        "content": "<p>I've recently written <a href=\"https://github.com/kim-em/lean-minimizer\">https://github.com/kim-em/lean-minimizer</a>, a general purpose Lean test case reducer (i.e. takes a file demonstrating a bug, and produces a smaller/simpler file, with fewer imports, demonstrating the same bug). (Usage reports / bug reports very very welcome!) If you're minimizing a file that imports Mathlib, it's convenient to use <a href=\"https://github.com/kim-em/mathilb-minimizer\">https://github.com/kim-em/mathilb-minimizer</a>, which additionally requires Mathlib.</p>",
        "id": 570213340,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1769473703
    },
    {
        "content": "<p>I've just encountered an interesting situation, which I would be happy to have help with. This is a case where I have a file with an import, but inlining that import causes compilation to fail.</p>",
        "id": 570213345,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1769473708
    },
    {
        "content": "<p>(For context, I'm trying to minimize a <a href=\"https://github.com/leanprover-community/mathlib4/blob/master/Mathlib/Analysis/ODE/PicardLindelof.lean#L785\">proof</a> from Mathlib/Analysis/ODE/PicardLindelof.lean that seems to sporadically generate a PANIC in <code>grind</code>.)</p>",
        "id": 570213350,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1769473712
    },
    {
        "content": "<p>Here's <a href=\"https://gist.github.com/kim-em/6c6f201a8e8d9592b3b7da44ad9053c8\">https://gist.github.com/kim-em/6c6f201a8e8d9592b3b7da44ad9053c8</a> which is a partial minimization of that theorem. It compiles <a href=\"https://live.lean-lang.org/#url=https%3A%2F%2Fgist.githubusercontent.com%2Fkim-em%2F6c6f201a8e8d9592b3b7da44ad9053c8%2Fraw%2F6732009e4e3fab40e59c831d9f21b0f0fa60c158%2Fgistfile1.txt\">fine</a>. After inlining the import <code>Mathlib.Analysis.Normed.Module.Multilinear.Basic</code> (i.e. just adding <code>section Mathlib.Analysis.Normed.Module.Multilinear.Basic</code> and <code>end Mathlib.Analysis.Normed.Module.Multilinear.Basic</code> at the top of the file, and moving the contents of <code>Mathlib.Analysis.Normed.Module.Multilinear.Basic</code> into that section, and moving the import statements back to the top of the file), the <a href=\"https://gist.github.com/kim-em/0c5a2467545300b6feba748ef842eb1a\">resulting file</a> fails to compile (see <a href=\"https://live.lean-lang.org/#url=https%3A%2F%2Fgist.githubusercontent.com%2Fkim-em%2F0c5a2467545300b6feba748ef842eb1a%2Fraw%2F2df33eb5c312118796256f1516db55ae435520ae%2Fgistfile1.txt\">live.lean-lang.org</a>) with an error</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">synthesize</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"kn\">class</span>\n<span class=\"w\">  </span><span class=\"n\">Norm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ContinuousMultilinearMap</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"n\">L</span><span class=\"o\">[</span><span class=\"n\">ùïú</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"n\">L</span><span class=\"o\">[</span><span class=\"n\">ùïú</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">ContinuousMultilinearMap</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span>\n\n<span class=\"n\">Hint</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">resolution</span><span class=\"w\"> </span><span class=\"n\">failures</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">inspected</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"ss\">`set_option</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"bp\">.</span>\n</code></pre></div>\n<p>at</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">norm_smulRightL_le</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚Äñ</span><span class=\"n\">smulRightL</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">‚Äñ</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">mkContinuous‚ÇÇ_norm_le</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">zero_le_one</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n</code></pre></div>",
        "id": 570213360,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1769473719
    },
    {
        "content": "<p>I'm a bit stumped how this can work before inlining but not afterwards. Assistance very much appreciated. Being able to reliably minimize test cases will really help the FRO help Mathlib!</p>",
        "id": 570213362,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1769473719
    },
    {
        "content": "<p>Mathlib has <code>maxSynthPendingDepth</code> set to 3 by default. It works if you add <code>set_option maxSynthPendingDepth 3 in</code> before the lemma.</p>",
        "id": 570221277,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1769479203
    },
    {
        "content": "<p>Nice catch! I will add this setting to the mathlib-minimizer lakefile.</p>",
        "id": 570222078,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1769479627
    }
]