[
    {
        "content": "<p>It seems that <code>to_additive</code> does not additivize matchers in a way that they are still recognized as such:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/--</span>\n<span class=\"sd\">info: def WithOne.recOneCoe.{u, u_1} : {α : Type u} →</span>\n<span class=\"sd\">  {C : WithOne α → Sort u_1} → C 1 → ((a : α) → C ↑a) → (n : WithOne α) → C n :=</span>\n<span class=\"sd\">fun {α} {C} h₁ h₂ x ↦</span>\n<span class=\"sd\">  match x with</span>\n<span class=\"sd\">  | none =&gt; h₁</span>\n<span class=\"sd\">  | some x =&gt; h₂ x</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">WithOne</span><span class=\"bp\">.</span><span class=\"n\">recOneCoe</span>\n<span class=\"sd\">/--</span>\n<span class=\"sd\">info: def WithZero.recZeroCoe.{u, u_1} : {α : Type u} →</span>\n<span class=\"sd\">  {C : WithZero α → Sort u_1} → C 0 → ((a : α) → C ↑a) → (n : WithZero α) → C n :=</span>\n<span class=\"sd\">fun {α} {C} h₁ h₂ x ↦ WithZero.instRepr.match_1 (fun x ↦ C x) x (fun _ ↦ h₁) fun x ↦ h₂ x</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">WithZero</span><span class=\"bp\">.</span><span class=\"n\">recZeroCoe</span>\n</code></pre></div>\n<p>Is this a known problem, or am I just the first to be bothered by this? <br>\nI haven’t looked yet, but I assume it’s just™ a matter of calling <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Meta.Match.Extension.addMatcherInfo#doc\">docs#Lean.Meta.Match.Extension.addMatcherInfo</a> in the right place.<br>\n(I don't mind the lack of pretty-printing, but I’m working on generating equational theorems also for non-recursive definition, and that needs to recognize matcher applications.)</p>",
        "id": 462569845,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1723734141
    },
    {
        "content": "<p>Yes, this is known and the bottom item here: <a href=\"https://github.com/leanprover-community/mathlib4/pull/1074\">#1074</a>. Please PR a fix if you know how to!<br>\nThe relevant lines where the additive declaration is added is here: <a href=\"https://github.com/leanprover-community/mathlib4/blob/master/Mathlib/Tactic/ToAdditive/Frontend.lean#L801-L805\">https://github.com/leanprover-community/mathlib4/blob/master/Mathlib/Tactic/ToAdditive/Frontend.lean#L801-L805</a></p>",
        "id": 462594786,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1723741489
    },
    {
        "content": "<p>Seem to be fairly straight-forward, it seems <a href=\"https://github.com/leanprover-community/mathlib4/commit/f11401e21dea90e60b0fe8bdb289fb1d067a4667\">https://github.com/leanprover-community/mathlib4/commit/f11401e21dea90e60b0fe8bdb289fb1d067a4667</a> sufficed.</p>\n<p>Plus the busywork of adding</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">ToAdditive</span><span class=\"bp\">/</span><span class=\"n\">Frontend</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ERR_NUM_LIN</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1700</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"n\">contains</span><span class=\"w\"> </span><span class=\"mi\">1504</span><span class=\"w\"> </span><span class=\"n\">lines</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">try</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">split</span><span class=\"w\"> </span><span class=\"n\">it</span><span class=\"w\"> </span><span class=\"n\">up</span>\n</code></pre></div>",
        "id": 462717144,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1723789841
    },
    {
        "content": "<p>PR'ed this at <a href=\"https://github.com/leanprover-community/mathlib4/pull/16026\">https://github.com/leanprover-community/mathlib4/pull/16026</a></p>",
        "id": 463998088,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1724233409
    }
]