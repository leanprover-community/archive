[
    {
        "content": "<p>Im currently proving some stuff about the <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Multiset/DershowitzManna.html\">DershowitzManna ordering extension</a><br>\nwhich extends an ordering on <code>a</code> to an ordering  on <code>Multiset a</code>.<br>\nThis extension has lots of nice properties in the sense that it transfers many properties from the order on <code>a</code> to the extension.<br>\nE.g. from <code>Preorder a</code> one gets<code>Partialorder (Multiset a)</code><br>\nand from <code>LinearOrder a</code> one gets <code>LinearOrder (Multiset a)</code>.</p>\n<p>I'm wondering if im doing the conditional LinearOrder def correctly - the LinearOrder should agree with the partialOrder if it exists.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">IsDershowitzMannaLT</span><span class=\"bp\">.</span><span class=\"n\">instPartialOrder</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Preorder</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PartialOrder</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiset</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">@</span><span class=\"n\">partialOrderOfSO</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">IsDershowitzMannaLT</span><span class=\"w\"> </span><span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">IsDershowitzMannaLT</span><span class=\"bp\">.</span><span class=\"n\">IsStrictOrder</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">IsDershowitzMannaLT</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrder</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LinearOrder</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LinearOrder</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiset</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toPartialOrder</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">IsDershowitzMannaLT</span><span class=\"bp\">.</span><span class=\"n\">instPartialOrder</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">  </span><span class=\"n\">toDecidableLE</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">linearOrderOfSTO</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiset</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">IsDershowitzMannaLT</span>\n<span class=\"w\">    </span><span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">IsDershowitzMannaLT</span><span class=\"bp\">.</span><span class=\"n\">IsStrictTotalOrder</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toDecidableLE</span>\n<span class=\"w\">  </span><span class=\"n\">le_total</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">linearOrderOfSTO</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">IsDershowitzMannaLT</span>\n<span class=\"w\">    </span><span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">IsDershowitzMannaLT</span><span class=\"bp\">.</span><span class=\"n\">IsStrictTotalOrder</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">le_total</span>\n<span class=\"w\">  </span><span class=\"n\">min</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">linearOrderOfSTO</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">IsDershowitzMannaLT</span>\n<span class=\"w\">    </span><span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">IsDershowitzMannaLT</span><span class=\"bp\">.</span><span class=\"n\">IsStrictTotalOrder</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">min</span>\n<span class=\"w\">  </span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">linearOrderOfSTO</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">IsDershowitzMannaLT</span>\n<span class=\"w\">    </span><span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">IsDershowitzMannaLT</span><span class=\"bp\">.</span><span class=\"n\">IsStrictTotalOrder</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">max</span>\n</code></pre></div>",
        "id": 575307458,
        "sender_full_name": "Moritz R",
        "timestamp": 1771855898
    },
    {
        "content": "<p>And one additional question:<br>\nI later need to pull back both of these defs via an injective function.<br>\nCan i just do the following (or will this get me any diamonds?)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- Literals are compared, by comparing `L1.toMultiset` and `L2.toMultiset` using</span>\n<span class=\"sd\">    the multiset extension. -/</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">priority</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">high</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">Literal</span><span class=\"bp\">.</span><span class=\"n\">instPartialOrder</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">PartialOrder</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Term</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">PartialOrder</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Literal</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">@</span><span class=\"n\">PartialOrder</span><span class=\"bp\">.</span><span class=\"n\">lift</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">    </span><span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">IsDershowitzMannaLT</span><span class=\"bp\">.</span><span class=\"n\">instPartialOrder</span>\n<span class=\"w\">    </span><span class=\"n\">Literal</span><span class=\"bp\">.</span><span class=\"n\">toMultiset</span>\n<span class=\"w\">    </span><span class=\"n\">Literal</span><span class=\"bp\">.</span><span class=\"n\">toMultiset_injective</span>\n\n<span class=\"sd\">/-- Literals are compared, by comparing `L1.toMultiset` and `L2.toMultiset` using</span>\n<span class=\"sd\">    the multiset extension. -/</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">priority</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">high</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">Literal</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrder</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LinearOrder</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Term</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">LinearOrder</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Literal</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">@</span><span class=\"n\">LinearOrder</span><span class=\"bp\">.</span><span class=\"n\">lift'</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">    </span><span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">IsDershowitzMannaLT</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrder</span>\n<span class=\"w\">    </span><span class=\"n\">Literal</span><span class=\"bp\">.</span><span class=\"n\">toMultiset</span>\n<span class=\"w\">    </span><span class=\"n\">Literal</span><span class=\"bp\">.</span><span class=\"n\">toMultiset_injective</span>\n</code></pre></div>",
        "id": 575308078,
        "sender_full_name": "Moritz R",
        "timestamp": 1771856065
    },
    {
        "content": "<p>This should be fine, since both lifts are abbrevs and the orders are in both cases defined using the same condition right?</p>",
        "id": 575308264,
        "sender_full_name": "Moritz R",
        "timestamp": 1771856118
    },
    {
        "content": "<p>You should tag your multiset defs with <code>instance_reducible</code></p>",
        "id": 575400056,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771881827
    },
    {
        "content": "<p>Can you exlain what that is needed for?</p>",
        "id": 576116476,
        "sender_full_name": "Moritz R",
        "timestamp": 1772137364
    },
    {
        "content": "<p>Should i always do this with defs that have a class type as the result?</p>",
        "id": 576116633,
        "sender_full_name": "Moritz R",
        "timestamp": 1772137413
    },
    {
        "content": "<p>This is needed so that lean can tell the two instances are the same without having to turn on more aggressive unfolding</p>",
        "id": 576116745,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1772137450
    }
]