[
    {
        "content": "<p>Why do we not have Subtype.prop as a simp lemma? Does it add major performance issues? It seems like a thing that would be useful but maybe that is naive.</p>",
        "id": 529863043,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1753096048
    },
    {
        "content": "<p>Probably because it's impossible to apply</p>",
        "id": 529863580,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1753096111
    },
    {
        "content": "<p>you can't infer the correct term of the subtype</p>",
        "id": 529863719,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1753096128
    },
    {
        "content": "<p>Right. It's just that if I already have an <code>x : Subtype p</code> in my context, I would quite like simp to know that <code>p ↑x</code> so it can apply lemmas with that as a hypothesis.</p>",
        "id": 529864208,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1753096187
    },
    {
        "content": "<p>huh i tried to make an example to show this but it works in my example!</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Is37</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"w\">  </span><span class=\"n\">eq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">37</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"n\">Is37</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">coe</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Is37</span><span class=\"bp\">.</span><span class=\"n\">val</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Is37</span><span class=\"bp\">.</span><span class=\"n\">coe_eq_37</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Is37</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">eq</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Is37</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Is37</span><span class=\"bp\">.</span><span class=\"n\">coe_eq_37</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 529865148,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1753096289
    },
    {
        "content": "<p>Hmm. What about <code>{x : Subtype (¬ p ·)}</code> - does it know that <code>\\not p ↑x</code>?</p>",
        "id": 529865529,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1753096331
    },
    {
        "content": "<p><code>Subtype.prop</code> unfortunately has a metavariable as head symbol, so it would have terrible performance most likely</p>",
        "id": 529865857,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1753096366
    },
    {
        "content": "<p>And I assume there's no way of fixing/avoiding that really?</p>",
        "id": 529866212,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1753096403
    },
    {
        "content": "<p>Broadly I am finding that the following very stupid lemmas might have a use.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidablePred</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">]</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">dite_of_subtype</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Subtype</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">dif_pos</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">dite_of_subtype_not</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Subtype</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">¬</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">dif_neg</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span>\n</code></pre></div>",
        "id": 529867154,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1753096502
    },
    {
        "content": "<p>Which feels real stupid. But simp kinda can't deal with that normally.</p>",
        "id": 529867336,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1753096522
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"330967\">@Wrenna Robson</span> but the lemmas you now proposed here are different from the general subtype prop lemma you asked in the beginning</p>",
        "id": 529868177,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1753096608
    },
    {
        "content": "<p>No, absolutely, but I was wondering if I was missing something and there was a simpler lemma that would be better.</p>",
        "id": 529868390,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1753096634
    },
    {
        "content": "<p>It seems to work?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Subtype</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">type_of</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span>\n</code></pre></div>",
        "id": 529870242,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1753097228
    },
    {
        "content": "<p>Hmm!</p>",
        "id": 529870312,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1753097255
    },
    {
        "content": "<p>that's different though, if you check <code>simp?</code> you'll see why</p>",
        "id": 529871565,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1753097701
    },
    {
        "content": "<p>in particular, the current issue is having <code>simp</code> work after <code>intros</code> in your example</p>",
        "id": 529872082,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1753097877
    },
    {
        "content": "<p>In what sense?</p>",
        "id": 529879499,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1753100690
    },
    {
        "content": "<p>in the sense that the above simp acts on <code>\\all x:{a// p a}, foo x</code> rather than on <code>foo x</code> with <code>x : {a//p a}</code></p>",
        "id": 529880059,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1753100873
    },
    {
        "content": "<p>My <code>dite_of_subtype</code>?</p>",
        "id": 529880142,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1753100908
    },
    {
        "content": "<p>It does seem to work for me after intros.</p>",
        "id": 529880176,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1753100921
    },
    {
        "content": "<p>i think Aaron meant that the example works with current mathlib, and i wanted to point out that that's only before <code>intros</code> and when the subtype value is a variable. i wasn't commenting on your <code>dite_of_subtype</code></p>",
        "id": 529881408,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1753101307
    },
    {
        "content": "<p>aha, thanks</p>",
        "id": 529881448,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1753101317
    }
]