[
    {
        "content": "<p>Recently, <code>lake exe cache get</code> started complaining because in my local mathlib git directory, the upstream mathlib4 remote was not named <code>origin</code>. This is a sane default for most use cases, but is it mandatory? Is there an environment variable I can set to override this?</p>",
        "id": 521691600,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1748855916
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span> , is this something you know about?</p>",
        "id": 521691780,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1748855960
    },
    {
        "content": "<p>More precisely, I get</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span>\n<span class=\"n\">uncaught</span><span class=\"w\"> </span><span class=\"n\">exception</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">Git</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">determine</span><span class=\"w\"> </span><span class=\"n\">Mathlib's</span><span class=\"w\"> </span><span class=\"n\">repository</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">exit</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"bp\">.</span>\n<span class=\"n\">Ensure</span><span class=\"w\"> </span><span class=\"n\">Git</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">installed</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">Mathlib's</span><span class=\"w\"> </span><span class=\"ss\">`origin</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">remote</span><span class=\"w\"> </span><span class=\"n\">points</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">its</span><span class=\"w\"> </span><span class=\"n\">GitHub</span><span class=\"w\"> </span><span class=\"n\">repository</span><span class=\"bp\">.</span>\n<span class=\"n\">Stdout</span><span class=\"o\">:</span>\n\n<span class=\"n\">Stderr</span><span class=\"o\">:</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">No</span><span class=\"w\"> </span><span class=\"n\">such</span><span class=\"w\"> </span><span class=\"n\">remote</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">origin'</span>\n</code></pre></div>",
        "id": 521692075,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1748856033
    },
    {
        "content": "<p>(This only happens in my mathlib4 local worktrees, downstream projects are of course fine.)</p>",
        "id": 521693094,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1748856310
    },
    {
        "content": "<p>There is a --repo flag I think</p>",
        "id": 521696234,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748857135
    },
    {
        "content": "<p>Both <code>lake exe cache get --repo </code> and <code>lake exe cache --repo get</code> seem to fail, so I don’t think there is.</p>",
        "id": 521696742,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1748857299
    },
    {
        "content": "<p>Culprit is <a href=\"https://github.com/leanprover-community/mathlib4/pull/25211\">#25211</a> I think</p>",
        "id": 521696905,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1748857344
    },
    {
        "content": "<p><code>Cache.Requests.getRemoteRepo</code> hardcodes <code>origin</code> and does not seem to allow anything else through an option. I’ll make a PR introducing an environment variable.</p>",
        "id": 521697413,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1748857489
    },
    {
        "content": "<p>That function is only called if the flag is not set</p>",
        "id": 521698245,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748857707
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"c1\">--repo=https://github.com/leanprover-community/mathlib4</span>\n<span class=\"n\">Invalid</span><span class=\"w\"> </span><span class=\"n\">argument</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">non</span><span class=\"bp\">-</span><span class=\"n\">existing</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"c1\">--repo=https:/github.com/leanprover-community/mathlib4</span>\n</code></pre></div>\n<p>What am I doing wrong here? (Also of  course, <code>lake exe cache get --repo=.</code> does not work).</p>",
        "id": 521699348,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1748858012
    },
    {
        "content": "<p>(also <code>lake exe cache get --repo \"...\"</code> seems like invalid syntax. <del>This is not exactly standard command line arguments parsing here.</del> my bad, it in fact is, I thought I knew some CLI that allowed <code>--arg value</code>.)</p>",
        "id": 521699608,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1748858070
    },
    {
        "content": "<p>(I stand by my proposal to make this configurable by an environment variable: this would save typing <code>--repo=...</code> at every call).</p>",
        "id": 521699993,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1748858162
    },
    {
        "content": "<p>I think <code>lake exe cache --repo=https://github.com/leanprover-community/mathlib4 get</code></p>",
        "id": 521714361,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748862172
    },
    {
        "content": "<p>Documenting this flag somewhere would be nice. It’s not mentionned in <code>lake exe cache --help</code>, and both <code>lake exe cache get --help</code> and <code>lake exe cache --help get</code> are invalid.</p>",
        "id": 521714858,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1748862328
    },
    {
        "content": "<p>I confirmed that it works, thanks!</p>",
        "id": 521720143,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1748863937
    },
    {
        "content": "<p>(It's a bit unfortunate that <code>lake exe cache</code> requires the <code>--repo</code> flag before <code>get</code>. If someone wants to have <code>cache</code> use <code>lean4-cli</code> this could easily be fixed.)</p>",
        "id": 521732099,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1748867125
    },
    {
        "content": "<p>(but how will I get the cache for my file called <code>--repo</code>? <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span>)</p>",
        "id": 521735297,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748867917
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Lake.20exe.20cache.20get.20with.20other.20git.20remote.20name.3F/near/521714361\">said</a>:</p>\n<blockquote>\n<p>I think <code>lake exe cache --repo=https://github.com/leanprover-community/mathlib4 get</code></p>\n</blockquote>\n<p>It's <code>lake exe cache --repo=leanprover-community/mathlib4 get</code>.</p>",
        "id": 521741532,
        "sender_full_name": "Mac Malone",
        "timestamp": 1748869439
    }
]