[
    {
        "content": "<p>As I understand it, there's two different spellings for \"multiply a polynomial by the inverse of its leading coefficient, which are <code>C p.leadingCoeff⁻¹ * p</code> and <code>normalize p</code>. There's even lemmas written about both, such as <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Polynomial.monic_mul_leadingCoeff_inv#doc\">docs#Polynomial.monic_mul_leadingCoeff_inv</a> vs <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Polynomial.monic_normalize#doc\">docs#Polynomial.monic_normalize</a>.</p>",
        "id": 535751905,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1755894690
    },
    {
        "content": "<p>Is there any difference between these? If so, when should I prefer one over the other? If not, why have both?</p>",
        "id": 535751943,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1755894704
    },
    {
        "content": "<p>It seems that <code>normalize p</code> better captures the semantics, so unless it's weaker somehow, I'd standardize on that</p>",
        "id": 535753081,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1755895191
    },
    {
        "content": "<p>I notice <code>monic_normalize</code> requires a field while <code>monic_mul_leadingCoeff_inv</code> only requires a division ring</p>",
        "id": 535755910,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1755896707
    },
    {
        "content": "<p>In fact, <code>normalize</code> itself requires commutativity</p>",
        "id": 535756097,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1755896801
    },
    {
        "content": "<p>In that case, use the other one :)</p>",
        "id": 535757239,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1755897434
    },
    {
        "content": "<p>in that case, change <code>normalize</code></p>",
        "id": 535788879,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755934321
    },
    {
        "content": "<p>aha, we can't change that because it's actually a general <code>normalize</code> for NormalizationMonoid</p>",
        "id": 535789026,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755934529
    },
    {
        "content": "<p>in that case, maybe we should make <code>Polynomial.normalize</code>?</p>",
        "id": 535789035,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755934542
    },
    {
        "content": "<p>or... what if we changed NormalizationMonoid to not assume comm? I might be cooking here</p>",
        "id": 535789103,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755934601
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=NormalizationMonoid#doc\">docs#NormalizationMonoid</a></p>",
        "id": 535789141,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1755934653
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span>\n\n<span class=\"sd\">/-- Normalization monoid: multiplying with `normUnit` gives a normal form for associated</span>\n<span class=\"sd\">elements. -/</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">NormalizationMonoid'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CancelMonoidWithZero</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- `normUnit` assigns to each element of the monoid a unit of the monoid. -/</span>\n<span class=\"w\">  </span><span class=\"n\">normUnit</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"bp\">ˣ</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The proposition that `normUnit` maps `0` to the identity. -/</span>\n<span class=\"w\">  </span><span class=\"n\">normUnit_zero</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">normUnit</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The proposition that `normUnit` respects multiplication of non-zero elements. -/</span>\n<span class=\"w\">  </span><span class=\"n\">normUnit_mul</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">normUnit</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">normUnit</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">normUnit</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The proposition that `normUnit` maps units to their inverses. -/</span>\n<span class=\"w\">  </span><span class=\"n\">normUnit_coe_units</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"bp\">ˣ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">normUnit</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"bp\">⁻¹</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">NormalizationMonoid'</span>\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">normUnit_zero</span><span class=\"w\"> </span><span class=\"n\">normUnit_mul</span><span class=\"w\"> </span><span class=\"n\">normUnit_coe_units</span>\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">NormalizationMonoid'</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">NormalizationMonoid'</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsDomain</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormalizationMonoid'</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">NormalizationMonoid'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Polynomial</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">normUnit</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"bp\">⟨</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">normUnit</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">leadingCoeff</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">normUnit</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">leadingCoeff</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">RingHom</span><span class=\"bp\">.</span><span class=\"n\">map_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Units</span><span class=\"bp\">.</span><span class=\"n\">mul_inv</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">C_1</span><span class=\"o\">],</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">RingHom</span><span class=\"bp\">.</span><span class=\"n\">map_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Units</span><span class=\"bp\">.</span><span class=\"n\">inv_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">C_1</span><span class=\"o\">]</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"n\">normUnit_zero</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Units</span><span class=\"bp\">.</span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">normUnit_mul</span><span class=\"w\"> </span><span class=\"n\">hp0</span><span class=\"w\"> </span><span class=\"n\">hq0</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"n\">Units</span><span class=\"bp\">.</span><span class=\"n\">ext</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"n\">dsimp</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ne</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">leadingCoeff_eq_zero</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"bp\">*</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">leadingCoeff_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">normUnit_mul</span><span class=\"w\"> </span><span class=\"n\">hp0</span><span class=\"w\"> </span><span class=\"n\">hq0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Units</span><span class=\"bp\">.</span><span class=\"n\">val_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">C_mul</span><span class=\"o\">])</span>\n<span class=\"w\">  </span><span class=\"n\">normUnit_coe_units</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"n\">Units</span><span class=\"bp\">.</span><span class=\"n\">ext</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"n\">dsimp</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">mul_one</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"bp\">⁻¹</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Units</span><span class=\"bp\">.</span><span class=\"n\">val_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Units</span><span class=\"bp\">.</span><span class=\"n\">eq_inv_mul_iff_mul_eq</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">rcases</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span><span class=\"bp\">.</span><span class=\"n\">isUnit_iff</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"bp\">⟨_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">w</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"bp\">⟩</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"bp\">⟩</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">leadingCoeff_C</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">NormalizationMonoid'</span><span class=\"bp\">.</span><span class=\"n\">normUnit_coe_units</span><span class=\"o\">,</span>\n<span class=\"w\">          </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">C_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Units</span><span class=\"bp\">.</span><span class=\"n\">mul_inv</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">C_1</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">rfl</span><span class=\"o\">)</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span>\n</code></pre></div>",
        "id": 535790176,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755936040
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"459227\">@Violeta Hernández</span> this seems to work fine</p>",
        "id": 535790180,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755936044
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Normalize.20polynomial/near/535789103\">said</a>:</p>\n<blockquote>\n<p>or... what if we changed NormalizationMonoid to not assume comm? I might be cooking here</p>\n</blockquote>\n<p>You're right, I don't see a reason for it to require commutativity. For any division ring you should be able to define an instance by sending a nonzero element to its inverse.</p>",
        "id": 535790185,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1755936047
    },
    {
        "content": "<p>Nerd-sniped</p>",
        "id": 535790194,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1755936060
    },
    {
        "content": "<p>XD</p>",
        "id": 535790196,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755936061
    },
    {
        "content": "<p>(just remember to change <code>a*b</code> to <code>b*a</code> as i did above)</p>",
        "id": 535790225,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755936094
    },
    {
        "content": "<p>Well, I think there's now two proposed PRs:</p>\n<ul>\n<li>generalize <code>NormalizationMonoid</code> to the noncomm case</li>\n<li>use <code>normalize p</code>for polynomials  instead of the explicit form throughout</li>\n</ul>",
        "id": 535790318,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1755936189
    },
    {
        "content": "<p>I could try a) tomorrow, though maybe you want to get ahead of me.</p>",
        "id": 535790342,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1755936221
    },
    {
        "content": "<p>i'll leave that to you</p>",
        "id": 535790363,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755936252
    },
    {
        "content": "<p>and 3rd PR: prove that every division ring is a normalization monoid</p>",
        "id": 535790466,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755936396
    },
    {
        "content": "<p>or actually, group with zero?</p>",
        "id": 535790478,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755936409
    }
]