[
    {
        "content": "<p>Why does <code>enorm_zero</code> fails when using it like in this mwe? It also means that <code>simp</code> doesn't close goals that I think it should easily do.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedField</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SeminormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedSpace</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">T2Space</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">]</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚Äñ</span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">)</span><span class=\"bp\">‚Äñ‚Çë</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">enorm_zero</span>\n<span class=\"w\">  </span><span class=\"c1\">-- Fails: typeclass instance problem is stuck, it is often due to metavariables</span>\n<span class=\"w\">  </span><span class=\"c1\">-- ENormedAddMonoid ?m.6292</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">enorm_zero</span>\n<span class=\"c1\">-- enorm_zero.{u_8} {E : Type u_8} [TopologicalSpace E] [ENormedAddMonoid E] : ‚Äñ0‚Äñ‚Çë = 0</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚Äñ</span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">)</span><span class=\"bp\">‚Äñ‚Çë</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ofReal_norm_eq_enorm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">simp_all</span>\n<span class=\"w\">  </span><span class=\"c1\">-- This ridiculous approach works.</span>\n</code></pre></div>",
        "id": 520836687,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1748422115
    },
    {
        "content": "<p><code>enorm_zero</code> wants a <code>ENormedAddMonoid</code>, but you only have <code>SeminormedAddCommGroup</code>.</p>",
        "id": 520838114,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1748422588
    },
    {
        "content": "<p>I don't know the first thing about this part of the library but two observations: (1) are you sure you want both <code>SeminormedAddCommGroup V</code> and <code>SeminormedGroup V</code>? They are surely putting two unrelated norms on <code>V</code> with the same notation, so you don't know which one you're getting and (2) isn't the convention that the difference between \"norm\" and \"seminorm\" is that a seminorm can have nonzero things with norm zero? (sorry if this is nonsense). If so then <code>enorm_zero</code> isn't strong enough for you.</p>",
        "id": 520838154,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748422608
    },
    {
        "content": "<p>Have you tried writing an <code>enorm_zero'</code> lemma which eats a seminormed object and proves |0|=0 using your \"ridiculous\" proof? Note that <code>simp_all?</code> reveals that it's using <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=norm_zero#doc\">docs#norm_zero</a> which only needs <code>SeminormedAddGroup</code>.</p>",
        "id": 520838508,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748422736
    },
    {
        "content": "<p>I agree with the two norms, but <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=enorm_zero#doc\">docs#enorm_zero</a> is true even for seminormed thing, isn't it? It's the easy direction</p>",
        "id": 520838603,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1748422770
    },
    {
        "content": "<p>Right, maybe <code>enorm_zero</code> can be strengthened, but the thing to do is to try and strengthen it and either succeed and make a PR or fail and understand what's going on :-)</p>",
        "id": 520838964,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748422881
    },
    {
        "content": "<p>For example maybe <code>ESeminormedAddCommGroup</code>s don't exist or something.</p>",
        "id": 520839089,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748422917
    },
    {
        "content": "<p>Well, we don't have any <code>ESemiblahblah</code></p>",
        "id": 520839137,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1748422925
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/enorm_zero.20oddities/near/520838154\">said</a>:</p>\n<blockquote>\n<p>(1) are you sure you want both <code>SeminormedAddCommGroup V</code> and <code>SeminormedGroup V</code>? They are surely putting two unrelated norms on <code>V</code> with the same notation, so you don't know which one you're getting </p>\n</blockquote>\n<p>Absolutely, I've removed <code>[SeminormedGroup V]</code>. It came from something ages ago, I didn't delete it when I should have and I didn't see it when copying here.</p>",
        "id": 520839143,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1748422926
    },
    {
        "content": "<p>So, in the second example you move from the extended norm to a standard norm and then the library works</p>",
        "id": 520839316,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1748422991
    },
    {
        "content": "<p>OK so it sounds like the fix is a huge PR with all the boilerplate for <code>ESeminormedMonoid</code>s.</p>",
        "id": 520839333,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748422998
    },
    {
        "content": "<p>Presumably if you are taking enorms of seminormed objects then this is the class you want?</p>",
        "id": 520839721,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748423131
    },
    {
        "content": "<p>The simple fix is to assume <code>[NormedAddCommGroup V]</code>. Is that enough for your applications?</p>",
        "id": 520840421,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1748423363
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130384\">Riccardo Brasca</span> <a href=\"#narrow/channel/287929-mathlib4/topic/enorm_zero.20oddities/near/520838114\">said</a>:</p>\n<blockquote>\n<p><code>enorm_zero</code> wants a <code>ENormedAddMonoid</code>, but you only have <code>SeminormedAddCommGroup</code>.</p>\n</blockquote>\n<p>A <code>NormedAddGroup</code> is an <code>ENormedAddMonoid</code> --- the \"seminormed\" part is confusing Lean. (edit: oh, that's basically what S√©bastien says)</p>",
        "id": 520840481,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1748423385
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110050\">S√©bastien Gou√´zel</span> <a href=\"#narrow/channel/287929-mathlib4/topic/enorm_zero.20oddities/near/520840421\">said</a>:</p>\n<blockquote>\n<p>The simple fix is to assume <code>[NormedAddCommGroup V]</code>. Is that enough for your applications?</p>\n</blockquote>\n<p>Another fix is to add a lemma stating that <code>‚Äñ0‚Äñ‚Çë = 0</code> at the beginning of the document using the proof of the fact following the second example. But this is ugly in every possible way! <span aria-label=\"scream\" class=\"emoji emoji-1f631\" role=\"img\" title=\"scream\">:scream:</span> </p>\n<p>Another option would have been to use <code>ENNReal.ofReal ‚ÄñŒº‚Äñ</code>. This is what we had previously but I recently swapped it for <code>‚ÄñŒº‚Äñ‚Çë</code> when I saw that mathlib had that.</p>\n<p>We are using this to define total variation for VectorMeasures as a supremum (which in turn is required for complex RMK which in turn is required for the spectral theorem). It seemed best to define variation as generally as possible, even thought we only want it for complex measures at the moment.</p>",
        "id": 520841883,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1748423790
    },
    {
        "content": "<p>Why are you saying that this is ugly? This just looks like any other API lemma. There are plenty of two-line proofs in mathlib of things which would take 0 lines on the board. Just add it to the library if you want it?</p>",
        "id": 520842682,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748424050
    },
    {
        "content": "<p>Since you are assuming that your space is a <code>[NormedSpace ùïú V]</code>, there is no added generality in assuming <code>[SeminormedAddCommGroup V]</code> over <code>[NormedAddCommGroup V]</code> (since you have a negation coming from multiplication by <code>-1</code>). That's the reason why in this area of mathlib the standing assumption is <code>[NormedAddCommGroup V]</code>.</p>",
        "id": 520842729,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1748424062
    },
    {
        "content": "<p>Aah so in fact the answer is \"you're doing it wrong\"?</p>",
        "id": 520842877,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748424110
    },
    {
        "content": "<p>I tried to say that more gently, Kevin ! <span aria-label=\"smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 520843009,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1748424147
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/enorm_zero.20oddities/near/520842877\">said</a>:</p>\n<blockquote>\n<p>Aah so in fact the answer is \"you're doing it wrong\"?</p>\n</blockquote>\n<p>Always, but my speed of doing things wrong means speed of learning the right way.</p>",
        "id": 520843169,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1748424204
    },
    {
        "content": "<p>Thanks so much for all the help! I'll change it as Sebastien suggests.</p>",
        "id": 520843225,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1748424219
    },
    {
        "content": "<p>In conclusion, I learnt (again) that I should actually read and think mathematically about the assumptions scattered in the file. </p>\n<p>After paying attention to the full task at hand reasonable assumptions are <code>[TopologicalSpace V] [ENormedAddCommMonoid V]</code> which makes the detail I was asking about and everything else work. (Although several of the <code>enorm</code> results in mathlib needed to be updated to weaker conditions in PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/25371\">#25371</a>.)</p>",
        "id": 522520477,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1749109005
    }
]