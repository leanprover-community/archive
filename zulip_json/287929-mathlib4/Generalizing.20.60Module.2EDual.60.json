[
    {
        "content": "<p>At the moment <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Module.Dual#doc\">docs#Module.Dual</a> uses <code>CommSemiring</code>, but I think it would be better if we had this for <code>Semiring</code>. It would be useful to have things in terms of <code>Dual R M</code> instead of <code>M →ₗ[R] R</code>.</p>\n<p>Is there any objections to changing this to use <code>Semiring</code>?</p>",
        "id": 553889769,
        "sender_full_name": "Monica Omar",
        "timestamp": 1762356917
    },
    {
        "content": "<p>That change seems pretty agreeable to me</p>",
        "id": 553889936,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1762356956
    },
    {
        "content": "<p>I've opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/31289\">#31289</a> for this :)</p>",
        "id": 553891107,
        "sender_full_name": "Monica Omar",
        "timestamp": 1762357209
    },
    {
        "content": "<p>note that this is a right R-module i think?</p>",
        "id": 553892309,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1762357455
    },
    {
        "content": "<p>the formula is <code>Hom : A-B-Mod x A-C-Mod -&gt; B-C-Mod</code></p>",
        "id": 553892436,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1762357481
    },
    {
        "content": "<p>with <code>M : R-Nat-Mod</code> and <code>R : R-R-Mod</code></p>",
        "id": 553892568,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1762357506
    },
    {
        "content": "<p>Usually, in <del>non-symmetric monoidal categories (such as modules over a non-commutative (semi)-ring</del> &lt;- it's only monoidal if we do bimodules) non-commutative settings you want to distinguish between left and right (weak) duals. If we generalize, the docstrings should perhaps add which direction it is the dual of (I always get confused by the directions here... <a href=\"https://mathoverflow.net/questions/339262/dual-of-a-bimodule\">this</a> might be relevant as the natural setting for this is by thinking of everything as bimodules I believe, though we need to ignore the \"projective\" part in the accepted answer.)</p>",
        "id": 553893211,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1762357645
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"238446\">@Anne Baanen</span> , to answer your question in the PR.<br>\nHere is an example of what motivated this: I wanted to add that given a nonzero element <code>x</code> in a vector space (by vector space I mean a module over a semiring), there exists a dual <code>f</code> such that <code>f x</code> is nonzero.<br>\n(See here: <a href=\"https://github.com/leanprover-community/mathlib4/pull/28100/files#r2494755205\">https://github.com/leanprover-community/mathlib4/pull/28100/files#r2494755205</a>.)<br>\nWhich is the linear map version of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=SeparatingDual.exists_ne_zero#doc\">docs#SeparatingDual.exists_ne_zero</a>.</p>\n<p>Also, note that <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=StrongDual#doc\">docs#StrongDual</a> uses <code>Semiring</code>.</p>",
        "id": 553906443,
        "sender_full_name": "Monica Omar",
        "timestamp": 1762360473
    },
    {
        "content": "<p>But it's not true that given a random nonzero module over a random semiring that there even exists a nonzero map from the module to the semiring, let alone one that does not vanish on a given nonzero element. What exactly is the statement what you want to add?</p>",
        "id": 553929745,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1762366039
    },
    {
        "content": "<p>Right, I forgot to say that it's \"free\". Here's the full statement:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">exists_dual_ne_zero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Free</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">→ₗ</span><span class=\"o\">[</span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n</code></pre></div>",
        "id": 553930159,
        "sender_full_name": "Monica Omar",
        "timestamp": 1762366177
    },
    {
        "content": "<p>Aah yeah, then you're fine. I am assuming that generalizing Dual to the noncommutative case will not stop us adding the R-module instance when R is commutative? Will probably be worth benchmarking afterwards to see if any chaos has been caused by this change.</p>",
        "id": 553930842,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1762366337
    },
    {
        "content": "<p>Don't see why not. Just benched it, let's see.</p>",
        "id": 553931573,
        "sender_full_name": "Monica Omar",
        "timestamp": 1762366523
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Generalizing.20.60Module.2EDual.60/near/553930842\">said</a>:</p>\n<blockquote>\n<p>Aah yeah, then you're fine. I am assuming that generalizing Dual to the noncommutative case will not stop us adding the R-module instance when R is commutative? Will probably be worth benchmarking afterwards to see if any chaos has been caused by this change.</p>\n</blockquote>\n<p>Worried about possible diamonds</p>",
        "id": 553934495,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762367462
    },
    {
        "content": "<p>what kind of diamonds?</p>",
        "id": 553944204,
        "sender_full_name": "Monica Omar",
        "timestamp": 1762370410
    },
    {
        "content": "<p>I don't see any diamonds risk here</p>",
        "id": 554026578,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1762416870
    },
    {
        "content": "<p>I think the only risk is the one <span class=\"user-mention\" data-user-id=\"238446\">@Anne Baanen</span> calls out about this representing a choice to have <code>Dual</code> mean \"left dual\" (and this being surprising), but indeed it seems we already made this choice for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=StrongDual#doc\">docs#StrongDual</a> so may as well be consistent for now</p>",
        "id": 554026813,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1762416953
    },
    {
        "content": "<p>\"left dual\" is only a thing when there are both left and right actions, right? I didn't understand this objection.</p>",
        "id": 554204534,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1762470107
    },
    {
        "content": "<p>Should we change all forms of <code>M →ₗ[R] R</code> to <code>Dual R M</code>?<br>\nFor example, there's <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Module.Basis.coord#doc\">docs#Module.Basis.coord</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Module.Basis.sumCoords#doc\">docs#Module.Basis.sumCoords</a> (and a lot more).</p>",
        "id": 554486433,
        "sender_full_name": "Monica Omar",
        "timestamp": 1762612044
    }
]