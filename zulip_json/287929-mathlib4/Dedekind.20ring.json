[
    {
        "content": "<p>We have the following in mathlib, but this looks very suspicious to me</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- A Dedekind ring is a commutative ring that is Noetherian, integrally closed, and</span>\n<span class=\"sd\">has Krull dimension at most one.</span>\n<span class=\"sd\">This is exactly `IsDedekindDomain` minus the `IsDomain` hypothesis. -/</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">IsDedekindRing</span>\n<span class=\"w\">  </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">IsNoetherian</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">DimensionLEOne</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">IsIntegralClosure</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FractionRing</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n</code></pre></div>\n<p>Are arbitrary artinian rings supposed to be dedekind rings?</p>\n<p>Furthermore, <code>Ring.DimensionLEOne</code> is a deceiving name too because its implementation is </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- A ring `R` has Krull dimension at most one if all nonzero prime ideals are maximal. -/</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Ring</span><span class=\"bp\">.</span><span class=\"n\">DimensionLEOne</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">maximalOfPrime</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ideal</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"bp\">⊥</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">IsPrime</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">IsMaximal</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>which is very wrong for non-domains.</p>\n<p>Hence, under our definitions <code>IsDedekindRing R ↔ IsDedekindDomain R ∨ IsArtinianRing R</code>.<br>\nI cannot find a good reference on non-domain dedekind rings to say for sure, but I really don't think this is what we were trying to describe with this typeclass.</p>\n<p>So, what's the fix here (of both <code>IsDedekindRing</code> and <code>Ring.DimensionLEOne</code>)?</p>",
        "id": 490122763,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1734686480
    },
    {
        "content": "<p>Maybe <code>Ring.DimensionLEOne</code> stems from before we had <code>krullDim</code>?</p>",
        "id": 490124152,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1734687010
    },
    {
        "content": "<p>Yeah I think so. But the question is then: Is it saying what it wants to say with the wrong name, or should the definition be changed, or maybe just add a <code>IsDomain R</code> and pretend everything is fine?</p>",
        "id": 490131268,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1734689749
    },
    {
        "content": "<p>I feel like the predicate is a useful one. So maybe we need a better name.</p>",
        "id": 490131726,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1734689928
    },
    {
        "content": "<p>For <code>DimensionLEOne</code> your point is that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">Z</mi><mo stretchy=\"false\">[</mo><mi>X</mi><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">/</mi><mo stretchy=\"false\">(</mo><msup><mi>X</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Z}[X]/(X^2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord mathbb\">Z</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mclose\">]</span><span class=\"mord\">/</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> has dimension 1 but not <code>DimensionLEOne</code>, so this should definitely be fixed. I'm not sure what a good definition is -- maybe \"P &lt;= Q &lt;= R implies P=Q or Q=R\" (for prime ideals)? for Dedekind rings my instinct is that this is a mathlibism, do people really talk about Dedekind rings which aren't Dedekind domains in the literature?</p>",
        "id": 490135852,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1734691417
    },
    {
        "content": "<p>Whatever the intention of DedekindRing was, it's hard to imagine that it has been correctly implemented. For example <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">Z</mi><mo>×</mo><mi mathvariant=\"double-struck\">Z</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Z}\\times\\mathbb{Z}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7722em;vertical-align:-0.0833em;\"></span><span class=\"mord mathbb\">Z</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">Z</span></span></span></span> doesn't look like it's going to be a Dedekind ring because it doesn't have DimensionLEOne.</p>",
        "id": 490136181,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1734691527
    },
    {
        "content": "<p>I'm guessing that the idea was \"smooth affine possibly-not-connected curve\"?</p>",
        "id": 490136343,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1734691576
    },
    {
        "content": "<p>So <a href=\"#narrow/channel/113488-general/topic/Should.20.60IsDedekindDomain.60.20extend.20.60IsDomain.60.3F/near/374513253\">this</a> seems to be the relevant thread. Seems like the initial motivation was just that because we already have <code>IsDomain</code> it was annoying to have to write <code>IsDedekindDomain</code> <em>as well</em>, so the idea was to split it off. It's not clear to me that there were any planned applications of <code>IsDedekindRing</code> beyond domains.</p>",
        "id": 490136966,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1734691858
    },
    {
        "content": "<p>in Bosch, Lutkebohmert, Raynaud, they work with more general Dedekind rings than domains. On the other hand, their local rings are either fields or dvr.</p>",
        "id": 490162143,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1734701706
    },
    {
        "content": "<p>I just checked. I was slightly wrong: they talk about <em>Dedekind schemes</em>, which are defined as Noetherian, normal schemes of dimension at most 1. I could find 6 occurrences of the expression <em>Dedekind ring</em> in their book, and 2 occurrences of <em>Dedekind domain</em>; in all cases, they write something like “over a field or a Dedekind [domain|ring]”, which seems to imply that Dedekind rings are not fields.</p>",
        "id": 490165304,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1734702851
    },
    {
        "content": "<p>To fix <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Ring.DimensionLEOne#doc\">docs#Ring.DimensionLEOne</a> we might say any prime is either maximal or minimal, using <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=minimalPrimes#doc\">docs#minimalPrimes</a>. We might introduce DimensionLEZero simultaneously.</p>",
        "id": 490165754,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1734703004
    },
    {
        "content": "<p>I just checked the definition in Bourbaki for whom a Dedekind ring is a Krull ring of which all nonzero prime ideals are maximal. (A Krull ring is an integral domain which is defined by a set of discrete valuations on its field of fractions) With their definition, a field is a Dedekind ring.</p>",
        "id": 490166451,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1734703214
    },
    {
        "content": "<p>The context is precisely me trying to introduce such a dim = 0 typeclass and running to a naming conflict with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Ideal.IsPrime.isMaximal#doc\">docs#Ideal.IsPrime.isMaximal</a></p>",
        "id": 490166643,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1734703271
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Ideal.IsPrime.isMaximal#doc\">docs#Ideal.IsPrime.isMaximal</a> (lowercase i after the last dot)</p>",
        "id": 490166988,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1734703376
    },
    {
        "content": "<p>(and the PR is <a href=\"https://github.com/leanprover-community/mathlib4/pull/20108\">#20108</a>; almost done)</p>",
        "id": 490167071,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1734703406
    },
    {
        "content": "<p>Regarding dimension: we have an ordered set, the set of prime ideals, and the dimension is that of this ordered set. So I believe that the <code>dimension_le_one</code>should just be an abbreviation to a similar predicate on ordered sets. Given the difficulty of deciding the value of the dimension of an infinite dimensional thing (0 or infinity?), the above suggestion of <span class=\"user-mention\" data-user-id=\"224323\">@Junyan Xu</span> would be perfect.</p>",
        "id": 490167676,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1734703596
    },
    {
        "content": "<p>(It could easily be generalized to <code>dimension_le_nat</code>…)</p>",
        "id": 490167718,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1734703616
    },
    {
        "content": "<p>Mathlib has the theory for general ordered sets <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Order.krullDim#doc\">docs#Order.krullDim</a>, and it takes value in natural numbers as well as <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>±</mo><mi mathvariant=\"normal\">∞</mi></mrow><annotation encoding=\"application/x-tex\">\\pm\\infty</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord\">±</span><span class=\"mord\">∞</span></span></span></span>. The specialization to comm. rings is <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ringKrullDim#doc\">docs#ringKrullDim</a>. Andrew's PR proves <code>RingKrullDimZero R ↔ ringKrullDim R = 0</code> assuming Nontrivial, and it should also be true that <code>RingKrullDimZero R ↔ ringKrullDim R ≤ 0</code> without that assumption, so DimensionLEZero is probably a more appropriate name and it aligns with DimensionLEOne.</p>",
        "id": 490169696,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1734704263
    },
    {
        "content": "<p>I think I'll pause that PR for now because I like Antoine's suggestion more.</p>",
        "id": 490170061,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1734704401
    },
    {
        "content": "<p>So you're going to refactor DimensionLEOne? That might be a good idea. I've heard people are introducing <a href=\"#narrow/channel/335062-homology/topic/Derived.20categories.20in.20mathlib/near/443446179\">ProjectiveDimensionLE</a> too.</p>",
        "id": 490170848,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1734704655
    },
    {
        "content": "<p><a href=\"https://stacks.math.columbia.edu/tag/00KH\">Stacks' proof</a> of Noetherian + zero-dim -&gt; Artinian is a bit complicated but would be much easier using (Akizuki's commutative version of) <a href=\"https://github.com/leanprover-community/mathlib4/pull/17908/files#diff-b3215bbbbec31e2687f1ba2bc6f76d6b9dc8ed8b23256275de14e51e925f67a2R117-R118\">Hopkins--Levitzki</a>, because it's easy to show a Noetherian ring of zero dimension is semiprimary. (It's essentially the same proof.)</p>",
        "id": 490171649,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1734704905
    },
    {
        "content": "<p>I have that proof here <a href=\"https://github.com/leanprover-community/mathlib4/pull/20096\">#20096</a>. I did it 3 years ago in lean3 so I don't remember what proof I followed though.</p>",
        "id": 490172585,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1734705212
    }
]