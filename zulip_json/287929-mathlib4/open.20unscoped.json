[
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/31086\">#31086</a> introduces a new syntax:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">unscoped</span><span class=\"w\"> </span><span class=\"n\">Foo1</span><span class=\"w\"> </span><span class=\"n\">Foo2</span><span class=\"w\"> </span><span class=\"n\">Foo3</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n</code></pre></div>\n<p>which opens the namespaces without activating its scope (i.e. instances or notations)</p>\n<p>Example usage:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">pi</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">3</span>\n<span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"π\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pi</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">unscoped</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">pi</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">π</span><span class=\"w\"> </span><span class=\"c1\">-- error</span>\n</code></pre></div>",
        "id": 547890530,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761817707
    },
    {
        "content": "<p>do we want this?</p>",
        "id": 547890545,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761817709
    },
    {
        "content": "<p>I'd say we shouldn't need this. If there is a feeling we need this, it's probably because we have too specific notations in too general namespaces, and then I'd say the solution would rather be to scope more these specific notations.</p>",
        "id": 547897376,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1761819711
    },
    {
        "content": "<p>let me add the context was <a class=\"stream-topic\" data-stream-id=\"270676\" href=\"/#narrow/channel/270676-lean4/topic/Why.20.22scoped.20notation.22.20for.20Euler.27s.20totient.20function.3F/with/547890198\">#lean4 &gt; Why \"scoped notation\" for Euler's totient function?</a></p>",
        "id": 547897546,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761819762
    },
    {
        "content": "<p>specifically φ in the Nat namespace for totient</p>",
        "id": 547897596,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761819777
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110050\">Sébastien Gouëzel</span> <a href=\"#narrow/channel/287929-mathlib4/topic/open.20unscoped/near/547897376\">said</a>:</p>\n<blockquote>\n<p>I'd say we shouldn't need this. If there is a feeling we need this, it's probably because we have too specific notations in too general namespaces, and then I'd say the solution would rather be to scope more these specific notations.</p>\n</blockquote>\n<p>but then I would also say that π is a very important symbol so it deserves to be in the <code>Real</code> namespace and not hidden any further like <code>Real.PiNotation</code></p>",
        "id": 547897795,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761819823
    },
    {
        "content": "<p>φ and ψ (golden ratios) are currently hidden in deeper namespaces btw</p>",
        "id": 547897899,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761819859
    },
    {
        "content": "<p>and yeah the golden ratio clashes with totient...</p>",
        "id": 547897952,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761819875
    },
    {
        "content": "<p>I agree with you that pi deserves to be in the Real namespace. On the other hand I would scope more phi for totient, it's too specific to be in the Nat namespace.</p>",
        "id": 547898246,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1761819975
    },
    {
        "content": "<p>I feel like \"hiding in deeper namespaces\" is precisely the workaround that arises from the fact that we don't currently have <code>open unscoped</code>...</p>",
        "id": 547898355,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761820014
    },
    {
        "content": "<p>I'd rather say that hiding in deeper namespaces gives more flexibility. With <code>open</code> or <code>open scoped</code> or <code>open unscoped</code>, it's always an all or nothing mechanism. If we consider that some notations are more important than others (for instance pi is a more important real number than phi or psi), then deeper namespaces look like a good solution to me. Some Nat notations are important (like factorial), some are less important (like totient), so I'd go for deeper namespaces there.</p>",
        "id": 547900212,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1761820557
    },
    {
        "content": "<p>that is a good point about flexibility, so what about instead of hiding in deeper namespace (which would require one to remember which namespace each notation is in, which is bad (e.g. look at Spec)), what if we modify the open syntax so that we can specify which notations to open?</p>",
        "id": 547900552,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761820657
    },
    {
        "content": "<p>that is, a third solution outside \"deeper namespace\" and \"open unscoped\"</p>",
        "id": 547900631,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761820678
    },
    {
        "content": "<p>so e.g. we can write <code>open Nat (hiding φ)</code></p>",
        "id": 547900721,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761820700
    },
    {
        "content": "<p>Downstream of Mathlib, we have less immediate control over moving notation to a deeper namespace, so having a command like this would be nice.</p>\n<p>I do also like the idea of also being able to hide specific notations, is this hard to implement?</p>",
        "id": 547901981,
        "sender_full_name": "Chris Henson",
        "timestamp": 1761821071
    },
    {
        "content": "<p>i haven't tried</p>",
        "id": 547902032,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761821089
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"687698\">@Chris Henson</span> on the other hand, maybe your downstream project can just use my code for open unscoped</p>",
        "id": 547908284,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761823102
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"873547\">@Robin Arnez</span> do you know which part of the parser is responsible for looking at a syntax (e.g. <code>π</code>) in a scope (e.g. <code>Real</code>) and then finding the corresponding notation identifier (e.g. <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Analysis/SpecialFunctions/Trigonometric/Basic.html#Real.term%CF%80\">Real.termπ</a>)?</p>",
        "id": 547911064,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761824073
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/287929-mathlib4/topic/open.20unscoped/near/547900721\">said</a>:</p>\n<blockquote>\n<p>so e.g. we can write <code>open Nat (hiding φ)</code></p>\n</blockquote>\n<p>how would this support hiding notation that is not composed of a single token?</p>",
        "id": 547970139,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1761838569
    },
    {
        "content": "<p>since notation definitions don't have a \"name\", it makes a lot sense to me that they are associated to their namespace</p>",
        "id": 547970537,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1761838665
    },
    {
        "content": "<p>good point</p>",
        "id": 547972135,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761839033
    },
    {
        "content": "<p>Notation definitions <em>do</em> <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Nat/Totient.html#Nat.term%CF%86\">have a name</a>. We should probably not write those in the source code though...</p>",
        "id": 547972958,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1761839227
    },
    {
        "content": "<p>yes, I meant that they are usually autogenerated</p>",
        "id": 547973057,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1761839254
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"111080\">Floris van Doorn</span> <a href=\"#narrow/channel/287929-mathlib4/topic/open.20unscoped/near/547972958\">said</a>:</p>\n<blockquote>\n<p>We should probably not write those in the source code though...</p>\n</blockquote>\n<p>Core does this for the <code>recommended_spelling</code>s (<a href=\"https://github.com/leanprover/lean4/blob/cc046e0c18371fee4e94e81432f272e38c780d79/src/Init/Data/List/Notation.lean#L37\">example</a>) and so far I don't think it's been a problem.</p>",
        "id": 547973223,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1761839294
    },
    {
        "content": "<p>for some things, the generated name can look pretty strange imo<br>\n<a href=\"/user_uploads/3121/c5gGSm4CToLZiffja11OTqlz/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/c5gGSm4CToLZiffja11OTqlz/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1223x331\" src=\"/user_uploads/thumbnail/3121/c5gGSm4CToLZiffja11OTqlz/image.png/840x560.webp\"></a></div>",
        "id": 547973695,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1761839407
    },
    {
        "content": "<p>what if we force mathlib to name all notations</p>",
        "id": 547974085,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761839509
    },
    {
        "content": "<p>ok we have <a href=\"https://loogle.lean-lang.org/?q=%22.term%22%2C+%E2%8A%A2+Lean.ParserDescr\">at least 2k notations</a> so maybe that's not a good idea</p>",
        "id": 547974429,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761839591
    },
    {
        "content": "<p>But if <code>hiding...</code> happens to be implemented, I think it should use the names, so your example would be <code>open Nat (hiding termφ)</code></p>",
        "id": 547992678,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1761844448
    },
    {
        "content": "<p>I would have to look into it, I think scope works differently</p>",
        "id": 547993159,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761844604
    },
    {
        "content": "<p>I personally would be happy with a command where you can open a namespace, except explicitly mentioned scoped notation (I guess for attributes it's even trickier how to specify that you don't want them).</p>\n<p>I agree with <span class=\"user-mention silent\" data-user-id=\"110050\">Sébastien Gouëzel</span> that we should <em>also</em> keep uncommonly-used scoped notations out of widely used namespaces. But the flexibility of such a command seems useful.</p>",
        "id": 547993784,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1761844779
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/287929-mathlib4/topic/open.20unscoped/near/547974429\">said</a>:</p>\n<blockquote>\n<p>what if we force mathlib to name all notations</p>\n<p>ok we have <a href=\"https://loogle.lean-lang.org/?q=%22.term%22%2C+%E2%8A%A2+Lean.ParserDescr\">at least 2k notations</a> so maybe that's not a good idea</p>\n</blockquote>\n<p>On the contrary, that fact that Mathlib has so many notations <em>increases</em> the value of asking that they be named. :-)</p>",
        "id": 548037513,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761860575
    },
    {
        "content": "<p>Didn't we require they be named during the port?</p>",
        "id": 548042345,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1761863250
    }
]