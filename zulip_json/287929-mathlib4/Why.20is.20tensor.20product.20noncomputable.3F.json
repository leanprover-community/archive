[
    {
        "content": "<p>I looked at the file, and it has the tag <a href=\"https://github.com/leanprover-community/mathlib4/blob/8a20fd89675e13f24e4ec9fd3a6cca95b20e382a/Mathlib/LinearAlgebra/TensorProduct/Basic.lean#L41\"><code>suppress_compilation</code></a>, and the docstring says</p>\n<blockquote>\n<p>This is a hack to work around <a href=\"https://github.com/leanprover-community/mathlib4/issues/7103\">https://github.com/leanprover-community/mathlib4/issues/7103</a> .</p>\n</blockquote>\n<p>And the issue is 2 years old, is it still an issue now? Can someone summarise the main problem? Isn't it just a quotient of List?</p>",
        "id": 524860156,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1750330514
    },
    {
        "content": "<p>With the new compiler, it would be a good idea to see if the situation has improved.</p>",
        "id": 524860349,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1750330598
    },
    {
        "content": "<p>When was the new compiler born?</p>",
        "id": 524860396,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1750330620
    },
    {
        "content": "<p>ETA soonish I think</p>",
        "id": 524860449,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1750330641
    },
    {
        "content": "<p>The problem is that <code>noncomputable</code> means try to compile and give up if unsuccessful. Failure was taking too long</p>",
        "id": 524860632,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1750330717
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"306577\">@Matthew Ballard</span> so the question is why was it taking too long?</p>",
        "id": 524862486,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1750331520
    },
    {
        "content": "<p>Still an unknown. Pretty sure it was somewhere in the old compiler</p>",
        "id": 524862568,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1750331551
    },
    {
        "content": "<p>Since it’s bothering me but not enough to touch code let me hedge the above with: it might only apply to <code>noncomputable section</code></p>",
        "id": 524876888,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1750336734
    },
    {
        "content": "<p>Profiling the C++ components of the language is rather murky (to me at least). And compiled code isn’t a priority (for math) so you get the solution above. </p>\n<p>Hopefully the new compiler can give us more visibility. For the kernel you should be able to use lean4lean but I was not able to get that working in limited attempts.</p>",
        "id": 524878373,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1750337266
    },
    {
        "content": "<p>Which file do you mean in particular? With the new compiler, if I remove this from <code>Mathlib/LinearAlgebra/TensorProduct/Basic.lean</code> (which doesn't have this notice, but seems to be the root of the dependency tree here), there is no difference to compile time or <code>maxrss</code>.</p>",
        "id": 525101194,
        "sender_full_name": "Cameron Zwarich",
        "timestamp": 1750452213
    },
    {
        "content": "<p>Oh yeah. You might be able to remove that on current master.</p>",
        "id": 525101522,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1750452412
    },
    {
        "content": "<p>With <code>set_option profiler true</code> commenting out <code>suppress_compilation</code> in that file doesn't seem change output.</p>",
        "id": 525101584,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1750452467
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"656225\">@Cameron Zwarich</span> If you look at the original PR that made tensor product noncomputable, it is <a href=\"https://github.com/leanprover-community/mathlib4/pull/7281\">#7281</a>, and the reason stated is to minimise the total compilation, with the following benchmark:</p>\n<p><a href=\"/user_uploads/3121/H9ppk7zYFUSWcOq-PiySCzPF/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/H9ppk7zYFUSWcOq-PiySCzPF/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"812x607\" src=\"/user_uploads/thumbnail/3121/H9ppk7zYFUSWcOq-PiySCzPF/image.png/840x560.webp\"></a></div><p>And the file with the most instruction reduction was <code>Mathlib.Algebra.Lie.BaseChange</code>.</p>",
        "id": 525117735,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1750466486
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span> ! I removed <code>suppress_compilation</code> and <code>noncomputable</code> from enough of that file's dependencies to get it building without <code>suppress_compilation</code> again. With <code>-D Elab.async=false</code>, the elaboration user time for that file goes from 3.90s to 3.91s, and the max RSS goes from 1337840 to 1340080. Seems like whatever problem was there is now fixed with the new compiler.</p>",
        "id": 525119870,
        "sender_full_name": "Cameron Zwarich",
        "timestamp": 1750469774
    },
    {
        "content": "<p>More generally, I hope that all of Mathlib's uses of <code>suppress_compilation</code> for performance reasons can be removed. If we're aiming for Lean to be usable for increasingly complex SW projects, then we should be able to handle the relatively simple definitions found in Mathlib (especially when a lot of subterms are computationally irrelevant).  If there are any remaining issues, I would definitely like to debug/fix them.</p>",
        "id": 525128419,
        "sender_full_name": "Cameron Zwarich",
        "timestamp": 1750481067
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/26642\">#26642</a> tries turning off a batch of suppress_compilations, though we'll have to wait a few hours for a benchmark result</p>",
        "id": 526882931,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751492105
    },
    {
        "content": "<p>Finally I can remove <code>noncomputable</code> when talking about tensor product!</p>",
        "id": 526883360,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751492220
    },
    {
        "content": "<p>I plan to add a <code>Repr</code> and <code>ToExpr</code> instance too, after that lands :)</p>",
        "id": 526883605,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751492289
    },
    {
        "content": "<p>is it sound?</p>",
        "id": 526883676,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751492334
    },
    {
        "content": "<p>No, but nor is the ToExpr instance on Multiset</p>",
        "id": 526883960,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751492499
    },
    {
        "content": "<p>Thanks for taking a look at this right after the 4.22 RC! If you find any issues, this increases the chances I can address them in time for 4.23.</p>",
        "id": 526884257,
        "sender_full_name": "Cameron Zwarich",
        "timestamp": 1751492669
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"656225\">Cameron Zwarich</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Why.20is.20tensor.20product.20noncomputable.3F/near/525128419\">said</a>:</p>\n<blockquote>\n<p>I hope that all of Mathlib's uses of <code>suppress_compilation</code> for performance reasons can be removed.</p>\n</blockquote>\n<p>If this is the case, do you feel the same way about <code>noncomputable</code>? Should there be a CI step that detects <code>noncomputable</code> on things that actually can be compiled after all?</p>",
        "id": 526886125,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751493780
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/26642#issuecomment-3029587118\">Results are in</a>: <em>compilation</em> is 7% (40s / ~10 minutes) slower, but that doesn't seem like a big deal</p>",
        "id": 526891496,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751497445
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Why.20is.20tensor.20product.20noncomputable.3F/near/526886125\">said</a>:</p>\n<blockquote>\n<p>If this is the case, do you feel the same way about <code>noncomputable</code>?</p>\n</blockquote>\n<p>If it's for performance reasons, definitely. It's possible I'm proven wrong by some definition I haven't seen yet.</p>\n<blockquote>\n<p>Should there be a CI step that detects <code>noncomputable</code> on things that actually can be compiled after all?</p>\n</blockquote>\n<p>Once I fix <a href=\"https://github.com/leanprover/lean4/pull/9021\">lean#9021</a>, then this would be pretty simple to do (basically make a mode where <code>noncomputable</code> behaves like <code>noncomputable section</code>, but issues a diagnostic if compilation doesn't fail). Part of my motivation for doing this is to make it easier to detect the root cause of noncomputability through a bunch of <code>noncomputable section</code>s. It should be possible to print the chain of definitions back to the root one that failed (or was explicitly marked <code>noncomputable</code>).</p>",
        "id": 526891507,
        "sender_full_name": "Cameron Zwarich",
        "timestamp": 1751497453
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Why.20is.20tensor.20product.20noncomputable.3F/near/526891496\">said</a>:</p>\n<blockquote>\n<p>Results are in: <em>compilation</em> is 7% (40s / ~10 minutes) slower, but that doesn't seem like a big deal</p>\n</blockquote>\n<p>What's the most affected file? I wouldn't mind taking a look.</p>",
        "id": 526891555,
        "sender_full_name": "Cameron Zwarich",
        "timestamp": 1751497490
    },
    {
        "content": "<p>There's no per-file compilation time</p>",
        "id": 526891640,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751497538
    },
    {
        "content": "<p>But <a href=\"https://tqft.net/mathlib4files/Mathlib/LinearAlgebra/TensorProduct/Graded/External\">file#Mathlib/LinearAlgebra/TensorProduct/Graded/External</a>.lean in total uses 2.5x as many instructions</p>",
        "id": 526891646,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751497544
    },
    {
        "content": "<p>So I guess a reasonable thing to do right now is leave that file with compilation suppressed and merge the rest?</p>",
        "id": 526891729,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751497617
    },
    {
        "content": "<p>With <code>trace.profiler</code>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=TensorProduct.gradedMul#doc\">docs#TensorProduct.gradedMul</a> emits:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">[</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">async</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">112.428655</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">compileDecls</span><span class=\"w\"> </span><span class=\"bp\">▼</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Compiler</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">112.321887</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">compiling</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TensorProduct</span><span class=\"bp\">.</span><span class=\"n\">wrapped</span><span class=\"bp\">._@.</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">LinearAlgebra</span><span class=\"bp\">.</span><span class=\"n\">TensorProduct</span><span class=\"bp\">.</span><span class=\"n\">Graded</span><span class=\"bp\">.</span><span class=\"n\">External</span><span class=\"bp\">._</span><span class=\"n\">hyg</span><span class=\"bp\">.</span><span class=\"m\">3854</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">▼</span>\n<span class=\"w\">    </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">11.591867</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">compiler</span><span class=\"w\"> </span><span class=\"n\">phase</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">base</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pass</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">specialize</span>\n<span class=\"w\">    </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">1.009664</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">compiler</span><span class=\"w\"> </span><span class=\"n\">phase</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">base</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pass</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">    </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.222378</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">compiler</span><span class=\"w\"> </span><span class=\"n\">phase</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">base</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pass</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cse</span>\n<span class=\"w\">    </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.324857</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">compiler</span><span class=\"w\"> </span><span class=\"n\">phase</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">base</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pass</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">saveBase</span>\n<span class=\"w\">    </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">2.581758</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">compiler</span><span class=\"w\"> </span><span class=\"n\">phase</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">base</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pass</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">toMono</span>\n<span class=\"w\">    </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">1.499076</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">compiler</span><span class=\"w\"> </span><span class=\"n\">phase</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mono</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pass</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">    </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.102651</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">compiler</span><span class=\"w\"> </span><span class=\"n\">phase</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mono</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pass</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">structProjCases</span>\n<span class=\"w\">    </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.013452</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">compiler</span><span class=\"w\"> </span><span class=\"n\">phase</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mono</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pass</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">extendJoinPointContext</span>\n<span class=\"w\">    </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.081286</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">compiler</span><span class=\"w\"> </span><span class=\"n\">phase</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mono</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pass</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">floatLetIn</span>\n<span class=\"w\">    </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.284566</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">compiler</span><span class=\"w\"> </span><span class=\"n\">phase</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mono</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pass</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">reduceArity</span>\n<span class=\"w\">    </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.481790</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">compiler</span><span class=\"w\"> </span><span class=\"n\">phase</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mono</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pass</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">    </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.010177</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">compiler</span><span class=\"w\"> </span><span class=\"n\">phase</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mono</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pass</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">floatLetIn</span>\n<span class=\"w\">    </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">90.545429</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">compiler</span><span class=\"w\"> </span><span class=\"n\">phase</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mono</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pass</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">elimDeadBranches</span>\n<span class=\"w\">    </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.101724</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">compiler</span><span class=\"w\"> </span><span class=\"n\">phase</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mono</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pass</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">lambdaLifting</span>\n<span class=\"w\">    </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.028384</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">compiler</span><span class=\"w\"> </span><span class=\"n\">phase</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mono</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pass</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">    </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.020180</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">compiler</span><span class=\"w\"> </span><span class=\"n\">phase</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mono</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pass</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cse</span>\n<span class=\"w\">    </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.037286</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">compiler</span><span class=\"w\"> </span><span class=\"n\">phase</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mono</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pass</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">saveMono</span>\n<span class=\"w\">    </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.026466</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">compiler</span><span class=\"w\"> </span><span class=\"n\">phase</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mono</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pass</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">extractClosed</span>\n</code></pre></div>",
        "id": 526892348,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751498080
    },
    {
        "content": "<p>Thanks Eric! Improving the algorithm used by <code>elimDeadBranches</code> was already on my radar for other non-performance reasons.</p>",
        "id": 526892544,
        "sender_full_name": "Cameron Zwarich",
        "timestamp": 1751498238
    },
    {
        "content": "<p>Note that I've reverted the change from <a href=\"https://github.com/leanprover-community/mathlib4/pull/26642\">#26642</a> which enabled this slowness, in the hope of getting the rest merged</p>",
        "id": 526893076,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751498660
    },
    {
        "content": "<p>\"most of tensor products are computable\" is still a better place to be in than \"none of them are\"</p>",
        "id": 526893119,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751498687
    },
    {
        "content": "<p>Did we make TensorProduct irreducible yet? This will surely help.</p>",
        "id": 526894434,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1751499507
    },
    {
        "content": "<p>I would be surprised if that's relevant</p>",
        "id": 526895592,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751500379
    },
    {
        "content": "<p>I thought the compiler only cares about inline, not reducibility</p>",
        "id": 526895619,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751500400
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Why.20is.20tensor.20product.20noncomputable.3F/near/526893076\">said</a>:</p>\n<blockquote>\n<p>Note that I've reverted the change from <a href=\"https://github.com/leanprover-community/mathlib4/pull/26642\">#26642</a> which enabled this slowness, in the hope of getting the rest merged</p>\n</blockquote>\n<p>Benchmark is now mostly neutral (6s longer over 10 minutes), so computability is free!</p>",
        "id": 526898290,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751502655
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Why.20is.20tensor.20product.20noncomputable.3F/near/526883605\">said</a>:</p>\n<blockquote>\n<p>I plan to add a <code>Repr</code> and <code>ToExpr</code> instance too, after that lands :)</p>\n</blockquote>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/26646\">#26646</a> has the Repr</p>",
        "id": 526902227,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751506414
    },
    {
        "content": "<p>The <code>ToExpr</code> instance <a href=\"#narrow/channel/270676-lean4/topic/ToExpr.2C.20the.20infoview.2C.20and.20lcUnreachable/near/526902441\">is a little cursed</a>, and perhaps is a bad idea</p>",
        "id": 526902275,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751506461
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Why.20is.20tensor.20product.20noncomputable.3F/near/526895592\">said</a>:</p>\n<blockquote>\n<p>I would be surprised if that's relevant</p>\n</blockquote>\n<p>Oh. So is the point that irreducibility might help with elaboration, but we're talking about compilation which only happens after that?</p>",
        "id": 526930290,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1751526647
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/26786\">#26786</a> removes a few more <code>suppress_compilation</code>, though it looks like the speedcenter can't be trusted since very basic files I didn't touch changed signficantly</p>",
        "id": 527288311,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751729282
    },
    {
        "content": "<p>how do i effectively search for <code>noncomputable</code> tags that can be removed?</p>",
        "id": 528856373,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752584708
    },
    {
        "content": "<p>I would guess this is a bad use of time, and we should make things computable as we need them</p>",
        "id": 528918841,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1752604035
    },
    {
        "content": "<p>(or until <span class=\"user-mention silent\" data-user-id=\"656225\">Cameron Zwarich</span> decides to make this a feature upstream)</p>",
        "id": 528918882,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1752604049
    }
]