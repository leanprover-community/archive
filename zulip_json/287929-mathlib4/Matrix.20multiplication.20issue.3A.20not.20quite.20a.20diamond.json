[
    {
        "content": "<p><code>Matrix n n R</code> gets a multiplication structure from two different places, one from <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix.instRing#doc\">docs#Matrix.instRing</a> (for square matrices), one from <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix.instHMulOfFintypeOfMulOfAddCommMonoid#doc\">docs#Matrix.instHMulOfFintypeOfMulOfAddCommMonoid</a> (for rectangular, heterogeneous matrices). As you can imagine, they both occur in the same contexts together ... sometimes I define something for rectangular matrices, but in other applications they happen to be square.</p>\n<p>They give defeq instances, so I can unify goals that look the same, but <code>rw</code> doesn't recognize that they're same. So <code>rw [‚Üê this]</code> fails, but</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">conv</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">enter</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n</code></pre></div>\n<p>made it work. (<code>rw</code> inside the conv also didn't work, and this is where I finally covered the issue!)</p>\n<p>Is there a good solution to make this better? It's not as bad as a diamond, but it means that many rw's and simp's dont work for hard to understand reasons.</p>\n<p>One thing is I could e.g. write a simp lemma (or even a <code>dsimp</code> proc?) that turns the rectangular one into the square one, in the cases where it happens to be applied to square matrices. That works for normalizing to the square case. But then it still means that rewriting a \"rectangular\" theorem onto a \"square\" expression still doesn't work so well.</p>",
        "id": 538898153,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1757606815
    },
    {
        "content": "<p>Sounds like the heterogeneous version should be defined first (if it isn't yet) and the ring instance should use that multiplication rather than defining its own</p>",
        "id": 538899743,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1757607286
    },
    {
        "content": "<p>That's actually exactly how it already is done. The issue is that <code>rw</code> can't see that they're the same. I'm not enough of an expert on reducibility / looking through instance / stuff to see what's wrong, though.</p>",
        "id": 538901291,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1757607758
    },
    {
        "content": "<p>See <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix.instMulOfFintypeOfAddCommMonoid#doc\">docs#Matrix.instMulOfFintypeOfAddCommMonoid</a> for the actual square multiplication (not just the whole <code>Ring</code>), I guess</p>",
        "id": 538901342,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1757607781
    },
    {
        "content": "<p>can you provide a <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a></p>",
        "id": 538907813,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757609885
    },
    {
        "content": "<p>I think since unification sets the reducibility to <code>default</code> in instance implicit arguments, this is supposed to work just fine.</p>",
        "id": 539580229,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1757947792
    }
]