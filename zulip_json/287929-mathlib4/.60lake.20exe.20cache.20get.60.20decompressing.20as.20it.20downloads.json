[
    {
        "content": "<p>I've been getting tired of how slow <code>lake exe cache get</code> is, and with the replacement not imminent, I decided to try improving things.</p>\n<blockquote>\n<p>feat: pipeline downloads and decompression in <code>cache get</code> <a href=\"https://github.com/leanprover-community/mathlib4/pull/32987\">#32987</a></p>\n</blockquote>\n<p>This PR puts downloaded files in a queue, and then sends them in batches to <code>leangz</code> while the download is in progress. (We only ever run a single <code>leangz</code> process: it handles parallelism internally. At the conclusion of each <code>leangz</code> run we start it again on whichever files have arrived in the meantime, or sleep a moment if there are none.)</p>\n<p>The actual keystrokes are of course all done by Claude, but I did spend a while explaining the design I wanted. :-)</p>",
        "id": 564156150,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1765932559
    },
    {
        "content": "<p>I don't feel like <code>lake exe cache get</code> is slow for me</p>",
        "id": 564160583,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1765936367
    },
    {
        "content": "<p>Lucky you. It's often over a minute for me.</p>",
        "id": 564167300,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1765942523
    },
    {
        "content": "<p>It sometimes goes minutes without any output</p>",
        "id": 564167387,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1765942598
    },
    {
        "content": "<p>Slightly off topic: it seems that <code>lake exe cache get</code> doesn't work when one is offline, which is partly obvious, but I believe something could work when the relevant thing is in the cache.</p>",
        "id": 564230575,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1765971743
    },
    {
        "content": "<p>Worse: <code>lake build</code> sometimes doesn't work when one is offline!</p>",
        "id": 564232511,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1765972409
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130609\">Antoine Chambert-Loir</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60lake.20exe.20cache.20get.60.20decompressing.20as.20it.20downloads/near/564230575\">said</a>:</p>\n<blockquote>\n<p>Slightly off topic: it seems that <code>lake exe cache get</code> doesn't work when one is offline, which is partly obvious, but I believe something could work when the relevant thing is in the cache.</p>\n</blockquote>\n<p>Does <code>lake exe cache unpack</code> work in this situation? It's supposed to only unpack the files that are already on your computer.</p>",
        "id": 564248239,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1765977170
    },
    {
        "content": "<p>Thank you for the wonderful speedup!</p>",
        "id": 564326161,
        "sender_full_name": "Geoffrey Irving",
        "timestamp": 1765999068
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110050\">Sébastien Gouëzel</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60lake.20exe.20cache.20get.60.20decompressing.20as.20it.20downloads/near/564248239\">said</a>:</p>\n<blockquote>\n<p>Does <code>lake exe cache unpack</code> work in this situation? It's supposed to only unpack the files that are already on your computer.</p>\n</blockquote>\n<p>Yes, thank you for the advice!</p>",
        "id": 565148320,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1766493040
    },
    {
        "content": "<p>I realised I forgot to remove the <code>awaiting-author</code> and <code>blocked-by-other-PR</code> labels from <a href=\"https://github.com/leanprover-community/mathlib4/pull/32987\">#32987</a>, but I've done so now. It's ready for review/merge again.</p>",
        "id": 573436907,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1770873276
    }
]