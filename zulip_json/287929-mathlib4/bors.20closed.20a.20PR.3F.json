[
    {
        "content": "<p>What just happened with <a href=\"https://github.com/leanprover-community/mathlib4/pull/23726\">#23726</a>?</p>\n<p>I made a suggestion, <code>bors d+</code>'s the PR, edited the suggestion and then this happened:</p>\n<p><a href=\"/user_uploads/3121/huzejb-rrwTcIj63_-B8UzUN/Screenshot-2025-04-22-at-16.28.07.png\">Screenshot 2025-04-22 at 16.28.07.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/huzejb-rrwTcIj63_-B8UzUN/Screenshot-2025-04-22-at-16.28.07.png\" title=\"Screenshot 2025-04-22 at 16.28.07.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1920x1550\" src=\"/user_uploads/thumbnail/3121/huzejb-rrwTcIj63_-B8UzUN/Screenshot-2025-04-22-at-16.28.07.png/840x560.webp\"></a></div><p>Did bors really just delete master and randomly merge this PR and not mark the PR as [Merged by Bors]? Could I have pressed a wrong button?</p>",
        "id": 513640942,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1745335869
    },
    {
        "content": "<p>Doesn't look like the PR is merged. Do I just reopen?</p>",
        "id": 513641070,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1745335901
    },
    {
        "content": "<p>bors closed the base branch, and also claims to have deleted master. This happens whenever you create dependent PRs \"the github way\", and reopening is the correct action</p>",
        "id": 513642394,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1745336236
    },
    {
        "content": "<p>Thanks for the explanation! I'd just a few minutes earlier merged the dependency.</p>",
        "id": 513642674,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1745336311
    },
    {
        "content": "<p>The base branch was <a href=\"https://github.com/leanprover-community/mathlib4/tree/fae_PR_genLT\">branch#fae_PR_genLT</a> (<a href=\"https://github.com/leanprover-community/mathlib4/pull/23725\">#23725</a>), which was merged into master and the branch is then deleted by bors. (Displaying this as master being deleted is a GitHub bug that has been there for a long time.) Once the base branch is deleted, bors closes <a href=\"https://github.com/leanprover-community/mathlib4/pull/23726\">#23726</a>. In this case bors somehow also automatically changed the base branch to <code>master</code> afterwards, so you can reopen the PR immediately; this doesn't happen every time and if it doesn't happen, usually you need to manually go to <a href=\"https://github.com/leanprover-community/mathlib4/pull/23725\">#23725</a> to restore the deleted branch, then you can reopen the PR and delete the branch again. (Both things happened to my PRs today.)</p>",
        "id": 513642791,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1745336348
    },
    {
        "content": "<p>Oh, so I guess that creating a branch from a non-master branch is not a good idea, although it is the \"github way\"?</p>",
        "id": 513676476,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1745346097
    },
    {
        "content": "<p>What I do usually is create a branch from master and merge the branch I want</p>",
        "id": 513684659,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1745348790
    },
    {
        "content": "<p>Yeah, that has always been my way as well, but I thought that opening a child branch from a branch looked neater. Apparently I was wrong ...</p>",
        "id": 513686738,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1745349546
    },
    {
        "content": "<p>It happens often that you want to add materials on top of a branch A which is already PR'ed or is ready to be PR'd, in which case it's natural to create another branch B out of A. When you open a PR from branch B, it's also natural to set the base branch to A to reduce diff and ease reviews (I often do this). The GitHub/bors workflow is not exactly friendly to this approach, but we can live with it.</p>",
        "id": 513733764,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1745359022
    },
    {
        "content": "<p>It's OK to create a new branch from a non-master branch. WHen you open a PR, you should set <code>master</code> as the base branch. Otherwise you tell it that you want to merge your changes into the base non-master branch, and it gets confused.</p>",
        "id": 513734767,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1745359512
    },
    {
        "content": "<p>It would be nice to better automation for dependent PRs (show my PRs as a color-coded tree, do the right thing when the base branch is merged etc), but this is not an easy task.</p>",
        "id": 513734966,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1745359611
    },
    {
        "content": "<p>E.g., when <code>A</code> depends on <code>B</code> and <code>B</code> is merged, then the right thing to do is to merge <code>master</code> into <code>B</code> (to get the same state as on <code>master</code>, but with the right history), then merge <code>B</code> into <code>A</code>. This is better than merging <code>master</code> directly, if you modify the same file both in <code>A</code> and <code>B</code>.</p>",
        "id": 513735203,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1745359718
    },
    {
        "content": "<p>But all this should be done between the moment <code>B</code> is merged to <code>master</code> and it is deleted, right?</p>",
        "id": 513822353,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1745400931
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/channel/287929-mathlib4/topic/bors.20closed.20a.20PR.3F/near/513735203\">said</a>:</p>\n<blockquote>\n<p>when <code>A</code> depends on <code>B</code> and <code>B</code> is merged, then the right thing to do is to merge <code>master</code> into <code>B</code> (to get the same state as on <code>master</code>, but with the right history), then merge <code>B</code> into <code>A</code>. This is better than merging <code>master</code> directly, if you modify the same file both in <code>A</code> and <code>B</code>.</p>\n</blockquote>\n<p>The better thing IMO is to rebase <code>A</code> over master, dropping the commits from <code>B</code></p>",
        "id": 513822709,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1745401027
    },
    {
        "content": "<p>Well, but as Kevin noticed (in my PR...) if <code>B</code>is merged and deleted, <code>A</code> is automatically closed.</p>",
        "id": 513824650,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1745401554
    },
    {
        "content": "<p>... if the base of <code>A</code> is <code>B</code>. I personally always make the base of <code>A</code> be <code>master</code></p>",
        "id": 513826903,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1745402199
    },
    {
        "content": "<p>Yes, I agree that this seems to be the better solution: branch out from your first PR branch, but make <code>master</code> the base of this new branch.</p>",
        "id": 513827285,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1745402296
    },
    {
        "content": "<p>And at any rate the delegation by <span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> is no longer valid (probably because of the closing-reopening business...)</p>",
        "id": 513828981,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1745402722
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"300245\">@Filippo A. E. Nuccio</span> I am a bit confused about the state of this PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/23726\">#23726</a> now. We have that <a href=\"https://github.com/leanprover-community/mathlib4/pull/23725\">#23725</a> is merged and it contains <code>Mathlib/Algebra/Order/Group/Cyclic.lean</code> which is 66 lines on ordered cyclic groups. But they're still showing up in the diff of <a href=\"https://github.com/leanprover-community/mathlib4/pull/23726\">#23726</a> . Can you merge or rebase master (don't ask me which one) so we can see what's actually going on in the PR?</p>",
        "id": 513830352,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1745403071
    },
    {
        "content": "<p>Done</p>",
        "id": 513830814,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1745403221
    }
]