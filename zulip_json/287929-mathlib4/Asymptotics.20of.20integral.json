[
    {
        "content": "<p>Should there be some theorems about <code>∫ f ~ ∫ g</code> given <code>f ~ g</code>,where <code>~</code> is one of <code>Asymptotics.IsLittleO</code>, <code>Asymptotics.IsBigO</code> etc? (Or maybe there are and I just didn't find them?)</p>\n<p>To ensure I didn't just make up false statements, I managed to prove a specialized version for my own use (with a non-mathlib-ready 100-line proof)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">Integral</span><span class=\"bp\">.</span><span class=\"n\">SetIntegral</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">Measure</span><span class=\"bp\">.</span><span class=\"n\">Lebesgue</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">CompletePartialOrder</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Asymptotics</span><span class=\"w\"> </span><span class=\"n\">Filter</span><span class=\"w\"> </span><span class=\"n\">MeasureTheory</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Asymptotics</span><span class=\"bp\">.</span><span class=\"n\">IsLittleO</span><span class=\"bp\">.</span><span class=\"n\">integral</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hfg</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"n\">o</span><span class=\"o\">[</span><span class=\"n\">atTop</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hg_tendsto</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Tendsto</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">atTop</span><span class=\"w\"> </span><span class=\"n\">atTop</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hf_integrable</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">IntegrableOn</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Ioc</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hg_integrable</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">IntegrableOn</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Ioc</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)):</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Ioc</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"n\">o</span><span class=\"o\">[</span><span class=\"n\">atTop</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Ioc</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">‖</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>I don't know how much this can be generalized.</p>",
        "id": 511865283,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1744511523
    },
    {
        "content": "<p>I managed to drop the norm on <code>g t</code> with another hundred of lines <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 511912373,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1744554136
    },
    {
        "content": "<p>Anyway, I have them pushed here <a href=\"https://github.com/wwylele/biased-bisect-lean/blob/5b8a76cadfa8cc387fe131d59c51de39fcf55666/BiasedBisect/MathlibMeasureTheoryIntegralAsymptotics.lean#L1\">https://github.com/wwylele/biased-bisect-lean/blob/5b8a76cadfa8cc387fe131d59c51de39fcf55666/BiasedBisect/MathlibMeasureTheoryIntegralAsymptotics.lean#L1</a></p>",
        "id": 511934193,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1744571587
    },
    {
        "content": "<p>The hypothesis <code>hg_tendsto</code> seems strange. I think better assumptions are that <code>g</code> has constant sign near infinity and <code>f</code> is not integrable on <code>Ioi a</code>.</p>",
        "id": 511934613,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1744571945
    },
    {
        "content": "<p>The <code>hg_tendsto</code> serves another purpose, which is to ensure the integral doesn't just converge to constants on both sides (and thus break IsLittleO). This likely can be weakened to requiring the integral to tends to infinity, but I haven't got time to think deeply in it</p>",
        "id": 511935744,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1744572794
    },
    {
        "content": "<p>I know this is the purpose of <code>hg_tendsto</code>, but my point is that it can be generalized (this was your original question)</p>",
        "id": 511936435,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1744573302
    },
    {
        "content": "<p>ah sorry, I misread your message</p>",
        "id": 511936535,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1744573369
    },
    {
        "content": "<p>requiring <code>f</code> not integrable on <code>Ioi a</code> seems also too strict. This should also work when <code>f</code> integrate to a finite value on <code>Ioi</code>, while <code>g</code> grows unbounded. Maybe requiring <code>g</code> not integrable on <code>Ioi</code> (&amp; the consistent sign condition) is good enough?</p>",
        "id": 511937020,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1744573705
    },
    {
        "content": "<p>I think it would be good enough yes. I have always seen it formulated with <code>f</code> not integrable because it implies that <code>g</code> is not too and if <code>f</code> is integrable but <code>g</code> is not then you likely are not interested in comparing their asymptotic behaviour. So <code>g</code> not integrable is more general, in practice I don't know if it would make much difference.</p>",
        "id": 511937519,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1744574106
    },
    {
        "content": "<p>Another thing that I don't know enough about is whether this can be generalized to arbitrary filter (e.g. integrating around a pole of a function). And if it does still work that way, my current approach of the proof won't work...</p>",
        "id": 511955777,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1744589086
    },
    {
        "content": "<p>I’m pretty sure it is still true with Ioo a b instead of Ioi a</p>",
        "id": 512000463,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1744614765
    },
    {
        "content": "<p>I am thinking more about this. Can I generalize this to arbitrary type other than <code>ℝ</code>, which might not even have an order? I think what I want to express is having an \"end point\" of the set being integrated to be in the filter, or maybe integrating along complement sets of sets in the filter.  Not sure what is the best way to express this in mathlib</p>",
        "id": 513176936,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1745074644
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 513177706,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1745075221
    },
    {
        "content": "<p><span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span> Maybe I should use what improper integral uses <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/MeasureTheory/Integral/IntegralEqImproper.html#MeasureTheory.AECover\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/MeasureTheory/Integral/IntegralEqImproper.html#MeasureTheory.AECover</a></p>",
        "id": 513180719,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1745077539
    },
    {
        "content": "<p>Maybe the cocompact filter</p>",
        "id": 513182689,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1745078755
    },
    {
        "content": "<p>Hmm, I don't see how cocompact helps (nor do I fully understand it). I think what I want is, given a <code>Filter a</code> that appears in the <code>IsBigO</code> hypothesis, I want to translate it to a <code>Filter (Set a)</code> for <code>IsBigO</code> on the integration. When elements in the <code>Filter a</code> \"contracts\" to its limit (say, <code>b</code>), elements in the <code>Filter (Set a)</code> should expand  with its boundary approaching <code>b</code>. I don't know how to precisely express this. I tried <code>Filter.smallSets</code> but it doesn't seem to do what I want</p>",
        "id": 513266777,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1745149639
    },
    {
        "content": "<p>Meanwhile, this is what I think the base theorem should look like assuming a partial order (I might be missing some measurability conditions)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Asympotitics</span><span class=\"bp\">.</span><span class=\"n\">IsBigOWith</span><span class=\"bp\">.</span><span class=\"n\">integral</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MeasurableSpace</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">PartialOrder</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Filter</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hfg</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsBigOWith</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Measure</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃ᶠ</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">IntegrableOn</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Iic</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">μ</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hg</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃ᶠ</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">IntegrableOn</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Iic</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">μ</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hg_tendsto</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Tendsto</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Iic</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∂</span><span class=\"n\">μ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">atTop</span><span class=\"o\">):</span>\n<span class=\"w\">    </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">IsBigOWith</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"w\"> </span><span class=\"n\">l</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Iic</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∂</span><span class=\"n\">μ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Iic</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∂</span><span class=\"n\">μ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n</code></pre></div>",
        "id": 513278987,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1745159304
    },
    {
        "content": "<p>hmm probably not... Even on real numbers, I feel I can come up with some pathological filters that break things. The problem is I don't know how to specify the contraint between the filter and the integral set (the set should grow while the filter shrinks). Maybe I should just focus on the atTop case and the case of a one-side neighborhood of a point</p>",
        "id": 513293295,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1745171267
    },
    {
        "content": "<p>At least I have a somewhat general version for atTop with slightly better proof now <a href=\"https://github.com/wwylele/biased-bisect-lean/blob/2cf6c592327453a7608d2c713b2099304facbdcd/BiasedBisect/MathlibMeasureTheoryIntegralAsymptotics.lean#L15\">https://github.com/wwylele/biased-bisect-lean/blob/2cf6c592327453a7608d2c713b2099304facbdcd/BiasedBisect/MathlibMeasureTheoryIntegralAsymptotics.lean#L15</a></p>",
        "id": 513334673,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1745206371
    }
]