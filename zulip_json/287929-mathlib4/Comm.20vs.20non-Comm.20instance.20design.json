[
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Normed.20modules/near/511944669\">said</a>:</p>\n<blockquote>\n<p><a href=\"/user_uploads/3121/wfNagE4dWp81klZs5HwIlSwW/IMG_20250413_222335365_HDR.jpg\">IMG_20250413_222335365_HDR.jpg</a></p>\n<p>I think that's what mathlib looks like currently, regarding {NonUnital/unital}{non-comm/Comm}{no norm/Seminorm/Norm}ed rings (so non-unital rings in the bottom left up to normed commutative rings in the top right, with seminormed rings in the middle). A red X means that the instance is present but has priority 100. The slightly curvy lines are <code>NonUnitalNormedCommRing.toNonUnitalCommRing</code> (i.e. skip the non-unital seminormed commutative ring) and <code>NormedCommRing.toCommRing</code>. A notable absentee is <code>Seminormed Ring.toRing</code> which presumably has default prio and which Matt explicitly flagged as perhaps causing a problem in the PR (note that SeminormedCommRing.toCommRing has prio 100). I don't know how to find the priority of <code>SeminormedRing.toRing</code>, I guess it could have prio lowered elsewhere. </p>\n<p>What should the logic of the diagram be? Are we being inconsistent and paying for it now?</p>\n<p>Is the picture supposed to be saying \"Here are 12 classes but we really really really don't want you to deduce any of them from any of the others, except that you are allowed to deduce X from CommX\"? Because that it what it says right now. It seems like a very weird set-up to me.</p>\n</blockquote>\n<p>I tried to think about this in two ways:</p>\n<ol>\n<li>Avoid the <code>CommX.toX</code> instances as much as possible by lowering the priorities <a href=\"https://github.com/leanprover-community/mathlib4/pull/24140\">#24140</a></li>\n<li>Jump at the first opportunity to the <code>Comm</code> level and stay there by raising the priorities (WIP to build) </li>\n</ol>\n<p>I am not sure of which is better overall for performance. </p>\n<p>1) has advantage of avoiding failing searches and not straying into <code>Comm</code> classes if needed. The disadvantage is that you in general need to unify against longer chains of instances, eg <code>CommRing.toRing Ring.toSemiring</code> vs <code>CommRing.toCommSemiring CommSemiring.toSemiring</code> when you are using a result that takes a <code>[CommSemiring R]</code>as a parameter for something with <code>[CommRing R]</code> as a parameter that needs a <code>Semiring R</code>. </p>\n<p>2) has advantage that the jump to the <code>Comm</code> class occurs at the first opportunity avoiding the unifications but the disadvantage of possibly more failing searches for <code>Comm</code> instances on non-<code>Comm</code> things.</p>",
        "id": 512820522,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1744894677
    },
    {
        "content": "<p>The results for 1 are in and not terrible. </p>\n<div class=\"codehilite\" data-code-language=\"Diff\"><pre><span></span><code><span class=\"w\"> </span> Benchmark                                              Metric          Change\n<span class=\"w\"> </span> =============================================================================\n<span class=\"gi\">+ build                                                  instructions     -0.8%</span>\n<span class=\"gi\">+ build                                                  type checking    -5.7%</span>\n<span class=\"gd\">- ~Mathlib.Algebra.Module.FinitePresentation             instructions     14.9%</span>\n<span class=\"gi\">+ ~Mathlib.AlgebraicGeometry.AffineSpace                 instructions     -9.7%</span>\n<span class=\"gi\">+ ~Mathlib.AlgebraicGeometry.EllipticCurve.Affine        instructions     -7.5%</span>\n<span class=\"gi\">+ ~Mathlib.AlgebraicGeometry.EllipticCurve.Group         instructions    -10.7%</span>\n<span class=\"gi\">+ ~Mathlib.Analysis.CStarAlgebra.lpSpace                 instructions    -38.8%</span>\n<span class=\"gi\">+ ~Mathlib.CategoryTheory.Preadditive.Mat                instructions    -13.8%</span>\n<span class=\"gi\">+ ~Mathlib.FieldTheory.RatFunc.Basic                     instructions     -5.2%</span>\n<span class=\"gd\">- ~Mathlib.Geometry.Euclidean.Basic                      instructions     23.1%</span>\n<span class=\"gd\">- ~Mathlib.Geometry.Euclidean.Circumcenter               instructions     15.4%</span>\n<span class=\"gi\">+ ~Mathlib.LinearAlgebra.CliffordAlgebra.Basic           instructions    -26.9%</span>\n<span class=\"gi\">+ ~Mathlib.LinearAlgebra.CliffordAlgebra.Even            instructions    -11.5%</span>\n<span class=\"gi\">+ ~Mathlib.LinearAlgebra.CliffordAlgebra.EvenEquiv       instructions    -17.6%</span>\n<span class=\"gi\">+ ~Mathlib.NumberTheory.KummerDedekind                   instructions    -19.0%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.AdjoinRoot                         instructions    -10.8%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.Algebraic.Integral                 instructions    -47.5%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.ClassGroup                         instructions    -26.3%</span>\n<span class=\"gd\">- ~Mathlib.RingTheory.CotangentLocalizationAway          instructions     15.6%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.DedekindDomain.Different           instructions    -23.4%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.Extension                          instructions     -6.9%</span>\n<span class=\"gd\">- ~Mathlib.RingTheory.FinitePresentation                 instructions     36.2%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.FiniteStability                    instructions    -28.5%</span>\n<span class=\"gd\">- ~Mathlib.RingTheory.Generators                         instructions     36.7%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.Ideal.Norm.AbsNorm                 instructions    -36.5%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.Ideal.Norm.RelNorm                 instructions    -18.5%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.Ideal.Quotient.Operations          instructions     -8.7%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.IntegralClosure.IntegralRestrict   instructions    -19.2%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.Jacobson.Ring                      instructions    -23.0%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.Kaehler.Basic                      instructions     -8.6%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.Kaehler.JacobiZariski              instructions    -21.6%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.Kaehler.TensorProduct              instructions     -8.1%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.LaurentSeries                      instructions    -11.1%</span>\n<span class=\"gd\">- ~Mathlib.RingTheory.NoetherNormalization               instructions     37.4%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.Polynomial.Quotient                instructions    -27.2%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.PowerSeries.Basic                  instructions    -31.5%</span>\n<span class=\"gd\">- ~Mathlib.RingTheory.Presentation                       instructions     26.6%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.WittVector.Isocrystal              instructions    -24.5%</span>\n</code></pre></div>",
        "id": 512823929,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1744895629
    },
    {
        "content": "<p>Note that <code>Mathlib.RingTheory.Kaehler.JacobiZariski</code> is particularly happy</p>",
        "id": 512824077,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1744895666
    },
    {
        "content": "<p>It's still more green than red, I think, and it would probably help to speed up <a href=\"https://github.com/leanprover-community/mathlib4/pull/24108\">#24108</a></p>",
        "id": 513164337,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1745064560
    },
    {
        "content": "<p>I haven't had time to finish the other approach yet and I am not sure when I will find it with finals coming up...</p>",
        "id": 513393552,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1745239071
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/tree/mrb%2Fbump_comm_prios_up\">branch#mrb/bump_comm_prios_up</a></p>",
        "id": 513394197,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1745239410
    },
    {
        "content": "<p>I took a look after the mild performance hit of <a href=\"https://github.com/leanprover-community/mathlib4/pull/24004\">#24004</a> and it was another in this line where Lean needs to unify Comm to non-Comm diamonds over and over again. What makes the most sense to me is making <code>Comm</code> a mixin. If we would could expand <code>[[CommRing R]]</code> to <code>[Ring R] [IsCommMul R]</code> I think we wouldn‚Äôt really lose much in terms of usability.</p>",
        "id": 514658430,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1745769302
    },
    {
        "content": "<p>Does <code>class_abbrev</code>s help here? Or do they cause the same slowdowns?</p>",
        "id": 514658744,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1745769501
    },
    {
        "content": "<p>Is there a notation <code>[[...]]</code> for bundling type class assumptions? Or are you suggesting to define this?</p>",
        "id": 514658753,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1745769509
    },
    {
        "content": "<p>There is no notation. I don‚Äôt what <code>class_abbrev</code> is‚Ä¶</p>",
        "id": 514658782,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1745769537
    },
    {
        "content": "<p>Given classes <code>A a</code> and <code>B a</code>, you can use <code>class_abbrev</code> to define a class <code>C a</code> that is equivalent to having <code>A a</code> and <code>B a</code>. This does what you want, but it is horribly inefficient.</p>\n<p>This is because it adds instances both from and to <code>C a</code>. Meaning that if you are searchin for an instance of <code>B a</code>, it obtains the subgoal of finding an instance of <code>C a</code>. And then it finds the pair of subgoals <code>A a</code> and <code>B a</code>. And then it starts synthesizing <code>A a</code>, which is completely unrelated to the original goal <code>B a</code>.</p>",
        "id": 514659269,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1745769805
    },
    {
        "content": "<p>I think it should just be a macro and its on the user or a linter to make sure there is no doubling up of <code>Mul</code></p>",
        "id": 514659298,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1745769827
    },
    {
        "content": "<p>Where does it live? In core?</p>",
        "id": 514659354,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1745769846
    },
    {
        "content": "<p>I agree that there should be a system for introducing multiple type class assumptions with one notation. For example, I'd love to write <code>[[AffineSpace ‚Ñù V P]]</code> instead of <code>[NormedAddCommGroup V] [InnerProductSpace ‚Ñù V] [MetricSpace P] [NormedAddTorsor V P]</code>. I could even imagine a world where this uses the same <code>[..]</code> brackets as a usual type class assumptions. In that case it wouldn't be a macro, but a built-in feature that acts based on whether the term is a type class or this new thing.</p>",
        "id": 514660239,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1745770445
    },
    {
        "content": "<p>I worry about overhead if it is not a macro</p>",
        "id": 514660823,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1745770822
    },
    {
        "content": "<p>What about <code>variable_alias</code>? I know that the usage of it (and <code>variable?</code>) is banned in mathlib but this seems similar to what you are looking for and can someone remind we why they are banned?</p>",
        "id": 514661029,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1745770967
    },
    {
        "content": "<p>(I told <span class=\"user-mention\" data-user-id=\"306577\">@Matthew Ballard</span> this in person today, but I'm currently investigating adding binder macros as part of some other adjacent work. Possibly user-definable binder elaborators are on the table too, but I won't promise this.)</p>",
        "id": 514661290,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1745771142
    },
    {
        "content": "<p>My idea was to define it as follows. We have a notation like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">class_abbrev'</span><span class=\"w\"> </span><span class=\"n\">AffineSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">InnerProductSpace</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MetricSpace</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddTorsor</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>which creates a structure</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">AffineSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">a1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">V</span>\n<span class=\"w\">  </span><span class=\"n\">a2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">InnerProductSpace</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">V</span>\n<span class=\"w\">  </span><span class=\"n\">a3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MetricSpace</span><span class=\"w\"> </span><span class=\"n\">P</span>\n<span class=\"w\">  </span><span class=\"n\">a4</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">NormedAddTorsor</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"n\">P</span>\n</code></pre></div>\n<p>Then, when elaborating an instance binder <code>[AffineSpace R V P]</code>, in the current implementation, it finds the name of the underlying structure (<code>AffineSpace</code>), and looks it up in the environment to see if it is a class. Then I propose if it is not a class, it looks it up in this <code>class_abbrev'</code> environment extension. When it finds that it is a class abbreviation, it recursively adds all the structure fields as type class hypotheses.</p>\n<p>With this design there is no overhead to worry about.</p>\n<p>Edit: I guess the constructor and projection functions should be made inaccessible, since the structure is not meant to actually be used.</p>",
        "id": 514662305,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1745771812
    },
    {
        "content": "<p>That seems reasonable also</p>",
        "id": 514662907,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1745772275
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"479299\">@Jovan Gerbscheid</span> Take a look at <code>variable_alias</code>, what <span class=\"user-mention\" data-user-id=\"439483\">@Andrew Yang</span> mentioned. It's pretty much the same idea. It's not recursive though.</p>",
        "id": 514665080,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1745773917
    },
    {
        "content": "<p>Where can it be found?</p>",
        "id": 514665204,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1745773978
    },
    {
        "content": "<p>I don't know if there are any mathlib examples except in the tests folder. Here's where it's implemented: <a href=\"https://github.com/leanprover-community/mathlib4/blob/master/Mathlib/Tactic/Variable.lean\">https://github.com/leanprover-community/mathlib4/blob/master/Mathlib/Tactic/Variable.lean</a></p>\n<p>It's only for <code>variable?</code></p>",
        "id": 514665682,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1745774337
    },
    {
        "content": "<p>There are e.g. <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=HilbertSpace#doc\">docs#HilbertSpace</a> that implements <code>variable_alias</code> but as I said it is banned in mathlib somehow.</p>",
        "id": 514665899,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1745774502
    },
    {
        "content": "<p>It's banned in Mathlib, because it works with <code>variable?</code>, not <code>variable</code>. I think that we should improve support for variable aliases so that one can write <code>[HilberSpace K V]</code> in <code>variable</code> or theorem assumptions and get the right thing, possibly with slightly different syntax, e.g., <code>[[HilbertSpace K V]]</code>.</p>",
        "id": 514666115,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1745774688
    },
    {
        "content": "<p>Then we can turn <code>[Comm*]</code> into variable aliases and have 2 separate searches, one in the non-commutative hierarcy, and one for <code>IsMulCommutative</code>.</p>",
        "id": 514666168,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1745774743
    },
    {
        "content": "<p>Yeah my question is why is <code>variable?</code> banned? Is it just because it is noisy by default or is it a conscious decision?</p>",
        "id": 514666272,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1745774807
    },
    {
        "content": "<p>(<span class=\"user-mention\" data-user-id=\"214703\">@Yury G. Kudryashov</span> Is this different from what Matt proposed in his first message today in this thread?)</p>",
        "id": 514666335,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1745774848
    },
    {
        "content": "<p>I can see why <code>variable?</code> is discouraged: it automatically infers the arguments that it thinks it needs. My suggested system is transparent: it is clear what hypotheses are added. And you have more control over it.</p>",
        "id": 514666337,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1745774849
    },
    {
        "content": "<p>Are people aware that <code>variable?</code> expands to the full form?</p>\n<p>However, even when expanded it still does the expansion to verify that the expanded form is correct. It's like <code>says</code>.</p>",
        "id": 514666483,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1745774950
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Comm.20vs.20non-Comm.20instance.20design/near/514666335\">said</a>:</p>\n<blockquote>\n<p>(<span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> Is this different from what Matt proposed in his first message today in this thread?)</p>\n</blockquote>\n<p>No, it's the same (modulo the question about auto deducing preexisting instances). I'm sorry for answering the last question without reading history. I'm going offline for several hours now, then I'll reread this thread.</p>",
        "id": 514666596,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1745775020
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Comm.20vs.20non-Comm.20instance.20design/near/514666483\">said</a>:</p>\n<blockquote>\n<p>Are people aware that <code>variable?</code> expands to the full form?</p>\n</blockquote>\n<p>Oh I see. But I want this feature for readability. I want to reduce the number of characters it takes to read/write e.g. <code>[PID P]</code>, instead of <code>[CommRing P] [IsDomain P] [IsPrincipalIdealRing P]</code></p>",
        "id": 514666776,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1745775172
    },
    {
        "content": "<p>There was a recent discussion about this. I sketched a possible design in <a class=\"message-link\" href=\"/#narrow/channel/287929-mathlib4/topic/Normed.20modules/near/512234387\">#mathlib4 &gt; Normed modules @ üí¨</a>  which looked reasonable to the participants of the discussion at the time.</p>",
        "id": 514666916,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1745775289
    },
    {
        "content": "<p>Yes. I should have referenced this explicitly but assumed everyone remembered.</p>",
        "id": 514667095,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1745775475
    },
    {
        "content": "<p>Probably not a good assumption</p>",
        "id": 514667151,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1745775497
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110050\">@S√©bastien Gou√´zel</span> Thanks, I just read the thread. The proposed feature sounds like the <code>@[variable_alias]</code> feature for <code>variable?</code>,  correct?</p>\n<p>There's a performance issue, but it's not the worst. Deciding whether or not to include an instance requires failing instance searches, which tend to be slow since Lean will go to great lengths to find an instance.</p>",
        "id": 514667449,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1745775755
    },
    {
        "content": "<p>Ah, I misread. Double brackets invokes the <code>variable?</code> behavior. Still, the performance point stands.</p>",
        "id": 514667508,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1745775817
    },
    {
        "content": "<p>I think that such a design as in <code>variable?</code>, which automatically decides whether to add an instance, isn't great.</p>\n<ul>\n<li>It adds an overhead for the reader to figure out what hypotheses are added.</li>\n<li>It seems fragile because a theorem could gain an unintended type class assumption because of a change upstream.</li>\n</ul>",
        "id": 514669051,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1745776990
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479299\">Jovan Gerbscheid</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Comm.20vs.20non-Comm.20instance.20design/near/514666776\">said</a>:</p>\n<blockquote>\n<p>Oh I see. But I want this feature for readability. I want to reduce the number of characters it takes to read/write e.g. <code>[PID P]</code>, instead of <code>[CommRing P] [IsDomain P] [IsPrincipalIdealRing P]</code></p>\n</blockquote>\n<p>I have an impression you haven't tried <code>variable?</code>. With</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>there is a code action to expanding it to</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>Or, in the tests file,</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">VectorSpace</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>there is a code action expanding it to</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">VectorSpace</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>I don't think <code>variable?</code> is the full answer, especially if we could get a reasonable <code>[[Module R M]]</code> as an actual binder notation, but I want to understand what your objection is, in case I misunderstood whether you knew what the expansions looked like.</p>\n<p>Having the <code>=&gt;</code> part is basically for review purposes and for protecting against changes to typeclass hierarchy. It's there for similar reasons to why some people support keeping autoimplicits off in Mathlib even if we have inlay hints for them in our IDEs.</p>\n<p>(<span class=\"user-mention\" data-user-id=\"439483\">@Andrew Yang</span> I'm not sure why <code>variable?</code> with a <code>=&gt;</code> clause is banned in mathlib. I'm not even sure whether or not it <em>is</em> banned.)</p>",
        "id": 514669165,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1745777052
    },
    {
        "content": "<p>Right, in my message I was referring to a design without the <code>=&gt;</code>, which is think is what is being proposed</p>",
        "id": 514669353,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1745777174
    },
    {
        "content": "<p>I think my proposed design should allow us to refactor the <code>Comm</code> vs non-<code>Comm</code> instance design without having to touch many of the theorems, or having to worry about whether got the correct hypotheses.</p>",
        "id": 514669476,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1745777271
    },
    {
        "content": "<p>To me, an important issue is readability, which is already a little bit problematic in examples like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NontriviallyNormedField</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithTop</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"bp\">‚àû</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedSpace</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ModelWithCorners</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ChartedSpace</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsManifold</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"bp\">‚àû</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ContMDiffVectorBundle</span><span class=\"w\"> </span><span class=\"bp\">‚àû</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TangentSpace</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">infer_instance</span>\n</code></pre></div>\n<p>Here, the <code>variable</code> is the minimal one to make sense of the statement, and it's already super long. If we decouple algebra from topology, as has been discussed (and is certainly a very good idea if the readability issues are solved), this would become</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Norm</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsNontriviallyNormedField</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithTop</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"bp\">‚àû</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddGroup</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsCommAdd</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Norm</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsNormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsNormedSpace</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ModelWithCorners</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ChartedSpace</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsManifold</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"bp\">‚àû</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ContMDiffVectorBundle</span><span class=\"w\"> </span><span class=\"bp\">‚àû</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TangentSpace</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">infer_instance</span>\n</code></pre></div>\n<p>which is even longer. Being able to just have</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithTop</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"bp\">‚àû</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[[</span><span class=\"n\">IsNormedSpace</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]]</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ModelWithCorners</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[[</span><span class=\"n\">IsManifold</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"bp\">‚àû</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]]</span>\n</code></pre></div>\n<p>would be a tremendous improvement in this respect.</p>",
        "id": 514670161,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1745777706
    },
    {
        "content": "<p>The only differences <span class=\"user-mention\" data-user-id=\"479299\">@Jovan Gerbscheid</span> between what you're proposing and <code>variable?</code> are:</p>\n<ol>\n<li>There's a feature to add missing instances on instance synthesis failure. That can be disabled easily enough.</li>\n<li>Rather than use fields of a structure, it uses parameters of a structure to record <code>@[variable_aliases]</code> (there are some good reasons to do this instead of using fields, beyond just supporting 1, but without 1 the design would probably need to be a bit different).</li>\n<li>It has a code action to add the expanded form, for review.</li>\n</ol>",
        "id": 514670167,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1745777715
    },
    {
        "content": "<ol start=\"4\">\n<li>This is just for <code>variable</code>s rather than binders in declarations. (But until core is extended that's a fundamental limitation.)</li>\n</ol>",
        "id": 514670278,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1745777777
    },
    {
        "content": "<p><del>I thought he wanted it in declarations also</del> misread.</p>",
        "id": 514670799,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1745778139
    },
    {
        "content": "<p>Me too Matt :-) But for completeness of the list of differences I thought I should include it.</p>",
        "id": 514670869,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1745778195
    },
    {
        "content": "<ol start=\"5\">\n<li>My proposal doesn't add any new syntax for stating theorems. We can just use the familiar <code>[..]</code> instance binders.</li>\n</ol>",
        "id": 514671605,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1745778652
    },
    {
        "content": "<p>Noted, though that's not a difference between your proposal and <code>variable?</code>.</p>",
        "id": 514671773,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1745778777
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110050\">@S√©bastien Gou√´zel</span> Introducing manifolds is such a chore, and I hope it's not always going to be multiple lines of variable declarations...</p>\n<p>When implementing <code>variable?</code> I found that adding the missing instances as new binders didn't always work right. I don't have any examples off-hand, but it was something to do with when you have a list of instance binders, you sort of need to look at the whole list to see what the \"right\" missing instance binders to add are. (Choices for earlier binders might throw later binders off.)</p>\n<p>Some sort of aliasing system to be able to control which missing instances to add would go a long way toward making things usable/maintainable. (Even if it's not based on what's missing, but a simple macro expansion.)</p>\n<p>One thought that comes to mind is having a missing instance system that only looks to see which local instances already exist (no global search). A downside is that it might add binders for things like <code>[Field ‚Ñù]</code> just because it's not a local instance. Maybe that's something that can be linted for.</p>",
        "id": 514671906,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1745778882
    },
    {
        "content": "<p>Well, <code>variable? .. =&gt; ..</code> seems like new syntax needed to understand theorems</p>",
        "id": 514671907,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1745778883
    },
    {
        "content": "<p>What I'm trying to say <span class=\"user-mention\" data-user-id=\"479299\">@Jovan Gerbscheid</span> is that your proposal is basically explored in <code>variable?</code> already, so I'm not sure what you're objecting to.</p>",
        "id": 514672063,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1745779022
    },
    {
        "content": "<p>I brought up the specifics of how <code>=&gt;</code> worked because it seemed like you were objecting to the fact that <code>variable?</code> had an expansion feature, and it seemed like you thought it meant that you couldn't see the short form anymore.</p>",
        "id": 514672112,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1745779080
    },
    {
        "content": "<p>(Or, said differently, if there's something different about your proposal and how <code>@[variable_alias]</code> works, I'm interested to hear it. I just find it hard to understand what's different without a careful comparison.)</p>",
        "id": 514672527,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1745779390
    },
    {
        "content": "<p>If there is a performance issue with the complicated design where on tries to synthetize the missing instances, I think the more simple-minded approach of just adding the intermediate instances if they are not already present in the context would already be helpful for readability.</p>\n<p>I mean, with something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">variable_alias</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NontriviallyNormedField</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">NormedSpace</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">NormedVectorSpace</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[[</span><span class=\"n\">NormedVectorSpace</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]]</span><span class=\"w\"> </span><span class=\"o\">[[</span><span class=\"n\">NormedVectorSpace</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]]</span>\n</code></pre></div>\n<p>then the last <code>variable</code> line would be interpreted as </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NontriviallyNormedField</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">NormedSpace</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedSpace</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>And it's the responsability of the user to make sure there is not already a <code>[NormedField ùïú]</code> around, because this would give two field structures on <code>ùïú</code>, in the same way that currently it's the responsability of the user to make sure we don't have <code>[Ring R] [CommRing R]</code>.</p>",
        "id": 514725429,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1745818961
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110050\">@S√©bastien Gou√´zel</span> Naively, that last line would become</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NontriviallyNormedField</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedSpace</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NontriviallyNormedField</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedSpace</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>right?<br>\nSo you do want the system to be responsible for not inserting a second copy of <code>[NontriviallyNormedField ùïú]</code>, is that right?</p>",
        "id": 514738539,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1745825035
    },
    {
        "content": "<p>Yes. I wrote \"just adding the intermediate instances if they are not already present in the context\" precisely for this issue. Just looking whether an instance is already there in this exact form, without launching typeclass inference, should be very cheap and avoid the performance issue <span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> was afraid of, hopefully.</p>",
        "id": 514739638,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1745825402
    },
    {
        "content": "<p>Aha, understood. That makes sense.</p>",
        "id": 514740149,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1745825556
    },
    {
        "content": "<p>This won't help with <code>[[NormedSpace Real E]]</code>. What about \"run typeclass instance with high priority instances only\"? Or does it require a fix in the core for priority of <code>extends</code>?</p>",
        "id": 514740160,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1745825561
    },
    {
        "content": "<p>Yes, this won't help in some situations. But still it would be helpful in many situations -- for instance if you want to refactor <code>[CommGroup E]</code> to become <code>[Group E] [IsMulComm E]</code>, then replacing <code>[CommGroup (.)]</code> with <code>[[CommGroup $1]]</code> throughout the library would be enough.</p>",
        "id": 514743230,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1745826486
    },
    {
        "content": "<p>I think that (A) \"binding multiple type classes in one go\" and (B) \"automatically binding missing type classes\" are different features that should be independently available. My proposal only does (A). Then if we also want (B), I propose that we use <code>[[..]]</code> notation for it.</p>\n<p><span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span>, the difference between my proposal and <code>variable?</code> is that when declaring a <code>class_abbrev'</code>, there is a distinction between parameters and field. For example, a normed vectorspace would be</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">class_abbrev'</span><span class=\"w\"> </span><span class=\"n\">NormedVectorSpace</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NontriviallyNormedField</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedSpace</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>And we can introduce two of them with</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NontriviallyNormedField</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">]</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedVectorSpace</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedVectorSpace</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>Or using (B), it would be what <span class=\"user-mention\" data-user-id=\"110050\">@S√©bastien Gou√´zel</span> wrote:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[[</span><span class=\"n\">NormedVectorSpace</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]]</span><span class=\"w\"> </span><span class=\"o\">[[</span><span class=\"n\">NormedVectorSpace</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]]</span>\n</code></pre></div>\n<p>I worry about both the mental and computational overhead that (B) would add. But if we can use (A) without (B), then I have no objection to adding (B). On the other hand I think (B) without (A) is also useful, e.g. writing <code>[[LawfulBEq Œ±]]</code> instead of <code>[BEq Œ±] [LawfulBEq Œ±]</code>.</p>",
        "id": 514775198,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1745835587
    },
    {
        "content": "<p>Another consideration for my proposal for (A) is whether <code>[NormedVectorSpace ùïú E]</code> should actually be expanded into <code>[NormedAddCommGroup E] [NormedSpace ùïú E]</code> when elaborating the statement or not. My goal is to improve readability, so it would be beneficial if the type of a theorem about normed vectorspaces contained hypothesis<code>[NormedVectorSpace ùïú E]</code> instead of <code>[NormedAddCommGroup E] [NormedSpace ùïú E]</code>. This would be useful when hovering over the theorem.</p>\n<p>Implementing this would mean that <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.LocalInstance#doc\">docs#Lean.LocalInstance</a> should be able to contain a structure projection of a free variable, instead of just a free variable. And when adding a variable to the local context, it would add the fields of a <code>class_abbrev</code> as local instances. And the constructor of the <code>class_abbrev'</code> would have to be tagged as the only instance of the class.</p>\n<p>At this point this could just be a refactor of <code>class abbrev</code> instead of a separate feature.</p>",
        "id": 514784832,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1745838682
    },
    {
        "content": "<p>Returning to the original approach in the thread: <a href=\"https://github.com/leanprover-community/mathlib4/pull/24429\">#24429</a> which tries to keep you in the CommX level of the instance graph as long as possible once you start there shows now builds enough for benchmarking</p>",
        "id": 515500001,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1746104028
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Diff\"><pre><span></span><code><span class=\"w\"> </span> Benchmark                                                                    Metric         Change\n<span class=\"w\"> </span> ==================================================================================================\n<span class=\"gd\">- build                                                                        instructions    1.01%</span>\n<span class=\"gd\">- ~Mathlib.Algebra.Algebra.Subalgebra.Rank                                     instructions    59.3%</span>\n<span class=\"gd\">- ~Mathlib.Algebra.DirectSum.Internal                                          instructions    23.8%</span>\n<span class=\"gi\">+ ~Mathlib.Algebra.Lie.TraceForm                                               instructions    -7.8%</span>\n<span class=\"gi\">+ ~Mathlib.Algebra.Lie.Weights.Killing                                         instructions    -5.0%</span>\n<span class=\"gd\">- ~Mathlib.Algebra.Order.GroupWithZero.Unbundled.Basic                         instructions    22.8%</span>\n<span class=\"gd\">- ~Mathlib.Algebra.TrivSqZeroExt                                               instructions    11.8%</span>\n<span class=\"gi\">+ ~Mathlib.AlgebraicGeometry.AffineSpace                                       instructions    -4.2%</span>\n<span class=\"gi\">+ ~Mathlib.AlgebraicGeometry.ProjectiveSpectrum.Proper                         instructions   -21.0%</span>\n<span class=\"gd\">- ~Mathlib.Analysis.Asymptotics.Defs                                           instructions    15.2%</span>\n<span class=\"gi\">+ ~Mathlib.Analysis.CStarAlgebra.ContinuousFunctionalCalculus.Instances        instructions    -5.7%</span>\n<span class=\"gi\">+ ~Mathlib.Analysis.CStarAlgebra.ContinuousFunctionalCalculus.Restrict         instructions   -19.5%</span>\n<span class=\"gd\">- ~Mathlib.Analysis.CStarAlgebra.ContinuousFunctionalCalculus.Unital           instructions    11.3%</span>\n<span class=\"gd\">- ~Mathlib.Analysis.CStarAlgebra.GelfandDuality                                instructions    13.8%</span>\n<span class=\"gd\">- ~Mathlib.Analysis.CStarAlgebra.Matrix                                        instructions    33.5%</span>\n<span class=\"gd\">- ~Mathlib.Analysis.Complex.UpperHalfPlane.Basic                               instructions   116.1%</span>\n<span class=\"gd\">- ~Mathlib.Analysis.Convolution                                                instructions     6.9%</span>\n<span class=\"gd\">- ~Mathlib.Analysis.InnerProductSpace.Adjoint                                  instructions    38.8%</span>\n<span class=\"gd\">- ~Mathlib.Analysis.InnerProductSpace.Projection                               instructions     7.1%</span>\n<span class=\"gd\">- ~Mathlib.Analysis.Normed.Field.UnitBall                                      instructions    93.1%</span>\n<span class=\"gd\">- ~Mathlib.Analysis.Normed.Lp.lpSpace                                          instructions     5.0%</span>\n<span class=\"gi\">+ ~Mathlib.Analysis.SpecialFunctions.ContinuousFunctionalCalculus.Rpow.Basic   instructions    -6.7%</span>\n<span class=\"gi\">+ ~Mathlib.FieldTheory.CardinalEmb                                             instructions   -14.2%</span>\n<span class=\"gi\">+ ~Mathlib.FieldTheory.Extension                                               instructions   -23.8%</span>\n<span class=\"gi\">+ ~Mathlib.FieldTheory.Galois.Infinite                                         instructions   -21.9%</span>\n<span class=\"gd\">- ~Mathlib.FieldTheory.Galois.Profinite                                        instructions    79.8%</span>\n<span class=\"gi\">+ ~Mathlib.FieldTheory.IntermediateField.Adjoin.Basic                          instructions   -11.1%</span>\n<span class=\"gi\">+ ~Mathlib.FieldTheory.IntermediateField.Adjoin.Defs                           instructions   -22.9%</span>\n<span class=\"gi\">+ ~Mathlib.FieldTheory.IntermediateField.Basic                                 instructions   -29.9%</span>\n<span class=\"gi\">+ ~Mathlib.FieldTheory.IsAlgClosed.AlgebraicClosure                            instructions   -28.9%</span>\n<span class=\"gd\">- ~Mathlib.FieldTheory.KummerExtension                                         instructions    21.8%</span>\n<span class=\"gi\">+ ~Mathlib.FieldTheory.LinearDisjoint                                          instructions   -13.4%</span>\n<span class=\"gi\">+ ~Mathlib.FieldTheory.PurelyInseparable.Basic                                 instructions   -29.3%</span>\n<span class=\"gd\">- ~Mathlib.FieldTheory.RatFunc.Basic                                           instructions     4.6%</span>\n<span class=\"gi\">+ ~Mathlib.FieldTheory.SeparableDegree                                         instructions   -21.6%</span>\n<span class=\"gi\">+ ~Mathlib.Geometry.Manifold.Algebra.LeftInvariantDerivation                   instructions    -6.0%</span>\n<span class=\"gd\">- ~Mathlib.Geometry.Manifold.ContMDiff.NormedSpace                             instructions    14.8%</span>\n<span class=\"gd\">- ~Mathlib.Geometry.Manifold.MFDeriv.NormedSpace                               instructions    14.7%</span>\n<span class=\"gd\">- ~Mathlib.GroupTheory.HNNExtension                                            instructions    19.0%</span>\n<span class=\"gd\">- ~Mathlib.GroupTheory.SpecificGroups.ZGroup                                   instructions    56.1%</span>\n<span class=\"gd\">- ~Mathlib.GroupTheory.Sylow                                                   instructions    54.0%</span>\n<span class=\"gd\">- ~Mathlib.GroupTheory.Transfer                                                instructions    75.2%</span>\n<span class=\"gd\">- ~Mathlib.LinearAlgebra.CliffordAlgebra.BaseChange                            instructions    20.5%</span>\n<span class=\"gi\">+ ~Mathlib.LinearAlgebra.CliffordAlgebra.Basic                                 instructions   -29.7%</span>\n<span class=\"gd\">- ~Mathlib.LinearAlgebra.CliffordAlgebra.Even                                  instructions    25.7%</span>\n<span class=\"gd\">- ~Mathlib.LinearAlgebra.CliffordAlgebra.EvenEquiv                             instructions    66.2%</span>\n<span class=\"gd\">- ~Mathlib.LinearAlgebra.CliffordAlgebra.Grading                               instructions   149.7%</span>\n<span class=\"gi\">+ ~Mathlib.LinearAlgebra.Dual.Lemmas                                           instructions    -6.3%</span>\n<span class=\"gd\">- ~Mathlib.LinearAlgebra.ExteriorAlgebra.Grading                               instructions    38.1%</span>\n<span class=\"gd\">- ~Mathlib.LinearAlgebra.ExteriorPower.Basic                                   instructions    12.8%</span>\n<span class=\"gd\">- ~Mathlib.LinearAlgebra.FreeProduct.Basic                                     instructions    68.9%</span>\n<span class=\"gd\">- ~Mathlib.LinearAlgebra.RootSystem.Irreducible                                instructions   100.6%</span>\n<span class=\"gd\">- ~Mathlib.LinearAlgebra.RootSystem.WeylGroup                                  instructions    81.4%</span>\n<span class=\"gi\">+ ~Mathlib.LinearAlgebra.Semisimple                                            instructions   -26.2%</span>\n<span class=\"gd\">- ~Mathlib.LinearAlgebra.TensorAlgebra.Grading                                 instructions   210.6%</span>\n<span class=\"gd\">- ~Mathlib.LinearAlgebra.TensorProduct.Graded.Internal                         instructions     4.8%</span>\n<span class=\"gd\">- ~Mathlib.LinearAlgebra.TensorProduct.Subalgebra                              instructions    11.2%</span>\n<span class=\"gd\">- ~Mathlib.MeasureTheory.Group.FundamentalDomain                               instructions    11.0%</span>\n<span class=\"gd\">- ~Mathlib.MeasureTheory.Measure.Haar.Disintegration                           instructions    62.8%</span>\n<span class=\"gd\">- ~Mathlib.NumberTheory.ModularForms.SlashActions                              instructions   139.0%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.AdjoinRoot                                               instructions    -8.5%</span>\n<span class=\"gd\">- ~Mathlib.RingTheory.Algebraic.MvPolynomial                                   instructions    32.1%</span>\n<span class=\"gd\">- ~Mathlib.RingTheory.AlgebraicIndependent.Basic                               instructions    39.7%</span>\n<span class=\"gd\">- ~Mathlib.RingTheory.AlgebraicIndependent.TranscendenceBasis                  instructions    17.2%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.ClassGroup                                               instructions   -10.8%</span>\n<span class=\"gd\">- ~Mathlib.RingTheory.DedekindDomain.AdicValuation                             instructions    48.9%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.DedekindDomain.Ideal                                     instructions    -6.7%</span>\n<span class=\"gd\">- ~Mathlib.RingTheory.EssentialFiniteness                                      instructions    36.7%</span>\n<span class=\"gd\">- ~Mathlib.RingTheory.Filtration                                               instructions    36.3%</span>\n<span class=\"gd\">- ~Mathlib.RingTheory.FinitePresentation                                       instructions    33.9%</span>\n<span class=\"gd\">- ~Mathlib.RingTheory.Generators                                               instructions    35.5%</span>\n<span class=\"gd\">- ~Mathlib.RingTheory.GradedAlgebra.FiniteType                                 instructions    96.6%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.Ideal.Norm.RelNorm                                       instructions   -13.3%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.IntegralClosure.IntegralRestrict                         instructions    -5.4%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.Jacobson.Ring                                            instructions   -23.8%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.Kaehler.Basic                                            instructions    -6.3%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.Kaehler.Polynomial                                       instructions   -31.8%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.LaurentSeries                                            instructions   -14.3%</span>\n<span class=\"gd\">- ~Mathlib.RingTheory.LinearDisjoint                                           instructions    14.5%</span>\n<span class=\"gd\">- ~Mathlib.RingTheory.LittleWedderburn                                         instructions    27.9%</span>\n<span class=\"gd\">- ~Mathlib.RingTheory.LocalProperties.Projective                               instructions    31.1%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.LocalRing.ResidueField.Ideal                             instructions   -40.5%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.Localization.Free                                        instructions   -31.9%</span>\n<span class=\"gd\">- ~Mathlib.RingTheory.Polynomial.Cyclotomic.Basic                              instructions    28.2%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.Polynomial.Quotient                                      instructions   -28.4%</span>\n<span class=\"gd\">- ~Mathlib.RingTheory.Presentation                                             instructions    25.6%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.RingHom.Locally                                          instructions   -17.1%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.Spectrum.Prime.Homeomorph                                instructions   -20.7%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.Spectrum.Prime.Polynomial                                instructions   -19.7%</span>\n<span class=\"gd\">- ~Mathlib.RingTheory.TensorProduct.Basic                                      instructions     3.2%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.Valuation.AlgebraInstances                               instructions   -58.8%</span>\n<span class=\"gi\">+ ~Mathlib.RingTheory.Valuation.ValuationSubring                               instructions   -49.3%</span>\n<span class=\"gd\">- ~Mathlib.RingTheory.WittVector.FrobeniusFractionField                        instructions    49.9%</span>\n<span class=\"gd\">- ~Mathlib.SetTheory.Game.Basic                                                instructions    14.7%</span>\n<span class=\"gd\">- ~Mathlib.Topology.Algebra.Category.ProfiniteGrp.Limits                       instructions    57.0%</span>\n<span class=\"gd\">- ~Mathlib.Topology.ContinuousMap.StoneWeierstrass                             instructions    16.6%</span>\n</code></pre></div>",
        "id": 515500004,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1746104030
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 515500320,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1746104176
    },
    {
        "content": "<p>/poll Should we<br>\nGo with deprioritizing <code>CommX.toX</code> (first diff above)<br>\nGo with prioritizing <code>CommX.toX</code>(most recent diff above)<br>\nDo nothing and see any core fix is inbound</p>",
        "id": 515500449,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1746104229
    },
    {
        "content": "<p>I think the first option is reasonable for the short term and can easily be ripped out if we want to unbundle <code>Comm</code> from everything.</p>",
        "id": 515500662,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1746104303
    },
    {
        "content": "<p>I've made an RFC for my proposal about reimplementing <code>class abbrev</code> <a href=\"https://github.com/leanprover/lean4/pull/8279\">lean#8279</a></p>",
        "id": 517310092,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1746925725
    }
]