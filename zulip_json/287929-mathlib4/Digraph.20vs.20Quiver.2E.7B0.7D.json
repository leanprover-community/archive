[
    {
        "content": "<p>Mathlib contains both <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Quiver#doc\">docs#Quiver</a> (with a moderate API) and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Digraph#doc\">docs#Digraph</a> (with a small API) but mathematically <code>Quiver.{0}</code> is the same as <code>Digraph</code>.</p>\n<p>So we could do any of:</p>\n<ol>\n<li>Continue with both, living with the duplication</li>\n<li>Make <code>Digraph</code> an <code>abbrev</code> for <code>Quiver.{0}</code> (and write some custom API for this case)</li>\n<li>Something else</li>\n</ol>\n<p>Has anyone thought about this?</p>",
        "id": 545016210,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1760547007
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 545017317,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760547361
    },
    {
        "content": "<p>I guess Quiver being a class vs Digraph being a structure might be a relevant discrepancy?</p>",
        "id": 545047571,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1760550464
    },
    {
        "content": "<p>(Noting also that <code>Category</code> extends <code>CategoryStruct</code> which extends <code>Quiver</code>. I don't know whether \"un-classing\" <code>Quiver</code> would cause a problem there.)</p>",
        "id": 545155784,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1760581162
    },
    {
        "content": "<p>In <a href=\"https://github.com/leanprover-community/mathlib4/pull/34228\">#34228</a> I try a completely different solution which is simply to change <code>Sort v</code> to <code>Type v</code> in the definition of quiver, i.e. make our old <code>Quiver.{0}</code> not exist any more, because we have <code>Digraph</code>. It makes mathlib much better (a lot of our theory of quivers only works for types, it turns out, and right now we use the slightly clunky fix <code>Quiver.{v+1}</code> everywhere). The diff is very pleasing, but it has one catch, in that just over the last few months we merged <code>Matrix.toQuiver</code> which constructs a digraph from a matrix, but we used quiver because it had more API :-/ Right now I fixed it with a <code>PLift</code> hack.</p>",
        "id": 569552187,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1769103519
    },
    {
        "content": "<p>Maybe rename Quiver to SQuiver and define <code>Quiver.{v} = SQuiver.{v+1}</code> and <code>Digraph = SQuiver.{0}</code></p>",
        "id": 569554052,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1769104074
    },
    {
        "content": "<p>Please don't. <code>Digraph</code> is acquiring a support set, cf <a href=\"https://github.com/leanprover-community/mathlib4/pull/33466\">#33466</a></p>",
        "id": 569554310,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1769104151
    },
    {
        "content": "<blockquote>\n<ol>\n<li>Continue with both, living with the duplication</li>\n</ol>\n</blockquote>\n<p>Actually we've always been living with the duplications <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=And#doc\">docs#And</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Prod#doc\">docs#Prod</a>, etc.<br>\n(<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=PProd#doc\">docs#PProd</a> <del>subsumes both but</del> is rarely used; by that naming convention SQuiver should be PQuiver)</p>",
        "id": 569554551,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1769104243
    },
    {
        "content": "<p>a bit more context also here <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/RFC.3A.20Quiver.20refactor/with/569381768\">#mathlib4 &gt; RFC: Quiver refactor</a></p>",
        "id": 569555434,
        "sender_full_name": "Matteo Cipollina",
        "timestamp": 1769104494
    },
    {
        "content": "<p>PProd doesn't subsume And because it can't return a Prop.</p>",
        "id": 569594243,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1769118320
    },
    {
        "content": "<p>it is possible to make a universe polymorphic product type with signature <code>Sort u â†’ Sort v â†’ Sort (max u v)</code> and this would subsume both <code>And</code> and <code>Prod</code></p>",
        "id": 569595215,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1769118726
    },
    {
        "content": "<p>Doesn't work:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">universe</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span>\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Prod'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Î²</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span>\n<span class=\"w\">  </span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î²</span>\n<span class=\"c\">/-</span><span class=\"cm\"> Invalid universe polymorphic resulting type: The resulting universe is not `Prop`, but it may be `Prop` for some parameter values:</span>\n<span class=\"cm\">  Sort (max u v)</span>\n\n<span class=\"cm\">Hint: A possible solution is to use levels of the form `max 1 _` or `_ + 1` to ensure the universe is of the form `Type _` -/</span>\n</code></pre></div>",
        "id": 569595939,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1769119101
    },
    {
        "content": "<p>I recall it used to work in Lean 3 (I think I also see <code>imax</code> more often those days); I recall there are some changes to the kernel in between but I can't point to the PR(s)</p>",
        "id": 569596146,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1769119204
    },
    {
        "content": "<p>The reason this doesn't show up with Quiver (and Category) is that Quiver involves <code>Type u</code> so can never be a Prop itself.</p>",
        "id": 569596968,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1769119498
    },
    {
        "content": "<p>The universe of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Quiver#doc\">docs#Quiver</a> is pretty: <code>Type max u v</code>. It's the universe of <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/CategoryTheory/Category/Basic.html#CategoryTheory.CategoryStruct\">CategoryTheory.CategoryStruct</a> that is ugly (<code>Type max u (v+1)</code>). Should we change (generalize) the latter instead? That would also eliminate the ULift hack we use to define the category associated to a preorder.</p>",
        "id": 569597531,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1769119719
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"224323\">Junyan Xu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Digraph.20vs.20Quiver.2E.7B0.7D/near/569595939\">said</a>:</p>\n<blockquote>\n<p>Doesn't work:</p>\n</blockquote>\n<p>you aren't trying hard enough:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">universe</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">genInjectivity</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">genSizeOf</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">bootstrap</span><span class=\"bp\">.</span><span class=\"n\">inductiveCheckResultingUniverse</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Prod'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Î²</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î²</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Prod'</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"n\">Î²</span>\n</code></pre></div>",
        "id": 569597784,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1769119819
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"224323\">Junyan Xu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Digraph.20vs.20Quiver.2E.7B0.7D/near/569597531\">said</a>:</p>\n<blockquote>\n<p>Should we change (generalize) the latter instead?</p>\n</blockquote>\n<p>I don't think so. I don't think you can have everything pretty. For example, for large categories right now, u=v+1 and our \"ugly\" type simplifies to <code>Type (v+1)</code>.</p>",
        "id": 569597790,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1769119824
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Digraph.20vs.20Quiver.2E.7B0.7D/near/569597784\">said</a>:</p>\n<blockquote>\n<p>you aren't trying hard enough:</p>\n</blockquote>\n<p>I suspect that with all those <code>set_option</code>s you might be trying a little <em>too</em> hard (at least as far as mathlib is concerned!)</p>",
        "id": 569597997,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1769119905
    },
    {
        "content": "<p><del>Can you prove false with <code>bootstrap.inductiveCheckResultingUniverse false</code>?</del><br>\n(Update: I tried and it still checks the specified universe is large enough.)</p>",
        "id": 569598037,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1769119925
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Digraph.20vs.20Quiver.2E.7B0.7D/near/569597997\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Digraph.20vs.20Quiver.2E.7B0.7D/near/569597784\">said</a>:</p>\n<blockquote>\n<p>you aren't trying hard enough:</p>\n</blockquote>\n<p>I suspect that with all those <code>set_option</code>s you might be trying a little <em>too</em> hard (at least as far as mathlib is concerned!)</p>\n</blockquote>\n<p>yeah it's definitely not worth the trouble</p>",
        "id": 569598038,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1769119925
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"224323\">Junyan Xu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Digraph.20vs.20Quiver.2E.7B0.7D/near/569598037\">said</a>:</p>\n<blockquote>\n<p>Can you prove false with <code>bootstrap.inductiveCheckResultingUniverse false</code>?</p>\n</blockquote>\n<p>I sure hope not, given that it's used in prelude for <code>PEmpty</code> and <code>PUnit</code></p>",
        "id": 569598109,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1769119960
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=PEmpty#src\">src#PEmpty</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=PUnit#src\">src#PUnit</a></p>",
        "id": 569598136,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1769119974
    },
    {
        "content": "<p>In the past we tried to change Category to accept Sort-valued morphisms and the result is just the opposite of <a href=\"https://github.com/leanprover-community/mathlib4/pull/34228\">#34228</a> -- lots of <code>+1</code>s and fighting.</p>",
        "id": 569598194,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1769119998
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Digraph.20vs.20Quiver.2E.7B0.7D/near/569598194\">said</a>:</p>\n<blockquote>\n<p>In the past we tried to change Category to accept Sort-valued morphisms and the result is just the opposite of <a href=\"https://github.com/leanprover-community/mathlib4/pull/34228\">#34228</a> -- lots of <code>+1</code>s and fighting.</p>\n</blockquote>\n<p>Which is unfortunate, because it makes categorical semantics for lambda calculi very difficult downstream. You either do intrinsic typing judgements in <code>Type</code> (shutting you out of much of the idiomatic formalization techniques unless you use tactics to construct data) or have to wrangle with universe lifting. I've still not gotten to a point where I have a solution I really like to the point of putting it in CSLib.</p>",
        "id": 569600560,
        "sender_full_name": "Chris Henson",
        "timestamp": 1769120995
    },
    {
        "content": "<p>Apparently Quiver is used in 195 files and Kevin's PR only removes <code>+1</code> from 20 of them.<br>\nWas Sophie's problem mainly due to the Category/Quiver mismatch? If so then changing either should solve the problem.</p>",
        "id": 569600915,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1769121161
    },
    {
        "content": "<p>I don't think generalizing Category is at all feasible -- as I say it's been tried before and it was a failure (although this <em>might</em> have been in Lean3?). Sophie was just frustrated because she was getting obscure universe errors due to the Category/Quiver mismatch and I thought I'd experiment with changing Quiver to see if we were really using it. I don't have a strong argument for merging <a href=\"https://github.com/leanprover-community/mathlib4/pull/34228\">#34228</a> other than the fact that it establishes the symmetry.</p>",
        "id": 569605030,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1769123332
    },
    {
        "content": "<p>Can you point to previous attempts (branch/PR)? Apparently the design decision is not documented in docstrings.</p>",
        "id": 569605111,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1769123382
    },
    {
        "content": "<p>It was Lean 3, I can find it...</p>",
        "id": 569606006,
        "sender_full_name": "Chris Henson",
        "timestamp": 1769123854
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib3/pull/1256\">https://github.com/leanprover-community/mathlib3/pull/1256</a> and <a href=\"https://github.com/leanprover-community/mathlib3/pull/1122\">https://github.com/leanprover-community/mathlib3/pull/1122</a> and <a href=\"https://github.com/leanprover-community/mathlib3/pull/1412\">https://github.com/leanprover-community/mathlib3/pull/1412</a> and <a class=\"message-link\" href=\"/#narrow/channel/113489-new-members/topic/.E2.9C.94.20Universe.20Restriction.20on.20CategoryTheory.2ECategory/near/479078691\">#new members &gt; âœ” Universe Restriction on CategoryTheory.Category @ ðŸ’¬</a></p>",
        "id": 569606144,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1769123936
    },
    {
        "content": "<p>Also here: <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/categories.20with.20morphisms.20in.20Prop/with/528286569\">#mathlib4 &gt; categories with morphisms in Prop</a> where I asked more recently</p>",
        "id": 569606584,
        "sender_full_name": "Chris Henson",
        "timestamp": 1769124192
    },
    {
        "content": "<p>Indeed from <a href=\"https://github.com/leanprover-community/mathlib3/pull/1412/files\">mathlib3#1412</a> I see a lot of <code>+1</code> are needed (in 47 files, back then) if we switch morphisms back from Type to Sort.<br>\n<a href=\"https://github.com/leanprover-community/mathlib3/commit/2f088fc1cb98c6e789f3c61e594e9c85a121d139\">mathlib3#824</a> was the PR that switched both objects and morphisms to Sort.</p>",
        "id": 569611807,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1769126879
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">YaÃ«l Dillies</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Digraph.20vs.20Quiver.2E.7B0.7D/near/569554310\">said</a>:</p>\n<blockquote>\n<p>Please don't. <code>Digraph</code> is acquiring a support set, cf <a href=\"https://github.com/leanprover-community/mathlib4/pull/33466\">#33466</a></p>\n</blockquote>\n<p>To add, digraph will sooner or later acquire graph theoretic API. I already discussed an improved definition of graphs walks in a graph theory thread. This is to address the concern that there isnâ€™t much API for digraph. Itâ€™s a historical accident. There is also a theoretical possibility to generalise  pieces of the SimpleGraph API to digraphs and use them for SimpleGraphs by extending them from Digraphs.</p>",
        "id": 569622806,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1769134135
    },
    {
        "content": "<p>Kevinâ€™s PR (<a href=\"https://github.com/leanprover-community/mathlib4/pull/34228\">#34228</a>) was just assigned to me. I think this change is a good idea and Iâ€™m inclined to merge it very soon, but I will hold off for a few days in case there are any convincing objections.</p>",
        "id": 569915452,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1769304222
    }
]