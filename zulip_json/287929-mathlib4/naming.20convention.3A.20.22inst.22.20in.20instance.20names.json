[
    {
        "content": "<p>Loogle search: <a href=\"https://loogle.lean-lang.org/?q=%E2%8A%A2+CommMonoid+_\">https://loogle.lean-lang.org/?q=%E2%8A%A2+CommMonoid+_</a></p>\n<p>Under usual circumstances, doing <code>instance : CommMonoid _</code> in a namespace <code>Foo</code> automatically generates the name <code>Foo.instCommMonoid</code>.</p>\n<p>However, some existing mathlib definitions that are manually named do not follow this rule, such as <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Rat/Defs.html#Rat.commMonoid\">Rat.commMonoid</a>.</p>\n<p>For the sake of consistency, I would advocate for changing all these instances to have name starting with <code>inst</code>.</p>\n<p>(This encompasses all (algebraic) typeclasses, not just CommMonoid)</p>",
        "id": 554336605,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1762525875
    },
    {
        "content": "<p>What about non-algebraic typeclasses?</p>",
        "id": 554342086,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762527366
    },
    {
        "content": "<p>I seldom interact with them.</p>",
        "id": 554342163,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1762527386
    },
    {
        "content": "<p>I don’t see what the extra <code>inst</code> tells you. Does it tell you that the def is tagged with <code>@[instance]</code> (in that case are you prepending every simp lemma with <code>simp_</code>?) or that <code>AddCommGroup</code> is a type class?</p>\n<p>Regarding the autogenerated name, I think autogenerated name should be intentionally worse to discourage people from mentioning it in production ready code and I don’t think their behavior is an indication of anything.</p>",
        "id": 554345118,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1762528150
    },
    {
        "content": "<p>Conversely, does the lack of <code>inst</code> tell us that this instance has been intentionally manually named, and thus indicate something about its (intended) usage? <span aria-label=\"eyes\" class=\"emoji emoji-1f440\" role=\"img\" title=\"eyes\">:eyes:</span></p>",
        "id": 554345559,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1762528280
    },
    {
        "content": "<p>Well, I think my argument here is that as long as the auto-generated names exist, there will be people who treat it as the standard...</p>\n<p>But I think you do have a valid point in that we should actually just never mention instance names at all.</p>\n<p>In either case, we should have a standard, and removing <code>inst</code> from all instance names will <a href=\"https://github.com/search?q=repo%3Aleanprover-community%2Fmathlib4+%2F%28%3F-i%29+inst%5BA-Z%5D%5Ba-z%5D%2F&amp;type=code\">also be a big PR</a>.</p>\n<p>(For reference, the other direction is <a href=\"https://github.com/search?q=repo%3Aleanprover-community%2Fmathlib4+%2F%28%3F-i%29instance+%5Ba-hj-z%5D%5Cw%2B+%3A%2F&amp;type=code\"><code>/(?-i)instance [a-hj-z]\\w+ :/</code></a>)</p>",
        "id": 554345776,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1762528346
    },
    {
        "content": "<p>Genuine question: why are these instances manually named? I figured it’s because they’re mentioned somewhere in source—but is that true? And if so, is mentioning them necessary/good style, or can we/should we avoid mentioning them like you say?</p>",
        "id": 554346500,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1762528558
    },
    {
        "content": "<p>because when there is a standard, people will follow it.</p>\n<p>(manually naming also avoids the situation where the auto generated name is 200 characters long)</p>",
        "id": 554346694,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1762528613
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"548935\">@Thomas Murrills</span> I think you're in a better position than me to figure out how many instance mentions exist in mathlib</p>",
        "id": 554346905,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1762528663
    },
    {
        "content": "<p>Also I do think there could potentially be a meaningful difference in standard between “how an autogenerated name should look” and “how a manually-created name should look”, precisely to signal the difference! :) I’m not sure autogenerated naming should be construed as a standard for manual naming, <em>if</em> they’re intended to have different usages.</p>",
        "id": 554347489,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1762528809
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/287929-mathlib4/topic/naming.20convention.3A.20.22inst.22.20in.20instance.20names/near/554346905\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"548935\">Thomas Murrills</span> I think you're in a better position than me to figure out how many instance mentions exist in mathlib</p>\n</blockquote>\n<p>I could do this! <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span> But before I go to the trouble, I’d like to hear about the intention behind giving these instances manual names in the first place, and whether mentioning them is even a problem.</p>",
        "id": 554347764,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1762528885
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"548935\">Thomas Murrills</span> <a href=\"#narrow/channel/287929-mathlib4/topic/naming.20convention.3A.20.22inst.22.20in.20instance.20names/near/554347489\">said</a>:</p>\n<blockquote>\n<p>Also I do think there could potentially be a meaningful difference in standard between “how an autogenerated name should look” and “how a manually-created name should look”, precisely to signal the difference! :) I’m not sure autogenerated naming should be construed as a standard for manual naming, <em>if</em> they’re intended to have different usages.</p>\n</blockquote>\n<p>I agree with this. As above, I said that it is acceptable to me if the rule is \"<code>inst</code> for autogenerated name, no <code>inst</code> for manual names\", but if this becomes the rule then it should be standardised!</p>\n<p>The only situation not acceptable to me is where there is not a standard rule written down somewhere, and then half of the declarations use <code>inst</code> and half don't.</p>",
        "id": 554348059,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1762528961
    },
    {
        "content": "<p>But then again as a user for discoverability purposes I would prefer if they all have <code>inst</code> even if I don't end up writing them down in the final proof. It's not a good algorithm to \"first try inst and then try without inst\"</p>",
        "id": 554348315,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1762529025
    },
    {
        "content": "<p>Why they're named at all</p>\n<ul>\n<li>they're mentioned somewhere</li>\n<li>the original name is confusing or strange or too long (e.g. <a href=\"https://github.com/leanprover-community/mathlib4/pull/31347\">#31347</a>)</li>\n<li>cargo-culting</li>\n</ul>\n<p>Why they're named without <code>inst</code></p>\n<ul>\n<li>they weren't an instance before</li>\n<li>they got their name in mathlib3</li>\n</ul>",
        "id": 554348527,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1762529082
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/287929-mathlib4/topic/naming.20convention.3A.20.22inst.22.20in.20instance.20names/near/554348315\">said</a>:</p>\n<blockquote>\n<p>But then again as a user for discoverability purposes I would prefer if they all have <code>inst</code> even if I don't end up writing them down in the final proof. It's not a good algorithm to \"first try inst and then try without inst\"</p>\n</blockquote>\n<p>Good point; to my mind discoverability concerns could definitely outweigh the importance of signaling intended usage in the tradeoff here. (Or maybe there’s a way to make them start with <code>inst</code> without being the same as the autogenerated name? But I’ll hold off on crossing that bridge.)</p>",
        "id": 554349376,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1762529302
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"548935\">Thomas Murrills</span> <a href=\"#narrow/channel/287929-mathlib4/topic/naming.20convention.3A.20.22inst.22.20in.20instance.20names/near/554349376\">said</a>:</p>\n<blockquote>\n<p>Or maybe there’s a way to make them start with <code>inst</code> without being the same as the autogenerated name?</p>\n</blockquote>\n<p>Not sure what you mean here.</p>",
        "id": 554349530,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1762529338
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/287929-mathlib4/topic/naming.20convention.3A.20.22inst.22.20in.20instance.20names/near/554348059\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"548935\">Thomas Murrills</span> <a href=\"#narrow/channel/287929-mathlib4/topic/naming.20convention.3A.20.22inst.22.20in.20instance.20names/near/554347489\">said</a>:</p>\n<blockquote>\n<p>Also I do think there could potentially be a meaningful difference in standard between “how an autogenerated name should look” and “how a manually-created name should look”, precisely to signal the difference! :) I’m not sure autogenerated naming should be construed as a standard for manual naming, <em>if</em> they’re intended to have different usages.</p>\n</blockquote>\n<p>I agree with this. As above, I said that it is acceptable to me if the rule is \"<code>inst</code> for autogenerated name, no <code>inst</code> for manual names\", but if this becomes the rule then it should be standardised!</p>\n<p>The only situation not acceptable to me is where there is not a standard rule written down somewhere, and then half of the declarations use <code>inst</code> and half don't.</p>\n</blockquote>\n<p>Oh, for sure! <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span> Are there manually-named instances that start with <code>inst</code>? (I wasn’t aware of these when saying what I said.)</p>",
        "id": 554349869,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1762529417
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"548935\">Thomas Murrills</span> <a href=\"#narrow/channel/287929-mathlib4/topic/naming.20convention.3A.20.22inst.22.20in.20instance.20names/near/554349869\">said</a>:</p>\n<blockquote>\n<p>Are there manually-named instances that start with <code>inst</code>?</p>\n</blockquote>\n<p><a href=\"https://github.com/search?q=repo%3Aleanprover-community%2Fmathlib4+%2F%28%3F-i%29instance+inst%5BA-Z%5D%5Ba-z%5D%2F&amp;type=code\"><code>/(?-i)instance inst[A-Z][a-z]/</code></a></p>",
        "id": 554350116,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1762529478
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/287929-mathlib4/topic/naming.20convention.3A.20.22inst.22.20in.20instance.20names/near/554349530\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"548935\">Thomas Murrills</span> <a href=\"#narrow/channel/287929-mathlib4/topic/naming.20convention.3A.20.22inst.22.20in.20instance.20names/near/554349376\">said</a>:</p>\n<blockquote>\n<p>Or maybe there’s a way to make them start with <code>inst</code> without being the same as the autogenerated name?</p>\n</blockquote>\n<p>Not sure what you mean here.</p>\n</blockquote>\n<p>E.g. use a manual name of something like <code>Rat.inst.commMonoid</code>, <code>Rat.instanceCommMonoid</code>, which would be distinct from an autogenerated-esque <code>Rat.instCommMonoid</code>…</p>",
        "id": 554350224,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1762529511
    },
    {
        "content": "<p>Then there would still be the same discoverability issue, where I would then need to try <code>Rat.instCommMonoid</code> and then try <code>Rat.instanceCommMonoid</code>. Discoverability means consistency and one single rule.</p>",
        "id": 554350471,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1762529579
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/287929-mathlib4/topic/naming.20convention.3A.20.22inst.22.20in.20instance.20names/near/554350116\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"548935\">Thomas Murrills</span> <a href=\"#narrow/channel/287929-mathlib4/topic/naming.20convention.3A.20.22inst.22.20in.20instance.20names/near/554349869\">said</a>:</p>\n<blockquote>\n<p>Are there manually-named instances that start with <code>inst</code>?</p>\n</blockquote>\n<p><a href=\"https://github.com/search?q=repo%3Aleanprover-community%2Fmathlib4+%2F%28%3F-i%29instance+inst%5BA-Z%5D%5Ba-z%5D%2F&amp;type=code\"><code>/(?-i)instance inst[A-Z][a-z]/</code></a></p>\n</blockquote>\n<p>Ah, okay, sorry, missed that. On mobile for a couple more minutes; about how many hits are there?</p>",
        "id": 554350498,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1762529585
    },
    {
        "content": "<p>440 files</p>",
        "id": 554350555,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1762529605
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/287929-mathlib4/topic/naming.20convention.3A.20.22inst.22.20in.20instance.20names/near/554350471\">said</a>:</p>\n<blockquote>\n<p>Then there would still be the same discoverability issue, where I would then need to try <code>Rat.instCommMonoid</code> and then try <code>Rat.instanceCommMonoid</code>. Discoverability means consistency and one single rule.</p>\n</blockquote>\n<p>Fair, my thought was that both would be able to come up in autocomplete when you typed <code>instCommMonoid</code> thanks to partial matching.</p>",
        "id": 554351177,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1762529748
    },
    {
        "content": "<p>indeed, but that's not good enough</p>",
        "id": 554351242,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1762529764
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/287929-mathlib4/topic/naming.20convention.3A.20.22inst.22.20in.20instance.20names/near/554348527\">said</a>:</p>\n<blockquote>\n<p>Why they're named at all</p>\n<ul>\n<li>they're mentioned somewhere</li>\n<li>the original name is confusing or strange or too long (e.g. <a href=\"https://github.com/leanprover-community/mathlib4/pull/31347\">#31347</a>)</li>\n<li>cargo-culting</li>\n</ul>\n<p>Why they're named without <code>inst</code></p>\n<ul>\n<li>they weren't an instance before</li>\n<li>they got their name in mathlib3</li>\n</ul>\n</blockquote>\n<p>Ok, great! So it seems like we have four reasons for manual naming of instances in general:</p>\n<ul>\n<li>mentioning/usage</li>\n<li>“correcting” the autogenerated name</li>\n<li>historical accident</li>\n<li>cargo culting</li>\n</ul>\n<p>I’d like to understand “usage”/“they’re mentioned somewhere” better. Why <em>do</em> instances get mentioned, typically? And should we really be doing so? Why not synthesize it?</p>\n<p>Also, my sense is that the primary intention for manual naming without <code>inst</code> for <em>mentioning</em> here is to signal intention and reduce code smell at the point of use (“it’s okay to mention this instance explicitly”). Do people find that to be their experience?</p>",
        "id": 554354251,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1762530517
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"548935\">Thomas Murrills</span> <a href=\"#narrow/channel/287929-mathlib4/topic/naming.20convention.3A.20.22inst.22.20in.20instance.20names/near/554354251\">said</a>:</p>\n<blockquote>\n<p>Also, my sense is that the primary intention for manual naming without <code>inst</code> for <em>mentioning</em> here is to signal intention and reduce code smell at the point of use (“it’s okay to mention this instance explicitly”). Do people find that to be their experience?</p>\n</blockquote>\n<p>Not necessarily, sometimes I just do it because I don't trust the auto generator (i.e. it might generate a name that is too long, or it might be fragile in some way (which is related))</p>",
        "id": 554354820,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1762530677
    },
    {
        "content": "<p>Okay, but it seems like that falls under “correcting the autogenerated name”. I’m specifically asking about the reason for {manual naming without inst for mentioning}. :)</p>",
        "id": 554355083,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1762530751
    },
    {
        "content": "<p>ah, my apologies</p>",
        "id": 554355202,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1762530784
    },
    {
        "content": "<p>No problem! :)</p>",
        "id": 554355301,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1762530807
    },
    {
        "content": "<p>for the mentioning part, it might not be for future mentions (i.e. in other files), it might be aimed towards the same file, where I define <code>instMonoid : Monoid ?a</code> under some assumptions, and then under some other assumptions,</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CommMonoid</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">__</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">instMonoid</span>\n<span class=\"w\">  </span><span class=\"n\">mul_comm</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">b</span>\n</code></pre></div>",
        "id": 554355567,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1762530874
    },
    {
        "content": "<p>Ok, maybe we can group a mention like that under “mentioning the instance in the typeclass hierarchy” more generally. (Because my guess is that using <code>inst</code> in instance names when it’s used only within other instances would be generally palatable!)</p>\n<p>So, the above question is of course refined to: why do we mention instances <em>outside</em> of other instances, and should we really be doing so instead of synthesizing them?</p>",
        "id": 554357133,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1762531287
    },
    {
        "content": "<p>well, one use case I can imagine is if we have two instances on the same type, on the rare occasion that we want to prove some sort of uniqueness of instances. (To be clear, this is clearly a rare situation, and <em>normally</em> should be avoided at all costs, but some theorems like that still have their usefulness.)</p>\n<p>Outside of that use case, I can't see why one would want to mention instance name.</p>",
        "id": 554357701,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1762531444
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/287929-mathlib4/topic/naming.20convention.3A.20.22inst.22.20in.20instance.20names/near/554355567\">said</a>:</p>\n<blockquote>\n<p>for the mentioning part, it might not be for future mentions (i.e. in other files), it might be aimed towards the same file, where I define <code>instMonoid : Monoid ?a</code> under some assumptions, and then under some other assumptions,</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CommMonoid</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">__</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">instMonoid</span>\n<span class=\"w\">  </span><span class=\"n\">mul_comm</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">b</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>I assume the right thing to use here is <code>inferInstanceAs (Monoid _)</code>? At least I personally think referring to an instance by its name is a code smell.</p>",
        "id": 554383269,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1762537983
    },
    {
        "content": "<p>The right thing to do here would to not put the instance there at all and just let Lean infer it (though this doesn't always work)</p>",
        "id": 554383853,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762538145
    },
    {
        "content": "<p>I'm arriving late to the bikeshed, and see 30-something messages, mostly (but not exclusively) by just two users. On a generic open source mailing list, one heuristic would be \"side discussion, ignore\" --- which I don't want to do since the content seems relevant and I respect both Kenny and Thomas' expertise. However, going over this in detail is not efficient:</p>\n<p><span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span> <span class=\"user-mention\" data-user-id=\"548935\">@Thomas Murrills</span> can you help me by creating a summary of the discussion so far? What did you cover, what conclusions did the two of you arrive at so far?</p>",
        "id": 554412487,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1762548089
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"634338\">@Michael Rothgang</span></p>\n<ul>\n<li>Issue: currently both <code>instance instGroup : ...</code> and <code>instance group : ...</code> exist, and I want to standardise.</li>\n<li>My opinion: I think <code>instGroup</code> should be chosen for consistency with auto-generated names for the sake of discoverability. It's inefficient for the user to have to first try <code>instGroup</code> and then try <code>group</code>.</li>\n<li>Thomas's opinion: he agrees with me on the discoverability point, but he's also waiting to explore <em>why</em> anyone would manually name instances in the first place.</li>\n</ul>",
        "id": 554413061,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1762548327
    },
    {
        "content": "<p>I bother naming instances by hand because, like any declaration in mathlib, following the naming convention makes the declaration more searchable (and, no, the autogenerated instance names are not consistent enough to be their own convention).</p>",
        "id": 554413359,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1762548486
    },
    {
        "content": "<p>And to add some context why I want to know: if it turns out there’s a good reason to want to be able to mention manually named instances, there might be a good reason to signal that they are distinct from autogenerated names. Then we can actually analyze the tradeoff between discoverability and distinct manual names.</p>",
        "id": 554413362,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1762548488
    },
    {
        "content": "<p>(More generally, I think we shouldn’t change things (e.g. impose a standardization convention) without first fully understanding why things are the way they are in the first place! :) )</p>",
        "id": 554413725,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1762548658
    },
    {
        "content": "<p>People have historically replied to my argument above by saying that \"It's <code>infer_instance</code>'s job to find an instance\". But there are many ways in which that can fail (missing assumption, missing import, no cache, not even a lean environment), and an analogous argument could be made of lemmas: \"It's <code>exact?</code>'s job to find a lemma\", which is (currently) ludicrous given all the constraints on what and how <code>exact?</code> can find something, constraints which aren't unlike those of <code>infer_instance</code>.</p>",
        "id": 554413776,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1762548682
    },
    {
        "content": "<p>ok, I would like to derail slightly this conversation: should we do <code>def instCommGroup : ...</code> for \"local instances\"?</p>",
        "id": 554413977,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1762548779
    },
    {
        "content": "<p>I don't see this mentioned above; a lot of instances are named <code>monoid</code> because they were mathported and that's what we named them in Lean 3</p>",
        "id": 554413984,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1762548782
    },
    {
        "content": "<p>Hmm, I don’t think <code>exact?</code> is at all analogous to typeclass synthesis. Shouldn’t instances be set up precisely so that you can access them via typeclass synthesis (as opposed to lemmas, which don’t work that way)?</p>\n<p>Also, <span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span>, is your position then that </p>\n<ol>\n<li><em>all</em> instances ought to be named by hand, in an ideal world</li>\n<li>a name without <code>inst</code> is more discoverable than one with <code>inst</code> (actually, sorry, you didn’t opine on this! What is your position here?)</li>\n</ol>\n<p>I’m also trying to understand the circumstances you’re talking about that make it helpful to mention an instance name. Are we talking just about the writing experience (autocomplete, etc.), or are there circumstances where instance names should remain mentioned in Mathlib source?</p>",
        "id": 554414653,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1762549059
    },
    {
        "content": "<p>sometimes I want to find the instance used to derive something and before I set up a Lean environment and wait 10~30sec for <code>import Mathlib</code> to go through so I can <code>#synth</code> usually I do two or three searches with <a href=\"https://loogle.lean-lang.org/\">#loogle</a> first</p>",
        "id": 554414898,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762549166
    },
    {
        "content": "<p>And to emphasize the question about source: the primary reason I could see for <em>not</em> using <code>inst</code> in the name of instances is to signal “this instance name, without <code>inst</code>, is okay to mention in (final, contributed) source with no code smell”.</p>\n<p>So, I’m wondering if there are any cases where we want to mention the name of the instance in final source (and not infer it), or if it’s <em>all</em> about discoverability during the writing process.</p>",
        "id": 554415906,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1762549637
    },
    {
        "content": "<p>For me, there are two kinds of instances:</p>\n<ul>\n<li>inheritance instances: they are recognisable by the fact that all (important) arguments to their return type are free variables. They are of the form <code>Stronger A -&gt; Weaker A</code> and their name is of the form <code>Stronger.toWeaker</code>, or <code>Stronger.to_weaker</code> if <code>Weaker</code> is Prop-valued. </li>\n<li>structural instances: all the other ones. They are usually of the form <code>... -&gt; Foo (BarA)</code>, where <code>Bar</code> is some kind of functor, and their name is of the form <code>Bar.instFoo</code>. Since this is the \"default\" kind of instances, not all of them actually have a meaningful <code>Bar</code> to base the name on, but the exceptions are rare (except in category theory).</li>\n</ul>",
        "id": 554420565,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1762552019
    },
    {
        "content": "<p>I personally see the instance names in the second category without <code>inst</code> as exceptions that should be gotten rid of, except as always in category theory which does its own thing</p>",
        "id": 554420709,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1762552100
    },
    {
        "content": "<p>I also think there is potential to carve out further kinds of instances from the structural ones, to better reflect usage. I do not have a precise suggestion here but, taking category theory again, it seems that a factor for the existing differences is whether the <code>Foo (Bar A)</code> instance is \"primarily about\" <code>Foo</code> or <code>Bar</code>.</p>",
        "id": 554421122,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1762552344
    },
    {
        "content": "<p>We also don't have much of a convention for <code>(b : Bar) : SomeClass ↥b</code> at the moment, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Submonoid.toMonoid#doc\">docs#Submonoid.toMonoid</a> doesn't fit your rule</p>",
        "id": 554425646,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1762554736
    },
    {
        "content": "<p>I still don't see what the <code>inst</code> tells you. <code>foo (bar A)</code> should just be called <code>foo_bar</code> or <code>foo.bar</code> or <code>bar.foo</code> regardless if <code>foo</code> is a typeclass or not according to the naming convention. If it were an inheritance instance it would be called <code>foo_of_bar</code> or something similar.</p>",
        "id": 554436242,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1762562390
    },
    {
        "content": "<p>The issue with Andrew's suggested convention is that usually we're in some namespace (in his example, <code>bar</code>) by the time we want to provide the instance, so <code>foo_bar</code> is out of the question.</p>",
        "id": 554461252,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1762586972
    },
    {
        "content": "<p><code>foo_of_bar</code> for inheritance instances is also not really an option because most such instances are auto-generated with the <code>to</code> name, with no option to rename them</p>",
        "id": 554461314,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1762587033
    },
    {
        "content": "<p>Personally, I think instances should just follow the same rules as everything else: snake case for prop-valued typeclasses and camel case for typeclasses carrying data.</p>",
        "id": 554471293,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1762597360
    },
    {
        "content": "<p>I think the purpose of the <code>inst</code> prefix is to explicitly keep names out of the way that users don't want to refer to. Otherwise you end up with a clash between <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.add#doc\">docs#Nat.add</a> and <code>Nat.instAdd</code> (if it existed) etc</p>",
        "id": 554478390,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1762604475
    },
    {
        "content": "<p>But it's also worth remembering that this <code>inst</code>-prefixing is builtin Lean behavior, and so we should have a stronger argument that personal preference for having mathlib choose to diverge from it.</p>",
        "id": 554478477,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1762604570
    },
    {
        "content": "<p>Of course, you could argue for the Lean behavior to be changed globally, but <span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> already put a lot of thought into the current naming heuristics, and this would almost certainly just be re-hashing a previous discussion</p>",
        "id": 554478500,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1762604594
    },
    {
        "content": "<p>I agree that we should follow the builtin Lean behaviour. That is, start instance names with <code>inst</code> if the autogenerated name also starts with <code>inst</code>. This makes it easy to tell if a definition is an instance or not. And it makes the naming consistent.</p>",
        "id": 554518046,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1762643817
    },
    {
        "content": "<p>What is the scope of this <code>inst</code>? When  <code>Foo (Bar ..)</code> is in the <code>Bar</code> namespace where <code>Bar ..</code> is a type and <code>Foo</code> is a data carrying typeclass, then one names the definition <code>Bar.instFoo</code>?</p>",
        "id": 554518725,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1762644462
    },
    {
        "content": "<p>It seems so:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Unit</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Bar</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Add</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">()</span><span class=\"bp\">⟩</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"bp\">.</span><span class=\"n\">instAdd</span>\n</code></pre></div>",
        "id": 554518889,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1762644650
    },
    {
        "content": "<p>well that's the autogenerated name though the question is what should the manually generated name be</p>",
        "id": 554518910,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762644677
    },
    {
        "content": "<p>The same as the autogenerated name</p>",
        "id": 554519045,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1762644855
    },
    {
        "content": "<p>but the autogenerated name is sometimes terrible</p>",
        "id": 554519067,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762644875
    },
    {
        "content": "<p>Yes, but I'm talking about this example</p>",
        "id": 554519086,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1762644890
    },
    {
        "content": "<p>I don't mind shortening the terribly long names, but I feel like this is orthogonal to the question posed in this thread, namely what the convention is around \"inst\" in instance names.</p>",
        "id": 554519133,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1762644958
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"439483\">Andrew Yang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/naming.20convention.3A.20.22inst.22.20in.20instance.20names/near/554518725\">said</a>:</p>\n<blockquote>\n<p>What is the scope of this <code>inst</code>? When  <code>Foo (Bar ..)</code> is in the <code>Bar</code> namespace where <code>Bar ..</code> is a type and <code>Foo</code> is a data carrying typeclass, then one names the definition <code>Bar.instFoo</code>?</p>\n</blockquote>\n<p>I think it is reasonable to ask if the manual name should follow the scope of the autogenerated one. I would guess the answer is usually yes, but maybe some exception for scoped instances?</p>",
        "id": 554519171,
        "sender_full_name": "Chris Henson",
        "timestamp": 1762644994
    },
    {
        "content": "<p>I hate naming instances. And I like that <code>where</code> notation has made a lot of manual instance naming unnecessary.</p>",
        "id": 565398817,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1766711220
    },
    {
        "content": "<p>As for the circumstances where one does want to name an instance, I'm entirely impartial as to which convention to employ.</p>",
        "id": 565398840,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1766711239
    }
]