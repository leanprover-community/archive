[
    {
        "content": "<p>Here is a trace from instance synthesis. </p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Spoiler</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>[Meta.synthInstance] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> CommMonoidWithZero ?m.851291 â–¼<br>\n  [] new goal CommMonoidWithZero ?m.851291 â–¼<br>\n    [instances] #[@CommSemiring.toCommMonoidWithZero, @CancelCommMonoidWithZero.toCommMonoidWithZero, @CommGroupWithZero.toCommMonoidWithZero, @LinearOrderedCommMonoidWithZero.toCommMonoidWithZero, @Pi.commMonoidWithZero, @WithBot.commMonoidWithZero, @instCommMonoidWithZeroLex, @ULift.commMonoidWithZero, @Localization.instCommMonoidWithZeroLocalizationToCommMonoid, @Associates.instCommMonoidWithZeroAssociatesToMonoidToMonoidWithZero, @WithZero.commMonoidWithZero, @instCommMonoidWithZeroOrderDual, @Prod.instCommMonoidWithZeroProd, @WithTop.commMonoidWithZero]<br>\n  [] ðŸ’¥ apply @WithTop.commMonoidWithZero to CommMonoidWithZero ?m.851291 â–¶</p>\n<p>[Meta.synthInstance] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> CommMonoidWithZero ?m.851292 â–¼<br>\n  [] new goal CommMonoidWithZero ?m.851292 â–¶<br>\n  [] ðŸ’¥ apply @WithTop.commMonoidWithZero to CommMonoidWithZero ?m.851292 â–¶</p>\n<p>[Meta.synthInstance] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> CommMonoidWithZero ?m.851291 â–¼<br>\n  [] new goal CommMonoidWithZero ?m.851291 â–¶<br>\n  [] ðŸ’¥ apply @WithTop.commMonoidWithZero to CommMonoidWithZero ?m.851291 â–¶</p>\n<p>[Meta.synthInstance] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> CommMonoidWithZero ?m.851292 â–¼<br>\n  [] new goal CommMonoidWithZero ?m.851292 â–¶<br>\n  [] ðŸ’¥ apply @WithTop.commMonoidWithZero to CommMonoidWithZero ?m.851292 â–¶</p>\n<p>[Meta.synthInstance] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> CommMonoidWithZero ?m.851291 â–¼<br>\n  [] new goal CommMonoidWithZero ?m.851291 â–¶<br>\n  [] ðŸ’¥ apply @WithTop.commMonoidWithZero to CommMonoidWithZero ?m.851291 â–¶</p>\n<p>[Meta.synthInstance] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> CommMonoidWithZero ?m.851292 â–¼<br>\n  [] new goal CommMonoidWithZero ?m.851292 â–¶<br>\n  [] ðŸ’¥ apply @WithTop.commMonoidWithZero to CommMonoidWithZero ?m.851292 â–¶</p>\n<p>[Meta.synthInstance] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> CommMonoidWithZero ?m.851291 â–¼<br>\n  [] new goal CommMonoidWithZero ?m.851291 â–¶<br>\n  [] ðŸ’¥ apply @WithTop.commMonoidWithZero to CommMonoidWithZero ?m.851291 â–¶</p>\n<p>[Meta.synthInstance] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> CommMonoidWithZero ?m.851292 â–¼<br>\n  [] new goal CommMonoidWithZero ?m.851292 â–¶<br>\n  [] ðŸ’¥ apply @WithTop.commMonoidWithZero to CommMonoidWithZero ?m.851292 â–¶</p>\n<p>[Meta.synthInstance] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> CommMonoidWithZero ?m.851291 â–¼<br>\n  [] new goal CommMonoidWithZero ?m.851291 â–¶<br>\n  [] ðŸ’¥ apply @WithTop.commMonoidWithZero to CommMonoidWithZero ?m.851291 â–¶</p>\n<p>[Meta.synthInstance] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> CommMonoidWithZero ?m.851292 â–¼<br>\n  [] new goal CommMonoidWithZero ?m.851292 â–¶<br>\n  [] ðŸ’¥ apply @WithTop.commMonoidWithZero to CommMonoidWithZero ?m.851292 â–¶</p>\n<p>[Meta.synthInstance] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> CommMonoidWithZero ?m.851291 â–¼<br>\n  [] new goal CommMonoidWithZero ?m.851291 â–¶<br>\n  [] ðŸ’¥ apply @WithTop.commMonoidWithZero to CommMonoidWithZero ?m.851291 â–¶</p>\n<p>[Meta.synthInstance] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> CommMonoidWithZero ?m.851292 â–¼<br>\n  [] new goal CommMonoidWithZero ?m.851292 â–¼<br>\n    [instances] #[@CommSemiring.toCommMonoidWithZero, @CancelCommMonoidWithZero.toCommMonoidWithZero, @CommGroupWithZero.toCommMonoidWithZero, @LinearOrderedCommMonoidWithZero.toCommMonoidWithZero, @Pi.commMonoidWithZero, @WithBot.commMonoidWithZero, @instCommMonoidWithZeroLex, @ULift.commMonoidWithZero, @Localization.instCommMonoidWithZeroLocalizationToCommMonoid, @Associates.instCommMonoidWithZeroAssociatesToMonoidToMonoidWithZero, @WithZero.commMonoidWithZero, @instCommMonoidWithZeroOrderDual, @Prod.instCommMonoidWithZeroProd, @WithTop.commMonoidWithZero]<br>\n  [] ðŸ’¥ apply @WithTop.commMonoidWithZero to CommMonoidWithZero ?m.851292 â–¶</p>\n</div></div>\n<p>If I ban <code>WithTop.commMonoidWithZero</code>, it does the same with the next entry. What is going on here?</p>",
        "id": 344528439,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1679764235
    },
    {
        "content": "<p>To clarify, it does not appear to try any of the other instances</p>",
        "id": 344528852,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1679764365
    },
    {
        "content": "<p>Maybe <a href=\"https://github.com/leanprover/lean4/pull/2055\">lean4#2055</a>?</p>",
        "id": 344529115,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1679764450
    },
    {
        "content": "<blockquote>\n<p>tc synthesis repeatedly tries [...]</p>\n</blockquote>\n<p>This is Lean repeatedly trying TC synthesis, not the other way around.</p>",
        "id": 344542723,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1679770722
    },
    {
        "content": "<p>During elaboration, we try to synthesize the instance immediately and if that doesn't work it's put on a list of postponed constraints.  At the end (or if you call synthesizeSyntheticMVars manually), we try to solve all these constraints.  And if we make progress on any one of them, we try all of them again (because now they might succeed after an mvar might have been assigned etc.) in a loop until they've all been solved or we can't make any progress.</p>",
        "id": 344543349,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1679771014
    },
    {
        "content": "<p>So this is very much expected.</p>",
        "id": 344543355,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1679771017
    },
    {
        "content": "<p>Thanks. I am still a little confused. There should or should not be something changing between the repeated <code>apply @WithTop.commMonoidWithZero to CommMonoidWithZero ?m.851292</code>?</p>",
        "id": 344544248,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1679771479
    },
    {
        "content": "<p>Maybe to spare everyone, what is the best documentation on this? Thanks</p>",
        "id": 344546788,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1679773040
    }
]