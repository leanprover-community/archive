[
    {
        "content": "<p>In <a href=\"https://github.com/leanprover-community/mathlib4/pull/25499\">#25499</a>, I introduce the notion of a left action of a monoidal category on a category. Given such an action of <code>C</code> on <code>D</code>, I intend to define modules in <code>D</code> on an internal monoid object of <code>C</code>. In terms of generality, this should completely supercedes <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/CategoryTheory/Monoidal/Mod_.html#Mod_\">Mathlib.CategoryTheory.Monoidal.Mod_</a> , which is the special case where <code>C</code> acts on itself via the tensor product. <br>\nShould I do this construction in a separate definition, and leave the current <code>Mod_</code> as is (and of course provide an equivalence between the two), or should I rather refactor <code>Mod_</code> into the more general construction? <br>\nMy gut feeling is to go for the refactor, because otherwise this is just going to end up with duplicated code/API, but I’d rather ask maintainers what they think of this.</p>",
        "id": 522662492,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1749154199
    },
    {
        "content": "<p>I would think it would be fine to refactor <code>Mod_</code>. You should coordinate with <span class=\"user-mention\" data-user-id=\"438192\">@Yuma Mizuno</span> because <a href=\"https://github.com/leanprover-community/mathlib4/pull/24646\">#24646</a> refactors <code>Mon_</code> by making the unbundled version <code>Mon_Class</code> the preferred API. We probably want that <code>Mod_</code> be changed accordingly.</p>",
        "id": 522717821,
        "sender_full_name": "Joël Riou",
        "timestamp": 1749193808
    },
    {
        "content": "<p>I'm not working on <code>Mod_</code> right now, but what I have in mind (for the current definition) is the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Mod_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Mon_Class</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">mod</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Mod_Class</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 522720927,
        "sender_full_name": "Yuma Mizuno",
        "timestamp": 1749195170
    },
    {
        "content": "<p>By the way, is <a href=\"https://github.com/leanprover-community/mathlib4/pull/24599\">#24599</a> the intended PR?</p>",
        "id": 522721714,
        "sender_full_name": "Yuma Mizuno",
        "timestamp": 1749195548
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/25499\">#25499</a></p>",
        "id": 522721780,
        "sender_full_name": "Joël Riou",
        "timestamp": 1749195577
    },
    {
        "content": "<p>Oh, right, sorry for the wrong number...</p>",
        "id": 522744557,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1749204105
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"438192\">Yuma Mizuno</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Refactoring.20Mod_.3F/near/522720927\">said</a>:</p>\n<blockquote>\n<p>I'm not working on <code>Mod_</code> right now, but what I have in mind (for the current definition) is the following:</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Mod_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Mon_Class</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">mod</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Mod_Class</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">]</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>I guess then this means that<code>Mod_Class</code> should also be refactored so that <code>X</code> can be in <code>D</code> where <code>C</code> acts on <code>D</code>.</p>",
        "id": 522745208,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1749204343
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"438192\">@Yuma Mizuno</span>  Is there a rationale behind the fact that <code>Mon_</code> has been redefined as </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Mon_</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The underlying object in the ambient monoidal category -/</span>\n<span class=\"w\">  </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">mon</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Mon_Class</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>but the <code>Mon_.Hom</code> structure remains</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">ext</span><span class=\"kd\">]</span>\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Hom</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Mon_</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The underlying morphism -/</span>\n<span class=\"w\">  </span><span class=\"n\">hom</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"bp\">.</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">⟶</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"bp\">.</span><span class=\"n\">X</span>\n<span class=\"w\">  </span><span class=\"n\">one_hom</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">η</span><span class=\"w\"> </span><span class=\"bp\">≫</span><span class=\"w\"> </span><span class=\"n\">hom</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">η</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">aesop_cat</span>\n<span class=\"w\">  </span><span class=\"n\">mul_hom</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"bp\">≫</span><span class=\"w\"> </span><span class=\"n\">hom</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hom</span><span class=\"w\"> </span><span class=\"bp\">⊗</span><span class=\"w\"> </span><span class=\"n\">hom</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">≫</span><span class=\"w\"> </span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">aesop_cat</span>\n</code></pre></div>\n<p>and is not e.g</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- A morphism of monoid objects. -/</span>\n<span class=\"kd\">@[</span><span class=\"n\">ext</span><span class=\"kd\">]</span>\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Hom</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Mon_</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The underlying morphism -/</span>\n<span class=\"w\">  </span><span class=\"n\">hom</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"bp\">.</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">⟶</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"bp\">.</span><span class=\"n\">X</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">isMon_Hom</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsMon_Hom</span><span class=\"w\"> </span><span class=\"n\">hom</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>?</p>",
        "id": 522782252,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1749217771
    },
    {
        "content": "<p>The refactor is at <a href=\"https://github.com/leanprover-community/mathlib4/pull/25545\">#25545</a>. I went with this definition for morphisms</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- A morphism of monoid objects. -/</span>\n<span class=\"kd\">@[</span><span class=\"n\">ext</span><span class=\"kd\">]</span>\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Hom</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Mod_</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The underlying morphism -/</span>\n<span class=\"w\">  </span><span class=\"n\">hom</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"bp\">.</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">⟶</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"bp\">.</span><span class=\"n\">X</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">isMod_Hom</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsMod_Hom</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">hom</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>but this can be easily change if we want something more aligned with the current Hom-types in <code>Mon_</code>.</p>",
        "id": 522813320,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1749228115
    },
    {
        "content": "<p>For <code>Hom</code>, I don't think it makes much difference. I think it's just the difference in the default constructor. For <code>Mon_</code>, the difference is more serious because <code>Mon_Class</code> contains data (μ and η).</p>",
        "id": 522816921,
        "sender_full_name": "Yuma Mizuno",
        "timestamp": 1749229423
    },
    {
        "content": "<p>So you’d suggest aligning the <code>Hom</code> structure for <code>Mod_</code> with the one for <code>Mon_</code>?</p>",
        "id": 522817130,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1749229494
    },
    {
        "content": "<p>No. I think either is fine. In particular, it would be fine to change the <code>Mon_.Hom</code> definition to the latter (one using <code>isMon_Hom</code>).</p>",
        "id": 522817557,
        "sender_full_name": "Yuma Mizuno",
        "timestamp": 1749229659
    },
    {
        "content": "<p>Given that <code>Mod_</code> is way less used than <code>Mon_</code>, it’s probably more of a pain to change <code>Mon_.Hom</code> than to just align <code>Mod_</code> on <code>Mon_</code>, if you say it doesn’t matter much anyway (which I agree). At least things would feel more coherent and would save an extra refactor PR if I just make <code>Mod_.Hom</code> without <code>isMod_hom</code>.</p>",
        "id": 522818573,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1749230107
    },
    {
        "content": "<p>I'm willing to do the refactoring about <code>Mon_.Hom</code>, which doesn't look hard if I introduce a new constructor like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">Hom</span><span class=\"bp\">.</span><span class=\"n\">mk'</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Mon_</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"bp\">.</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">⟶</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"bp\">.</span><span class=\"n\">X</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">one_f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">η</span><span class=\"w\"> </span><span class=\"bp\">≫</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">η</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">aesop_cat</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">mul_f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"bp\">≫</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">⊗</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">≫</span><span class=\"w\"> </span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">aesop_cat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Hom</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsMon_Hom</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">one_f</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_f</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">f</span>\n</code></pre></div>\n<p>and just replace the current use of <code>Hom.mk</code> with <code>Hom.mk'</code>.</p>",
        "id": 522822282,
        "sender_full_name": "Yuma Mizuno",
        "timestamp": 1749231590
    },
    {
        "content": "<p>Well, too late as I have already replaced the definition in <a href=\"https://github.com/leanprover-community/mathlib4/pull/25545\">#25545</a> to match the current <code>Mon_</code> :D. It’s your call really. I just find that it’s better if the two definition align, whichever we pick.</p>",
        "id": 522822486,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1749231688
    },
    {
        "content": "<p>If it doesn't make a big difference, I would prefer <code>IsMon_Hom</code> to be the default.</p>",
        "id": 522823599,
        "sender_full_name": "Yuma Mizuno",
        "timestamp": 1749232205
    },
    {
        "content": "<p>Ok! I’ll revert the commit in <a href=\"https://github.com/leanprover-community/mathlib4/pull/25545\">#25545</a> then.</p>",
        "id": 522823667,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1749232238
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 522823792,
        "sender_full_name": "Yuma Mizuno",
        "timestamp": 1749232277
    },
    {
        "content": "<p>refactor(CategoryTheory/Monoidal): define <code>Mon_.Hom</code> using type class <code>IsMon_Hom</code> <a href=\"https://github.com/leanprover-community/mathlib4/pull/25549\">#25549</a></p>",
        "id": 522851100,
        "sender_full_name": "Yuma Mizuno",
        "timestamp": 1749246904
    }
]