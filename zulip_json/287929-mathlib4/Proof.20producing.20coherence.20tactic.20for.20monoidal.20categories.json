[
    {
        "content": "<p>Recently I completely rewrote the coherence tactic in monoidal categories (and bicategories), which solves the goal like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Category</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MonoidalCategory</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"bp\">Œª_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">ùüô</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">hom</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">œÅ_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">ùüô</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">hom</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">monoidal_coherence</span>\n</code></pre></div>\n<p>The current coherence tactic transport equalities from free monoidal categories by the monoidal functor <code>F : FreeMonoidalCategory C ‚•§ C</code>. <a href=\"https://github.com/leanprover-community/mathlib4/blob/035936f986f1b6a83a6cf9ba5bae3c34ef9ec5dc/test/CategoryTheory/Coherence.lean#L18\">This example</a> is a good explanation of what the tactic does. This approach works, but has a performance issue due to the heavy defeq at the transport. In fact, some proofs using <code>coherence</code> tacitc in mathlib almost reach the timeout.</p>\n<p>The new coherence tactic is a proof producing tactic, which avoids heavy defeqs. It tunrs out that the new tactic is much faster than the current one especially when the expression is long. </p>\n<p>Note that there is a similar comparison between the transporting tactic and the proof producing tactic in the case of <code>ring</code>, which is discussed at the thread <a class=\"stream-topic\" data-stream-id=\"270676\" href=\"/#narrow/stream/270676-lean4/topic/Styles.20of.20reflective.20tactics\">#lean4 &gt; Styles of reflective tactics</a>  .</p>\n<p>The new coherence tactic combines the normalization procedure used in the string diagram widget to give us the general purpose tactic <code>monoidal</code>, which is similar to the current <code>coherence</code> tactic but much faster. </p>\n<p>I have created a series of PRs about this new coherence tactic. These are somewhat lengthy meta PRs, but would someone be willing to review it? I believe the new tactic will be more useful in formalizing theorems formulated by the category theory.</p>\n<ul>\n<li>feat(CategoryTheory/MonoidalComp): change¬†<code>IsIso</code>¬†to¬†<code>Iso</code>¬†<a href=\"https://github.com/leanprover-community/mathlib4/pull/16554\">#16554</a></li>\n<li>feat(CategoryTheory): proof producing coherence tactic 1: datatypes¬†<a href=\"https://github.com/leanprover-community/mathlib4/pull/16562\">#16562</a></li>\n<li>feat(CategoryTheory): proof producing coherence tactic 2-a: pureCoherence¬†<a href=\"https://github.com/leanprover-community/mathlib4/pull/16567\">#16567</a></li>\n<li>feat(CategoryTheory): proof producing coherence tactic 2-b: normalize¬†<a href=\"https://github.com/leanprover-community/mathlib4/pull/16578\">#16578</a></li>\n<li>feat(CategoryTheory): proof producing coherence tactic 3: main¬†<a href=\"https://github.com/leanprover-community/mathlib4/pull/16580\">#16580</a></li>\n<li>feat(CategoryTheory): proof producing coherence tactic 4: integrate into mathlib¬†<a href=\"https://github.com/leanprover-community/mathlib4/pull/16606\">#16606</a></li>\n<li>feat(CategoryTheory): proof producing coherence tactic 5: integrate into string diagram widget¬†<a href=\"https://github.com/leanprover-community/mathlib4/pull/16612\">#16612</a></li>\n<li>feat(CategoryTheory): proof producing coherence tactic 6: bicategory¬†<a href=\"https://github.com/leanprover-community/mathlib4/pull/16629\">#16629</a></li>\n</ul>",
        "id": 468858528,
        "sender_full_name": "Yuma Mizuno",
        "timestamp": 1725900389
    },
    {
        "content": "<p>cc <span class=\"user-mention\" data-user-id=\"260507\">@Heather Macbeth</span> who was looking for examples of heavy rfls</p>",
        "id": 469003030,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1725951855
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"438192\">@Yuma Mizuno</span>, contrary to our usual practice of splitting into many small PRs, I think we may want to just merge this all in one go. I've had a very brief look, and am very positive so far.</p>\n<p>Could you fix the missing module docs / merge conflicts, and run <code>!bench</code> on the final PR?</p>",
        "id": 470417573,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726453315
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span>  Thanks for the comment! I have made the all-in-one PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/16852\">#16852</a>.</p>",
        "id": 470632298,
        "sender_full_name": "Yuma Mizuno",
        "timestamp": 1726497776
    },
    {
        "content": "<p>Here is the benchmark result:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">Benchmark</span><span class=\"w\">                                        </span><span class=\"n\">Metric</span><span class=\"w\">          </span><span class=\"n\">Change</span>\n<span class=\"w\">  </span><span class=\"bp\">=======================================================================</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\">                                            </span><span class=\"n\">compilation</span><span class=\"w\">       </span><span class=\"mf\">5.2</span><span class=\"bp\">%</span>\n<span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Bicategory</span><span class=\"bp\">.</span><span class=\"n\">Adjunction</span><span class=\"w\">    </span><span class=\"n\">instructions</span><span class=\"w\">    </span><span class=\"bp\">-</span><span class=\"mf\">86.5</span><span class=\"bp\">%</span>\n<span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Monoidal</span><span class=\"bp\">.</span><span class=\"n\">Bimod</span><span class=\"w\">           </span><span class=\"n\">instructions</span><span class=\"w\">    </span><span class=\"bp\">-</span><span class=\"mf\">16.2</span><span class=\"bp\">%</span>\n<span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Monoidal</span><span class=\"bp\">.</span><span class=\"n\">Braided</span><span class=\"bp\">.</span><span class=\"n\">Basic</span><span class=\"w\">   </span><span class=\"n\">instructions</span><span class=\"w\">    </span><span class=\"bp\">-</span><span class=\"mf\">64.5</span><span class=\"bp\">%</span>\n<span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Monoidal</span><span class=\"bp\">.</span><span class=\"n\">Center</span><span class=\"w\">          </span><span class=\"n\">instructions</span><span class=\"w\">    </span><span class=\"bp\">-</span><span class=\"mf\">51.8</span><span class=\"bp\">%</span>\n<span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Monoidal</span><span class=\"bp\">.</span><span class=\"n\">Rigid</span><span class=\"bp\">.</span><span class=\"n\">Basic</span><span class=\"w\">     </span><span class=\"n\">instructions</span><span class=\"w\">    </span><span class=\"bp\">-</span><span class=\"mf\">80.0</span><span class=\"bp\">%</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Widget</span><span class=\"bp\">.</span><span class=\"n\">StringDiagram</span><span class=\"w\">             </span><span class=\"n\">instructions</span><span class=\"w\">   </span><span class=\"mf\">1021.1</span><span class=\"bp\">%</span>\n</code></pre></div>",
        "id": 470632718,
        "sender_full_name": "Yuma Mizuno",
        "timestamp": 1726497832
    },
    {
        "content": "<p>Sounds like I can finally close <a href=\"https://pp.ipd.kit.edu/thesis.php?id=333&amp;lang=en\">this</a> call for students to do this as their master thesis. <span aria-label=\"octopus\" class=\"emoji emoji-1f419\" role=\"img\" title=\"octopus\">:octopus:</span></p>",
        "id": 470650657,
        "sender_full_name": "Jakob von Raumer",
        "timestamp": 1726501322
    },
    {
        "content": "<p>Okay! Any objections to merging? I have still only skimmed, but I'm not finding any problems, and it looks great.</p>",
        "id": 470781823,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726532748
    }
]