[
    {
        "content": "<p>We have a new <code>privateModule</code> linter in mathlib (which is great!). However, it doesn't fire on <a href=\"https://github.com/leanprover-community/mathlib4/pull/30998\">#30998</a> --- which seemingly adds no public declarations at all. I did check: this branch includes the linter, and the mathlib standard linter set is enabled at that point.</p>\n<p>Can anybody help me investigate?</p>",
        "id": 560337157,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1764147696
    },
    {
        "content": "<p>I've made <a href=\"https://github.com/leanprover-community/mathlib4/pull/32128\">#32128</a> to start debugging that file (currently waiting for CI to build olean's).</p>",
        "id": 560337933,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1764147939
    },
    {
        "content": "<p>It's not firing on <a href=\"https://github.com/leanprover-community/mathlib4/pull/32080\">#32080</a> either</p>",
        "id": 560344739,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1764150010
    },
    {
        "content": "<p>... (consequently?) the docBlame linter also isn't triggering on <a href=\"https://github.com/leanprover-community/mathlib4/pull/32080/files#diff-1ca5ddeef0901701dbaef8900f22b3da273452bbdb54d8a38dd7b2eb9b33d437R45\">this def</a>.</p>",
        "id": 560348283,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1764151091
    },
    {
        "content": "<p>I think that the new module system has changed so much of the infrastructure that probably we should revise all linters to check that they still work as expected.</p>",
        "id": 560354333,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1764152816
    },
    {
        "content": "<p>Sure, but that linter was written after mathlib moved to the module system <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 560356918,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1764153502
    },
    {
        "content": "<p>I know, but I still think that I have not understood how things work, so I probably did not pick up potential issues...</p>",
        "id": 560357374,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1764153610
    },
    {
        "content": "<p>CI results are in, and with a bit of debugging I found something interesting:</p>\n<ul>\n<li><code>(← getEnv).constants.map₂</code> in the linter actually reports a public declaration, namely <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MvPolynomial.eq_1#doc\">docs#MvPolynomial.eq_1</a></li>\n<li>however, <code>#check MvPolynomial.eq_1</code>already is defined at the start of the module</li>\n</ul>",
        "id": 560381842,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1764161332
    },
    {
        "content": "<p>Does that indicate a bug in <code>Environment.constants.map₂</code>?</p>",
        "id": 560381929,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1764161366
    },
    {
        "content": "<p>cc <span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span> ?</p>",
        "id": 560382192,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1764161457
    },
    {
        "content": "<p>And MvPolynomial.eq_1 is not hoverable, so I'm not sure where it's defined.</p>",
        "id": 560383051,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1764161728
    },
    {
        "content": "<p>Probably at <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MvPolynomial#doc\">docs#MvPolynomial</a></p>",
        "id": 560383341,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1764161805
    },
    {
        "content": "<p>Indeed: <code>#check MvPolynomial.eq_1</code> works right after the definition, but not before.</p>",
        "id": 560383769,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1764161907
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/PrivateModule.20linter.20not.20firing/near/560381842\">said</a>:</p>\n<blockquote>\n<p>CI results are in, and with a bit of debugging I found something interesting:</p>\n<ul>\n<li><code>(← getEnv).constants.map₂</code> in the linter actually reports a public declaration, namely <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MvPolynomial.eq_1#doc\">docs#MvPolynomial.eq_1</a></li>\n<li>however, <code>#check MvPolynomial.eq_1</code>already is defined at the start of the module</li>\n</ul>\n</blockquote>\n<p>What do you get from <code>whatsnew in #print MvPolynomial.eq_1</code>? This is one of those lemmas that doesn't exist until you use it.</p>",
        "id": 560383890,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764161937
    },
    {
        "content": "<p>Putting this right after <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MvPolynomial#doc\">docs#MvPolynomial</a> yields the following</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/--</span>\n<span class=\"sd\">info: @[defeq] theorem MvPolynomial.eq_1.{u_1, u_2} : ∀ (σ : Type u_1) (R : Type u_2) [inst : CommSemiring R],</span>\n<span class=\"sd\">  MvPolynomial σ R = R[σ →₀ ℕ] :=</span>\n<span class=\"sd\">fun σ R [CommSemiring R] ↦ Eq.refl (MvPolynomial σ R)</span>\n<span class=\"sd\">---</span>\n<span class=\"sd\">info: theorem MvPolynomial.eq_1.{u_1, u_2} : ∀ (σ : Type u_1) (R : Type u_2) [inst : CommSemiring R],</span>\n<span class=\"sd\">  MvPolynomial σ R = R[σ →₀ ℕ] :=</span>\n<span class=\"sd\">fun σ R [CommSemiring R] ↦ Eq.refl (MvPolynomial σ R)</span>\n\n<span class=\"sd\">-- Lean.declRangeExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.docStringExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- _private.Lean.DocString.Extension.0.Lean.inheritDocStringExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.versoDocStringExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- _private.Lean.Compiler.MetaAttr.0.Lean.declMetaExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.Compiler.inlineAttrs extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.projectionFnInfoExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- _private.Lean.AddDecl.0.Lean.privateConstKindsExt extension: 1 new entries</span>\n\n<span class=\"sd\">-- Lean.Compiler.LCNF.baseExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.Compiler.LCNF.monoExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.IR.declMapExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.IR.UnreachableBranches.functionSummariesExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.Compiler.LCNF.Simp.ConstantFold.folderExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.Compiler.LCNF.specExtension extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.Compiler.LCNF.Specialize.specCacheExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.Compiler.LCNF.UnreachableBranches.functionSummariesExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.extraModUses extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.defeqAttr extension: 1 new entries</span>\n\n<span class=\"sd\">-- Lean.Meta.congrKindsExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.Elab.Structural.eqnInfoExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.Server.userRpcProcedures extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.Elab.WF.eqnInfoExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.Elab.PartialFixpoint.eqnInfoExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.Meta.funIndInfoExt extension: 0 new entries</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"n\">whatsnew</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">MvPolynomial</span><span class=\"bp\">.</span><span class=\"n\">eq_1</span>\n</code></pre></div>",
        "id": 560384200,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1764162009
    },
    {
        "content": "<p>Yeah see it's new</p>",
        "id": 560384278,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764162029
    },
    {
        "content": "<p>What if you put it at the end of the file?</p>",
        "id": 560384347,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764162050
    },
    {
        "content": "<p>Perhaps the private module linter is doing the wrong check: it does <code>!isPrivateName decl</code>...</p>",
        "id": 560384433,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1764162072
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/PrivateModule.20linter.20not.20firing/near/560384347\">said</a>:</p>\n<blockquote>\n<p>What if you put it at the end of the file?</p>\n</blockquote>\n<p>At the end of MvPolynomial.Basic: same out</p>",
        "id": 560384554,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1764162106
    },
    {
        "content": "<p>At the beginning of <code>FieldTheory/SeparatablyGenerated</code> (the module where the linter does not fire): slightly different, but very similar output</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/--</span>\n<span class=\"sd\">info: @[defeq] theorem MvPolynomial.eq_1.{u_1, u_2} : ∀ (σ : Type u_1) (R : Type u_2) [inst : CommSemiring R],</span>\n<span class=\"sd\">  MvPolynomial σ R = AddMonoidAlgebra R (σ →₀ ℕ) :=</span>\n<span class=\"sd\">fun σ R [CommSemiring R] ↦ Eq.refl (MvPolynomial σ R)</span>\n<span class=\"sd\">---</span>\n<span class=\"sd\">info: theorem MvPolynomial.eq_1.{u_1, u_2} : ∀ (σ : Type u_1) (R : Type u_2) [inst : CommSemiring R],</span>\n<span class=\"sd\">  MvPolynomial σ R = AddMonoidAlgebra R (σ →₀ ℕ) :=</span>\n<span class=\"sd\">fun σ R [CommSemiring R] ↦ Eq.refl (MvPolynomial σ R)</span>\n\n<span class=\"sd\">-- Lean.declRangeExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.docStringExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- _private.Lean.DocString.Extension.0.Lean.inheritDocStringExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.versoDocStringExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- _private.Lean.Compiler.MetaAttr.0.Lean.declMetaExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.Compiler.inlineAttrs extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.projectionFnInfoExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- _private.Lean.AddDecl.0.Lean.privateConstKindsExt extension: 1 new entries</span>\n\n<span class=\"sd\">-- Lean.Compiler.LCNF.baseExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.Compiler.LCNF.monoExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.IR.declMapExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.IR.UnreachableBranches.functionSummariesExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.Compiler.LCNF.Simp.ConstantFold.folderExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.Compiler.LCNF.specExtension extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.Compiler.LCNF.Specialize.specCacheExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.Compiler.LCNF.UnreachableBranches.functionSummariesExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.extraModUses extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.defeqAttr extension: 1 new entries</span>\n\n<span class=\"sd\">-- Lean.Meta.congrKindsExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.Elab.Structural.eqnInfoExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.Server.userRpcProcedures extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.Elab.WF.eqnInfoExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.Elab.PartialFixpoint.eqnInfoExt extension: 0 new entries</span>\n\n<span class=\"sd\">-- Lean.Meta.funIndInfoExt extension: 0 new entries</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"n\">whatsnew</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">MvPolynomial</span><span class=\"bp\">.</span><span class=\"n\">eq_1</span>\n</code></pre></div>",
        "id": 560384712,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1764162153
    },
    {
        "content": "<p>sorry, I mean put it at the end of the file where the linter didn't lint</p>",
        "id": 560385258,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764162308
    },
    {
        "content": "<p>I was wondering if you meant that :-)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/--</span>\n<span class=\"sd\">info: @[defeq] theorem MvPolynomial.eq_1.{u_1, u_2} : ∀ (σ : Type u_1) (R : Type u_2) [inst : CommSemiring R],</span>\n<span class=\"sd\">  MvPolynomial σ R = AddMonoidAlgebra R (σ →₀ ℕ) :=</span>\n<span class=\"sd\">fun σ R [CommSemiring R] ↦ Eq.refl (MvPolynomial σ R)</span>\n<span class=\"sd\">---</span>\n<span class=\"sd\">info: -- Lean.declRangeExt extension: 0 new entries</span>\n<span class=\"sd\">-- Lean.docStringExt extension: 0 new entries</span>\n<span class=\"sd\">-- _private.Lean.DocString.Extension.0.Lean.inheritDocStringExt extension: 0 new entries</span>\n<span class=\"sd\">-- Lean.versoDocStringExt extension: 0 new entries</span>\n<span class=\"sd\">-- _private.Lean.Compiler.MetaAttr.0.Lean.declMetaExt extension: 0 new entries</span>\n<span class=\"sd\">-- Lean.Compiler.inlineAttrs extension: 0 new entries</span>\n<span class=\"sd\">-- Lean.projectionFnInfoExt extension: 0 new entries</span>\n<span class=\"sd\">-- _private.Lean.AddDecl.0.Lean.privateConstKindsExt extension: 0 new entries</span>\n<span class=\"sd\">-- Lean.Compiler.LCNF.baseExt extension: 0 new entries</span>\n<span class=\"sd\">-- Lean.Compiler.LCNF.monoExt extension: 0 new entries</span>\n<span class=\"sd\">-- Lean.IR.declMapExt extension: 0 new entries</span>\n<span class=\"sd\">-- Lean.IR.UnreachableBranches.functionSummariesExt extension: 0 new entries</span>\n<span class=\"sd\">-- Lean.Compiler.LCNF.Simp.ConstantFold.folderExt extension: 0 new entries</span>\n<span class=\"sd\">-- Lean.Compiler.LCNF.specExtension extension: 0 new entries</span>\n<span class=\"sd\">-- Lean.Compiler.LCNF.Specialize.specCacheExt extension: 0 new entries</span>\n<span class=\"sd\">-- Lean.Compiler.LCNF.UnreachableBranches.functionSummariesExt extension: 0 new entries</span>\n<span class=\"sd\">-- Lean.extraModUses extension: 0 new entries</span>\n<span class=\"sd\">-- Lean.defeqAttr extension: 0 new entries</span>\n<span class=\"sd\">-- Lean.Meta.congrKindsExt extension: 0 new entries</span>\n<span class=\"sd\">-- Lean.Elab.Structural.eqnInfoExt extension: 0 new entries</span>\n<span class=\"sd\">-- Lean.Server.userRpcProcedures extension: 0 new entries</span>\n<span class=\"sd\">-- Lean.Elab.WF.eqnInfoExt extension: 0 new entries</span>\n<span class=\"sd\">-- Lean.Elab.PartialFixpoint.eqnInfoExt extension: 0 new entries</span>\n<span class=\"sd\">-- Lean.Meta.funIndInfoExt extension: 0 new entries</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"n\">whatsnew</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">MvPolynomial</span><span class=\"bp\">.</span><span class=\"n\">eq_1</span>\n</code></pre></div>",
        "id": 560385560,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1764162388
    },
    {
        "content": "<p>In particular, all lines say \"0 new entries\"</p>",
        "id": 560385614,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1764162405
    },
    {
        "content": "<p>Ah, the linter should filter out any <code>isReservedName</code>s</p>",
        "id": 560385736,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1764162438
    },
    {
        "content": "<p>So at the end of the file it's not new anymore</p>",
        "id": 560385912,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764162484
    },
    {
        "content": "<p>see it's not printing the theorem declaration twice</p>",
        "id": 560385986,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764162510
    },
    {
        "content": "<p>so this is definitely defined somewhere in the file</p>",
        "id": 560386021,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764162523
    },
    {
        "content": "<p>So the linter should read <code>if !isPrivateName decl &amp;&amp; !isReservedName (← getEnv) decl then</code> instead of the current <code>if !isPrivateName decl then</code>?</p>",
        "id": 560386089,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1764162543
    },
    {
        "content": "<p>Yes, that's more correct and possibly also fully correct :)</p>",
        "id": 560386167,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1764162564
    },
    {
        "content": "<p>It is hard to make a statement about the behavior of any and all involved metaprograms, especially when some might not be from core</p>",
        "id": 560386353,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1764162616
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/32140\">#32140</a> fixes the linter. It would be very nice to add a test; can somebody help me by suggesting one (that's not \"take this entire module in mathlib\")?</p>",
        "id": 560386811,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1764162740
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"224323\">Junyan Xu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/PrivateModule.20linter.20not.20firing/near/560344739\">said</a>:</p>\n<blockquote>\n<p>It's not firing on <a href=\"https://github.com/leanprover-community/mathlib4/pull/32080\">#32080</a> either</p>\n</blockquote>\n<p>That's because I have public theorems</p>",
        "id": 560387664,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764162995
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"224323\">Junyan Xu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/PrivateModule.20linter.20not.20firing/near/560348283\">said</a>:</p>\n<blockquote>\n<p>... (consequently?) the docBlame linter also isn't triggering on <a href=\"https://github.com/leanprover-community/mathlib4/pull/32080/files#diff-1ca5ddeef0901701dbaef8900f22b3da273452bbdb54d8a38dd7b2eb9b33d437R45\">this def</a>.</p>\n</blockquote>\n<p>That's because it's private</p>",
        "id": 560387692,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764163002
    },
    {
        "content": "<p>I see, decls are by default private now. <code>@[expose] public section</code> restores the old behavior.</p>",
        "id": 560389035,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1764163403
    },
    {
        "content": "<p>(Great to wake up to both a bug and its fix! <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span>)</p>\n<p>Hmm, what about some of the things <code>isAutoDecl</code> checks? Obviously some are simply evidence of public declarations, and there is no need to consider them private—but specifically, I could imagine considering as \"private\"</p>\n<ul>\n<li><code>isInternal</code> names</li>\n<li>names which have macro scopes</li>\n<li>names which start with <code>match_</code> or <code>proof_</code></li>\n</ul>\n<p>I'm not sure if these are already covered by existing checks, though: for instance, it seems like a <code>match_*</code> lemma is <code>_private</code> iff it's generated by a private declaration, but I'm not sure. (Note: it's not reserved)</p>",
        "id": 560410967,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1764169050
    },
    {
        "content": "<p>Good points, for all of these. Do you have examples at hand? It would be great to verify these, and having an example to look at would also make it much easier for me to decide what sensible behaviour would be.</p>",
        "id": 560424060,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1764172243
    },
    {
        "content": "<p>If a public declaration is synthesized from a private one, that should likely be considered a bug in that metaprogram. This is true for reserved names as well but the special thing about them is that the two decls can live in different files, so it makes sense for the linter to special case them.</p>",
        "id": 560438429,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1764176137
    },
    {
        "content": "<p>I just found a new case of this: <a href=\"https://tqft.net/mathlib4files/Mathlib\">file#Mathlib</a>.Analysis.Normed.Lp.SmoothApprox seems to define no public file, but is fine. Does somebody here have time to investigate? (I probably won't, in the near future, sadly.)</p>",
        "id": 562418477,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1765185574
    },
    {
        "content": "<p>Correct link: <a href=\"https://github.com/leanprover-community/mathlib4/blob/master/Mathlib/Analysis/Normed/Lp/SmoothApprox.lean\">https://github.com/leanprover-community/mathlib4/blob/master/Mathlib/Analysis/Normed/Lp/SmoothApprox.lean</a></p>",
        "id": 562418538,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1765185589
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/32128\">#32128</a> should have debugging output in around an hour, which should make investigating not so difficult</p>",
        "id": 562419984,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1765185971
    },
    {
        "content": "<p>It seems that the linter finds some weird declarations, even if nothing is public:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">privateModule</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">running</span>\n<span class=\"n\">found</span><span class=\"w\"> </span><span class=\"n\">public</span><span class=\"w\"> </span><span class=\"n\">declaration</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">auto</span><span class=\"bp\">._@.</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">Normed</span><span class=\"bp\">.</span><span class=\"n\">Lp</span><span class=\"bp\">.</span><span class=\"n\">SmoothApprox</span><span class=\"bp\">.</span><span class=\"m\">2780282558</span><span class=\"bp\">._</span><span class=\"n\">hygCtx</span><span class=\"bp\">._</span><span class=\"n\">hyg</span><span class=\"bp\">.</span><span class=\"m\">36</span>\n<span class=\"n\">found</span><span class=\"w\"> </span><span class=\"n\">public</span><span class=\"w\"> </span><span class=\"n\">declaration</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">auto</span><span class=\"bp\">._@.</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">Normed</span><span class=\"bp\">.</span><span class=\"n\">Lp</span><span class=\"bp\">.</span><span class=\"n\">SmoothApprox</span><span class=\"bp\">.</span><span class=\"m\">2871035219</span><span class=\"bp\">._</span><span class=\"n\">hygCtx</span><span class=\"bp\">._</span><span class=\"n\">hyg</span><span class=\"bp\">.</span><span class=\"m\">37</span>\n</code></pre></div>",
        "id": 562453477,
        "sender_full_name": "Moritz Doll",
        "timestamp": 1765196631
    },
    {
        "content": "<p>With <code>@[expose] public section</code> we get all of the actual declarations on top</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">privateModule</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">running</span>\n<span class=\"n\">found</span><span class=\"w\"> </span><span class=\"n\">public</span><span class=\"w\"> </span><span class=\"n\">declaration</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">auto</span><span class=\"bp\">._@.</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">Normed</span><span class=\"bp\">.</span><span class=\"n\">Lp</span><span class=\"bp\">.</span><span class=\"n\">SmoothApprox</span><span class=\"bp\">.</span><span class=\"m\">2780282558</span><span class=\"bp\">._</span><span class=\"n\">hygCtx</span><span class=\"bp\">._</span><span class=\"n\">hyg</span><span class=\"bp\">.</span><span class=\"m\">36</span>\n<span class=\"n\">found</span><span class=\"w\"> </span><span class=\"n\">public</span><span class=\"w\"> </span><span class=\"n\">declaration</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">auto</span><span class=\"bp\">._@.</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">Normed</span><span class=\"bp\">.</span><span class=\"n\">Lp</span><span class=\"bp\">.</span><span class=\"n\">SmoothApprox</span><span class=\"bp\">.</span><span class=\"m\">2871035219</span><span class=\"bp\">._</span><span class=\"n\">hygCtx</span><span class=\"bp\">._</span><span class=\"n\">hyg</span><span class=\"bp\">.</span><span class=\"m\">37</span>\n<span class=\"n\">found</span><span class=\"w\"> </span><span class=\"n\">public</span><span class=\"w\"> </span><span class=\"n\">declaration</span><span class=\"w\"> </span><span class=\"n\">HasCompactSupport</span><span class=\"bp\">.</span><span class=\"n\">exist_eLpNorm_sub_le_of_continuous</span>\n<span class=\"n\">found</span><span class=\"w\"> </span><span class=\"n\">public</span><span class=\"w\"> </span><span class=\"n\">declaration</span><span class=\"w\"> </span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">MemLp</span><span class=\"bp\">.</span><span class=\"n\">exist_eLpNorm_sub_le</span>\n<span class=\"n\">found</span><span class=\"w\"> </span><span class=\"n\">public</span><span class=\"w\"> </span><span class=\"n\">declaration</span><span class=\"w\"> </span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">Lp</span><span class=\"bp\">.</span><span class=\"n\">dense_hasCompactSupport_contDiff</span>\n</code></pre></div>",
        "id": 562453796,
        "sender_full_name": "Moritz Doll",
        "timestamp": 1765196738
    },
    {
        "content": "<p>it seems that <code>by volume_tac</code> is the problem</p>",
        "id": 562455149,
        "sender_full_name": "Moritz Doll",
        "timestamp": 1765197164
    },
    {
        "content": "<p>That's interesting; it seems we found a new bug in the linter <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span></p>",
        "id": 562457089,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1765197751
    },
    {
        "content": "<p>What happens when you do <code>#whatsnew</code> on the new declarations? (Similarly to the debugging further up this thread.)</p>",
        "id": 562457169,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1765197782
    },
    {
        "content": "<p>If I check with <code>Batteries.Tactic.Lint.isAutoDecl</code> as well, then it is fine</p>",
        "id": 562457195,
        "sender_full_name": "Moritz Doll",
        "timestamp": 1765197789
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"548935\">@Thomas Murrills</span> It seems there's another bug - in this linter or in <code>volume_tac</code>.</p>",
        "id": 562457223,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1765197798
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">          </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"n\">isPrivateName</span><span class=\"w\"> </span><span class=\"n\">decl</span><span class=\"w\"> </span><span class=\"bp\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"n\">isReservedName</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getEnv</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">decl</span><span class=\"w\"> </span><span class=\"bp\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">liftCoreM</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Batteries</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Lint</span><span class=\"bp\">.</span><span class=\"n\">isAutoDecl</span><span class=\"w\"> </span><span class=\"n\">decl</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"k\">then</span>\n</code></pre></div>",
        "id": 562457273,
        "sender_full_name": "Moritz Doll",
        "timestamp": 1765197813
    },
    {
        "content": "<p>In the doc-string it says that this check is not done on purpose, so either <code>volume_tac</code> does something wrong or the linter has to be more strict</p>",
        "id": 562457459,
        "sender_full_name": "Moritz Doll",
        "timestamp": 1765197873
    },
    {
        "content": "<p>Exactly - but I don't know enough Lean internals to say for sure which one.</p>",
        "id": 562457553,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1765197902
    },
    {
        "content": "<p><code>volume_tac</code> is just</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- The tactic `exact volume`, to be used in optional (`autoParam`) arguments. -/</span>\n<span class=\"kn\">macro</span><span class=\"w\"> </span><span class=\"s2\">\"volume_tac\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">first</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">MeasureSpace</span><span class=\"bp\">.</span><span class=\"n\">volume</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>so I feel out of my depth as well</p>",
        "id": 562458114,
        "sender_full_name": "Moritz Doll",
        "timestamp": 1765198066
    },
    {
        "content": "<p>For my own curiousity: does the linter still not fire if you replace the tactic by <code>exact MeasureTheory.MeasureSpace.volume</code>?</p>",
        "id": 562458568,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1765198208
    },
    {
        "content": "<p>yeah, that does not make a difference</p>",
        "id": 562458756,
        "sender_full_name": "Moritz Doll",
        "timestamp": 1765198264
    },
    {
        "content": "<p>i.e., replace <code>by volume_tac</code> by <code>by exact volume</code> yields the same results (I was in fact wondering why there is the <code>first | ..</code> in the tactic)</p>",
        "id": 562458954,
        "sender_full_name": "Moritz Doll",
        "timestamp": 1765198325
    },
    {
        "content": "<p>seems a bit redundant (<a href=\"https://github.com/leanprover-community/mathlib4/pull/32586\">#32586</a>)</p>",
        "id": 562458981,
        "sender_full_name": "Moritz Doll",
        "timestamp": 1765198336
    },
    {
        "content": "<p>Hmm, nice investigation! :) These <code>_auto</code> declarations are public in the given module, but are they indeed ultimately imported downstream as you’d expect? (Or do lean internals e.g. ignore things with macro scopes when exporting?)</p>",
        "id": 562501813,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1765208867
    },
    {
        "content": "<p>(I can investigate this in about an hour if no one gets to it.)</p>",
        "id": 562501978,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1765208901
    },
    {
        "content": "<p>Basically, if they <em>are</em> imported downstream, that seems to me like a meta bug arising from <code>volume_tac</code> somehow. If they’re not, it means we need another check—perhaps macro scopes, or perhaps <code>isInternal</code>. (In this case we should see what core does.)</p>\n<p>(It could also be the case that these are deliberately allowed to leak into the public scope because they’re inaccessible to the user anyway, given that they have macro scopes or are internal, but I’d be surprised. But I’ve been surprised before! :) )</p>",
        "id": 562502921,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1765209138
    },
    {
        "content": "<p>Interestingly, the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">module</span>\n\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">Normed</span><span class=\"bp\">.</span><span class=\"n\">Lp</span><span class=\"bp\">.</span><span class=\"n\">SmoothApprox</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"n\">run_cmd</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">modIdx?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getEnv</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">header</span><span class=\"bp\">.</span><span class=\"n\">moduleNames</span><span class=\"bp\">.</span><span class=\"n\">findIdx?</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"ss\">`Mathlib.Analysis.Normed.Lp.SmoothApprox</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">modIdx?</span><span class=\"bp\">.</span><span class=\"n\">isNone</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">throwError</span><span class=\"w\"> </span><span class=\"s2\">\"could not find module\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">mut</span><span class=\"w\"> </span><span class=\"n\">fromSmoothApprox</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[]</span>\n<span class=\"w\">  </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"o\">,</span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getEnv</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">constants</span><span class=\"bp\">.</span><span class=\"n\">map₁</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getEnv</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">getModuleIdxFor?</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">modIdx?</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"n\">fromSmoothApprox</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">fromSmoothApprox</span><span class=\"bp\">.</span><span class=\"n\">push</span><span class=\"w\"> </span><span class=\"n\">name</span>\n<span class=\"w\">  </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"{fromSmoothApprox.map MessageData.ofConstName}\"</span>\n</code></pre></div>\n<p>yields</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">[</span><span class=\"bp\">_</span><span class=\"n\">private</span><span class=\"bp\">.</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">Normed</span><span class=\"bp\">.</span><span class=\"n\">Lp</span><span class=\"bp\">.</span><span class=\"n\">SmoothApprox</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">.</span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">MemLp</span><span class=\"bp\">.</span><span class=\"n\">exist_eLpNorm_sub_le</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">auto</span><span class=\"bp\">._@.</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">Normed</span><span class=\"bp\">.</span><span class=\"n\">Lp</span><span class=\"bp\">.</span><span class=\"n\">SmoothApprox</span><span class=\"bp\">.</span><span class=\"m\">2780282558</span><span class=\"bp\">._</span><span class=\"n\">hygCtx</span><span class=\"bp\">._</span><span class=\"n\">hyg</span><span class=\"bp\">.</span><span class=\"m\">36</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">private</span><span class=\"bp\">.</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">Normed</span><span class=\"bp\">.</span><span class=\"n\">Lp</span><span class=\"bp\">.</span><span class=\"n\">SmoothApprox</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">.</span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">Lp</span><span class=\"bp\">.</span><span class=\"n\">dense_hasCompactSupport_contDiff</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">auto</span><span class=\"bp\">._@.</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">Normed</span><span class=\"bp\">.</span><span class=\"n\">Lp</span><span class=\"bp\">.</span><span class=\"n\">SmoothApprox</span><span class=\"bp\">.</span><span class=\"m\">2871035219</span><span class=\"bp\">._</span><span class=\"n\">hygCtx</span><span class=\"bp\">._</span><span class=\"n\">hyg</span><span class=\"bp\">.</span><span class=\"m\">37</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">private</span><span class=\"bp\">.</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">Normed</span><span class=\"bp\">.</span><span class=\"n\">Lp</span><span class=\"bp\">.</span><span class=\"n\">SmoothApprox</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">.</span><span class=\"n\">HasCompactSupport</span><span class=\"bp\">.</span><span class=\"n\">exist_eLpNorm_sub_le_of_continuous</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>So, it seems like the private constants are \"imported\" as well, but they have that <code>num</code> component (<code>0</code>) in the middle. I'm therefore not sure that having these in the imported constants means anything...maybe there's a more appropriate way to check if a constant is \"imported\".</p>",
        "id": 562524469,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1765215814
    },
    {
        "content": "<p>Note: it seems that this is not a property of <code>volume_tac</code>, but of any <code>autoParam</code>. (Indeed, <code>by skip</code> produces similar decls.) I was under the impression before looking at the code that <code>volume_tac</code> was being executed. However, these <code>_auto</code> declarations are in fact autogenerated declarations reperesenting the <code>Syntax</code> of the autoparam! (Hover over them after running the code above to see their type.)</p>",
        "id": 562524918,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1765215975
    },
    {
        "content": "<p>(Note: the meta declaration which constructs these declarations is <code>Lean.Elab.Term.declareTacticSyntax</code>.)</p>",
        "id": 562525739,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1765216304
    },
    {
        "content": "<p>For what it's worth, it seems that this declaration is generated at <code>variable</code>, and then again at every theorem that uses it (which is only one).</p>",
        "id": 562529921,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1765216830
    },
    {
        "content": "<p>I would like to check to see if autoparams are in fact intended to be exported like this in lean core, but in the meantime, the most limited possible fix is simply not counting names with the prefix <code>_auto</code> (which is added by <code>declareTacticSyntax</code>.</p>\n<p>Alternatively, we could avoid counting all names that are inaccessible to the user: <code>isInternalOrNum</code> should do it. (Note: this subsumes <code>hasMacroScopes</code>.)</p>\n<p>However, the part of the docstring of <code>isInternalOrNum</code> which states that \"the frontend does not allow user declarations to start with <code>_</code> in any of its parts\" does not seem to be true...</p>",
        "id": 562536255,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1765219052
    },
    {
        "content": "<p><span aria-label=\"working on it\" class=\"emoji emoji-1f6e0\" role=\"img\" title=\"working on it\">:working_on_it:</span> <a href=\"https://github.com/leanprover-community/mathlib4/pull/32597\">#32597</a>; starting with the limited-scope fix, will test the broader strategy as well.</p>",
        "id": 562537292,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1765219512
    },
    {
        "content": "<p>I've asked about these decls in <a class=\"stream-topic\" data-stream-id=\"270676\" href=\"/#narrow/channel/270676-lean4/topic/Should.20autoparam.20helper.20decls.20be.20private.3F/with/562539784\">#lean4 &gt; Should autoparam helper decls be private?</a> .</p>",
        "id": 562539837,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1765220634
    },
    {
        "content": "<p>I've now tested not counting names which satisfy <code>isInternalDetail</code> as public, and I am pretty sure this is not what we want, as it means not counting <code>initialize</code> declarations and lemmas generated by <code>simps</code>-esque attributes as public. (More info in PR comments.)</p>\n<p>It's also possible that we do not get resolution on this question until Sebastian comes back from traveling, so I suggest we go ahead with just excluding <code>_auto</code> for now. :) I've also mentioned the lean issue (<a href=\"https://github.com/leanprover/lean4/pull/11569\">lean4#11569</a>) in the PR.</p>",
        "id": 562813825,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1765319568
    },
    {
        "content": "<p>Another instance: <a href=\"https://github.com/leanprover-community/mathlib4/pull/31732\">#31732</a> was also missed by the linter. It doesn't look like it has any autoparams --- is this another bug? <span class=\"user-mention\" data-user-id=\"548935\">@Thomas Murrills</span></p>",
        "id": 563184916,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1765459400
    },
    {
        "content": "<p>(Be my guest to modify my debugging PR!)</p>",
        "id": 563184952,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1765459412
    },
    {
        "content": "<p>Aux decls generated by <code>notation3</code> seem to be the culprit. :) I think this falls under the scope of \"bug in the metaprogram\" (i.e., <code>notation3</code> is not respecting visibility). Seeing if I can fix it easily now. :)</p>",
        "id": 563242985,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1765473102
    },
    {
        "content": "<p>For some reason it explicitly makes the <code>delab</code> <code>public</code>...?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">public</span><span class=\"w\"> </span><span class=\"n\">aux_def</span><span class=\"w\"> </span><span class=\"n\">delab_app</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"o\">(</span><span class=\"n\">mkIdent</span><span class=\"w\"> </span><span class=\"n\">fullName</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Delab</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n</code></pre></div>",
        "id": 563243470,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1765473256
    },
    {
        "content": "<p>Ah, it seems this was just during the bump, which is understandable. :)</p>",
        "id": 563243558,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1765473286
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/32749\">#32749</a> fixes <code>notation3</code> and adds a test for the private module linter. (Assuming it passes CI. <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span>)</p>",
        "id": 563261032,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1765478920
    },
    {
        "content": "<p>CI fails in the tests, but for a reason that's not obvious to me.</p>",
        "id": 563298267,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1765494664
    },
    {
        "content": "<p>Restarted the job, who knows</p>",
        "id": 563299324,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1765495383
    },
    {
        "content": "<p>Oops, sorry, that was actually just me not committing everything I intended to! <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 563311532,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1765503574
    },
    {
        "content": "<p>CI is green now. :)</p>",
        "id": 563311731,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1765503740
    }
]