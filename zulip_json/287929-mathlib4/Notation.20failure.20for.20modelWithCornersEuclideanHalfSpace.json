[
    {
        "content": "<p>The following was minimized from <a href=\"https://github.com/leanprover-community/mathlib4/pull/15891\">#15891</a>: removing brackets leads to a confusing error message.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">Manifold</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NeZero</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Zero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EuclideanHalfSpace</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\">  </span><span class=\"bp\">‚ü®</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">norm_num</span><span class=\"bp\">‚ü©</span>\n\n<span class=\"c1\">-- works fine</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">modelWithCornersEuclideanHalfSpace_zero</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NeZero</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùì°</span><span class=\"bp\">‚àÇ</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"c1\">-- fails</span>\n<span class=\"sd\">/--</span>\n<span class=\"sd\">error: function expected at</span>\n<span class=\"sd\">  n</span>\n<span class=\"sd\">term has type</span>\n<span class=\"sd\">  ‚Ñï</span>\n<span class=\"sd\">---</span>\n<span class=\"sd\">error: function expected at</span>\n<span class=\"sd\">  n</span>\n<span class=\"sd\">term has type</span>\n<span class=\"sd\">  ‚Ñï</span>\n<span class=\"sd\">---</span>\n<span class=\"sd\">error: function expected at</span>\n<span class=\"sd\">  n</span>\n<span class=\"sd\">term has type</span>\n<span class=\"sd\">  ‚Ñï</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">fails</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NeZero</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ùì°</span><span class=\"bp\">‚àÇ</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p><span class=\"user-mention\" data-user-id=\"387244\">@Ya√´l Dillies</span> suggested <code>That sounds like a missing withOverApp or something like that.</code><br>\nAny notation experts here who can chime in? CC <span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> <span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span></p>",
        "id": 493366735,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1736778805
    },
    {
        "content": "<p>I think my <code>withOverApp</code> is a confusion with the delaborator. Still, you should definitely be able to do notation for functions!</p>",
        "id": 493367391,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1736778970
    },
    {
        "content": "<p>Actually, aren't you simply missing an <code>:args</code> on the notation? It would be helpful to reproduce the notation here</p>",
        "id": 493369735,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1736779606
    },
    {
        "content": "<p>Sure, the code for the notation is</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- The model space used to define `n`-dimensional real manifolds with boundary. -/</span>\n<span class=\"kn\">scoped</span><span class=\"o\">[</span><span class=\"n\">Manifold</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">notation3</span><span class=\"w\"> </span><span class=\"s2\">\"ùì°‚àÇ \"</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">modelWithCornersEuclideanHalfSpace</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">      </span><span class=\"n\">ModelWithCorners</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EuclideanHalfSpace</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">))</span>\n</code></pre></div>",
        "id": 493370656,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1736779829
    },
    {
        "content": "<p>(in Geometry/Manifold/Instances/Real.lean)</p>",
        "id": 493370751,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1736779849
    },
    {
        "content": "<p>How does</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- The model space used to define `n`-dimensional real manifolds with boundary. -/</span>\n<span class=\"kn\">scoped</span><span class=\"o\">[</span><span class=\"n\">Manifold</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">notation3</span><span class=\"w\"> </span><span class=\"s2\">\"ùì°‚àÇ \"</span><span class=\"o\">:</span><span class=\"n\">arg</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">modelWithCornersEuclideanHalfSpace</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">      </span><span class=\"n\">ModelWithCorners</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EuclideanHalfSpace</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>fare? (on mobile currently, so untested)</p>",
        "id": 493371272,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1736779970
    },
    {
        "content": "<p>I guess the question is whether <code>ùì°‚àÇ f x</code> is intended to parse as <code>ùì°‚àÇ (f x)</code> or <code>(ùì°‚àÇ f) x</code></p>",
        "id": 493371724,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736780059
    },
    {
        "content": "<p>The syntax doesn't parse: <code>unexpected token ':'; expected '=&gt;'</code></p>",
        "id": 493382596,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1736782818
    },
    {
        "content": "<p>And what if you replace <code>notation3</code> with <code>notation</code>?</p>",
        "id": 493387488,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1736784127
    },
    {
        "content": "<p>The same error. Here's the updated MWE to test</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">Manifold</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NeZero</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Zero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EuclideanHalfSpace</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\">  </span><span class=\"bp\">‚ü®</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">norm_num</span><span class=\"bp\">‚ü©</span>\n\n<span class=\"sd\">/-- The model space used to define `n`-dimensional real manifolds with boundary. -/</span>\n<span class=\"kn\">scoped</span><span class=\"o\">[</span><span class=\"n\">Manifold</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"foo \"</span><span class=\"o\">:</span><span class=\"n\">arg</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">modelWithCornersEuclideanHalfSpace</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">      </span><span class=\"n\">ModelWithCorners</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EuclideanHalfSpace</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">))</span>\n<span class=\"c1\">-- works fine</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">modelWithCornersEuclideanHalfSpace_zero</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NeZero</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùì°</span><span class=\"bp\">‚àÇ</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"c1\">-- fails</span>\n<span class=\"sd\">/--</span>\n<span class=\"sd\">error: elaboration function for 'Manifold.termFoo' has not been implemented</span>\n<span class=\"sd\">  foo</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">fails</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NeZero</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>",
        "id": 493399173,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1736787202
    }
]