[
    {
        "content": "<p>Hey I've been trying to do <a href=\"https://adventofcode.com/2024\">advent of code 2024</a> using Lean4 and I'm getting a weird issue where if I try to run my program that contains a <code>mathlib</code> import it'll error without an error message.</p>\n<p>My repo is here: <a href=\"https://github.com/Philogy/lean-aoc-2024\">https://github.com/Philogy/lean-aoc-2024</a></p>\n<p>It's very simple so I'd consider the <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a> to just un-comment <code>/- import Aoc2024.Day2 -/</code> in <code>Main.lean</code> not sure why this is happening. I'm trying to run <code>lake exec aoc-2024</code>.</p>\n<p>My Day2 function evaluates fine &amp; builds fine but if I try <code>exec</code> or running the resulting executable it fails. (The executable version gives me a segfault). Maybe I configured smth wrong?</p>",
        "id": 486060949,
        "sender_full_name": "Philogy",
        "timestamp": 1733308679
    },
    {
        "content": "<p>Could you post a stack trace using gdb/...?</p>",
        "id": 486061678,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1733308906
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110024\">Sebastian Ullrich</span> <a href=\"#narrow/channel/287929-mathlib4/topic/No.20Error.2FSegfault.20when.20importing.20mathlib/near/486061678\">said</a>:</p>\n<blockquote>\n<p>Could you post a stack trace using gdb/...?</p>\n</blockquote>\n<p>I'm on macos, any good alternative?</p>",
        "id": 486148655,
        "sender_full_name": "Philogy",
        "timestamp": 1733334767
    },
    {
        "content": "<p>Also what command do I run exactly to get a stack trace to</p>",
        "id": 486148847,
        "sender_full_name": "Philogy",
        "timestamp": 1733334835
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"739332\">Philogy</span> <a href=\"#narrow/channel/287929-mathlib4/topic/No.20Error.2FSegfault.20when.20importing.20mathlib/near/486060949\">said</a>:</p>\n<blockquote>\n<p>It's very simple so I'd consider the <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a> to just un-comment <code>/- import Aoc2024.Day2 -/</code> in <code>Main.lean</code> not sure why this is happening. I'm trying to run <code>lake exec aoc-2024</code>.</p>\n</blockquote>\n<p>An <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a> needs to consist of a code block enclosed in backticks that we can run in the online sandbox.</p>",
        "id": 486198477,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733355949
    },
    {
        "content": "<p>The fact that in your repository you are getting lots of warnings from building Mathlib:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">aoc</span><span class=\"bp\">-</span><span class=\"mi\">2024</span>\n<span class=\"bp\">⚠</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">201</span><span class=\"bp\">/</span><span class=\"mi\">1044</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Replayed</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Logic</span><span class=\"bp\">.</span><span class=\"n\">ExistsUnique</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Logic</span><span class=\"bp\">/</span><span class=\"n\">ExistsUnique</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">109</span><span class=\"o\">:</span><span class=\"mi\">16</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"ss\">`exists_unique_eq'</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">missing</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">doc</span><span class=\"bp\">-</span><span class=\"n\">string</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">please</span><span class=\"w\"> </span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"bp\">.</span>\n<span class=\"n\">Declarations</span><span class=\"w\"> </span><span class=\"n\">whose</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"n\">ends</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">`'`</span><span class=\"w\"> </span><span class=\"n\">are</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">contain</span><span class=\"w\"> </span><span class=\"n\">an</span><span class=\"w\"> </span><span class=\"n\">explanation</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">presence</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">`'`</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">their</span><span class=\"w\"> </span><span class=\"n\">doc</span><span class=\"bp\">-</span><span class=\"n\">string</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">This</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">consist</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">discussion</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">difference</span><span class=\"w\"> </span><span class=\"n\">relative</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">unprimed</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">an</span><span class=\"w\"> </span><span class=\"n\">explanation</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">why</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">better</span><span class=\"w\"> </span><span class=\"n\">naming</span><span class=\"w\"> </span><span class=\"n\">scheme</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">possible</span><span class=\"bp\">.</span>\n<span class=\"n\">note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"ss\">`set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">docPrime</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"bp\">`</span>\n</code></pre></div>\n<p>suggests something is weird in your repository. Running <code>lake update &amp;&amp; lake clean &amp;&amp; lake exe cache get &amp;&amp; lake exe aoc-2024</code>, at least the warnings go away. (But there is still a segfault.)</p>",
        "id": 486199257,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733356413
    },
    {
        "content": "<p>After that, the way to get a stack trace on MacOS is:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"n\">lldb</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">aoc</span><span class=\"bp\">-</span><span class=\"mi\">2024</span>\n</code></pre></div>",
        "id": 486199418,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733356504
    },
    {
        "content": "<p>(and then type <code>run</code> when you get to the lldb prompt...)</p>",
        "id": 486199438,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733356526
    },
    {
        "content": "<p>We get:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"n\">lldb</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">aoc</span><span class=\"bp\">-</span><span class=\"mi\">2024</span>\n<span class=\"o\">(</span><span class=\"n\">lldb</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">create</span><span class=\"w\"> </span><span class=\"s2\">\".lake/build/bin/aoc-2024\"</span>\n<span class=\"n\">Current</span><span class=\"w\"> </span><span class=\"n\">executable</span><span class=\"w\"> </span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"bp\">'/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">kim</span><span class=\"bp\">/</span><span class=\"n\">scratch</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">aoc</span><span class=\"bp\">-</span><span class=\"mi\">2024</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">aoc</span><span class=\"bp\">-</span><span class=\"mi\">2024</span><span class=\"bp\">'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">arm64</span><span class=\"o\">)</span><span class=\"bp\">.</span>\n<span class=\"o\">(</span><span class=\"n\">lldb</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">run</span>\n<span class=\"n\">Process</span><span class=\"w\"> </span><span class=\"mi\">13072</span><span class=\"w\"> </span><span class=\"n\">launched</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">'/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">kim</span><span class=\"bp\">/</span><span class=\"n\">scratch</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">aoc</span><span class=\"bp\">-</span><span class=\"mi\">2024</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">aoc</span><span class=\"bp\">-</span><span class=\"mi\">2024</span><span class=\"bp\">'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">arm64</span><span class=\"o\">)</span>\n<span class=\"n\">Process</span><span class=\"w\"> </span><span class=\"mi\">13072</span><span class=\"w\"> </span><span class=\"n\">stopped</span>\n<span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">queue</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">com</span><span class=\"bp\">.</span><span class=\"n\">apple</span><span class=\"bp\">.</span><span class=\"n\">main</span><span class=\"bp\">-</span><span class=\"n\">thread'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">stop</span><span class=\"w\"> </span><span class=\"n\">reason</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">EXC_BAD_ACCESS</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">code</span><span class=\"bp\">=</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">address</span><span class=\"bp\">=</span><span class=\"mi\">0</span><span class=\"n\">xf500000000000000</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">frame</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">x000000010086958c</span><span class=\"w\"> </span><span class=\"n\">aoc</span><span class=\"bp\">-</span><span class=\"mi\">2024</span><span class=\"ss\">`_init_l_Aesop_Frontend_Feature_elab___closed__7</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">28</span>\n<span class=\"n\">aoc</span><span class=\"bp\">-</span><span class=\"mi\">2024</span><span class=\"bp\">`</span><span class=\"o\">:</span>\n<span class=\"bp\">-&gt;</span><span class=\"w\">  </span><span class=\"mi\">0</span><span class=\"n\">x10086958c</span><span class=\"w\"> </span><span class=\"bp\">&lt;+</span><span class=\"mi\">28</span><span class=\"bp\">&gt;</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ldr</span><span class=\"w\">    </span><span class=\"n\">w8</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">x19</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"n\">x100869590</span><span class=\"w\"> </span><span class=\"bp\">&lt;+</span><span class=\"mi\">32</span><span class=\"bp\">&gt;</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cmp</span><span class=\"w\">    </span><span class=\"n\">w8</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">0</span><span class=\"n\">x1</span>\n<span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"n\">x100869594</span><span class=\"w\"> </span><span class=\"bp\">&lt;+</span><span class=\"mi\">36</span><span class=\"bp\">&gt;</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"bp\">.</span><span class=\"n\">lt</span><span class=\"w\">   </span><span class=\"mi\">0</span><span class=\"n\">x1008695b0</span><span class=\"w\">               </span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"bp\">&lt;+</span><span class=\"mi\">64</span><span class=\"bp\">&gt;</span>\n<span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"n\">x100869598</span><span class=\"w\"> </span><span class=\"bp\">&lt;+</span><span class=\"mi\">40</span><span class=\"bp\">&gt;</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">add</span><span class=\"w\">    </span><span class=\"n\">w8</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">w8</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">0</span><span class=\"n\">x1</span>\n<span class=\"n\">Target</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">aoc</span><span class=\"bp\">-</span><span class=\"mi\">2024</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">stopped</span><span class=\"bp\">.</span>\n<span class=\"o\">(</span><span class=\"n\">lldb</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">bt</span>\n<span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">queue</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">com</span><span class=\"bp\">.</span><span class=\"n\">apple</span><span class=\"bp\">.</span><span class=\"n\">main</span><span class=\"bp\">-</span><span class=\"n\">thread'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">stop</span><span class=\"w\"> </span><span class=\"n\">reason</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">EXC_BAD_ACCESS</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">code</span><span class=\"bp\">=</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">address</span><span class=\"bp\">=</span><span class=\"mi\">0</span><span class=\"n\">xf500000000000000</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">frame</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">x000000010086958c</span><span class=\"w\"> </span><span class=\"n\">aoc</span><span class=\"bp\">-</span><span class=\"mi\">2024</span><span class=\"ss\">`_init_l_Aesop_Frontend_Feature_elab___closed__7</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">28</span>\n<span class=\"w\">    </span><span class=\"n\">frame</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">x0000000100866870</span><span class=\"w\"> </span><span class=\"n\">aoc</span><span class=\"bp\">-</span><span class=\"mi\">2024</span><span class=\"ss\">`initialize_Aesop_Frontend_RuleExpr</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">8936</span>\n<span class=\"w\">    </span><span class=\"n\">frame</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">x0000000100886f28</span><span class=\"w\"> </span><span class=\"n\">aoc</span><span class=\"bp\">-</span><span class=\"mi\">2024</span><span class=\"ss\">`initialize_Aesop_Frontend_Tactic</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">140</span>\n<span class=\"w\">    </span><span class=\"n\">frame</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">3</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">x0000000100898c00</span><span class=\"w\"> </span><span class=\"n\">aoc</span><span class=\"bp\">-</span><span class=\"mi\">2024</span><span class=\"ss\">`initialize_Aesop_Main</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">176</span>\n<span class=\"w\">    </span><span class=\"n\">frame</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">x00000001009585b4</span><span class=\"w\"> </span><span class=\"n\">aoc</span><span class=\"bp\">-</span><span class=\"mi\">2024</span><span class=\"ss\">`initialize_Aesop</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">124</span>\n<span class=\"w\">    </span><span class=\"n\">frame</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">5</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">x0000000100b21cc8</span><span class=\"w\"> </span><span class=\"n\">aoc</span><span class=\"bp\">-</span><span class=\"mi\">2024</span><span class=\"ss\">`initialize_Mathlib_Algebra_Group_Basic</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">124</span>\n<span class=\"w\">    </span><span class=\"n\">frame</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">6</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">x0000000100c15668</span><span class=\"w\"> </span><span class=\"n\">aoc</span><span class=\"bp\">-</span><span class=\"mi\">2024</span><span class=\"ss\">`initialize_Mathlib_Algebra_Group_Units_Basic</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">124</span>\n<span class=\"w\">    </span><span class=\"n\">frame</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">7</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">x0000000100da966c</span><span class=\"w\"> </span><span class=\"n\">aoc</span><span class=\"bp\">-</span><span class=\"mi\">2024</span><span class=\"ss\">`initialize_Mathlib_Algebra_Order_Monoid_Canonical_Defs</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">124</span>\n<span class=\"w\">    </span><span class=\"n\">frame</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">8</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">x0000000100da9978</span><span class=\"w\"> </span><span class=\"n\">aoc</span><span class=\"bp\">-</span><span class=\"mi\">2024</span><span class=\"ss\">`initialize_Mathlib_Algebra_Order_Group_Nat</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">176</span>\n<span class=\"w\">    </span><span class=\"n\">frame</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">x0000000101902ad0</span><span class=\"w\"> </span><span class=\"n\">aoc</span><span class=\"bp\">-</span><span class=\"mi\">2024</span><span class=\"ss\">`initialize_Mathlib_Algebra_Order_Ring_Nat</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">132</span>\n<span class=\"w\">    </span><span class=\"n\">frame</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">10</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">x0000000101903d40</span><span class=\"w\"> </span><span class=\"n\">aoc</span><span class=\"bp\">-</span><span class=\"mi\">2024</span><span class=\"ss\">`initialize_Mathlib_Data_Nat_Dist</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">124</span>\n<span class=\"w\">    </span><span class=\"n\">frame</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">11</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">x000000010190493c</span><span class=\"w\"> </span><span class=\"n\">aoc</span><span class=\"bp\">-</span><span class=\"mi\">2024</span><span class=\"ss\">`initialize_Aoc2024_Day2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">168</span>\n<span class=\"w\">    </span><span class=\"n\">frame</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">12</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">x0000000100000cf4</span><span class=\"w\"> </span><span class=\"n\">aoc</span><span class=\"bp\">-</span><span class=\"mi\">2024</span><span class=\"ss\">`initialize_Main</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">168</span>\n<span class=\"w\">    </span><span class=\"n\">frame</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">13</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">x0000000100000de0</span><span class=\"w\"> </span><span class=\"n\">aoc</span><span class=\"bp\">-</span><span class=\"mi\">2024</span><span class=\"ss\">`main</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">32</span>\n<span class=\"w\">    </span><span class=\"n\">frame</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"mi\">14</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">x000000019990f154</span><span class=\"w\"> </span><span class=\"n\">dyld</span><span class=\"ss\">`start</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2476</span>\n<span class=\"o\">(</span><span class=\"n\">lldb</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 486199470,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733356539
    },
    {
        "content": "<p>which is really not your fault. :-)</p>",
        "id": 486199516,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733356562
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"256311\">@Jannis Limperg</span>, <span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span>, I can reproduce this just in Aesop; any executable with <code>import Aesop</code> will segfault during initialization.</p>",
        "id": 486200907,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733357348
    },
    {
        "content": "<p>Repro at <a href=\"https://github.com/leanprover-community/aesop/pull/182\">https://github.com/leanprover-community/aesop/pull/182</a></p>",
        "id": 486201626,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733357791
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"739332\">@Philogy</span>, thanks for reporting this! We will get this fixed asap.</p>",
        "id": 486201930,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733357988
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/287929-mathlib4/topic/No.20Error.2FSegfault.20when.20importing.20mathlib/near/486201930\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"739332\">Philogy</span>, thanks for reporting this! We will get this fixed asap.</p>\n</blockquote>\n<p>Thanks for looking into this! <span aria-label=\"folded hands\" class=\"emoji emoji-1f64f\" role=\"img\" title=\"folded hands\">:folded_hands:</span></p>",
        "id": 486229172,
        "sender_full_name": "Philogy",
        "timestamp": 1733376521
    },
    {
        "content": "<p>I believe I'm running into this same issue, so looking forward to a fix</p>",
        "id": 486249699,
        "sender_full_name": "Greg Shuflin",
        "timestamp": 1733387380
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/287929-mathlib4/topic/No.20Error.2FSegfault.20when.20importing.20mathlib/near/486201626\">said</a>:</p>\n<blockquote>\n<p>Repro at <a href=\"https://github.com/leanprover-community/aesop/pull/182\">https://github.com/leanprover-community/aesop/pull/182</a></p>\n</blockquote>\n<p>As commented on the PR this is unfortunately one of the issues we would usually tag with depends on new code generator :(</p>",
        "id": 486257561,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1733390224
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"395550\">@Henrik Böving</span>, how does one disable the closed term extractor?</p>",
        "id": 486260096,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733391017
    },
    {
        "content": "<p><code>set_option compiler.extract_closed false</code> above the definition in question</p>",
        "id": 486260217,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1733391054
    },
    {
        "content": "<p>This workaround will be on Aesop master very shortly and will fix the segfault. Thanks for the report and investigation, everyone!</p>",
        "id": 486285196,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1733398915
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"256311\">Jannis Limperg</span> <a href=\"#narrow/channel/287929-mathlib4/topic/No.20Error.2FSegfault.20when.20importing.20mathlib/near/486285196\">said</a>:</p>\n<blockquote>\n<p>This workaround will be on Aesop master very shortly and will fix the segfault. Thanks for the report and investigation, everyone!</p>\n</blockquote>\n<p>what do I need to do to pull in this fix into my existing <code>lake</code> project?</p>",
        "id": 486412732,
        "sender_full_name": "Greg Shuflin",
        "timestamp": 1733441977
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">require</span><span class=\"w\"> </span><span class=\"s2\">\"leanprover-community\"</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"s2\">\"aesop\"</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"s2\">\"master\"</span>\n</code></pre></div>",
        "id": 486413316,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733442277
    },
    {
        "content": "<p>(Assuming you have a <code>lakefile.lean</code>. If it is <code>lakefile.toml</code> then something else. :-)</p>",
        "id": 486413344,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733442295
    },
    {
        "content": "<p>Alternatively, possibly just <code>lake update</code> later today if you acquire Aesop as a transitive dependency of Mathlib.</p>",
        "id": 486413523,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733442375
    },
    {
        "content": "<p>Is this new / mac-specific? I think I've had no issue compiling programs with Aesop on Linux in the past</p>",
        "id": 486413980,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733442603
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/287929-mathlib4/topic/No.20Error.2FSegfault.20when.20importing.20mathlib/near/486413523\">said</a>:</p>\n<blockquote>\n<p>Alternatively, possibly just <code>lake update</code> later today if you acquire Aesop as a transitive dependency of Mathlib.</p>\n</blockquote>\n<p>So, once <a href=\"https://github.com/leanprover-community/aesop/pull/182\">https://github.com/leanprover-community/aesop/pull/182</a> is merged, I should be able to run <code>lake update</code> and that will pull it in as a transitive dep of mathlib? I have a <code>lakefile.toml</code> file that has the dep:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">[[</span><span class=\"n\">require</span><span class=\"o\">]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"mathlib\"</span>\n<span class=\"n\">scope</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"leanprover-community\"</span>\n</code></pre></div>\n<p>no mention of Aesop.</p>\n<p>Btw, are lakefile.lean files deprecated in favor of lakefile.toml? Or is there a reason to prefer one or the other?</p>",
        "id": 486426944,
        "sender_full_name": "Greg Shuflin",
        "timestamp": 1733450937
    },
    {
        "content": "<p>or wait no <a href=\"https://github.com/leanprover-community/aesop/pull/183\">https://github.com/leanprover-community/aesop/pull/183</a> is the fix which seems to be merged. I just did <code>lake update</code> and I'm still getting the segfault after rebuilding</p>",
        "id": 486427137,
        "sender_full_name": "Greg Shuflin",
        "timestamp": 1733451087
    },
    {
        "content": "<p>so according to my lake-manifest.json, aesop is on commit 8b6048aa0a4a4b6bcf83597802d8dee734e64b7e, which is before the merged bugfix. mathlib4 has commit d070358a60c92d366214c49fa4731575a4c9d651 which looks like the latest on github. does there need to be an additional fix to mathlib4 to pull in the updated fix?</p>",
        "id": 486427382,
        "sender_full_name": "Greg Shuflin",
        "timestamp": 1733451252
    },
    {
        "content": "<p>I guess I could try manually adding an aesop dep. I'm not sure what lean currently does with different versions of transitive dependencies specified by different top-level dependencies</p>",
        "id": 486427441,
        "sender_full_name": "Greg Shuflin",
        "timestamp": 1733451307
    },
    {
        "content": "<p>huh:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">update</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">aesop</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">master</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">external</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">git'</span><span class=\"w\"> </span><span class=\"n\">exited</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mi\">128</span>\n</code></pre></div>\n<p>with that code change manually adding aesop</p>",
        "id": 486427548,
        "sender_full_name": "Greg Shuflin",
        "timestamp": 1733451373
    },
    {
        "content": "<p>ah I wanted <code>rev</code> not <code>git</code> I think, according to <a href=\"https://github.com/leanprover/lean4/blob/master/src/lake/README.md\">https://github.com/leanprover/lean4/blob/master/src/lake/README.md</a></p>",
        "id": 486427742,
        "sender_full_name": "Greg Shuflin",
        "timestamp": 1733451530
    },
    {
        "content": "<p>Mathlib will update when <a href=\"https://github.com/leanprover-community/mathlib4/pull/19758\">#19758</a> lands. (Our auto-updater broker because I \"cleverly\" pinned the Aesop dependency to the <code>v4.15.0-rc1</code> to make the Mathlib <code>v4.15.0-rc1</code> tag.)</p>",
        "id": 486445053,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733463854
    },
    {
        "content": "<p>Looks like the change got merged into <code>mathlib</code> as well, after <code>lake update</code> things seem to work now.</p>",
        "id": 486469841,
        "sender_full_name": "Philogy",
        "timestamp": 1733476368
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/No.20Error.2FSegfault.20when.20importing.20mathlib/near/486413980\">said</a>:</p>\n<blockquote>\n<p>Is this new / mac-specific? I think I've had no issue compiling programs with Aesop on Linux in the past</p>\n</blockquote>\n<p>I reproduced on Linux. It shouldn't be platform-specific since the Lean IR already contains the incorrect array access. I don't know how long this bug has been lurking.</p>",
        "id": 486502964,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1733487996
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"739332\">Philogy</span> has marked this topic as resolved.</p>",
        "id": 486759088,
        "sender_full_name": "Notification Bot",
        "timestamp": 1733655277
    }
]