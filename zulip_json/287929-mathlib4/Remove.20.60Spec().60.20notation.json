[
    {
        "content": "<p>Continuing the trend of notation bikesheding, I am planning to remove the usage of <code>Spec()</code> notation in mathlib in <a href=\"https://github.com/leanprover-community/mathlib4/pull/30272\">#30272</a>. It will be kept as a scoped notation so that down stream projects could still use it if they prefer to.<br>\nThe reason being</p>\n<ol>\n<li>It is really confusing that <code>Spec(R)</code> and <code>Spec (R)</code> have different meanings.</li>\n<li>It hides <code>CommRingCat.of</code>, which is often the source of <code>erw</code> errors and other confusing behaviour.</li>\n<li>It makes people erronously write <code>Spec (.of R)</code> for <code>R : CommRingCat</code> more easily. </li>\n<li>It doesn't have much benefit to outweigh the downsides listed above. <code>Spec (.of R)</code> is a perfectly fine \"vanilla\" lean syntax that isn't really much longer or harder to read than <code>Spec(R)</code>.</li>\n</ol>",
        "id": 543355075,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1759765804
    },
    {
        "content": "<p>and I will <a href=\"#narrow/channel/116395-maths/topic/Projective.20Space/near/543349164\">continue to disagree</a>, I think the fact that it's very close to maths notation is a huge benefit for readability, and I think we should know that <code>ident(</code> is always special notation because real brackets require a space before. I really don't think this is a good diff to see:</p>\n<p><a href=\"/user_uploads/3121/f9fEkuNas2yaCsEWFph_EEOX/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/f9fEkuNas2yaCsEWFph_EEOX/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"564x707\" src=\"/user_uploads/thumbnail/3121/f9fEkuNas2yaCsEWFph_EEOX/image.png/840x560.webp\"></a></div>",
        "id": 543417429,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759789656
    },
    {
        "content": "<p>Can <code>of</code> be a coercion?</p>",
        "id": 543417514,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759789712
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- The object in the category of R-algebras associated to a type equipped with the appropriate</span>\n<span class=\"sd\">typeclasses. This is the preferred way to construct a term of `CommRingCat`. -/</span>\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CommRingCat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">⟨</span><span class=\"n\">R</span><span class=\"bp\">⟩</span>\n</code></pre></div>\n<p>Can an <code>abbrev</code> be a coercion?</p>",
        "id": 543417744,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1759789869
    },
    {
        "content": "<p>and for more context, as discussed in the thread I linked to, I wish to eventually make <code>Proj(R)</code> a notation as well, which takes in a ring <code>R</code> with a <strong>canonical</strong> graded structure. (Recall that <code>Proj</code> really takes a grading, which for now is a term of type <code>ℕ → Submodule R A</code>.)</p>\n<p>Then, the problem here is that if mathlib decides it doesn't want <code>Proj(R)</code> as well, seeking an alternative such as <code>Spec (.of R)</code> would be impossible, because the input that <code>Proj</code> takes has type <code>Function</code>, and nobody in their right mind would name the function that returns the canonical graded structure of a ring as <code>Function.of</code>, so there's no <code>Proj (.of R)</code> alternative available.</p>\n<p>The alternative here would be something like <code>Proj (Graded.of R)</code> (ideally), which is much longer than <code>Proj(R)</code>, and <code>Graded.of</code> still looks a bit off because there is no such structure/class called <code>Graded</code> (and once again it is actually a <code>Function</code>).</p>",
        "id": 543417950,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759789999
    },
    {
        "content": "<p>As I stressed above, I don't think hiding <code>of</code> by the removal of a space it is the right call because it is a important implementation detail (not as in it is mathematical important but as in it bites you if you are not careful).<br>\nI would be open to a proposal of a notation for <code>of</code> although I personally find nothing wrong with <code>of</code>. Something that looks weird and signals something odd is going on like the coe sort arrow <code>↥</code>.</p>",
        "id": 543418116,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1759790118
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Remove.20.60Spec.28.29.60.20notation/near/543417429\">said</a>:</p>\n<blockquote>\n<p><code>ident(</code> is always special notation</p>\n</blockquote>\n<p>To elaborate on this point, note how the colour changes:<br>\n<a href=\"/user_uploads/3121/o2bDYzKuHBacNd-MGpEHD7JS/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/o2bDYzKuHBacNd-MGpEHD7JS/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"595x307\" src=\"/user_uploads/thumbnail/3121/o2bDYzKuHBacNd-MGpEHD7JS/image.png/840x560.webp\"></a></div>",
        "id": 543418367,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759790287
    },
    {
        "content": "<p><em>Is</em> it an important implementation detail? I mostly find it to be an annoyance that I-as-library-user can't really do anything about, so it should be covered up by the API as much as possible. The actual <em>solution</em> to most problems involving <code>of</code> tend to require me hiking back to whatever underlying bit of Mathlib in code I didn't write and redefining things to have exactly the right spelling of accepts-a-bundled-object vs. accepts-a-type-and-type-class vs. outright defining defs that refer to bundled objects as abbrevs to defs that refer to the unbundled types, rather than something I can address by redesigning 'my' code further down the import tree.</p>",
        "id": 543418863,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1759790636
    },
    {
        "content": "<p>I've been wrestling with this in <code>TopCat</code> for a while now and it's absolutely not the case that <code>of</code> does very much for me other than add mental noise.</p>",
        "id": 543418912,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1759790680
    },
    {
        "content": "<p>I've made <a href=\"https://github.com/leanprover-community/mathlib4/pull/30285\">#30285</a> to document the new changes in the docstring of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AlgebraicGeometry.Spec#doc\">docs#AlgebraicGeometry.Spec</a> .</p>",
        "id": 543418917,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759790686
    },
    {
        "content": "<p>I agree we should add API to ease the transition from unbundled to bundled, but I don't think hiding it in a notation is API. I am happy to hide it once automation can make the transition seamless, but before that, it is a useful to have the distinction present to signify and remind the user to do the transition by hand.</p>",
        "id": 543419534,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1759791139
    },
    {
        "content": "<p>It's less about making automation that makes the transition seamless, and more about making the existing definitions in such a way that existing automation can handle it seamlessly. Again, there's not much that a Mathlib user can actually do about, for a concrete example, the fact that <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=TopCat.sigmaIsoSigma#doc\">docs#TopCat.sigmaIsoSigma</a> is missing an <code>of</code> and therefore doesn't play well with unbundled objects on the left, except go and edit Mathlib; that says to me that this should be essentially an 'implementation detail problem' that as much as possible should be invisible from outside the library.</p>",
        "id": 543419886,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1759791422
    },
    {
        "content": "<p>let me make a reference to another good notation in the AG library, which is <code>⁻¹ᵁ</code> and <code>''ᵁ</code>. you'll never be able to guess what they actually stand for, but they make statements look much cleaner and easier to read.</p>\n<ul>\n<li><code>f ⁻¹ᵁ U</code> is notation for <code>(Opens.map f.base).obj U</code>, the preimage of an open set <code>U</code> under <code>f</code>.</li>\n</ul>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/blob/70adeca95169a95af5987779ff931e095b213197/Mathlib/AlgebraicGeometry/OpenImmersion.lean#L84-L85\">https://github.com/leanprover-community/mathlib4/blob/70adeca95169a95af5987779ff931e095b213197/Mathlib/AlgebraicGeometry/OpenImmersion.lean#L84-L85</a>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- `f ''ᵁ U` is notation for the image (as an open set) of `U` under an open immersion `f`. -/</span>\n<span class=\"kn\">scoped</span><span class=\"o\">[</span><span class=\"n\">AlgebraicGeometry</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">notation3</span><span class=\"o\">:</span><span class=\"mi\">90</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">:</span><span class=\"mi\">91</span><span class=\"w\"> </span><span class=\"s2\">\" ''ᵁ \"</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"o\">:</span><span class=\"mi\">90</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Scheme</span><span class=\"bp\">.</span><span class=\"n\">Hom</span><span class=\"bp\">.</span><span class=\"n\">opensFunctor</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"n\">U</span>\n</code></pre></div>\n<p>and on top of that, the lemmas referring to them actually call them <code>image</code> and <code>preimage</code> in the name of the theorem, which to me is another sign of good notation API happening</p>",
        "id": 543419950,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759791456
    },
    {
        "content": "<p>and actually I did have trouble finding out what they actually are (when I needed to build more API) but i didn't mind that drawback</p>",
        "id": 543420058,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759791537
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"439483\">Andrew Yang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Remove.20.60Spec.28.29.60.20notation/near/543419534\">said</a>:</p>\n<blockquote>\n<p>I agree we should add API to ease the transition from unbundled to bundled, but I don't think hiding it in a notation is API.</p>\n</blockquote>\n<p>I think we should have enough API (if we don't already) so that we can just work with <code>Spec(R)</code> and forget that it ever stood for <code>Spec (.of R)</code>. What are some deficiencies in this part that you've experienced?</p>",
        "id": 543420217,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759791656
    },
    {
        "content": "<p>(you usually don't rewrite types)</p>",
        "id": 543420285,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759791686
    },
    {
        "content": "<p>The fact that you are able to locate the fact that <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=TopCat.sigmaIsoSigma#doc\">docs#TopCat.sigmaIsoSigma</a> is missing an <code>of</code> is in part because if there is an <code>of</code> it will show up.</p>",
        "id": 543420287,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1759791689
    },
    {
        "content": "<p>(and I also don't see why <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=TopCat.sigmaIsoSigma#doc\">docs#TopCat.sigmaIsoSigma</a> should have an <code>of</code> on the left but this is off topic)</p>",
        "id": 543420312,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1759791713
    },
    {
        "content": "<p>I think that one deficiency might be how <code>Spec.map</code> takes <code>CommRingCat.ofHom</code>, to which... we should have <code>Spec.map(</code> as well</p>",
        "id": 543420339,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759791729
    },
    {
        "content": "<p>(btw surely it should be <code>spec</code>?)</p>",
        "id": 543420703,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759791974
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Remove.20.60Spec.28.29.60.20notation/near/543420703\">said</a>:</p>\n<blockquote>\n<p>(btw surely it should be <code>spec</code>?)</p>\n</blockquote>\n<p>The capitalization conventions don't apply when the name is always used in a specific spelling in the literature. In this case, Spec is never written spec.</p>",
        "id": 543422480,
        "sender_full_name": "Christian Merten",
        "timestamp": 1759793284
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Remove.20.60Spec.28.29.60.20notation/near/543420339\">said</a>:</p>\n<blockquote>\n<p>I think that one deficiency might be how <code>Spec.map</code> takes <code>CommRingCat.ofHom</code>, to which... we should have <code>Spec.map(</code> as well</p>\n</blockquote>\n<p>No, for this the correct fix is to rename <code>CommRingCat.ofHom</code> to <code>CommRingCat.Hom.of</code>.</p>",
        "id": 543422524,
        "sender_full_name": "Christian Merten",
        "timestamp": 1759793326
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"648495\">@Christian Merten</span>, <span class=\"user-mention\" data-user-id=\"439483\">@Andrew Yang</span>, would you be happy if we made <code>Spec(R)</code> an elaborator that automatically checked whether <code>R : CommRingCat</code> or <code>R : Type _</code> and applies <code>.of</code> accordingly? This is perfectly possibly, I simply hadn't done it because I am satisfied with the simpler statu quo, but clearly you are not.</p>",
        "id": 543560378,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1759850602
    },
    {
        "content": "<p>how will that fix the \"confusing error messages\" that andrew is referring to</p>",
        "id": 543560640,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759850659
    },
    {
        "content": "<p>I have no idea what these error messages are. I have never encountered them myself</p>",
        "id": 543561417,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1759850825
    },
    {
        "content": "<p>me neither, but that's because I <em>know</em> that Spec(R) is Spec (.of R), so maybe I'm not in the targeted audience of Andrew's explanations</p>",
        "id": 543562082,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759850985
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Remove.20.60Spec.28.29.60.20notation/near/543417744\">said</a>:</p>\n<blockquote>\n<p>Can an <code>abbrev</code> be a coercion?</p>\n</blockquote>\n<p>Coercions don't even need a function, you can just inline the coercion into the <code>Coe</code> instance as an arbitrary expression</p>",
        "id": 543562192,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759851011
    },
    {
        "content": "<p>Let me take Andrew's original message apart and apply my suggestion to it:<br>\n<span class=\"user-mention silent\" data-user-id=\"439483\">Andrew Yang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Remove.20.60Spec.28.29.60.20notation/near/543355075\">said</a>:</p>\n<blockquote>\n<ol>\n<li>It is really confusing that <code>Spec(R)</code> and <code>Spec (R)</code> have different meanings.</li>\n</ol>\n</blockquote>\n<p>First, I don't find this really confusing. In the context of Lean 4, people have been repeatedly made aware that spaces before brackets are really important: eg we didn't scrap the <code>congr()</code> elaborator because <code>congr</code> could mean something else.<br>\nSecond, with my suggestion, <code>Spec R</code> would still be valid syntax for <code>R : CommRingCat</code>, but we would encourage contributors to use <code>Spec(R)</code>.</p>\n<blockquote>\n<ol start=\"2\">\n<li>It hides <code>CommRingCat.of</code>, which is often the source of <code>erw</code> errors and other confusing behaviour.</li>\n</ol>\n</blockquote>\n<p>With my suggestion, it would not hide any <em>unnecessary</em> <code>CommRingCat.of</code>, which I believe are the actual source of the <code>erw</code> errors you mention. Of course, it is impossible to be sure without you giving us a concrete example.</p>\n<blockquote>\n<ol start=\"3\">\n<li>It makes people erronously write <code>Spec (.of R)</code> for <code>R : CommRingCat</code> more easily.</li>\n</ol>\n</blockquote>\n<p>With my suggestion, <code>Spec(R)</code> would never introduce <code>Spec (.of R)</code> in the expression for <code>R : CommRingCat</code>.</p>\n<blockquote>\n<ol start=\"4\">\n<li>It doesn't have much benefit to outweigh the downsides listed above. <code>Spec (.of R)</code> is a perfectly fine \"vanilla\" lean syntax that isn't really much longer or harder to read than <code>Spec(R)</code>.</li>\n</ol>\n</blockquote>\n<p>It has for me the so far unparalleled benefits that (not even so) large goals involving <code>Spec (CommRingCat.of R)</code> move from the \"unreadable, <span aria-label=\"warning\" class=\"emoji emoji-26a0\" role=\"img\" title=\"warning\">:warning:</span> brain panic <span aria-label=\"warning\" class=\"emoji emoji-26a0\" role=\"img\" title=\"warning\">:warning:</span>\" zone to the \"readable, I know how to prove this\" one.</p>\n<p><code>Spec (.of R)</code> is short to read <em>in the source code</em>, but not in the infoview. This is, I believe, why our opinions diverge.</p>\n<p>In the future, maybe Lean will delaborate to uses of anonymous dot notation, so that <code>Spec (CommRingCat.of R)</code> actually delaborates as <code>Spec (.of R)</code>. If such a change to delaboration occurred, I would agree that the <code>Spec(R)</code> notation would be significantly less useful (but IMO still useful enough that we should use it).</p>",
        "id": 543564048,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1759851465
    },
    {
        "content": "<p>My coercion suggestion is to show <code>Spec ↑R</code> when <code>R</code> is a type, and <code>Spec R</code> when <code>R : CommRingCat</code></p>",
        "id": 543568143,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759852543
    },
    {
        "content": "<p>Or perhaps to declare a new special arrow as a delaborator for category-theoretic <code>of</code>, since it's sort of the reverse of <code>coeSort</code></p>",
        "id": 543568232,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759852567
    },
    {
        "content": "<p>so clearly it's <code>↓</code></p>",
        "id": 543568325,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759852589
    },
    {
        "content": "<p>I was thinking <code>⤒</code> or  <code>⤓</code> or <code>↧</code> (which are all dual to <code>↥</code>)</p>",
        "id": 543568464,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759852632
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Remove.20.60Spec.28.29.60.20notation/near/543560378\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"648495\">Christian Merten</span>, <span class=\"user-mention silent\" data-user-id=\"439483\">Andrew Yang</span>, would you be happy if we made <code>Spec(R)</code> an elaborator that automatically checked whether <code>R : CommRingCat</code> or <code>R : Type _</code> and applies <code>.of</code> accordingly? This is perfectly possibly, I simply hadn't done it because I am satisfied with the simpler statu quo, but clearly you are not.</p>\n</blockquote>\n<p>This would be much better than the old notation, but it still hides whether <code>R : Type _</code> or <code>R : CommRingCat</code>. For me, this is a readability loss, because I can't immediately see if there is a <code>.of</code> or there is none.</p>",
        "id": 543569300,
        "sender_full_name": "Christian Merten",
        "timestamp": 1759852848
    },
    {
        "content": "<p>I agree that seeing <code>Spec (CommRingCat.of R)</code> in the infoview can be annoying, but if we wanted to specifically fix this, we could have a delaborator that makes this pretty-print as <code>Spec (.of R)</code> instead.</p>",
        "id": 543569605,
        "sender_full_name": "Christian Merten",
        "timestamp": 1759852927
    },
    {
        "content": "<p>The advantage with Eric's suggestion is that the distinction between <code>R : Type _</code> and <code>R : CommRingCat</code> stays visible, but I am not sure this has to be done with a coercion. It could as well be a delaborator.</p>",
        "id": 543570052,
        "sender_full_name": "Christian Merten",
        "timestamp": 1759853046
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"648495\">@Christian Merten</span> what if we renamed <code>Spec</code> into <code>Spectrum</code> and kept <code>Spec(R)</code>?</p>",
        "id": 543570104,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759853060
    },
    {
        "content": "<p>So every name becomes longer, we no longer use the standard literature name and we still have all the disadvantages of the <code>Spec(R)</code> notation?</p>",
        "id": 543570308,
        "sender_full_name": "Christian Merten",
        "timestamp": 1759853124
    },
    {
        "content": "<p>actually why does Spec take a CommRingCat in the first place?</p>",
        "id": 543570889,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759853302
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"648495\">Christian Merten</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Remove.20.60Spec.28.29.60.20notation/near/543570308\">said</a>:</p>\n<blockquote>\n<p>So every name becomes longer, we no longer use the standard literature name</p>\n</blockquote>\n<p>we can still use <code>Spec</code> namespace</p>\n<blockquote>\n<p>we still have all the disadvantages of the <code>Spec(R)</code> notation?</p>\n</blockquote>\n<p>one of the main disadvantages brought up was \"confusing notation\", now that Spec(R) and Spectrum (.of R) are very different, there should be no more confusion</p>",
        "id": 543571194,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759853380
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"648495\">Christian Merten</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Remove.20.60Spec.28.29.60.20notation/near/543570052\">said</a>:</p>\n<blockquote>\n<p>The advantage with Eric's suggestion is that the distinction between <code>R : Type _</code> and <code>R : CommRingCat</code> stays visible, but I am not sure this has to be done with a coercion. It could as well be a delaborator.</p>\n</blockquote>\n<p>Remember that coercions have two pieces; the delaborator via <code>@[coe]</code> and the auto-insertion via <code>instance</code>. My proposal is to use the latter and write a custom delaborator in place of the former</p>",
        "id": 543575247,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759854524
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Remove.20.60Spec.28.29.60.20notation/near/543575247\">said</a>:</p>\n<blockquote>\n<p>Remember that coercions have two pieces; the delaborator via <code>@[coe]</code> and the auto-insertion via <code>instance</code>. My proposal is to use the latter and write a custom delaborator in place of the former</p>\n</blockquote>\n<p>From what I gathered from this thread is that the main concern of the proponents of the <code>Spec(R)</code> notation is how <code>Spec (.of R)</code> is pretty-printed. So I don't think we need the auto-insertion of the coercion.</p>",
        "id": 543576107,
        "sender_full_name": "Christian Merten",
        "timestamp": 1759854773
    },
    {
        "content": "<p>Would <code>prefix:max \"↧\" =&gt; CommRingCat.of</code>be a good middle ground?</p>",
        "id": 543578357,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1759855443
    },
    {
        "content": "<p>well then people will say that TopCat.of also wants that notation</p>",
        "id": 543578562,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759855510
    },
    {
        "content": "<p>Scoped to <code>AlgebraicGeometry</code>? I would not know why <code>CommRingCat</code> should in general deserve special treatment</p>",
        "id": 543578575,
        "sender_full_name": "Christian Merten",
        "timestamp": 1759855513
    },
    {
        "content": "<p>I think as suggested before ↧ should mean \"look at the expected type, find the .of function, and apply it\"</p>",
        "id": 543578739,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759855564
    },
    {
        "content": "<p>and then we should have <code>Spec ↧R</code></p>",
        "id": 543578773,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759855574
    },
    {
        "content": "<p>In the long run we probably should give that notation to <code>CategoryTheory.ToType</code> and switch to that everywhere. But I'm just asking if people would be happy about such a notation in this context.</p>",
        "id": 543578809,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1759855586
    },
    {
        "content": "<p>I guess I can stand behind <code>Spec ↧R</code></p>",
        "id": 543578920,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759855620
    },
    {
        "content": "<p>Note that <code>↥</code> is not notation for <code>coeSort</code> any more, but a generic delaborator for arbitrary coercions to sort</p>",
        "id": 543581454,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759856338
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"439483\">Andrew Yang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Remove.20.60Spec.28.29.60.20notation/near/543578357\">said</a>:</p>\n<blockquote>\n<p>Would <code>prefix:max \"↧\" =&gt; CommRingCat.of</code>be a good middle ground?</p>\n</blockquote>\n<p>I think this would be good enough until we need it for a second category (any idea when that would happen?)</p>",
        "id": 544291147,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1760161663
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Remove.20.60Spec.28.29.60.20notation/near/544291147\">said</a>:</p>\n<blockquote>\n<p>we need it for a second category</p>\n</blockquote>\n<p>right after that we discussed it already and we already had 2 suggestions</p>",
        "id": 544291197,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760161710
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Remove.20.60Spec.28.29.60.20notation/near/543578739\">said</a>:</p>\n<blockquote>\n<p>↧ should mean \"look at the expected type, find the .of function, and apply it\"</p>\n</blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"439483\">Andrew Yang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Remove.20.60Spec.28.29.60.20notation/near/543578809\">said</a>:</p>\n<blockquote>\n<p>In the long run we probably should give that notation to <code>CategoryTheory.ToType</code> and switch to that everywhere.</p>\n</blockquote>",
        "id": 544291222,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760161738
    },
    {
        "content": "<p>Kenny, I think your proposal might be what you get for free if you overload the notation</p>",
        "id": 544293486,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1760164155
    },
    {
        "content": "<p>what can i say, i love overloading notation</p>",
        "id": 544293582,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760164248
    },
    {
        "content": "<p>Aren't overloaded notations very bad performance-wise? From what I gather this situation is not exactly similar, but when the tensor product of objects and morphisms in a monoidal category were overloaded with same notations it was very bad.</p>",
        "id": 544295400,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1760166275
    },
    {
        "content": "<p>I think Andrew's solution is better regardless (but might require more refactoring)</p>",
        "id": 544295567,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760166427
    },
    {
        "content": "<p>The monoidal notation was <em>performant</em> but it had poor <em>unification</em></p>",
        "id": 544300670,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1760172032
    },
    {
        "content": "<p>That's not what I read from the <a href=\"https://github.com/leanprover-community/mathlib4/pull/25922#issuecomment-2974212778\">benchmark result for the PR</a>?<br>\nIt <em>also</em> had bad unification.</p>",
        "id": 544305452,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1760176063
    },
    {
        "content": "<p>maybe make it scoped</p>",
        "id": 544317950,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760186486
    },
    {
        "content": "<p>how many categories could you possibly be working with simultaneously</p>",
        "id": 544317983,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760186503
    },
    {
        "content": "<p>(I have no idea how many)</p>",
        "id": 544318000,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760186514
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"286014\">Robin Carlier</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Remove.20.60Spec.28.29.60.20notation/near/544305452\">said</a>:</p>\n<blockquote>\n<p>That's not what I read from the <a href=\"https://github.com/leanprover-community/mathlib4/pull/25922#issuecomment-2974212778\">benchmark result for the PR</a>?<br>\nIt <em>also</em> had bad unification.</p>\n</blockquote>\n<p>Oh right, I forgot about that <span aria-label=\"speak no evil\" class=\"emoji emoji-1f64a\" role=\"img\" title=\"speak no evil\">:speak_no_evil:</span></p>",
        "id": 544318159,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1760186623
    }
]