[
    {
        "content": "<p>I'm struggling to find a home for this lemma. find_home is not helpful. Any ideas?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"c1\">-- TODO: where is a good home for this lemma? minimal imports are</span>\n<span class=\"c1\">-- Mathlib.Analysis.Normed.{Group.Continuity, Ring.Basic}; #find_home! is not helpful</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">enorm_ofReal_of_nonneg</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ha</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">ENNReal</span><span class=\"bp\">.</span><span class=\"n\">ofReal</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">‖ₑ</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">a</span><span class=\"bp\">‖ₑ</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">enorm_of_nonneg</span><span class=\"w\"> </span><span class=\"n\">ha</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n</code></pre></div>",
        "id": 517783353,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1747129486
    },
    {
        "content": "<p><code>Mathlib.Analysis.Normed.Group.Basic</code>. This works: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">Normed</span><span class=\"bp\">.</span><span class=\"n\">Group</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">enorm_ofReal_of_nonneg</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ha</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">ENNReal</span><span class=\"bp\">.</span><span class=\"n\">ofReal</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">‖ₑ</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">a</span><span class=\"bp\">‖ₑ</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">enorm_of_nonneg</span><span class=\"w\"> </span><span class=\"n\">ha</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n</code></pre></div>\n<p>Presumably  your<code>simp</code> used a later lemma that wasn't needed.</p>",
        "id": 517868376,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1747151871
    },
    {
        "content": "<p>(Note: <code>simp [Real.enorm_of_nonneg, ha]</code> or <code>simp_rw [enorm_eq_self, Real.enorm_of_nonneg ha]</code> are also valid proofs)</p>",
        "id": 517868739,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1747151963
    },
    {
        "content": "<p>Oh, the issue with <code>#min_imports</code> is that if you import more, the statement uses the instance <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Real.normedCommRing#doc\">docs#Real.normedCommRing</a>, even though there are other ways to get an instance...</p>",
        "id": 517869775,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1747152206
    },
    {
        "content": "<p>Maybe we are missing a shortcut instance on <code>ℝ</code>?</p>",
        "id": 517871076,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1747152559
    },
    {
        "content": "<p>This issue of alternative paths found by instance-searches is recurring, but I do not really have a good way of avoiding it.  Maybe, adding a flag that computes the LUB of all constants contained in a declarations that do not correspond to instances could be useful?</p>",
        "id": 517946878,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1747183457
    },
    {
        "content": "<p>I've just convinced myself that the correct fix to have more shortcut instances. Let me check my prediction...</p>",
        "id": 517982552,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1747205132
    },
    {
        "content": "<p>Just brainstorming: </p>\n<ul>\n<li>it might be helpful to also have a command that does <code>#min_imports</code> but ignores all used instances. This will be an underestimate of the imports needed, but will often be right (it's not that common to use an instance from a file without using any lemma from it). </li>\n<li>If it also prints a list of used instances (+ the file they are declared in) that are not imported with this smaller set of imports, it's easy to add imports back.</li>\n<li>You could even imagine automatically going over all places where these now unimported instances are used, and run type-class inference trying to find an instance with the smaller set of imports.</li>\n</ul>\n<p>I'm not convinced that it's actually a good investment of time to write this, but that could be a way to deal with this. <br>\nI can imagine that it's not just type-class inference that causes <code>#min_imports</code> to overestimate the needed imports, but also something like <code>simp</code>, which could use lemmas that are not actually needed to simplify an expression.</p>",
        "id": 518051374,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1747225439
    },
    {
        "content": "<p>Thanks for all the answers, that was really helpful. (My PR is updated now.)</p>",
        "id": 518151378,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1747253785
    }
]