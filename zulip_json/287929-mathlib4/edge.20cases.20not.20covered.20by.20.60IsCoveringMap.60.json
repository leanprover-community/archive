[
    {
        "content": "<p>The inclusion of one of the points E = {x} into a two-point discrete space B = {x,y} is a covering map by the usual definition. However, it doesn't satisfy mathlib's <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsCoveringMap#doc\">docs#IsCoveringMap</a>, because y isn't <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsEvenlyCovered#doc\">docs#IsEvenlyCovered</a>: there doesn't exist the required <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Trivialization#doc\">docs#Trivialization</a> because the fiber F (= preimage of y) is empty, but E is not, so there is no map from E to B √ó F. I'm trying to figure out what's the best way to fix this. The current definition seems to originate from <a class=\"message-link\" href=\"/#narrow/channel/240192-Berkeley-Lean-Seminar/topic/Covering.20Spaces/near/288230415\">#Berkeley Lean Seminar &gt; Covering Spaces @ üí¨</a>, cc <span class=\"user-mention\" data-user-id=\"253861\">@Thomas Browning</span></p>",
        "id": 518413081,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1747349418
    },
    {
        "content": "<p>In some sense, is this an issue with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Trivialization%3F#doc\">docs#Trivialization?</a> <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Trivialization#doc\">docs#Trivialization</a> requires a map defined on all of <code>E</code>, even if the source ends up being empty?</p>",
        "id": 518416395,
        "sender_full_name": "Thomas Browning",
        "timestamp": 1747351607
    },
    {
        "content": "<p>Yeah you can trace this back to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Pretrivialization#doc\">docs#Pretrivialization</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=PartialHomeomorph#doc\">docs#PartialHomeomorph</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=PartialEquiv#doc\">docs#PartialEquiv</a>. These are used extensively in the manifold / differential geometry library though, and I wonder whether they'll find their category of fiber bundles etc. are missing some objects when they start considering such categories. (if the fiber is constant it should be okay though)</p>\n<p>I think the easiest fix is probably falling back to the <code>f ‚Åª¬π' {x} √ó U ‚âÉ‚Çú f ‚Åª¬π' U</code> definition.</p>",
        "id": 518416931,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1747351997
    },
    {
        "content": "<p>This is a consequence of the partial equivalence design, where you define it as two functions defined on the whole space which are inverses on this set, and please don't apply it to anywhere outside the set</p>",
        "id": 518416966,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1747352033
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"224323\">Junyan Xu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/edge.20cases.20not.20covered.20by.20.60IsCoveringMap.60/near/518416931\">said</a>:</p>\n<blockquote>\n<p>I think the easiest fix is probably falling back to the <code>f ‚Åª¬π' {x} √ó U ‚âÉ‚Çú f ‚Åª¬π' U</code> definition.</p>\n</blockquote>\n<p>Yeah, that's definitely the easiest short-term fix. But even for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=PartialEquiv#doc\">docs#PartialEquiv</a>, if <code>Œ±</code> is nonempty and <code>Œ≤</code> is empty, then under the current definition there is no partial equiv between the empty subsets, even through there technically ought to be.</p>",
        "id": 518417052,
        "sender_full_name": "Thomas Browning",
        "timestamp": 1747352082
    },
    {
        "content": "<p>You can always just use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=PEquiv#doc\">docs#PEquiv</a></p>",
        "id": 518417075,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1747352105
    },
    {
        "content": "<p>Going back and forth with <code>Option</code> may not be simpler than doing so with <code>Subtype</code>?</p>",
        "id": 518417117,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1747352146
    },
    {
        "content": "<p>There are lots of options (pun not intended)</p>",
        "id": 518417218,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1747352197
    },
    {
        "content": "<p>I'm not sure how I feel about <code>FunLike (Œ± ‚âÉ. Œ≤) Œ± (Option Œ≤)</code> though</p>",
        "id": 518417279,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1747352259
    },
    {
        "content": "<p>I'd argue using subtype/subspaces is the closest to mathematical practice.</p>",
        "id": 518417336,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1747352285
    },
    {
        "content": "<p>The issue is you have to provide a proof, though there are ways around this</p>",
        "id": 518417381,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1747352332
    },
    {
        "content": "<p>So would the ultimate refactor be to change <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=PartialHomeomorph#doc\">docs#PartialHomeomorph</a> to use a homeomorphism between two subtypes?</p>",
        "id": 518417397,
        "sender_full_name": "Thomas Browning",
        "timestamp": 1747352344
    },
    {
        "content": "<p>I think that would be a good idea, though I'd like to see some other opinions</p>",
        "id": 518417432,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1747352373
    },
    {
        "content": "<p>You could maybe still have a coercion to a global function in the case where Y is nonempty.</p>",
        "id": 518417446,
        "sender_full_name": "Thomas Browning",
        "timestamp": 1747352386
    },
    {
        "content": "<p>There are some notes about this in the module docstring for <a href=\"https://tqft.net/mathlib4files/Logic/Equiv/PartialEquiv\">file#Logic/Equiv/PartialEquiv</a></p>",
        "id": 518417531,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1747352430
    },
    {
        "content": "<p>We could still develop APIs for functions defined on sets, like <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearIndepOn#doc\">docs#LinearIndepOn</a>.</p>",
        "id": 518417556,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1747352445
    },
    {
        "content": "<p>I forgot why we chose to use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Trivialization#doc\">docs#Trivialization</a> to define IsCoveringMap ...<br>\n(but maybe we still want to use it after fixing it)</p>",
        "id": 518417596,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1747352469
    },
    {
        "content": "<p>Probably just because it's cleaner to reuse existing definitions</p>",
        "id": 518418094,
        "sender_full_name": "Thomas Browning",
        "timestamp": 1747352704
    },
    {
        "content": "<p>I came up with a minimally invasive fix in <a href=\"https://github.com/leanprover-community/mathlib4/pull/24983\">#24983</a>. The definition is switched to the standard one (<code>f ‚Åª¬π' {x} √ó U ‚âÉ‚Çú f ‚Åª¬π' U</code>), but I provide API to convert between the Trivialization formulation, so most proofs don't need to be changed. As a sanity check I proved that any map between two discrete spaces is a covering map.</p>",
        "id": 518862976,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1747522903
    }
]