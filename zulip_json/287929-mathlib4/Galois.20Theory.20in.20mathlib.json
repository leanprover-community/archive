[
    {
        "content": "<p>TLDR: Is the following the best way to say \"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>L</mi><mi mathvariant=\"normal\">/</mi><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">L/K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mord\">/</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span> is galois with galois group <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>G</mi></mrow><annotation encoding=\"application/x-tex\">G</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">G</span></span></span></span>, ring of integers <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>B</mi><mi mathvariant=\"normal\">/</mi><mi>A</mi></mrow><annotation encoding=\"application/x-tex\">B/A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord\">/</span><span class=\"mord mathnormal\">A</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span> is the fixed field of some <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>H</mi><mo>≤</mo><mi>G</mi></mrow><annotation encoding=\"application/x-tex\">H \\le G</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">G</span></span></span></span> with ring of integers <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span></span></span></span>\"?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">IsScalarTower</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsScalarTower</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">IsFractionRing</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsFractionRing</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MulSemiringAction</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MulSemiringAction</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">IsScalarTower</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">IsInvariant</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">IsInvariant</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">SMulCommClass</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SMulCommClass</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsScalarTower</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsScalarTower</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsFractionRing</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsScalarTower</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsScalarTower</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsScalarTower</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsScalarTower</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Subgroup</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">IsInvariant</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SMulCommClass</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">IsInvariant</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SMulCommClass</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>Problems with less generality:</p>\n<ol>\n<li>\n<p>The current spelling of \"galois group\" is just <code>L ≃ₐ[K] L</code>. But this is inconvenient because when <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span> is the fixed field of some <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>H</mi><mo>≤</mo><mrow><mi mathvariant=\"normal\">G</mi><mi mathvariant=\"normal\">a</mi><mi mathvariant=\"normal\">l</mi></mrow><mo stretchy=\"false\">(</mo><mi>L</mi><mi mathvariant=\"normal\">/</mi><mi>K</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">H \\le \\mathrm{Gal}(L/K)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathrm\">Gal</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">L</span><span class=\"mord\">/</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mclose\">)</span></span></span></span>, we would want to say that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>H</mi></mrow><annotation encoding=\"application/x-tex\">H</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span></span></span></span> is the galois group of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>L</mi><mi mathvariant=\"normal\">/</mi><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">L/M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mord\">/</span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span>, or that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>G</mi><mi mathvariant=\"normal\">/</mi><mi>H</mi></mrow><annotation encoding=\"application/x-tex\">G/H</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">G</span><span class=\"mord\">/</span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span></span></span></span> is the galois group of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi><mi mathvariant=\"normal\">/</mi><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">M/K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mord\">/</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span> (if galois).<br>\nSo I am thinking we should use <code>[MulSemiringAction G L] [FaithfulSMul G L] [SmulCommClass G K L] [Algebra.IsInvariant K L G]</code> to mean \"is galois group\" and develop API from this. </p>\n</li>\n<li>\n<p>The current approach of galois theory is to consider two <code>Field</code>s. A base field <code>K</code> and a large enough <code>L</code> and everything else is <code>IntermediateField K L</code>. But often we would start with some <code>M/K</code> and construct some field extension <code>L/M</code>, and it is now a pain to identify <code>E</code> with the image of it in <code>L</code>, especially when we have some primes and ring of integers floating around that also needs to be identifed with each other. (For example I'm now considering the inertia field of some cyclic extension and primes in them and it is driving lean (and me) insane) So this leads to the <code>M</code> stuff above. It is tempting to say that we just let <code>H := FixingSubgroup M</code> and not have an extra <code>H : Subgroup</code>, but often the construction goes the other way and it is also tedious to identify <code>H</code> with <code>FixedField (FixingSubgroup H)</code></p>\n</li>\n<li>I think I'm fairly certain (after flt-regular) that we want the whole AKLB thing. Combining with the previous points we get GHABCKLM.</li>\n</ol>",
        "id": 502237225,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1740649095
    },
    {
        "content": "<p>GHABCKLMFTW!</p>",
        "id": 502241282,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1740650355
    },
    {
        "content": "<p>In my opinion <code>M</code> should be <code>IntermediateField K L</code>, <code>A</code> should be <code>Subring K</code>, <code>B</code> should be <code>Subring L</code>, not sure about <code>C</code>. Of course the typeclass problem for this approach will be horrible...</p>",
        "id": 502241359,
        "sender_full_name": "Jz Pan",
        "timestamp": 1740650377
    },
    {
        "content": "<p>Can we introduce macros that expand to parts of this? For example <code>[AKLB A K L B]</code> expands to <code>[CommRing A] [CommRing B] [Field K] [Field L]  [Algebra A K] [Algebra A B] [Algebra A L] [Algebra B L] [Algebra K L] [IsScalarTower A B L] [IsScalarTower A K L] [IsFractionRing A K] [IsFractionRing B L]</code>. This is of course similar to <code>variable?</code> but could be commited to mathlib and be used both in <code>variable</code> lines and type signatures of declarations.</p>",
        "id": 502243103,
        "sender_full_name": "Christian Merten",
        "timestamp": 1740650842
    },
    {
        "content": "<p>Perhaps others already know, but since I just learned about it recently, I'll mention that <a href=\"https://lean-lang.org/doc/reference/latest/Type-Classes/Class-Declarations/#class-abbrev\">class abbrev</a> (and also plain <code>abbrev</code>) can be used for this instead of a macro.</p>",
        "id": 502247081,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1740651935
    },
    {
        "content": "<p>Unfortunately this doesn't work for some reason:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">Test</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span>\n</code></pre></div>\n<p>And I might want it to be more smart, e.g. <code>[AKLB A K L B] [AKLB A K M C]</code> to not duplicate <code>Algebra A K</code> instances.</p>",
        "id": 502248999,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1740652432
    },
    {
        "content": "<p>I think <code>variable?</code> is smart enough to not duplicate instances, so an <code>AKLB</code> macro could do that as well.</p>",
        "id": 502252139,
        "sender_full_name": "Christian Merten",
        "timestamp": 1740653267
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"439483\">Andrew Yang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Galois.20Theory.20in.20mathlib/near/502248999\">said</a>:</p>\n<blockquote>\n<p>Unfortunately this doesn't work for some reason</p>\n</blockquote>\n<p>Huh, I see. I hadn't considered what happens when the given classes have overlapping fields</p>",
        "id": 502255788,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1740654327
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"366779\">Jz Pan</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Galois.20Theory.20in.20mathlib/near/502241359\">said</a>:</p>\n<blockquote>\n<p>In my opinion <code>M</code> should be <code>IntermediateField K L</code>, <code>A</code> should be <code>Subring K</code>, <code>B</code> should be <code>Subring L</code>, not sure about <code>C</code>. Of course the typeclass problem for this approach will be horrible...</p>\n</blockquote>\n<p>I think this is not an ideal approach. The moment we allow a \"it's sometimes a ring and sometimes a subring\" philosophy then we run into the problem that all of a sudden we need many many more lemmas for everything, because when on paper it says <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>A</mi><mo>⊆</mo><mi>K</mi><mo>⊆</mo><mi>L</mi></mrow><annotation encoding=\"application/x-tex\">A\\subseteq K\\subseteq L</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">A</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">⊆</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">⊆</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">L</span></span></span></span> we need to deal with: A,K,L types, L a type and A,K subtypes, K and L types and A a subtype, and A K L all subtypes, so now we need 4 lemmas every time we have this situation, not one. For example in your situation the relationship <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>A</mi><mo>⊆</mo><mi>K</mi><mo>⊆</mo><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">A\\subseteq K\\subseteq M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">A</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">⊆</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">⊆</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span> is different to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>A</mi><mo>⊆</mo><mi>K</mi><mo>⊆</mo><mi>L</mi></mrow><annotation encoding=\"application/x-tex\">A\\subseteq K\\subseteq L</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">A</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">⊆</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">⊆</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">L</span></span></span></span> so lemmas developed for one situation will not apply in the other situation. There is also the problem that typeclass inference hates subtypes which have been promoted to types; if it needs to find an action of <code>\\u A</code> on something with <code>A : Subring K</code> then it is very quick to realise that it will suffice to find an action of <code>K</code> on that same thing, but often <code>K</code> does not act (e.g. A acts on B but K does not) and this makes typeclass inference grind to a halt (recall for example all the problems we had with rings of integers when they were terms not types).</p>\n<p>Way back in the day we had a very long discussion about this (the thread was called something like \"Algebra is not scaling for me\" (edit: it's <a href=\"#narrow/channel/116395-maths/topic/algebra.20is.20not.20scaling.20for.20me/near/188403964\">here</a> ). In the odd order theorem paper this problem was solved by letting <em>everything</em> be a subtype; all groups were subgroups of a large abstract ambient \"universe group G\" (rather like how Weil did algebraic geometry in the 1940s) and this trick worked for groups because if A and B were groups then there was always a large ambient group which contained A and B as subgroups, namely A x B. This trick doesn't work for rings though, because there's no ring which has Z/2 and Z/3 as subrings, and because we wanted to avoid this combinatorial explosion of lemmas we went with \"everything is a type\"; Kenny invented IsScalarTower to tell typeclass inference that a diagram commutes, and that was it. I think we need to stick with types or else we will end up in all kinds of problems. We maybe need to start to learn how to glue IsScalarTowers together to make more complex commutative diagrams.</p>",
        "id": 502264070,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1740657114
    },
    {
        "content": "<p>This would throw a lot more typeclass arguments into the mix, but perhaps one shouldn't talk about the ring of integers, but _a_ ring that is an integer compatible ring, a la the difference between FractionField and IsFractionField.</p>",
        "id": 502285314,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1740663273
    },
    {
        "content": "<p>But I guess that's how you have it written now anyway</p>",
        "id": 502285519,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1740663334
    },
    {
        "content": "<p>So, let me then reverse the idea -- in this particular situation, maybe it's easier to work with explicit O K or FractionField in this case.</p>",
        "id": 502285985,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1740663462
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Galois.20Theory.20in.20mathlib/near/502264070\">said</a>:</p>\n<blockquote>\n<p>... We maybe need to start to learn how to glue IsScalarTowers together to make more complex commutative diagrams.</p>\n</blockquote>\n<p>☹. At least in this case we need a lot of <code>IsScalarTower</code> to fully describe the relationships of them:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>B-L\n| |\nC-M\n| |\nA-K\n</code></pre></div>\n<p>In general if you have <code>n</code> objects then you may need <code>O(n^3)</code> <code>IsScalarTower</code> instances... that's messy.</p>",
        "id": 502324094,
        "sender_full_name": "Jz Pan",
        "timestamp": 1740672900
    },
    {
        "content": "<p>It's even worse I am afraid, as sometimes it is natural to introduce <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mrow><mi mathvariant=\"normal\">F</mi><mi mathvariant=\"normal\">r</mi><mi mathvariant=\"normal\">a</mi><mi mathvariant=\"normal\">c</mi></mrow><mo stretchy=\"false\">(</mo><mi>A</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\mathrm{Frac}(A)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathrm\">Frac</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">A</span><span class=\"mclose\">)</span></span></span></span>, that is not <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span>. I am adding various instance to work with this setting in <a href=\"https://github.com/leanprover-community/mathlib4/pull/21522\">#21522</a>.</p>",
        "id": 502327505,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1740673830
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"224323\">@Junyan Xu</span> see above. <br>\nEssentially you want G/H to also be the galois group of <code>FixedField H</code> etc</p>",
        "id": 523648239,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1749681249
    },
    {
        "content": "<p>For the last point, I don't think that one wants equalities,<br>\nIf <code>E = FixedField H</code>, one would just need that the natural map from <code>G</code> to  <code>E </code>≃ₐ[K]<code> E</code> (which uses that <code>H</code> is normal) is surjective with kernel <code>H</code>.</p>",
        "id": 523652400,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1749683789
    },
    {
        "content": "<p>I am saying that we want <code>IsGaloisGroup (G/H) K (FixedField H)</code> and we don't want to pass through isomorphisms all times. It will get really messy when we involve more constructions when we want to consider e.g. the inertia subfield of some Kummer extension of <code>FixedField H</code> etc.</p>",
        "id": 523658809,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1749687833
    },
    {
        "content": "<p>(where <code>IsGaloisGroup G K L</code> means something like <code>[IsGalois K L] [MulSemiringAction G L] [SMulCommClass G K L] [Algebra.IsInvariant K L G] [FaithfulSMul G L]</code>)</p>",
        "id": 523658968,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1749687945
    },
    {
        "content": "<p><code>Algebra.IsInvariant</code> probably implies <code>IsGalois</code>? You didn't include it in the OP.</p>",
        "id": 523659717,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1749688453
    },
    {
        "content": "<p>Here's a first stab at this: <a href=\"https://github.com/leanprover-community/mathlib4/pull/26056\">#26056</a></p>",
        "id": 524595729,
        "sender_full_name": "Thomas Browning",
        "timestamp": 1750194071
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"253861\">@Thomas Browning</span> I have a question about the (now-merged) design: why does <code>IsGaloisGroup</code> not simply extend its fields? The low-priority instances on 2 (but not all 3) of them suggests that you set the classes up very intentionally here.</p>",
        "id": 536521669,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1756348526
    },
    {
        "content": "<p>Well, you can't have an instance from <code>IsGaloisGroup</code> to <code>FaithfulSMul</code> (since there's no way to infer <code>K</code>).</p>",
        "id": 536522369,
        "sender_full_name": "Thomas Browning",
        "timestamp": 1756349211
    },
    {
        "content": "<p><span aria-label=\"face with spiral eyes\" class=\"emoji emoji-1f635-200d-1f4ab\" role=\"img\" title=\"face with spiral eyes\">:face_with_spiral_eyes:</span> I would think, looking at that, it would be time to take the bull by the horns <span aria-label=\"ox\" class=\"emoji emoji-1f402\" role=\"img\" title=\"ox\">:ox:</span>, and consider it may be a time to create some DSL or language improvement/higher abstraction to try and simplify this. </p>\n<p>Trying to sweep the problem under the carpet using MACROs is probably not going to end well.</p>\n<p>Sometimes you have to make things more complicated in order to simplify things©</p>\n<p>That is my uninformed opinion. <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span></p>",
        "id": 536528575,
        "sender_full_name": "Mr Proof",
        "timestamp": 1756355279
    }
]