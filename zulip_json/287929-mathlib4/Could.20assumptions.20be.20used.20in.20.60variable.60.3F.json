[
    {
        "content": "<p>I have a file with many lemmas using the condition <code>(hp : p.IsHamiltonianCycle)</code>. However, in my earlier PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/15578\">#15578</a>, <span class=\"user-mention\" data-user-id=\"214703\">@Yury G. Kudryashov</span> advised me not to use assumptions in <code>variable</code>.</p>",
        "id": 459980292,
        "sender_full_name": "Shuhao Song",
        "timestamp": 1723432840
    },
    {
        "content": "<p>If you are in the namespace <code>Path.IsHamiltonianCycle</code> then I think that could be an exception to the rule that Yury stated.</p>",
        "id": 460023231,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1723449571
    },
    {
        "content": "<p>I'm afraid that the new <code>variable</code>s algorithm will require an explicit <code>include hp</code>, and there was a discussion saying that we shouldn't allow <code>include hp</code>, only <code>include hp in</code>.</p>",
        "id": 460082182,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1723469101
    },
    {
        "content": "<p>Let's ask <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> about possible exceptions.</p>",
        "id": 460082316,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1723469156
    },
    {
        "content": "<p>why should assumptions not be placed in variable declarations?</p>",
        "id": 460083980,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723469715
    },
    {
        "content": "<p>I have been doing this in some of my demo projects</p>",
        "id": 460084024,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723469730
    },
    {
        "content": "<p>(not mathlib)</p>",
        "id": 460084053,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723469742
    },
    {
        "content": "<p>also, in what ways is the new variable mechanism going to differ from the current one. I am asking before I perform some toolchain updates to know what to watch out for.</p>",
        "id": 460084256,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723469803
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Could.20assumptions.20be.20used.20in.20.60variable.60.3F/near/460082182\">said</a>:</p>\n<blockquote>\n<p>and there was a discussion saying that we shouldn't allow <code>include hp</code>, only <code>include hp in</code>.</p>\n</blockquote>\n<p>Perhaps this should be a mathlib-only linter</p>",
        "id": 460084262,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723469806
    },
    {
        "content": "<p>I was doing this too before <span class=\"user-mention\" data-user-id=\"110050\">@Sébastien Gouëzel</span> told me not to a few years ago. There are 2 reasons:</p>\n<ul>\n<li>if you have a long section, then a reader looking at the code (not at the generated HTML docs) may not realise that you have a running assumption; </li>\n<li>Lean 4.10.0 and newer uses a new algorithm for <code>variable</code> inclusion, and <code>(hp : p &lt; 5)</code> won't be available in a tactic proof unless you add an explicit <code>include</code>.</li>\n</ul>\n<p>P.S.: the new algorithm is very similar to the one Lean 3 used to have.</p>",
        "id": 460084526,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1723469895
    },
    {
        "content": "<p>Okay, but now I have another question. When is variable useful? If I have to explicitly include it in every proof, I might as well add the assumptions in the theorem statement right? My intuition for <code>variable</code> was, when dealing with a topic we make some ambient assumptions and those go into variable declarations.</p>",
        "id": 460085704,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723470261
    },
    {
        "content": "<p>Also, the clutter up will get significant in many theorem statements if I have to add the same list of instances every time.</p>",
        "id": 460085795,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723470296
    },
    {
        "content": "<p>How should one <code>include</code> unnamed instances?</p>",
        "id": 460085884,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723470325
    },
    {
        "content": "<p>I usually use something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">}</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">mythm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Continuous</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">trivial</span>\n</code></pre></div>",
        "id": 460085981,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1723470354
    },
    {
        "content": "<p>I am still confused because this example seems to work without <code>include</code> very much like the old <code>variable</code> command.</p>",
        "id": 460086413,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723470488
    },
    {
        "content": "<p>I almost never used lean3, other than porting stuff to lean4,  so I have no experience with the <code>variable</code> command there.</p>",
        "id": 460086550,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723470536
    },
    {
        "content": "<p>Which example?</p>",
        "id": 460088191,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1723471080
    },
    {
        "content": "<p>I wrote this <a href=\"https://gist.github.com/Shreyas4991/8d5eb0ecb0146aa75480315612f4816a\">gist</a> 2 months ago to help a PR. Currently, except some warnings about <code>done</code>, it works well on the <a href=\"https://live.lean-lang.org/#code=%2F-%0ACopyright%20(c)%202024%20Shreyas%20Srinivas.%20All%20rights%20reserved.%0AReleased%20under%20Apache%202.0%20license%20as%20described%20in%20the%20file%20LICENSE.%0AAuthors%3A%20Shreyas%20Srinivas%0A-%2F%0A%0Aimport%20Mathlib.Tactic%0Aimport%20Webeditor.Tools%0A%0A%23package_version%0A%0Anamespace%20EFXAlloc%0A%0A%0Avariable%20%7BAgents%20Goods%20%3A%20Type%7D%0Avariable%20%5BFintype%20Agents%5D%20%5BFintype%20Goods%5D%0Avariable%20%5BDecidableEq%20Agents%5D%0Avariable%20%5BDecidableEq%20Goods%5D%20--%20Indivisible%20goods%20only%0A%0A%0A%0Astructure%20Alloc%20where%0A%20%20assign%20%3A%20Agents%20%E2%86%92%20Finset%20Goods%0A%20%20disjoint%20%3A%20%E2%88%80%20a%20b%20%3A%20Agents%2C%20a%20%E2%89%A0%20b%20%E2%86%92%20assign%20a%20%E2%88%A9%20assign%20b%20%3D%20%E2%88%85%0A%0Astructure%20Val%20where%0A%20%20val%20%3A%20Agents%20%E2%86%92%20Finset%20Goods%20%E2%86%92%20%E2%84%9D%0A%20%20empty%20%3A%20%E2%88%80%20a%20%3A%20Agents%2C%20val%20a%20%E2%88%85%20%3D%200%0A%20%20pos%20%3A%20%E2%88%80%20a%20%3A%20Agents%2C%20%E2%88%80%20s%20%3A%20Finset%20Goods%2C%20val%20a%20s%20%E2%89%A5%200%0A%20%20mono%20%3A%20%E2%88%80%20a%20%3A%20Agents%2C%20%E2%88%80%20s%20t%20%3A%20Finset%20Goods%2C%0A%20%20%20%20s%20%E2%8A%86%20t%20%E2%86%92%20val%20a%20s%20%E2%89%A4%20val%20a%20t%0A%0A%0Avariable%20(alloc%20%3A%20%40Alloc%20Agents%20Goods%20_)%0Avariable%20(v%20%3A%20%40Val%20Agents%20Goods)%0A%0Adef%20valSingle%20(a%20%3A%20Agents)%20(g%20%3A%20Goods)%20%3A%3D%0A%20%20v.val%20a%20%7Bg%7D%0A%0Adef%20isEmpty%20(a%20%3A%20Agents)%3A%3D%0A%20%20alloc.assign%20a%20%3D%20%E2%88%85%0A%0Aabbrev%20unAllocated%20(g%20%3A%20Goods)%20%3A%3D%20%E2%88%80%20a%2C%20g%20%E2%88%89%20alloc.assign%20a%0A%0Adef%20allocate%20(g%20%3A%20Goods)%20(a%20%3A%20Agents)%20(h%20%3A%20unAllocated%20alloc%20g)%3A%20%40Alloc%20Agents%20Goods%20_%20%3A%3D%20%7B%0A%20%20assign%20%3A%3D%20fun%20(x%20%3A%20Agents)%20%3D%3E%20if%20x%20%3D%20a%20then%20(alloc.assign%20x)%20%E2%88%AA%20%7Bg%7D%20else%20alloc.assign%20x%0A%20%20disjoint%20%3A%3D%20by%0A%20%20%20%20intro%20arb_a%20arb_b%20hneq%0A%20%20%20%20simp%0A%20%20%20%20by_cases%20ha%20%3A%20arb_a%20%3D%20a%0A%20%20%20%20case%20pos%20%3D%3E%0A%20%20%20%20%20%20have%20hneqb%20%3A%20arb_b%20%E2%89%A0%20a%20%3A%3D%20by%0A%20%20%20%20%20%20%20%20by_contra%20heqarb_a%0A%20%20%20%20%20%20%20%20simp_all%20only%20%5Bne_eq%2C%20not_true_eq_false%5D%0A%20%20%20%20%20%20%20%20done%0A%20%20%20%20%20%20simp%20%5Bha%2C%20hneqb%2C%20Finset.union_inter_distrib_right%5D%0A%20%20%20%20%20%20rw%20%5B%E2%86%90ha%2C%20alloc.disjoint%5D%0A%20%20%20%20%20%20simp%20%5Bh%5D%0A%20%20%20%20%20%20exact%20hneq%0A%20%20%20%20%20%20done%0A%20%20%20%20case%20neg%20%3D%3E%0A%20%20%20%20%20%20by_cases%20hb%20%3A%20arb_b%20%3D%20a%20%3C%3B%3E%0A%20%20%20%20%20%20%20%20simp%5Bhb%2C%20ha%2C%20alloc.disjoint%2C%20hneq%5D%0A%20%20%20%20%20%20rw%5B%E2%86%90hb%5D%0A%20%20%20%20%20%20simp%5BFinset.inter_union_distrib_left%2C%20hneq%2C%20alloc.disjoint%5D%0A%20%20%20%20%20%20simp%20%5Bh%5D%0A%20%20%20%20%20%20done%0A%7D%0A%0Adef%20isEmptyAlloc%20%20%3A%3D%0A%20%20%E2%88%80%20a%20%3A%20Agents%2C%20alloc.assign%20a%20%3D%20%E2%88%85%0A%0Adef%20complete%20%3A%20Prop%20%3A%3D%0A%20%20%E2%88%80%20g%20%3A%20Goods%2C%20%E2%88%83%20a%20%3A%20Agents%2C%20g%20%E2%88%88%20alloc.assign%20a%0A%0Adef%20additive%20%3A%20Prop%20%3A%3D%0A%20%20%E2%88%80%20a%20%3A%20Agents%2C%20%E2%88%80%20G%20%3A%20Finset%20Goods%2C%0A%20%20%20%20v.val%20a%20G%20%3D%20%E2%88%91%20g%20%E2%88%88%20G%2C%20v.val%20a%20%7Bg%7D%0A%0Adef%20EF_agents%20(a%20b%20%3A%20Agents)%20%3A%20Prop%20%3A%3D%0A%20%20%20%20%20%20v.val%20a%20(alloc.assign%20a)%20%E2%89%A5%20v.val%20a%20(alloc.assign%20b)%0A%0Adef%20EF%20%3A%20Prop%20%3A%3D%0A%20%20%20%20%E2%88%80%20(a%20b%20%3A%20Agents)%2C%20EF_agents%20alloc%20v%20a%20b%0A%0Adef%20EF1_agents%20(a%20b%20%3A%20Agents)%20%3A%20Prop%20%3A%3D%0A%20%20%20%20%20isEmpty%20alloc%20b%20%E2%88%A8%20(%E2%88%83%20g%20%E2%88%88%20alloc.assign%20b%2C%0A%20%20%20%20%20%20%20%20v.val%20a%20(alloc.assign%20a)%20%E2%89%A5%20v.val%20a%20((alloc.assign%20b).erase%20g))%0A%0Adef%20EF1%20%3A%20Prop%20%3A%3D%0A%20%20%20%20%E2%88%80%20(a%20b%20%3A%20Agents)%2C%20EF1_agents%20alloc%20v%20a%20b%0A%0Adef%20EFX_agents%20(a%20b%20%3A%20Agents)%20%3A%20Prop%20%3A%3D%0A%20%20%20%20%E2%88%80%20g%20%E2%88%88%20alloc.assign%20b%2C%0A%20%20%20%20%20%20v.val%20a%20(alloc.assign%20a)%20%E2%89%A5%20v.val%20a%20((alloc.assign%20b).erase%20g)%0A%0Adef%20EFX%20%3A%20Prop%20%3A%3D%0A%20%20%20%20%E2%88%80%20(a%20b%20%3A%20Agents)%2C%20EFX_agents%20alloc%20v%20a%20b%0A%0A%0A--%20Some%20elementary%20lemmas%0A%0Alemma%20empty_alloc_is_EF%20%3A%20isEmptyAlloc%20alloc%20%E2%86%92%20EF%20alloc%20v%20%3A%3D%20by%0A%20%20simp%20%5BisEmptyAlloc%2C%20EF%2C%20EF_agents%5D%0A%20%20intro%20hempty%20a%20b%0A%20%20have%20ha%20%3A%3D%20hempty%20a%0A%20%20have%20hb%20%3A%3D%20hempty%20b%0A%20%20rw%20%5Bha%2C%20hb%5D%0A%20%20done%0A%0Alemma%20EF_implies_EFX%20%3A%0A%20%20EF%20alloc%20v%20%E2%86%92%20EFX%20alloc%20v%20%3A%3D%20by%0A%20%20intro%20hEF%0A%20%20unfold%20EFX%20EFX_agents%0A%20%20intro%20a%20b%20g%20_%0A%20%20by_cases%20hemp_a%20%3A%20(isEmpty%20alloc%20a)%0A%20%20%20%20%3C%3B%3E%20by_cases%20hemp_b%20%3A%20(isEmpty%20alloc%20b)%0A%20%20%20%20%3C%3B%3E%20simp%5BisEmptyAlloc%2C%20EF%2C%20isEmpty%5D%20at%20hemp_a%20hemp_b%20%3C%3B%3E%20tauto%0A%20%20%20%20%3C%3B%3E%20simp%20%5BEF%2C%20EF_agents%5D%20at%20hEF%0A%20%20%20%20%3C%3B%3E%20specialize%20hEF%20a%20b%0A%20%20%20%20%3C%3B%3E%20have%20mono_ineq%20%3A%20v.val%20a%20((alloc.assign%20b).erase%20g)%20%E2%89%A4%20v.val%20a%20(alloc.assign%20b)%20%3A%3D%20by%0A%20%20%20%20%20%20%20%20%20%20%20%20simp%5BFinset.erase_subset%2C%20v.mono%5D%0A%20%20all_goals%0A%20%20%20%20simp%5BFinset.erase_subset%5D%0A%20%20%20%20linarith%0A%20%20%20%20done%0A%0Alemma%20EFX_implies_EF1%20%3A%0A%20%20EFX%20alloc%20v%20%E2%86%92%20EF1%20alloc%20v%20%3A%3D%20by%0A%20%20intro%20hEFX%0A%20%20simp_all%20%5BEFX%2C%20EFX_agents%2C%20EF1%2C%20EF1_agents%5D%0A%20%20intro%20a%20b%0A%20%20by_cases%20h%20%3A%20isEmpty%20alloc%20b%20%3C%3B%3E%20simp%20%5Bh%5D%0A%20%20simp%20%5BisEmpty%5D%20at%20h%0A%20%20specialize%20hEFX%20a%20b%0A%20%20apply%20Finset.nonempty_iff_ne_empty.mpr%20at%20h%0A%20%20apply%20Finset.Nonempty.exists_mem%20at%20h%0A%20%20cases%20h%20with%0A%20%20%7C%20intro%20g%20h%20%3D%3E%0A%20%20%20%20%20%20use%20g%0A%20%20%20%20%20%20tauto%0A%20%20done%0A%0Alemma%20EF_implies_EF1%20%3A%0A%20%20EF%20alloc%20v%20%E2%86%92%20EF1%20alloc%20v%20%3A%3D%20by%0A%20%20solve_by_elim%20%5BEF_implies_EFX%2C%20EFX_implies_EF1%5D%0A%0A%0Aend%20EFXAlloc\">web editor</a>. It uses <code>variable</code> to encode assumptions throughout the namespace <code>EFXAlloc</code>.  I think I would understand this change to <code>variable</code> better if I knew what would have to be changed to make it work.</p>",
        "id": 460088239,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723471085
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Could.20assumptions.20be.20used.20in.20.60variable.60.3F/near/460088191\">said</a>:</p>\n<blockquote>\n<p>Which example?</p>\n</blockquote>\n<p>The one below:<br>\n<span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Could.20assumptions.20be.20used.20in.20.60variable.60.3F/near/460085981\">said</a>:</p>\n<blockquote>\n<p>I usually use something like</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">}</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">mythm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Continuous</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">trivial</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 460088311,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723471107
    },
    {
        "content": "<p>This doesn't need <code>include</code>. Lean includes</p>\n<ul>\n<li>variables <code>X</code>, <code>Y</code>, and <code>f</code>, because they are mentioned in the theorem statement;</li>\n<li>variables <code>[TopologicalSpace X] [TopologicalSpace Y]</code>, because they are instances and all variables mentioned in these instances are included.</li>\n</ul>",
        "id": 460088544,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1723471192
    },
    {
        "content": "<p>OTOH, if you try something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Differentiable</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">mythm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Continuous</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"bp\">.</span><span class=\"n\">continuous</span>\n</code></pre></div>\n<p>then you'll see that <code>hf</code> is not available in the proof.</p>",
        "id": 460088829,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1723471262
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/15726\">#15726</a> makes significant changes to how <code>variable</code> works. I suggest not investing time into understanding it until that landed</p>",
        "id": 460089209,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1723471378
    },
    {
        "content": "<p>So I guess as long as I use implicit <code>variable</code>s, it is assumed that theorems refer to them and I don't have to <code>include</code> them. But if a <code>variable</code> uses the explicit parameter syntax  like <code>variable (hx : ...)</code>,  I have to <code>include</code> them to use them</p>\n<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Could.20assumptions.20be.20used.20in.20.60variable.60.3F/near/460088829\">said</a>:</p>\n<blockquote>\n<p>OTOH, if you try something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Differentiable</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">mythm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Continuous</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"bp\">.</span><span class=\"n\">continuous</span>\n</code></pre></div>\n<p>then you'll see that <code>hf</code> is not available in the proof.</p>\n</blockquote>",
        "id": 460089449,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723471450
    },
    {
        "content": "<p>I'm describing the new algorithm. The current algorithm is \"include everything, cleanup after we have a proof\".</p>",
        "id": 460089522,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1723471473
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Could.20assumptions.20be.20used.20in.20.60variable.60.3F/near/460089449\">said</a>:</p>\n<blockquote>\n<p>So I guess as long as I use implicit <code>variable</code>s, it is assumed that theorems refer to them and I don't have to <code>include</code> them. But if a <code>variable</code> uses the explicit parameter syntax  like <code>variable (hx : ...)</code>,  I have to <code>include</code> them to use them</p>\n</blockquote>\n<p>No, the difference is between \"the variable is mentioned in the theorem statement (not proof) vs it isn't mentioned.</p>",
        "id": 460089708,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1723471539
    },
    {
        "content": "<p>Yeah I am also trying to understand what will break when the new algorithm lands.</p>",
        "id": 460089713,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723471540
    },
    {
        "content": "<p>E.g., you can have something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Continuous</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">mythm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">⟨</span><span class=\"n\">f</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">id</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">congr_arg</span><span class=\"w\"> </span><span class=\"n\">DFunLike</span><span class=\"bp\">.</span><span class=\"n\">coe</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>\n<p>because <code>hf</code> is mentioned in the statement.</p>",
        "id": 460090061,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1723471657
    },
    {
        "content": "<p>But isn't the whole point of <code>variable</code> not to have to repeat things?</p>",
        "id": 460090235,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723471709
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Could.20assumptions.20be.20used.20in.20.60variable.60.3F/near/460088544\">said</a>:</p>\n<blockquote>\n<p>This doesn't need <code>include</code>. Lean includes</p>\n<ul>\n<li>variables <code>X</code>, <code>Y</code>, and <code>f</code>, because they are mentioned in the theorem statement;</li>\n<li>variables <code>[TopologicalSpace X] [TopologicalSpace Y]</code>, because they are instances and all variables mentioned in these instances are included.</li>\n</ul>\n</blockquote>\n<p>But the statement of <code>mythm</code> doesn't mention them at all. So are they \"mentioned\" transitively because <code>f</code> is mentioned?</p>",
        "id": 460090451,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723471801
    },
    {
        "content": "<p>Yes, <code>f</code> is mentioned, and it has the type <code>X → Y</code>, so <code>X</code> and <code>Y</code> are included as well.</p>",
        "id": 460090631,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1723471850
    },
    {
        "content": "<p>Is \"mentioned\" in a theorem transitive in the sense that if <code>f</code> is mentioned and <code>f : X -&gt; Y</code> then <code>X</code> and <code>Y</code> are deemed to be \"mentioned\" in the theorem statement?</p>",
        "id": 460090636,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723471851
    },
    {
        "content": "<p>oh right. that was a near simultaneous reply. Thanks :)</p>",
        "id": 460090688,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723471867
    },
    {
        "content": "<p>Lean includes (after the change)</p>\n<ul>\n<li>the minimal amount of <code>variable</code>s needed to \"understand\" the theorem statement;</li>\n<li>all <code>variable</code> instances that don't use non-included <code>variable</code>s</li>\n</ul>",
        "id": 460090826,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1723471919
    },
    {
        "content": "<p>okay. I am guessing this change is great because downstream theorem proofs can be elaborated in parallel since you know the full statement of upstream theorems in advance.</p>",
        "id": 460091041,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723471974
    },
    {
        "content": "<p>Also, in some cases a theorem in Mathlib included unneeded assumptions from <code>variable</code>s, because a tactic like <code>cases</code> generalized too much.</p>",
        "id": 460091198,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1723472036
    },
    {
        "content": "<p>See <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/stream/287929-mathlib4/topic/New.20variable.20inclusion.20mechanism\">#mathlib4 &gt; New variable inclusion mechanism</a>  for more information.</p>",
        "id": 460091386,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1723472089
    }
]