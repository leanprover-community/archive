[
    {
        "content": "<p>I'm making this discussion thread to keep track of new features and to get feedback on the tactic.</p>\n<h2>Feedback may include</h2>\n<ul>\n<li>Does it find the lemmas you expect it to find? (Even after toggling the filter button?)</li>\n<li>How can the tactic-pasting interaction be smoother, e.g. when doing multiple rewrites in a row</li>\n<li>How can the HTML interface be improved (this is not my strong side)</li>\n</ul>\n<h2>Some more considerations</h2>\n<ul>\n<li><code>rw??</code> could be extended to work with <code>grw</code>.</li>\n<li><code>rw??</code> could be extended to rewrite expressions with bound variables. But let's wait for <code>rw</code> to change first.</li>\n<li>What should be the name of the tactic? I called it <code>rw??</code> because <code>rw?</code> was taken. However this means that in the webeditor, when typing <code>rw??</code> character-by-character, the <code>rw?</code> tactic first needs to finish elaborating, which is slow. As a solution, we could simply overwrite <code>rw?</code> which significantly improves discoverability of the new tactic. This is done in <a href=\"https://github.com/leanprover-community/mathlib4/pull/26478\">#26478</a>. Although there should still be a way to call the overwritten tactic. Maybe with <code>rw? -interactive</code>.</li>\n</ul>\n<p>The original discussion of this tactic was at <a href=\"#narrow/channel/287929-mathlib4/topic/Point.26Click.20library.20rewrite.20tactic\">#mathlib4 &gt; Point&amp;Click library rewrite tactic</a>.</p>",
        "id": 528913870,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1752602101
    },
    {
        "content": "<p>sounds really cool! One thing I don't understand is why this in Mathlib? Shouldn't it be in #batteries, so that it's useful outside of Mathlib?</p>",
        "id": 528920525,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1752604629
    },
    {
        "content": "<p>why is*</p>",
        "id": 528920572,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1752604648
    },
    {
        "content": "<p>I agree that it would make sense to have it in Batteries (or even in Core). The issue was that there was nobody to review the code, before I found <span class=\"user-mention silent\" data-user-id=\"111080\">Floris van Doorn</span> who is a Mathlib maintainer.</p>",
        "id": 528922430,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1752605387
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/27164\">#27164</a> imports <code>rw??</code> into <code>Mathlib.Tactic.Common</code> so that it can be used inside of mathlib more easily.</p>",
        "id": 528922543,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1752605428
    },
    {
        "content": "<p>Jovan, thanks a lot for your work on this and your patience with the exceptionally long review process!</p>",
        "id": 528949376,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1752617288
    },
    {
        "content": "<p>I have updated <a href=\"https://github.com/leanprover-community/mathlib4/pull/26478\">#26478</a> by adding the suggestion to use <code>rw? at ⊢</code> to call the core <code>rw?</code> tactic. I have gotten more convinced that it is a good idea to rename the tactic to <code>rw?</code>, because I've been resorting to writing <code>r??</code> and then inserting the <code>w</code>, in order to avoid running the slow <code>rw?</code> tactic. The other way around there is no performance issue since my tactic doesn't do any search without a further interaction.</p>",
        "id": 531016337,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1753570110
    },
    {
        "content": "<p>Maybe we should rename your tactic to be <code>r?w</code></p>",
        "id": 531016604,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1753570243
    },
    {
        "content": "<p>I've also noticed that <code>rw??</code> (similarly to <code>apply?</code>) suffers from unification/type class search being slow. I think the problem is that it may find the right lemma, but then gets stuck wasting time on other lemmas. So I'd like to add some heartbeats limit, both per lemma, and in total.</p>\n<p>If you do encounter such an example that takes too long while there is an obvious available rewrite, let me know, so that I can test with it.</p>",
        "id": 531017319,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1753570601
    },
    {
        "content": "<p>Do you have anything written about the RefinedDiscTree or this tactic?</p>",
        "id": 532736184,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1754316719
    },
    {
        "content": "<p>In the doc-string of the <code>RefinedDiscrTree</code> file I wrote an explanation of the difference with Lean's <code>DiscrTree</code> (<a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Lean/Meta/RefinedDiscrTree.html\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/Lean/Meta/RefinedDiscrTree.html</a>).</p>\n<p>I was also considering writing a sort of blogpost about discrimination trees, about how they work and how they are used. Would that interest you?</p>",
        "id": 532867095,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1754383672
    },
    {
        "content": "<p>Yes, a blog post with examples will help a lot. Thanks in advance!</p>",
        "id": 532938978,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1754407275
    },
    {
        "content": "<p>That would be very cool Jovan!</p>",
        "id": 532941749,
        "sender_full_name": "Eric Rodriguez",
        "timestamp": 1754408168
    },
    {
        "content": "<p>I have created the <code>#infoview_search</code> command in <a href=\"https://github.com/leanprover-community/mathlib4/pull/33052\">#33052</a> to replace <code>rw??</code>. They both give the same suggestions, but the difference is that <code>#infoview_search</code> is a command that you only need to write once at the top of the file, and then you can get library rewrite suggestions at any point simply by shift-clicking.</p>\n<p>Do you think there is still value in having a tactic that triggers the widget instead of a command, in the way that <code>rw??</code> does now?</p>",
        "id": 564530071,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1766081736
    },
    {
        "content": "<p>In a previous version I called it <code>#infoview_suggest</code>, but I think <code>#infoview_search</code> may be a better name. Name suggestions are still welcome.</p>",
        "id": 564530301,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1766081818
    },
    {
        "content": "<p>I have now opened the dependent PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/33209\">#33209</a> which improves the UI of <code>#infoview_search</code>, making the replacement expression hoverable, and adding a separate button for inserting the suggested tactic.</p>\n<p>Here are the before and after screen-shots:</p>\n<p><a href=\"/user_uploads/3121/I3tul224i9FjfJuneFDqCVXa/Schermafbeelding-2025-12-22-234134.png\">Schermafbeelding 2025-12-22 234134.png</a><br>\n<a href=\"/user_uploads/3121/xGeX8xaMKVOSspxzAoF1ajmF/Schermafbeelding-2025-12-22-234019.png\">Schermafbeelding 2025-12-22 234019.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/I3tul224i9FjfJuneFDqCVXa/Schermafbeelding-2025-12-22-234134.png\" title=\"Schermafbeelding 2025-12-22 234134.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1237x1553\" src=\"/user_uploads/thumbnail/3121/I3tul224i9FjfJuneFDqCVXa/Schermafbeelding-2025-12-22-234134.png/840x560.webp\"></a></div><div class=\"message_inline_image\"><a href=\"/user_uploads/3121/xGeX8xaMKVOSspxzAoF1ajmF/Schermafbeelding-2025-12-22-234019.png\" title=\"Schermafbeelding 2025-12-22 234019.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1198x1541\" src=\"/user_uploads/thumbnail/3121/xGeX8xaMKVOSspxzAoF1ajmF/Schermafbeelding-2025-12-22-234019.png/840x560.webp\"></a></div>",
        "id": 565081431,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1766445783
    }
]