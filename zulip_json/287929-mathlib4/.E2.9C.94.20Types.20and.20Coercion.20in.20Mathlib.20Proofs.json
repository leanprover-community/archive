[
    {
        "content": "<p>I am new to Lean and Mathlib, so apologies if this question is misplaced.</p>\n<p>If I want to assert that the ratio of two integers is equal to a particular rational number, it feels like the following code should work:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Trouble</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">x</span><span class=\"bp\">/</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">3</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">3</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Trouble</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Trouble</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">ring_nf</span>\n</code></pre></div>\n<p>If I load this into VS Code and look at the Infoview with the cursor on the last line of the example, it looks like the proof goes through and Lean is happy. If I change <code>Trouble</code> to have <code>(x y : ℚ)</code>, then I everything remains fine (and this is arguably less objectionable, since x/y has an obvious meaning in <code>ℚ</code>) and the Infoview looks identical to the first case. </p>\n<p>My trouble starts when I change one of the numbers to be incorrect. If I say I'm working with rationals, then this code does what I expect:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Trouble</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">x</span><span class=\"bp\">/</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">3</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Trouble</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Trouble</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">ring_nf</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span>\n</code></pre></div>\n<p>At the end of the example my goal is False, which is what I want. But if I'm working with <code>ℤ</code>, then the following code gives the same output as the correct proofs above, which seems wrong:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Trouble</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">x</span><span class=\"bp\">/</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">3</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Trouble</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Trouble</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">ring_nf</span>\n</code></pre></div>\n<p>I know in some sense the right thing to do here is use the correct types, but I'm wondering if there's something else I am missing to distinguish between a correct proof and something that has gone wrong, or if there's something I'm missing about type coercion in mathlib4 specifically.</p>",
        "id": 492032584,
        "sender_full_name": "Richard Kelley",
        "timestamp": 1736139396
    },
    {
        "content": "<p>I think what you're missing is that when <code>x</code> and <code>y</code> are integers, <code>x/y</code> is also a (rounded) integer</p>",
        "id": 492045352,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1736146386
    },
    {
        "content": "<p>The syntax <code>a / b</code> can be intepreted to different functions for different types of a,b. (see <a href=\"https://leanprover.github.io/theorem_proving_in_lean4/type_classes.html\">type class</a>)</p>\n<blockquote>\n<p>If a,b are <code>Nat</code> then <code>a/b</code> is <code>Nat.div</code>. <br>\nIf a,b are <code>Int</code> then <code>a/b</code> is <code>Int.ediv</code>.<br>\nIf a,b are <code>Rat</code> then <code>a/b</code> is <code>Rat.div</code>.<br>\n......</p>\n</blockquote>\n<p>For your example, you can use <code>(1 / 3 : ℚ)</code> to trigger coercion.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Trouble</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"o\">(</span><span class=\"n\">Trouble</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">norm_num</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Trouble</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 492054125,
        "sender_full_name": "Zhang Qinchuan",
        "timestamp": 1736150664
    },
    {
        "content": "<p>In short, <code>/</code> on rings like <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">N</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{N}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">N</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">Z</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Z}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">Z</span></span></span></span> is a \"non-mathematical\" definition, so should be avoided unless this is really what you want (e.g. <code>5 / 2 = 2</code>).</p>",
        "id": 492056647,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1736151653
    },
    {
        "content": "<p>I think your answers are beating around the bush. Richard is specifically asking \"How to know I am in trouble without reading everything carefully?\", and I think the answer to that is <span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span>'s papercut linter</p>",
        "id": 492058762,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1736152545
    },
    {
        "content": "<p>I had forgotten about that linter!  I think that all that was missing was making sure that it was aware of when a <code>a ≤ b</code> assumption was in scope, if you also has <code>b - a</code> with nat-subtraction.</p>",
        "id": 492060623,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736153273
    },
    {
        "content": "<p>All of the above is very helpful - thank you! I'll look into linters - does anyone know of a guide or tutorial that is specific to Lean?</p>\n<p>Having the symbol <code>/</code> represent truncating division makes sense, but that leads me to the question: if I know I want to work with the mapping from pairs of integers to a rational (the problem that prompted my question was a puzzle concerning ratios and Pythagorean triples), how would I go about finding the name of that function in mathlib? Is someone working on a search engine for theorems and tactics?</p>",
        "id": 492150841,
        "sender_full_name": "Richard Kelley",
        "timestamp": 1736185004
    },
    {
        "content": "<p>There are <a href=\"https://leanprover-community.github.io/mathlib4_docs\">#docs</a>, <a href=\"https://loogle.lean-lang.org/\">#loogle</a>, <a href=\"https://leansearch.net/\">#leansearch</a>/ <a href=\"https://www.moogle.ai/\">#moogle</a> in increasing order of fanciness</p>",
        "id": 492158884,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1736187880
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Types.20and.20Coercion.20in.20Mathlib.20Proofs/near/492158884\">said</a>:</p>\n<blockquote>\n<p>There are <a href=\"https://leanprover-community.github.io/mathlib4_docs\">#docs</a>, <a href=\"https://loogle.lean-lang.org/\">#loogle</a>, <a href=\"https://leansearch.net/\">#leansearch</a>/ <a href=\"https://www.moogle.ai/\">#moogle</a> in increasing order of fanciness</p>\n</blockquote>\n<p>Amazing - thank you!</p>",
        "id": 492160679,
        "sender_full_name": "Richard Kelley",
        "timestamp": 1736188606
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"783025\">Richard Kelley</span> has marked this topic as resolved.</p>",
        "id": 492320675,
        "sender_full_name": "Notification Bot",
        "timestamp": 1736260351
    }
]