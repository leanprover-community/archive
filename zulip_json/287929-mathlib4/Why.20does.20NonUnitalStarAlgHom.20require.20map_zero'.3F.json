[
    {
        "content": "<p>Why does proving the <code>NonUnitalStarAlgHom</code> structure require me to prove <code>map_zero'</code>, when it is a direct consequence of <code>map_smul'</code>? Is there some case where it isn't? Is there some way to make it so that <code>map_zero'</code> doesn't have to be proven explicitly?</p>\n<p>I am asking this because I've been making some improvements to my code for the GNS construction, and I was able to refactor my code to create a lemma that is exactly the statement of <code>map_smul'</code> and then prove <code>map_zero'</code> by <code>by simpa using</code> that lemma with the scalar 0 and vector 0, like so</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">gnsNonUnitalStarAlgHom_map_smul</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">leftMulMapPreGNS</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">completion</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">MonoidHom</span><span class=\"bp\">.</span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">leftMulMapPreGNS</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">completion</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">induction_on</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">hp</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">isClosed_eq</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">fun_prop</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">smul_mul_assoc</span><span class=\"o\">]</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">gnsNonUnitalStarAlgHom</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">→⋆ₙₐ</span><span class=\"o\">[</span><span class=\"n\">ℂ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">GNS</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"n\">L</span><span class=\"o\">[</span><span class=\"n\">ℂ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">GNS</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">leftMulMapPreGNS</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">completion</span>\n<span class=\"w\">  </span><span class=\"n\">map_smul'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"n\">map_zero'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">gnsNonUnitalStarAlgHom_map_smul</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div>\n<p><span class=\"user-mention\" data-user-id=\"197836\">@Jireh Loreaux</span></p>",
        "id": 575392219,
        "sender_full_name": "Gregory Wickham",
        "timestamp": 1771878836
    },
    {
        "content": "<p>It's because of the chain  of <code>extends</code> clauses: <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=NonUnitalStarAlgHom#doc\">docs#NonUnitalStarAlgHom</a> extends <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=NonUnitalAlgHom#doc\">docs#NonUnitalAlgHom</a> extends <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=DistribMulActionHom#doc\">docs#DistribMulActionHom</a> extends <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AddMonoidHom#doc\">docs#AddMonoidHom</a>. In <code>AddMonoidHom</code>, the condition <code>map_zero'</code> is truly necessary, but starting with <code>DistribMulActionHom</code> it's not strictly necessary. So, if you wanted to change this, that would be the place to do it. You would need to create a new <code>def</code> for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=DistributMulActionHom.toAddMonoidHom#doc\">docs#DistributMulActionHom.toAddMonoidHom</a> since that will no longer be a structure projection created from <code>extends</code>. And then of course you'll need to fix all the places downstream that require the proof of the <code>map_zero'</code> field and remove them.</p>\n<p>The reason no one has bothered to do it until now: it's generally minimal effort to supply <code>map_zero'</code>.</p>",
        "id": 575393487,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1771879319
    },
    {
        "content": "<p>Is it that obvious? It doesn't seem like R necessarily has a zero</p>",
        "id": 575394134,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1771879562
    },
    {
        "content": "<p>Jireh, this isn't quite true. You can avoid changing the <code>extends</code> structure completely by instead repeating the field name along with a default value</p>",
        "id": 575394298,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1771879624
    },
    {
        "content": "<p>Not at a computer, but can explain tomorrow id you haven't figured it out yet</p>",
        "id": 575394363,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1771879653
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Why.20does.20NonUnitalStarAlgHom.20require.20map_zero'.3F/near/575394134\">said</a>:</p>\n<blockquote>\n<p>Is it that obvious? It doesn't seem like R necessarily has a zero</p>\n</blockquote>\n<p>Oh right, sorry, it's just a monoid, not a ring.</p>",
        "id": 575394578,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1771879729
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Why.20does.20NonUnitalStarAlgHom.20require.20map_zero'.3F/near/575394298\">said</a>:</p>\n<blockquote>\n<p>Jireh, this isn't quite true. You can avoid changing the <code>extends</code> structure completely by instead repeating the field name along with a default value</p>\n</blockquote>\n<p>Sure, but is that actually better for some reason? If these were instances, then I would agree it would be better to have the structure projection onto the parent so that nothing needs unfolding, but for <code>structure</code>s I think it would be better to simply omit the field entirely.</p>",
        "id": 575394893,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1771879852
    },
    {
        "content": "<p>Gregory, if you really want, you can add a so-called <em>convenience constructor</em>. This is <code>def</code> which produces a <code>NonUnitalStarAlgHom</code> (or <code> NonUnitalAlgHom</code>) which uses your argument for the <code>map_zero'</code> field when the scalars form a ring. However, like I said before, there's not too much reason to do this, because the <code>map_zero'</code> field is almost always trivial.</p>",
        "id": 575395348,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1771880016
    },
    {
        "content": "<p>Your suggestion brings us back to (nearly) flat structures, and my understanding was that nested structures were much more performant</p>",
        "id": 575395360,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1771880020
    },
    {
        "content": "<p>But again: structures, not instances, so is the payoff really that large?</p>",
        "id": 575395632,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1771880120
    },
    {
        "content": "<p>Also, see <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearMap#doc\">docs#LinearMap</a> which extends <code>AddHom</code> instead of <code>AddMonoidHom</code>.</p>",
        "id": 575395764,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1771880181
    },
    {
        "content": "<p>So if it's really that much better, presumably we should change that?</p>",
        "id": 575395855,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1771880220
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"197836\">Jireh Loreaux</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Why.20does.20NonUnitalStarAlgHom.20require.20map_zero'.3F/near/575395348\">said</a>:</p>\n<blockquote>\n<p>Gregory, if you really want, you can add a so-called <em>convenience constructor</em>. This is <code>def</code> which produces a <code>NonUnitalStarAlgHom</code> (or <code> NonUnitalAlgHom</code>) which uses your argument for the <code>map_zero'</code> field when the scalars form a ring. However, like I said before, there's not too much reason to do this, because the <code>map_zero'</code> field is almost always trivial.</p>\n</blockquote>\n<p>Once you are declaring a NonUnitalStarAlgHom, doesn't it require [<a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/GroupWithZero/Action/Defs.html#DistribMulAction\">DistribMulAction</a> R A], which requires that R is an <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Group/Defs.html#AddMonoid\">AddMonoid</a>, which does have to have a 0? So then we wouldn't strictly need a Ring, right?</p>",
        "id": 575396362,
        "sender_full_name": "Gregory Wickham",
        "timestamp": 1771880427
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Why.20does.20NonUnitalStarAlgHom.20require.20map_zero'.3F/near/575394134\">said</a>:</p>\n<blockquote>\n<p>Is it that obvious? It doesn't seem like R necessarily has a zero</p>\n</blockquote>\n<p>The scalars must always have a 0 because R must be an AddMonoid in order to define a <code>NonUnitalStarAlgHom</code>, so being able to get <code>map_zero'</code> from <code>map_smul'</code> isn't a special case, right?</p>",
        "id": 575397084,
        "sender_full_name": "Gregory Wickham",
        "timestamp": 1771880663
    },
    {
        "content": "<p>There are two things in play, the algebra <code>A</code>, and the scalars <code>R</code> which are only required to be a <code>Monoid</code>. You know that <code>f 0 = f (r • 0) = r • f 0</code> for any <code>r : R</code>, but this doesn't allow you to conclude that <code>f 0 = 0</code> since you can't take <code>r = 0</code>. All you know is that <code>f 0</code> is an absorbing element under the <code>R</code>-action.</p>",
        "id": 575397961,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1771880999
    },
    {
        "content": "<p>Oh, I see. Thank you!</p>",
        "id": 575398145,
        "sender_full_name": "Gregory Wickham",
        "timestamp": 1771881066
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Why.20does.20NonUnitalStarAlgHom.20require.20map_zero'.3F/near/575395360\">said</a>:</p>\n<blockquote>\n<p>Your suggestion brings us back to (nearly) flat structures, and my understanding was that nested structures were much more performant</p>\n</blockquote>\n<p>I've argued in the past that we should be using flat structures for morphisms anyway, as it makes the story around <code>simp</code> lemmas for <code>mk</code> simpler</p>",
        "id": 575399885,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771881755
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"197836\">Jireh Loreaux</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Why.20does.20NonUnitalStarAlgHom.20require.20map_zero'.3F/near/575394893\">said</a>:</p>\n<blockquote>\n<p>Sure, but is that actually better for some reason? If these were instances, then I would agree it would be better to have the structure projection onto the parent so that nothing needs unfolding, but for <code>structure</code>s I think it would be better to simply omit the field entirely.</p>\n</blockquote>\n<p>If you define an <code>AddMonoidHom.foo</code> and you have a <code>f : NonUnitalStarAlgHom ..</code> then you can write <code>f.foo</code> if <code>NonUnitalStarAlgHom</code> transitively extends <code>AddMonoidHom</code></p>",
        "id": 575406637,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1771884426
    },
    {
        "content": "<p>Though I also think that <code>RingHom extends MonoidHom, AddMonoidHom</code> only inherits such behavior from the first parent and not the second?</p>",
        "id": 575411185,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771886552
    },
    {
        "content": "<p>It checks all the parents in some specified order</p>",
        "id": 575411535,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1771886719
    },
    {
        "content": "<p>you can find out what order with <code>#print</code></p>",
        "id": 575411667,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1771886769
    }
]