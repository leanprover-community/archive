[
    {
        "content": "<p>Since a week or two the bit keeps posting new comments to lean PRs, e.g. <a href=\"https://github.com/leanprover/lean4/pull/5241\">https://github.com/leanprover/lean4/pull/5241</a>.<br>\nI had a quick look but didn't see obvious changes to the comment posting script. Does anyone know what's going on?</p>",
        "id": 467166093,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1725350812
    },
    {
        "content": "<p>I think that some tokens were recently updated/modified: could it be that now they are posting more reliably (and, as a consequence, excessively)?</p>",
        "id": 467174684,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1725353011
    },
    {
        "content": "<p>No, the script has provisions to check for an existing comment and only append to it if it finds one:<br>\n<a href=\"https://github.com/leanprover-community/mathlib4/blob/b191738f9875e429b3680fecf251652a03f77cee/scripts/lean-pr-testing-comments.sh#L71\">https://github.com/leanprover-community/mathlib4/blob/b191738f9875e429b3680fecf251652a03f77cee/scripts/lean-pr-testing-comments.sh#L71</a></p>",
        "id": 467176100,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1725353338
    },
    {
        "content": "<p>Ah, but maybe the bot name has changed? The line</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">jq</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">first</span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">select</span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">body</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"o\">(</span><span class=\"s2\">\"^- . Mathlib\"</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">startswith</span><span class=\"o\">(</span><span class=\"s2\">\"Mathlib CI status\"</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">select</span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">user</span><span class=\"bp\">.</span><span class=\"n\">login</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"s2\">\"leanprover-community-mathlib4-bot\"</span><span class=\"o\">))</span><span class=\"bp\">'</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>doesn’t match <a href=\"https://github.com/leanprover-community-bot\">https://github.com/leanprover-community-bot</a></p>",
        "id": 467176285,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1725353385
    },
    {
        "content": "<p>It should probably check for both names, because the “no mathlib ci attempted” check is still done from the old name:<br>\n<a href=\"https://github.com/leanprover/lean4/pull/5207#issuecomment-2318398108\">https://github.com/leanprover/lean4/pull/5207#issuecomment-2318398108</a><br>\nAnd the same code exists in the lean4 repo, and should also be updated, it seems:<br>\n<a href=\"https://github.com/leanprover/lean4/blob/b053403238c1e8fb3148634de13a0b96b80a6aa9/.github/workflows/pr-release.yml#L170\">https://github.com/leanprover/lean4/blob/b053403238c1e8fb3148634de13a0b96b80a6aa9/.github/workflows/pr-release.yml#L170</a></p>",
        "id": 467176586,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1725353447
    },
    {
        "content": "<p>There seem to be two names for this bot: <a href=\"#narrow/stream/345428-mathlib-reviewers/topic/new-contributor.20PRs/near/466730581\">here</a> (if you are in the \"maintainers\" group) is a similar issue, I think.</p>",
        "id": 467177329,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1725353614
    },
    {
        "content": "<p>It refers to <a href=\"https://github.com/leanprover-community/mathlib4/pull/14860\">#14860</a> that had the bot make a modification and therefore the PR being labeled as <code>new-contributor</code>, since the bot was picked up.  There also there was a mismatch between the \"name\" of the bot and what the script had.</p>",
        "id": 467177665,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1725353692
    },
    {
        "content": "<p>I don't have access to that thread. But this &ldquo;edit by&rdquo; clearly shows that there are now two separate bots involved. <br>\n<a href=\"/user_uploads/3121/RphKLOBan6kYOgYLnW2EZUIf/Screenshot_20240903-141733.png\">Screenshot_20240903-141733.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/RphKLOBan6kYOgYLnW2EZUIf/Screenshot_20240903-141733.png\" title=\"Screenshot_20240903-141733.png\"><img data-original-dimensions=\"1080x2400\" src=\"/user_uploads/thumbnail/3121/RphKLOBan6kYOgYLnW2EZUIf/Screenshot_20240903-141733.png/840x560.webp\"></a></div><p>Should the lean4 repo maybe also use the &rdquo;new&rdquo; bot, the one with the nice icon? Maybe just a matter of setting the right token (and adjusting the expected user names in the scripts)?</p>",
        "id": 467232249,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1725366016
    },
    {
        "content": "<p>We still get duplicate comments, <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> .</p>",
        "id": 472890448,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727355474
    },
    {
        "content": "<p>Hopefully <a href=\"https://github.com/leanprover-community/mathlib4/pull/17182\">#17182</a></p>",
        "id": 473022628,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1727418216
    },
    {
        "content": "<p>Remember that the lean repo also posts to this comment, so if you change the bot name, rather than filter for either, then the lean4 workflow needs to use the same token as the mathlib workflow, and also needs to check for the new name.</p>",
        "id": 473022822,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727418325
    },
    {
        "content": "<p>I <em>think</em> that is already the case, but will go double check.</p>",
        "id": 473027471,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1727420172
    },
    {
        "content": "<p>Nope</p>",
        "id": 473027590,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1727420224
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/5490\">lean#5490</a> (new token+secret documented in the usual places, on both the Mathlib and FRO sides)</p>",
        "id": 473030350,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1727421030
    },
    {
        "content": "<p>I <em>think</em> this will work, but this is CI we're talking about so it almost certainly <em>won't</em>.</p>",
        "id": 473030437,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1727421051
    },
    {
        "content": "<p>Probably also needs <a href=\"https://github.com/leanprover/lean4/pull/5495\">https://github.com/leanprover/lean4/pull/5495</a> (sent to the merge queue)</p>",
        "id": 473136504,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727450887
    }
]