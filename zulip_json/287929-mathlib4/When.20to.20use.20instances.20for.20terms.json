[
    {
        "content": "<p>The way I'm used to working with Mathlib is, you prove predicates and pass them as arguments to other predicates. Typeclasses exist a level above this in some sense. They're the implicit assumptions about whatever type you're working within, stuff you are rarely if ever going to need to specify explicitly.</p>\n<p>There are a few places where this design philosphy doesn't apply. The two I'm aware of are <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ONote.NF#doc\">docs#ONote.NF</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=SetTheory.PGame.Impartial#doc\">docs#SetTheory.PGame.Impartial</a>. These are typeclasses for specific values, rather than for the types of objects they describe.</p>\n<p>The idea in both cases is, I believe, that the compiler should be able to do structural proofs automatically. For instance, if <code>G</code> is impartial, the compiler should be able to determine <code>-G + 1 + *</code> is impartial as well, without having to write down the proof yourself. The downside is that, whenever you don't know if a value satisfies your predicate a priori, you need to prove it first in a <code>haveI</code> block, or make all arguments explicit with <code>@</code>. This is made slightly more annoying by the level of indirection between the instance and the actual predicate. </p>\n<p>I don't really think this is a huge problem that needs solving. We've managed just fine with e.g. <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=SetTheory.PGame.Numeric#doc\">docs#SetTheory.PGame.Numeric</a>, even though it shares this structural property.</p>\n<p>I'm generally not a fan of using instances like this, and I'd like both of these usages to be refactored out, but I'd like to hear what others think.</p>",
        "id": 464192171,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724282220
    },
    {
        "content": "<p>Another issue with this design is how sensitive instances are to rewrites. And when one breaks, you don't have the name of the instance at hand to debug it. None of these problems exist if you just call the theorem name explicitly.</p>",
        "id": 464193135,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724282798
    },
    {
        "content": "<p>I think this is a common source of contention. One common argument for \"<code>P x</code> should be a typeclass\" is \"I want to write <code>instance [P X] : UndisputableTypeclass X</code>, and <code>Fact (P X)</code> is too annoying\".</p>\n<p>I think probably everyone is happy that <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Even#doc\">docs#Even</a> is not a typeclass, but I think the status of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsClosed#doc\">docs#IsClosed</a> (which is a typeclass, even though <code>IsOpen</code> is not) was more divisive</p>",
        "id": 464194694,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1724283673
    },
    {
        "content": "<p>Another awkward one is <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Invertible#doc\">docs#Invertible</a>, which has good reason to be a typeclass because there would be no other way to provide the notation; but the API is difficult to use precisely because it is a data-carrying typeclass, and so it usually only plays a part while assembling a more user-friendly interface.</p>",
        "id": 464194932,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1724283819
    },
    {
        "content": "<p>I don't think either of the cases I mention would be good as <code>Fact</code> either. It's not like we're making extensive use of the impartiality of <code>*</code> or anything like that.</p>",
        "id": 464196209,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724284607
    },
    {
        "content": "<p>The whole thing with <code>ONote</code> is honestly a bit of a mess, that file was made back in 2017 and hasn't been touched much since. But at least with <code>Impartial</code> that refactor would be pretty easy.</p>",
        "id": 464204540,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724288086
    },
    {
        "content": "<p>I'd like to hear from other people within the game part of the library. <span class=\"user-mention\" data-user-id=\"224323\">@Junyan Xu</span> or <span class=\"user-mention\" data-user-id=\"500038\">@Timo Carlin-Burns</span>?</p>",
        "id": 464205368,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724288385
    },
    {
        "content": "<p>I haven't tried to work in either of these files, but after a quick look my first impression is that:</p>\n<ul>\n<li><code>ONote.NF</code> should probably be a regular proposition but there should be a type for <code>{ o // o.NF}</code> which is closed under addition, etc.</li>\n<li><code>Impartial</code> shouldn't be a type class either</li>\n</ul>",
        "id": 464210467,
        "sender_full_name": "Timo Carlin-Burns",
        "timestamp": 1724289879
    },
    {
        "content": "<p><code>{o // o.NF}</code> does exist, it's <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=NONote#doc\">docs#NONote</a></p>",
        "id": 464210516,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724289912
    },
    {
        "content": "<p>I'll make the PR for <code>Impartial</code> sometime soon, I'll wait a bit on <code>ONote</code> since there's a lot more that needs to be cleaned up within that file first</p>",
        "id": 464211145,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724290315
    },
    {
        "content": "<p>Huh, actually, it seems like we had discussed this exact thing before in <a href=\"#narrow/stream/116395-maths/topic/Well-founded.20recursion.20for.20pgames/near/286467225\">https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Well-founded.20recursion.20for.20pgames/near/286467225</a></p>",
        "id": 464211702,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724290631
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"459227\">Violeta Hernández</span> <a href=\"#narrow/stream/287929-mathlib4/topic/When.20to.20use.20instances.20for.20terms/near/464210516\">said</a>:</p>\n<blockquote>\n<p><code>{o // o.NF}</code> does exist, it's <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=NONote#doc\">docs#NONote</a></p>\n</blockquote>\n<p>Note that this is supposed to be the main type that people use outside the file. <code>ONote</code> is only needed within the file itself</p>",
        "id": 464219663,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724293971
    },
    {
        "content": "<p>I opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/16054\">#16054</a> for removing the <code>Impartial</code> typeclass. A few proofs become slightly longer but not by much, dot notation means you can just write stuff like <code>hG.add hH</code> for the impartiality proofs.</p>",
        "id": 464224199,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724295658
    }
]