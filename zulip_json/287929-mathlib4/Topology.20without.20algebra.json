[
    {
        "content": "<p>Now that <a href=\"https://github.com/leanprover-community/mathlib4/pull/19779\">#19779</a> is merged, I was looking into not importing <code>Monoid</code> in topology, but <code>assert_not_exists Monoid</code> in <code>Topology.Defs.Basic</code> gives</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Declaration</span><span class=\"w\"> </span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">allowed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"bp\">.</span>\n<span class=\"n\">It</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">defined</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Group</span><span class=\"bp\">.</span><span class=\"n\">Defs</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Group</span><span class=\"bp\">.</span><span class=\"n\">Pi</span><span class=\"bp\">.</span><span class=\"n\">Basic</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">RefinedDiscrTree</span><span class=\"bp\">.</span><span class=\"n\">Pi</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">RefinedDiscrTree</span><span class=\"bp\">.</span><span class=\"n\">Encode</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">RefinedDiscrTree</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">FunProp</span><span class=\"bp\">.</span><span class=\"n\">Theorems</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">FunProp</span><span class=\"bp\">.</span><span class=\"n\">Attr</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">FunProp</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"bp\">.</span>\n</code></pre></div>",
        "id": 492280575,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1736245208
    },
    {
        "content": "<p>Any thoughts on how to circumvent this issue? Should I split <code>Algebra.Group.Pi.Basic</code> into a notation-only file not importing <code>Monoid</code> vs the rest?</p>",
        "id": 492280694,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1736245264
    },
    {
        "content": "<p><del>Why does <code>Topology.Defs.Basic</code> need <code>Monoid</code>?</del></p>",
        "id": 492286777,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736247319
    },
    {
        "content": "<p>I think the problem is that <code>Mathlib.Lean.Meta.RefinedDiscrTree.Pi</code> hard-codes a list of pi instances, rather than providing an extension point</p>",
        "id": 492286980,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736247371
    },
    {
        "content": "<p>(or perhaps looking at attributes on instances instead)</p>",
        "id": 492287012,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736247381
    },
    {
        "content": "<p>Note that <span class=\"user-mention\" data-user-id=\"479299\">@Jovan Gerbscheid</span>'s has a rewrite of RefinedDiscr in <a href=\"https://github.com/leanprover-community/mathlib4/pull/11968\">#11968</a>, so a refactor in the meantime would probably not be appreciated</p>",
        "id": 492287092,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736247415
    },
    {
        "content": "<p>(In the PR Jovan did discuss dropping the import, but the proposed approach comes at the cost of replacing <code> ``Pi.instAdd </code> with <code> `Pi.instAdd </code>, which makes everything more fragile)</p>",
        "id": 492287230,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736247463
    },
    {
        "content": "<p>It would be great to have an answer rather quickly as this is preventing further improvements to the import graph</p>",
        "id": 492288218,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1736247820
    },
    {
        "content": "<p>You could remove the fun_prop import from topology/defs/basic</p>",
        "id": 492288712,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736248015
    },
    {
        "content": "<p>Is improving the import graph an urgent issue?</p>",
        "id": 492302090,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1736253633
    },
    {
        "content": "<p>No, but it's a long term one with many intermediate steps to perform</p>",
        "id": 492302202,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1736253670
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Topology.20without.20algebra/near/492280694\">said</a>:</p>\n<blockquote>\n<p>Should I split <code>Algebra.Group.Pi.Basic</code> into a notation-only file not importing <code>Monoid</code> vs the rest?</p>\n</blockquote>\n<p>I think we used to have this as <code>Data.Pi</code>? (edit: <a href=\"https://leanprover-community.github.io/mathlib_docs/data/pi/algebra.html\"><code>data.pi.algebra</code></a>)</p>",
        "id": 492302488,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736253786
    },
    {
        "content": "<p>It had a bit more than just notation (which is why I eventually merged it with the other algebra + pi file)</p>",
        "id": 492303239,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1736254086
    },
    {
        "content": "<p>By the way, in the new version of RefinedDiscrTree (<a href=\"https://github.com/leanprover-community/mathlib4/pull/11968\">#11968</a>), the extra import is just Mathlib.Algebra.Group.Operations, so this doesn't include <code>Monoid</code>.</p>",
        "id": 495878638,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1737818006
    }
]