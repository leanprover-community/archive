[
    {
        "content": "<p>Why does <code>Subgroup</code> eat a group rather than a monoid? This came up in FLT-related work, because some Imperial students want to talk about maximal subfields of a K-algebra D where D is not a field (or even a division ring). They can't use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IntermediateField#doc\">docs#IntermediateField</a> because this wants to eat fields. I realised that this convention stretches right down to the basics.</p>",
        "id": 477814769,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1729350658
    },
    {
        "content": "<p>Workaround: you can use <code>Subgroup (Units M)</code></p>",
        "id": 477817944,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1729353027
    },
    {
        "content": "<p>If you want <code>⁻¹</code> on the subgroup to be defeq to the restriction of <code>⁻¹</code> on the original group (in case of groups), then you have to assume <code>Group G</code>.</p>",
        "id": 477818006,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1729353088
    },
    {
        "content": "<p>This workaround does not work for intermediate fields (as subfields of a noncommutative ring) as there is no \"maximal commutative subring\" of a non-commutative ring.</p>",
        "id": 477818239,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1729353269
    },
    {
        "content": "<p>I just encountered this independently. Any thoughts on the following possible design:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span>\n\n<span class=\"c1\">-- Candidate replacement for `Subgroup`</span>\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Subgroup'</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">Submonoid</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">inv_mem'</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">carrier</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">carrier</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Subgroup'</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SetLike</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Subgroup'</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">coe</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">carrier</span>\n<span class=\"w\">  </span><span class=\"n\">coe_injective'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"c1\">-- Only define instance when ambient is a `Group`</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">instInvOfGroup</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Subgroup'</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Inv</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">inv</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"bp\">⟩</span>\n\n<span class=\"sd\">/-- Not an instance because we want good defeq properties of `instInvOfGroup` when have ambient</span>\n<span class=\"sd\">`Group` etc. -/</span>\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">inv</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Subgroup'</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Inv</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">inv</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"o\">(</span><span class=\"n\">H</span><span class=\"bp\">.</span><span class=\"n\">inv_mem'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">property</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">choose</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">H</span><span class=\"bp\">.</span><span class=\"n\">inv_mem'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">property</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">choose_spec</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">⟩</span>\n\n<span class=\"c1\">-- Usual API etc</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Subgroup'</span>\n</code></pre></div>",
        "id": 535316867,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1755697292
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"240862\">@Oliver Nash</span> I think you basically want an \"IsGroup\" typeclass on groups, and then <code>Subgroup'</code> is just <code>Submonoid + IsGroup</code></p>",
        "id": 535317856,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755697577
    },
    {
        "content": "<p>I've heard that we also need similar things for subfields of a ring, and that we're stuck on this front for some reason</p>",
        "id": 535317954,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755697611
    },
    {
        "content": "<p>I don't quite see that <code>IsGroup</code> is what I want here (though perhaps it is).</p>\n<p>The issue I see (highlighted by Yury above) is that <code>Group</code> carries the data of the inverse function and so when defining the inverse for a <code>Subgroup</code> we want to use this same data for definitional convenience. I don't see how a <code>Prop</code>-valued typeclass (which is what I understand by <code>IsGroup</code>) can control the definitional property in the way that we seek.</p>",
        "id": 535319746,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1755698171
    },
    {
        "content": "<p>Make it a subgroup of the units</p>",
        "id": 535319799,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1755698187
    },
    {
        "content": "<p>Indeed this is what is possible today but it's not quite as convenient as I'd like. Sadly I must now disappear to join a call!</p>",
        "id": 535320038,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1755698258
    },
    {
        "content": "<p>I guess this only works because forget (Group -&gt; Monoid) has a right adjoint</p>",
        "id": 535320042,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1755698260
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"240862\">Oliver Nash</span> <a href=\"#narrow/channel/287929-mathlib4/topic/subgroups.20of.20a.20monoid/near/535316867\">said</a>:</p>\n<blockquote>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- Not an instance because we want good defeq properties of `instInvOfGroup` when have ambient</span>\n<span class=\"sd\">`Group` etc. -/</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>this will become painful when you have the same comment on <code>DivInvMonoid</code> and <code>Group</code> and <code>CommGroup</code></p>",
        "id": 535325177,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755699637
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"240862\">Oliver Nash</span> <a href=\"#narrow/channel/287929-mathlib4/topic/subgroups.20of.20a.20monoid/near/535319746\">said</a>:</p>\n<blockquote>\n<p>definitional property</p>\n</blockquote>\n<p>but there is no defintional property in your code above, since everything is noncomputable</p>",
        "id": 535325880,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755699816
    },
    {
        "content": "<p>your <code>inv_mem'</code> is a Prop already</p>",
        "id": 535325950,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755699832
    }
]