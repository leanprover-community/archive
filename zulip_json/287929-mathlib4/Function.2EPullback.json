[
    {
        "content": "<p>Hi.<br>\nWhy is <code>Function.Pullback</code> defined as a subtype rather than a set?</p>",
        "id": 523501531,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1749628870
    },
    {
        "content": "<p>My guess: because you want to use it as a type more frequently. And note the following behavior about the coercion to <code>Sort</code> of a <code>Set</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Prod</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">)</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">Pullback</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"c1\">-- works</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">Pullback</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">with_reducible</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"c1\">-- fails</span>\n</code></pre></div>",
        "id": 523538432,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1749641169
    },
    {
        "content": "<p>What is the significance of that?</p>",
        "id": 523538538,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1749641204
    },
    {
        "content": "<p>sorry, perhaps the more significant bit that I should have written:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">Pullback</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">with_reducible_and_instances</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"c1\">-- fails</span>\n</code></pre></div>\n<p>So these are not interchangeable at the instance level. Basically, you have a choice to make, and your defeqs are affected accordingly. If you were planning to use something as a type virtually all the time, then you should probably go with a subtype (as <code>Function.Pullback</code> does) so that you don't end up in <code>Set</code> land for your defeqs, but if you are going to use it as a <code>Set</code> most of the time, then this is reversed.</p>",
        "id": 523540293,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1749641757
    },
    {
        "content": "<p>Thanks, that's interesting. Suppose you have two definitions, a set and a subtype, where the set happens to be equal to the set the subtype coerces to. How do you express that?</p>",
        "id": 523540772,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1749641919
    },
    {
        "content": "<p><code>Set.range (Subtype.val : my_subtype → my_type) = my_set</code></p>",
        "id": 523541013,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1749642005
    },
    {
        "content": "<p>Nice, thanks</p>",
        "id": 523541211,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1749642081
    },
    {
        "content": "<p>In fact, that's just a missing lemma for <code>Function.Pullback</code>. You should add it <span aria-label=\"wink\" class=\"emoji emoji-1f609\" role=\"img\" title=\"wink\">:wink:</span></p>",
        "id": 523541266,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1749642103
    },
    {
        "content": "<p>I don't think we have a name for that set (I was actually thinking of adding it, mainly actually because I wanted the Set version of Setoid.ker which it is a special case of.)</p>",
        "id": 523541769,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1749642295
    },
    {
        "content": "<p>Right, I'm not suggesting giving it a name, only making a lemma of the form:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">range_pullback</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Pullback</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 523542126,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1749642401
    },
    {
        "content": "<p>Ah got you</p>",
        "id": 523542736,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1749642597
    },
    {
        "content": "<p>The pullback is worth having as a new type as opposed to being a subset because one might install different instances on it, not necessarily the ones that are implied, like subspace topology.</p>",
        "id": 523547832,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1749644244
    },
    {
        "content": "<p>Oh does that work even though it's an \"abbrev\".</p>",
        "id": 523547992,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1749644285
    },
    {
        "content": "<p>no, <code>abbrev</code> means it will inherit those instances.</p>",
        "id": 523551584,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1749645448
    },
    {
        "content": "<p>But I agree that this seems like the wrong choice.</p>",
        "id": 523551707,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1749645487
    }
]