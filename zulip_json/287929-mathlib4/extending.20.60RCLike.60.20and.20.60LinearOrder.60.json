[
    {
        "content": "<p>I have a class </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">RCLike</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">RealScalar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">RCLike</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">LinearOrder</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">is_real</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">RCLike</span><span class=\"bp\">.</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"w\">  </span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">R</span>\n<span class=\"w\">  </span><span class=\"n\">sin</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">R</span>\n<span class=\"w\">  </span><span class=\"c1\">-- ...</span>\n</code></pre></div>\n<p>which on <code>v4.19.0-rc2</code> breaks with</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">field</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">toPartialOrder'</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">RCLike'</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"n\">conflict</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">parent</span><span class=\"w\"> </span><span class=\"n\">projection</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">PartialOrder'</span>\n\n<span class=\"n\">The</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">toParent</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P'</span><span class=\"w\"> </span><span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">used</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">adjust</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">parent</span><span class=\"w\"> </span><span class=\"n\">projection</span>\n</code></pre></div>\n<p>What is going on? How do I fix this?</p>\n<p>Following the suggestion</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">RealScalar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">Scalar</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">toOrder</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LinearOrder</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n</code></pre></div>\n<p>does not work.</p>",
        "id": 511022629,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1744145147
    },
    {
        "content": "<p>Why are you extending <code>RCLike</code> and <code>LinearOrder</code>?</p>",
        "id": 511023095,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1744145335
    },
    {
        "content": "<p>I want to work with real numbers without actually working with real numbers and making my code noncomputable everywhere.  I write most of my code parameterized over this calss and only at the and provide an inconsistent instance of this class for <code>Float</code> to execute the code.</p>",
        "id": 511023356,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1744145439
    },
    {
        "content": "<p>I think SciLean had a solution for this that didn't involve extending <code>RCLike</code> and <code>LinearOrder</code>.</p>",
        "id": 511023480,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1744145496
    },
    {
        "content": "<p>I don't know how it works though, you'll have to see for yourself.</p>",
        "id": 511023519,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1744145513
    },
    {
        "content": "<p>This is in SciLean :)</p>",
        "id": 511023592,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1744145527
    },
    {
        "content": "<p><a href=\"https://github.com/lecopivo/SciLean/blob/53f112d9c99068a8231454c078525facd4ca2404/SciLean/Analysis/Scalar/Basic.lean#L109\">https://github.com/lecopivo/SciLean/blob/53f112d9c99068a8231454c078525facd4ca2404/SciLean/Analysis/Scalar/Basic.lean#L109</a></p>",
        "id": 511023693,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1744145575
    },
    {
        "content": "<p>oh, well... hmm...</p>",
        "id": 511023994,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1744145700
    },
    {
        "content": "<p>What if you extend <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ConditionallyCompleteLinearOrderedField#doc\">docs#ConditionallyCompleteLinearOrderedField</a> and add an instance of RCLike</p>",
        "id": 511024092,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1744145741
    },
    {
        "content": "<p>The job of <code>RCLike</code> is to axiomatise \"the reals or complexes\". If you want to axiomatise the reals then we have just the class for you in mathlib: <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ConditionallyCompleteLinearOrderedField#doc\">docs#ConditionallyCompleteLinearOrderedField</a> .</p>",
        "id": 511024401,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744145855
    },
    {
        "content": "<p>My current hierarchy is actually</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- `K` models complex numbers over `R` which should model reals</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Scalar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">outParam</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">RCLike</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n\n<span class=\"c1\">-- `R` models reals</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">RealScalar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">Scalar</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">LinearOder</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n</code></pre></div>\n<p>I feel that to use <code>ConditionallyCompleteLinearOrderedField</code> I would have to do substantial refactoring. Which might be the right thing to do as I'm not completely satisfy with my current set up,  but in a short term In not going to do that.</p>",
        "id": 511024866,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1744146039
    },
    {
        "content": "<p>Well I managed to get a different error...</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">RCLike</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">RealScalar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">LinearOrder</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">RCLike</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">is_real</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">RCLike</span><span class=\"bp\">.</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span>\n\n<span class=\"w\">  </span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">R</span>\n<span class=\"w\">  </span><span class=\"n\">sin</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">R</span>\n<span class=\"w\">  </span><span class=\"c1\">-- ...</span>\n</code></pre></div>",
        "id": 511026028,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1744146484
    },
    {
        "content": "<p>Interesting, if you swap <code>RCLike</code> and <code>LinearOrder</code> it gives you very different error.</p>",
        "id": 511026163,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1744146555
    },
    {
        "content": "<p>Anyway, simply doing</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">RealScalar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">Scalar</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">order</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LinearOrder</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span>\n\n<span class=\"w\">  </span><span class=\"n\">is_real</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">âˆ€</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">im</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">RealScalar</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LinearOrder</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">RealScalar</span><span class=\"bp\">.</span><span class=\"n\">order</span>\n</code></pre></div>\n<p>seems to work for now.</p>",
        "id": 511026591,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1744146740
    },
    {
        "content": "<p>Are you sure that this isn't just a \"random\" linear order on R rather than the one you want? (i.e. the one where x^2&gt;=0)?</p>",
        "id": 511026769,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744146816
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">RCLike</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"c1\">-- shut up the error</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">synthInstance</span><span class=\"bp\">.</span><span class=\"n\">checkSynthOrder</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">RealScalar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">LinearOrder</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">RCLike</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">is_real</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">RCLike</span><span class=\"bp\">.</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span>\n\n<span class=\"w\">  </span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">R</span>\n<span class=\"w\">  </span><span class=\"n\">sin</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">R</span>\n<span class=\"w\">  </span><span class=\"c1\">-- ...</span>\n\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">RealScalar</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span>\n\n<span class=\"c1\">-- synthesis still seems to work fine</span>\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">RCLike</span><span class=\"w\"> </span><span class=\"n\">R</span>\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">LinearOrder</span><span class=\"w\"> </span><span class=\"n\">R</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">inferInstanceAs</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">RCLike</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">toPartialOrder</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">inferInstanceAs</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">LinearOrder</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">toPartialOrder</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"c1\">-- no diamonds either</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n</code></pre></div>",
        "id": 511026948,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1744146889
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/extending.20.60RCLike.60.20and.20.60LinearOrder.60/near/511026769\">said</a>:</p>\n<blockquote>\n<p>Are you sure that this isn't just a \"random\" linear order on R rather than the one you want? (i.e. the one where x^2&gt;=0)?</p>\n</blockquote>\n<p>Ohh yes that is true, the class should contain some compatibility of those structures.</p>",
        "id": 511027074,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1744146946
    },
    {
        "content": "<p>If you extend <code>LinearOrder R, RCLike R</code> and shut up the error, the <code>toPartialOrder</code> fields get merged, so the compatibility is free</p>",
        "id": 511027348,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1744147066
    },
    {
        "content": "<p>The <code>checkSynthOrder</code> error is surprising (to me). Is it a regression?</p>",
        "id": 511027815,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744147257
    },
    {
        "content": "<p>In v4.18.0 you get an error on <code>RCLike.I</code> with the complaint that it can't synthesiz<code> RCLike R</code> and if you delete this field then you get the synthesization order error again.</p>",
        "id": 511028155,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744147417
    },
    {
        "content": "<blockquote>\n<p><code>-- no diamonds either</code></p>\n</blockquote>\n<p>There is a diamond in the <code>decidableEq</code> instance, since this creates both <code>decidableEq</code> and <code>toDecidableEq</code> fields</p>",
        "id": 511033347,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744149742
    },
    {
        "content": "<p>We could rename the field in RCLike to also be called <code>decidableEq</code></p>",
        "id": 511045278,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1744156536
    },
    {
        "content": "<p>I'd argue vice versa is more consistent</p>",
        "id": 511045446,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744156642
    },
    {
        "content": "<p>Then we should have <code>toDecidableEq</code>, <code>toDecidableLE</code>, and <code>toDecidableLT</code> on <code>LinearOrder</code>?</p>",
        "id": 511047785,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1744157911
    },
    {
        "content": "<blockquote>\n<p>TheÂ <code>checkSynthOrder</code>Â error is surprising (to me). Is it a regression?</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> I saw that error recently as well:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommGroup</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">â‰ƒ</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CommGroup</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">commGroup</span>\n</code></pre></div>\n<p>it seemed like a straightforward application of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Equiv.commGroup#doc\">docs#Equiv.commGroup</a> so I figured I was making some dumb mistake</p>",
        "id": 511054852,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1744162153
    },
    {
        "content": "<p>looks like there was a recent thread about this: <a href=\"#narrow/channel/270676-lean4/topic/projection.20instance.20binderinfo.20problem/near/505859872\">#lean4 &gt; projection instance binderinfo problem @ ðŸ’¬</a></p>",
        "id": 511055645,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1744162640
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"380294\">Matt Diamond</span> <a href=\"#narrow/channel/287929-mathlib4/topic/extending.20.60RCLike.60.20and.20.60LinearOrder.60/near/511054852\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>TheÂ <code>checkSynthOrder</code>Â error is surprising (to me). Is it a regression?</p>\n</blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> I saw that error recently as well:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommGroup</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">â‰ƒ</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CommGroup</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">commGroup</span>\n</code></pre></div>\n<p>it seemed like a straightforward application of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Equiv.commGroup#doc\">docs#Equiv.commGroup</a> so I figured I was making some dumb mistake</p>\n</blockquote>\n<p>No in that one the error seems reasonable</p>",
        "id": 511056653,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1744163279
    },
    {
        "content": "<p>Since <code>Equiv</code> isn't a typeclass</p>",
        "id": 511056731,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1744163305
    },
    {
        "content": "<p>Typeclass search will not infer the <code>Equiv</code>, so you're asking it to do <code>CommGroup ?R  â†’ CommGroup S</code>, which does not solve for <code>?R</code></p>",
        "id": 511057116,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1744163463
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 511060860,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1744165580
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 511060876,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1744165593
    },
    {
        "content": "<p>wait, but I'm not asking it to infer the Equiv, I'm providing it explicitly...</p>",
        "id": 511060952,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1744165643
    },
    {
        "content": "<p>I don't get why that wouldn't work... it has all the information it needs</p>",
        "id": 511061169,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1744165791
    },
    {
        "content": "<p>oh I think I get it... the arguments to a class instance must themselves be classes for typeclass inference to work (you can't just say \"if this equiv exists...\")</p>",
        "id": 511061378,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1744165907
    },
    {
        "content": "<p>so I guess the point of <code>Equiv.commGroup</code> is for when you need a <code>CommGroup</code> instance in a specific proof, not as a general instance</p>",
        "id": 511061695,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1744166069
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/extending.20.60RCLike.60.20and.20.60LinearOrder.60/near/511047785\">said</a>:</p>\n<blockquote>\n<p>Then we should have <code>toDecidableEq</code>, <code>toDecidableLE</code>, and <code>toDecidableLT</code> on <code>LinearOrder</code>?</p>\n</blockquote>\n<p>I don't see it mentioned here; this is <a href=\"https://github.com/leanprover-community/mathlib4/pull/23976\">#23976</a></p>",
        "id": 512175512,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744665589
    }
]