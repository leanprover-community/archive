[
    {
        "content": "<p>I believe Mathlib doesn't currently have the notion of \"even\" and \"odd\" functions (between types with negation), i.e. functions satisfying <code>f (-x) = f x</code> or <code>f (-x) = -(f x)</code> respectively. Cf. <a href=\"https://en.wikipedia.org/wiki/Even_and_odd_functions\">https://en.wikipedia.org/wiki/Even_and_odd_functions</a>.</p>\n<p>These are pretty trivial to code up:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- A function `f` is _even_ if it satisfies `f (-x) = f x` for all `x`. -/</span>\n<span class=\"kn\">protected</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">Even</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">R'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Neg</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">R'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n<span class=\"sd\">/-- A function `f` is _odd_ if it satisfies `f (-x) = -f x` for all `x`. -/</span>\n<span class=\"kn\">protected</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">Odd</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">R'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Neg</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Neg</span><span class=\"w\"> </span><span class=\"n\">R'</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">R'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>My question is: where should they go in Mathlib, given that they have virtually no prerequisites at all? Would a new file under <code>Data</code>, perhaps <code>Data/EvenOddFunction.lean</code>, be a good solution?</p>",
        "id": 466990287,
        "sender_full_name": "David Loeffler",
        "timestamp": 1725292542
    },
    {
        "content": "<p>Definitely not under <code>Data</code> since they import algebra if you try to prove anything non-trivial. <code>Algebra</code> could work</p>",
        "id": 466990510,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1725292601
    },
    {
        "content": "<p>Good point, I guess you will very soon need <code>InvolutiveNeg</code> and that lives in <code>Algebra/Group</code>. How about <code>Algebra.Group.EvenOddFunction</code> then?</p>",
        "id": 466991308,
        "sender_full_name": "David Loeffler",
        "timestamp": 1725292820
    },
    {
        "content": "<p>Happy with it</p>",
        "id": 466993851,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1725293488
    },
    {
        "content": "<p>Should it come with a linter warning against <code>_root_.Even (f : α → β)</code>?</p>",
        "id": 467013315,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1725299557
    },
    {
        "content": "<p>This is a valid term that means (after some simplifications) <code>∀ a, Even (f a)</code>.</p>",
        "id": 467013480,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1725299604
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Even.20and.20odd.20functions/near/467013315\">said</a>:</p>\n<blockquote>\n<p>Should it come with a linter warning against <code>_root_.Even (f : α → β)</code>?</p>\n</blockquote>\n<p>This sounds like a nice idea (I made that mistake several times myself) but I have no idea how to write linters myself...</p>",
        "id": 467040651,
        "sender_full_name": "David Loeffler",
        "timestamp": 1725307908
    },
    {
        "content": "<p>I think such a linter can be useful (not for mathlib CI, but just as an authoring tool in VScode). But it can definitely be a separate PR.</p>",
        "id": 467112841,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1725339153
    },
    {
        "content": "<p>I'm not sure that I understand what the linter should do: it is supposed to prevent using <code>_root_.Even</code> with a function?  Due to the <code>protected</code> this means <code>Even f</code> where <code>f</code> is a function, right?</p>",
        "id": 467132174,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1725344601
    },
    {
        "content": "<p>Why don't you just write <code>f.Even</code>?</p>",
        "id": 467138546,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1725345842
    },
    {
        "content": "<p>Or, let's be crazy, why not call the predicates <code>EvenFun</code>/<code>OddFun</code>?</p>",
        "id": 467138817,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1725345885
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Even.20and.20odd.20functions/near/467112841\">said</a>:</p>\n<blockquote>\n<p>I think such a linter can be useful (not for mathlib CI, but just as an authoring tool in VScode). But it can definitely be a separate PR.</p>\n</blockquote>\n<p>A similar linter would be good for IsCoprime on Nat</p>",
        "id": 467176595,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1725353449
    },
    {
        "content": "<p>This linter would be a \"reverse\" protected, or am I misunderstanding?  It should flag a selected few declarations <code>X</code> for which <code>Y.X</code> is preferred (and possibly <code>protected</code>)?</p>",
        "id": 467179342,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1725354090
    },
    {
        "content": "<p>Well, I think it should also look at the <code>t</code> that comes after <code>X</code>. So for certain <code>t</code> it should warn about <code>X t</code> and suggest <code>Y.X t</code>.</p>",
        "id": 467179804,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1725354195
    },
    {
        "content": "<p>And I think it should only run locally.</p>",
        "id": 467179866,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1725354211
    },
    {
        "content": "<p>Ok, yes, I did not mention further necessary checks to trigger the linter, but I think that I have a clearer idea of what it should do!</p>",
        "id": 467180658,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1725354401
    },
    {
        "content": "<p>PR up at <a href=\"https://github.com/leanprover-community/mathlib4/pull/16446\">#16446</a>.</p>",
        "id": 467215444,
        "sender_full_name": "David Loeffler",
        "timestamp": 1725361857
    }
]