[
    {
        "content": "<p>It seems like we have both <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Int.gcd_eq_one_iff_coprime#doc\">docs#Int.gcd_eq_one_iff_coprime</a>  and  <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Int.isCoprime_iff_gcd_eq_one#doc\">docs#Int.isCoprime_iff_gcd_eq_one</a>. </p>\n<p>Should there be both?<br>\nIn that case I propose to shorten the proof of <code>gcd_eq_one_iff_coprime</code> to <code>isCoprime_iff_gcd_eq_one.symm</code>, because the one for <code>isCoprime_iff_gcd_eq_one</code>is nicer and comes first in the import order.</p>\n<p>Is it preferred in general to have only one iff-direction? <br>\nIn that case I propose to deprecate <code>gcd_eq_one_iff_coprime</code></p>\n<p>Also I think the name should be  <del><code>gcd_eq_one_iff_IsCoprime</code></del> <code>gcd_eq_one_iff_isCoprime</code>?</p>",
        "id": 495364912,
        "sender_full_name": "Moritz Firsching",
        "timestamp": 1737576390
    },
    {
        "content": "<p>Definitely not with a capital <code>I</code></p>",
        "id": 495365222,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1737576494
    },
    {
        "content": "<p>corrected...</p>",
        "id": 495365405,
        "sender_full_name": "Moritz Firsching",
        "timestamp": 1737576564
    },
    {
        "content": "<p><code>Int.isCoprime_iff_gcd_eq_one</code> was added in <a href=\"https://github.com/leanprover-community/mathlib4/commit/c0f7bfdefbf97107687d4dc99db525fa09c04bba\">c0f7bfde</a>, while <code>Int.gcd_eq_one_iff_coprime</code> existed back in mathlib3.</p>",
        "id": 495375351,
        "sender_full_name": "David Renshaw",
        "timestamp": 1737580687
    },
    {
        "content": "<p>Maybe <span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> (author of that commit) can comment. Deprecating <code>gcd_eq_one_iff_coprime</code> makes sense to me.</p>",
        "id": 495377223,
        "sender_full_name": "David Renshaw",
        "timestamp": 1737581409
    },
    {
        "content": "<p>I must have missed the pre-existing one because I didn't expect it to have \"coprime\" in the name rather than \"isCoprime\"</p>",
        "id": 495380921,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1737583009
    },
    {
        "content": "<p>Deprecating <code>gcd_eq_one_iff_coprime</code> here: <a href=\"https://github.com/leanprover-community/mathlib4/pull/20976\">#20976</a> (also slightly improve imports).<br>\nFixing other names that wrongly have <code>coprime</code> instead of <code>isCoprime</code> here: <a href=\"https://github.com/leanprover-community/mathlib4/pull/20982\">#20982</a></p>",
        "id": 495468957,
        "sender_full_name": "Moritz Firsching",
        "timestamp": 1737627881
    },
    {
        "content": "<p>Ì think the lemma should be <code>gcd a b = 1 ↔ IsCoprime a b</code> and not the other way around, and be made simp</p>",
        "id": 495469080,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1737627919
    },
    {
        "content": "<p>Therefore could we deprecate both <code>gcd_eq_one_iff_coprime</code> and <code>isCoprime_iff_gcd_eq_one</code> and add <code>gcd_eq_one_iff_isCoprime</code>?</p>",
        "id": 495469168,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1737627949
    },
    {
        "content": "<p>I'm not sure about that being a simp lemma <span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span>. It seems like something that would be easy to find yourself fighting against...</p>\n<p>Independent of that, it's now possible to add the reverse of a lemma to the simp set with <code>@[simp ←]</code>, so if your suggestion on changing the direction is just for appeasing simp, that's no longer needed.</p>",
        "id": 495496124,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1737638259
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60gcd_eq_one_iff_coprime.60.20and.20.60isCoprime_iff_gcd_eq_one.60/near/495496124\">said</a>:</p>\n<blockquote>\n<p>I'm not sure about that being a simp lemma @Yaël Dillies. It seems like something that would be easy to find yourself fighting against...</p>\n</blockquote>\n<p>Really? Don't you mentally turn any assumption of the form <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mrow><mi mathvariant=\"normal\">g</mi><mi mathvariant=\"normal\">c</mi><mi mathvariant=\"normal\">d</mi></mrow><mo stretchy=\"false\">(</mo><mi>a</mi><mo separator=\"true\">,</mo><mi>b</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">\\mathrm{gcd}(a, b) = 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathrm\">gcd</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> into \"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span> are coprime\" when doing mathematics on paper?</p>",
        "id": 495496542,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1737638395
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60gcd_eq_one_iff_coprime.60.20and.20.60isCoprime_iff_gcd_eq_one.60/near/495496124\">said</a>:</p>\n<blockquote>\n<p>Independent of that, it's now possible to add the reverse of a lemma to the simp set with <code>@[simp ←]</code>, so if your suggestion on changing the direction is just for appeasing simp, that's no longer needed.</p>\n</blockquote>\n<p><span aria-label=\"idea\" class=\"emoji emoji-1f4a1\" role=\"img\" title=\"idea\">:idea:</span> I had no idea. Regardless, I think we want to keep the rule that the LHS of a lemma is simpler than its RHS, so I would keep <code>IsCoprime</code> on the right</p>",
        "id": 495497050,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1737638545
    },
    {
        "content": "<p>Thought experiment: you have the fact that <code>gcd a b = 2</code> in context, but simp turns your goals into something involving <code>IsCoprime a b</code>.</p>\n<p>This means you have to figure out what simp lemma should be disabled (or you have to take a gamble that putting this fact into <code>simp [...]</code> will happen to work due to priorities).</p>",
        "id": 495497932,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1737638804
    },
    {
        "content": "<p>I was thinking about this lemma as being the \"def\" lemma for <code>IsCoprime</code> for <code>Int</code>, hence the direction I wrote it in.</p>",
        "id": 495497994,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1737638828
    },
    {
        "content": "<p>You don't generally have simp lemmas that refold definitions. If you have the unfolded form, you may be intending to work with the unfolded form.</p>",
        "id": 495498130,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1737638873
    },
    {
        "content": "<p>Usually, when that happens you end up adding another lemma that makes simp loop. Currently, the user experience is quite terrible. You need to:</p>\n<ol>\n<li>Read the error message to see that you need <code>set_option diagnostics true</code></li>\n<li>Copy-paste <code>set_option diagnostics true</code> before your proof</li>\n<li>Wait for your proof to rebuild</li>\n<li>Put your cursor on the incriminating simp</li>\n<li>Click on <code>[simp] used theorems (max: 251, num: 2): ▶</code></li>\n<li>Tada. You finally know which two lemmas looped</li>\n</ol>",
        "id": 495499033,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1737639149
    },
    {
        "content": "<p>Here's a MWE demonstrating this situation:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo_eq_bar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">bar_eq_foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"c1\">-- set_option diagnostics true</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">foo_eq_bar</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">bar_eq_foo</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 495499075,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1737639164
    },
    {
        "content": "<p>But there's an alternative world where simp is a bit smarter and can detect when a loop happened (99% of all loops involve only two lemmas, and I have yet to see a naturally occurring loop involving more than three lemmas) and report the faulty lemmas.</p>",
        "id": 495499426,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1737639270
    },
    {
        "content": "<p>Maybe it is helpful to split the discussion his into parts:</p>\n<ol>\n<li>I think we all agree that <code>gcd_eq_one_iff_coprime</code> should be deprecated </li>\n<li>replacing <code>isCoprime_iff_gcd_eq_one</code> with <code>gcd_eq_one_iff_isCoprime</code></li>\n<li>adding <code>simp</code> to the one that remains</li>\n</ol>\n<p>I have no strong opinion on 2. and looking in the library which direction is substituted more often doesn't give a signal.<br>\nFor 3., I tried and adding <code>``+@[simp ←] to </code>Int.isCoprime_iff_gcd_eq_one` at least doesn't break anything right away. But then again those theorems are not used super often (~20 times).</p>",
        "id": 495549977,
        "sender_full_name": "Moritz Firsching",
        "timestamp": 1737652725
    },
    {
        "content": "<p>I'd be fine doing just (1)</p>",
        "id": 495551526,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1737653225
    },
    {
        "content": "<p>Me too, and we can always do 2. and 3. later, for instances when cycle detection for simp gets better.</p>\n<ol>\n<li>is done in  <a href=\"https://github.com/leanprover-community/mathlib4/pull/20976\">#20976</a></li>\n</ol>",
        "id": 495552904,
        "sender_full_name": "Moritz Firsching",
        "timestamp": 1737653665
    },
    {
        "content": "<p>I agree with Kyle. <code>simp</code> lemmas for refolding definitions are a bit of an antipattern, since they don't apply very often, and when they do, it's usually when you don't want them to.</p>",
        "id": 496002256,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1737925998
    }
]