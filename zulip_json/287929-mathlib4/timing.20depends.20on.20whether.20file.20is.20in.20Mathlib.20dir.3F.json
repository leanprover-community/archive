[
    {
        "content": "<p>I was very surprised to find the following.<br>\nCreate a file called <code>scratch.lean</code> in the root directory of Mathlib (i.e. <em>not</em> in the <code>Mathlib/</code> directory where all the Lean files are). And populate it with this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"n\">suppress_compilation</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NumberField</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">]</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">TotallyDefiniteQuaternionAlgebra</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">TensorProduct</span><span class=\"w\"> </span><span class=\"n\">NumberField</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">IsDedekindDomain</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstance</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstance</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">profiler</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">count_heartbeats</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"c1\">-- 10037 in root , 23198 in Mathlib/</span>\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Now create a second file called <code>Mathlib/scratch.lean</code> and populate it with exactly the same thing. Tada: instance synthesis now takes twice as long (according to both the profiler and <code>count_heartbeats</code>).</p>\n<p>I discovered this when trying to debug a slowdown in FLT, I was minimising in a scratch file which wasn't in <code>FLT/</code> and it was much quicker. I didn't even know that this could happen. Can someone else reproduce or do I just need to turn it off and on again? This was on a recent master but I observed the same behaviour on tag <code>v4.19.0</code>.</p>",
        "id": 520434609,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748261286
    },
    {
        "content": "<p>Does disabling linting have the same effect?</p>",
        "id": 520436824,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748261883
    },
    {
        "content": "<p>how do I disable linting? Does that involve typing in about 20 things?</p>",
        "id": 520437539,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748262073
    },
    {
        "content": "<p>The extreme version is</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- no undoing this without restarting the file, commenting it out won't work</span>\n<span class=\"n\">run_cmd</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Command</span><span class=\"bp\">.</span><span class=\"n\">lintersRef</span><span class=\"bp\">.</span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[]</span>\n</code></pre></div>",
        "id": 520438031,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748262195
    },
    {
        "content": "<p>I put that line in both files, restarted the server, and am still observing the same phenomenon. I'll dump the traces to a file and get the diffs.</p>",
        "id": 520438421,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748262296
    },
    {
        "content": "<p>dammit I can't use <code>lake</code> to build the file outside Mathlib</p>",
        "id": 520438799,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748262390
    },
    {
        "content": "<p>is the one outside mathlib the same lean version?</p>",
        "id": 520439209,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748262490
    },
    {
        "content": "<p><code>lean --version</code> is producing the same output in both the root directory and in the Mathlib subdirectory. And adding <code>#eval Lean.versionString</code> to both files produces the same output.</p>",
        "id": 520440949,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748262955
    },
    {
        "content": "<p>I am kind of in shock right now because after I added a \"check <code>FLT.lean</code> contains all the files in <code>FLT/</code>\" linter to CI in FLT I had to move my scratch directory out of <code>FLT/</code> (because I kept accidentally adding scratch files to <code>FLT.lean</code> when I ran <code>lake exe mk-all</code>) and I had no idea that this would change anything.</p>",
        "id": 520441701,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748263154
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/timing.20depends.20on.20whether.20file.20is.20in.20Mathlib.20dir.3F/near/520441701\">said</a>:</p>\n<blockquote>\n<p>(because I kept accidentally adding scratch files to <code>FLT.lean</code> when I ran <code>lake exe mk-all</code>)</p>\n</blockquote>\n<p>Have you tried using  <code>lake exe mk_all --git</code>, instead?</p>",
        "id": 520443525,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1748263620
    },
    {
        "content": "<p>By the way, re the actual issue that you reported, I also observed that <code>import Mathlib</code> on projects that <em>depend</em> on mathlib seems faster than on mathlib <em>itself</em>.  I wonder if it is a similar underlying reason.</p>",
        "id": 520443854,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1748263699
    },
    {
        "content": "<p>Aah so you're saying that I can recover my 2x slowdown by using this <code>mk-all</code> variant? :-)</p>",
        "id": 520444023,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748263744
    },
    {
        "content": "<p>Exactly!</p>",
        "id": 520444128,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1748263765
    },
    {
        "content": "<p>And then we can close this thread as resolved.</p>",
        "id": 520444161,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1748263775
    },
    {
        "content": "<p>sorry i'm not exactly sure i understand what the conclusion was</p>",
        "id": 520444833,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1748263937
    },
    {
        "content": "<p>it has to do with the <code>mk_all</code> file?</p>",
        "id": 520444928,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1748263960
    },
    {
        "content": "<p>but the scratch files are not in the <code>mk_all</code> file</p>",
        "id": 520444952,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1748263971
    },
    {
        "content": "<p>No, I think that Kevin found out about the issue because <code>mk_all</code> was adding non-git-tracked files to <code>import all</code>.</p>",
        "id": 520445785,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1748264168
    },
    {
        "content": "<p>I simply mentioned that <code>lake exe mk_all --git</code> would only create an <code>import all-git-tracked</code> file.</p>",
        "id": 520445871,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1748264193
    },
    {
        "content": "<p>The slowdown is still unresolved.  If Kevin had known about the <code>--git</code> flag, this issue would have been preempted, since no one would have never noticed.</p>",
        "id": 520446020,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1748264231
    },
    {
        "content": "<p>yeah mk_all caused the discovery but has nothing to do with the problem. I would like to compare traces but I don't know how to dump the trace of the file not in the Mathlib directory to a file.</p>",
        "id": 520446273,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748264299
    },
    {
        "content": "<p><code>lake env lean yourfile.lean</code> or maybe <code>lake lean yourfile.lean</code>?</p>",
        "id": 520447867,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748264730
    },
    {
        "content": "<p>Looking at the traces manually and there is a difference in typeclass synthesis. In the slow file</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>[synthInstance] [0.472236] âœ…ï¸ LieRing (FiniteAdeleRing (ğ“ F) F) â–¼\n  [] [0.041777] âœ…ï¸ apply @RestrictedProduct.instRingCoeOfSubringClass to Ring (FiniteAdeleRing (ğ“ F) F) â–¶\n  [] [0.014545] âœ…ï¸ apply @UniformSpace.Completion.ring to (i : HeightOneSpectrum (ğ“ F)) â†’\n        Ring (HeightOneSpectrum.adicCompletion F i) â–¶\n  [] [0.292250] âŒï¸ apply WithIdeal.instNonarchimedeanRing to âˆ€ (i : HeightOneSpectrum (ğ“ F)),\n        NonarchimedeanRing (WithVal (HeightOneSpectrum.valuation F i)) â–¶\n  [] [0.074443] âœ…ï¸ apply @ValuationSubring.instSubringClass to âˆ€ (i : HeightOneSpectrum (ğ“ F)),\n        SubringClass (ValuationSubring (HeightOneSpectrum.adicCompletion F i))\n          (HeightOneSpectrum.adicCompletion F i) â–¶\n  [check] [0.018059] âœ…ï¸ LieRing.ofAssociativeRing\n[] [0.019343] âœ…ï¸ SubNegMonoid.toAddMonoid =?= SubNegMonoid.toAddMonoid â–¼\n</code></pre></div>\n<p>and in the fast file (again let me stress that this is character-for-character <em>the same file</em>, just in a different location)</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>[synthInstance] [0.060356] âœ…ï¸ LieRing (FiniteAdeleRing (ğ“ F) F) â–¼\n  [] [0.014654] âœ…ï¸ apply @UniformSpace.Completion.ring to (i : HeightOneSpectrum (ğ“ F)) â†’\n        Ring (HeightOneSpectrum.adicCompletion F i) â–¶\n  [] [0.010935] âœ…ï¸ apply @ValuationSubring.instSubringClass to âˆ€ (i : HeightOneSpectrum (ğ“ F)),\n        SubringClass (ValuationSubring (HeightOneSpectrum.adicCompletion F i))\n          (HeightOneSpectrum.adicCompletion F i) â–¶\n[] [0.012450] âœ…ï¸ SubNegMonoid.toAddMonoid =?= SubNegMonoid.toAddMonoid â–¶\n</code></pre></div>",
        "id": 520449703,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748265164
    },
    {
        "content": "<p>so typeclass inference seems to be behaving differently in the two files <em>shrug</em></p>",
        "id": 520450072,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748265262
    },
    {
        "content": "<p>Yes, I also see different type class inference traces:<br>\noutside Mathlib</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">[</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">command</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.921671</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.000249</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.000648</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">CommSemiring</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.003443</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">step</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.583382</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"n\">not</span><span class=\"bp\">-</span><span class=\"n\">available</span><span class=\"bp\">&gt;</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">term</span>\n<span class=\"w\">      </span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">    </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.583282</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"w\"> </span><span class=\"n\">u_2</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">term</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">      </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.583269</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"w\"> </span><span class=\"n\">u_2</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">term</span>\n<span class=\"w\">          </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">        </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.583139</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"w\"> </span><span class=\"n\">u_2</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">term</span>\n<span class=\"w\">            </span><span class=\"n\">TensorProduct</span><span class=\"bp\">âœ</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">          </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.012553</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">term</span>\n<span class=\"w\">              </span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">            </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.000124</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">            </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.000220</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">            </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.000436</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">IsDedekindDomain</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">            </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.000023</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">            </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.004494</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">            </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.000851</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">IsFractionRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">          </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.000563</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">CommSemiring</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">          </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.023315</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">          </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.102239</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">          </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.006492</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">          </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.383813</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">          </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">isDefEq</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.053174</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">18716</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"n\">LieAlgebra</span><span class=\"bp\">.</span><span class=\"n\">toModule</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.328889</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">    </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.000074</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">goal</span><span class=\"w\"> </span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">    </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.215802</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">TensorProduct</span><span class=\"bp\">.</span><span class=\"n\">instSemiring</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">isDefEq</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.065836</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">check</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.046707</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">TensorProduct</span><span class=\"bp\">.</span><span class=\"n\">instSemiring</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">    </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">TensorProduct</span><span class=\"bp\">.</span><span class=\"n\">instSemiring</span>\n</code></pre></div>\n<p>inside Mathlib</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">[</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">command</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.831129</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.000151</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.000483</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">CommSemiring</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.002658</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">step</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.689016</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"n\">not</span><span class=\"bp\">-</span><span class=\"n\">available</span><span class=\"bp\">&gt;</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">term</span>\n<span class=\"w\">      </span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">    </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.688925</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"w\"> </span><span class=\"n\">u_2</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">term</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">      </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.688914</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"w\"> </span><span class=\"n\">u_2</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">term</span>\n<span class=\"w\">          </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">        </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.688803</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"w\"> </span><span class=\"n\">u_2</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">term</span>\n<span class=\"w\">            </span><span class=\"n\">TensorProduct</span><span class=\"bp\">âœ</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">          </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.000096</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">          </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.000171</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">          </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.000357</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">IsDedekindDomain</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">          </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.000017</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">          </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.003326</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">          </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.000598</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">IsFractionRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">          </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.000454</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">CommSemiring</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">          </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.008607</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">          </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.024117</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">          </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.004967</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">          </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.627383</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">          </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">isDefEq</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.017395</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">24839</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"n\">LieAlgebra</span><span class=\"bp\">.</span><span class=\"n\">toModule</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.133231</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">    </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.000049</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">goal</span><span class=\"w\"> </span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">    </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.085615</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">TensorProduct</span><span class=\"bp\">.</span><span class=\"n\">instSemiring</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">      </span><span class=\"o\">[</span><span class=\"n\">tryResolve</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.085555</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â‰Ÿ</span><span class=\"w\"> </span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">        </span><span class=\"o\">[</span><span class=\"n\">isDefEq</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.051705</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">37432</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">37431</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">37433</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">          </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.051676</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">37432</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">37431</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">37433</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">            </span><span class=\"o\">[</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.002619</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">            </span><span class=\"o\">[</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.003738</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">            </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.043137</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">LieAlgebra</span><span class=\"bp\">.</span><span class=\"n\">toModule</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">toModule</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">              </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.043103</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">toModule</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">toModule</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">                </span><span class=\"o\">[</span><span class=\"n\">delta</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.043090</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">toModule</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">toModule</span><span class=\"w\"> </span><span class=\"bp\">â–¼</span>\n<span class=\"w\">                  </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.011402</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">FiniteAdeleRing</span><span class=\"bp\">.</span><span class=\"n\">instAlgebra</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">37438</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">                  </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.031641</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">Ring</span><span class=\"bp\">.</span><span class=\"n\">toSemiring</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"n\">CommSemiring</span><span class=\"bp\">.</span><span class=\"n\">toSemiring</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">        </span><span class=\"o\">[</span><span class=\"n\">isDefEq</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.033624</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">37421</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">TensorProduct</span><span class=\"bp\">.</span><span class=\"n\">instSemiring</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">      </span><span class=\"o\">[</span><span class=\"n\">answer</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.000011</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">isDefEq</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.034688</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">check</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.012465</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">TensorProduct</span><span class=\"bp\">.</span><span class=\"n\">instSemiring</span><span class=\"w\"> </span><span class=\"bp\">â–¶</span>\n<span class=\"w\">    </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">TensorProduct</span><span class=\"bp\">.</span><span class=\"n\">instSemiring</span>\n</code></pre></div>\n<p>that's surprising.</p>",
        "id": 520450608,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1748265399
    },
    {
        "content": "<p>I have no idea whether this is anything to do with anything, but with <code>pp.explicit true</code> the quick file has this in the trace:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">isDefEq</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">29.000000</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">HeightOneSpectrum</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">i2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â†’</span>\n<span class=\"w\">          </span><span class=\"n\">SetLike</span>\n<span class=\"w\">            </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">ValuationSubring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">HeightOneSpectrum</span><span class=\"bp\">.</span><span class=\"n\">adicCompletion</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">i2</span><span class=\"w\"> </span><span class=\"n\">i3</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">i1</span><span class=\"w\"> </span><span class=\"n\">i4</span><span class=\"w\"> </span><span class=\"n\">i5</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span>\n<span class=\"w\">              </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">UniformSpace</span><span class=\"bp\">.</span><span class=\"n\">Completion</span><span class=\"bp\">.</span><span class=\"n\">instField</span>\n<span class=\"w\">                </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">WithVal</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithZero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">))</span>\n<span class=\"w\">                  </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">WithZero</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrderedCommGroupWithZero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span>\n<span class=\"bp\">...</span>\n</code></pre></div>\n<p>and the slow file has this</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">isDefEq</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">698518.000000</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">âœ…ï¸</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">HeightOneSpectrum</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">i2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â†’</span>\n<span class=\"w\">          </span><span class=\"n\">SetLike</span>\n<span class=\"w\">            </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">ValuationSubring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">HeightOneSpectrum</span><span class=\"bp\">.</span><span class=\"n\">adicCompletion</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">i2</span><span class=\"w\"> </span><span class=\"n\">i3</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">i1</span><span class=\"w\"> </span><span class=\"n\">i4</span><span class=\"w\"> </span><span class=\"n\">i5</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span>\n<span class=\"w\">              </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">UniformSpace</span><span class=\"bp\">.</span><span class=\"n\">Completion</span><span class=\"bp\">.</span><span class=\"n\">instField</span>\n<span class=\"w\">                </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">WithVal</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithZero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">))</span>\n<span class=\"w\">                  </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">WithZero</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrderedCommGroupWithZero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span>\n<span class=\"bp\">...</span>\n</code></pre></div>\n<p>and the two very long terms, when written out in full, have the following diff:</p>\n<div class=\"codehilite\" data-code-language=\"Diff\"><pre><span></span><code><span class=\"gu\">1c1</span>\n<span class=\"gd\">&lt;     [isDefEq] [698518.000000] âœ…ï¸ (i : @HeightOneSpectrum A i2) â†’</span>\n<span class=\"gs\">---</span>\n<span class=\"gi\">&gt;     [isDefEq] [29.000000] âœ…ï¸ (i : @HeightOneSpectrum A i2) â†’</span>\n54c54\n<span class=\"gd\">&lt;                     (@Multiplicative.linearOrder Int Int.instLinearOrder) â‹¯)</span>\n<span class=\"gs\">---</span>\n<span class=\"gi\">&gt;                     (@Multiplicative.linearOrder Int Int.instLinearOrder) HeightOneSpectrum.intValuation._proof_1)</span>\n66c66\n<span class=\"gd\">&lt;                       (@Multiplicative.linearOrder Int Int.instLinearOrder) â‹¯)</span>\n<span class=\"gs\">---</span>\n<span class=\"gi\">&gt;                       (@Multiplicative.linearOrder Int Int.instLinearOrder) HeightOneSpectrum.intValuation._proof_1)</span>\n72c72\n<span class=\"gd\">&lt;                     (@Multiplicative.linearOrder Int Int.instLinearOrder) â‹¯)</span>\n<span class=\"gs\">---</span>\n<span class=\"gi\">&gt;                     (@Multiplicative.linearOrder Int Int.instLinearOrder) HeightOneSpectrum.intValuation._proof_1)</span>\n76c76\n<span class=\"gd\">&lt;                       (@Multiplicative.linearOrder Int Int.instLinearOrder) â‹¯)</span>\n<span class=\"gs\">---</span>\n<span class=\"gi\">&gt;                       (@Multiplicative.linearOrder Int Int.instLinearOrder) HeightOneSpectrum.intValuation._proof_1)</span>\n</code></pre></div>\n<p>I don't really know what the <code>...</code>s mean, is it likely that the terms are different because of some earlier divergence, or that the terms are the same but are being printed differently? Note the gigantic change in runtime for the defeq check.</p>",
        "id": 520484570,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748274285
    },
    {
        "content": "<p><code>...</code> looks like a printing setting, which the lakefile only sets for mathlib</p>",
        "id": 520486876,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748275147
    },
    {
        "content": "<p>(or turns off for mathlib, one of the two)</p>",
        "id": 520486893,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748275155
    },
    {
        "content": "<p>I think <a href=\"https://github.com/leanprover-community/mathlib4/blob/cdf00c3262877ba8a9c34e58215d2a31dee64adb/lakefile.lean#L57\">https://github.com/leanprover-community/mathlib4/blob/cdf00c3262877ba8a9c34e58215d2a31dee64adb/lakefile.lean#L57</a> is the answer to this thread</p>",
        "id": 520487103,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748275233
    },
    {
        "content": "<p>Yes I believe you -- well spotted. I had found this monster example below, which was elaborating differently inside and outside mathlib, and indeed if I change <code>maxSynthPendingDepth</code> then it changes elaboration of the term.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"n\">run_cmd</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Command</span><span class=\"bp\">.</span><span class=\"n\">lintersRef</span><span class=\"bp\">.</span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[]</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">versionString</span>\n\n<span class=\"n\">suppress_compilation</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">i1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">i2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">i3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsDedekindDomain</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">i4</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">i5</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsFractionRing</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">IsDedekindDomain</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">maxSynthPendingDepth</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"c1\">-- changing this changes things</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">pp</span><span class=\"bp\">.</span><span class=\"n\">all</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">count_heartbeats</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">HeightOneSpectrum</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">i2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â†’</span>\n<span class=\"w\">                        </span><span class=\"n\">SetLike</span>\n<span class=\"w\">                          </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">ValuationSubring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">HeightOneSpectrum</span><span class=\"bp\">.</span><span class=\"n\">adicCompletion</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">i2</span><span class=\"w\"> </span><span class=\"n\">i3</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">i1</span><span class=\"w\"> </span><span class=\"n\">i4</span><span class=\"w\"> </span><span class=\"n\">i5</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span>\n<span class=\"w\">                            </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">UniformSpace</span><span class=\"bp\">.</span><span class=\"n\">Completion</span><span class=\"bp\">.</span><span class=\"n\">instField</span>\n<span class=\"w\">                              </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">WithVal</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithZero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">))</span>\n<span class=\"w\">                                </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">WithZero</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrderedCommGroupWithZero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span>\n<span class=\"w\">                                  </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"n\">commGroup</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instAddCommGroup</span><span class=\"o\">)</span>\n<span class=\"w\">                                  </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"n\">linearOrder</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrder</span><span class=\"o\">)</span>\n<span class=\"w\">                                  </span><span class=\"n\">HeightOneSpectrum</span><span class=\"bp\">.</span><span class=\"n\">intValuation</span><span class=\"bp\">._</span><span class=\"n\">proof_1</span><span class=\"o\">)</span>\n<span class=\"w\">                                </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">DivisionRing</span><span class=\"bp\">.</span><span class=\"n\">toRing</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Field</span><span class=\"bp\">.</span><span class=\"n\">toDivisionRing</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">i1</span><span class=\"o\">))</span>\n<span class=\"w\">                                </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">HeightOneSpectrum</span><span class=\"bp\">.</span><span class=\"n\">valuation</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">i2</span><span class=\"w\"> </span><span class=\"n\">i3</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">i1</span><span class=\"w\"> </span><span class=\"n\">i4</span><span class=\"w\"> </span><span class=\"n\">i5</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">))</span>\n<span class=\"w\">                              </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">WithVal</span><span class=\"bp\">.</span><span class=\"n\">instField</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithZero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">))</span>\n<span class=\"w\">                                </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">WithZero</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrderedCommGroupWithZero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span>\n<span class=\"w\">                                  </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"n\">commGroup</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instAddCommGroup</span><span class=\"o\">)</span>\n<span class=\"w\">                                  </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"n\">linearOrder</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrder</span><span class=\"o\">)</span>\n<span class=\"w\">                                  </span><span class=\"n\">HeightOneSpectrum</span><span class=\"bp\">.</span><span class=\"n\">intValuation</span><span class=\"bp\">._</span><span class=\"n\">proof_1</span><span class=\"o\">)</span>\n<span class=\"w\">                                </span><span class=\"n\">i1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">HeightOneSpectrum</span><span class=\"bp\">.</span><span class=\"n\">valuation</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">i2</span><span class=\"w\"> </span><span class=\"n\">i3</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">i1</span><span class=\"w\"> </span><span class=\"n\">i4</span><span class=\"w\"> </span><span class=\"n\">i5</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">))</span>\n<span class=\"w\">                              </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Valued</span><span class=\"bp\">.</span><span class=\"n\">toUniformSpace</span>\n<span class=\"w\">                                </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">WithVal</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithZero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">))</span>\n<span class=\"w\">                                  </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">WithZero</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrderedCommGroupWithZero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span>\n<span class=\"w\">                                    </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"n\">commGroup</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instAddCommGroup</span><span class=\"o\">)</span>\n<span class=\"w\">                                    </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"n\">linearOrder</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrder</span><span class=\"o\">)</span>\n<span class=\"w\">                                    </span><span class=\"n\">HeightOneSpectrum</span><span class=\"bp\">.</span><span class=\"n\">intValuation</span><span class=\"bp\">._</span><span class=\"n\">proof_1</span><span class=\"o\">)</span>\n<span class=\"w\">                                  </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">DivisionRing</span><span class=\"bp\">.</span><span class=\"n\">toRing</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Field</span><span class=\"bp\">.</span><span class=\"n\">toDivisionRing</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">i1</span><span class=\"o\">))</span>\n<span class=\"w\">                                  </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">HeightOneSpectrum</span><span class=\"bp\">.</span><span class=\"n\">valuation</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">i2</span><span class=\"w\"> </span><span class=\"n\">i3</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">i1</span><span class=\"w\"> </span><span class=\"n\">i4</span><span class=\"w\"> </span><span class=\"n\">i5</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">))</span>\n<span class=\"w\">                                </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">WithVal</span><span class=\"bp\">.</span><span class=\"n\">instRing</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithZero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">))</span>\n<span class=\"w\">                                  </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">WithZero</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrderedCommGroupWithZero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span>\n<span class=\"w\">                                    </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"n\">commGroup</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instAddCommGroup</span><span class=\"o\">)</span>\n<span class=\"w\">                                    </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"n\">linearOrder</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrder</span><span class=\"o\">)</span>\n<span class=\"w\">                                    </span><span class=\"n\">HeightOneSpectrum</span><span class=\"bp\">.</span><span class=\"n\">intValuation</span><span class=\"bp\">._</span><span class=\"n\">proof_1</span><span class=\"o\">)</span>\n<span class=\"w\">                                  </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">DivisionRing</span><span class=\"bp\">.</span><span class=\"n\">toRing</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Field</span><span class=\"bp\">.</span><span class=\"n\">toDivisionRing</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">i1</span><span class=\"o\">))</span>\n<span class=\"w\">                                  </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">HeightOneSpectrum</span><span class=\"bp\">.</span><span class=\"n\">valuation</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">i2</span><span class=\"w\"> </span><span class=\"n\">i3</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">i1</span><span class=\"w\"> </span><span class=\"n\">i4</span><span class=\"w\"> </span><span class=\"n\">i5</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">))</span>\n<span class=\"w\">                                </span><span class=\"o\">(</span><span class=\"n\">WithZero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">))</span>\n<span class=\"w\">                                </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">WithZero</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrderedCommGroupWithZero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span>\n<span class=\"w\">                                  </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"n\">commGroup</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instAddCommGroup</span><span class=\"o\">)</span>\n<span class=\"w\">                                  </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"n\">linearOrder</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrder</span><span class=\"o\">)</span>\n<span class=\"w\">                                  </span><span class=\"n\">HeightOneSpectrum</span><span class=\"bp\">.</span><span class=\"n\">intValuation</span><span class=\"bp\">._</span><span class=\"n\">proof_1</span><span class=\"o\">)</span>\n<span class=\"w\">                                </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">WithVal</span><span class=\"bp\">.</span><span class=\"n\">instValued</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithZero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">))</span>\n<span class=\"w\">                                  </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">WithZero</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrderedCommGroupWithZero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span>\n<span class=\"w\">                                    </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"n\">commGroup</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instAddCommGroup</span><span class=\"o\">)</span>\n<span class=\"w\">                                    </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"n\">linearOrder</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrder</span><span class=\"o\">)</span>\n<span class=\"w\">                                    </span><span class=\"n\">HeightOneSpectrum</span><span class=\"bp\">.</span><span class=\"n\">intValuation</span><span class=\"bp\">._</span><span class=\"n\">proof_1</span><span class=\"o\">)</span>\n<span class=\"w\">                                  </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">DivisionRing</span><span class=\"bp\">.</span><span class=\"n\">toRing</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Field</span><span class=\"bp\">.</span><span class=\"n\">toDivisionRing</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">i1</span><span class=\"o\">))</span>\n<span class=\"w\">                                  </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">HeightOneSpectrum</span><span class=\"bp\">.</span><span class=\"n\">valuation</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">i2</span><span class=\"w\"> </span><span class=\"n\">i3</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">i1</span><span class=\"w\"> </span><span class=\"n\">i4</span><span class=\"w\"> </span><span class=\"n\">i5</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)))</span>\n<span class=\"w\">                              </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">))</span>\n<span class=\"w\">                          </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">HeightOneSpectrum</span><span class=\"bp\">.</span><span class=\"n\">adicCompletion</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">i2</span><span class=\"w\"> </span><span class=\"n\">i3</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">i1</span><span class=\"w\"> </span><span class=\"n\">i4</span><span class=\"w\"> </span><span class=\"n\">i5</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 520488198,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748275592
    },
    {
        "content": "<p>With <code>maxSynthPendingDepth</code> set to 0 the term starts</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">IsDedekindDomain</span><span class=\"bp\">.</span><span class=\"n\">HeightOneSpectrum</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">i2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"bp\">@</span><span class=\"n\">ValuationSubring</span><span class=\"bp\">.</span><span class=\"n\">instSetLike</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">IsDedekindDomain</span><span class=\"bp\">.</span><span class=\"n\">HeightOneSpectrum</span><span class=\"bp\">.</span><span class=\"n\">adicCompletion</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">i2</span><span class=\"w\"> </span><span class=\"n\">i3</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">i1</span><span class=\"w\"> </span><span class=\"n\">i4</span><span class=\"w\"> </span><span class=\"n\">i5</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">UniformSpace</span><span class=\"bp\">.</span><span class=\"n\">Completion</span><span class=\"bp\">.</span><span class=\"n\">instField</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">WithVal</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithZero</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">))</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">WithZero</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrderedCommGroupWithZero</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span>\n<span class=\"w\">          </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"n\">commGroup</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instAddCommGroup</span><span class=\"o\">)</span>\n<span class=\"w\">          </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"n\">linearOrder</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrder</span><span class=\"o\">)</span>\n<span class=\"w\">          </span><span class=\"n\">IsDedekindDomain</span><span class=\"bp\">.</span><span class=\"n\">HeightOneSpectrum</span><span class=\"bp\">.</span><span class=\"n\">intValuation</span><span class=\"bp\">._</span><span class=\"n\">proof_1</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">DivisionRing</span><span class=\"bp\">.</span><span class=\"n\">toRing</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Field</span><span class=\"bp\">.</span><span class=\"n\">toDivisionRing</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">i1</span><span class=\"o\">))</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">IsDedekindDomain</span><span class=\"bp\">.</span><span class=\"n\">HeightOneSpectrum</span><span class=\"bp\">.</span><span class=\"n\">valuation</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">i2</span><span class=\"w\"> </span><span class=\"n\">i3</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">i1</span><span class=\"w\"> </span><span class=\"n\">i4</span><span class=\"w\"> </span><span class=\"n\">i5</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">))</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">WithVal</span><span class=\"bp\">.</span><span class=\"n\">instField</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithZero</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">))</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">WithZero</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrderedCommGroupWithZero</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span>\n<span class=\"w\">          </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"n\">commGroup</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instAddCommGroup</span><span class=\"o\">)</span>\n<span class=\"w\">          </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"n\">linearOrder</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrder</span><span class=\"o\">)</span>\n<span class=\"w\">          </span><span class=\"n\">IsDedekindDomain</span><span class=\"bp\">.</span><span class=\"n\">HeightOneSpectrum</span><span class=\"bp\">.</span><span class=\"n\">intValuation</span><span class=\"bp\">._</span><span class=\"n\">proof_1</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"n\">i1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">IsDedekindDomain</span><span class=\"bp\">.</span><span class=\"n\">HeightOneSpectrum</span><span class=\"bp\">.</span><span class=\"n\">valuation</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">i2</span><span class=\"w\"> </span><span class=\"n\">i3</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">i1</span><span class=\"w\"> </span><span class=\"n\">i4</span><span class=\"w\"> </span><span class=\"n\">i5</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">))</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Valued</span><span class=\"bp\">.</span><span class=\"n\">toUniformSpace</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">}</span>\n<span class=\"bp\">...</span>\n</code></pre></div>\n<p>and with it set to 3 it looks like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">IsDedekindDomain</span><span class=\"bp\">.</span><span class=\"n\">HeightOneSpectrum</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">i2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"bp\">@</span><span class=\"n\">ValuationSubring</span><span class=\"bp\">.</span><span class=\"n\">instSetLike</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">IsDedekindDomain</span><span class=\"bp\">.</span><span class=\"n\">HeightOneSpectrum</span><span class=\"bp\">.</span><span class=\"n\">adicCompletion</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">i2</span><span class=\"w\"> </span><span class=\"n\">i3</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">i1</span><span class=\"w\"> </span><span class=\"n\">i4</span><span class=\"w\"> </span><span class=\"n\">i5</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">UniformSpace</span><span class=\"bp\">.</span><span class=\"n\">Completion</span><span class=\"bp\">.</span><span class=\"n\">instField</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">WithVal</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithZero</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">))</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">WithZero</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrderedCommGroupWithZero</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span>\n<span class=\"w\">          </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"n\">commGroup</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instAddCommGroup</span><span class=\"o\">)</span>\n<span class=\"w\">          </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"n\">linearOrder</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrder</span><span class=\"o\">)</span>\n<span class=\"w\">          </span><span class=\"n\">IsDedekindDomain</span><span class=\"bp\">.</span><span class=\"n\">HeightOneSpectrum</span><span class=\"bp\">.</span><span class=\"n\">intValuation</span><span class=\"bp\">._</span><span class=\"n\">proof_1</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">DivisionRing</span><span class=\"bp\">.</span><span class=\"n\">toRing</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Field</span><span class=\"bp\">.</span><span class=\"n\">toDivisionRing</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">i1</span><span class=\"o\">))</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">IsDedekindDomain</span><span class=\"bp\">.</span><span class=\"n\">HeightOneSpectrum</span><span class=\"bp\">.</span><span class=\"n\">valuation</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">i2</span><span class=\"w\"> </span><span class=\"n\">i3</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">i1</span><span class=\"w\"> </span><span class=\"n\">i4</span><span class=\"w\"> </span><span class=\"n\">i5</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">))</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">WithVal</span><span class=\"bp\">.</span><span class=\"n\">instField</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithZero</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">))</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">WithZero</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrderedCommGroupWithZero</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span>\n<span class=\"w\">          </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"n\">commGroup</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instAddCommGroup</span><span class=\"o\">)</span>\n<span class=\"w\">          </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"n\">linearOrder</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrder</span><span class=\"o\">)</span>\n<span class=\"w\">          </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"n\">isOrderedMonoid</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instAddCommMonoid</span>\n<span class=\"w\">            </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">SemilatticeInf</span><span class=\"bp\">.</span><span class=\"n\">toPartialOrder</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span>\n<span class=\"w\">              </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Lattice</span><span class=\"bp\">.</span><span class=\"n\">toSemilatticeInf</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span>\n<span class=\"w\">                </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">DistribLattice</span><span class=\"bp\">.</span><span class=\"n\">toLattice</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span>\n<span class=\"w\">                  </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">instDistribLatticeOfLinearOrder</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span>\n<span class=\"w\">                    </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"n\">linearOrder</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrder</span><span class=\"o\">)))))</span>\n<span class=\"w\">            </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instIsOrderedAddMonoid</span><span class=\"o\">))</span>\n<span class=\"w\">        </span><span class=\"n\">i1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">IsDedekindDomain</span><span class=\"bp\">.</span><span class=\"n\">HeightOneSpectrum</span><span class=\"bp\">.</span><span class=\"n\">valuation</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">i2</span><span class=\"w\"> </span><span class=\"n\">i3</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">i1</span><span class=\"w\"> </span><span class=\"n\">i4</span><span class=\"w\"> </span><span class=\"n\">i5</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">))</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Valued</span><span class=\"bp\">.</span><span class=\"n\">toUniformSpace</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">}</span>\n<span class=\"bp\">...</span>\n</code></pre></div>",
        "id": 520489134,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748275905
    },
    {
        "content": "<p>In other words,</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">IsDedekindDomain</span><span class=\"bp\">.</span><span class=\"n\">HeightOneSpectrum</span><span class=\"bp\">.</span><span class=\"n\">intValuation</span><span class=\"bp\">._</span><span class=\"n\">proof_1</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"n\">isOrderedMonoid</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instAddCommMonoid</span>\n<span class=\"w\">            </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">SemilatticeInf</span><span class=\"bp\">.</span><span class=\"n\">toPartialOrder</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span>\n<span class=\"w\">              </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Lattice</span><span class=\"bp\">.</span><span class=\"n\">toSemilatticeInf</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span>\n<span class=\"w\">                </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">DistribLattice</span><span class=\"bp\">.</span><span class=\"n\">toLattice</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span>\n<span class=\"w\">                  </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">instDistribLatticeOfLinearOrder</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span>\n<span class=\"w\">                    </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"n\">linearOrder</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrder</span><span class=\"o\">)))))</span>\n<span class=\"w\">            </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instIsOrderedAddMonoid</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>are both proofs of <code>IsOrderedMonoid (Multiplicative â„¤)</code> and different ones are being found depending on the setting. Why does this affect IsDefEq though?</p>",
        "id": 520489772,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748276118
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/timing.20depends.20on.20whether.20file.20is.20in.20Mathlib.20dir.3F/near/520489772\">said</a>:</p>\n<blockquote>\n<p>In other words,</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">IsDedekindDomain</span><span class=\"bp\">.</span><span class=\"n\">HeightOneSpectrum</span><span class=\"bp\">.</span><span class=\"n\">intValuation</span><span class=\"bp\">._</span><span class=\"n\">proof_1</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"n\">isOrderedMonoid</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instAddCommMonoid</span>\n<span class=\"w\">            </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">SemilatticeInf</span><span class=\"bp\">.</span><span class=\"n\">toPartialOrder</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span>\n<span class=\"w\">              </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Lattice</span><span class=\"bp\">.</span><span class=\"n\">toSemilatticeInf</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span>\n<span class=\"w\">                </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">DistribLattice</span><span class=\"bp\">.</span><span class=\"n\">toLattice</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span>\n<span class=\"w\">                  </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">instDistribLatticeOfLinearOrder</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span>\n<span class=\"w\">                    </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"n\">linearOrder</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrder</span><span class=\"o\">)))))</span>\n<span class=\"w\">            </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instIsOrderedAddMonoid</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>are both proofs of <code>IsOrderedMonoid (Multiplicative â„¤)</code> and different ones are being found depending on the setting. Why does this affect IsDefEq though?</p>\n</blockquote>\n<p>The two proofs are actually the same, just one has been wrapped up</p>",
        "id": 520490952,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1748276531
    },
    {
        "content": "<p>Try <code>#print IsDedekindDomain.HeightOneSpectrum.intValuation._proof_1</code> and see the result</p>",
        "id": 520491082,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1748276579
    },
    {
        "content": "<p>Well sounds like I'm talking about a red herring then, but Eric's answer is certainly correct:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"n\">suppress_compilation</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NumberField</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">]</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">TotallyDefiniteQuaternionAlgebra</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">TensorProduct</span><span class=\"w\"> </span><span class=\"n\">NumberField</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">IsDedekindDomain</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstance</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstance</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">maxSynthPendingDepth</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">count_heartbeats</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"c1\">-- 6672</span>\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">maxSynthPendingDepth</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">count_heartbeats</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"c1\">-- 20002</span>\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">âŠ—</span><span class=\"o\">[</span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">FiniteAdeleRing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 520491362,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748276696
    }
]