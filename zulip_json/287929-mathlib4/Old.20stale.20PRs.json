[
    {
        "content": "<p>Hi! I was trying to start reviewing PRs on Mathlib for the first time, but got quite intimidated by the numbers. Then I had a look at the older PRs and it looks like most (or all?) of them are abandoned and now completely conflicted. I was discussing this with someone and he told me some repos use a bot who writes a comment (say after 1 month) saying if there is no activity in the next x days the PR will be closed. To keep it open you can just write a comment. I was wondering if we could maybe consider using such a bot to diminish the amount of open PRs? We could make the bot take into account dependencies obviously. I am assuming for the most experienced reviewers it is easy to filter what is what and understand which issues are active or not, but from my newbie viewpoint it feels it would help at the entry level.</p>",
        "id": 534944044,
        "sender_full_name": "Laura Monk",
        "timestamp": 1755521020
    },
    {
        "content": "<p>You can try commenting on the PR to get the author to do something</p>",
        "id": 534944142,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1755521060
    },
    {
        "content": "<p>You can check <a href=\"https://leanprover-community.github.io/queueboard/review_dashboard.html\">https://leanprover-community.github.io/queueboard/review_dashboard.html</a> for the \"active, ready for review\" PRs.</p>",
        "id": 534944309,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1755521114
    },
    {
        "content": "<p>Sure, but is there really an advantage to keeping a lot of abandoned PRs which will never be merged open?</p>",
        "id": 534944452,
        "sender_full_name": "Laura Monk",
        "timestamp": 1755521170
    },
    {
        "content": "<p>We actually have <a href=\"https://github.com/leanprover-community/mathlib4/blob/master/.github/workflows/stale.yml\">some automation</a> that we were testing for this, but <del>it broke</del> I broke it and didn't get around to fixing it while awaiting further maintainer discussion. I believe there should be some movement on this front in the near future!</p>",
        "id": 534945619,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1755521590
    },
    {
        "content": "<p>Nice, thank you! Looking forward to it :)</p>",
        "id": 534945733,
        "sender_full_name": "Laura Monk",
        "timestamp": 1755521627
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"938037\">@Laura Monk</span> Also, thanks a lot for wanting to help with reviews! Much appreciated!</p>",
        "id": 534945738,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1755521629
    },
    {
        "content": "<p>It turns out there's a lot of good stuff in some old PRs, which is why I am reluctant to close them. From time to time I look around and revive a few</p>",
        "id": 534975396,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1755530923
    },
    {
        "content": "<p>Also note that we moved to a fork-based workflow two months ago, and a lot of people haven't yet closed their PRs made from branches, even though they won't be able to edit them further</p>",
        "id": 534975916,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1755531073
    },
    {
        "content": "<p>There are mathlib3 PRs to be rescued too and I've suggested that the repo may need to be un-archived in order for PRs to be searchable. (Update: <a href=\"https://github.com/orgs/community/discussions/170753\">reported to Github</a>)</p>",
        "id": 534976517,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1755531292
    },
    {
        "content": "<p>Also please please delete the branch when you close a PR. A week ago we have 6.5k branches on the mathlib repo, and a lot of people copied all 6.5k of them to their fork when switching to a fork-based workflow (doesn't help that this is what github does by default when you try to edit a file in mathlib from the interface...), which in turn means that I cannot review PRs from many people simultaneously, because to review PRs from N different people I need to clone N different forks and their 6.5k * N branches. For not even that big values of N, this makes branch switching from within the vscode UI impossibly slow.</p>",
        "id": 534977326,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1755531543
    },
    {
        "content": "<p>I just ran the migrate to fork script and it copied all the branches when I ran it</p>",
        "id": 534977489,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1755531600
    },
    {
        "content": "<p>I suspect this is what happened for many other people too</p>",
        "id": 534977551,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1755531617
    },
    {
        "content": "<p>I thought so too, but I wasn't sure because I didn't run it</p>",
        "id": 534977585,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1755531628
    },
    {
        "content": "<p>Just by deleting branches from closed PRs and obsolete pr-testing branches, I got that number down to 2.2k branches!</p>",
        "id": 534977668,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1755531652
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/channel/287929-mathlib4/topic/New.20contribution.20model.3A.20PRs.20from.20forks/near/524722970\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"224323\">Junyan Xu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/New.20contribution.20model.3A.20PRs.20from.20forks/near/524722590\">said</a>:</p>\n<blockquote>\n<p>So now if I want to review a PR locally (not in Gitpod/codespace) I'll need to add the author's fork as a remote. The git command is nontrivial to type. Can we add a VS Code command in the palette or a lake command to minimize typing / memorization?</p>\n</blockquote>\n<p><code>gh pr checkout 12345</code> should work, which I think is similar in difficulty to the old approach of <code>git checkout some_branch_name</code>.</p>\n</blockquote>\n<p>Does this solution clone the whole repo or just check out the branch? I haven't really tried as I'm still mostly relying on Gitpod for PR reviews.</p>",
        "id": 534978570,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1755531955
    },
    {
        "content": "<p>I run it inside an existing clone.</p>",
        "id": 534978753,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1755532015
    },
    {
        "content": "<p>Yes, but a clone of the fork you're reviewing a PR from, or your own fork?</p>",
        "id": 534982661,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1755533281
    },
    {
        "content": "<p>gh pr checkout does it within your own fork</p>",
        "id": 534994650,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1755538713
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Old.20stale.20PRs/near/534977489\">said</a>:</p>\n<blockquote>\n<p>I just ran the migrate to fork script and it copied all the branches when I ran it</p>\n</blockquote>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/blob/2e1c3bafb2cca56a96e3713b2cf7241c0dc017fe/scripts/githelper.py#L321\"><code>githelper.py</code> only keeps the master branch when forking</a>, while <a href=\"https://github.com/leanprover-community/mathlib4/blob/2e1c3bafb2cca56a96e3713b2cf7241c0dc017fe/scripts/migrate_to_fork.py#L293\"><code>migrate_to_fork.py</code> keeps all branches (the default behavior)</a>. Probably worth a PR.</p>\n<p>Maybe <code>githelper.py</code> could gain a command to delete all branches in your own fork except those mentioned by your own open PRs?</p>",
        "id": 535150420,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1755616022
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"308899\">Yakov Pechersky</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Old.20stale.20PRs/near/534994650\">said</a>:</p>\n<blockquote>\n<p>gh pr checkout does it within your own fork</p>\n</blockquote>\n<p><code>gh pr checkout</code> does <em>not</em> add the branch to your own <em>fork</em>, only to your local repo. It does not require adding a separate remote or anything, and only checks out the single branch from the PR.</p>\n<p>(For those interested in the details: A repo on GitHub basically has a hidden branch for every PR, even if the PR itself comes from a branch in a different repo. <code>gh pr checkout</code> checks out that hidden branch and gives it a nice name locally. Thus there's no need to add the repo the PR comes from as a remote.)</p>\n<p>A <em>fork</em> here is a GitHub-specific term for a repo on GitHub that's been forked (split off/based on) from another repo on GitHub. Your locally cloned repo is a separate thing that can have multiple other repos as remotes. Usually those remotes include both your fork as well as the original GitHub repo that it was forked from, but there may also be other remotes.</p>",
        "id": 535152052,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1755616521
    },
    {
        "content": "<p>Opened a PR that limits forks to only the <code>master</code> branch when using <code>migrate_to_fork.py</code>: <a href=\"https://github.com/leanprover-community/mathlib4/pull/28643\">#28643</a></p>",
        "id": 535154879,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1755617303
    },
    {
        "content": "<p>Yes, sorry, I meant shorthand for the local on-machine clone.</p>",
        "id": 535164312,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1755620376
    },
    {
        "content": "<p>I've now opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/28657\">#28657</a> which adds a <code>prune</code> subcommand to <code>githelper.py</code> that deletes unused branches in your fork (i.e. branches that are not used in any open PRs). Branches in your local clone are not affected. I'd appreciate any feedback.</p>\n<p>To try it out with your fork, run</p>\n<ol>\n<li><code>gh pr checkout 28657</code></li>\n<li><code>python scripts/githelper.py prune</code> (add <code>--help</code> to see available options)</li>\n</ol>",
        "id": 535177963,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1755625912
    },
    {
        "content": "<p>I'm happy to merge on the basis of someone reporting that it works for them. :-)</p>",
        "id": 535224626,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1755653873
    }
]