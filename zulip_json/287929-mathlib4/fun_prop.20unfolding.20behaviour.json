[
    {
        "content": "<p>I just learned (via <a href=\"https://github.com/leanprover-community/mathlib4/pull/33998\">#33998</a>) about <code>fun_prop [c]</code> --- according to the documentation there, it will unfold <code>c</code> and then apply fun_prop. However, there are cases in mathlib where replacing <code>unfold foo; fun_prop</code> by <code>fun_prop [foo]</code> does not work. Is this expected/can it be described when this holds? If not, I'm happy to debug further.</p>",
        "id": 568203096,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1768481773
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/34000\">#34000</a> has a few working golfs, and comments on the failing golfs.</p>",
        "id": 568204041,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1768482005
    },
    {
        "content": "<p>Here is one example that fails, in Mathlib.Data.Real.Sqrt, line 123:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">continuity</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">fun_prop</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">continuous_sqrt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Continuous</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">√·</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"c1\">-- TODO: why does this fail? fun_prop [sqrt]</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">sqrt</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">fun_prop</span>\n</code></pre></div>\n<p>(This is not an MWE, as importing mathlib makes it harder to make one.)<br>\nReplacing the local notation \\sqrt by Real.sqrt does not make a difference.</p>",
        "id": 568204273,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1768482066
    },
    {
        "content": "<p>CC <span class=\"user-mention\" data-user-id=\"346070\">@Tomas Skrivan</span> perhaps you can help me investigate this.</p>",
        "id": 568204317,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1768482079
    },
    {
        "content": "<p>Ohh that feature was never really used and tested. Might make sense to remove it, or do you want to keep it and debug it?</p>",
        "id": 568206416,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1768482668
    },
    {
        "content": "<p>My suspicion is that: If <code>sqrt</code> is typeclass field(like other arithmetic operations like <code>+</code>) then <code>fun_prop</code> is likely doing some naive unfolding which just results in structure projection like <code>instSqrtReal.1</code> which then confuses <code>fun_prop</code>.</p>",
        "id": 568207352,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1768482967
    },
    {
        "content": "<p>Unfortunately, I don't have the time right now to look into the code more deeply</p>",
        "id": 568207416,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1768482989
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"346070\">Tomas Skrivan</span> <a href=\"#narrow/channel/287929-mathlib4/topic/fun_prop.20unfolding.20behaviour/near/568207352\">said</a>:</p>\n<blockquote>\n<p>My suspicion is that: If <code>sqrt</code> is typeclass field(like other arithmetic operations like <code>+</code>) [...]</p>\n</blockquote>\n<p>It's not.</p>",
        "id": 568208479,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1768483277
    },
    {
        "content": "<p>aha</p>",
        "id": 568316256,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1768513278
    },
    {
        "content": "<p>if I make <code>Real.sqrt</code> not irreducible then it works</p>",
        "id": 568316279,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1768513286
    },
    {
        "content": "<p>oh and I also need to use the full name <code>Real.sqrt</code> instead of just <code>sqrt</code></p>",
        "id": 568316375,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1768513334
    },
    {
        "content": "<p>so that's two things</p>",
        "id": 568316399,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1768513345
    },
    {
        "content": "<p>(Note that <code>Real.sqrt</code> was made <code>irreducible</code> for performance reasons not so long ago.)</p>",
        "id": 568317055,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1768513695
    }
]