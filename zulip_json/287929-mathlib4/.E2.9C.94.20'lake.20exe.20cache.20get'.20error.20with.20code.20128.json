[
    {
        "content": "<p>Hello! I'm new to Lean and started downloading mathlib to use a tool. Running 'lake exe cache get' first downloaded lean-4.15-0 successfully, then (omitting part of path due to privacy)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">installing</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">Users</span><span class=\"bp\">/.../.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.15.0</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">.</span><span class=\"n\">git</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">external</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">git'</span><span class=\"w\"> </span><span class=\"n\">exited</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mi\">128</span>\n</code></pre></div>\n<p>After that, I tried 'lake clean' which resulted in the same error and 'rm -rf .lake', but the same info and error repeat. I've seen a similar report but couldn't figure out what to do exactly.</p>",
        "id": 497943529,
        "sender_full_name": "V S",
        "timestamp": 1738775579
    },
    {
        "content": "<p>A report mentioned is: <a href=\"https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lake.20failing.20with.20git.20error.html\">https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lake.20failing.20with.20git.20error.html</a>, and the last comment seems to have figured something out, but I'm not sure what dependencies to clone</p>",
        "id": 497944005,
        "sender_full_name": "V S",
        "timestamp": 1738775740
    },
    {
        "content": "<p>Does the error message change if you run any of the lake commands with <code>-v</code>?</p>",
        "id": 497944408,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1738775878
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110024\">Sebastian Ullrich</span> <a href=\"#narrow/channel/287929-mathlib4/topic/'lake.20exe.20cache.20get'.20error.20with.20code.20128/near/497944408\">said</a>:</p>\n<blockquote>\n<p>Does the error message change if you run any of the lake commands with <code>-v</code>?</p>\n</blockquote>\n<p>No, it's the same: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">...</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">v</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">.</span><span class=\"n\">git</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">external</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">git'</span><span class=\"w\"> </span><span class=\"n\">exited</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mi\">128</span>\n</code></pre></div>\n<p>I should also mention that the error doesn't appear momentarily, the process seems to be running for 1-2 minutes without any notes below and the \"info\" and \"error\" appear at the same time</p>",
        "id": 497945310,
        "sender_full_name": "V S",
        "timestamp": 1738776133
    },
    {
        "content": "<p>Probably not the problem, but can you try to <code>git clone</code> something else, just to make sure the problem isn't your ssh-agent or something?</p>",
        "id": 497947148,
        "sender_full_name": "Nick Ward",
        "timestamp": 1738776727
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"776338\">Nick Ward</span> <a href=\"#narrow/channel/287929-mathlib4/topic/'lake.20exe.20cache.20get'.20error.20with.20code.20128/near/497947148\">said</a>:</p>\n<blockquote>\n<p>Probably not the problem, but can you try to <code>git clone</code> something else, just to make sure the problem isn't your ssh-agent or something?</p>\n</blockquote>\n<p>Another repository cloned fine, but thank you still!</p>",
        "id": 497947783,
        "sender_full_name": "V S",
        "timestamp": 1738776948
    },
    {
        "content": "<p>Forgot to mention that I'm using a macbook with ventura 13.0, not sure how helpful it is but the problem could be macos-related</p>",
        "id": 497949544,
        "sender_full_name": "V S",
        "timestamp": 1738777482
    },
    {
        "content": "<p>I guess you can try <code>cd .lake/packages; git clone https://github.com/leanprover-community/mathlib4.git mathlib</code> to see if Lake will use your clone</p>",
        "id": 497949961,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1738777594
    },
    {
        "content": "<p>(then go back to the parent directory and try <code>lake exe cache get</code> again)</p>",
        "id": 497951032,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1738777914
    },
    {
        "content": "<p>(I was imprecise, it should be <code>lake -v exe cache get</code> to make sure the flag goes to Lake, not Cache)</p>",
        "id": 497959355,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1738780752
    },
    {
        "content": "<p>After these two suggestions (the git clone did not work with https, but worked with ssh), 'lake exe cache get' had the same error, but 'lake -v exe cache get' had the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">.</span><span class=\"n\">git</span>\n<span class=\"n\">trace</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">.&gt;</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">clone</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">.</span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span>\n<span class=\"n\">trace</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"n\">Cloning</span><span class=\"w\"> </span><span class=\"n\">into</span><span class=\"w\"> </span><span class=\"bp\">'././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib'</span><span class=\"bp\">...</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">RPC</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">curl</span><span class=\"w\"> </span><span class=\"mi\">18</span><span class=\"w\"> </span><span class=\"n\">transfer</span><span class=\"w\"> </span><span class=\"n\">closed</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">outstanding</span><span class=\"w\"> </span><span class=\"n\">read</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"n\">remaining</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">4735</span><span class=\"w\"> </span><span class=\"n\">bytes</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">body</span><span class=\"w\"> </span><span class=\"n\">are</span><span class=\"w\"> </span><span class=\"n\">still</span><span class=\"w\"> </span><span class=\"n\">expected</span>\n<span class=\"n\">fetch</span><span class=\"bp\">-</span><span class=\"n\">pack</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unexpected</span><span class=\"w\"> </span><span class=\"n\">disconnect</span><span class=\"w\"> </span><span class=\"n\">while</span><span class=\"w\"> </span><span class=\"n\">reading</span><span class=\"w\"> </span><span class=\"n\">sideband</span><span class=\"w\"> </span><span class=\"n\">packet</span>\n<span class=\"n\">fatal</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">early</span><span class=\"w\"> </span><span class=\"n\">EOF</span>\n<span class=\"n\">fatal</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">fetch</span><span class=\"bp\">-</span><span class=\"n\">pack</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">invalid</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"bp\">-</span><span class=\"n\">pack</span><span class=\"w\"> </span><span class=\"n\">output</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">external</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">git'</span><span class=\"w\"> </span><span class=\"n\">exited</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mi\">128</span>\n</code></pre></div>\n<p>It seems like the problem could be related to my inability to git clone with https (i've seen similar problems and the only working solution for me was to use ssh) since the errors look like the ones I've gotten. Is there any way to manually clone all the necessary stuff using ssh? Or, to be more precise, where can I find everything needed for 'lake build' and in which directory to clone?</p>",
        "id": 497963768,
        "sender_full_name": "V S",
        "timestamp": 1738782230
    },
    {
        "content": "<p>Others might have something better to recommend, but you can force lake to use ssh by first running:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>git<span class=\"w\"> </span>config<span class=\"w\"> </span>--global<span class=\"w\"> </span>url.<span class=\"s2\">\"git@github.com:\"</span>.insteadOf<span class=\"w\"> </span><span class=\"s2\">\"https://github.com/\"</span>\n</code></pre></div>",
        "id": 497965311,
        "sender_full_name": "Nick Ward",
        "timestamp": 1738782652
    },
    {
        "content": "<p>This will update your global gitconfig, but you can undo the change with <code>git config --global --remove-section url.\"git@github.com:\"</code></p>",
        "id": 497965648,
        "sender_full_name": "Nick Ward",
        "timestamp": 1738782803
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"776338\">Nick Ward</span> <a href=\"#narrow/channel/287929-mathlib4/topic/'lake.20exe.20cache.20get'.20error.20with.20code.20128/near/497965311\">said</a>:</p>\n<blockquote>\n<p>Others might have something better to recommend, but you can force lake to use ssh by first running:</p>\n<p><div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>git<span class=\"w\"> </span>config<span class=\"w\"> </span>--global<span class=\"w\"> </span>url.<span class=\"s2\">\"git@github.com:\"</span>.insteadOf<span class=\"w\"> </span><span class=\"s2\">\"https://github.com/\"</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>After that, 'lake -v exe cache get' completed successfully, big thank you to everyone!</p>",
        "id": 497969525,
        "sender_full_name": "V S",
        "timestamp": 1738784209
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"874708\">V S</span> has marked this topic as resolved.</p>",
        "id": 497969552,
        "sender_full_name": "Notification Bot",
        "timestamp": 1738784219
    }
]