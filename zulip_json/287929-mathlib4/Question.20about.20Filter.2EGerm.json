[
    {
        "content": "<p>If <code>l : Filter α</code>, Mathlib defines <code>l.Germ</code> as a quotient of <code>α → β</code>. An alternative would be to define it as a quotient of <code>{f : PFun α β // f.Dom ∈ l}</code>. These are equivalent unless <code>IsEmpty (α → β) ∧ l = ⊥</code>, in which case the existing definition says <code>l.Germ</code> is empty, while the alternative says it's a singleton.</p>\n<p>Which version is standard? Which version is <em>better</em>? And if the answers to these questions disagree, which should Mathlib use?</p>",
        "id": 462853298,
        "sender_full_name": "finegeometer",
        "timestamp": 1723840731
    },
    {
        "content": "<p>I never needed germs along the bottom filter (and AFAIK lots of texts don't consider it to be a filter).</p>",
        "id": 462855909,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1723842015
    },
    {
        "content": "<p>I think changing this would be a bad move. We want to keep the coercion from functions to <code>Filter.Germ</code>. You should probably un-#xy and tell us why you think you need <code>PFun</code>. The mostly likely situation is that you should stick to functions.</p>",
        "id": 462998188,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723908818
    },
    {
        "content": "<p>You would still have a coercion from functions to <code>Filter.Germ</code> even with the change. I don't think there can be any question that the 'alternative' definition is in fact the correct one. For example, the type of germs should be the colimit of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>U</mi><mo>→</mo><mi>β</mi></mrow><annotation encoding=\"application/x-tex\">U \\to \\beta</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β</span></span></span></span> over <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>U</mi></mrow><annotation encoding=\"application/x-tex\">U</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span></span></span></span> in the filter. Also, the type of germs for the principal filter under <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>U</mi><mo>⊆</mo><mi>α</mi></mrow><annotation encoding=\"application/x-tex\">U \\subseteq \\alpha</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">⊆</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span></span></span></span> should be the type of functions <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>U</mi><mo>→</mo><mi>β</mi></mrow><annotation encoding=\"application/x-tex\">U \\to \\beta</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β</span></span></span></span> (even if <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>U</mi></mrow><annotation encoding=\"application/x-tex\">U</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span></span></span></span> is empty). Perhaps the situation is clearer if you think algebro-geometrically, where you can have lots of locally defined functions that don't extend to global functions but still define germs. I think this was discussed already many years ago, but I won't try to argue that this is an important issue or something that needs changing :-)</p>",
        "id": 463015228,
        "sender_full_name": "David Wärn",
        "timestamp": 1723914602
    },
    {
        "content": "<p>I was thinking along the same lines, but it's nice being able to take advantage of the existence of global functions (and to avoid some dependent types!)</p>\n<p>If Filter.Germ could let you restrict the class of functions then the correct definition would definitely be correct :-)</p>",
        "id": 463045550,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1723927123
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Question.20about.20Filter.2EGerm/near/462998188\">said</a>:</p>\n<blockquote>\n<p>You should probably un-#xy and tell us why you think you need <code>PFun</code>.</p>\n</blockquote>\n<p>This wasn't, in fact, an XY problem. I don't need this for anything. I was just looking at the definition, and something seemed a bit off, so I thought I'd ask.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"130377\">David Wärn</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Question.20about.20Filter.2EGerm/near/463015228\">said</a>:</p>\n<blockquote>\n<p>For example, the type of germs should be the colimit of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>U</mi><mo>→</mo><mi>β</mi></mrow><annotation encoding=\"application/x-tex\">U \\to \\beta</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β</span></span></span></span> over <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>U</mi></mrow><annotation encoding=\"application/x-tex\">U</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span></span></span></span> in the filter. Also, the type of germs for the principal filter under <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>U</mi><mo>⊆</mo><mi>α</mi></mrow><annotation encoding=\"application/x-tex\">U \\subseteq \\alpha</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">⊆</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span></span></span></span> should be the type of functions <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>U</mi><mo>→</mo><mi>β</mi></mrow><annotation encoding=\"application/x-tex\">U \\to \\beta</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β</span></span></span></span> (even if <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>U</mi></mrow><annotation encoding=\"application/x-tex\">U</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span></span></span></span> is empty).</p>\n</blockquote>\n<p>And this seems to formalize my intuition that something was slightly wrong. Thanks!</p>",
        "id": 463563433,
        "sender_full_name": "finegeometer",
        "timestamp": 1724122115
    },
    {
        "content": "<p>Generally, we try to be practical with definitions. E.g., <code>\\bot</code> is allowed as a <code>Filter _</code>, because this way we have <code>CompleteLattice (Filter _)</code>, even though many authors only work with <code>NeBot</code> filters. Similarly, we use globally defined functions, because this way we can avoid dependent types and proofs <code>x ∈ f.Dom</code> all over the place. If someone will need to deal with germs at the <code>\\bot</code> filter and it will be important to make this type nonempty even if the codomain is empty, then we can refactor (with the one who needs it leading the effort).</p>",
        "id": 463564818,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1724122400
    },
    {
        "content": "<p>That makes sense. It bugs me to have a slightly wrong definition, but you're right that it might not be worth the effort to fix.</p>",
        "id": 463567175,
        "sender_full_name": "finegeometer",
        "timestamp": 1724122868
    },
    {
        "content": "<p>If we change the definition as you suggest, then <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Germ.ofFun#doc\">docs#Germ.ofFun</a> will no longer be surjective, unless we assume <code>[NeBot l]</code> or <code>Nonempty β</code>. Then we'll have to either deal with these special cases in proofs, or add these assumptions in all lemmas.</p>",
        "id": 463582004,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1724126392
    },
    {
        "content": "<p>I would prefer to avoid it unless we need to.</p>",
        "id": 463582151,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1724126410
    }
]