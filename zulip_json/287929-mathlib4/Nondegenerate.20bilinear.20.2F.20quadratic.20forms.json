[
    {
        "content": "<p><em>Premable</em>: One of my students (Nick Trutmann, at ETH Zürich) recently formalized a proof of the \"uniqueness\" part of Sylvester's law of inertia (i.e. quadratic forms over the reals have a well-defined signature), which is a long-standing TODO item for Mathlib; and I was just looking at how exactly it should be formulated in order to best fit into the library.</p>\n<p><em>Question</em>: What is the \"preferred\" formulation of \"nondegeneracy of a bilinear / quadratic form\" in Mathlib? </p>\n<p>At the moment there is no definition for quadratic forms, and a welter of confusingly-slightly-different definitions for bilinear forms. We have </p>\n<ul>\n<li><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearMap.SeparatingLeft#doc\">docs#LinearMap.SeparatingLeft</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearMap.SeparatingRight#doc\">docs#LinearMap.SeparatingRight</a>: for bilinear maps <code>X × Y → K</code>, the assertion that there is no x with B x y = 0 for all y, resp. no y with B x y = 0 for all x (conditions which are equivalent if <code>dim X = dim Y &lt; ∞</code> or if a symmetry condition is present, which are the most important cases, but not in general).</li>\n<li><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearMap.Nondegenerate#doc\">docs#LinearMap.Nondegenerate</a>: condition of being both left-separating and right-separating.</li>\n<li><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearMap.BilinForm.Nondegenerate#doc\">docs#LinearMap.BilinForm.Nondegenerate</a>: copy of LinearMap.SeparatingLeft but assuming X = Y.</li>\n<li><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix.Nondegenerate#doc\">docs#Matrix.Nondegenerate</a>: matrix version of LinearMap.SeparatingLeft, again assuming X = Y.</li>\n</ul>\n<p>This is rather confusing, particularly the fact that LinearMap.BilinForm.Nondegenerate is not equivalent to LinearMap.Nondegenerate! This also leads to <code>SeparatingLeft</code> being used in places where <code>Nondegenerate</code> would seem more natural, e.g. the current formulation of the existence part of Sylvester in <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=QuadraticForm.equivalent_one_neg_one_weighted_sum_squared#doc\">docs#QuadraticForm.equivalent_one_neg_one_weighted_sum_squared</a> has the nondegeneracy condition formulated as <code>LinearMap.SeparatingLeft (QuadraticMap.associated Q)</code>, which is just ugly. </p>\n<p>I suggest we unify <code>LinearMap.BilinForm.Nondegenerate</code> and <code>LinearMap.Nondegenerate</code>; but should we standardize on defining nondegenerate = left-separating, or nondegenerate = left and right-separating?</p>",
        "id": 568568165,
        "sender_full_name": "David Loeffler",
        "timestamp": 1768634801
    },
    {
        "content": "<p><del>(FWIW, my preference is to standardize the definition as \"nondegenerate = left-separating\", with lemmas saying this is equivalent to right-separating under finite-dimensionality or symmetry hypotheses; and anyone who wants the right-separating condition in situations where the two aren't equivalent can work directly with <code>LinearMap.SeparatingRight</code>. )</del> <br>\nEDIT: This is probably not a good idea because it means the entire API for <code>SeparatingLeft</code> ends up being duplicated for <code>Nondegenerate</code>. Maybe we should standardize on the \"both left and right separating\" version; but I'm keen we should standardize on <em>something</em>.</p>",
        "id": 568568293,
        "sender_full_name": "David Loeffler",
        "timestamp": 1768634928
    },
    {
        "content": "<p>To me the \"left+right\" version sounds most natural.<br>\nSo I propose to deprecate <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearMap.BilinForm.Nondegenerate#doc\">docs#LinearMap.BilinForm.Nondegenerate</a></p>\n<p>And then it would make sense to update <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix.Nondegenerate#doc\">docs#Matrix.Nondegenerate</a> to match that.</p>",
        "id": 568577512,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1768646518
    },
    {
        "content": "<p>I'd also think that \"nondegenerate\" should be a symmetric condition; I would find it surprising if it were one-sided...</p>",
        "id": 568578583,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1768647939
    },
    {
        "content": "<p>But not demanding <code>X = Y</code>, right?</p>",
        "id": 568578783,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1768648117
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Nondegenerate.20bilinear.20.2F.20quadratic.20forms/near/568577512\">said</a>:</p>\n<blockquote>\n<p>So I propose to deprecate <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearMap.BilinForm.Nondegenerate#doc\">docs#LinearMap.BilinForm.Nondegenerate</a></p>\n</blockquote>\n<p>Deprecations are actually a bit of a problem here: the problem is that since we are deprecating it in favour of a declaration <em>with the same name but in a higher namespace</em>, dot-notating on a bilinear form picks up the deprecated alias in preference to the un-deprecated def. </p>\n<p>I can't think of a good way of solving this, other than simply not having a deprecation.</p>",
        "id": 568585140,
        "sender_full_name": "David Loeffler",
        "timestamp": 1768654419
    },
    {
        "content": "<p>In situations that our deprecation machinery can't handle, I would imagine that a comment in the code would be appropriate, so downstream users have a chance of quickly finding out what the issue is when their code breaks.</p>",
        "id": 568586176,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1768655460
    },
    {
        "content": "<p>We could also just change it to an <code>abbrev</code></p>",
        "id": 568588749,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1768657906
    },
    {
        "content": "<p>Doesn't Sylvester's law of inertia hold over any ordered field?<br>\n<a href=\"/user_uploads/3121/oe3Szs7OUBGTUyLhU0EVUMxC/image.png\">image.png</a><br>\nsource: <em>Real Algebra</em> by Knebusch and Scheiderer</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/oe3Szs7OUBGTUyLhU0EVUMxC/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"868x430\" src=\"/user_uploads/thumbnail/3121/oe3Szs7OUBGTUyLhU0EVUMxC/image.png/840x560.webp\"></a></div>",
        "id": 568626938,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1768698261
    },
    {
        "content": "<blockquote>\n<p>Doesn't Sylvester's law of inertia hold over any ordered field?</p>\n</blockquote>\n<p>That depends how you want to formulate it. If you formulate it as</p>\n<blockquote>\n<p>\"for any quadratic form there is a basis where the matrix is diagonal, and the number of positive, negative, zero entries are isomorphism invariants of the form\"</p>\n</blockquote>\n<p>then any linearly ordered field is OK. If you want to state it as</p>\n<blockquote>\n<p>\"for any quadratic form there is a basis where the matrix is diagonal with all diagonal entries {0, 1, -1}, and the number of +1, -1, and 0 entries are isomorphism invariants of the form\"</p>\n</blockquote>\n<p>(which is, I think, how Sylvester originally stated it), then you need to be working over R, or at least over a linearly ordered field in which all positive elements are squares. Clearly we should have both versions.</p>",
        "id": 568649298,
        "sender_full_name": "David Loeffler",
        "timestamp": 1768726768
    },
    {
        "content": "<p>Yeah that's exactly the right setting for the second one. I guess my point is we don't need the analytic structure, completeness, whatever.</p>",
        "id": 568665243,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1768744587
    },
    {
        "content": "<p>FWIW, I agree with you, but the necessary machinery isn't there in mathlib to state it this way. (I think there are quite a few results, e.g. existence of square roots of positive-def matrices, which we currently do only over <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">R</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{R}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">R</span></span></span></span> because we don't have the definitions required to state them in their natural generality.)</p>",
        "id": 568666447,
        "sender_full_name": "David Loeffler",
        "timestamp": 1768745764
    },
    {
        "content": "<p>I have an open PR defining real-closed fields: <a href=\"https://github.com/leanprover-community/mathlib4/pull/33697\">#33697</a><br>\nThis isn't quite the right generality but it's already a big improvement.</p>",
        "id": 568689990,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1768766386
    },
    {
        "content": "<p>Well, I suppose it's not a proper generalisation until I've proved that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">R</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{R}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">R</span></span></span></span> is real closed, which isn't hard but isn't in that PR.</p>",
        "id": 568690946,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1768767231
    },
    {
        "content": "<p>This is great! I had vaguely remembered someone was working on this but I<br>\ndidn't realise it was you. :-)</p>\n<p>I am not sure this is quite the right generality for Sylvester – I think<br>\nfor Sylvester the correct setting is a \"Euclidean field\", i.e. a<br>\nlinearly-ordered field where every positive element is a square, which is<br>\nmore general than being real-closed. But it is definitely good to have<br>\nreal-closed fields in Mathlib in any case.</p>",
        "id": 568696469,
        "sender_full_name": "David Loeffler",
        "timestamp": 1768772964
    },
    {
        "content": "<p>Yes, I agree. I didn't know that was the name for them. My point is that the proof over real-closed fields would immediately generalise to Euclidean fields, while a proof over the reals might well not.</p>",
        "id": 568703649,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1768781530
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Nondegenerate.20bilinear.20.2F.20quadratic.20forms/near/568577512\">said</a>:</p>\n<blockquote>\n<p>To me the \"left+right\" version sounds most natural.<br>\nSo I propose to deprecate <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearMap.BilinForm.Nondegenerate#doc\">docs#LinearMap.BilinForm.Nondegenerate</a></p>\n<p>And then it would make sense to update <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix.Nondegenerate#doc\">docs#Matrix.Nondegenerate</a> to match that.</p>\n</blockquote>\n<p>I have made a PR at <a href=\"https://github.com/leanprover-community/mathlib4/pull/34110\">#34110</a> which makes the following changes:</p>\n<ul>\n<li>make <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearMap.BilinForm.Nondegenerate#doc\">docs#LinearMap.BilinForm.Nondegenerate</a> into an <code>abbrev</code> for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearMap.Nondegenerate#doc\">docs#LinearMap.Nondegenerate</a>, as suggested by Eric;</li>\n<li>update <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix.Nondegenerate#doc\">docs#Matrix.Nondegenerate</a> to match <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearMap.Nondegenerate#doc\">docs#LinearMap.Nondegenerate</a>, and introduce two new predicates <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix.SeparatingLeft#doc\">docs#Matrix.SeparatingLeft</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix.SeparatingRight#doc\">docs#Matrix.SeparatingRight</a>;</li>\n<li>fix downstream code appropriately.</li>\n</ul>\n<p>The one slight pain point is that several downstream code files prove nondegeneracy using <code>nondegenerate_iff_ker_eq_bot</code>, and with the new (stronger) definition of <code>Nondegenerate</code> this is only true with some extra side conditions. Fortunately these are satisfied in the applications I found </p>\n<p>There are two boring pre-requisite PR's (sorting out naming conflicts &amp; duplication) at <a href=\"https://github.com/leanprover-community/mathlib4/pull/34057\">#34057</a> and <a href=\"https://github.com/leanprover-community/mathlib4/pull/34082\">#34082</a>.</p>",
        "id": 568763916,
        "sender_full_name": "David Loeffler",
        "timestamp": 1768817432
    },
    {
        "content": "<p>Let me help out the emoji bot.</p>",
        "id": 568773829,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1768820356
    },
    {
        "content": "<p>The main PR: <a href=\"https://github.com/leanprover-community/mathlib4/pull/34110\">#34110</a></p>",
        "id": 568773860,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1768820364
    },
    {
        "content": "<p>Prereq 1: <a href=\"https://github.com/leanprover-community/mathlib4/pull/34057\">#34057</a></p>",
        "id": 568773879,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1768820370
    },
    {
        "content": "<p>Prereq 2: <a href=\"https://github.com/leanprover-community/mathlib4/pull/34082\">#34082</a></p>",
        "id": 568773908,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1768820377
    },
    {
        "content": "<p>My answer will come late, but there are four natural notions for bilinear forms, according to whether the left/right associated linear map is injective or an isomorphism.</p>",
        "id": 568810258,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1768831726
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"130609\">@Antoine Chambert-Loir</span> I agree these four notions are very natural; but is it common to use the term \"nondegenerate\" for the condition at the associated linear map to the dual is an isomorphism? I'd call that \"perfect\" rather than \"nondegenerate\".</p>",
        "id": 568821518,
        "sender_full_name": "David Loeffler",
        "timestamp": 1768834642
    },
    {
        "content": "<p>Does  this mean that left and right separating should be defined in terms of injectivity rather than how they behave at zero?</p>",
        "id": 568825075,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1768835634
    },
    {
        "content": "<p>(in order to be correctly defined for semi modules)</p>",
        "id": 568825154,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1768835661
    },
    {
        "content": "<p>I guess so.</p>",
        "id": 568863247,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1768848480
    },
    {
        "content": "<p>Some people use nondegenerate for injectivity and invertible for isomorphism.</p>",
        "id": 568863325,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1768848509
    }
]