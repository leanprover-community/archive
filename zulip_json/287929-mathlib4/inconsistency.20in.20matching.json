[
    {
        "content": "<p>Can someone explain please why the first example works but the second does not?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">ZMod</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">∣</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ZMod</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">natCast_zmod_eq_zero_iff_dvd</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"n\">h</span>\n\n<span class=\"kn\">example</span><span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">∣</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ZMod</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">natCast_zmod_eq_zero_iff_dvd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>",
        "id": 456297775,
        "sender_full_name": "Ralf Stephan",
        "timestamp": 1722766393
    },
    {
        "content": "<p>I needed <code>norm_cast</code>. Thanks.</p>",
        "id": 456300439,
        "sender_full_name": "Ralf Stephan",
        "timestamp": 1722767221
    },
    {
        "content": "<p>Probably one happens to be true by definition and the other doesn't</p>",
        "id": 456304092,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1722768466
    },
    {
        "content": "<p>The second one is fine if you write</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">∣</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ZMod</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">natCast_zmod_eq_zero_iff_dvd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>",
        "id": 456304358,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1722768590
    },
    {
        "content": "<p>The original does also not work with <code>exact</code>. I would have expected <code>exact</code> to apply <code>norm_cast</code>.</p>",
        "id": 456307161,
        "sender_full_name": "Ralf Stephan",
        "timestamp": 1722770123
    },
    {
        "content": "<p>There is <code>exact_mod_cast</code> for that.</p>",
        "id": 456307290,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1722770266
    },
    {
        "content": "<p>I wonder if we should deprecate <code>exact_mod_cast</code> since it's just <code>exact mod_cast</code></p>",
        "id": 456310710,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1722772561
    },
    {
        "content": "<p>By the same argument we should deprecate <code>simpa</code> because \"it's just <code>exact simp</code>\" right?</p>",
        "id": 456310793,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1722772630
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"707242\">@Ralf Stephan</span> <code>exact h</code> succeeds when <code>h</code> is <em>definitionally equal</em> to the goal, <code>exact</code> isn't applying any cast tactics or anything, it's just applying the algorithm for <code>rfl</code>.</p>",
        "id": 456310904,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1722772719
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/287929-mathlib4/topic/inconsistency.20in.20matching/near/456310793\">said</a>:</p>\n<blockquote>\n<p>By the same argument we should deprecate <code>simpa</code> because \"it's just <code>exact simp</code>\" right?</p>\n</blockquote>\n<p>Surely <code>simp</code> isn't legal in term mode?</p>",
        "id": 456311113,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1722772847
    },
    {
        "content": "<p>it's also the same number of characters and even the same words in the same order</p>",
        "id": 456311233,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1722772922
    },
    {
        "content": "<p>also <code>simpa</code> isn't just <code>exact simp</code>, it's <code>simp at h; simp; exact h</code></p>",
        "id": 456311291,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1722772952
    },
    {
        "content": "<p>give or take some edge cases</p>",
        "id": 456311300,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1722772967
    },
    {
        "content": "<p>when I say it is just <code>exact mod_cast</code> I mean it <a href=\"https://github.com/leanprover/lean4/blob/647a5e94925791f6a16b629b6c16ffad60a7f478/src/Init/TacticsExtra.lean#L83\">literally</a>; compare with <a href=\"https://github.com/leanprover/lean4/blob/647a5e94925791f6a16b629b6c16ffad60a7f478/src/Lean/Elab/Tactic/Simpa.lean#L31-L90\"><code>simpa</code></a></p>",
        "id": 456311492,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1722773121
    },
    {
        "content": "<p>They're not literally the same, right? Thanks to the extra parens, <code>exact_mod_cast .</code> is legal, but <code>exact mod_cast .</code> isn't.</p>",
        "id": 456312571,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1722774048
    },
    {
        "content": "<p>It would  be helpful if <code>hint</code> would find it.</p>",
        "id": 456319028,
        "sender_full_name": "Ralf Stephan",
        "timestamp": 1722777513
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/287929-mathlib4/topic/inconsistency.20in.20matching/near/456312571\">said</a>:</p>\n<blockquote>\n<p>They're not literally the same, right? Thanks to the extra parens, <code>exact_mod_cast .</code> is legal, but <code>exact mod_cast .</code> isn't.</p>\n</blockquote>\n<p>no, <code>.</code> is extra magic, it applies before macro expansion so it doesn't work like that</p>",
        "id": 456328996,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1722780983
    },
    {
        "content": "<p>the extra parens presumably do something but as far as I know <code>(e : _)</code> is a no-op</p>",
        "id": 456329103,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1722781017
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/287929-mathlib4/topic/inconsistency.20in.20matching/near/456328996\">said</a>:</p>\n<blockquote>\n<p>no, <code>.</code> is extra magic, it applies before macro expansion so it doesn't work like that</p>\n</blockquote>\n<p>I agree it <em>shouldn't</em> work like that, but it does:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">mod_cast</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"c1\">-- fails</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">exact_mod_cast</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"c1\">-- ok</span>\n</code></pre></div>",
        "id": 456335321,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1722783975
    },
    {
        "content": "<p><code>by use ·</code> is legal for the same reason, even though <code>by exact ·</code> isn't</p>",
        "id": 456335440,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1722784016
    }
]