[
    {
        "content": "<p>So a few months ago I introduced <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearMap.intrinsicStar#doc\">docs#LinearMap.intrinsicStar</a> (star operation on linear maps where <code>star f = star ∘ f ∘ star</code>) which is scoped to <code>IntrinsicStar</code>, this is mathematically distinct from the adjoint star (<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearMap.instStarId#doc\">docs#LinearMap.instStarId</a>, which is a global instance).<br>\nNow this is fine for linear maps on non-Hilbert spaces, and for non-endomorphisms. However, say we want to talk about both stars, on a specific Hilbert space which also has a star instance, then we have a problem. My thought in this case is to use <code>star</code> for the intrinsic star and <code>adjoint</code> for the adjoint star, however, how do we know if the <code>star</code> will actually mean what we want it to mean, and what if we want to use results that apply to both?</p>\n<p>A similar problem also arises with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearMap.convMul#doc\">docs#LinearMap.convMul</a> (the convolutive product on linear maps), which is scoped to <code>ConvolutiveProduct</code> (cc <span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span>).<br>\nWhat if we want to talk about both <code>@IsStarProjection _ LinearMap.convMul LinearMap.intrinsicStar</code> and <code>@IsStarProjection _ Module.End.instMul LinearMap.instStarId</code> (which we will want to)?<br>\nAnother example of this conflict: In <a href=\"https://github.com/leanprover-community/mathlib4/pull/34119\">#34119</a>, I'm adding a result that says what the linear map of the adjacency matrix of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=SimpleGraph.completeGraph#doc\">docs#SimpleGraph.completeGraph</a> looks like, i.e., <code>((completeGraph n).adjMatrix R').toLin' = 1 - .id</code> where <code>1</code> here is the convolutive one <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearMap.convOne#doc\">docs#LinearMap.convOne</a>. But in the PR I had to deinstance all the global instances on the composition product ring to make sure we pick the right <code>*</code> and <code>1</code>. But what if we want to talk about both? What if we needed to talk about both rings?</p>\n<p>The current suggestions are:</p>\n<ul>\n<li>local/scoped instance (it is scoped now, local wouldn't solve these problems either)</li>\n<li>using notation/separate definition for the intrinsic star that doesn't use <code>star</code>, but then we wouldn't be able to use <code>IsSelfAdjoint</code> etc</li>\n<li>a type synonym, but this sounds painful for one use case</li>\n</ul>\n<p>Does anyone have any thoughts on this?</p>\n<p>(cc <span class=\"user-mention\" data-user-id=\"197836\">@Jireh Loreaux</span>, <span class=\"user-mention\" data-user-id=\"240862\">@Oliver Nash</span>)</p>",
        "id": 571736952,
        "sender_full_name": "Monica Omar",
        "timestamp": 1770144422
    },
    {
        "content": "<p>I'm glad that <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearMap.convMul#doc\">docs#LinearMap.convMul</a> didn't become a global instance, but I think it's still quite confusing that lemmas in doc-gen about this convolutional multiplication don't make it clear that a non-standard multiplication is being used</p>",
        "id": 571743122,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1770146353
    },
    {
        "content": "<p>(In particular seeing <code>1 - .id</code> and having to remember that <code>1</code> is not in this case the identity map any more seems unpleasant)</p>",
        "id": 571743281,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1770146398
    },
    {
        "content": "<p>The way we've been dealing with this so far in the <code>Star</code> situation is that we always use<code>intrinsicStar</code> in the name of the declaration. I think this is less of an issue overall because people who work in this area are used to seeing a <code>star</code> and thinking of both senses of the operation. Admittedly, they don't overlap <em>that</em> much (which is what makes it tolerable on paper), but they do still overlap in certain settings.</p>",
        "id": 571743715,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1770146516
    },
    {
        "content": "<p>And we've been using <code>convMul</code> and <code>convOne</code> in the names of the declarations for the <code>ConvolutionProduct</code>.</p>\n<p>The intrinsic star and the convolutive product are both leaf files now, so now is the best time to agree on a change, before things get more complicated and troublesome.</p>\n<p>I think the type synonym is the only one that would solve all the problems (but obviously comes with the annoying hurdle of using and implementing the type synonym).<br>\nHowever, I think we can use a single type synonym for both the intrinsic star and the convolutive product, since they can form a star algebra together under the right circumstances.</p>",
        "id": 572168588,
        "sender_full_name": "Monica Omar",
        "timestamp": 1770302877
    },
    {
        "content": "<p>Should we introduce type synonyms instead?</p>",
        "id": 572170172,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1770303216
    },
    {
        "content": "<p>I think so. But let's see what Yaël says about this, since they authored the convolutive product.</p>",
        "id": 572171786,
        "sender_full_name": "Monica Omar",
        "timestamp": 1770303567
    },
    {
        "content": "<p>I think the other question would be about the name of the synonym. We wouldn't want it to be long, but would also need it to be informative, which is difficult.<br>\n<code>toIntrinsicStarConvolutiveProduct</code> is just too long and messy<br>\n<code>toConv</code> might be confusing?<br>\nI don't know</p>",
        "id": 572173878,
        "sender_full_name": "Monica Omar",
        "timestamp": 1770303983
    },
    {
        "content": "<p>Can we deinstance global instances for specific types?<br>\nFor example, say <code>toConvRing</code> is a type synonym. Then I want to disable <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Module.End.instMul#doc\">docs#Module.End.instMul</a> (and the rest) for <code>toConvRing A →ₗ[R] toConvRing A</code>. Is that possible?</p>",
        "id": 572479474,
        "sender_full_name": "Monica Omar",
        "timestamp": 1770421133
    },
    {
        "content": "<p>My suggestion was to put a type synonym on <code>LinearMap ..</code></p>",
        "id": 572480003,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1770421550
    },
    {
        "content": "<p>Something like <code>def ConvEnd R A := A →ₗ[R] A</code></p>",
        "id": 572480055,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1770421605
    },
    {
        "content": "<p>This comes at a cost (you need to transfer the instances that should still apply, define an <code>Equiv</code> to the underlying type, and make sure that the API doesn't abuse defeq), but AFAIK we don't have a better way to deal with conflicting instances.</p>",
        "id": 572480123,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1770421679
    },
    {
        "content": "<p>Having thought about it further, I am also inclined towards the type synonym.</p>",
        "id": 572481559,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1770422863
    },
    {
        "content": "<p>Yeah, the definitions will look messy with the conjugation, but all in all, it will be fine. And at least this way they can be global instances too.</p>",
        "id": 572481710,
        "sender_full_name": "Monica Omar",
        "timestamp": 1770422954
    },
    {
        "content": "<p>Perhaps better to go straight to</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">ConvEnd</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"kn\">where</span><span class=\"w\"> </span><span class=\"n\">ofEnd</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">toEnd</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">End</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">A</span>\n</code></pre></div>",
        "id": 572481899,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1770423102
    },
    {
        "content": "<p>Alright, done with this: <a href=\"https://github.com/leanprover-community/mathlib4/pull/34945\">#34945</a><br>\nJust need to rename all the lemmas to match the new statements (which I'll do in a follow-up PR to reduce diff, etc).<br>\nBasically copied the same implementation for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=WithLp#doc\">docs#WithLp</a>.</p>",
        "id": 572530919,
        "sender_full_name": "Monica Omar",
        "timestamp": 1770469959
    },
    {
        "content": "<p>Good thought on also wanting the matrix version</p>",
        "id": 572581080,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1770515316
    }
]