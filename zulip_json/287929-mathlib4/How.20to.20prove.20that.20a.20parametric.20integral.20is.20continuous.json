[
    {
        "content": "<p>I have the following improper integral (Landen's integral, related to the AGM which I introduce in <a href=\"https://github.com/leanprover-community/mathlib4/pull/32892\">#32892</a>) and I would like to prove that it is continuous in its two parameters <code>a, b</code> when both are positive.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">SpecialFunctions</span><span class=\"bp\">.</span><span class=\"n\">ImproperIntegrals</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">MeasureTheory</span><span class=\"w\"> </span><span class=\"n\">Topology</span><span class=\"w\"> </span><span class=\"n\">Real</span>\n\n<span class=\"sd\">/-- The elliptic integral related to the arithmetic-geometric mean. -/</span>\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">agmIntegral</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Ioi</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">√</span><span class=\"o\">((</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)))</span><span class=\"bp\">⁻¹</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">continuousOn_agmIntegral</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">ContinuousOn</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">agmIntegral</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Ioi</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">×ˢ</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Ioi</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>I can't see a simple way of proving it. It's improper, so <code>continuousOn_integral_of_compact_support</code> doesn't work here. How can I do it?</p>",
        "id": 569617616,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1769130556
    },
    {
        "content": "<p>I guess you can apply <code>continuousOn_integral_of_compact_support</code>on each compact neighborhood. You probably should first prove a local version of <code>continuousOn_integral_of_compact_support</code>.</p>",
        "id": 569619256,
        "sender_full_name": "Yongxi Lin (Aaron)",
        "timestamp": 1769131799
    },
    {
        "content": "<p>There is also <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MeasureTheory.continuousWithinAt_of_dominated#doc\">docs#MeasureTheory.continuousWithinAt_of_dominated</a> but I am not sure whether it can be applied, and if so how to apply it</p>",
        "id": 569619442,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1769131944
    },
    {
        "content": "<p>I could for example transform the integral to the trigonometric form (closer to Legendre's elliptic integrals, over <code>0..π / 2</code>) and then apply <code>continuousOn_integral_of_compact_support</code>, but that approach feels too long-winded</p>",
        "id": 569628124,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1769138140
    },
    {
        "content": "<p>Found a way to do it without passing to the trigonometric form. The completed PR is <a href=\"https://github.com/leanprover-community/mathlib4/pull/34397\">#34397</a></p>",
        "id": 569930256,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1769319513
    }
]