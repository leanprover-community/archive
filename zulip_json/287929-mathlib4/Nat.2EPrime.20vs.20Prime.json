[
    {
        "content": "<p>Following this <a href=\"#narrow/channel/287929-mathlib4/topic/rename.20Nat.2Eprime_def_lt''.20to.20Nat.2Eprime_def\">topic about <code>Nat.Prime</code></a> I realised I don't fully understand why mathlib has both <code>Nat.Prime</code> and <code>_root_.Prime</code>.</p>\n<p>Is there a convenient reason that <code>Nat.Prime</code> works better for something or is this more that the API for <code>_root_.Prime</code> should ideally be improved so that it could fully replace <code>Nat.Prime</code> eventually? And just nobody done that yet?</p>\n<p>Originally I thought <code>Nat.Prime</code> helps with decidability, but on first glance it seems that one could transport this decidability to <code>_root_.Prime 3</code>, too:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"n\">root_</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">decidable_of_iff'</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">prime_iff</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n</code></pre></div>",
        "id": 483668846,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1732187227
    },
    {
        "content": "<p>Historical reasons</p>",
        "id": 483669438,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1732187410
    },
    {
        "content": "<p>Also, you'd need to choose whether to replace it with <code>Prime</code> or <code>Irreducible</code></p>",
        "id": 483669562,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1732187465
    },
    {
        "content": "<p>Well, at least we follow the mathematical terminology of defining prime natural numbers via irreducibility and then using the word \"prime\" in general to denote something else (that of course is equivalent in the case of natural numbers)</p>",
        "id": 483672944,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1732188654
    },
    {
        "content": "<p>Mathematicians and their terminology are really something to behold <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 483673121,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1732188721
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Nat.2EPrime.20vs.20Prime/near/483669562\">said</a>:</p>\n<blockquote>\n<p>Also, you'd need to choose whether to replace it with <code>Prime</code> or <code>Irreducible</code></p>\n</blockquote>\n<p>I mean sure, but since <code>Prime</code> and <code>Irreducible</code> are equivalent on <code>Nat</code> (or generally if there are no zero-divisors) , that's also just a matter of having the API written conveniently, isn't it?</p>",
        "id": 483674869,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1732189352
    },
    {
        "content": "<p>Does \"historical reason\" mean a refactor could be appreciated in that case? Assuming it's more convenient to use than the current dual setup.</p>",
        "id": 483675043,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1732189410
    },
    {
        "content": "<p>One should check that to prove stuff about <code>Nat.Prime</code> we would not need a lot of imports from ring theory</p>",
        "id": 483675844,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1732189655
    },
    {
        "content": "<p>Looks like that should not be that case. At least <code>_root_.Prime</code> is already imported in the file where <code>Nat.Prime</code> is defined.</p>\n<p><a href=\"/user_uploads/3121/jQXtCYIGeZI_X91eDzXcyS6H/prime_to_nat_prime.png\">prime_to_nat_prime.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/jQXtCYIGeZI_X91eDzXcyS6H/prime_to_nat_prime.png\" title=\"prime_to_nat_prime.png\"><img data-original-dimensions=\"454x251\" src=\"/user_uploads/thumbnail/3121/jQXtCYIGeZI_X91eDzXcyS6H/prime_to_nat_prime.png/840x560.webp\"></a></div>",
        "id": 483678892,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1732190578
    },
    {
        "content": "<p>or rather, that battle was lost long ago</p>",
        "id": 483680390,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1732191015
    },
    {
        "content": "<p>Yes, the definition is surely fine, I was wondering about the theorems. But I didn't check anything</p>",
        "id": 483680977,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1732191177
    },
    {
        "content": "<p>Indeed, <code>Nat.Prime</code> does have quite a bit of unused transitive imports, but also it's not huge in it's current shape:</p>\n<p><a href=\"/user_uploads/3121/dd_dj92uLj4ICRPjry9LA5zO/nat_prime2.jpg\">nat_prime2.jpg</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/dd_dj92uLj4ICRPjry9LA5zO/nat_prime2.jpg\" title=\"nat_prime2.jpg\"><img data-original-dimensions=\"6755x2459\" src=\"/user_uploads/thumbnail/3121/dd_dj92uLj4ICRPjry9LA5zO/nat_prime2.jpg/840x560.webp\"></a></div><p>Haven't really looked into it either, just trying to gauge here whether it would be worth looking at in a free minute or if that would be unreasonable.</p>",
        "id": 483681321,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1732191285
    },
    {
        "content": "<p>Looking at it a bit, but it seems like your picture is fairly out of date</p>",
        "id": 483686908,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1732193047
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"385895\">Jon Eugster</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Nat.2EPrime.20vs.20Prime/near/483681321\">said</a>:</p>\n<blockquote>\n<p>Indeed, <code>Nat.Prime</code> does have quite a bit of unused transitive imports, but also it's not huge in it's current shape:</p>\n<p><a href=\"/user_uploads/3121/dd_dj92uLj4ICRPjry9LA5zO/nat_prime2.jpg\">nat_prime2.jpg</a></p>\n</blockquote>\n<p>Just as a reminder, optimizing away all gray nodes for the sake of removing gray is a bad metric, and at its extreme leads to  total atomization of mathlib (or one single extraordinarily large file)</p>",
        "id": 483693935,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1732195201
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Nat.2EPrime.20vs.20Prime/near/483686908\">said</a>:</p>\n<blockquote>\n<p>Looking at it a bit, but it seems like your picture is fairly out of date</p>\n</blockquote>\n<p>You're right, I made that from a branch I was reviewing, which is way too old, my bad.</p>",
        "id": 483713931,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1732200152
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Nat.2EPrime.20vs.20Prime/near/483693935\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"385895\">Jon Eugster</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Nat.2EPrime.20vs.20Prime/near/483681321\">said</a>:</p>\n<blockquote>\n<p>Indeed, <code>Nat.Prime</code> does have quite a bit of unused transitive imports, but also it's not huge in it's current shape:</p>\n<p><a href=\"/user_uploads/3121/dd_dj92uLj4ICRPjry9LA5zO/nat_prime2.jpg\">nat_prime2.jpg</a></p>\n</blockquote>\n<p>Just as a reminder, optimizing away all gray nodes for the sake of removing gray is a bad metric, and at its extreme leads to  total atomization of mathlib (or one single extraordinarily large file)</p>\n</blockquote>\n<p>That's fair, but I think there's some reasonable things that might be done here</p>",
        "id": 483716795,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1732200887
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Nat.2EPrime.20vs.20Prime/near/483693935\">said</a>:</p>\n<blockquote>\n<p>Just as a reminder, optimizing away all gray nodes for the sake of removing gray is a bad metric, and at its extreme leads to  total atomization of mathlib (or one single extraordinarily large file)</p>\n</blockquote>\n<p>That's not really true, is it?</p>\n<p>For example, If a file contains a definition <code>F</code>, and then independent lemmas <code>A</code> and <code>B</code> about <code>F</code> (and not requiring any additional imports), and then a lemma <code>C</code> which uses both <code>A</code> and <code>B</code>, I don't think there are even \"extreme atomization\" strategies that would separate these into different files.</p>\n<p>(Except the trivial \"total atomization\" strategy, of course, e.g. if one were aiming for a content-addressed library.)</p>",
        "id": 483790370,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732223938
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/19342\">#19342</a> is one change, though I'd be okay with it if we decided not to take it</p>",
        "id": 483791010,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1732224224
    },
    {
        "content": "<p>I'll investigate, though probably not today. I'm also looking at some other approaches</p>",
        "id": 483795883,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1732226216
    },
    {
        "content": "<p>Like <a href=\"https://github.com/leanprover-community/mathlib4/pull/19346\">#19346</a></p>",
        "id": 483805950,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1732230713
    },
    {
        "content": "<p>Also <a href=\"https://github.com/leanprover-community/mathlib4/pull/19375\">#19375</a></p>",
        "id": 483947374,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1732293096
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Nat.2EPrime.20vs.20Prime/near/483791010\">said</a>:</p>\n<blockquote>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/19342\">#19342</a> is one change, though I'd be okay with it if we decided not to take it</p>\n</blockquote>\n<p>This is back up for review now.</p>\n<p>Graph before the changes (2bb0410843932d03ff2c12cd9bf2e996f514a36b):</p>\n<p><a href=\"/user_uploads/3121/fExgm1PGTuXb_XEdMx_Xo2si/prime-master-0.png\">prime-master-0.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/fExgm1PGTuXb_XEdMx_Xo2si/prime-master-0.png\" title=\"prime-master-0.png\"><img data-original-dimensions=\"5853x1499\" src=\"/user_uploads/thumbnail/3121/fExgm1PGTuXb_XEdMx_Xo2si/prime-master-0.png/840x560.webp\"></a></div><p>With all the recent changes including  <a href=\"https://github.com/leanprover-community/mathlib4/pull/19342\">#19342</a>:</p>\n<p><a href=\"/user_uploads/3121/dtPue2zsmqR1v9Me-GypMm7J/prime-nat-ring.png\">prime-nat-ring.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/dtPue2zsmqR1v9Me-GypMm7J/prime-nat-ring.png\" title=\"prime-nat-ring.png\"><img data-original-dimensions=\"4230x1307\" src=\"/user_uploads/thumbnail/3121/dtPue2zsmqR1v9Me-GypMm7J/prime-nat-ring.png/840x560.webp\"></a></div>",
        "id": 484005986,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1732317014
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Nat.2EPrime.20vs.20Prime/near/483680390\">said</a>:</p>\n<blockquote>\n<p>or rather, that battle was lost long ago</p>\n</blockquote>\n<p>Mario, do you have some <code>#assert_not_exists</code> that you wish would be present in <code>Data.Nat.Prime.Basic</code>, based on the graphs above?</p>",
        "id": 484031752,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732337280
    },
    {
        "content": "<p>The two graphs seem to me to be roughly equivalent in size. So at the moment I don't feel strongly about merging one or the other.</p>",
        "id": 484031815,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732337318
    },
    {
        "content": "<p>May I ask how you are generating the import graphs?<br>\nI've figured it's lake exe graph. I have some troubles just getting the dependencies that I need. Currently I use import Mathlib, but I'd just like to use the dependencies that I need</p>",
        "id": 484636359,
        "sender_full_name": "metakuntyyy",
        "timestamp": 1732679741
    },
    {
        "content": "<p>Use #min_imports at the bottom of your file. It will tell you (sometimes incorrectly) what to replace <code>import Mathlib</code> with.</p>",
        "id": 484638740,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732681608
    },
    {
        "content": "<p>Can I have a review on <a href=\"https://github.com/leanprover-community/mathlib4/pull/19342\">#19342</a> and <a href=\"https://github.com/leanprover-community/mathlib4/pull/19437\">#19437</a>?</p>",
        "id": 484784668,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1732735083
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Nat.2EPrime.20vs.20Prime/near/484031752\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Nat.2EPrime.20vs.20Prime/near/483680390\">said</a>:</p>\n<blockquote>\n<p>or rather, that battle was lost long ago</p>\n</blockquote>\n<p>Mario, do you have some <code>#assert_not_exists</code> that you wish would be present in <code>Data.Nat.Prime.Basic</code>, based on the graphs above?</p>\n</blockquote>\n<p>I would prefer to have <code>#assert_not_exists Prime</code> in <code>Data.Nat.Prime.Basic</code></p>",
        "id": 485108088,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1732889758
    },
    {
        "content": "<p>we could even upstream <code>Data.Nat.Prime.Basic</code> to batteries, which would basically require this</p>",
        "id": 485108326,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1732889820
    },
    {
        "content": "<p>I don't think the definition should be <code>Irreducible</code> and use the algebraic hierarchy to do it</p>",
        "id": 485108413,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1732889857
    },
    {
        "content": "<p>I'm not convinced that would be better</p>",
        "id": 485115771,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1732892250
    },
    {
        "content": "<p>better how? It's a tradeoff, of course</p>",
        "id": 485115963,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1732892306
    }
]