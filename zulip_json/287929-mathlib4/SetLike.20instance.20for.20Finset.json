[
    {
        "content": "<p>In his review of a PR of mine, <span class=\"user-mention\" data-user-id=\"224323\">@Junyan Xu</span> observed that there was no <code>SetLike</code> instance for <code>Finset</code>. I easily provided one in <a href=\"https://github.com/leanprover-community/mathlib4/pull/28076\">#28076</a>, but that breaks swiftly because <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Finset.toSet#doc\">docs#Finset.toSet</a> already provides a coercion mechanism, via the instance <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Finset.instCoeTCSet#doc\">docs#Finset.instCoeTCSet</a><br>\nI 'm tempted to believe that this instance had been defined before <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=SetLike#doc\">docs#SetLike</a> existed but have no serious opinion of how mathlib should be designed in this case.</p>",
        "id": 533764377,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1754910970
    },
    {
        "content": "<p>It's very practical being able to write <code>.toSet</code> when the coercion system fails to understand that the only coercion <code>Finset α → Set ?β</code> is when <code>?β := α</code>. Apart from that, adding the <code>SetLike</code> instance should be no issue</p>",
        "id": 533779073,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1754914091
    },
    {
        "content": "<p>In practice, adding this instance brings some issues, because Lean doesn't get that te two coercions coincide, hence some previously-terminating <code>simp</code> don't work anymore.</p>",
        "id": 533785282,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1754916227
    },
    {
        "content": "<p>Yes, you would need to remove <code>Finset.toSet</code></p>",
        "id": 533787134,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1754916852
    },
    {
        "content": "<p>Do you mean to remove <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Finset/Defs.html#Finset.instCoeTCSet\">Finset.instCoeTCSet</a>?</p>",
        "id": 533799879,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1754920537
    },
    {
        "content": "<p>Let's see how many changes are needed for <a href=\"https://github.com/leanprover-community/mathlib4/pull/28241\">#28241</a> to pass CI ...</p>",
        "id": 533806182,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1754922303
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/28241\">#28241</a> builds with 25 files changed (+54 -62) which is pretty reasonable IMO. What I did is making <code>Finset.toSet</code> an abbrev of <code>SetLike.coe</code>.</p>",
        "id": 533953805,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1754995731
    },
    {
        "content": "<p>I had to <a href=\"https://github.com/leanprover-community/mathlib4/pull/28241/files#diff-d2f74a78c07475a6b80ce83e3966140b832ce78898af192cac76092194e6171a\">revert</a> one of the <code>grind</code> golfs back to </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">rintro</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hi</span><span class=\"bp\">⟩;</span><span class=\"w\"> </span><span class=\"n\">specialize</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">hi</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">sets_t'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">dif_pos</span><span class=\"w\"> </span><span class=\"n\">hi</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>\n<p>and <code>grind</code>'s output is <a href=\"/user_uploads/3121/HqzC-giBFhe3Arq0BDiUnkOo/Probability.Kernel-grind-failure.txt\">Probability.Kernel grind failure.txt</a>.<br>\nIf anyone knows how to golf it again please do.</p>",
        "id": 533954418,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1754995991
    }
]