[
    {
        "content": "<p>Are these instances suitable for inclusion in mathlib?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">Normed</span><span class=\"bp\">.</span><span class=\"n\">Lp</span><span class=\"bp\">.</span><span class=\"n\">WithLp</span><span class=\"w\"> </span><span class=\"c1\">-- thanks #min_imports</span>\n\n<span class=\"c1\">-- Is this a bad instance?</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MulDistribMulAction</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">MulDistribMulAction</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"bp\">À£</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">smul</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">mx</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">mx</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">mx</span><span class=\"bp\">‚Åª¬π</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">smul_mul'</span><span class=\"o\">],</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">smul_mul'</span><span class=\"o\">]</span><span class=\"bp\">‚ü©</span>\n<span class=\"w\">  </span><span class=\"n\">one_smul</span><span class=\"w\"> </span><span class=\"n\">mx</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">ext</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">one_smul</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">mx</span><span class=\"bp\">.</span><span class=\"m\">1</span>\n<span class=\"w\">  </span><span class=\"n\">mul_smul</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">mx</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">ext</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">mul_smul</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">mx</span><span class=\"bp\">.</span><span class=\"m\">1</span>\n<span class=\"w\">  </span><span class=\"n\">smul_mul</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">mx</span><span class=\"w\"> </span><span class=\"n\">nx</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">ext</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">smul_mul'</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">mx</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"n\">nx</span><span class=\"bp\">.</span><span class=\"m\">1</span>\n<span class=\"w\">  </span><span class=\"n\">smul_one</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">ext</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">smul_one</span><span class=\"w\"> </span><span class=\"n\">g</span>\n\n<span class=\"c1\">-- is this a bad instance?</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MulDistribMulAction</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">DistribMulAction</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Additive</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">smul</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">am</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">ofMul</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">am</span><span class=\"bp\">.</span><span class=\"n\">toMul</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">one_smul</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">one_smul</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">mul_smul</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mul_smul</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">smul_zero</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">HSMul</span><span class=\"bp\">.</span><span class=\"n\">hSMul</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">smul_one</span><span class=\"w\"> </span><span class=\"n\">g</span>\n<span class=\"w\">  </span><span class=\"n\">smul_add</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\">  </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">HSMul</span><span class=\"bp\">.</span><span class=\"n\">hSMul</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">smul_mul'</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">toMul</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n</code></pre></div>\n<p>The back story is that if <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>L</mi><mi mathvariant=\"normal\">/</mi><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">L/K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mord\">/</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span> is a Galois extension of fields with Galois group <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>G</mi></mrow><annotation encoding=\"application/x-tex\">G</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">G</span></span></span></span> then I want to make <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>L</mi><mo>√ó</mo></msup></mrow><annotation encoding=\"application/x-tex\">L^\\times</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7713em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">L</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7713em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">√ó</span></span></span></span></span></span></span></span></span></span></span> into a term of type <code>Rep ‚Ñ§ G</code> and with both these instances in place it's as simple as <code> Rep.ofDistribMulAction ‚Ñ§ G (Additive LÀ£)</code>.</p>",
        "id": 553692331,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1762282828
    },
    {
        "content": "<p>(I'm expecting an answer of the form \"these instances are not allowed in mathlib because what if G=M^*\"  or \"G = Unit\" or some such thing, but I can't see any problems myself yet)</p>",
        "id": 553693336,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1762283168
    },
    {
        "content": "<p>This fails:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- Is this a bad instance?</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MulDistribMulAction</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">MulDistribMulAction</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"bp\">À£</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">smul</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">mx</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">mx</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">mx</span><span class=\"bp\">‚Åª¬π</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">smul_mul'</span><span class=\"o\">],</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">smul_mul'</span><span class=\"o\">]</span><span class=\"bp\">‚ü©</span>\n<span class=\"w\">  </span><span class=\"n\">one_smul</span><span class=\"w\"> </span><span class=\"n\">mx</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">ext</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">one_smul</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">mx</span><span class=\"bp\">.</span><span class=\"m\">1</span>\n<span class=\"w\">  </span><span class=\"n\">mul_smul</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">mx</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">ext</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">mul_smul</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">mx</span><span class=\"bp\">.</span><span class=\"m\">1</span>\n<span class=\"w\">  </span><span class=\"n\">smul_mul</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">mx</span><span class=\"w\"> </span><span class=\"n\">nx</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">ext</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">smul_mul'</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">mx</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"n\">nx</span><span class=\"bp\">.</span><span class=\"m\">1</span>\n<span class=\"w\">  </span><span class=\"n\">smul_one</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">ext</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">smul_one</span><span class=\"w\"> </span><span class=\"n\">g</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ConjAct</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">À£</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">infer_instance</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"c1\">--fails</span>\n</code></pre></div>\n<p>I am not entirely sure if we care or not. I am guessing me might care.</p>",
        "id": 553701577,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1762286124
    },
    {
        "content": "<p>What's the diamond expand to there?</p>",
        "id": 553732425,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1762297454
    },
    {
        "content": "<p>Kevin's instances look sensible enough to me</p>",
        "id": 553732469,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1762297480
    },
    {
        "content": "<p>The RHS is <code>MulDistribMulAction (ConjAct GÀ£) GÀ£</code> which comes from the generic <code>MulDistribMulAction (ConjAct G) G</code> instance.</p>",
        "id": 553733802,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1762298277
    },
    {
        "content": "<p>The LHS goes through <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ConjAct.unitsMulDistribMulAction#doc\">docs#ConjAct.unitsMulDistribMulAction</a> and Kevin's instance.</p>",
        "id": 553734075,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1762298415
    },
    {
        "content": "<p>Investigating this further, <span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span> noticed this instance was conflicting with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Units.mulDistribMulAction%27#doc\">docs#Units.mulDistribMulAction'</a>. I was very confused at first since <code>foo</code> above sets <code>g ‚Ä¢ u := ‚ü®g ‚Ä¢ u, g ‚Ä¢ u‚Åª¬π, _, _‚ü©</code> while <code>Units.mulDistribMulAction'</code> sets <code>g ‚Ä¢ u := ‚ü®g ‚Ä¢ u, g‚Åª¬π ‚Ä¢ u‚Åª¬π, _, _‚ü©</code> and these are a priori not even propeq!</p>",
        "id": 561914403,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1764863498
    },
    {
        "content": "<p>By uniqueness of inverses, the above means that, whenever both instances are available, <code>g‚Åª¬π ‚Ä¢ u‚Åª¬π = g ‚Ä¢ u‚Åª¬π</code>, which is certainly quite odd.</p>",
        "id": 561914578,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1764863542
    },
    {
        "content": "<p>And now I have figured out what's going on: The typeclass assumptions of <code>Units.mulDistribMulAction'</code> include <code>MulDistribMulAction G M</code> and <code>SMulCommClass G M M</code>. The first one reads <code>g ‚Ä¢ (m‚ÇÅ * m‚ÇÇ) = m‚ÇÅ * g ‚Ä¢ m‚ÇÇ</code> while the second one reads <code>g ‚Ä¢ (m‚ÇÅ * m‚ÇÇ) = g ‚Ä¢ m‚ÇÅ * g ‚Ä¢ m‚ÇÇ</code>. If <code>M</code> is cancellative, this implies <code>g ‚Ä¢ m‚ÇÅ = m‚ÇÅ</code> for all <code>g : G</code> and <code>m‚ÇÅ : M</code>. In other words, the action is trivial!</p>",
        "id": 561915099,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1764863672
    },
    {
        "content": "<p>I see, so we should remove <code>Units.mulDistribMulAction'</code>!</p>",
        "id": 561915231,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1764863702
    },
    {
        "content": "<p>Yes, exactly. This unfortunately doesn't remove Andrew's diamond above, but at least we will have only one diamond to care about, rather than two.</p>",
        "id": 561915628,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1764863787
    },
    {
        "content": "<p>Is <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Group/Action/Units.html#Units.mulAction'\">Units.mulAction'</a> also bad then?</p>",
        "id": 561915640,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1764863789
    },
    {
        "content": "<p>No, because it doesn't have this <code>MulDistribMulAction G M</code> assumption</p>",
        "id": 561915751,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1764863816
    },
    {
        "content": "<p>But my argument above also shows that it doesn't cause a diamond in non-degenerate cases: The only action on a (cancellative) monoid that satisfies both <code>Units.mulAction'</code> and <code>foo</code> is the trivial one.</p>",
        "id": 561916045,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1764863881
    },
    {
        "content": "<p>The instance was added in <a href=\"https://github.com/leanprover-community/mathlib/pull/10480\">!3#10480</a> by no else than <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span>. Eric, did you have an application in mind?</p>",
        "id": 561918245,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1764864354
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/32430\">#32430</a></p>",
        "id": 561920191,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1764864840
    },
    {
        "content": "<p>I think there's a previous thread about this somewhere</p>",
        "id": 561925012,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1764865994
    },
    {
        "content": "<p>I claim the instance is harmless because it adds only proofs not data</p>",
        "id": 561925123,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1764866026
    },
    {
        "content": "<p>Lean-wise it is harmless. Mathematically, it is extremely confusing.</p>",
        "id": 561925303,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1764866077
    },
    {
        "content": "<p>I think a docstring is a good solution then</p>",
        "id": 561925400,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1764866098
    },
    {
        "content": "<p>But also I think there is an underlying issue here about right actions</p>",
        "id": 561925544,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1764866132
    },
    {
        "content": "<p>Sure, although I do wonder if we should have \"theoretically harmless but mathematically useless\" instances</p>",
        "id": 561925548,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1764866133
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/32432\">#32432</a></p>",
        "id": 561925551,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1764866134
    },
    {
        "content": "<p>I don't understand this point, this wrong instance is blocking us from having the correct instance that we need</p>",
        "id": 561925693,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1764866169
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/stream/287929-mathlib4/topic/MulDistribMulAction.20instances/near/561915640\">said</a>:</p>\n<blockquote>\n<p>Is <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Group/Action/Units.html#Units.mulAction'\">Units.mulAction'</a> also bad then?</p>\n</blockquote>\n<p>The situation is different if the answer to this is yes</p>",
        "id": 561925847,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1764866208
    },
    {
        "content": "<p>Kenny, I claim what we mostly care about is diamonds in the notation classes, not diamonds in the derived classes (though obviously the latter implies the former)</p>",
        "id": 561926338,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1764866336
    },
    {
        "content": "<p>Fixing the derived instances but not the underlying notation instance is just looking away from the problem</p>",
        "id": 561926573,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1764866395
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/287929-mathlib4/topic/MulDistribMulAction.20instances/near/561925693\">said</a>:</p>\n<blockquote>\n<p>I don't understand this point, this wrong instance is blocking us from having the correct instance that we need</p>\n</blockquote>\n<p>It was <em>mentally</em> blocking, but not <em>actually</em> blocking. My argument for why <code>Units.mulAction'</code> is okay to have also applies to <code>Units.mulDistribMulAction'</code></p>",
        "id": 561927210,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1764866549
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/287929-mathlib4/topic/MulDistribMulAction.20instances/near/561915640\">said</a>:</p>\n<blockquote>\n<p>Is <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Group/Action/Units.html#Units.mulAction'\">Units.mulAction'</a> also bad then?</p>\n</blockquote>\n<p>Indeed it is:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Group</span><span class=\"bp\">.</span><span class=\"n\">Action</span><span class=\"bp\">.</span><span class=\"n\">Units</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommMonoid</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Units</span><span class=\"bp\">.</span><span class=\"n\">mulAction'</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Monoid</span><span class=\"bp\">.</span><span class=\"n\">toMulAction</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"bp\">À£</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">ext1</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">ext1</span><span class=\"w\"> </span><span class=\"n\">m‚ÇÅ</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">ext1</span><span class=\"w\"> </span><span class=\"n\">m‚ÇÇ</span>\n<span class=\"w\">  </span><span class=\"n\">change</span><span class=\"w\"> </span><span class=\"n\">Units</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span><span class=\"cm\"> { val := m‚ÇÅ ‚Ä¢ ‚Üëm‚ÇÇ, inv := m‚ÇÅ‚Åª¬π ‚Ä¢ ‚Üëm‚ÇÇ‚Åª¬π, val_inv := ‚ãØ, inv_val := ‚ãØ } =</span>\n<span class=\"cm\">  { val := ‚Üëm‚ÇÅ * ‚Üëm‚ÇÇ, inv := m‚ÇÇ.inv * m‚ÇÅ.inv, val_inv := ‚ãØ, inv_val := ‚ãØ } -/</span>\n</code></pre></div>",
        "id": 566342849,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1767616419
    },
    {
        "content": "<p>Oh, I hadn't noticed this order swapping. Should we scope it then?</p>",
        "id": 566349626,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1767618551
    },
    {
        "content": "<p>This has been known for a while: <a class=\"message-link\" href=\"/#narrow/channel/113488-general/topic/units.2Emul_action.27.20diamond/near/246400399\">#general &gt; units.mul_action' diamond @ üí¨</a></p>",
        "id": 566352657,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1767619600
    },
    {
        "content": "<p>Hit this today with <code>M := ‚ÑÇ</code> trying to prove</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">isQuotientCoveringMap_zpow</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñ§</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NeZero</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">IsQuotientCoveringMap</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"bp\">À£</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">rootsOfUnity</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">natAbs</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n</code></pre></div>",
        "id": 566353140,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1767619734
    }
]