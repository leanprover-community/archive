[
    {
        "content": "<p>The following innocuous-looking code results in a maximum recursion depth being reached.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsDomain</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ValuationRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ideal</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">⊥</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">classical</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span>\n</code></pre></div>\n<p>The issue is that <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Submodule.zero_eq_bot#doc\">docs#Submodule.zero_eq_bot</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=bot_eq_zero%27#doc\">docs#bot_eq_zero'</a> have conflicting simp-normal forms, and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ValuationRing.instLinearOrderIdealOfDecidableLE#doc\">docs#ValuationRing.instLinearOrderIdealOfDecidableLE</a> is happy to provide the required linear-order instance (assuming some decidability instance, which is why <code>classical</code> is necessary).</p>\n<p>This seems bad, and presumably a consistent simp-normal form should be chosen.</p>",
        "id": 566807522,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1767813953
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib3/pull/14553\">https://github.com/leanprover-community/mathlib3/pull/14553</a> added <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=bot_eq_zero%27#doc\">docs#bot_eq_zero'</a> and there's a discussion in the PR about this design decision (and in particular about the disadvantage of it not being a simp lemma).</p>",
        "id": 566815659,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1767816937
    },
    {
        "content": "<p><code>zero_eq_bot</code> is back in the dark ages (2018) where we were allowed +500 line PRs: <a href=\"https://github.com/leanprover-community/mathlib3/pull/462\">https://github.com/leanprover-community/mathlib3/pull/462</a> . Basically the simp attribute has been there forever.</p>",
        "id": 566818237,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1767817879
    },
    {
        "content": "<p>To what extent is <code>⊥</code> the preferred spelling of the zero ideal? Would it be feasible to change the simp-normal form to <code>0</code>, so that it's consistent with the more general case of linear orders?</p>",
        "id": 566827020,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1767821530
    },
    {
        "content": "<p>The bottom submodule, subring, submodule etc is spelled <code>⊥</code> everywhere afaik. It would be a big refactor.<br>\nOn the merits themselves, I'd support it, because it matches pen and paper notation.</p>",
        "id": 566827247,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1767821609
    },
    {
        "content": "<p>I guess one small downside of changing it, is that currently we consistently(?) use <code>⊥</code> for all minimal substructures, and after this change we use <code>0</code> for some and <code>⊥</code> for others...</p>",
        "id": 566828067,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1767821958
    },
    {
        "content": "<p>Another option would be to not have <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ValuationRing.instLinearOrderIdealOfDecidableLE#doc\">docs#ValuationRing.instLinearOrderIdealOfDecidableLE</a> as an instance. The decidability of that instance already disables it most of the time (which is presumably why this hasn't been an issue that often so far)</p>\n<p>This is quite far outside my area, so I'll let others decide what the best way to solve/work around this is</p>\n<p>(cc <span class=\"user-mention\" data-user-id=\"406490\">@María Inés de Frutos Fernández</span> <span class=\"user-mention\" data-user-id=\"300245\">@Filippo A. E. Nuccio</span> <span class=\"user-mention\" data-user-id=\"243562\">@Adam Topaz</span> to ping some of the people for whom this might be relevant)</p>",
        "id": 566829320,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1767822493
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"111080\">Floris van Doorn</span> <a href=\"#narrow/channel/287929-mathlib4/topic/conflicting.20simp-normal.20form.3A.20bot.20vs.200/near/566827020\">said</a>:</p>\n<blockquote>\n<p>To what extent is <code>⊥</code> the preferred spelling of the zero ideal? Would it be feasible to change the simp-normal form to <code>0</code>, so that it's consistent with the more general case of linear orders?</p>\n</blockquote>\n<p>At some point in the past I tried making a typeclass for stating <code>⊥ = 0</code> (before we had <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CanonicallyOrderedAdd#doc\">docs#CanonicallyOrderedAdd</a> automatically providing this for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Ordinal#doc\">docs#Ordinal</a>) and I found that this was the one place in the library where we wanted the opposite simp normal form.</p>",
        "id": 566834818,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1767825027
    },
    {
        "content": "<p>On the other hand, it'd be kind of weird to write 0 for the bottom ideal and ⊤ for the top ideal. So if we are going to change something here I believe we should be consistent and also set ⊤ = 1 as a normal form.</p>",
        "id": 566834872,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1767825057
    },
    {
        "content": "<p>I think that 1 is a confusing name for the top ideal in the sense that mathematicians could be confused by it. I'd be happy to consistently call the zero ideal bot even though it's often called zero in the literature.  We use bot for plenty of other things which mathematicians would call zero.</p>",
        "id": 566886491,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1767860010
    },
    {
        "content": "<p>I denote the top ideal by 1 in my algebra lectures since it is neutral for multiplication.</p>",
        "id": 566889187,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1767861117
    },
    {
        "content": "<p>Yeah it's pretty clear what it must mean if you think about it -- it's the ideal generated by 1 just like 0 is the ideal generated by 0. I'm just saying that it's I think far less common to denote the top ideal of R by 1 when you can just denote it by R (on the blackboard).</p>",
        "id": 566889532,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1767861266
    },
    {
        "content": "<p>To be honest I probably used R before getting infected.</p>",
        "id": 566892282,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1767862313
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"111080\">Floris van Doorn</span> <a href=\"#narrow/channel/287929-mathlib4/topic/conflicting.20simp-normal.20form.3A.20bot.20vs.200/near/566828067\">said</a>:</p>\n<blockquote>\n<p>I guess one small downside of changing it, is that currently we consistently(?) use <code>⊥</code> for all minimal substructures, and after this change we use <code>0</code> for some and <code>⊥</code> for others...</p>\n</blockquote>\n<p>I have always been happy with <code>0 = ⊥</code> being <code>simp</code> but thinking about it I'd be happy to revert it to <code>0</code>; this would match our preference for <code>0</code> as the normal form of the bottom element for linear orders. So, we would end up using <code>⊥</code> for all minimal structures in general lattices, and <code>0</code> for all minimal structures in linear orders (like ideals).</p>",
        "id": 566896601,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1767863841
    },
    {
        "content": "<p>One argument against this is that for ideals it would look weird to use 0 but not 1 while for most other cases the 1 would be meaningless.</p>",
        "id": 566898651,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1767864170
    },
    {
        "content": "<p>Well, but <code>1</code> has no special meaning from the lattice point of view.</p>",
        "id": 566898961,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1767864208
    },
    {
        "content": "<p>Or perhaps I don't see exactly your point, <span class=\"user-mention\" data-user-id=\"110031\">@Patrick Massot</span> : are you suggesting that we make <code>⊤ = 1</code> a simp lemma (or rather: suggesting that if we make <code>⊥ = 0</code> <code>simp</code>, then we should also do the same for <code>⊤ = 1</code> and this looks weird?)</p>",
        "id": 566899534,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1767864409
    },
    {
        "content": "<p>Precisely I say that if we want to be consistent within ideal theory then we should either use ⊥ and ⊤ or 0 and 1. But if we choose the second option then on a larger scale consistency would require to use 0 also for other submodules say, and there we would have 0 and ⊤ which looks inconsistent.</p>",
        "id": 566904041,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1767865923
    },
    {
        "content": "<p>Athough I understand your point, I'm not sure that for consistency we need to mark <code>⊤ = 1</code> as a <code>simp</code> lemma. Since ideals are implemented as submodules, and the <code>1</code> notation only makes sense for ideals and not for submodules, I feel that the <code>⊤ = 1</code> equality is more of an accident that something to be recorded.</p>",
        "id": 566906133,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1767866639
    },
    {
        "content": "<p>(and I promise I would <em>never</em> tell something of the sort to my students <span aria-label=\"smirk\" class=\"emoji emoji-1f60f\" role=\"img\" title=\"smirk\">:smirk:</span> )</p>",
        "id": 566906229,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1767866670
    },
    {
        "content": "<p>I’m not sure I understand which one you wouldn’t tell students, is it ⊤ or 1?</p>",
        "id": 566914851,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1767869450
    },
    {
        "content": "<p>I wouldn't tell students that the equality <code>⊤ = 1</code> is an accident (which is my argument for <em>not</em> marking it as <code>simp</code> although I would mark <code>⊥ = 0</code> as <code>simp</code>)</p>",
        "id": 566918881,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1767870880
    },
    {
        "content": "<p>I claim that we should keep <code>⊥</code> as the <code>simp</code> normal form even for <code>Ideal R</code>, because the lattice structure is more frequently used than the semiring structure. It's possible that I'm showing my bias here as someone who doesn't work in algebra. <span aria-label=\"shrug\" class=\"emoji emoji-1f937\" role=\"img\" title=\"shrug\">:shrug:</span></p>",
        "id": 567081268,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1767941265
    },
    {
        "content": "<p>I think that the <em>semiring</em> structure is seldom used (although all the time in algebraic number theory), but the monoid one is quite common.</p>",
        "id": 567082741,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1767942496
    },
    {
        "content": "<p>Something to keep in mind is that, even in number theory part of mathlib, currently most of results about ideals are stated (I think) using <code>⊥</code> (probably exactly because it is the <code>simp</code> normal form).</p>",
        "id": 567085974,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1767944804
    },
    {
        "content": "<p><code>Mathlib.NumberTheory.RamificationInertia.Basic</code> for a random example</p>",
        "id": 567086193,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1767944912
    },
    {
        "content": "<p>Well, it depends on what you call \"the\" simp normal form.</p>",
        "id": 567086302,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1767944967
    },
    {
        "content": "<p>(As said, having worked extensively with this part of the library, I initially believed that <code>⊥</code> was actually better, but given that we use different conventions for linear orders or for arbitrary lattices, I'm beginning to doubt)</p>",
        "id": 567086414,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1767945033
    },
    {
        "content": "<p>I don't have strong opinions, what I mean is that currently we have tons of declarations having the assumption <code>I ≠ ⊥</code>. If we decide we prefer <code>0</code> it would make sense to try to modify all these assumptions.</p>",
        "id": 567088881,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1767946235
    },
    {
        "content": "<p>My favorite example is still <a href=\"https://github.com/leanprover-community/mathematics_in_lean/blob/master/MIL/C09_Groups_and_Rings/solutions/Solutions_S02_Rings.lean#L36-L50\">https://github.com/leanprover-community/mathematics_in_lean/blob/master/MIL/C09_Groups_and_Rings/solutions/Solutions_S02_Rings.lean#L36-L50</a> that really uses the semi-ring structure.</p>",
        "id": 567090183,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1767946842
    },
    {
        "content": "<p>I think I'd also vote for bot as the simp normal form always. One could even argue to mathematicians that \"0\" is not the correct name for the zero ideal because it's actually {0}.</p>",
        "id": 567120578,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1767957601
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/conflicting.20simp-normal.20form.3A.20bot.20vs.200/near/567120578\">said</a>:</p>\n<blockquote>\n<p>because it's actually {0}.</p>\n</blockquote>\n<p>Also known as 1 <span aria-label=\"rofl\" class=\"emoji emoji-1f923\" role=\"img\" title=\"rofl\">:rofl:</span></p>",
        "id": 567126939,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1767960112
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 567139780,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1767964613
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/conflicting.20simp-normal.20form.3A.20bot.20vs.200/near/567120578\">said</a>:</p>\n<blockquote>\n<p>I think I'd also vote for bot as the simp normal form always. One could even argue to mathematicians that \"0\" is not the correct name for the zero ideal because it's actually {0}.</p>\n</blockquote>\n<p>By \"always\" do you mean also in linear orders or only for ideals?</p>",
        "id": 567163341,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1767971537
    },
    {
        "content": "<p>Oh I don't think I want simp to simplify 0 to bot in the naturals! I think I must mean \"just de-simp bot_eq_zero'\"</p>",
        "id": 567246822,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1767986311
    },
    {
        "content": "<p>Yes, I imagined... <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span> But then the naturals end up with a <code>bot</code> that does not <code>simp</code>lify to <code>0</code>.</p>",
        "id": 567246970,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1767986372
    }
]