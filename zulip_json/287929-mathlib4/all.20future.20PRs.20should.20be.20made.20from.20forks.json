[
    {
        "content": "<p>We've built a new CI setup for Mathlib, that removes the need for contributors to make PRs from branches pushed directly to the leanprover-community/mathlib4 repository, and instead allows making PRs from forks (i.e. per the usual practice for any git repository).</p>",
        "id": 523670012,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1749697604
    },
    {
        "content": "<p>We will shortly begin removing write access to the repository from contributors.</p>",
        "id": 523670016,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1749697608
    },
    {
        "content": "<p>Regardless of whether you still have write access, please <em>do not</em> open further PRs from branches on the main repository: instead open them from branches on your own fork.</p>",
        "id": 523670020,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1749697611
    },
    {
        "content": "<p>We have provided a migration tool to assist in moving an existing PR to your own fork. You will need to merge <code>master</code> into your branch, and then run <code>scripts/migrate_to_fork.py</code>.</p>",
        "id": 523670024,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1749697615
    },
    {
        "content": "<p>(Note that once we begin removing write access, if you have an old PR you will not be able to push more commits to it until you migrate it.)</p>",
        "id": 523670026,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1749697616
    },
    {
        "content": "<p><span class=\"user-mention channel-wildcard-mention\" data-user-id=\"*\">@channel</span> Please note the announcement above: all new PRS must be made from forks.</p>",
        "id": 523670058,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1749697646
    },
    {
        "content": "<p>May I suggest to have documentation for users on how to do pulls/merges/cherry picks across forks? Sometimes I might want to base a PR on another branch that someone else wrote. Or even just cherry pick another branch's commit. It's possible to do in fork land, requires adding new remotes. But others might not be as familiar with this.</p>",
        "id": 523670247,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1749697876
    },
    {
        "content": "<p>Can this be posted in the announcement channel as well?</p>",
        "id": 523670296,
        "sender_full_name": "Niels Voss",
        "timestamp": 1749697938
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"308899\">Yakov Pechersky</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523670247\">said</a>:</p>\n<blockquote>\n<p>May I suggest to have documentation for users on how to do pulls/merges/cherry picks across forks? Sometimes I might want to base a PR on another branch that someone else wrote. Or even just cherry pick another branch's commit. It's possible to do in fork land, requires adding new remotes. But others might not be as familiar with this.</p>\n</blockquote>\n<p>I'm not sure that there's anything to write here that is Mathlib specific, and there are plenty of good git tutorials (and all the AIs can do this stuff very well by now). If anyone would like to write something specifically addressed to users of Mathlib, we can certainly link to it!</p>",
        "id": 523670671,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1749698296
    },
    {
        "content": "<p>Won‚Äôt this make collaboration a lot more difficult? How are multiple people supposed to collaborate on a PR?</p>",
        "id": 523671057,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749698693
    },
    {
        "content": "<p>The owner of the fork the PR is being made from can give out write access to collaborators there.</p>\n<p>Alternatively, one can make PRs to the PR branch.</p>",
        "id": 523671104,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1749698749
    },
    {
        "content": "<p>Needing to grant permission seems like it could be a lot more friction. I have a lot of please-adopt PRs but I do not receive emails from github and it seems possible that if someone wanted to contact me to be added, I might not notice for a while.</p>",
        "id": 523671664,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1749699291
    },
    {
        "content": "<p>Hmm, I‚Äôm not sure making PRs to a PR branch is really feasible in practice‚Äîthere‚Äôs a lot of admin involved there.</p>\n<p>But the alternative‚Äîmoving between entirely different repos/forks to switch from working on a personal PR to working on a collaborative effort, and remembering which repo is associated with which collaboration‚Äîmaybe seems worse? <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span> (Maybe there are benefits I‚Äôm not thinking of, though? Separate windows in VS code can be a pro or a con‚Ä¶)</p>\n<p>I trust there‚Äôs a necessary reason for this, of course. But I wonder if we can make collaboration nicer for mathematicians (who might not be so git-savvy) in the future somehow, either with tooling or something else.</p>",
        "id": 523672329,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749699984
    },
    {
        "content": "<p>will PRs that are currently under review be merged directly to the main repo? Or should I migrate it?</p>",
        "id": 523672541,
        "sender_full_name": "Tanner Duve",
        "timestamp": 1749700208
    },
    {
        "content": "<p>You should migrate it please, if you anticipate needing to push any further commits to the branch.</p>",
        "id": 523672575,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1749700245
    },
    {
        "content": "<p>If you think it will be merged as is it's probably fine to leave for now.</p>",
        "id": 523672599,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1749700267
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"282271\">Bolton Bailey</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523671664\">said</a>:</p>\n<blockquote>\n<p>Needing to grant permission seems like it could be a lot more friction. I have a lot of please-adopt PRs but I do not receive emails from github and it seems possible that if someone wanted to contact me to be added, I might not notice for a while.</p>\n</blockquote>\n<p>In case of those <code>please-adopt</code> PRs, the person who wants to adopt the PR can pull your branch to their fork, and continue the rest of the work from their fork. I imagine they would then open a new PR, linking to your <code>please-adopt</code> PR.</p>",
        "id": 523672604,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1749700272
    },
    {
        "content": "<p>In fact, they can use the <code>migrate-to-fork.py</code> script for exactly this purpose!</p>",
        "id": 523672627,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1749700303
    },
    {
        "content": "<p>One possible unintended (negative) side effect that will increase noise is -- currently, it is very useful when a PR (let's say 9876) or issue refers to another PR by mentioning <code>#12345</code> in a git commit or github comment. That mention appears on the 12345 github page as a breadcrumb, very useful to have this informative link. </p>\n<p>Then, once 9876 is merged to master, the bors driven commit leaves another breadcrumb on 12345. Then all community contributors merge upstream master into their master. Each of those merge commits will leave a breadcrumb on 12345 as well.</p>",
        "id": 523672735,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1749700400
    },
    {
        "content": "<p>For variety, I'll express my opinion of welcoming this change. I don't think that for collaboration it is too onerous to add people to a repo (or just make PRs in the fork as Kim suggests). In return, it seems that we get a much more limited set of those with write access, a more standard process with less friction for new contributors, and I assume some benefits in partially decentralizing CI. I'm sure this took effort, thanks for your work!</p>",
        "id": 523672796,
        "sender_full_name": "Chris Henson",
        "timestamp": 1749700484
    },
    {
        "content": "<p>Would there be some way of configuring Mathlib issues and PRs in github to not show fork breadcrumbs?</p>",
        "id": 523672892,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1749700565
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"308899\">@Yakov Pechersky</span> could you link to such a breadcrumb? So far I don't understand what you mean.</p>",
        "id": 523673001,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1749700656
    },
    {
        "content": "<blockquote>\n<p>I trust there‚Äôs a necessary reason for this, of course.</p>\n</blockquote>\n<p>There definitely is a valid reason. While I haven't seen anyone deleting all the branches in Mathlib this is bound to happen.</p>",
        "id": 523673389,
        "sender_full_name": "(deleted)",
        "timestamp": 1749700930
    },
    {
        "content": "<p>I'm in mobile right now, so my screenshot is of the mobile app. By breadcrumb I mean the \"referenced this\" entries in the conversation flow. <a href=\"/user_uploads/3121/XOLBd-ss0WzzyhtG32tEJmi3/042598ad-9fca-4085-b50c-87a726424b33.png\">042598ad-9fca-4085-b50c-87a726424b33.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/XOLBd-ss0WzzyhtG32tEJmi3/042598ad-9fca-4085-b50c-87a726424b33.png\" title=\"042598ad-9fca-4085-b50c-87a726424b33.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1080x2340\" src=\"/user_uploads/thumbnail/3121/XOLBd-ss0WzzyhtG32tEJmi3/042598ad-9fca-4085-b50c-87a726424b33.png/840x560.webp\"></a></div>",
        "id": 523673421,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1749700953
    },
    {
        "content": "<p>Okay, if you see breadcrumbs appearing inappropriately in irrelevant places, please post a link!</p>",
        "id": 523673512,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1749701020
    },
    {
        "content": "<p>(For the record, let me be clear and also applaud the work done here in making Mathlib more secure! I certainly don‚Äôt mean to naysay it just by worrying about changing collaboration workflows and such. :) )</p>",
        "id": 523673811,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749701289
    },
    {
        "content": "<p>As with all change, something is lost and something is gained.</p>\n<p>With this change, I think that aligning with well-tested and established workflows, not having to rely on asking for permissions to propose a change and managing your own version of mathlib while developing a PR are all big advantages that outweigh the negatives.</p>",
        "id": 523674712,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1749702105
    },
    {
        "content": "<p>Do I need to close my current PRs and reopen new one? Seems that the source branch in a PR can't be edited.</p>",
        "id": 523675444,
        "sender_full_name": "Jz Pan",
        "timestamp": 1749702629
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523670024\">said</a>:</p>\n<blockquote>\n<p>We have provided a migration tool to assist in moving an existing PR to your own fork. You will need to merge <code>master</code> into your branch, and then run <code>scripts/migrate_to_fork.py</code>.</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"366779\">@Jz Pan</span> <span aria-label=\"up\" class=\"emoji emoji-2b06\" role=\"img\" title=\"up\">:up:</span></p>",
        "id": 523675910,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1749703044
    },
    {
        "content": "<p>I've read that script. But I'm on Windows and don't have the dependency installed (e.g. <code>gh</code> command line tool). Since currently I have only one open PR so I'd rather like to do it manually.</p>\n<p>Do the following steps correct?</p>\n<ol>\n<li>Fork mathlib</li>\n<li>In my computer, change the <code>remote</code> to my fork and push my working branches to my fork</li>\n<li>close my current PRs and reopen new one</li>\n<li>that's all?</li>\n</ol>",
        "id": 523677253,
        "sender_full_name": "Jz Pan",
        "timestamp": 1749704348
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 523677294,
        "sender_full_name": "Jz Pan",
        "timestamp": 1749704393
    },
    {
        "content": "<p>Yup, that's the gist of it!</p>",
        "id": 523677361,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1749704431
    },
    {
        "content": "<p>Then will all (contributed) branches be removed from Mathlib? If so, it should be nice to announce that also, to make sure to notice everyone who needs backup.</p>",
        "id": 523677748,
        "sender_full_name": "Jihoon Hyun",
        "timestamp": 1749704703
    },
    {
        "content": "<p>I don't think we need to rush that.</p>",
        "id": 523681535,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1749707522
    },
    {
        "content": "<p>This is a cool change. Will it change anything about CI from a point of view of mathlib caching and that.</p>",
        "id": 523683472,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1749708800
    },
    {
        "content": "<p>It should be working. There are now isolated caches for each fork, plus a central cache that is only updated when changes hit <code>master</code>.</p>",
        "id": 523683567,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1749708862
    },
    {
        "content": "<p>(I should say: this change was a huge effort, with many people helping! Thanks to <span class=\"user-mention\" data-user-id=\"112680\">@Johan Commelin</span>, <span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span>, <span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span> (this has been a significant priority for the FRO this quarter), as well as  <span class=\"user-mention\" data-user-id=\"123965\">@Bryan Gin-ge Chen</span>, <span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span>, <span class=\"user-mention\" data-user-id=\"306577\">@Matthew Ballard</span>, and <span class=\"user-mention\" data-user-id=\"128280\">@ùö†ùöòùöìùöåùöíùöéùöåùöë ùöóùöäùö†ùöõùöòùöåùöîùöí</span>  for making it happen, and to many others for testing and advice.)</p>",
        "id": 523683966,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1749709142
    },
    {
        "content": "<p>(and ... <span aria-label=\"drum\" class=\"emoji emoji-1f941\" role=\"img\" title=\"drum\">:drum:</span> there's more goodies, including caching for all downstream projects, in the pipeline. :-)</p>",
        "id": 523684047,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1749709217
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523684047\">said</a>:</p>\n<blockquote>\n<p>(and ... <span aria-label=\"drum\" class=\"emoji emoji-1f941\" role=\"img\" title=\"drum\">:drum:</span> there's more goodies, including caching for all downstream projects, in the pipeline. :-)</p>\n</blockquote>\n<p>By this, do you mean that downstream projects can host and maintain cache server for them, or that some downstream projects will be cached on FROs server, or both?</p>",
        "id": 523688324,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1749711418
    },
    {
        "content": "<p>TBD, I think.</p>",
        "id": 523688430,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1749711465
    },
    {
        "content": "<p>Some things I noticed with the migration script:</p>\n<ul>\n<li>draft PRs are reopened as non-draft PRs when migrated.</li>\n<li>for PRs depending on others, the migrated PRs uses the old numbers for dependent PRs and have to be manually updated with the new dependency, but this is probably hard to tackle, and ultimately not too bad.</li>\n</ul>",
        "id": 523698450,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1749715336
    },
    {
        "content": "<p>It also looks like dependabot consider that a closed PR is a merged PR, and so removes the \"blocked-by-other-PR\" tag when a pr gets migrated. Perhaps the bot should check that the pr gets closed <em>and</em> merged by bors?</p>",
        "id": 523699511,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1749715694
    },
    {
        "content": "<p>Will all the branches be preserved? There's probably a substantial amount of work that never got PR'd and might be lost if the branches were deleted</p>",
        "id": 523699774,
        "sender_full_name": "Niels Voss",
        "timestamp": 1749715782
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"521331\">Niels Voss</span> <a href=\"#narrow/stream/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523699774\">said</a>:</p>\n<blockquote>\n<p>Will all the branches be preserved? There's probably a substantial amount of work that never got PR'd and might be lost if the branches were deleted</p>\n</blockquote>\n<p>Using the GitHub web interface, all branches will get copied to the fork if you uncheck the little box that says copy only the default branch (see eg <a href=\"https://github.blog/changelog/2022-07-27-you-can-now-fork-a-repo-and-copy-only-the-default-branch/\">https://github.blog/changelog/2022-07-27-you-can-now-fork-a-repo-and-copy-only-the-default-branch/</a>)</p>",
        "id": 523703071,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1749716874
    },
    {
        "content": "<p>Re: migration script, we expect there will be some edge cases. The same holds the full suite existing CI. Please complain loudly about things that don‚Äôt work as expected (or better yet propose fixes).</p>",
        "id": 523703336,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1749716982
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523683966\">said</a>:</p>\n<blockquote>\n<p>(I should say: this change was a huge effort, with many people helping! Thanks to <span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span>, <span class=\"user-mention silent\" data-user-id=\"315577\">Mac Malone</span>, <span class=\"user-mention silent\" data-user-id=\"110024\">Sebastian Ullrich</span> (this has been a significant priority for the FRO this quarter), as well as  <span class=\"user-mention silent\" data-user-id=\"123965\">Bryan Gin-ge Chen</span>, <span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span>, <span class=\"user-mention silent\" data-user-id=\"306577\">Matthew Ballard</span>, and <span class=\"user-mention silent\" data-user-id=\"128280\">ùö†ùöòùöìùöåùöíùöéùöåùöë ùöóùöäùö†ùöõùöòùöåùöîùöí</span>  for making it happen, and to many others for testing and advice.)</p>\n</blockquote>\n<p>Says atlas as they hold up the world ;) Thanks <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span>!</p>",
        "id": 523703445,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1749717022
    },
    {
        "content": "<p>Matthew, the link you gave says that the default is precisely the inverse: by default, only master gets copied.<br>\nBut if yes if you uncheck that checkbox, you get all branches.</p>",
        "id": 523703525,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1749717055
    },
    {
        "content": "<p>I think you need to opt in for this</p>",
        "id": 523703631,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1749717092
    },
    {
        "content": "<p>Oh no, you need to opt out for this! Using <code>gh</code> this is not the case</p>",
        "id": 523703864,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1749717174
    },
    {
        "content": "<p>Ultra-na√Øve question: how does one <em>fork</em> mathlib?</p>",
        "id": 523709262,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1749718821
    },
    {
        "content": "<p>Here: <a href=\"https://github.com/leanprover-community/mathlib4/fork\">https://github.com/leanprover-community/mathlib4/fork</a></p>",
        "id": 523709484,
        "sender_full_name": "Christian Merten",
        "timestamp": 1749718887
    },
    {
        "content": "<p>there is also a \"fork\" button on the right of mathlib's name on the repo main page.</p>",
        "id": 523709823,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1749718985
    },
    {
        "content": "<p>Is there a naming rule for the branches we create by forking?</p>",
        "id": 523709892,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1749719000
    },
    {
        "content": "<p>No</p>",
        "id": 523709934,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1749719013
    },
    {
        "content": "<p>At least two options that I know of:</p>\n<ol>\n<li><code>gh repo fork leanprover-community/mathlib4</code> </li>\n<li>GitHub web interface: click on the little fork <a href=\"/user_uploads/3121/5NwVviI_QhdbizDRkPbs5-mb/BF60E982-8255-430A-B58E-CA08D76AC4A9.jpg\">icon</a><div class=\"message_inline_image\"><a href=\"/user_uploads/3121/5NwVviI_QhdbizDRkPbs5-mb/BF60E982-8255-430A-B58E-CA08D76AC4A9.jpg\" title=\"icon\"><img data-original-content-type=\"image/jpeg\" data-original-dimensions=\"2678x582\" src=\"/user_uploads/thumbnail/3121/5NwVviI_QhdbizDRkPbs5-mb/BF60E982-8255-430A-B58E-CA08D76AC4A9.jpg/840x560.webp\"></a></div></li>\n</ol>",
        "id": 523709984,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1749719034
    },
    {
        "content": "<p>You can also do it more manually but unless you need to I wouldn‚Äôt recommend it</p>",
        "id": 523710318,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1749719135
    },
    {
        "content": "<p>The migration script includes the creation of a fork.</p>",
        "id": 523710513,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1749719188
    },
    {
        "content": "<p>Anyways, a big thank for the migration script! without it, migrating 30PRs would have been a very very massive pain!</p>",
        "id": 523710553,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1749719200
    },
    {
        "content": "<p>Did you do all 30 already?</p>",
        "id": 523710649,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1749719229
    },
    {
        "content": "<p>I've created my fork and the first branches in it. As far as I can tell, CI does not run on the branches. Do I understand correctly that, for CI to run, I should create a PR to mathlib? Side question: if the branch is for experimentation, and will never become a true PR, should I mark it as WIP, or should we have another label for that?</p>",
        "id": 523710854,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1749719296
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306577\">Matthew Ballard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523710649\">said</a>:</p>\n<blockquote>\n<p>Did you do all 30 already?</p>\n</blockquote>\n<p>yup</p>",
        "id": 523710913,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1749719312
    },
    {
        "content": "<p>(I did not count fixing the CI errors induced by merging master on some old PRs in the \"migration\", though, this will definitely take more time)</p>",
        "id": 523711139,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1749719396
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110050\">S√©bastien Gou√´zel</span> <a href=\"#narrow/stream/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523710854\">said</a>:</p>\n<blockquote>\n<p>I've created my fork and the first branches in it. As far as I can tell, CI does not run on the branches. Do I understand correctly that, for CI to run, I should create a PR to mathlib? Side question: if the branch is for experimentation, and will never become a true PR, should I mark it as WIP, or should we have another label for that?</p>\n</blockquote>\n<p>I think the answer depends on which CI workflow you are talking about. I‚Äôve had the main build step go through on pushes to branches on my fork. </p>\n<p>Side question: this is for PR you just making for extra CI goodness? I did that in the previous setup quite a bit (eg bench) and just marked it draft.</p>",
        "id": 523711493,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1749719519
    },
    {
        "content": "<p>Running the migration scripts on my end now. First fork PR is <a href=\"https://github.com/leanprover-community/mathlib4/pull/25770\">#25770</a></p>",
        "id": 523711696,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1749719583
    },
    {
        "content": "<p>Is it OK?</p>",
        "id": 523711786,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1749719610
    },
    {
        "content": "<p>I have a whole bunch of open PRs, only one of which (<a href=\"https://github.com/leanprover-community/mathlib4/pull/25646\">#25646</a>) has a chance of being merged as is. I'm also not as experienced with standard git workflows (having never pushed to anything from a fork). I interact with github from the website (creating and managing repositories) and from the command line (frequently running the basic commands but with no advanced skills). </p>\n<p>After creating my fork (which I haven't yet done) and migrating all my PRs, I'd like to delete the local clone of mathlib (directly from the main repository, not from a fork) and replace it with a local version of my fork. But I'm not quite sure about the correct order of operations.</p>\n<p>Is this the correct workflow:</p>\n<ol>\n<li>First I need to fork mathlib (eg using the web interface). </li>\n<li>Then I need to migrate each open PR. Can I run the script mentioned above without having a local clone yet of my fork?</li>\n<li>After doing this am I safe to delete my local clone of mathlib and replace it with a local clone of the fork?</li>\n<li>Having done all of this how do I keep my fork up to date with the main mathlib?</li>\n<li>Having done all of this how do I invite all of the contributors to my PRs to give them continued access. Each one has a different contributor subset. Should I just add all these people to my fork? Or do I need different forks for each collaborative PR? If the latter, how do people manage all of this? (Eg at the end of the year, will I end up with dozens of mathlib forks that I'm managing? If so, is there a way to have offline access to these without cluttering up everything?)</li>\n</ol>\n<p>Perhaps relevant to the last question: I tend to prefer alternatives that are a bit simpler, even if less optimal from a security POV.</p>\n<p>Apologies for the naive questions and thanks in advance.</p>",
        "id": 523711924,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1749719658
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306577\">Matthew Ballard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523711493\">said</a>:</p>\n<blockquote>\n<p>I think the answer depends on which CI workflow you are talking about. I‚Äôve had the main build step go through on pushes to branches on my fork. </p>\n</blockquote>\n<p>I meant the main build steps. On <a href=\"https://github.com/sgouezel/mathlib4/branches\">https://github.com/sgouezel/mathlib4/branches</a>, I don't see any CI output in the check status, for instance. Should I maybe activate github actions or whatever?</p>",
        "id": 523712197,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1749719740
    },
    {
        "content": "<p>(and it doesn't mention PR numbers, although I've opened PRs for all the three branches. I'm definitely doing something wrong here...)</p>",
        "id": 523712488,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1749719829
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"246635\">@Emily Riehl</span> : you don‚Äôt need to re-clone the fork. You can keep you local mathlib folder and the migration script will update its remotes (the things that tell <code>git</code> where to push/pull stuff) to have \"origin\" point to your github fork, and \"upstream\" point to mathlib.</p>",
        "id": 523712977,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1749719968
    },
    {
        "content": "<p>So your local clone of mathlib will \"become\" the local clone of you fork</p>",
        "id": 523713116,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1749720010
    },
    {
        "content": "<p>Similarly for collaboration, you can have as many remotes as you want in your mathlib local folder, all pointing to different forks if you want!</p>",
        "id": 523713458,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1749720128
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110050\">S√©bastien Gou√´zel</span> <a href=\"#narrow/stream/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523712488\">said</a>:</p>\n<blockquote>\n<p>(and it doesn't mention PR numbers, although I've opened PRs for all the three branches. I'm definitely doing something wrong here...)</p>\n</blockquote>\n<p>Sorry for being dense, but what should mention the PR numbers</p>",
        "id": 523715118,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1749720620
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306577\">Matthew Ballard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523715118\">said</a>:</p>\n<blockquote>\n<p>Sorry for being dense, but what should mention the PR numbers</p>\n</blockquote>\n<p>Sorry for not being clear. When I look at my branches on leanprover-community/mathlib (<a href=\"https://github.com/leanprover-community/mathlib4/branches\">https://github.com/leanprover-community/mathlib4/branches</a>), the \"pull request\" column shows the number of the PR I've opened for a given branch, and I can click on it to go to the PR. On my fork, (<a href=\"https://github.com/sgouezel/mathlib4/branches\">https://github.com/sgouezel/mathlib4/branches</a>), the \"pull request\" column is empty, even though I've opened PRs for all these branches.</p>",
        "id": 523715724,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1749720840
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"286014\">@Robin Carlier</span>'s answer to my question above makes me realize I don't understand the migration script. Where and when do I run it? </p>\n<p>Should I create a fork first before running it, or run it first? If I have multiple open PRs, do I run this multiple times (after checking out each branch separately) or do I just run this once? Is the script creating separate forks for each one or moving them all to branches of a single new fork? What else do I need to know?</p>",
        "id": 523716177,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1749720968
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110050\">S√©bastien Gou√´zel</span> <a href=\"#narrow/stream/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523715724\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"306577\">Matthew Ballard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523715118\">said</a>:</p>\n<blockquote>\n<p>Sorry for being dense, but what should mention the PR numbers</p>\n</blockquote>\n<p>Sorry for not being clear. When I look at my branches on leanprover-community/mathlib (<a href=\"https://github.com/leanprover-community/mathlib4/branches\">https://github.com/leanprover-community/mathlib4/branches</a>), the \"pull request\" column shows the number of the PR I've opened for a given branch, and I can click on it to go to the PR. On my fork, (<a href=\"https://github.com/sgouezel/mathlib4/branches\">https://github.com/sgouezel/mathlib4/branches</a>), the \"pull request\" column is empty, even though I've opened PRs for all these branches.</p>\n</blockquote>\n<p>I don‚Äôt see this either on mine. So I guess this is broken at the moment. Not sure if by design or some other reasons. Thanks for pointing it out</p>",
        "id": 523716265,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1749720998
    },
    {
        "content": "<p>Also, if people happen to be in the same room with me (or same building) right now, it will probably be more efficient to talk in person.</p>",
        "id": 523718099,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1749721568
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306577\">Matthew Ballard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523718099\">said</a>:</p>\n<blockquote>\n<p>Also, if people happen to be in the same room with me (or same building) right now, it will probably be more efficient to talk in person.</p>\n</blockquote>\n<p>Sorry, I'm not at Big Proof</p>",
        "id": 523718605,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1749721740
    },
    {
        "content": "<p>sorry if this has been answered before, there are 100 messages here; will the CI stuff automatically come with the fork, or will we have to set it up ourselves?</p>",
        "id": 523720863,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1749722478
    },
    {
        "content": "<p>The essential CI should run on your fork but you may need to enable actions for the repository.</p>",
        "id": 523721048,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1749722547
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"246635\">Emily Riehl</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523711924\">said</a>:</p>\n<blockquote>\n<p>Is this the correct workflow:</p>\n<ol>\n<li>First I need to fork mathlib (eg using the web interface).</li>\n<li>Then I need to migrate each open PR. Can I run the script mentioned above without having a local clone yet of my fork?</li>\n<li>After doing this am I safe to delete my local clone of mathlib and replace it with a local clone of the fork?</li>\n<li>Having done all of this how do I keep my fork up to date with the main mathlib?</li>\n<li>Having done all of this how do I invite all of the contributors to my PRs to give them continued access. Each one has a different contributor subset. Should I just add all these people to my fork? Or do I need different forks for each collaborative PR? If the latter, how do people manage all of this? (Eg at the end of the year, will I end up with dozens of mathlib forks that I'm managing? If so, is there a way to have offline access to these without cluttering up everything?)</li>\n</ol>\n<p>Perhaps relevant to the last question: I tend to prefer alternatives that are a bit simpler, even if less optimal from a security POV.</p>\n</blockquote>\n<p>Sorry if this is repeating answers elsewhere, I just want to make sure these points are all addressed in one place. <span class=\"user-mention\" data-user-id=\"246635\">@Emily Riehl</span> </p>\n<p>‚ÇÅ You <em>may</em> create a fork before running <code>migrate_to_fork.py</code>, but don't need to --- on the first run the script will do this for you.<br>\n‚ÇÇ You run the script by checking out each branch in turn, merging master (so the script is present), and running <code>script/migrate_to_fork.py</code></p>\n<p>* (Note that you can do this for branches with an associated PR, or for branches that don't yet have a PR.)<br>\n  * (Also, if you have reason to not want to merge master, it's also fine to just copy the script off <code>master</code>.)<br>\n‚ÇÉ Yes, if you've done this for every local branch, it should be safe, but also completely unnecessary. All that's happen after the script (with default settings) is that now the remote named <code>upstream</code> points to <code>leanprover-community/mathlib4</code> while the remote named <code>origin</code> points to <code>username/mathlib4</code>.<br>\n‚ÇÑ There are many solutions to keeping up to date. My suggestion would be to <em>not</em> keep up to date, and instead set your local copy of master to track the <code>upstream</code> remote, and just completely ignore the <code>master</code> branch in your fork:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">checkout</span><span class=\"w\"> </span><span class=\"n\">master</span>\n<span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">checkout</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">master</span><span class=\"w\"> </span><span class=\"n\">upstream</span><span class=\"bp\">/</span><span class=\"n\">master</span>\n</code></pre></div>\n<p>‚ÇÖ If you go to <a href=\"https://github.com/emilyriehl/mathlib4/settings/access\">https://github.com/emilyriehl/mathlib4/settings/access</a>, you can give people access to your fork. I would recommend just adding anyone you regularly collaborate with there. There is only need for a single fork.</p>",
        "id": 523723565,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1749723466
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523723565\">said</a>:</p>\n<blockquote>\n<p>‚ÇÑ There are many solutions to keeping up to date. My suggestion would be to <em>not</em> keep up to date, and instead set your local copy of master to track the <code>upstream</code> remote, and just completely ignore the <code>master</code> branch in your fork:</p>\n<p>git checkout master<br>\ngit checkout -b master upstream/master</p>\n</blockquote>\n<p>This second command failed for me with the error </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">fatal</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">upstream</span><span class=\"bp\">/</span><span class=\"n\">master'</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">commit</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">branch</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">master'</span><span class=\"w\"> </span><span class=\"n\">cannot</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">created</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">it</span>\n</code></pre></div>\n<p>Would you explain what it is trying to do?</p>",
        "id": 523731239,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1749726005
    },
    {
        "content": "<p>I think you need first of all</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>git<span class=\"w\"> </span>fetch<span class=\"w\"> </span>upstream\n</code></pre></div>",
        "id": 523731520,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1749726082
    },
    {
        "content": "<p>Now there's a new error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">fatal</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">branch</span><span class=\"w\"> </span><span class=\"n\">named</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">master'</span><span class=\"w\"> </span><span class=\"n\">already</span><span class=\"w\"> </span><span class=\"n\">exists</span>\n</code></pre></div>\n<p>But I also don't understand what this command is trying to do.</p>",
        "id": 523732204,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1749726297
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>git<span class=\"w\"> </span>branch<span class=\"w\"> </span>--set-upstream-to<span class=\"o\">=</span>upstream/master\n</code></pre></div>\n<p>should work</p>",
        "id": 523732755,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1749726482
    },
    {
        "content": "<p>Another (very minor) annoyance with the new CI: when a build is queued, the build step doesn't show anything (while before it used to show something like \"queued, waiting for an available runner\"). <br>\n<a href=\"/user_uploads/3121/VBiu-SqoUGPxq51UtVBNMsOW/queued.png\">queued.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/VBiu-SqoUGPxq51UtVBNMsOW/queued.png\" title=\"queued.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1233x654\" src=\"/user_uploads/thumbnail/3121/VBiu-SqoUGPxq51UtVBNMsOW/queued.png/840x560.webp\"></a></div>",
        "id": 523732906,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1749726541
    },
    {
        "content": "<p>Did that build eventually start?</p>",
        "id": 523734094,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1749727016
    },
    {
        "content": "<p>It just occurred to me, is there a PSA issue about this or something about this change on GitHub? Or in the README.md? Some people with open PRs might not be following closely the zulip chat and might get confused</p>",
        "id": 523734352,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1749727121
    },
    {
        "content": "<p>The webpage needs updating</p>",
        "id": 523734607,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1749727218
    },
    {
        "content": "<p>Note that this topic started out as \"all <em>future</em> PRs should be made from forks\", and it seems to have diverged into \"all open PRs should migrate to forks\".<br>\nWhile it is good to stress test the migration script, I don't think we need to rush migrating 1000 open PRs to forks in 24hrs or so.</p>",
        "id": 523734641,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1749727227
    },
    {
        "content": "<p>The README.md as well.</p>",
        "id": 523734662,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1749727237
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306577\">Matthew Ballard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523734094\">said</a>:</p>\n<blockquote>\n<p>Did that build eventually start?</p>\n</blockquote>\n<p>Yes, it did, after more than one hour, and completed fine. (The queue is currently very long, probably because of everyone moving the PRs to forks, and <del>three</del> four runners being offline)</p>",
        "id": 523735767,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1749727614
    },
    {
        "content": "<p>I <strong>think</strong> Github CI controls this information and there is no knob we can turn to get the old behavior back for a fork. Is there any info on the main repo?</p>",
        "id": 523735941,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1749727676
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523734641\">said</a>:</p>\n<blockquote>\n<p>Note that this topic started out as \"all <em>future</em> PRs should be made from forks\", and it seems to have diverged into \"all open PRs should migrate to forks\".<br>\nWhile it is good to stress test the migration script, I don't think we need to rush migrating 1000 open PRs to forks in 24hrs or so.</p>\n</blockquote>\n<p>I think the issue here is that if we don't migrate, then we can't add on existing branches<br>\n(I agree tho that if it is a finished PR then there's no need to do it now)</p>",
        "id": 523737007,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1749728074
    },
    {
        "content": "<p>Another data point: I have activated actions on my fork, but for branches which are not PRed to mathlib CI starts, but it skips all the steps. Any idea what I might be doing wrong?<br>\n<a href=\"/user_uploads/3121/B6KaKEd1XICVO8s67guzSfTq/skip.png\">skip.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/B6KaKEd1XICVO8s67guzSfTq/skip.png\" title=\"skip.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1627x736\" src=\"/user_uploads/thumbnail/3121/B6KaKEd1XICVO8s67guzSfTq/skip.png/840x560.webp\"></a></div>",
        "id": 523742277,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1749729988
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523670058\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention channel-wildcard-mention silent\" data-user-id=\"*\">channel</span> Please note the announcement above: all new PRS must be made from forks.</p>\n</blockquote>\n<p>i would really like to know <em>why</em> this decision has been made, particularly since it seems to have been made without any mention of open discussion in the community or at least on zulip? If mathlib is to be a community project, surely the community should have a say in, or at least be informed about ongoing decision making about the project? To me this news comes like a bolt from the blue...</p>",
        "id": 523742295,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1749729994
    },
    {
        "content": "<p>I'll respond to that in a DM</p>",
        "id": 523742556,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1749730100
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110050\">S√©bastien Gou√´zel</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523742277\">said</a>:</p>\n<blockquote>\n<p>Another data point: I have activated actions on my fork, but for branches which are not PRed to mathlib CI starts, but it skips all the steps. Any idea what I might be doing wrong?</p>\n</blockquote>\n<p>Looks like it's not specific to my setup. For instance, <a href=\"https://github.com/mattrobball/mathlib4/actions\">https://github.com/mattrobball/mathlib4/actions</a> shows that all actions are also skipped there.</p>",
        "id": 523742974,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1749730233
    },
    {
        "content": "<p>I think CI will only run on PRs.</p>",
        "id": 523743039,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1749730259
    },
    {
        "content": "<p>If you want CI for some branch, then I think it's best to create a WIP/draft PR</p>",
        "id": 523743141,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1749730282
    },
    {
        "content": "<p>That's what I had understood, but Matthew told me the following:</p>\n<p><span class=\"user-mention silent\" data-user-id=\"306577\">Matthew Ballard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523721048\">said</a>:</p>\n<blockquote>\n<p>The essential CI should run on your fork but you may need to enable actions for the repository.</p>\n</blockquote>",
        "id": 523743238,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1749730311
    },
    {
        "content": "<p>I thought I had observed this. Though the sample set might have just been PRed branches</p>",
        "id": 523743386,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1749730369
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"286014\">Robin Carlier</span> <a href=\"#narrow/stream/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523734662\">said</a>:</p>\n<blockquote>\n<p>The README.md as well.</p>\n</blockquote>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/25810\">#25810</a></p>",
        "id": 523753929,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1749733849
    },
    {
        "content": "<p>Should we split messages about moving  <em>existing</em> PRs to a new thread?</p>",
        "id": 523754412,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749734012
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306577\">Matthew Ballard</span> <a href=\"#narrow/stream/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523734607\">said</a>:</p>\n<blockquote>\n<p>The webpage needs updating</p>\n</blockquote>\n<p>This is in process at <a href=\"https://github.com/leanprover-community/leanprover-community.github.io/pull/638\">https://github.com/leanprover-community/leanprover-community.github.io/pull/638</a> (linkifier‚Ä¶?)</p>",
        "id": 523754489,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1749734036
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306577\">Matthew Ballard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523754489\">said</a>:</p>\n<blockquote>\n<p>This is in process at <a href=\"https://github.com/leanprover-community/leanprover-community.github.io/pull/638\">https://github.com/leanprover-community/leanprover-community.github.io/pull/638</a> (linkifier‚Ä¶?)</p>\n</blockquote>\n<p>Per your suggestion, I've merged, but there are still various things that need to be fixed.</p>",
        "id": 523763772,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1749736792
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110050\">S√©bastien Gou√´zel</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523743238\">said</a>:</p>\n<blockquote>\n<p>That's what I had understood, but Matthew told me the following:<br>\n<span class=\"user-mention silent\" data-user-id=\"306577\">Matthew Ballard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523721048\">said</a>:</p>\n<blockquote>\n<p>The essential CI should run on your fork but you may need to enable actions for the repository.<br>\n</p>\n</blockquote>\n</blockquote>\n<p>CI will run on PRs from forks even if GitHub actions isn't enabled in the fork (I just tested by disabling actions in my fork and submitting a PR); in fact, I think if you enable actions in your fork you might get CI errors from workflows that aren't designed to be run in forks (though the last ones I'm aware of should be disabled in <a href=\"https://github.com/leanprover-community/mathlib4/pull/25813\">#25813</a>).</p>",
        "id": 523766920,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1749737685
    },
    {
        "content": "<p>As for managing merges and cherry picks from multiple users, maybe using <a href=\"https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/configuring-pull-request-merges/managing-a-merge-queue\">Github Merge Queues</a> could help. Though maybe you'd want to save this for later, it seems reasonable to limit a project to one big development workflow transition at a time. <span aria-label=\"smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 523768940,
        "sender_full_name": "Joe Taber",
        "timestamp": 1749738244
    },
    {
        "content": "<p>Another small issue in the new PR management (not sure it's by design or not): when a PR is merged from a fork, the branch is not deleted automatically.</p>",
        "id": 523773498,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1749739536
    },
    {
        "content": "<p>A message was moved from this topic to <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/Feedback.20on.20scripts.2Fmigrate_to_fork.2Epy/with/523697294\">#mathlib4 &gt; Feedback on scripts/migrate_to_fork.py</a> by <span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span>.</p>",
        "id": 523774073,
        "sender_full_name": "Notification Bot",
        "timestamp": 1749739710
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523737007\">said</a>:</p>\n<blockquote>\n<p>I think the issue here is that if we don't migrate, then we can't add on existing branches<br>\n(I agree tho that if it is a finished PR then there's no need to do it now)</p>\n</blockquote>\n<p>We are explicitly not at this moment removing write access for everyone. At some unspecified date in the future, you will need to migrate open PRs to forks, and you are welcome to choose to do so before this date (especially for unreviewed PRs). There should be no technical restriction preventing you from pushing new commits to existing branches.</p>\n<p>What changed is that there now <em>is</em> a technical restriction that prevents creating any <em>new</em> branches.</p>",
        "id": 523776066,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749740291
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110050\">S√©bastien Gou√´zel</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523773498\">said</a>:</p>\n<blockquote>\n<p>Another small issue in the new PR management (not sure it's by design or not): when a PR is merged from a fork, the branch is not deleted automatically.</p>\n</blockquote>\n<p>bors does this auto-deletion for us now, but it doesn't have permission to delete branches in the forked repos. There's also <a href=\"https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/configuring-pull-request-merges/managing-the-automatic-deletion-of-branches\">a repo setting</a> to auto-delete but I suspect this also won't work for branches in forks.</p>",
        "id": 523778318,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1749740912
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"246635\">@Emily Riehl</span> : About keeping your fork up to date. GitHub provides a button to do this with the text ‚ÄúSync fork‚Äù. When you create a fork of mathlib, I suggest never pushing to its master branch. As before, create a fresh new branch for every PR.</p>",
        "id": 523816214,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1749754968
    },
    {
        "content": "<p>As long as you keep the master branch free from any commits of your own, the sync fork feature will bring  the master branch of your fork up to date with the main repository</p>",
        "id": 523816389,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1749755030
    },
    {
        "content": "<p>Could we possibly write down somewhere a ‚Äòstandard‚Äô process for setting the correct upstream &amp; remotes, syncing regularly, etc. which would be suitable for slightly git-averse mathematicians (like myself)?</p>\n<p>E.g., I‚Äôm not looking forward to switching to a browser window, clicking the ‚Äúsync fork‚Äù button (currently how I do it for fork-model repos), running git fetch, etc., all to merge master‚Ä¶which is what I would have done by default.</p>",
        "id": 523817972,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749755706
    },
    {
        "content": "<p>You can generally do everything you want through the GitHub cli (e.g., <code>gh repo sync</code> etc.)</p>",
        "id": 523818140,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1749755781
    },
    {
        "content": "<p>you don‚Äôt have to do much. Just go to your fork on GitHub and if it is behind the main repository, GitHub will point that out and suggest that you sync fork</p>",
        "id": 523818273,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1749755842
    },
    {
        "content": "<p>My main suggestion is to keep the master branch of your fork clean. Not push anything to it.</p>",
        "id": 523818369,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1749755882
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/stream/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523818273\">said</a>:</p>\n<blockquote>\n<p>you don‚Äôt have to do much. Just go to your fork on GitHub and if it is behind the main repository, GitHub will point that out and suggest that you sync fork</p>\n</blockquote>\n<p>Which it almost always will be, so if I wasn‚Äôt pointed to <code>gh</code> in this thread, I‚Äôd be opening a browser window all the time now, right?</p>",
        "id": 523818469,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749755934
    },
    {
        "content": "<p>True. But I think the web interface is safer for anyone who doesn‚Äôt want to get deep into git technicalities</p>",
        "id": 523818560,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1749755981
    },
    {
        "content": "<p><code>gh</code> is relatively user friendly. It's the porcelain's porcelain.</p>",
        "id": 523818861,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1749756142
    },
    {
        "content": "<p>I‚Äôm hoping we can come up with a smoother interface for mathematicians than either ‚Äúalways go to github.com‚Äù or ‚Äúlearn git technicalities‚Äù :) I‚Äôm betting that there‚Äôs a simple set of instructions and commands to be aware of that would make this smooth for most people, and which could be written down somewhere.</p>",
        "id": 523818888,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749756157
    },
    {
        "content": "<p>personally, I disagree with this. I've been advocating to mathematicians for <em>years</em> before I ever started using Lean that they should be writing their LaTeX papers using git (or some other version control).</p>",
        "id": 523819074,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1749756241
    },
    {
        "content": "<p>I like <code>gh</code>, it works well.</p>",
        "id": 523819083,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1749756242
    },
    {
        "content": "<p>In terms of not modifying <code>master</code> of your own fork, I think that is also important.  In fact, you can set up <code>git-hooks</code> that warn/prevent you from directly committing changes to <code>master</code>.</p>",
        "id": 523819090,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1749756244
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"197836\">Jireh Loreaux</span> <a href=\"#narrow/stream/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523818861\">said</a>:</p>\n<blockquote>\n<p><code>gh</code> is relatively user friendly. It's the porcelain's porcelain.</p>\n</blockquote>\n<p>I‚Äôm sure you‚Äôre right, but I wouldn‚Äôt be using it if I weren‚Äôt pointed to it in this thread as a thing which has these capabilities (how would I know?), and so would probably be causing myself a lot more friction regularly than necessary. :)</p>",
        "id": 523819120,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749756261
    },
    {
        "content": "<p>\"Mathematicians can learn complicated math, they can learn git\"</p>",
        "id": 523819238,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1749756320
    },
    {
        "content": "<p>Another fairly user-friendly UI-based alternative might be <a href=\"https://github.com/apps/desktop\">GitHub Desktop</a></p>",
        "id": 523819254,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1749756324
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"197836\">Jireh Loreaux</span> <a href=\"#narrow/stream/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523819074\">said</a>:</p>\n<blockquote>\n<p>personally, I disagree with this. I've been advocating to mathematicians for <em>years</em> before I ever started using Lean that they should be writing their LaTeX papers using git (or some other version control).</p>\n</blockquote>\n<p>I just don‚Äôt think ‚Äúyou should also learn git technicalities beyond the pull/push/etc. basics‚Äù ought to be another hurdle in the way of contributing to Mathlib.</p>",
        "id": 523819289,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749756339
    },
    {
        "content": "<p>Also, I just want to be clear; surely you don‚Äôt also disagree with writing useful instructions down somewhere, right?</p>",
        "id": 523819600,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749756462
    },
    {
        "content": "<p>Thomas, what other technicalities are you talking about? You just <code>git pull upstream master</code>, <code>git switch -c my_new_branch</code>, <code>git add files</code>, <code>git commit</code>, <code>git push origin my_new_branch</code>.  (where <code>upstream</code> = <code>leanprover-community/mathlib4</code> and <code>origin</code> = <code>user/mathlib4</code>)</p>",
        "id": 523819656,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1749756490
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523819090\">said</a>:</p>\n<blockquote>\n<p>In terms of not modifying <code>master</code> of your own fork, I think that is also important.  In fact, you can set up <code>git-hooks</code> that warn/prevent you from directly committing changes to <code>master</code>.</p>\n</blockquote>\n<p>I accidentally pushed to <code>master</code> on my own fork, had to rip it out with two rebases and a force-push.</p>",
        "id": 523819695,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1749756516
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"548935\">Thomas Murrills</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523819600\">said</a>:</p>\n<blockquote>\n<p>surely you don‚Äôt also disagree with writing useful instructions down somewhere, right?</p>\n</blockquote>\n<p>Sure (I don't disagree), if necessary.</p>",
        "id": 523819727,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1749756529
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523819695\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523819090\">said</a>:</p>\n<blockquote>\n<p>In terms of not modifying <code>master</code> of your own fork, I think that is also important.  In fact, you can set up <code>git-hooks</code> that warn/prevent you from directly committing changes to <code>master</code>.</p>\n</blockquote>\n<p>I accidentally pushed to <code>master</code> on my own fork, had to rip it out with two rebases and a force-push.</p>\n</blockquote>\n<p>Right, I think that it should be almost the default that you should not be allowed to push to <code>master</code> -- ever!</p>",
        "id": 523819815,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1749756573
    },
    {
        "content": "<p>I think it should not be made easy, but it should also not be made hard. There should be some safeguards that you can turn off.</p>",
        "id": 523819913,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1749756620
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"197836\">Jireh Loreaux</span> <a href=\"#narrow/stream/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523819656\">said</a>:</p>\n<blockquote>\n<p>Thomas, what other technicalities are you talking about? You just <code>git pull upstream master</code>, <code>git switch -c my_new_branch</code>, <code>git add files</code>, <code>git commit</code>, <code>git push origin my_new_branch</code>.  (where <code>upstream</code> = <code>leanprover-community/mathlib4</code> and <code>origin</code> = <code>user/mathlib4</code>)</p>\n</blockquote>\n<p>How does that accomplish the ‚Äúsync fork‚Äù functionality of the GitHub web interface?</p>\n<p>And look at the extra steps <span class=\"user-mention\" data-user-id=\"246635\">@Emily Riehl</span> needed to take earlier in this thread to get set up (which I expect I might need to take as well, and will be referring to this thread as guidance for how to do so!)</p>",
        "id": 523819949,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749756635
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523673512\">said</a>:</p>\n<blockquote>\n<p>Okay, if you see breadcrumbs appearing inappropriately in irrelevant places, please post a link!</p>\n</blockquote>\n<p>Here's an example from <a href=\"https://github.com/leanprover-community/mathlib4/pull/21736\">#21736</a><br>\n<a href=\"/user_uploads/3121/F8tGr1GVxEEWVzwKkR4qEwuT/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/F8tGr1GVxEEWVzwKkR4qEwuT/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1403x1951\" src=\"/user_uploads/thumbnail/3121/F8tGr1GVxEEWVzwKkR4qEwuT/image.png/840x560.webp\"></a></div><p>This happened because the PR description for <a href=\"https://github.com/leanprover-community/mathlib4/pull/21738\">#21738</a> mentioned \"In <a href=\"https://github.com/leanprover-community/mathlib4/pull/21736\">#21736</a> ...\". The PR description becomes the commit message of the squashed commit. This left a breadcrumb of \"mathlib-bors (bot) pushed a commit that referenced this pull request\". </p>\n<p>Then, all other users merge master (likely fast-forward merge), which added the same commits to their fork, with the same message, also leaving breadcrumbs.</p>\n<p>This wasn't so bad here, because first <a href=\"https://github.com/leanprover-community/mathlib4/pull/21736\">#21736</a> was merged, and then <a href=\"https://github.com/leanprover-community/mathlib4/pull/21738\">#21738</a> (and <a href=\"https://github.com/leanprover-community/mathlib4/pull/25546\">#25546</a>, another example). But in my example above, one could imagine a currently in-progress PR 12345 that merged PR 9876 referenced like \"Pulled results out of <a href=\"https://github.com/leanprover-community/mathlib4/pull/12345\">#12345</a>\". And then the conversation for <a href=\"https://github.com/leanprover-community/mathlib4/pull/12345\">#12345</a> will get N breadcrumbs in the middle, where N is the number of forks that are actively merging (ff) master.</p>",
        "id": 523820390,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1749756815
    },
    {
        "content": "<p>I support a fork-PR workflow. I am trying to make people aware ahead of time of this communication obstacle that forks will place in our github views, which can make reviewing more cumbersome. Perhaps someone at Github knows how to turn off fork-breadcrumbs for conversations of a repo.</p>",
        "id": 523820551,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1749756906
    },
    {
        "content": "<blockquote>\n<p>How does that accomplish the ‚Äúsync fork‚Äù functionality of the GitHub web interface?</p>\n</blockquote>\n<p>It doesn't technically sync your fork, but techinically it's not strictly necessary. You could sync the <code>master</code> branch on your fork with <code>git pull upstream master</code>, <code>git push origin master</code> if you're on <code>master</code> in your local repo.</p>\n<p>You should think of it like this: there are three repos in play: upstream, origin, local. You can pull from upstream, but not push to it, only PR to it. So when you <code>pull upstream master</code>, you are syncing your local repository with <code>upstream</code>. Then you can <code>push origin master</code> to sync your <code>origin</code> to your local repo.</p>\n<p>On GitHub, you have a button that allows you to do this in one go: <code>upstream</code> to <code>origin</code> (syncing your fork, this may pull other branches and tags, I'm not sure). Then <code>gh</code> also gives you access to some of these web features.</p>",
        "id": 523820879,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1749757071
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"197836\">Jireh Loreaux</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523819656\">said</a>:</p>\n<blockquote>\n<p>Thomas, what other technicalities are you talking about? You just <code>git pull upstream master</code>, <code>git switch -c my_new_branch</code>, <code>git add files</code>, <code>git commit</code>, <code>git push origin my_new_branch</code>.  (where <code>upstream</code> = <code>leanprover-community/mathlib4</code> and <code>origin</code> = <code>user/mathlib4</code>)</p>\n</blockquote>\n<p>Just want to point out that to mathematicians unfamiliar with git, even this sequence of commands might seem completely mystifying and could be helpful to write down to lower the barrier to entry.</p>",
        "id": 523822865,
        "sender_full_name": "Thomas Browning",
        "timestamp": 1749758031
    },
    {
        "content": "<p>How important is keeping the fork's <code>master</code> up-to-date in the first place? Keeping your local <code>master</code> up-to-date with <code>upstream</code> seems sufficient, unless there's some sort of interaction with CI in forks?</p>",
        "id": 523823091,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1749758143
    },
    {
        "content": "<p>I don't mind having a go at writing a \"git for the formalizing mathematician\" entry in the mathlib4 wiki but this might wait this weekend/start of next week.</p>",
        "id": 523823219,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1749758210
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"421885\">Joscha Mennicken</span> <a href=\"#narrow/stream/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523823091\">said</a>:</p>\n<blockquote>\n<p>How important is keeping the fork's <code>master</code> up-to-date in the first place? Keeping your local <code>master</code> up-to-date with <code>upstream</code> seems sufficient, unless there's some sort of interaction with CI in forks?</p>\n</blockquote>\n<p>I‚Äôm wondering this too; for example, does VS code allow you to look at the upstream master branch without switching repos, when you want to see how things work on master? Or is it now necessary to run a command to sync, whereas previously you could just click the down arrow to pull the new commits? (Not at my computer at the moment.)</p>\n<p>(When on master, VS code also unhelpfully indicates that your <em>local</em> master is up to date with origin/master by default, which can give the false appearance that you‚Äôre synced up even when your origin is not synced to upstream; I could imagine this causing confusion.)</p>",
        "id": 523824100,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749758621
    },
    {
        "content": "<p>I‚Äôm also not sure if upstreams are set up by default or not; I seem to remember having to do it myself with other forks? At the very least we‚Äôve seen some nontrivial upstream-related setup earlier in this thread, so I expect there is guidance to give here‚Ä¶</p>",
        "id": 523824207,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749758684
    },
    {
        "content": "<p>You can <code>git fetch remote</code> to see what is on a remote without <code>pull</code>ing it into your current branch.</p>",
        "id": 523824304,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1749758736
    },
    {
        "content": "<p>Can I switch to it in vs code the same way I can switch to other branches?</p>",
        "id": 523824398,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749758780
    },
    {
        "content": "<p>sure</p>",
        "id": 523824407,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1749758788
    },
    {
        "content": "<p>But, I have to run the command first? ‚Ä¶Hang on, let me just get to my computer instead of asking. :)</p>",
        "id": 523824480,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749758825
    },
    {
        "content": "<p>Yes, you need to <code>git fetch</code> first, unless VS Code is doing auto-fetching for you.</p>",
        "id": 523824516,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1749758846
    },
    {
        "content": "<p>Locally, you'll have <code>master</code>, <code>upstream/master</code>, and <code>origin/master</code></p>",
        "id": 523824532,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1749758860
    },
    {
        "content": "<blockquote>\n<p>VS code also unhelpfully indicates that your¬†<em>local</em>¬†master is up to date with origin/master by default</p>\n</blockquote>\n<p>Yes, that's true, but Github view of your fork will display it. There's probably a fork-related VSCode plugin that can help show the difference between upstream and origin</p>",
        "id": 523824651,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1749758915
    },
    {
        "content": "<p>If there is, we should direct people to it! (I do want to emphasize that I‚Äôm not looking for solutions for myself, but trying to anticipate what might cause confusion among newcomers.)</p>\n<p>Generally, when you don‚Äôt even know where to look to get the functionality you want, you can still get by‚Äîyou just find <em>worse</em> ways to get things done at significant cost, often running into footguns along the way.</p>\n<p>(E.g. for someone who wants to merge master: sync your fork on GitHub, fetch, pull the updated origin, <em>then</em> run <code>git merge master</code>‚Äîeither because you don‚Äôt even know about upstreams in the first place or they‚Äôre not set up correctly.)</p>\n<p>Imo we ought to prevent that as much as we can, and I‚Äôm surprised to meet resistance here! :) Ultimately, I think it‚Äôs very easy to ignore the simple barrier of unfamiliarity when you‚Äôre on the ‚Äòfamiliar‚Äô side of it‚Ä¶</p>",
        "id": 523825450,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749759262
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"548935\">Thomas Murrills</span> <a href=\"#narrow/stream/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523824100\">said</a>:</p>\n<blockquote>\n<p>(When on master, VS code also unhelpfully indicates that your <em>local</em> master is up to date with origin/master by default, which can give the false appearance that you‚Äôre synced up even when your origin is not synced to upstream; I could imagine this causing confusion.)</p>\n</blockquote>\n<p>Is the issue here that the local master branch tracks the origin/master branch instead of upstream/master?</p>",
        "id": 523825629,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1749759326
    },
    {
        "content": "<p>That's right</p>",
        "id": 523826580,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1749759735
    },
    {
        "content": "<p>So, immediately, on a fresh fork, when I try to switch to <code>upstream/master</code> in VS code, I get the same fatal error as Emily Riehl (namely that a branch named master already exists).</p>",
        "id": 523826762,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749759826
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130384\">Riccardo Brasca</span> <a href=\"#narrow/stream/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523732755\">said</a>:</p>\n<blockquote>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>git<span class=\"w\"> </span>branch<span class=\"w\"> </span>--set-upstream-to<span class=\"o\">=</span>upstream/master\n</code></pre></div>\n<p>should work</p>\n</blockquote>\n<p>Does that mean that everyone should run this when setting up?</p>",
        "id": 523826840,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749759865
    },
    {
        "content": "<p>The thing is not to switch to that branch, but to make the <em>local</em> one track the upstream one. The command Riccardo gave is supposed to achieve this.</p>",
        "id": 523826974,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1749759927
    },
    {
        "content": "<p>It's probably a good idea to tell everyone to run a similar command.</p>",
        "id": 523827079,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1749759969
    },
    {
        "content": "<p>Ok, I see. Just curious, does the wording of that command mean that the ‚Äúupstream‚Äù of my local master branch used to be origin/master (i.e. these are two different applications of the word ‚Äúupstream‚Äù)?</p>",
        "id": 523827344,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749760082
    },
    {
        "content": "<p>Yes, I guess renaming the second remote to \"upstream\" is not the less confusing choice <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 523827564,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1749760163
    },
    {
        "content": "<p>One of them is \"upstream\" in the git sense, the second is \"upstream\" as in \"the remote named upstream\" and could have been \"foo\" if you renamed that remote \"foo\"</p>",
        "id": 523827693,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1749760211
    },
    {
        "content": "<p>I wonder if a \"repair\" script would make sense that you can run in a mathlib git repo and that would set up or reset remotes to common, fixed names, configure tracking branches, create a fork if necessary; to move the repo to a recommended base state from which people can have a common workflow. The migration script already does something along those lines, but in a more limited and less robust way.</p>",
        "id": 523827738,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1749760225
    },
    {
        "content": "<p>That would be great, imo‚Äîplus ideally a bit of explanation somewhere as to how the resulting environment is now set up, so that you‚Äôre not blindly following commands and know where to look if you need more information.</p>\n<p>(This is aligned with the sort of vibe I was going for in proposing a ‚Äústandard‚Äù set of instructions for mathematicians‚Äîsensible defaults and a structure for a typical workflow, so that you‚Äôre not ad-hoccing your way through git in a possibly suboptimal way.)</p>",
        "id": 523828456,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749760534
    },
    {
        "content": "<p>It would also make slightly less common but useful settings available, e.g. <code>master</code> tracking <code>upstream</code> but with a <code>branch.master.pushRemote = origin</code> so that if you <code>git pull</code>, it pulls from <code>upstream</code> but if you <code>git push</code>, it pushes to <code>origin</code>.</p>",
        "id": 523828872,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1749760725
    },
    {
        "content": "<p>On the other hand, collaborating with other people on their own forks while having your own fork will remain tricky and require you to have some idea of how git actually works.</p>",
        "id": 523829258,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1749760877
    },
    {
        "content": "<p>Yes, that <code>pushRemote</code> suggestion is critical, because otherwise, you usually push to the branch that one tracks.</p>",
        "id": 523829493,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1749760963
    },
    {
        "content": "<p>Earlier it was suggested that you probably do not want to ever push to your own master branch; would preventing pushing to origin/master be possible? Or does that have issues?</p>",
        "id": 523829627,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749761032
    },
    {
        "content": "<p>Or, wait‚ÄîI suppose pushing to origin/master after pulling from upstream/master would just keep everything up to date.</p>",
        "id": 523829808,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749761106
    },
    {
        "content": "<p>Maybe it‚Äôs that you do not ever want to <em>commit</em> to master yourself, or something like that?</p>",
        "id": 523829874,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749761140
    },
    {
        "content": "<p>Yes, a <code>git pull &amp;&amp; git push</code> on <code>master</code> would just update <code>origin/master</code>. You could prevent local commits to master using a pre-commit hook, I believe.</p>",
        "id": 523830607,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1749761465
    },
    {
        "content": "<p>There is no need to ever touch <code>origin/master</code> <em>or</em> <code>master</code>. You can click on the branch name in VS Code, select \"Create branch from...\", and directly select <code>upstream/master</code> there.</p>",
        "id": 523831025,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1749761667
    },
    {
        "content": "<p>Often you want to quickly look at how things are working interactively on master, and if you try to switch to <code>upstream/master</code>, you get an error unless you‚Äôve set the upstreams correctly. (You <em>could</em> just create a new branch each time you want to do this, but then you clutter things up with ‚Äújunk branches‚Äù.)</p>\n<p>I also think, just practically, that a lot of people will at some point or other choose the wrong <code>master</code>. If we can remove a demand of the form ‚Äújust always do it this way‚Äù, I think we should.</p>",
        "id": 523831625,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749761969
    },
    {
        "content": "<p>That said, I‚Äôm certainly in favor of guiding people to do this as something that could be convenient for them, just not in favor of <em>never</em> touching local master. :)</p>",
        "id": 523831882,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749762064
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"548935\">Thomas Murrills</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523831625\">said</a>:</p>\n<blockquote>\n<p>if you try to switch to <code>upstream/master</code>, you get an error</p>\n</blockquote>\n<p>Well, <code>git switch upstream/master</code> tells you to use <code>--detach</code> which works fine, but gets you into detached head state, which seems confusing for inexperienced users.</p>",
        "id": 523832035,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1749762133
    },
    {
        "content": "<p>You can usually name your remotes anything, including potato and tomato. The names ‚Äúorigin‚Äù and ‚Äúupstream‚Äù are conventions. Usually if you fork a repository and work with a clone of the fork, your fork is the ‚Äúorigin‚Äù of your local repository. The original source repository of the fork is upstream.</p>",
        "id": 523834754,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1749763369
    },
    {
        "content": "<p>(This is in response to Thomas Murrills confusion about usage of upstream)</p>",
        "id": 523834848,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1749763410
    },
    {
        "content": "<p>Makes sense (brb, will be naming my upstreams ‚Äúpotato‚Äù now)‚ÄîI was mostly surprised to learn that ‚Äúupstream‚Äù apparently also describes a general relationship between repos/branches(?) in <code>--set-upstream-to</code>! :)</p>",
        "id": 523835720,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749763788
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"421885\">Joscha Mennicken</span> <a href=\"#narrow/stream/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523829258\">said</a>:</p>\n<blockquote>\n<p>On the other hand, collaborating with other people on their own forks while having your own fork will remain tricky and require you to have some idea of how git actually works.</p>\n</blockquote>\n<p>On this note, I‚Äôm trying to think ahead and wonder if it will make more sense to have multiple cloned repos and so multiple VS code windows, or if there‚Äôs a good way to work on multiple repos in the same window by configuring the right remotes. (Mainly wondering whether the second option is even feasible.)</p>",
        "id": 523836063,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749763948
    },
    {
        "content": "<p>The workflow I'd expect for someone familiar with git is a single local repo with one remote per fork you are collaborating on, and one remote for the upstream repo. When pushing a branch, you specify the remote you want to push to, or you can set a per-branch default using <code>git branch --set-upstream-to &lt;remote&gt;</code>.</p>",
        "id": 523837045,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1749764417
    },
    {
        "content": "<p>Okay, I see! Ooh, the per-branch default is interesting. (I‚Äôm hoping that the VS code buttons will ‚Äúlisten‚Äù to that.) I feel a tiny script which sets things like this up might go a long way to making collaboration almost as smooth as it was before. :)</p>",
        "id": 523837501,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749764664
    },
    {
        "content": "<p>VS Code will definitely listen to it. All it does is read your git config file. Look inside the <code>.git</code> folder. It's pretty easy to understand.</p>",
        "id": 523840702,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1749766331
    },
    {
        "content": "<p>I'am not following the whole discussion, but I think a guide for mathematicians is absolutely needed. It's important to understand that people had their mental model of how git/github worked, based on having used <em>only for mathlib</em>. So now there two completely new notions:</p>\n<ul>\n<li>fork (probably easy to explain)</li>\n<li>remote (this is trickier, since the mental model \"my computer is a copy of the thing online, I only have to make sure the two are in sync\" in no longer enough)</li>\n</ul>",
        "id": 523841928,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1749767036
    },
    {
        "content": "<p>I guess that people are much happier to spend 5 minutes to update their mental model and understand what's going on than memorizing 5 commands (and forgetting them 3 days later)</p>",
        "id": 523842130,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1749767139
    },
    {
        "content": "<p>I agree that it‚Äôs useful and necessary to update the mental model! Maybe you‚Äôre considering this implicitly, I actually don‚Äôt anticipate that understanding the basic interplay between local/origin/upstream will be the only (or maybe even main) source of friction. (For example, I already knew, conceptually, what Jireh explained (much) earlier about origin/upstream/local repos and the interplay between them.)</p>\n<p>The source of friction I‚Äôm concerned about is (1) not knowing fully what capabilities are present in which tools in the first place (2) therefore not knowing what capabilities I ‚Äúshould‚Äù be using to solve a given problem (since this relies on being aware of all capabilities). (Not knowing which precise commands to execute is indeed mostly a detail.)</p>\n<p>That is, it‚Äôs the fact that unfamiliarity with the full space of things that <em>can</em> be done leads to not knowing what <em>should</em> be done in simple cases. (E.g. how do I update my copy? how do I work on someone else‚Äôs fork? is it possible for this branch to reflect that branch somehow? All of these have multiple reasonable attempts at answers from a newcomer, some of which are very inefficient, or lead to inscrutable errors, etc.)</p>\n<p>When you‚Äôre familiar with tools, what they can and can‚Äôt do and how to hold them is so obvious that it seems the only problem is learning each actual use of them. I claim the issue is prior to usage per se, but comes after the mental model of the thing you‚Äôre using the tools <em>on</em>. It‚Äôs about having a sufficient mental model of the possible manipulations each tool makes available. (And maybe just as importantly, what they <em>don‚Äôt</em>.)</p>\n<p>But instead of saying that everyone should learn the full scope of git‚Äôs power out of the gate, I think we can isolate the understanding-of-capabilities necessary for the simple cases encountered in typical workflows from people who <em>are</em> very familiar with git (as in this thread! :) ), and then provide that to newcomers somehow.</p>\n<p>(Note: I‚Äôm in favor of both automating things and explaining to people what was automated, so that understanding is actually gained!)</p>",
        "id": 523844655,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749768722
    },
    {
        "content": "<p>I would say there are <em>enough different conventions that exist</em> that, when googling for tips on how to do things in git(hub), I've definitely frequently been lead astray and made things worse. When the philosophy is \"these are the four commands you run\", then as soon as you diverge from that recipe, it becomes a mess.</p>\n<p>(And it <em>does</em> happen that you'll need to diverge from the simplest recipe ... like, you saved+committed your files on the wrong branch. Or you need to merge some nontrivial conflicts.)</p>\n<p>For instance: Some orgs/companies expect everyone to merge master. Some expect rebasing and never merge. Some have policies that commits <em>must</em> be squashed. Someone wants to PR your branch, or you need to pull in someone else's branch from their cloned repo to build on their stuff for the new feature you're doing. Plenty of guides will say \"just copy+paste this\" but no one can agree if it's main or master.</p>\n<p>There are <em>many many</em> ways for things to go off the rails!</p>",
        "id": 523848509,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1749771624
    },
    {
        "content": "<p>Never mind issues where people give <code>gh</code> commands to run but they write <code>git</code>, or other outright errors</p>",
        "id": 523848557,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1749771660
    },
    {
        "content": "<p>Good point! I don‚Äôt know if you were implying I was advocating for a ‚Äúthese are the four commands you run‚Äù philosophy, but either way, I do agree with that criticism of it!</p>\n<p>To make my approach more explicit (and distinct): I‚Äôm advocating for giving mathematicians working on Mathlib <em>some</em> starting state where things have been set up nicely (and ideally an <em>understanding</em> of that state), plus the awareness of capabilities that are probably relevant to them. (And by ‚Äúawareness of capabilities‚Äù, I don‚Äôt just mean ‚Äúrun this when this‚Äù, but communicating ‚Äúyou can change your situation from this (which works this way) to that (which works that way)‚Äù)</p>\n<p>We can then at least avoid people <em>starting out</em> by googling those sorts of maybe-not-useful tips to solve their problems that might get them in difficult situations from the get-go (and hopefully the basic understanding provided gives them a springboard to figuring out the inevitable issues you mention, instead of leaving them adrift).</p>",
        "id": 523850905,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749773481
    },
    {
        "content": "<p>Here‚Äôs an example that clarifies the place I‚Äôm coming from re: awareness of capabilities:</p>\n<p>Let‚Äôs say I tell a newcomer ‚Äúrun <code>git branch --set-upstream-to=upstream</code>‚Äù. I may think I‚Äôm just telling them ‚Äúhow to use git to set upstreams‚Äù, but really (ideally, with a bit more explanation), I‚Äôm also telling them</p>\n<ol>\n<li>that there even exists a state where master ‚Äútracks‚Äù upstream (and possibly the concept of tracking)</li>\n<li>that git is a tool which can get you to that state</li>\n</ol>\n<p>and implicitly</p>\n<ol start=\"3\">\n<li>that this is an appropriate solution to the problem at hand, which satisfies nice properties and will probably not break in unexpected ways</li>\n</ol>\n<p>none of which they knew before, and all of which are what‚Äôs really important to them. </p>\n<p><em>This</em> is the information I think it‚Äôs important for newcomers to know; otherwise the ocean of possibilities is overwhelming, and the newcomer will potentially hack together a path to a different state which achieves their goals, but in a brittle and inconvenient manner.</p>",
        "id": 523851028,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749773607
    },
    {
        "content": "<p>Well, my personal setup completely eliminated <code>upstream</code> on my local computer, and there is only <code>origin</code> which points to my fork of mathlib. The sync of my fork with the actual mathlib is completely done by github web interface \"sync fork\" button.</p>\n<p>IMHO this gives less confusions, since the local workflow is completely unchanged (and no mental models needs to be updated).</p>",
        "id": 523863749,
        "sender_full_name": "Jz Pan",
        "timestamp": 1749783752
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"548935\">Thomas Murrills</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523819949\">said</a>:</p>\n<blockquote>\n<p>How does that accomplish the ‚Äúsync fork‚Äù functionality of the GitHub web interface?</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"548935\">@Thomas Murrills</span>, the point is that you don't ever need to \"sync fork\". That's simply a red herring. Don't do it unless you want to!</p>\n<p>(Sorry, replying while mid-thread, this may have already been addressed.)</p>",
        "id": 523868935,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1749788078
    },
    {
        "content": "<p>Why not just have a cheatsheet so that those who do not want to think about these issues can just follow instructions?  If nonstandard issues arise, one can always ask questions on Zulip.</p>",
        "id": 523876015,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1749793840
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"366779\">Jz Pan</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/523863749\">said</a>:</p>\n<blockquote>\n<p>Well, my personal setup completely eliminated <code>upstream</code> on my local computer, and there is only <code>origin</code> which points to my fork of mathlib. The sync of my fork with the actual mathlib is completely done by github web interface \"sync fork\" button.</p>\n<p>IMHO this gives less confusions, since the local workflow is completely unchanged (and no mental models needs to be updated).</p>\n</blockquote>\n<p>I think your response to this new situation is perfectly reasonable, and is exactly the sort of thing I'm worried about! :) This is how I approached a fork model too at first, and I can guarantee it's how many others will as well: we know how to click \"sync fork\", we understand the basics of what a fork is vs. the original repo and the local copy, and we'll default to leveraging that knowledge as quickly as possible. But doing this means opening a browser window, navigating to your fork, and clicking that button each time you want to merge or view master, when things could be smoother.</p>\n<p>The fact that the prevailing advice here (from those familiar with the tools) is actually \"<em>don't</em> bother clicking sync fork\" is a great example of the gap I'm pointing out.</p>\n<p>A lot of people (including myself) will simply set things up in a way that uses the tools immediately available to them, like a \"sync fork\" button, even if it involves more friction than something they don't know about yet‚Äîbecause unless your goal is to learn git, you're just going to reach for what you already know. Without guidance or support to the contrary, this course of action actually makes sense in the short term, when beelining for what you're actually here for. But <em>with</em> guidance and support for smoothing things out, we can give people a better experience.</p>",
        "id": 523876145,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1749793932
    },
    {
        "content": "<p>I have a a problem that might be a bit silly: when trying to run <code>scripts/migrate_to_fork.py</code><br>\nFirst, there is this error : <code>UnicodeDecodeError: 'gbk' codec can't decode byte 0x93 in position 15: illegal multibyte sequence</code><br>\nThen it show</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">‚úó</span><span class=\"w\"> </span><span class=\"n\">GitHub</span><span class=\"w\"> </span><span class=\"n\">CLI</span><span class=\"w\"> </span><span class=\"n\">token</span><span class=\"w\"> </span><span class=\"n\">lacks</span><span class=\"w\"> </span><span class=\"n\">required</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">repo'</span><span class=\"w\"> </span><span class=\"n\">scope</span><span class=\"bp\">.</span>\n<span class=\"n\">Please</span><span class=\"w\"> </span><span class=\"n\">re</span><span class=\"bp\">-</span><span class=\"n\">authenticate</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">required</span><span class=\"w\"> </span><span class=\"n\">scopes</span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">gh</span><span class=\"w\"> </span><span class=\"n\">auth</span><span class=\"w\"> </span><span class=\"n\">login</span><span class=\"w\"> </span><span class=\"c1\">--scopes 'repo,workflow'</span>\n</code></pre></div>\n<p>I run <code>gh auth login --scopes 'repo,workflow</code> but it still show this error. Can anyone help?</p>",
        "id": 523885150,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1749799014
    },
    {
        "content": "<p><code>UnicodeDecodeError</code> is a Python error, but <code>gh</code> is written in go, so this seems like an error in <code>migrate_to_fork.py</code>. Can you share the full error traceback including the line numbers? Also, this should probably be in <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/Feedback.20on.20scripts.2Fmigrate_to_fork.2Epy/with/523697294\">#mathlib4 &gt; Feedback on scripts/migrate_to_fork.py</a></p>",
        "id": 523886729,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1749799674
    },
    {
        "content": "<p>Note the update at <a class=\"message-link\" href=\"/#narrow/channel/113486-announce/topic/Mathlib.20PRs.20should.20be.20made.20from.20a.20fork/near/524200869\">#announce &gt; Mathlib PRs should be made from a fork @ üí¨</a></p>",
        "id": 524200956,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1750061303
    },
    {
        "content": "<p>There were recent complaints about how the maintainers of Mathlib handle objections from people making PRs and also a resignation letter.</p>\n<p>The previous policy featured master branch privledges and this policy does not feature master branch privledges.</p>",
        "id": 524224683,
        "sender_full_name": "Jeremy Ravenel",
        "timestamp": 1750069777
    },
    {
        "content": "<p>Just to be clear -- Chris Hughes' resignation occurred a long time ago and the fact that a discussion has resurfaced about it now is completely unrelated to the discussion about changing the PR workflow.</p>\n<p>There was also a complaint about the PR workflow change from David Loeffler (in the form of an open letter to the maintainers) and the script doing the updates (which he had been frustrated by) now is hopefully fixed. The issue was branches with names which only differed in capitalization and was OS-specific; we had not caught it in testing. If you are still having problems then please update mathlib and they should be fixed.</p>\n<p>Yes, the previous policy featured master branch privileges which are now being removed so that we conform to the usual github workflow.</p>",
        "id": 524229963,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1750071591
    },
    {
        "content": "<p>Thanks for clarifying for me.</p>",
        "id": 524235734,
        "sender_full_name": "Jeremy Ravenel",
        "timestamp": 1750073616
    },
    {
        "content": "<p>The migration tool worked perfectly for me, instructions were very clear</p>",
        "id": 524264362,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1750082453
    },
    {
        "content": "<p>This is a great move! It's not only more secure but it also scales much better <span aria-label=\"clap\" class=\"emoji emoji-1f44f\" role=\"img\" title=\"clap\">:clap:</span></p>\n<p>(maybe it scales better <em>because</em> it's more secure)</p>",
        "id": 524286598,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1750089375
    },
    {
        "content": "<p>what are \"master branch privileges\"?</p>",
        "id": 524288585,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1750089987
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/524229963\">said</a>:</p>\n<blockquote>\n<p>There was also a complaint about the PR workflow change from David Loeffler (in the form of an open letter to the maintainers) and the script doing the updates (which he had been frustrated by) now is hopefully fixed. The issue was branches with names which only differed in capitalization and was OS-specific; we had not caught it in testing. If you are still having problems then please update mathlib and they should be fixed.</p>\n</blockquote>\n<p>As I recall, the issue was also about  </p>\n<ol>\n<li>The suddenness of the change, instead of a gradual transition to allow people to learn and adapt the new workflow. </li>\n<li>The sparse instructions surrounding git and github workflows which break the mental model of git that mathlib-only users of git had.</li>\n</ol>\n<p>EDIT: Both these appear to have been addresssed to the best possible extent.</p>",
        "id": 524291850,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750091178
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"873350\">Weiyi Wang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/524288585\">said</a>:</p>\n<blockquote>\n<p>what are \"master branch privileges\"?</p>\n</blockquote>\n<p>It's a slightly incorrect way of describing the situation where contributors were being given write privileges to non-master branches of mathlib. Only maintainers have ever been able to write to the master branch for as long as I can remember.</p>",
        "id": 524292221,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750091300
    },
    {
        "content": "<p>Hi all, is there a list of instructions to follow for <code>scripts/migrate_to_fork.py</code>? I'm just blindly running the script and ran into <a href=\"/user_uploads/3121/kmHXwlmbVZV9osT_2iYdbrX1/image.png\">this error</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/kmHXwlmbVZV9osT_2iYdbrX1/image.png\" title=\"this error\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"823x132\" src=\"/user_uploads/thumbnail/3121/kmHXwlmbVZV9osT_2iYdbrX1/image.png/840x560.webp\"></a></div>",
        "id": 524323104,
        "sender_full_name": "David Ang",
        "timestamp": 1750103185
    },
    {
        "content": "<p>there has to be something funny in the fact that this problem seems to be because of emojis.</p>",
        "id": 524323362,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1750103318
    },
    {
        "content": "<p>Can you try editing the script on your end, removing every emojis, and try again?</p>",
        "id": 524323430,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1750103344
    },
    {
        "content": "<p>You probably also could try setting <code>PYTHONUTF8=1</code> and seeing if that works without editing.</p>",
        "id": 524324735,
        "sender_full_name": "Julian Berman",
        "timestamp": 1750103884
    },
    {
        "content": "<p>How do you add that setting?</p>",
        "id": 524325367,
        "sender_full_name": "David Ang",
        "timestamp": 1750104163
    },
    {
        "content": "<p>Are you in powershell or some unix-y (WSL?) shell</p>",
        "id": 524325447,
        "sender_full_name": "Julian Berman",
        "timestamp": 1750104211
    },
    {
        "content": "<p>I'm in Git Bash</p>",
        "id": 524325465,
        "sender_full_name": "David Ang",
        "timestamp": 1750104229
    },
    {
        "content": "<p>If the latter, run <code>PYTHONUTF8=1 python scripts/migrate_to_fork.py</code>. If the former, I think <code>set</code> is the powershell command</p>",
        "id": 524325473,
        "sender_full_name": "Julian Berman",
        "timestamp": 1750104232
    },
    {
        "content": "<p>OK yeah try just adding it to the front</p>",
        "id": 524325493,
        "sender_full_name": "Julian Berman",
        "timestamp": 1750104242
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321696\">Julian Berman</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/524325493\">said</a>:</p>\n<blockquote>\n<p>OK yeah try just adding it to the front</p>\n</blockquote>\n<p>Thanks, this works! Now I have <a href=\"/user_uploads/3121/e8s3m1Ifk3wXig0YdjU38d8x/image.png\">another error</a> - and after restarting the terminal it tells me it <a href=\"/user_uploads/3121/tHjbMiLJ_-tsk6c6A6x40OAG/image.png\">doesn't have pseudo terminal support</a>? I'm happy to use powershell as well but I don't know what you mean by <code>set</code> being the command</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/e8s3m1Ifk3wXig0YdjU38d8x/image.png\" title=\"another error\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"615x247\" src=\"/user_uploads/thumbnail/3121/e8s3m1Ifk3wXig0YdjU38d8x/image.png/840x560.webp\"></a></div><div class=\"message_inline_image\"><a href=\"/user_uploads/3121/tHjbMiLJ_-tsk6c6A6x40OAG/image.png\" title=\"doesn't have pseudo terminal support\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"476x106\" src=\"/user_uploads/thumbnail/3121/tHjbMiLJ_-tsk6c6A6x40OAG/image.png/840x560.webp\"></a></div>",
        "id": 524328904,
        "sender_full_name": "David Ang",
        "timestamp": 1750105703
    },
    {
        "content": "<p>Seems like powershell is happy with the emojis...</p>",
        "id": 524329128,
        "sender_full_name": "David Ang",
        "timestamp": 1750105807
    },
    {
        "content": "<p>as a software developer I generally get better unicode support from powershell than git bash (mingw). Perhaps we should add this note to the guide?</p>",
        "id": 524329538,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1750105968
    },
    {
        "content": "<p>It seems like the script has done a bunch of stuff, but my PRs are still there and nothing is migrated</p>",
        "id": 524329786,
        "sender_full_name": "David Ang",
        "timestamp": 1750106084
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"873350\">Weiyi Wang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/524329538\">said</a>:</p>\n<blockquote>\n<p>as a software developer I generally get better unicode support from powershell than git bash (mingw). Perhaps we should add this note to the guide?</p>\n</blockquote>\n<p>Could you give me a link to the guide? I've been trying to find it.</p>",
        "id": 524329885,
        "sender_full_name": "David Ang",
        "timestamp": 1750106129
    },
    {
        "content": "<p>There's this guide, but it's not been merged yet: <a href=\"https://github.com/leanprover-community/leanprover-community.github.io/pull/643\">https://github.com/leanprover-community/leanprover-community.github.io/pull/643</a></p>",
        "id": 524335850,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1750109128
    },
    {
        "content": "<p>I'm still unsure what I need to do to get my PRs migrated after running the script :(</p>",
        "id": 524336526,
        "sender_full_name": "David Ang",
        "timestamp": 1750109484
    },
    {
        "content": "<p>David, did you manage to get the <code>gh auth login</code> to work? the script can‚Äôt do anything without that.</p>",
        "id": 524336687,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1750109581
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"286014\">Robin Carlier</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/524336687\">said</a>:</p>\n<blockquote>\n<p>David, did you manage to get the <code>gh auth login</code> to work? the script can‚Äôt do anything without that.</p>\n</blockquote>\n<p>Yes, powershell goes through that but Git Bash doesn't</p>",
        "id": 524336781,
        "sender_full_name": "David Ang",
        "timestamp": 1750109641
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/Hc-ot-nUQzb9j2dU1r46CKG-/image.png\">This</a> is the output (after step 4, I think)</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/Hc-ot-nUQzb9j2dU1r46CKG-/image.png\" title=\"This\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"651x1038\" src=\"/user_uploads/thumbnail/3121/Hc-ot-nUQzb9j2dU1r46CKG-/image.png/840x560.webp\"></a></div>",
        "id": 524336840,
        "sender_full_name": "David Ang",
        "timestamp": 1750109684
    },
    {
        "content": "<p>My guess is that this is the output of the <code>git fetch --prune</code>? normally, the script continues many more steps, it‚Äôs weird that it stops right after step 4... Can you show what <code>git remote -v</code> gives you?</p>",
        "id": 524337155,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1750109855
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"286014\">Robin Carlier</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/524337155\">said</a>:</p>\n<blockquote>\n<p>My guess is that this is the output of the <code>git fetch --prune</code>? normally, the script continues many more steps, it‚Äôs weird that it stops right after step 4... Can you show what <code>git remote -v</code> gives you?</p>\n</blockquote>\n<p>I changed remote manually to my own fork before running the script, so <code>git remote -v</code> gives me the links to my fork (both fetch and push)</p>",
        "id": 524337320,
        "sender_full_name": "David Ang",
        "timestamp": 1750109954
    },
    {
        "content": "<p>I don't actually know if this is step 4, because step 4 is the last thing I see before the entire page gets congested with this output</p>",
        "id": 524337398,
        "sender_full_name": "David Ang",
        "timestamp": 1750110004
    },
    {
        "content": "<p>but do you have <code>leanprover-community/mathlib4</code> as a remote named upstream?</p>",
        "id": 524337421,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1750110016
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/dP6miSOJ1_m1_xzIGlyjNG3E/image.png\">I guess not?</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/dP6miSOJ1_m1_xzIGlyjNG3E/image.png\" title=\"I guess not?\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"441x52\" src=\"/user_uploads/thumbnail/3121/dP6miSOJ1_m1_xzIGlyjNG3E/image.png/840x560.webp\"></a></div>",
        "id": 524337654,
        "sender_full_name": "David Ang",
        "timestamp": 1750110142
    },
    {
        "content": "<p>ok, that might be the issue. Can you run <code>git remote add upstream \"https://github.com/leanprover-community/mathlib4.git\"</code>?</p>",
        "id": 524337731,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1750110188
    },
    {
        "content": "<p>once it‚Äôs done, you might want to try running <code>git fetch --all --prune</code> before running the script, the script does it but let‚Äôs be extra extra sure.</p>",
        "id": 524337858,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1750110284
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"286014\">Robin Carlier</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/524337858\">said</a>:</p>\n<blockquote>\n<p>once it‚Äôs done, you might want to try running <code>git fetch --all --prune</code> before running the script, the script does it but let‚Äôs be extra extra sure.</p>\n</blockquote>\n<p>It <a href=\"/user_uploads/3121/J3z9K0bKv8RRM8fnVqcHUvre/image.png\">could not fetch origin?</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/J3z9K0bKv8RRM8fnVqcHUvre/image.png\" title=\"could not fetch origin?\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"585x170\" src=\"/user_uploads/thumbnail/3121/J3z9K0bKv8RRM8fnVqcHUvre/image.png/840x560.webp\"></a></div>",
        "id": 524338394,
        "sender_full_name": "David Ang",
        "timestamp": 1750110444
    },
    {
        "content": "<p><code>git fetch upstream --prune</code>?</p>",
        "id": 524338707,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1750110509
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"286014\">Robin Carlier</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/524338707\">said</a>:</p>\n<blockquote>\n<p><code>git fetch upstream --prune</code>?</p>\n</blockquote>\n<p>This doesn't seem to do anything, and running the script after this gives the same error that it could not fetch origin</p>",
        "id": 524339045,
        "sender_full_name": "David Ang",
        "timestamp": 1750110663
    },
    {
        "content": "<p>I don't quite understand why we're pruning things from origin/upstream? I thought we're trying to move PRs</p>",
        "id": 524339170,
        "sender_full_name": "David Ang",
        "timestamp": 1750110737
    },
    {
        "content": "<p>The pruning has to do with the fact that some branches had name differing only by case that were causing trouble down the line, so this was added as a step in the script to make sure these bad branches (now deleted in the main repo) do not appear. But I‚Äôm confused as to why it doesn‚Äôt let you fetch from your fork...<br>\nAs a last resort, you can try deleting line 331 (that fetch step) in the script and try.</p>",
        "id": 524339496,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1750110923
    },
    {
        "content": "<p>Right, that now moves me to the next step, and it tells me I have to move to individual branches to migrate them manually? Can this not be done from master?</p>",
        "id": 524339935,
        "sender_full_name": "David Ang",
        "timestamp": 1750111172
    },
    {
        "content": "<p>In particular I have really old branches that won't play well if I try to merge master to get <code>script/migration_to_fork.py</code>...</p>",
        "id": 524339977,
        "sender_full_name": "David Ang",
        "timestamp": 1750111203
    },
    {
        "content": "<p>No, for each PR you want to migrate, you need to switch to the branch and run the script.<br>\nI guess you can copy-paste only the script in old branches.</p>",
        "id": 524340104,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1750111278
    },
    {
        "content": "<p>Seems like that works for at least one PR! Thanks! I'll try to do my remaining PRs and report back if anything goes awry...</p>",
        "id": 524340664,
        "sender_full_name": "David Ang",
        "timestamp": 1750111607
    },
    {
        "content": "<p>Note that the PR labels seem to have disappeared :(</p>",
        "id": 524340680,
        "sender_full_name": "David Ang",
        "timestamp": 1750111618
    },
    {
        "content": "<p>I‚Äôm still a bit concerned that you can‚Äôt fetch from your fork, because at some point you‚Äôll definitely need to do that.</p>",
        "id": 524340801,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1750111694
    },
    {
        "content": "<p>Yeah, I have to manually erase that line for the script to work...</p>",
        "id": 524340909,
        "sender_full_name": "David Ang",
        "timestamp": 1750111779
    },
    {
        "content": "<p>You might have a better experience with the windows terminal. I think you can also open a git bash terminal inside it, although it has been over a year since I tried anything lean related on windows (about the Unicode error)</p>",
        "id": 524341141,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750111930
    },
    {
        "content": "<p>And you‚Äôll need to fetch not necessarily in the migration but in everyday workflow, if e.g you accept a suggestion made via github UI in one of your PR, and want to code on top of that, or if you collaborate with someone pushing on one of your branches.</p>\n<p>Perhaps at this point if you don‚Äôt have too many local only branches it could be worth trying re-setting up your local repo from scratch?<br>\nI tried adding your fork as a remote and fetching and it works, so there has to be something wrong in your local repo.</p>",
        "id": 524341206,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1750111971
    },
    {
        "content": "<p>I have a bit too many local only branches, unfortunately.</p>\n<p>Note that I've also lost all PR comments, but maybe that's expected to happen.</p>",
        "id": 524341310,
        "sender_full_name": "David Ang",
        "timestamp": 1750112047
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"464700\">David Ang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/524341310\">said</a>:</p>\n<blockquote>\n<p>I have a bit too many local only branches, unfortunately.</p>\n<p>Note that I've also lost all PR comments, but maybe that's expected to happen.</p>\n</blockquote>\n<p>IIUC, newer versions of the script preserve these. In other words: make sure your master branch is up to date before running the script, to get the latest bug-fixes.</p>",
        "id": 524342606,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1750112884
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/524342606\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"464700\">David Ang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/524341310\">said</a>:</p>\n<blockquote>\n<p>I have a bit too many local only branches, unfortunately.</p>\n<p>Note that I've also lost all PR comments, but maybe that's expected to happen.</p>\n</blockquote>\n<p>IIUC, newer versions of the script preserve these. In other words: make sure your master branch is up to date before running the script, to get the latest bug-fixes.</p>\n</blockquote>\n<p>I am up-to-date with master; the comments seem to have been squished into one comment! I didn't notice that at the start...</p>",
        "id": 524343515,
        "sender_full_name": "David Ang",
        "timestamp": 1750113493
    },
    {
        "content": "<p>Yes, the squishing of comments is expected behaviour. There's no way to copy comments preserving the authorship.</p>",
        "id": 524347070,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1750116065
    },
    {
        "content": "<p>(at least, not without using \"GitHub Enterprise importer\", which is what Python used to copy issue comments from bpo to GitHub)</p>",
        "id": 524380997,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1750142243
    },
    {
        "content": "<p>Think I have finished my migration.</p>",
        "id": 524413161,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1750153849
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 524413181,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1750153856
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/524380997\">said</a>:</p>\n<blockquote>\n<p>(at least, not without using \"GitHub Enterprise importer\", which is what Python used to copy issue comments from bpo to GitHub)</p>\n</blockquote>\n<p>Even that isn't perfect of course, all my comments on bpo got imported and I even happen to have the same username on both bpo and GitHub, but the comments on GitHub have this weird phantom Julian as the username on the comment and clicking on the username takes you to nowhere. (The reason is almost certainly due to email mismatch and if I added my old bpo email to my GitHub profile maybe things would work. Or maybe not. Copying is hard!)</p>",
        "id": 524469349,
        "sender_full_name": "Julian Berman",
        "timestamp": 1750171180
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321696\">Julian Berman</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/524469349\">said</a>:</p>\n<blockquote>\n<p>the comments on GitHub have this weird phantom Julian as the username on the comment and clicking on the username takes you to nowhere.</p>\n</blockquote>\n<p>These placeholders are called mannequin accounts in GitHub parlance, and they can be reclaimed by actual users (with the help of the repo owners), see <a href=\"https://docs.github.com/en/migrations/using-github-enterprise-importer/completing-your-migration-with-github-enterprise-importer/reclaiming-mannequins-for-github-enterprise-importer\">https://docs.github.com/en/migrations/using-github-enterprise-importer/completing-your-migration-with-github-enterprise-importer/reclaiming-mannequins-for-github-enterprise-importer</a></p>",
        "id": 524506923,
        "sender_full_name": "Matthias K√∂ppe",
        "timestamp": 1750184741
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/524380997\">said</a>:</p>\n<blockquote>\n<p>(at least, not without using \"GitHub Enterprise importer\", which is what Python used to copy issue comments from bpo to GitHub)</p>\n</blockquote>\n<p>Yes, either that or a contact at GitHub who runs the import of the migration archives for you. The folks at the GItHub open source program were most helpful in doing that when we migrated SageMath development to GitHub in 2022‚Äì23.</p>",
        "id": 524584802,
        "sender_full_name": "Matthias K√∂ppe",
        "timestamp": 1750189557
    },
    {
        "content": "<p>My guess is that GitHub cares much more about helping projects transition to GitHub than within GitHub</p>",
        "id": 524587434,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1750190560
    },
    {
        "content": "<p>I'm going to have dinner and then do some final editing of (a guide to git for new contributors) <a href=\"https://github.com/leanprover-community/leanprover-community.github.io/pull/643\">https://github.com/leanprover-community/leanprover-community.github.io/pull/643</a> and then merge; if anyone has any last-minute comments, please leave a review in the next ~3 hours or so!</p>",
        "id": 524602153,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1750196968
    },
    {
        "content": "<p>Thanks everyone for the additional comments! The guide to git for new contributors is now live <a href=\"https://leanprover-community.github.io/contribute/git.html\">here</a> and is linked to from the website sidebar, as well as from the previous <a href=\"https://leanprover-community.github.io/contribute/index.html\">\"pull request lifecycle\" page</a>.</p>\n<p>I tried to incorporate the remaining suggestions while I did some reorganization / editing of my own, and I've no doubt missed some issues and introduced new errors. I'd appreciate if folks could read through the pages and comment here or open PRs to fix / improve them!</p>",
        "id": 524625086,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1750217670
    },
    {
        "content": "<p>Do we really want the line <code>git fetch upstream</code>? There are a zillion of branches upstream, not sure it's worth fetching them all.</p>",
        "id": 524640031,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1750229572
    },
    {
        "content": "<p>Maybe <code>git fetch upstream master</code> is enough?</p>",
        "id": 524644100,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1750231407
    },
    {
        "content": "<p>The <code>git pull</code> in the \"Keep Your Master Branch Up to Date\" step will also fetch all branches of <code>upstream</code>, so if the <code>git fetch</code> is changed to <code>git fetch upstream master</code>, then we should also change from <code>git pull</code> to <code>git pull upstream master</code>.</p>",
        "id": 524648844,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1750233357
    },
    {
        "content": "<p>My preference is to keep things simple in the instructions, even if that means git is doing more work (e.g. pulling zillions of branches).</p>",
        "id": 524650214,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1750233782
    },
    {
        "content": "<p>Fair enough</p>",
        "id": 524650555,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1750233890
    },
    {
        "content": "<p>Looking at the instructions, I think there are a few more places where <code>gh</code> can be used instead of the manual commands. For example, instead of forking via the web ui and then cloning using <code>gh repo clone ...</code>, you can just run <code>gh repo fork leanprover-community/mathlib4 --clone --default-branch-only</code>. It will create a fork if there is none, or use an existing fork if present, and then clone the fork, setting up <code>upstream</code> and <code>origin</code> as expected. Also, I believe you can run <code>gh repo fork ...</code> inside an existing git repo instead of doing step 3 option B manually.</p>",
        "id": 524667141,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1750239631
    },
    {
        "content": "<p>A PR adding more uses of <code>gh</code> would be appreciated!</p>",
        "id": 524687399,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1750247076
    },
    {
        "content": "<p>An other way to avoid fetching the entire mathlib repo would be to change step 3.A.2 to <code>git remote add -t master upstream https://github.com/leanprover-community/mathlib4.git</code>. This way everyday commands remain the same (i.e. simply <code>git pull</code>/<code>git fetch upstream</code>), however <code>gh</code> don't seems to be able to setup this with <code>gh repo clone</code> so it requires one more step for people choosing step 2.A.1</p>",
        "id": 524699688,
        "sender_full_name": "Anthony Fernandes",
        "timestamp": 1750251134
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"123965\">Bryan Gin-ge Chen</span> <a href=\"#narrow/stream/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/524687399\">said</a>:</p>\n<blockquote>\n<p>A PR adding more uses of <code>gh</code> would be appreciated!</p>\n</blockquote>\n<p>But installing gh for windows is not completely obvious.</p>",
        "id": 524807025,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1750300328
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"400289\">@Artie Khovanov</span> seems to have lost privileges to run <code>!bench</code> (cf <a href=\"https://github.com/leanprover-community/mathlib4/pull/26123\">#26123</a>). Is this expected?</p>",
        "id": 524824457,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1750315968
    },
    {
        "content": "<p>I believe at the moment <a href=\"https://github.com/IPDSnelting/velcom/blob/1c51514fe1f4290757c5428d99a73eb28d1fef9f/backend/backend/src/main/java/de/aaaaaaah/velcom/backend/listener/github/GithubPrInteractor.java#L293\">you need write permissions</a> to use <code>!bench</code>. Maybe <code>bench-after-CI</code> can be used as a workaround? (For future reference, <a href=\"https://docs.github.com/en/rest/collaborators/collaborators?apiVersion=2022-11-28#get-repository-permissions-for-a-user\">the GitHub API endpoint used to determine permissions</a>)</p>",
        "id": 524839379,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1750322055
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"421885\">@Joscha Mennicken</span> please could you say a bit more about the workaround? I'm afraid I don't understand. Is <code>!bench-after-CI</code> a command?</p>",
        "id": 524857330,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1750329208
    },
    {
        "content": "<p>There is a <code>bench-after-CI</code> label that causes some bot to trigger the <code>!bench</code> command after CI succeeds, and I assume the bot still has the required permissions for the bench command. I'm not sure though what happens when the label is added while CI is already green.</p>",
        "id": 524857591,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1750329337
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"300245\">Filippo A. E. Nuccio</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/524807025\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"123965\">Bryan Gin-ge Chen</span> <a href=\"#narrow/stream/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/524687399\">said</a>:</p>\n<blockquote>\n<p>A PR adding more uses of <code>gh</code> would be appreciated!</p>\n</blockquote>\n<p>But installing gh for windows is not completely obvious.</p>\n</blockquote>\n<p>I wasn't aware of this! Are the instructions on the <code>gh</code> website that we link to not sufficient? (I have a windows machine but I haven't attempted to make PRs to mathlib4 from it yet so I could try some testing, but probably not in the next few days)</p>",
        "id": 524903184,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1750345009
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"123965\">Bryan Gin-ge Chen</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/524903184\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"300245\">Filippo A. E. Nuccio</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/524807025\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"123965\">Bryan Gin-ge Chen</span> <a href=\"#narrow/stream/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/524687399\">said</a>:</p>\n<blockquote>\n<p>A PR adding more uses of <code>gh</code> would be appreciated!</p>\n</blockquote>\n<p>But installing gh for windows is not completely obvious.</p>\n</blockquote>\n<p>I wasn't aware of this! Are the instructions on the <code>gh</code> website that we link to not sufficient? (I have a windows machine but I haven't attempted to make PRs to mathlib4 from it yet so I could try some testing, but probably not in the next few days)</p>\n</blockquote>\n<p>Well, let's say that they are OK for people willing to open terminal on Win, and they are not that many.</p>",
        "id": 524912550,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1750348361
    },
    {
        "content": "<p>I see. Unfortunately the entire guide assumes that users are willing to open the terminal. If there is something reasonable to link to get people started with the terminal that might be good to put in at the start of the guide.</p>",
        "id": 524912905,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1750348483
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"421885\">@Joscha Mennicken</span> just tried, didn't work <span aria-label=\"frown\" class=\"emoji emoji-1f641\" role=\"img\" title=\"frown\">:frown:</span> <br>\n<a href=\"https://github.com/leanprover-community/mathlib4/pull/26162\">#26162</a> (could a maintainer run bench? <span aria-label=\"pleading\" class=\"emoji emoji-1f97a\" role=\"img\" title=\"pleading\">:pleading:</span>)</p>",
        "id": 524917255,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1750350078
    },
    {
        "content": "<p>I haven't been able to bench anything either -- I think the speed center is down right now :-(</p>",
        "id": 524918738,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1750350717
    },
    {
        "content": "<p>The speed center only allows !bench for contributors with write access, so it makes sense that it stopped working after the fork migration.</p>",
        "id": 524929575,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1750356166
    },
    {
        "content": "<p>OK well I guess my PRs are blocked on this lol</p>",
        "id": 524929987,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1750356387
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"421885\">@Joscha Mennicken</span> I have write access</p>",
        "id": 524952753,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1750370626
    },
    {
        "content": "<p>Oh, no, apparently I don't. <em>Edit:</em> I do. There are too many places to look to see if you have write access...</p>",
        "id": 524952907,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1750370761
    },
    {
        "content": "<p>The bot uses the <code>permission</code> field of <code>gh api repos/leanprover-community/mathlib4/collaborators/&lt;your username&gt;/permission</code>, which isn't as granular as the actual permissions.</p>",
        "id": 524953481,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1750371269
    },
    {
        "content": "<p>Thanks, I have <code>admin</code>, so it ought to work.</p>",
        "id": 524953808,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1750371578
    },
    {
        "content": "<p>In that case, I have absolutely no idea.</p>",
        "id": 524953829,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1750371602
    },
    {
        "content": "<p>Oh, maybe the bench bot itself no longer has the required permissions to check for other people's permissions? :D</p>",
        "id": 524953898,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1750371671
    },
    {
        "content": "<p>The bench bot works now. Manual command still doesn't. Bit silly but workable!</p>",
        "id": 525118937,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1750468331
    },
    {
        "content": "<p>Posting here because I'm guessing it's related.</p>\n<p>Running <code>lake exe cache get</code> in a lake project created today results in the following warning:</p>\n<blockquote>\n<p>Warning: Some Mathlib ecosystem tools assume that the git remote for <code>leanprover-community/mathlib4</code> is named <code>upstream</code>. You have named it <code>origin</code> instead. We recommend changing the name to <code>upstream</code>. Moreover, <code>origin</code> should point to your own fork of the mathlib4 repository. You can set this up with <code>git remote add upstream https://github.com/leanprover-community/mathlib4.git</code>.</p>\n</blockquote>\n<p><code>git remote -v</code> in <code>.lake/packages/mathlib</code> shows</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">origin</span><span class=\"w\">  </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">fetch</span><span class=\"o\">)</span>\n<span class=\"n\">origin</span><span class=\"w\">  </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">push</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>so I'm guessing this is because <code>lake update</code> clones mathlib with the default remote name <code>origin</code> and some other part of lake or mathlib, which was written for the migration to forking, notices this and complains.</p>",
        "id": 525405334,
        "sender_full_name": "Raghuram",
        "timestamp": 1750711627
    },
    {
        "content": "<p>I get the following error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">===</span><span class=\"w\"> </span><span class=\"n\">Step</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Setting</span><span class=\"w\"> </span><span class=\"n\">up</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">remotes</span><span class=\"w\"> </span><span class=\"bp\">===</span>\n<span class=\"bp\">‚úì</span><span class=\"w\"> </span><span class=\"n\">Upstream</span><span class=\"w\"> </span><span class=\"n\">remote</span><span class=\"w\"> </span><span class=\"n\">already</span><span class=\"w\"> </span><span class=\"n\">configured</span><span class=\"w\"> </span><span class=\"n\">correctly</span>\n<span class=\"bp\">‚úì</span><span class=\"w\"> </span><span class=\"n\">Origin</span><span class=\"w\"> </span><span class=\"n\">remote</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">fork</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">already</span><span class=\"w\"> </span><span class=\"n\">configured</span><span class=\"w\"> </span><span class=\"n\">correctly</span>\n\n<span class=\"n\">Current</span><span class=\"w\"> </span><span class=\"n\">branch</span><span class=\"o\">:</span>\n\n<span class=\"bp\">===</span><span class=\"w\"> </span><span class=\"n\">Step</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Pushing</span><span class=\"w\"> </span><span class=\"n\">branch</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">fork</span><span class=\"w\"> </span><span class=\"bp\">===</span>\n<span class=\"bp\">‚úó</span><span class=\"w\"> </span><span class=\"n\">Command</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">push</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">origin</span>\n<span class=\"bp\">‚úó</span><span class=\"w\"> </span><span class=\"n\">Error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">fatal</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">invalid</span><span class=\"w\"> </span><span class=\"n\">refspec</span><span class=\"w\"> </span><span class=\"bp\">''</span>\n</code></pre></div>\n<p>The first branch I ran this with ran fine. The second one, didn't.</p>",
        "id": 525433873,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1750733850
    },
    {
        "content": "<p>Never mind, I got it to work. <code>git checkout [branch name]</code> didn't work for this branch, I needed the <code>git checkout --track [branch name]</code>.</p>\n<p>It seems to be (sample size: 4) that the additional <code>--track</code> option is needed iff the branch name has a <code>/</code> character in it.</p>",
        "id": 525433976,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1750733974
    },
    {
        "content": "<p>I noticed that in my <code>git config</code>, VS code has inserted</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">branch</span><span class=\"bp\">.</span><span class=\"n\">master</span><span class=\"bp\">.</span><span class=\"n\">vscode</span><span class=\"bp\">-</span><span class=\"n\">merge</span><span class=\"bp\">-</span><span class=\"n\">base</span><span class=\"bp\">=</span><span class=\"n\">origin</span><span class=\"bp\">/</span><span class=\"n\">master</span>\n</code></pre></div>\n<p>If I'm trying to ignore <code>origin/master</code> as per the instructions, do I want this? Or do I want <code>...=upstream/master</code>? I'm having trouble finding documentation for what exactly it means.</p>",
        "id": 525789051,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1750885001
    },
    {
        "content": "<p>I don't know exactly what that setting does, but <code>upstream/master</code> would be my guess, yes</p>",
        "id": 525835137,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1750921242
    },
    {
        "content": "<p>So I'm having trouble with my PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/26006\">#26006</a>  which was made using the script. Its saying merge conflict, but I ran <code>git merge origin/master</code> (after pulling master) and it never gave me the \"resolve merge issues\" thing where I can fix the merge problems. I must be doing something wrong, but I can't seem to figure it out.</p>",
        "id": 526287526,
        "sender_full_name": "Chris Birkbeck",
        "timestamp": 1751222805
    },
    {
        "content": "<p>I also did the sync fork thing on my fork of mathlib, but that also didnt seem to fix the problem.</p>",
        "id": 526287597,
        "sender_full_name": "Chris Birkbeck",
        "timestamp": 1751222886
    },
    {
        "content": "<p>I assume <code>origin</code> is your fork and <code>upstream</code> is the main repo (which are what the script recommends), could you try <code>git fetch upstream</code> then <code>git merge upstream/master</code>?</p>",
        "id": 526287615,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1751222907
    },
    {
        "content": "<p>so it says: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">merge</span><span class=\"w\"> </span><span class=\"n\">upstream</span><span class=\"bp\">/</span><span class=\"n\">master</span>\n<span class=\"n\">Already</span><span class=\"w\"> </span><span class=\"n\">up</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">date</span><span class=\"bp\">.</span>\n</code></pre></div>",
        "id": 526287719,
        "sender_full_name": "Chris Birkbeck",
        "timestamp": 1751223055
    },
    {
        "content": "<p>Are you on the right branch?</p>",
        "id": 526287795,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751223157
    },
    {
        "content": "<p>oh but now when I ran <code>get merge origin/master</code> it now gave me the merge conflicts to fix, so that did work I guess</p>",
        "id": 526287856,
        "sender_full_name": "Chris Birkbeck",
        "timestamp": 1751223230
    },
    {
        "content": "<p>thanks!</p>",
        "id": 526287862,
        "sender_full_name": "Chris Birkbeck",
        "timestamp": 1751223234
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/all.20future.20PRs.20should.20be.20made.20from.20forks/near/526287795\">said</a>:</p>\n<blockquote>\n<p>Are you on the right branch?</p>\n</blockquote>\n<p>I think I was...</p>",
        "id": 526287874,
        "sender_full_name": "Chris Birkbeck",
        "timestamp": 1751223246
    },
    {
        "content": "<p>Something seems to have worked, yeah :)</p>",
        "id": 526287889,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1751223272
    },
    {
        "content": "<p>This may have been caused by out-of-date remotes (<code>upstream</code>/<code>origin</code>). When in doubt, just run <code>git fetch --all</code> to update all remotes.</p>",
        "id": 526288305,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1751223689
    },
    {
        "content": "<p>it might be worth adding some instructions about this to: <a href=\"https://leanprover-community.github.io/contribute/git.html\">https://leanprover-community.github.io/contribute/git.html</a> in case others get these merge issues. Since it doesn't mention <code>get merge origin/master</code> which I don't know I would know (and fail) to do unless I'd done it before.</p>",
        "id": 526288486,
        "sender_full_name": "Chris Birkbeck",
        "timestamp": 1751223900
    },
    {
        "content": "<p>A random observation: <a href=\"https://github.com/leanprover-community/mathlib4/pull/25739\">#25739</a> says CI is \"2 workflows awaiting approval\". Would this happen to all future new contributors from a fork, and requires maintainers to click some buttons?</p>",
        "id": 526288503,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1751223918
    },
    {
        "content": "<p>Looks like I have that power, so I clicked the button</p>",
        "id": 526288857,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1751224302
    },
    {
        "content": "<p>Thanks! I think thin will be a reoccurring thing, as I saw this in <a href=\"https://github.com/leanprover-community/mathlib4/pull/26518\">#26518</a> again. I think github will always ask maintainer for approval when running CI against new contributor's PR from fork (so nobody can just PR a bitcoin miner and get it running in our CI), but similar to how people needed to ask for permission, now they need to ask for the approval</p>",
        "id": 526299905,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1751237824
    },
    {
        "content": "<p>For what it's worth, the \"main\" CI jobs do not require approval; I think the only jobs that require approval are mostly jobs for automatically labeling the PR or making automatic style suggestions.</p>",
        "id": 526300080,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1751238052
    },
    {
        "content": "<p>That's interesting... what makes them different?</p>",
        "id": 526300121,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1751238100
    },
    {
        "content": "<p>I think the workflows triggered on the <a href=\"https://docs.github.com/en/actions/reference/events-that-trigger-workflows#pull_request\"><code>pull_request</code> event</a> require maintainer permission. (There may be some others as well)</p>",
        "id": 526300183,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1751238209
    },
    {
        "content": "<p>A few months ago I ran the script mentioned above on my laptop to migrate my open PRs to a fork. Now I'm back on my office desktop and I realized I was trying to work with local copies of an old (pre-migration) PR, which explained why all the recent commit history was missing!</p>\n<p>So I've just:<br>\n(i) deleted my local copy of mathlib4<br>\n(ii) replaced it with a clone of my mathlib4 fork<br>\n(iii) ran <code>git branch --set-upstream-to=upstream/master</code> which I think means my master branch will track the original mathlib master branch; I know I'm not supposed to edit my fork's master branch</p>\n<p>But now when I try to checkout my PR, I get an error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">eriehl</span><span class=\"bp\">@</span><span class=\"n\">mather</span><span class=\"bp\">-</span><span class=\"n\">mstu</span><span class=\"bp\">-</span><span class=\"n\">m2</span><span class=\"w\"> </span><span class=\"n\">mathlib4</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">gh</span><span class=\"w\"> </span><span class=\"n\">pr</span><span class=\"w\"> </span><span class=\"n\">checkout</span><span class=\"w\"> </span><span class=\"mi\">25780</span>\n<span class=\"n\">GraphQL</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Could</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">resolve</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">PullRequest</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">number</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"mf\">25780.</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">repository</span><span class=\"bp\">.</span><span class=\"n\">pullRequest</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Have I set this up incorrectly?</p>",
        "id": 532360873,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1754074020
    },
    {
        "content": "<p>Did you maybe miss <a href=\"https://leanprover-community.github.io/contribute/git.html#if-you-cloned-your-fork-without-using-the-github-cli-option-a-method-2\">the step where you add the original mathlib4 repo as remote named <code>upstream</code></a>? <code>git remote add upstream https://github.com/leanprover-community/mathlib4.git</code></p>",
        "id": 532362123,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1754074577
    },
    {
        "content": "<p>Probably that gh is configured to follow the repository to be your fork and not the main repo, so it's looking at pr <a href=\"https://github.com/leanprover-community/mathlib4/pull/25780\">#25780</a> on your fork which of course does not exist<br>\nCan you run <code>gh repo set-default leanprover-community/mathlib4</code> and then try again?</p>",
        "id": 532362130,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1754074579
    },
    {
        "content": "<p>You could also try running <code>./scripts/githelper.py fix</code> (or <code>python scripts/githelper.py fix</code>), which should (re-)set your repo to a known-good state. I'd be curious if it works correctly.</p>",
        "id": 532362509,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1754074728
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"421885\">@Joscha Mennicken</span> this gave me:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Step</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Check</span><span class=\"w\"> </span><span class=\"n\">remotes</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">branch</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">master'</span><span class=\"bp\">.</span>\n<span class=\"n\">WARNING</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Branch</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">master'</span><span class=\"w\"> </span><span class=\"n\">should</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">pushRemote</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">origin'</span><span class=\"bp\">.</span>\n<span class=\"n\">Update</span><span class=\"w\"> </span><span class=\"n\">pushRemote</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">master'?</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Y</span><span class=\"bp\">/</span><span class=\"n\">n</span><span class=\"o\">]:</span>\n</code></pre></div>\n<p>How should I respond?</p>",
        "id": 532362635,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1754074782
    },
    {
        "content": "<p>Either is fine. Use <code>n</code> if you want to keep your repo as-is.</p>",
        "id": 532362775,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1754074832
    },
    {
        "content": "<p>After implementing <span class=\"user-mention\" data-user-id=\"286014\">@Robin Carlier</span>'s suggestion I was able to pull the PR. But now I have no idea whether I've set anything up correctly or not.</p>",
        "id": 532362795,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1754074839
    },
    {
        "content": "<p>I'm never going to push anything from master, is that the reason why it doesn't matter?</p>",
        "id": 532362863,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1754074859
    },
    {
        "content": "<p>Yes. With the setup suggested by the script, any pushes to <code>master</code> would push to your fork, even though pulls would still fetch from the original mathlib4. This setup might be more confusing than useful.</p>",
        "id": 532363042,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1754074928
    },
    {
        "content": "<p>Okay, thanks for the help both of you.</p>",
        "id": 532363101,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1754074956
    },
    {
        "content": "<p>Now I'm left wondering if the script would've fixed it all by itself (which is the reason it exists in the first place). I guess I thought of it too late :D</p>",
        "id": 532363237,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1754075022
    },
    {
        "content": "<p>I maybe should have tried that? I never quite understood what the script was for. In any case, since I'd already moved my PRs, it didn't occur to me to try.</p>",
        "id": 532363342,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1754075072
    },
    {
        "content": "<p>The githelper fix command is meant for cases just like this, where a git repo may be set up incorrectly and you want to fix it in-place.</p>",
        "id": 532364396,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1754075489
    },
    {
        "content": "<p>(I think we still need to add something about the githelper script to the instructions on our website.)</p>",
        "id": 532364496,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1754075540
    },
    {
        "content": "<p>Good idea. This is the first I'm hearing about that script which indeed sounds very useful!</p>",
        "id": 532364990,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1754075765
    },
    {
        "content": "<p>I'm having a new issue and I'm wondering if it's related. I'm trying to add a new import to a file in the PR I just mentioned and I'm getting an error</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">object</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"bp\">'/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">eriehl</span><span class=\"bp\">/</span><span class=\"n\">Math</span><span class=\"bp\">/</span><span class=\"n\">Formalization</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">/</span><span class=\"n\">Category</span><span class=\"bp\">/</span><span class=\"n\">Cat</span><span class=\"bp\">/</span><span class=\"n\">CartesianClosed</span><span class=\"bp\">.</span><span class=\"n\">olean'</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"n\">Cat</span><span class=\"bp\">.</span><span class=\"n\">CartesianClosed</span><span class=\"w\"> </span><span class=\"n\">does</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">exist</span>\n</code></pre></div>\n<p>This file is in mathlib so is it an issue with my local set up?</p>",
        "id": 532372310,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1754079130
    },
    {
        "content": "<p>try reloading everything</p>",
        "id": 532372495,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754079228
    },
    {
        "content": "<p>A partial rebuild eventually fixed it. Thanks.</p>",
        "id": 532373890,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1754079907
    }
]