[
    {
        "content": "<p>I was playing around with the <code>variable?</code> command, and found it gives errors when the <code>variable</code> line has free universe variables. It would be useful for concrete categories if this were supported.</p>\n<p>For example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib.CategoryTheory.Category.Basic</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span>\n\n<span class=\"kd\">universe</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">u</span>\n\n<span class=\"kd\">class</span><span class=\"w\"> </span><span class=\"n\">FancyCategory</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span>\n\n<span class=\"c1\">-- It works if we make all universes explicit somehow:</span>\n<span class=\"kd\">variable</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">FancyCategory</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span>\n\n<span class=\"c1\">-- It breaks if we leave `v` implicit:</span>\n<span class=\"kd\">variable</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">FancyCategory</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span>\n<span class=\"c\">/-</span>\n<span class=\"cm\">error:</span>\n<span class=\"cm\">Maximum recursion depth for variables! reached. This might be a bug, or you can try adjusting `set_option variable?.maxSteps 15`</span>\n\n<span class=\"cm\">Current variable command:</span>\n<span class=\"cm\">  variable (C : Type u) [Category.{?u.36, u} C] [Category.{?u.47, u} C] [Category.{?u.58, u} C] [Category.{?u.69, u} C]</span>\n<span class=\"cm\">    [Category.{?u.80, u} C] [Category.{?u.91, u} C] [Category.{?u.102, u} C] [Category.{?u.113, u} C]</span>\n<span class=\"cm\">    [Category.{?u.124, u} C] [Category.{?u.135, u} C] [Category.{?u.146, u} C] [Category.{?u.157, u} C]</span>\n<span class=\"cm\">    [Category.{?u.168, u} C] [Category.{?u.179, u} C]</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"c1\">-- It also breaks if we leave `u` implicit:</span>\n<span class=\"kd\">variable</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">FancyCategory</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span>\n<span class=\"c\">/-</span>\n<span class=\"cm\">error:</span>\n<span class=\"cm\">Binder</span>\n<span class=\"cm\">  [FancyCategory.{v} C]</span>\n<span class=\"cm\">was not able to satisfy one of its dependencies using the pre-existing binder</span>\n<span class=\"cm\">  [Category.{v, ?u.264} C]</span>\n\n<span class=\"cm\">This might be due to differences in implicit arguments, which are not represented in binders since they are generated by pretty printing unsatisfied dependencies.</span>\n\n<span class=\"cm\">Current variable command:</span>\n<span class=\"cm\">  variable (C : Type _) [Category.{v, ?u.264} C]</span>\n\n<span class=\"cm\">Local context for the unsatisfied dependency:C✝ : Type u</span>\n<span class=\"cm\">inst✝² : Category.{v, u} C✝</span>\n<span class=\"cm\">inst✝¹ : FancyCategory C✝</span>\n<span class=\"cm\">C : Type ?u.264</span>\n<span class=\"cm\">inst✝ : sorry `«troep:1:1»</span>\n<span class=\"cm\">⊢ Category.{v, ?u.264} C</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"c1\">-- It also breaks if we write `Type*`:</span>\n<span class=\"kd\">variable</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">FancyCategory</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span>\n<span class=\"c\">/-</span>\n<span class=\"cm\">error:</span>\n<span class=\"cm\">failed to synthesize</span>\n<span class=\"cm\">  Category.{v, u_2} C</span>\n<span class=\"cm\">Additional diagnostic information may be available using the `set_option diagnostics true` command.</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"kd\">end</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span>\n</code></pre></div>",
        "id": 492327930,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1736262607
    },
    {
        "content": "<p>I just experimented with making metavariables pretty print as <code>_</code>, which helps the first failing example make progress, but I'm not sure what's going on with the <code>sorry</code> in the local context in the error message.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">pp</span><span class=\"bp\">.</span><span class=\"n\">mvars</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"kn\">variable</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">FancyCategory</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span>\n<span class=\"c\">/-</span>\n<span class=\"cm\">Binder</span>\n<span class=\"cm\">  [FancyCategory C]</span>\n<span class=\"cm\">was not able to satisfy one of its dependencies using the pre-existing binder</span>\n<span class=\"cm\">  [Category.{_, u} C]</span>\n\n<span class=\"cm\">This might be due to differences in implicit arguments, which are not represented in binders since they are generated by pretty printing unsatisfied dependencies.</span>\n\n<span class=\"cm\">Current variable command:</span>\n<span class=\"cm\">  variable (C : Type u) [Category.{_, u} C]</span>\n\n<span class=\"cm\">Local context for the unsatisfied dependency:</span>\n<span class=\"cm\">C : Type u</span>\n<span class=\"cm\">inst✝ : sorry</span>\n<span class=\"cm\">⊢ Category.{_, u} C</span>\n<span class=\"cm\">-/</span>\n</code></pre></div>\n<p>The only hint I have is that the <code>trace.variable?</code> option shows this <code>sorry</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">[</span><span class=\"kn\">variable</span><span class=\"bp\">?</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">elaborated</span><span class=\"w\"> </span><span class=\"n\">binder</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"n\">array</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"gr\">sorry</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>I can't spend time on <code>variable?</code> at the moment. I think having <code>variable?</code> set <code>pp.mvars false</code> makes sense (it's a small hack upon the hack that <code>variable?</code> already is — it depends on binder pretty printing!).</p>\n<p>Maybe with the right options we can see the binder elaboration failure that led to the <code>sorry</code>.</p>",
        "id": 492556834,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1736358726
    }
]