[
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/113488-general/topic/.22Missing.20Tactics.22.20list/near/533976912\">said</a>:</p>\n<blockquote>\n<p>here's the real one-line proof using typeclass:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">isStableUnderBaseChange'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsStableUnderBaseChange</span><span class=\"w\"> </span><span class=\"n\">Flat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"n\">auto</span><span class=\"w\"> </span><span class=\"n\">respectsIso</span>\n</code></pre></div>\n<p>(<a href=\"https://live.lean-lang.org/#codez=JYWwDg9gTgLgBAWQIYwBYBtgCMBQOCuAdsAG4CmUAzmXPnhGGYXACpOXQAKUEAJvgGMYeQkhBlKYJAJoAlYIQDmACQgg8A9EkqU4AQXSKyWKEmADuDCjACeOOA7gAKTnABccQABEcAN6y4AMrurDaMtAC+cADaAMJqIPJKcLIAutFxIAkKioEpADTO/oBJhADUAFSBAJRwRXCWYJX2ji4A5MEQ+DCcSKYgcAA8AD5ehYHBLKE0+NWx8Yk5qelz2bnRBkYmSMm5BfXVbgC8TWA8MGRCZLxwSIbGpshgAPrAAGYvvv5BHhNh+JGzmXmyTSAKySQCIPWdy2nzSbiaDlcThuG3uSDA2wC1UAKYR1NqfPAAWkJcAE0Cg53gZAAHmBMAJgDBCBJKDg0GRoGQ+ijoQ9nm8Ec5XB5vH4xt9JhEloCVotQUCIQUnMVylUanUeA1BT5OG0PB0uj0xANht5leKQr8ZhkwQsQTaFZDbptMfkNQxwoKolDNuZ6tYbHU8WkxV9LVN/g7ZfbluCnaiYat4Y4g8jnWiMZ8cXjMe4jg4faY/ZqAwA6HmbPmvF54ADEAlQ5wA1nAAJKUAIwJBYdBkACqhF4FAAQtoyDFUEglGRSyAm2zG5y+u3O93ewOh1BR9QJ1OjLOmy1tcKRqHxpK/tLbcCr46lSqKlj1fVPSmnKhAIEEwVkEkYQko7YQHUjRvqggBBBME3iAMGUnysIAIZS3tGiFxshOQsPG0Kums6aJuheSCoizgVhm2wsNUtRIsRSAPGMThBIA6URRIsZGVPsgorl2Pb9oOI5jru05BocTQHnAn6iWBeDskubYdpx648VufGTtO5adBAx6QR8Fo/BGqE3vKKyKqMpSPuR7pgK+jg6nqIzmmGOm0NasZ2npELYQmrq7JqlkON6OHFlYsCBq4uopIKxLOKggABBJpZ4Sr8kbOfpUYoX5HmwrsRE4TRWZwLiuqYiBzRiR4P6SJSAEcMBgrvhBIpwDBYwsAhBlJHKKU5G5rVoRhLqwu5mH+HhBE5kNz5tEEdFwIxzH7AccBYIGCgwDwlAANxwAoLwUM8hCUF2hAyGxKYcWu3Gbtu47KUYgnzYtTQUi8Cg0AebRiQA/I8TTLTwJCiQ9ADu0RUVWbx1GkKCiXAgBFRE0NLSPA4H/SIYi/tINAAGJaMIOAKPtU4yMEhZmBYJZBXAWOQ04LxELmgBlhIgfD4L2paU/AuUA42FJNCD6L8u8hwLUthArRA61wFAQNRC82OPLzTzVmFOD1o2AgtsAslnRuvE7tdZALhyFJ9Brq5cdrim63uZA2adZsKZd/E3WzebCUgakS7+FWAXgTBXGzPuDsk2SqOoQA\">full code</a>)</p>\n</blockquote>",
        "id": 534767897,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755356853
    },
    {
        "content": "<p>so, this has been sitting in the other chat for a few days now, do people want this?</p>",
        "id": 534767913,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755356868
    },
    {
        "content": "<p>Sorry for my slow response time, I was on vacation and am slowly catching up again. Your recent PRs <a href=\"https://github.com/leanprover-community/mathlib4/pull/28225\">#28225</a> and <a href=\"https://github.com/leanprover-community/mathlib4/pull/28238\">#28238</a> were already good improvements, so the proofs are now nice and readable. Thanks for that!<br>\nTherefore, I don't think we need any more machinery right now to automate the <code>RingHom.Property</code> files. The number of such proofs is low and is not expected to grow significantly. We can (and should) of course revisit if this changes.</p>\n<p>What I would be in favour of though, would be to extend <code>algebraize</code> to also replace tagged <code>RingHom</code> properties with <code>Algebra</code> properties in the goal (i.e. if the goal is <code>RingHom.Flat f</code>, <code>algebraize [f]</code> would turn the goal into <code>Module.Flat R S</code>, possibly with an option <code>algebraize -goal</code> to turn this behaviour of). This would require some refactoring of <code>algebraize</code> though.</p>",
        "id": 534898473,
        "sender_full_name": "Christian Merten",
        "timestamp": 1755506353
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"648495\">@Christian Merten</span> that would naturally require <code>algebraize</code> to store the iff lemmas, which opens us up to the possibility of also automating that part; is it a good idea to only automate the iff lemmas and nothing more?</p>",
        "id": 534910183,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755510077
    },
    {
        "content": "<p>Yes, I think letting a <code>@[algebraize +mk_iff]</code> attribute also add the <code>iff</code> lemma (there is precedent in the form of <code>@[mk_iff]</code>) would be reasonable, but mostly orthogonal to my above proposal.<br>\nThe blocking point for the above is that currently <code>algebraize</code> can only store one \"constructor lemma\" per property, because we tag the <code>Algebra</code> property and give it the lemma name as an argument. I have discussed this with <span class=\"user-mention\" data-user-id=\"684366\">@Edward van de Meent</span> before (who is on vacation this week): Probably we should change the tagging to happen on the lemmas instead of on the property. This way we can tag multiple lemmas and for <code>algebraize</code> to rewrite in hypothesis and goal, it would need either one <code>iff</code> lemma or two implications.</p>",
        "id": 534911652,
        "sender_full_name": "Christian Merten",
        "timestamp": 1755510547
    },
    {
        "content": "<p>well can we store both?</p>",
        "id": 534911880,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755510623
    },
    {
        "content": "<p>Yes we could, but tagging the lemmas instead of the property would be more extensible.<br>\nAn alternative would be to only replace <code>f</code> by <code>algebraMap R S</code> and let <code>simp</code> do the replacement (this would require us to tag <code>RingHom.flat_algebraMap</code> with <code>simp</code>.</p>",
        "id": 534912386,
        "sender_full_name": "Christian Merten",
        "timestamp": 1755510780
    },
    {
        "content": "<p>I am in favour of more custom tactics instead of relying on <code>simp</code></p>",
        "id": 534913113,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755511020
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- A ring homomorphism `f : R →+* S` is flat if `S` is flat as an `R` module. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">RingHom</span><span class=\"bp\">.</span><span class=\"n\">Flat</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">→+*</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">letI</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">toAlgebra</span>\n<span class=\"w\">  </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">Flat</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">algebraize</span><span class=\"kd\">]</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">RingHom</span><span class=\"bp\">.</span><span class=\"n\">flat_algebraMap_iff</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">algebraMap</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">Flat</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">Flat</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">RingHom</span><span class=\"bp\">.</span><span class=\"n\">Flat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">toAlgebra_algebraMap</span><span class=\"o\">]</span>\n</code></pre></div>\n<p><span class=\"user-mention\" data-user-id=\"648495\">@Christian Merten</span> to make sure I understand correctly, the above code is your current proposal, is that correct?</p>",
        "id": 534913326,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755511092
    },
    {
        "content": "<p>Yes, but we should still be able to tag more lemmas.<br>\nBut still, put this way it really starts looking like we should just have a <code>algebraize</code> simp set that <code>algebraize</code> can invoke after replacing <code>f</code> by <code>algebraMap R S</code>.</p>",
        "id": 534914238,
        "sender_full_name": "Christian Merten",
        "timestamp": 1755511385
    },
    {
        "content": "<p>Of course your proposed <code>@[algebraize +mk_iff]</code> can not be done by <code>simp</code>.</p>",
        "id": 534914421,
        "sender_full_name": "Christian Merten",
        "timestamp": 1755511443
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"648495\">Christian Merten</span> <a href=\"#narrow/channel/287929-mathlib4/topic/automate.20ring.20hom.20props/near/534914238\">said</a>:</p>\n<blockquote>\n<p>Yes, but we should still be able to tag more lemmas.<br>\nBut still, put this way it really starts looking like we should just have a <code>algebraize</code> simp set that <code>algebraize</code> can invoke after replacing <code>f</code> by <code>algebraMap R S</code>.</p>\n</blockquote>\n<p>well i'm not sure that <code>simp</code> is really the right thing here, e.g. i don't think the scalar tower can be <code>simp</code> either</p>",
        "id": 534922115,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755514246
    },
    {
        "content": "<p>Yes, I agree. I am not saying we don't need <code>algebraize</code>, I am just saying that (parts of) the property translation can be done by a custom <code>simp</code> set that <code>algebraize</code> invokes after creating the <code>Algebra</code> and <code>IsScalarTower</code> instances.</p>",
        "id": 534926373,
        "sender_full_name": "Christian Merten",
        "timestamp": 1755515727
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"648495\">Christian Merten</span> <a href=\"#narrow/channel/287929-mathlib4/topic/automate.20ring.20hom.20props/near/534898473\">said</a>:</p>\n<blockquote>\n<p>extend <code>algebraize</code> to also replace tagged <code>RingHom</code> properties with <code>Algebra</code> properties in the goal (i.e. if the goal is <code>RingHom.Flat f</code>, <code>algebraize [f]</code> would turn the goal into <code>Module.Flat R S</code>, possibly with an option <code>algebraize -goal</code> to turn this behaviour of).</p>\n</blockquote>\n<p>Whatever you do, could you please make sure it's consistent with <code>simp</code> acting on the goal, <code>simp at h</code> acting on <code>h</code>, <code>simp at h ⊢</code> acting on <code>h</code> and the goal, <code>simp at *</code> acting everywhere?</p>",
        "id": 534970889,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1755529491
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span> Heather currently has a PR to make this part smoother</p>",
        "id": 534970993,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755529524
    }
]