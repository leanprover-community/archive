[
    {
        "content": "<p>Currently Mathlib does not have much of a development for the <a href=\"https://en.wikipedia.org/wiki/Hyperreal_number\">hyperreals</a>, just a single 700 line file over at <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Hyperreal#doc\">docs#Hyperreal</a>. My proposal is to cut it down in half.</p>\n<p>Most of the file is spent introducing such notions such as <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Hyperreal.Infinite#doc\">docs#Hyperreal.Infinite</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Hyperreal.Infinitesimal#doc\">docs#Hyperreal.Infinitesimal</a>, and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Hyperreal.st#doc\">docs#Hyperreal.st</a>. All of these can be generalized (and are useful! e.g. surreals) to the setting of a general (non-)Archimedean field. Specifically:</p>\n<ul>\n<li><code>Hyperreal.Infinite x</code>: <code>ArchimedeanClass.mk x &lt; 0</code></li>\n<li><code>Hyperreal.Infinitesimal x</code>: <code>0 &lt; ArchimedeanClass.mk x</code></li>\n<li><code>Hyperreal.st x</code>: <code>ArchimedeanClass.stdPart x</code> (I added this just a few days ago)</li>\n<li><code>Hyperreal.IsSt x r</code>: <code>0 &lt; ArchimedeanClass.mk (x - ↑r)</code></li>\n<li><code>Hyperreal.InfinitePos x</code>: <code>0 &lt; x ∧ ArchimedeanClass.mk x &lt; 0</code></li>\n<li><code>Hyperreal.InfiniteNeg x</code>: <code>x &lt; 0 ∧ ArchimedeanClass.mk x &lt; 0</code></li>\n</ul>\n<p>My idea is then to deprecate all of these predicates, and generalize whatever useful theorems exist about them to this broader setting of non-Archimedean fields. This would leave us with basically nothing about hyperreals proper, save for the definition and some very basic theorems about how these functions relate to the ultrafilters in their definition. Is this an ok thing to do?</p>",
        "id": 564423893,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1766053205
    },
    {
        "content": "<p>(Truthfully I'm skeptical on whether we even want hyperreals specifically in Mathlib, rather than more generally proving Łoś's theorem, but that's a separate discussion)</p>",
        "id": 564424379,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1766053370
    },
    {
        "content": "<p>That sounds sensible. It doesn't seem too bad to keep the definition and presumably the instance of <code>ArchimedeanClass</code> if it's not that much code</p>",
        "id": 564427049,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1766054332
    },
    {
        "content": "<p>Would the correct move be to just deprecate everything about these six predicates? Or do I also have to show that the API that exists on <code>ArchimedeanClass</code> is sufficient to prove all of the API that exists on <code>Hyperreal</code>?</p>",
        "id": 564427393,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1766054443
    },
    {
        "content": "<p>(after <a href=\"https://github.com/leanprover-community/mathlib4/pull/33007\">#33007</a>, it basically should be)</p>",
        "id": 564427460,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1766054469
    },
    {
        "content": "<p>Well, picking a random example like <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Hyperreal.isSt_iff_abs_sub_lt_delta#doc\">docs#Hyperreal.isSt_iff_abs_sub_lt_delta</a> - if you deprecate it in favour of a lemma about <code>ArchimedeanClass.stdPart</code>, ideally you'd replace the proof to be sure the replacement works as well as you expect</p>",
        "id": 564428420,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1766054769
    },
    {
        "content": "<p>I've opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/33650\">#33650</a> for this deprecation. It depends on two other PRs which add some material to the file so that we don't end up losing anything of mathematical substance.</p>",
        "id": 566473526,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1767670669
    },
    {
        "content": "<p>I found that most of the file was just boilerplate which would not be very interesting to reprove. I claim that the lemmas in <a href=\"https://github.com/leanprover-community/mathlib4/pull/33644\">#33644</a> plus the existing API on <code>stdPart</code> and <code>ArchimedeanClass</code> well make up for the remainder.</p>",
        "id": 566473818,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1767670965
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"130500\">@Abhimanyu Pallavi Sudhir</span> Figured that I should notify the original author about this refactor (though the account hasn't been active in three years)</p>",
        "id": 566479463,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1767676029
    }
]