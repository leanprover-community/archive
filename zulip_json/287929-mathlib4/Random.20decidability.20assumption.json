[
    {
        "content": "<p>I’d be grateful if someone can help me explain in MIL why <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=DirectSum.toModule#doc\">docs#DirectSum.toModule</a> needs decidable equality on the indexing type but <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=DirectSum.linearEquivFunOnFintype#doc\">docs#DirectSum.linearEquivFunOnFintype</a> doesn’t.</p>",
        "id": 457386709,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723128444
    },
    {
        "content": "<p>And also why we have this Fintype version but seemingly no Finite version.</p>",
        "id": 457386909,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723128512
    },
    {
        "content": "<p>Why would we want both a finite version and a fintype version?</p>",
        "id": 457387439,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723128649
    },
    {
        "content": "<p>(I claim that at least that shouldn't be a general principle; we'd end up needing two different multiplications on <code>Matrix</code>, one for <code>Finite</code> and one for <code>Fintype</code>)</p>",
        "id": 457387607,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723128710
    },
    {
        "content": "<p>Because <code>Finite</code> is much nicer?</p>",
        "id": 457387799,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723128766
    },
    {
        "content": "<p>I mean I wouldn’t mind getting rid of the <code>Fintype</code> version.</p>",
        "id": 457387900,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723128804
    },
    {
        "content": "<p>I think the decidable equality might be accidental, since the docstring for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=DFinsupp.sumAddHom#doc\">docs#DFinsupp.sumAddHom</a> says no decidable assumption is needed, <del>and indeed <a href=\"https://leanprover-community.github.io/mathlib_docs/find/dfinsupp.sum_add_hom\">docs3#dfinsupp.sum_add_hom</a> does not have that assumption</del></p>",
        "id": 457388065,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723128855
    },
    {
        "content": "<p>That is, this looks like a misfiring variable inclusion</p>",
        "id": 457388103,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723128870
    },
    {
        "content": "<p>I won’t insist on the Fintype vs Finite thing. Right now I am only trying to get a consistent story to explain in my new MIL chapter.</p>",
        "id": 457388191,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723128895
    },
    {
        "content": "<p>I’ll try to open a Mathlib PR fixing this accidental assumption (unless you would prefer to do it).</p>",
        "id": 457388272,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723128928
    },
    {
        "content": "<p>In retrospect, I think it's talking about a <em>different</em> decidability assumption</p>",
        "id": 457388354,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723128954
    },
    {
        "content": "<p>Yes, the reason that assumption is needed is that <code>DFinsupp</code> stores a multiset of its support, and so to sum over the support you need to first deduplicate</p>",
        "id": 457388534,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723129003
    },
    {
        "content": "<p>So I think the fix here is perhaps just an explanation in the docstrings</p>",
        "id": 457388664,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723129049
    },
    {
        "content": "<p>Meanwhile, <code>DirectSum.linearEquivFunOnFintype</code> does not need to sum over the support, as it knows that it can just use the underlying function directly; so no decidable equality is needed</p>",
        "id": 457388909,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723129116
    },
    {
        "content": "<p>Ok, I guess I will stick to my “Note that the direct sum notation is scoped to the <code>DirectSum</code> namespace, and that the universal property of direct sums requires decidable equality on the indexing type (this is somehow an implementation accident).”</p>",
        "id": 457392390,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723129985
    },
    {
        "content": "<p>I might be biased, but I think decidable equality on the index type is a totally reasonable thing to require in general, and in fact its absence in some functions is more the implementation detail. Using the multivariate polynomial analogy, I think assuming an algorithm to tell the variable names apart is valid except possibly in the case of bad handwriting on a blackboard.</p>",
        "id": 457400322,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723131609
    },
    {
        "content": "<p>I guess the other way you could spin it is that to mathematicians, <code>Decidable</code> is always an implementation detail</p>",
        "id": 457400667,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723131671
    },
    {
        "content": "<p>Yes, decidability is not taught in mathematics departments and is universally found confusing by my students (as is noncomputability). The less of it we have, the better, in my opinion!</p>",
        "id": 457410405,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1723133449
    },
    {
        "content": "<p>About decidability: I have a linter in <a href=\"https://github.com/leanprover-community/mathlib4/pull/10235\">#10235</a> that detects unneeded <code>Decidable*</code>/<code>Fintype</code>/<code>Encodable</code> assumptions. It needs some work to avoid false positives (most come from structures) and some <code>nolint</code>s, but I have no time to finish it.</p>",
        "id": 457448900,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1723142935
    },
    {
        "content": "<p>what exactly is the accepted practice with regards to these kinds of assumptions?</p>",
        "id": 457455259,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1723144076
    },
    {
        "content": "<p>i'm not very acquainted with writing linters, but i get the impression that the linter wants you to replace all <code>Decidable</code> parameters with uses of <code>classical</code>? but surely that's not right?</p>",
        "id": 457456237,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1723144291
    },
    {
        "content": "<p>i thought the whole point of using <code>Decidable</code> instances is so you don't have to assume <code>classical</code>?</p>",
        "id": 457456637,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1723144364
    },
    {
        "content": "<p>The linter enforces the following rule: if you don't need <code>Decidable</code> to <strong>formulate</strong> a theorem, then don't use it.</p>",
        "id": 457461279,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1723145676
    },
    {
        "content": "<p>For definitions, if you don't need <code>Decidable</code> to generate <strong>data</strong>, then don't use it.</p>",
        "id": 457461330,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1723145710
    },
    {
        "content": "<p>So, it allows <code>Decidable</code> used to generate data but bans non-classical proofs (several exceptions will be added before we merge it).</p>",
        "id": 457461420,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1723145749
    },
    {
        "content": "<p>why is the decision being made to ban non-classical proofs?</p>",
        "id": 457461588,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1723145816
    },
    {
        "content": "<p>Because we decided to focus on classical math to make it easier for mathematicians.</p>",
        "id": 457461843,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1723145929
    },
    {
        "content": "<p>Non-classical proofs are tolerated (especially if <span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> will PR his <code>@[allowed_axioms]</code> attribute and mark lemmas that are supposed to stay non-classical), but most of the library uses <code>Decidable</code> only if it's required for data.</p>",
        "id": 457462081,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1723146021
    },
    {
        "content": "<p>in what contexts will non-classical proofs be allowed?</p>",
        "id": 457462213,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1723146086
    },
    {
        "content": "<p>E.g., Mario formalized something about Turing machines, and one of the points in his paper was that the proof didn't depend on <code>Clasical.choice</code>. If a theorem already relies on <code>Classical.choice</code> (e.g., anything in topology/analysis), then it makes no sense to make the proof \"a bit less\" classical.</p>",
        "id": 457462617,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1723146248
    },
    {
        "content": "<p>There are no formal rules for exceptions, but the idea is that in Coq you need to justify why you use classical reasoning, while in Mathlib you need to justify why you avoid it.</p>",
        "id": 457462809,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1723146333
    },
    {
        "content": "<p>so there's no real reason why, just \"because\"?</p>",
        "id": 457464035,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1723146820
    },
    {
        "content": "<p>to be clear, i do think it makes sense that if dependencies of a theorem already use <code>classical</code>, it's ok to continue to do so... it just strikes me as odd that that is used to justify forcing any proof to do so</p>",
        "id": 457464692,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1723147096
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Random.20decidability.20assumption/near/457461330\">said</a>:</p>\n<blockquote>\n<p>For definitions, if you don't need <code>Decidable</code> to generate <strong>data</strong>, then don't use it.</p>\n</blockquote>\n<p>In Patrick's original example, we <em>do</em> need this instance to (computably) generate the data.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Random.20decidability.20assumption/near/457410405\">said</a>:</p>\n<blockquote>\n<p>The less of it we have, the better, in my opinion!</p>\n</blockquote>\n<p>I don't think we should be making things noncomputable just to avoid confusing students, because this can often just create more work for tactic writing, cripple <code>#eval</code> for quick tests (which confuses other students), and prevents kernel reduction (which breaks <code>decide</code>). There are ways to reduce confusion without removing it!</p>",
        "id": 457464733,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723147111
    },
    {
        "content": "<p>Do you think we can somehow get a \"docstring for mathematicians\" at <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=DecidableEq#doc\">docs#DecidableEq</a> ? I can see this being contentious from the FRO's perspective since not all users are mathematicians. Was there any progress towards docstring extension by downstream packages?</p>",
        "id": 457465214,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723147268
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Random.20decidability.20assumption/near/457464733\">said</a>:</p>\n<blockquote>\n<p>I don't think we should be making things noncomputable just to avoid confusing students, because this can often just create more work for tactic writing, cripple <code>#eval</code> for quick tests (which confuses other students), and prevents kernel reduction (which breaks <code>decide</code>). There are ways to reduce confusion without removing it!</p>\n</blockquote>\n<p>This is not only confusing students, this is confusing professional mathematicians. Crippling <code>#eval</code> confuses students only if you tell students about <code>#eval</code>, which I never did, and I would be surprised if Kevin did. Do you know any proof in Mathlib that actually benefits from those <code>DecidableEq</code>? I am not saying we must get rid of them, but I am far from convinced by your arguments.</p>",
        "id": 457509958,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723151469
    },
    {
        "content": "<p>One setting where computability matters is functions about <code>Nat</code>, especially those used in <code>norm_num</code> and other tactic.</p>",
        "id": 457514666,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1723151785
    },
    {
        "content": "<p>This may include <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.factorization#doc\">docs#Nat.factorization</a>, hence bits of <code>Finsupp</code>.</p>",
        "id": 457514701,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1723151805
    },
    {
        "content": "<p>I am talking about direct sums of modules here, not computability in general.</p>",
        "id": 457515375,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723152102
    },
    {
        "content": "<p>I have numerous threads on Zulip (admittedly not in mathlib), where I use direct sums to build computable polynomials in about 20 lines. This depends on decidability, and I think enables rfl for some trivial statements</p>",
        "id": 457516063,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723152434
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Random.20decidability.20assumption/near/457509958\">said</a>:</p>\n<blockquote>\n<p>Do you know any proof in Mathlib that actually benefits from those <code>DecidableEq</code>?</p>\n</blockquote>\n<p>Speculating for now, I would expect this to be convenient for working with the graded structure of Exterior algebra, since otherwise you end up with a classical decidable instance for Nat when selecting a single element from <code>DirectSum.of</code></p>",
        "id": 457516627,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723152681
    },
    {
        "content": "<p>By the way <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=DirectSum.of#doc\">docs#DirectSum.of</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=DirectSum.lof#doc\">docs#DirectSum.lof</a> are also embarassing to explain in succession given the way they disagree on implicitness of arguments.</p>",
        "id": 458407267,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723152883
    },
    {
        "content": "<p>Maybe the explicit indexing type in the second one is a typo.</p>",
        "id": 458407875,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723153182
    },
    {
        "content": "<p>I suspect it's there due to elaboration issues; if you want the linear map version, then probably you're not applying it to <code>i</code> and so need to pass the type <code>I</code> instead</p>",
        "id": 458408786,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723153642
    },
    {
        "content": "<p>Oh, I guess the same is true for the AddMonoidHom, so this is inconsistent however you look at it</p>",
        "id": 458408932,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723153705
    },
    {
        "content": "<p>In the past I suggested making <code>of</code> a plain unbundled function. Would that be worse in your opinion?</p>",
        "id": 458409012,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723153766
    },
    {
        "content": "<p>It is definitely inconsistent. And you don’t need to apply it to infer <code>I</code>, it is already given by <code>M</code> (or <code>β</code>).</p>",
        "id": 458410792,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723154708
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Random.20decidability.20assumption/near/457464035\">said</a>:</p>\n<blockquote>\n<p>so there's no real reason why, just \"because\"?</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"684366\">@Edward van de Meent</span>, there's definitely a real reason, which is that nearly all mathematicians (one can of course quibble of what that means) don't care at all (or know!) about decidability, and the decision to have Mathlib be as classical as possible was intentional, and I think highly successful, in making Mathlib appealing and useful to these users.</p>\n<p>It is easy to find many people who've looked at other theorem provers libraries and essentially immediately dismissed them as being \"about\" constructivism or intuitionism or ..., rather than about \"mathematics\". Preferring classical reasoning in Mathlib is a direct response to this.</p>",
        "id": 459312592,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723159075
    },
    {
        "content": "<p>We're well aware this makes some people sad, and at the margins are willing to accommodate, but not on the core principle that Mathlib is <em>intended</em> to be primarily classical.</p>",
        "id": 459312679,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723159109
    }
]