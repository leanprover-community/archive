[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">primeFactors</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>This used to work before <code>chore: bump toolchain to v4.13.0-rc2</code> (<a href=\"https://github.com/leanprover-community/mathlib4/pull/17377\">#17377</a>).<br>\nNow <code>native_decide</code> can still solve it, but what is the best way to do these kind of calculations avoiding <code>native_decide</code>?</p>",
        "id": 480885425,
        "sender_full_name": "Moritz Firsching",
        "timestamp": 1730887871
    },
    {
        "content": "<p>This works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"n\">unseal</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">primeFactorsList</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">primeFactors</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>but I'm not sure if it counts as \"best\" or even \"good\"</p>",
        "id": 480889082,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1730889097
    },
    {
        "content": "<p>How about “least bad for now” :)</p>",
        "id": 480889710,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1730889323
    },
    {
        "content": "<p>I need this in a <code>have</code> somewhere in a longer proof, is there a way to make this <code>semireducible</code> only in the scope of this <code>have</code>?</p>",
        "id": 480893952,
        "sender_full_name": "Moritz Firsching",
        "timestamp": 1730890760
    },
    {
        "content": "<p>In the longer term, I expect that a <code>norm_num</code> extension that can compute this would be helpful. At the bottom of <code>Tactic.NormNum.Prime</code> there is some commented Lean 3 code that did this (or something similar).</p>",
        "id": 480894494,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1730890934
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"313038\">Moritz Firsching</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60rfl.60.20on.20primeFactors/near/480893952\">said</a>:</p>\n<blockquote>\n<p>I need this in a <code>have</code> somewhere in a longer proof, is there a way to make this <code>semireducible</code> only in the scope of this <code>have</code>?</p>\n</blockquote>\n<p>No, unfortunately not. Can you make it an auxillary lemma?</p>",
        "id": 480895367,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1730891221
    },
    {
        "content": "<p>Ah, since 4.14 you can use</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">primeFactors</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">decide!</span>\n</code></pre></div>\n<p>(This uses the kernel exclusively to reduce, so no need to <code>unseal</code>, and incidentially creates an aux lemma behind the scenes, so can be used inside a longer proof.)</p>",
        "id": 480895456,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1730891254
    },
    {
        "content": "<p>Oh, and this works too:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">primeFactors</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">primeFactors</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">primeFactorsList</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">minFac</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">minFacAux</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">dvd_iff_mod_eq_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">toFinset_factors</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>(Variants of <code>simp</code> will loop here, and I thought this was due to looping equational lemmas from well-founded recursion, but that’s not actually the case here)</p>",
        "id": 480937979,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1730904977
    },
    {
        "content": "<p>I have an open PR with an incomplete extension, I think, ported from Lean 3</p>",
        "id": 480947672,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1730907606
    },
    {
        "content": "<p>[this one: <a href=\"https://github.com/leanprover-community/mathlib4/pull/15420\">#15420</a>]</p>",
        "id": 481913551,
        "sender_full_name": "Moritz Firsching",
        "timestamp": 1731407617
    },
    {
        "content": "<p>I've managed to finish off that PR</p>",
        "id": 491778862,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1735920964
    }
]