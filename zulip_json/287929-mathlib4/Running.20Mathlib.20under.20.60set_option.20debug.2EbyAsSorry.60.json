[
    {
        "content": "<p>I've been trying to get Mathlib to run under <code>set_option debug.byAsSorry</code>, which turns all <code>by</code> blocks into <code>sorry</code>.</p>",
        "id": 453913575,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721903999
    },
    {
        "content": "<p>The purpose of this is to enable very fast benchmarking builds of subsets of Mathlib. (e.g. one might turn it on globally, and then turn it off for select files, and then rebuild while making changes to Lean itself)</p>",
        "id": 453913638,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721904006
    },
    {
        "content": "<p>This causes some problems! Sometimes implicit arguments in term mode aren't determined until we run a tactic block. Other times <code>variable</code>s are not pulled in when the tactic block is omitted.</p>",
        "id": 453913652,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721904010
    },
    {
        "content": "<p>Nearly all the changes required, however, seem positive. I've made 5 PRs so far backporting changes. <a href=\"https://github.com/leanprover-community/mathlib4/pull/14993\">#14993</a> <a href=\"https://github.com/leanprover-community/mathlib4/pull/15119\">#15119</a> <a href=\"https://github.com/leanprover-community/mathlib4/pull/15120\">#15120</a> <a href=\"https://github.com/leanprover-community/mathlib4/pull/15125\">#15125</a> <a href=\"https://github.com/leanprover-community/mathlib4/pull/15126\">#15126</a></p>",
        "id": 453913673,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721904015
    },
    {
        "content": "<p>Moreover, some of these changes are independently going to be helpful as we change the <code>variable</code> inclusion mechanism (as requested at <a href=\"https://github.com/leanprover/lean4/pull/2452\">lean#2452</a> with work in flight at <a href=\"https://github.com/leanprover/lean4/pull/4814\">lean#4814</a>).</p>",
        "id": 453913688,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721904020
    },
    {
        "content": "<p>If anyone would like to help out with this effort, here's how you can assist:</p>\n<ul>\n<li>Checkout <a href=\"https://github.com/leanprover-community/mathlib4/tree/byAsSorry\">branch#byAsSorry</a></li>\n<li><code>lake build</code></li>\n<li>This will fail at a bunch of files, the current frontier of work.</li>\n<li>Look at these files<ul>\n<li>if you can fix them via the types of changes in the PRs above, please do so!</li>\n<li>if you can't fix them, just as <code>set_option debug.byAsSorry false</code>, either to individual declarations or the whole file</li>\n</ul>\n</li>\n<li>Commit any of the <code>set_option</code> changes direct to <a href=\"https://github.com/leanprover-community/mathlib4/tree/byAsSorry\">branch#byAsSorry</a></li>\n<li>But for all the other changes, please don't commit them directly: instead <code>git stash</code> them, create a branch off <code>master</code>, and PR them, <em>then</em> merge that branch in <code>byAsSorry</code>.</li>\n</ul>",
        "id": 453913705,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721904024
    },
    {
        "content": "<p>It's probably a good idea to \"claim\" and \"unclaim\" <a href=\"https://github.com/leanprover-community/mathlib4/tree/byAsSorry\">branch#byAsSorry</a> here, via comment or emoji, so we don't have any collisions. I'm done for the night.</p>",
        "id": 453913720,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721904027
    },
    {
        "content": "<p>9 messages were moved from this topic to <a class=\"stream-topic\" data-stream-id=\"236604\" href=\"/#narrow/stream/236604-Zulip-meta/topic/fixing.20the.20mathlib.23n.20linkifier\">#Zulip meta &gt; fixing the mathlib#n linkifier</a> by <span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span>.</p>",
        "id": 453916534,
        "sender_full_name": "Notification Bot",
        "timestamp": 1721904637
    },
    {
        "content": "<p>Let me \"claim\" this branch for perhaps an hour (I'll write another message once I'm done)</p>",
        "id": 453924824,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1721907605
    },
    {
        "content": "<p>Follow-up request: can you disable the linter.unusedTactic linter on that branch? (I won't do that now, to not bust my cache locally. But it seems useful to avoid warning spew.)</p>",
        "id": 453925031,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1721907706
    },
    {
        "content": "<p>Are the semantics of <code>byAsSorry</code> \"don't run any <code>by</code> blocks\" or \"don't run any <em><code>Prop</code>-typed</em> <code>by</code> blocks\"?</p>",
        "id": 453928161,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1721908803
    },
    {
        "content": "<p>If the former, this seems to be leaning towards \"<code>by</code> should not be used for data\" as a hard rule, rather than the general guideline it used to be</p>",
        "id": 453928235,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1721908829
    },
    {
        "content": "<p>the latter</p>",
        "id": 453929099,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1721909131
    },
    {
        "content": "<p>assuming this gets adapted, i suppose mathlib would need another CI step where mathlib gets built with this option, to enforce this kind of benchmarking is possible? or maybe this can be enforced with some kind of linter?</p>",
        "id": 453938122,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1721911489
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Running.20Mathlib.20under.20.60set_option.20debug.2EbyAsSorry.60/near/453925031\">said</a>:</p>\n<blockquote>\n<p>Follow-up request: can you disable the linter.unusedTactic linter on that branch? (I won't do that now, to not bust my cache locally. But it seems useful to avoid warning spew.)</p>\n</blockquote>\n<p>maybe you could just hide warnings?</p>",
        "id": 453938635,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1721911656
    },
    {
        "content": "<p>i imagine there might be an option for that?</p>",
        "id": 453938861,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1721911708
    },
    {
        "content": "<p>Sure, I can disable these warnings locally. I'm asking to globally disable these warnings (<em>on that branch only</em>) because</p>\n<ul>\n<li>with that option, \"unreachable tactics\" are bound to happen <em>by design</em></li>\n<li>right now, running<code>lake build</code> or opening a new file means waiting for what feels a minute, for lake to replay all the warnings produced by previous files --- which are not useful</li>\n</ul>",
        "id": 453967520,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1721918435
    },
    {
        "content": "<p>I filed <a href=\"https://github.com/leanprover-community/mathlib4/pull/15133\">#15133</a> with the fixes I have so far (for a few other files, I couldn't find an easy find, but <code>set_option debug.byAsSorry</code> at the top of the file did not work either; I left these alone.</p>",
        "id": 453967645,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1721918476
    },
    {
        "content": "<p>is it just me or do the changes to the lakefile you made at <a href=\"https://github.com/leanprover-community/mathlib4/tree/MR-debugAsSorry\">branch#MR-debugAsSorry</a> make <code>lake build</code> throw errors saying <code>invalid -D parameter, unknown configuration option 'linter.unreachableTactic'</code>?</p>",
        "id": 453968726,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1721918790
    },
    {
        "content": "<p>or are you still working on that?</p>",
        "id": 453969195,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1721918928
    },
    {
        "content": "<p>i'd like to claim the branch for a bit</p>",
        "id": 453972752,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1721919867
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Running.20Mathlib.20under.20.60set_option.20debug.2EbyAsSorry.60/near/453968726\">said</a>:</p>\n<blockquote>\n<p>is it just me or do the changes to the lakefile you made at <a href=\"https://github.com/leanprover-community/mathlib4/tree/MR-debugAsSorry\">branch#MR-debugAsSorry</a> make <code>lake build</code> throw errors saying <code>invalid -D parameter, unknown configuration option 'linter.unreachableTactic'</code>?</p>\n</blockquote>\n<p>No, both tactics are mathlib tactics, and that branch apparently doesn't have the Lean change allowing to set mathlib options in <code>lakefile.lean</code>.</p>",
        "id": 453979446,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1721921357
    },
    {
        "content": "<p>I'm not working on this branch.</p>",
        "id": 453979505,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1721921378
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 453979917,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1721921434
    },
    {
        "content": "<p>i've created a pr, is it the intention that the entirety of (current master + your changes) gets merged into <a href=\"https://github.com/leanprover-community/mathlib4/tree/byAsSorry\">branch#byAsSorry</a> ? or just (your changes)?</p>",
        "id": 454007407,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1721928181
    },
    {
        "content": "<p>(the pr is <a href=\"https://github.com/leanprover-community/mathlib4/pull/15137\">#15137</a> for those interested)</p>",
        "id": 454007653,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1721928248
    },
    {
        "content": "<p>i suppose i will do the first option.</p>",
        "id": 454009780,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1721928834
    },
    {
        "content": "<p>once CI completes, that is</p>",
        "id": 454009879,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1721928864
    },
    {
        "content": "<p>ok, i'm done</p>",
        "id": 454018749,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1721931035
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Running.20Mathlib.20under.20.60set_option.20debug.2EbyAsSorry.60/near/453967645\">said</a>:</p>\n<blockquote>\n<p>I filed <a href=\"https://github.com/leanprover-community/mathlib4/pull/15133\">#15133</a> with the fixes I have so far (for a few other files, I couldn't find an easy find, but <code>set_option debug.byAsSorry</code> at the top of the file did not work either; I left these alone.</p>\n</blockquote>\n<p>Made one change, and <img alt=\":merge:\" class=\"emoji\" src=\"https://zulip-avatars.s3.amazonaws.com/3121/emoji/images/37577b95.png\" title=\"merge\">'d</p>",
        "id": 454065790,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721947763
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Running.20Mathlib.20under.20.60set_option.20debug.2EbyAsSorry.60/near/454007653\">said</a>:</p>\n<blockquote>\n<p>(the pr is <a href=\"https://github.com/leanprover-community/mathlib4/pull/15137\">#15137</a> for those interested)</p>\n</blockquote>\n<p>Thank you! <img alt=\":merge:\" class=\"emoji\" src=\"https://zulip-avatars.s3.amazonaws.com/3121/emoji/images/37577b95.png\" title=\"merge\">'d</p>",
        "id": 454066023,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721947903
    },
    {
        "content": "<p>Oh: I should have said earlier, a good technique for debugging when Lean can't synthesize an implicit argument to is locally <code>set_option debug.byAsSorry false</code>, and then use <code>#print</code> to inspect the proof term, and fill things in from that.</p>",
        "id": 454069565,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721949977
    },
    {
        "content": "<p>Another: robustifying for debug.byAsSorry (part 8) <a href=\"https://github.com/leanprover-community/mathlib4/pull/15149\">#15149</a></p>",
        "id": 454074027,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721951866
    },
    {
        "content": "<p>And: robustifying for debug.byAsSorry (part 9) <a href=\"https://github.com/leanprover-community/mathlib4/pull/15150\">#15150</a></p>",
        "id": 454120944,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721954786
    },
    {
        "content": "<p>I'll fix the errors in those two, but otherwise <a href=\"https://github.com/leanprover-community/mathlib4/tree/byAsSorry\">branch#byAsSorry</a> is available if anyone would like to hack on this.</p>",
        "id": 454121633,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721954807
    },
    {
        "content": "<p>We are definitely \"getting there\" now. We have been adding <code>set_option debug.byAsSorry false</code> in places, and these will have to be revisited, but the current frontier is now:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Subalgebra</span><span class=\"bp\">.</span><span class=\"n\">Directed</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"n\">Grp</span><span class=\"bp\">.</span><span class=\"n\">Kernels</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Exact</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Homology</span><span class=\"bp\">.</span><span class=\"n\">CommSq</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Homology</span><span class=\"bp\">.</span><span class=\"n\">ShortComplex</span><span class=\"bp\">.</span><span class=\"n\">Exact</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Polynomial</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Abelian</span><span class=\"bp\">.</span><span class=\"n\">Transfer</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Galois</span><span class=\"bp\">.</span><span class=\"n\">Decomposition</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Limits</span><span class=\"bp\">.</span><span class=\"n\">EpiMono</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Quotient</span><span class=\"bp\">.</span><span class=\"n\">Linear</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Quotient</span><span class=\"bp\">.</span><span class=\"n\">Preadditive</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Sites</span><span class=\"bp\">.</span><span class=\"n\">CoverLifting</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Sites</span><span class=\"bp\">.</span><span class=\"n\">Preserves</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Combinatorics</span><span class=\"bp\">.</span><span class=\"n\">Young</span><span class=\"bp\">.</span><span class=\"n\">YoungDiagram</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">DFinsupp</span><span class=\"bp\">.</span><span class=\"n\">WellFounded</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Geometry</span><span class=\"bp\">.</span><span class=\"n\">Manifold</span><span class=\"bp\">.</span><span class=\"n\">LocalInvariantProperties</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">GroupTheory</span><span class=\"bp\">.</span><span class=\"n\">OrderOfElement</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">LinearAlgebra</span><span class=\"bp\">.</span><span class=\"n\">TensorProduct</span><span class=\"bp\">.</span><span class=\"n\">Tower</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">RingTheory</span><span class=\"bp\">.</span><span class=\"n\">Ideal</span><span class=\"bp\">.</span><span class=\"n\">Quotient</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">RingTheory</span><span class=\"bp\">.</span><span class=\"n\">Localization</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">RingTheory</span><span class=\"bp\">.</span><span class=\"n\">Valuation</span><span class=\"bp\">.</span><span class=\"n\">Integers</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">SetTheory</span><span class=\"bp\">.</span><span class=\"n\">Ordinal</span><span class=\"bp\">.</span><span class=\"n\">Arithmetic</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Topology</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">Star</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Topology</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">OpenSubgroup</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Topology</span><span class=\"bp\">.</span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Topology</span><span class=\"bp\">.</span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">ScottTopology</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Topology</span><span class=\"bp\">.</span><span class=\"n\">SeparatedMap</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Topology</span><span class=\"bp\">.</span><span class=\"n\">StoneCech</span>\n</code></pre></div>",
        "id": 454125909,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721954942
    },
    {
        "content": "<p>I couldn't work out how to fix</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Combinatorics</span><span class=\"bp\">.</span><span class=\"n\">Young</span><span class=\"bp\">.</span><span class=\"n\">YoungDiagram</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">LinearAlgebra</span><span class=\"bp\">.</span><span class=\"n\">TensorProduct</span><span class=\"bp\">.</span><span class=\"n\">Tower</span>\n</code></pre></div>\n<p>nicely at all.</p>\n<p>Perhaps on these it is better to wait for <a href=\"https://github.com/leanprover/lean4/pull/4814\">lean#4814</a> to be ready, and to use <code>include</code>.</p>",
        "id": 454130123,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721955079
    },
    {
        "content": "<p>Can we get some kind of <code>by!</code> which says \"don't stub me under <code>debug.byAsSorry</code>\"?</p>",
        "id": 454136283,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1721955286
    },
    {
        "content": "<p>this will be useful in particular for defs defined using tactics</p>",
        "id": 454137008,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1721955310
    },
    {
        "content": "<p>in fact, I think it can be implemented in user space, as <code>set_option debug.byAsSorry false in by</code></p>",
        "id": 454137704,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1721955397
    },
    {
        "content": "<p>it is a uniform solution to migrate code to work with this option enabled</p>",
        "id": 454137784,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1721955444
    },
    {
        "content": "<p>I'd like to do a first pass without this, and see where we land. With the changes required for the new <code>variables</code> I think there might not be a huge amount remaining, and <code>by!</code> would be a fine solution.</p>",
        "id": 454138343,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721955809
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Running.20Mathlib.20under.20.60set_option.20debug.2EbyAsSorry.60/near/454137008\">said</a>:</p>\n<blockquote>\n<p>this will be useful in particular for defs defined using tactics</p>\n</blockquote>\n<p>I thought <span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span>'s comment above means that such <code>by</code> blocks are run anyway?</p>",
        "id": 454139311,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1721956402
    },
    {
        "content": "<p>yes, but part of the reason for that was that it was just infeasible because the breakage was too much</p>",
        "id": 454139351,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1721956435
    },
    {
        "content": "<p>having a low cost syntax for opting out would make it a lot more feasible</p>",
        "id": 454139415,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1721956453
    },
    {
        "content": "<p>i'm claiming the branch again</p>",
        "id": 454221904,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1721979157
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Running.20Mathlib.20under.20.60set_option.20debug.2EbyAsSorry.60/near/454074027\">said</a>:</p>\n<blockquote>\n<p>Another: robustifying for debug.byAsSorry (part 8) <a href=\"https://github.com/leanprover-community/mathlib4/pull/15149\">#15149</a></p>\n</blockquote>\n<p>Do we have a standard emoji for \"maintainer merge\"'d? Anyway, I just did so this PR and its sequel.</p>",
        "id": 454249573,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1721984277
    },
    {
        "content": "<p>i think it would be useful for this effort to have a linter checking if toggling the option changes the type of a statement. currently, the only way to see if that is the case is hoping and waiting for an error to occur somewhere down the line when tactic-mode isn't used, but that seems a bit short-sighted to me...</p>",
        "id": 454260909,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1721987692
    },
    {
        "content": "<p>As far as I understand a linter would be able to check that each individual declaration that is parsed would parse with \"<code>by</code> replaced by <code>sorry</code>\" (filtering out non-<code>Prop</code>-valued ones and whatever else).  However, to recreate the full <code>sorry</code>-bearing environment and checking that a new declaration compiles with the <em>previous ones</em> <code>sorry</code>ed out would mean basically that the linter would have to re-parse a big chunk of each file.</p>",
        "id": 454270045,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1721990651
    },
    {
        "content": "<p>This looks more like a CI step: CI build mathlib as is and also mathlib-as-sorry.</p>",
        "id": 454270151,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1721990713
    },
    {
        "content": "<p>doesn't it suffice to check locally?</p>",
        "id": 454270152,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1721990713
    },
    {
        "content": "<p>because assuming that somehow a statement compiles differently when replacing <code>by</code> with <code>sorry</code>, there is a first such statement where that is the case.</p>",
        "id": 454270246,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1721990757
    },
    {
        "content": "<p>I am not sure that it suffices to check locally: something <code>sorry</code>ed may parse, but may not have the \"same\" meaning as the un-<code>sorry</code>ed one in subtle ways.</p>",
        "id": 454270305,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1721990766
    },
    {
        "content": "<p>A simple way in which this can happen is because a <code>variable</code> is not pulled in, since it was used in the proof (but not in the statement), but there are certainly more ways in which this can happen.</p>",
        "id": 454270371,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1721990799
    },
    {
        "content": "<p>so you can't compare the type of two versions of the term?</p>",
        "id": 454270479,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1721990841
    },
    {
        "content": "<p>I'm not saying that the linter would be useless, just that you would still need to depend on more resources.</p>",
        "id": 454270532,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1721990865
    },
    {
        "content": "<p>Yes, that could be done, but making it work for auto-generated declarations would be hard.</p>",
        "id": 454270689,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1721990925
    },
    {
        "content": "<p>maybe i'm not explaining it well...<br>\ntake this example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"o\">:</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">heq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>\n<p>with <code>set_option debug.byAsSorry false</code>, the type of <code>heq</code> is <code>heq {a b : Nat} (h : a = b) : a = b</code> while with <code>set_option debug.byAsSorry true</code>, it is <code>heq {a b : Nat} : a = b</code>. can't a linter tell this difference?</p>",
        "id": 454271081,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1721991096
    },
    {
        "content": "<p>Yes, I think that this you could detect.</p>",
        "id": 454271172,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1721991125
    },
    {
        "content": "<p>Let me try to write a linter that does that and see how it performs.</p>",
        "id": 454271244,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1721991160
    },
    {
        "content": "<p>I agree that it will be useful, but I am not sure that it would flag everything that it should.</p>",
        "id": 454271274,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1721991177
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/15162\">#15162</a></p>\n<p>This is very preliminary, but I am not sure that I will have more time to work on this soon.</p>",
        "id": 454284782,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1721995611
    },
    {
        "content": "<p>As you can probably see, the PR has just two new files: <code>Mathlib.Tactic.Linter.CheckAsSorry</code> and a test file.  If you copy over <code>Mathlib.Tactic.Linter.CheckAsSorry</code> to your \"other\" PR, adding</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Linter</span><span class=\"bp\">.</span><span class=\"n\">CheckAsSorry</span>\n</code></pre></div>\n<p>at the beginning should make the linter parse the file.  The tests that I ran are basically exactly the ones contained in the test file, so I expect a lot of issues, since this is quite delicate, but hopefully it is useful.</p>",
        "id": 454293938,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1721998626
    },
    {
        "content": "<p>If you accumulate the problems that you come across with the linter, I can try to fix them, though that would in all likelyhood not happen before Monday.</p>",
        "id": 454294035,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1721998676
    },
    {
        "content": "<p>right, thanks!</p>",
        "id": 454294099,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1721998689
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/15164\">#15164</a> is <del>part 9</del> part 10 in the series</p>",
        "id": 454308948,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1722003592
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Running.20Mathlib.20under.20.60set_option.20debug.2EbyAsSorry.60/near/454308948\">said</a>:</p>\n<blockquote>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/15164\">#15164</a> is part 9 in the series</p>\n</blockquote>\n<p>Part 9 already landed on master, so this is even part 10. :-)</p>",
        "id": 454310592,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1722004167
    },
    {
        "content": "<p>ah oops <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 454310730,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1722004209
    },
    {
        "content": "<p>forgot how to count</p>",
        "id": 454310758,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1722004219
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/15169\">#15169</a> is part 11 in the series</p>",
        "id": 454333135,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1722011218
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> i've taken a look at <code>Mathlib.LinearAlgebra.TensorProduct.Tower</code>, and it seems to be the case that removing <code>[Module B P]</code> as well as <code>[IsScalarTower R B P] [SMulCommClass A B P]</code> at lines <code>303-304</code> fixes the errors... it seems to have something to do with <code>AlgebraTensorModule.assoc</code> pulling <em>in</em> more variables for some reason? i'm not really sure exactly how it works. I'll create a PR for my current changes minus this tensorproduct stuff,  and then free the branch</p>",
        "id": 454372600,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1722027559
    },
    {
        "content": "<p><del>a quick look at <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/LinearAlgebra/TensorProduct/Tower.html#TensorProduct.AlgebraTensorModule.cancelBaseChange\">the docs for the file</a> using ctrl+f makes it seem like the assumption <code>[Module B P]</code> occurs in <em>0</em> of the declarations in the file?</del> nvm, that's just my browser not handling searching for italics</p>",
        "id": 454374548,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1722028496
    },
    {
        "content": "<p>it's at the very least not used in <code>section CommSemiring</code>, where the <code>variable</code> is declared</p>",
        "id": 454375265,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1722028891
    },
    {
        "content": "<p>ok, <a href=\"https://github.com/leanprover-community/mathlib4/pull/15178\">#15178</a> is number 12! i'm done for today</p>",
        "id": 454376808,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1722029688
    },
    {
        "content": "<p>In case anyone tries the linter, I forgot to specify what I intended it to do:</p>\n<ul>\n<li>it only inspects <code>lemma</code>s and <code>theorem</code>s whose proof begins with <code>:=</code> (as opposed to <code>|</code>),</li>\n<li><code>protected</code> confuses the linter,</li>\n<li>if it fails, it should produce a message saying what expressions the sorried version produced,</li>\n<li>it does <em>not</em> replace any other proof by <code>sorry</code>, just the \"main\" one.</li>\n</ul>",
        "id": 454388376,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1722034771
    },
    {
        "content": "<p>it would seem that i accidentally merged a batteries bump into the branch, which causes some issues i don't know how to fix. (it complained that some declarations like <code>List.pmap</code> and <code>List.attach</code> were already present.) For now, i'll undo the bump</p>",
        "id": 454438999,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1722064366
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"684366\">@Edward van de Meent</span>, I've merged your PRs, except for a few minor comments on <a href=\"https://github.com/leanprover-community/mathlib4/pull/15178\">#15178</a>, which I've delegated ( <span aria-label=\"peace sign\" class=\"emoji emoji-270c\" role=\"img\" title=\"peace sign\">:peace_sign:</span>)</p>",
        "id": 454441239,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1722066373
    },
    {
        "content": "<p>i'm working on it again</p>",
        "id": 454446353,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1722070123
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/15197\">#15197</a> is part 13</p>",
        "id": 454474799,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1722088899
    },
    {
        "content": "<p>i'll stop there for today</p>",
        "id": 454474811,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1722088912
    },
    {
        "content": "<p>Out of curiosity, did you try the linter?  Was it in any way useful?  <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 454474947,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1722089022
    },
    {
        "content": "<p>i forgot <span aria-label=\"melting face\" class=\"emoji emoji-1fae0\" role=\"img\" title=\"melting face\">:melting_face:</span></p>",
        "id": 454475008,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1722089055
    },
    {
        "content": "<p>One more for now at \"robustifying for debug.byAsSorry (part 14) <a href=\"https://github.com/leanprover-community/mathlib4/pull/15247\">#15247</a>\"</p>",
        "id": 454687275,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1722213988
    },
    {
        "content": "<p>I propose, however, that we now pause on getting <a href=\"https://github.com/leanprover-community/mathlib4/tree/byAsSorry\">branch#byAsSorry</a> working, as we are more and more often running into problems that are better solved by <em>first</em> updating Mathlib for the new variables inclusion mechanism from <a href=\"https://github.com/leanprover/lean4/pull/4814\">lean#4814</a>.</p>",
        "id": 454687322,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1722214031
    },
    {
        "content": "<p>I will started a separate thread describing the work that needs to be done there. We'll definitely need some help to get it pushed through. As soon as that is done we can return to <code>byAsSorry</code>. (Although, if anyone would like to continue here nevertheless, I'm not going to stop them!)</p>",
        "id": 454687376,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1722214079
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/15247\">#15247</a> still awaiting review</p>",
        "id": 455503818,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1722467854
    },
    {
        "content": "<p>I implemented a similar option many years ago. I used notation <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">S</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{S}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathcal\" style=\"margin-right:0.075em;\">S</span></span></span></span> to wrap around a <code>by</code>-block, and when the option <code>checking_mode</code> is true, it will be a usual <code>by</code>-tactic, when false it is elaborated as <code>sorry</code>.</p>",
        "id": 455552519,
        "sender_full_name": "Shuhao Song",
        "timestamp": 1722488987
    },
    {
        "content": "<p>Hi, this sounds really useful what you're doing here. Can I just add my use case which is to basically have a small Mathlib library with propositions only without proofs included, which can be used offline, using REPL. In this use case we are not really interested in having things proved from the basic axioms, but are fine to \"trust\" the propositions in Mathlib are correct.</p>",
        "id": 455797522,
        "sender_full_name": "Mr Proof",
        "timestamp": 1722562244
    }
]