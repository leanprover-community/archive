[
    {
        "content": "<p>I have started porting <code>data_synth</code> tactic to mathlib4, <a href=\"https://github.com/leanprover-community/mathlib4/pull/29432\">#29432</a>. </p>\n<p>The tactic <code>data_synth</code> is designed to synthesize some data and prove a property about it. The canonical examples is <code>HasFDerivAt ùïú f ?f' x</code>. This tactic figures out what <code>?f'</code> is  and provides a proof of <code>HasFDerivAt</code>.</p>\n<p>Another examples of propositions solvable by <code>data_synth</code></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">data_synth</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">center</span><span class=\"w\"> </span><span class=\"n\">radius</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">HasBoundingBall</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">center</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">radius</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">‚äÜ</span><span class=\"w\"> </span><span class=\"n\">Metric</span><span class=\"bp\">.</span><span class=\"n\">closedBall</span><span class=\"w\"> </span><span class=\"n\">center</span><span class=\"w\"> </span><span class=\"n\">radius</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">data_synth</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">IsPolynomial</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">eval</span>\n</code></pre></div>\n<p>Calling <code>data_synth</code> on <code>HasBoundingBall s _ _</code> will find center and radius of a ball thet bounds the set <code>s</code> and calling it on <code>IsPolynomial f _</code> will finds <code>p : Polynomial R</code> that evaluates to <code>f</code>.</p>\n<p>Here is an example how to set up <code>data_synth</code> for <code>HasBoundingBall</code></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">data_synth</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">center</span><span class=\"w\"> </span><span class=\"n\">radius</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">HasBoundingBall</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">center</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">radius</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">‚äÜ</span><span class=\"w\"> </span><span class=\"n\">Metric</span><span class=\"bp\">.</span><span class=\"n\">closedBall</span><span class=\"w\"> </span><span class=\"n\">center</span><span class=\"w\"> </span><span class=\"n\">radius</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">data_synth</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">hasBoundingBall_Icc</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">HasBoundingBall</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Icc</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">a</span><span class=\"bp\">+</span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">|</span><span class=\"n\">b</span><span class=\"bp\">-</span><span class=\"n\">a</span><span class=\"bp\">|/</span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">data_synth</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">hasBoundingBall_union</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">s‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">c‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÇ</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hs‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HasBoundingBall</span><span class=\"w\"> </span><span class=\"n\">s‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÅ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hs‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HasBoundingBall</span><span class=\"w\"> </span><span class=\"n\">s‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">HasBoundingBall</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s‚ÇÅ</span><span class=\"w\"> </span><span class=\"bp\">‚à™</span><span class=\"w\"> </span><span class=\"n\">s‚ÇÇ</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‚Äñ</span><span class=\"n\">c‚ÇÅ</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÇ</span><span class=\"bp\">‚Äñ</span>\n<span class=\"w\">       </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">min</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÇ</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÇ</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">         </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÅ</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÇ</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÇ</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÅ</span>\n<span class=\"w\">       </span><span class=\"k\">else</span>\n<span class=\"w\">         </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">+</span><span class=\"o\">(</span><span class=\"n\">r‚ÇÅ</span><span class=\"bp\">-</span><span class=\"n\">r‚ÇÇ</span><span class=\"o\">)</span><span class=\"bp\">/</span><span class=\"n\">d</span><span class=\"o\">)</span><span class=\"bp\">/</span><span class=\"mi\">2</span>\n<span class=\"w\">         </span><span class=\"o\">(</span><span class=\"n\">w</span><span class=\"bp\">‚Ä¢</span><span class=\"n\">c‚ÇÅ</span><span class=\"bp\">+</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">-</span><span class=\"n\">w</span><span class=\"o\">)</span><span class=\"bp\">‚Ä¢</span><span class=\"n\">c‚ÇÇ</span><span class=\"o\">))</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‚Äñ</span><span class=\"n\">c‚ÇÅ</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÇ</span><span class=\"bp\">‚Äñ</span>\n<span class=\"w\">       </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">min</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÇ</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÇ</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">         </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÅ</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÇ</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÇ</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÅ</span>\n<span class=\"w\">       </span><span class=\"k\">else</span>\n<span class=\"w\">         </span><span class=\"o\">(</span><span class=\"n\">d</span><span class=\"bp\">+</span><span class=\"n\">r‚ÇÅ</span><span class=\"bp\">+</span><span class=\"n\">r‚ÇÇ</span><span class=\"o\">)</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>The tactic can be called as</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">check</span>\n<span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">data_synth</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">norm</span><span class=\"o\">:=</span><span class=\"n\">norm_num</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">HasBoundingBall</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Icc</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚à™</span><span class=\"w\"> </span><span class=\"n\">Icc</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>with the output</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">‚ãØ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HasBoundingBall</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Icc</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">‚à™</span><span class=\"w\"> </span><span class=\"n\">Icc</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span>\n</code></pre></div>\n<hr>\n<p>I personally use this tactic for:</p>\n<ul>\n<li>computing derivatives</li>\n<li>finding bounds</li>\n<li>verified compilation</li>\n</ul>\n<p>More examples can be found in this previous <a href=\"#narrow/channel/270676-lean4/topic/Meta-functions.3A.20meta.20programming.20for.20everyone/with/507628025\">thread</a> on \"meta-functions\" which is just some syntactic sugar over this tactic.</p>\n<p>I would appreciate input from others what they might use the tactic for and give me some concrete examples of goals that should be solvable by this tactic. It would help me tremendously to refine this tactic.</p>",
        "id": 538173356,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1757323312
    },
    {
        "content": "<p>If anyone interested, I have couple of examples of computing derivatives <a href=\"https://github.com/lecopivo/mathlib4/blob/37bb5142e63c0f3648870317324381cb239a59af/Mathlib/Tactic/DataSynth/Tests/FDeriv.lean\">here</a>.</p>",
        "id": 538849431,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1757594788
    },
    {
        "content": "<p>This seems nice, but can you explain how it differs from standard typeclass inference? e.g. this seems to largely reproduce the behavior:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">tmp</span><span class=\"w\"> </span><span class=\"c1\">-- to avoid collision with existing `HasBoundingBall`</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Œ±</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MetricSpace</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LinearOrder</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">]</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">InnerProductSpace</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">]</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">HasBoundingBall</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">center</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">outParam</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">radius</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">outParam</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">‚äÜ</span><span class=\"w\"> </span><span class=\"n\">Metric</span><span class=\"bp\">.</span><span class=\"n\">closedBall</span><span class=\"w\"> </span><span class=\"n\">center</span><span class=\"w\"> </span><span class=\"n\">radius</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">hasBoundingBall_Icc</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HasBoundingBall</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Icc</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">a</span><span class=\"bp\">+</span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">|</span><span class=\"n\">b</span><span class=\"bp\">-</span><span class=\"n\">a</span><span class=\"bp\">|/</span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">hasBoundingBall_union</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">s‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">c‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÇ</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">hs‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HasBoundingBall</span><span class=\"w\"> </span><span class=\"n\">s‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÅ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hs‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HasBoundingBall</span><span class=\"w\"> </span><span class=\"n\">s‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÇ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">HasBoundingBall</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s‚ÇÅ</span><span class=\"w\"> </span><span class=\"bp\">‚à™</span><span class=\"w\"> </span><span class=\"n\">s‚ÇÇ</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‚Äñ</span><span class=\"n\">c‚ÇÅ</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÇ</span><span class=\"bp\">‚Äñ</span>\n<span class=\"w\">       </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">min</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÇ</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÇ</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">         </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÅ</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÇ</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÇ</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÅ</span>\n<span class=\"w\">       </span><span class=\"k\">else</span>\n<span class=\"w\">         </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">+</span><span class=\"o\">(</span><span class=\"n\">r‚ÇÅ</span><span class=\"bp\">-</span><span class=\"n\">r‚ÇÇ</span><span class=\"o\">)</span><span class=\"bp\">/</span><span class=\"n\">d</span><span class=\"o\">)</span><span class=\"bp\">/</span><span class=\"mi\">2</span>\n<span class=\"w\">         </span><span class=\"o\">(</span><span class=\"n\">w</span><span class=\"bp\">‚Ä¢</span><span class=\"n\">c‚ÇÅ</span><span class=\"bp\">+</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">-</span><span class=\"n\">w</span><span class=\"o\">)</span><span class=\"bp\">‚Ä¢</span><span class=\"n\">c‚ÇÇ</span><span class=\"o\">))</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‚Äñ</span><span class=\"n\">c‚ÇÅ</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÇ</span><span class=\"bp\">‚Äñ</span>\n<span class=\"w\">       </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">min</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÇ</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÇ</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">         </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÅ</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÇ</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÇ</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">r‚ÇÅ</span>\n<span class=\"w\">       </span><span class=\"k\">else</span>\n<span class=\"w\">         </span><span class=\"o\">(</span><span class=\"n\">d</span><span class=\"bp\">+</span><span class=\"n\">r‚ÇÅ</span><span class=\"bp\">+</span><span class=\"n\">r‚ÇÇ</span><span class=\"o\">)</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">haveI</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstanceAs</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">HasBoundingBall</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Icc</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚à™</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Icc</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">  </span><span class=\"n\">norm_num</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">this</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">this</span>\n<span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- ... : HasBoundingBall (Set.Icc (-1) 2 ‚à™ Set.Icc 5 6) (5 / 2) (7 / 2)</span>\n</code></pre></div>",
        "id": 538920805,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1757615304
    },
    {
        "content": "<p>(Based on your PR, it _looks_ like it can do more complicated kinds of inference, which is what I'm hoping to hear about! Not saying that it seems useless since typeclass inference exists. :) )</p>",
        "id": 538921057,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1757615410
    },
    {
        "content": "<p>I think the main difference is customizability, <code>data_synth</code> is designed to be extensible. Few examples:</p>\n<ul>\n<li>Theorems like <code>HasFDerivAt.comp</code> require custom unification as the standard one does not always provide a good result.</li>\n<li>Built in support for normalization of the output parameter.  This helps with the speed of the tactic as it(in my uses cases) keeps the size of the output expression relatively small.</li>\n<li>Use of custom dischargers. In type class synthesis you can't call custom tactic to infer an argument to a theorem e.g. prove <code>0 &lt; x</code> with <code>positivity</code>.</li>\n</ul>\n<p>I use this tactic mainly for automatic differentiation where all these little details matter in order to get tactic that is fast and can differentiate reasonably sized programs/functions.</p>\n<p>On other hand, the search algorithm is much more simple compared to type class synthesis. It is effectively depth first search. </p>\n<p>The example <code>HasBoundingBall</code> is probably too simple to notice the difference between the two tactics.</p>",
        "id": 539007461,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1757665053
    },
    {
        "content": "<p>I see, okay that makes sense! They're both doing some kind of backwards search to fill in \"out params\" and synthesize a proof as they go. But then the details diverge. I guess it's a similar story to <code>fun_prop</code> then, yes?</p>",
        "id": 539108965,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1757693109
    },
    {
        "content": "<p>Yes the devil is in the details :) higher order unification, bundled morphisms, performance, ...</p>",
        "id": 539271129,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1757769729
    }
]