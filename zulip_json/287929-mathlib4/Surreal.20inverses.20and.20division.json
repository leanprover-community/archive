[
    {
        "content": "<p>After correcting the definition of surreal inverses (discussed in <a href=\"#narrow/stream/287929-mathlib4/topic/Surreal.20inverse.20formula.20in.20mathlib4.20is.20incorrect\">this thread</a>), I have proven that the definition indeed gives a multiplicative inverse, and defined a <code>LinearOrderedField</code> structure on <code>Surreal</code>. The PR is <a href=\"https://github.com/leanprover-community/mathlib4/pull/14498\">#14498</a></p>",
        "id": 449716926,
        "sender_full_name": "Ted Hwa",
        "timestamp": 1720383752
    },
    {
        "content": "<p>Yikes it's huge! Usually PRs, especially from new contributors, are encouraged to be more like 150 lines, although at first glance the code looks pretty good -- thanks! Is there any way you can PR some preliminaries separately? Another issue is that there are not that many people who are able to review PRs in this area.</p>",
        "id": 449719315,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1720385554
    },
    {
        "content": "<p>I think putting up the whole thing at once like this is still good - it's just not the final step to getting it reviewed. What it does mean is that when people ask about how the pieces are used, you can point at the big PR for examples, and they can suggest how to change it to avoid the need for those pieces at all if necessary</p>",
        "id": 449723518,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1720387121
    },
    {
        "content": "<p>I can break each file's changes into a separate PR, but the main proof in the <code>Division</code> file is still long. The PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/14463\">#14463</a> to fix the formula was intended to be able a small change leading up to this PR. But in the discussion on <a href=\"#narrow/stream/287929-mathlib4/topic/Surreal.20inverse.20formula.20in.20mathlib4.20is.20incorrect\">the other thread</a>, there was disagreement on whether it should be separated or incorporated into this PR.</p>\n<blockquote>\n<p>Another issue is that there are not that many people who are able to review PRs in this area.</p>\n</blockquote>\n<p>Any suggestions on what to do about that? I acknowledge this is a somewhat niche area of mathematics.</p>",
        "id": 449724506,
        "sender_full_name": "Ted Hwa",
        "timestamp": 1720387947
    },
    {
        "content": "<p>Perhaps ping previous contributors to these files (although likely Mario and I won't have time to review)?</p>",
        "id": 449724648,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1720388080
    },
    {
        "content": "<p>I think the key difference with <a href=\"https://github.com/leanprover-community/mathlib4/pull/14463\">#14463</a> is that it changes the definition. PRs that add lemmas about existing definitions are much easier to review, because theorems can't be wrong in the same way</p>",
        "id": 449725433,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1720388778
    },
    {
        "content": "<p>Tagging contributors for the multiplication proof : <span class=\"user-mention\" data-user-id=\"459227\">@Violeta Hernández</span> <span class=\"user-mention\" data-user-id=\"224323\">@Junyan Xu</span></p>",
        "id": 449725596,
        "sender_full_name": "Ted Hwa",
        "timestamp": 1720388921
    },
    {
        "content": "<p>One easy first split might be the <code>insertLeft</code> definition and the lemmas about it.</p>",
        "id": 449725612,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1720388941
    },
    {
        "content": "<p>(where it might be reasonable to add <code>insertRight</code> at the same time, if others agree)</p>",
        "id": 449725734,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1720389025
    },
    {
        "content": "<p>Instead of saying \"This PR incorporates <a href=\"https://github.com/leanprover-community/mathlib4/pull/14463\">#14463</a>\", you should write \"- [ ] depends on: <a href=\"https://github.com/leanprover-community/mathlib4/pull/14463\">#14463</a>\" in the PR description</p>",
        "id": 449774978,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1720414912
    },
    {
        "content": "<p>Yael, previous discussion was that people were uncomfortable merging that PR without the proof the change was correct being in the same one</p>",
        "id": 449824343,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1720432666
    },
    {
        "content": "<p>Ah sorry I thought this uncomfortability was cleared by the later PR containing the proof</p>",
        "id": 449829073,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1720434127
    },
    {
        "content": "<p>Maybe it now has been</p>",
        "id": 449836268,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1720436332
    },
    {
        "content": "<p>The first split out PR is <a href=\"https://github.com/leanprover-community/mathlib4/pull/14517\">#14517</a> for <code>insertLeft</code> and <code>insertRight</code></p>",
        "id": 449925258,
        "sender_full_name": "Ted Hwa",
        "timestamp": 1720457242
    },
    {
        "content": "<p>Here are the PR's split out so far:</p>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/14517\">#14517</a> - the <code>insertLeft</code> and <code>insertRight</code> lemmas (already mentioned above), which has been reviewed by <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> for code style (thank you!), but he would like someone with more knowledge in the area to check it for any obvious missing lemmas.</p>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/14463\">#14463</a> - corrects the definition of inverse. In the <a href=\"#narrow/stream/287929-mathlib4/topic/Surreal.20inverse.20formula.20in.20mathlib4.20is.20incorrect\">other thread</a>, there now seems to be some agreement that this change is now acceptable because we have a proof that it is correct. But it hasn't gotten any reviews by anyone yet.</p>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/14600\">#14600</a> - a few simple lemmas about Surreal numbers needed in the proof. It's actually a continuation of a previous PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/14278\">#14278</a> which <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> reviewed but then I closed because we weren't sure about whether they should be <code>simp</code> lemmas or not. I removed all the <code>simp</code> in the new PR.  (When I tried to reopen the old PR, github wouldn't let me - I think I messed something up by doing a rebase then force push. Anyway it was easier to just open a new PR.) </p>\n<p>If anyone can review these PRs that would be appreciated.</p>",
        "id": 450345847,
        "sender_full_name": "Ted Hwa",
        "timestamp": 1720587940
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/14517\">#14517</a> seems fine to me, though I'm quite a bit rusted with Lean</p>",
        "id": 450617975,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1720670791
    },
    {
        "content": "<p>Same goes for <a href=\"https://github.com/leanprover-community/mathlib4/pull/14600\">#14600</a></p>",
        "id": 450618548,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1720671044
    },
    {
        "content": "<p>Can't really comment on <a href=\"https://github.com/leanprover-community/mathlib4/pull/14463\">#14463</a>, I haven't worked with surreal division at all <span aria-label=\"frown\" class=\"emoji emoji-1f641\" role=\"img\" title=\"frown\">:frown:</span></p>",
        "id": 450618574,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1720671080
    },
    {
        "content": "<p>Thank you <span class=\"user-mention\" data-user-id=\"459227\">@Violeta Hernández</span> !  I'm not sure, if you need to / have permissions to approve the PRs on github?  If not, can someone else approve based on the above comments?</p>",
        "id": 450868813,
        "sender_full_name": "Ted Hwa",
        "timestamp": 1720756409
    },
    {
        "content": "<p>No, my approval is really just an informal one</p>",
        "id": 450874318,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1720758618
    },
    {
        "content": "<p>I left some naming comments on <a href=\"https://github.com/leanprover-community/mathlib4/pull/14517\">#14517</a>.</p>",
        "id": 451168460,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1720874909
    },
    {
        "content": "<p>I left comments on <a href=\"https://github.com/leanprover-community/mathlib4/pull/14600\">#14600</a>.</p>",
        "id": 451169090,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1720875446
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"459227\">@Violeta Hernández</span> , it may be helpful to look at my comments to see the type of things it is helpful to catch in review. :-)</p>",
        "id": 451169174,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1720875484
    },
    {
        "content": "<p>I pushed a few golfs to  <a href=\"https://github.com/leanprover-community/mathlib4/pull/14517\">#14517</a></p>",
        "id": 451171643,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1720876993
    },
    {
        "content": "<p>Nice!</p>",
        "id": 451172066,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1720877286
    },
    {
        "content": "<p>Thank you <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> and <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> for the reviews! I have made the suggested changes.</p>",
        "id": 451244605,
        "sender_full_name": "Ted Hwa",
        "timestamp": 1720919982
    },
    {
        "content": "<p>When I resolved a merge conflict for the big PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/14498\">#14498</a>, suddenly the CI is failing with this error:</p>\n<p><code>error: ././././Mathlib/SetTheory/Surreal/Division.lean:261:5: unknown tactic</code></p>\n<p>The tactic on that line is <code>ring_nf</code>.  What happened?</p>",
        "id": 451244694,
        "sender_full_name": "Ted Hwa",
        "timestamp": 1720920052
    },
    {
        "content": "<p>Ok when I did <code>import Mathlib.Tactic.Ring.RingNF</code> then it worked. It must have been getting pulled in transitively before.</p>",
        "id": 451245001,
        "sender_full_name": "Ted Hwa",
        "timestamp": 1720920377
    },
    {
        "content": "<p>I updated <a href=\"https://github.com/leanprover-community/mathlib4/pull/14498\">#14498</a> with the above merged PRs (thank you <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> !). However, I am unable to figure out how to fix this error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">././././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">SetTheory</span><span class=\"bp\">/</span><span class=\"n\">Surreal</span><span class=\"bp\">/</span><span class=\"n\">Division</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">811</span><span class=\"o\">:</span><span class=\"mi\">47</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">application</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">mismatch</span>\n<span class=\"w\">  </span><span class=\"n\">Sum</span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"o\">()</span>\n<span class=\"n\">argument</span>\n<span class=\"w\">  </span><span class=\"o\">()</span>\n<span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">PUnit</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_1</span>\n</code></pre></div>\n<p>It seems to be because <code>insertLeft</code> was changed to use <code>Sum.elim</code> instead of <code>match</code>. When I revert to the old definition using <code>match</code>, then everything works. I'm not sure how to fix this apparent universe issue. I tried replacing <code>()</code> by <code>PUnit.unit</code> and it is accepted, but then the subsequent <code>simp</code> does not simplify anymore (it refuses to apply the simp lemma <code>mul_moveLeft_inl</code>).</p>\n<p>Is there a way to fix this or should I revert to the old definition using <code>match</code> ?</p>\n<p>Old definition (uses <code>match</code>):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">insertLeft</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">x'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PGame</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PGame</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">xl</span><span class=\"w\"> </span><span class=\"n\">xr</span><span class=\"w\"> </span><span class=\"n\">xL</span><span class=\"w\"> </span><span class=\"n\">xR</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">xl</span><span class=\"w\"> </span><span class=\"bp\">⊕</span><span class=\"w\"> </span><span class=\"n\">PUnit</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">xr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">i'</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">xL</span><span class=\"w\"> </span><span class=\"n\">i</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"o\">()</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x'</span>\n<span class=\"w\">    </span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">xR</span>\n</code></pre></div>\n<p>New definition (uses <code>Sum.elim</code>):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">insertLeft</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">x'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PGame</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PGame</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">xl</span><span class=\"w\"> </span><span class=\"n\">xr</span><span class=\"w\"> </span><span class=\"n\">xL</span><span class=\"w\"> </span><span class=\"n\">xR</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">xl</span><span class=\"w\"> </span><span class=\"bp\">⊕</span><span class=\"w\"> </span><span class=\"n\">PUnit</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">xr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Sum</span><span class=\"bp\">.</span><span class=\"n\">elim</span><span class=\"w\"> </span><span class=\"n\">xL</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">xR</span>\n</code></pre></div>",
        "id": 451252808,
        "sender_full_name": "Ted Hwa",
        "timestamp": 1720926894
    },
    {
        "content": "<p>The <code>()</code> notation only would for <code>PUnit.{0}</code> (edit: pushed a fix to use Unit instead of PUnit)</p>",
        "id": 451253052,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1720927148
    },
    {
        "content": "<p>My initial reaction to this is that the problem wouldn't exist if you used <code>Option</code> instead of <code>⊕ PUnit</code>!</p>",
        "id": 451253074,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1720927183
    },
    {
        "content": "<p>Not at a computer, but I'd be trying to work out why simp isn't applying that lemma.</p>",
        "id": 451359335,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1720968054
    },
    {
        "content": "<p>My guess would be that you first need to apply a lemma about Sum.elim</p>",
        "id": 451361861,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1720969619
    },
    {
        "content": "<p>I got it to work. I just needed to add <code>Sum.elim_inr</code> to the list of <code>simp only</code> lemmas at the end.  There was no problem with <code>mul_moveLeft_inl</code>.  I must have misread the infoview when I said that. Sorry for wasting everyone's time on this.</p>",
        "id": 451368701,
        "sender_full_name": "Ted Hwa",
        "timestamp": 1720976935
    },
    {
        "content": "<p>No problem. We're all learning!</p>",
        "id": 451378255,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1720987245
    },
    {
        "content": "<p>In your defense the infoview got pretty cluttered mid-proof there. I wonder if we should have syntax highlighting  / bracket matching there to help?</p>",
        "id": 451379776,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1720988836
    },
    {
        "content": "<p>I think I may have gotten confused by the \"Expected type\" section in the infoview (I don't really understand what that is). When the context is long and there are several goals and the \"Expected type\" section shows up, it is easy to scroll too far (looking through the goals) and end up in the \"Expected type\" section thinking that is a goal, since it looks very similar. Then probably I tried a <code>simp</code> and saw nothing changed, so I concluded that the <code>simp</code> didn't work but actually I was looking at the \"Expected type\" which did not change.</p>",
        "id": 451393633,
        "sender_full_name": "Ted Hwa",
        "timestamp": 1721004601
    },
    {
        "content": "<p>This is why it's not a good idea to have several goals :-) The moment there's more than one goal you want to use <code>\\.</code> to get yourself into the situation where instead you have multiple \"threads\" each with one goal. Then you can use <code>sorry</code> to close all the goals which are around other than the one you're working on, and then if you add an <code>_</code> you can be sure that any \"expected type* errors will correspond to the unique error in your code.</p>",
        "id": 451408135,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1721017562
    },
    {
        "content": "<p>I learned that <code>field_simp</code> doesn't actually need a field, and can work when dividing by units in a commutative ring. This simplified the proof a lot since throughout the proof, we are trying to prove we have a field and from the inductive hypothesis, certain elements are already known to be units. Previously I was doing a lot of manipulations by hand.</p>",
        "id": 451839886,
        "sender_full_name": "Ted Hwa",
        "timestamp": 1721157295
    },
    {
        "content": "<p>Hi! I've spent the past week revisiting all of these game files and I think I've got a hang of the API once again</p>",
        "id": 462619823,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1723749052
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 462619874,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1723749062
    },
    {
        "content": "<p>I think it might be a good idea to make a preliminary PR containing only the stuff about <code>normalization</code>. That's the easy prerequisites to the complex calculations, in some sense.</p>",
        "id": 462619942,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1723749089
    },
    {
        "content": "<p>I opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/15779\">#15779</a>, which should hopefully simplify this step a bit</p>",
        "id": 462620018,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1723749116
    }
]