[
    {
        "content": "<p>On current master, when I try to use <code>#where</code>, I get <code>unknown option 'weak.linter.cdot'</code>...</p>",
        "id": 464403221,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1724339080
    },
    {
        "content": "<p>I also have this problem.</p>",
        "id": 464405668,
        "sender_full_name": "Frédéric Dupuis",
        "timestamp": 1724339676
    },
    {
        "content": "<p>Would this help</p>\n<div class=\"codehilite\" data-code-language=\"Diff\"><pre><span></span><code><span class=\"gh\">diff --git a/lakefile.lean b/lakefile.lean</span>\n<span class=\"gh\">index ab4be75c68..afddd69fc6 100644</span>\n<span class=\"gd\">--- a/lakefile.lean</span>\n<span class=\"gi\">+++ b/lakefile.lean</span>\n<span class=\"gu\">@@ -10,7 +10,7 @@ open Lake DSL</span>\n<span class=\"w\"> </span>abbrev mathlibOnlyLinters : Array LeanOption := #[\n<span class=\"w\"> </span>  ⟨`linter.hashCommand, true⟩,\n<span class=\"w\"> </span>  ⟨`linter.missingEnd, true⟩,\n<span class=\"gd\">-  ⟨`linter.cdot, true⟩,</span>\n<span class=\"gi\">+  ⟨`linter.cdot, false⟩,</span>\n<span class=\"w\"> </span>  ⟨`linter.dollarSyntax, true⟩,\n<span class=\"w\"> </span>  ⟨`linter.longLine, true⟩,\n<span class=\"w\"> </span>  ⟨`linter.oldObtain, true,⟩,\n</code></pre></div>",
        "id": 464410263,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1724340633
    },
    {
        "content": "<p>I get the error <code>unknown option 'linter.cdot'</code> instead</p>",
        "id": 464427253,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724344297
    },
    {
        "content": "<p>I added some code to allow it to print unknown options; the result is:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Command</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">autoImplicit</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"c1\">-- set_option linter.cdot true  -- unknown</span>\n<span class=\"c1\">-- set_option linter.dollarSyntax true  -- unknown</span>\n<span class=\"c1\">-- set_option linter.hashCommand true  -- unknown</span>\n<span class=\"c1\">-- set_option linter.longLine true  -- unknown</span>\n<span class=\"c1\">-- set_option linter.missingEnd true  -- unknown</span>\n<span class=\"c1\">-- set_option linter.oldObtain true  -- unknown</span>\n<span class=\"c1\">-- set_option linter.refine true  -- unknown</span>\n<span class=\"c1\">-- set_option linter.setOption true  -- unknown</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">pp</span><span class=\"bp\">.</span><span class=\"n\">unicode</span><span class=\"bp\">.</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"c1\">-- set_option weak.linter.cdot true  -- unknown</span>\n<span class=\"c1\">-- set_option weak.linter.dollarSyntax true  -- unknown</span>\n<span class=\"c1\">-- set_option weak.linter.hashCommand true  -- unknown</span>\n<span class=\"c1\">-- set_option weak.linter.longLine true  -- unknown</span>\n<span class=\"c1\">-- set_option weak.linter.missingEnd true  -- unknown</span>\n<span class=\"c1\">-- set_option weak.linter.oldObtain true  -- unknown</span>\n<span class=\"c1\">-- set_option weak.linter.refine true  -- unknown</span>\n<span class=\"c1\">-- set_option weak.linter.setOption true  -- unknown</span>\n</code></pre></div>",
        "id": 464428774,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724344752
    },
    {
        "content": "<p>This looks kind of wrong... are we sure the lakefile is set up correctly?</p>",
        "id": 464428846,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724344779
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/batteries/pull/932\">batteries#932</a></p>",
        "id": 464430124,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724345233
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> Thanks! I have no idea why that diff helps. Do you think it is worth adding a comment or two?</p>",
        "id": 464450677,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1724350711
    },
    {
        "content": "<p>Apparently, weak options are handled by putting things in the <code>Options</code> struct which are not known to be options, meaning that code which handles options now has to be aware of this and deal with undefined options. My point above is that even after doing so, the results suggest that either lean is incorrectly setting the <code>Options</code> struct, or mathlib's lakefile is misconfigured, because I don't think there are supposed to be options literally containing <code>weak.*</code> in them, that's supposed to be a syntax just for the command line parser AFAIK</p>",
        "id": 464490084,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724365267
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 465186629,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1724679041
    },
    {
        "content": "<p>Is <code>#where</code> broken for everybody or just some of us?</p>",
        "id": 465809873,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1724862558
    },
    {
        "content": "<p>It's also broken for me. <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span> this message if it's broken for you.</p>",
        "id": 465810685,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1724862846
    },
    {
        "content": "<p>If I understand correctly, this has been fixed by Mario in <a href=\"https://github.com/leanprover-community/batteries/pull/932\">batteries#932</a>, but this hasn't been merged yet.</p>",
        "id": 465812359,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1724863473
    },
    {
        "content": "<p>the discussion above is because although it doesn't crash anymore, the new output of <code>#where</code> doesn't look that great</p>",
        "id": 465838655,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724874456
    },
    {
        "content": "<p>but perhaps I should just merge it anyway because this is actually what is in the environment at that point</p>",
        "id": 465838747,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724874486
    }
]