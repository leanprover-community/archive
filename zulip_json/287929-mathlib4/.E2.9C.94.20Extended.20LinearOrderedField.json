[
    {
        "content": "<p>Mathlib defines extended reals:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">EReal</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">WithBot</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithTop</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">Bot</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">One</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nontrivial</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">AddMonoid</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">PartialOrder</span>\n</code></pre></div>\n<p>I define extended rationals:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">ERat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">WithBot</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithTop</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">LinearOrderedAddCommMonoid</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">AddCommMonoidWithOne</span>\n</code></pre></div>\n<p>Would it be possible to generalize — define an extended LinearOrderedField and provide theorems for the extended LinearOrderedField so that whenever a user provides any LinearOrderedField, she will obtain API and results that hold in every extended LinearOrderedField.</p>",
        "id": 451728119,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1721125194
    },
    {
        "content": "<p>You can define <code>WithBotTop</code>, define API for this type, and make exactly one of <code>WithBotTop</code> and <code>EReal</code> semireducible, and the other reducible.</p>",
        "id": 451756287,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1721135702
    },
    {
        "content": "<p>Or you can add more API about <code>WithBot (WithTop R)</code> and duplicate it (with trivial proofs) for each <code>EReal</code>/<code>ERat</code>/<code>EInt</code>.</p>",
        "id": 451756644,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1721135781
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Extended.20LinearOrderedField/near/451756644\">said</a>:</p>\n<blockquote>\n<p>Or you can add more API about <code>WithBot (WithTop R)</code> and duplicate it (with trivial proofs) for each <code>EReal</code>/<code>ERat</code>/<code>EInt</code>.</p>\n</blockquote>\n<p>This wouldn't work for me because I want to claim results about all extended <code>LinearOrderedField</code>s, not only about the most important instances.</p>",
        "id": 451762010,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1721137402
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Extended.20LinearOrderedField/near/451756287\">said</a>:</p>\n<blockquote>\n<p>You can define <code>WithBotTop</code>, define API for this type, and make exactly one of <code>WithBotTop</code> and <code>EReal</code> semireducible, and the other reducible.</p>\n</blockquote>\n<p>Would I be then able to prove theorems like the following?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">myTheorem</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LinearOrderedField</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithBotTop</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 451762169,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1721137440
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"417654\">Martin Dvořák</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Extended.20LinearOrderedField/near/451762010\">said</a>:</p>\n<blockquote>\n<p>I want to claim results about all extended <code>LinearOrderedField</code>s</p>\n</blockquote>\n<p>How many use cases do you envision?</p>",
        "id": 451767316,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1721138866
    },
    {
        "content": "<p>The only practical use case for me is extended rational. However, for an academic publication, I would like to provide the most general version.</p>",
        "id": 451767483,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1721138913
    },
    {
        "content": "<p>But do you have any case?</p>",
        "id": 451767782,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1721139009
    },
    {
        "content": "<p>I don't have a use case beyond extended rationals. The extended <code>LinearOrderedField</code> would be only for presentation of results.</p>",
        "id": 451768019,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1721139088
    },
    {
        "content": "<p>You can state your results for <code>WithBot (WithTop R)</code>.</p>",
        "id": 451908873,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1721180594
    },
    {
        "content": "<p>Would it be better to use <code>WithBotTop</code> as you <span class=\"user-mention\" data-user-id=\"214703\">@Yury G. Kudryashov</span> suggested previously?</p>",
        "id": 451965561,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1721200344
    },
    {
        "content": "<p>Do you want to make it reducible or semi reducible?</p>",
        "id": 452057300,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1721219253
    },
    {
        "content": "<p>Probably semireducible, but I don't know enough at this moment to make an informed decision now.</p>",
        "id": 452057933,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1721219475
    },
    {
        "content": "<p>Huge thanks to <span class=\"user-mention\" data-user-id=\"395550\">@Henrik Böving</span> for major advice!</p>\n<p>I will go with the following definition:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Extend</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LinearOrderedField</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">WithBot</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithTop</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LinearOrderedField</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LinearOrderedAddCommMonoid</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Extend</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">inferInstanceAs</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">LinearOrderedAddCommMonoid</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithBot</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithTop</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)))</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AddCommMonoidWithOne</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Extend</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">inferInstanceAs</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">AddCommMonoidWithOne</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithBot</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithTop</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)))</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ZeroLEOneClass</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Extend</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstanceAs</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ZeroLEOneClass</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithBot</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithTop</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)))</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CharZero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Extend</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstanceAs</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">CharZero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithBot</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithTop</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)))</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BoundedOrder</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Extend</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstanceAs</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">BoundedOrder</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithBot</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithTop</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)))</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DenselyOrdered</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Extend</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstanceAs</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">DenselyOrdered</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithBot</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithTop</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)))</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DecidableRel</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Extend</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Extend</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">WithBot</span><span class=\"bp\">.</span><span class=\"n\">decidableLT</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">coe</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">toE</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Extend</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">some</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Extend</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">toE</span><span class=\"bp\">⟩</span>\n</code></pre></div>",
        "id": 452136737,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1721236533
    },
    {
        "content": "<p><code>Extend</code> shouldn't assume <code>LinearOrderedField</code>.</p>",
        "id": 452143618,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1721238054
    },
    {
        "content": "<p>Where would you start?</p>",
        "id": 452143680,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1721238082
    },
    {
        "content": "<p>You can</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Extend</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">WithBot</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithTop</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>then assume relevant typeclasses about <code>F</code> to add instances/prove theorems about <code>Extend F</code>.</p>",
        "id": 452143785,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1721238127
    },
    {
        "content": "<p>Since I removed all those <code>deriving</code> I could right away define <code>Extend</code> for literally any type and only assume what I need to assume later.</p>",
        "id": 452143815,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1721238142
    },
    {
        "content": "<p>Then you can turn <code>EReal</code> into a reducible definition for <code>Extend Real</code> (note: if you're going to PR it to Mathlib, then <code>WithBotTop</code> has more chances to be accepted as a name, because <code>Extend</code> is too generic).</p>",
        "id": 452143996,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1721238224
    },
    {
        "content": "<p>E.g., you should make sure that all the lemmas that don't involve division work for <code>Extend Int</code>.</p>",
        "id": 452144122,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1721238275
    },
    {
        "content": "<p>I will never PR it to Mathlib, because my <code>Extend</code> is going to do some nonstandard things.</p>",
        "id": 452144127,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1721238277
    },
    {
        "content": "<p>Then you don't have to worry about Mathlib naming conventions etc.</p>",
        "id": 452144254,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1721238310
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"417654\">Martin Dvořák</span> has marked this topic as resolved.</p>",
        "id": 452576692,
        "sender_full_name": "Notification Bot",
        "timestamp": 1721397598
    }
]