[
    {
        "content": "<p>It looks like in <a href=\"https://github.com/leanprover-community/mathlib4/pull/17341\">#17341</a> I ran into an instance of missing cache invalidation. In the first commit, one file failed due to a linter warning. I modified one of the nolint files (<code>no_lints_prime_decls.txt</code>) to fix this, but it seems not to be included in Lake's list of build inputs. Thus, even after the change the file is replayed from cache and the build continues to fail. What should I do to fix this?</p>",
        "id": 474156179,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1727830819
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span>, could you advise here?</p>",
        "id": 474158641,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1727831804
    },
    {
        "content": "<p>My suggestion would be to add the no lint files as a <code>target</code> (via <code>inputTextFile</code>) and an <code>extraDepTargets</code> of the relevant libaries (or the whole package). For example, something like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">no_lints</span><span class=\"w\"> </span><span class=\"n\">pkg</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">noLintFiles</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span>\n<span class=\"w\">    </span><span class=\"n\">pkg.dir</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"s2\">\"scripts\"</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"s2\">\"no_lints_prime_decls.txt\"</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">pkg.dir</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"s2\">\"scripts\"</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"s2\">\"nolints-style.txt\"</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">pkg.dir</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"s2\">\"scripts\"</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"s2\">\"nolints.json\"</span>\n<span class=\"w\">  </span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">BuildJob.mixArray</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">â†</span><span class=\"w\"> </span><span class=\"n\">noLintFiles.mapM</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">inputTextFile</span><span class=\"w\"> </span><span class=\"bp\">Â·</span><span class=\"o\">))</span>\n\n<span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">extraDepTargets</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">{</span><span class=\"ss\">`no_lints</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 474170732,
        "sender_full_name": "Mac Malone",
        "timestamp": 1727836800
    },
    {
        "content": "<p>Why not add a docstring instead?</p>",
        "id": 474170872,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1727836819
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"214703\">@Yury G. Kudryashov</span> as in, obey the lint? The lemma in question is</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kd\">lemma</span><span class=\"w\"> </span><span class=\"n\">coe_mk'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">carrier</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hâ‚</span><span class=\"w\"> </span><span class=\"n\">hâ‚‚</span><span class=\"w\"> </span><span class=\"n\">hâ‚ƒ</span><span class=\"w\"> </span><span class=\"n\">hâ‚„</span><span class=\"w\"> </span><span class=\"n\">hâ‚…</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">mk'</span><span class=\"w\"> </span><span class=\"n\">carrier</span><span class=\"w\"> </span><span class=\"n\">hâ‚</span><span class=\"w\"> </span><span class=\"n\">hâ‚‚</span><span class=\"w\"> </span><span class=\"n\">hâ‚ƒ</span><span class=\"w\"> </span><span class=\"n\">hâ‚„</span><span class=\"w\"> </span><span class=\"n\">hâ‚…</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">carrier</span>\n</code></pre></div>\n<p>which I feel doesn't really deserve a docstring. Also, even though this particular issue can be fixed this way, the issue of overzealous caching would remain.</p>",
        "id": 474172020,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1727837120
    }
]