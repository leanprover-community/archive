[
    {
        "content": "<p><code>Order.Preimage</code> is identical to <code>Function.onFun</code> up to a <code>Function.swap</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"n\">Î²</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Î²</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î²</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Î²</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">Preimage</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">onFun</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>Is this duplication necessary? <code>Function.onFun</code> has a lot more API.<br>\nI know it has instances for relation properties (e.g. <code>Std.Symm s â†’ Std.Symm (Order.Preimage f s)</code>), but I'd like those for <code>Function.onFun</code> as well (<a href=\"https://github.com/leanprover-community/mathlib4/pull/35622\">#35622</a>).</p>",
        "id": 576133996,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1772144591
    },
    {
        "content": "<p>The duplication here - in fact triplication with InvImage - is a bugbear of mine, I'm very much in favour of cleaning it all up.</p>",
        "id": 576134355,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1772144766
    },
    {
        "content": "<p>what's the point of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Function.onFun#doc\">docs#Function.onFun</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Function.dcomp#doc\">docs#Function.dcomp</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Function.swap#doc\">docs#Function.swap</a></p>",
        "id": 576134874,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1772144963
    },
    {
        "content": "<p>it feels like a lot of work in comparison to just writing out a lambda</p>",
        "id": 576134906,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1772144978
    },
    {
        "content": "<p>though <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Order.Preimage#doc\">docs#Order.Preimage</a> I can understand as it's the right adjoint to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Relation.Map#doc\">docs#Relation.Map</a></p>",
        "id": 576135043,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1772145025
    },
    {
        "content": "<p>though it would be nice if it also supported heterogeneous relations like <code>Relation.Map</code></p>",
        "id": 576135290,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1772145125
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60Order.2EPreimage.60.20vs.20.60Function.2EonFun.60/near/576135043\">said</a>:</p>\n<blockquote>\n<p>though <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Order.Preimage#doc\">docs#Order.Preimage</a> I can understand as it's the right adjoint to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Relation.Map#doc\">docs#Relation.Map</a></p>\n</blockquote>\n<p>But there are 0 matches on Loogle for <code>Order.Preimage, Relation.Map</code>.<br>\nCompare that to 7 matches for <code>Function.onFun, Relation.Map</code> (from my <a href=\"https://github.com/leanprover-community/mathlib4/pull/30416\">#30416</a> <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span>)</p>",
        "id": 576135477,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1772145203
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60Order.2EPreimage.60.20vs.20.60Function.2EonFun.60/near/576134906\">said</a>:</p>\n<blockquote>\n<p>it feels like a lot of work in comparison to just writing out a lambda</p>\n</blockquote>\n<p>You're claiming that <code>fun x y â†¦ r (f x) (f y)</code> is better/easier than <code>(r on f)</code>? I disagree</p>",
        "id": 576135685,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1772145280
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"933054\">Snir Broshi</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60Order.2EPreimage.60.20vs.20.60Function.2EonFun.60/near/576135477\">said</a>:</p>\n<blockquote>\n<p>But there are 0 matches on Loogle for <code>Order.Preimage, Relation.Map</code>.<br>\nCompare that to 7 matches for <code>Function.onFun, Relation.Map</code> (from my <a href=\"https://github.com/leanprover-community/mathlib4/pull/30416\">#30416</a> <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span>)</p>\n</blockquote>\n<p>yeah the API is really lacking in this area</p>",
        "id": 576135889,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1772145328
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"933054\">Snir Broshi</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60Order.2EPreimage.60.20vs.20.60Function.2EonFun.60/near/576135685\">said</a>:</p>\n<blockquote>\n<p>You're claiming that <code>fun x y â†¦ r (f x) (f y)</code> is better/easier than <code>(r on f)</code>? I disagree</p>\n</blockquote>\n<p>I claim it's better because we don't have to have another definition <code>Function.onFun</code></p>",
        "id": 576136490,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1772145460
    },
    {
        "content": "<p>if the <code>on</code> was purely syntax sugar would also be fine</p>",
        "id": 576136550,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1772145474
    },
    {
        "content": "<p>I believe having standard ways of spelling these common combinators is useful.<br>\ne.g. you'd be hard-pressed getting mathematicians to write <code>Î» x. f (g x)</code> instead of <code>f âˆ˜ g</code>.</p>",
        "id": 576137416,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1772145711
    },
    {
        "content": "<p>i mean... i sometimes do write <code>(f &lt;| g .)</code>...</p>",
        "id": 576145596,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1772150275
    },
    {
        "content": "<p>I raised this same issue about a year ago: <a class=\"message-link\" href=\"/#narrow/channel/287929-mathlib4/topic/InvImage.20instances/near/500149757\">#mathlib4 &gt; InvImage instances @ ðŸ’¬</a> <br>\nSuffice to say I'd love to see us standardize a single spelling.</p>",
        "id": 576165391,
        "sender_full_name": "Violeta HernÃ¡ndez",
        "timestamp": 1772159724
    },
    {
        "content": "<p>I'd personally vote for <code>InvImage</code>. <code>Order.Preimage</code> is barely used, and <code>Function.onFun</code> has always striked me as both very confusing syntax and naming (what does it mean to have a relation on a function? is this a thing mathematicians actually say?)</p>",
        "id": 576165510,
        "sender_full_name": "Violeta HernÃ¡ndez",
        "timestamp": 1772159822
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"459227\">Violeta HernÃ¡ndez</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60Order.2EPreimage.60.20vs.20.60Function.2EonFun.60/near/576165510\">said</a>:</p>\n<blockquote>\n<p>is this a thing mathematicians actually say?)</p>\n</blockquote>\n<p>I think \"induced by\" is the common nomenclature, e.g. for <code>f : Î± â†’ â„•</code>, <code>LT.lt on f</code> is the order induced on <code>Î±</code> by <code>f</code></p>",
        "id": 576165722,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1772159987
    },
    {
        "content": "<p>But <code>onFun</code> has the most general signature, <code>InvImage</code> only supports <code>Prop</code> so it's a no-go.</p>",
        "id": 576165790,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1772160031
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Function.onFun#doc\">docs#Function.onFun</a> | <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Order.Preimage#doc\">docs#Order.Preimage</a> | <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=InvImage#doc\">docs#InvImage</a></p>",
        "id": 576165890,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1772160106
    },
    {
        "content": "<p>Well, <code>on</code> wouldn't be the only idiosyncratically named basic object in the language (<code>Iff.mp</code>, <code>Iff.mpr</code>). I guess I can live with it if it means getting rid of the triplication.</p>",
        "id": 576166067,
        "sender_full_name": "Violeta HernÃ¡ndez",
        "timestamp": 1772160257
    },
    {
        "content": "<p>My only interaction with these is via <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=InvImage.wf#doc\">docs#InvImage.wf</a> anyways. Give me an <code>onFun</code> version and I'll be happy.</p>",
        "id": 576166146,
        "sender_full_name": "Violeta HernÃ¡ndez",
        "timestamp": 1772160309
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"459227\">Violeta HernÃ¡ndez</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60Order.2EPreimage.60.20vs.20.60Function.2EonFun.60/near/576166067\">said</a>:</p>\n<blockquote>\n<p>Well, <code>on</code> wouldn't be the only idiosyncratically named basic object in the language (<code>Iff.mp</code>, <code>Iff.mpr</code>).</p>\n</blockquote>\n<p>modus ponens and modus ponens reverse?</p>",
        "id": 576166318,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1772160421
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"459227\">Violeta HernÃ¡ndez</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60Order.2EPreimage.60.20vs.20.60Function.2EonFun.60/near/576166146\">said</a>:</p>\n<blockquote>\n<p>My only interaction with these is via <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=InvImage.wf#doc\">docs#InvImage.wf</a> anyways. Give me an <code>onFun</code> version and I'll be happy.</p>\n</blockquote>\n<p>Oh no why is everything in core <span aria-label=\"cold sweat\" class=\"emoji emoji-1f630\" role=\"img\" title=\"cold sweat\">:cold_sweat:</span></p>",
        "id": 576166349,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1772160440
    },
    {
        "content": "<p>That tends to be the problem with a lot of these types of refactors.</p>",
        "id": 576166390,
        "sender_full_name": "Violeta HernÃ¡ndez",
        "timestamp": 1772160453
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60Order.2EPreimage.60.20vs.20.60Function.2EonFun.60/near/576136490\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"933054\">Snir Broshi</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60Order.2EPreimage.60.20vs.20.60Function.2EonFun.60/near/576135685\">said</a>:</p>\n<blockquote>\n<p>You're claiming that <code>fun x y â†¦ r (f x) (f y)</code> is better/easier than <code>(r on f)</code>? I disagree</p>\n</blockquote>\n<p>I claim it's better because we don't have to have another definition <code>Function.onFun</code></p>\n</blockquote>\n<p>One reason to use <code>onFun</code> or a similar function is that you write <code>f</code> only once in <code>r on f</code>.</p>",
        "id": 576171883,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1772164066
    },
    {
        "content": "<blockquote>\n<p>(what does it mean to have a relation on a function? is this a thing mathematicians actually say?)</p>\n</blockquote>\n<p>I think it's more of a functional programming thing... I first encountered it <a href=\"https://hackage-content.haskell.org/package/base-4.22.0.0/docs/Data-Function.html#v:on\">in Haskell</a></p>\n<p>the Haskell docs explain the wording as \"running the binary function <code>b</code> <em>on</em> the results of applying unary function <code>u</code> to two arguments <code>x</code> and <code>y</code>\"</p>\n<p>another angle: one of the examples in the Haskell docs is comparing two things \"on\" a property, and we have a <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=compareOn#doc\">docs#compareOn</a> function that follows this phrasing</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Logic</span><span class=\"bp\">.</span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">Defs</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Function</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"n\">Î²</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ord</span><span class=\"w\"> </span><span class=\"n\">Î²</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Î²</span><span class=\"o\">)</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">compareOn</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">compare</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>",
        "id": 576305434,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1772210618
    }
]