[
    {
        "content": "<p>I found that Mathlib doesn't seem to have a computable version of ^-1 for ℝ, so I wrote <a href=\"https://gist.github.com/linuxmetel/56976fa57d699c4752ed116bb6fc1a81\">one</a> myself. If I make it into a pull request, would such a trivial (and probably unnecessary) contribution be welcomed?<br>\n(It's my first post here, so if I've sent it to the wrong place, please let me know)</p>",
        "id": 547066994,
        "sender_full_name": "Linuxmetel",
        "timestamp": 1761408182
    },
    {
        "content": "<p>I don't know how much the people involved in Mathlib development care about computability.</p>",
        "id": 547067253,
        "sender_full_name": "Linuxmetel",
        "timestamp": 1761408473
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"982095\">@Linuxmetel</span> first of all, welcome to lean, and well done on writing the code, so please don't let the following deter you:</p>\n<ol>\n<li>as you've observed you have a partial function here because you need the input to be nonzero, while in Mathlib we've adopted the convention that the inverse function in a field should be total and send 0 to 0, this is to prevent the statements from blowing up in complexity because you would have to write a proof every time you want to say the inverse</li>\n<li>and as you might know it's impossible to extend it to a total function computably because all computable functions are continuous</li>\n<li>and as you've observed, mathlib doesn't particularly care about computability, and this isn't a trivial replacement (because of it being a partial function)</li>\n</ol>",
        "id": 547067443,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761408684
    },
    {
        "content": "<p>(i'm not affiliated to mathlib officially, but i'm reasonably confident that that would be the opinion of mathlib)</p>",
        "id": 547067453,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761408697
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span> Thank you for your reply. So when I use Lean, don't I need to hesitate to mark definitions as uncomputable?</p>\n<p>The case I came across is some function I was writing that uses the value of <code>x / ‖x‖</code> for <code>x ≠ 0</code> in some normed space. The Lean processor said it should be marked uncomputable, but I believed it is computable. But I couldn't find such a version of inversion in Mathlib, so I was wondering why that is.</p>",
        "id": 547068162,
        "sender_full_name": "Linuxmetel",
        "timestamp": 1761409515
    },
    {
        "content": "<p>that's because we like total functions over removing the noncomputability tag</p>",
        "id": 547068182,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761409545
    },
    {
        "content": "<p>to make <code>/</code> total it has to be noncomputable</p>",
        "id": 547068185,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761409551
    },
    {
        "content": "<p>I don't think they observed \"mathlib doesn't particularly care about computability\", I think they're asking how much the mathlib devs care about computability, but the answer is that this is not a high priority issue in mathlib and your PR is unlikely to be merged.</p>",
        "id": 547068356,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761409725
    },
    {
        "content": "<p>Thank you for your replies. I know total functions are better when you do normal analysis or algebra, but I might care about it too much when I write some codes that I intend to use in multiple places.</p>",
        "id": 547068464,
        "sender_full_name": "Linuxmetel",
        "timestamp": 1761409861
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"982095\">@Linuxmetel</span> computability matters if you want to <code>#reduce</code> or <code>#eval</code> it, which I argue is the wrong thing to do (the correct thing to do is to set up simp lemmas and tactics such as <code>norm_num</code>)</p>",
        "id": 547068526,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761409903
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">norm_num</span>\n</code></pre></div>",
        "id": 547068558,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761409934
    },
    {
        "content": "<p>for example, the tactic <code>norm_num</code> can compute 144/7 here without ever needing computability</p>",
        "id": 547068568,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761409948
    },
    {
        "content": "<p>I think a computable implementation for partial division on reals is already in mathlib</p>",
        "id": 547068704,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761410130
    },
    {
        "content": "<p>the just put a noncomputable check for zero in front of it and mark the whole thing noncomputable</p>",
        "id": 547068715,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761410154
    },
    {
        "content": "<blockquote>\n<p>computability matters if you want to <code>#reduce</code> or <code>#eval</code> it,</p>\n</blockquote>\n<p>I think computability matters because it guarantees constructivity, rather than because you actually want to evaluate it. But I know some people care about it while others don't.</p>",
        "id": 547068754,
        "sender_full_name": "Linuxmetel",
        "timestamp": 1761410188
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Computable.20version.20of.20.5E-1.20for.20.E2.84.9D/near/547068704\">said</a>:</p>\n<blockquote>\n<p>I think a computable implementation for partial division on reals is already in mathlib</p>\n</blockquote>\n<p>I couldn't find one. Mathlib includes that for <code>CauSeq</code> (<a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Order/CauSeq/Basic.html#CauSeq.inv\">CauSeq.inv</a>), but it seems not for <code>CauSeq.Completion.Cauchy</code> and <code>Real</code>.</p>",
        "id": 547068856,
        "sender_full_name": "Linuxmetel",
        "timestamp": 1761410319
    },
    {
        "content": "<p>If you look at <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CauSeq.Completion.instInvCauchy#src\">src#CauSeq.Completion.instInvCauchy</a> it's computable except for the part where it tests zero</p>",
        "id": 547068890,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761410367
    },
    {
        "content": "<p>You may be able to \"extract\" computable part from it, but I think it is a little troublesome in that such a function need to receive the proof of <code>x ≠ 0</code> after lift along the equivalence relation. Still I wrote my version from scratch using <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Order/CauSeq/Basic.html#CauSeq.inv\"><code>CauSeq.inv</code></a> rather than extract from it.</p>",
        "id": 547069113,
        "sender_full_name": "Linuxmetel",
        "timestamp": 1761410692
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"982095\">@Linuxmetel</span> could you share a little bit more context? what did you \"intend to use\" with this computable partial inverse?</p>",
        "id": 547069221,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761410831
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span> I wanted to construct the natural homeomorphism</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msup><mi>S</mi><mi>n</mi></msup><mo>×</mo><msub><mi mathvariant=\"bold\">R</mi><mrow><mo>&gt;</mo><mn>0</mn></mrow></msub><mo>→</mo><msup><mi mathvariant=\"bold\">R</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msup><mo>∖</mo><mo stretchy=\"false\">{</mo><mn>0</mn><mo stretchy=\"false\">}</mo><mo separator=\"true\">,</mo></mrow><annotation encoding=\"application/x-tex\">S^n \\times \\mathbf{R}_{&gt; 0} \\to \\mathbf{R}^{n+1} \\setminus \\{0\\},</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7977em;vertical-align:-0.0833em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7144em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8635em;vertical-align:-0.1774em;\"></span><span class=\"mord\"><span class=\"mord mathbf\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mrel mtight\">&gt;</span><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1774em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1141em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathbf\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∖</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord\">0</span><span class=\"mclose\">}</span><span class=\"mpunct\">,</span></span></span></span></span></p>\n<p>and I just hesitated to mark such a simple mapping as uncomputable. However, it is something I don't need to worry about in Lean, I am ok to mark it.</p>",
        "id": 547069412,
        "sender_full_name": "Linuxmetel",
        "timestamp": 1761411096
    },
    {
        "content": "<p>the forward direction you sent should be computable</p>",
        "id": 547069587,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761411294
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"982095\">Linuxmetel</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Computable.20version.20of.20.5E-1.20for.20.E2.84.9D/near/547068754\">said</a>:</p>\n<blockquote>\n<p>I think computability matters because it guarantees constructivity</p>\n</blockquote>\n<p>also, computable functions can (and do) still use <code>Classical.choice</code></p>",
        "id": 547069618,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761411317
    },
    {
        "content": "<p>Is there not also <code>#norm_num</code>?</p>",
        "id": 547069634,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1761411335
    },
    {
        "content": "<p><code>Homeomorph</code> requires to construct InvFun, so ...</p>",
        "id": 547069680,
        "sender_full_name": "Linuxmetel",
        "timestamp": 1761411396
    },
    {
        "content": "<p>If you care about constructivity then you should forget Mathlib completely and you'll live a happier life.</p>",
        "id": 547069761,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1761411491
    },
    {
        "content": "<p>It should be possible to computably define the inverse with domain <code>{x : ℝ // x ≠ 0}</code>. I'm somewhat skeptical that this would be accepted into Mathlib, however.</p>",
        "id": 547072092,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1761414004
    },
    {
        "content": "<p>Oh, this is what you did! I thought that people were saying that you made a <code>partial def</code>.</p>",
        "id": 547074252,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1761416283
    },
    {
        "content": "<p>See also <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=divp#doc\">docs#divp</a></p>",
        "id": 547074287,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1761416328
    },
    {
        "content": "<p>I think it would be totally reasonable to accept a PR to mathlib that split out the computable part of <a href=\"https://github.com/leanprover-community/mathlib4/blob/aa1b475dc183aa4e2f541bea5bff747c5963fec2/Mathlib/Algebra/Order/CauSeq/Completion.lean#L194-L206\">https://github.com/leanprover-community/mathlib4/blob/aa1b475dc183aa4e2f541bea5bff747c5963fec2/Mathlib/Algebra/Order/CauSeq/Completion.lean#L194-L206</a> into <code>Cauchy.inv0</code> or similar if that's useful to you, especially as the this wouldn't really affect the complexity of the code.</p>",
        "id": 547086958,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1761432488
    },
    {
        "content": "<p>But certainly mathlib (rightly) doesn't care enough about computability of Reals (which is mostly useless in it's current form anyway) to change how division works elsewhere</p>",
        "id": 547086992,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1761432545
    },
    {
        "content": "<p>(such an <code>def inv0</code> would be a nice place to park a docstring explaining why we don't attempt to propagate the computability to Real)</p>",
        "id": 547087049,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1761432639
    },
    {
        "content": "<p>Yeah, invertibility of reals /as cauchy sequences/ is \"useless\" in a mathematically precise way: the only computable predicates of reals are the constants True and False, sort of a Rice's theorem for numerics. So there is, in a strict sense, nothing gained by making an operation computable or not. (Nothing besides not writing \"noncomputable\", or maybe scratching a philosophical itch.)</p>\n<p>If reals are built from sequences of intervals / Dedekind cuts (as <code>Rat -&gt; Bool</code>) / Cauchy sequences with some guarantee on convergence rate, then some things are computable, so then this could have a material benefit.</p>",
        "id": 547091969,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1761439470
    }
]