[
    {
        "content": "<p>Hi everyone! So this tactic <code>norm_numI</code> that <span class=\"user-mention\" data-user-id=\"476523\">@Sidharth Hariharan</span> , <span class=\"user-mention\" data-user-id=\"260507\">@Heather Macbeth</span>  and I have been working is soon going to be PRed into mathlib, so I think it's best to let everyone check if this is what they'd want <code>norm_num</code> to do. </p>\n<p>So currently, what it DOES handle:</p>\n<ul>\n<li><code>ofNat n</code>: Natural numbers coerced to complex;</li>\n<li><code>z1 + z2</code>: Addition of complexes;</li>\n<li><code>z1 * z2</code>: Multiplication of complexes;</li>\n<li><code>z⁻¹</code>: Inverse of complexes;</li>\n<li><code>z1/z2</code>: Division of complexes;</li>\n<li><code>-z</code>: Negation of complexes;</li>\n<li><code>z1 - z2</code>: Subtraction of complexes;</li>\n<li><code>conj z</code>: Conjugation of complexes;</li>\n<li><code>@HPow.hPow ℂ ℕ ℂ</code>: Natural exponents of  complexes, e.g. <code>z^(2 + 3)</code> ;</li>\n<li><code>@HPow.hPow ℂ ℤ ℂ</code>: Integral exponents of complexes, e.g. <code>z^(-1-2*3 : ℤ)</code>;</li>\n<li>Scientific expressions of complexes; e.g. <code>(0.25 : ℂ) + (0.25 : ℂ)</code>.</li>\n</ul>\n<p>And currently it DOES NOT handle : </p>\n<ul>\n<li>free variables in complexes, e.g. <code>x y : ℂ, x * I = y * I</code> for <code>x = y</code></li>\n<li>constructor mode in complexes, e.g <code>⟨1, 0⟩ + ⟨38, 0⟩ - 1 = (⟨37, 0⟩ : ℂ)</code></li>\n</ul>\n<p>I will soon post the PR number once we PR this, in the mean time, feel free to let us know whether you think this is enough/not enough for <code>norm_numI</code> in complexes, your advice will be valued and appreciated, thanks!</p>",
        "id": 523585657,
        "sender_full_name": "Edison Xie",
        "timestamp": 1749655319
    },
    {
        "content": "<p>Here's a few more additions, in order of difficulty:</p>\n<ul>\n<li><code>Nat.cast</code></li>\n<li><code>Int.cast</code></li>\n<li><code>Rat.cast</code></li>\n<li><code>smul</code> from <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Complex.module#doc\">docs#Complex.module</a></li>\n<li>Complex powers of complex numbers, when the power turns out to be an integer</li>\n<li><code>NNRat.cast</code></li>\n</ul>",
        "id": 523598204,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749659349
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"699016\">Edison Xie</span> <a href=\"#narrow/channel/287929-mathlib4/topic/NormNumI/near/523585657\">said</a>:</p>\n<blockquote>\n<ul>\n<li>free variables in complexes, e.g. <code>x y : ℂ, x * I = y * I</code> for <code>x = y</code></li>\n</ul>\n</blockquote>\n<p>I'm pretty sure that this is explicitly out of scope for <code>norm_num</code>, so this seems like a good thing</p>",
        "id": 523598430,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749659431
    },
    {
        "content": "<p>This is great! I'd like to see more extensions to <code>norm_num</code>!</p>",
        "id": 523728791,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1749725170
    },
    {
        "content": "<p>I'm a bit worried about the number of new tactics we're introducing. I think it would be much better if we have fewer tactics that do more themselves. </p>\n<p>Would it be possible to incorporate this into <code>norm_num</code>? This  will require changing some hard-coded internal data-structures of <code>norm_num</code> (I don't know if it would be feasible to make that more extensible?)</p>",
        "id": 523729223,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1749725307
    },
    {
        "content": "<p>I'd advocate for a separate tactic with a TODO comment for now</p>",
        "id": 523729468,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749725384
    },
    {
        "content": "<p>I'm perfectly happy with that.</p>",
        "id": 523729571,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1749725428
    },
    {
        "content": "<p>Making norm_num extensible over types is a really hard problem I think</p>",
        "id": 523729605,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749725438
    },
    {
        "content": "<p>I was afraid that would be the case... It would be nice if it could also represent lists and list-like types (Finset)</p>",
        "id": 523729721,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1749725480
    },
    {
        "content": "<p>I think that's squarely in the \"this should be a simproc\" scope creep territory</p>",
        "id": 523729766,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749725499
    },
    {
        "content": "<p>Even supporting <code>Complex</code> in norm_num without also supporting GaussianInt (or other quadratic extensions) seems like something we should try to avoid</p>",
        "id": 523729873,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749725538
    },
    {
        "content": "<p>I'd definitely also be happy if <code>simp</code> can simplify those kinds of things.</p>",
        "id": 523730074,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1749725611
    },
    {
        "content": "<p>Note that the proposed norm_numI already partially integrates into norm_num; it can register an extension for (in)equalities of complex numbers, but can't simplify complex numerals that don't participate in a comparison.</p>",
        "id": 523730493,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749725747
    },
    {
        "content": "<p>Should the tactic be called <code>norm_num_complex</code> or <code>norm_num_I</code> or <code>norm_num +complex</code>? (where the latter is an unrelated syntax that happens to start with the same word)</p>",
        "id": 523730682,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749725812
    },
    {
        "content": "<p>I think currently we have our tactic as a <code>norm_num</code> extension already? <span class=\"user-mention\" data-user-id=\"476523\">@Sidharth Hariharan</span> what's the current state of it :-)</p>",
        "id": 523914474,
        "sender_full_name": "Edison Xie",
        "timestamp": 1749809660
    },
    {
        "content": "<p>When I checked it was an extension for equality only, but that won't help with simplifying <code>cexp (I*I)</code> to <code>cexp (-1)</code></p>",
        "id": 523915084,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749809889
    },
    {
        "content": "<p>As it stands, we have</p>\n<ol>\n<li>a <code>conv</code> tactic called <code>norm_numI</code></li>\n<li>a <code>norm_num</code> extension that integrates the parsing and normalisation procedures of <code>norm_numI</code> into <code>norm_num</code></li>\n</ol>\n<p>I am exploring how it can be made into a separate tactic, but the advice I've gotten so far is that we should make it a simproc as well as a <code>norm_num</code> extension. (I don't know how to make it into a simproc, but I'd love to learn!)</p>",
        "id": 523915088,
        "sender_full_name": "Sidharth Hariharan",
        "timestamp": 1749809892
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"476523\">Sidharth Hariharan</span> <a href=\"#narrow/channel/287929-mathlib4/topic/NormNumI/near/523915088\">said</a>:</p>\n<blockquote>\n<p>but the advice I've gotten so far</p>\n</blockquote>\n<p>To clarify the advice I gave, for others; I think we should get a version merged that uses some combinations of norm_num extensions and simprocs, and then think about a standalone version / integration into norm_num's internals after that.</p>",
        "id": 523915506,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749810079
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/NormNumI/near/523915506\">said</a>:</p>\n<blockquote>\n<p>I think we should get a version merged that uses some combinations of norm_num extensions and simprocs</p>\n</blockquote>\n<p>I think it would be fine to merge even less, namely what they have now: the <code>norm_num</code> extension that handles complex (dis)equalities, plus the new <code>conv</code> tactic <code>norm_numI</code>.</p>\n<p>For tasks like simplifying <code>cexp (I*I)</code>, it's less user-friendly to require the user to build a <code>conv =&gt; .... norm_numI</code> than to have a simproc find the location automatically, but it's perfectly workable (and, in my opinion, mergeable).</p>",
        "id": 523924411,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1749813373
    },
    {
        "content": "<p>I think the simproc is probably on the order of 5 lines of code calling what they already have, which I could probably suggest in the review!</p>",
        "id": 523925824,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749813905
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/NormNumI/near/523598204\">said</a>:</p>\n<blockquote>\n<ul>\n<li><code>smul</code> from <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Complex.module#doc\">docs#Complex.module</a><br>\n</li>\n</ul>\n</blockquote>\n<p>do you mean <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Complex.instModule%3F#doc\">docs#Complex.instModule?</a></p>",
        "id": 523952138,
        "sender_full_name": "Edison Xie",
        "timestamp": 1749823082
    },
    {
        "content": "<p>a PR has been made! <a href=\"https://github.com/leanprover-community/mathlib4/pull/26975\">#26975</a></p>",
        "id": 528132855,
        "sender_full_name": "Edison Xie",
        "timestamp": 1752169653
    }
]