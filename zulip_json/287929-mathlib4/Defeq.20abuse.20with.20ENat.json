[
    {
        "content": "<p>Using functions like <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=WithTop.untop%27#doc\">docs#WithTop.untop'</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=WithTop.map#doc\">docs#WithTop.map</a> with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ENat#doc\">docs#ENat</a> is defeq abuse, and causes them to <code>simp</code> badly, as <code>ENat</code> uses <code>Nat.cast</code> instead of <code>WithTop.some</code>. How should that be resolved? Should we add <code>ENat.toWithTop</code> and <code>ENat.ofWithTop</code> equivalences and use them? Should we copy needed functions from <code>WithTop</code> to <code>ENat</code>? Some other approach?</p>",
        "id": 480689563,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1730803041
    },
    {
        "content": "<p>Would it be possible to add <code>WithTop Nat = ENat</code> as a simp lemma?</p>",
        "id": 481241320,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1731040835
    },
    {
        "content": "<p>I don't see why you'd ever want to use the former if you have the latter available</p>",
        "id": 481415792,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1731117178
    },
    {
        "content": "<p>So I vote yes</p>",
        "id": 481415795,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1731117180
    },
    {
        "content": "<p>Since this is def-eq <code>simp</code> should have no trouble doing the replacement</p>",
        "id": 481415817,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1731117205
    },
    {
        "content": "<p>I made  <a href=\"https://github.com/leanprover-community/mathlib4/pull/18782\">#18782</a>, although I'm not sure how to interpret the benchmark</p>",
        "id": 481433911,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1731133839
    },
    {
        "content": "<p>In case it is helpful, the bench summary bot did not post anything since there were no entries that differed by at least 10^9 instructions.</p>",
        "id": 481441882,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731141541
    },
    {
        "content": "<p>(Right now, the action fails and posts nothing in this case, but it could be changed to posting what I said above instead!)</p>",
        "id": 481441911,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731141588
    },
    {
        "content": "<p>I closed it because after trying to use it for a bit I don't think it helps with defeq abuse. I think I'm leaning more towards <code>ENat.toWithTop</code> and <code>ENat.ofWithTop</code> now</p>",
        "id": 481447708,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1731147298
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"690858\">Daniel Weber</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Defeq.20abuse.20with.20ENat/near/481241320\">said</a>:</p>\n<blockquote>\n<p>Would it be possible to add <code>WithTop Nat = ENat</code> as a simp lemma?</p>\n</blockquote>\n<p>Unless <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ENat#doc\">docs#ENat</a> is reducible, this doesn't seem like a good idea to me</p>",
        "id": 481452718,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731152142
    },
    {
        "content": "<p>Yes, I agree. I tried making it reducible, but it had some weird failure</p>",
        "id": 481454171,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1731153464
    },
    {
        "content": "<p>/poll How to use WithTop functions on ENat?<br>\nAdd <code>toWithTop</code> and <code>ofWithTop</code> functions<br>\nCopy the appropriate theorems/definition for ENat when needed<br>\nMake <code>ENat</code> abbrev</p>",
        "id": 482110206,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1731484893
    },
    {
        "content": "<p>I made <a href=\"https://github.com/leanprover-community/mathlib4/pull/19149\">#19149</a> for <code>map</code>. A potential problem with this is that <code>map</code> needs three versions: <code>Nat -&gt; Nat, Nat -&gt; α, α -&gt; Nat</code>. This PR has the the second of those</p>",
        "id": 482855396,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1731844013
    },
    {
        "content": "<p>This passes CI now, but I really dislike the duplication</p>",
        "id": 482879454,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1731863681
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/19164\">#19164</a> implements the first approach, of adding <code>toWithTop</code> and <code>ofWithTop</code></p>",
        "id": 482885246,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1731868222
    },
    {
        "content": "<p>Why don't we make <code>ENat</code> an <code>abbrev</code>? It really is semantically the same as <code>WithTop Nat</code></p>",
        "id": 494775837,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1737369792
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"690858\">Daniel Weber</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Defeq.20abuse.20with.20ENat/near/481454171\">said</a>:</p>\n<blockquote>\n<p>Yes, I agree. I tried making it reducible, but it had some weird failure</p>\n</blockquote>\n<p>I tried that, but it had failures I didn't understand how to fix</p>",
        "id": 494779597,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1737370862
    },
    {
        "content": "<p>Aha, do you have some logs I can look at?</p>",
        "id": 494780009,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1737370971
    },
    {
        "content": "<p>I'm not at home for a week and I don't think I published the branch to GitHub, so unfortunately no</p>",
        "id": 494786066,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1737372760
    },
    {
        "content": "<p>Ah that's okay, I can wait</p>",
        "id": 494786753,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1737372954
    }
]