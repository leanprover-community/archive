[
    {
        "content": "<p>I've never particularly been a fan of <code>Mathlib.Init</code>, but I understand people like it. Could I put in a request for such a person to improve the error message:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">following</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">do</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Init</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"bp\">...</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>in the situation that adding <code>import Mathlib.Init</code> would cause an import cycle, to instead explain where to add the exception?</p>\n<p>(c.f. <a href=\"https://github.com/leanprover-community/mathlib4/pull/32416\">#32416</a>)</p>",
        "id": 561799641,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1764827905
    },
    {
        "content": "<p>Thanks for the complaint. Sorry that you got stuck on an unhelpful error messages. I just commented on the PR suggesting the right fix.</p>",
        "id": 561813436,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1764835155
    },
    {
        "content": "<p>I'm happy to make a PR improving the error, but am really busy in the next two weeks. If you periodically ping me (say, start of next week and the one after), I'll make sure to find time for this.</p>",
        "id": 561813528,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1764835191
    },
    {
        "content": "<p>Did you mean that if I import Mathlib.Tactic.Linter.Header, then I can remove the exception in lint-style?</p>",
        "id": 561813719,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1764835254
    },
    {
        "content": "<p>I think I have it now.</p>",
        "id": 561815312,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1764835842
    },
    {
        "content": "<p>No: you should import the header linter <em>and</em> keep the exception (but with a different comment for its existence).</p>",
        "id": 561815386,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1764835868
    },
    {
        "content": "<p>It seems if I import this file into <code>Mathlib.Init</code> then no exception is needed?</p>",
        "id": 561815461,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1764835892
    },
    {
        "content": "<p>Ah, you're importing it directly: then it's fine. Transitive imports you need to add by hand, for now.</p>",
        "id": 561815552,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1764835924
    },
    {
        "content": "<p>Longer term, should we insist that everything is imported directly (thereby not needing the confusing exceptions) or just do the analysis and allow everything transitively imported by Mathlib.Init?</p>",
        "id": 561815991,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1764836079
    },
    {
        "content": "<blockquote>\n<p>fix(scripts/lint-style): improve Mathlib.Init import error messagesÂ <a href=\"https://github.com/leanprover-community/mathlib4/pull/32419\">#32419</a></p>\n</blockquote>\n<p>is Claude's attempt at providing me with an actionable error message.</p>",
        "id": 561819090,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1764837203
    },
    {
        "content": "<p>If you add the analysis for transitive imports (i.e., making the linter smarter), I'm happy about that!</p>",
        "id": 561821461,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1764837950
    },
    {
        "content": "<p>Sure!</p>",
        "id": 561821523,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1764837972
    },
    {
        "content": "<p>My least favourite thing about <code>Mathlib.Init</code> is that if anyone ever downloads the FLT repo and opens a new file, they immediately get the incomprehensible error</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>invalid -D parameter, unknown configuration option 'linter.mathlibStandardSet'\n\nIf the option is defined in a library, use '-Dweak.linter.mathlibStandardSet' to set it conditionally\n</code></pre></div>\n<p>(thus making it look like the repo is mis-installed, but it is actually code for \"please type <code>import Mathlib.Init</code>\")</p>",
        "id": 561822485,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1764838255
    },
    {
        "content": "<p>Yes, this is really disastrous. :-) I am all for killing <code>Mathlib.Init</code>, but working with the constraint that we don't, let's see what we could do in this situation...</p>",
        "id": 561825903,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1764839180
    },
    {
        "content": "<p>Actually, <span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span>, why doesn't FLT just prepend <code>weak.</code> to that option name, as the error suggests? :-)</p>",
        "id": 561826882,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1764839463
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Mathlib.2EInit.20linter.20error/near/561821461\">said</a>:</p>\n<blockquote>\n<p>If you add the analysis for transitive imports (i.e., making the linter smarter), I'm happy about that!</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"634338\">@Michael Rothgang</span>, done.</p>",
        "id": 561828807,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1764839999
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Mathlib.2EInit.20linter.20error/near/561826882\">said</a>:</p>\n<blockquote>\n<p>Actually, <span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span>, why doesn't FLT just prepend <code>weak.</code> to that option name, as the error suggests? :-)</p>\n</blockquote>\n<p>Oh I absolutely could do that -- basically I never change any system files in FLT, the default set-up with anything other than mathematics in FLT is \"other people do everything and I understand nothing\" (although this changed recently because I actually attempted, and failed, to add a test; see <a class=\"message-link\" href=\"/#narrow/channel/113488-general/topic/Project.20dashboard/near/560949649\">#general &gt; Project dashboard @ ðŸ’¬</a> , so maybe there's hope for me yet )</p>",
        "id": 561853541,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1764847844
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Mathlib.2EInit.20linter.20error/near/561825903\">said</a>:</p>\n<blockquote>\n<p>Yes, this is really disastrous. :-) I am all for killing <code>Mathlib.Init</code>, but working with the constraint that we don't, let's see what we could do in this situation...</p>\n</blockquote>\n<p>I agree this is not great user experience! I do think Mathlib.Init solves a real problem, though (making sure all files in mathlib are run with all syntax linters - and making sure some basic imports are available everywhere). Kim: If you propose killing that file, how would you like to solve this?</p>",
        "id": 561853906,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1764847961
    },
    {
        "content": "<p>In CSLib we also spent a lot of time thinking about Mathlib.Init with the motivation Michael mentions of making sure syntax linters are available everywhere. I don't consider <code>weak</code> a great solution, because it puts you in a situation where you could silently not have linters if you're missing an import. </p>\n<p>The solution I came up with is to <a href=\"https://github.com/leanprover/cslib/blob/1000a8136da9ef6009b46cb0dc10252fe0ea44f0/scripts/CheckInitImports.lean\">write a test</a> that uses <code>importGraph</code> to check transitive imports. In fact we ended up creating our own Cslib.Init file, currently including <code>Mathlib.Tactic.Common</code>, <code>Mathlib.Init</code>, and our own linters. To me this indicates that maybe this idea of ensuring imports is something that could be a broadly useful tool.</p>\n<p>(I know we had some of this discussion previously, but I can't find it at the moment)</p>",
        "id": 561864572,
        "sender_full_name": "Chris Henson",
        "timestamp": 1764851202
    }
]