[
    {
        "content": "<p>It looks like there is no tactic like <code>abel</code> for handling computations in commutative multiplicative group/monoids, so I tried to see if I could get a duplicate version of <code>abel</code> called <code>abel_mul</code>that would do the same thing in the multiplicative notations, and the resulting file (also containing the <code>abel</code> tactic) looks like <a href=\"https://gist.github.com/robin-carlier/048b1715b38f6de07d5af35449fd01cf\">this</a>. As I’m completely new to metaprogramming, there is an awful lot of code duplication and this is basically just a copy of the code of <code>abel</code> with a few modifications here and there.</p>\n<p>Would this be too much code duplication to be considered PR-able?</p>",
        "id": 474307541,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1727878140
    },
    {
        "content": "<p>I thought there were already two PR attempting this...</p>",
        "id": 474473582,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1727930862
    },
    {
        "content": "<p>One of them is <a href=\"https://github.com/leanprover-community/mathlib4/pull/13233\">#13233</a></p>",
        "id": 474473662,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1727930894
    },
    {
        "content": "<p>The other is <a href=\"https://github.com/leanprover-community/mathlib4/pull/13442\">#13442</a>...</p>",
        "id": 474473698,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1727930939
    },
    {
        "content": "<p>We should really get this tactic. But I don't have the meta skills to make this converge</p>",
        "id": 474473737,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1727930969
    },
    {
        "content": "<p>Oh, I wasn’t aware of these PR. I guess I’ll just wait until one of these get merged. <a href=\"https://github.com/leanprover-community/mathlib4/pull/13233\">#13233</a> seems to take the exact same approach that I did anyway. Thanks for digging them up!</p>",
        "id": 474500769,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1727939088
    },
    {
        "content": "<p>Could we arrange that <code>abel</code> does both?</p>",
        "id": 474501697,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1727939333
    },
    {
        "content": "<p>I would think that it should be possible, although there might be some choice about what to do when the target involves an expression in a ring, with both additions and multiplications.</p>",
        "id": 474519376,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727943621
    },
    {
        "content": "<p>Maybe, defaulting to addition is reasonable and an <code>abel!</code> could also normalize summands?</p>",
        "id": 474519507,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727943668
    },
    {
        "content": "<p>When trying to code it, I considered that and thought that defaulting to addition + an optional config option to force the multiplicative mode would be reasonable, but I lack the meta skills to do this kind of things.</p>",
        "id": 474519762,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1727943758
    },
    {
        "content": "<p>I wonder whether we can leverage <code>to_additive</code> to take care of most of the fluff and simply add a small plug at the end of it all that decides whether it should run <code>add_abel</code> or <code>mul_abel</code>.</p>",
        "id": 474520262,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727943921
    },
    {
        "content": "<p>I scanned through the <code>abel</code> file and here is a potential approach:</p>\n<ul>\n<li>write a <code>Syntax</code>-to<code>Syntax</code> conversion that does what <code>to_additive</code> does, but only for the very limited scope of what <code>abel</code> needs;</li>\n<li>multiplicativize everything in <code>abel</code> for which it makes sense to do so and elaborate each definition and the <code>Syntax</code>-converted one;</li>\n<li>extend <code>Context</code> to also keep track of whether the operation is addition or multiplication;</li>\n<li>extend the switch that decides whether you are facing an AddGroup or an AddMonoid, to also allow Group and Monoid;</li>\n<li>put everything together.</li>\n</ul>\n<p>None of the steps above looks hard, probably, when you actually start doing it, you will realize that there was more involved, but I think that it should be all relatively straightforward.</p>\n<p>Any opinions on this?</p>",
        "id": 474534989,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727947086
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Multiplicative.20variant.20of.20the.20.60abel.60.20tactic/near/474501697\">said</a>:</p>\n<blockquote>\n<p>Could we arrange that <code>abel</code> does both?</p>\n</blockquote>\n<p>Or at least, have <code>mabel</code> and <code>abel</code> call the same underlying <code>TacticM</code> with different configuration</p>",
        "id": 474536811,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1727947616
    }
]