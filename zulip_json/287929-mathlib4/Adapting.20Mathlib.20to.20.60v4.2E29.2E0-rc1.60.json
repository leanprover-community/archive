[
    {
        "content": "<p>Please read the <a href=\"#narrow/channel/113486-announce/topic/releases.20of.20new.20Lean.20versions/near/574616123\">announcement</a> about <code>v4.29.0-rc1</code>.</p>",
        "id": 574617682,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1771454441
    },
    {
        "content": "<p>A few things to start the ball rolling:</p>\n<ul>\n<li>Everyone will notice merge conflicts resulting from the additions of <code>set_option backward.isDefEq.respectTransparency false</code> in many places in Mathlib. Please help out newcomers dealing with this!</li>\n<li>If you're working on a new file, is it completely okay to add <code>set_option backward.isDefEq.respectTransparency false</code> at the top of the file, and not worry about this process further.</li>\n<li>If you're working on existing files, our preference is that you try to localize <code>set_option</code> to individual declarations where possible. This will help us triage, identify problems, and track improvements.</li>\n<li>Nearly always, these <code>set_option</code>s are required \"at the point of use\", but there are occasional places in Mathlib where a <code>set_option</code> is needed on a declaration that otherwise compiles, but is needed to prevent errors downstream. If possible, we'd ask that when adding these you leave a comment on the same line like <code>-- needed in X.Y.Z</code></li>\n</ul>",
        "id": 574617975,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1771454626
    },
    {
        "content": "<p>Just to make sure, is <a href=\"https://github.com/leanprover-community/mathlib4/pull/35500\">#35500</a> (disable <code>backward.isDefEq.respectTransparency</code> globally) interfering with any plans?</p>",
        "id": 574618839,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1771454934
    },
    {
        "content": "<p>More generally:</p>\n<ul>\n<li>We are very aware this is disruptive. We do not believe that all of these <code>set_option</code>s represent problems in Mathlib, although many do! We are working harder on further fixes to Lean, and there will be more release candidates soon which should alleviate the need for these.</li>\n<li>It is super helpful if contributors can provide an <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a> showing a problem that looks like it needs to be fixed in Lean. We will analyze these and try to fix asap. Community members are already hard at work on this at <a class=\"message-link\" href=\"/#narrow/channel/113488-general/topic/backward.2EisDefEq.2ErespectTransparency/near/574421640\">#general &gt; backward.isDefEq.respectTransparency @ ðŸ’¬</a> </li>\n<li>We are really determined to reach a good conclusion to these problems; we are fixing a longstanding problem in Lean's typeclass inference, and once we sort out the wrinkles, this will bring better performance and predictability to Lean.</li>\n</ul>",
        "id": 574618900,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1771454973
    },
    {
        "content": "<p>Thank you!<br>\nCould you explain a bit what the changes do specifically, perhaps with MWEs that the 2 big changes break and are considered intentional rather than bugs? (i.e. what \"wrong\" behavior did Mathlib rely on)</p>",
        "id": 574619101,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1771455074
    },
    {
        "content": "<p>Does <a href=\"https://github.com/leanprover/lean4/pull/12179\">lean#12179</a> mean that some defeq checks automatically upgrade <code>def</code>s to <code>abbrev</code>s? Or automatically added <code>@[expose]</code> or <code>@[reducible]</code>?<br>\nEdit: <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Meta.TransparencyMode#doc\">docs#Lean.Meta.TransparencyMode</a> contains some relevant info</p>",
        "id": 574619236,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1771455167
    },
    {
        "content": "<p>Previously, isDefEq was unfolding semireducible arguments when checking equalities of implicit arguments (i.e. treating anything sitting in an implicit position as if it were reducible).</p>",
        "id": 574619423,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1771455277
    },
    {
        "content": "<p>We think that <a href=\"https://github.com/leanprover/lean4/pull/12564\">lean#12564</a> should resolve many of the problems experienced in Mathlib so far. We're testing it now.</p>",
        "id": 574619472,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1771455319
    },
    {
        "content": "<p>I have to pause now, but if anyone would like to contribute fixes on the lean-pr-testing-12564 branch, that would be super helpful.</p>",
        "id": 574625729,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1771459100
    },
    {
        "content": "<p>Also, some good news:</p>\n<p><span class=\"user-mention silent\" data-user-id=\"395550\">Henrik BÃ¶ving</span> said:</p>\n<blockquote>\n<p>I was just looking at the mathlib instructions count:<br>\n<a href=\"/user_uploads/3121/DWU204JSTxS834NHmnv0dlhv/image.png\">image.png</a></p>\n<p>Thanks to v4.28 and v4.29 we managed to push instruction count back to where it was 3 months ago despite mathlib adding around 150k lines in the mean time <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span> !</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">Î»</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">diff</span><span class=\"w\"> </span><span class=\"c1\">--stat ef549b7b128a834178a5f25fbcdf75c3aa32deb7</span>\n<span class=\"w\"> </span><span class=\"mi\">8160</span><span class=\"w\"> </span><span class=\"n\">files</span><span class=\"w\"> </span><span class=\"n\">changed</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">325220</span><span class=\"w\"> </span><span class=\"n\">insertions</span><span class=\"o\">(</span><span class=\"bp\">+</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"mi\">142632</span><span class=\"w\"> </span><span class=\"n\">deletions</span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"o\">)</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 574635746,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1771465528
    }
]