[
    {
        "content": "<p>I was recently wondering about our normalisation of Hausdorff measure. I believe it is such that the following is true:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">Group</span><span class=\"bp\">.</span><span class=\"n\">Measure</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">Measure</span><span class=\"bp\">.</span><span class=\"n\">Hausdorff</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">FiniteDimensional</span><span class=\"w\"> </span><span class=\"n\">MeasureTheory</span><span class=\"w\"> </span><span class=\"n\">Measure</span><span class=\"w\"> </span><span class=\"n\">Metric</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">FiniteDimensional</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">MeasurableSpace</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">BorelSpace</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">hausdorffMeasure_ball_zero_one</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">μH</span><span class=\"o\">[</span><span class=\"n\">finrank</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ball</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">finrank</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 466726879,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1725206715
    },
    {
        "content": "<p>Furthermore, given this (or otherwise) it looks like the following should be easy:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">isAddHaarMeasure_hausdorffMeasure</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nontrivial</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">IsAddHaarMeasure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">μH</span><span class=\"o\">[</span><span class=\"n\">finrank</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 466727124,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1725206780
    },
    {
        "content": "<p>I might add these results if I have time in the coming week but I thought I'd see if anyone had remarks to make before I embark. Maybe <span class=\"user-mention\" data-user-id=\"214703\">@Yury G. Kudryashov</span> ?</p>",
        "id": 466727272,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1725206834
    },
    {
        "content": "<p>I don't think that <code>hausdorffMeasure_ball_zero_one</code> is true.</p>",
        "id": 466728131,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1725207163
    },
    {
        "content": "<p>I think that in an inner product space it is equal to <code>volume</code>.</p>",
        "id": 466728161,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1725207180
    },
    {
        "content": "<p><code>IsAddHaarMeasure ...</code> should be true.</p>",
        "id": 466728369,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1725207279
    },
    {
        "content": "<p>We have <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/MeasureTheory/Measure/Hausdorff.html#MeasureTheory.instIsAddLeftInvariantHausdorffMeasureOfIsometricVAdd\">MeasureTheory.instIsAddLeftInvariantHausdorffMeasureOfIsometricVAdd</a>, so you only need to prove that it's positive on balls and is finite on compacts. Both easily follow from its properties on <code>ι → Real</code> and a linear equivalence with this space.</p>",
        "id": 466728605,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1725207439
    },
    {
        "content": "<p>I'll have to look into the normalisation question when I have more time but in the meantime I added the easy (given what we have) bit: <a href=\"https://github.com/leanprover-community/mathlib4/pull/16524\">#16524</a></p>",
        "id": 468120474,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1725612675
    },
    {
        "content": "<p>It would be good to have lemmas giving the normalisation not just for top-dimensional Hausdorff measure, but for m-dimensional Hausdorff measure in an n-dimensional affine space, applied to a set lying in an m-dimensional affine subspace thereof. (See the PutnamBench discussion of how to refer to the area of a triangle in 3-dimensional space, for example - to talk about 2-dimensional areas in higher-dimensional spaces we need to know how to correctly normalise 2-dimensional Hausdorff measure in a space of any dimension with the Euclidean metric.)</p>",
        "id": 468313876,
        "sender_full_name": "Joseph Myers",
        "timestamp": 1725668833
    },
    {
        "content": "<p>This can by done by some <code>map</code>/<code>comap</code> tricks.</p>",
        "id": 468313950,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1725668891
    },
    {
        "content": "<p>OK, that's something we do already have the lemmas for (<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Isometry.hausdorffMeasure_image#doc\">docs#Isometry.hausdorffMeasure_image</a> etc.), unlike the normalisation where we only have a lemma giving equality to <code>volume</code> in the <code>ι → ℝ</code> (sup metric) case, not anything for the Euclidean metric.</p>",
        "id": 468314598,
        "sender_full_name": "Joseph Myers",
        "timestamp": 1725669402
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Hausdorff.20measure.20normalisation/near/466728161\">said</a>:</p>\n<blockquote>\n<p>I think that in an inner product space it is equal to <code>volume</code>.</p>\n</blockquote>\n<p>No longer sure about that.</p>",
        "id": 468433528,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1725725640
    },
    {
        "content": "<p>For the plane, the answer seems to be <code>π/4</code> due to the isodiametric inequality.</p>",
        "id": 468435320,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1725726428
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"266253\">@Joseph Myers</span> I think that you should generalize <code>MeasureSpace</code> on <code>InnerProductSpace</code> to a <code>NormedAddTorsor</code> (if it isn't done yet), then you'll have measure on an affine subspace of a Euclidean space.</p>",
        "id": 468435451,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1725726512
    },
    {
        "content": "<p>I think I should have time to add a proof of my original claim in the next day or so.</p>",
        "id": 468475159,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1725744920
    },
    {
        "content": "<p>I had a look this morning and I think the non-trivial direction follows from <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Besicovitch.exists_closedBall_covering_tsum_measure_le#doc\">docs#Besicovitch.exists_closedBall_covering_tsum_measure_le</a> (though perhaps this is too much of a sledgehammer).</p>",
        "id": 468475248,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1725744993
    },
    {
        "content": "<p>Really though, we should just use the <code>volume</code> for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=EuclideanSpace#doc\">docs#EuclideanSpace</a> and not the Hausdorff measure.</p>",
        "id": 468475379,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1725745139
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Hausdorff.20measure.20normalisation/near/468435451\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"266253\">Joseph Myers</span> I think that you should generalize <code>MeasureSpace</code> on <code>InnerProductSpace</code> to a <code>NormedAddTorsor</code> (if it isn't done yet), then you'll have measure on an affine subspace of a Euclidean space.</p>\n</blockquote>\n<p>Any translation-invariant measure on an additive group gives one for an <code>AddTorsor</code> in the obvious way, but this probably needs to be a <code>def</code> and not an <code>instance</code> to avoid diamonds for the measure on the group, which can also be considered as a torsor for itself, as while the measures would be equal I expect they wouldn't be defeq. (Then I suppose you'd need a <code>Prop</code> typeclass asserting that the measure on a torsor is the one given by that on the underlying group, with associated instances both for the group as a torsor for itself and for the measure given by the above <code>def</code>.)</p>",
        "id": 468935582,
        "sender_full_name": "Joseph Myers",
        "timestamp": 1725923622
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"240862\">Oliver Nash</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Hausdorff.20measure.20normalisation/near/468475379\">said</a>:</p>\n<blockquote>\n<p>Really though, we should just use the <code>volume</code> for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=EuclideanSpace#doc\">docs#EuclideanSpace</a> and not the Hausdorff measure.</p>\n</blockquote>\n<p>We need some standard way to talk about n-dimensional volume of a set in a space that might be of more than n dimensions, whether that's <code>volume</code> combined with moving to a subspace or whether that's Hausdorff measure (and then we need lemmas relating all the plausible ways of talking about this to whatever the main version we choose is). Even a statement as basic as \"volume of an n-dimensional simplex = volume of base * height / n\" involves measures of both n-dimensional and (n-1)-dimensional sets simultaneously (in a space that might be more than n-dimensional). (No doubt we do then also want a version of that specialized to triangles, where 1-dimensional volume of the base is replaced by distance between two points.)</p>",
        "id": 468936165,
        "sender_full_name": "Joseph Myers",
        "timestamp": 1725923877
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"266253\">Joseph Myers</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Hausdorff.20measure.20normalisation/near/468935582\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Hausdorff.20measure.20normalisation/near/468435451\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"266253\">Joseph Myers</span> I think that you should generalize <code>MeasureSpace</code> on <code>InnerProductSpace</code> to a <code>NormedAddTorsor</code> (if it isn't done yet), then you'll have measure on an affine subspace of a Euclidean space.</p>\n</blockquote>\n<p>Any translation-invariant measure on an additive group gives one for an <code>AddTorsor</code> in the obvious way, but this probably needs to be a <code>def</code> and not an <code>instance</code> to avoid diamonds for the measure on the group, which can also be considered as a torsor for itself, as while the measures would be equal I expect they wouldn't be defeq. (Then I suppose you'd need a <code>Prop</code> typeclass asserting that the measure on a torsor is the one given by that on the underlying group, with associated instances both for the group as a torsor for itself and for the measure given by the above <code>def</code>.)</p>\n</blockquote>\n<p>If you <strong>replace</strong> the instance <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/MeasureTheory/Measure/Haar/OfBasis.html#measureSpaceOfInnerProductSpace\">measureSpaceOfInnerProductSpace</a> with a new instance that works for torsors, then you get no diamonds.</p>",
        "id": 468947764,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1725929808
    },
    {
        "content": "<p>I think I argued in the past that that instance is probably not a good one in the long run, as it will surely lead to diamonds</p>",
        "id": 468951168,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1725931645
    },
    {
        "content": "<p>How?</p>",
        "id": 468978678,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1725941661
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"266253\">Joseph Myers</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Hausdorff.20measure.20normalisation/near/468936165\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"240862\">Oliver Nash</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Hausdorff.20measure.20normalisation/near/468475379\">said</a>:</p>\n<blockquote>\n<p>Really though, we should just use the <code>volume</code> for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=EuclideanSpace#doc\">docs#EuclideanSpace</a> and not the Hausdorff measure.</p>\n</blockquote>\n<p>We need some standard way to talk about n-dimensional volume of a set in a space that might be of more than n dimensions, whether that's <code>volume</code> combined with moving to a subspace or whether that's Hausdorff measure [...]</p>\n</blockquote>\n<p>Agreed of course. What I had in mind though is that Hausdorff measure is still not the right thing (not even up to an overall scale) if you just pass to a subset which is not an affine subspace.</p>\n<p>For example if we take the 2-sphere inside Euclidean 3-space, then Mathlib gives it the subset metric rather than the geodesic metric. So the corresponding 2-dim Hausdorff measure (or equivalently the restriction of the 2-dim Hausdorff measure on Euclidean 3-space) will not be the right measure because the diameter of a ball will be off by the cosine of an angle.</p>\n<p>So what's really missing is geodesic distance. The setting in which I understand this well is when you have an infinitesimal metric, i.e., a Riemannian manifold and then the tangent space is an inner product space so you might as well just use inner product space <code>volume</code> there and (assuming orientability) integrate this up to a measure. (Of course, this will actually agree with the Hausdorff measure, with the geodesic metric, up to scale.)</p>",
        "id": 469080701,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1725972442
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Hausdorff.20measure.20normalisation/near/468978678\">said</a>:</p>\n<blockquote>\n<p>How?</p>\n</blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/113488-general/topic/.60measure_space.60.20instance.20on.20euclidean.20space/near/350868566\">said</a>:</p>\n<blockquote>\n<p>I'm pretty sure that <code>measure_space_of_inner_product_space</code> is going to give us a diamond problem eventually, because it breaks the \"don't construct data from data\" rule; what's the measure on <code>ulift complex</code>? Is it just the measure on complex passed through <code>equiv.ulift</code>? Or is it the measure derived from <code>inner</code> passed through <code>equiv.ulift</code>? They're certainly not defeq, because everything goes through a <code>classical.some</code>.</p>\n</blockquote>",
        "id": 469082726,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1725972910
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"240862\">Oliver Nash</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Hausdorff.20measure.20normalisation/near/469080701\">said</a>:</p>\n<blockquote>\n<p>For example if we take the 2-sphere inside Euclidean 3-space, then Mathlib gives it the subset metric rather than the geodesic metric. So the corresponding 2-dim Hausdorff measure (or equivalently the restriction of the 2-dim Hausdorff measure on Euclidean 3-space) will not be the right measure because the diameter of a ball will be off by the cosine of an angle.</p>\n</blockquote>\n<p>I'm not sure I understand the issue here. When you zoom in enough, since you're talking of a submanifold, the geodesic distance and the subset distance become essentially the same (within a multiplicative factor of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>+</mo><mi>ϵ</mi></mrow><annotation encoding=\"application/x-tex\">1+\\epsilon</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">ϵ</span></span></span></span>). As Hausdorff measure is precisely defined by zooming in arbitrarily, doesn't it imply that the Hausdorff measure for the geodesic distance and the subset distance coincide?</p>\n<p>Of course, this wouldn't be the case for arbitrary sets, but in fractal sets where the difference becomes relevant I don't think you can even talk of a geodesic distance.</p>",
        "id": 469085648,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1725973541
    },
    {
        "content": "<p>Oh you're absolutely right. What I wrote is clearly ridiculous.</p>\n<p>What I had in mind was that the area of a circle on the sphere will be off by a factor involving the cosine so how could things line up but of course radius^2 will be off by an exactly compensating factor, so indeed it is possible for there to be agreement up to an overall scale; and moreover there is! (In my defense I was writing this in my rapidly shortening moments over lunch --- indeed I'd better resume work now.)</p>",
        "id": 469092692,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1725975165
    },
    {
        "content": "<p>OK I now agree that the HM is a very convenient shortcut around the missing differential geometry. (Indeed one wonders if Euclid made an error declaring the unit square to have area 1; and should instead have given the unit circle this honour.)</p>",
        "id": 469093098,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1725975247
    },
    {
        "content": "<p>Thanks Eric, <code>ULift</code> is  a good example. Should we make it a non-instance and add a typeclass saying that the volume (or even a measure?) is equal to the one given by the inner product? <span class=\"user-mention\" data-user-id=\"110050\">@Sébastien Gouëzel</span> , what do you think?</p>",
        "id": 469174583,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1725991859
    },
    {
        "content": "<p>The argument in the past (which I think is reasonable) was \"we don't actually care about <code>ULift</code>, let's wait until we have a situation we do care about\"</p>",
        "id": 469179227,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1725993299
    },
    {
        "content": "<p>I think we care a lot about the standard measure on inner product spaces (for example when doing Fourier transform) and not so much about <code>ULift</code>ing measures, so I'd rather keep the current instance. Of course, I'm ready to change my mind the day it creates real problems!</p>",
        "id": 469183768,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1725994307
    },
    {
        "content": "<p>Then we should add this information to the docstring of the instance.</p>",
        "id": 469184243,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1725994385
    },
    {
        "content": "<p>Opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/17270\">#17270</a>, feel free to push improvements there.</p>",
        "id": 473593012,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1727675823
    }
]