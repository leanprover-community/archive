[
    {
        "content": "<p>I've been cleaning-up a definition and some basic API/proofs for Cayley graphs <a href=\"https://github.com/vlad902/misc-lean-proofs/blob/main/MiscLeanProofs/CayleyGraph.lean\">here</a> that I'd like to upstream to mathlib. There's two things I don't like that I wanted to ask about:</p>\n<ol>\n<li>I define a <code>CayleyGraph</code> structure like so:</li>\n</ol>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">CayleyGraph</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">one_not_mem</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">∉</span><span class=\"w\"> </span><span class=\"n\">S</span>\n</code></pre></div>\n<p><code>one_not_mem</code> is required to satisfy SimpleGraph which does not allow self-loops. I then define the actual SimpleGraph</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">CayleyGraph</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">CG</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CayleyGraph</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Graph</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">Adj</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">S</span>\n<span class=\"w\">  </span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n<span class=\"w\">  </span><span class=\"n\">loopless</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CG</span><span class=\"bp\">.</span><span class=\"n\">one_not_mem</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>but this feels awkward, having a <code>(CG : CayleyGraph G S)</code> and needing to reference the actual graph as <code>CG.Graph</code> when <code>CayleyGraph</code> itself has graph in the name. Am I overthinking this, or should I be taking a different approach?</p>\n<ol start=\"2\">\n<li>Slightly related to the above, the API I've developed so far is specialized to <code>Group</code> and I can't additivize it using <code>@[to_additive]</code> because I don't use <code>Group</code> in the naming. Should I extend <code>to_additive</code> to support <code>AddCayleyGraph</code>, or should this API actually live as <code>Group.CayleyGraph generating_set</code>,  or something else? Perhaps to also address the above, <code>Group.Cayley generating_set</code> where <code>(Group.Cayley generating_set).Graph</code> is the SimpleGraph?</li>\n</ol>\n<p>Any other feedback/suggestions welcome.</p>",
        "id": 537506251,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1756914544
    },
    {
        "content": "<p>Isn't it usually the case that you want to construct a Cayley graph for an entire group?</p>",
        "id": 537555473,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1756934034
    },
    {
        "content": "<p>I think you should either use a non-simple graph, or you should avoid drawing edges from x back to itself</p>",
        "id": 537555558,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1756934077
    },
    {
        "content": "<p>Then you don't need this extra <code>CayleyGraph</code> structure</p>",
        "id": 537555584,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1756934092
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"459227\">Violeta Hernández</span> <a href=\"#narrow/channel/287929-mathlib4/topic/How.20to.20structure.20Cayley.20graph.20API/near/537555473\">said</a>:</p>\n<blockquote>\n<p>Isn't it usually the case that you want to construct a Cayley graph for an entire group?</p>\n</blockquote>\n<p>Not sure I understand this question, this object is the Cayley graph for an entire group.</p>\n<p>The difficulty with <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo mathvariant=\"normal\">∉</mo><mi>S</mi></mrow><annotation encoding=\"application/x-tex\">1 \\notin S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mord\"><span class=\"mrel\">∈</span></span><span class=\"mord vbox\"><span class=\"thinbox\"><span class=\"llap\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"inner\"><span class=\"mord\"><span class=\"mord\">/</span><span class=\"mspace\" style=\"margin-right:0.0556em;\"></span></span></span><span class=\"fix\"></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span></span></span></span> is hard to avoid because the other Graph APIs in mathlib are so undeveloped--and I figured it wasn't worth the investment since 1 is not an interesting generator anyway.</p>",
        "id": 537712428,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1757003745
    },
    {
        "content": "<p>Oh, I misunderstood. So S is the set of generators, not the set of elements of the graph.</p>",
        "id": 537712859,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1757003924
    },
    {
        "content": "<p>What I tried to say still applies, though. What do you think about allowing 1 in the set of generators, but explicitly omitting any edges between a node and itself?</p>",
        "id": 537713243,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1757004087
    },
    {
        "content": "<p>As a more holistic kind of question, what exactly do you want to do with Cayley graphs? I've always viewed them as more of a visualization device, rather than a mathematical tool.</p>",
        "id": 537713355,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1757004128
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"459227\">Violeta Hernández</span> <a href=\"#narrow/channel/287929-mathlib4/topic/How.20to.20structure.20Cayley.20graph.20API/near/537713243\">said</a>:</p>\n<blockquote>\n<p>What I tried to say still applies, though. What do you think about allowing 1 in the set of generators, but explicitly omitting any edges between a node and itself?</p>\n</blockquote>\n<p>What is the advantage? Just to avoid the hypothesis? Does it allow structuring the code differently somehow? I'm not sure it's particularly useful in practice for developing the theory.</p>",
        "id": 537716220,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1757005189
    },
    {
        "content": "<p>Cayley graphs are often studied in Geometric Group Theory as you can put a geometric representation on a groups, e.g. a metric structure, and then study invariant properties. I'm not an expert, so I was developing some basic theory while following a seminar and thought it'd be nice to contribute them.</p>",
        "id": 537717037,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1757005492
    },
    {
        "content": "<p>I'm not sure if you need <code>CayleyGraph</code> structure in the first place. Do you use this <code>CayleyGraph</code> structure for something else than creating <code>SimpleGraph</code> from it, or do you have more constructors?</p>\n<p>Something like:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">}</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">cayleyGraph</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">∉</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">Adj</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">S</span>\n<span class=\"w\">  </span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n<span class=\"w\">  </span><span class=\"n\">loopless</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simpa</span>\n</code></pre></div>\n<p>You can still prove properties about <code>cayleyGraph</code>.</p>",
        "id": 537729840,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1757010729
    },
    {
        "content": "<p>Yeah so the reason I had not gone with <code>def cayleyGraph (h : 1 ∉ S) : SimpleGraph G</code> is because I think I was concerned that carrying around the hypothesis in the type was unergonomic, but I'm not really sure if that's a valid concern relative to carrying around a structure instead. I'll give it a try and see how it looks</p>",
        "id": 537879547,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1757081299
    },
    {
        "content": "<p>I agree with Vlad there - data-carrying <code>defs</code> that include propositions to be valid pretty much always leads to large pain. (e.g. what if I want to call <code>simp</code> on my set <code>S</code> now?)</p>\n<p>I think Violeta's approach will be the right one, i.e define it for any set of generators, and just explicitly include <code>x \\ne y \\and ...</code> in the definition of <code>Adj x y</code>. And then of course there will be theorems that <code>CayleyGraph S = CayleyGraph (insert 1 S)</code> and <code>CayleyGraph S = CayleyGraph (S \\ {1})</code>.</p>",
        "id": 537882245,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1757082087
    },
    {
        "content": "<p>Actually, I think there's an even better way: first define <code>CayleyDigraph</code> as the directed version, <code>Digraph</code>, which keeps track of the orientation based on the elements of <code>S</code>. (This does show up in enough contexts to merit talking defining here, I'm pretty sure.) It can have self-loops just fine. Then <code>CayleyGraph S := (CayleyDigraph S).toSimpleGraphInclusive</code>.</p>\n<p>Then all a lot of the fussing about what happens with including 1 or not, or symmetrizing or not, would follow from the properties of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Digraph.toSimpleGraphInclusive#doc\">docs#Digraph.toSimpleGraphInclusive</a>.</p>",
        "id": 537883554,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1757082457
    },
    {
        "content": "<p>I've never interacted with graph theory in Mathlib so take my suggestions with a grain of salt but, if you're going to define the Cayley graph then why not go for the Schreier graph of an arbitrary group action?</p>\n<p>Of course the issue is that it is no longer a simple graph even when <code>S</code> does not contain 1 (which I think should be allowed btw). It is naturally built as a subquiver of the action groupoid though (but it seems that these two approaches to graph theory are not connected in Mathlib...)</p>",
        "id": 537885578,
        "sender_full_name": "Anatole Dedecker",
        "timestamp": 1757083017
    }
]