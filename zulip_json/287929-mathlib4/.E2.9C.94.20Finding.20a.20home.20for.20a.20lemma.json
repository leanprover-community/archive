[
    {
        "content": "<p>(This concerns <a href=\"https://github.com/leanprover-community/mathlib4/pull/20272\">#20272</a>)</p>\n<p>I would like some advice about where to put the following lemma:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">IsSquare</span><span class=\"bp\">.</span><span class=\"n\">nonneg</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LinearOrder</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsRightCancelAdd</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">ZeroLEOneClass</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ExistsAddOfLE</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">PosMulMono</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddLeftStrictMono</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsSquare</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div>\n<p>It's immediately analogous to <code>mul_self_nonneg</code> in <code>Algebra.Order.Ring.Unbundled.Basic</code>, but that file and <code>Algebra.Group.Even</code>, where <code>IsSquare</code> is defined, are restricted from importing each other.</p>\n<p>I've tentatively stuck the lemma at the top of <code>Algebra.Order.Ring.Basic</code>, but that file deals with bundled typclasses such as <code>OrderedRing</code> rather than the unbundled assumptions my lemma has.</p>",
        "id": 491501541,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1735739592
    },
    {
        "content": "<p>I'm guessing you have already tried <code>#find_home</code>, and it suggests only locations you've already considered?</p>",
        "id": 491502306,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1735740269
    },
    {
        "content": "<p>Have now tried it. The only sensible place it returned is <code>Algebra.Order.Ring.Basic</code> -- I think that means it can't go into any file imported by <code>Algebra.Order.Ring.Basic</code> without changing the imports?</p>",
        "id": 491505931,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1735743466
    },
    {
        "content": "<p>Unless there is a bug in <code>#find_home</code> yes.</p>",
        "id": 491506016,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1735743529
    },
    {
        "content": "<p>There's a small footnote to be made here: Your proof might be using typeclass synthesis, and it might have found a path that needs <code>Algebra.Order.Ring.Basic</code>. But maybe an alternative path exists that needs fewer imports.<br>\nThat's something that <code>#find_home</code> will not detect for you.</p>",
        "id": 491581800,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1735809106
    },
    {
        "content": "<p>But I wouldn't sweat too much about such scenarios.</p>",
        "id": 491581812,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1735809120
    },
    {
        "content": "<p>So.. is it reasonable to just stick the lemma at the topp of <code>Algebra.Order.Ring.Basic</code>?</p>",
        "id": 491609137,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1735823743
    },
    {
        "content": "<p>If there's not a more logical place in that file, sure. Are there other lemmas about <code>IsSquare</code> in that file already?</p>",
        "id": 491616559,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1735827472
    },
    {
        "content": "<p>Pretty much all lemmas about <code>Even</code>/<code>IsSquare</code> are in <code>Algebra.Group.Even</code>. But, as mentioned, orderings can't be imported into that file.</p>",
        "id": 491640284,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1735838181
    },
    {
        "content": "<p>The thing is that that file talks about bundled structure typclasses, whereas my lemma is about unbundled ones (since it's just a modification of <code>mul_self_nonneg</code>).</p>",
        "id": 491640408,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1735838244
    },
    {
        "content": "<p>In that case, just put it in a place in <code>Algebra.Order.Ring.Basic</code> that looks best to you</p>",
        "id": 491653676,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1735845001
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"400289\">Artie Khovanov</span> has marked this topic as resolved.</p>",
        "id": 491807340,
        "sender_full_name": "Notification Bot",
        "timestamp": 1735935527
    }
]