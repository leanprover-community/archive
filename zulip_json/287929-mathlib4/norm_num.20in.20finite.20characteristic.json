[
    {
        "content": "<p>The following makes me sad</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib.Data.ZMod.Basic</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">error: unsolved goals</span>\n<span class=\"sd\">⊢ ¬0 = 1</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kd\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ZMod</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ZMod</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"n\">norm_num</span>\n</code></pre></div>",
        "id": 478977859,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1729885047
    },
    {
        "content": "<p>One culprit is <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Mathlib.Tactic.Normnum.evalEq#doc\">docs#Mathlib.Tactic.Normnum.evalEq</a> L101</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">isNat</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"n\">na</span><span class=\"w\"> </span><span class=\"n\">pa</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">isNat</span><span class=\"w\"> </span><span class=\"n\">mα</span><span class=\"w\"> </span><span class=\"n\">nb</span><span class=\"w\"> </span><span class=\"n\">pb</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">assumeInstancesCommute</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">na.natLit</span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">nb.natLit</span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"n\">haveI'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">na</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"n\">Q</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">nb</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">⟨⟩</span>\n<span class=\"w\">      </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">isNat_eq_true</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">pa</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">pb</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">inferCharZeroOfAddMonoidWithOne</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"n\">mα</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Nat.beq</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">na</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">nb</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">Eq.refl</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">isNat_eq_false</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">pa</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">pb</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">r</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">else</span>\n<span class=\"w\">      </span><span class=\"n\">failure</span><span class=\"w\"> </span><span class=\"c1\">--TODO: nonzero characteristic ≠</span>\n</code></pre></div>",
        "id": 478978312,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1729885252
    },
    {
        "content": "<p>Correct me if I wrong but there is no simple way to return all the <code>m</code> such that <code>CharP R m</code> instance is registered right?</p>",
        "id": 478978807,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1729885465
    },
    {
        "content": "<p>It seems simpler to refactor to include <code>.isNatMod</code></p>",
        "id": 478979176,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1729885610
    },
    {
        "content": "<p>I think it would be relatively straightforward to obtain all <code>m</code> such that <code>CharP R m</code> is registered <em>directly</em>, given a particular <code>R</code>. E.g. in this case it should be easy to find <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ZMod.CharP#doc\">docs#ZMod.CharP</a>` in the environment.</p>",
        "id": 478982313,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1729886945
    },
    {
        "content": "<p>But yeah, presumably adding a <code>isNatMod</code> would be more direct.</p>",
        "id": 478982331,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1729886961
    },
    {
        "content": "<p>Oh yeah. I guess I could just query the instance cache.</p>",
        "id": 478983117,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1729887400
    }
]