[
    {
        "content": "<p>Why can't I use <code>decide</code> or <code>norm_num</code> to compute <code>Nat.primeFactors</code>?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">RingTheory</span><span class=\"bp\">.</span><span class=\"n\">Radical</span>\n\n<span class=\"sd\">/-- The radical of a natural number is the product of its prime factors.</span>\n<span class=\"sd\">This is computable, unlike `UniqueFactorizationMonoid.radical`. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">radical</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">∏</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">primeFactors</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">radical_899</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">radical</span><span class=\"w\"> </span><span class=\"mi\">899</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">899</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">decide</span><span class=\"w\"> </span><span class=\"c1\">-- fails</span>\n</code></pre></div>",
        "id": 573846733,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1771028306
    },
    {
        "content": "<p>I think <a class=\"stream-topic\" data-stream-id=\"217875\" href=\"/#narrow/channel/217875-Is-there-code-for-X.3F/topic/Compute.20Nat.2EprimeFactors/with/522916641\">#Is there code for X? &gt; Compute Nat.primeFactors</a> has some prior discussion</p>",
        "id": 573846817,
        "sender_full_name": "Julian Berman",
        "timestamp": 1771028376
    },
    {
        "content": "<p>Ah, yes</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">RingTheory</span><span class=\"bp\">.</span><span class=\"n\">Radical</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Simproc</span><span class=\"bp\">.</span><span class=\"n\">Factors</span>\n\n<span class=\"sd\">/-- The radical of a natural number is the product of its prime factors.</span>\n<span class=\"sd\">This is computable, unlike `UniqueFactorizationMonoid.radical`. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">radical</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">∏</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">primeFactors</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">yyy</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">radical</span><span class=\"w\"> </span><span class=\"mi\">899</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">899</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">radical</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">primeFactors</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">primeFactorsList_ofNat</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">norm_num</span>\n</code></pre></div>",
        "id": 573847107,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1771028607
    },
    {
        "content": "<p>It's because <code>Nat.primeFactorsList</code> &amp; <code>Nat.minFacAux</code> are <code>irreducible</code>.<br>\n<code>with_unfolding_all</code> resolves this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">radical_899</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">radical</span><span class=\"w\"> </span><span class=\"mi\">899</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">899</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">with_unfolding_all</span><span class=\"w\"> </span><span class=\"n\">decide</span>\n</code></pre></div>",
        "id": 573860070,
        "sender_full_name": "Miyahara Kō",
        "timestamp": 1771041560
    },
    {
        "content": "<p>Since <a href=\"https://github.com/leanprover/lean4/pull/7965\">https://github.com/leanprover/lean4/pull/7965</a> has landed, it would be reasonable for Mathlib to make <code>Nat.primeFactorsList</code> and <code>Nat.minFacAux</code> to be reducible again, so that <code>decide</code> works fine.</p>",
        "id": 573885267,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1771065646
    }
]