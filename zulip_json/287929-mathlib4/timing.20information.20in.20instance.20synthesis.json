[
    {
        "content": "<p>Can anyone remind me of the incantation to get timings for instance synthesis?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"c1\">--set_option trace.profiler true in</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">ContinuousLinearMap</span><span class=\"bp\">.</span><span class=\"n\">norm_smulRightL'</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"n\">Fâ‚—</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">Fâ‚—</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NontriviallyNormedField</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">NormedSpace</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedSpace</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">Fâ‚—</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"n\">L</span><span class=\"o\">[</span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nontrivial</span><span class=\"w\"> </span><span class=\"n\">Fâ‚—</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">â€–</span><span class=\"o\">(</span><span class=\"n\">smulRightL</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"n\">Fâ‚—</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">â€–</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">â€–</span><span class=\"n\">c</span><span class=\"bp\">â€–</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n</code></pre></div>\n<p>shows the instance synthesis steps, but no timings. And If I uncomment the line <code>set_option trace.profiler true</code> I get timings, but I lose the instance synthesis steps.</p>",
        "id": 525016443,
        "sender_full_name": "SÃ©bastien GouÃ«zel",
        "timestamp": 1750415286
    },
    {
        "content": "<p>Probably they're still there but just buried in a sea of other information and you have to start unfolding to find them.</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>buzzard@IC-HWDXTW69VR<span class=\"w\"> </span>~<span class=\"w\"> </span>%<span class=\"w\"> </span><span class=\"nb\">cd</span><span class=\"w\"> </span>Lean/Projects/Mathlib\nbuzzard@IC-HWDXTW69VR<span class=\"w\"> </span>Mathlib<span class=\"w\"> </span>%<span class=\"w\"> </span>cat<span class=\"w\"> </span>&gt;<span class=\"w\"> </span>Mathlib/test2.lean\nimport<span class=\"w\"> </span>Mathlib\n\nset_option<span class=\"w\"> </span>trace.Meta.synthInstance<span class=\"w\"> </span><span class=\"nb\">true</span><span class=\"w\"> </span><span class=\"k\">in</span>\nset_option<span class=\"w\"> </span>trace.profiler<span class=\"w\"> </span><span class=\"nb\">true</span><span class=\"w\"> </span><span class=\"k\">in</span>\ntheorem<span class=\"w\"> </span>ContinuousLinearMap.norm_smulRightL<span class=\"err\">'</span>\n<span class=\"w\">    </span><span class=\"o\">{</span>ğ•œ<span class=\"w\"> </span>E<span class=\"w\"> </span>Fâ‚—<span class=\"w\"> </span>:<span class=\"w\"> </span>Type*<span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span>NormedAddCommGroup<span class=\"w\"> </span>E<span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span>NormedAddCommGroup<span class=\"w\"> </span>Fâ‚—<span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span>NontriviallyNormedField<span class=\"w\"> </span>ğ•œ<span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span>NormedSpace<span class=\"w\"> </span>ğ•œ<span class=\"w\"> </span>E<span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span>NormedSpace<span class=\"w\"> </span>ğ•œ<span class=\"w\"> </span>Fâ‚—<span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span>c<span class=\"w\"> </span>:<span class=\"w\"> </span>E<span class=\"w\"> </span>â†’L<span class=\"o\">[</span>ğ•œ<span class=\"o\">]</span><span class=\"w\"> </span>ğ•œ<span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span>Nontrivial<span class=\"w\"> </span>Fâ‚—<span class=\"o\">]</span><span class=\"w\"> </span>:\n<span class=\"w\">    </span>â€–<span class=\"o\">(</span>smulRightL<span class=\"w\"> </span>ğ•œ<span class=\"w\"> </span>E<span class=\"w\"> </span>Fâ‚—<span class=\"o\">)</span><span class=\"w\"> </span>câ€–<span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span>â€–câ€–<span class=\"w\"> </span>:<span class=\"o\">=</span><span class=\"w\"> </span>by<span class=\"w\"> </span>simp\nbuzzard@IC-HWDXTW69VR<span class=\"w\"> </span>Mathlib<span class=\"w\"> </span>%<span class=\"w\"> </span>lake<span class=\"w\"> </span>build<span class=\"w\"> </span>Mathlib/test2.lean<span class=\"w\"> </span>&gt;<span class=\"w\"> </span>test2.out\nbuzzard@IC-HWDXTW69VR<span class=\"w\"> </span>Mathlib<span class=\"w\"> </span>%<span class=\"w\"> </span>grep<span class=\"w\"> </span><span class=\"s2\">\"\\[Meta.synthInstance\\]\"</span><span class=\"w\"> </span>test2.out\n<span class=\"o\">[</span>very<span class=\"w\"> </span>large<span class=\"w\"> </span>amount<span class=\"w\"> </span>of<span class=\"w\"> </span>output<span class=\"w\"> </span>suppressed<span class=\"o\">]</span>\n</code></pre></div>\n<p>Is this at all helpful?</p>",
        "id": 525037534,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1750423978
    },
    {
        "content": "<p>Yes, definitely helpful! Grepping through a file like that which will be much more efficient than clicking on arrows in VSCode :-)</p>",
        "id": 525039543,
        "sender_full_name": "SÃ©bastien GouÃ«zel",
        "timestamp": 1750424793
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 525039557,
        "sender_full_name": "SÃ©bastien GouÃ«zel",
        "timestamp": 1750424799
    },
    {
        "content": "<p>The trace is 1736 kB before my PR on Riemannian manifolds, and 1739 kB afterwards. And the timings are very much comparable. It doesn't look like a crazy exponential blow up (but still enough to make the <code>simpNF</code> linter reach a deterministic timeout)!</p>",
        "id": 525040614,
        "sender_full_name": "SÃ©bastien GouÃ«zel",
        "timestamp": 1750425222
    }
]