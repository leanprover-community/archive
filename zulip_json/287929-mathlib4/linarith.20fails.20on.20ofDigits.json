[
    {
        "content": "<p>In this example, linarith fails:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">extracted_1</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">ofDigits</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">[])</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">ofDigits</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">[])</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"c1\">-- set s := ofDigits 2 [] -- works with this line</span>\n<span class=\"w\">  </span><span class=\"n\">linarith</span><span class=\"w\"> </span><span class=\"c1\">-- fails</span>\n</code></pre></div>\n<p>I would expect both sides to process <code>Nat.ofDigits 2 []</code> into an atom and solve the goal that way. Why does this not happen?</p>",
        "id": 521396345,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1748656803
    },
    {
        "content": "<p>Looking at the output with <code>set_option trace.linarith true</code>, there's some process where the <code>Nat.ofDigits</code> are transformed into returning <code>Int</code>. Maybe something is going wrong after that?</p>\n<p>In any case, <code>omega</code> can solve this.</p>",
        "id": 521397974,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1748658255
    },
    {
        "content": "<p>Interestingly, omega does not solve the issue this was minimized from.</p>",
        "id": 521398022,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1748658332
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">extracted_1</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">ofDigits</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">([</span><span class=\"mi\">0</span><span class=\"o\">])</span><span class=\"bp\">.</span><span class=\"n\">reverse</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ofDigits</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">([</span><span class=\"mi\">0</span><span class=\"o\">])</span><span class=\"bp\">.</span><span class=\"n\">reverse</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">([</span><span class=\"mi\">0</span><span class=\"o\">])</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">omega</span><span class=\"w\"> </span><span class=\"c1\">--fails</span>\n</code></pre></div>",
        "id": 521398231,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1748658503
    }
]