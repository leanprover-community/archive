[
    {
        "content": "<p>When a comment references a module, for it to be clickable in the docs it needs to look like <code>Mathlib/Data/List/Basic.lean</code> rather than any of these similar alternatives:</p>\n<ul>\n<li><code>Mathlib/Data/List/Basic</code></li>\n<li><code>Data/List/Basic.lean</code></li>\n<li><code>Mathlib.Data.List.Basic</code></li>\n<li><code>Data.List.Basic</code></li>\n</ul>\n<p>I <a href=\"https://github.com/leanprover-community/mathlib4/pull/29653/commits/4e979ba02cc07fed122e673e953e1a91a7b53e0b\">fixed 2</a> but I suspect there are a lot more, not to mention references to modules that don't exist anymore.<br>\nIs it possible to lint against it, or maybe use an LLM to find and fix all such references?</p>",
        "id": 553461495,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1762196897
    },
    {
        "content": "<p>You'd want to both lint against it, and fix all current cases. The linting could happen (not now, but in the medium term) by converting all doc-strings to verso, which also checks for other errors. Until then, PRs fixing these violations are welcome.</p>",
        "id": 553462489,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1762197290
    },
    {
        "content": "<p>If you make a LLM-generated PR, please disclose this very clearly, and verify all output manually (so you could vouch for it yourself).</p>",
        "id": 553462618,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1762197339
    },
    {
        "content": "<p>This seems like something that could be done much more reliably by what old people like myself called \"a script\"</p>",
        "id": 553467089,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1762198960
    },
    {
        "content": "<p>And note that (3) also works if you already import the module in question</p>",
        "id": 553467209,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1762198990
    },
    {
        "content": "<p>And once we move to verso, I understand we're getting a new syntax anyway</p>",
        "id": 553467383,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1762199017
    },
    {
        "content": "<p>One other thing to watch out for: sometimes the module name is just wrong</p>",
        "id": 553467511,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1762199045
    },
    {
        "content": "<p>And sometimes something that looks like a module name really is a namespace name</p>",
        "id": 553483358,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1762205103
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Module.20references.20in.20comments/near/553467089\">said</a>:</p>\n<blockquote>\n<p>This seems like something that could be done much more reliably by what old people like myself called \"a script\"</p>\n</blockquote>\n<p>That might work for easy cases like the ones I mentioned, e.g. a simple regex led me to <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Int/Cast/Basic.html\">Mathlib.Data.Int.Cast.Basic</a> which references 3 modules of which 1 is broken since it isn't imported.</p>\n<p>But in general I want to find things that were <em>intended</em> to be references, which don't necessarily fit any pattern, which is where an LLM can help. For example, \"for more info see the Lemmas module\". In any case, I don't subscribe to any LLMs so it was more of an open invitation for anyone who wants to do it.</p>",
        "id": 553498313,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1762212060
    },
    {
        "content": "<p>A related but harder problem is references to declarations, and LLMs might not be able to help there. I recently found <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix.mulVec#doc\">docs#Matrix.mulVec</a> which says \"see <code>col_mulVec</code>\" but I haven't been able to find this mysterious <code>col_mulVec</code> (similarly <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix.vecMul#doc\">docs#Matrix.vecMul</a> mentions <code>row_vecMul</code>).<br>\nAlthough searching for valid identifiers surrounded by backticks might be a good approximation, maybe with a minimum length of 3 to exclude things which are meant to be variable names (e.g. <code>n</code> <code>v</code> <code>i</code> <code>hIsCycle</code>).</p>",
        "id": 553498337,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1762212072
    },
    {
        "content": "<p>Verso will really help with declaration references.</p>",
        "id": 553551207,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1762244871
    },
    {
        "content": "<p>I did have code to search for valid identifiers surrounded by backticks. There were a number of very short false positives, but for long strings, it would probably work well. I could try to dig up my code; going through that list would certainly be welcome!</p>",
        "id": 553551315,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1762244915
    },
    {
        "content": "<p>(<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix.replicateCol_mulVec#doc\">docs#Matrix.replicateCol_mulVec</a> is the lemma that went missing)</p>",
        "id": 553732999,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1762297787
    },
    {
        "content": "<p>I have a related draft PR here: <a href=\"https://github.com/leanprover-community/mathlib4/pull/32025\">#32025</a></p>\n<p>This PR moves from (mostly non-functioning) module refs to functioning file refs in cases where it was unequivocally clear to me that the author intended to be referencing the file as opposed to the module. Do people in this thread deem this useful?</p>\n<p>The PR was split out of a larger automated replacement of references, <a href=\"https://github.com/leanprover-community/mathlib4/pull/31972\">#31972</a>, that I was experimenting with before I realized, as <span class=\"user-mention\" data-user-id=\"307953\">@Ruben Van de Velde</span>  pointed out, that not all module refs are non-functioning.</p>\n<p>I guess I could turn this larger PR into one that at least gives all module refs a _chance_ at working, by prefixing <code>Mathlib.</code> where that is missing. From there, one could look more closely at detecting links that fail due to missing imports.</p>",
        "id": 558998065,
        "sender_full_name": "Harald Husum",
        "timestamp": 1763978745
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"767479\">Harald Husum</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Module.20references.20in.20comments/near/558998065\">said</a>:</p>\n<blockquote>\n<p>Do people in this thread deem this useful?</p>\n</blockquote>\n<p>Yes! tbh I was hoping you would try this, as you have experience with LLM PRs, thanks :)</p>\n<p><span class=\"user-mention silent\" data-user-id=\"767479\">Harald Husum</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Module.20references.20in.20comments/near/558998065\">said</a>:</p>\n<blockquote>\n<p>I guess I could turn this larger PR into one that at least gives all module refs a _chance_ at working, by prefixing <code>Mathlib.</code> where that is missing. From there, one could look more closely at detecting links that fail due to missing imports.</p>\n</blockquote>\n<p>I like this approach, but IIUC we have to wait for Verso to be integrated to be able to detect the failures, and idk what's the timeline on that</p>",
        "id": 560012694,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1764017263
    }
]