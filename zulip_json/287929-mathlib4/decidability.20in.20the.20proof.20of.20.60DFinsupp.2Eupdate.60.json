[
    {
        "content": "<p>This is probably a very minor thing/perhaps I am misreading, but I noticed I noticed that <code>DFinsupp.update</code> uses <code>eq_or_ne</code> instead of <code>Decidable.eq_or_ne</code> even though there was a <code>DecidableEq</code> instance in the hypothesis. When I navigate to the definition of <code>eq_or_ne</code>, it takes me to the classical version of it instead of the decidable one. Is there a reason to use <code>eq_or_ne</code> here, or am I misreading it somehow?</p>\n<p>I've attached the version of <code>DFinsupp.update</code> that I have locally below (along with the hypotheses that it apparently uses):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">update</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Zero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">Π₀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">Π₀</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">⟨</span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">update</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">support'</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"bp\">⟨</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">::ₘ</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"n\">rcases</span><span class=\"w\"> </span><span class=\"n\">eq_or_ne</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">hi</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">        </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"n\">hj</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hj</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">prop</span><span class=\"w\"> </span><span class=\"n\">j</span>\n<span class=\"w\">          </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Or</span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">mem_cons_of_mem</span><span class=\"w\"> </span><span class=\"n\">hj</span><span class=\"o\">)</span>\n<span class=\"w\">          </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Or</span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">update_of_ne</span><span class=\"w\"> </span><span class=\"n\">hi</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"n\">hj</span><span class=\"o\">)</span><span class=\"bp\">⟩⟩</span>\n</code></pre></div>",
        "id": 568475645,
        "sender_full_name": "Kin Yau James Wong",
        "timestamp": 1768581259
    },
    {
        "content": "<p>The reason is that very few people want to bother with using decidability</p>",
        "id": 568479758,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1768582430
    },
    {
        "content": "<p>But it is already included in the hypothesis anyways <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 568479909,
        "sender_full_name": "Kin Yau James Wong",
        "timestamp": 1768582473
    },
    {
        "content": "<p>You should read Ruben's message as \"no one previously cared about it in this case\" as opposed to \"this change is a bad idea, do not make it\".</p>",
        "id": 568480208,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1768582571
    },
    {
        "content": "<p>(though your subtext of \"this would be a bad idea if we had to add an extra hypothesis\" is also largely the community opinion)</p>",
        "id": 568480314,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1768582606
    },
    {
        "content": "<p>Well, I <em>also</em> mean \"please don't make a PR that someone would need to review\"</p>",
        "id": 568480903,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1768582792
    },
    {
        "content": "<p>Ah ok I understand - so no action required?</p>",
        "id": 568481515,
        "sender_full_name": "Kin Yau James Wong",
        "timestamp": 1768582984
    },
    {
        "content": "<p>My opinion is no action required</p>",
        "id": 568489569,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1768585417
    },
    {
        "content": "<p>As far as I understand, the policy is: unless there is a result that someone really wants to see formalized without <code>Classical.choice</code>, we don't bother reducing dependencies.</p>",
        "id": 568533458,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1768601985
    },
    {
        "content": "<p>If there is such result, the way to do it is</p>\n<ul>\n<li>recover from Zulip archives or write a linter (or an attribute) that will check that a given declaration doesn't depend on <code>Classical.choice</code>;</li>\n<li>put this tag on the theorem you really care about;</li>\n<li>get rid of <code>Classical.choice</code> in the dependencies of this theorem.</li>\n</ul>",
        "id": 568533660,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1768602100
    },
    {
        "content": "<p>For all other results,</p>\n<ul>\n<li>we assume decidability in definitions, if it's required to make them computable <strong>and</strong> we want them to be computable;</li>\n<li>we assume decidability in theorems, if it's required to <strong>state</strong> the theorem; otherwise, we use <code>classical</code> in the proof.</li>\n</ul>",
        "id": 568533852,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1768602194
    }
]