[
    {
        "content": "<p>Hi again,<br>\nI am having issues with my PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/30130\">#30130</a> where I just changed some normal mathlib files, but <a href=\"https://github.com/leanprover-community/mathlib4/actions/runs/18709979266/job/53355873698?pr=30130\">CI</a> complains about missing definitions in tactic files. I tried merging master, but it didn't help. I am out of my depth here, so I'd appreaciate someone looking at it to show me what went wrong.    <br>\n(I would have posted this in my thread from yesterday but I can't find it).</p>",
        "id": 546398628,
        "sender_full_name": "Christian Krause",
        "timestamp": 1761122836
    },
    {
        "content": "<p>The error is</p>\n<blockquote>\n<p>error: Mathlib/Tactic/ReduceModChar.lean:74:14: failed to compile definition, compiler IR check failed at <code>normIntNumeral'</code>. Error: depends on declaration 'Tactic.ReduceModChar.normBareNumeral', which has no executable code; consider marking definition as 'noncomputable'</p>\n</blockquote>",
        "id": 546399486,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761123102
    },
    {
        "content": "<p>I can reproduce the error locally.</p>",
        "id": 546400948,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1761123537
    },
    {
        "content": "<p>I suspect that the tactic file imports the files with your changes and something there is affecting the tactic.</p>",
        "id": 546401056,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1761123565
    },
    {
        "content": "<p><code>ReduceModChar</code> I think uses <code>smul</code>.  I wonder if your new <code>smul</code> instances is confusing the tactic.</p>",
        "id": 546401379,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1761123652
    },
    {
        "content": "<p>Ohh ok, I suppose it has something to do with the changes in Mathlib/GroupTheory/GroupAction/Defs.lena. I'll try to find out what is going on.</p>",
        "id": 546403519,
        "sender_full_name": "Christian Krause",
        "timestamp": 1761124274
    },
    {
        "content": "<p>I am not sure, actually, since even reverting these changes does not seem to fix the error, at least locally.</p>",
        "id": 546403900,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1761124376
    },
    {
        "content": "<p>Ok, but Mathlib/GroupTheory/FreeGroup/Orbit.lean is just importet in Mathlib.lean, Mathlib/RingTheory/Kaehler/TensorProduct.lean is just changing a proof and Mathlib/Dynamics/Flow.lean is surely not relevant...?</p>",
        "id": 546404208,
        "sender_full_name": "Christian Krause",
        "timestamp": 1761124464
    },
    {
        "content": "<p>I agree that if the files are not imported by the tactic one, they should not affect it.  I am not really understanding what is going on.</p>",
        "id": 546404436,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1761124534
    },
    {
        "content": "<p><del>I tried replacing the beta i introduced  with a new variable gamma in Action/Defs.lean (because beta is used later in the file and maybe this is something about explicit vs implicit arguments). Otherwise I have no idea...</del> (I just realized that this should not fix the error because reverting all the changes doesn't fix it...)</p>",
        "id": 546404978,
        "sender_full_name": "Christian Krause",
        "timestamp": 1761124715
    },
    {
        "content": "<p>I don't know enough about <code>Qq</code> to know what it might be synthesizing and where it might get stuck.  I'll ping <span class=\"user-mention\" data-user-id=\"238446\">@Anne Baanen</span>, as the author of the <code>ReduceModChar</code> tactic!</p>",
        "id": 546405821,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1761124961
    },
    {
        "content": "<p>This also happens in bors right now: <a href=\"https://github.com/leanprover-community/mathlib4/actions/runs/18710984072/job/53359169237\">https://github.com/leanprover-community/mathlib4/actions/runs/18710984072/job/53359169237</a></p>",
        "id": 546407295,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1761125353
    },
    {
        "content": "<p>and it also happened to <span class=\"user-mention\" data-user-id=\"679664\">@Stefan Kebekus</span> in <a href=\"https://github.com/leanprover-community/mathlib4/pull/30630\">#30630</a>, but he closed the PR and reopened a new one instead of reporting <span aria-label=\"sad\" class=\"emoji emoji-2639\" role=\"img\" title=\"sad\">:sad:</span></p>",
        "id": 546407496,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1761125407
    },
    {
        "content": "<p>(nothing against you, Stefan, but in the face of an error you don't understand, the primary instinct should be to go complain on Zulip, not shuffle things around across PRs)</p>",
        "id": 546407970,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1761125559
    },
    {
        "content": "<p>So random PRs appear to be affected but not master?</p>",
        "id": 546414225,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1761127392
    },
    {
        "content": "<p>Might be a <code>cache</code> bug around the new .ir files</p>",
        "id": 546414286,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1761127412
    },
    {
        "content": "<p>It looks like bors is unable to merge anything, since it runs into this issue.</p>",
        "id": 546414312,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1761127421
    },
    {
        "content": "<p>It would be great if someone could confirm building from scratch fixes things - just has to be up to a broken file</p>",
        "id": 546414434,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1761127473
    },
    {
        "content": "<p>I also just confirmed that the cache on master works.</p>",
        "id": 546414476,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1761127488
    },
    {
        "content": "<p>In the context of the PR above, I did a rebuild by reverting to master a file upstream of where the error was, running <code>lake build</code> and still getting errors.</p>",
        "id": 546414683,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1761127552
    },
    {
        "content": "<p>I did not however build from scratch.</p>",
        "id": 546414736,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1761127567
    },
    {
        "content": "<p>I'm having a similar issue with my PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/29960\">#29960</a> with error message</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">MeasureTheory</span><span class=\"bp\">/</span><span class=\"n\">Integral</span><span class=\"bp\">/</span><span class=\"n\">Bochner</span><span class=\"bp\">/</span><span class=\"n\">Basic</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">1442</span><span class=\"o\">:</span><span class=\"mi\">2</span><span class=\"o\">:</span>\n<span class=\"o\">(</span><span class=\"n\">interpreter</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">unknown</span><span class=\"w\"> </span><span class=\"n\">declaration</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">Positivity</span><span class=\"bp\">.</span><span class=\"n\">evalIntegral'</span>\n</code></pre></div>\n<p>Locally in the master branch with <code>lake exe cache get</code>, adding anything to <code>Mathlib.LinearAlgebra.TensorProduct.Tower</code> gives me the same error if I do <code>lake build Mathlib.MeasureTheory.Integral.Bochner.Basic</code>.</p>",
        "id": 546415280,
        "sender_full_name": "Yong-Gyu Choi",
        "timestamp": 1761127759
    },
    {
        "content": "<p>I did the rebuild:</p>\n<ul>\n<li>I checked out the PR above,</li>\n<li>removed the <code>.lake</code> dir and</li>\n<li>built the tactic file.</li>\n</ul>\n<p>Now there are no errors.</p>",
        "id": 546416656,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1761128145
    },
    {
        "content": "<p>Thanks! So we should likely revert the cache changes as well as all package bumps related to it for now</p>",
        "id": 546416922,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1761128227
    },
    {
        "content": "<p>Which changes are these exactly? Is it <a href=\"https://github.com/leanprover-community/mathlib4/pull/30772\">#30772</a>?</p>",
        "id": 546422249,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1761129812
    },
    {
        "content": "<p>I believe so. Reverting the toolchain should be optional but it doesn't hurt.</p>",
        "id": 546422588,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1761129923
    },
    {
        "content": "<p>This does not include the changes to cache but that too should be okay as long as no dependencies make use of the module system</p>",
        "id": 546423630,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1761130225
    },
    {
        "content": "<p>Thanks, I've opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/30785\">#30785</a>.</p>",
        "id": 546424431,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1761130462
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 546429081,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1761131737
    },
    {
        "content": "<p>I've put it on the queue after the currently running batch. If anyone objects, I can take it off again.</p>",
        "id": 546430604,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1761132086
    },
    {
        "content": "<p>Unfortunately the builds are still failing: <a href=\"https://github.com/leanprover-community/mathlib4/actions/runs/18716744507/job/53377985563\">https://github.com/leanprover-community/mathlib4/actions/runs/18716744507/job/53377985563</a></p>\n<p>Do we need to go back further?</p>",
        "id": 546455276,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1761138944
    },
    {
        "content": "<p>Should we revert <a href=\"https://github.com/leanprover-community/mathlib4/pull/30740\">#30740</a> and <a href=\"https://github.com/leanprover-community/mathlib4/pull/30748\">#30748</a> perhaps?</p>",
        "id": 546455556,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1761139028
    },
    {
        "content": "<p>It might be, I only just learned that the rc1 bump already included some modulized packages. I'm taking a look at the specific failure right now but that doesn't have to delay reverting.</p>",
        "id": 546456069,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1761139172
    },
    {
        "content": "<p>OK, I've put <a href=\"https://github.com/leanprover-community/mathlib4/pull/30788\">#30788</a> on the queue.</p>",
        "id": 546456877,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1761139373
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> The root issue seems to be that all <code>.olean.server/private</code> files fetched from the cache are (almost) empty</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"gp\">$ </span>ls<span class=\"w\"> </span>-lh<span class=\"w\"> </span>.lake/packages/plausible/.lake/build/lib/lean/Plausible/DeriveArbitrary.*\n<span class=\"go\">-rw-rw-r-- 1 sebastian sebastian  28K Oct 22 15:11 .lake/packages/plausible/.lake/build/lib/lean/Plausible/DeriveArbitrary.ilean</span>\n<span class=\"go\">-rw-rw-r-- 1 sebastian sebastian   16 Oct 22 15:11 .lake/packages/plausible/.lake/build/lib/lean/Plausible/DeriveArbitrary.ilean.hash</span>\n<span class=\"go\">-rw-rw-r-- 1 sebastian sebastian 639K Oct 22 15:11 .lake/packages/plausible/.lake/build/lib/lean/Plausible/DeriveArbitrary.ir</span>\n<span class=\"go\">-rw-rw-r-- 1 sebastian sebastian   16 Oct 22 15:11 .lake/packages/plausible/.lake/build/lib/lean/Plausible/DeriveArbitrary.ir.hash</span>\n<span class=\"go\">-rw-rw-r-- 1 sebastian sebastian  25K Oct 22 15:11 .lake/packages/plausible/.lake/build/lib/lean/Plausible/DeriveArbitrary.olean</span>\n<span class=\"go\">-rw-rw-r-- 1 sebastian sebastian   16 Oct 22 15:11 .lake/packages/plausible/.lake/build/lib/lean/Plausible/DeriveArbitrary.olean.hash</span>\n<span class=\"go\">-rw-rw-r-- 1 sebastian sebastian   96 Oct 22 15:11 .lake/packages/plausible/.lake/build/lib/lean/Plausible/DeriveArbitrary.olean.private</span>\n<span class=\"go\">-rw-rw-r-- 1 sebastian sebastian   16 Oct 22 15:11 .lake/packages/plausible/.lake/build/lib/lean/Plausible/DeriveArbitrary.olean.private.hash</span>\n<span class=\"go\">-rw-rw-r-- 1 sebastian sebastian   96 Oct 22 15:11 .lake/packages/plausible/.lake/build/lib/lean/Plausible/DeriveArbitrary.olean.server</span>\n<span class=\"go\">-rw-rw-r-- 1 sebastian sebastian   16 Oct 22 15:11 .lake/packages/plausible/.lake/build/lib/lean/Plausible/DeriveArbitrary.olean.server.hash</span>\n<span class=\"go\">-rw-rw-r-- 1 sebastian sebastian  247 Oct 22 15:11 .lake/packages/plausible/.lake/build/lib/lean/Plausible/DeriveArbitrary.trace</span>\n<span class=\"gp\">$ </span>ls<span class=\"w\"> </span>-lh<span class=\"w\"> </span>.lake2/packages/plausible/.lake/build/lib/lean/Plausible/DeriveArbitrary.*\n<span class=\"go\">-rw-rw-r-- 1 sebastian sebastian  28K Oct 22 15:12 .lake2/packages/plausible/.lake/build/lib/lean/Plausible/DeriveArbitrary.ilean</span>\n<span class=\"go\">-rw-rw-r-- 1 sebastian sebastian   16 Oct 22 15:12 .lake2/packages/plausible/.lake/build/lib/lean/Plausible/DeriveArbitrary.ilean.hash</span>\n<span class=\"go\">-rw-rw-r-- 1 sebastian sebastian 639K Oct 22 15:12 .lake2/packages/plausible/.lake/build/lib/lean/Plausible/DeriveArbitrary.ir</span>\n<span class=\"go\">-rw-rw-r-- 1 sebastian sebastian   16 Oct 22 15:12 .lake2/packages/plausible/.lake/build/lib/lean/Plausible/DeriveArbitrary.ir.hash</span>\n<span class=\"go\">-rw-rw-r-- 1 sebastian sebastian  25K Oct 22 15:12 .lake2/packages/plausible/.lake/build/lib/lean/Plausible/DeriveArbitrary.olean</span>\n<span class=\"go\">-rw-rw-r-- 1 sebastian sebastian   16 Oct 22 15:12 .lake2/packages/plausible/.lake/build/lib/lean/Plausible/DeriveArbitrary.olean.hash</span>\n<span class=\"go\">-rw-rw-r-- 1 sebastian sebastian 1.2M Oct 22 15:12 .lake2/packages/plausible/.lake/build/lib/lean/Plausible/DeriveArbitrary.olean.private</span>\n<span class=\"go\">-rw-rw-r-- 1 sebastian sebastian   16 Oct 22 15:12 .lake2/packages/plausible/.lake/build/lib/lean/Plausible/DeriveArbitrary.olean.private.hash</span>\n<span class=\"go\">-rw-rw-r-- 1 sebastian sebastian 8.0K Oct 22 15:12 .lake2/packages/plausible/.lake/build/lib/lean/Plausible/DeriveArbitrary.olean.server</span>\n<span class=\"go\">-rw-rw-r-- 1 sebastian sebastian   16 Oct 22 15:12 .lake2/packages/plausible/.lake/build/lib/lean/Plausible/DeriveArbitrary.olean.server.hash</span>\n<span class=\"go\">-rw-rw-r-- 1 sebastian sebastian 2.7K Oct 22 15:12 .lake2/packages/plausible/.lake/build/lib/lean/Plausible/DeriveArbitrary.trace</span>\n</code></pre></div>\n<p>Second directory is from a local build</p>",
        "id": 546458012,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1761139656
    },
    {
        "content": "<p>What's the right way of making the build depend on a new version of a bad cache file? I've hit this error twice now:</p>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/actions/runs/18720505499/job/53397344367#step:8:19\">https://github.com/leanprover-community/mathlib4/actions/runs/18720505499/job/53397344367#step:8:19</a></p>\n<p>After downloading the cache, in the step checking that <code>lake build --no-build</code> works:</p>\n<blockquote>\n<p>âœ– [2/755] Building Mathlib.Tactic.Linter.Header<br>\nerror: target is out-of-date and needs to be rebuilt</p>\n</blockquote>\n<p>The first time I tried to fix it by adding some whitespace to the aforementioned file, but I guess that wasn't enough?</p>",
        "id": 546497408,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1761148995
    },
    {
        "content": "<p>Ah, I guess I added the whitespace to the module doc. Maybe adding it to a docstring would have worked.</p>",
        "id": 546497888,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1761149105
    },
    {
        "content": "<p>Hmm, I'm surprised this happens even with the revert</p>",
        "id": 546507165,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1761152041
    },
    {
        "content": "<p>Ran into the same error again: <a href=\"https://github.com/leanprover-community/mathlib4/actions/runs/18723044360/job/53404947721?pr=30788#step:8:19\">https://github.com/leanprover-community/mathlib4/actions/runs/18723044360/job/53404947721?pr=30788#step:8:19</a></p>\n<p>Not sure what to do at this point -- I could merge this manually, but I'm afraid of leaving <code>master</code> on a state with a broken cache file.</p>",
        "id": 546519332,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1761155972
    },
    {
        "content": "<p>I guess the big mystery to me is why nothing is still being uploaded in the cache upload steps -- they all seem to be rejected because they are already present. Have I still not managed to tweak the code enough to generate new oleans?</p>",
        "id": 546521306,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1761156565
    },
    {
        "content": "<p>Ah, maybe the issue is that the changes to Cache on <code>master</code> make it impossible to properly verify the build from the PR branch? I guess the PRs I'm trying to revert were both merged into <code>master</code> without going through <code>bors</code> as well.</p>",
        "id": 546523290,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1761157201
    },
    {
        "content": "<p>I'll revert the whitespace changes I made and then merge <a href=\"https://github.com/leanprover-community/mathlib4/pull/30788\">#30788</a> manually -- feel free to tell me this is a bad idea!</p>",
        "id": 546523911,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1761157384
    },
    {
        "content": "<p>Done. <code>master</code> is building now, if the cache is still broken here then I'm really out of ideas.</p>",
        "id": 546525280,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1761157799
    },
    {
        "content": "<p>Someone advised me NOT to merge this into downstream projects yet due to some bug with continuous integration. See eg <a href=\"https://github.com/emilyriehl/infinity-cosmos/pull/142\">this PR</a> which didn't generate any checks. Or should I not worry about this and merge anyway?</p>",
        "id": 546528582,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1761158803
    },
    {
        "content": "<p>There were some issues with the mathlib cache with v4.25.0-rc2 so I have moved mathlib back to v4.24.0; I would recommend also holding off on upgrading to v4.25.0-rc2 until at least after Kim gets back online to advise.</p>\n<p>(I think the fact that the auto-generated PR didn't generate any checks is probably unrelated to the version bump. <a class=\"stream\" data-stream-id=\"113486\" href=\"/#narrow/channel/113486-announce\">#announce</a> is probably not the place to discuss it though.)</p>",
        "id": 546530299,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1761159434
    },
    {
        "content": "<p>2 messages were moved here from <a class=\"stream-topic\" data-stream-id=\"113486\" href=\"/#narrow/channel/113486-announce/topic/releases.20of.20new.20Lean.20versions/with/546367288\">#announce &gt; releases of new Lean versions</a> by <span class=\"user-mention silent\" data-user-id=\"130384\">Riccardo Brasca</span>.</p>",
        "id": 546531045,
        "sender_full_name": "Notification Bot",
        "timestamp": 1761159689
    },
    {
        "content": "<p>This is the right topic, isn't it?</p>",
        "id": 546531113,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1761159707
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"130384\">@Riccardo Brasca</span> I think those messages were fine in the announce topic -- it's probably a good idea to let people know there are currently some issues with mathlib's cache and v4.25.0-rc2. I just meant I didn't want to get into a discussion about the CI in that thread.</p>",
        "id": 546532615,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1761160197
    },
    {
        "content": "<p>I didn't think about that, would you mind write some sort of \"official\" message in the announce topic? It seems more appropriate that Emily's question.</p>",
        "id": 546532849,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1761160291
    },
    {
        "content": "<p><del>Unfortunately it looks like the build on <code>master</code> failed with the same cache error: <a href=\"https://github.com/leanprover-community/mathlib4/actions/runs/18723067296/job/53405707259\">https://github.com/leanprover-community/mathlib4/actions/runs/18723067296/job/53405707259</a> </del></p>\n<p>I'll hold off from making any more changes until Kim or Sebastian are back.</p>\n<p><strong>edit</strong>: just checked again and <code>master</code> is actually green. I was looking at the wrong tab above, whoops!</p>",
        "id": 546532916,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1761160317
    },
    {
        "content": "<p>Thanks for moving the message. I never know which channel to use. Is there a users guide somewhere ;)?</p>",
        "id": 546538485,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1761162363
    },
    {
        "content": "<p>We are somehow strict only with <a class=\"stream\" data-stream-id=\"113486\" href=\"/#narrow/channel/113486-announce\">#announce</a> , that we try to keep as small as possible (literally just the announcement, without any discussion). Anyway no worries!</p>",
        "id": 546538795,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1761162479
    },
    {
        "content": "<p>Often there is a discussion topic for anything being announced.</p>",
        "id": 546539046,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1761162549
    },
    {
        "content": "<p>Is it fixed now? I see some PR's merging master</p>",
        "id": 546542548,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761163830
    },
    {
        "content": "<p>I hope so, but I'm a bit hesitant to declare victory until someone can explain what exactly went wrong.</p>",
        "id": 546544001,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1761164280
    },
    {
        "content": "<p>I think troubles with merging the fix are likely from the split cache executable setup in CI that makes it depend on the state of both the PR and master, though I can't completely explain it either</p>",
        "id": 546551152,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1761167182
    },
    {
        "content": "<p>Okay, just arriving here after a good night's sleep. :-)</p>\n<p>Here's I think the plan:</p>\n<ul>\n<li><span aria-label=\"check\" class=\"emoji emoji-2705\" role=\"img\" title=\"check\">:check:</span> I'm going to delete the existing <code>v4.25.0-rc1</code> and <code>v4.25.0-rc2</code> tags from Mathlib/repl/Cslib now.</li>\n<li><span aria-label=\"check\" class=\"emoji emoji-2705\" role=\"img\" title=\"check\">:check:</span> We make sure the announcement thread has a warning that people shouldn't be bumping their Mathlib dependencies past <code>v4.24.0</code> for now.</li>\n<li>[ ] <a href=\"https://github.com/leanprover-community/mathlib4/pull/30805\">#30805</a> In the Mathlib CI step, when we verify that the cache works, we should change <code>lake build --no-build</code> to <code>lake build --no-build --rehash</code>. This would have detected the underlying problem, and alerted us to the bug in leantar.</li>\n<li>[ ] We need to fix the <a href=\"#narrow/channel/287929-mathlib4/topic/Build.20error.20in.20Tactic.20file/near/546458012\">problem</a> in leantar (it produces the wrong <code>.olean.server</code> and <code>.olean.private</code> files).</li>\n<li>[ ] We can then re-merge <a href=\"https://github.com/leanprover-community/mathlib4/pull/30740\">#30740</a>, <a href=\"https://github.com/leanprover-community/mathlib4/pull/30748\">#30748</a>, <a href=\"https://github.com/leanprover-community/mathlib4/pull/30772\">#30772</a> (i.e. revert the revert PRs <a href=\"https://github.com/leanprover-community/mathlib4/pull/30785\">#30785</a> and <a href=\"https://github.com/leanprover-community/mathlib4/pull/30788\">#30788</a>), but remembering to update to the new version of leantar. Probably as with these PRs, we are going to have to squash merge by hand, as CI will still be confused by the change in behaviour in <code>cache</code> contained in the PR.</li>\n<li>[ ] We then just re-tag Mathlib with <code>v4.25.0-rc2</code> (perhaps waiting until one more PR successfully lands?).</li>\n<li>[ ] We run <code>lake update</code> in repl and Cslib and retag those.</li>\n<li>[ ] We update the announcement thread.</li>\n</ul>",
        "id": 546563514,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761173828
    },
    {
        "content": "<p>One piece of confusion today has been PRs from branches with a toolchain differing from Mathlib. Could we check for this in a pull request workflow and suggest to merge master? Today is an exceptional situation in having a toolchain reversion, but this seems more generally relevant for older PRs too.</p>",
        "id": 546566345,
        "sender_full_name": "Chris Henson",
        "timestamp": 1761175740
    },
    {
        "content": "<p>In the past we've decided this was too much churn, and given that most PRs merge just fine even across toolchain changes, this wasn't worth it.</p>",
        "id": 546566410,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761175787
    },
    {
        "content": "<p>But on days like today, it would be nice to be more conservative!</p>",
        "id": 546566443,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761175803
    },
    {
        "content": "<p>I figured it had been discussed, and I agree that it is relatively uncommon. I think it could be minimally invasive if it is just a comment on the PR along the lines of  \"If this PR is potentially toolchain sensitive (<code>grind</code>, <code>simp</code>, etc.) consider merging master\". If the consensus changes, feel free to ping me to add this.</p>",
        "id": 546567291,
        "sender_full_name": "Chris Henson",
        "timestamp": 1761176227
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"687698\">@Chris Henson</span> Ah, I didn't realize you were worried about the toolchain difference when you merged <code>master</code> into <a href=\"https://github.com/leanprover-community/mathlib4/pull/30803\">#30803</a>. Sorry if my message came off as condescending. Let me take your PR off the queue again and delegate.</p>",
        "id": 546567454,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1761176392
    },
    {
        "content": "<p>I've reproduced the <code>leangz</code> problem in the <code>leangz</code> repository itself, and added a (failing) <code>cargo test</code> test case: <a href=\"https://github.com/digama0/leangz/pull/4\">https://github.com/digama0/leangz/pull/4</a></p>",
        "id": 546567486,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761176414
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"123965\">@Bryan Gin-ge Chen</span> No worries. It should be fine I think now, you can leave it on.</p>",
        "id": 546567495,
        "sender_full_name": "Chris Henson",
        "timestamp": 1761176431
    },
    {
        "content": "<p>Okay, Claude says it understands the problem in leangz</p>",
        "id": 546568077,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761176888
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span>, I just put up <a href=\"https://github.com/digama0/leangz/pull/5\">https://github.com/digama0/leangz/pull/5</a>, with Claude's fix.</p>",
        "id": 546568092,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761176900
    },
    {
        "content": "<p>I don't understand, but it's a two line change so hopefully you can say whether it is nonsense or not.</p>",
        "id": 546568121,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761176925
    },
    {
        "content": "<p>If it is nonsense, hopefully <a href=\"https://github.com/digama0/leangz/pull/4\">https://github.com/digama0/leangz/pull/4</a> is still useful as a test case!</p>",
        "id": 546568134,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761176943
    },
    {
        "content": "<p>Can you point me to a bug case?</p>",
        "id": 546568249,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1761177047
    },
    {
        "content": "<p><a class=\"message-link\" href=\"/#narrow/channel/287929-mathlib4/topic/Build.20error.20in.20Tactic.20file/near/546458012\">#mathlib4 &gt; Build error in Tactic file @ ðŸ’¬</a></p>",
        "id": 546568327,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761177115
    },
    {
        "content": "<p>and <a href=\"https://github.com/digama0/leangz/pull/4\">https://github.com/digama0/leangz/pull/4</a> contains 3 explicit oleans which don't roundtrip.</p>",
        "id": 546568352,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761177128
    },
    {
        "content": "<p>Is this on mathlib master?</p>",
        "id": 546568522,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1761177250
    },
    {
        "content": "<p>It was on master but has been reverted.</p>",
        "id": 546568542,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761177263
    },
    {
        "content": "<p>SHA incoming</p>",
        "id": 546568554,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761177274
    },
    {
        "content": "<p>52404eb9d41e2d814169199b4930ff4279847223</p>",
        "id": 546568620,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761177314
    },
    {
        "content": "<p>(I wanted to test leangz on mathlib first before releasing it on master, and finally release a non <code>-pre</code> release)</p>",
        "id": 546568648,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1761177335
    },
    {
        "content": "<p>i.e. if you <code>git checkout 52404eb9d41e2d814169199b4930ff4279847223</code> and <code>lake exe cache get</code> you should see truncated <code>.olean.server</code> and <code>.olean.private</code> files</p>",
        "id": 546568659,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761177350
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Build.20error.20in.20Tactic.20file/near/546568648\">said</a>:</p>\n<blockquote>\n<p>(I wanted to test leangz on mathlib first before releasing it on master, and finally release a non <code>-pre</code> release)</p>\n</blockquote>\n<p>Sorry about moving too quickly, I should have asked you about the \"pre\" status.</p>",
        "id": 546568707,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761177383
    },
    {
        "content": "<p>there is a selftest feature in leangz which is not yet module-aware, that will do a roundtrip of every file in mathlib</p>",
        "id": 546568770,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1761177422
    },
    {
        "content": "<p>but I couldn't test it at the time because there weren't any interesting files to test</p>",
        "id": 546568827,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1761177452
    },
    {
        "content": "<p>IIUC even now there aren't that many module files</p>",
        "id": 546568840,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1761177466
    },
    {
        "content": "<p>There are <em>no</em> module files in Mathlib itself, but on that 52404 commit above, all the dependencies are module files.</p>",
        "id": 546568883,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761177495
    },
    {
        "content": "<p>the added leangz test infrastructure is much appreciated</p>",
        "id": 546569092,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1761177609
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span>: added self-test and ran it on all of the oleans in <code>52404eb</code>, and released v0.1.16-pre4</p>",
        "id": 546579290,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1761186488
    },
    {
        "content": "<p>I've opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/30807\">#30807</a> which reverts <a href=\"https://github.com/leanprover-community/mathlib4/pull/30785\">#30785</a> and <a href=\"https://github.com/leanprover-community/mathlib4/pull/30788\">#30788</a>. Going to sign off for the night soon, so feel free to push the <code>leantar</code> updates, etc. to it and merge while I'm gone.</p>",
        "id": 546581964,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1761188746
    },
    {
        "content": "<p>I've updated <a href=\"https://github.com/leanprover-community/mathlib4/pull/30807\">#30807</a> to use v0.1.16-pre4</p>",
        "id": 546583172,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761189879
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span>, we're <a href=\"https://github.com/leanprover-community/mathlib4/actions/runs/18736547101/job/53444435933?pr=30807#step:24:24\">failing in CI</a> while trying to upload the cache, with:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">uncaught</span><span class=\"w\"> </span><span class=\"n\">exception</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">failure</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/.</span><span class=\"n\">cache</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"n\">leantar</span><span class=\"bp\">-</span><span class=\"mf\">0.1</span><span class=\"bp\">.</span><span class=\"m\">15</span><span class=\"w\"> </span><span class=\"bp\">#</span>\n<span class=\"o\">[</span><span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/.</span><span class=\"n\">cache</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"mi\">1829</span><span class=\"n\">cd72ae91ee2a</span><span class=\"bp\">.</span><span class=\"n\">ltar</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">./.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">trace</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">c</span><span class=\"o\">,</span>\n<span class=\"n\">git</span><span class=\"bp\">=</span><span class=\"n\">mathlib4</span><span class=\"bp\">@</span><span class=\"mi\">3976</span><span class=\"n\">ee441f89218bfb5d49b29dcb0e328e4b2076</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">./.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">olean</span><span class=\"o\">,</span>\n<span class=\"bp\">./.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">olean</span><span class=\"bp\">.</span><span class=\"n\">hash</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">./.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">ilean</span><span class=\"o\">,</span>\n<span class=\"bp\">./.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">ilean</span><span class=\"bp\">.</span><span class=\"n\">hash</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">./.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">ir</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">c</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">./.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">ir</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">hash</span><span class=\"o\">]:</span>\n\n<span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">main'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">project</span><span class=\"bp\">/</span><span class=\"n\">src</span><span class=\"bp\">/</span><span class=\"n\">ltar</span><span class=\"bp\">.</span><span class=\"n\">rs</span><span class=\"o\">:</span><span class=\"mi\">275</span><span class=\"o\">:</span><span class=\"mi\">24</span><span class=\"o\">:</span>\n<span class=\"n\">bad</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">trace</span><span class=\"w\"> </span><span class=\"n\">file</span>\n</code></pre></div>",
        "id": 546588784,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761194221
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> That's master leantar, right? I'd suggest force-merging the leantar update first, then the actual bump should be able to pass regular CI</p>",
        "id": 546596473,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1761199581
    },
    {
        "content": "<p>Done.</p>",
        "id": 546601956,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761202310
    },
    {
        "content": "<p>and trying again on <a href=\"https://github.com/leanprover-community/mathlib4/pull/30807\">#30807</a>.</p>",
        "id": 546602264,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761202466
    },
    {
        "content": "<p>I've merged, let's see what happens on master this time.</p>",
        "id": 546614713,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761206788
    },
    {
        "content": "<p>(cache will be unavailable on master for about 40 minutes)</p>",
        "id": 546615291,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761206972
    },
    {
        "content": "<p>back from climbing, everything seems to have merged, and nothing is on fire!</p>",
        "id": 546643317,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761215333
    }
]