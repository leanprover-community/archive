[
    {
        "content": "<p>This is going to be my first contribution to Mathlib4, so I'd appreciate any guidance on the process and approach.</p>\n<p>I've formalized Robbins' sharp bound for successive differences in the logarithm of the Stirling sequence:</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">∣</mi><mi>log</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mtext>stirlingSeq</mtext><mo stretchy=\"false\">(</mo><mi>k</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo><mo>−</mo><mi>log</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mtext>stirlingSeq</mtext><mo stretchy=\"false\">(</mo><mi>k</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo><mi mathvariant=\"normal\">∣</mi><mo>≤</mo><mfrac><mn>1</mn><mrow><mn>12</mn><mi>k</mi><mo stretchy=\"false\">(</mo><mi>k</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">|\\log(\\text{stirlingSeq}(k+1)) - \\log(\\text{stirlingSeq}(k))| \\leq \\frac{1}{12k(k+1)}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mopen\">(</span><span class=\"mord text\"><span class=\"mord\">stirlingSeq</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">))</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mopen\">(</span><span class=\"mord text\"><span class=\"mord\">stirlingSeq</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose\">))</span><span class=\"mord\">∣</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.3651em;vertical-align:-0.52em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8451em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">12</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span><span class=\"mclose mtight\">)</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.52em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></p>\n<p>This improves the existing bound of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mn>1</mn><mrow><mn>4</mn><msup><mi>k</mi><mn>2</mn></msup></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{1}{4k^2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1901em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8451em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">4</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7463em;\"><span style=\"top:-2.786em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>.</p>\n<p>The Mathlib docs note this sharper bound as \"not yet formalised, noted at <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Analysis/SpecialFunctions/Stirling.html#Stirling.le_factorial_stirling\">Stirling.le_factorial_stirling</a>.</p>\n<p>Link to code:<br>\n<a href=\"https://gist.github.com/FaffyWaffles/e1703b6146d8b743a257ec364a86bde4\">https://gist.github.com/FaffyWaffles/e1703b6146d8b743a257ec364a86bde4</a></p>\n<p>I have several questions...</p>\n<p>I'm planning to add it to Mathlib/Analysis/SpecialFunctions/Stirling.lean, is that the right location?</p>\n<p>I've atomized the proof with many small lemmas. Should I consolidate some of these, or is the preferred approach?</p>\n<p>Are there naming conventions I should follow? (I tried to follow what I saw in existing files)</p>\n<p>I haven't made a PR yet, as I wanted to get feedback first. Happy to make any changes needed to fit Mathlib standards.</p>\n<p>Thanks for your help!</p>",
        "id": 547951682,
        "sender_full_name": "Ashton J",
        "timestamp": 1761834655
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"979178\">@Ashton J</span> thank you for your honesty about using LLM. do you have a rough estimate of how much of the code is by LLM, or could you provide a rough outline of what was the process of incorporating LLM?</p>",
        "id": 547952731,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761834897
    },
    {
        "content": "<p>also could you instruct the LLM to make the docstrings conform more to mathlib standard? this shouldn't be hard for an LLM since it's a language task</p>",
        "id": 547953172,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761834991
    },
    {
        "content": "<p>and what does atomised mean?</p>",
        "id": 547953379,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761835035
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/eaMI-Gyj-qnmSyPEb2jGAW4p/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/eaMI-Gyj-qnmSyPEb2jGAW4p/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"973x256\" src=\"/user_uploads/thumbnail/3121/eaMI-Gyj-qnmSyPEb2jGAW4p/image.png/840x560.webp\"></a></div><p>LLM-generated code tends to have a lot of inefficiencies, such as here where a library lemma was just restated two times</p>",
        "id": 547953541,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761835074
    },
    {
        "content": "<p>you should try to understand the code yourself</p>",
        "id": 547953605,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761835088
    },
    {
        "content": "<p>Solid 75%, I am still quite new to Lean. The Method I used was I would create a Outline of exactly what we needed to prove. Then, I would \"atomize\" it, meaning break up a pretty complex lemma into something bitesized, and easy to prove on its own. Then, I would write roughly what I wanted to prove with each lemma, and had Aristotle try to prove some of the easier lemmas. I also went back and forth with Claude for some of the more complex lemmas.</p>",
        "id": 547953715,
        "sender_full_name": "Ashton J",
        "timestamp": 1761835116
    },
    {
        "content": "<p>I actually did know about that specific section of code, and am going to refactor it in a bit. This was a byproduct of the \"Atomization\", where we determine what is and is not already in the library.</p>",
        "id": 547954246,
        "sender_full_name": "Ashton J",
        "timestamp": 1761835239
    },
    {
        "content": "<p>This looks very nice! It would be a good, solid first contribution to mathlib.</p>\n<blockquote>\n<p>I'm planning to add it to Mathlib/Analysis/SpecialFunctions/Stirling.lean, is that the right location?</p>\n</blockquote>\n<p>Sure - either there, or in a separate file Mathlib/Analysis/SpecialFunctions/StirlingRobbinsBound.lean if you want to keep it separate. Either is fine. (If you make a new file, you should run <code>lake exe mk_all</code> to add it to the main mathlib index file.)</p>\n<blockquote>\n<p>I've atomized the proof with many small lemmas. Should I consolidate some of these, or is the preferred approach?</p>\n</blockquote>\n<p>Right now it is definitely too atomized. A lot of your lemmas are just re-statements of existing mathlib lemmas, or can be proved in one line with standard tactics like <code>ring</code> or <code>positivity</code>. These lemmas should be dispensed with, and applications of them replaced by applications of the existing library lemma or tactic.</p>\n<blockquote>\n<p>Are there naming conventions I should follow? (I tried to follow what I saw in existing files)</p>\n</blockquote>\n<p><a href=\"https://leanprover-community.github.io/contribute/naming.html\">Here</a> are the naming conventions; have a look at the other advice under \"contributing\" as well. The naming conventions take a bit of getting used to, but this is something that will be addressed during the PR review process.</p>",
        "id": 547992387,
        "sender_full_name": "David Loeffler",
        "timestamp": 1761844360
    }
]