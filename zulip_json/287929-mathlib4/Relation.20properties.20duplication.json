[
    {
        "content": "<p>Mathlib and Std combined have 3 versions of many properties of relations:</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>Std class</th>\n<th>Mathlib class</th>\n<th>Mathlib prop</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>reflexive relation</td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Std.Refl#doc\">docs#Std.Refl</a></td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsRefl#doc\">docs#IsRefl</a></td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Reflexive#doc\">docs#Reflexive</a></td>\n</tr>\n<tr>\n<td>irreflexive relation</td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Std.Irrefl#doc\">docs#Std.Irrefl</a></td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsIrrefl#doc\">docs#IsIrrefl</a></td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Irreflexive#doc\">docs#Irreflexive</a></td>\n</tr>\n<tr>\n<td>symmetric relation</td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Std.Symm#doc\">docs#Std.Symm</a></td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsSymm#doc\">docs#IsSymm</a></td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Symmetric#doc\">docs#Symmetric</a></td>\n</tr>\n<tr>\n<td>antisymmetric relation</td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Std.Antisymm#doc\">docs#Std.Antisymm</a></td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsAntisymm#doc\">docs#IsAntisymm</a></td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AntiSymmetric#doc\">docs#AntiSymmetric</a></td>\n</tr>\n<tr>\n<td>asymmetric relation</td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Std.Asymm#doc\">docs#Std.Asymm</a></td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsAsymm#doc\">docs#IsAsymm</a></td>\n<td></td>\n</tr>\n<tr>\n<td>total relation</td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Std.Total#doc\">docs#Std.Total</a></td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsTotal#doc\">docs#IsTotal</a></td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Total#doc\">docs#Total</a></td>\n</tr>\n<tr>\n<td>transitive relation</td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Trans#doc\">docs#Trans</a> (more generic)</td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsTrans#doc\">docs#IsTrans</a></td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Transitive#doc\">docs#Transitive</a></td>\n</tr>\n<tr>\n<td>equivalence relation</td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Equivalence#doc\">docs#Equivalence</a> (structure)</td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsEquiv#doc\">docs#IsEquiv</a></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>There are also classes for orders which were upstreamed to core because of the new <code>grind</code>, although the situation here is different because of bundling:</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>Std class using <code>LE</code></th>\n<th>Mathlib class using <code>LE</code></th>\n<th>Mathlib unbundled class</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>preorder</td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Std.IsPreorder#doc\">docs#Std.IsPreorder</a></td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Preorder#doc\">docs#Preorder</a></td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsPreorder#doc\">docs#IsPreorder</a></td>\n</tr>\n<tr>\n<td>partial order</td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Std.IsPartialOrder#doc\">docs#Std.IsPartialOrder</a></td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=PartialOrder#doc\">docs#PartialOrder</a></td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsPartialOrder#doc\">docs#IsPartialOrder</a></td>\n</tr>\n<tr>\n<td>linear order</td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Std.IsLinearOrder#doc\">docs#Std.IsLinearOrder</a></td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearOrder#doc\">docs#LinearOrder</a></td>\n<td><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsLinearOrder#doc\">docs#IsLinearOrder</a></td>\n</tr>\n</tbody>\n</table>\n<p>I also found <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=emptyRelation#doc\">docs#emptyRelation</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=EmptyRelation#doc\">docs#EmptyRelation</a>.</p>\n<p>Some relations have instances/theorems for all classes/props, some only for some:</p>\n<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Eq#doc\">docs#Eq</a>: <code>Equivalence</code> âœ“, <code>IsEquiv</code> âœ“<br>\n<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Ne#doc\">docs#Ne</a>: <code>Std.Irrefl</code> x (<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Ne.irrefl#doc\">docs#Ne.irrefl</a> is close), <code>IsIrrefl</code> x, <code>Irreflexive</code> x, <code>Std.Symm</code> x (<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Ne.symm#doc\">docs#Ne.symm</a> is close), <code>IsSymm</code> x, <code>Symmetric</code> x<br>\n<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Iff#doc\">docs#Iff</a>: <code>Equivalence</code> x, <code>IsEquiv</code> âœ“<br>\n<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Relation.ReflGen#doc\">docs#Relation.ReflGen</a>: <code>Std.Refl</code> x, <code>IsRefl</code> âœ“, <code>Reflexive</code> âœ“<br>\n<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Relation.TransGen#doc\">docs#Relation.TransGen</a>: <code>Trans</code> âœ“, <code>IsTrans</code> âœ“, <code>Transitive</code> âœ“<br>\n<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Relation.ReflTransGen#doc\">docs#Relation.ReflTransGen</a>: <code>Std.Refl</code> x, <code>IsRefl</code> âœ“, <code>Reflexive</code> âœ“, <code>Trans</code> âœ“, <code>IsTrans</code> âœ“, <code>Transitive</code> âœ“<br>\n<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Relation.EqvGen#doc\">docs#Relation.EqvGen</a>: <code>Equivalence</code> âœ“, <code>IsEquiv</code> x</p>\n<p>I think we should either fill the missing ones and add instances relating everything (already exist for transitive and the order ones) and theorems for the classes to imply the props (already exist for reflexive and transitive), or deprecate Mathlib's classes and props where possible, or at least document this table somewhere.</p>\n<p>Thoughts? I assume this has been brought up before but I couldn't find it.</p>",
        "id": 544638270,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1760402193
    },
    {
        "content": "<p>The order classes require more discussion (particularly <code>LinearOrder</code>, which is a mess.)</p>\n<p>But personally I would be happy to see <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsAntisymm#doc\">docs#IsAntisymm</a> deprecated in favour of <code>Std.Antisymm</code> (and similarly for everything in the first table).</p>",
        "id": 544659241,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1760417603
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"933054\">Snir Broshi</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Relation.20properties.20duplication/near/544638270\">said</a>:</p>\n<blockquote>\n<p>There are also classes for orders which were upstreamed to core because of the new <code>grind</code>,</p>\n</blockquote>\n<p>Just noting that <code>grind</code> was not the primary motivation for adding these classes. Rather, they were added to support various future standard library developments like consolidating the lemmas for <code>List.min?</code> and adding verified sorting algorithms, binary  search, and more. The fact that the classes are useful for <code>grind</code> was more of a happy accident.</p>",
        "id": 544662074,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1760419684
    },
    {
        "content": "<p>I'm extremely enthusiastic about tidying up this situation.</p>",
        "id": 546696813,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1761229981
    },
    {
        "content": "<p>I'm currently working on Total</p>",
        "id": 546715390,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1761234516
    },
    {
        "content": "<p>Which is now <a href=\"https://github.com/leanprover-community/mathlib4/pull/30855\">#30855</a></p>",
        "id": 546916593,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1761317440
    },
    {
        "content": "<p>If anyone has thoughts on deduplicating relation properties like IsTotal/Std.Total, please have a look at <a href=\"https://github.com/leanprover-community/mathlib4/pull/30855\">#30855</a>.</p>",
        "id": 553900820,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1762359258
    },
    {
        "content": "<p>I've been wanting this unification for a very long time, thank you!</p>",
        "id": 565019646,
        "sender_full_name": "Violeta HernÃ¡ndez",
        "timestamp": 1766415315
    },
    {
        "content": "<p><code>EmptyRelation</code> <a href=\"https://github.com/leanprover-community/mathlib4/pull/33204\">#33204</a></p>",
        "id": 565058185,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1766431024
    },
    {
        "content": "<p><code>IsSymm</code> <a href=\"https://github.com/leanprover-community/mathlib4/pull/33325\">#33325</a></p>",
        "id": 565473632,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1766786328
    },
    {
        "content": "<p><code>IsAsymm</code> <a href=\"https://github.com/leanprover-community/mathlib4/pull/33503\">#33503</a></p>",
        "id": 566121855,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1767413230
    },
    {
        "content": "<p><code>IsAntisymm</code> <a href=\"https://github.com/leanprover-community/mathlib4/pull/33685\">#33685</a></p>",
        "id": 566632300,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1767738992
    },
    {
        "content": "<p><code>IsIrrefl</code> <a href=\"https://github.com/leanprover-community/mathlib4/pull/33717\">#33717</a></p>",
        "id": 566792795,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1767809136
    },
    {
        "content": "<p><code>IsRefl</code> <a href=\"https://github.com/leanprover-community/mathlib4/pull/33755\">#33755</a></p>",
        "id": 566969754,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1767885952
    },
    {
        "content": "<p>Please feel free to take over / redo <a href=\"https://github.com/leanprover-community/mathlib4/pull/30855\">#30855</a> if you have time.</p>",
        "id": 566971156,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1767886296
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Relation.20properties.20duplication/near/566971156\">said</a>:</p>\n<blockquote>\n<p>Please feel free to take over / redo <a href=\"https://github.com/leanprover-community/mathlib4/pull/30855\">#30855</a> if you have time.</p>\n</blockquote>\n<p>Do you prefer I open another PR or push to yours w/ an invitation?</p>",
        "id": 566972855,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1767886692
    },
    {
        "content": "<p>Either way - I invited you</p>",
        "id": 566973946,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1767887013
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Relation.20properties.20duplication/near/566973946\">said</a>:</p>\n<blockquote>\n<p>Either way - I invited you</p>\n</blockquote>\n<p>Wrong repo</p>",
        "id": 567147802,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1767967145
    },
    {
        "content": "<p><code>IsTotal</code> <a href=\"https://github.com/leanprover-community/mathlib4/pull/33797\">#33797</a></p>",
        "id": 567240735,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1767984196
    },
    {
        "content": "<p>We're close to being done with the (non-order) classes, few last points:</p>",
        "id": 569362347,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1769031809
    },
    {
        "content": "<p>1) <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Equivalence#doc\">docs#Equivalence</a> is a structure and doesn't extend <code>Std.Refl</code>/<code>Std.Symm</code>/<code>IsTrans</code>, so I think we should leave <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsEquiv#doc\">docs#IsEquiv</a> as-is, add an iff theorem between them, and perhaps RFC in core for a new <code>Std.Equiv</code> (though <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsPreorder#doc\">docs#IsPreorder</a> vs <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Std.IsPreorder#doc\">docs#Std.IsPreorder</a> might be a blocker)</p>",
        "id": 569362357,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1769031815
    },
    {
        "content": "<p>2) Mathlib's <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsTrans#doc\">docs#IsTrans</a> vs core's <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Trans#doc\">docs#Trans</a>: I suggest changing <code>IsTrans</code> to <code>abbrev IsTrans Î± r := Trans r r r</code>, but this creates universe problems:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">TypeStar</span>\n<span class=\"sd\">/--</span>\n<span class=\"sd\">error: Type mismatch</span>\n<span class=\"sd\">  Trans r r r</span>\n<span class=\"sd\">has type</span>\n<span class=\"sd\">  Sort (max 1 u_1)</span>\n<span class=\"sd\">of sort `Type (max 1 u_1)` but is expected to have type</span>\n<span class=\"sd\">  Prop</span>\n<span class=\"sd\">of sort `Type`</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">IsTrans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Trans</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">r</span>\n</code></pre></div>",
        "id": 569362370,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1769031821
    },
    {
        "content": "<p>3) <a href=\"https://github.com/leanprover/lean4/pull/10945\">lean4#10945</a> introduced <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Std.Trichotomous#doc\">docs#Std.Trichotomous</a> which is <code>Â¬r a b â†’ Â¬r b a â†’ a = b</code>, <br>\nwhich seems to replace <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsTrichotomous#doc\">docs#IsTrichotomous</a> but that is <code>r a b âˆ¨ a = b âˆ¨ r b a</code>.<br>\nThey're of course logically equivalent, but deprecating one for the other seems nontrivial.<br>\nWhich do you prefer? Should I go ahead and deprecate, or do we prefer mathlib's version and want to suggest it to core?</p>",
        "id": 569362375,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1769031826
    },
    {
        "content": "<p>4) Can I proceed to deprecating the prop versions (e.g. <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Total#doc\">docs#Total</a> / <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AntiSymmetric#doc\">docs#AntiSymmetric</a>)? Their docstrings say e.g. \"<code>Std.Total</code> as a definition, suitable for use in proofs\", but the classes can also be used in proofs, I don't see a reason to keep them.</p>",
        "id": 569362382,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1769031829
    },
    {
        "content": "<p>cc <span class=\"user-mention\" data-user-id=\"330967\">@Wrenna Robson</span> for trichotomous</p>",
        "id": 569362781,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1769031971
    },
    {
        "content": "<p>We did deliberately choose the version we have there, essentially because it is then the natural counterpart of antisymm.</p>",
        "id": 569385520,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1769042124
    },
    {
        "content": "<p>As I recall Mathlib's version feels like a good idea but in practice it doesn't work amazingly.</p>",
        "id": 569385654,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1769042215
    },
    {
        "content": "<p>I think you probably just want to prove that as a theorem if you don't already have it.</p>",
        "id": 569385689,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1769042236
    },
    {
        "content": "<p>So we should deprecate Mathlib's version, yes?</p>",
        "id": 569385758,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1769042283
    },
    {
        "content": "<p>Yes, I think so.</p>",
        "id": 569385782,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1769042291
    },
    {
        "content": "<p>I am sorry that that is nontrivial. I'm happy to help with review chores and things.</p>",
        "id": 569385814,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1769042312
    },
    {
        "content": "<p>No worries, thanks!</p>",
        "id": 569386095,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1769042479
    },
    {
        "content": "<p><code>IsTrichotomous</code> <a href=\"https://github.com/leanprover-community/mathlib4/pull/34349\">#34349</a></p>",
        "id": 569828951,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1769221188
    },
    {
        "content": "<p><code>Total</code> <a href=\"https://github.com/leanprover-community/mathlib4/pull/34351\">#34351</a></p>",
        "id": 569830180,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1769222729
    },
    {
        "content": "<p><code>AntiSymmetric</code> <a href=\"https://github.com/leanprover-community/mathlib4/pull/35025\">#35025</a></p>",
        "id": 572923604,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1770687944
    },
    {
        "content": "<p><code>Irreflexive</code> <a href=\"https://github.com/leanprover-community/mathlib4/pull/35191\">#35191</a></p>",
        "id": 573637726,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1770939594
    },
    {
        "content": "<p>Are we sure we want to be using typeclasses as fields to structures? Now that <a href=\"https://github.com/leanprover-community/mathlib4/pull/35191\">#35191</a> is merged, the following code doesn't work:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Combinatorics</span><span class=\"bp\">.</span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">Dart</span>\n\n<span class=\"sd\">/-- The graph obtained by contracting a dart in an existing graph. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">contractDart</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Dart</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">SimpleGraph</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">â‰ </span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">snd</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">Adj</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">      </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Adj</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">.</span><span class=\"n\">val</span>\n<span class=\"w\">    </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">fst</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">â‰ </span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">fst</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Adj</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">snd</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">.</span><span class=\"n\">val</span>\n<span class=\"w\">    </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">fst</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">â‰ </span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">fst</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Adj</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">snd</span>\n<span class=\"w\">  </span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">loopless</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"n\">x_adj_x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">loopless</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"n\">x_adj_x</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"n\">x_problem</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">tauto</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"n\">x_problem</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">tauto</span>\n</code></pre></div>\n<p>and one needs to instead do</p>\n<div class=\"codehilite\" data-code-language=\"import\"><pre><span></span><code>/-- The graph obtained by contracting a dart in an existing graph. -/\ndef contractDart {V : Type*} (G : SimpleGraph V) (e : G.Dart) :\nÂ  Â  SimpleGraph {x : V // x â‰  e.snd} where\nÂ  Adj x y :=\nÂ  Â  Â  G.Adj x.val y.val\nÂ  Â  âˆ¨ x.val = e.fst âˆ§ y.val â‰  e.fst âˆ§ G.Adj e.snd y.val\nÂ  Â  âˆ¨ y.val = e.fst âˆ§ x.val â‰  e.fst âˆ§ G.Adj x.val e.snd\nÂ  symm := sorry\nÂ  loopless := by\nÂ  Â  constructor\nÂ  Â  exact fun\nÂ  Â  | x, .inl x_adj_x =&gt; G.loopless.1 x.val x_adj_x\nÂ  Â  | x, .inr &lt;| .inl x_problem =&gt; by tauto\nÂ  Â  | x, .inr &lt;| .inr x_problem =&gt; by tauto\n</code></pre></div>",
        "id": 574155601,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1771262245
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/35191#discussion_r2811914740\">Relevant</a></p>",
        "id": 574160136,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1771264191
    },
    {
        "content": "<p>FWIW I think the <code>by constructor; exact fun</code> construction isn't so bad if in return we get better interop with core's relation properties and possibly typeclass inference for properties where possible</p>",
        "id": 574160542,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1771264351
    },
    {
        "content": "<p>(I wouldn't be too hopeful for typeclass inference to do too much here, it seems like <code>aesop_graph</code> autoparams is the way to go.)</p>",
        "id": 574251224,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1771321799
    },
    {
        "content": "<p>But yes, I think this extra abstraction barrier is annoying but is less bad than unbundling. Especially since choosing a consistent spelling makes it easier to copy fields between different structures.</p>\n<p>Note that <code>where</code> notation also works as:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Combinatorics</span><span class=\"bp\">.</span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">Dart</span>\n\n<span class=\"sd\">/-- The graph obtained by contracting a dart in an existing graph. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">contractDart</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Dart</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">SimpleGraph</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">â‰ </span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">snd</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">Adj</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">      </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Adj</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">.</span><span class=\"n\">val</span>\n<span class=\"w\">    </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">fst</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">â‰ </span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">fst</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Adj</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">snd</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">.</span><span class=\"n\">val</span>\n<span class=\"w\">    </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">fst</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">â‰ </span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">fst</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Adj</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">snd</span>\n<span class=\"w\">  </span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">loopless</span><span class=\"bp\">.</span><span class=\"n\">irrefl</span><span class=\"w\"> </span><span class=\"c1\">-- &lt;- changed here</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"n\">x_adj_x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">loopless</span><span class=\"bp\">.</span><span class=\"n\">irrefl</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"n\">x_adj_x</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"n\">x_problem</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">tauto</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"n\">x_problem</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">tauto</span>\n</code></pre></div>",
        "id": 574252076,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1771322054
    },
    {
        "content": "<p>Ah yes, I knew I was missing something. Annoying that you must go one deeper, but it's workable with</p>",
        "id": 574803654,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1771528067
    },
    {
        "content": "<p><code>Transitive</code> <a href=\"https://github.com/leanprover-community/mathlib4/pull/35592\">#35592</a></p>",
        "id": 575061077,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1771649862
    },
    {
        "content": "<p>About transivity, we currently have <code>IsTrans</code> (in mathlib) and <code>Trans</code> (from core), and they are separate type classes with a loop like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- `IsTrans X r` means the binary relation `r` on `X` is transitive. -/</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">IsTrans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">âˆ€</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">c</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsTrans</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Trans</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">âŸ¨</span><span class=\"n\">IsTrans</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_âŸ©</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">priority</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">100</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Trans</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsTrans</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">âŸ¨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Trans</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"bp\">âŸ©</span>\n</code></pre></div>\n<p>Wouldn't it make more sense to avoid the loop and simply make it an <code>abbrev</code>?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">IsTrans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Trans</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">r</span>\n</code></pre></div>\n<p>I suppose this would be a breaking change because the argument implicitness in the <code>trans</code> field is different...</p>",
        "id": 575070399,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1771661932
    },
    {
        "content": "<p>I've always thought of <code>Trans</code> as an implementation detail of the <code>trans</code> tactic, I don't think you're really supposed to use it in mathematical code.</p>",
        "id": 575077427,
        "sender_full_name": "Violeta HernÃ¡ndez",
        "timestamp": 1771669490
    },
    {
        "content": "<p>Unfortunately I think we do</p>",
        "id": 575077455,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1771669509
    },
    {
        "content": "<p>The <code>trans</code> tactic is in batteries so <code>Trans</code> wasn't made for the <code>trans</code>. <code>Trans</code> is part of the implementation of <code>calc</code> though.</p>",
        "id": 575077613,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1771669637
    },
    {
        "content": "<p>Another case of duplicated relation properties is <code>IsWellFounded</code> and <code>WellFounded</code>, which are the exact same thing, except one is a class and the other isn't. Why don't we replace</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- A well-founded relation. Not to be confused with `IsWellOrder`. -/</span>\n<span class=\"kd\">@[</span><span class=\"n\">mk_iff</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">IsWellFounded</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The relation is `WellFounded`, as a proposition. -/</span>\n<span class=\"w\">  </span><span class=\"n\">wf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WellFounded</span><span class=\"w\"> </span><span class=\"n\">r</span>\n</code></pre></div>\n<p>with</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"kn\">class</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">WellFounded</span>\n</code></pre></div>\n<p>We can still have both APIs for using it as a class or passing it around explicitly.</p>",
        "id": 575079203,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1771671590
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479299\">Jovan Gerbscheid</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Relation.20properties.20duplication/near/575070399\">said</a>:</p>\n<blockquote>\n<p>Wouldn't it make more sense to avoid the loop and simply make it an <code>abbrev</code>?</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">IsTrans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Trans</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">r</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>I agree, but see <a class=\"message-link\" href=\"/#narrow/channel/287929-mathlib4/topic/Relation.20properties.20duplication/near/569362370\">#mathlib4 &gt; Relation properties duplication @ ðŸ’¬</a> above, this doesn't work.<br>\nI don't know why <code>Trans</code> has <code>max 1</code> in the universes though. It allows the relations to produce <code>Sort*</code> rather than <code>Prop</code>.</p>",
        "id": 575093533,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1771686643
    },
    {
        "content": "<p>I was planning on RFCing a new <code>Std.Trans</code> to core to half fix this, so that they would solve the duplication</p>",
        "id": 575093796,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1771686934
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"933054\">Snir Broshi</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Relation.20properties.20duplication/near/575093533\">said</a>:</p>\n<blockquote>\n<p>I don't know why <code>Trans</code> has <code>max 1</code> in the universes though. It allows the relations to produce <code>Sort*</code> rather than <code>Prop</code>.</p>\n</blockquote>\n<p>I just wanted to comment that, the <code>max 1</code> is technically unnecessary and you can get rid of it but it's a total pain and breaks a lot of automation</p>",
        "id": 575094744,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1771687826
    }
]