[
    {
        "content": "<p>We were told when <code>aesop</code> hit that we should go through mathlib tagging lots of lemmas with <code>@[aesop]</code> and then <code>aesop</code> would be brilliant. I am not convinced that this ever happened.</p>\n<p>However I am actually quite confused about all this. I occasionally mention <a href=\"#narrow/channel/287929-mathlib4/topic/lattice.20tactics/near/453730734\">this post</a> by Anand Rao where he tags some inequality lemmas with the aesop tag and then bam, aesop can solve inequality lemmas in partial orders (and lattices). But I am not sure that the conclusion of this is that those lemmas should globally be tagged <code>@[aesop]</code>. So this brings me to my question: is \"making aesop better\" just a question of \"tagging as many lemmas in the library as possible with aesop\" or is this not actually the correct way to use the tactic, and the correct way is to have lemmas which should only be tagged aesop when working on goals in a certain area, by which in practice I guess I mean making bespoke tactics like <code>aesop_cat</code>?</p>",
        "id": 499419210,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1739438373
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"400289\">@Artie Khovanov</span> has been looking into this recently. Let me try to find the other thread</p>",
        "id": 499419515,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1739438435
    },
    {
        "content": "<p><a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/Adding.20.2F.20modifying.20Aesop.20lemmas\">#mathlib4 &gt; Adding / modifying Aesop lemmas</a></p>",
        "id": 499419657,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1739438469
    },
    {
        "content": "<p>The way I often use aesop is to locally add lemmas to its set, which are globally probably not sensible but are useful in my specific file. For instance in <a href=\"https://github.com/leanprover-community/mathlib4/pull/20082\">#20082</a>, I write</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">aesop</span><span class=\"w\"> </span><span class=\"n\">norm</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Omega</span><span class=\"bp\">.</span><span class=\"n\">omegaDefault</span>\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">aesop</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">subset_def</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">subset_iff</span>\n</code></pre></div>\n<p>(the first one tells aesop to try omega, it would be nice if the notation was cleaner here!) Both of these are absolutely not sensible for mathlib in general, but in that specific PR it makes proofs nicer. Similarly in <a href=\"https://github.com/leanprover-community/mathlib4/pull/20759\">#20759</a> (merged), all the proofs are something like <code>aesop (add safe forward [le_antisymm, le_of_lt])</code>: here instead of adding the attribute in the file, I just repeat the same call a few times, but it's the same pattern.</p>\n<p>My pattern is to do what we used to do with <code>simp</code>: put it at the end and keep moving it upwards until it stops working. In the <code>simp</code> case, we'd usually stop at anything that's not a <code>rw</code>, but with <code>aesop</code> I can add apply lemmas using <code>add ... forward</code> too, or add local simp lemmas using <code>add ... simp</code>. I have no idea if this is how we're meant to use it, but I like it anyway!</p>",
        "id": 499425744,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1739439988
    },
    {
        "content": "<p>The other thread seemed to end up talking about several different things. But I am coming to the same conclusion as Bhavik -- aesop is not some one-size-fits-all tactic, the way it's to be used is that a user needs to supply their own lemmas. Is this correct?</p>",
        "id": 499426302,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1739440153
    },
    {
        "content": "<p>I think it's meant to be extensible (I believe that's what the e in aesop stands for!). But we also have the option of building common rulesets like Anand's example or aesop_cat or finsetNonempty. So, both?</p>",
        "id": 499426594,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1739440249
    },
    {
        "content": "<p>I agree with Bhavik that rule sets would be the ideal way of tagging and grouping lemmas related to a given area. </p>\n<p>(<a href=\"https://github.com/leanprover-community/mathlib4/blob/4083b7d96b03db1ae474536012e2cb629f010422/Mathlib/Combinatorics/SimpleGraph/Basic.lean#L137\">Here's</a> an example of what this looks like in practice).</p>\n<p>Joachim Breitner suggests towards the end of the thread on lattices that syntax like <code>aesop [cat]</code> or <code>aesop [graph]</code> would be nicer than having bespoke tactics for each of these areas, since this would allow room for composite tactics like <code>aesop [cat, order]</code>. I agree and think that this in combination with rule sets would be the best way forward.</p>",
        "id": 499436629,
        "sender_full_name": "Anand Rao Tadipatri",
        "timestamp": 1739442906
    }
]