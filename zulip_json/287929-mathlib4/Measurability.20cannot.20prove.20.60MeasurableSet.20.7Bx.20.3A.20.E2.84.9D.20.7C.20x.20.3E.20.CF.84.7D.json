[
    {
        "content": "<p>I just saw <a href=\"https://github.com/leanprover-community/mathlib4/pull/26620\">#26620</a> --- let me cross-post this here for visibility:</p>",
        "id": 530916186,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1753519726
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">MeasureTheory</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Set</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">greaterSet</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">τ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">MeasurableSet</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">measurability</span>\n\n<span class=\"c1\">-- both fail with the same problem:</span>\n<span class=\"c1\">-- tactic 'aesop' failed, failed to prove the goal after exhaustive search.</span>\n<span class=\"c1\">-- Initial goal:</span>\n\n<span class=\"c1\">-- τ : ℝ</span>\n<span class=\"c1\">-- ⊢ MeasurableSet {x | x &gt; τ}</span>\n<span class=\"c1\">-- Remaining goals after safe rules:</span>\n\n<span class=\"c1\">-- τ : ℝ</span>\n<span class=\"c1\">-- ⊢ Measurable (LT.lt τ)</span>\n\n<span class=\"c1\">-- My own proof of the statement</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">greaterSet''</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">τ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">MeasurableSet</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">measurableSet_Ioi</span>\n<span class=\"c1\">-- Here I first prove that {x : ℝ | x &gt; τ} is Ioi and then measurability passes through, avoiding casting to function</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">greaterSet_with_measurability</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">τ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">MeasurableSet</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Ioi</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ioi</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mem_setOf_eq</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">this</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">measurability</span>\n<span class=\"c1\">-- Now I redefine measurability and disable simp. The proof goes through.</span>\n<span class=\"kn\">macro</span><span class=\"w\"> </span><span class=\"s2\">\"measurability\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">aesop</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">config</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">terminal</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">enableSimp</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"o\">})</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">rule_sets</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">$</span><span class=\"o\">(</span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">mkIdent</span><span class=\"w\"> </span><span class=\"ss\">`Measurable</span><span class=\"o\">):</span><span class=\"n\">ident</span><span class=\"o\">]))</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">greaterSet'''</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">τ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">MeasurableSet</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">measurability</span>\n</code></pre></div>",
        "id": 530916261,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1753519764
    },
    {
        "content": "<blockquote>\n<p>The problem is that <code>measurability</code> cannot prove a very simple, almost definitional <code>MeasurableSet</code> because it first applies <code>simp</code> and gets a <code>Measurable</code> function instead of a set, which it cannot prove</p>\n<p>I have redefined the measurability to add <code>enableSimp := false</code> and it works.</p>\n<p>Cannot give any advice on how to fix that, either deprioritize simp, or have more theorems for functions. What do you think?</p>\n</blockquote>",
        "id": 530916312,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1753519791
    },
    {
        "content": "<p>(To repeat, I did not create this issue --- but am also curious why this is.)</p>",
        "id": 530916357,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1753519816
    },
    {
        "content": "<p>Replacing \"&gt;\" by \"&lt;\" makes no difference here.</p>",
        "id": 530916374,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1753519827
    },
    {
        "content": "<p>I did some investigation </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">MeasureTheory</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Set</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">greaterSet</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">τ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">MeasurableSet</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">measurability?</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span><span class=\"cm\"> simp_all only [gt_iff_lt, measurableSet_setOf]</span>\n<span class=\"cm\">     sorry -/</span>\n\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"n\">simp</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">gt_iff_lt</span>\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"n\">simp</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">measurableSet_setOf</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">greaterSet'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">τ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">MeasurableSet</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">measurability?</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span><span class=\"cm\"> apply measurableSet_lt</span>\n<span class=\"cm\">     · simp_all only [measurable_const]</span>\n<span class=\"cm\">     · apply measurable_id'-/</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">greaterSet''</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">τ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">MeasurableSet</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">measurability?</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span><span class=\"cm\"> sorry -/</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">greaterSet'''</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">τ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">MeasurableSet</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">measurableSet_lt</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp_all</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">measurable_const</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">measurable_id'</span>\n</code></pre></div>\n<p>If you remove the <code>simp</code> lemmas that <code>measurability</code> uses then it works but notably it doesn't work when you flip the sign (and this is also true when you disable simp). I think probably <code>MeasurableSet_SetOf</code> shouldn't be a <code>simp</code> lemma (instead the direction that is used should be made into a measurability lemma) but this still doesn't fix the issue. Of course if we can get <code>measurability </code>to work for the lt sign case then we wouldnt need to remove <code>gt_iff_lt</code> from <code>simp</code>. Note its weird that <code>measurability</code> cant prove the lt case after removing the <code>simp</code> lemmas since the exact proof that <code>measurability</code> finds for the gt case works for the lt case. I don't (yet) have an understanding of how <code>aesop</code> works to diagnose why this happens but I have ran into a few weird cases like this and  I am in the process of learning meta programming in part so I can try to improve <code>measurability</code> and <code>fun_prop</code>.</p>",
        "id": 531015615,
        "sender_full_name": "David Ledvinka",
        "timestamp": 1753569730
    },
    {
        "content": "<p>Michael, thanks for endorsing this! And thanks for debugging that, David.</p>\n<p>I have a more general question on the matter though. I do not really understand, why <code>MeasurableSet</code> is not a class (in the same way <code>MeasurableSpace</code> or <code>IsMarkovKernel</code> are) with some instances (which are now theorems marked with measurability tag), which can automatically infer (and therefore prove) <code>MeasurableSet</code> and <code>Measurable</code> statements.</p>\n<p>This would be so useful for defs and theorems using random variables, I have some examples and arguments, but maybe the answer is simple and I won't overwhelm the thread</p>",
        "id": 531018747,
        "sender_full_name": "Georgy Kalashnov",
        "timestamp": 1753571295
    }
]