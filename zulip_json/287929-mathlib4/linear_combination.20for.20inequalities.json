[
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/16841\">#16841</a> extends the tactic <code>linear_combination</code> to prove inequalities!  From the test file:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">linear_combination</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hy</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">linear_combination</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">hx</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">25</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">h3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">43</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">linear_combination</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">14</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">h3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">38</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ht</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">17</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">linear_combination</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">ht</span>\n</code></pre></div>",
        "id": 470457699,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1726464360
    },
    {
        "content": "<p>It seems that my <a href=\"https://github.com/madvorak/duality\">duality</a> project is henceforth redundant. JOKE</p>",
        "id": 470522415,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1726478518
    },
    {
        "content": "<p>Some rudimentary profiling suggests that on \"tiny\" problems, <code>linear_combination</code>-for-inequalities is as fast as a rewrite or a proof term, and several times faster than linarith:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Linarith</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">LinearCombination</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span>\n\n<span class=\"c1\">-- 730 heartbeats</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">linarith</span>\n\n<span class=\"c1\">-- 223 heartbeats</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">linear_combination</span><span class=\"w\"> </span><span class=\"n\">h</span>\n\n<span class=\"c1\">-- 278 heartbeats</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rwa</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">sub_pos</span><span class=\"o\">]</span>\n\n<span class=\"c1\">-- 279 heartbeats</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">sub_pos</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>",
        "id": 470779888,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1726532149
    },
    {
        "content": "<p>This kind of goal is my primary motivation for this feature, so I would be very interested in</p>\n<ul>\n<li>suggestions for measuring this speedup more precisely (on small problems <code>#time</code> has high variance and I am hesitant to draw conclusions)</li>\n<li>suggestions for speeding up further!</li>\n</ul>",
        "id": 470780361,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1726532305
    },
    {
        "content": "<p>I thought of one other way to profile small problems: repeat 50 times and <code>#time</code> the whole thing.</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>import Mathlib.Tactic.Linarith<br>\nimport Mathlib.Tactic.LinearCombination<br>\nimport Mathlib.Data.Real.Basic</p>\n<p>variable {a b : ℝ}</p>\n<p>syntax \"test_tactic\" \" [\" term \"]\" : tactic</p>\n<p>macro_rules | <code>(tactic | test_tactic [$arg])=&gt; </code>(tactic | linear_combination ($arg))<br>\n-- macro_rules | <code>(tactic | test_tactic [$arg])=&gt; </code>(tactic | linarith only [$arg])</p>\n<p>example (h : a &lt; b) : True := by<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  have : 0 &lt; b - a := by test_tactic [h]<br>\n  trivial</p>\n</div></div>\n<p>I assume this is not the right way to do it?  (For the record: 761 ms for 50 identical <code>linarith</code>s, 483 ms for 50 identical <code>linear_combination</code>s.)</p>",
        "id": 470788389,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1726534015
    },
    {
        "content": "<p>Use <code>repeat</code> rather than actually repeating. :-)</p>",
        "id": 470817658,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726542914
    },
    {
        "content": "<p>And you might add a zero or two!</p>",
        "id": 470817928,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726542971
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> What is the syntax?  I see the <code>repeat</code> tactic but this doesn't seem to take a parameter for number of iterations? <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Parser.Tactic.tacticRepeat_#doc\">docs#Lean.Parser.Tactic.tacticRepeat_</a></p>",
        "id": 470819232,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1726543405
    },
    {
        "content": "<p>I don't know about repeat, but I think you can use <code>iterate</code> (<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Parser.Tactic.tacticIterate____#doc\">docs#Lean.Parser.Tactic.tacticIterate____</a>)</p>",
        "id": 470820448,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1726543735
    },
    {
        "content": "<p>OK, that actually seems pretty stable! For 500 iterations, 1.2 seconds for <code>rwa [sub_pos]</code>, 5.2 seconds for <code>linear_combination h</code>, 8.3 seconds for <code>linarith only [h]</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Linarith</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">LinearCombination</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span>\n\n<span class=\"bp\">#</span><span class=\"n\">time</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">maxRecDepth</span><span class=\"w\"> </span><span class=\"mi\">1600</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">iterate</span><span class=\"w\"> </span><span class=\"mi\">500</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">linear_combination</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">clear</span><span class=\"w\"> </span><span class=\"n\">H</span>\n<span class=\"w\">  </span><span class=\"n\">trivial</span>\n</code></pre></div>",
        "id": 470822792,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1726544371
    },
    {
        "content": "<p>I assume that when the same tactic call is repeated 500 times, things like typeclass search are cached, so it really is just the tactic execution and typechecking which are being tested?</p>\n<p>(Which may not reflect \"real-world\" conditions ...  Is there a way of clearing any cached typeclass searches between iterations?)</p>",
        "id": 470822809,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1726544380
    },
    {
        "content": "<p>(Oops, sorry, <code>iterate</code>!)</p>",
        "id": 470881958,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726554687
    },
    {
        "content": "<p>There is also <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Mathlib.CountHeartbeats.tacticCount_heartbeats%21#doc\">docs#Mathlib.CountHeartbeats.tacticCount_heartbeats!</a>_In__ that might be useful.</p>",
        "id": 470887238,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1726556281
    },
    {
        "content": "<p>Yup, that's how I got <a href=\"#narrow/stream/287929-mathlib4/topic/linear_combination.20for.20inequalities/near/470457699\">these heartbeat counts</a>, but the heartbeat numbers seem not to match my impression of time elapsed.</p>",
        "id": 470979614,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1726579714
    },
    {
        "content": "<p>The prerequisites for <a href=\"https://github.com/leanprover-community/mathlib4/pull/16841\">#16841</a> (<code>linear_combination</code>-for-inequalities) have all been merged, and this tactic is ready for review!</p>",
        "id": 481577227,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1731256658
    },
    {
        "content": "<p>Merged, thanks to Rob!</p>\n<p>How do we feel about large-scale squeezing of <code>linarith</code> to <code>linear_combination</code>?  See <a href=\"https://github.com/leanprover-community/mathlib4/pull/18841\">#18841</a> for the result of doing this in 100 places: it's a modest speedup.  On the other hand, it's a slight loss in readability.</p>\n<p>We could also have a policy that is \"conditional\" rather than absolute; for example the policy could be \"<code>linarith</code>s which depend on only one hypothesis are fair game for squeezing\".</p>",
        "id": 481640940,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1731305539
    },
    {
        "content": "<p>I left some comments. I think squeezing <code>linarith only</code> might be a good rule.</p>\n<p>Also, we could rename <code>linear_combination</code> to <code>lincombi</code> if we think that <code>linarith</code> has an unfair advantage for short proofs.</p>",
        "id": 481648238,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1731308956
    },
    {
        "content": "<p>I also left some comments: TL;DR is that many changes are clear wins imho, some are neutral to good, and a few I'm less sure about (including because of the length).</p>",
        "id": 481696015,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1731324563
    },
    {
        "content": "<p>I think squeezing which avoids extra <code>have</code>s/several lines is clearly better. If the new code is shorter, I think it's also clearly better.</p>",
        "id": 481696342,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1731324653
    },
    {
        "content": "<p>Thank you Johan and Michael for going through the diff! But I am realising from your comments that I presented the PR in a way which obscures the linarith/linear_combination discussion, because I also mixed in some golfing which would have worked with either linarith or linear_combination. Let me move that golfing to a separate PR so we have a better basis for the discussion.</p>",
        "id": 481714426,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1731329663
    }
]