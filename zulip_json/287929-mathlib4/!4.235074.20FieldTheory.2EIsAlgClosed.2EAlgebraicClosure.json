[
    {
        "content": "<p>The next big boss seems to be <a href=\"https://github.com/leanprover-community/mathlib4/pull/5074\">!4#5074</a> (at least it is short...). In particular I am stuck with <code>Step.isIntegral</code>, that timeouts. I have an horribly slow proof, that works with <code>set_option maxHeartbeats 5000000 in</code> .</p>\n<p>I think that one of the culprit is the use of <code>RingHom.toAlgebra</code>, but I am not sure.</p>",
        "id": 366838873,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1686923440
    },
    {
        "content": "<p>I am currently looking for a slightly different proof</p>",
        "id": 366840038,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1686923649
    },
    {
        "content": "<p>Not directly related to the PR, but I can see that <code>AlgebraicClosure</code> is not marked as irreducible, which means that the gory details of the construction are available to the kernel whenever one uses it. Wouldn't it make sense to make it irreducible?</p>",
        "id": 366840732,
        "sender_full_name": "Sebastien Gouezel",
        "timestamp": 1686923796
    },
    {
        "content": "<p>There are various <code>smul</code> diamonds that only commute for <code>SplittingField</code> and <code>TensorProduct</code>if they are not irreducible I believe. The same may be true of algebraic closure, although I believe it wasn't constructed with as much care so they might not commute anyway.</p>",
        "id": 366853769,
        "sender_full_name": "Chris Hughes",
        "timestamp": 1686926192
    },
    {
        "content": "<p>I am wondering if we should change the definition, following what you did with <code>SplittingField</code>.</p>",
        "id": 366854055,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1686926256
    },
    {
        "content": "<p><a href=\"#narrow/stream/287929-mathlib4/topic/Nontrivial.20typeclass.20def-eqs\">https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Nontrivial.20typeclass.20def-eqs</a> is an example for <code>TensorProduct</code></p>",
        "id": 366855119,
        "sender_full_name": "Chris Hughes",
        "timestamp": 1686926454
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130384\">Riccardo Brasca</span> <a href=\"#narrow/stream/287929-mathlib4/topic/!4.235074.20FieldTheory.2EIsAlgClosed.2EAlgebraicClosure/near/366854055\">said</a>:</p>\n<blockquote>\n<p>I am wondering if we should change the definition, following what you did with <code>SplittingField</code>.</p>\n</blockquote>\n<p>I think the definition <code>AdjoinMonic</code> in the current file is the algebraic closure and satisfies the nice def-eqs because it is a quotient of <code>MvPolynomial</code>. Kenny couldn't be bothered to prove this was algebraically closed and carried on adding all the roots and taking some direct limit to make a field that was easier to prove was algebraically closed, but I think proving <code>AdjoinMonic</code> is algebraically closed is the best construction.</p>",
        "id": 366856122,
        "sender_full_name": "Chris Hughes",
        "timestamp": 1686926630
    },
    {
        "content": "<p>I don't mean to change the mathematical construction, but the way it is written in Lean. Currently, the real this is <code>AdjoinMonic</code>, used to define <code>stepAux</code>. Then no instance are added to <code>stepAux</code>, but we define <code>Step = stepAux.1</code> and we add the various instance.</p>\n<p>Now, the prof that <code>Step k n</code> is algebraic is essentially an induction on <code>n</code>, as follows: the case <code>n=0</code> is easy, and we split the <code>n+1</code> case via the tower <code>k → Step k n → Step k (n+1)</code>. The first morphism is algebraic by induction hypothesis and the second because of the properties of <code>AdjoinMonic</code>. The problem is that Lean has troubles in understanding that the second morphism is the one given by <code>AdjoinMonic</code></p>",
        "id": 366861329,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1686927658
    },
    {
        "content": "<p>I tried to unfold manually <code>Step</code>, and things seem to be faster, but then all the instances (for example <code>Algebra k </code>stepAux``) are missing</p>",
        "id": 366861896,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1686927764
    },
    {
        "content": "<p>But I am done for today :(</p>",
        "id": 366862187,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1686927822
    },
    {
        "content": "<p>I've pushed the proof I have, with two <code>sorry</code> that makes it working without increasing the hearbeats. I tried to use <code>RingHom.IsIntegral</code> to have more control on the algebra instances.</p>",
        "id": 366863929,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1686928135
    },
    {
        "content": "<p>I got a somewhat faster version (only 700000 Heartbeats) by separating out some things. I'll push it for now - everything compiles, but some proofs are still slow (max. is 900 k further down in the file).</p>",
        "id": 367443021,
        "sender_full_name": "Nikolas Kuhn",
        "timestamp": 1687113623
    },
    {
        "content": "<p>I'll open it up for review, but please take another look whether you like it <span class=\"user-mention\" data-user-id=\"130384\">@Riccardo Brasca</span> !</p>",
        "id": 367443650,
        "sender_full_name": "Nikolas Kuhn",
        "timestamp": 1687113918
    },
    {
        "content": "<p>I will have a look tomorrow, thanks!</p>",
        "id": 367456862,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1687120584
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110044\">Chris Hughes</span> <a href=\"#narrow/channel/287929-mathlib4/topic/!4.235074.20FieldTheory.2EIsAlgClosed.2EAlgebraicClosure/near/366856122\">said</a>:</p>\n<blockquote>\n<p>I think the definition <code>AdjoinMonic</code> in the current file is the algebraic closure and satisfies the nice def-eqs because it is a quotient of <code>MvPolynomial</code>. Kenny couldn't be bothered to prove this was algebraically closed and carried on adding all the roots and taking some direct limit to make a field that was easier to prove was algebraically closed, but I think proving <code>AdjoinMonic</code> is algebraically closed is the best construction.</p>\n</blockquote>\n<p>Just a note that this is now done in <a href=\"https://github.com/leanprover-community/mathlib4/pull/19853\">#19853</a>.</p>",
        "id": 490942333,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1735270223
    },
    {
        "content": "<p>Is there a specific reason to follow that note by K. Conrad instead of <a href=\"https://kconrad.math.uconn.edu/blurbs/galoistheory/algclosureshorter.pdf\">https://kconrad.math.uconn.edu/blurbs/galoistheory/algclosureshorter.pdf</a>?</p>",
        "id": 490984517,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1735301157
    },
    {
        "content": "<p>This looks great! I recall having seen such a proof, but I've forgotten about it. I wonder why K. Conrad doesn't point to the existence of a shorter version in the longer version. Formalizing this proof will probably allow us to cut down imports, especially those introduced in <a href=\"https://github.com/leanprover-community/mathlib4/pull/19853\">#19853</a>. This proof is different in that you adjoin all roots of each polynomial, rather than one root of each polynomial, so you need to adjust the argument, not just reducing an infinite iteration to a single step. The <a href=\"https://github.com/leanprover-community/mathlib4/commit/ab7a60c7ef056c2f563780a9eaba38334ee68af4#diff-abe22930a9c8ef025fcfdec88b7a436960fd44bb8738c6ea3418d19de32f67f3R230-R238\">key lemma</a> to conclude the proof has been added in <a href=\"https://github.com/leanprover-community/mathlib4/pull/18431\">#18431</a>, and the splitting field argument is already there.</p>",
        "id": 490993345,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1735307033
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/20295\">#20295</a> switches to the construction in algclosureshorter.pdf. The reduction in imports is not very impressive: 7 files see a ~30 import reduction.</p>",
        "id": 491110982,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1735410660
    },
    {
        "content": "<p>Does this mean that we can finally reverse the dependence between splitting fields and algebraic closure? There's been an idea floating around for a while that the algebraic closure should be defined abstractly, and then we get splitting fields just by adjoining roots inside an algebraic closure.</p>",
        "id": 491139266,
        "sender_full_name": "Thomas Browning",
        "timestamp": 1735440099
    },
    {
        "content": "<p>The proof still uses the splitting field to show the span of the coefficients is not everything. It seems the diamond issues around SplittingField has been solved, so there may not be much motivation to reverse the dependency. (Is there expected performance gain from changing SplittingField to a Subalgebra in AlgebraicClosure? I think subobjects rather <strong>causes</strong> performance issues?)</p>\n<p>If you really want to define SplittingField in terms of AlgebraicClosure, I guess you have to either (1) revive the Zorn's lemma approach and ensure no diamond happens with the instances on the resulting AlgebraicClosure; (2) change the current SplittingField to SplittingFieldAux and only use it in the proofs for AlgebraicClosure; after we finish the proof we can then define the actual SplittingField that will be used across Mathlib.</p>",
        "id": 491142088,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1735443231
    },
    {
        "content": "<p>Ah right. I do want to play around with (2), and see how it changes things.</p>",
        "id": 491203732,
        "sender_full_name": "Thomas Browning",
        "timestamp": 1735503058
    },
    {
        "content": "<p>That has always been an option; if you do it now, the dependencies of SplittingField would increase from 1254 to 1319 (according to #trans_imports, not GitHub bot). With <a href=\"https://github.com/leanprover-community/mathlib4/pull/20295\">#20295</a> they only increase to 1284.</p>",
        "id": 491206119,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1735505289
    },
    {
        "content": "<p>Oh, yes, <a href=\"https://github.com/leanprover-community/mathlib4/pull/20295\">#20295</a> definitely seems worthwhile either way. I just want to play with using <code>SplittingFieldAux</code> in your <code>toSplittingField</code>, instead of <code>SplittingField</code>.</p>",
        "id": 491207201,
        "sender_full_name": "Thomas Browning",
        "timestamp": 1735506349
    },
    {
        "content": "<p>Okay, my last comment was just because the dependencies of the eventual public-facing SplittingField would be a consideration whether this refactor should be accepted to Mathlib.</p>",
        "id": 491207424,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1735506573
    }
]