[
    {
        "content": "<p>The code action that completes an <code>induction</code> call in tactic mode is very nice. Could we have a similar thing for <code>match</code> statements?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"c1\">-- cursor here to get code action</span>\n</code></pre></div>",
        "id": 569312937,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1769016253
    },
    {
        "content": "<p>Mario has that somewhere on a branch I think. There's a Zulip thread for it which I'll try and find.</p>",
        "id": 569313202,
        "sender_full_name": "Julian Berman",
        "timestamp": 1769016326
    },
    {
        "content": "<p><a href=\"#narrow/channel/113488-general/topic/Docs.20for.20.60induction.60.20and.20.60cases.60/near/481490849\">#general &gt; Docs for &#96;induction&#96; and &#96;cases&#96; @ ðŸ’¬</a> obviously feel free to politely bump for status update, perhaps it slipped through the cracks.</p>",
        "id": 569313807,
        "sender_full_name": "Julian Berman",
        "timestamp": 1769016493
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"282271\">Bolton Bailey</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Code.20actions.20wishlist/near/569312937\">schrieb</a>:</p>\n<blockquote>\n<p>The code action that completes an <code>induction</code> call in tactic mode is very nice. Could we have a similar thing for <code>match</code> statements?</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"c1\">-- cursor here to get code action</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>This works locally for me?</p>",
        "id": 569314384,
        "sender_full_name": "Moritz R",
        "timestamp": 1769016628
    },
    {
        "content": "<p>I did a first pass of the implementation and it should be merged into batteries</p>",
        "id": 569314477,
        "sender_full_name": "Moritz R",
        "timestamp": 1769016651
    },
    {
        "content": "<p>i have no clue why it works for induction on Lean 4 web, but not for match. But locally it does work for me and i hope it does for everyone else?</p>",
        "id": 569315286,
        "sender_full_name": "Moritz R",
        "timestamp": 1769016874
    },
    {
        "content": "<p><a class=\"message-link\" href=\"/#narrow/channel/287929-mathlib4/topic/Tactic.20code.20actions/near/529940912\">#mathlib4 &gt; Tactic code actions @ ðŸ’¬</a></p>",
        "id": 569315598,
        "sender_full_name": "Moritz R",
        "timestamp": 1769016959
    },
    {
        "content": "<p>This is the last update i have on the state of this code action. Mario still wanted to improve the exact implementation details, i have no idea if he already did.</p>",
        "id": 569315722,
        "sender_full_name": "Moritz R",
        "timestamp": 1769016992
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"602461\">Moritz R</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Code.20actions.20wishlist/near/569315286\">schrieb</a>:</p>\n<blockquote>\n<p>i have no clue why it works for induction on Lean 4 web, but not for match. But locally it does work for me and i hope it does for everyone else?</p>\n</blockquote>\n<p>Does anybody know anyone of the <code>Lean 4 Web</code> implementers?</p>",
        "id": 569316375,
        "sender_full_name": "Moritz R",
        "timestamp": 1769017161
    },
    {
        "content": "<p>It's not working for me locally</p>\n<p>Cursor on match gives only \"fix\" tip</p>\n<p><a href=\"/user_uploads/3121/gWzZwtDfHv8IKEjGgAMITeQB/Screenshot-2026-01-21-at-10.14.11AM.png\">Screenshot 2026-01-21 at 10.14.11â€¯AM.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/gWzZwtDfHv8IKEjGgAMITeQB/Screenshot-2026-01-21-at-10.14.11AM.png\" title=\"Screenshot 2026-01-21 at 10.14.11â€¯AM.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1030x548\" src=\"/user_uploads/thumbnail/3121/gWzZwtDfHv8IKEjGgAMITeQB/Screenshot-2026-01-21-at-10.14.11AM.png/840x560.webp\"></a></div><p>Cursor on induction gives the lightbulb completion clickable</p>\n<p><a href=\"/user_uploads/3121/GRQa98cN1ykxWDT0Y7fsLZn2/Screenshot-2026-01-21-at-10.13.33AM.png\">Screenshot 2026-01-21 at 10.13.33â€¯AM.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/GRQa98cN1ykxWDT0Y7fsLZn2/Screenshot-2026-01-21-at-10.13.33AM.png\" title=\"Screenshot 2026-01-21 at 10.13.33â€¯AM.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"888x478\" src=\"/user_uploads/thumbnail/3121/GRQa98cN1ykxWDT0Y7fsLZn2/Screenshot-2026-01-21-at-10.13.33AM.png/840x560.webp\"></a></div>",
        "id": 569323876,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1769019288
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 569690647,
        "sender_full_name": "Moritz R",
        "timestamp": 1769166892
    },
    {
        "content": "<p>This is certainly not expected, thank you for reporting</p>",
        "id": 569690985,
        "sender_full_name": "Moritz R",
        "timestamp": 1769167009
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 569691745,
        "sender_full_name": "Moritz R",
        "timestamp": 1769167226
    },
    {
        "content": "<p>Which Lean version are you on?</p>",
        "id": 569693131,
        "sender_full_name": "Moritz R",
        "timestamp": 1769167703
    },
    {
        "content": "<p><code>#eval Lean.versionString</code></p>",
        "id": 569693213,
        "sender_full_name": "Moritz R",
        "timestamp": 1769167730
    },
    {
        "content": "<p>It works with <code>import Batteries.CodeAction.Match</code> but not if you additionally have <code>import Batteries.Tactic.NoMatch</code>.</p>",
        "id": 569702700,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1769171226
    },
    {
        "content": "<p>So</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">.</span><span class=\"n\">CodeAction</span><span class=\"bp\">.</span><span class=\"n\">Match</span>\n\n<span class=\"c1\">-- the same syntax as in `Batteries.Tactic.NoMatch`</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"match \"</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"o\">,</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"s2\">\" with\"</span><span class=\"w\"> </span><span class=\"s2\">\".\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"c1\">-- no code action</span>\n</code></pre></div>\n<p>but</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">.</span><span class=\"n\">CodeAction</span><span class=\"bp\">.</span><span class=\"n\">Match</span>\n\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">priority</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">low</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"match \"</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"o\">,</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"s2\">\" with\"</span><span class=\"w\"> </span><span class=\"s2\">\".\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"c1\">-- code action!</span>\n</code></pre></div>",
        "id": 569703142,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1769171362
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 569704823,
        "sender_full_name": "Moritz R",
        "timestamp": 1769171888
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 569704835,
        "sender_full_name": "Moritz R",
        "timestamp": 1769171891
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 569705108,
        "sender_full_name": "Moritz R",
        "timestamp": 1769171975
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 569705158,
        "sender_full_name": "Moritz R",
        "timestamp": 1769171991
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 569705742,
        "sender_full_name": "Moritz R",
        "timestamp": 1769172187
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 569705965,
        "sender_full_name": "Moritz R",
        "timestamp": 1769172263
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 569706429,
        "sender_full_name": "Moritz R",
        "timestamp": 1769172398
    },
    {
        "content": "<p>18 messages were moved here from <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/Code.20actions.20wishlist/with/498223225\">#mathlib4 &gt; Code actions wishlist</a> by <span class=\"user-mention silent\" data-user-id=\"873547\">Robin Arnez</span>.</p>",
        "id": 569707018,
        "sender_full_name": "Notification Bot",
        "timestamp": 1769172570
    },
    {
        "content": "<p>6 messages were moved here from <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/Tactic.20code.20actions/with/529940912\">#mathlib4 &gt; Tactic code actions</a> by <span class=\"user-mention silent\" data-user-id=\"873547\">Robin Arnez</span>.</p>",
        "id": 569707093,
        "sender_full_name": "Notification Bot",
        "timestamp": 1769172592
    },
    {
        "content": "<p>This should be a better place for this discussion</p>",
        "id": 569707195,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1769172616
    },
    {
        "content": "<p>i deleted my messages, in this order they were confusing</p>",
        "id": 569707533,
        "sender_full_name": "Moritz R",
        "timestamp": 1769172712
    },
    {
        "content": "<p>Right, with the way things currently are working,  the <code>match n with .</code> syntax from <code>Batteries.CodeAction.NoMatch</code> takes priority over normal match, so adjusting the priority should fix the issue</p>",
        "id": 569707706,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1769172770
    },
    {
        "content": "<p>Why does it even fire without a dot? I have never seen the old syntax, but if it contains a dot, we should not warn already if there is no dot written by the user yet, right?</p>",
        "id": 569708054,
        "sender_full_name": "Moritz R",
        "timestamp": 1769172869
    },
    {
        "content": "<p>Also, did you mean to write \"syntax from <code>Batteries.CodeAction.NoMatch</code>\"?</p>",
        "id": 569708286,
        "sender_full_name": "Moritz R",
        "timestamp": 1769172936
    },
    {
        "content": "<p>Well <code>match n with</code> is incomplete syntax so it has to choose between <code>match n with | ...</code> or <code>match n with .</code>. This choice is based off of priority and declaration order so the newer syntax (with the <code>.</code>) has higher priority.</p>",
        "id": 569708896,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1769173134
    },
    {
        "content": "<p>Here's a fix: <a href=\"https://github.com/leanprover-community/batteries/pull/1626\">batteries#1626</a></p>",
        "id": 569708956,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1769173154
    },
    {
        "content": "<p>Ah, i see</p>",
        "id": 569708965,
        "sender_full_name": "Moritz R",
        "timestamp": 1769173159
    },
    {
        "content": "<p>Maybe link this conversation in the PR</p>",
        "id": 569709068,
        "sender_full_name": "Moritz R",
        "timestamp": 1769173192
    },
    {
        "content": "<p>ohno, Lean 4.27 was just released 20 minutes ago</p>",
        "id": 569709732,
        "sender_full_name": "Moritz R",
        "timestamp": 1769173395
    },
    {
        "content": "<p>so this probably won't be included in 4.27 batteries anymore ;(</p>",
        "id": 569709754,
        "sender_full_name": "Moritz R",
        "timestamp": 1769173406
    },
    {
        "content": "<p>I just did this in a new file in my local clone of mathlib, it replicates for me on <code>master</code> (<del>now</del> that I had from a few days ago), version string \"4.27.0-rc1\".</p>",
        "id": 569832916,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1769226671
    },
    {
        "content": "<p>Ok I have just pulled again, and I now get the lightbulb on both!</p>",
        "id": 569833020,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1769226851
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 569833049,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1769226913
    }
]