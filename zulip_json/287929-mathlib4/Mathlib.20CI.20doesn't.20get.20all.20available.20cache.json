[
    {
        "content": "<p>In the past, if I made a change to a PR in a leaf file or a file like <code>noshake</code> that isn't related to building mathlib, then CI would be very fast, because it would get the cache from the previous CI run. Now, it doesn't get any cache from the previous CI run (instead getting just the cache from base mathlib).</p>\n<p>This is very apparent in <a href=\"https://github.com/leanprover-community/mathlib4/pull/27888\">#27888</a>, where I only  changed the <code>noshake</code> file, and now have to wait for 40 minutes again for CI to be done.</p>\n<p>I think this started happening when we switched to the new Github contribution model with forks.</p>",
        "id": 532537183,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1754212703
    },
    {
        "content": "<p>Could you show the output from <code>lake exe cache get</code>? It should include diagnostic information about which cache it is trying to retrieve from.</p>",
        "id": 532545591,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1754219428
    },
    {
        "content": "<p>I see, it says just:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Using</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">origin</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span>\n<span class=\"n\">Attempting</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">download</span><span class=\"w\"> </span><span class=\"mi\">6325</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"w\"> </span><span class=\"n\">cache</span>\n</code></pre></div>\n<p>so ... we have a problem here, and need to work out why <code>cache</code> is not trying to use the <code>JovanGerb</code> cache (in addition to the central one).</p>",
        "id": 532545835,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1754219633
    },
    {
        "content": "<p>If someone would like to investigate this, that would be great.</p>",
        "id": 532612398,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1754264025
    },
    {
        "content": "<p>This issue turns out to be part of what's causing CI trouble, see <a class=\"message-link\" href=\"/#narrow/channel/287929-mathlib4/topic/Failing.20CI/near/533575058\">#mathlib4 &gt; Failing CI @ ðŸ’¬</a></p>",
        "id": 533598474,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1754769416
    },
    {
        "content": "<p>Maybe it's well known here, but let me still mention it again: our CI (on the runners), when building a PR to mathlib from a fork, only downloads the cache from the leanprover community cache, and not from the fork's cache. I noticed that in <a href=\"https://github.com/leanprover-community/mathlib4/actions/runs/16864962436/job/47770567564\">https://github.com/leanprover-community/mathlib4/actions/runs/16864962436/job/47770567564</a>: this is a PR which modifies a very basic file, and each time I push a commit then CI rebuilds all of mathlib, although most of it is already available from the fork cache. You can see that in the step <code>get cache (3/3)</code> .</p>",
        "id": 533669408,
        "sender_full_name": "SÃ©bastien GouÃ«zel",
        "timestamp": 1754851432
    },
    {
        "content": "<p>This could maybe be solved by adding the <code>--repo</code> flag, as in the post-build step checking the cache.</p>",
        "id": 533669606,
        "sender_full_name": "SÃ©bastien GouÃ«zel",
        "timestamp": 1754851535
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110050\">SÃ©bastien GouÃ«zel</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Mathlib.20CI.20doesn't.20get.20all.20available.20cache/near/533669606\">said</a>:</p>\n<blockquote>\n<p>This could maybe be solved by adding the <code>--repo</code> flag, as in the post-build step checking the cache.</p>\n</blockquote>\n<p>I've opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/28253\">#28253</a> for this.</p>",
        "id": 533833948,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1754931673
    },
    {
        "content": "<p>are you free in 30 minutes?</p>",
        "id": 543393840,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1759779081
    },
    {
        "content": "<p>oops wrong thread lol</p>",
        "id": 543393951,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1759779121
    }
]