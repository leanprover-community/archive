[
    {
        "content": "<p>The following is trying to prove a TODO in <br>\n<a href=\"https://github.com/leanprover-community/mathlib4/blob/v4.26.0/Mathlib/Combinatorics/SimpleGraph/Bipartite.lean\">https://github.com/leanprover-community/mathlib4/blob/v4.26.0/Mathlib/Combinatorics/SimpleGraph/Bipartite.lean</a> from <span class=\"user-mention\" data-user-id=\"688480\">@Mitchell Horner</span> with one sorry left in Theorem \"No Odd Cycles Implies Bipartite\". I'm trying to fill the sorry (just try because I cannot ensure that the mathematical proof is suitable. It has not been checked mathematically)</p>\n<ol>\n<li>\n<p>Establish Component-Wise Structure</p>\n<p>The proof proceeds by analyzing each connected component of the graph independently. Since a graph is bipartite if and only if every connected component is bipartite, it suffices to prove the theorem for connected graphs. For disconnected graphs, we apply the same reasoning to each component separately and then combine the resulting colorings. This reduction allows us to assume, without loss of generality, that the graph G is connected for the remainder of the argument.</p>\n</li>\n<li>\n<p>Define a Candidate Coloring Based on Distance Parity</p>\n<p>Select an arbitrary vertex r in V as a root. For any vertex v ∈ V, define a coloring function color(v) as the parity (modulo 2) of the graph distance dist_G(r, v). Specifically, color(v) = 0 if the distance is even and color(v) = 1 if the distance is odd. This definition is intuitive: vertices at even distances from the root are assigned one color, and vertices at odd distances are assigned the other.</p>\n</li>\n<li>\n<p>Verify the Coloring is Well-Defined</p>\n<p>A potential issue arises: the distance dist_G(r, v) is defined as the length of a shortest path, but there might be multiple shortest paths. We must show that all shortest paths from r to any vertex v have the same parity. Suppose, for contradiction, that there exist two paths p₁ and p₂ from r to v such that length(p₁) is even and length(p₂) is odd. The concatenation of p₁ with the reverse of p₂ forms a closed walk from r to r. While this closed walk might not be a simple cycle, it contains a cycle (by standard graph theory lemmas about walks). The total length of this closed walk is length(p₁) + length(p₂), which is odd. Since an odd closed walk must contain an odd cycle, this contradicts the hypothesis that all cycles in G have even length. Therefore, the parity of the distance is uniquely determined.</p>\n</li>\n<li>\n<p>Prove Adjacent Vertices Receive Different Colors</p>\n<p>Consider an edge (u, v) ∈ G.edgeSet. We aim to show color(u) ≠ color(v). Assume, for contradiction, that color(u) = color(v), meaning dist_G(r, u) and dist_G(r, v) have the same parity. Let p be a shortest path from r to u. Consider the walk formed by concatenating p, the single edge (u, v), and then a shortest path from v back to r. The length of this closed walk is dist_G(r, u) + 1 + dist_G(r, v). Since the two distances have the same parity, their sum is even, and adding 1 makes the total length odd. This closed walk, being of odd length, must contain an odd cycle (again, by the property that any odd closed walk contains an odd cycle). This contradicts the assumption that all cycles are even. Hence, adjacent vertices must have different colors.</p>\n</li>\n<li>\n<p>Construct the Bipartite Structure</p>\n<p>The function color : V → Fin 2 defined above satisfies the condition of a proper 2-coloring: for every edge (u, v), we have color(u) ≠ color(v). This is precisely the definition of a SimpleGraph.Coloring (Fin 2). Therefore, we can construct a coloring object and conclude that G is bipartite, as G.IsBipartite is defined by the existence of such a coloring.</p>\n</li>\n<li>\n<p>Address the Empty Graph and Corner Cases</p>\n<p>If the vertex set V is empty, the statement holds vacuously. If the graph has no edges, any coloring is valid, so the graph is trivially bipartite. The proof outlined above covers the non-trivial case where G has at least one edge and is connected. The formalization in Lean would need to handle these degenerate cases explicitly, though they are straightforward.</p>\n</li>\n</ol>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">)</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">unusedSectionVars</span><span class=\"w\"> </span><span class=\"n\">false</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">even_length_iff_same_color</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Coloring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)}</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Even</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">nil</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"c1\">-- Base case: length 0 is even, c u = c u is true</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"n\">h_adj</span><span class=\"w\"> </span><span class=\"n\">p_tail</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"c1\">-- Inductive step</span>\n<span class=\"w\">    </span><span class=\"c1\">-- Goal: Even (cons ...).length ↔ c u = c w</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h_first_step_diff</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">valid</span><span class=\"w\"> </span><span class=\"n\">h_adj</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"bp\">.</span><span class=\"n\">length_cons</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">even_add_one</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"c1\">-- 1 + x is even &lt;-&gt; x is odd</span>\n\n<span class=\"w\">    </span><span class=\"c1\">-- Using induction hypothesis ih: Even p_tail.length ↔ c v = c w</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ih</span><span class=\"o\">]</span>\n\n<span class=\"w\">    </span><span class=\"c1\">-- Now the goal becomes: ¬(c v = c w) ↔ c u = c w</span>\n<span class=\"w\">    </span><span class=\"n\">constructor</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"c1\">-- Direction 1: (c next ≠ c end) -&gt; (c start = c end)</span>\n<span class=\"w\">      </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h_next_ne_end</span>\n\n<span class=\"w\">      </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h_cases</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">        </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">left</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">        </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"w\">      </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">h_cases</span>\n<span class=\"w\">      </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"c1\">-- Case 1: c u = 0</span>\n<span class=\"w\">        </span><span class=\"n\">simp_all</span>\n<span class=\"w\">        </span><span class=\"n\">omega</span>\n<span class=\"w\">      </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"c1\">-- Case 2: c u = 1</span>\n<span class=\"w\">        </span><span class=\"n\">simp_all</span>\n<span class=\"w\">        </span><span class=\"n\">omega</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"c1\">-- Direction 2: (c start = c end) -&gt; (c next ≠ c end)</span>\n<span class=\"w\">      </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h_start_eq_end</span>\n<span class=\"w\">      </span><span class=\"c1\">-- Given: start ≠ next</span>\n<span class=\"w\">      </span><span class=\"c1\">-- Replacing start with end, we get end ≠ next</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h_start_eq_end</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h_first_step_diff</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">h_first_step_diff</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n\n<span class=\"sd\">/-- Our target theorem: G is bipartite ↔ All cycles in G have even length -/</span>\n<span class=\"c1\">-- Proof of necessity</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">bipartite_implies_even_cycles</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">IsBipartite</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">IsCycle</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Even</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"c1\">-- 1. Since it's a bipartite graph, there exists a 2-coloring scheme (color : V -&gt; Bool)</span>\n<span class=\"w\">  </span><span class=\"n\">rcases</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">color</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"c1\">-- 2. Analyze any cycle c</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">hc</span>\n\n<span class=\"w\">  </span><span class=\"c1\">-- 3. Use Walk property: In a bipartite graph, if a path has same start and end color,</span>\n<span class=\"w\">  </span><span class=\"c1\">--    then the path length must be even.</span>\n<span class=\"w\">  </span><span class=\"c1\">--    A cycle starts and ends at the same point v, so colors are obviously the same.</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h_color_eq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">color</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">color</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"w\">  </span><span class=\"c1\">-- 4. Call the lemma about bipartite path parity in Mathlib</span>\n<span class=\"w\">  </span><span class=\"c1\">-- (SimpleGraph.Coloring.valid_walk_length_even_iff)</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">even_length_iff_same_color</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">color</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">Walk</span>\n\n<span class=\"c1\">-- Helper lemma 1: The prefix of a shortest path is also a shortest path</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">dist_eq_length_takeUntil</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">IsPath</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hp_len</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">dist</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">support</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">takeUntil</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">dist</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"c1\">-- Strategy: Prove takeUntil yields a path, and length ≤ dist</span>\n<span class=\"w\">  </span><span class=\"c1\">-- Since dist ≤ length of any walk, they are equal</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">p_to_x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">takeUntil</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">hx</span>\n\n<span class=\"w\">  </span><span class=\"c1\">-- p_to_x is a path</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hp_to_x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p_to_x</span><span class=\"bp\">.</span><span class=\"n\">IsPath</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">takeUntil</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">append</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">dropUntil</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">take_spec</span><span class=\"w\"> </span><span class=\"n\">hx</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hp</span><span class=\"bp\">.</span><span class=\"n\">takeUntil</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">  </span><span class=\"c1\">-- p_to_x.length ≤ p.length</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h_le</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p_to_x</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"bp\">.</span><span class=\"n\">length_takeUntil_le</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">hx</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h_triangle</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">dist</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">dist</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">dist</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">by_cases</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Reachable</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Reachable</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"bp\">;</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">q</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hq</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">dist</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">;</span>\n<span class=\"w\">        </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Reachable</span><span class=\"bp\">.</span><span class=\"n\">exists_walk_length_eq_dist</span><span class=\"w\"> </span><span class=\"n\">this</span>\n<span class=\"w\">      </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">r</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hr</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">dist</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">r</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hr</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">dist</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">          </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h_reachable</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Reachable</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">right</span>\n<span class=\"w\">          </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Reachable</span><span class=\"bp\">.</span><span class=\"n\">exists_walk_length_eq_dist</span><span class=\"w\"> </span><span class=\"n\">h_reachable</span>\n<span class=\"w\">        </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"bp\">;</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">dist_le</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">append</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">|&gt;</span><span class=\"w\"> </span><span class=\"n\">le_trans</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"n\">decide</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"n\">hq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hr</span><span class=\"w\"> </span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">;</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">hp_to_x</span><span class=\"w\"> </span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">simp_all</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"n\">decide</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">Reachable</span><span class=\"w\"> </span><span class=\"o\">]</span><span class=\"bp\">;</span>\n<span class=\"w\">      </span><span class=\"n\">contrapose!</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">;</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"w\"> </span><span class=\"n\">p_to_x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">dropUntil</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h_dist_xv_le</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">dist</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">dropUntil</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">dist_le</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">dropUntil</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">)</span>\n\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h_eq_parts</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">p_to_x</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">dropUntil</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">congr_arg</span><span class=\"w\"> </span><span class=\"n\">Walk</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">take_spec</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"c1\">-- The length of the appended walk is the sum of the lengths of the two parts.</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"o\">]</span><span class=\"bp\">;</span>\n<span class=\"w\">    </span><span class=\"c1\">-- The length of the appended walk is the sum of the lengths of the two parts by definition.</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"bp\">.</span><span class=\"n\">length_append</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h_upper</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p_to_x</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">dist</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hp_len</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h_eq_parts</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">calc</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">dist</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span>\n<span class=\"w\">      </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">dist</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">dist</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h_triangle</span>\n<span class=\"w\">      </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">dist</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">dropUntil</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">add_le_add_left</span><span class=\"w\"> </span><span class=\"n\">h_dist_xv_le</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">    </span><span class=\"n\">omega</span>\n<span class=\"w\">  </span><span class=\"n\">refine'</span><span class=\"w\"> </span><span class=\"n\">le_antisymm</span><span class=\"w\"> </span><span class=\"n\">h_upper</span><span class=\"w\"> </span><span class=\"bp\">_;</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">dist_le</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">takeUntil</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">)</span>\n\n<span class=\"c1\">-- Helper lemma 2: Length of the suffix of a shortest path</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">length_dropUntil_eq_dist_sub</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">IsPath</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hp_len</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">dist</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">support</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">dropUntil</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">dist</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">dist</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">congr_arg</span><span class=\"w\"> </span><span class=\"n\">Walk</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">take_spec</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h4</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">takeUntil</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">dist</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"bp\">.</span><span class=\"n\">dist_eq_length_takeUntil</span><span class=\"w\"> </span><span class=\"o\">]</span><span class=\"bp\">;</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">assumption</span><span class=\"bp\">;</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hp_len</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">h4</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">hp_len</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"bp\">.</span><span class=\"n\">length_append</span><span class=\"w\"> </span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">aesop</span>\n\n<span class=\"c1\">-- Proof of sufficiency: If all cycles have even length, then the graph is bipartite</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">no_odd_cycles_implies_bipartite</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">IsCycle</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Even</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">IsBipartite</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">bipartite_iff_all_cycles_even</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">IsBipartite</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">IsCycle</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Even</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">constructor</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"c1\">-- Forward direction: G is bipartite → all cycles have even length</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h_bip</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">bipartite_implies_even_cycles</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">h_bip</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"c1\">-- Reverse direction: all cycles have even length → G is bipartite</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h_even</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">no_odd_cycles_implies_bipartite</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">h_even</span>\n</code></pre></div>",
        "id": 565048345,
        "sender_full_name": "Nick Adfor",
        "timestamp": 1766426209
    },
    {
        "content": "<p><a class=\"stream-topic\" data-stream-id=\"217875\" href=\"/#narrow/channel/217875-Is-there-code-for-X.3F/topic/bipartite.20iff.20does.20not.20contain.20an.20odd.20cycle/with/562540826\">#Is there code for X? &gt; bipartite iff does not contain an odd cycle</a></p>",
        "id": 565049079,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1766426501
    },
    {
        "content": "<p>Can I ask that if you used AI to write the big message/code that you please disclose it? If not, ignore this</p>",
        "id": 565049293,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1766426581
    },
    {
        "content": "<p>(Nick uses LLMs to translate from Chinese)</p>",
        "id": 565049792,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1766426791
    },
    {
        "content": "<p>We already have <code>bipartite_implies_even_cycles</code> (without IsCycle assumption, which is not needed, and you also doesn't use it in your proof). <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Combinatorics/SimpleGraph/ConcreteColorings.html#SimpleGraph.two_colorable_iff_forall_loop_even\">SimpleGraph.two_colorable_iff_forall_loop_even</a></p>\n<p>I know of two ways to prove <code>bipartite_iff_all_cycles_even</code>. One, that you write about, requires lemma that odd closed walk contains odd cycle. I have a proof of this here <a class=\"message-link\" href=\"/#narrow/channel/217875-Is-there-code-for-X.3F/topic/bipartite.20iff.20does.20not.20contain.20an.20odd.20cycle/near/555369802\">#Is there code for X? &gt; bipartite iff does not contain an odd cycle @ 💬</a>, it's not in mathlib yet though. That lemma and <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Combinatorics/SimpleGraph/ConcreteColorings.html#SimpleGraph.two_colorable_iff_forall_loop_even\">SimpleGraph.two_colorable_iff_forall_loop_even</a> is all you need to prove <code>bipartite_iff_all_cycles_even</code>, this is because <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Combinatorics/SimpleGraph/ConcreteColorings.html#SimpleGraph.two_colorable_iff_forall_loop_even\">SimpleGraph.two_colorable_iff_forall_loop_even</a> already proves all the other details of your proof, like \"graph is bipartite if and only if every connected component is bipartite\" and constructing the coloring.</p>\n<p>That two helper lemmas you have might be useful for a different proof I have in mind. That is, constructing the odd cycle directly, without going through odd closed walk. The idea of that proof, is that you start with an arbitrary BFS tree rooted in <code>r</code>. Then, in the part of the proof were you take <code>(u, v) ∈ G.edgeSet</code> and assume <code>dist_G(r, u)</code> and <code>dist_G(r, v)</code> have the same parity. You take a vertex <code>z</code> that is the lowest common ancestor of <code>u</code> and <code>v</code> in the tree. You have to disprove the cases <code>z = u</code> and <code>z = v</code> using parity assumption. If <code>z ≠ u</code> and <code>z ≠ v</code> then concatenating the path from z to u, edge u v, and the path from v to z, yields a cycle (and not just a closed walk). And it is an odd cycle because of the parity assumption.</p>\n<p>A proof that uses arbitrary shortest paths, instead of starting with BFS tree might also be possible, but I haven't given it much thought. You would have to deal with a few more cases. One being, that the lowest point where the path r-&gt;u meets with the path r-&gt;v, and the lowest point where that path r-&gt;v meets with the path r-&gt;u could be different (I think that's <del>impossible</del> possible from the assumption that these paths are the shortest paths?)</p>",
        "id": 565060312,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1766432152
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 565060394,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1766432179
    },
    {
        "content": "<p>The \"graph is bipartite if and only if every connected component is bipartite\" part was actually very nontrivial and we have to thank <span class=\"user-mention\" data-user-id=\"506168\">@John Talbot</span> for his work on it. :)</p>",
        "id": 565061484,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1766432758
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"933054\">Snir Broshi</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Formalizing.20Graph.20Theory.20-.20The.20Odd.20Cycle.20Theorem.20in.20Lean/near/565049293\">said</a>:</p>\n<blockquote>\n<p>Can I ask that if you used AI to write the big message/code that you please disclose it? If not, ignore this</p>\n</blockquote>\n<p>The origin code comments are Chinese :( maybe I should write another pure English version.</p>\n<p>As for the \"long math proof\" about Theorem \"No Odd Cycles Implies Bipartite\", I should say that I do not understand it very well. The more precise proof is in the textbook (I can provide a picture)</p>",
        "id": 565093924,
        "sender_full_name": "Nick Adfor",
        "timestamp": 1766460239
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/oZ4qzepx1Sw9OZMR9pxs1-ZK/c860c667-f601-4b81-ab2b-6f6d7b9cdd16.jpg\">precise and concise proof.jpg</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/oZ4qzepx1Sw9OZMR9pxs1-ZK/c860c667-f601-4b81-ab2b-6f6d7b9cdd16.jpg\" title=\"precise and concise proof.jpg\"><img data-original-content-type=\"image/jpeg\" data-original-dimensions=\"1500x2662\" src=\"/user_uploads/thumbnail/3121/oZ4qzepx1Sw9OZMR9pxs1-ZK/c860c667-f601-4b81-ab2b-6f6d7b9cdd16.jpg/840x560.webp\"></a></div>",
        "id": 565093974,
        "sender_full_name": "Nick Adfor",
        "timestamp": 1766460318
    },
    {
        "content": "<p>I think that \"Since the first vertex of each of these walks is x there is a vertex z that is the last common vertex of these two walks\" is not true.<br>\nThis is because you can take the last vertex on the walk x⋯a that is common with the walk x⋯b, and you can take the last vertex on the walk x⋯b that is common with the walk x⋯a. And these two are not necessarily equal.</p>",
        "id": 565094255,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1766460741
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"870257\">Jakub Nowak</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Formalizing.20Graph.20Theory.20-.20The.20Odd.20Cycle.20Theorem.20in.20Lean/near/565060312\">said</a>:</p>\n<blockquote>\n<p>A proof that uses arbitrary shortest paths, instead of starting with BFS tree might also be possible, but I haven't given it much thought. You would have to deal with a few more cases. One being, that the lowest point where the path r-&gt;u meets with the path r-&gt;v, and the lowest point where that path r-&gt;v meets with the path r-&gt;u could be different (I think that's impossible from the assumption that these paths are the shortest paths?)</p>\n</blockquote>\n<p>Since you refered to \"that's impossible\", I would consider give up that :(</p>",
        "id": 565095123,
        "sender_full_name": "Nick Adfor",
        "timestamp": 1766461816
    },
    {
        "content": "<p>Oh no, sorry, that was a typo, I meant possible, not impossible.</p>",
        "id": 565095143,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1766461846
    },
    {
        "content": "<p>I meant that the last vertex on the path x⋯a that is common with the path x⋯b, and the last vertex on the path x⋯b that is common with the path x⋯a are not necessarily equal for arbitrary paths. For example, they aren't equal for paths <code>x u v a</code> and <code>x v u b</code>. However, I suspect that they must be equal if you also take into consideration that these paths are the shortest paths. And your <code>dist_eq_length_takeUntil</code> lemma is I think useful in a proof of that equality.</p>",
        "id": 565095501,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1766462279
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"870257\">Jakub Nowak</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Formalizing.20Graph.20Theory.20-.20The.20Odd.20Cycle.20Theorem.20in.20Lean/near/565095501\">said</a>:</p>\n<blockquote>\n<p>I meant that the last vertex on the path x⋯a that is common with the path x⋯b, and the last vertex on the path x⋯b that is common with the path x⋯a are not necessarily equal for arbitrary paths. For example, they aren't equal for paths <code>x u v a</code> and <code>x v u b</code>. However, I suspect that they must be equal if you also take into consideration that these paths are the shortest paths. And your <code>dist_eq_length_takeUntil</code> lemma is I think useful in a proof of that equality.</p>\n</blockquote>\n<p>Is there difference between the proof 11.4.1 in my posted picture and the code already posted in <a class=\"stream-topic\" data-stream-id=\"217875\" href=\"/#narrow/channel/217875-Is-there-code-for-X.3F/topic/bipartite.20iff.20does.20not.20contain.20an.20odd.20cycle/with/565095054\">#Is there code for X? &gt; bipartite iff does not contain an odd cycle</a></p>",
        "id": 565097202,
        "sender_full_name": "Nick Adfor",
        "timestamp": 1766464098
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"877182\">Nick_adfor</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Formalizing.20Graph.20Theory.20-.20The.20Odd.20Cycle.20Theorem.20in.20Lean/near/565097202\">said</a>:</p>\n<blockquote>\n<p>Is there difference between the proof 11.4.1 in my posted picture and the code already posted in <a class=\"stream-topic\" data-stream-id=\"217875\" href=\"/#narrow/channel/217875-Is-there-code-for-X.3F/topic/bipartite.20iff.20does.20not.20contain.20an.20odd.20cycle/with/565095054\">#Is there code for X? &gt; bipartite iff does not contain an odd cycle</a></p>\n</blockquote>\n<p>You mean the proof that defines <code>odd_cycle_of_odd_walk</code>? I think, these two are very different. The proof via <code>odd_cycle_of_odd_walk</code> is pretty much the same proof you described in your first post in this topic <a class=\"message-link\" href=\"/#narrow/channel/287929-mathlib4/topic/Formalizing.20Graph.20Theory.20-.20The.20Odd.20Cycle.20Theorem.20in.20Lean/near/565048345\">#mathlib4 &gt; Formalizing Graph Theory - The Odd Cycle Theorem in Lean @ 💬</a>.</p>\n<p>The proof of 11.4.1 and your have common parts, but they diverge in how the odd cycle is constructed. Your proof constructs an odd closed walk, and then invokes on the lemma that you can extract odd cycle from odd closed walk. The proof of 11.4.1 tries to construct odd cycle directly, without going through odd closed walk.</p>",
        "id": 565098174,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1766464996
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"870257\">Jakub Nowak</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Formalizing.20Graph.20Theory.20-.20The.20Odd.20Cycle.20Theorem.20in.20Lean/near/565094255\">said</a>:</p>\n<blockquote>\n<p>I think that \"Since the first vertex of each of these walks is x there is a vertex z that is the last common vertex of these two walks\" is not true.<br>\nThis is because you can take the last vertex on the walk x⋯a that is common with the walk x⋯b, and you can take the last vertex on the walk x⋯b that is common with the walk x⋯a. And these two are not necessarily equal.</p>\n</blockquote>\n<p>Yes, and till now I've not introduced any definition. I may think that I need a new def on  \"the last common vertex\". The \"… is not true\" might be because it is  not-well-defined</p>",
        "id": 565098402,
        "sender_full_name": "Nick Adfor",
        "timestamp": 1766465247
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/AUaUgJvD5oHUjiUt6XWbHRF1/Finish-bipartite_iff_all_cycles_even.lean\">Finish bipartite_iff_all_cycles_even.lean</a></p>",
        "id": 565104159,
        "sender_full_name": "Nick Adfor",
        "timestamp": 1766471238
    },
    {
        "content": "<p>This is generated by Aristotle. It focus on a definition in Mathlib \"bypass\". What is \"bypass\"?...... It's not in the textbook, just in Mathlib. <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Combinatorics/SimpleGraph/Paths.html\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/Combinatorics/SimpleGraph/Paths.html</a></p>",
        "id": 565104411,
        "sender_full_name": "Nick Adfor",
        "timestamp": 1766471479
    },
    {
        "content": "<p>I try to explain what happened to the proof. First this theorem no_odd_cycles_implies_bipartite (also in the textbook, see the picture) relies on the well-definition about the last common vertex, but now we don't have a well-definition (see what Jakub Nowak has said before). So anything connected with that should be deleted. That is to delete the second part of the constructor.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c\">/-</span><span class=\"cm\"> Aristotle failed to find a proof. -/</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">no_odd_cycles_implies_bipartite</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">IsCycle</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Even</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">IsBipartite</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">bipartite_iff_all_cycles_even</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">IsBipartite</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">IsCycle</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Even</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">constructor</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h_bip</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">bipartite_implies_even_cycles</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">h_bip</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h_even</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">no_odd_cycles_implies_bipartite</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">h_even</span><span class=\"w\"> </span><span class=\"c1\">-- replace this line with `sorry`</span>\n</code></pre></div>\n<p>And in this way, Aristotle was able to rely on another well-definition already in Mathlib, that is \"bypass\".</p>",
        "id": 565105035,
        "sender_full_name": "Nick Adfor",
        "timestamp": 1766471963
    },
    {
        "content": "<p>Very thanks for <span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span>'s work to introduce definition about \"bypass\", which solves this problem on The Odd Cycle Theorem, (though I'm not so familiar with the definition and unable to find some references)</p>",
        "id": 565113948,
        "sender_full_name": "Nick Adfor",
        "timestamp": 1766477231
    },
    {
        "content": "<p>So did you prove it? Is there a PR?</p>",
        "id": 565115164,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1766477913
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"933054\">Snir Broshi</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Formalizing.20Graph.20Theory.20-.20The.20Odd.20Cycle.20Theorem.20in.20Lean/near/565115164\">said</a>:</p>\n<blockquote>\n<p>So did you prove it? Is there a PR?</p>\n</blockquote>\n<p>There's a file but not a PR yet</p>",
        "id": 565115514,
        "sender_full_name": "Nick Adfor",
        "timestamp": 1766478102
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"877182\">Nick_adfor</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Formalizing.20Graph.20Theory.20-.20The.20Odd.20Cycle.20Theorem.20in.20Lean/near/565104159\">said</a>:</p>\n<blockquote>\n<p><a href=\"/user_uploads/3121/AUaUgJvD5oHUjiUt6XWbHRF1/Finish-bipartite_iff_all_cycles_even.lean\">Finish bipartite_iff_all_cycles_even.lean</a></p>\n</blockquote>\n<p>Here</p>",
        "id": 565115540,
        "sender_full_name": "Nick Adfor",
        "timestamp": 1766478116
    },
    {
        "content": "<p>I though that <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Walk.bypass#doc\">docs#Walk.bypass</a> couldn't be useful for this theorem, but going away from closed walks to prove <code>Even p.length ↔ Even p.bypass.length</code> by induction was pretty clever. The proof made by AI is much more complicated than it could be, I think for mathlib PR a human would have to redo the proofs. I did rewrite part of the proof and I think that it could end up being a very nice proof, probably shorter and simpler than mine.</p>",
        "id": 565120962,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1766480698
    },
    {
        "content": "<p>When I wrote that todo I imagined a proof in terms of containment.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"bp\">.</span><span class=\"n\">IsCycle</span><span class=\"bp\">.</span><span class=\"n\">adj_getVert_of_cycleGraph_adj</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">IsCycle</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hadj</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">cycleGraph</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">Adj</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Adj</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">getVert</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">getVert</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rcases</span><span class=\"w\"> </span><span class=\"n\">eq_zero_or_neZero</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">heq</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">heq</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">i</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"n\">elim0</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">wlog</span><span class=\"w\"> </span><span class=\"n\">hlt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"n\">generalizing</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">j</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">adj_comm</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">hadj</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">lt_of_le_of_ne</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">le_of_not_gt</span><span class=\"w\"> </span><span class=\"n\">hlt</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">hadj</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"bp\">.</span><span class=\"n\">ne</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">by_cases</span><span class=\"w\"> </span><span class=\"n\">hi</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">      </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hi</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">cycleGraph_adj'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">zero_sub</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sub_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">neg_def</span><span class=\"o\">,</span>\n<span class=\"w\">          </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">mod_eq_of_lt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">omega</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">sub_eq_iff_eq_add</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"bp\">.</span><span class=\"n\">is_lt</span><span class=\"bp\">.</span><span class=\"n\">le</span><span class=\"o\">,</span>\n<span class=\"w\">          </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">sub_eq_iff_eq_add'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">omega</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">eq_comm</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hadj</span>\n<span class=\"w\">        </span><span class=\"n\">rcases</span><span class=\"w\"> </span><span class=\"n\">hadj</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">hsnd</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">hpen</span>\n<span class=\"w\">        </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hi</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">val_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hsnd</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Walk</span><span class=\"bp\">.</span><span class=\"n\">getVert_zero</span><span class=\"o\">]</span>\n<span class=\"w\">          </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">adj_penultimate</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">not_nil</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n<span class=\"w\">        </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hi</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">val_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hpen</span><span class=\"o\">]</span>\n<span class=\"w\">          </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">adj_getVert_succ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">omega</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hsub</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">le_pred_of_lt</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"bp\">.</span><span class=\"n\">is_lt</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">trans'</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span>\n<span class=\"w\">            </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">sub_lt_self</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">pos_of_ne_zero</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">val_eq_zero_iff</span><span class=\"bp\">.</span><span class=\"n\">ne</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"n\">hi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">hlt</span><span class=\"bp\">.</span><span class=\"n\">le</span>\n<span class=\"w\">        </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">cycleGraph_adj'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">coe_sub_iff_lt</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"n\">hlt</span><span class=\"o\">,</span>\n<span class=\"w\">          </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">tsub_tsub_eq_add_tsub_of_le</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">val_fin_le</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"n\">hlt</span><span class=\"bp\">.</span><span class=\"n\">le</span><span class=\"o\">),</span>\n<span class=\"w\">          </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">sub_eq_iff_eq_add</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">omega</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">),</span>\n<span class=\"w\">          </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">sub_eq_iff_eq_add'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">pos_of_neZero</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">hsub</span><span class=\"bp\">.</span><span class=\"n\">ne'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">false_or</span><span class=\"o\">,</span>\n<span class=\"w\">          </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">sub_val_of_le</span><span class=\"w\"> </span><span class=\"n\">hlt</span><span class=\"bp\">.</span><span class=\"n\">le</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">sub_eq_iff_eq_add'</span><span class=\"w\"> </span><span class=\"n\">hlt</span><span class=\"bp\">.</span><span class=\"n\">le</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hadj</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hadj</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">adj_getVert_succ</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"n\">is_lt</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"bp\">.</span><span class=\"n\">IsCycle</span><span class=\"bp\">.</span><span class=\"n\">toCopy</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">IsCycle</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Copy</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">cycleGraph</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toHom</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">getVert</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">adj_getVert_of_cycleGraph_adj</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"n\">injective'</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"n\">heq</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">getVert_injOn'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">le_pred_of_lt</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"n\">is_lt</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">le_pred_of_lt</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"bp\">.</span><span class=\"n\">is_lt</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">heq</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">ConnectedComponent</span><span class=\"bp\">.</span><span class=\"n\">toCopy</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">ConnectedComponent</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Copy</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">toSimpleGraph</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toHom</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">toSimpleGraph_hom</span>\n<span class=\"w\">  </span><span class=\"n\">injective'</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">toSimpleGraph_hom</span><span class=\"o\">]</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">IsBipartite</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Odd</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">cycleGraph</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">Free</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">constructor</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">contrapose!</span>\n<span class=\"w\">    </span><span class=\"n\">rintro</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hn</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h_odd</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h_cycle</span><span class=\"bp\">⟩</span>\n<span class=\"w\">    </span><span class=\"n\">contrapose</span><span class=\"w\"> </span><span class=\"n\">h_cycle</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">hc</span>\n<span class=\"w\">    </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">free_of_colorable</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"w\"> </span><span class=\"n\">hc</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hχ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">chromaticNumber_cycleGraph_of_odd</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">hn</span><span class=\"w\"> </span><span class=\"n\">h_odd</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"bp\">∞</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">norm_cast</span><span class=\"o\">,</span>\n<span class=\"w\">      </span><span class=\"n\">chromaticNumber_eq_iff_colorable_not_colorable</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hχ</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hχ</span><span class=\"bp\">.</span><span class=\"m\">2</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">colorable_iff_forall_connectedComponents</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">?_</span>\n<span class=\"w\">    </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">IsBipartite</span><span class=\"bp\">.</span><span class=\"n\">of_eachCycleEven</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">connected_toSimpleGraph</span>\n<span class=\"w\">    </span><span class=\"n\">contrapose!</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">v</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hW_cycle</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hW_len</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">W</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">?_⟩</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hW_cycle</span><span class=\"bp\">.</span><span class=\"n\">three_le_length</span><span class=\"bp\">.</span><span class=\"n\">trans'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">omega</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">odd_iff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">mod_two_of_bodd</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hW_len</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">toCopy</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"n\">hW_cycle</span><span class=\"bp\">.</span><span class=\"n\">toCopy</span><span class=\"bp\">⟩</span>\n</code></pre></div>\n<p>I just threw this together on top of <span class=\"user-mention\" data-user-id=\"870257\">@Jakub Nowak</span>'s proof of <code>SimpleGraph.IsBipartite.of_eachCycleEven</code> (<a href=\"https://live.lean-lang.org/#codez=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\">live.lean-lang.org</a>).</p>",
        "id": 565123568,
        "sender_full_name": "Mitchell Horner",
        "timestamp": 1766481875
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"870257\">Jakub Nowak</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Formalizing.20Graph.20Theory.20-.20The.20Odd.20Cycle.20Theorem.20in.20Lean/near/565120962\">said</a>:</p>\n<blockquote>\n<p>I though that <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Walk.bypass#doc\">docs#Walk.bypass</a> couldn't be useful for this theorem.</p>\n</blockquote>\n<p>But in my file bypass finished some kind of proof<span aria-label=\"fear\" class=\"emoji emoji-1f628\" role=\"img\" title=\"fear\">:fear:</span></p>",
        "id": 565124380,
        "sender_full_name": "Nick Adfor",
        "timestamp": 1766482228
    },
    {
        "content": "<p>My intention in the second part of the sentence you cited was to say, that I was wrong in thinking that. I've tried to use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Walk.bypass#doc\">docs#Walk.bypass</a> before, and I failed. But formulation of the lemma <code>Even p.length ↔ Even p.bypass.length</code> is I think quite clever use of it.</p>",
        "id": 565125384,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1766482702
    },
    {
        "content": "<p>My version about the theorem eachCycleEven <a href=\"https://live.lean-lang.org/#codez=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\">bipartite_iff_all_cycles_even</a>. In this way, we have two different version now.</p>",
        "id": 565126191,
        "sender_full_name": "Nick Adfor",
        "timestamp": 1766483125
    },
    {
        "content": "<p>Ref <a class=\"stream-topic\" data-stream-id=\"217875\" href=\"/#narrow/channel/217875-Is-there-code-for-X.3F/topic/bipartite.20iff.20does.20not.20contain.20an.20odd.20cycle/with/565095054\">#Is there code for X? &gt; bipartite iff does not contain an odd cycle</a>:<br>\n<span class=\"user-mention silent\" data-user-id=\"870257\">Jakub Nowak</span> <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/bipartite.20iff.20does.20not.20contain.20an.20odd.20cycle/near/555369802\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"933054\">Snir Broshi</span> I will answer your question here.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"933054\">Snir Broshi</span> <a href=\"#narrow/channel/252551-graph-theory/topic/How.20to.20return.20Walk/near/555017212\">said</a>:</p>\n<blockquote>\n<p>I'm interested to learn how you managed to get an odd cycle from an odd walk, can you share the body of that function? This might enhance <a href=\"https://github.com/leanprover-community/mathlib4/pull/31217\">#31217</a></p>\n</blockquote>\n<p>Here's the implementation: <a href=\"https://live.lean-lang.org/#codez=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\">live.lean-lang.org</a><br>\nIt's implemented by following the walk, until first repetition of a vertex. This gives either a cycle, or a <code>A -&gt; B -&gt; A</code> walk. If it's an odd cycle, then we get an odd cycle, otherwise it has even length, we can recurse on the walk with the repetition bypassed, and the length of the whole walk is still kept odd. At some point we must end up with odd length cycle, because <code>.nil</code> has even length.</p>\n<p>If you try to apply similar algorithm to any closed walk, to get any cycle, the problem that arises is that we could always end up with <code>A -&gt; B -&gt; A</code> case. I think that the exact condition for when it is possible to extract cycle from closed walk isn't easy to formulate. E.g., you can't extract a cycle from such a walk: <code>A -&gt; B -&gt; C -&gt; B -&gt; C -&gt; D -&gt; C -&gt; E -&gt; F -&gt; E -&gt; C -&gt; B -&gt; A</code>. I think <code>IsTrail</code> is a good, simple condition. Odd length is another. Maybe another simple condition, weaker then <code>IsTrail</code>, is to require that the walk does not contain a back-and-forth <code>A -&gt; B -&gt; A</code> subwalk (this would require implementing similar recursive algorithm, the implementation from <a href=\"https://github.com/leanprover-community/mathlib4/pull/31217\">#31217</a> won't work).</p>\n</blockquote>",
        "id": 565128442,
        "sender_full_name": "Nick Adfor",
        "timestamp": 1766484132
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"933054\">Snir Broshi</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Formalizing.20Graph.20Theory.20-.20The.20Odd.20Cycle.20Theorem.20in.20Lean/near/565115164\">said</a>:</p>\n<blockquote>\n<p>So did you prove it? Is there a PR?</p>\n</blockquote>\n<p>NowI have a PR. For more problem in PR, there's another post.<br>\n<a href=\"#narrow/channel/144837-PR-reviews/topic/.2333257.20Odd.20Cycle.20Theorem/with/565301389\">(5126) #PR reviews &gt; #33257 Odd Cycle Theorem - Lean - Zulip</a></p>",
        "id": 565330126,
        "sender_full_name": "Nick Adfor",
        "timestamp": 1766625146
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"688480\">Mitchell Horner</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Formalizing.20Graph.20Theory.20-.20The.20Odd.20Cycle.20Theorem.20in.20Lean/near/565123568\">said</a>:</p>\n<blockquote>\n<p>When I wrote that todo I imagined a proof in terms of containment.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"bp\">.</span><span class=\"n\">IsCycle</span><span class=\"bp\">.</span><span class=\"n\">adj_getVert_of_cycleGraph_adj</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">IsCycle</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hadj</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">cycleGraph</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">Adj</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Adj</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">getVert</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">getVert</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rcases</span><span class=\"w\"> </span><span class=\"n\">eq_zero_or_neZero</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">heq</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">heq</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">i</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"n\">elim0</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">wlog</span><span class=\"w\"> </span><span class=\"n\">hlt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"n\">generalizing</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">j</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">adj_comm</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">hadj</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">lt_of_le_of_ne</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">le_of_not_gt</span><span class=\"w\"> </span><span class=\"n\">hlt</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">hadj</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"bp\">.</span><span class=\"n\">ne</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">by_cases</span><span class=\"w\"> </span><span class=\"n\">hi</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">      </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hi</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">cycleGraph_adj'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">zero_sub</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sub_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">neg_def</span><span class=\"o\">,</span>\n<span class=\"w\">          </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">mod_eq_of_lt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">omega</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">sub_eq_iff_eq_add</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"bp\">.</span><span class=\"n\">is_lt</span><span class=\"bp\">.</span><span class=\"n\">le</span><span class=\"o\">,</span>\n<span class=\"w\">          </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">sub_eq_iff_eq_add'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">omega</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">eq_comm</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hadj</span>\n<span class=\"w\">        </span><span class=\"n\">rcases</span><span class=\"w\"> </span><span class=\"n\">hadj</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">hsnd</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">hpen</span>\n<span class=\"w\">        </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hi</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">val_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hsnd</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Walk</span><span class=\"bp\">.</span><span class=\"n\">getVert_zero</span><span class=\"o\">]</span>\n<span class=\"w\">          </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">adj_penultimate</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">not_nil</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n<span class=\"w\">        </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hi</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">val_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hpen</span><span class=\"o\">]</span>\n<span class=\"w\">          </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">adj_getVert_succ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">omega</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hsub</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">le_pred_of_lt</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"bp\">.</span><span class=\"n\">is_lt</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">trans'</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span>\n<span class=\"w\">            </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">sub_lt_self</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">pos_of_ne_zero</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">val_eq_zero_iff</span><span class=\"bp\">.</span><span class=\"n\">ne</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"n\">hi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">hlt</span><span class=\"bp\">.</span><span class=\"n\">le</span>\n<span class=\"w\">        </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">cycleGraph_adj'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">coe_sub_iff_lt</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"n\">hlt</span><span class=\"o\">,</span>\n<span class=\"w\">          </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">tsub_tsub_eq_add_tsub_of_le</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">val_fin_le</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"n\">hlt</span><span class=\"bp\">.</span><span class=\"n\">le</span><span class=\"o\">),</span>\n<span class=\"w\">          </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">sub_eq_iff_eq_add</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">omega</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">),</span>\n<span class=\"w\">          </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">sub_eq_iff_eq_add'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">pos_of_neZero</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">hsub</span><span class=\"bp\">.</span><span class=\"n\">ne'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">false_or</span><span class=\"o\">,</span>\n<span class=\"w\">          </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">sub_val_of_le</span><span class=\"w\"> </span><span class=\"n\">hlt</span><span class=\"bp\">.</span><span class=\"n\">le</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">sub_eq_iff_eq_add'</span><span class=\"w\"> </span><span class=\"n\">hlt</span><span class=\"bp\">.</span><span class=\"n\">le</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hadj</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hadj</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">adj_getVert_succ</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"n\">is_lt</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"bp\">.</span><span class=\"n\">IsCycle</span><span class=\"bp\">.</span><span class=\"n\">toCopy</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">Walk</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">IsCycle</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Copy</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">cycleGraph</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toHom</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">getVert</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">adj_getVert_of_cycleGraph_adj</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"n\">injective'</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"n\">heq</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">getVert_injOn'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">le_pred_of_lt</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"n\">is_lt</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">le_pred_of_lt</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"bp\">.</span><span class=\"n\">is_lt</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">heq</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">SimpleGraph</span><span class=\"bp\">.</span><span class=\"n\">ConnectedComponent</span><span class=\"bp\">.</span><span class=\"n\">toCopy</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">ConnectedComponent</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Copy</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">toSimpleGraph</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toHom</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">toSimpleGraph_hom</span>\n<span class=\"w\">  </span><span class=\"n\">injective'</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">toSimpleGraph_hom</span><span class=\"o\">]</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">IsBipartite</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Odd</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">cycleGraph</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">Free</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">constructor</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">contrapose!</span>\n<span class=\"w\">    </span><span class=\"n\">rintro</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hn</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h_odd</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h_cycle</span><span class=\"bp\">⟩</span>\n<span class=\"w\">    </span><span class=\"n\">contrapose</span><span class=\"w\"> </span><span class=\"n\">h_cycle</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">hc</span>\n<span class=\"w\">    </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">free_of_colorable</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"w\"> </span><span class=\"n\">hc</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hχ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">chromaticNumber_cycleGraph_of_odd</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">hn</span><span class=\"w\"> </span><span class=\"n\">h_odd</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"bp\">∞</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">norm_cast</span><span class=\"o\">,</span>\n<span class=\"w\">      </span><span class=\"n\">chromaticNumber_eq_iff_colorable_not_colorable</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hχ</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hχ</span><span class=\"bp\">.</span><span class=\"m\">2</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">colorable_iff_forall_connectedComponents</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">?_</span>\n<span class=\"w\">    </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">IsBipartite</span><span class=\"bp\">.</span><span class=\"n\">of_eachCycleEven</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">connected_toSimpleGraph</span>\n<span class=\"w\">    </span><span class=\"n\">contrapose!</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">v</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hW_cycle</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hW_len</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">W</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">?_⟩</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hW_cycle</span><span class=\"bp\">.</span><span class=\"n\">three_le_length</span><span class=\"bp\">.</span><span class=\"n\">trans'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">omega</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">odd_iff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">mod_two_of_bodd</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hW_len</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">toCopy</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"n\">hW_cycle</span><span class=\"bp\">.</span><span class=\"n\">toCopy</span><span class=\"bp\">⟩</span>\n</code></pre></div>\n<p>I just threw this together on top of <span class=\"user-mention silent\" data-user-id=\"870257\">Jakub Nowak</span>'s proof of <code>SimpleGraph.IsBipartite.of_eachCycleEven</code> (<a href=\"https://live.lean-lang.org/#codez=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\">live.lean-lang.org</a>).</p>\n</blockquote>\n<p>Mitchell, I've used my origin way to prove your TODO in my <a href=\"https://github.com/leanprover-community/mathlib4/pull/33257\">#33257</a> (means that the theorem statement is yours but the proof is mine). I'm wondering if your proof here will be next branch of my PR or if I should add it in my PR (even repeatedly prove the same theorem statement).</p>",
        "id": 566010484,
        "sender_full_name": "Nick Adfor",
        "timestamp": 1767318008
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"688480\">Mitchell Horner</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Formalizing.20Graph.20Theory.20-.20The.20Odd.20Cycle.20Theorem.20in.20Lean/near/565123568\">said</a>:</p>\n<blockquote>\n<p>When I wrote that todo I imagined a proof in terms of containment.</p>\n</blockquote>\n<p>Why do you need the theorem in term of containments? One possible direction where someone could try to go further, would be to prove some things about matchings in bipartite graphs. It's hard to guess what form of this theorem would be easier to use, but the one in terms <code>.IsCycle</code> seems to me much more usable than the one in terms of containments.</p>",
        "id": 569334787,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1769022628
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"870257\">Jakub Nowak</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Formalizing.20Graph.20Theory.20-.20The.20Odd.20Cycle.20Theorem.20in.20Lean/near/569334787\">said</a>:</p>\n<blockquote>\n<p>Why do you need the theorem in term of containments?</p>\n</blockquote>\n<p>For excluding cycles in forbidden subgraph problems. </p>\n<p><span class=\"user-mention silent\" data-user-id=\"870257\">Jakub Nowak</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Formalizing.20Graph.20Theory.20-.20The.20Odd.20Cycle.20Theorem.20in.20Lean/near/569334787\">said</a>:</p>\n<blockquote>\n<p>It's hard to guess what form of this theorem would be easier to use</p>\n</blockquote>\n<p>Ah. Sorry. I don't want the theorem in terms of containment because I think it is a better representation. <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span> On the contrary. The forbidden subgraph problems are written in terms of containment and I'd like to iff a containment statement to its corresponding statement in terms of <code>.IsCycle</code> - I agree with you that they are much more usable.</p>\n<p>Ideally, you have everything in terms of <code>.IsCycle</code> and then a handful of small lemmas/defs linking <code>.IsCycle</code> to <code>cycleGraph</code> and one small <code>iff</code> to convert the statement in discussion simply for convenience. (See <a href=\"https://github.com/leanprover-community/mathlib4/pull/33121#discussion_r2702395221\">this comment</a> on a PR implementing some of these for <code>pathGraph</code>.)</p>",
        "id": 569371949,
        "sender_full_name": "Mitchell Horner",
        "timestamp": 1769035583
    }
]