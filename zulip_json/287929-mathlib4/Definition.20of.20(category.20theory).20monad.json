[
    {
        "content": "<p>The <code>assoc</code> field of <code>Monad</code> is defined as</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">assoc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">toFunctor</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">NatTrans</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"n\">Œº</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">Œº</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Œº</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">Œº</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">aesop_cat</span>\n</code></pre></div>\n<p>Why is this definition used instead of the more natural / correct</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">whiskerLeft</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">Œº</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">Œº</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">whiskerRight</span><span class=\"w\"> </span><span class=\"n\">Œº</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">Œº</span>\n</code></pre></div>",
        "id": 533192326,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1754522933
    },
    {
        "content": "<p>(you need <code>\\ggg</code> right?)</p>",
        "id": 533192386,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754522988
    },
    {
        "content": "<p>No because \\mu is a natural transformation</p>",
        "id": 533192418,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1754523008
    },
    {
        "content": "<p>You are abusing the defeq that functor composition is associative</p>",
        "id": 533192419,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754523008
    },
    {
        "content": "<p>Yes</p>",
        "id": 533192434,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1754523021
    },
    {
        "content": "<p>But they're defeq and Mathlib/CategoryTheory does that all the time anyways?</p>",
        "id": 533192454,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1754523038
    },
    {
        "content": "<p>Or is it maybe because it was ported from Lean 3 and back then it wasn't defeq (I have no idea)</p>",
        "id": 533192516,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1754523096
    },
    {
        "content": "<p>Okay a better question, is it a good idea to change this?</p>",
        "id": 533192522,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1754523105
    },
    {
        "content": "<p>no the reason is that abusing defeq is bad</p>",
        "id": 533192530,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754523117
    },
    {
        "content": "<p>even though it's already done in a lot of places</p>",
        "id": 533192560,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754523131
    },
    {
        "content": "<p>How is it bad? Plus it's not even abusing defeq, and if you don't like it / want to recover the current definition just <code>ext</code> or <code>ext1</code> or something</p>",
        "id": 533193909,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1754524203
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"579936\">Gareth Ma</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Definition.20of.20.28category.20theory.29.20monad/near/533193909\">said</a>:</p>\n<blockquote>\n<p>Plus it's not even abusing defeq</p>\n</blockquote>\n<p>what?</p>",
        "id": 533195333,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754525334
    },
    {
        "content": "<p>I would consider the definition of defeq abuse to be \"doesn't typecheck at reducible transparency\":</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">checkAux</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">Check</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Functor</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Monad</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">whiskerLeft</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">Œº</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">Œº</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">whiskerRight</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">Œº</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">Œº</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Meta</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">error: Application type mismatch: In the application</span>\n<span class=\"sd\">  x.whiskerLeft x.Œº ‚â´ x.Œº = Functor.whiskerRight x.Œº x.toFunctor ‚â´ x.Œº</span>\n<span class=\"sd\">the argument</span>\n<span class=\"sd\">  Functor.whiskerRight x.Œº x.toFunctor ‚â´ x.Œº</span>\n<span class=\"sd\">has type</span>\n<span class=\"sd\">  (x.toFunctor ‚ãô x.toFunctor) ‚ãô x.toFunctor ‚ü∂ x.toFunctor : Type (max u_1 v)</span>\n<span class=\"sd\">but is expected to have type</span>\n<span class=\"sd\">  x.toFunctor ‚ãô x.toFunctor ‚ãô x.toFunctor ‚ü∂ x.toFunctor : Type (max v u_1)</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"n\">run_meta</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">getConstVal</span><span class=\"w\"> </span><span class=\"ss\">``test</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">val</span><span class=\"bp\">.</span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">withReducible</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">checkAux</span><span class=\"w\"> </span><span class=\"n\">type</span>\n</code></pre></div>\n<p>The problem here is that many tactics like <code>simp</code> operate on reducible transparency, so they might run into problems when trying to operate.</p>",
        "id": 533259972,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1754561111
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"579936\">@Gareth Ma</span> you could take a look at how we define <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Mon_class#doc\">docs#Mon_class</a> (and also how <code>Comon_class</code> is used to define comonads in a bicategory in mathlib)</p>",
        "id": 533326574,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1754584165
    },
    {
        "content": "<p>Note in particular the explicit use of associators and unitors</p>",
        "id": 533326664,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1754584198
    },
    {
        "content": "<p>For monoidal categories it makes sense since that‚Äôs data</p>",
        "id": 533326828,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1754584253
    },
    {
        "content": "<p>But here it‚Äôs defeq right</p>",
        "id": 533326845,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1754584259
    },
    {
        "content": "<p>(I hope I‚Äôm understanding your point correctly, I‚Äôm on phone right now but I can double check later)</p>",
        "id": 533326897,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1754584278
    },
    {
        "content": "<p>Or another question, is it a good idea to change the Monad assoc definition from the current one to what I suggested (with whiskering) but with associators added in</p>",
        "id": 533327257,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1754584398
    },
    {
        "content": "<p>Functor.assoc or something iirc</p>",
        "id": 533327271,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1754584405
    },
    {
        "content": "<p>I don't think we have the associators and unitor natural transformations for functor composition</p>",
        "id": 533327321,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754584427
    },
    {
        "content": "<p>I guess it's just <code>eqToHom</code></p>",
        "id": 533327488,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754584496
    },
    {
        "content": "<p>We used to abuse defeq for associators/unitors, but it turns out it is better practice to insert associators in definitions. Here it would be ok to make a lemma for this compatibility at the level of natural transformations, adding a different constructor, or even changing the definition.</p>",
        "id": 533327528,
        "sender_full_name": "Jo√´l Riou",
        "timestamp": 1754584512
    },
    {
        "content": "<p>No it's <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/CategoryTheory/Functor/Category.html#CategoryTheory.Functor.associator\">CategoryTheory.Functor.associator</a></p>",
        "id": 533327539,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1754584516
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"579936\">Gareth Ma</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Definition.20of.20.28category.20theory.29.20monad/near/533327539\">said</a>:</p>\n<blockquote>\n<p>No it's <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/CategoryTheory/Functor/Category.html#CategoryTheory.Functor.associator\">CategoryTheory.Functor.associator</a></p>\n</blockquote>\n<p>Oh I must have missed it</p>",
        "id": 533327621,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754584548
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"459699\">Jo√´l Riou</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Definition.20of.20.28category.20theory.29.20monad/near/533327528\">said</a>:</p>\n<blockquote>\n<p>We used to abuse defeq for associators/unitors, but it turns out it is better practice to insert associators in definitions. Here it would be ok to make a lemma for this compatibility at the level of natural transformations, adding a different constructor, or even changing the definition.</p>\n</blockquote>\n<p>So changing <code>Monad.assoc</code> definition to <code>whiskerLeft _ Œº \\ggg Functor.associator something ‚â´ Œº = whiskerRight Œº _ ‚â´ Functor.associator something \\ggg Œº</code> would fit what you're saying right</p>",
        "id": 533327744,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1754584601
    },
    {
        "content": "<p>(Whatever the correct statement is)</p>",
        "id": 533327805,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1754584630
    },
    {
        "content": "<p>Sure, I think such a defitinion could be made. But does this give any advantage?</p>",
        "id": 533328186,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1754584774
    },
    {
        "content": "<p>Monads and comonads are inherently a 2-categorical thing, and IMO the right abstraction is at that level.</p>",
        "id": 533328374,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1754584840
    },
    {
        "content": "<p>It‚Äôs what‚Äôs found in textbooks, you can recover the existing one with ext, but going the other way around seems more annoying (I used fun x -&gt; congrArg (fun a -&gt; <a href=\"http://a.app\">a.app</a> X or something)</p>",
        "id": 533328383,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1754584844
    },
    {
        "content": "<p>I think if you want to work at the level of natural transformations without applying them to a particular object, then you should formulate things in terms of bicategories</p>",
        "id": 533328694,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1754584956
    },
    {
        "content": "<p>cf <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CategoryTheory.Bicategory.Comonad#doc\">docs#CategoryTheory.Bicategory.Comonad</a></p>",
        "id": 533328884,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1754585035
    },
    {
        "content": "<p>Okay I will try that out then. I know it‚Äôs the natural place to do monad stuff but I just didn‚Äôt want to touch/learn it :) Thanks for the comments</p>",
        "id": 533329047,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1754585095
    },
    {
        "content": "<p>So eg the statement ‚Äúif a category has all limits then the codensity monad of a functor exists‚Äù should be in Bicategory?</p>",
        "id": 533329224,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1754585164
    },
    {
        "content": "<p>For an example of defeq abuse, here:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">findFinIdx?_cons_eq_some_succ_iff</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">findFinIdx?</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"bp\">‚Üî</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"bp\">‚àß</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"bp\">.</span><span class=\"n\">findFinIdx?</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">findFinIdx?_cons</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">split</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">simp_all</span><span class=\"w\"> </span><span class=\"o\">[(</span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">succ_ne_zero</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">simp_all</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">map_eq_some_iff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">succ_inj</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">exists_eq_right</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"bp\">.</span><span class=\"n\">not_eq_true</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">true_and</span><span class=\"o\">]</span>\n\n<span class=\"c1\">-- basically the same statement</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">findFinIdx?</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">‚Üî</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"bp\">‚àß</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"bp\">.</span><span class=\"n\">findFinIdx?</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">eq_comm</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">findFinIdx?_cons_eq_some_succ_iff</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"c1\">-- fails!!!</span>\n</code></pre></div>",
        "id": 533329329,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1754585212
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"579936\">Gareth Ma</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Definition.20of.20.28category.20theory.29.20monad/near/533329224\">said</a>:</p>\n<blockquote>\n<p>So eg the statement ‚Äúif a category has all limits then the codensity monad of a functor exists‚Äù should be in Bicategory?</p>\n</blockquote>\n<p>I think this is a statement about Kan extensions</p>",
        "id": 533329427,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1754585252
    },
    {
        "content": "<p>Yes</p>",
        "id": 533329450,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1754585265
    },
    {
        "content": "<p>In this example, the defeq abuse of <code>(x :: l).length = l.length + 1</code> causes problems because the <code>Eq</code> in the statement is about <code>Fin (x :: l).length</code> and we use it on <code>Fin (l.length + 1) later</code></p>",
        "id": 533329469,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1754585272
    },
    {
        "content": "<p>Codensity monad = Right Kan extension of F along F exists</p>",
        "id": 533329513,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1754585287
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">universe</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Monad</span><span class=\"bp\">.</span><span class=\"n\">mk'</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">‚•§</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ∑</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">ùü≠</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œº</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">‚ãô</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">mul_assoc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Functor</span><span class=\"bp\">.</span><span class=\"n\">whiskerRight</span><span class=\"w\"> </span><span class=\"n\">Œº</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">Œº</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">T</span><span class=\"bp\">.</span><span class=\"n\">associator</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">hom</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Functor</span><span class=\"bp\">.</span><span class=\"n\">whiskerLeft</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">Œº</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">Œº</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">one_mul</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Functor</span><span class=\"bp\">.</span><span class=\"n\">whiskerLeft</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">Œ∑</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">Œº</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"bp\">.</span><span class=\"n\">rightUnitor</span><span class=\"bp\">.</span><span class=\"n\">hom</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">mul_one</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Functor</span><span class=\"bp\">.</span><span class=\"n\">whiskerRight</span><span class=\"w\"> </span><span class=\"n\">Œ∑</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">Œº</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"bp\">.</span><span class=\"n\">leftUnitor</span><span class=\"bp\">.</span><span class=\"n\">hom</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Monad</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"n\">Œº</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Œ∑</span>\n<span class=\"w\">    </span><span class=\"n\">assoc</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">congr</span><span class=\"o\">((</span><span class=\"bp\">$</span><span class=\"n\">mul_assoc</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">left_unit</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">congr</span><span class=\"o\">((</span><span class=\"bp\">$</span><span class=\"n\">one_mul</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">right_unit</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">congr</span><span class=\"o\">((</span><span class=\"bp\">$</span><span class=\"n\">mul_one</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">}</span>\n</code></pre></div>",
        "id": 533331192,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754585968
    },
    {
        "content": "<p>Where can I learn more about the $ notation</p>",
        "id": 533331325,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1754586019
    },
    {
        "content": "<p>Wth is that</p>",
        "id": 533331333,
        "sender_full_name": "Gareth Ma",
        "timestamp": 1754586021
    },
    {
        "content": "<p>it's a monad</p>",
        "id": 533331351,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754586028
    },
    {
        "content": "<p>see, there's the associativity, and there's the left and right unit equations</p>",
        "id": 533331470,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754586078
    },
    {
        "content": "<p>The one in congr? That's part of the congr syntax itself</p>",
        "id": 533331539,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1754586104
    },
    {
        "content": "<p>oh this works too</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">universe</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Monad</span><span class=\"bp\">.</span><span class=\"n\">mk'</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">‚•§</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ∑</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">ùü≠</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œº</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">‚ãô</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">mul_assoc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Functor</span><span class=\"bp\">.</span><span class=\"n\">whiskerRight</span><span class=\"w\"> </span><span class=\"n\">Œº</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">Œº</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">T</span><span class=\"bp\">.</span><span class=\"n\">associator</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">hom</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Functor</span><span class=\"bp\">.</span><span class=\"n\">whiskerLeft</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">Œº</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">Œº</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">one_mul</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Functor</span><span class=\"bp\">.</span><span class=\"n\">whiskerLeft</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">Œ∑</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">Œº</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"bp\">.</span><span class=\"n\">rightUnitor</span><span class=\"bp\">.</span><span class=\"n\">hom</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">mul_one</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Functor</span><span class=\"bp\">.</span><span class=\"n\">whiskerRight</span><span class=\"w\"> </span><span class=\"n\">Œ∑</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">Œº</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"bp\">.</span><span class=\"n\">leftUnitor</span><span class=\"bp\">.</span><span class=\"n\">hom</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Monad</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toFunctor</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">T</span>\n<span class=\"w\">  </span><span class=\"n\">Œº</span>\n<span class=\"w\">  </span><span class=\"n\">Œ∑</span>\n<span class=\"w\">  </span><span class=\"n\">assoc</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">congr</span><span class=\"o\">((</span><span class=\"bp\">$</span><span class=\"n\">mul_assoc</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">left_unit</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">congr</span><span class=\"o\">((</span><span class=\"bp\">$</span><span class=\"n\">one_mul</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">right_unit</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">congr</span><span class=\"o\">((</span><span class=\"bp\">$</span><span class=\"n\">mul_one</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 533332340,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754586407
    },
    {
        "content": "<p>those lines with one character are so weird</p>",
        "id": 533332362,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754586419
    }
]