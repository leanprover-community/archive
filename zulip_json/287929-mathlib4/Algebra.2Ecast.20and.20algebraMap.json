[
    {
        "content": "<p>Currently something which is quite annoying for automation is that <code>simp</code> fails to show <code>algebraMap A B a = (a : B)</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">algebraMap</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommSemiring</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">algebraMap</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">fail_if_success</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>What's the best way to solve this? It's possible to just add it as a <code>@[simp]</code> lemma (probability scoped to <code>algebraMap</code>), and I've also thought about making <code>Algebra.cast</code> reducible, but I'm not sure about the exact pros and cons of either</p>",
        "id": 449430597,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1720236427
    },
    {
        "content": "<p>I have been working with algebraMap with algebraMap open and am also a bit confused about what the simp normal form is supposed to be. For quotients <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi><mi mathvariant=\"normal\">/</mi><mi>I</mi></mrow><annotation encoding=\"application/x-tex\">R/I</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mord\">/</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span></span></span></span> there's another coercion from <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi></mrow><annotation encoding=\"application/x-tex\">R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span></span> which exists even without algebraMap open (I asked a question about this recently) (edit: <a href=\"#narrow/stream/287929-mathlib4/topic/map.20to.20quotient.20ring.20diamond/near/445963180\">here</a>)</p>",
        "id": 449460602,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1720254990
    },
    {
        "content": "<p>We have two spellings here because the port interrupted a major refactor by <span class=\"user-mention\" data-user-id=\"238446\">@Anne Baanen</span>. I think changes to coercions to lean 4 made the original plan untenable.</p>",
        "id": 449462559,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1720256532
    },
    {
        "content": "<p>My vote would be to drop Algebra.cast until someone finds time to come up with a plan for a replacement refactor.</p>",
        "id": 449462595,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1720256578
    },
    {
        "content": "<p>So you're saying \"drop the coercion associated to <code>[Algebra A B]</code>\"? I'm using this coercion a lot, I love it.</p>",
        "id": 449467314,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1720258698
    },
    {
        "content": "<p>Or make it mean <code>algebraMap</code></p>",
        "id": 449487279,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1720269418
    },
    {
        "content": "<p>My understanding was that Lean 4 does not allow us to have things like <code>algebraMap</code> (whose type is not a function type) as coercions? I thought that this was why we introduced <code>Algebra.cast</code> in the first place?</p>",
        "id": 449495778,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1720272770
    },
    {
        "content": "<p>Arguably they work fine, and it's just the pretty-printing that doesn't</p>",
        "id": 449579239,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1720310836
    },
    {
        "content": "<p>I think the original goal might have been to drop <code>Nat.cast</code> and <code>Int.cast</code> and <code>Rat.cast</code> and use <code>Algebra.cast</code> as the spelling of all of them</p>",
        "id": 449579443,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1720310894
    },
    {
        "content": "<p>That goes against making <code>Nat</code>/<code>Int</code>/<code>Rat</code> foundational, right?</p>",
        "id": 449584274,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1720314954
    },
    {
        "content": "<p>I don't think so?</p>",
        "id": 449624512,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1720343168
    },
    {
        "content": "<p>It goes against the \"every coercion should be a different function\" thing that core seems to have designed for, but so does the design of Dfunlike</p>",
        "id": 449624666,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1720343291
    },
    {
        "content": "<p>A data only <code>AlgebraCast</code> type class next to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=NatCast#doc\">docs#NatCast</a> would do the trick.</p>",
        "id": 449624736,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1720343379
    },
    {
        "content": "<p>I've been experimenting with making Algebra.cast <code>@[reducible]</code> on <a href=\"https://github.com/leanprover-community/mathlib4/tree/CommandMaster_castReducible\">branch#CommandMaster_castReducible</a> (<a href=\"https://github.com/leanprover-community/mathlib4/pull/14601\">#14601</a>)</p>",
        "id": 450348153,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1720589279
    }
]