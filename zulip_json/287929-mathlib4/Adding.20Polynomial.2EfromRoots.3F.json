[
    {
        "content": "<p>I just checked that the Multiset prod paradigm is used somewhat regularly. Does it make sense to introduce a separate definition and rewrite existing theorems using the new definition?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">fromRootMultiset</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Multiset</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">prod</span>\n</code></pre></div>",
        "id": 558903262,
        "sender_full_name": "metakuntyyy",
        "timestamp": 1763912483
    },
    {
        "content": "<p>Loogle says the pattern occurs 27 times in mathlib; didn't check if there's any false positives</p>",
        "id": 558903672,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1763912816
    },
    {
        "content": "<p>Is that enough occurences to introduce a new definition?</p>",
        "id": 558903708,
        "sender_full_name": "metakuntyyy",
        "timestamp": 1763912857
    },
    {
        "content": "<p>Opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/32005\">#32005</a>. Feedback welcome.</p>",
        "id": 558909554,
        "sender_full_name": "metakuntyyy",
        "timestamp": 1763918872
    },
    {
        "content": "<p>Does anyone know how I can remove the simp rule I defined from aesop? My build's crashing: </p>\n<p>Error: error: Mathlib/Algebra/Polynomial/Factors.lean:215:2: aesop: error in norm simp: Tactic <code>simp</code> failed with a nested error:</p>",
        "id": 558910354,
        "sender_full_name": "metakuntyyy",
        "timestamp": 1763919641
    },
    {
        "content": "<p>Maybe <code>ofRootMultiset</code> is in better agreement with mathlib convention.</p>",
        "id": 558912070,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1763921435
    },
    {
        "content": "<p>How can I remove a specific theorem from the simp set for a whole file?</p>",
        "id": 558912339,
        "sender_full_name": "metakuntyyy",
        "timestamp": 1763921688
    },
    {
        "content": "<p>Is it <code>attribute [-simp] foo</code>?</p>",
        "id": 558912565,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1763921927
    },
    {
        "content": "<p>Build succeeded, lint failed. I think I did something off, how do I resolve this?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Run</span><span class=\"w\"> </span><span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"n\">pr</span><span class=\"bp\">-</span><span class=\"n\">branch</span>\n<span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"n\">pr</span><span class=\"bp\">-</span><span class=\"n\">branch</span>\n<span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"n\">LEAN_ABORT_ON_PANIC</span><span class=\"bp\">=</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">../</span><span class=\"n\">master</span><span class=\"bp\">-</span><span class=\"n\">branch</span><span class=\"bp\">/</span><span class=\"n\">scripts</span><span class=\"bp\">/</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">build</span><span class=\"bp\">-</span><span class=\"n\">wrapper</span><span class=\"bp\">.</span><span class=\"n\">py</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build_summary_lint</span><span class=\"bp\">.</span><span class=\"n\">json</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">runLinter</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"n\">Build</span><span class=\"w\"> </span><span class=\"n\">progress</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">starting</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"mi\">19</span><span class=\"bp\">/</span><span class=\"mi\">22</span><span class=\"o\">]</span>\n\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">19</span><span class=\"bp\">/</span><span class=\"mi\">22</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Array</span><span class=\"bp\">.</span><span class=\"n\">Basic</span><span class=\"o\">:</span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">294</span><span class=\"n\">ms</span><span class=\"o\">)</span>\n\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">20</span><span class=\"bp\">/</span><span class=\"mi\">22</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">runLinter</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">856</span><span class=\"n\">ms</span><span class=\"o\">)</span>\n\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">21</span><span class=\"bp\">/</span><span class=\"mi\">22</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">runLinter</span><span class=\"o\">:</span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">561</span><span class=\"n\">ms</span><span class=\"o\">)</span>\n\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">22</span><span class=\"bp\">/</span><span class=\"mi\">22</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">runLinter</span><span class=\"o\">:</span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">478</span><span class=\"n\">ms</span><span class=\"o\">)</span>\n\n<span class=\"n\">Running</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">specified</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"c1\">-- Found 2 errors in 276466 declarations (plus 199085 automatically generated ones) in Mathlib with 15 linters</span>\n\n<span class=\"c\">/-</span><span class=\"cm\"> The `simpNF` linter reports:</span>\n\n<span class=\"cm\">SOME SIMP LEMMAS ARE NOT IN SIMP-NORMAL FORM.</span>\n\n<span class=\"cm\">see note [simp-normal form] for tips how to debug this.</span>\n\n<span class=\"cm\">https://leanprover-community.github.io/mathlib_docs/notes.html#simp-normal%20form -/</span>\n<span class=\"c1\">-- Mathlib.Algebra.Polynomial.BigOperators</span>\n\n<span class=\"n\">Error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">actions</span><span class=\"bp\">-</span><span class=\"n\">runner</span><span class=\"bp\">/_</span><span class=\"n\">work</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">/</span><span class=\"n\">pr</span><span class=\"bp\">-</span><span class=\"n\">branch</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Algebra</span><span class=\"bp\">/</span><span class=\"n\">Polynomial</span><span class=\"bp\">/</span><span class=\"n\">BigOperators</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">272</span><span class=\"o\">:</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">Polynomial</span><span class=\"bp\">.</span><span class=\"n\">natDegree_multiset_prod_X_sub_C_eq_card</span><span class=\"w\"> </span><span class=\"n\">Left</span><span class=\"bp\">-</span><span class=\"n\">hand</span><span class=\"w\"> </span><span class=\"n\">side</span><span class=\"w\"> </span><span class=\"n\">simplifies</span><span class=\"w\"> </span><span class=\"k\">from</span>\n\n<span class=\"o\">(</span><span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span><span class=\"bp\">.</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span><span class=\"bp\">.</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">prod</span><span class=\"bp\">.</span><span class=\"n\">natDegree</span>\n\n<span class=\"n\">to</span>\n\n<span class=\"o\">(</span><span class=\"n\">Polynomial</span><span class=\"bp\">.</span><span class=\"n\">fromRootMultiset</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">natDegree</span>\n\n<span class=\"kn\">using</span>\n\n<span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">*</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">Polynomial</span><span class=\"bp\">.</span><span class=\"n\">fromRootMultiset_eq_map_prod</span><span class=\"o\">]</span>\n\n<span class=\"n\">Try</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">change</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">left</span><span class=\"bp\">-</span><span class=\"n\">hand</span><span class=\"w\"> </span><span class=\"n\">side</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">simplified</span><span class=\"w\"> </span><span class=\"n\">term!</span>\n<span class=\"c1\">-- Mathlib.Algebra.Polynomial.Roots</span>\n\n<span class=\"n\">Error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">actions</span><span class=\"bp\">-</span><span class=\"n\">runner</span><span class=\"bp\">/_</span><span class=\"n\">work</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">/</span><span class=\"n\">pr</span><span class=\"bp\">-</span><span class=\"n\">branch</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Algebra</span><span class=\"bp\">/</span><span class=\"n\">Polynomial</span><span class=\"bp\">/</span><span class=\"n\">Roots</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">292</span><span class=\"o\">:</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">Polynomial</span><span class=\"bp\">.</span><span class=\"n\">roots_multiset_prod_X_sub_C</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"w\"> </span><span class=\"n\">prove</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"o\">:</span>\n\n<span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">*</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">Polynomial</span><span class=\"bp\">.</span><span class=\"n\">fromRootMultiset_eq_map_prod</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">Polynomial</span><span class=\"bp\">.</span><span class=\"n\">roots_fromRootMultiset</span><span class=\"o\">]</span>\n\n<span class=\"n\">One</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">lemmas</span><span class=\"w\"> </span><span class=\"n\">above</span><span class=\"w\"> </span><span class=\"n\">could</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">duplicate</span><span class=\"bp\">.</span>\n\n<span class=\"n\">If</span><span class=\"w\"> </span><span class=\"n\">that's</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">try</span><span class=\"w\"> </span><span class=\"n\">reordering</span><span class=\"w\"> </span><span class=\"n\">lemmas</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">adding</span><span class=\"w\"> </span><span class=\"kd\">@[</span><span class=\"n\">priority</span><span class=\"kd\">]</span><span class=\"bp\">.</span>\n\n<span class=\"n\">Error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Process</span><span class=\"w\"> </span><span class=\"n\">completed</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">exit</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mf\">1.</span>\n</code></pre></div>",
        "id": 558913806,
        "sender_full_name": "metakuntyyy",
        "timestamp": 1763923246
    },
    {
        "content": "<p>Because you added <code>@[simp] theorem fromRootMultiset_eq_map_prod</code>, <code>(Multiset.map (fun (a : R) =&gt; X - C a) s).prod</code> is no longer a simp-normal form, so any other simp lemma with this in LHS needs to also change to the new simp-normal form <code>fromRootMultiset s</code></p>\n<p>If you don't want to do too much refactor now, perhaps remove <code>@[simp]</code> from <code>fromRootMultiset_eq_map_prod</code>?</p>",
        "id": 558914249,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1763923611
    },
    {
        "content": "<p>All the breaking that requires <code>simp [-fromRootMultiset_eq_map_prod]</code> to fix is effectively for the same reason</p>",
        "id": 558914332,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1763923673
    },
    {
        "content": "<p>I suspect that there are reasons against this change, though. Let's say I am new to mathlib, and I'd like to loogle <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Polynomial/BigOperators.html#Polynomial.natDegree_multiset_prod_X_sub_C_eq_card\">Polynomial.natDegree_multiset_prod_X_sub_C_eq_card</a> by guessing its statement. I might search for <code>Multiset.prod, Polynomial.natDegree</code>. It can find the theorem now, but it won't if we switch over to <code>fromRootMultiset</code> that hides the <code>Multiset.prod</code></p>",
        "id": 558914706,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1763924065
    },
    {
        "content": "<p>I am not totally conviced this is a good idea, I have the impression it just adds an abstraction layer that may be harmful. If in a file this is used a lot it can of course be a notation, and this is most likely a good ideam but a global definition I don't know.</p>",
        "id": 558916028,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1763925311
    },
    {
        "content": "<p>I think there are quite a lot of good points made. I'm not sure if my idea is good as I never did any such refactor.</p>\n<p>Here's my rationale, what I'm working on and why I think a separate definition is warranted.<br>\nDuring my search I needed to prove injectivity of the map that takes a multiset to a polynomial that has as roots this multiset. My first ideas were to find theorems in Polynomial.Roots as I knew that roots gives me a multiset. I could find that roots goes from Polynomials to Multisets but I couldn't find the canonical map that goes from Multiset to Polynomials.</p>\n<p>I did however find <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Polynomial/Roots.html#Polynomial.roots_multiset_prod_X_sub_C\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Polynomial/Roots.html#Polynomial.roots_multiset_prod_X_sub_C</a> which is exactly the thing that I needed (modulo it being in a more explicit form).</p>\n<p>Now I don't know how to do this refactor, or even if this refactor is good. I don't know the intricacies between simp normal forms. Now when I think about it it makes sense to put this definition in Polynomial.Basic so that it's well documented along other constructions.</p>\n<p>What would a local definition look like. In Polynomial.Roots there are 7 occurences. There are 3 more occurences in <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Polynomial/BigOperators.html\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Polynomial/BigOperators.html</a></p>\n<p>I assume there are more occurences in other files.</p>",
        "id": 558918618,
        "sender_full_name": "metakuntyyy",
        "timestamp": 1763927936
    },
    {
        "content": "<p>I think to see that this refactor is worthwile, we should replace all occurrences of the pattern <code>(s.map fun a : R =&gt; X - C a).prod</code> with <code>Polynomial.ofRootMultiset s</code> and see if it makes the theorems/proofs nicer or not. This will also get rid of the <code>simpNF</code> linter warning, because the <code>simp</code> lemmas will now use <code>Polynomial.ofRootMultiset</code> instead of <code>(s.map fun a : R =&gt; X - C a).prod</code>.</p>",
        "id": 560226442,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1764095842
    },
    {
        "content": "<p>I agree with Jovan here: in order to decide about <a href=\"https://github.com/leanprover-community/mathlib4/pull/32005\">#32005</a> we would need to see the proposed refactor in conjunction.</p>",
        "id": 560552685,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1764236522
    },
    {
        "content": "<p>One way I could see this tipping into useful territory is if the fact that this is a multiplicative morphism comes up enough. This could be expressed as:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">ofMultiset</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Multiplicative</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiset</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→*</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s.toAdd.map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">prod</span>\n<span class=\"w\">  </span><span class=\"n\">map_one'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"n\">map_mul'</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n</code></pre></div>\n<p>but probably it is better to avoid <code>Multiplicative</code>, keep <code>ofMultiset</code> as a raw function, and just have <code>simp</code> lemmas for the <code>map_one</code> and <code>map_mul</code> properties (stated as sending <code>0</code> to <code>1</code>, and <code>+</code> to <code>*</code>).</p>",
        "id": 560552921,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1764236590
    },
    {
        "content": "<p>Note that we have <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AddChar#doc\">docs#AddChar</a> although I never really know if we should be using it.</p>",
        "id": 560569068,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1764241228
    },
    {
        "content": "<p>It <em>is used</em> quite a bit by now:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>&gt; git grep AddChar | wc -l\n387\n</code></pre></div>\n<p>(and most of it is not from the file that defines <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AddChar#doc\">docs#AddChar</a> ...)</p>",
        "id": 560581579,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1764245333
    },
    {
        "content": "<p>Ok, I've completed the refactor ofMultiset <a href=\"https://github.com/leanprover-community/mathlib4/pull/32005\">#32005</a>. </p>\n<p>Does anyone know how to best resolve the linter issues here <a href=\"https://github.com/leanprover-community/mathlib4/actions/runs/19849515472/job/56873327397\">https://github.com/leanprover-community/mathlib4/actions/runs/19849515472/job/56873327397</a>?</p>",
        "id": 561335619,
        "sender_full_name": "metakuntyyy",
        "timestamp": 1764658198
    },
    {
        "content": "<p>I think the linter warning explains itself: <code>ofMultiset_apply</code> is a simp lemma, and it seems you don't want it to be a simp lemma. So don't use <code>@[simps]</code>.</p>",
        "id": 561368123,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1764669543
    },
    {
        "content": "<p>Or <code>@[simps -simp]</code> or whatever the syntax is</p>",
        "id": 561369493,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1764669892
    },
    {
        "content": "<p><code>@[simps -isSimp]</code></p>",
        "id": 561374636,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1764671306
    },
    {
        "content": "<p>Ah I see. I have taken the simps annotation from the suggestion from <span class=\"user-mention\" data-user-id=\"240862\">@Oliver Nash</span> . I have resolved the issue by reverting the two previous theorems so that they can keep the simp.</p>\n<p>I am surprised how smooth the refactor was. I guess everything is nice if you are refactoring modulo defeq.</p>",
        "id": 561478915,
        "sender_full_name": "metakuntyyy",
        "timestamp": 1764696686
    },
    {
        "content": "<p>Good work. Glancing briefly now, it looks like using the new definition everywhere mostly creates some extra indirection, and proofs mostly get a bit more awkward. IMHO the new definition is worth adding because it captures the <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AddChar#doc\">docs#AddChar</a> issue but at the moment using it everywhere doesn't look so attractive.</p>",
        "id": 561484398,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1764698289
    },
    {
        "content": "<p>I think I have to refactor this due to the simpnf linting issue. I think I can reduce some of those indirections.</p>",
        "id": 561487459,
        "sender_full_name": "metakuntyyy",
        "timestamp": 1764699085
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"240862\">Oliver Nash</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Adding.20Polynomial.2EfromRoots.3F/near/561484398\">said</a>:</p>\n<blockquote>\n<p>Good work. Glancing briefly now, it looks like using the new definition everywhere mostly creates some extra indirection, and proofs mostly get a bit more awkward. IMHO the new definition is worth adding because it captures the <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AddChar#doc\">docs#AddChar</a> issue but at the moment using it everywhere doesn't look so attractive.</p>\n</blockquote>\n<p>I force pushed so I can't reopen the old PR. However I opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/32496\">#32496</a> with just the definition and it being AddChar.</p>",
        "id": 562198405,
        "sender_full_name": "metakuntyyy",
        "timestamp": 1764978162
    }
]