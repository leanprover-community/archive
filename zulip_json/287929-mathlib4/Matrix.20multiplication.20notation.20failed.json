[
    {
        "content": "<p>I was trying to write something about matrices when I encounted the following error, where lean seems to have failed to parse the matrix multiplication notation under certain circumstances. </p>\n<p>It is an unexpected bug or did I use the wrong way to write it?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">RCLike</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">Â  </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">Â  </span><span class=\"c\">/-</span>\n<span class=\"cm\">Â  failed to synthesize</span>\n<span class=\"cm\">Â  CoeT (Matrix n n ğ•œ) x (Matrix m n ğ•œ)</span>\n<span class=\"cm\">(deterministic) timeout at `typeclass`, maximum number of heartbeats (20000) has been reached</span>\n<span class=\"cm\">Note: Use `set_option synthInstance.maxHeartbeats &lt;num&gt;` to set the limit.</span>\n<span class=\"cm\">Hint: Additional diagnostic information may be available using the `set_option diagnostics true` command.</span>\n<span class=\"cm\">Hint: Additional diagnostic information may be available using the `set_option diagnostics true` command.</span>\n<span class=\"cm\">Â  -/</span>\n<span class=\"w\">Â  </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">RCLike</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">Â  </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">instHMulOfFintypeOfMulOfAddCommMonoid</span><span class=\"bp\">.</span><span class=\"n\">hMul</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">Â  </span><span class=\"c\">/-</span>\n<span class=\"cm\">Â  Works well when I write the mul explicitly</span>\n<span class=\"cm\">Â  -/</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">RCLike</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span>\n<span class=\"cm\">  Also works if the matrix is square</span>\n<span class=\"cm\">  -/</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n<span class=\"w\">Â  </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 548270327,
        "sender_full_name": "nemo",
        "timestamp": 1761967010
    },
    {
        "content": "<p>This topic was moved here from <a class=\"stream-topic\" data-stream-id=\"270676\" href=\"/#narrow/channel/270676-lean4/topic/Matrix.20multiplication.20notation.20failed\">#lean4 &gt; Matrix multiplication notation failed</a> by <span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span>.</p>",
        "id": 548271658,
        "sender_full_name": "Notification Bot",
        "timestamp": 1761968635
    },
    {
        "content": "<p>This topic was moved here from <a class=\"stream-topic\" data-stream-id=\"113489\" href=\"/#narrow/channel/113489-new-members/topic/Matrix.20multiplication.20notation.20failed\">#new members &gt; Matrix multiplication notation failed</a> by <span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span>.</p>",
        "id": 548271843,
        "sender_full_name": "Notification Bot",
        "timestamp": 1761968847
    },
    {
        "content": "<p>Sorry for moving twice. First I thought that you've made a typo, then I realized that I've misread your message. I guess, when the parser sees that the type of the first multiplier is the same as the type of the product, it tries to elaborate the second multiplier as the same type.</p>",
        "id": 548271902,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1761968929
    },
    {
        "content": "<p>CC: <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span></p>",
        "id": 548271965,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1761969045
    },
    {
        "content": "<p>As a temporary workaround, you can use <code>HMul.hMul A B</code>. I know that it looks bad.</p>",
        "id": 548272357,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1761969508
    },
    {
        "content": "<p>This looks like we have some terrible coercion instances, specifically:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">IsometryClass</span><span class=\"bp\">.</span><span class=\"n\">instCoeOutIsometryEquiv</span>\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">ContinuousMonoidHom</span><span class=\"bp\">.</span><span class=\"n\">instCoeOutOfMonoidHomClassOfContinuousMapClass</span>\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">ContinuousAddMonoidHom</span><span class=\"bp\">.</span><span class=\"n\">instCoeOutOfAddMonoidHomClassOfContinuousMapClass</span>\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">HomeomorphClass</span><span class=\"bp\">.</span><span class=\"n\">instCoeOutHomeomorph</span>\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">StarRingEquivClass</span><span class=\"bp\">.</span><span class=\"n\">instCoeHead</span>\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">CoalgEquivClass</span><span class=\"bp\">.</span><span class=\"n\">instCoeToCoalgEquiv</span>\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">PositiveLinearMapClass</span><span class=\"bp\">.</span><span class=\"n\">instCoeToLinearMap</span>\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">SemilinearEquivClass</span><span class=\"bp\">.</span><span class=\"n\">instCoeToSemilinearEquiv</span>\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">SemilinearMapClass</span><span class=\"bp\">.</span><span class=\"n\">instCoeToSemilinearMap</span>\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">BialgHomClass</span><span class=\"bp\">.</span><span class=\"n\">instCoeToBialgHom</span>\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">LinearMapClass</span><span class=\"bp\">.</span><span class=\"n\">instCoeToLinearMap</span>\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">NonUnitalStarRingHomClass</span><span class=\"bp\">.</span><span class=\"n\">instCoeHeadNonUnitalStarRingHom</span>\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">StarAlgEquivClass</span><span class=\"bp\">.</span><span class=\"n\">instCoeHead</span>\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">CompletelyPositiveMapClass</span><span class=\"bp\">.</span><span class=\"n\">instCoeToCompletelyPositiveMap</span>\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">CoalgHomClass</span><span class=\"bp\">.</span><span class=\"n\">instCoeToCoalgHom</span>\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">SignType</span><span class=\"bp\">.</span><span class=\"n\">instCoeTail</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">RCLike</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>works</p>",
        "id": 548294518,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1761992000
    },
    {
        "content": "<p>wow, thanks for taking the time to diagnose all that!</p>",
        "id": 548294590,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761992055
    },
    {
        "content": "<p>Wait, actually</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">SignType</span><span class=\"bp\">.</span><span class=\"n\">instCoeTail</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">RCLike</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>is enough?</p>",
        "id": 548294611,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1761992073
    },
    {
        "content": "<p>Still I don't like all of these other ones firing for <em>all coercions</em></p>",
        "id": 548294637,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1761992095
    },
    {
        "content": "<p>Alright I'm officially confused;</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">RCLike</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">CoeTail</span><span class=\"w\"> </span><span class=\"n\">SignType</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>is the problem but it takes less steps to resolve <code>Zero (Matrix m n ğ•œ)</code>,  <code>One (Matrix m n ğ•œ)</code> and <code>Neg (Matrix m n ğ•œ)</code> combined?</p>",
        "id": 548295552,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1761992937
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Matrix.20multiplication.20notation.20failed/near/548271902\">said</a>:</p>\n<blockquote>\n<p>I guess, when the parser sees that the type of the first multiplier is the same as the type of the product, it tries to elaborate the second multiplier as the same type.</p>\n</blockquote>\n<p>I don't think the typeclass takes into account the type of the product at all, since it's an <code>outParam</code>.</p>",
        "id": 548316096,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762010523
    },
    {
        "content": "<p>Should we use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CoeHTCT#doc\">docs#CoeHTCT</a> ? I know that it's discouraged in the docstring.</p>",
        "id": 548322228,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1762016161
    },
    {
        "content": "<p>Or should the coercion from <code>SignType</code> be a <code>CoeHead</code>?</p>",
        "id": 548322344,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1762016259
    },
    {
        "content": "<p>Why is <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=SignType.cast#doc\">docs#SignType.cast</a> even a coercion</p>",
        "id": 548322522,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762016424
    },
    {
        "content": "<p>is it even used that much</p>",
        "id": 548322532,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762016436
    },
    {
        "content": "<p>not like <code>Nat.cast</code> which is everywhere</p>",
        "id": 548322543,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762016452
    },
    {
        "content": "<p>I think it's convenient to have it as a coercion, but <code>CoeHead</code> may be better so that it applies only for coercions from <code>SignType</code>.</p>",
        "id": 548327898,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1762020548
    },
    {
        "content": "<p>The right thing to do is <code>CoeDep</code> I believe</p>",
        "id": 548333069,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1762025661
    },
    {
        "content": "<p>I don't think you can do <code>CoeHead</code> because there's no way to know what to coerce to with that</p>",
        "id": 548333121,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1762025705
    },
    {
        "content": "<p>Alright, I opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/31168\">#31168</a></p>",
        "id": 548335805,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1762028381
    },
    {
        "content": "<p>It would be great to note in the docstring for CoeDep that it is useful in nondependent cases</p>",
        "id": 548337920,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1762030623
    },
    {
        "content": "<p>BTW, why do we have a separate <code>CoeDep</code>, not just extra instances of <code>CoeT</code>?</p>",
        "id": 553209598,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1762054540
    },
    {
        "content": "<p>they seems to serve different function</p>",
        "id": 553209785,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762054845
    },
    {
        "content": "<p><code>CoeDep</code> is for dependent coercions specifically and <code>CoeT</code> is for all the coercions</p>",
        "id": 553209870,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762054971
    },
    {
        "content": "<p>that's my guess</p>",
        "id": 553209872,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762054974
    },
    {
        "content": "<p>They have the same signature. <code>CoeT</code> has instances coming from non-dependent coercions + an instance from <code>CoeDep</code>. I don't understand why not just use specific <code>CoeT</code> instances instead of having an extra class.</p>",
        "id": 553211032,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1762056699
    },
    {
        "content": "<p>Alright I see there is a bit of a problem; we have a coercion diamond between <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=SemilinearMapClass.instCoeToSemilinearMap#doc\">docs#SemilinearMapClass.instCoeToSemilinearMap</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearEquiv.instCoeLinearMap#doc\">docs#LinearEquiv.instCoeLinearMap</a></p>",
        "id": 553226323,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1762071011
    },
    {
        "content": "<p>I see that there is also a theorem about this: <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearEquiv.toLinearMap_eq_coe#doc\">docs#LinearEquiv.toLinearMap_eq_coe</a>. Which of these is supposed to be the normal form then?</p>",
        "id": 553226510,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1762071211
    },
    {
        "content": "<p>AFAIR, <span class=\"user-mention\" data-user-id=\"387244\">@YaÃ«l Dillies</span> mentioned that <code>*Class.instCoe*</code> instances are going to be removed, not sure about the details.</p>",
        "id": 553246801,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1762091735
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Matrix.20multiplication.20notation.20failed/near/553209598\">said</a>:</p>\n<blockquote>\n<p>BTW, why do we have a separate <code>CoeDep</code>, not just extra instances of <code>CoeT</code>?</p>\n</blockquote>\n<p><code>CoeT</code> is an implementation detail that users should not implement directly. It's unlikely that this will get a large redesign in the nearby future, but I can certainly imagine that <code>CoeT</code> will be replaced someday.</p>\n<p>(Similarly, we should really have dealt already with all the <code>CoeTC</code> instances still defined in Mathlib...)</p>",
        "id": 553565449,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1762249142
    }
]