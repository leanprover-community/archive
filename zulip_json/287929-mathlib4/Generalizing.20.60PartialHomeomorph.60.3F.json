[
    {
        "content": "<p>While working with CW complexes I encounter a lot of <code>PartialEquiv</code>s that are continuous on their source and target which in my cases are not open: examples are the characteristic maps of a CW complex or cellular maps (where both source and target are closed). That means that my statements can get quite long. Additionally, I would like some lemmas in mathlib for this specific type of <code>PartialEquiv</code> which currently is awkward because there is no good place for them (see <a href=\"https://github.com/leanprover-community/mathlib4/pull/23048\">#23048</a>). My question is: Should one maybe generalize <code>PartialHomeomorph</code>? I think there could be one general version that has no limitations on the openness or closedness of the source and target. Then the current <code>PartialHomeomorph</code> could become something like <code>OpenPartialHomeomorph</code> and then the closed version could be <code>ClosedPartialHomeomorph</code>. I assume that the general version would probably find use in a lot of places. What do you think?</p>",
        "id": 516462038,
        "sender_full_name": "Hannah Scholz",
        "timestamp": 1746542191
    },
    {
        "content": "<p>I think this would be good to do. We already have a few \"continuous partial equivalences\" in Mathlib, e.g. <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ModelWithCorners#doc\">docs#ModelWithCorners</a>. So having a definition that generalizes them and provides common lemmas sounds valuable.</p>",
        "id": 517063107,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1746781302
    },
    {
        "content": "<p>Feel free to ask me for review on the PR doing this.</p>",
        "id": 517069302,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1746783237
    },
    {
        "content": "<p>Hannah and I would like to go forward with Hannah's proposal above: </p>\n<ul>\n<li>rename the current <code>PartialHomeomorph</code> to <code>OpenPartialHomeomorph</code></li>\n<li>add a new version of <code>PartialHomeomorph</code> that doesn't assume openness of source/target</li>\n<li>add <code>ClosedPartialHomeomorph</code> with closed source/target</li>\n</ul>\n<p>I think that it will be useful for both CW-complexes and manifolds (e.g. <code>ModelWithCorners</code>), but probably also in various other places.</p>\n<p>I'm asking again, because this got little response until now. Does this sound like a good change?<br>\n<span class=\"user-mention\" data-user-id=\"110031\">@Patrick Massot</span> <span class=\"user-mention\" data-user-id=\"110050\">@Sébastien Gouëzel</span> <span class=\"user-mention\" data-user-id=\"260507\">@Heather Macbeth</span> <span class=\"user-mention\" data-user-id=\"240862\">@Oliver Nash</span></p>",
        "id": 536579114,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1756378281
    },
    {
        "content": "<p>It sounds like a good plan. For the sake of considering a variant, do you think the following might be useful:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">structure</span><span class=\"w\"> </span><span class=\"n\">PartialHomeomorph</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Q</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kd\">extends</span><span class=\"w\"> </span><span class=\"n\">PartialEquiv</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">pred_source</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">source</span>\n<span class=\"w\">  </span><span class=\"n\">pred_target</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"w\"> </span><span class=\"n\">target</span>\n<span class=\"w\">  </span><span class=\"n\">continuousOn_toFun</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ContinuousOn</span><span class=\"w\"> </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"n\">source</span>\n<span class=\"w\">  </span><span class=\"n\">continuousOn_invFun</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ContinuousOn</span><span class=\"w\"> </span><span class=\"n\">invFun</span><span class=\"w\"> </span><span class=\"n\">target</span>\n</code></pre></div>",
        "id": 536579968,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1756378620
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span>, if you have the need for it, then go for it, sure! We could then upgrade <code>extChartAt</code> to be a <code>PartialHomeomorph</code> in your sense, for instance.</p>",
        "id": 536582725,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1756379744
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"240862\">Oliver Nash</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Generalizing.20.60PartialHomeomorph.60.3F/near/536579968\">said</a>:</p>\n<blockquote>\n<p>It sounds like a good plan. For the sake of considering a variant, do you think the following might be useful:</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">structure</span><span class=\"w\"> </span><span class=\"n\">PartialHomeomorph</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Q</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kd\">extends</span><span class=\"w\"> </span><span class=\"n\">PartialEquiv</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">pred_source</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">source</span>\n<span class=\"w\">  </span><span class=\"n\">pred_target</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"w\"> </span><span class=\"n\">target</span>\n<span class=\"w\">  </span><span class=\"n\">continuousOn_toFun</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ContinuousOn</span><span class=\"w\"> </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"n\">source</span>\n<span class=\"w\">  </span><span class=\"n\">continuousOn_invFun</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ContinuousOn</span><span class=\"w\"> </span><span class=\"n\">invFun</span><span class=\"w\"> </span><span class=\"n\">target</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>This is an interesting thought, since that would be a common generalization of all three notions.<br>\nHowever, I'm not sure if that this will be more convenient this than with just the plain <code>PartialHomeomorph</code> that I'm suggesting. I expect that if you want to define e.g. <code>PartialHomeomorph .trans</code> you already need conditions on <code>P</code> and <code>Q</code> such as they're closed under taking intersections. <br>\nI <em>think</em> that just the plain <code>PartialHomeomorph</code> will be more convenient.</p>",
        "id": 536596104,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1756384524
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/29113\">#29113</a> does the first step: renaming <code>PartialHomeomorph</code> to <code>OpenPartialHomeomorph</code></p>",
        "id": 536896053,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1756537561
    },
    {
        "content": "<p>Waking up, I wondered about the deprecation strategy for this change. Its namespace changes don't need deprecations, but other changes will. In general, I would ask for the following:</p>\n<ul>\n<li>a deprecated alias <code>PartialHomomeomorph</code> pointing to <code>OpenPartialHomeomorph</code> (perhaps with a custom message, indicating the impending generalisation!)</li>\n<li>a deprecation for each lemma which is not simply changing namespaces</li>\n<li>waiting until a stable release has happened before re-purposing the <code>PartialHomeomorph</code> name</li>\n</ul>",
        "id": 536896198,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1756537699
    },
    {
        "content": "<p>In this case, you will be generalising some lemmas from OpenPartialHomeomorph to PartialHomommorph, right? Does it make sense to include deprecations there/can these be counter-productive? (Perhaps this is fine, and any lemma that's not maximally general will land as-is. You can always generalise later, after all.)</p>",
        "id": 536896273,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1756537797
    }
]