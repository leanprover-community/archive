[
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"598052\">Jeremy Tan</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Technical.20Debt.20Counters/near/470809566\">said</a>:</p>\n<blockquote>\n<p>I would have expected <a href=\"https://github.com/leanprover-community/mathlib4/pull/16836\">#16836</a> to have been merged by now</p>\n</blockquote>\n<p>Cross-posting a message that I just posted on the PR page:</p>\n<blockquote>\n<p>There's a lot of discussion that happened about these files. I think it is very good that we do <em>something</em>:</p>\n<ul>\n<li>remove them, or</li>\n<li>undeprecate them.</li>\n</ul>\n<p>Historically, the <code>structure</code>s in these files were <code>class</code>es. And there was consensus that this was not a good design, and hence they were deprecated. Back in the mathlib3 era, Kevin refactored mathlib to make the deprecated classes into structures: <a href=\"https://github.com/leanprover-community/mathlib3/commit/f961b28041ad901e12ff55653c93a640000da4d5#diff-9dfe378e58a7961147b1d523be114d4c149665a6b9cee973d330bfc5057cc710\">https://github.com/leanprover-community/mathlib3/commit/f961b28041ad901e12ff55653c93a640000da4d5#diff-9dfe378e58a7961147b1d523be114d4c149665a6b9cee973d330bfc5057cc710</a>. It is worth taking a moment to look at Kevin's commit message. In particular, he reaches the conclusion that there isn't much harm in deleting these files.</p>\n<p>However, we should also consider some past zulip discussions (there might be more):</p>\n<ul>\n<li><a href=\"#narrow/stream/116395-maths/topic/Submonoids.20containing.20the.20base.2Fcentral.20ring/near/218724723\">https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Submonoids.20containing.20the.20base.2Fcentral.20ring/near/218724723</a></li>\n<li><a href=\"#narrow/stream/113488-general/topic/deprecated.20is_sub*/near/210452380\">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/deprecated.20is_sub*/near/210452380</a></li>\n<li><a href=\"#narrow/stream/113488-general/topic/deprecated.20is_sub*/near/210400716\">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/deprecated.20is_sub*/near/210400716</a></li>\n</ul>\n<p>I personally lean towards: undeprecate, move to some appropriate place in the mathlib directory structure, but do not give these a central role in the algebraic APIs.</p>\n<p>I think we should have 1 more final zulip discussion about this.</p>\n</blockquote>",
        "id": 470883371,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1726555102
    },
    {
        "content": "<p>If we're talking about uses of <code>IsGroup</code> and friends, I've got one myself. In the proof that nimbers are algebraically closed, you have to reason about certain intervals <code>Iio x</code> of nimbers being closed under addition / multiplication / inverses, and what that entails for <code>x</code>.</p>",
        "id": 470883940,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1726555319
    },
    {
        "content": "<p>That being said, the current proof draft just makes these into predicates for <code>Nimber</code>, and it seems to be cleaner. We can even exclude some hypotheses that aren't really needed for the proof, such as <code>0</code> being in a group and <code>1</code> being in a field.</p>",
        "id": 470885399,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1726555630
    },
    {
        "content": "<p>My two cents here is that <em>even if we want these predicates, we should rewrite the API from scratch</em>. The purpose of the files as they currently are is purely archival. So many things have changed since they were written and they have changed so little that I think we should just trash them. To give you an idea, this kind of file would take me one or two hours to write at most, so I don't think we are saving any time by keeping them around.</p>",
        "id": 470909421,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1726562076
    },
    {
        "content": "<p>I think we are saving one or two hours of Yael-time <em>per file</em>. So we're talking about a full Yael-day. We don't have those in abundant supply...</p>",
        "id": 470910642,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1726562475
    },
    {
        "content": "<p>Unless you think the current API is really terrible. But from glossing over the files, I think they're not that bad.</p>",
        "id": 470910723,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1726562507
    },
    {
        "content": "<p>And even if yael commits himself to be available 24/7 for writing stuff like this upon request, mathlib should build on something more sustainable.</p>",
        "id": 470939139,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1726568803
    },
    {
        "content": "<p>I'm inclined to scrap these. They date from before the port, and ever since then have been unused in Mathlib, and sitting in a folder named <code>Deprecated</code>.</p>",
        "id": 470957920,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726574186
    },
    {
        "content": "<p>Are there actual users?</p>",
        "id": 470957940,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726574195
    },
    {
        "content": "<p>Not that I know of</p>",
        "id": 470958331,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1726574313
    },
    {
        "content": "<p>Nope, but that's a bit self-reinforcing.</p>",
        "id": 470958352,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1726574319
    },
    {
        "content": "<p>It's in a folder named <code>Deprecated</code>. So nobody will use it.</p>",
        "id": 470958392,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1726574332
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/stream/287929-mathlib4/topic/deprecated.20sub.7Bmonoid.2Cgroup.7D.20predicates/near/470909421\">said</a>:</p>\n<blockquote>\n<p>My two cents here is that <em>even if we want these predicates, we should rewrite the API from scratch</em>. The purpose of the files as they currently are is purely archival. So many things have changed since they were written and they have changed so little that I think we should just trash them. To give you an idea, this kind of file would take me one or two hours to write at most, so I don't think we are saving any time by keeping them around.</p>\n</blockquote>\n<p>You could substitute me in this paragraph if you doubled the times mentioned</p>",
        "id": 471123444,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1726616534
    },
    {
        "content": "<p>Is anyone proposing that we keep this material <em>in the Deprecated folder</em>?</p>",
        "id": 471126724,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726618060
    },
    {
        "content": "<p>Does anyone with a use case want to rewrite them and move them out of Deprecated?</p>",
        "id": 471126830,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726618095
    },
    {
        "content": "<p>I think unless there is a specific yes on one of those questions from someone who wants to take ownership, then we should delete.</p>",
        "id": 471126877,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726618120
    },
    {
        "content": "<p>Just leaving material in <code>Deprecated</code> for years is not a plan.</p>",
        "id": 471126901,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726618140
    },
    {
        "content": "<p>Is it also an option to move them out of <code>Deprecated</code> as is, without rewriting? Because I would happily answer that question with \"yes\"</p>",
        "id": 471291217,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1726673930
    },
    {
        "content": "<p>I guess it is. I'm skeptical about (re)introducing multiple ways to talk about the same thing (usual reason, API cost) without stronger evidence that it is really useful.</p>\n<p>What if we did something like move it out of Deprecated, but with a module doc that says \"Please use this if it is really actually useful to you (maybe some hints about how to determine that). If we find that it is still unused in 6 months, however, we'll deprecate.\"</p>",
        "id": 471369794,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726704455
    },
    {
        "content": "<p>If some PR really needed this it would have moved the material out of <code>Deprecated</code> itself, but no PR has done so. Thus I believe we have no need to wait any longer to straight-up delete the files</p>",
        "id": 471426304,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1726732500
    },
    {
        "content": "<p>The examples which Johan posted -- it seemed to be that there were easy workarounds given what we have. For example Reid's subsets <code>X n</code> of a group, indexed by the naturals, and his proof by induction that they were all subgroups, could be replaced by defining subgroups <code>G n</code> recursively where <code>G n = X n</code> was <code>rfl</code>.</p>",
        "id": 471427918,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1726732918
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/287929-mathlib4/topic/deprecated.20sub.7Bmonoid.2Cgroup.7D.20predicates/near/471369794\">said</a>:</p>\n<blockquote>\n<p>I guess it is. I'm skeptical about (re)introducing multiple ways to talk about the same thing (usual reason, API cost) without stronger evidence that it is really useful.</p>\n</blockquote>\n<p>I think there's a way of doing this with no API cost. If we change to</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Submonoid</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">   </span><span class=\"n\">carrier</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">M</span>\n<span class=\"w\">   </span><span class=\"n\">isSubmonoid</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsSubmonoid</span><span class=\"w\"> </span><span class=\"n\">M</span>\n</code></pre></div>\n<p>then</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">IsSubmonoid</span><span class=\"bp\">.</span><span class=\"n\">inter</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Inf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Submonoid</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n</code></pre></div>\n<p>isn't really duplication, since the first theorem would be used to prove the second.</p>",
        "id": 471466192,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1726745980
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"112680\">@Johan Commelin</span>, thoughts here? I remain at \"no one is using these, no one is writing a PR to revamp these and start using them, they've been deprecated for a long time ===&gt; delete\".</p>",
        "id": 478826752,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1729820780
    },
    {
        "content": "<p>Yeah, fine. Let's just delete.</p>",
        "id": 478841066,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1729831819
    },
    {
        "content": "<p>Done.</p>",
        "id": 496241599,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1738027839
    },
    {
        "content": "<p>Two tests are failing.</p>",
        "id": 496304622,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1738060887
    },
    {
        "content": "<p>Which PR are we talking about? Several searches have come up with nothing.</p>",
        "id": 496311559,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738063143
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/16836\">#16836</a></p>",
        "id": 496311920,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1738063270
    },
    {
        "content": "<p>Oh! I was expecting a recent one; i had not understood that this was a discussion about an old PR. OK well I guess we just broke some people's projects! But I'm definitely in favour of removing these files. As I said in my PR message when I deprecated them, I was expecting to run into what seemed to be genuine use cases but I never did, really.</p>",
        "id": 496312281,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738063400
    },
    {
        "content": "<p>It does not exactly apply to this PR, but there was a <a href=\"#narrow/channel/287929-mathlib4/topic/.60Deprecated.60.20folder\">recent discussion</a> about how to deprecate an entire file in favour of other files.</p>",
        "id": 496314317,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738064124
    },
    {
        "content": "<p>It was more in the context of splitting/renaming files, but if the <code>deprecatedModule</code> machinery were available, it could probably also be repurposed to mitigate the effect of these removals</p>",
        "id": 496314321,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738064125
    }
]