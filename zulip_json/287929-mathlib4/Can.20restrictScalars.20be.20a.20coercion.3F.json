[
    {
        "content": "<p>In a recent PR we implemented coercion from a submodule to a pointed cone, which is just restriction to the non-negative scalars. Is there a reason to not have the general <code>restrictScalars</code> as a coercion like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Submodule</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CoeDep</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Submodule</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Submodule</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">restrictScalars</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">⟩</span>\n</code></pre></div>\n<p>I know from my own code that a lot of statements would become much shorter.<br>\nWe could then also put <code>@[coe]</code> on <code>restrictScalars</code> for readability.</p>",
        "id": 566763501,
        "sender_full_name": "Martin Winter",
        "timestamp": 1767800738
    },
    {
        "content": "<p>Why do you need <code>CoeDep</code> here?</p>",
        "id": 566779892,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1767805149
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"950805\">Martin Winter</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Can.20restrictScalars.20be.20a.20coercion.3F/near/566763501\">said</a>:</p>\n<blockquote>\n<p>We could then also put <code>@[coe]</code> on <code>restrictScalars</code> for readability.</p>\n</blockquote>\n<p>This is a bad idea, since the goal view then shows <code>p.restrictScalars S</code> as <code>↑S p</code></p>",
        "id": 566780042,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1767805193
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Can.20restrictScalars.20be.20a.20coercion.3F/near/566779892\">said</a>:</p>\n<blockquote>\n<p>Why do you need <code>CoeDep</code> here?</p>\n</blockquote>\n<p>The honest answer is: because I could not make it work with any other Coe variant. It always complains that it cannot find a synthesization order.</p>",
        "id": 566780334,
        "sender_full_name": "Martin Winter",
        "timestamp": 1767805275
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Can.20restrictScalars.20be.20a.20coercion.3F/near/566780042\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"950805\">Martin Winter</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Can.20restrictScalars.20be.20a.20coercion.3F/near/566763501\">said</a>:</p>\n<blockquote>\n<p>We could then also put <code>@[coe]</code> on <code>restrictScalars</code> for readability.</p>\n</blockquote>\n<p>This is a bad idea, since the goal view then shows <code>p.restrictScalars S</code> as <code>↑S p</code></p>\n</blockquote>\n<p>This is already the case for <code>LinearMap.restrictScalars</code> and I always found this to be more readable than the alternative.</p>",
        "id": 566780882,
        "sender_full_name": "Martin Winter",
        "timestamp": 1767805426
    },
    {
        "content": "<p>Yes I noticed this \"weirdness\" with <code>LinearMap.restrictScalars</code> recently and after having considered reporting it as an issue I decided it might actually be more helpful to just to leave it as it is and get used to it :-) It's weird but helpful notation :-)</p>",
        "id": 566818462,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1767817972
    }
]