[
    {
        "content": "<p>Hi everyone,</p>\n<p>I was trying to create some deprecated alias after renaming. The CI complains</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c\">/-</span><span class=\"cm\"> The `defLemma` linter reports:</span>\n<span class=\"cm\">INCORRECT DEF/LEMMA: -/</span>\n<span class=\"c1\">-- Mathlib.Algebra.Group.Units.Hom</span>\n<span class=\"n\">Error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">././././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Algebra</span><span class=\"bp\">/</span><span class=\"n\">Group</span><span class=\"bp\">/</span><span class=\"n\">Units</span><span class=\"bp\">/</span><span class=\"n\">Hom</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">252</span><span class=\"o\">:</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">MonoidHom</span><span class=\"bp\">.</span><span class=\"n\">isLocalRingHom_comp</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">should</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"kn\">lemma</span><span class=\"bp\">/</span><span class=\"kn\">theorem</span>\n</code></pre></div>\n<p>The code is like this, where <code>IsLocalHom</code> takes values in <code>Prop</code></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">MonoidHom</span><span class=\"bp\">.</span><span class=\"n\">isLocalHom_comp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">→*</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">→*</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsLocalHom</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">IsLocalHom</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsLocalHom</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">map_nonunit</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">IsLocalHom</span><span class=\"bp\">.</span><span class=\"n\">map_nonunit</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">IsLocalHom</span><span class=\"bp\">.</span><span class=\"n\">map_nonunit</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">deprecated</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">since</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"2024-10-10\"</span><span class=\"o\">)</span><span class=\"kd\">]</span>\n<span class=\"kn\">alias</span><span class=\"w\"> </span><span class=\"n\">MonoidHom</span><span class=\"bp\">.</span><span class=\"n\">isLocalRingHom_comp</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">MonoidHom</span><span class=\"bp\">.</span><span class=\"n\">isLocalHom_comp</span>\n</code></pre></div>\n<p>Is this a bug? When creating an alias for <code>Prop</code> valued instances, it will be treated as def and further trigger the <code>defLemma</code> linter.</p>",
        "id": 476166848,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1728575679
    },
    {
        "content": "<p>Yes, that's a bug. But it's not the fault of <code>alias</code>. Instead, <code>instance</code> creates <code>def</code>s regardless of whether the typeclass is Prop- or Type-valued</p>",
        "id": 476168089,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1728576057
    },
    {
        "content": "<p>Yes, but without alias, the <code>defLemma</code> linter does not complain. So maybe the true solution is that we should fix instances? (not alias nor linter)</p>",
        "id": 476168915,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1728576252
    },
    {
        "content": "<p>I think for my PR I'll just drop these deprecated alias for instances.</p>",
        "id": 476169137,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1728576305
    },
    {
        "content": "<p>Silencing the linter seems to be the kick-the-can solution currently</p>",
        "id": 476169459,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1728576383
    },
    {
        "content": "<p>And shall I write an issue in the GitHub page of Mathlib for this?</p>",
        "id": 476169619,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1728576423
    },
    {
        "content": "<p>There is already an issue on the lean4 repo</p>",
        "id": 476169711,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1728576444
    },
    {
        "content": "<p>Actually, I don't find it <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 476170437,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1728576633
    },
    {
        "content": "<p>How to see whether a declaration (instance) is a <code>def</code> or a <code>theorem</code>?</p>",
        "id": 476174317,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1728577571
    },
    {
        "content": "<p>I was trying to write a new issue but don't know the way to exhibit this <code>def</code>-or-<code>theorem</code> difference.</p>",
        "id": 476174456,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1728577622
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Command</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n\n<span class=\"sd\">/-- info: it's a definition -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"n\">run_meta</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">defnInfo</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getConstInfo</span><span class=\"w\"> </span><span class=\"ss\">`a</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"s2\">\"it's a definition\"</span>\n</code></pre></div>",
        "id": 476176418,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1728578266
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Alias.20of.20Prop.20type.20instances/near/476170437\">said</a>:</p>\n<blockquote>\n<p>Actually, I don't find it <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>\n</blockquote>\n<p>It would be nice if someone reported this!</p>",
        "id": 476178421,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1728578897
    },
    {
        "content": "<p>I opened <a href=\"https://github.com/leanprover/lean4/pull/5672\">lean#5672</a> to report this.</p>",
        "id": 476184086,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1728580955
    },
    {
        "content": "<p>Does writing <code>@[instance] theorem</code> fix the problem for now?</p>",
        "id": 476184362,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1728581071
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Alias.20of.20Prop.20type.20instances/near/476184362\">said</a>:</p>\n<blockquote>\n<p>Does writing <code>@[instance] theorem</code> fix the problem for now?</p>\n</blockquote>\n<p>Yes, that would fix the problem.</p>",
        "id": 476184492,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1728581128
    },
    {
        "content": "<p>Thank you! I've adopted this solution in my PR.</p>",
        "id": 476188025,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1728582457
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"611077\">Jiang Jiedong</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Alias.20of.20Prop.20type.20instances/near/476174317\">said</a>:</p>\n<blockquote>\n<p>How to see whether a declaration (instance) is a <code>def</code> or a <code>theorem</code>?</p>\n</blockquote>\n<p>give it a name and use <code>#print</code></p>",
        "id": 476446367,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1728674702
    },
    {
        "content": "<p>Or hover over the word <code>instance</code> to find the generated name</p>",
        "id": 476447318,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1728675169
    },
    {
        "content": "<p>The issue has been resolved by <a href=\"https://github.com/leanprover/lean4/pull/5856\">lean#5856</a></p>",
        "id": 488675354,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1734021661
    }
]