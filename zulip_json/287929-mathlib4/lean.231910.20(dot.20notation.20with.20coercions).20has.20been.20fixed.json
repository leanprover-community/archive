[
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/1910\">lean#1910</a> has been fixed. Would anyone be interested in going through the 26 appearances of the URL <a href=\"https://github.com/leanprover/lean4/issues/1910\">https://github.com/leanprover/lean4/issues/1910</a> in Mathlib and taking advantage of dot notation again, and removing the porting notes?</p>",
        "id": 483811514,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732233733
    },
    {
        "content": "<p>i'll take a look</p>",
        "id": 483875501,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732269619
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/287929-mathlib4/topic/lean.231910.20.28dot.20notation.20with.20coercions.29.20has.20been.20fixed/near/483811514\">said</a>:</p>\n<blockquote>\n<p>and taking advantage of dot notation again</p>\n</blockquote>\n<p>there are hundreds of occurences of <code>Additive.toAdd</code> (and mul version) to be changed.... and that's just one porting note...</p>",
        "id": 483911287,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732282094
    },
    {
        "content": "<p>seems like a right place to split PRs...<br>\nPR at <a href=\"https://github.com/leanprover-community/mathlib4/pull/19369\">#19369</a> for the <code>Additive</code> and <code>Multiplicative</code> changes, please take a look to decide if this is appropriately sized or if the PR should be split up more...</p>",
        "id": 483911460,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732282163
    },
    {
        "content": "<p>btw, it looks like there is some defeq abuse at around <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Order/SuccPred/TypeTags.html#Order.succ_toMul\">Order.succ_toMul</a>?</p>",
        "id": 483913174,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732282691
    },
    {
        "content": "<p>One that I often encounter is <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Subalgebra.toSubmodule#doc\">docs#Subalgebra.toSubmodule</a></p>",
        "id": 483933063,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1732288925
    },
    {
        "content": "<p>Is there a PR making dot notation work for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearMap.range#doc\">docs#LinearMap.range</a> etc.? Currently the middle example in <a href=\"https://github.com/leanprover-community/mathlib4/pull/11036\">#11036</a> to <a href=\"https://github.com/leanprover/lean4/pull/1910\">lean#1910</a>, but it seems to be a different problem since no coercion is going on ...</p>",
        "id": 483944094,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1732292138
    },
    {
        "content": "<p>part of the issue there is also that the definition is more general than just linear maps...</p>",
        "id": 483965931,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732299350
    },
    {
        "content": "<p>There's a proposal to make dot notation first look for an argument named <code>self</code> rather than an argument whose type matches. That would work here for <code>LinearMap</code> itself, right?</p>",
        "id": 483967539,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1732299997
    },
    {
        "content": "<p>if you want <code>g.ker</code> to work, lean would need to recognise that the <code>f:F</code> argument to <code>LinearMap.Ker</code> is the intended place for <code>g</code> to fit, somehow... i think naming the argument <code>self</code> would work in that case, yes.</p>",
        "id": 483967638,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732300043
    },
    {
        "content": "<p>could you link the proposal?</p>",
        "id": 483967649,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732300050
    },
    {
        "content": "<p>you might still need to use the <code>LinearMap.ker g</code> notation when <code>g</code> is an <code>AlgHom</code>, so it still wouldn't be 'optimal'</p>",
        "id": 483967877,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732300136
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/1629\">lean4#1629</a> has the <code>self</code> proposal, and <a href=\"https://github.com/leanprover/lean4/pull/5482\">lean4#5482</a> has a proposal for adding to the list of namespaces that dot notation searches through. That second one also has a link to another proposal.</p>",
        "id": 483968221,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1732300260
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/channel/287929-mathlib4/topic/lean.231910.20.28dot.20notation.20with.20coercions.29.20has.20been.20fixed/near/483913174\">said</a>:</p>\n<blockquote>\n<p>btw, it looks like there is some defeq abuse at around <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Order/SuccPred/TypeTags.html#Order.succ_toMul\">Order.succ_toMul</a>?</p>\n</blockquote>\n<p>PR fixing this at <a href=\"https://github.com/leanprover-community/mathlib4/pull/19379\">#19379</a></p>",
        "id": 483972397,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732301916
    },
    {
        "content": "<p>2nd PR removing porting notes at <a href=\"https://github.com/leanprover-community/mathlib4/pull/19380\">#19380</a></p>",
        "id": 483984324,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732306497
    },
    {
        "content": "<p>there are a bunch of porting notes in relation to this issue which claim that <code>@[pp_nodot]</code> has no effect on a declaration since it can't be used with dot notation anyway. However, the following example suggests that this still has no effect, as the pretty printer doesn't print these with dot notation anway... the following example shows this using <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=SymAlg.unsym#doc\">docs#SymAlg.unsym</a> as an example</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Symmetrized</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">:</span><span class=\"n\">α</span><span class=\"bp\">ˢʸᵐ</span><span class=\"o\">)</span>\n\n<span class=\"bp\">#</span><span class=\"n\">help</span><span class=\"w\"> </span><span class=\"n\">attr</span><span class=\"w\"> </span><span class=\"n\">pp_nodot</span><span class=\"w\"> </span><span class=\"c1\">-- [pp_nodot]: mark declaration to never be pretty printed using field notation</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">SymAlg</span><span class=\"bp\">.</span><span class=\"n\">unsym</span><span class=\"w\"> </span><span class=\"c1\">-- this declaration has the @[pp_nodot] attribute in mathlib</span>\n\n<span class=\"c1\">-- as expected, no dot notation used here...</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">unsym</span><span class=\"w\"> </span><span class=\"c1\">-- SymAlg.unsym a : α</span>\n\n<span class=\"c1\">-- let's define it again, without the attribute</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">SymAlg</span><span class=\"bp\">.</span><span class=\"n\">unsym'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">SymAlg</span><span class=\"bp\">.</span><span class=\"n\">sym</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n\n<span class=\"c1\">-- doesn't use dot notation anyway</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">unsym'</span><span class=\"w\"> </span><span class=\"c1\">-- SymAlg.unsym' a : α</span>\n\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">pp_nodot</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">SymAlg</span><span class=\"bp\">.</span><span class=\"n\">unsym'</span>\n\n<span class=\"c1\">-- no change at all.</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">unsym'</span><span class=\"w\"> </span><span class=\"c1\">-- SymAlg.unsym' a : α</span>\n</code></pre></div>",
        "id": 483986317,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732307389
    },
    {
        "content": "<p>what should happen with these porting notes?</p>",
        "id": 483986538,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732307462
    },
    {
        "content": "<p>to be clear, these porting notes related to the <code>pp_nodot</code> attribute can be found near <code>SymAlg.unsym</code> (<a href=\"https://github.com/leanprover-community/mathlib4/blob/be959a9ade921f874584eb5761e7c4f6c82f6651/Mathlib/Algebra/Symmetrized.lean#L50\">here</a>), <code>Real.nnabs</code> (<a href=\"https://github.com/leanprover-community/mathlib4/blob/be959a9ade921f874584eb5761e7c4f6c82f6651/Mathlib/Data/NNReal/Defs.lean#L919\">here</a>),  and <code>NNReal.sqrt</code> (<a href=\"https://github.com/leanprover-community/mathlib4/blob/be959a9ade921f874584eb5761e7c4f6c82f6651/Mathlib/Data/Real/Sqrt.lean#L41\">here</a>)</p>",
        "id": 483987249,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732307731
    },
    {
        "content": "<p>At some point I'm hoping the pretty printer can print these with dot notation, but yeah, it does not support it yet so <code>pp_nodot</code> does not yet have an effect.</p>",
        "id": 483987795,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1732307968
    },
    {
        "content": "<p>For the <code>LinearMap.ker</code> (and friends) related porting notes, i will replace the link to <a href=\"https://github.com/leanprover/lean4/pull/1910\">lean4#1910</a> with a link to <a href=\"https://github.com/leanprover/lean4/pull/1629\">lean4#1629</a></p>",
        "id": 483987949,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732308013
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/channel/287929-mathlib4/topic/lean.231910.20.28dot.20notation.20with.20coercions.29.20has.20been.20fixed/near/483987949\">said</a>:</p>\n<blockquote>\n<p>For the <code>LinearMap.ker</code> (and friends) related porting notes, i will replace the link to <a href=\"https://github.com/leanprover/lean4/pull/1910\">lean4#1910</a> with a link to <a href=\"https://github.com/leanprover/lean4/pull/1629\">lean4#1629</a></p>\n</blockquote>\n<p>PR at <a href=\"https://github.com/leanprover-community/mathlib4/pull/19381\">#19381</a></p>",
        "id": 483989634,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732308798
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/287929-mathlib4/topic/lean.231910.20.28dot.20notation.20with.20coercions.29.20has.20been.20fixed/near/483987795\">said</a>:</p>\n<blockquote>\n<p>At some point I'm hoping the pretty printer can print these with dot notation, but yeah, it does not support it yet so <code>pp_nodot</code> does not yet have an effect.</p>\n</blockquote>\n<p>alright, but what should happen to the porting notes which wrongly accuse <a href=\"https://github.com/leanprover/lean4/pull/1910\">lean4#1910</a> of causing this?</p>",
        "id": 483989873,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732308903
    },
    {
        "content": "<p>(these are the only porting notes that arent covered by a PR yet)</p>",
        "id": 483989946,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732308946
    },
    {
        "content": "<p>It'd be a help if you made a new Lean issue that tracks pretty printing of the CoeFun dot notation :-)</p>",
        "id": 483989949,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1732308947
    },
    {
        "content": "<p>i haven't made issues for lean4 repo yet, is there some guide for best practices?</p>",
        "id": 483990190,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732309058
    },
    {
        "content": "<p>Maybe you could start by copying the <a href=\"https://github.com/leanprover/lean4/pull/1910\">lean4#1910</a> issue and then adjusting it to say \"now dot notation works, but pretty printing doesn't\".</p>\n<p>In the end, I'm very likely going to be stuck with implementing the feature, and I know what it's about, but still it needs to be logged somewhere to make sure it happens. (I'd do it myself, but I don't have time for the next few hours at least.)</p>",
        "id": 483990891,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1732309330
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/6178\">lean4#6178</a></p>",
        "id": 483993564,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732310757
    },
    {
        "content": "<p>putting the relevant PRs in a row:<br>\n<a href=\"https://github.com/leanprover-community/mathlib4/pull/19369\">#19369</a> removes porting notes for <code>Additive.toMul</code> and <code>Multiplicative.toAdd</code></p>",
        "id": 483994652,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732311250
    },
    {
        "content": "<ul>\n<li><a href=\"https://github.com/leanprover-community/mathlib4/pull/19379\">#19379</a> removes defeq abuse for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Order.succ_toMul#doc\">docs#Order.succ_toMul</a> and friends</li>\n</ul>",
        "id": 483995182,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732311531
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/19380\">#19380</a> removes porting notes for <code>OrderHom.lfp</code>, <code>OrderHom.gfp</code>, and <code>OrderHom.dual</code></p>",
        "id": 483995197,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732311537
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/19381\">#19381</a> changes adaptation notes regarding <code>LinearMap.range</code> and friends to refer to <a href=\"https://github.com/leanprover/lean4/pull/1629\">lean4#1629</a> , since that is an issue that would actually solve the problem these notes are about</p>",
        "id": 483995217,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732311544
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/19385\">#19385</a> changes adaptation notes regarding use of <code>pp_nodot</code> to refer to <a href=\"https://github.com/leanprover/lean4/pull/6178\">lean4#6178</a> , since that is the newly blocking issue for the purpose of these notes.</p>",
        "id": 483995225,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732311550
    },
    {
        "content": "<p>at the end of the day, a whole 4 porting notes are removed by these PRs (of the 26 which mentioned the issue) <span aria-label=\"melting face\" class=\"emoji emoji-1fae0\" role=\"img\" title=\"melting face\">:melting_face:</span></p>",
        "id": 484000318,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732313886
    },
    {
        "content": "<p>There's a case I've seen (outside of mathlib, don't know if it appears anywhere in mathlib, and don't have a reduced test case) where dot notation with bundled functions (specifically, when a hypothesis calls a bundled function and dot notation is used on that hypothesis) still doesn't work even after the fix for <a href=\"https://github.com/leanprover/lean4/pull/1910\">lean#1910</a>.</p>\n<p>A representative example is at <a href=\"https://github.com/jsm28/AperiodicMonotilesLean/blob/a20bb761aee7263a613d4853662ca368f26321ef/AM/Mathlib/Combinatorics/Tiling/Periodic.lean#L156\">https://github.com/jsm28/AperiodicMonotilesLean/blob/a20bb761aee7263a613d4853662ca368f26321ef/AM/Mathlib/Combinatorics/Tiling/Periodic.lean#L156</a> - if I change <code>FiniteDistinctIntersections.finiteDistinctIntersectionsOn {x} hf</code> to <code>hf.finiteDistinctIntersectionsOn {x}</code>, it no longer works; Lean is apparently looking for <code>Discrete.TileSetFunction.toFun.finiteDistinctIntersectionsOn</code> when I'd like it to look for <code>Discrete.TileSet.FiniteDistinctIntersections.finiteDistinctIntersectionsOn</code> given that <code>hf</code> is calling <code>Discrete.TileSet.FiniteDistinctIntersections</code>.</p>",
        "id": 484017715,
        "sender_full_name": "Joseph Myers",
        "timestamp": 1732324593
    },
    {
        "content": "<p>I'd be interested in a reduced test case</p>",
        "id": 484018561,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1732325209
    },
    {
        "content": "<p>Reduced test case, not depending on mathlib, where I'd like dot notation to work but it doesn't:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">structure</span><span class=\"w\"> </span><span class=\"n\">MyStruct</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"kd\">structure</span><span class=\"w\"> </span><span class=\"n\">MyFun</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">MyStruct</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n\n<span class=\"kd\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CoeFun</span><span class=\"w\"> </span><span class=\"n\">MyFun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">MyStruct</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">coe</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">MyFun.toFun</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">MyStruct</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">IsZero</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MyFun</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">s.d</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">IsConst</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MyFun</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">s.d</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">s.d</span><span class=\"w\"> </span><span class=\"n\">j</span>\n\n<span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"n\">IsZero.isConst</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MyStruct</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s.IsZero</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s.IsConst</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">j</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">]</span>\n\n<span class=\"kd\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MyStruct</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s.IsZero</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s.IsConst</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">h.isConst</span>\n\n<span class=\"c\">/-</span>\n<span class=\"cm\">23:2:</span>\n<span class=\"cm\">invalid field 'isConst', the environment does not contain 'MyFun.toFun.isConst'</span>\n<span class=\"cm\">  h</span>\n<span class=\"cm\">has type</span>\n<span class=\"cm\">  IsZero.toFun s</span>\n<span class=\"cm\">23:2:</span>\n<span class=\"cm\">invalid field notation, type is not of the form (C ...) where C is a constant</span>\n<span class=\"cm\">  h</span>\n<span class=\"cm\">has type</span>\n<span class=\"cm\">  ∀ (i : ι), s.d i = 0</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"kd\">end</span><span class=\"w\"> </span><span class=\"n\">MyStruct</span>\n</code></pre></div>",
        "id": 484073842,
        "sender_full_name": "Joseph Myers",
        "timestamp": 1732376213
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/19237\">#19237</a> addresses (among other things) an instance of this</p>",
        "id": 484086804,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1732387672
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/19417\">#19417</a> doesn't directly address a porting note but it does amend a more recent decision that was made based on the lack of dot notation</p>",
        "id": 484087287,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1732388133
    },
    {
        "content": "<p>Thanks for minimizing <span class=\"user-mention\" data-user-id=\"266253\">@Joseph Myers</span>. Here's my understanding of the issue:</p>\n<ul>\n<li><code>s.IsZero</code> is short for <code>IsZero.toFun s</code> due to the fix to <a href=\"https://github.com/leanprover/lean4/pull/1910\">lean4#1910</a>, so at least that works.</li>\n<li>Recall that this type is <code>@MyStruct.MyFun.toFun MyStruct.IsZero ι s</code> in full.</li>\n<li>Writing <code>h.isConst</code>, it takes the head constant <code>MyStruct.MyFun.toFun</code> and looks for something named <code>isConst</code> in that namespace. There is no <code>MyStruct.MyFun.toFun.isConst</code>, so dot notation fails.</li>\n</ul>\n<p>We don't have any mechanism to reverse a <code>CoeFun</code>, at least not yet, so there's no way for dot notation to deduce that it should be looking in the <code>MyStruct.IsZero</code> namespace. Even if it did, it would have to figure out that it shouldn't be looking for a <code>MyStruct.MyFun.toFun</code> argument — it would have to reverse the <code>CoeFun</code> on <code>s</code> itself too.</p>\n<p>I'm not sure if we will ever support this ('this' being reversing coercions to resolve dot notations), sorry Joseph.</p>\n<p>I do have a workaround for you, which is to move <code>IsZero.isConst</code> or at least give it an alias. This works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">alias</span><span class=\"w\"> </span><span class=\"n\">MyFun</span><span class=\"bp\">.</span><span class=\"n\">toFun</span><span class=\"bp\">.</span><span class=\"n\">isConst</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">MyStruct</span><span class=\"bp\">.</span><span class=\"n\">IsZero</span><span class=\"bp\">.</span><span class=\"n\">isConst</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MyStruct</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">IsZero</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">IsConst</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">isConst</span>\n</code></pre></div>",
        "id": 484088584,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1732389224
    }
]