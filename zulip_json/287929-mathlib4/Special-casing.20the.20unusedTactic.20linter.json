[
    {
        "content": "<p>(For some reason the unusedTactic linter objects to one version's test file but not the other, has anyone debugged this kind of unpredictability before?)</p>",
        "id": 465269932,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1724705728
    },
    {
        "content": "<p>Just glancing at the code (I am not at a computer), I think that the linter is complaining about the \"config\" <code>skip</code> that the linter considers to be unused.</p>",
        "id": 465270293,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724705893
    },
    {
        "content": "<p>Right, but there is an identical file in which no complaints occur.</p>",
        "id": 465270324,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1724705913
    },
    {
        "content": "<p>Oh, on which file is the linter silent?</p>",
        "id": 465270487,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724705985
    },
    {
        "content": "<p>It's noisy on <code>test/linear_combination'</code> and silent on <code>test/linear_combination</code> :)<br>\n<a href=\"https://github.com/leanprover-community/mathlib4/actions/runs/10566534579/job/29273542575\">https://github.com/leanprover-community/mathlib4/actions/runs/10566534579/job/29273542575</a></p>",
        "id": 465270745,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1724706070
    },
    {
        "content": "<p>Ah, the docs of the linter hold the answer:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">The</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"n\">does</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">discharger</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"ss\">`linear_combination</span><span class=\"bp\">`</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">checks</span><span class=\"w\"> </span><span class=\"ss\">`linear_combination</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">itself</span><span class=\"bp\">.</span>\n<span class=\"w\">  </span><span class=\"n\">The</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">reason</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"ss\">`skip</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">common</span><span class=\"w\"> </span><span class=\"n\">discharger</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"w\"> </span><span class=\"n\">would</span>\n<span class=\"w\">  </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">always</span><span class=\"w\"> </span><span class=\"n\">fail</span><span class=\"w\"> </span><span class=\"n\">whenever</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">user</span><span class=\"w\"> </span><span class=\"n\">explicitly</span><span class=\"w\"> </span><span class=\"n\">chose</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">pass</span><span class=\"w\"> </span><span class=\"ss\">`skip</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">discharger</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"bp\">.</span>\n</code></pre></div>",
        "id": 465271388,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724706350
    },
    {
        "content": "<p>So, I am guessing that <code>linear_combination'</code> should be special-cased in the same way.</p>",
        "id": 465271482,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724706376
    },
    {
        "content": "<p>Aha!  Thanks!</p>",
        "id": 465271501,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1724706386
    },
    {
        "content": "<p>I can do that tomorrow, but if you want to take care of it now, it should be pretty straightforward as a change.</p>",
        "id": 465271520,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724706395
    },
    {
        "content": "<p>I made a guess on how to fix it, and if I guessed correctly, there will be no need to bother you.</p>",
        "id": 465271920,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1724706589
    },
    {
        "content": "<p>10 messages were moved here from <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/stream/287929-mathlib4/topic/Narrowing.20the.20scope.20of.20.02klzzwxh.3A0000.03\">#mathlib4 &gt; Narrowing the scope of <code>linear_combination</code></a> by <span class=\"user-mention silent\" data-user-id=\"260507\">Heather Macbeth</span>.</p>",
        "id": 465271998,
        "sender_full_name": "Notification Bot",
        "timestamp": 1724706609
    },
    {
        "content": "<p>I think the guess is <em>almost</em> right; it should be</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">``|&gt;.</span><span class=\"n\">insert</span><span class=\"w\"> </span><span class=\"ss\">`Mathlib.Tactic.LinearCombination'.linearCombination'</span><span class=\"bp\">``</span>\n</code></pre></div>",
        "id": 465272104,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1724706663
    },
    {
        "content": "<p>(The namespace name also has a prime.)</p>",
        "id": 465272122,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1724706672
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> that sounds like another instance of that principle from before: <code>skip</code> when used as a tactic (rather than a tacticSeq), or as the lone tactic in a tacticSeq, shouldn't be linted because you can't syntactically delete it</p>",
        "id": 465272156,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724706692
    },
    {
        "content": "<p>Where is the information of whether the syntax is a <code>tactic</code> or a <code>tacticSeq</code>?  I imagine somewhere in the infotree, but I cannot seem to find it.</p>",
        "id": 465354182,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724743334
    },
    {
        "content": "<p>it's in the syntax itself</p>",
        "id": 465359233,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724744731
    },
    {
        "content": "<p>although in general it's not super easy to get a hold of</p>",
        "id": 465359328,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724744759
    },
    {
        "content": "<p>the parent syntax will have some expectation for what its child is</p>",
        "id": 465359800,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724744920
    },
    {
        "content": "<p>Stored in... preresolved?</p>",
        "id": 465359863,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724744942
    },
    {
        "content": "<p>Or the SourceInfo?</p>",
        "id": 465359884,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724744950
    },
    {
        "content": "<p>no, just the structure of the tree and the node names</p>",
        "id": 465359926,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724744964
    },
    {
        "content": "<p>I am looking at what I thought was the \"whole\" syntax tree and I cannot find it.</p>",
        "id": 465359941,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724744970
    },
    {
        "content": "<p>in the case of tacticSeq, you can more or less what the hard code the possible parents are</p>",
        "id": 465359961,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724744974
    },
    {
        "content": "<p>Ah, like a missing null node somewhere?</p>",
        "id": 465360004,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724744988
    },
    {
        "content": "<p>I mean if the parent is a <code>tacticSeqIndented</code> node and under that is a null node and under that is a bunch of syntax nodes, then all those syntax nodes are in the <code>tactic</code> category because that's what <code>tacticSeqIndented</code> expects</p>",
        "id": 465360225,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724745046
    },
    {
        "content": "<p>Got it: it is a \"usual\" skip that appears inside something that was parsed as a <code>tacticSeq</code> or not.</p>",
        "id": 465360321,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724745085
    },
    {
        "content": "<p>If it is a <code>skip</code> node and its parent is a null node of length 1 (whose parent is a <code>tacticSeqIndented</code> or <code>tacticSeqBracketed</code> node), then that means it's alone in its tacticSeq</p>",
        "id": 465360461,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724745125
    },
    {
        "content": "<p>if it has a parent that isn't a null node then it is being used as a <code>tactic</code> directly in some other syntax</p>",
        "id": 465360591,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724745160
    },
    {
        "content": "<p>Indeed: this is what a <code>skip</code> with usual <code>tactic</code> parsing looks like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">|-</span><span class=\"n\">node</span><span class=\"w\"> </span><span class=\"n\">linearCombination</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">none</span>\n<span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|-</span><span class=\"n\">atom</span><span class=\"w\"> </span><span class=\"n\">original</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">⟨⟩⟨</span><span class=\"w\"> </span><span class=\"bp\">⟩</span><span class=\"c1\">-- 'linear_combination'</span>\n<span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|-</span><span class=\"n\">node</span><span class=\"w\"> </span><span class=\"n\">null</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">none</span>\n<span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|-</span><span class=\"n\">node</span><span class=\"w\"> </span><span class=\"n\">normStx</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">none</span>\n<span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|-</span><span class=\"n\">atom</span><span class=\"w\"> </span><span class=\"n\">original</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">⟨⟩⟨⟩</span><span class=\"c1\">-- '('</span>\n<span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|-</span><span class=\"n\">atom</span><span class=\"w\"> </span><span class=\"n\">original</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">⟨⟩⟨</span><span class=\"w\"> </span><span class=\"bp\">⟩</span><span class=\"c1\">-- 'norm'</span>\n<span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|-</span><span class=\"n\">atom</span><span class=\"w\"> </span><span class=\"n\">original</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">⟨⟩⟨</span><span class=\"w\"> </span><span class=\"bp\">⟩</span><span class=\"c1\">-- ':='</span>\n<span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|-</span><span class=\"n\">node</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Parser</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">skip</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">none</span>\n<span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|-</span><span class=\"n\">atom</span><span class=\"w\"> </span><span class=\"n\">original</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">⟨⟩⟨⟩</span><span class=\"c1\">-- 'skip'</span>\n<span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|-</span><span class=\"n\">atom</span><span class=\"w\"> </span><span class=\"n\">original</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">⟨⟩⟨⏎</span><span class=\"w\">  </span><span class=\"c1\">--rfl⏎⏎⟩-- ')'</span>\n<span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|-</span><span class=\"n\">node</span><span class=\"w\"> </span><span class=\"n\">null</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">none</span>\n</code></pre></div>\n<p>and this is what it looks like when you modify <code>linear_combination</code> to use a <code>tacticSeq</code> as discharger:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">|-</span><span class=\"n\">node</span><span class=\"w\"> </span><span class=\"n\">linearCombination</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">none</span>\n<span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|-</span><span class=\"n\">atom</span><span class=\"w\"> </span><span class=\"n\">original</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">⟨⟩⟨</span><span class=\"w\"> </span><span class=\"bp\">⟩</span><span class=\"c1\">-- 'linear_combination'</span>\n<span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|-</span><span class=\"n\">node</span><span class=\"w\"> </span><span class=\"n\">null</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">none</span>\n<span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|-</span><span class=\"n\">node</span><span class=\"w\"> </span><span class=\"n\">normStx</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">none</span>\n<span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|-</span><span class=\"n\">atom</span><span class=\"w\"> </span><span class=\"n\">original</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">⟨⟩⟨⟩</span><span class=\"c1\">-- '('</span>\n<span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|-</span><span class=\"n\">atom</span><span class=\"w\"> </span><span class=\"n\">original</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">⟨⟩⟨</span><span class=\"w\"> </span><span class=\"bp\">⟩</span><span class=\"c1\">-- 'norm'</span>\n<span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|-</span><span class=\"n\">atom</span><span class=\"w\"> </span><span class=\"n\">original</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">⟨⟩⟨</span><span class=\"w\"> </span><span class=\"bp\">⟩</span><span class=\"c1\">-- ':='</span>\n<span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|-</span><span class=\"n\">node</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Parser</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">tacticSeq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">none</span>\n<span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|-</span><span class=\"n\">node</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Parser</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">tacticSeq1Indented</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">none</span>\n<span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|-</span><span class=\"n\">node</span><span class=\"w\"> </span><span class=\"n\">null</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">none</span>\n<span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|-</span><span class=\"n\">node</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Parser</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">skip</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">none</span>\n<span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|-</span><span class=\"n\">atom</span><span class=\"w\"> </span><span class=\"n\">original</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">⟨⟩⟨⟩</span><span class=\"c1\">-- 'skip'</span>\n<span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"bp\">|-</span><span class=\"n\">atom</span><span class=\"w\"> </span><span class=\"n\">original</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">⟨⟩⟨⏎</span><span class=\"w\">  </span><span class=\"c1\">--rfl⏎⏎⟩-- ')'</span>\n</code></pre></div>",
        "id": 465360937,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724745288
    },
    {
        "content": "<p>After the <code>:=</code> I can now see that the syntax either places directly the node for the tactic or starts the dance for a tacticSeq.</p>",
        "id": 465361102,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724745345
    },
    {
        "content": "<p>in this case, you want to lint only when it has a parent that is a tacticSeq with more than 1 element</p>",
        "id": 465361213,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724745378
    },
    {
        "content": "<p>so both of these cases would be rejected</p>",
        "id": 465361256,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724745396
    },
    {
        "content": "<p>Yes, agreed.</p>",
        "id": 465361263,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724745398
    },
    {
        "content": "<p>\"Rejected\" as in \"allowed by the linter\"!  <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 465361300,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724745414
    },
    {
        "content": "<p>although if the tactic is anything <em>other</em> than <code>skip</code> you still want to lint it and suggest to replace it by <code>skip</code> in these edge cases</p>",
        "id": 465361539,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724745498
    },
    {
        "content": "<p>Yes, I am not sure that I will have time to work on this this week, but I agree: a <code>tactic</code> (that is not part of a <code>tacticSeq</code>!) should not be linted and a <code>tacticSeq</code> should be linted only if it contains more than one <code>tactic</code>.</p>",
        "id": 465362200,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724745698
    },
    {
        "content": "<p>From an \"efficiency\" point of view, does it make sense to make the linter not inspect tactics that are required to modify something?  E.g., should the linter not inspect <code>simp</code> in all its forms or is it not worth it?</p>",
        "id": 465365576,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724746869
    },
    {
        "content": "<p><code>simp</code> can have the <code>failIfUnchanged := false</code> option, in which case it may not fail even if it does nothing</p>",
        "id": 465578170,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724796698
    }
]