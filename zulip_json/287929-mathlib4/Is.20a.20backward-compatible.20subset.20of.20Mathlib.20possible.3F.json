[
    {
        "content": "<p>Hi all,</p>\n<p>I understand that Mathlib is not backward-compatible, and this remains a challenge even recently.</p>\n<p>I believe the lack of backward compatibility could hinder the adoption of Mathlib in applications. It causes trained LLMs to quickly become outdated. It also makes it harder for developers to build programs upon Mathlib.</p>\n<p>While we don’t have sufficient resources to make the entire Mathlib backward-compatible, perhaps we could focus on creating a <strong>sufficiently small subset</strong> that maintains compatibility?</p>\n<p>My proposal consists of three components:</p>",
        "id": 520676991,
        "sender_full_name": "Wen Yang (杨文)",
        "timestamp": 1748354586
    },
    {
        "content": "<h4>1. <strong>Stable-Mathlib</strong></h4>\n<p>A project depending on Mathlib that serves as a stable subset of Mathlib. Its goal is to cover <strong>undergraduate common math courses</strong>, such as Calculus, Linear Algebra, and Probability Theory.  </p>\n<p>Initially, we <strong>assume</strong> certain definitions/theorems in Mathlib are \"stable\" (i.e., their names and types won’t change). Then we create formal mirrors (like symbolic links) in Stable-Mathlib.  <br>\n<em>Example</em>: Create <code>StableMathlib/Data/Real/Basic.lean</code> with just one line:  </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib.Data.Real.Basic</span>\n</code></pre></div>\n<p>Users of Stable-Mathlib would write:  </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">StableMathlib.Data.Real.Basic</span>\n</code></pre></div>\n<p><em>Note</em>: This doesn’t mean we need to consider <strong>all</strong> content in <code>Mathlib.Data.Real.Basic</code>. Instead, we identify specific definitions/theorems we need and create test suites to monitor changes in Mathlib that could affect Stable-Mathlib users. When necessary, we’ll add actual code in Stable-Mathlib to maintain compatibility.</p>",
        "id": 520677046,
        "sender_full_name": "Wen Yang (杨文)",
        "timestamp": 1748354605
    },
    {
        "content": "<h4>2. <strong>UG-common-math</strong></h4>\n<p>A project depending on Stable-Mathlib that adds more definitions/theorems (possibly redundant ones) to cover the same areas: Calculus, Linear Algebra, and Probability Theory. Ideally, the <strong>main branch</strong> would strictly build on Stable-Mathlib, never directly using Mathlib’s definitions/theorems.</p>",
        "id": 520677127,
        "sender_full_name": "Wen Yang (杨文)",
        "timestamp": 1748354628
    },
    {
        "content": "<p><em>P.S.</em> I’d also like to create a Chinese version of UG-common-math, but currently I can only use <code>\\f&lt;&lt;&gt;&gt;</code> to do it. I’m curious when Lean will support native Chinese identifiers for definitions and theorems.</p>",
        "id": 520677238,
        "sender_full_name": "Wen Yang (杨文)",
        "timestamp": 1748354648
    },
    {
        "content": "<h4>3. <strong>Textbook formalizations</strong></h4>\n<p>Projects depending on UG-common-math, each corresponding to a formalized mathematics textbook.</p>",
        "id": 520677314,
        "sender_full_name": "Wen Yang (杨文)",
        "timestamp": 1748354666
    },
    {
        "content": "<p>The workflow would be <strong>inverted</strong>:  </p>\n<ul>\n<li>Start with textbook formalizations (component 3).  </li>\n<li>Identify needed content for component 3 → add to component 2 (UG-common-math).  </li>\n<li>Identify dependencies in UG-common-math → create test suites in component 1 (Stable-Mathlib).</li>\n</ul>",
        "id": 520677390,
        "sender_full_name": "Wen Yang (杨文)",
        "timestamp": 1748354686
    },
    {
        "content": "<p>We do <strong>not</strong> need to limit the scope to undergraduate common math courses. While I think many people might be interested in these courses, someone suggested starting with <strong>Abstract Algebra</strong> instead.</p>",
        "id": 520677439,
        "sender_full_name": "Wen Yang (杨文)",
        "timestamp": 1748354703
    },
    {
        "content": "<p>I’d like to know if this approach is feasible. Specifically:  </p>\n<ol>\n<li>Are any of these steps already being implemented by others?  </li>\n<li>Could performance issues become significant?  </li>\n<li>Would the maintenance workload be too heavy?</li>\n</ol>",
        "id": 520677587,
        "sender_full_name": "Wen Yang (杨文)",
        "timestamp": 1748354719
    },
    {
        "content": "<p>Looking forward to your feedback!</p>",
        "id": 520677651,
        "sender_full_name": "Wen Yang (杨文)",
        "timestamp": 1748354734
    },
    {
        "content": "<p>To be honest my response to \"it could consider trained LLMs to become outdated\" is \"that sounds like an LLM developer problem\". If they can only cope with stable APIs then they're less useful than just getting people to do it.</p>",
        "id": 520677972,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1748354803
    },
    {
        "content": "<p>But I think in general this is an interesting idea and a good point. (Your point about chinese identifiers is also a really good one and probably deserves a separate post.)</p>",
        "id": 520678121,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1748354853
    },
    {
        "content": "<p>In my perception, recent efforts towards backwards compatibility are mostly spent towards \"make it easy to migrate to a new mathlib version\". If you could migrate your project to a newer version of mathlib mostly automatically/with little effort, is that much worse than a guaranteed-stable project?</p>",
        "id": 520678310,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1748354906
    },
    {
        "content": "<p>Who will do this work?</p>",
        "id": 520678504,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1748354963
    },
    {
        "content": "<p>And what will the benefit be?</p>",
        "id": 520678583,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1748354988
    },
    {
        "content": "<p>I don't see mathlib maintainers committing to maintaining a stable subset of mathlib soon. (Caveat: I'm a mathlib reviewer, but not a maintainer.) There is lots of work to be done, and so far I don't see why one should spent all the energy on this project.<br>\nHaving an <code>unofficial-stable-mathlib</code> depending on mathlib is possible, of course: the question is who will do the work.</p>",
        "id": 520678673,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1748355005
    },
    {
        "content": "<p>And why: I'm not convinced yet the massive work required has sufficient use to justify it.</p>",
        "id": 520678775,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1748355037
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"416034\">Wen Yang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Is.20a.20backward-compatible.20subset.20of.20Mathlib.20possible.3F/near/520677390\">said</a>:</p>\n<blockquote>\n<p>The workflow would be <strong>inverted</strong>:  </p>\n<ul>\n<li>Start with textbook formalizations (component 3).  </li>\n<li>Identify needed content for component 3 → add to component 2 (UG-common-math).  </li>\n<li>Identify dependencies in UG-common-math → create test suites in component 1 (Stable-Mathlib).</li>\n</ul>\n</blockquote>\n<p>I'm sceptical this can work. Mathlib's completeness varies a lot by area, and e.g. in differential geometry a large number of relatively basic things are still missing. (Sometimes because they are hard!) In such an area, I'd rather push for contributions to mathlib, not an intermediate \"stable mathlib\". To add, if I formalise something for the first time, it's unlikely to be \"good enough\" for the next three years without change. I'd rather add material to mathlib first and let it mature there.</p>",
        "id": 520679219,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1748355181
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Is.20a.20backward-compatible.20subset.20of.20Mathlib.20possible.3F/near/520678504\">发言道</a>：</p>\n<blockquote>\n<p>Who will do this work?</p>\n</blockquote>\n<p>I'm planning to gather some people to work on it, provided that it doesn't require too much effort or resources.</p>",
        "id": 520679523,
        "sender_full_name": "Wen Yang (杨文)",
        "timestamp": 1748355275
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Is.20a.20backward-compatible.20subset.20of.20Mathlib.20possible.3F/near/520678310\">said</a>:</p>\n<blockquote>\n<p>In my perception, recent efforts towards backwards compatibility are mostly spent towards \"make it easy to migrate to a new mathlib version\". If you could migrate your project to a newer version of mathlib mostly automatically/with little effort, is that much worse than a guaranteed-stable project?</p>\n</blockquote>\n<p>I should add: help towards these efforts is very welcome. Some ideas simply need somebody to implement them \"well enough\", so we can standardise on one tool.</p>",
        "id": 520679564,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1748355287
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Is.20a.20backward-compatible.20subset.20of.20Mathlib.20possible.3F/near/520678310\">发言道</a>：</p>\n<blockquote>\n<p>If you could migrate your project to a newer version of mathlib mostly automatically/with little effort, is that much worse than a guaranteed-stable project?</p>\n</blockquote>\n<p>I think it's unlikely that migrating my project(s) to a newer version of mathlib can be done mostly automatically or with little effort — in fact, the process could be quite painful.</p>",
        "id": 520680382,
        "sender_full_name": "Wen Yang (杨文)",
        "timestamp": 1748355501
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Is.20a.20backward-compatible.20subset.20of.20Mathlib.20possible.3F/near/520678583\">发言道</a>：</p>\n<blockquote>\n<p>And what will the benefit be?</p>\n</blockquote>\n<p>I don't know. But at the very least, I hope to start formalizing a university-level math textbook now. However, I think that keeping up with Mathlib's updates will be a challenge.</p>",
        "id": 520681234,
        "sender_full_name": "Wen Yang (杨文)",
        "timestamp": 1748355745
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Is.20a.20backward-compatible.20subset.20of.20Mathlib.20possible.3F/near/520678775\">发言道</a>：</p>\n<blockquote>\n<p>And why: I'm not convinced yet the massive work required has sufficient use to justify it.</p>\n</blockquote>\n<p>I believe we need a mathematical library that is more accommodating to specific, possibly redundant definitions, theorems, and examples than Mathlib currently allows. For instance, there are theorems that hold true only for some functions but cannot be expected to apply to more general functions. And the textbooks often include examples and counterexamples that might not accepted by Mathlib.</p>",
        "id": 520682872,
        "sender_full_name": "Wen Yang (杨文)",
        "timestamp": 1748356198
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Is.20a.20backward-compatible.20subset.20of.20Mathlib.20possible.3F/near/520679219\">发言道</a>：</p>\n<blockquote>\n<p>Mathlib's completeness varies a lot by area, and e.g. in differential geometry a large number of relatively basic things are still missing. (Sometimes because they are hard!) In such an area, I'd rather push for contributions to mathlib, not an intermediate \"stable mathlib\". To add, if I formalise something for the first time, it's unlikely to be \"good enough\" for the next three years without change. I'd rather add material to mathlib first and let it mature there.</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"634338\">@Michael Rothgang</span>  I fully agree with your view. However, I think it's also important to recognize that many of the definitions, theorems, and examples required for formalizing a university-level math textbook might not fit well within Mathlib — often because they are context-specific or pedagogical in nature, rather than part of a generalized mathematical library. This doesn't diminish their value, but suggests that there might be a need for complementary resources alongside Mathlib.</p>",
        "id": 520684169,
        "sender_full_name": "Wen Yang (杨文)",
        "timestamp": 1748356536
    },
    {
        "content": "<p>Even in basic tutorials, such as math in lean4, we see a lot of changes caused by mathlib updates. I'm not sure how small \"a stable subset\" will be.<br>\nFor example:<br>\n<a href=\"https://github.com/avigad/mathematics_in_lean_source/commit/82c6e7a045000c5c99c89483209e960455322b79\">https://github.com/avigad/mathematics_in_lean_source/commit/82c6e7a045000c5c99c89483209e960455322b79</a><br>\n<a href=\"https://github.com/avigad/mathematics_in_lean_source/commit/12c71e9a4ca3b0a4c495fdc18e094e76d05c510c\">https://github.com/avigad/mathematics_in_lean_source/commit/12c71e9a4ca3b0a4c495fdc18e094e76d05c510c</a></p>",
        "id": 520684961,
        "sender_full_name": "Ziyu Zhou",
        "timestamp": 1748356747
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"413313\">Ziyu Zhou</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Is.20a.20backward-compatible.20subset.20of.20Mathlib.20possible.3F/near/520684961\">发言道</a>：</p>\n<blockquote>\n<p>Even in basic tutorials, such as math in lean4, we see a lot of changes caused by mathlib updates. I'm not sure how small \"a stable subset\" will be.</p>\n</blockquote>\n<p>I’m not sure either. In my view, the scope covered by MIL is quite limited — and perhaps this is precisely because Mathlib itself is still evolving and not yet sufficiently stable to support a broader teaching base.</p>",
        "id": 520686810,
        "sender_full_name": "Wen Yang (杨文)",
        "timestamp": 1748357205
    },
    {
        "content": "<p>Brainstorm: A better idea might be an AI agent that can track mathlib updates in real time to help us manage the project.</p>",
        "id": 520687972,
        "sender_full_name": "Ziyu Zhou",
        "timestamp": 1748357512
    },
    {
        "content": "<p>If <span class=\"user-mention\" data-user-id=\"197836\">@Jireh Loreaux</span> gets his way (and he might well) then <code>Group</code> will one day be refactored yet again in mathlib (a <code>pnat_smul</code> field might be added), so I cannot imagine that anyone in charge of the library would commit to any stability right now.</p>",
        "id": 520688843,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748357728
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Is.20a.20backward-compatible.20subset.20of.20Mathlib.20possible.3F/near/520688843\">发言道</a>：</p>\n<blockquote>\n<p>If <span class=\"user-mention silent\" data-user-id=\"197836\">Jireh Loreaux</span> gets his way (and he might well) then <code>Group</code> will one day be refactored yet again in mathlib (a <code>pnat_smul</code> field might be added), so I cannot imagine that anyone in charge of the library would commit to any stability right now.</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> I just found the relevant code in <a href=\"https://github.com/leanprover-community/mathlib4/pull/22517\">#22517</a>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">class</span><span class=\"w\"> </span><span class=\"n\">Semigroup</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kd\">extends</span><span class=\"w\"> </span><span class=\"n\">Mul</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- Multiplication is associative -/</span>\n<span class=\"w\">  </span><span class=\"kn\">protected</span><span class=\"w\"> </span><span class=\"n\">mul_assoc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- Positive integer power operation -/</span>\n<span class=\"w\">  </span><span class=\"n\">ppow</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ppowRec</span>\n<span class=\"w\">  </span><span class=\"n\">ppow_one</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ppow</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">Nat.one_pos</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"n\">intros</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">  </span><span class=\"n\">ppow_succ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ppow</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">succ_pos</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">ppow</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">n.succ_pos</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"n\">intros</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>Are you referring to this part? From my perspective, this is indeed an important example, and I should prepare for such changes. However, I’m not fully grasping your point here. I don’t see this code having a major impact because the new fields (<code>ppow</code>, <code>ppow_one</code>, <code>ppow_succ</code>) <strong>appear to be automatically generated</strong>. It seems unlikely that these additions would break existing theorems or proofs about <code>Semigroup</code>.</p>\n<p>I just read this:<br>\n<span class=\"user-mention silent\" data-user-id=\"197836\">Jireh Loreaux</span> <a href=\"#narrow/channel/287929-mathlib4/topic/PNat.20powers.20in.20a.20semigroup/near/505859441\">发言道</a>：</p>\n<blockquote>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/22517\">#22517</a> implements the forgetful inheritance approach, but the performance impact is absurdly large (1.1 tera-instructions). It seems to be a \"death by a thousand cuts situation\" for the most part with the largest single-file instruction increase being 24 billion. Does anyone know what might be a good potential culprit?</p>\n</blockquote>\n<p>Are you suggesting that even though downstream code continues to work after the refactor, the performance overhead introduced by the changes might be significantly higher than expected?</p>",
        "id": 520770857,
        "sender_full_name": "Wen Yang (杨文)",
        "timestamp": 1748386311
    },
    {
        "content": "<p>I'm suggesting that such a large performance increase is unacceptable, and I need to figure out how to reduce it significantly before the PR can be reasonably considered.</p>",
        "id": 520789711,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1748399237
    },
    {
        "content": "<p>Yes you've found the right PR. The fields have optional parameters so if you leave them out then they'll be generated automatically, but sometimes the default values will be the \"wrong\" things and in this case one will have to fill them in manually (indeed if the automatic solution was correct always then I guess we would not need the extra fields).</p>",
        "id": 520800236,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748406207
    }
]