[
    {
        "content": "<p>Hi all, I'm trying to prove this theorem about the way Traversables interact with Options, and I'm stuck on both directions:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">sequence_some</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Functor</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Traversable</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">LawfulTraversable</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">sequence</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"bp\">&lt;$&gt;</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Iff</span><span class=\"bp\">.</span><span class=\"n\">intro</span>\n<span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"c\">/-</span>\n<span class=\"cm\">    case mp</span>\n<span class=\"cm\">    ...</span>\n<span class=\"cm\">    h : sequence t = some t'</span>\n<span class=\"cm\">    ⊢ t = some &lt;$&gt; t'</span>\n<span class=\"cm\">    NOTE: Might not be true?</span>\n<span class=\"cm\">    -/</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">subst</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"n\">comm</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"c\">/-</span>\n<span class=\"cm\">    case mpr</span>\n<span class=\"cm\">    ...</span>\n<span class=\"cm\">    ⊢ some t' = sequence (some &lt;$&gt; t')</span>\n<span class=\"cm\">    NOTE: Should follow by naturality?</span>\n<span class=\"cm\">    -/</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>The right to left direction is really the one I'm asking for help with: I know it should follow from naturality, but I can't seem to get the types to line up. Does someone have a minute to help me wrangle the implicits?</p>\n<p>The left to right direction I'm actually not sure is true, but if anyone has an idea for how to prove that I'd also really appreciate it.</p>",
        "id": 489283844,
        "sender_full_name": "Harry Goldstein",
        "timestamp": 1734366974
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"686704\">Harry Goldstein</span> has marked this topic as resolved.</p>",
        "id": 489593447,
        "sender_full_name": "Notification Bot",
        "timestamp": 1734480195
    },
    {
        "content": "<p>This is surely false without <code>LawfulFunctor</code>?</p>",
        "id": 489594276,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1734480607
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"686704\">Harry Goldstein</span> has marked this topic as unresolved.</p>",
        "id": 489594926,
        "sender_full_name": "Notification Bot",
        "timestamp": 1734481000
    },
    {
        "content": "<p>I believe <code>LawfulTraversable</code> depends on <code>LawfulFunctor</code>, no?</p>",
        "id": 489594960,
        "sender_full_name": "Harry Goldstein",
        "timestamp": 1734481021
    },
    {
        "content": "<p>Ah, in that case you should remove <code>Functor</code>, since otherwise you're assuming two unrelated functor structures</p>",
        "id": 489595756,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1734481461
    }
]