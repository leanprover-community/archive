[
    {
        "content": "<p>I still fairly regularly encounter the situation where <code>lake exe cache get</code> reports there is nothing to download, but then <code>lake build</code> does work, and have to resort to <code>rm -rf .lake</code>.</p>\n<p>I finally have a repro for this. Run the following steps in Mathlib</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">checkout</span><span class=\"w\"> </span><span class=\"n\">de715a348f421a70c608a4cfa6a5c107944c914a</span><span class=\"w\">   </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">This</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">just</span><span class=\"w\"> </span><span class=\"n\">today's</span><span class=\"w\"> </span><span class=\"n\">master</span>\n<span class=\"n\">rm</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">rf</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span>\n<span class=\"n\">wget</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">tqft</span><span class=\"bp\">.</span><span class=\"n\">net</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">.</span><span class=\"n\">tgz</span><span class=\"w\">    </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"mf\">1.5</span><span class=\"n\">gb</span><span class=\"w\"> </span><span class=\"n\">file</span>\n<span class=\"n\">tar</span><span class=\"w\"> </span><span class=\"n\">zxvf</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">.</span><span class=\"n\">tgz</span>\n<span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"w\">     </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Reports</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">there</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">nothing</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">download</span>\n<span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\">             </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">But</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">still</span><span class=\"w\"> </span><span class=\"n\">recompiles</span>\n</code></pre></div>\n<p>Could someone verify for me that this reproduces for them?</p>\n<p>Note that <code>lake exe cache get</code> gives a warning \"warning: batteries: repository '././.lake/packages/batteries' has local changes\" but I <em>think</em> this is unrelated to the problem.</p>",
        "id": 497799364,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1738724698
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"gp\">$ </span>wget<span class=\"w\"> </span>https://tqft.net/.lake.tgz\n<span class=\"go\">--2025-02-05 06:11:29--  https://tqft.net/.lake.tgz</span>\n<span class=\"go\">Resolving tqft.net (tqft.net)... 2607:f298:6:a034::c0b:3922, 69.163.141.145</span>\n<span class=\"go\">Connecting to tqft.net (tqft.net)|2607:f298:6:a034::c0b:3922|:443... connected.</span>\n<span class=\"go\">HTTP request sent, awaiting response... 404 Not Found</span>\n<span class=\"go\">2025-02-05 06:11:30 ERROR 404: Not Found.</span>\n</code></pre></div>",
        "id": 497810491,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1738732317
    },
    {
        "content": "<p>Sad, my web hosting seems to have deleted the file.</p>",
        "id": 497812584,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1738733816
    },
    {
        "content": "<p>btw, last week when looking into cache, I did the following to investigate failures:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">rm</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">rf</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span>\n<span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Init</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"n\">mv</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">cached_lake</span>\n<span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">Mathlin</span><span class=\"bp\">.</span><span class=\"n\">Init</span>\n<span class=\"n\">diff</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">rq</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">cached_lake</span><span class=\"bp\">/</span>\n</code></pre></div>\n<p>and then see what files are missing/different. (I used <code>Mathlib.Init</code> because it started building from zero and that way the number of files was smaller)</p>\n<p>I believe <code>.trace</code> files are allowed to differ but not the file-hash in there.</p>\n<p>Anyways, might be worth to look at this and see if there are any suspicious differences.</p>",
        "id": 497822316,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1738739509
    },
    {
        "content": "<p>*or rather, I observed that some downloaded <code>.trace</code> files did contain less than the ones from building (which had some additional <code>env</code> entry or something) while it still seemed to work with this downloaded cache. From that I just accepted that this is probably fine without looking at it.<br>\nAnyways if you haven't resolved this by Monday, I could try to reproduce. Copying the entire <code>.lake</code> folder is definitely useful<span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span></p>",
        "id": 497823731,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1738740203
    },
    {
        "content": "<p>Hmmm, maybe this one: <a href=\"https://mega.nz/file/mT4QCIZC#fTkh0FxxqFnqDW5FHStTGBn5AH-ExEMzkEwHDN0ucZo\">https://mega.nz/file/mT4QCIZC#fTkh0FxxqFnqDW5FHStTGBn5AH-ExEMzkEwHDN0ucZo</a></p>",
        "id": 497845676,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1738747516
    },
    {
        "content": "<p>I can reproduce (in my case it downloaded files, but that's obviously irrelevant). After <code>lake exe cache get</code>, <code>lake build</code> output starts with:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">MinImports</span><span class=\"bp\">.</span><span class=\"n\">trace</span>\n<span class=\"o\">{</span><span class=\"s2\">\"log\"</span><span class=\"o\">:[],</span><span class=\"s2\">\"depHash\"</span><span class=\"o\">:</span><span class=\"s2\">\"10144975536918709095\"</span><span class=\"o\">}</span>\n\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"c1\">--no-ansi</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">batteries</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">repository</span><span class=\"w\"> </span><span class=\"bp\">'././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">batteries'</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"n\">changes</span>\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1095</span><span class=\"bp\">/</span><span class=\"mi\">6032</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">MinImports</span>\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1096</span><span class=\"bp\">/</span><span class=\"mi\">6032</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Logic</span><span class=\"bp\">.</span><span class=\"n\">Equiv</span><span class=\"bp\">.</span><span class=\"n\">Nat</span>\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1097</span><span class=\"bp\">/</span><span class=\"mi\">6032</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Size</span>\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1098</span><span class=\"bp\">/</span><span class=\"mi\">6032</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Linter</span><span class=\"bp\">.</span><span class=\"n\">UpstreamableDecl</span>\n<span class=\"o\">[</span><span class=\"bp\">...</span><span class=\"o\">]</span>\n\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">MinImports</span><span class=\"bp\">.</span><span class=\"n\">trace</span>\n<span class=\"o\">{</span><span class=\"s2\">\"log\"</span><span class=\"o\">:</span>\n<span class=\"w\"> </span><span class=\"o\">[{</span><span class=\"s2\">\"message\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">...</span><span class=\"n\">omitted</span><span class=\"bp\">...</span><span class=\"o\">],</span>\n<span class=\"w\">   </span><span class=\"s2\">\"level\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"trace\"</span><span class=\"o\">}],</span>\n<span class=\"w\"> </span><span class=\"s2\">\"depHash\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"9358359678330834859\"</span><span class=\"o\">}</span>\n</code></pre></div>",
        "id": 497877132,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1738757189
    },
    {
        "content": "<p>What does a <code>diff -r</code>between the broken and working .lake say?</p>",
        "id": 497886076,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1738760045
    },
    {
        "content": "<p>One thing that stands out is that, if I follow Kim's instructions, then I have this hash before and after <code>lake exe cache get</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">sha256sum</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">Nat</span><span class=\"bp\">/</span><span class=\"n\">Bits</span><span class=\"bp\">.</span><span class=\"n\">olean</span>\n<span class=\"mi\">4</span><span class=\"n\">f5135aa15fb9853f1675bc33cb5187ed6141e0281011a924d04b80d28c22629</span><span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">Nat</span><span class=\"bp\">/</span><span class=\"n\">Bits</span><span class=\"bp\">.</span><span class=\"n\">olean</span>\n</code></pre></div>\n<p>But if I do the same thing in a clean checkout of the same commit, then I see this instead:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">sha256sum</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">Nat</span><span class=\"bp\">/</span><span class=\"n\">Bits</span><span class=\"bp\">.</span><span class=\"n\">olean</span>\n<span class=\"mi\">29266328</span><span class=\"n\">c4d6fef3dc91b684fcbe10d27855f9bf2ce46841ed9e7b81d25968a0</span><span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">Nat</span><span class=\"bp\">/</span><span class=\"n\">Bits</span><span class=\"bp\">.</span><span class=\"n\">olean</span>\n</code></pre></div>",
        "id": 497887097,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1738760353
    },
    {
        "content": "<p>I'm going to try manually removing trace files before running <code>lake exe cache get</code> to see if it makes diffing easier.</p>",
        "id": 497887586,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1738760502
    },
    {
        "content": "<p>Removing all trace files and then running <code>lake exe cache get</code> afterwards makes <code>lake build</code> succeed without rebuilding anything. So there must be an outdated trace file that cache decides not to overwrite for some reason.</p>",
        "id": 497890800,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1738761534
    },
    {
        "content": "<p>Uh-oh... This is what I see on a clean checkout:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span>\n<span class=\"o\">[</span><span class=\"bp\">...</span><span class=\"o\">]</span>\n<span class=\"n\">Decompressing</span><span class=\"w\"> </span><span class=\"mi\">6025</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span>\n<span class=\"n\">Unpacked</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mi\">4781</span><span class=\"w\"> </span><span class=\"n\">ms</span>\n<span class=\"n\">Completed</span><span class=\"w\"> </span><span class=\"n\">successfully!</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span>\n<span class=\"n\">Build</span><span class=\"w\"> </span><span class=\"n\">completed</span><span class=\"w\"> </span><span class=\"n\">successfully</span><span class=\"bp\">.</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">sha256sum</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">Nat</span><span class=\"bp\">/</span><span class=\"n\">Bits</span><span class=\"bp\">.</span><span class=\"n\">olean</span>\n<span class=\"mi\">29266328</span><span class=\"n\">c4d6fef3dc91b684fcbe10d27855f9bf2ce46841ed9e7b81d25968a0</span><span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">Nat</span><span class=\"bp\">/</span><span class=\"n\">Bits</span><span class=\"bp\">.</span><span class=\"n\">olean</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">Nat</span><span class=\"bp\">/</span><span class=\"n\">Bits</span><span class=\"bp\">.</span><span class=\"n\">trace</span>\n<span class=\"o\">{</span><span class=\"s2\">\"log\"</span><span class=\"o\">:[],</span><span class=\"s2\">\"depHash\"</span><span class=\"o\">:</span><span class=\"s2\">\"17010145873784995897\"</span><span class=\"o\">}</span>\n</code></pre></div>\n<p>So far, so good. But then:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">rm</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">Nat</span><span class=\"bp\">/</span><span class=\"n\">Bits</span><span class=\"bp\">.*</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"c1\">--no-ansi</span>\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">2929</span><span class=\"bp\">/</span><span class=\"mi\">6036</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Bits</span>\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">2930</span><span class=\"bp\">/</span><span class=\"mi\">6036</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Logic</span><span class=\"bp\">.</span><span class=\"n\">Equiv</span><span class=\"bp\">.</span><span class=\"n\">Nat</span>\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">2931</span><span class=\"bp\">/</span><span class=\"mi\">6036</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Size</span>\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">2932</span><span class=\"bp\">/</span><span class=\"mi\">6036</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Countable</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">2933</span><span class=\"bp\">/</span><span class=\"mi\">6036</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">FP</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">2934</span><span class=\"bp\">/</span><span class=\"mi\">6036</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Group</span><span class=\"bp\">.</span><span class=\"n\">Subgroup</span><span class=\"bp\">.</span><span class=\"n\">ZPowers</span><span class=\"bp\">.</span><span class=\"n\">Lemmas</span>\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">2935</span><span class=\"bp\">/</span><span class=\"mi\">6036</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Logic</span><span class=\"bp\">.</span><span class=\"n\">Encodable</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">2936</span><span class=\"bp\">/</span><span class=\"mi\">6036</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Bitwise</span>\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">2937</span><span class=\"bp\">/</span><span class=\"mi\">6036</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Rat</span><span class=\"bp\">.</span><span class=\"n\">Encodable</span>\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">2938</span><span class=\"bp\">/</span><span class=\"mi\">6036</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Logic</span><span class=\"bp\">.</span><span class=\"n\">Encodable</span><span class=\"bp\">.</span><span class=\"n\">Lattice</span>\n<span class=\"o\">[</span><span class=\"bp\">...</span><span class=\"o\">]</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">sha256sum</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">Nat</span><span class=\"bp\">/</span><span class=\"n\">Bits</span><span class=\"bp\">.</span><span class=\"n\">olean</span>\n<span class=\"mi\">4</span><span class=\"n\">f5135aa15fb9853f1675bc33cb5187ed6141e0281011a924d04b80d28c22629</span><span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">Nat</span><span class=\"bp\">/</span><span class=\"n\">Bits</span><span class=\"bp\">.</span><span class=\"n\">olean</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">Nat</span><span class=\"bp\">/</span><span class=\"n\">Bits</span><span class=\"bp\">.</span><span class=\"n\">trace</span>\n<span class=\"o\">{</span><span class=\"s2\">\"log\"</span><span class=\"o\">:</span>\n<span class=\"w\"> </span><span class=\"o\">[{</span><span class=\"s2\">\"message\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">...</span><span class=\"n\">omitted</span><span class=\"bp\">...</span><span class=\"o\">]</span>\n<span class=\"w\"> </span><span class=\"s2\">\"depHash\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"17010145873784995897\"</span><span class=\"o\">}</span>\n</code></pre></div>",
        "id": 497901000,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1738764343
    },
    {
        "content": "<p>To be fair, I'm not sure I'm supposed to get the exact same sha in different builds. But it is weird that it needs to rebuild a lot of stuff instead of the file I just deleted.</p>",
        "id": 497901796,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1738764577
    },
    {
        "content": "<p>Hmm. This file uses <code>simp?  says</code>. Maybe CI is generating different oleans due to that?</p>",
        "id": 497905461,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1738765521
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">rm</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">Nat</span><span class=\"bp\">/</span><span class=\"n\">Bits</span><span class=\"bp\">.*</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">CI</span><span class=\"bp\">=</span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Bits</span>\n<span class=\"n\">Build</span><span class=\"w\"> </span><span class=\"n\">completed</span><span class=\"w\"> </span><span class=\"n\">successfully</span><span class=\"bp\">.</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">sha256sum</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">Nat</span><span class=\"bp\">/</span><span class=\"n\">Bits</span><span class=\"bp\">.</span><span class=\"n\">olean</span>\n<span class=\"mi\">29266328</span><span class=\"n\">c4d6fef3dc91b684fcbe10d27855f9bf2ce46841ed9e7b81d25968a0</span><span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">Nat</span><span class=\"bp\">/</span><span class=\"n\">Bits</span><span class=\"bp\">.</span><span class=\"n\">olean</span>\n\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">rm</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">Nat</span><span class=\"bp\">/</span><span class=\"n\">Bits</span><span class=\"bp\">.*</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Bits</span>\n<span class=\"n\">Build</span><span class=\"w\"> </span><span class=\"n\">completed</span><span class=\"w\"> </span><span class=\"n\">successfully</span><span class=\"bp\">.</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">sha256sum</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">Nat</span><span class=\"bp\">/</span><span class=\"n\">Bits</span><span class=\"bp\">.</span><span class=\"n\">olean</span>\n<span class=\"mi\">4</span><span class=\"n\">f5135aa15fb9853f1675bc33cb5187ed6141e0281011a924d04b80d28c22629</span><span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">Nat</span><span class=\"bp\">/</span><span class=\"n\">Bits</span><span class=\"bp\">.</span><span class=\"n\">olean</span>\n</code></pre></div>",
        "id": 497906553,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1738765771
    },
    {
        "content": "<p>Ah, that seems to be a source of non-determinism. The hashes are sensible to that</p>",
        "id": 497922539,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1738769908
    },
    {
        "content": "<p>Yeah, leantar doesn't overwrite oleans if the trace is the same, i.e. it reasonably assumes that equal inputs will result in equal outputs. But what is unsettling is that in Kim's .tgz this happens elsewhere as well: <code>.lake/packages/importGraph/.lake/build/lib/ImportGraph/Imports.trace</code> matches what you get from <code>lake exe cache get</code>, but the corresponding olean does not.</p>",
        "id": 497925243,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1738770532
    },
    {
        "content": "<p>(Off-topic: I know I've already complained about base-10 hashes, but it's also very annoying that .hash/.trace files don't end in a newline)</p>",
        "id": 497926223,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1738770764
    },
    {
        "content": "<p>That's not good, Imports.olean contains the full path to the lean binary:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">xxd</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">importGraph</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">ImportGraph</span><span class=\"bp\">/</span><span class=\"n\">Imports</span><span class=\"bp\">.</span><span class=\"n\">olean</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">grep</span><span class=\"w\"> </span><span class=\"n\">kim</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"mi\">4</span>\n<span class=\"mi\">0002</span><span class=\"n\">b4c0</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0000</span><span class=\"w\"> </span><span class=\"mi\">0000</span><span class=\"w\"> </span><span class=\"mi\">2000</span><span class=\"w\"> </span><span class=\"mi\">0205</span><span class=\"w\"> </span><span class=\"mi\">80</span><span class=\"n\">af</span><span class=\"w\"> </span><span class=\"mi\">7566</span><span class=\"w\"> </span><span class=\"n\">fa1f</span><span class=\"w\"> </span><span class=\"mi\">0000</span><span class=\"w\">  </span><span class=\"bp\">....</span><span class=\"w\"> </span><span class=\"bp\">.....</span><span class=\"n\">uf</span><span class=\"bp\">....</span>\n<span class=\"mi\">0002</span><span class=\"n\">b4d0</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a0b4</span><span class=\"w\"> </span><span class=\"mi\">7566</span><span class=\"w\"> </span><span class=\"n\">fa1f</span><span class=\"w\"> </span><span class=\"mi\">0000</span><span class=\"w\"> </span><span class=\"n\">c9ad</span><span class=\"w\"> </span><span class=\"n\">ea58</span><span class=\"w\"> </span><span class=\"mi\">0200</span><span class=\"w\"> </span><span class=\"mi\">0000</span><span class=\"w\">  </span><span class=\"bp\">..</span><span class=\"n\">uf</span><span class=\"bp\">.......</span><span class=\"n\">X</span><span class=\"bp\">....</span>\n<span class=\"mi\">0002</span><span class=\"n\">b4e0</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0000</span><span class=\"w\"> </span><span class=\"mi\">0000</span><span class=\"w\"> </span><span class=\"mi\">0100</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"n\">f9</span><span class=\"w\"> </span><span class=\"mi\">4500</span><span class=\"w\"> </span><span class=\"mi\">0000</span><span class=\"w\"> </span><span class=\"mi\">0000</span><span class=\"w\"> </span><span class=\"mi\">0000</span><span class=\"w\">  </span><span class=\"bp\">........</span><span class=\"n\">E</span><span class=\"bp\">.......</span>\n<span class=\"mi\">0002</span><span class=\"n\">b4f0</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">4500</span><span class=\"w\"> </span><span class=\"mi\">0000</span><span class=\"w\"> </span><span class=\"mi\">0000</span><span class=\"w\"> </span><span class=\"mi\">0000</span><span class=\"w\"> </span><span class=\"mi\">4400</span><span class=\"w\"> </span><span class=\"mi\">0000</span><span class=\"w\"> </span><span class=\"mi\">0000</span><span class=\"w\"> </span><span class=\"mi\">0000</span><span class=\"w\">  </span><span class=\"n\">E</span><span class=\"bp\">.......</span><span class=\"n\">D</span><span class=\"bp\">.......</span>\n<span class=\"mi\">0002</span><span class=\"n\">b500</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"n\">f55</span><span class=\"w\"> </span><span class=\"mi\">7365</span><span class=\"w\"> </span><span class=\"mi\">7273</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"n\">f6b</span><span class=\"w\"> </span><span class=\"mi\">696</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"n\">f2e</span><span class=\"w\"> </span><span class=\"mi\">656</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"mi\">616</span><span class=\"n\">e</span><span class=\"w\">  </span><span class=\"bp\">/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">kim</span><span class=\"bp\">/.</span><span class=\"n\">elan</span>\n<span class=\"mi\">0002</span><span class=\"n\">b510</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"n\">f74</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"n\">f6f</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"n\">c63</span><span class=\"w\"> </span><span class=\"mi\">6861</span><span class=\"w\"> </span><span class=\"mi\">696</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"mi\">732</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"n\">c65</span><span class=\"w\"> </span><span class=\"mi\">616</span><span class=\"n\">e</span><span class=\"w\">  </span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">lean</span>\n<span class=\"mi\">0002</span><span class=\"n\">b520</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">7072</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"n\">f76</span><span class=\"w\"> </span><span class=\"mi\">6572</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"n\">d2d</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"n\">c65</span><span class=\"w\"> </span><span class=\"mi\">616</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"mi\">342</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"n\">d2d</span><span class=\"w\">  </span><span class=\"n\">prover</span><span class=\"c1\">--lean4---</span>\n<span class=\"mi\">0002</span><span class=\"n\">b530</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">7634</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"n\">e31</span><span class=\"w\"> </span><span class=\"mi\">372</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"mi\">302</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"mi\">7263</span><span class=\"w\"> </span><span class=\"mi\">312</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"n\">c69</span><span class=\"w\"> </span><span class=\"mi\">622</span><span class=\"n\">f</span><span class=\"w\">  </span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">17</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc1</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span>\n<span class=\"mi\">0002</span><span class=\"n\">b540</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"n\">c65</span><span class=\"w\"> </span><span class=\"mi\">616</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"mi\">0000</span><span class=\"w\"> </span><span class=\"mi\">0000</span><span class=\"w\"> </span><span class=\"mi\">0000</span><span class=\"w\"> </span><span class=\"mi\">0000</span><span class=\"w\"> </span><span class=\"mi\">1000</span><span class=\"w\"> </span><span class=\"mi\">0101</span><span class=\"w\">  </span><span class=\"n\">lean</span><span class=\"bp\">............</span>\n</code></pre></div>",
        "id": 497929702,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1738771684
    },
    {
        "content": "<p>And it's been like this since forever (I tested with the <code>v4.4.0</code> tag). I guess that's what we get for prescribing <code>rm -rf .lake</code> as a cure for every problem :) But it's understandable: If you make the mistake of running <code>lake build</code> before <code>lake exe cache get</code> and it builds importGraph, then you'll basically need to nuke your <code>.lake</code> directory unless you know exactly what the problem is. Minimal example (independent of the <code>simp? says</code> issue, which might also be a problem):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">clone</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"n\">mathlib4</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">tested</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"n\">eb0ff709449ce0401b0032e17d61dd0f5d51b46</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">commit</span><span class=\"w\"> </span><span class=\"n\">shouldn't</span><span class=\"w\"> </span><span class=\"n\">matter</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">ImportGraph</span><span class=\"bp\">.</span><span class=\"n\">Imports</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"w\"> </span><span class=\"n\">happen</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">real</span><span class=\"bp\">-</span><span class=\"n\">life</span><span class=\"w\"> </span><span class=\"n\">scenarios</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">you</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">bare</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">it</span><span class=\"w\"> </span><span class=\"n\">reaches</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"n\">before</span><span class=\"w\"> </span><span class=\"n\">you</span><span class=\"w\"> </span><span class=\"n\">press</span><span class=\"w\"> </span><span class=\"n\">Ctrl</span><span class=\"bp\">-</span><span class=\"n\">C</span>\n<span class=\"o\">[</span><span class=\"bp\">...</span><span class=\"o\">]</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">leantar</span><span class=\"w\"> </span><span class=\"n\">doesn't</span><span class=\"w\"> </span><span class=\"n\">overwrite</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">olean</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"n\">matches</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">can</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">overridden</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">leantar</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">default</span><span class=\"o\">)</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span>\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1098</span><span class=\"bp\">/</span><span class=\"mi\">6036</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">MinImports</span>\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1099</span><span class=\"bp\">/</span><span class=\"mi\">6036</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Linter</span><span class=\"bp\">.</span><span class=\"n\">UpstreamableDecl</span>\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1100</span><span class=\"bp\">/</span><span class=\"mi\">6036</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Group</span><span class=\"bp\">.</span><span class=\"n\">Idempotent</span>\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1101</span><span class=\"bp\">/</span><span class=\"mi\">6036</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Ring</span><span class=\"bp\">.</span><span class=\"n\">Submonoid</span>\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1102</span><span class=\"bp\">/</span><span class=\"mi\">6036</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Linter</span><span class=\"bp\">.</span><span class=\"n\">MinImports</span>\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1103</span><span class=\"bp\">/</span><span class=\"mi\">6036</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Group</span><span class=\"bp\">.</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Hom</span>\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1104</span><span class=\"bp\">/</span><span class=\"mi\">6036</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Linter</span>\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1105</span><span class=\"bp\">/</span><span class=\"mi\">6036</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">GroupWithZero</span><span class=\"bp\">.</span><span class=\"n\">Idempotent</span>\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1106</span><span class=\"bp\">/</span><span class=\"mi\">6036</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Common</span>\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1107</span><span class=\"bp\">/</span><span class=\"mi\">6036</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Ring</span><span class=\"bp\">.</span><span class=\"n\">Idempotent</span>\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1108</span><span class=\"bp\">/</span><span class=\"mi\">6036</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">Count</span>\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1109</span><span class=\"bp\">/</span><span class=\"mi\">6036</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">GroupWithZero</span><span class=\"bp\">.</span><span class=\"n\">Action</span><span class=\"bp\">.</span><span class=\"n\">Synonym</span>\n<span class=\"bp\">✔</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1110</span><span class=\"bp\">/</span><span class=\"mi\">6036</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Control</span><span class=\"bp\">.</span><span class=\"n\">Bifunctor</span>\n<span class=\"o\">[</span><span class=\"bp\">...</span><span class=\"o\">]</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">rm</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">importGraph</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">ImportGraph</span><span class=\"bp\">/</span><span class=\"n\">Imports</span><span class=\"bp\">.</span><span class=\"n\">trace</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span>\n<span class=\"n\">No</span><span class=\"w\"> </span><span class=\"n\">files</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">download</span>\n<span class=\"n\">Decompressing</span><span class=\"w\"> </span><span class=\"mi\">6025</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span>\n<span class=\"n\">Unpacked</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"w\"> </span><span class=\"n\">ms</span>\n<span class=\"n\">Completed</span><span class=\"w\"> </span><span class=\"n\">successfully!</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">should</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">fine</span><span class=\"w\"> </span><span class=\"n\">now</span>\n<span class=\"n\">Build</span><span class=\"w\"> </span><span class=\"n\">completed</span><span class=\"w\"> </span><span class=\"n\">successfully</span><span class=\"bp\">.</span>\n</code></pre></div>",
        "id": 497932824,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1738772563
    },
    {
        "content": "<p>You'll need to deal with both problems to fix Kim's workdir, since I assume some <code>simp? says</code> files were also built locally:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">clone</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"n\">mathlib4</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">tar</span><span class=\"w\"> </span><span class=\"n\">xzf</span><span class=\"w\"> </span><span class=\"bp\">~/</span><span class=\"n\">lake</span><span class=\"bp\">.</span><span class=\"n\">tgz</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">rm</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">importGraph</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">ImportGraph</span><span class=\"bp\">/</span><span class=\"n\">Imports</span><span class=\"bp\">.</span><span class=\"n\">trace</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"ss\">`grep</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">Rl</span><span class=\"w\"> </span><span class=\"s2\">\"simp</span><span class=\"err\">\\</span><span class=\"s2\">?.*says\"</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">`;</span><span class=\"w\"> </span><span class=\"k\">do</span><span class=\"w\"> </span><span class=\"n\">rm</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/$</span><span class=\"o\">{</span><span class=\"n\">file</span><span class=\"bp\">%.</span><span class=\"n\">lean</span><span class=\"o\">}</span><span class=\"bp\">.</span><span class=\"n\">trace</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">done</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">oleans</span><span class=\"w\"> </span><span class=\"n\">corresponding</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"mi\">83</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"w\"> </span><span class=\"n\">files</span><span class=\"w\"> </span><span class=\"n\">deleted</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">two</span><span class=\"w\"> </span><span class=\"n\">lines</span><span class=\"w\"> </span><span class=\"n\">above</span><span class=\"w\"> </span><span class=\"n\">will</span><span class=\"w\"> </span><span class=\"n\">now</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">extracted</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">batteries</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">repository</span><span class=\"w\"> </span><span class=\"bp\">'././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">batteries'</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"n\">changes</span>\n<span class=\"n\">Build</span><span class=\"w\"> </span><span class=\"n\">completed</span><span class=\"w\"> </span><span class=\"n\">successfully</span><span class=\"bp\">.</span>\n</code></pre></div>",
        "id": 497936443,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1738773568
    },
    {
        "content": "<p>Thanks for this!  Here is another confirmation.</p>\n<p>I just pulled the current mathlib, ran <code>lake exe cache get</code> and after that <code>lake build</code> started building.</p>\n<p>I interrupted it quickly, but missed the first couple of files when I stopped it at</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>⡿<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">1108</span>/6039<span class=\"o\">]</span><span class=\"w\"> </span>Running<span class=\"w\"> </span>Mathlib.Algebra.Quotient<span class=\"w\"> </span><span class=\"o\">(</span>+<span class=\"w\"> </span><span class=\"m\">3</span><span class=\"w\"> </span>more<span class=\"o\">)</span>^C\n</code></pre></div>",
        "id": 498048693,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738825131
    },
    {
        "content": "<p>After that, running</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>rm<span class=\"w\"> </span>.lake/packages/importGraph/.lake/build/lib/ImportGraph/Imports.trace\nlake<span class=\"w\"> </span>build\n</code></pre></div>\n<p>worked!</p>",
        "id": 498048699,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738825134
    },
    {
        "content": "<p>Thanks for confirming! For future reference: I assume you ran <code>lake exe cache get</code> again in between the <code>rm</code> and the <code>lake build</code>, right?</p>",
        "id": 498087367,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1738837838
    },
    {
        "content": "<p>I think so, but I'm no longer at my computer...</p>",
        "id": 498088007,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738838023
    },
    {
        "content": "<p>The full path in Imports.olean is caused by <a href=\"https://github.com/leanprover-community/import-graph/blob/main/ImportGraph/Imports.lean#L190-L194\">the following function</a>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Core</span><span class=\"bp\">.</span><span class=\"n\">withImportModules</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">modules</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Name</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CoreM</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">searchPathRef</span><span class=\"bp\">.</span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">compile_time_search_path</span><span class=\"bp\">%</span>\n<span class=\"w\">  </span><span class=\"n\">unsafe</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">withImportModules</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">modules</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">}))</span><span class=\"w\"> </span><span class=\"o\">{}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">trustLevel</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1024</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"n\">fst</span><span class=\"w\"> </span><span class=\"bp\">&lt;$&gt;</span><span class=\"w\"> </span><span class=\"n\">Core</span><span class=\"bp\">.</span><span class=\"n\">CoreM</span><span class=\"bp\">.</span><span class=\"n\">toIO</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"n\">ctx</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">fileName</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"&lt;CoreM&gt;\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">fileMap</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">default</span><span class=\"w\"> </span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"k\">do</span><span class=\"w\"> </span><span class=\"n\">f</span>\n</code></pre></div>\n<p>The <a href=\"https://leanprover-community.github.io/mathlib4_docs/Lean/Util/SearchPath.html\">docs</a> say the first line is a bad idea. I guess we want <code>initSearchPath (← findSysroot)</code> instead?</p>",
        "id": 498110570,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1738845321
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/import-graph/pull/56\">https://github.com/leanprover-community/import-graph/pull/56</a></p>",
        "id": 498114565,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1738846565
    },
    {
        "content": "<p>Merged. (Apologies for the delay.)</p>",
        "id": 498756716,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1739192943
    },
    {
        "content": "<p>Thanks! I tried looking into the <code>simp? says</code> issue, but generating identical oleans in all cases is way above my pay grade.</p>",
        "id": 498765157,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1739195087
    },
    {
        "content": "<p>For future reference: One thing I ignored is that <code>lake exe cache get!</code> passes <code>-f</code> to leantar, meaning it is a valid workaround for the issues described above.</p>",
        "id": 498807327,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1739204927
    },
    {
        "content": "<p>Unfortunately it also redownloads the whole cache. It would be nice to have an option that only forces unpacking.</p>",
        "id": 498807579,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1739205001
    },
    {
        "content": "<p>Do we not have <code>lake exe cache unpack!</code>?</p>",
        "id": 498841403,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1739214548
    },
    {
        "content": "<p>Oh, we do! Thanks.</p>",
        "id": 498967753,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1739267322
    }
]