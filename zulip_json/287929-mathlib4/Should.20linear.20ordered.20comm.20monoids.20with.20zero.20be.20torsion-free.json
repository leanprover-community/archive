[
    {
        "content": "<p>We have two lemmas proving that, if <code>n : ℕ</code> is non-zero, then <code>a : M</code> is one iff <code>a ^ n</code> is one:</p>\n<ul>\n<li><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsMulTorsionFree.pow_eq_one_iff_left#doc\">docs#IsMulTorsionFree.pow_eq_one_iff_left</a>, assuming that <code>M</code> is torsion-free</li>\n<li><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=pow_eq_one_iff#doc\">docs#pow_eq_one_iff</a>, assuming that <code>M</code> is a linearly ordered monoid</li>\n</ul>",
        "id": 547421447,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1761634813
    },
    {
        "content": "<p>The latter looks like a code smell to me, since <code>n ≠ 0 → (a ^ n = 1 ↔ a = 1)</code> is a purely algebraic statement, yet it is proved using some order assumptions. This got me thinking: Is there any non-torsion-free linearly ordered monoid we care about? If not, we could fully replace <code>pow_eq_one_iff</code> with <code>IsMulTorsionFree.pow_eq_one_iff_left</code>.</p>",
        "id": 547421643,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1761634913
    },
    {
        "content": "<p>The answer is \"It's hard, currently\", because <code>pow_eq_one_iff</code> is used in the context of valuations on the target <code>Γ</code> of a valuation, which is a linearly ordered comm monoid with zero.  This is a problem, because <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearOrderedCommMonoidWithZero#doc\">docs#LinearOrderedCommMonoidWithZero</a> currently only implies monotonicity of multiplication, not strict monotonicity.</p>",
        "id": 547422120,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1761635174
    },
    {
        "content": "<p>My question therefore is: Should it be that <code>LinearOrderedCommMonoidWithZero M₀</code> imply <code>PosMulStrictMono M₀</code> (which would in turn imply <code>IsMulTorsionFree M₀</code>)?</p>",
        "id": 547422336,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1761635285
    },
    {
        "content": "<p>cc <span class=\"user-mention\" data-user-id=\"112680\">@Johan Commelin</span></p>",
        "id": 547422344,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1761635292
    },
    {
        "content": "<p>Here's my current progress unifying the two lemmas at the top of the thread: <a href=\"https://github.com/leanprover-community/mathlib4/pull/30799\">#30799</a></p>",
        "id": 547422474,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1761635377
    },
    {
        "content": "<p>Thanks for the ping. I can't immediately think of a counter example. But let me ping some experts:<br>\n<span class=\"user-mention\" data-user-id=\"300245\">@Filippo A. E. Nuccio</span> <span class=\"user-mention\" data-user-id=\"406490\">@María Inés de Frutos Fernández</span> <span class=\"user-mention\" data-user-id=\"130609\">@Antoine Chambert-Loir</span> <span class=\"user-mention\" data-user-id=\"308899\">@Yakov Pechersky</span> <span class=\"user-mention\" data-user-id=\"243562\">@Adam Topaz</span></p>",
        "id": 547422609,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1761635484
    },
    {
        "content": "<p>There is a counterexample to something that may be related in <a href=\"https://leanprover-community.github.io/mathlib4_docs/Counterexamples/CanonicallyOrderedCommSemiringTwoMul.html\">file#Counterexamples.CanonicallyOrderedCommSemiringTwoMul</a>, but I am not sure if it is the (counter)example that you are looking for.</p>",
        "id": 547427869,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1761637988
    },
    {
        "content": "<p>I'm on mobile now, but aren't you mixing up multiplicative and additive notation, <span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span> ?  So, don't you want the conclusion that when <code>n</code> is non-zero, we have <code>a*n=0</code> iff <code>a=0</code>?</p>",
        "id": 547429757,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1761638751
    },
    {
        "content": "<p>I mean torsion-free in the sense of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsMulTorsionFree#doc\">docs#IsMulTorsionFree</a>, ie <code>n ≠ 0 → Injective (· ^ n)</code></p>",
        "id": 547430019,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1761638847
    },
    {
        "content": "<p>Ok, but then in your code snippet you want to replace <code>a^n = 0</code> by <code>a^n=1</code>, right? I'm asking to understand if you care about monoids with zero or simply honest monoids.</p>",
        "id": 547430593,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1761639080
    },
    {
        "content": "<p>Yes, sorry, that was a running typo</p>",
        "id": 547434945,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1761640594
    },
    {
        "content": "<p>In the context of <em>groups</em>, a linear ordered forces the group to be torsion free.</p>",
        "id": 547435887,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1761640906
    },
    {
        "content": "<p>I'm on mobile, but what happens with <code>WithTop Unit</code>?</p>",
        "id": 547436082,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1761640985
    },
    {
        "content": "<p>Indeed, <code>LinearOrderedCommGroupWithZero G₀</code> already implies <code>PosMulStrictMono G₀</code> (mathlib knows this). My question really is about non-group monoids. <code>ZMod 2</code> (<code>= WithTop Unit</code>) respects <code>PosMulStrictMono</code>, so that's not interesting.</p>",
        "id": 547437026,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1761641325
    },
    {
        "content": "<p>And <code>ZMod 2 x ZMod 2</code> (as product of <code>WithTop Units</code>?) I'm not sure to immediately come up with an interesting valuation valued there, but it seems plausible.</p>",
        "id": 547437543,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1761641481
    },
    {
        "content": "<p>This is not linearly ordered</p>",
        "id": 547437703,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1761641543
    },
    {
        "content": "<p>You would need to come up with a non-cancellative monoid with zero, ie there would need to be some <code>a ≠ b</code> and <code>c ≠ 0</code> such that <code>a * c = b * c</code>.</p>",
        "id": 547437763,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1761641571
    },
    {
        "content": "<p>Like <code>Z + ZMod 2</code>, where <code>(n, 0) &lt; (n, 1)</code>: does it work?</p>",
        "id": 547438035,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1761641650
    },
    {
        "content": "<p>Oh, this is a group!</p>",
        "id": 547438111,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1761641683
    },
    {
        "content": "<p>Well, it depends on the structure on <code>ZMod 2</code></p>",
        "id": 547438155,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1761641703
    },
    {
        "content": "<p>I mean, if you see it as <code>WithZero Unit</code>, then <code>0</code> absorbs.</p>",
        "id": 547438234,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1761641731
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span> consider the truncated monoid <code>Fin 67</code> where <code>a + b := min(a+b, 66)</code> and <code>a * b := min(ab,66)</code>, then 3^37 = 4^37</p>",
        "id": 547438396,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761641788
    },
    {
        "content": "<p>Yes, I know this exists. My question is \"Do you care about them?\"</p>",
        "id": 547438472,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1761641811
    },
    {
        "content": "<p>i guess other people in this discussion didn't know it exists</p>",
        "id": 547438658,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761641873
    },
    {
        "content": "<p>Sorry, I should have given it as an example, but I didn't want to influence what people would come up with</p>",
        "id": 547438831,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1761641923
    },
    {
        "content": "<p>Well, everybody who worked with a 8-digit calculator knows that truncated integers exist.</p>",
        "id": 547438866,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1761641935
    },
    {
        "content": "<p>For me, there are two distinct questions:</p>\n<ul>\n<li>What kind of objects do <code>LinearOrderedblahblah</code>we wish to model?</li>\n<li>Given the name of the structure, what is expected that they would satisfy.</li>\n</ul>",
        "id": 547439077,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1761642000
    },
    {
        "content": "<p>This is only tangentially related, but when proving that monoid algebra (don't) have zero divisors, there were a lot of arguments involving an ordering on the grading monoid that were replaced by <code>UniqueSums</code> and it worked very well.  Maybe something analogous should happen here, though I don't know what the replacement is!</p>",
        "id": 547439323,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1761642077
    },
    {
        "content": "<p>Thinking from ordered groups, there's a basic theorem that they are torsion free, which drives the whole mathematical field. (For example, it follows from the fact that the braid group is orderable that it is torsion free.) So I guess our ordered blobs should satisfy this as well.</p>",
        "id": 547439540,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1761642149
    },
    {
        "content": "<p>From what I understand, only the relation with <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>≤</mo></mrow><annotation encoding=\"application/x-tex\">\\leq</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mrel\">≤</span></span></span></span> has been imposed but not <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>&lt;</mo></mrow><annotation encoding=\"application/x-tex\">\\lt</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mrel\">&lt;</span></span></span></span>, and that may be a mistake. On the other hand, changing the definition now might break a lot of things and we may also wish to have a weaker structure at our disposal.</p>",
        "id": 547439668,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1761642183
    },
    {
        "content": "<p>I feel like this is heading towards the direction of \"we should only allow monoids whose map to its groupification is injective\" and I don't think that's a good direction</p>",
        "id": 547440720,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761642489
    },
    {
        "content": "<p>Not at all,  there are very important monoids/semirings which are not like that.</p>",
        "id": 547440961,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1761642572
    },
    {
        "content": "<p>The question here is only about the notion of an ordering relation on a monoid, that is, the nature of the expected interaction between the ordering relation and the multiplication. Is it that multiplication respects <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>&lt;</mo></mrow><annotation encoding=\"application/x-tex\">&lt;</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mrel\">&lt;</span></span></span></span> or that it respects <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>≤</mo></mrow><annotation encoding=\"application/x-tex\">\\leq</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mrel\">≤</span></span></span></span>? As your simple example shows, these are two different notions.</p>",
        "id": 547441252,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1761642678
    },
    {
        "content": "<p>Do you have (naturally occurring) examples of valuations that are valued in non-cancellative monoids with zero? This, to me, seems like the central question</p>",
        "id": 547452031,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1761645958
    },
    {
        "content": "<p>I suppose by that you mean <em>organic</em> examples</p>",
        "id": 547452176,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761646011
    },
    {
        "content": "<p>what's a valuation</p>",
        "id": 547453828,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761646540
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Valuation#doc\">docs#Valuation</a></p>",
        "id": 547453907,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1761646568
    },
    {
        "content": "<p>I can value any local domain which is not a field in a three element linear ordered comm monoid with zero that's not cancellative</p>",
        "id": 547456806,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761647475
    },
    {
        "content": "<p>is that \"natural\"</p>",
        "id": 547456847,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761647486
    },
    {
        "content": "<p>I am looking for important mathematical applications, not theoretical considerations</p>",
        "id": 547465365,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1761649936
    },
    {
        "content": "<p>The fact that the whole edifice of mathematics holds up is a combination of important examples and such theoretical considerations. (Analogous argument: you can likely delete the empty set from the theory of sets by pretending but this will make the theory much more difficult to work out.)</p>",
        "id": 547467731,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1761650660
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Should.20linear.20ordered.20comm.20monoids.20with.20zero.20be.20torsion-free/near/547452031\">said</a>:</p>\n<blockquote>\n<p>Do you have (naturally occurring) examples of valuations that are valued in non-cancellative monoids with zero?</p>\n</blockquote>\n<p>At least for ValuativeRel the answer is negative, because it is set up so that the support is always a prime ideal, so you get a valuation on R/supp(R) which is an integral domain</p>",
        "id": 547468730,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761650966
    },
    {
        "content": "<p>(but it seems like Valuation does not have this restriction)</p>",
        "id": 547468777,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761650982
    },
    {
        "content": "<p>For <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Valuation#doc\">docs#Valuation</a>, keep in mind that mathematicians <em>always</em> consider the case where the monoid with zero comes from a linearly ordered group with zero added. Here, mathlib has to judge between the tension of adding an extra level of generality (by authorizing all ordered comm monoids with zero, whatever that means)  with the need of providing additional hypotheses to get actual theorems, or sticking within the classical story.</p>",
        "id": 547471861,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1761651968
    },
    {
        "content": "<p>Thanks Antoine! I believe what you just said is strong evidence we could restrict the <code>Valuation</code> API (and therefore <code>LinearOrderedCommMonoidWithZero</code>, whose sole purpose is to be used in the <code>Valuation</code> API) to talk about cancellative monoids with zero.</p>",
        "id": 547485578,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1761655977
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearOrderedAddMonoidWithTop#doc\">docs#LinearOrderedAddMonoidWithTop</a> would then need changing too, as it is the generality of the codomain of a general additive valuation</p>",
        "id": 547486823,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1761656333
    },
    {
        "content": "<p>If I understand correctly the setting, by our LinearOrderedCommGroupWithZero (and general \"math\" structure), the Hahn embedding theorem says any such group can be decomposed into a lexicographic product of subgroups of the Reals (considered additively). So one gets the LE to LT relationship naturally that way, due to inheriting it from the Reals (or Int when discrete).</p>",
        "id": 547492616,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1761657843
    },
    {
        "content": "<p>… or, simpler, by cancellation if the monoid with zero is actually a group with zero.</p>",
        "id": 547496865,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1761658891
    },
    {
        "content": "<p>Maybe sidetracking but I am a bit sad that all linear ordered cancellative monoid stuff are only developed assuming it is a partial order. This forced me to duplicate API for the valuation preorder on valued fields.</p>",
        "id": 547498603,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1761659338
    },
    {
        "content": "<p>I think your point is worth another discussion, yes</p>",
        "id": 547548892,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1761671201
    },
    {
        "content": "<p>Annoyingly, this change seems to have made <code>ne_zero_of_lt</code> no longer apply to <code>ℝ≥0∞</code></p>",
        "id": 568809718,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1768831602
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ne_zero_of_lt#doc\">docs#ne_zero_of_lt</a></p>",
        "id": 568811884,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1768832158
    },
    {
        "content": "<p>Is there a reason why <code>ne_zero_of_lt</code> doesn't have the same type-class arguments as <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=bot_eq_zero#doc\">docs#bot_eq_zero</a> ?</p>",
        "id": 568812821,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1768832429
    },
    {
        "content": "<p>This lemma should probably be generalised or deprecated in the future</p>",
        "id": 568820804,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1768834448
    }
]