[
    {
        "content": "<p>The current definition of groupoids in mathlib makes use of a type-valued class <code>Groupoid</code> bundling explicit inverses for every morphisms, which I guess is nice for computability/keeping things explicit.<br>\nFor similar situations (e.g <code>Discrete</code>), there is also a prop-valued typeclass asserting that a category merely has the property, and then a noncomputable def turning it into the type-valued class. In the case of groupoid, that would be something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">IsGroupoid</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">all_is_iso</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">⟶</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsIso</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">infer_instance</span>\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">IsGroupoid</span><span class=\"bp\">.</span><span class=\"n\">all_is_iso</span>\n</code></pre></div>\n<p>and it would change <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CategoryTheory.Groupoid.ofIsIso#doc\">docs#CategoryTheory.Groupoid.ofIsIso</a> to something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Groupoid</span><span class=\"bp\">.</span><span class=\"n\">ofIsGroupoid</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsGroupoid</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Groupoid</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">inv</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">inv</span><span class=\"w\"> </span><span class=\"n\">f</span>\n<span class=\"w\">  </span><span class=\"n\">inv_comp</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Classical</span><span class=\"bp\">.</span><span class=\"n\">choose_spec</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">infer_instance</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsIso</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">out</span><span class=\"bp\">|&gt;.</span><span class=\"n\">right</span>\n</code></pre></div>\n<p>Would the <code>CategoryTheory</code> maintainers be OK with this? I would like to use this as a basis for a definition of \"Locally groupoidal\" bicategories (aka (2,1)-categories).</p>",
        "id": 507966076,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1742894062
    },
    {
        "content": "<p>Is <del>docs#CategoryTheory.IsIso prop-valued?</del> yes, maybe I'm remembering an old version</p>",
        "id": 507978897,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1742897419
    },
    {
        "content": "<p>What's the advantage of the new definition for you? Usually the argument for introducing something prop-valued like this is \"this avoids some annoying instance diamonds\", not just convenience constructing it.</p>",
        "id": 507979304,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1742897538
    },
    {
        "content": "<p>I do not have explicit example of specific instance diamonds that it could avoid (I will admit that I see the word \"diamond\" flailed everywhere in this zulip, but I only have a vague understanding of what it actually means in practice), but I can imagine the fact that using it as a structure might get a bit painful if you try to talk about locally groupoidal bi-categories as I’d like to. E.g, you'd need to extend <code>Bicategory</code> in a way that a <code>homGroupoid</code> structure field extends its <code>homCategory</code> fields. You probably can’t take this as a definition (or at least I don’t know the syntax for this if you can), so I guess you have instead to add the inverses as fields of the extended structure, but then you have to externally define the <code>Groupoid</code> instance everywhere. (It would also perhaps make the statement of \"a locally discrete category is locally groupoidal\" a bit harder I guess).</p>\n<p>Aside from this example, I also feel like having a prop-valued definition like this is much closer to the usual mathematical practice of category theory in the literature, but that is purely philosophical and admittedly very subjective.<br>\n(Also an other \"philosophical\" point: we have <code>AlgebraicTopology.KanComplex</code>, aka (a model of) infinity-groupoids as prop-valued, and sooner or later  a statement like \"a (homotopically) 1-truncated Kan complex is the nerve of a groupoid\" will probably need to deal with the fact that one is prop-valued while the other does not have a prop-valued counterpart.)</p>",
        "id": 507985705,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1742899129
    },
    {
        "content": "<p>As we have <code>Bicategory.IsLocallyDiscrete</code>, I think we can have <code>IsLocallyGroupoid</code> that is defined similarly.</p>",
        "id": 508046860,
        "sender_full_name": "Joël Riou",
        "timestamp": 1742914531
    },
    {
        "content": "<p>As <code>IsLocallyDiscrete</code> uses the <code>IsDiscrete</code> typeclass, that means we also need the <code>IsGroupoid</code> typeclass then.</p>",
        "id": 508047782,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1742914703
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/23307\">#23307</a>. I’ll deprecate <code>Groupoid.ofIsIso</code> once it lands.</p>",
        "id": 508055538,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1742916307
    }
]