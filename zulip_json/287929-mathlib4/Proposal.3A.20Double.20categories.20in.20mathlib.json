[
    {
        "content": "<p>I am interested in contributing the definition of a weak double category to mathlib, and examples.</p>\n<p>I started writing it down and I feel that it would be better to refactor the existing definition of bicategory to make it more modular.</p>\n<p>I will include my code so far below, which indicates the design definition I want to go.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Bicategory</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"n\">Cat</span>\n\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Functor</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span>\n\n<span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">ParametricQuiver</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">unusedVariables</span><span class=\"w\"> </span><span class=\"n\">false</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">hzQuiver</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">u1</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">O</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n\n<span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">O</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">O</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v1</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">ParametricQuiver</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v‚ÇÅ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">u‚ÇÅ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÇ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">u‚ÇÇ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÉ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">u‚ÇÉ</span><span class=\"o\">}</span>\n\n<span class=\"o\">(</span><span class=\"n\">O‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u‚ÇÅ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Quiver</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v‚ÇÅ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">O‚ÇÅ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">O‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u‚ÇÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Quiver</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v‚ÇÇ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">O‚ÇÇ</span><span class=\"o\">]</span>\n\n<span class=\"o\">(</span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">O‚ÇÅ</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">O‚ÇÇ</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u‚ÇÉ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n\n<span class=\"n\">two_cells</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">forall</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">o‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">o‚ÇÅ'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">O‚ÇÅ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Quiver</span><span class=\"bp\">.</span><span class=\"n\">Hom</span><span class=\"w\"> </span><span class=\"n\">o‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">o‚ÇÅ'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">o‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">o‚ÇÇ'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">O‚ÇÇ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Quiver</span><span class=\"bp\">.</span><span class=\"n\">Hom</span><span class=\"w\"> </span><span class=\"n\">o‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">o‚ÇÇ'</span><span class=\"o\">),</span>\n\n<span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">o‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">o‚ÇÇ</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">o‚ÇÅ'</span><span class=\"w\"> </span><span class=\"n\">o‚ÇÇ'</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÉ</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">ParametricQuiver</span>\n\n<span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">ParametricCategory</span>\n\n<span class=\"kn\">universe</span><span class=\"w\"> </span><span class=\"n\">u‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">u‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">w‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">w‚ÇÇ</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">ParametricQuiver</span><span class=\"w\"> </span><span class=\"k\">in</span>\n\n<span class=\"sd\">/--</span>\n\n<span class=\"sd\">A parametric CategoryStruct over two CategoryStructs C and D.</span>\n<span class=\"sd\">- For each pair of objects (c, d) in C √ó D, we have a type of objects Ob c d</span>\n<span class=\"sd\">- For each pair of morphisms (f : c ‚Üí c') in C and (g : d ‚Üí d') in D,</span>\n\n<span class=\"sd\">and objects X : Ob c d and Y : Ob c' d', we have a type of morphisms Hom f g X Y</span>\n<span class=\"sd\">-/</span>\n\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"o\">:</span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"s2\">\"‚ñ°(\"</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"s2\">\",\"</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"s2\">\";\"</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"s2\">\",\"</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"s2\">\")\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">two_cells</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">ParametricCategoryStruct</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u‚ÇÅ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u‚ÇÇ</span><span class=\"o\">)</span>\n\n<span class=\"o\">[</span><span class=\"n\">Ccat</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CategoryStruct</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v‚ÇÅ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">u‚ÇÅ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Dcat</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CategoryStruct</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v‚ÇÇ</span><span class=\"o\">,</span><span class=\"n\">u‚ÇÇ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">]</span>\n\n<span class=\"o\">(</span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">w‚ÇÅ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ParametricQuiver</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v‚ÇÅ</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">u‚ÇÅ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÇ</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">u‚ÇÇ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">w‚ÇÇ</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">w‚ÇÅ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"o\">]</span>\n\n<span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">u‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">u‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">w‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">w‚ÇÇ</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n\n<span class=\"sd\">/-- Identity morphism over the pair of identity morphisms -/</span>\n\n<span class=\"n\">id</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">ParametricQuiver</span><span class=\"bp\">.</span><span class=\"n\">two_cells</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">F</span>\n\n<span class=\"sd\">/-- Composition of morphisms over composition of base morphisms -/</span>\n\n<span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"w\"> </span><span class=\"n\">c''</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">d'</span><span class=\"w\"> </span><span class=\"n\">d''</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">}</span>\n\n<span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">c''</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">d'</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">g'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">d'</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">d''</span><span class=\"o\">}</span>\n\n<span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"w\"> </span><span class=\"n\">d'</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">c''</span><span class=\"w\"> </span><span class=\"n\">d''</span><span class=\"o\">},</span>\n\n<span class=\"bp\">‚ñ°</span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"o\">,</span><span class=\"n\">g</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"bp\">‚ñ°</span><span class=\"o\">(</span><span class=\"n\">f'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">g'</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"bp\">‚ñ°</span><span class=\"o\">(</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">f'</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">g'</span><span class=\"o\">)</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">special2cell</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u‚ÇÅ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u‚ÇÇ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Category</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Category</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">]</span>\n\n<span class=\"o\">(</span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"o\">)</span>\n\n<span class=\"o\">[</span><span class=\"n\">ParametricQuiver</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"o\">]</span>\n\n<span class=\"o\">[</span><span class=\"n\">ParametricCategoryStruct</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">}</span>\n\n<span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n\n<span class=\"bp\">‚ñ°</span><span class=\"o\">(</span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span>\n\n<span class=\"sd\">/--</span>\n\n<span class=\"sd\">A parametric Category over two Categories C and D.</span>\n\n<span class=\"sd\">Extends ParametricCategoryStruct with identity and associativity axioms.</span>\n\n<span class=\"sd\">These axioms state that the parametric structure respects the categorical structure of C and D.</span>\n<span class=\"sd\">-/</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">ParametricCategory</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u‚ÇÅ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u‚ÇÇ</span><span class=\"o\">)</span>\n\n<span class=\"o\">[</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v‚ÇÅ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v‚ÇÇ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">]</span>\n\n<span class=\"o\">(</span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">w‚ÇÅ</span><span class=\"o\">)</span>\n\n<span class=\"o\">[</span><span class=\"n\">ParametricQuiver</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"o\">]</span>\n\n<span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">ParametricCategoryStruct</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u‚ÇÅ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">u‚ÇÇ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÇ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">w‚ÇÅ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">w‚ÇÇ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n\n<span class=\"sd\">/-- Identity morphisms are left identities for composition,</span>\n\n<span class=\"sd\">modulo the left identity laws in C and D -/</span>\n\n<span class=\"n\">id_comp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">d'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">d'</span><span class=\"o\">}</span>\n\n<span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"w\"> </span><span class=\"n\">d'</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚ñ°</span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)),</span>\n\n<span class=\"o\">(</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"n\">id_comp</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚ñ∏</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"n\">id_comp</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚ñ∏</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"c1\">-- ((Category.id_comp f).symm ‚ñ∏ (Category.id_comp g).symm ‚ñ∏ h : ‚ñ°((ùüô c ‚â´ f), (ùüô d ‚â´ g); X, Y))</span>\n\n<span class=\"sd\">/-- Identity morphisms are right identities for composition,</span>\n\n<span class=\"sd\">modulo the right identity laws in C and D -/</span>\n\n<span class=\"n\">comp_id</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">d'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">d'</span><span class=\"o\">}</span>\n\n<span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"w\"> </span><span class=\"n\">d'</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚ñ°</span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)),</span>\n\n<span class=\"o\">(</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"n\">comp_id</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚ñ∏</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"n\">comp_id</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚ñ∏</span><span class=\"w\"> </span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">h</span>\n\n<span class=\"sd\">/-- Composition is associative, modulo the associativity laws in C and D -/</span>\n\n<span class=\"n\">assoc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">c‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÉ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">d‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">d‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">d‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">d‚ÇÉ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">}</span>\n\n<span class=\"o\">{</span><span class=\"n\">f‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÄ</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÅ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÅ</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÇ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f‚ÇÉ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÇ</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÉ</span><span class=\"o\">}</span>\n\n<span class=\"o\">{</span><span class=\"n\">g‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">d‚ÇÄ</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">d‚ÇÅ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">g‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">d‚ÇÅ</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">d‚ÇÇ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">g‚ÇÉ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">d‚ÇÇ</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">d‚ÇÉ</span><span class=\"o\">}</span>\n\n<span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">d‚ÇÄ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">d‚ÇÅ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">d‚ÇÇ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÉ</span><span class=\"w\"> </span><span class=\"n\">d‚ÇÉ</span><span class=\"o\">}</span>\n\n<span class=\"o\">(</span><span class=\"n\">h‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚ñ°</span><span class=\"o\">(</span><span class=\"n\">f‚ÇÅ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">g‚ÇÅ</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">,</span><span class=\"n\">Y</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚ñ°</span><span class=\"o\">(</span><span class=\"n\">f‚ÇÇ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">g‚ÇÇ</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h‚ÇÉ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚ñ°</span><span class=\"o\">(</span><span class=\"n\">f‚ÇÉ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">g‚ÇÉ</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"o\">)),</span>\n\n<span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"n\">h‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">h‚ÇÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">h‚ÇÉ</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n\n<span class=\"o\">(</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"n\">assoc</span><span class=\"w\"> </span><span class=\"n\">f‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">f‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">f‚ÇÉ</span><span class=\"w\"> </span><span class=\"bp\">‚ñ∏</span><span class=\"w\"> </span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"n\">assoc</span><span class=\"w\"> </span><span class=\"n\">g‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">g‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">g‚ÇÉ</span><span class=\"w\"> </span><span class=\"bp\">‚ñ∏</span>\n\n<span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"n\">h‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"n\">h‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">h‚ÇÉ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚ñ°</span><span class=\"o\">((</span><span class=\"n\">f‚ÇÅ</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">f‚ÇÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">f‚ÇÉ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g‚ÇÅ</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">g‚ÇÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">g‚ÇÉ</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"o\">))</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">special2cellCatStruct</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Category</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Category</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">]</span>\n\n<span class=\"o\">(</span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">w‚ÇÅ</span><span class=\"o\">)</span>\n\n<span class=\"o\">[</span><span class=\"n\">ParametricQuiver</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"o\">]</span>\n\n<span class=\"o\">[</span><span class=\"n\">ParametricCategoryStruct</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">}</span>\n\n<span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CategoryStruct</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span>\n\n<span class=\"n\">Hom</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">special2cell</span><span class=\"w\"> </span><span class=\"n\">HHom</span>\n\n<span class=\"n\">id</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ParametricCategoryStruct</span><span class=\"bp\">.</span><span class=\"n\">id</span>\n\n<span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">special2cell</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">special2cell</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n\n<span class=\"o\">(</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"n\">comp_id</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚ñ∏</span><span class=\"w\"> </span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"n\">comp_id</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚ñ∏</span>\n\n<span class=\"n\">ParametricCategoryStruct</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span>\n\n<span class=\"bp\">‚ñ°</span><span class=\"o\">(</span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">))</span>\n\n<span class=\"o\">}</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">ParametricCategoryStruct</span><span class=\"w\"> </span><span class=\"k\">in</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">special2cellCat</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Category</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span>\n\n<span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Category</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">]</span>\n\n<span class=\"o\">(</span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">w‚ÇÅ</span><span class=\"o\">)</span>\n\n<span class=\"o\">[</span><span class=\"n\">ParametricQuiver</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"o\">]</span>\n\n<span class=\"o\">[</span><span class=\"n\">ParametricCategory</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">}</span>\n\n<span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Category</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span>\n\n<span class=\"n\">id_comp</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span>\n\n<span class=\"n\">dsimp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CategoryStruct</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">special2cellCatStruct</span><span class=\"o\">]</span>\n\n<span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">ParametricCategory</span><span class=\"bp\">.</span><span class=\"n\">id_comp</span><span class=\"w\"> </span><span class=\"n\">f</span>\n\n<span class=\"n\">comp_id</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span>\n\n<span class=\"n\">dsimp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CategoryStruct</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">special2cellCatStruct</span><span class=\"o\">]</span>\n\n<span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">ParametricCategory</span><span class=\"bp\">.</span><span class=\"n\">comp_id</span><span class=\"w\"> </span><span class=\"n\">f</span>\n\n<span class=\"n\">assoc</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span>\n\n<span class=\"n\">dsimp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CategoryStruct</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">special2cellCatStruct</span><span class=\"o\">]</span>\n\n<span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">congr_arg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"n\">rec</span>\n\n<span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x_1</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"bp\">‚ñ°</span><span class=\"o\">(</span><span class=\"n\">x_1</span><span class=\"o\">,</span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">;</span><span class=\"n\">W</span><span class=\"o\">,</span><span class=\"n\">Z</span><span class=\"o\">))</span>\n\n<span class=\"n\">z</span>\n\n<span class=\"o\">(</span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">special2cellCatStruct</span><span class=\"bp\">._</span><span class=\"n\">proof_1</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚ñ°</span><span class=\"o\">(</span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">;</span><span class=\"n\">W</span><span class=\"o\">,</span><span class=\"n\">Z</span><span class=\"o\">))))</span>\n\n<span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">congr_arg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"n\">rec</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x_1</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"bp\">‚ñ°</span><span class=\"o\">(</span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"n\">x_1</span><span class=\"bp\">;</span><span class=\"n\">W</span><span class=\"o\">,</span><span class=\"n\">Z</span><span class=\"o\">))</span>\n\n<span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">special2cellCatStruct</span><span class=\"bp\">._</span><span class=\"n\">proof_1</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚ñ°</span><span class=\"o\">(</span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">;</span><span class=\"n\">W</span><span class=\"o\">,</span><span class=\"n\">Z</span><span class=\"o\">))))</span>\n\n<span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">eq_of_heq</span>\n\n<span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">HEq</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">))</span>\n\n<span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">grind</span><span class=\"w\"> </span><span class=\"o\">}</span>\n\n<span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">HEq</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">)))</span>\n\n<span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">grind</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ParametricCategory</span><span class=\"bp\">.</span><span class=\"n\">assoc</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">}</span>\n\n<span class=\"n\">grind</span>\n\n<span class=\"o\">}</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">DoubleCategoryStruct</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">uob</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">uv</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">uh</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">u2</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">uob</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">uv</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span>\n\n<span class=\"o\">(</span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">uh</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ParametricQuiver</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"o\">]</span>\n\n<span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">ParametricCategory</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">uob</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">uv</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">uob</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">uv</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">uh</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">u2</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n\n<span class=\"sd\">/-- Horizontal identity object: for each vertical object c, we have an identity object -/</span>\n\n<span class=\"n\">horiz_id</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">c</span>\n\n<span class=\"sd\">/-- Horizontal composition of objects -/</span>\n\n<span class=\"n\">horiz_comp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"w\"> </span><span class=\"n\">c''</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"w\"> </span><span class=\"n\">c''</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">c''</span>\n\n<span class=\"sd\">/-- Horizontal identity 2-cell: for each vertical morphism, we have an identity 2-cell -/</span>\n\n<span class=\"n\">horiz_id_2cell</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">ParametricQuiver</span><span class=\"bp\">.</span><span class=\"n\">two_cells</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">horiz_id</span><span class=\"w\"> </span><span class=\"n\">horiz_id</span>\n\n<span class=\"sd\">/-- Horizontal composition of 2-cells: compose 2-cells with the same left and right sides -/</span>\n\n<span class=\"n\">horiz_comp_2cell</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"w\"> </span><span class=\"n\">c''</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">d'</span><span class=\"w\"> </span><span class=\"n\">d''</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">}</span>\n\n<span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">d'</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f''</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c''</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">d''</span><span class=\"o\">}</span>\n\n<span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"w\"> </span><span class=\"n\">c''</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">d'</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Y'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">d'</span><span class=\"w\"> </span><span class=\"n\">d''</span><span class=\"o\">},</span>\n\n<span class=\"n\">ParametricQuiver</span><span class=\"bp\">.</span><span class=\"n\">two_cells</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">f'</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">X'</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">ParametricQuiver</span><span class=\"bp\">.</span><span class=\"n\">two_cells</span><span class=\"w\"> </span><span class=\"n\">f'</span><span class=\"w\"> </span><span class=\"n\">f''</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">Y'</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span>\n\n<span class=\"n\">ParametricQuiver</span><span class=\"bp\">.</span><span class=\"n\">two_cells</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">f''</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">horiz_comp</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">horiz_comp</span><span class=\"w\"> </span><span class=\"n\">X'</span><span class=\"w\"> </span><span class=\"n\">Y'</span><span class=\"o\">)</span>\n\n<span class=\"sd\">/-- Horizontal composition of identity 2-cells is the identity 2-cell on the composite -/</span>\n\n<span class=\"n\">horiz_comp_id</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">c‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÅ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÇ</span><span class=\"o\">),</span>\n\n<span class=\"n\">horiz_comp_2cell</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n\n<span class=\"n\">id</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">horiz_comp</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)</span>\n\n<span class=\"sd\">/-- Interchange law: horizontal composition respects vertical composition -/</span>\n\n<span class=\"n\">interchange</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">c‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">d‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">d‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">d‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">e‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">e‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">e‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">}</span>\n\n<span class=\"o\">{</span><span class=\"n\">f‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÄ</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">d‚ÇÄ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">d‚ÇÄ</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">e‚ÇÄ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">g‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÅ</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">d‚ÇÅ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">g‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">d‚ÇÅ</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">e‚ÇÅ</span><span class=\"o\">}</span>\n\n<span class=\"o\">{</span><span class=\"n\">h‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÇ</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">d‚ÇÇ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">h‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">d‚ÇÇ</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">e‚ÇÇ</span><span class=\"o\">}</span>\n\n<span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÅ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">c‚ÇÇ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">d‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">d‚ÇÅ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Y'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">d‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">d‚ÇÇ</span><span class=\"o\">}</span>\n\n<span class=\"o\">{</span><span class=\"n\">X''</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">e‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">e‚ÇÅ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Y''</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">e‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">e‚ÇÇ</span><span class=\"o\">}</span>\n\n<span class=\"o\">(</span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ParametricQuiver</span><span class=\"bp\">.</span><span class=\"n\">two_cells</span><span class=\"w\"> </span><span class=\"n\">f‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">g‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">X'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ≤</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ParametricQuiver</span><span class=\"bp\">.</span><span class=\"n\">two_cells</span><span class=\"w\"> </span><span class=\"n\">g‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">h‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">Y'</span><span class=\"o\">)</span>\n\n<span class=\"o\">(</span><span class=\"n\">Œ≥</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ParametricQuiver</span><span class=\"bp\">.</span><span class=\"n\">two_cells</span><span class=\"w\"> </span><span class=\"n\">f‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">g‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">X'</span><span class=\"w\"> </span><span class=\"n\">X''</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ¥</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ParametricQuiver</span><span class=\"bp\">.</span><span class=\"n\">two_cells</span><span class=\"w\"> </span><span class=\"n\">g‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">h‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">Y'</span><span class=\"w\"> </span><span class=\"n\">Y''</span><span class=\"o\">),</span>\n\n<span class=\"n\">horiz_comp_2cell</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"n\">Œ≥</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"w\"> </span><span class=\"n\">Œ¥</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n\n<span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">horiz_comp_2cell</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">horiz_comp_2cell</span><span class=\"w\"> </span><span class=\"n\">Œ≥</span><span class=\"w\"> </span><span class=\"n\">Œ¥</span><span class=\"o\">)</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">ParametricCategory</span>\n</code></pre></div>\n<p>In natural language, my idea is to start with a category of objects and horizontal arrows. (For example, the category of rings and ring homomorphisms.) we then introduce a notion of \"parametric category\", which is essentially a span in the category of categories but presented in a displayed style. (For example, the category of triples (R,S, M) where M is an (R,S)-bimodule, and morphisms (phi, psi, f) where phi, psi are ring homomorphisms and f is a (phi,psi)-equivariant map.)</p>\n<p>Then, we would want to add vertical composition (for example tensoring of modules). I think it is best to view this as a bicategory structure enriching the data we have so far. Then we have to add vertical composition of 2-cells, which I view as a kind of parametric bicategory structure which rides the existing bicategory structure on bimodules.</p>",
        "id": 564828511,
        "sender_full_name": "Patrick Nicodemus",
        "timestamp": 1766237478
    },
    {
        "content": "<p>I will also invite guidance on what is the appropriate size of a pull request, say measured in 100s of lines of code.</p>",
        "id": 564828566,
        "sender_full_name": "Patrick Nicodemus",
        "timestamp": 1766237552
    },
    {
        "content": "<blockquote>\n<p>I started writing it down and I feel that it would be better to refactor the existing definition of bicategory to make it more modular.</p>\n</blockquote>\n<p>I am aware that there are performance problems from decomposing the typeclass structure hierarchy too finely, so I think sophisticated guidance on this point would be appreciated. I think that Coq's math-comp library has an interesting approach of controlled code duplication where many definitions are given in both a bundled and unbundled style.</p>",
        "id": 564828700,
        "sender_full_name": "Patrick Nicodemus",
        "timestamp": 1766237706
    },
    {
        "content": "<p>It seems indentation got lost in your copy-pasting in the backtick, this makes things hard to read.<br>\nYou mention refactoring bicategories: can you precise what you‚Äôd like to refactor?<br>\nRight now, the focus of category theory in mathlib favors way, <em>way</em> more the unbundled designs over the bundled ones (one of the reason being that it allows for more universe polymorphism).</p>",
        "id": 564830322,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1766239198
    },
    {
        "content": "<p>At a glance, it also seems you are fighting with casts in <code>ParametricCategory</code> and <code>ParametricCategoryStruct</code>: we usually try to avoid direct casts like the plague in mathlib category theory. When they are \"really needed\", we use <code>eqToHom</code> and <code>eqToIso</code> as wrapper around them.</p>",
        "id": 564831207,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1766239914
    },
    {
        "content": "<p>I really like mathlib's design to start with the weakest possible structure (bicategories) to have no problems with \"casting\" like this, and then specialize this weakest possible object to a \"strict version\" (2-categories in mathlib are not directly defined, and instead, we have <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CategoryTheory.Bicategory.Strict#doc\">docs#CategoryTheory.Bicategory.Strict</a> as a typleclass on a bicategory asserting that \"it‚Äôs a 2-category\"). In the case of 2-categories vs bicategories, the \"weak concept\" is rather common and well-known, but I‚Äôm much less aware of the \"fully weak\" version of double categories in the literature for ordinary categories, so I am not sure how viable is this option (it stills feels like the \"morally correct\" option IMO).</p>",
        "id": 564832502,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1766241155
    },
    {
        "content": "<p>The concept of bicategory is quite standard, and we already have significant code using this notion. Then, I am a little bit worried with your suggestion to \"refactor the existing definition of bicategory\".</p>",
        "id": 564832995,
        "sender_full_name": "Jo√´l Riou",
        "timestamp": 1766241607
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"459699\">Jo√´l Riou</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Proposal.3A.20Double.20categories.20in.20mathlib/near/564832995\">said</a>:</p>\n<blockquote>\n<p>The concept of bicategory is quite standard, and we already have significant code using this notion. Then, I am a little bit worried with your suggestion to \"refactor the existing definition of bicategory\".</p>\n</blockquote>\n<p>I didn't intend to suggest redefining the meaning of bicategory to have a different semantic meaning that conflicts with the standard textbook definition. What I mean is that the current typeclass hierarchy for bicategories is only two levels deep:</p>\n<ul>\n<li>level 1: CategoryStruct, which contains Ob, Hom, comp, id</li>\n<li>level 2: everything else</li>\n</ul>\n<p>There are various reasons you might want to decompose level 2 into multiple levels. For example,  if there is a natural diamond shape in the structure hierarchy A -&gt; B -&gt; D and A -&gt; C -&gt; D, then it would be ideal if B and C contain no overlap, otherwise in trying to define a D you have to say that the data contained in B and C is equivalent or identical, or else define B' which captures some, but not all, of the theory in B. </p>\n<p>The definitions of weak double category and bicategory contain substantial overlap, so there has to be some thought about how to organize this. I won't insist on modifying current code but in that case there will be a healthy amount of code duplication.</p>",
        "id": 564833965,
        "sender_full_name": "Patrick Nicodemus",
        "timestamp": 1766242507
    },
    {
        "content": "<blockquote>\n<p>Right now, the focus of category theory in mathlib favors way, <em>way</em> more the unbundled designs over the bundled ones (one of the reason being that it allows for more universe polymorphism).</p>\n</blockquote>\n<p>To clarify, I mean bundled/unbundled as a spectrum, not a binary. The current definition of a bicategory involves only two typeclasses, which I consider to be more toward the \"bunded\" side. If I had an arbitrary 2-graph and I could say \"now, furthermore, assume this 2-graph is equipped with a bicategory structure\", then that would be moving a bit more in the unbundled direction, but that appears to be not possible with the current design.</p>",
        "id": 564834144,
        "sender_full_name": "Patrick Nicodemus",
        "timestamp": 1766242739
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"286014\">Robin Carlier</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Proposal.3A.20Double.20categories.20in.20mathlib/near/564831207\">said</a>:</p>\n<blockquote>\n<p>At a glance, it also seems you are fighting with casts in <code>ParametricCategory</code> and <code>ParametricCategoryStruct</code>: we usually try to avoid direct casts like the plague in mathlib category theory. When they are \"really needed\", we use <code>eqToHom</code> and <code>eqToIso</code> as wrapper around them.</p>\n</blockquote>\n<p>I see where you are coming from from a broad perspective of starting with the weakest possible structure and specializing to a strict one, and I can understand that perspective.<br>\nDominic Verity has discussed a concept of \"doubly weak double category\" which is weak in both directions, I can't say I'm really familiar with this notion or have seen it used in the literature, or am familiar with many examples of it. It's possible that this would just be inflating the complexity of the formalization effort by introducing unnecessary generality.<br>\n<a href=\"https://ncatlab.org/nlab/show/double+category#double_bicategories\">https://ncatlab.org/nlab/show/double+category#double_bicategories</a></p>\n<p>Conceptually, I suppose we can think of casts as just transport in an isofibration over a thin groupoid; as a practical matter, code written for Prop cannot directly translate to code for Type, and so literally proving things for an isofibration would be generalizeable in ways that code in Prop cannot. But in this case I personally have no interest in the extra generality given by doubly weak bicategories, maybe somebody else will come along with interesting applications of these structures and why they deserve to be included in Mathlib.</p>",
        "id": 564834830,
        "sender_full_name": "Patrick Nicodemus",
        "timestamp": 1766243463
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"286014\">Robin Carlier</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Proposal.3A.20Double.20categories.20in.20mathlib/near/564830322\">said</a>:</p>\n<blockquote>\n<p>It seems indentation got lost in your copy-pasting in the backtick, this makes things hard to read.</p>\n</blockquote>\n<p>Yes, thank you. I will upload the file independently later.</p>",
        "id": 564835102,
        "sender_full_name": "Patrick Nicodemus",
        "timestamp": 1766243731
    },
    {
        "content": "<p>(From a quick search, it seems Fairbanks and Shulman also worked on variants of double categories where everything is weak: <a href=\"https://arxiv.org/pdf/2506.23651\">https://arxiv.org/pdf/2506.23651</a>. Proposition 7.22 claims to give a finite description of what something \"weak in both direction\" should be.<br>\nI do agree that this is not a notion that one encounters a lot in the literature (at least in \"lower-dimensional\" category theory like this; I‚Äôve seen a few times double ‚àû-categories (which must be fully weak everywhere) show up in the ‚àû-categorical literature, but mathlib is definitely not ready for this yet).</p>",
        "id": 564837426,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1766246132
    },
    {
        "content": "<p>To be a bit more precise about the refactoring of bicategories, if we consider the double category of rings, ring homomorphisms and bimodules, there are two bicategories involved here:</p>\n<ul>\n<li>a bicategory of rings, and bimodules between rings, with composition given by the tensor product</li>\n<li>a bicategory whose objects are ring homomorphisms (f_R : R1 -&gt; R2), whose 1-cells are pairs of bimodules (M an (R1, S1)-bimodule, N an (R2, S2)-bimodule) together with an (f_R, g_R)-equivariant homomorphism M -&gt; N;  a 2-cell (M, N, phi: M -&gt; N) =&gt; (M', N', psi) would be a pair of ring homomorphisms s: M -&gt; M' and t :N-&gt; N' such that  t\\circ phi = psi \\circ s</li>\n</ul>\n<p>The coherence laws for a weak double category are largely subsumed by requiring that both of these are bicategories and the <code>src</code> and <code>target</code> projections are strict functors preserving all the bicategory structure on the nose. That is why I want to talk about \"a bicategory structure on the given data\"; the existing definition of bicategory seems too bundled to facilitate this.</p>",
        "id": 564842485,
        "sender_full_name": "Patrick Nicodemus",
        "timestamp": 1766251492
    },
    {
        "content": "<p>I reached out to Mike Shulman about his paper and asked him if he had any comments about what a good general definition is.</p>\n<blockquote>\n<p>Good question! My instinct would be that the best definition of weak double category to use in a proof assistant would be what Aaron and I called a \"tidy double bicategory\" -- Verity's definition plus a \"saturation\" axiom to ensure the bigons are determined by the squares.<br>\nIn addition to being finitary, which is an advantage for formalization, this has the advantage that the horizontal and vertical bicategories are explicitly part of the structure. Thus, for instance, if you build a weak double category of quintets from a bicategory, then the horizontal and vertical bicategories of that double category could be <em>definitionally</em> equal to the bicategory you started from.</p>\n</blockquote>",
        "id": 564895335,
        "sender_full_name": "Patrick Nicodemus",
        "timestamp": 1766324615
    },
    {
        "content": "<p>So it seems from this that the definition would indeed have to go first from Verity's double bicategories, and then specialize from there on. This is probably a rather big project.</p>",
        "id": 564896024,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1766325675
    },
    {
        "content": "<blockquote>\n<p>It seems indentation got lost in your copy-pasting in the backtick, this makes things hard to read.</p>\n</blockquote>\n<p>PSA: when posting a large amount of code, I've noticed that Zulip sometimes adds extra newlines in between each line. One can fix this by hitting ctrl-Z (\"undo\") after the pasting (which, counterintuitively, doesn't delete it; it just deletes all the extra incorrect formatting). It's a bit like when you copy and paste a declaration name from the mathlib docs; at the paste the URL is sometimes pasted too, but you can remove it with ctrl-Z. </p>\n<p>tl;dr <span class=\"user-mention\" data-user-id=\"460251\">@Patrick Nicodemus</span> try editing your original post, copy the lean code as before from VS Code or whatever, paste it, and then if there are still blank lines on every second line, hit Ctrl-Z (or Command-Z on a mac) and see if this fixes it.</p>",
        "id": 564907922,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1766341138
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Proposal.3A.20Double.20categories.20in.20mathlib/near/564907922\">said</a>:</p>\n<blockquote>\n<p>when posting a large amount of code, I've noticed that Zulip sometimes adds extra newlines in between each line</p>\n</blockquote>\n<p>It's not about the amount. It's about whether you are pasting it in a code block</p>",
        "id": 564907964,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1766341195
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"286014\">@Robin Carlier</span>  I thought about this a little more and I wanted to explain where some of the casts come from. My design involves something that is very similar to that of a displayed category. If you think about how a displayed category works, if the base category is a normal category then the associativity of composition in the total category is only well-typed by casting along the associativity in the base category, and same with left and right identities. There are various ways to get around this - using heterogeneous equality or an equality between morphisms in the total space that \"rides\" a morphism in the base space - but all of them seem kind of equivalent to me.<br>\nOne could pass to a 2-categorical version of displayed categories but that seems to just shift the problem up one degree.</p>\n<p>Does this make sense? Do you think casting is justified from the perspective of \"this is essentially a displayed category and these casts are coming from the need for associativity in the total category to be well-formed\"?</p>",
        "id": 567826525,
        "sender_full_name": "Patrick Nicodemus",
        "timestamp": 1768326554
    },
    {
        "content": "<p>I understand why casts appears in this situation, though I do not know a lot about displayed categories.<br>\nTo repeat why I am slightly wary of casts here: they make definitions possible but my experience is that more often than not, they do not make working with the definition pleasant at all. It works at first, but it hardly scales.</p>\n<p>To make composition well-formed while hiding away the casts, a trick that has been used in Mathlib is to carry around equality proof as parameters to control the return type of compositions. for instance, you field <code>comp</code> would look like this</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- ...</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- Composition of morphisms over composition of base morphisms -/</span>\n<span class=\"w\">  </span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"w\"> </span><span class=\"n\">c''</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">d'</span><span class=\"w\"> </span><span class=\"n\">d''</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">c''</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">d'</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">g'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">d'</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">d''</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">f''</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">c''</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">g''</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">d''</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\">‚ÄØ</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">f'</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f''</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">g'</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">g''</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"w\"> </span><span class=\"n\">d'</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HHom</span><span class=\"w\"> </span><span class=\"n\">c''</span><span class=\"w\"> </span><span class=\"n\">d''</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"bp\">‚ñ°</span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"o\">,</span><span class=\"n\">g</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"bp\">‚ñ°</span><span class=\"o\">(</span><span class=\"n\">f'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">g'</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"bp\">‚ñ°</span><span class=\"o\">(</span><span class=\"n\">f''</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">g''</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Similarly, the identity field could depend on a pair of morphisms that are equal to the identities.</p>\n<p>This pattern has been used in mathlib for working with pseudofunctors out of strict (e.g locally discrete) bicategories and works quite well for this.</p>",
        "id": 567920996,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1768377606
    },
    {
        "content": "<p>Also, I didn‚Äôt do it in the snippet above, but one nice thing about adding these equality params is that you can add autoparameters for them (<code>grind</code>, <code>cat_disch</code>, ...) so that they are discharged automatically. This way you can write most morphisms as you wold normally without having to feed it <code>Category.id_comp</code>, <code>Category.assoc</code> etc. manually all the time</p>",
        "id": 567922649,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1768378253
    }
]