[
    {
        "content": "<p>The latest version of Mathlib seems to have introduced an unfortunate phenomenon: there are now two instances <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.instLE#doc\">docs#List.instLE</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.LE%27#doc\">docs#List.LE'</a>, and they're not def-eq:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">Lex</span>\n\n<span class=\"c\">/-</span>\n<span class=\"cm\">type mismatch</span>\n<span class=\"cm\">  List.cons_le_cons_iff</span>\n<span class=\"cm\">has type</span>\n<span class=\"cm\">  @LE.le (List ?m.48) List.instLE (?m.55 :: ?m.57) (?m.56 :: ?m.58) ↔</span>\n<span class=\"cm\">    ?m.55 &lt; ?m.56 ∨ ?m.55 = ?m.56 ∧ ?m.57 ≤ ?m.58 : Prop</span>\n<span class=\"cm\">but is expected to have type</span>\n<span class=\"cm\">  @LE.le (List ℕ) List.LE' (a :: l) (b :: m) ↔ a &lt; b ∨ a = b ∧ l ≤ m : Prop</span>\n<span class=\"cm\">-/</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">cons_le_cons_iff</span>\n</code></pre></div>",
        "id": 497241115,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1738486583
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span></p>",
        "id": 497241232,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1738486695
    },
    {
        "content": "<p>I think the fix is to set the correct def-eq in <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.instLinearOrder#doc\">docs#List.instLinearOrder</a>, and remove the <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.LE%27#doc\">docs#List.LE'</a> override (along with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.LT%27#doc\">docs#List.LT'</a> while we're at it, though that's not problematic since both instances are def-eq)</p>",
        "id": 497242041,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1738487522
    },
    {
        "content": "<p>Although, I think a better fix might be not to define <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.le#doc\">docs#List.le</a> to begin with. It doesn't mean what you'd expect when the list type isn't linearly ordered, and when it is, we should probably go through the linear order instance instead.</p>",
        "id": 497242373,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1738487844
    },
    {
        "content": "<p>(While we're at it, something I find unfortunate with the new <code>List.Lex</code> file is that it uses the <code>Std</code> relation classes instead of those defined in Mathlib. Unifying these would be a worthwhile endeavor.)</p>",
        "id": 497242629,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1738488106
    },
    {
        "content": "<p>I've opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/21339\">#21339</a> which provides a quick and dirty fix</p>",
        "id": 497244073,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1738489583
    },
    {
        "content": "<p>I don't think we should touch the  override instance in mathlib; rather, we should ensure any downstream instances are compatible with the override.</p>",
        "id": 497253847,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1738498794
    },
    {
        "content": "<p>Keeping the override makes any of the new <code>List.le</code> theorems in code unusable in Mathlib.</p>",
        "id": 497288956,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1738528683
    },
    {
        "content": "<p>I think that's fine, don't we have all those theorems for List.Lex anyway?</p>",
        "id": 497290238,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1738529883
    },
    {
        "content": "<p>I think we upstreamed a lot of them to core. In fact, I updated my personal project to v4.16 precisely to be able to use these theorems (and ended up not being able to...)</p>",
        "id": 497290502,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1738530103
    },
    {
        "content": "<p>For instance I can't find Mathlib variants of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.nil_le#doc\">docs#List.nil_le</a> or <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.cons_le_cons_iff#doc\">docs#List.cons_le_cons_iff</a></p>",
        "id": 497290576,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1738530157
    },
    {
        "content": "<p>I'd like Kim to comment on this, I think they're the one who added <code>List.le</code> in the latest release.</p>",
        "id": 497294546,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1738533168
    }
]