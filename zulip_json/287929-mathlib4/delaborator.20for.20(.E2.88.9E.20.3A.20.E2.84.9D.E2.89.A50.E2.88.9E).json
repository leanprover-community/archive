[
    {
        "content": "<p>I've just noticed that even after <code>open ENNReal</code>, <code>∞ : ℝ≥0∞</code> gets prettyprinted as <code>⊤</code>. This might confuse the poor authors of Annals papers who I am spamming with Lean code claiming to state their theorems. Is there some one-liner which can fix this, or are things not so simple? </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">ENNReal</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∞</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"bp\">≥</span><span class=\"mi\">0</span><span class=\"bp\">∞</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- ⊤ : ℝ≥0∞</span>\n</code></pre></div>\n<p>I think one fix might be changing this line in mathlib</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- Notation for infinity as an `ENNReal` number. -/</span>\n<span class=\"kn\">scoped</span><span class=\"o\">[</span><span class=\"n\">ENNReal</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"∞\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">⊤</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ENNReal</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>to </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- Notation for infinity as an `ENNReal` number. -/</span>\n<span class=\"kn\">scoped</span><span class=\"o\">[</span><span class=\"n\">ENNReal</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">notation3</span><span class=\"w\"> </span><span class=\"s2\">\"∞\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">⊤</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ENNReal</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>but does this have unintended consequences?</p>",
        "id": 572135384,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1770294765
    },
    {
        "content": "<p>In fact I am totally confused -- just above this we have</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">scoped</span><span class=\"o\">[</span><span class=\"n\">ENNReal</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"ℝ≥0∞\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">ENNReal</span>\n</code></pre></div>\n<p>but this isn't notation3 and yet the notation sticks. Is it because one is a type and one a term?</p>",
        "id": 572136023,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1770294958
    },
    {
        "content": "<p><code>notation3</code> shouldn't have any unwanted consequences for such simple elab/delab pairs</p>",
        "id": 572136437,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1770295068
    },
    {
        "content": "<p>The delaborator that <code>notation</code> creates does roughly this: whenever it sees the syntax on the RHS (here <code>(⊤ : ENNReal)</code>), it will replace it with the notation you declared (here <code>∞</code>). Note that this is an operation on <em>syntax</em>. If you write something on the RHS that elaborates to the same expression, but write it differently than how it is printed, then the delaborator will not fire. So the following notation commands all create delaborators that never(?) fire:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"ℝ≥0∞\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">ENNReal</span>\n\n<span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"∞\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">Top</span><span class=\"bp\">.</span><span class=\"n\">top</span><span class=\"w\"> </span><span class=\"n\">ENNReal</span><span class=\"w\"> </span><span class=\"n\">instTopENNReal</span>\n<span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"∞\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Top</span><span class=\"bp\">.</span><span class=\"n\">top</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ENNReal</span><span class=\"o\">)</span>\n<span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"∞\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">⊤</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ENNReal</span><span class=\"o\">)</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">ENNReal</span><span class=\"w\"> </span><span class=\"c1\">-- ENNReal : Type</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">⊤</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"bp\">≥</span><span class=\"mi\">0</span><span class=\"bp\">∞</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- ⊤ : ℝ≥0∞</span>\n</code></pre></div>",
        "id": 572151492,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1770298886
    },
    {
        "content": "<p>IMO <code>⊤</code> is the symbol for the term whereäs <code>∞</code> is the symbol for the type [modifier]. I wouldn't use <code>∞</code> for both.</p>",
        "id": 572176113,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1770304484
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"417654\">Martin Dvořák</span> <a href=\"#narrow/channel/287929-mathlib4/topic/delaborator.20for.20.28.E2.88.9E.20.3A.20.E2.84.9D.E2.89.A50.E2.88.9E.29/near/572176113\">said</a>:</p>\n<blockquote>\n<p>IMO <code>⊤</code> is the symbol for the term whereäs <code>∞</code> is the symbol for the type [modifier]. I wouldn't use <code>∞</code> for both.</p>\n</blockquote>\n<p>I think you may be technically right, but I've never cared about this distinction in practice. If <code>∞</code> notation makes your code more approachable to Kevin's specialized audience, I wouldn't object.</p>",
        "id": 572178023,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1770304933
    },
    {
        "content": "<p>I understand the claim about the audience but consider that <code>ℝ≥0∞</code> is not the only type with infinities.<br>\nThere is also <code>ℝ∞</code> and writing <code>(∞ : ℝ∞)</code> doesn't make sense.<br>\nTherefore, for consistency, I would avoid <code>(∞ : ℝ≥0∞)</code> as well.</p>",
        "id": 572178930,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1770305140
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span>, I don't understand the point your code sample above is making; do you have an example where <code>notation</code> <em>does</em> work for delaborating as <code>∞</code>?</p>",
        "id": 572179257,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1770305220
    },
    {
        "content": "<p>I'm pretty sure no delaborators can inspect the original syntax in a <code>#check</code> to decide how to delaborate</p>",
        "id": 572179437,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1770305262
    },
    {
        "content": "<p>It's very clear what <code>(∞ : ℝ∞)</code> should mean --- so we could add notation for it if desired.</p>",
        "id": 572179587,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1770305301
    },
    {
        "content": "<p>Yeah but then <code>(-∞ : ℝ∞)</code> shoots you in the face.</p>",
        "id": 572182578,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1770305910
    },
    {
        "content": "<p>Indeed, \\top and \\bot being treated differently is unfortunate. I'm open to redefining <code>EReal</code> as <code>WithTopBot Real</code>.</p>",
        "id": 572183874,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1770306191
    },
    {
        "content": "<p><a class=\"stream-topic\" data-stream-id=\"113488\" href=\"/#narrow/channel/113488-general/topic/WithBot.20.28WithTop.20.CE.B1.29/with/571188153\">#general &gt; WithBot (WithTop α)</a></p>",
        "id": 572184348,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1770306286
    },
    {
        "content": "<p>Naming question: If we make <code>∞</code> delaborate for <code>ℝ≥0∞</code>, do we continue naming <code>ENNReal</code> lemmas with <code>top</code> or do we use <code>infty</code>?</p>",
        "id": 572185029,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1770306441
    },
    {
        "content": "<p>Could we go back to Kevin's question? <code>∞</code>is already notation for infinity in ENNReal, and is already used everywhere in the code (although we use <code>top</code> in names). It's just not used by the infoview. I'd also like that to change (it would allow me to copy an paste without having to change it everywhere). Is using <code>notation3</code> the right solution?</p>",
        "id": 572185251,
        "sender_full_name": "Rémy Degenne",
        "timestamp": 1770306495
    },
    {
        "content": "<p>so <code>notation3</code> creates an actual delaborator whereas <code>notation</code> creates a (reverse?) macro?</p>",
        "id": 572185818,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1770306610
    },
    {
        "content": "<p><code>notation</code> also creates a delaborator. It's just not a very good one</p>",
        "id": 572186042,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1770306651
    },
    {
        "content": "<p>There is always time to fix our historical mistakes. And deprecating <code>∞</code> as the name of the term (constant) would be far less disruptive than changing definitions.</p>",
        "id": 572186189,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1770306678
    },
    {
        "content": "<p>But Floris mentioned it creates an operation on <em>syntax</em>, whereas a delaborator should be <code>Expr → Syntax</code>?</p>",
        "id": 572186436,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1770306732
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"417654\">Martin Dvořák</span> <a href=\"#narrow/channel/287929-mathlib4/topic/delaborator.20for.20.28.E2.88.9E.20.3A.20.E2.84.9D.E2.89.A50.E2.88.9E.29/near/572186189\">said</a>:</p>\n<blockquote>\n<p>There is always time to fix our historical mistakes. And deprecating <code>∞</code> as the name of the term (constant) would be far less disruptive than changing definitions.</p>\n</blockquote>\n<p>Who's talking about changing definitions? And I don't think deprecating <code>∞</code> is even on the table. Why would we want that?</p>",
        "id": 572186645,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1770306775
    },
    {
        "content": "<p>Because once writing <code>(∞ : ℝ∞)</code> becomes socially acceptable, it will be a slippery slope and <code>(-∞ : ℝ∞)</code> might start appearing in the code.</p>",
        "id": 572187012,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1770306841
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/delaborator.20for.20.28.E2.88.9E.20.3A.20.E2.84.9D.E2.89.A50.E2.88.9E.29/near/572179257\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"111080\">Floris van Doorn</span>, I don't understand the point your code sample above is making; do you have an example where <code>notation</code> <em>does</em> work for delaborating as <code>∞</code>?</p>\n</blockquote>\n<p>The point was to hopefully help Kevin understand why these delaborators don't help with pretty-printing (or at least, to tell him \"if you use these things in the RHS of your <code>notation</code> command, it will probably not fire for pretty-printing\").<br>\nI don't know know any way to tell <code>notation</code> to pretty-print <code>⊤</code> only for <code>ENNReal</code>, but not for any other types.<br>\nI agree that delaborators cannot look at the source syntax.</p>",
        "id": 572189975,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1770307388
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/287929-mathlib4/topic/delaborator.20for.20.28.E2.88.9E.20.3A.20.E2.84.9D.E2.89.A50.E2.88.9E.29/near/572186042\">said</a>:</p>\n<blockquote>\n<p><code>notation</code> also creates a delaborator. It's just not a very good one</p>\n</blockquote>\n<p>This is untrue; it creates an <em>unexpander</em>, as can be seen with</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">whatsnew</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"∞\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Top</span><span class=\"bp\">.</span><span class=\"n\">top</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ENNReal</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 572201478,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1770310106
    },
    {
        "content": "<p>And the unexpander is basically like writing a delaborator of the form</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">orig</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Syntax</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">delab</span>\n<span class=\"w\">  </span><span class=\"n\">run_the_unexpander</span><span class=\"w\"> </span><span class=\"n\">orig</span>\n</code></pre></div>",
        "id": 572201589,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1770310137
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"417654\">Martin Dvořák</span> <a href=\"#narrow/channel/287929-mathlib4/topic/delaborator.20for.20.28.E2.88.9E.20.3A.20.E2.84.9D.E2.89.A50.E2.88.9E.29/near/572182578\">said</a>:</p>\n<blockquote>\n<p>Yeah but then <code>(-∞ : ℝ∞)</code> shoots you in the face.</p>\n</blockquote>\n<p>We could make <code>\"-∞\"</code> a notation too.</p>",
        "id": 572210350,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1770312436
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/delaborator.20for.20.28.E2.88.9E.20.3A.20.E2.84.9D.E2.89.A50.E2.88.9E.29/near/572201478\">said</a>:</p>\n<blockquote>\n<p>This is untrue; it creates an <em>unexpander</em>, as can be seen with</p>\n</blockquote>\n<p>Oops, yes. I meant \"unexpander\" when I wrote \"delaborator\".</p>",
        "id": 572212794,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1770313136
    },
    {
        "content": "<p>Ah sure, yes</p>",
        "id": 572256288,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1770328843
    },
    {
        "content": "<p>I have no opinion about usage of <code>∞</code> for <code>ENNReal</code>. I mean, I can use this notation or <code>\\top</code>. However, it's very useful for smoothness, as we have <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>C</mi><mi>n</mi></msup></mrow><annotation encoding=\"application/x-tex\">C^n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span></span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>C</mi><mi mathvariant=\"normal\">∞</mi></msup></mrow><annotation encoding=\"application/x-tex\">C^\\infty</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">∞</span></span></span></span></span></span></span></span></span></span></span>, and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>C</mi><mi>ω</mi></msup></mrow><annotation encoding=\"application/x-tex\">C^\\omega</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">ω</span></span></span></span></span></span></span></span></span></span></span>, where <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">∞</mi></mrow><annotation encoding=\"application/x-tex\">\\infty</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord\">∞</span></span></span></span> is in fact <code>WithTop.some \\top</code> in <code>WithTop ENat</code>.</p>",
        "id": 572284958,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1770346285
    },
    {
        "content": "<p>Yes I totally agree that the smoothness use of infinity is useful (as well as being confusing and poorly-documented). I'm specifically talking about making mathlib output in L^p analysis easier to read for mathematicians (who typically have no idea what \\top is) and am asking whether changing to notation3 is desired.</p>",
        "id": 572318813,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1770366821
    },
    {
        "content": "<p>I think the answer is yes.</p>",
        "id": 572497282,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1770437478
    },
    {
        "content": "<p>stumbled across <a href=\"https://github.com/leanprover-community/mathlib4/pull/34953\">#34953</a>, is there any difference between using <code>notation3</code> and adding a small delaborator:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">scoped</span><span class=\"o\">[</span><span class=\"n\">ENNReal</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"∞\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">⊤</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ENNReal</span><span class=\"o\">)</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">ENNReal</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">PrettyPrinter</span><span class=\"bp\">.</span><span class=\"n\">Delaborator</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">PrettyPrinter</span><span class=\"bp\">.</span><span class=\"n\">Delaborator</span><span class=\"bp\">.</span><span class=\"n\">SubExpr</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"sd\">/-- Delaborate `(top : ENNReal)` as `∞`. -/</span>\n<span class=\"kd\">@[</span><span class=\"n\">app_delab</span><span class=\"w\"> </span><span class=\"n\">Top</span><span class=\"bp\">.</span><span class=\"n\">top</span><span class=\"kd\">]</span>\n<span class=\"n\">meta</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">delabInftyENNReal</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Delab</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">whenNotPPOption</span><span class=\"w\"> </span><span class=\"n\">getPPExplicit</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span>\n<span class=\"w\">  </span><span class=\"n\">whenPPOption</span><span class=\"w\"> </span><span class=\"n\">getPPNotation</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"n\">let_expr</span><span class=\"w\"> </span><span class=\"n\">Top</span><span class=\"bp\">.</span><span class=\"n\">top</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getExpr</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">failure</span>\n<span class=\"w\">    </span><span class=\"n\">guard</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"bp\">.</span><span class=\"n\">isConstOf</span><span class=\"w\"> </span><span class=\"ss\">``ENNReal</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"bp\">∞</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">annotateGoToSyntaxDef</span><span class=\"w\"> </span><span class=\"n\">stx</span>\n</code></pre></div>",
        "id": 573787748,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1771001657
    },
    {
        "content": "<p>These are mostly the same indeed. If they are exactly the same, I'd suggest using <code>notation3</code> for its simplicity, but if the <code>notation3</code> version is missing some feature, then a delaborator is the way to go indeed.</p>",
        "id": 573788490,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1771001898
    },
    {
        "content": "<p>Tbh I don't fully know if there are exactly the same, the implementation of <code>notation3</code> is quite lengthy with sprinkled <code>-- HACK</code> comments, but I think they might be identical for this.</p>\n<p>Thanks  for the quick answer!</p>",
        "id": 573792522,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1771003111
    },
    {
        "content": "<p>Why not use <code>whatsnew</code> to see what delaborator it generates?</p>",
        "id": 573793810,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771003377
    },
    {
        "content": "<p>I imagine that the <code>annotateGoToSyntaxDef</code> could give different behaviour - this would be easy to test.</p>",
        "id": 573797474,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1771004554
    },
    {
        "content": "<p>apparently <code>annotateGoToSyntaxDef</code> has the effect that shift-clicking in the infoview goes to the <code>notation</code>, while for <code>notation3</code> it goes to <code>deriving Top</code> in the <code>ENNReal</code> definition. But in the editor, both versions jump to <code>deriving Top</code>?</p>",
        "id": 573803703,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1771006698
    },
    {
        "content": "<p>What you see in the editor is not related to the delaborator, it is just related to the syntax/elaborator. That one is more tricky to influence.</p>",
        "id": 573812502,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1771009633
    }
]