[
    {
        "content": "<p>I've wanted this feature for a while, I know how to write it, basically I see a lot of cases where we want <code>[Ring R]</code> in one section of a file and then <code>[Field R]</code> in another section, but you can't delete the instance, so you either have to separate them into sections or just shadow the variables, both of which feel a bit undesirable</p>\n<p>Proposed syntax:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"o\">[</span><span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>",
        "id": 546996315,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761338156
    },
    {
        "content": "<p>This is roughly what <code>omit</code> is supposed to do. But it has other issues</p>",
        "id": 546996384,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1761338185
    },
    {
        "content": "<p><code>omit</code> doesn't really forget it iiuc</p>",
        "id": 546996428,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761338204
    },
    {
        "content": "<p>oh wait, it does? hmm i remember encountering some problems earlier</p>",
        "id": 546996547,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761338266
    },
    {
        "content": "<p>what are the other issues you're mentioning?</p>",
        "id": 546996565,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761338274
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/287929-mathlib4/topic/RFC.3A.20delete.20variables/near/546996428\">said</a>:</p>\n<blockquote>\n<p><code>omit</code> doesn't really forget it iiuc</p>\n</blockquote>\n<p>Yeah, hence the \"roughly\". In fact, see <a class=\"stream-topic\" data-stream-id=\"270676\" href=\"/#narrow/channel/270676-lean4/topic/omitting.20a.20type-class.20argument.20doesn.27t.20always.20work/with/546704682\">#lean4 &gt; omitting a type-class argument doesn't always work</a> which is pretty much what you describe.</p>\n<p>I think any \"delete variable\" feature you describe is what <code>omit</code> <em>ought</em> to be doing. Or, <code>omit</code> should be removed, with this <code>variable -...</code> syntax. But I think it's the same objective.</p>",
        "id": 546996913,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1761338468
    },
    {
        "content": "<p>well, i guess there's nothing i can do since it's in core lean <span aria-label=\"shrug\" class=\"emoji emoji-1f937\" role=\"img\" title=\"shrug\">:shrug:</span></p>",
        "id": 546997058,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761338551
    },
    {
        "content": "<p>I have a vague memory that <code>omit</code> was intended to be the negation of <code>include</code> and not of <code>variable</code>.</p>",
        "id": 546997214,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1761338645
    },
    {
        "content": "<p>yeah, exactly</p>",
        "id": 546997231,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761338655
    },
    {
        "content": "<p>So, I don't think that there is a way of <code>unvariable</code> a variable.</p>",
        "id": 546997306,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1761338696
    },
    {
        "content": "<p>or at least it hasn't been written yet (as I said, I know how to do it)</p>",
        "id": 546997362,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761338726
    },
    {
        "content": "<p>There was a thread a while ago started by David Loeffler about this, I think.  (I'm on mobile with limited search abilities.)</p>",
        "id": 546997379,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1761338734
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Command</span>\n\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"#print_vars\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"{(← getScope).varDecls}\"</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Command</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"bp\">#</span><span class=\"n\">print_vars</span><span class=\"w\"> </span><span class=\"c1\">-- \"R\", [Ring R]</span>\n\n<span class=\"n\">omit</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span>\n\n<span class=\"bp\">#</span><span class=\"n\">print_vars</span><span class=\"w\"> </span><span class=\"c1\">-- \"R\",[Ring R]</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span>\n\n<span class=\"bp\">#</span><span class=\"n\">print_vars</span><span class=\"w\"> </span><span class=\"c1\">-- \"R\",[Ring R], [Field R]</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 546997561,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761338826
    },
    {
        "content": "<p>this code shows that <code>omit</code> is not <code>unvariable</code></p>",
        "id": 546997587,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761338839
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/U4NqNqaEtEeXQHFrgoxj1U61/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/U4NqNqaEtEeXQHFrgoxj1U61/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1034x671\" src=\"/user_uploads/thumbnail/3121/U4NqNqaEtEeXQHFrgoxj1U61/image.png/840x560.webp\"></a></div>",
        "id": 546997697,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761338890
    },
    {
        "content": "<p>in fact the variables, included variables, and omitted variables are all stored separately (????)</p>",
        "id": 546997724,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761338904
    },
    {
        "content": "<p>This is by design. We want people to use <code>section</code>.</p>",
        "id": 547109517,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761462843
    },
    {
        "content": "<p>Note: this is <a href=\"https://github.com/leanprover/lean4/pull/5595\">lean#5595</a>. Consider upvote that issue.</p>",
        "id": 547254087,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1761564995
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span> <del>is there a way to see the most upvoted issues?</del> (edit: nvm found it)</p>",
        "id": 547258297,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761566277
    },
    {
        "content": "<p>I have to agree with Kim. I dread the PRs that would arise if we were able to carelessly add and remove variables every ten lines...</p>",
        "id": 547266475,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1761568801
    },
    {
        "content": "<p>There is a difference between what Lean should allow and what style Mathlib should adopt. I think <code>section</code> is much nicer for Mathlib, but annoying if you want to quickly add a lemma in your own project.</p>",
        "id": 547284247,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1761573690
    }
]