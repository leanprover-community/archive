[
    {
        "content": "<p>Hello! It's probably quite a stupid question, but I'm trying to understand how exactly to use aesop and what it's capabilities are. For example, since it claims to prove simple lemmas, I've been trying to rewrite my proof of \"if (for integer n) n mod7 = 2, then (n+2) mod7 = 4\", which is pretty much obvious for humans. The proof that I'm rewriting is:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Aesop</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">simple_lemma</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">ModEq</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">ModEq</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">   </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">modEq_iff_dvd</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">⊢</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">diff</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">ring</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">&lt;-</span><span class=\"n\">diff</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>\n<p>Simple \"by aesop\" didn't work and I'm not sure what rules to include and what the proper syntax would be (I've asked several ai chats, suggestions from which didn't help, and couldn't find a proper example). Would be grateful for any info on the subject, especially where to learn the proper way to use aesop<br>\nEdit: I've tried <code>declare_aesop_rule_sets [mathlib, norm_num, ring, rw, intros, apply] (default := true)</code>, using the syntax from github and ai suggestions, which also didn't help, <code>add_aesop_rules safe [(by rfl), (by intros), (by rw [Int.modEq_iff_dvd]), (by ring), (by norm_num)]</code> didn't help either (aesop: error in norm unfold: tactic 'simp' failed, nested error:<br>\nmaximum recursion depth has been reached<br>\nuse <code>set_option maxRecDepth &lt;num&gt;</code> to increase limit<br>\nuse <code>set_option diagnostics true</code> to get diagnostic information)</p>",
        "id": 501804281,
        "sender_full_name": "V S",
        "timestamp": 1740489591
    },
    {
        "content": "<p><del>Importing Aesop, as some chats suggested, didn't help either and I haven't seen it in any \"human\" examples, so not sure whether it's needed</del> I included import Aesop in my code since the github page includes it and also checked that the \"example : α → α := by aesop\" works<br>\nAnd to add to my initial question, can someone experienced in aesop tell me what the limits are? What exactly can one expect aesop to be able to prove, if the tactic is written in good fashion in code?</p>",
        "id": 501805394,
        "sender_full_name": "V S",
        "timestamp": 1740489895
    },
    {
        "content": "<p>(deleted @, since the question was answered) if possible, could I please hear some feedback from you on this issue? From what I've gathered, it seems like proving this lemma with aesop isn't possible due to maxRuleApplications issues when adding rules</p>",
        "id": 501820836,
        "sender_full_name": "V S",
        "timestamp": 1740493950
    },
    {
        "content": "<p>AI is nowhere near ready to help you on questions like this. It's fairly clear that this proof is out of scope for aesop (how would it ever know to prove an identity by <code>ring</code>, and then rewrite by it?). I would suggest looking at examples in Mathlib where it does work, and using <code>aesop?</code> to see the sorts of proofs it can generate, rather than just expecting it to prove anything.</p>",
        "id": 501960459,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740544677
    },
    {
        "content": "<p>Someone else can perhaps explain the scope of Aesop better, but the applications where I've found success with it are essentially those that can be solved through a combination of <code>simp_all</code> + <code>split</code>.</p>",
        "id": 501962148,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1740545633
    },
    {
        "content": "<p>So in some sense it can solve \"obvious\" goals, not in the mathematical sense of the word, but in a structural sense.</p>",
        "id": 501962217,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1740545670
    },
    {
        "content": "<p>Indeed the O in aesop stands for Obvious, iirc <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span></p>",
        "id": 501982507,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1740556681
    },
    {
        "content": "<blockquote>\n<p>What exactly can one expect aesop to be able to prove, if the tactic is written in good fashion in code?</p>\n</blockquote>\n<p>Prolog-like problems, since it's basically a prolog-style search for lemmas.</p>",
        "id": 501983475,
        "sender_full_name": "suhr",
        "timestamp": 1740557057
    },
    {
        "content": "<p>In other words, it solves problems that could be solved by repeatedly using <code>apply?</code>, <code>exact?</code> and case splits.</p>",
        "id": 501983828,
        "sender_full_name": "suhr",
        "timestamp": 1740557209
    },
    {
        "content": "<p>Thank you, everyone, for feedback and advice! I see now that my definition of \"obvious\" was wrong in this context. I admit, I was hoping that my solution was too complicated =&gt; there could be an easier solution that aesop would somehow find, but now, since I know what direction to follow, will do more research</p>",
        "id": 501997491,
        "sender_full_name": "V S",
        "timestamp": 1740561900
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"874708\">V S</span> has marked this topic as resolved.</p>",
        "id": 501997553,
        "sender_full_name": "Notification Bot",
        "timestamp": 1740561918
    },
    {
        "content": "<p>After the <code>rw</code>, you can let <code>omega</code> finish the proof for you.</p>",
        "id": 502001216,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1740562948
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.E2.9C.94.20Question.20about.20using.20aesop/near/502001216\">said</a>:</p>\n<blockquote>\n<p>After the <code>rw</code>, you can let <code>omega</code> finish the proof for you.</p>\n</blockquote>\n<p>Thank you! It seems like a very convenient tactic, especially for my needs</p>",
        "id": 502002683,
        "sender_full_name": "V S",
        "timestamp": 1740563361
    },
    {
        "content": "<p>For more info about Aesop, see the <a href=\"https://github.com/leanprover-community/aesop\">README</a>. <span class=\"user-mention\" data-user-id=\"394485\">@suhr</span>'s characterisation is essentially correct, though Aesop also runs <code>simp</code> and a few other tactics.</p>\n<p>In general, Aesop is not expected to do very much unless it's set up with appropriate rules (lemmas to apply, tactics to run). So if you have a proof that looks sufficiently obvious, you might think about whether Aesop's search algorithm (described in the README) could have found the proof if you had given it certain rules.</p>",
        "id": 502564793,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1740744990
    }
]