[
    {
        "content": "<p>I noticed that <a href=\"https://github.com/leanprover-community/mathlib4/pull/34393\">#34393</a> has a new label \"Mathlib/Geometry/Polygons\" which was apparently added by a bot. It seems we also have a \"Mathlib/CFT\" label with no PRs currently associated with it. What is the purpose of these labels, which seem very stylistically different from all the other labels we currently use, and what is the logic the bot uses to add them?</p>",
        "id": 569958509,
        "sender_full_name": "Joseph Myers",
        "timestamp": 1769351909
    },
    {
        "content": "<p>Mathlib/CFT sounds like a botched version of the CFT label</p>",
        "id": 569958635,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1769352035
    },
    {
        "content": "<p>This is a bug in the autolabelling bot:</p>\n<p><a href=\"/user_uploads/3121/jSnBdUXUVwSwvm7t3-EzmAA4/Screenshot-2026-01-25-at-23.59.20.png\">Screenshot 2026-01-25 at 23.59.20.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/jSnBdUXUVwSwvm7t3-EzmAA4/Screenshot-2026-01-25-at-23.59.20.png\" title=\"Screenshot 2026-01-25 at 23.59.20.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"2132x1312\" src=\"/user_uploads/thumbnail/3121/jSnBdUXUVwSwvm7t3-EzmAA4/Screenshot-2026-01-25-at-23.59.20.png/840x560.webp\"></a></div><p>Although not sure why it does this... I'm looking into it, maybe I can push a fix for this to <a href=\"https://github.com/leanprover-community/mathlib4/pull/34066\">#34066</a> before it gets reviewed</p>",
        "id": 569988520,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1769382079
    },
    {
        "content": "<p>Ah no, the autolabel script works as expected, it's the github action which fails. Particularly the line</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">label</span><span class=\"bp\">=</span><span class=\"s2\">\"$(printf '%s' \"</span><span class=\"bp\">$</span><span class=\"o\">{</span><span class=\"n\">labels</span><span class=\"o\">}</span><span class=\"s2\">\" | sed -n 's=.*#</span><span class=\"err\">\\</span><span class=\"s2\">[</span><span class=\"err\">\\</span><span class=\"s2\">([^,]*</span><span class=\"err\">\\</span><span class=\"s2\">)</span><span class=\"err\">\\</span><span class=\"s2\">].*=</span><span class=\"err\">\\</span><span class=\"s2\">1=p')\"</span>\n</code></pre></div>\n<p>(<a href=\"https://github.com/leanprover-community/mathlib4/blob/6eedf69860a9e6492114afe16728906c2afa1493/.github/workflows/add_label_from_diff.yaml#L43\">Link to source</a>) This got introduced in <a href=\"https://github.com/leanprover-community/mathlib4/pull/25641\">#25641</a> (<a href=\"https://github.com/leanprover-community/mathlib4/pull/25641/changes/e65c2d3ef65df8908420422ff17a7b3b46ebdf95#diff-67e0978ccb5c2a8b02f70f5e7f7047dc5c6af3375f98e493478eab485d8465a5R37\">link to commit</a>).</p>\n<p><span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> you probably know better what motivated this PR, could I leave it for you to fix?</p>",
        "id": 569990008,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1769383854
    },
    {
        "content": "<p>(I've deleted the bad labels now. Reproduction: when a PR adds a new folder outside any label, the autolabel script returns an empty array, but also a warning like \"the following paths are not covered by any label #[Mathlib/Geometry/Polygon]\". The linked <code>sed</code> then mistakenly parses this and thinks it should add <code>Mathlib/Geometry/Polygon</code> as a label.)</p>",
        "id": 569990190,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1769384088
    },
    {
        "content": "<p>This same <code>Polygon</code> label got added in <a href=\"https://github.com/leanprover-community/mathlib4/pull/34566\">#34566</a>, which has nothing to do with polygons.</p>",
        "id": 570762408,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1769683981
    },
    {
        "content": "<p>Ok, thanks for the reports and diagnostics!</p>",
        "id": 570765634,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1769684864
    },
    {
        "content": "<p>As far as I understand, there are two somewhat unrelated issues.</p>\n<ol>\n<li>\n<p>The new <code>Polygon</code> directory exposed a gap in the autolabel coverage and the script has been correctly picking this up.</p>\n<p>A fix for this, is to make autolabel apply the appropriate label to changes in this dir, which could happen with the revamp in <a href=\"https://github.com/leanprover-community/mathlib4/pull/34066\">#34066</a> or in a separate, much smaller PR.</p>\n</li>\n<li>\n<p>The mechanism that retrieves the output of <code>lake exe autolabel</code> and decides if a unique label is applicable mistakenly reads the \"gap in autolabel\" report as a label to be added and uses that to label PRs.</p>\n<p>I'll think about a fix for that and will produce a PR.</p>\n</li>\n</ol>",
        "id": 570766820,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1769685218
    },
    {
        "content": "<p>If I remember correctly, there had been a discussion of having the action post a message on Zulip when it noticed a gap in autolabels.  Maybe this is a good time to think about doing that as well.</p>",
        "id": 570767015,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1769685289
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/34568\">#34568</a> (the previous PR was entirely an arithmetic progression!)</p>",
        "id": 570771397,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1769686746
    },
    {
        "content": "<p>The PR above should restore the correct functionality of <code>autolabel</code>.  It does <em>not</em> address the fact that <code>Polygon</code> still produces warnings.</p>",
        "id": 570772217,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1769687058
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Mathlib.2F*.20labels/near/570766820\">said</a>:</p>\n<blockquote>\n<p>A fix for this, is to make autolabel apply the appropriate label to changes in this dir, which could happen with the revamp in <a href=\"https://github.com/leanprover-community/mathlib4/pull/34066\">#34066</a> or in a separate, much smaller PR.</p>\n</blockquote>\n<p>I think I'd prefer a follow-up PR which just adds the <code>Polygon</code> dir to the list. I can create that once <a href=\"https://github.com/leanprover-community/mathlib4/pull/34066\">#34066</a> lands. (or it can happen earlier, then I just need to make sure the refactor PR is updated correctly)</p>",
        "id": 570870692,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1769712148
    },
    {
        "content": "<p>(made a PR to add then new <code>Mathlib/Geometry/Polygon</code>: <a href=\"https://github.com/leanprover-community/mathlib4/pull/34677\">#34677</a>)</p>",
        "id": 571278759,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1769945059
    }
]