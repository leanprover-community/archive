[
    {
        "content": "<p>There's a TODO comment above the <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Real.sqrt#doc\">docs#Real.sqrt</a> notation, suggesting turning it into a typeclass. Has there been any progress on this?</p>",
        "id": 535570203,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1755806360
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Real.sqrt#src\">src#Real.sqrt</a></p>",
        "id": 535570982,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1755806733
    },
    {
        "content": "<p>What does this comment even mean? Edit: oh, the issue seems to be that the notation should be <code>HasSqrt.sqrt</code> so it works for NNReal etc.</p>",
        "id": 535574376,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1755808290
    },
    {
        "content": "<p>I imagine it means one of two things</p>\n<ul>\n<li>Make a typeclass for the notation</li>\n<li>Make a typeclass for types with a \"well-behaved\" square root operation</li>\n</ul>",
        "id": 535574550,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1755808378
    },
    {
        "content": "<p>I'm not sure what the second one would entail (and I don't really find it feasible), but the first one seems very uncontroversial</p>",
        "id": 535574590,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1755808395
    },
    {
        "content": "<p>Do we want to turn <code>Nat.sqrt</code> into a typeclass instance? I personally don't think that's a good idea, but I want to hear what other people's perspectives are</p>",
        "id": 535578373,
        "sender_full_name": "Niels Voss",
        "timestamp": 1755810211
    },
    {
        "content": "<p>I don't really see why not. It might look a bit weird to write stuff like <code>√5 = 2</code> but I'd argue this is no worse than what Nat substraction and division already allow.</p>",
        "id": 535578772,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1755810414
    },
    {
        "content": "<p>I guess that's fair. I'm just used to having sqrt automatically coerce Nat to Real</p>",
        "id": 535579279,
        "sender_full_name": "Niels Voss",
        "timestamp": 1755810691
    },
    {
        "content": "<p>Hmmm yeah, that's actually a really good point against this idea</p>",
        "id": 535579448,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1755810774
    },
    {
        "content": "<p>I recently defined a square root on a new type (<a href=\"https://github.com/vihdzp/combinatorial-games/pull/335\">CGT#335</a>) and came back to this. Surely it wouldn't be controversial to add this code somewhere?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/--</span>\n<span class=\"sd\">The notation typeclass for square roots.</span>\n<span class=\"sd\">This enables the notation `√a : α` where `a : α`.</span>\n<span class=\"sd\">-/</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Sqrt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- `√a` computes the square root of `a`.</span>\n<span class=\"sd\">  The meaning of this notation is type-dependent. -/</span>\n<span class=\"w\">  </span><span class=\"n\">sqrt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">inherit_doc</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">prefix</span><span class=\"o\">:</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"s2\">\"√\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Sqrt</span><span class=\"bp\">.</span><span class=\"n\">sqrt</span>\n\n<span class=\"kn\">macro_rules</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"bp\">√</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">unop</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">Sqrt</span><span class=\"bp\">.</span><span class=\"n\">sqrt</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">x</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 571489166,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1770053405
    },
    {
        "content": "<p>(The question of course is, does this go in core, or in some basic file in Mathlib?)</p>",
        "id": 571489227,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1770053425
    },
    {
        "content": "<p>It feels more Mathlib to me</p>",
        "id": 571489857,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1770053617
    },
    {
        "content": "<p>What would be a good file for it?</p>",
        "id": 571490769,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1770053902
    },
    {
        "content": "<p>I don't want to put it in the same file as <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Real.sqrt#doc\">docs#Real.sqrt</a> because that would dramatically raise the imports to use this notation</p>",
        "id": 571490847,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1770053929
    },
    {
        "content": "<p>I think that I wrote this comment some time ago, but some of use cases I thought about (e.g., <code>Nat.sqrt</code>) were later dismissed, because it isn't clear whether the floor one or the ceiling one should be given by the notation.</p>",
        "id": 571491763,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1770054216
    },
    {
        "content": "<p>Also, note that a notation class makes all expressions heavier. If we aren't going to have any generic theory, then I'm not sure that we should have a notation class.</p>",
        "id": 571491891,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1770054257
    },
    {
        "content": "<p>Another option is to have an overloaded notation.</p>",
        "id": 571491985,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1770054294
    },
    {
        "content": "<p>Truthfully I just wanted to get the elaborator for free. If there's an actual cost to introducing this notation typeclass then we probably shouldn't.</p>",
        "id": 571492244,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1770054369
    },
    {
        "content": "<p>It turns every <code>Real.sqrt</code> into <code>@Sqrt.sqrt Real instRealSqrt</code>, same for other use cases.</p>",
        "id": 571492611,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1770054487
    },
    {
        "content": "<p>If it were a notation typeclass we could use it for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CFC.sqrt#doc\">docs#CFC.sqrt</a></p>",
        "id": 571492800,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1770054553
    },
    {
        "content": "<p>We could also use it for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Ideal.radical#doc\">docs#Ideal.radical</a>, though I'm not sure we would want to.</p>",
        "id": 571492853,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1770054569
    },
    {
        "content": "<p>And of course there's my motivating example <a href=\"https://vihdzp.github.io/combinatorial-games/find/?pattern=Nimber.sqrt#doc\">CGT#Nimber.sqrt</a> (not yet merged)</p>",
        "id": 571492923,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1770054594
    },
    {
        "content": "<p>Will an overloaded notation work for all these cases?</p>",
        "id": 571503382,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1770058186
    },
    {
        "content": "<p>I think it makes sense that we'd like to talk about <code>CFC.sqrt</code> and <code>Real.sqrt</code> simultaneously. For the other examples I don't believe there's any possible confusion.</p>",
        "id": 571503523,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1770058245
    },
    {
        "content": "<p>Ah yes, is there an instance of whatever is needed for <code>CFC.sqrt</code> for <code>Real</code>?</p>",
        "id": 571503647,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1770058303
    },
    {
        "content": "<p>If yes, then adding a notation typeclass will lead to a non-defeq diamond for <code>Real</code>, and we don't want that.</p>",
        "id": 571503689,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1770058323
    },
    {
        "content": "<p>Yury, the answer is <em>currently</em> no, but it will be yes when we eventually get real C*-algebras. I'll note though that we already have a non-defeq diamond somewhere for real powers.</p>",
        "id": 571556709,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1770083007
    },
    {
        "content": "<p>Where?</p>",
        "id": 571559084,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1770085099
    },
    {
        "content": "<p>Do you mean <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CFC.instPowReal#doc\">docs#CFC.instPowReal</a> ?</p>",
        "id": 571559216,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1770085234
    },
    {
        "content": "<p>(assuming that <code>Real</code> satisfies assumptions on <code>A</code>)</p>",
        "id": 571559262,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1770085279
    },
    {
        "content": "<p>Ah, maybe we don't have a diamond yet. I thought Mathlib had a <code>Pow Complex Real</code> instance, but apparently not. But yes, the point is that when we have real C*-algebras, <code>Real</code> will be one.</p>",
        "id": 571567587,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1770091743
    },
    {
        "content": "<p>Is there a reasonable typeclass that can use forgetful inheritance here?</p>",
        "id": 571572720,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1770095055
    }
]