[
    {
        "content": "<p>I'm very excited to see <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ContinuousMulEquiv#doc\">docs#ContinuousMulEquiv</a> (homeomorphisms which are group isomorphisms) merged and now want to start using it by pushing Haar measures along such things. </p>\n<p>Right now we have <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MeasureTheory.Measure.isHaarMeasure_map#doc\">docs#MeasureTheory.Measure.isHaarMeasure_map</a> which works for group homomorphisms <code>f</code> satisfying a bunch of annoying-to-fill-in properties like <code>Filter.Tendsto (⇑f) (Filter.cocompact G) (Filter.cocompact H)</code>, and then we have what mathlib calls a \"convenience wrapper\", <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MulEquiv.isHaarMeasure_map#doc\">docs#MulEquiv.isHaarMeasure_map</a>, which asks for fewer annoying properties but still wants <code>(e : G ≃* H) (he : Continuous ⇑e)\n(hesymm : Continuous ⇑e.symm)</code>, which is exactly what a <code>ContinuousMulEquiv</code> is. We also have another convenience wrapper <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ContinuousLinearEquiv.isAddHaarMeasure_map#doc\">docs#ContinuousLinearEquiv.isAddHaarMeasure_map</a> (a linear map version), which makes me think that we will not be averse to this declaration:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">Yet another convenience wrapper for MeasureTheory.Measure.isHaarMeasure_map.</span>\n<span class=\"sd\">-/</span>\n<span class=\"kd\">@[</span><span class=\"n\">to_additive</span><span class=\"w\"> </span><span class=\"s2\">\"Yet another convenience wrapper for MeasureTheory.Measure.isAddHaarMeasure_map.</span>\n<span class=\"s2\">\"</span><span class=\"kd\">]</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">ContinuousMulEquiv</span><span class=\"bp\">.</span><span class=\"n\">isHaarMeasure_map</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MeasurableSpace</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">Measure</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">μ</span><span class=\"bp\">.</span><span class=\"n\">IsHaarMeasure</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">BorelSpace</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">TopologicalGroup</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MeasurableSpace</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">BorelSpace</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalGroup</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"bp\">≃ₜ*</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">Measure</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">⇑</span><span class=\"n\">e</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">μ</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">IsHaarMeasure</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">toMulEquiv</span><span class=\"bp\">.</span><span class=\"n\">isHaarMeasure_map</span><span class=\"w\"> </span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">continuous</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"bp\">.</span><span class=\"n\">continuous</span>\n</code></pre></div>\n<p>My first question is: do we in fact want this? My (dependent) second question is: if we do, it can't go in <code>Mathlib.MeasureTheory.Group.Measure</code> with the other wrappers as it stands because this file doesn't import <code>Mathlib.Topology.Algebra.ContinuousMonoidHom</code> where <code>≃ₜ*</code> is defined (even though <code>ContinuousLinearEquiv</code> is imported!). Can I add this import? I don't know my way around this part of mathlib at all.</p>",
        "id": 491792133,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1735927647
    },
    {
        "content": "<p>We definitely want to do this, and you can add the import (it's pretty low-level compared to Haar measures, so this is completely reasonable).</p>",
        "id": 491860501,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1735981520
    },
    {
        "content": "<p>Thanks! In fact later on it occurred to me that it was quite funny that the file imports continuous module isomorphisms but not continuous additive group isomorphisms.</p>",
        "id": 491860682,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1735981689
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/20469\">#20469</a></p>",
        "id": 491863581,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1735984684
    },
    {
        "content": "<p>I've since created <a href=\"https://github.com/leanprover-community/mathlib4/pull/21443\">#21443</a> which lessens the weight of the <code>ContinousMonoidHom</code> import</p>",
        "id": 497777523,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1738712306
    }
]