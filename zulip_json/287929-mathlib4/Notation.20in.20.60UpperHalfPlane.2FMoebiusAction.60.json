[
    {
        "content": "<p>What's the reason to use</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"o\">:</span><span class=\"mi\">1024</span><span class=\"w\"> </span><span class=\"s2\">\"↑ₘ\"</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">:</span><span class=\"mi\">1024</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"o\">(((</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GL</span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">⁺</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GL</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>instead of either</p>\n<ul>\n<li>introducing a new <code>def GLPos.toFun</code> and registering it as <code>CoeFun</code>;</li>\n<li>or introducing a <code>FunLike</code> instance?</li>\n</ul>\n<p>P.S.: I would prefer the former, leaving <code>FunLike</code> to bundled operators with additional properties, but this should be probably discussed in a dedicated thread, as it affects <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Finsupp#doc\">docs#Finsupp</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=DFinsupp#doc\">docs#DFinsupp</a> as well.</p>",
        "id": 569902343,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769287381
    },
    {
        "content": "<p>BTW, the scoped notation <code>↑ₘ</code> is never used.</p>",
        "id": 569902758,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769287820
    },
    {
        "content": "<p>Also, does it make sense to have an action of <code>GL</code>, not <code>GLPos</code>?</p>",
        "id": 569907923,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769294076
    },
    {
        "content": "<p>Answering myself: yes, if we want to have orientation-reversing isometries too.</p>",
        "id": 569907994,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769294185
    },
    {
        "content": "<p>What's the plan for <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi><mi>S</mi><mi>L</mi></mrow><annotation encoding=\"application/x-tex\">PSL</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">PS</span><span class=\"mord mathnormal\">L</span></span></span></span> action? Also, <span class=\"user-mention\" data-user-id=\"481963\">@David Loeffler</span> , could you please expand the docstrings in <a href=\"https://tqft.net/mathlib4files/LinearAlgebra/Matrix/GeneralLinearGroup/FinTwo\">file#LinearAlgebra/Matrix/GeneralLinearGroup/FinTwo</a> ? E.g.,</p>\n<ul>\n<li>write a module docstring;</li>\n<li>explain the motivation behind the names <code>IsParabolic</code> etc, both in the module docstring and in the individual docstrings.</li>\n</ul>",
        "id": 569908274,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769294489
    },
    {
        "content": "<blockquote>\n<p>What's the reason to use</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"o\">:</span><span class=\"mi\">1024</span><span class=\"w\"> </span><span class=\"s2\">\"↑ₘ\"</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">:</span><span class=\"mi\">1024</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"o\">(((</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GL</span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">⁺</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GL</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>The UpperHalfPlane stuff was originally written (long ago in mathlib3 days, and not by me, mostly by <span class=\"user-mention\" data-user-id=\"389019\">@Chris Birkbeck</span> I think) with an action of <code>GL(2, ℝ)⁺</code>. This was kind of annoying because of constantly having to manage coercions between <code>GL(2, ℝ)⁺</code> and <code>GL(2, ℝ)</code> (and a host of other related types as well). I think this <code>↑ₘ</code> notation was introduced to ease that process slightly.</p>\n<p>Subsequently I rewrote a bunch of this code to make the whole of <code>GL(2, ℝ)</code> act (by letting <code>![-1, 0; 0, 1]</code> act as reflection in the <del>real</del> imaginary axis). Probably I overlooked that this notation should have been weeded out at the same time.</p>\n<blockquote>\n<p>Also, does it make sense to have an action of <code>GL</code>, not <code>GLPos</code>? [...] Answering myself: yes, if we want to have orientation-reversing isometries too.</p>\n</blockquote>\n<p>I hope it does, since I invested a nontrivial amount of work in doing so.</p>",
        "id": 569934909,
        "sender_full_name": "David Loeffler",
        "timestamp": 1769324824
    },
    {
        "content": "<p>I'm going to add a PGL action too.</p>",
        "id": 569934992,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769324897
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Notation.20in.20.60UpperHalfPlane.2FMoebiusAction.60/near/569908274\">said</a>:</p>\n<blockquote>\n<p>Also, @David Loeffler , could you please expand the docstrings in <a href=\"https://tqft.net/mathlib4files/LinearAlgebra/Matrix/GeneralLinearGroup/FinTwo\">file#LinearAlgebra/Matrix/GeneralLinearGroup/FinTwo</a> ? E.g.,</p>\n<ul>\n<li>write a module docstring;</li>\n<li>explain the motivation behind the names <code>IsParabolic</code> etc, both in the module docstring and in the individual docstrings.</li>\n</ul>\n</blockquote>\n<p>With all due respect, Yury: what is the role of the mathlib maintainers? Is it to manage the growth of mathlib, or to direct it? I have many projects and a lot of demands on my time, and I'm not accustomed to being told what to do.</p>",
        "id": 569935041,
        "sender_full_name": "David Loeffler",
        "timestamp": 1769324970
    },
    {
        "content": "<p>I just saw a file with no docs, and asked the author of the file. It's OK to say that you have no time for this.</p>",
        "id": 569935075,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769325018
    },
    {
        "content": "<p>Quite frankly don't know what the etymology of the term \"parabolic element\" is, for certain classes of 2x2 matrices; and I've managed to get by working in, and teaching, modular form theory for ~20 years without particularly needing to know the motivation behind this name. That's just the name that's conventionally used; that's enough.</p>",
        "id": 569935126,
        "sender_full_name": "David Loeffler",
        "timestamp": 1769325094
    },
    {
        "content": "<p>Currently, the definitions are in the <code>Matrix</code> namespace, and the definition don't say that they have something to do with the action on the upper half-plane.</p>",
        "id": 569935174,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769325158
    },
    {
        "content": "<p>The definition isn't specific to the upper half-plane, that's just one place that the distinction is relevant.</p>",
        "id": 569935196,
        "sender_full_name": "David Loeffler",
        "timestamp": 1769325199
    },
    {
        "content": "<p>My main concern is that someone may expect <code>Matrix.IsElliptic</code> to be about matrices representing elliptic operators or something like that.</p>",
        "id": 569935358,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769325429
    },
    {
        "content": "<p>More widely: Yury, in this thread and <a class=\"stream-topic\" data-stream-id=\"116395\" href=\"/#narrow/channel/116395-maths/topic/Shifts.20.28translations.3F.29.20of.20the.20hyperbolic.20plane/with/566827080\">#maths &gt; Shifts (translations?) of the hyperbolic plane</a>  you have twice tried to start a debate about how best to implement X in mathlib when X is actually already there (and clearly documented as such in the mathlib manuals). </p>\n<p>We have an entire channel devoted to novices asking how to find stuff; but when a mathlib maintainer doesn't bother to check if something already exists before asking how to build it, that seems (to put it mildly) a little disrespectful to those who have invested vast amounts of work in doing so.</p>",
        "id": 569935388,
        "sender_full_name": "David Loeffler",
        "timestamp": 1769325496
    },
    {
        "content": "<p>In this thread I'm asking what led to design choices that aren't documented in the code. Refactoring existing code is a part of maintainance.<br>\nIn the other thread I took a shortcut by defining one specific type of Möbius transformations of the unit disc instead of transfering the structure from the upper half-plane. Indeed, this was a bad decision motivated by a rush towards formalizing RMT, so I'm working on a proper implementation now.</p>",
        "id": 569935580,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769325772
    },
    {
        "content": "<p>The existence of an action of GL (as opposed to GLPos) <em>is</em> documented in the code – indeed, in the module docstring of a file you have already quoted from in this thread.</p>",
        "id": 569935698,
        "sender_full_name": "David Loeffler",
        "timestamp": 1769325974
    },
    {
        "content": "<p>I'm sorry I've badly formulated my question. The actual question was whether the action of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>G</mi><mi>L</mi></mrow><annotation encoding=\"application/x-tex\">GL</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">G</span><span class=\"mord mathnormal\">L</span></span></span></span> is mathematically meaningful, or just a \"junk\" extension of the action of <code>GLPos</code>. This is not documented at the moment, and I've answered myself a few minutes later.</p>",
        "id": 569935811,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769326103
    },
    {
        "content": "<p>Indeed, I could've thought a bit more to avoid the question in the first place, sorry about that.</p>",
        "id": 569935854,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769326150
    },
    {
        "content": "<p>Back to \"what can we do about it\", will you have time to review PRs adding docs to <code>MoebiusAction</code> and <code>GeneralLinearGroup/FinTwo</code>, if I prepare them?</p>",
        "id": 569935911,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769326217
    },
    {
        "content": "<p>I guess there is a cultural chasm here, becuase the <code>UpperHalfPlane</code> code was all written by number theorists (not analysts) who naturally have their own ideas what is important, what names are natural, etc. (E.g. elliptic operators are something the vast majority of number theorists don't ever think about, while you can't talk about modular forms for long without dealing with elliptic points.)</p>",
        "id": 569935942,
        "sender_full_name": "David Loeffler",
        "timestamp": 1769326287
    },
    {
        "content": "<p>The metric was written by me, I'm not a number theorist ;-)</p>",
        "id": 569935969,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769326332
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Notation.20in.20.60UpperHalfPlane.2FMoebiusAction.60/near/569935911\">said</a>:</p>\n<blockquote>\n<p>Back to \"what can we do about it\", will you have time to review PRs adding docs to <code>MoebiusAction</code> and <code>GeneralLinearGroup/FinTwo</code>, if I prepare them?</p>\n</blockquote>\n<p>Sure, can do.</p>",
        "id": 569935996,
        "sender_full_name": "David Loeffler",
        "timestamp": 1769326365
    },
    {
        "content": "<p>I'll try to prepare them tomorrow then.</p>",
        "id": 569936006,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769326381
    },
    {
        "content": "<p>I have some code written but not PR'ed which shows that the action of SL2Z is measure-preserving. I'll swap you one PR review for another if you like :-)</p>",
        "id": 569936033,
        "sender_full_name": "David Loeffler",
        "timestamp": 1769326415
    },
    {
        "content": "<p>ack</p>",
        "id": 569936042,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769326428
    },
    {
        "content": "<p>Do you mean the action of GL2R?</p>",
        "id": 569936077,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769326464
    },
    {
        "content": "<p>Need to look at code (might be some abs(det) factor preventing GL from acting measure-preservingly)</p>",
        "id": 569936090,
        "sender_full_name": "David Loeffler",
        "timestamp": 1769326502
    },
    {
        "content": "<p>Since it's actually the action of PGL2R, the determinant shouldn't play any role.</p>",
        "id": 569936126,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769326561
    },
    {
        "content": "<p>You're right, it's all of GL, code is here <a href=\"https://github.com/loefflerd/ModularFormDimensions/blob/856a596b38b4aab9a246d3f096e5486e21993b39/ModularFormDimensions/Measure.lean#L44C1-L44C57\">https://github.com/loefflerd/ModularFormDimensions/blob/856a596b38b4aab9a246d3f096e5486e21993b39/ModularFormDimensions/Measure.lean#L44C1-L44C57</a></p>",
        "id": 569936131,
        "sender_full_name": "David Loeffler",
        "timestamp": 1769326564
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SMulInvariantMeasure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">GL</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">ℍ</span><span class=\"w\"> </span><span class=\"n\">volume</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n</code></pre></div>\n<p>(here <code>volume</code> is Lebesgue measure weigthed by <code>1 / im z ^ 2</code>)</p>",
        "id": 569936195,
        "sender_full_name": "David Loeffler",
        "timestamp": 1769326639
    },
    {
        "content": "<p>BTW, do you know why the notation for <code>GL</code> takes a type while notations for <code>GL^+</code>, <code>SL</code> etc take a natural number?</p>",
        "id": 569936444,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769326995
    },
    {
        "content": "<p>I'm trying to decide which convention to follow for <code>PGL</code>.</p>",
        "id": 569936499,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769327063
    },
    {
        "content": "<p>Not sure. Both are shorthands for more general notations that take a fintype; probably they were just independently implemented by different people. I had spotted that inconsistency but shied away from fixing it, because it is not easy to search-and-replace. </p>\n<p>IMHO the abbreviations should both take a nat, for maximal simplicity when writing GL2R, and anyone who wants GL indexed by a more general fintype can live with writing <code>Matrix.GeneralLinearGroup foo</code>.</p>",
        "id": 569936645,
        "sender_full_name": "David Loeffler",
        "timestamp": 1769327248
    },
    {
        "content": "<p>(PS: I also think the special-case notations (&amp; coercion instances etc) for GL^+ should be retired, that type is now very little used in the library.)</p>",
        "id": 569937338,
        "sender_full_name": "David Loeffler",
        "timestamp": 1769328124
    },
    {
        "content": "<p>My personal opinion is that we can have notation that disambiguates between both, since a natural number is never a type</p>",
        "id": 569938682,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1769329919
    },
    {
        "content": "<p>Sorry I am a bit late to this, but it's as David says. The GL^+ stuff was added by me back in the lean 3 days since originally we only had an action by SL2Z. I thought for modular forms this is all we would ever need, but the coercions were a pain (hence we had this  <code>↑ₘ</code> notation). So more recently David extended this to GL. As for the notations taking in a type or a number, I honestly don't remember (it was likely me who added both of these), it was probably just me being inconsistent and reviewers not catching me. </p>\n<p>Lastly, I also don't really know the origin of calling these points elliptic or parabolic, but there is some discussion about this on the Wikipedia page <a href=\"https://en.wikipedia.org/wiki/M%C3%B6bius_transformation#The_real_case_and_a_note_on_terminology\">here</a></p>",
        "id": 569940844,
        "sender_full_name": "Chris Birkbeck",
        "timestamp": 1769332522
    },
    {
        "content": "<p>Thanks Chris for explaining the origin of this! I think your link got a bit scrambled, I suspect you may have meant this one: <a href=\"https://en.wikipedia.org/wiki/SL2(R)#Classification_of_elements\">https://en.wikipedia.org/wiki/SL2(R)#Classification_of_elements</a></p>",
        "id": 569945117,
        "sender_full_name": "David Loeffler",
        "timestamp": 1769337283
    },
    {
        "content": "<p>Ah yes thanks, I was doing this on my phone and got the link wrong!</p>",
        "id": 569945165,
        "sender_full_name": "Chris Birkbeck",
        "timestamp": 1769337332
    },
    {
        "content": "<p>Oh thats a slightly different link, I meant to send <a href=\"https://en.wikipedia.org/wiki/M%C3%B6bius_transformation#The_real_case_and_a_note_on_terminology\">this</a></p>",
        "id": 569945283,
        "sender_full_name": "Chris Birkbeck",
        "timestamp": 1769337474
    },
    {
        "content": "<p>Here is a PR which adds the <code>MeasurePreserving</code> stuff, improves the docstring of <code>FinTwo.lean</code>, and removes the no-longer-needed coercion notation: <a href=\"https://github.com/leanprover-community/mathlib4/pull/34402\">#34402</a></p>",
        "id": 569945718,
        "sender_full_name": "David Loeffler",
        "timestamp": 1769337958
    },
    {
        "content": "<p>Thanks! I'll review it after the breakfast.</p>",
        "id": 569959913,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769353428
    },
    {
        "content": "<p>I want to make minor adjustments (move some usage of defeq to <code>Subtype</code> to lemmas), otherwise LGTM. BTW, do you think it makes sense to add a lemma about <code>mfderiv</code> of the action?</p>",
        "id": 570022762,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769412089
    },
    {
        "content": "<p>Thanks! I wasn't sure how best to handle the subtype defeq so very grateful for a second opinion on that. </p>\n<p>Regarding <code>mfderiv</code>: I wrote a TODO in the code about this. I guess ultimately we want to have all the options in parallel – the abstract manifold deriv valued in the tangent space, the concrete deriv obtained by extending the function to C, and the link between the two via the canonical trivialization of the tangent space. But my experience is that if you ever want to actually <em>do</em> anything with these definitions, you end up falling back to functions on C anyway, so I wanted to get that in first.</p>",
        "id": 570039987,
        "sender_full_name": "David Loeffler",
        "timestamp": 1769418570
    },
    {
        "content": "<p>I made a pass locally, but I got carried away and fixed some <code>Subtype</code> defeq abuses that are out of scope for this PR. I'll clean up the code and split these fixes into a separate PR tomorrow or on Friday.</p>",
        "id": 570758708,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769683003
    },
    {
        "content": "<p>(then I'll push the rest to your branch)</p>",
        "id": 570758766,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769683020
    },
    {
        "content": "<p>Thanks for doing this, there is definitely a lot of sub-optimal code (of mine mostly!) in this part of the library so having an expert look it over is really highly appreciated.</p>",
        "id": 570760577,
        "sender_full_name": "David Loeffler",
        "timestamp": 1769683505
    },
    {
        "content": "<p>I've opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/34597\">#34597</a> and pushed to your branch. Feel free to revert changes that you don't like.</p>",
        "id": 570960121,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1769759195
    }
]