[
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"633109\">Ahmad Alkhalawi</span> <a href=\"#narrow/stream/287929-mathlib4/topic/github.20permission/near/462063460\">said</a>:</p>\n<blockquote>\n<p>Woodbury identity</p>\n</blockquote>\n<p>Hopefully you are planning on proving it in an arbitrary ring? Hopefully the proof is quite short, using e.g. the \"algebraic proof\" on the wikipedia page and the <code>ring</code> tactic.</p>",
        "id": 462245284,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723602142
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/287929-mathlib4/topic/github.20permission/near/462245284\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"633109\">Ahmad Alkhalawi</span> <a href=\"#narrow/stream/287929-mathlib4/topic/github.20permission/near/462063460\">said</a>:</p>\n<blockquote>\n<p>Woodbury identity</p>\n</blockquote>\n<p>Hopefully you are planning on proving it in an arbitrary ring? Hopefully the proof is quite short, using e.g. the \"algebraic proof\" on the wikipedia page and the <code>ring</code> tactic.</p>\n</blockquote>\n<p>I have a proof for it in matrices over a commutative ring. Unfortunately I don't think <code>ring</code> helps since matrices are noncommutative, and <code>abel</code>/<code>noncomm_ring</code> helped but not much. I followed the direct proof in Wikipedia and it was about 22 lines.</p>",
        "id": 462292545,
        "sender_full_name": "Ahmad Alkhalawi",
        "timestamp": 1723624401
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"633109\">Ahmad Alkhalawi</span> <a href=\"#narrow/stream/287929-mathlib4/topic/github.20permission/near/462292545\">said</a>:</p>\n<blockquote>\n<p>I have a proof for it in matrices over a commutative ring. Unfortunately I don't think <code>ring</code> helps since matrices are noncommutative, and <code>abel</code>/<code>noncomm_ring</code> helped but not much. I followed the direct proof in Wikipedia and it was about 22 lines.</p>\n</blockquote>\n<p>But why restrict the result to matrices? From what I understand it's just true in any ring. Indeed I am wrong however about the <code>ring</code> tactic being helpful.</p>",
        "id": 462442288,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723683511
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/287929-mathlib4/topic/github.20permission/near/462442288\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"633109\">Ahmad Alkhalawi</span> <a href=\"#narrow/stream/287929-mathlib4/topic/github.20permission/near/462292545\">said</a>:</p>\n<blockquote>\n<p>I have a proof for it in matrices over a commutative ring. Unfortunately I don't think <code>ring</code> helps since matrices are noncommutative, and <code>abel</code>/<code>noncomm_ring</code> helped but not much. I followed the direct proof in Wikipedia and it was about 22 lines.</p>\n</blockquote>\n<p>But why restrict the result to matrices? From what I understand it's just true in any ring. Indeed I am wrong however about the <code>ring</code> tactic being helpful.</p>\n</blockquote>\n<p>I proved it over general rings as well, but it seems like that doesnt imply the matrix version since the matrices don't have to be the same size. Maybe I could submit both?</p>",
        "id": 462518420,
        "sender_full_name": "Ahmad Alkhalawi",
        "timestamp": 1723717101
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"633109\">Ahmad Alkhalawi</span> <a href=\"#narrow/stream/287929-mathlib4/topic/github.20permission/near/462518420\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/287929-mathlib4/topic/github.20permission/near/462442288\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"633109\">Ahmad Alkhalawi</span> <a href=\"#narrow/stream/287929-mathlib4/topic/github.20permission/near/462292545\">said</a>:</p>\n<blockquote>\n<p>I have a proof for it in matrices over a commutative ring. Unfortunately I don't think <code>ring</code> helps since matrices are noncommutative, and <code>abel</code>/<code>noncomm_ring</code> helped but not much. I followed the direct proof in Wikipedia and it was about 22 lines.</p>\n</blockquote>\n<p>But why restrict the result to matrices? From what I understand it's just true in any ring. Indeed I am wrong however about the <code>ring</code> tactic being helpful.</p>\n</blockquote>\n<p>I proved it over general rings as well, but it seems like that doesnt imply the matrix version since the matrices don't have to be the same size. Maybe I could submit both?</p>\n</blockquote>\n<p>Hi Ahamd,<br>\nCan you share both versions for the woodbury identity? I am interested in seeing how different they are.</p>",
        "id": 462583818,
        "sender_full_name": "MohanadAhmed",
        "timestamp": 1723737912
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"497480\">MohanadAhmed</span> <a href=\"#narrow/stream/287929-mathlib4/topic/github.20permission/near/462583818\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"633109\">Ahmad Alkhalawi</span> <a href=\"#narrow/stream/287929-mathlib4/topic/github.20permission/near/462518420\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/287929-mathlib4/topic/github.20permission/near/462442288\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"633109\">Ahmad Alkhalawi</span> <a href=\"#narrow/stream/287929-mathlib4/topic/github.20permission/near/462292545\">said</a>:</p>\n<blockquote>\n<p>I have a proof for it in matrices over a commutative ring. Unfortunately I don't think <code>ring</code> helps since matrices are noncommutative, and <code>abel</code>/<code>noncomm_ring</code> helped but not much. I followed the direct proof in Wikipedia and it was about 22 lines.</p>\n</blockquote>\n<p>But why restrict the result to matrices? From what I understand it's just true in any ring. Indeed I am wrong however about the <code>ring</code> tactic being helpful.</p>\n</blockquote>\n<p>I proved it over general rings as well, but it seems like that doesnt imply the matrix version since the matrices don't have to be the same size. Maybe I could submit both?</p>\n</blockquote>\n<p>Hi Ahamd,<br>\nCan you share both versions for the woodbury identity? I am interested in seeing how different they are.</p>\n</blockquote>\n<p>Hello, this is the matrix version:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">add_mul_inv</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Invertible</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Invertible</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">][</span><span class=\"n\">Invertible</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"o\">)</span><span class=\"bp\">⁻¹=</span><span class=\"n\">A</span><span class=\"bp\">⁻¹-</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹+</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">⁻¹*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">inv_eq_right_inv</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"k\">calc</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">⁻¹-</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹+</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">⁻¹*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹-</span><span class=\"n\">A</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹+</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">⁻¹*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹-</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹+</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">⁻¹*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">add_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">mul_sub</span><span class=\"o\">,</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">mul_sub</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">repeat</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">mul_assoc</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"bp\">←@</span><span class=\"n\">add_sub_assoc</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹</span><span class=\"o\">)</span><span class=\"bp\">-</span><span class=\"o\">(</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹+</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">⁻¹*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹+</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">⁻¹*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"n\">simp</span>\n<span class=\"w\">        </span><span class=\"n\">abel</span>\n<span class=\"w\">      </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹-</span><span class=\"o\">(</span><span class=\"n\">U</span><span class=\"bp\">+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹+</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">⁻¹*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"n\">simp</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">add_mul</span><span class=\"o\">,</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">add_mul</span><span class=\"o\">,</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">add_mul</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹-</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹+</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹+</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">⁻¹*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"n\">congr</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">mul_add</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">simp</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">mul_assoc</span><span class=\"o\">,</span><span class=\"bp\">←</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">mul_assoc</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n</code></pre></div>\n<p>Note R is commutative<br>\nThis is the ring version</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">add_mul_inv</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Invertible</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Invertible</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">][</span><span class=\"n\">Invertible</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">⅟</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">⅟</span><span class=\"n\">A</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"o\">)]:</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"bp\">⅟</span><span class=\"n\">A</span><span class=\"bp\">-⅟</span><span class=\"n\">A</span><span class=\"bp\">*</span><span class=\"n\">U</span><span class=\"bp\">*⅟</span><span class=\"o\">(</span><span class=\"bp\">⅟</span><span class=\"n\">C</span><span class=\"bp\">+</span><span class=\"n\">V</span><span class=\"bp\">*⅟</span><span class=\"n\">A</span><span class=\"bp\">*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*⅟</span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"bp\">=</span><span class=\"mi\">1</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"k\">calc</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"bp\">⅟</span><span class=\"n\">A</span><span class=\"bp\">-⅟</span><span class=\"n\">A</span><span class=\"bp\">*</span><span class=\"n\">U</span><span class=\"bp\">*⅟</span><span class=\"o\">(</span><span class=\"bp\">⅟</span><span class=\"n\">C</span><span class=\"bp\">+</span><span class=\"n\">V</span><span class=\"bp\">*⅟</span><span class=\"n\">A</span><span class=\"bp\">*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*⅟</span><span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">*⅟</span><span class=\"n\">A</span><span class=\"bp\">-</span><span class=\"n\">A</span><span class=\"bp\">*⅟</span><span class=\"n\">A</span><span class=\"bp\">*</span><span class=\"n\">U</span><span class=\"bp\">*⅟</span><span class=\"o\">(</span><span class=\"bp\">⅟</span><span class=\"n\">C</span><span class=\"bp\">+</span><span class=\"n\">V</span><span class=\"bp\">*⅟</span><span class=\"n\">A</span><span class=\"bp\">*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*⅟</span><span class=\"n\">A</span><span class=\"bp\">+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*⅟</span><span class=\"n\">A</span><span class=\"bp\">-</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*⅟</span><span class=\"n\">A</span><span class=\"bp\">*</span><span class=\"n\">U</span><span class=\"bp\">*⅟</span><span class=\"o\">(</span><span class=\"bp\">⅟</span><span class=\"n\">C</span><span class=\"bp\">+</span><span class=\"n\">V</span><span class=\"bp\">*⅟</span><span class=\"n\">A</span><span class=\"bp\">*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*⅟</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"n\">add_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_sub</span><span class=\"o\">,</span><span class=\"n\">mul_sub</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">repeat</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"n\">mul_assoc</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"bp\">←@</span><span class=\"n\">add_sub_assoc</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*⅟</span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"bp\">-</span><span class=\"o\">(</span><span class=\"n\">U</span><span class=\"bp\">*⅟</span><span class=\"o\">(</span><span class=\"bp\">⅟</span><span class=\"n\">C</span><span class=\"bp\">+</span><span class=\"n\">V</span><span class=\"bp\">*⅟</span><span class=\"n\">A</span><span class=\"bp\">*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*⅟</span><span class=\"n\">A</span><span class=\"bp\">+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*⅟</span><span class=\"n\">A</span><span class=\"bp\">*</span><span class=\"n\">U</span><span class=\"bp\">*⅟</span><span class=\"o\">(</span><span class=\"bp\">⅟</span><span class=\"n\">C</span><span class=\"bp\">+</span><span class=\"n\">V</span><span class=\"bp\">*⅟</span><span class=\"n\">A</span><span class=\"bp\">*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*⅟</span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"n\">simp</span>\n<span class=\"w\">        </span><span class=\"n\">abel</span>\n<span class=\"w\">      </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*⅟</span><span class=\"n\">A</span><span class=\"bp\">-</span><span class=\"o\">(</span><span class=\"n\">U</span><span class=\"bp\">+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*⅟</span><span class=\"n\">A</span><span class=\"bp\">*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">*⅟</span><span class=\"o\">(</span><span class=\"bp\">⅟</span><span class=\"n\">C</span><span class=\"bp\">+</span><span class=\"n\">V</span><span class=\"bp\">*⅟</span><span class=\"n\">A</span><span class=\"bp\">*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*⅟</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"n\">simp</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">add_mul</span><span class=\"o\">,</span><span class=\"n\">add_mul</span><span class=\"o\">,</span><span class=\"n\">add_mul</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*⅟</span><span class=\"n\">A</span><span class=\"bp\">-</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"bp\">⅟</span><span class=\"n\">C</span><span class=\"bp\">+</span><span class=\"n\">V</span><span class=\"bp\">*⅟</span><span class=\"n\">A</span><span class=\"bp\">*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">*⅟</span><span class=\"o\">(</span><span class=\"bp\">⅟</span><span class=\"n\">C</span><span class=\"bp\">+</span><span class=\"n\">V</span><span class=\"bp\">*⅟</span><span class=\"n\">A</span><span class=\"bp\">*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*⅟</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"n\">congr</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mul_add</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mul_assoc</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">⅟</span><span class=\"n\">C</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">simp</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"n\">mul_assoc</span><span class=\"o\">,</span><span class=\"bp\">←</span><span class=\"n\">mul_assoc</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n</code></pre></div>\n<p>Here  \\frac1 instead of \\inv since \\inv isnt defined, and i only prove it is a left inverse, since im not sure its two-sided</p>",
        "id": 462660130,
        "sender_full_name": "Ahmad Alkhalawi",
        "timestamp": 1723765684
    },
    {
        "content": "<p>11 messages were moved here from <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/stream/287929-mathlib4/topic/github.20permission\">#mathlib4 &gt; github permission</a> by <span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span>.</p>",
        "id": 462800318,
        "sender_full_name": "Notification Bot",
        "timestamp": 1723819037
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"633109\">@Ahmad Alkhalawi</span> </p>\n<p>I tried to golf it but I could not do much. Compared to my <a href=\"#narrow/stream/217875-Is-there-code-for-X.3F/topic/Sherman.E2.80.93Morrison.20formula/near/390176429\">earlier proof</a>, I think this is much neater.<br>\n<span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span>  Any golfs you can think of?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">LinearAlgebra</span><span class=\"bp\">.</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">NonsingularInverse</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">add_mul_inv</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">][</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">][</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">][</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Invertible</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Invertible</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">][</span><span class=\"n\">Invertible</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"o\">)</span><span class=\"bp\">⁻¹=</span><span class=\"n\">A</span><span class=\"bp\">⁻¹-</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹+</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">⁻¹*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">inv_eq_right_inv</span><span class=\"w\"> </span><span class=\"bp\">?_</span>\n<span class=\"w\">    </span><span class=\"k\">calc</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">⁻¹-</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹+</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">⁻¹*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹-</span><span class=\"n\">A</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹+</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">⁻¹*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹-</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹+</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">⁻¹*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">add_sub_assoc</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">add_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">mul_sub</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">mul_assoc</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹</span><span class=\"o\">)</span><span class=\"bp\">-</span><span class=\"o\">(</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹+</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">⁻¹*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹+</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">⁻¹*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">mul_inv_of_invertible</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">one_mul</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">abel</span>\n<span class=\"w\">      </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹-</span><span class=\"o\">(</span><span class=\"n\">U</span><span class=\"bp\">+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹+</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">⁻¹*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">sub_right_inj</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">add_mul</span><span class=\"o\">,</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">add_mul</span><span class=\"o\">,</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">add_mul</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹-</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹+</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹+</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">⁻¹*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"n\">congr</span>\n<span class=\"w\">        </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">mul_add</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">mul_inv_cancel_right_of_invertible</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">mul_assoc</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n</code></pre></div>",
        "id": 463238449,
        "sender_full_name": "MohanadAhmed",
        "timestamp": 1724013884
    },
    {
        "content": "<p>Not a golf, but it would be great to show the inverse for the other side too, and bundle the resulting two-sided inverse up as <code>Invertible (A + U*C*V)</code></p>",
        "id": 463238862,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1724014082
    },
    {
        "content": "<p>(I guess the right-inverse follows quickly from the left-inverse)</p>",
        "id": 463238938,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1724014139
    },
    {
        "content": "<p>Should that not follow from: <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix.mul_eq_one_comm#doc\">docs#Matrix.mul_eq_one_comm</a></p>",
        "id": 463239071,
        "sender_full_name": "MohanadAhmed",
        "timestamp": 1724014245
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Woodbury.20identity/near/463238862\">said</a>:</p>\n<blockquote>\n<p>Not a golf, but it would be great to show the inverse for the other side too, and bundle the resulting two-sided inverse up as <code>Invertible (A + U*C*V)</code></p>\n</blockquote>\n<p>Is this what you meant?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">add_mul_mul_inv_mul_eq_one</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">][</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">][</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">][</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Invertible</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Invertible</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">][</span><span class=\"n\">Invertible</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">⁻¹-</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹+</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">⁻¹*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">calc</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">⁻¹-</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹+</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">⁻¹*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹-</span><span class=\"n\">A</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹+</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">⁻¹*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹-</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹+</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">⁻¹*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">add_sub_assoc</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">add_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">mul_sub</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">mul_assoc</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹</span><span class=\"o\">)</span><span class=\"bp\">-</span><span class=\"o\">(</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹+</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">⁻¹*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹+</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">⁻¹*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">mul_inv_of_invertible</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">one_mul</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">abel</span>\n<span class=\"w\">      </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹-</span><span class=\"o\">(</span><span class=\"n\">U</span><span class=\"bp\">+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹+</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">⁻¹*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">sub_right_inj</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">add_mul</span><span class=\"o\">,</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">add_mul</span><span class=\"o\">,</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">add_mul</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹-</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹+</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹+</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">⁻¹*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"n\">congr</span>\n<span class=\"w\">        </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">mul_add</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">mul_inv_cancel_right_of_invertible</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">mul_assoc</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">invertibleWoodburyLHS</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">][</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">][</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">][</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Invertible</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Invertible</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Invertible</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"o\">)]</span><span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Invertible</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">invertibleOfRightInverse</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">add_mul_mul_inv_mul_eq_one</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">)</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">woodbury_identity</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">][</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">][</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">][</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Invertible</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Invertible</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">][</span><span class=\"n\">Invertible</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">+</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"o\">)</span><span class=\"bp\">⁻¹=</span><span class=\"n\">A</span><span class=\"bp\">⁻¹-</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">⁻¹+</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">⁻¹*</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">⁻¹</span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">inv_eq_right_inv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">add_mul_mul_inv_mul_eq_one</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 463536897,
        "sender_full_name": "MohanadAhmed",
        "timestamp": 1724109575
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"633109\">@Ahmad Alkhalawi</span> Did you get non master mathlib access yet?<br>\nI think we should pr this before it becomes mathlib outdated  like my earlier code</p>",
        "id": 464048759,
        "sender_full_name": "MohanadAhmed",
        "timestamp": 1724245209
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> Do you have any more thoughts on this?</p>",
        "id": 464053387,
        "sender_full_name": "MohanadAhmed",
        "timestamp": 1724245987
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"497480\">MohanadAhmed</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Woodbury.20identity/near/464048759\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"633109\">Ahmad Alkhalawi</span> Did you get non master mathlib access yet?<br>\nI think we should pr this before it becomes mathlib outdated  like my earlier code</p>\n</blockquote>\n<p>I did not</p>",
        "id": 464070699,
        "sender_full_name": "Ahmad Alkhalawi",
        "timestamp": 1724249832
    },
    {
        "content": "<p><span class=\"user-group-mention\" data-user-group-id=\"2494\">@maintainers</span> Maintainers, can someone please <span class=\"user-mention\" data-user-id=\"633109\">@Ahmad Alkhalawi</span> (github name <code>4hma4d</code> access to PR his proof of Woodbury (aka Sherman Morrison) identity to mathlib?</p>",
        "id": 464143905,
        "sender_full_name": "MohanadAhmed",
        "timestamp": 1724267391
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"633109\">@Ahmad Alkhalawi</span> invitation sent!</p>",
        "id": 464144208,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1724267476
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 464144341,
        "sender_full_name": "Ahmad Alkhalawi",
        "timestamp": 1724267519
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Woodbury.20identity/near/462442288\">said</a>:</p>\n<blockquote>\n<p>But why restrict the result to matrices? From what I understand it's just true in any ring.</p>\n</blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"633109\">Ahmad Alkhalawi</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Woodbury.20identity/near/462518420\">said</a>:</p>\n<blockquote>\n<p>I proved it over general rings as well, but it seems like that doesnt imply the matrix version since the matrices don't have to be the same size. Maybe I could submit both?</p>\n</blockquote>\n<p>I think the correct generality here is over a ring equipped with additive maps, trading the key steps using</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">(</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"n\">B</span><span class=\"bp\">*</span><span class=\"n\">V</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">V</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">*</span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">V</span>\n</code></pre></div>\n<p>for</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Fuv</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"bp\">*</span><span class=\"n\">A</span><span class=\"bp\">*</span><span class=\"n\">Fuv</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Fuv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Fvu</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>where on matrices all the <code>*</code> are still square multiplications. This can be instantiated separately for <code>Fuv C = U*C*V</code> for regular and matrix multiplication.</p>\n<p>I think <span class=\"user-mention\" data-user-id=\"633109\">@Ahmad Alkhalawi</span>'s <a href=\"https://github.com/leanprover-community/mathlib4/pull/16325\">#16325</a> can get merged without that generalization though, assuming everything else looks fine.</p>",
        "id": 472089367,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1727043388
    }
]