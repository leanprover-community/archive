[
    {
        "content": "<p>Hi, I wanted to ask for feedback about the statement of a theorem I would like to prove and eventually contribute to Mathlib. I plan to write more theorems related to this subject, but I first wanted to make sure I understand the style / conventions of Mathlib. Personally I don't like how this theorem is stated very much, especially not all the many ands, but I was advised not to try to define too many structures and try to state things more directly, so that's what I try to do here. The theorem says that every regular parametrized curve has a unit speed reparametrization, i.e., reparametrization by arc-length:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">reparam_by_arc_length</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">I</span><span class=\"bp\">.</span><span class=\"n\">OrdConnected</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithTop</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"bp\">∞</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">once_diff</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ContDiffOn</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">regular</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">φ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">J</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">J</span><span class=\"bp\">.</span><span class=\"n\">OrdConnected</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">MonotoneOn</span><span class=\"w\"> </span><span class=\"n\">φ</span><span class=\"w\"> </span><span class=\"n\">J</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">DifferentiableOn</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">φ</span><span class=\"w\"> </span><span class=\"n\">J</span>\n<span class=\"w\">  </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">φ</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"n\">J</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">J</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"bp\">∘</span><span class=\"n\">φ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>How  would you modify it to be fit for Mathlib?</p>",
        "id": 560654199,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764267961
    },
    {
        "content": "<p>Is it specific to euclidean space or does it work for any real vector space or any finite dimensional real vector space or any normed real vector space or...</p>",
        "id": 560655811,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764268790
    },
    {
        "content": "<p>also <code>once_diff</code> probably shouldn't be an implicit argument since it's impossible to infer</p>",
        "id": 560655933,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764268838
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Looking.20for.20feedback.20on.20a.20theorem.20statement/near/560655811\">said</a>:</p>\n<blockquote>\n<p>Is it specific to euclidean space or does it with for any real vector space or any finite dimensional real vector space or any normed real vector space or...</p>\n</blockquote>\n<p>I'm not sure, but I think this might work in any normed real vector space</p>",
        "id": 560657426,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764269616
    },
    {
        "content": "<p>In regards to the type of the theorem, i.e, the part with all the ands, do you think that's a good style? Is there a better way of doing it?</p>",
        "id": 560657721,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764269782
    },
    {
        "content": "<p>In the above theorem, I would make a definition <code>arclengthReparamFrom c x₀</code> which would be the arclength reparameterization sending 0 to x₀. It would be defined without any assumption on <code>c</code> (using junk values at points where it is not well defined). And then you would state its properties, in separate lemmas. Note that it would work at once for all intervals <code>I</code> containing <code>x₀</code> on which the function is C^1 with nonvanishing derivative. </p>\n<p>This would be one definition (but of a function, not of a type), and many API lemmas establishing the properties of this function. Your statement above with existentials could be a technical lemma used in the proof of the properties of <code>arclengthReparamFrom</code>, but not the final statement as it is hard to use as you point out.</p>",
        "id": 560721188,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1764315374
    },
    {
        "content": "<p>Thank you very much! I'll try do it</p>",
        "id": 560721801,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764315670
    },
    {
        "content": "<p>Is this a good statement of this definition (for now I still use euclidean space, but might change it later)?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">arclengthReparamFrom</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">I</span><span class=\"bp\">.</span><span class=\"n\">OrdConnected</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t₀</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 560724156,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764316819
    },
    {
        "content": "<p>I'm not sure if this is what you were thinking of, but I defined it like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">noncomputable</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">arclengthReparamFrom</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">I</span><span class=\"bp\">.</span><span class=\"n\">OrdConnected</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t₀</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">ψ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">t₀</span><span class=\"bp\">..</span><span class=\"n\">t</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"bp\">‖</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">ψ</span><span class=\"bp\">⁻¹</span>\n</code></pre></div>\n<p>The problem I see with this is that I would want to prove a few properties of <code>ψ</code> and it's inverse, in order to prove properties of the arc-length reparametrization.</p>",
        "id": 560726778,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764317837
    },
    {
        "content": "<p>I would rather let <code>arclengthReparamFrom</code> be the function ψ⁻¹, because that's the one you will use in statements. Also, there shouldn't be an <code>I</code> in your definition. And what exactly do you mean by ψ⁻¹? </p>\n<p>I'd say, start with any definition you like and start proving theorems about it. You will see soon if your definition works well or if it should be tweaked.</p>",
        "id": 560732161,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1764319656
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110050\">Sébastien Gouëzel</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Looking.20for.20feedback.20on.20a.20theorem.20statement/near/560732161\">said</a>:</p>\n<blockquote>\n<p>I would rather let <code>arclengthReparamFrom</code> be the function ψ⁻¹, because that's the one you will use in statements. Also, there shouldn't be an <code>I</code> in your definition. And what exactly do you mean by ψ⁻¹? </p>\n<p>I'd say, start with any definition you like and start proving theorems about it. You will see soon if your definition works well or if it should be tweaked.</p>\n</blockquote>\n<p>So essentially define the parameter transformation that gives us the arc-length reparametrization, i.e: <code>φ :=  ψ⁻¹</code>.  Although I would also want to use properties of <code>ψ</code>, so maybe I should also define that before. Not sure what I would call it, but I'll think of something.</p>",
        "id": 560739719,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764321862
    },
    {
        "content": "<p>So this is the updated definitions I came up with. Some of the names are a bit long,  especially of the first definition, because I don't know what is a good description of this term - it's essentially a construction (an important one)  we usually make inside a proof, I don't think there is a term for this in of itself. </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">section</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t₀</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span>\n\n<span class=\"c1\">--This is the reversed (inverse) parameter transformation for the arc-length reparametrization</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">revParamTransformForArclengthReparamFrom</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">t₀</span><span class=\"bp\">..</span><span class=\"n\">t</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"bp\">‖</span>\n\n<span class=\"c1\">--This is parameter transformation used to construct the arc-length reparametrization</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">arclengthParamTransformFrom</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">ψ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">revParamTransformForArclengthReparamFrom</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">t₀</span>\n<span class=\"w\">  </span><span class=\"n\">ψ</span><span class=\"bp\">⁻¹</span>\n\n<span class=\"c1\">--an arclength reparametrization of a parametrized curve</span>\n<span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">arclengthReparamFrom</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">φ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">arclengthParamTransformFrom</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">t₀</span>\n<span class=\"w\">  </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">φ</span>\n</code></pre></div>",
        "id": 560758052,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764327564
    },
    {
        "content": "<p>You should use <code>letI</code> inside your definitions. (Otherwise, your proof terms will be more complicated and your first step in using them will be to <code>simp</code>lify them.)</p>",
        "id": 560761066,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1764328534
    },
    {
        "content": "<p>I'm not sure why there's a <code>From</code> in all your names: can you say why?</p>",
        "id": 560761181,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1764328571
    },
    {
        "content": "<p>Another option for definitions is to say <code>arcLengthParamTransformAux</code> - for \"auxiliary definition\". If you add a comment that they are auxiliary, that is not rare in mathlib.</p>",
        "id": 560761304,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1764328615
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Looking.20for.20feedback.20on.20a.20theorem.20statement/near/560761066\">said</a>:</p>\n<blockquote>\n<p>You should use <code>letI</code> inside your definitions. (Otherwise, your proof terms will be more complicated and your first step in using them will be to <code>simp</code>lify them.)</p>\n</blockquote>\n<p>Thank you very much! I never heard of <code>letI</code>,  it seems like a great idea, and also using <code>Aux</code> in the name is a great idea. The reason I have <code>From</code> in all the definitions is that it follows the naming <span class=\"user-mention\" data-user-id=\"110050\">@Sébastien Gouëzel</span>  suggested - they are constructed from <code>c</code> and <code>t₀</code>. Do you think I should avoid it?</p>",
        "id": 560763093,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764329170
    },
    {
        "content": "<p>These are the updated definitions:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">section</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t₀</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span>\n\n<span class=\"sd\">/-- Auxiliary definition, this is the reversed (inverse) parameter transformation</span>\n<span class=\"sd\">for the arclength reparametrization. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">revParamTransformForArclengthReparamAux</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">t₀</span><span class=\"bp\">..</span><span class=\"n\">t</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"bp\">‖</span>\n\n<span class=\"c1\">--This is parameter transformation used to construct the arc-length reparametrization.</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">arclengthParamTransformFrom</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">letI</span><span class=\"w\"> </span><span class=\"n\">ψ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">revParamTransformForArclengthReparamAux</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">t₀</span>\n<span class=\"w\">  </span><span class=\"n\">ψ</span><span class=\"bp\">⁻¹</span>\n\n<span class=\"c1\">--Unit speed / arclength reparametrization of a parametrized curve</span>\n<span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">arclengthReparamFrom</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">letI</span><span class=\"w\"> </span><span class=\"n\">φ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">arclengthParamTransformFrom</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">t₀</span>\n<span class=\"w\">  </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">φ</span>\n</code></pre></div>",
        "id": 560765264,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764329897
    },
    {
        "content": "<p>Once you have your definitions, the only way to see if they're good or if they're flawed is to start proving theorems about them. (I have the impression there are still issues, but it's more pedagogical if you discover them yourself while trying to prove theorems)</p>",
        "id": 560767648,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1764330617
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110050\">Sébastien Gouëzel</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Looking.20for.20feedback.20on.20a.20theorem.20statement/near/560767648\">said</a>:</p>\n<blockquote>\n<p>Once you have your definitions, the only way to see if they're good or if they're flawed is to start proving theorems about them. (I have the impression there are still issues, but it's more pedagogical if you discover them yourself while trying to prove theorems)</p>\n</blockquote>\n<p>O.k, I'll try to prove some theorems now and see how it goes.  Thanks a lot!</p>",
        "id": 560769281,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764331193
    },
    {
        "content": "<p>Is there some excepted way to create a short name (maybe <code>ψ</code>, for example) for the expression<code>revParamTransformForArclengthReparamAux c t₀</code>? I will be using it only in some auxiliary lemmas, but it looks a bit ridiculous having to type this long expression every time, especially in the statement of a lemma.</p>",
        "id": 560778562,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764334055
    },
    {
        "content": "<p>Does</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"n\">notation3</span><span class=\"w\"> </span><span class=\"s2\">\"ψ\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">revParamTransformForArclengthReparamAux</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">t₀</span>\n</code></pre></div>\n<p>work for you?</p>",
        "id": 560780809,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1764334708
    },
    {
        "content": "<p>(Also, you can/should definitely use a shorter name!)</p>",
        "id": 560781056,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1764334770
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110050\">Sébastien Gouëzel</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Looking.20for.20feedback.20on.20a.20theorem.20statement/near/560780809\">said</a>:</p>\n<blockquote>\n<p>Does</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"n\">notation3</span><span class=\"w\"> </span><span class=\"s2\">\"ψ\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">revParamTransformForArclengthReparamAux</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">t₀</span>\n</code></pre></div>\n<p>work for you?</p>\n</blockquote>\n<p>It works great, thank you very much!</p>",
        "id": 560781380,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764334845
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110050\">Sébastien Gouëzel</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Looking.20for.20feedback.20on.20a.20theorem.20statement/near/560781056\">said</a>:</p>\n<blockquote>\n<p>(Also, you can/should definitely use a shorter name!)</p>\n</blockquote>\n<p>You are absolutely right, but I don't know what is a good short description of it. Maybe I'll have some idea later.</p>",
        "id": 560781636,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764334923
    },
    {
        "content": "<p>I was thinking of <code>arclengthParamTransformAux</code>, by the way.</p>",
        "id": 560783243,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1764335281
    },
    {
        "content": "<p>That's a good idea, it's definitely shorter. But is it still o.k., that I use the <code>ψ</code> notation (only on auxiliary lemmas) when I change it?</p>",
        "id": 560783770,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764335434
    },
    {
        "content": "<p>I have this working code so far:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">MeasureTheory</span><span class=\"w\"> </span><span class=\"n\">intervalIntegral</span>\n\n<span class=\"sd\">/-- This is a version of the first part of FTC for a function which is continuous on an interval.</span>\n<span class=\"sd\">    Credit to Aaron Liu. -/</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">derivWithin_integral_of_continuousOn_interval</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">I</span><span class=\"bp\">.</span><span class=\"n\">OrdConnected</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ContinuousOn</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x₀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HasDerivWithinAt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\">  </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">x₀</span><span class=\"bp\">..</span><span class=\"n\">t</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">intervalIntegral</span><span class=\"bp\">.</span><span class=\"n\">FTCFilter</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nhdsWithin</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nhdsWithin</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">intervalIntegral</span><span class=\"bp\">.</span><span class=\"n\">FTCFilter</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nhdsWithin</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nhdsWithin</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">⟨?_⟩</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"w\"> </span><span class=\"bp\">?_</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Filter</span><span class=\"bp\">.</span><span class=\"n\">tendsto_smallSets_iff</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">ht</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mem_nhdsWithin_iff_exists_mem_nhds_inter</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">ht</span>\n<span class=\"w\">      </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hu</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hut</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ht</span>\n<span class=\"w\">      </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">haxb</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">habx</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">habu</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">exists_Icc_mem_subset_of_mem_nhds</span><span class=\"w\"> </span><span class=\"n\">hu</span>\n<span class=\"w\">      </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hab</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Icc</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">∩</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">nhdsWithin</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">        </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">inter_comm</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">▸</span><span class=\"w\"> </span><span class=\"n\">inter_mem_nhdsWithin</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">habx</span>\n<span class=\"w\">      </span><span class=\"n\">filter_upwards</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Filter</span><span class=\"bp\">.</span><span class=\"n\">prod_mem_prod</span><span class=\"w\"> </span><span class=\"n\">hab</span><span class=\"w\"> </span><span class=\"n\">hab</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">hi</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hj</span><span class=\"bp\">⟩</span>\n<span class=\"w\">      </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">subset_trans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">subset_inter</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">hut</span>\n<span class=\"w\">      </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">subset_trans</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"w\"> </span><span class=\"n\">habu</span>\n<span class=\"w\">        </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">hk</span>\n<span class=\"w\">        </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">hi</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"n\">hk</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">.</span><span class=\"n\">le</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hk</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"n\">hj</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">⟩</span>\n<span class=\"w\">      </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">hk</span>\n<span class=\"w\">        </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Icc_subset</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">hi</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"n\">hj</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Ioc_subset_Icc_self</span><span class=\"w\"> </span><span class=\"n\">hk</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">pure_le_nhdsWithin</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">nhdsWithin_le_nhds</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">Filter</span><span class=\"bp\">.</span><span class=\"n\">inf_isMeasurablyGenerated</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">OrdConnected</span><span class=\"bp\">.</span><span class=\"n\">measurableSet</span><span class=\"w\"> </span><span class=\"bp\">‹_›</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">principal_isMeasurablyGenerated</span>\n<span class=\"w\">  </span><span class=\"n\">intervalIntegral</span><span class=\"bp\">.</span><span class=\"n\">integral_hasDerivWithinAt_right</span>\n<span class=\"w\">    </span><span class=\"o\">((</span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">mono</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">OrdConnected</span><span class=\"bp\">.</span><span class=\"n\">uIcc_subset</span><span class=\"w\"> </span><span class=\"bp\">‹_›</span><span class=\"w\"> </span><span class=\"n\">x₀</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">intervalIntegrable</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">stronglyMeasurableAtFilter_nhdsWithin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">OrdConnected</span><span class=\"bp\">.</span><span class=\"n\">measurableSet</span><span class=\"w\"> </span><span class=\"bp\">‹_›</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">continuousWithinAt</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"o\">)</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">section</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span>\n\n<span class=\"sd\">/-- Auxiliary definition, this is the reversed (inverse) parameter transformation</span>\n<span class=\"sd\">for the arclength reparametrization. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">arclengthParamTransformAux</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t₀</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">t₀</span><span class=\"bp\">..</span><span class=\"n\">t</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"bp\">‖</span>\n\n<span class=\"c1\">--This is parameter transformation used to construct the arc-length reparametrization.</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">arclengthParamTransform</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t₀</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">letI</span><span class=\"w\"> </span><span class=\"n\">ψ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">arclengthParamTransformAux</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">t₀</span>\n<span class=\"w\">  </span><span class=\"n\">ψ</span><span class=\"bp\">⁻¹</span>\n\n<span class=\"c1\">--Unit speed / arclength reparametrization of a parametrized curve</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">arclengthReparamFrom</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t₀</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">letI</span><span class=\"w\"> </span><span class=\"n\">φ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">arclengthParamTransform</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">t₀</span>\n<span class=\"w\">  </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">φ</span>\n\n<span class=\"c1\">-- We now also assume c is a parametrized curve of class Cʳ from the interval I, r≥1.</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">I</span><span class=\"bp\">.</span><span class=\"n\">OrdConnected</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hI</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsOpen</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithTop</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"bp\">∞</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">once_diff</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ContDiffOn</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t₀</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span>\n\n<span class=\"c1\">--Auxilary definition, so we don't have to type the full long expression everytime</span>\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"n\">notation3</span><span class=\"w\"> </span><span class=\"s2\">\"ψ\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">arclengthParamTransformAux</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">t₀</span>\n\n<span class=\"sd\">/-- An auxiliary lemma giving us the derivitive of the reverse parameter transformation on I. -/</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">rev_param_transform_deriv_eq_aux</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">once_diff</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ContDiffOn</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">hI</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsOpen</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HasDerivWithinAt</span><span class=\"w\"> </span><span class=\"n\">ψ</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">cont_speed</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ContinuousOn</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">‖</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"n\">Continuous</span><span class=\"bp\">.</span><span class=\"n\">comp_continuousOn'</span><span class=\"w\"> </span><span class=\"n\">continuous_norm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hc</span><span class=\"bp\">.</span><span class=\"n\">continuousOn_deriv_of_isOpen</span><span class=\"w\"> </span><span class=\"n\">hI</span><span class=\"w\"> </span><span class=\"n\">once_diff</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">arclengthParamTransformAux</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">derivWithin_integral_of_continuousOn_interval</span><span class=\"w\"> </span><span class=\"n\">cont_speed</span><span class=\"w\"> </span><span class=\"n\">t₀</span><span class=\"w\"> </span><span class=\"n\">t</span>\n</code></pre></div>\n<p>There are two issues that I wanted to ask about:<br>\nThe first one is a bit weird  -  when I remove the assumptions <code>once_diff</code>, <code>hc</code>, <code>hI</code> from the statement of the last lemma, lean doesn't recognize these names inside the proof even though they already appear in the variable command above. Why is that? Is there some better way to do it which avoids repetition?<br>\nThe second issue is about making a strategic  decision about the use of intervals in the project. In the last lemma for example I assumed also that the interval <code>I</code> is open because I found a theorem on Mathlib that helped me get what I want which required <code>I</code> to be open. I might try to drop now the assumption that <code>I</code> is open and prove the lemma without it, but maybe it could be a good idea to just always assume that the interval is open to make life easier. Will that be acceptable if I want this code to eventually get into Mathlib? And do you think it will really be very helpful to assume the interval is open? Another option is to use a normal closed intervals as Michael Rothgang suggested previously, but it seems to me that this choice will still have the issue of dealing with edge points for which there isn't a neighborhood inside the interval.</p>",
        "id": 561864639,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764851219
    },
    {
        "content": "<p>The reason you need the interval to be open is you are using <code>deriv</code>, which looks at the neighborhood of whatever point you give it, and this neighborhood might go outside the interval if it is not open.</p>",
        "id": 561873852,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764853877
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"952635\">Michael Novak</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Looking.20for.20feedback.20on.20a.20theorem.20statement/near/561864639\">said</a>:</p>\n<blockquote>\n<p>The first one is a bit weird  -  when I remove the assumptions <code>once_diff</code>, <code>hc</code>, <code>hI</code> from the statement of the last lemma, lean doesn't recognize these names inside the proof even though they already appear in the variable command above. Why is that? Is there some better way to do it which avoids repetition?</p>\n</blockquote>\n<p>This is because variables are not included into a <code>theorem</code> unless they are \"relevant\", messing appears in the statement or if a typeclass relating to a relevant variable. This is so that you don't accidentally change the statement of a theorem by messing around with its proof. You can get around it by doing <code>include once_diff hc hI</code>.</p>",
        "id": 561874437,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764854062
    },
    {
        "content": "<p>Surely you can get some derivative information from <code>hc</code>, so you don't have to use <code>deriv</code>?</p>",
        "id": 561874806,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764854167
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Looking.20for.20feedback.20on.20a.20theorem.20statement/near/561873852\">said</a>:</p>\n<blockquote>\n<p>The reason you need the interval to be open is you are using <code>deriv</code>, which looks at the neighborhood of whatever point you give it, and this neighborhood might go outside the interval if it is not open.</p>\n</blockquote>\n<p>Yes, I thought of using <code>derivWithin</code>, but then I will also need the original definition of <code>arclengthParamTransformAux</code> and the subsequent definitions to include the interval <code>I</code>,  and I was told not to include it and also the theorem for the continuity of derivWithin require another assumption which is not completely clear to me, but if you think it's better to switch to <code>derivWithin</code> I'll look into it in more detail.</p>",
        "id": 561875369,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764854323
    },
    {
        "content": "<p>I don't think it should require another assumption</p>",
        "id": 561875649,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764854407
    },
    {
        "content": "<p>I'll take a look</p>",
        "id": 561875668,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764854412
    },
    {
        "content": "<p>oh it wants the derivative to be unique?</p>",
        "id": 561875877,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764854471
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Looking.20for.20feedback.20on.20a.20theorem.20statement/near/561875649\">said</a>:</p>\n<blockquote>\n<p>I don't think it should require another assumption</p>\n</blockquote>\n<p>The theorem I'm refering to is <code>ContDiffOn.continuousOn_derivWithin</code>, which also require this: <code>(hs : UniqueDiffOn 𝕜 s₂)</code>. Do you think it's easy to show?</p>",
        "id": 561876170,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764854562
    },
    {
        "content": "<p>oh that why it wants the derivative to be unique</p>",
        "id": 561876174,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764854563
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Looking.20for.20feedback.20on.20a.20theorem.20statement/near/561875877\">said</a>:</p>\n<blockquote>\n<p>oh it wants the derivative to be unique?</p>\n</blockquote>\n<p>yes</p>",
        "id": 561876226,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764854576
    },
    {
        "content": "<p>I'll think about it</p>",
        "id": 561876237,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764854581
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Looking.20for.20feedback.20on.20a.20theorem.20statement/near/561874437\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"952635\">Michael Novak</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Looking.20for.20feedback.20on.20a.20theorem.20statement/near/561864639\">said</a>:</p>\n<blockquote>\n<p>The first one is a bit weird  -  when I remove the assumptions <code>once_diff</code>, <code>hc</code>, <code>hI</code> from the statement of the last lemma, lean doesn't recognize these names inside the proof even though they already appear in the variable command above. Why is that? Is there some better way to do it which avoids repetition?</p>\n</blockquote>\n<p>This is because variables are not included into a <code>theorem</code> unless they are \"relevant\", messing appears in the statement or if a typeclass relating to a relevant variable. This is so that you don't accidentally change the statement of a theorem by messing around with its proof. You can get around it by doing <code>include once_diff hc hI</code>.</p>\n</blockquote>\n<p>I'm not sure I understand it completely. If these are assumptions about some variables like <code>c</code> and <code>I</code> which appear in the theorem statement, why are they not included?</p>",
        "id": 561877895,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764855053
    },
    {
        "content": "<p>They are not mentioned in the statement and they are not typeclass assumptions</p>",
        "id": 561886116,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764857201
    },
    {
        "content": "<p>Why doesn't this <code>HasDerivWithinAt ψ ‖deriv c t‖ I t</code> count as a mention of <code>c</code> and <code>I</code>?</p>",
        "id": 561888142,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764857682
    },
    {
        "content": "<p>I didn't read everything, but mentioning <code>I</code> is not enough to have <code>hI</code> automatically included (it would work if the statement mention <code>hI</code> explicitly).</p>",
        "id": 561889338,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1764857987
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130384\">Riccardo Brasca</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Looking.20for.20feedback.20on.20a.20theorem.20statement/near/561889338\">said</a>:</p>\n<blockquote>\n<p>I didn't read everything, but mentioning <code>I</code> is not enough to have <code>hI</code> automatically included (it would work if the statement mention <code>hI</code> explicitly).</p>\n</blockquote>\n<p>Oh, that makes sense, thank you very much! And also thank you <span class=\"user-mention\" data-user-id=\"816344\">@Aaron Liu</span>  for trying to explain me that!</p>",
        "id": 561891204,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764858457
    },
    {
        "content": "<p>So the reason they want the derivative to be unique is that <code>derivWithin</code> picks out an arbitrary derivative and <code>ContDiff</code> only asserts the existence of a continuous derivative</p>",
        "id": 561926129,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764866281
    },
    {
        "content": "<p>so if the derivative isn't unique you can have the arbitrary derivative not the same as the continuous derivative</p>",
        "id": 561926351,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764866339
    },
    {
        "content": "<p>I claim you shouldn't be picking an arbitrary derivative with <code>derivWithin</code> and you should instead pick an arbitrary continuous derivative</p>",
        "id": 561926462,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764866371
    },
    {
        "content": "<p>This sounds very weird to me. As far as I know the derivative is a limit and limits are unique. What do I miss?</p>",
        "id": 561927441,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764866612
    },
    {
        "content": "<p>for example, if your interval is a singleton point what's the derivative?</p>",
        "id": 561927582,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764866647
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"952635\">Michael Novak</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Looking.20for.20feedback.20on.20a.20theorem.20statement/near/561927441\">said</a>:</p>\n<blockquote>\n<p>As far as I know the derivative is a limit and limits are unique.</p>\n</blockquote>\n<p>In mathlib a function <code>f</code> is said to have a derivative <code>f'</code> at <code>x</code> within a set <code>s</code> if <code>f y - f x - f' * (y - x)</code> as a function of <code>y</code> grows as little o of <code>y - x</code> at the neighborhood of <code>x</code> within <code>s</code>.</p>",
        "id": 561929539,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764867139
    },
    {
        "content": "<p>I'm not sure, maybe it's not defined because there isn't an open subset (in the bigger normed space) of the point which is contained in the singleton. Now that I think of it, when I learned the general definition of the derivative of a multivariable function it was defined always when the domain of the function is an open set in the bigger normed space. Maybe Mathlib does something more general I'm not sure.</p>",
        "id": 561929550,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764867143
    },
    {
        "content": "<p>Yes, that is what's happening: mathlib's definition <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=DifferentiableOn#doc\">docs#DifferentiableOn</a> never requires the set to be open --- which is why considers <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=DifferentiableWithinAt#doc\">docs#DifferentiableWithinAt</a>. (For open sets, <code>DifferentiableWithinAt</code> and <code>DifferentiableAt</code> are equivalent.)</p>",
        "id": 561929887,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1764867227
    },
    {
        "content": "<p>You can read <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=HasFDerivAtFilter#doc\">docs#HasFDerivAtFilter</a></p>",
        "id": 561930524,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764867383
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Looking.20for.20feedback.20on.20a.20theorem.20statement/near/561929539\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"952635\">Michael Novak</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Looking.20for.20feedback.20on.20a.20theorem.20statement/near/561927441\">said</a>:</p>\n<blockquote>\n<p>As far as I know the derivative is a limit and limits are unique.</p>\n</blockquote>\n<p>In mathlib a function <code>f</code> is said to have a derivative <code>f'</code> at <code>x</code> within a set <code>s</code> if <code>f y - f x - f' * (y - x)</code> as a function of <code>y</code> grows as little o of <code>y - x</code> at the neighborhood of <code>x</code> within <code>s</code>.</p>\n</blockquote>\n<p>I thought about it, it's a bit confusing, so I'm really not sure, but I think that according to this definition, the answer to your question about the case of a singleton is that any function <code>f'</code> would satisfy it vacuously (if we unfold the definition with epsilon and delta, then there isn't any point in any neighborhood of <code>x</code> without <code>x</code> itself within <code>s</code>). So if I understood this correctly I understand now the problem that the derivative could be not unique. But if we eliminate the case of a singleton is it still possible to get a non-unique derivative on an interval?</p>",
        "id": 561937232,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764869232
    },
    {
        "content": "<p>The singleton is the only problematic case. See <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=uniqueDiffOn_Icc#doc\">docs#uniqueDiffOn_Icc</a> and the lemmas around.</p>",
        "id": 561941234,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1764870401
    },
    {
        "content": "<p>For a set of real numbera the derivative is always unique at non-isolated points</p>",
        "id": 561941353,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764870431
    },
    {
        "content": "<p>So should I include an assumption that the interval <code>I</code> includes two different points and solve the issue in this way?</p>",
        "id": 561941967,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764870612
    },
    {
        "content": "<p>I think you should use something other than <code>derivWithin</code> that gets you a derivative which is automatically continuous</p>",
        "id": 561942166,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764870671
    },
    {
        "content": "<p>Do you mean I should use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=HasFDerivAtFilter#doc\">docs#HasFDerivAtFilter</a> ? If that's the best way to do it then I will try it. My main problem is that I barely understand what is a Filter (only read the definition in Wikipedia). Do you have a link for some information about using filters and related concepts in Mathlib?</p>",
        "id": 561944358,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764871375
    },
    {
        "content": "<p>not what I meant but I encourage you to learn about filters</p>",
        "id": 561944611,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764871468
    },
    {
        "content": "<p>Could you elaborate what did you mean? (I will also try to lean about filters anyways <span aria-label=\"joy\" class=\"emoji emoji-1f602\" role=\"img\" title=\"joy\">:joy:</span> ).</p>",
        "id": 561944985,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764871577
    },
    {
        "content": "<p>At a point <code>x</code> different from <code>t0</code> you could use <code>derivWithin (uIcc t0 x)</code>, and at <code>t0</code> use <code>deriv</code>, for example.</p>",
        "id": 561945175,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1764871628
    },
    {
        "content": "<p><code>ContDiffOn</code> says there exists a sequence of multilinear maps whose first few terms form continuous derivatives for your given function within a certain set</p>",
        "id": 561945407,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764871724
    },
    {
        "content": "<p>so just take the derivative from there, and it's continuous by assumption</p>",
        "id": 561945453,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764871743
    },
    {
        "content": "<p>no need to use <code>derivWithin</code> that gives you a derivative not guaranteed to be continuous</p>",
        "id": 561945596,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764871788
    },
    {
        "content": "<p>Thank you very much! I'll try this.</p>",
        "id": 561945908,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764871868
    },
    {
        "content": "<p>Aaron, inside intervals (different from a single point) the derivative is unique, and therefore continuous. The issue is not there. The issue is if you want something which works regardless of the interval <code>I</code> that you want to reparameterize.<br>\n<span class=\"user-mention\" data-user-id=\"952635\">@Michael Novak</span>, thinking again about it, I think your life will be much easier if you allow yourself to let the reparam depend on the interval, or if you just take open intervals (in which case you can use the plain <code>deriv</code>). This really depends on the theorems you want to formalize, though.</p>",
        "id": 561955211,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1764874930
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110050\">Sébastien Gouëzel</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Looking.20for.20feedback.20on.20a.20theorem.20statement/near/561955211\">said</a>:</p>\n<blockquote>\n<p>Aaron, inside intervals (different from a single point) the derivative is unique, and therefore continuous. The issue is not there. The issue is if you want something which works regardless of the interval <code>I</code> that you want to reparameterize.<br>\n<span class=\"user-mention silent\" data-user-id=\"952635\">Michael Novak</span>, thinking again about it, I think your life will be much easier if you allow yourself to let the reparam depend on the interval, or if you just take open intervals (in which case you can use the plain <code>deriv</code>). This really depends on the theorems you want to formalize, though.</p>\n</blockquote>\n<p>Your solution totally makes sense to me as well. The theorems I want to to formalize should work on any intervals, I'm not sure how much assuming the interval is open will help, certainly adding assumptions could not make life harder, but on the other hand as I understand it you want to be as general as you can in Mathlib, but I really don't have much experience with Mathlib as you, so I'm not sure. I'll wait to see what <span class=\"user-mention\" data-user-id=\"816344\">@Aaron Liu</span>  thinks.</p>",
        "id": 562018581,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764908850
    },
    {
        "content": "<p>So I finished working on this theorem. I would really appreciate any feedback - what should I work on to make it suitable for the Mathlib library? There are two main issues: The first is that in the end I decided to assume that the interval is open, it made life much easier, but if you think this is very problematic and would not be acceptable on Mathlib, then I will try to generalize the work to any interval, although it might be a pain to do. The second one is about the statement of the main theorem: I couldn't think of a sensible way of splitting it to different theorems, if I was creating some structures, then  for example the structure of a  parameter transformation would come with an interval attached to it and this would make it much easier to split the theorem to multiple theorems. If you have any suggestion how reorganize  the theorems I would love to know. And in general I would love to hear any feedback even about small style details.</p>\n<p>I tried to paste the code here, but it's too long. So here is a link with the code:<br>\n<a href=\"https://paste.ofcode.org/E5wRc6yz4trHJKCRai7w5p\">https://paste.ofcode.org/E5wRc6yz4trHJKCRai7w5p</a></p>",
        "id": 565307780,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766600548
    },
    {
        "content": "<p>I read a bit about contributing to Mathlib and I made a few small changes to the file to hopefully make better fit for Mathlib and I also read that it's better to make pull request to small pieces each time and find a reviewer. So I wanted to try to make a pull request for this file about arc-length reparametrization of parametrized curves, before I continue to prove more results about planar curves. So I was wondering if there's someone here that could be a reviewer for my code and also if someone here could help me with the technicalities of making a pull request, because I only recently created a Github account and I don't have any experience with it. <br>\nThis is the current file: <br>\n<a href=\"/user_uploads/3121/hk4VlTjghNTv-Qab6bwHsX0-/ArcLengthReparametrization.lean\">ArcLengthReparametrization.lean</a></p>",
        "id": 565438585,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766751855
    },
    {
        "content": "<p>Have you seen <a href=\"https://leanprover-community.github.io/contribute/index.html\">https://leanprover-community.github.io/contribute/index.html</a> already? Does it answer your github-related questions?</p>",
        "id": 565438947,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1766752146
    },
    {
        "content": "<p>The arc length reparametrisation of curves sounds like a useful first step. I'm happy to review your PR (but very busy until mid-January - I cannot promise a response before then).</p>",
        "id": 565438988,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1766752188
    },
    {
        "content": "<p>In general, it seems clear enough that your code will find an interested reviewer: so you can open a PR before e.g. getting a review promise from a particular person. When opening my PRs, I just open the PR (and trust that there will be a reviewer) - rather than asking a particular reviewer in advance.</p>",
        "id": 565439097,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1766752276
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Looking.20for.20feedback.20on.20a.20theorem.20statement/near/565438988\">said</a>:</p>\n<blockquote>\n<p>The arc length reparametrisation of curves sounds like a useful first step. I'm happy to review your PR (but very busy until mid-January - I cannot promise a response before then).</p>\n</blockquote>\n<p>Thank you very much! Take your time, honestly I'm also very busy right now, so I have no problem waiting, and maybe there will also be someone else that would like to review as you said.</p>",
        "id": 565439352,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766752488
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Looking.20for.20feedback.20on.20a.20theorem.20statement/near/565438947\">said</a>:</p>\n<blockquote>\n<p>Have you seen <a href=\"https://leanprover-community.github.io/contribute/index.html\">https://leanprover-community.github.io/contribute/index.html</a> already? Does it answer your github-related questions?</p>\n</blockquote>\n<p>The first issue I have is that I don't know which option I should choose at the first step: \"Choose different branches or forks above to discuss and review change\"</p>",
        "id": 565439456,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766752590
    },
    {
        "content": "<p>I don't think this is explained in the link you sent</p>",
        "id": 565439502,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766752638
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/lUoOQ3tbKCYRDHuaYSPMurJr/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/lUoOQ3tbKCYRDHuaYSPMurJr/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"2358x991\" src=\"/user_uploads/thumbnail/3121/lUoOQ3tbKCYRDHuaYSPMurJr/image.png/840x560.webp\"></a></div>",
        "id": 565439631,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766752753
    },
    {
        "content": "<p>Have you pushed your changes to a branch of your fork yet?</p>",
        "id": 565451248,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766762569
    },
    {
        "content": "<p>No, is that something that I need to do? And if so is there some guide on how to do it?</p>",
        "id": 565452062,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766763220
    },
    {
        "content": "<p>yes you do have to do it</p>",
        "id": 565452149,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766763285
    },
    {
        "content": "<p>it's in the thing <span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> linked</p>",
        "id": 565452177,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766763302
    },
    {
        "content": "<p>Do you know in which section it is explained?</p>",
        "id": 565452317,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766763407
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/contribute/index.html#working-on-mathlib\">this section</a> talks about how you make a fork and push to it</p>",
        "id": 565452451,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766763509
    },
    {
        "content": "<p>Thank you very much!</p>",
        "id": 565452561,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766763578
    },
    {
        "content": "<p>I work now on my fork now and I'm not sure where is the best place to put my file in. I was thinking maybe in Analysis/Calculus or maybe in Geometry/Manifold? And another question which might be silly - can I choose which license to use in my file (can I use the GNU GPL for example) or do all files have to use Apache?</p>",
        "id": 565461235,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766771939
    },
    {
        "content": "<p>No, most definitely only Apache is allowed</p>",
        "id": 565462685,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1766773253
    },
    {
        "content": "<p>I created the PR now. Hopefully I didn't make too many mistakes <span aria-label=\"joy\" class=\"emoji emoji-1f602\" role=\"img\" title=\"joy\">:joy:</span></p>",
        "id": 565492760,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766816698
    },
    {
        "content": "<p>It seems that I have some errors. Do you understand what's the problem?</p>",
        "id": 565496328,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766821807
    },
    {
        "content": "<p>Maybe post at least one of a link to the PR and the errors?</p>",
        "id": 565497006,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1766822569
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/33330\">https://github.com/leanprover-community/mathlib4/pull/33330</a></p>",
        "id": 565497031,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766822612
    },
    {
        "content": "<p>The error tells you what to do to fix it: run <code>lake exe mk_all</code> and then commit the new Mathlib.lean file which contains a mention of the new file you added</p>",
        "id": 565497172,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1766822813
    },
    {
        "content": "<p>So, just to make sure I understand, because I barely know how to use git: I first do this <code>lake exe mk_all</code> command inside the mathlib fork in my computer, then I do <code>git add Mathlib.lean</code>, then <code>git commit</code> and then <code>git push</code> and then do I need to do another PR in GitHub?</p>",
        "id": 565497287,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766822971
    },
    {
        "content": "<p>All of that sounds right, except you don't need to do another PR in GH after <code>git push</code>.</p>",
        "id": 565497528,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1766823306
    },
    {
        "content": "<p>It will update your existing PR</p>",
        "id": 565497537,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1766823313
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"952635\">Michael Novak</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Looking.20for.20feedback.20on.20a.20theorem.20statement/near/565497287\">said</a>:</p>\n<blockquote>\n<p>So, just to make sure I understand, because I barely know how to use git: I first do this command inside the mathlib fork in my computer, then I do <code>git commit</code> and then <code>git push</code> and then do I need to do another PR in GitHub?</p>\n</blockquote>\n<p>If you are working in the branch of the fork you are merging with mathlib (the PR) , then whatever you commit/push into that branch will be part of the merge PR.</p>\n<p>i.e the changes you commit/push to the branch <a href=\"https://github.com/michael-novak-math/mathlib4/tree/arclength-reparametrization-branch\">michael-novak-math:arclength-reparametrization-branch</a>, will be reflected in the current PR you have .</p>",
        "id": 565497543,
        "sender_full_name": "Yan Yablonovskiy 🇺🇦",
        "timestamp": 1766823330
    },
    {
        "content": "<p>Thank you very much!</p>",
        "id": 565497550,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766823358
    },
    {
        "content": "<p>I get this error when I try to do <code>git push</code>:<br>\n<code> ! [rejected]              arclength-reparametrization-branch -&gt; arclength-reparametrization-branch (fetch first)\nerror: failed to push some refs to 'https://github.com/michael-novak-math/mathlib4.git'\nhint: Updates were rejected because the remote contains work that you do not\nhint: have locally. This is usually caused by another repository pushing to\nhint: the same ref. If you want to integrate the remote changes, use\nhint: 'git pull' before pushing again.\nhint: See the 'Note about fast-forwards' in 'git push --help' for details. </code></p>",
        "id": 565497762,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766823782
    },
    {
        "content": "<p>I tried to follow the hints and somehow managed to push now. I hope the tests will work now.</p>",
        "id": 565498642,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766824946
    },
    {
        "content": "<p>There's a new error in the PR now: <a href=\"https://github.com/leanprover-community/mathlib4/actions/runs/20536801096/job/58996064274\">https://github.com/leanprover-community/mathlib4/actions/runs/20536801096/job/58996064274</a>. Could someone explain what's the problem?</p>",
        "id": 565499560,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766826353
    },
    {
        "content": "<p>If you click on the little arrow next to \"lint mathlib\" and then on the coloured line with the <span aria-label=\"caution\" class=\"emoji emoji-26a0\" role=\"img\" title=\"caution\">:caution:</span> icon, it should show actionable errors</p>",
        "id": 565500115,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1766827214
    },
    {
        "content": "<p>But you should see those as warnings in your editor locally as well</p>",
        "id": 565500173,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1766827317
    },
    {
        "content": "<p>In fact, the \"build mathlib\" step shows you the same errors (so I'd click on that instead, as it comes first).</p>",
        "id": 565500406,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1766827721
    },
    {
        "content": "<p>I left a comment explaining a bit more how to solve these. The second one (\"cannot import non-modules inside modules\") is indeed not beginner-friendly. I am sure that one will get better in one or two months. You should see the first one in your editor, and it should tell you mostly what to do.</p>",
        "id": 565500435,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1766827777
    },
    {
        "content": "<p>If you can't see those warnings in the editor, please ask here! (You don't want to miss out on that.)</p>",
        "id": 565500465,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1766827823
    },
    {
        "content": "<p>If you're not sure how to address them, similarly.</p>",
        "id": 565500488,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1766827868
    },
    {
        "content": "<p>I also left a few quick comments. I will return to it later (once you had a chance to address all comments), perhaps only in mid-January.</p>",
        "id": 565500497,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1766827894
    },
    {
        "content": "<p>Thank you very much, I'll look into that</p>",
        "id": 565500950,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766828508
    },
    {
        "content": "<p>Sorry for the newbie question: if I made some changes (commits) to the branch in GitHub on the web browser, then how can I update the local fork on my computer?</p>",
        "id": 565513868,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766845603
    },
    {
        "content": "<p>You can just Google or ask an LLM for how to work git and GitHub, this is not lean specific and there are a ton of good resources. You can use <code>git pull</code> and <code>git push</code> to move commits between your local fork on your computer and GitHub.</p>",
        "id": 565514703,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1766846932
    },
    {
        "content": "<p>Sorry, I had a bit of an issue that <code>git pull</code> didn't work, but it was resolved, I wanted to delete the comment but there isn't such an option. I have now a different issue which I think is more related to lean: in the mathlib fork in my computer, every file that starts with <code>mudule</code> has this error:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>unknown module prefix 'Mathlib'\n\nNo directory 'Mathlib' or file 'Mathlib.olean' in the search path entries:\n/home/michael/.elan/toolchains/leanprover--lean4---v4.27.0-rc1/lib/lean\n</code></pre></div>",
        "id": 565515495,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766847924
    },
    {
        "content": "<p>Huh, it definitely shouldn't do that!</p>",
        "id": 565515555,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1766848019
    },
    {
        "content": "<p>Also a different issue, that might be unrelated and just due to the fact that  my computer is pretty bad or might be connected is that every time I tried to run <code>lake build</code> in the fork in my computer, my CPU gets to nearly 100% usage and after a minute or two my computer crash.</p>",
        "id": 565515873,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766848414
    },
    {
        "content": "<p>uhoh</p>",
        "id": 565516032,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766848662
    },
    {
        "content": "<p>did you <code>lake exe cache get</code></p>",
        "id": 565516040,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766848672
    },
    {
        "content": "<p>no, should I do it?</p>",
        "id": 565516071,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766848753
    },
    {
        "content": "<p>is <code>lake build</code> actually building things or is it just counting up to 7000</p>",
        "id": 565516074,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766848756
    },
    {
        "content": "<p>how can I know?</p>",
        "id": 565516089,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766848790
    },
    {
        "content": "<p>it reportes the current file that it's working on</p>",
        "id": 565516103,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766848812
    },
    {
        "content": "<p>can you read the file name before it disappears</p>",
        "id": 565516117,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766848829
    },
    {
        "content": "<p>nvm</p>",
        "id": 565516146,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766848874
    },
    {
        "content": "<p>just run <code>lake exe cache get</code></p>",
        "id": 565516158,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766848884
    },
    {
        "content": "<p>o.k</p>",
        "id": 565516167,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766848901
    },
    {
        "content": "<p>it won't really do any harm even if it's unnecessary</p>",
        "id": 565516171,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766848908
    },
    {
        "content": "<p>This was the output:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>Current branch: arclength-reparametrization-branch\nUsing cache (Azure) from origin: michael-novak-math/mathlib4\nAttempting to download 7794 file(s) from leanprover-community/mathlib4 cache\nDownloaded: 7563 file(s) [attempted 7794/7794 = 100%, 75 KB/s]]\nAttempting to download 231 file(s) from michael-novak-math/mathlib4 cache\nDownloaded: 0 file(s) [attempted 231/231 = 100%, 1 KB/s]\nWarning: some files were not found in the cache.\nThis usually means that your local checkout of mathlib4 has diverged from upstream.\nIf you push your commits to a branch of the mathlib4 repository, CI will build the oleans and they will be available later.\nAlternatively, if you already have pushed your commits to a branch, this may mean the CI build has failed part-way through building.\nDecompressing 7563 file(s)\n/home/michael/.cache/mathlib/86edffd46437e77c.ltar: removing corrupted file\n/home/michael/.cache/mathlib/170d053d38e23641.ltar: removing corrupted file\n/home/michael/.cache/mathlib/139738388054bd6b.ltar: removing corrupted file\n/home/michael/.cache/mathlib/7b1ef49e559b72ee.ltar: removing corrupted file\n/home/michael/.cache/mathlib/75f68ef6cf7cb2e1.ltar: removing corrupted file\n/home/michael/.cache/mathlib/9d244000e72d4a57.ltar: removing corrupted file\n/home/michael/.cache/mathlib/9fdca3b7ca56a861.ltar: removing corrupted file\n/home/michael/.cache/mathlib/2edabac7ae2aad3e.ltar: removing corrupted file\n/home/michael/.cache/mathlib/b893c179d26576fb.ltar: removing corrupted file\n/home/michael/.cache/mathlib/42994fe1c2ba7f7f.ltar: removing corrupted file\n/home/michael/.cache/mathlib/e36e90e403398a7a.ltar: removing corrupted file\n/home/michael/.cache/mathlib/df43610ff397fdbc.ltar: removing corrupted file\n/home/michael/.cache/mathlib/fb97058d81f0ea33.ltar: removing corrupted file\n/home/michael/.cache/mathlib/c667a1fd6d47c342.ltar: removing corrupted file\n/home/michael/.cache/mathlib/2d9d752dc84df6c2.ltar: removing corrupted file\n/home/michael/.cache/mathlib/8cc3915510034709.ltar: removing corrupted file\n/home/michael/.cache/mathlib/2faa083c35b04473.ltar: removing corrupted file\n/home/michael/.cache/mathlib/efc8ad6a9e3dc11c.ltar: removing corrupted file\n/home/michael/.cache/mathlib/9c33f8e3ac60c6f3.ltar: removing corrupted file\n/home/michael/.cache/mathlib/5fab394be4b85953.ltar: removing corrupted file\n/home/michael/.cache/mathlib/97c5c9596a34b84f.ltar: removing corrupted file\n/home/michael/.cache/mathlib/2b9851e933dea3f7.ltar: removing corrupted file\n/home/michael/.cache/mathlib/eea55a04deb43599.ltar: removing corrupted file\n/home/michael/.cache/mathlib/c5cc97e6ea6fe4b7.ltar: removing corrupted file\n/home/michael/.cache/mathlib/f45c2549b3137afc.ltar: removing corrupted file\n/home/michael/.cache/mathlib/ff9b4fad0d83652b.ltar: removing corrupted file\n/home/michael/.cache/mathlib/85c88e68cc5bf021.ltar: removing corrupted file\n/home/michael/.cache/mathlib/c059373475063c11.ltar: removing corrupted file\n/home/michael/.cache/mathlib/d5a759053a4e3806.ltar: removing corrupted file\n/home/michael/.cache/mathlib/3def00a9e926294c.ltar: removing corrupted file\n/home/michael/.cache/mathlib/34e5293a1821697f.ltar: removing corrupted file\n/home/michael/.cache/mathlib/e6bd4fc21fc66007.ltar: removing corrupted file\n/home/michael/.cache/mathlib/b2b7deac8f9375b8.ltar: removing corrupted file\n/home/michael/.cache/mathlib/d807f1e04152b9ab.ltar: removing corrupted file\n/home/michael/.cache/mathlib/a19641ad6e99999b.ltar: removing corrupted file\n/home/michael/.cache/mathlib/cdedd14b4465f3a4.ltar: removing corrupted file\n/home/michael/.cache/mathlib/36696acba7d0da4e.ltar: removing corrupted file\n/home/michael/.cache/mathlib/3ccd3d1eec9a76b8.ltar: removing corrupted file\n/home/michael/.cache/mathlib/18ba69dca29f31a1.ltar: removing corrupted file\n/home/michael/.cache/mathlib/1eccb9bec3829a40.ltar: removing corrupted file\n/home/michael/.cache/mathlib/b5807fb076ddeb8b.ltar: removing corrupted file\n/home/michael/.cache/mathlib/422c50ba01a33cf0.ltar: removing corrupted file\n/home/michael/.cache/mathlib/341351784cf06f45.ltar: removing corrupted file\n/home/michael/.cache/mathlib/11a2789f521a380c.ltar: removing corrupted file\n/home/michael/.cache/mathlib/cc15ff521b3c30a5.ltar: removing corrupted file\n/home/michael/.cache/mathlib/7ba647abddbd8d0a.ltar: removing corrupted file\n/home/michael/.cache/mathlib/db6c23dd2e59a69b.ltar: removing corrupted file\n/home/michael/.cache/mathlib/28e7309dea9a5a27.ltar: removing corrupted file\n/home/michael/.cache/mathlib/ec12b715e2b06634.ltar: removing corrupted file\n/home/michael/.cache/mathlib/1143c749d3608aaf.ltar: removing corrupted file\n/home/michael/.cache/mathlib/a5bdd54c7af6587b.ltar: removing corrupted file\n/home/michael/.cache/mathlib/5992b30c5ebb8719.ltar: removing corrupted file\n/home/michael/.cache/mathlib/fd3444b0e2051796.ltar: removing corrupted file\n/home/michael/.cache/mathlib/77d727c1e0ded21f.ltar: removing corrupted file\n/home/michael/.cache/mathlib/350a1f8d0293f929.ltar: removing corrupted file\n/home/michael/.cache/mathlib/ba21b5298072ccec.ltar: removing corrupted file\nUnpacked in 35110 ms\nCompleted successfully!\n</code></pre></div>",
        "id": 565516273,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766849063
    },
    {
        "content": "<p>well it looks like something happened</p>",
        "id": 565516284,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766849089
    },
    {
        "content": "<p>now does <code>lake build </code> work?</p>",
        "id": 565516300,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766849110
    },
    {
        "content": "<p>Should I try it again? And if so, should I stop it if I see that my CPU usage gets very high to prevent my computer from crashing again or just let it continue?</p>",
        "id": 565516388,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766849271
    },
    {
        "content": "<p>do try it again</p>",
        "id": 565516419,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766849319
    },
    {
        "content": "<p>Btw, the message about <code>module</code> still exists</p>",
        "id": 565516431,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766849330
    },
    {
        "content": "<p>uhoh</p>",
        "id": 565516435,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766849336
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Looking.20for.20feedback.20on.20a.20theorem.20statement/near/565516419\">said</a>:</p>\n<blockquote>\n<p>do try it again</p>\n</blockquote>\n<p>O.k</p>",
        "id": 565516439,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766849342
    },
    {
        "content": "<p>I think of you don't want it to crash your computer then that's fine</p>",
        "id": 565516455,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766849362
    },
    {
        "content": "<p>is your PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/33330\">#33330</a></p>",
        "id": 565516486,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766849410
    },
    {
        "content": "<p>I tried it again but stopped in the middle to prevent a computer crash because the CPU was getting to 90%. This was the output:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>[michael@libre-d16-desktop mathlib4]$ lake build\n⚠ [1393/5859] Built Mathlib.Algebra.Order.PUnit\nwarning: /home/michael/documents/mathematics/lean-projects/mathlib4/.lake/build/lib/lean/Mathlib/Algebra/Order/PUnit.trace: offset 0: unexpected end of input\n⚠ [1399/6113] Built Mathlib.Deprecated.RingHom\nwarning: /home/michael/documents/mathematics/lean-projects/mathlib4/.lake/build/lib/lean/Mathlib/Deprecated/RingHom.trace: offset 0: unexpected end of input\n⚠ [1419/6113] Built Mathlib.Data.Int.Range\nwarning: /home/michael/documents/mathematics/lean-projects/mathlib4/.lake/build/lib/lean/Mathlib/Data/Int/Range.trace: offset 0: unexpected end of input\n⣾ [1427/6113] Running Mathlib.Combinatorics.Quiver.Path.Vertices (+ 32 more)^C\n</code></pre></div>",
        "id": 565516566,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766849529
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Looking.20for.20feedback.20on.20a.20theorem.20statement/near/565516486\">said</a>:</p>\n<blockquote>\n<p>is your PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/33330\">#33330</a></p>\n</blockquote>\n<p>yes</p>",
        "id": 565516579,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766849541
    },
    {
        "content": "<p>I guess I don't really know what to do now</p>",
        "id": 565516861,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766849958
    },
    {
        "content": "<p>I'm not sure if going up to a high CPU usage is normal or not</p>",
        "id": 565516880,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766849973
    },
    {
        "content": "<p>do you think that the <code>module</code> error is related to the <code>lake build</code> issue?</p>",
        "id": 565516939,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766850058
    },
    {
        "content": "<p>probably not?</p>",
        "id": 565516947,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766850071
    },
    {
        "content": "<p>that one is relatively easy to fix</p>",
        "id": 565516953,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766850083
    },
    {
        "content": "<p>Because the <code>module</code> issue is the one that most practically bothering me now from trying to fix some things in the PR.</p>",
        "id": 565517023,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766850151
    },
    {
        "content": "<p>what's the error you're getting?</p>",
        "id": 565517067,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766850230
    },
    {
        "content": "<p>looking at your PR I don't think you should get this kind of error so the fix may be just a <code>git pull</code></p>",
        "id": 565517089,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766850268
    },
    {
        "content": "<p>In the mathlib fork in my computer, every file that starts with <code>mudule</code> has this error:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>unknown module prefix 'Mathlib'\n\nNo directory 'Mathlib' or file 'Mathlib.olean' in the search path entries:\n/home/michael/.elan/toolchains/leanprover--lean4---v4.27.0-rc1/lib/lean\n</code></pre></div>",
        "id": 565517093,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766850283
    },
    {
        "content": "<p>oh that's</p>",
        "id": 565517113,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766850315
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Looking.20for.20feedback.20on.20a.20theorem.20statement/near/565517089\">said</a>:</p>\n<blockquote>\n<p>looking at your PR I don't think you should get this kind of error so the fix may be just a <code>git pull</code></p>\n</blockquote>\n<p>I already did it and if I do it again I just get the message <code>Already up to date.</code></p>",
        "id": 565517125,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766850350
    },
    {
        "content": "<p>that's not the error I thought you had</p>",
        "id": 565517135,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766850364
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"952635\">Michael Novak</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Looking.20for.20feedback.20on.20a.20theorem.20statement/near/565517093\">said</a>:</p>\n<blockquote>\n<p>In the mathlib fork in my computer, every file that starts with <code>mudule</code> has this error:</p>\n<p><div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>unknown module prefix 'Mathlib'\n\nNo directory 'Mathlib' or file 'Mathlib.olean' in the search path entries:\n/home/michael/.elan/toolchains/leanprover--lean4---v4.27.0-rc1/lib/lean\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>is that just every file or are there files you don't get this error on</p>",
        "id": 565517150,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766850404
    },
    {
        "content": "<p>also, does it list only that one search path entry?</p>",
        "id": 565517184,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766850473
    },
    {
        "content": "<p>I didn't check every file, but on the few files that I did check, they all had this error, so I believe they all have it, but can't tell for sure.</p>",
        "id": 565517202,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766850494
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Looking.20for.20feedback.20on.20a.20theorem.20statement/near/565517184\">said</a>:</p>\n<blockquote>\n<p>also, does it list only that one search path entry?</p>\n</blockquote>\n<p>yes</p>",
        "id": 565517213,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766850528
    },
    {
        "content": "<p>maybe try deleting your <code>mathlib4/.lake</code> folder?</p>",
        "id": 565517266,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766850638
    },
    {
        "content": "<p>and then run <code>lake exe cache get</code> again</p>",
        "id": 565517283,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766850660
    },
    {
        "content": "<p>o.k, I'll try it, thanks</p>",
        "id": 565517303,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766850698
    },
    {
        "content": "<p>if this doesn't work then I'm out of ideas</p>",
        "id": 565517338,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766850759
    },
    {
        "content": "<p>This is the output:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>[michael@libre-d16-desktop mathlib4]$ lake update\ninfo: toolchain not updated; already up-to-date\ninfo: mathlib: running post-update hooks\n[michael@libre-d16-desktop mathlib4]$ git pull\nAlready up to date.\n[michael@libre-d16-desktop mathlib4]$ ranger\n[michael@libre-d16-desktop mathlib4]$ lake exe cache get\ninfo: plausible: cloning https://github.com/leanprover-community/plausible\ninfo: plausible: checking out revision 'b3dd6c3ebc0a71685e86bea9223be39ea4c299fb'\ninfo: LeanSearchClient: cloning https://github.com/leanprover-community/LeanSearchClient\ninfo: LeanSearchClient: checking out revision '5ce7f0a355f522a952a3d678d696bd563bb4fd28'\ninfo: importGraph: cloning https://github.com/leanprover-community/import-graph\ninfo: importGraph: checking out revision 'cff9dd30f2c161b9efd7c657cafed1f967645890'\ninfo: proofwidgets: cloning https://github.com/leanprover-community/ProofWidgets4\ninfo: proofwidgets: checking out revision 'ef8377f31b5535430b6753a974d685b0019d0681'\ninfo: aesop: cloning https://github.com/leanprover-community/aesop\ninfo: aesop: checking out revision 'fa78cf032194308a950a264ed87b422a2a7c1c6c'\ninfo: Qq: cloning https://github.com/leanprover-community/quote4\ninfo: Qq: checking out revision '8920dcbb96a4e8bf641fc399ac9c0888e4a6be72'\ninfo: batteries: cloning https://github.com/leanprover-community/batteries\ninfo: batteries: checking out revision '2e16f91af2a97975e5d2fac906494cd6c17ba255'\ninfo: Cli: cloning https://github.com/leanprover/lean4-cli\ninfo: Cli: checking out revision '726b98c53e2da249c1de768fbbbb5e67bc9cef60'\nFetching ProofWidgets cloud release... done!\nCurrent branch: arclength-reparametrization-branch\nUsing cache (Azure) from origin: michael-novak-math/mathlib4\nAttempting to download 287 file(s) from leanprover-community/mathlib4 cache\nDownloaded: 56 file(s) [attempted 287/287 = 100%, 1 KB/s]]\nAttempting to download 231 file(s) from michael-novak-math/mathlib4 cache\nDownloaded: 0 file(s) [attempted 231/231 = 100%, 1 KB/s]\nWarning: some files were not found in the cache.\nThis usually means that your local checkout of mathlib4 has diverged from upstream.\nIf you push your commits to a branch of the mathlib4 repository, CI will build the oleans and they will be available later.\nAlternatively, if you already have pushed your commits to a branch, this may mean the CI build has failed part-way through building.\nDecompressing 7563 file(s)\nUnpacked in 41155 ms\nCompleted successfully!\n</code></pre></div>",
        "id": 565517424,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766850908
    },
    {
        "content": "<p>did it fix the problem</p>",
        "id": 565517456,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766850976
    },
    {
        "content": "<p>It didn't fix the <code>module</code> error</p>",
        "id": 565517499,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766851051
    },
    {
        "content": "<p>what if you restart Lean?</p>",
        "id": 565517518,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766851078
    },
    {
        "content": "<p>how can I do this?</p>",
        "id": 565517524,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766851094
    },
    {
        "content": "<p>you are using VSCode?</p>",
        "id": 565517537,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766851115
    },
    {
        "content": "<p>click on the search bar at the very top and type <code>&gt;restart server</code></p>",
        "id": 565517828,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766851282
    },
    {
        "content": "<p>and pick the option that restarts the lean4 server</p>",
        "id": 565517837,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766851303
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Looking.20for.20feedback.20on.20a.20theorem.20statement/near/565517537\">said</a>:</p>\n<blockquote>\n<p>you are using VSCode?</p>\n</blockquote>\n<p>typically I used nvim, but now when I use nvim on this fork my computer also crash after a minute or two, although I didn't check this in the last hour or two so maybe it changed. So now I use codium (basically VSCode) and this is where is see the <code>module</code> error,  but at least there are no crashes.</p>",
        "id": 565517870,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766851346
    },
    {
        "content": "<p>oh</p>",
        "id": 565517882,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766851364
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Looking.20for.20feedback.20on.20a.20theorem.20statement/near/565517828\">said</a>:</p>\n<blockquote>\n<p>click on the search bar at the very top and type <code>&gt;restart server</code></p>\n</blockquote>\n<p>O.k</p>",
        "id": 565517891,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766851371
    },
    {
        "content": "<p>It didn't make a difference. I also closed the editor and reopened again, but still the same error.</p>",
        "id": 565518002,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766851562
    },
    {
        "content": "<p>then I'm really out of ideas</p>",
        "id": 565518022,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766851580
    },
    {
        "content": "<p>O.K, I have no idea what happened, maybe the gods wanted to help us, but some how when I tried now to open the files in nvim, there isn't any <code>module</code> errors <span aria-label=\"joy\" class=\"emoji emoji-1f602\" role=\"img\" title=\"joy\">:joy:</span> Thank you very much for your help!</p>",
        "id": 565518260,
        "sender_full_name": "Michael Novak",
        "timestamp": 1766851945
    }
]