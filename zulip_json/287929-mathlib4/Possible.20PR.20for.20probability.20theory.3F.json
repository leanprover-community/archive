[
    {
        "content": "<p>Hi all, I'm working on an implementation for Bernoulli random variables. I think it might be a good fit for Mathlib as there are quite a few other commonly used probability distributions in there already. Also, I'm following the existing Mathlib code for the geometric distribution, so integration should be relatively easy, hopefully.</p>",
        "id": 478232837,
        "sender_full_name": "Rick de Wolf",
        "timestamp": 1729586100
    },
    {
        "content": "<p>(<span class=\"user-mention\" data-user-id=\"350992\">@Rémy Degenne</span>, hope you don't mind me pinging you)</p>",
        "id": 478232880,
        "sender_full_name": "Rick de Wolf",
        "timestamp": 1729586118
    },
    {
        "content": "<p>My question is, is there any interest in a PR like this?</p>",
        "id": 478233543,
        "sender_full_name": "Rick de Wolf",
        "timestamp": 1729586370
    },
    {
        "content": "<p>Hi Rick, <br>\nI've written a few files in this direction in the past, and I can tell you that adding some more distributions is certainly desirable. (I've been too busy lately to work on Mathlib myself, unfortunately). What is important to keep in mind is that in Mathlib we typically aim for generality: if possible, I believe it would be nice to start with the categorical distribution, after which you could make a separate file for the bernoulli distribution as a special case. (Similar to how the exponential distribution is written as a special case of the gamma distribution). </p>\n<p>Perhaps Rémy has some thoughts on the properties of distributions that we would like to have available for each distribution, to make sure that have some reliable API across the various distributions?</p>",
        "id": 478238035,
        "sender_full_name": "Josha Dekker",
        "timestamp": 1729587836
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"603023\">Rick de Wolf</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Possible.20PR.20for.20probability.20theory.3F/near/478232837\">said</a>:</p>\n<blockquote>\n<p>I'm working on an implementation for Bernoulli random variables.</p>\n</blockquote>\n<p>To me this could mean many things. Can you clarify whether you are defining an explicit Bernoulli random variable, defining a predicate saying that a random variable is Bernoulli, proving properties of Bernoulli random variable, something else?</p>",
        "id": 478238898,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1729588125
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"673728\">@Josha Dekker</span> That is great to hear! Generalizing to a categorical distribution makes a lot of sense. When I was working on this last night I tried to use <code>PMF.ofFinset</code> but that becomes quite clunky even for something as simple as a Categorical PMF <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span>. I can have a go at that and then maybe PR both the categorical and the Bernoulli distribution at the same time?</p>",
        "id": 478240030,
        "sender_full_name": "Rick de Wolf",
        "timestamp": 1729588536
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"603023\">Rick de Wolf</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Possible.20PR.20for.20probability.20theory.3F/near/478240030\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"673728\">Josha Dekker</span> That is great to hear! Generalizing to a categorical distribution makes a lot of sense. When I was working on this last night I tried to use <code>PMF.ofFinset</code> but that becomes quite clunky even for something as simple as a Categorical PMF <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span>. I can have a go at that and then maybe PR both the categorical and the Bernoulli distribution at the same time?</p>\n</blockquote>\n<p>You could definitely develop them in parallel, but you may want to split them in two separate PR's (one depending on the other) to speed up the reviewing process. I'd probably stick to categorical at first. If PMF.ofFinset is too clunky to work with, perhaps it is easier to work directly with a PMF as follows: if I have <code>k</code> categories with probabilities <code>p_1,..,p_k</code>, I can define a PMF (in pseudo-code): <code>f(n) = n &lt;= k ? p_n : 0</code>. </p>\n<p>But it may be that a small API lemma around PMF.ofFinset is missing/is overlooked, which makes that approach viable?</p>\n<p>edit: I see that what I'm describing is practically PMF.ofFinset, I'd stick to that one.</p>",
        "id": 478241258,
        "sender_full_name": "Josha Dekker",
        "timestamp": 1729588933
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span> I am following the geometric distribution's implementation in Mathlib as a guide, so the overall setup is almost the same as that one. To be more concrete though, I'm defining a Bernoulli PMF, using <code>  def bernoulli_pmf_real (p : ℝ) (b : Bool) : ℝ := if b then p else (1-p)</code> as a basis. (And yes, I realized it should be {0, 1} instead of Bool last night, that's the one thing that's left to do.) There is more in my file though - there is a lemma stating <code>bernoulli_pmf_real</code> sums to one, for example, and there is a definition for the induced Measure on Bool.</p>",
        "id": 478241457,
        "sender_full_name": "Rick de Wolf",
        "timestamp": 1729589006
    },
    {
        "content": "<p>Do you know about <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=PMF.bernoulli#doc\">docs#PMF.bernoulli</a> ?</p>",
        "id": 478241692,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1729589078
    },
    {
        "content": "<p>In fact, I don't like this definition and would rather have it be a PMF over <code>Prop</code>, because that's how binomial random graphs are defined (as a family of independent random Prop-valued Bernoulli variables)</p>",
        "id": 478241848,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1729589146
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"673728\">Josha Dekker</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Possible.20PR.20for.20probability.20theory.3F/near/478241258\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"603023\">Rick de Wolf</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Possible.20PR.20for.20probability.20theory.3F/near/478240030\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"673728\">Josha Dekker</span> That is great to hear! Generalizing to a categorical distribution makes a lot of sense. When I was working on this last night I tried to use <code>PMF.ofFinset</code> but that becomes quite clunky even for something as simple as a Categorical PMF <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span>. I can have a go at that and then maybe PR both the categorical and the Bernoulli distribution at the same time?</p>\n</blockquote>\n<p>You could definitely develop them in parallel, but you may want to split them in two separate PR's (one depending on the other) to speed up the reviewing process. I'd probably stick to categorical at first. If PMF.ofFinset is too clunky to work with, perhaps it is easier to work directly with a PMF as follows: if I have <code>k</code> categories with probabilities <code>p_1,..,p_k</code>, I can define a PMF (in pseudo-code): <code>f(n) = n &lt;= k ? p_n : 0</code>. </p>\n<p>But it may be that a small API lemma around PMF.ofFinset is missing/is overlooked, which makes that approach viable?</p>\n<p>edit: I see that what I'm describing is practically PMF.ofFinset, I'd stick to that one.</p>\n</blockquote>\n<p>Yeah PMF.ofFinset basically does everything a categorical dist needs, but I'm not a fan of the interface. Maybe I'm missing something there, but I feel like there should be an interface that only needs to be given an array or similar datastructure with probability masses and automatically turns that into a PMF. I might be oversimplifying things though.</p>",
        "id": 478242414,
        "sender_full_name": "Rick de Wolf",
        "timestamp": 1729589311
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Possible.20PR.20for.20probability.20theory.3F/near/478241692\">said</a>:</p>\n<blockquote>\n<p>Do you know about <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=PMF.bernoulli#doc\">docs#PMF.bernoulli</a> ?</p>\n</blockquote>\n<p>No I did not haha This would make my code unncessary it seems. So a PR that changes the existing definition to use <code>Prop</code>s might be good then?</p>",
        "id": 478242919,
        "sender_full_name": "Rick de Wolf",
        "timestamp": 1729589477
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"603023\">Rick de Wolf</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Possible.20PR.20for.20probability.20theory.3F/near/478242414\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"673728\">Josha Dekker</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Possible.20PR.20for.20probability.20theory.3F/near/478241258\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"603023\">Rick de Wolf</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Possible.20PR.20for.20probability.20theory.3F/near/478240030\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"673728\">Josha Dekker</span> That is great to hear! Generalizing to a categorical distribution makes a lot of sense. When I was working on this last night I tried to use <code>PMF.ofFinset</code> but that becomes quite clunky even for something as simple as a Categorical PMF <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span>. I can have a go at that and then maybe PR both the categorical and the Bernoulli distribution at the same time?</p>\n</blockquote>\n<p>You could definitely develop them in parallel, but you may want to split them in two separate PR's (one depending on the other) to speed up the reviewing process. I'd probably stick to categorical at first. If PMF.ofFinset is too clunky to work with, perhaps it is easier to work directly with a PMF as follows: if I have <code>k</code> categories with probabilities <code>p_1,..,p_k</code>, I can define a PMF (in pseudo-code): <code>f(n) = n &lt;= k ? p_n : 0</code>. </p>\n<p>But it may be that a small API lemma around PMF.ofFinset is missing/is overlooked, which makes that approach viable?</p>\n<p>edit: I see that what I'm describing is practically PMF.ofFinset, I'd stick to that one.</p>\n</blockquote>\n<p>Yeah PMF.ofFinset basically does everything a categorical dist needs, but I'm not a fan of the interface. Maybe I'm missing something there, but I feel like there should be an interface that only needs to be given an array or similar datastructure with probability masses and automatically turns that into a PMF. I might be oversimplifying things though.</p>\n</blockquote>\n<p>It should not be hard to write API for this, i.e. a lemma that takes as input a vector <code>p</code> of probabilities and the hypothesis that they sum to 1, and returns a PMF:</p>\n<ul>\n<li>Define a function (pseudocode!) <code>f(n) = n &lt;= k ? p_n : 0</code>, and verify that this satisfies the conditions of <code>PMF.ofFinset</code>.</li>\n<li>Then call <code>PMF.ofFinset</code> to supply the PMF.</li>\n</ul>",
        "id": 478243005,
        "sender_full_name": "Josha Dekker",
        "timestamp": 1729589510
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"603023\">Rick de Wolf</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Possible.20PR.20for.20probability.20theory.3F/near/478242919\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Possible.20PR.20for.20probability.20theory.3F/near/478241692\">said</a>:</p>\n<blockquote>\n<p>Do you know about <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=PMF.bernoulli#doc\">docs#PMF.bernoulli</a> ?</p>\n</blockquote>\n<p>No I did not haha This would make my code unncessary it seems. So a PR that changes the existing definition to use <code>Prop</code>s might be good then?</p>\n</blockquote>\n<p>Or perhaps first generalise to categorical, then derive Bernoulli as a special case (still mapping to {0,1}) and then introducing a similar object which is prop-valued? This way we can avoid as much API duplication as possible?</p>",
        "id": 478243233,
        "sender_full_name": "Josha Dekker",
        "timestamp": 1729589588
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"603023\">Rick de Wolf</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Possible.20PR.20for.20probability.20theory.3F/near/478242919\">said</a>:</p>\n<blockquote>\n<p>So a PR that changes the existing definition to use <code>Prop</code>s might be good then?</p>\n</blockquote>\n<p>Yes. I would be happy with that. See <a href=\"https://github.com/YaelDillies/LeanCamCombi/blob/master/LeanCamCombi/Mathlib/Probability/ProbabilityMassFunction/Constructions.lean\">LeanCamCombi</a> for some work towards that. If people complain that they want the <code>Bool</code> version still, we could have two versions</p>",
        "id": 478243289,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1729589607
    },
    {
        "content": "<p>Sounds great! I'll look into defining a categorical distribution interface.</p>",
        "id": 478243383,
        "sender_full_name": "Rick de Wolf",
        "timestamp": 1729589638
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Possible.20PR.20for.20probability.20theory.3F/near/478243289\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"603023\">Rick de Wolf</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Possible.20PR.20for.20probability.20theory.3F/near/478242919\">said</a>:</p>\n<blockquote>\n<p>So a PR that changes the existing definition to use <code>Prop</code>s might be good then?</p>\n</blockquote>\n<p>Yes. I would be happy with that. See <a href=\"https://github.com/YaelDillies/LeanCamCombi/blob/master/LeanCamCombi/Mathlib/Probability/ProbabilityMassFunction/Constructions.lean\">LeanCamCombi</a> for some work towards that. If people complain that they want the <code>Bool</code> version still, we could have two versions</p>\n</blockquote>\n<p>What about deprecating the old version?</p>",
        "id": 478243538,
        "sender_full_name": "Rick de Wolf",
        "timestamp": 1729589680
    },
    {
        "content": "<p>Happy with it (although personally I think you can change in place), but again maybe people will complain. I just don't know.</p>",
        "id": 478243614,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1729589715
    },
    {
        "content": "<p>Alright, I can make a PR and we'll take it from there then. It would be my first time contributing to Mathlib so it might take me a minute to set things up.</p>",
        "id": 478243917,
        "sender_full_name": "Rick de Wolf",
        "timestamp": 1729589808
    },
    {
        "content": "<p>Probably not until the weekend at least.</p>",
        "id": 478243946,
        "sender_full_name": "Rick de Wolf",
        "timestamp": 1729589819
    },
    {
        "content": "<p>LeanCamCombi might be interesting for another thing I'm working on as well. Does it have anything for random graphs?</p>",
        "id": 478244119,
        "sender_full_name": "Rick de Wolf",
        "timestamp": 1729589876
    },
    {
        "content": "<p>Feel free to ask for help! I am happy to take to DMs to avoid spamming this thread</p>",
        "id": 478244161,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1729589883
    },
    {
        "content": "<p>Will do!</p>",
        "id": 478244229,
        "sender_full_name": "Rick de Wolf",
        "timestamp": 1729589897
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"603023\">Rick de Wolf</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Possible.20PR.20for.20probability.20theory.3F/near/478244119\">said</a>:</p>\n<blockquote>\n<p>LeanCamCombi might be interesting for another thing I'm working on as well. Does it have anything for random graphs?</p>\n</blockquote>\n<p>It doesn't have a huge lot, but I've worked out the definitions and quite immediately saw I needed to refactor mathlib, but I never did. <a href=\"https://github.com/YaelDillies/LeanCamCombi/tree/master/LeanCamCombi/ErdosRenyi\">Here</a> it is.</p>",
        "id": 478244384,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1729589939
    },
    {
        "content": "<p>We will need several definitions for Benoulli distributions: neither Bool nor Prop corresponds to what I would like to have for example (I want to be able to take sums and averages of Bernoulli r.v., to look at some limit of that, so something that coerces to Real).</p>\n<p>I don't know if the Bool definition is useful of if replacing that one with Prop would just be better. But let's name that <code>bernoulliBool</code> or <code>bernoulliProp</code> rather than just <code>bernoulli</code>?</p>",
        "id": 478246099,
        "sender_full_name": "Rémy Degenne",
        "timestamp": 1729590520
    },
    {
        "content": "<p>I'm planning on using Bernoulli distributions in a way that requires expectations and variances can be handled, so I'm happy to look into that Rémy <span aria-label=\"thumbs up\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"thumbs up\">:thumbs_up:</span> . Would a simple <code>Finset \\Real</code> work?</p>",
        "id": 478263856,
        "sender_full_name": "Rick de Wolf",
        "timestamp": 1729597051
    }
]