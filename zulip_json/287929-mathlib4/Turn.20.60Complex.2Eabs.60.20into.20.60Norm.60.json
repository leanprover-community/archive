[
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"488648\">Xavier Roblot</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2321454.20Protect.20some.20results.20about.20.60Complex.2Eabs.60/near/497882220\">said</a>:</p>\n<blockquote>\n<p>In any case, how would we do that explicitly?</p>\n</blockquote>\n<ol>\n<li>Move the <code>Norm Complex</code> instance earlier.</li>\n<li>Decide whether we duplicate basic <code>norm</code> API lemmas or move the <code>NormedAddCommGroup Complex</code> and <code>NormedRing</code> instances earlier.</li>\n<li>Make all the <code>Complex.abs</code> lemmas be one-liners from <code>norm</code> lemmas.</li>\n<li>Deprecate the <code>Complex.abs</code> lemmas.</li>\n</ol>",
        "id": 497882764,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1738758965
    },
    {
        "content": "<p>It would be interesting to know if there is a consensus that this is something we should do and if so, that this the way to do it.</p>",
        "id": 497909712,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1738766619
    },
    {
        "content": "<p>I'm in favour of this</p>",
        "id": 497985123,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1738790569
    },
    {
        "content": "<p>I'd also be happy to see <code>Complex.abs</code> gotten rid of.</p>",
        "id": 497985905,
        "sender_full_name": "David Loeffler",
        "timestamp": 1738790888
    },
    {
        "content": "<p>Reversing the simp lemmas such as <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Complex.norm_eq_abs#doc\">docs#Complex.norm_eq_abs</a> should probably be its own step in that process.</p>",
        "id": 497986211,
        "sender_full_name": "Frédéric Dupuis",
        "timestamp": 1738791018
    },
    {
        "content": "<p>Frédéric, I think that can only be done after step 2 of my plan above. So maybe step 2bis</p>",
        "id": 497987671,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1738791503
    },
    {
        "content": "<p>Ok, so I'd be interested in working on this  but I'll probably need some guidance. Would it be possible to move the relevant messages to a new topic? I tried to do it but I don't have the rights.</p>",
        "id": 498052115,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1738826651
    },
    {
        "content": "<p>7 messages were moved here from <a class=\"stream-topic\" data-stream-id=\"144837\" href=\"/#narrow/channel/144837-PR-reviews/topic/.2321454.20Protect.20some.20results.20about.20.02klzzwxh.3A0000.03\">#PR reviews &gt; #21454 Protect some results about <code>Complex.abs</code></a> by <span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span>.</p>",
        "id": 498166864,
        "sender_full_name": "Notification Bot",
        "timestamp": 1738860625
    },
    {
        "content": "<p>Link is broken. This one should work: <a href=\"#narrow/channel/144837-PR-reviews/topic/.2321454.20Protect.20some.20results.20about.20.60Complex.2Eabs.60\">#PR reviews &gt; #21454 Protect some results about &#96;Complex.abs&#96;</a></p>",
        "id": 498167000,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1738860671
    },
    {
        "content": "<p>So I made <a href=\"https://github.com/leanprover-community/mathlib4/pull/21494\">#21494</a> as a first step. This PR does the following:</p>\n<ul>\n<li>Create the new file <code>Data/Complex/Norm</code> with the minimal imports so that <code>Complex.norm</code> could be defined and related to <code>Complex.abs</code>.</li>\n<li>Move to <code>Data/Complex/Norm</code> all the results from <code>Analysis/Complex/Basic.lean</code>, where <code>Complex.norm</code> was defined, that depends only on the imports of <code>Data/Complex/Norm</code>.</li>\n</ul>\n<p>This is only code moving. No results was changed in this PR except the definition of the norm that I changed to:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Norm</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\">   </span><span class=\"o\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">Real.sqrt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">normSq</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"o\">)⟩</span>\n</code></pre></div>\n<p>so it still defeq to <code>Complex.abs</code>. </p>\n<p>Still, we are already getting to step 2 in Yaël's plan above. Indeed, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Norm#doc\">docs#Norm</a> is defined in <code>Mathlib.Analysis.Normed.Group.Basic</code>  which has some quite heavy imports. The file <code>Mathlib.Data.Complex.Abs</code> which would eventually be replaced by <code>Mathlib.Data.Complex.Norm</code> is imported by two files:  <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Complex/Order.html\">Mathlib.Data.Complex.Order</a> and  <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Complex/Exponential.html\">Mathlib.Data.Complex.Exponential</a>. </p>\n<p>The file <code>Mathlib.Data.Complex.Order</code> is only imported by <code>Mathlib.Analysis.Complex.Basic</code> so the added imports would not cause any problem in this direction, but in the other direction of the file <code>Mathlib.Data.Complex.Exponential</code>, the new imports could make a significant difference. </p>\n<p>So at this point we have to decide if adding these extra imports to all the basic Complex analysis files is acceptable or we should move the definition of <code>Norm</code> somewhere else to reduce the imports (and then, as mentioned by Yaël above), some API would probably need to be duplicated for the complex norm.</p>",
        "id": 498275733,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1738913580
    },
    {
        "content": "<p>I think we could have a very lightweight file that introduces <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Norm#doc\">docs#Norm</a> and similar notions, without any extra structure/axioms, just to provide the notation.</p>",
        "id": 498276405,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1738913946
    },
    {
        "content": "<p>Note that an extra option is to find a way to reduce the imports to <code>Analysis.Normed.Group.Basic</code>, which is independently useful</p>",
        "id": 498276690,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1738914112
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Turn.20.60Complex.2Eabs.60.20into.20.60Norm.60/near/498276405\">said</a>:</p>\n<blockquote>\n<p>I think we could have a very lightweight file that introduces <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Norm#doc\">docs#Norm</a> and similar notions, without any extra structure/axioms, just to provide the notation.</p>\n</blockquote>\n<p>Yes, but soon after you'll also want the very basic theorems... I am of the opinion that you should split the file a bit further down to make it useful</p>",
        "id": 498276816,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1738914166
    },
    {
        "content": "<p>Notation classes for <code>0</code>, <code>1</code>, <code>+</code>, <code>*</code>, <code>^</code>, etc are done at a very low level, and basic lemmas are in different files that import the notations. I think the same can be done here.</p>",
        "id": 498277173,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1738914362
    },
    {
        "content": "<p>Sure, but eg <code>‖a * b‖ = ‖a‖ * ‖b‖</code> for <code>a b : ℂ</code> is something we want really early on, I think</p>",
        "id": 498277483,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1738914503
    },
    {
        "content": "<p>If we prove early on <code>IsAbsoluteValue Complex.norm</code>, we should get all the basic properties that we need.</p>",
        "id": 498283659,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1738916866
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Turn.20.60Complex.2Eabs.60.20into.20.60Norm.60/near/498277483\">said</a>:</p>\n<blockquote>\n<p>Sure, but eg <code>‖a * b‖ = ‖a‖ * ‖b‖</code> for <code>a b : ℂ</code> is something we want really early on, I think</p>\n</blockquote>\n<p>Right. But that doesn't have to live in <code>Mathlib/Data/Norm.lean</code>, whereas having that file provide the notation typeclass could work well imho.</p>",
        "id": 498291489,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1738919327
    },
    {
        "content": "<p>I am saying that having the notation and nothing is basically useless. Happy to be proven wrong <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span></p>",
        "id": 498306126,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1738923871
    },
    {
        "content": "<p>But that's exactly what the situation is for most common notation, right? eg LE, Zero, Add, ...</p>",
        "id": 498309170,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738924890
    },
    {
        "content": "<p>Anyway, I made <a href=\"https://github.com/leanprover-community/mathlib4/pull/21541\">#21541</a> to see what it would look like.</p>",
        "id": 498309927,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1738925094
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Turn.20.60Complex.2Eabs.60.20into.20.60Norm.60/near/498309170\">said</a>:</p>\n<blockquote>\n<p>But that's exactly what the situation is for most common notation, right? eg LE, Zero, Add, ...</p>\n</blockquote>\n<p><a href=\"https://tqft.net/mathlib4files/Algebra/Group/Defs\">file#Algebra/Group/Defs</a> contains theorems, and those notations are much more foundational than norms.</p>",
        "id": 498311779,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1738925664
    },
    {
        "content": "<p>It also doesn't provide new notation.</p>",
        "id": 498312366,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1738925866
    },
    {
        "content": "<p>I did some experiments and the imports of  <code>Analysis.Normed.Group.Basic</code> could reduced to just: </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib.Analysis.Normed.Group.Seminorm</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib.Topology.Instances.ENNReal.Defs</span>\n</code></pre></div>\n<p>if the two results </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">controlled_prod_of_mem_closure</span>\n<span class=\"n\">controlled_prod_of_mem_closure_range</span>\n</code></pre></div>\n<p>are moved somewhere else. So maybe a refactor of this file should be the first step.</p>",
        "id": 498335980,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1738933405
    },
    {
        "content": "<p>Yeah, that sounds like an independently good idea</p>",
        "id": 498340412,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1738934786
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"488648\">Xavier Roblot</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Turn.20.60Complex.2Eabs.60.20into.20.60Norm.60/near/498335980\">said</a>:</p>\n<blockquote>\n<p>I did some experiments and the imports of <code>Analysis.Normed.Group.Basic</code> could reduced to just:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib.Analysis.Normed.Group.Seminorm</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib.Topology.Instances.ENNReal.Defs</span>\n</code></pre></div>\n<p>if the two results</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">controlled_prod_of_mem_closure</span>\n<span class=\"n\">controlled_prod_of_mem_closure_range</span>\n</code></pre></div>\n<p>are moved somewhere else. So maybe a refactor of this file should be the first step.</p>\n</blockquote>\n<p>I should note that this doesn't reduce the transitive imports very much. <code>Topology.Instances.ENNReal.Defs</code> is unfortunately quite heavy</p>",
        "id": 498342568,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1738935471
    },
    {
        "content": "<p>I was the one adding the <code>Topology.Instances.ENNReal.Defs</code> import (so 115 extra transitive imports) in <a href=\"https://github.com/leanprover-community/mathlib4/pull/20966\">#20966</a> simply because to get access to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ENNReal.isOpenEmbedding_coe#doc\">docs#ENNReal.isOpenEmbedding_coe</a> to prove <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=continuous_enorm#doc\">docs#continuous_enorm</a>. See <a href=\"https://github.com/leanprover-community/mathlib4/pull/20966/files#diff-67009df17b3a5774f47588bb4973789873c7d5227867d14f5adeede906f17e90R907-R908\">https://github.com/leanprover-community/mathlib4/pull/20966/files#diff-67009df17b3a5774f47588bb4973789873c7d5227867d14f5adeede906f17e90R907-R908</a>. Hopefully, we can split <code>Topology.Instances.ENNReal.Defs</code> so as to make this lemma available with less imports</p>",
        "id": 498342967,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1738935599
    },
    {
        "content": "<p>Alternatively, I was contemplating making the first few files about <code>MetricSpace</code> and <code>NormedGroup</code> topology-less, in the sense that we need to import the definition of a topological space and of a uniform space because that's part of the definition of a metric space, but we could try to import nothing more, and delay continuity results and similar to later files</p>",
        "id": 498343368,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1738935706
    },
    {
        "content": "<p>We could also move all the stuff about <code>nnnorm</code> and <code>enorm</code> in another file. Then, it would not be necessary to import <code>Topology.Instances.ENNReal.Defs</code> into <code>Analysis.Normed.Group.Basic</code></p>",
        "id": 498346199,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1738936559
    },
    {
        "content": "<p>I am explicitly against that since I want people to think of (and prove theorems about!) <code>norm</code>, <code>nnnorm</code> and <code>enorm</code> on an equal footing. Else their APIs will drift apart beyond recognition</p>",
        "id": 498347976,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1738937012
    },
    {
        "content": "<p>Yeah, I agree that would probably not be a good idea.</p>",
        "id": 498348233,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1738937088
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/21554\">#21554</a> is a tentative to split <code>Analysis.Normed.Group.Basic</code> into three files.</p>",
        "id": 498391309,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1738949695
    },
    {
        "content": "<p>Now, that <a href=\"https://github.com/leanprover-community/mathlib4/pull/21554\">#21554</a> has been merged, I have modified accordingly  <a href=\"https://github.com/leanprover-community/mathlib4/pull/21494\">#21494</a>. In this PR, the definition of the complex norm is moved from <code>Analysis.Complex.Norm</code> to  a new file <code>Data.Complex.Norm</code> with minimal imports (but with the definition of <code>Norm</code> still in <code>Mathlib.Analysis.Normed.Group.Basic</code>) together with all the results from <code>Analysis.Complex.Norm</code> that could be moved to the new file.</p>\n<p>Since the plan is eventually to replace <code>Data.Complex.Abs</code> by <code>Data.Complex.Norm</code>, I have, as an experiment, done that and replaced<code>Data.Complex.Abs</code> by <code>Data.Complex.Norm</code> in the two files that import <code>Data.Complex.Abs</code>. The result are <a href=\"https://github.com/leanprover-community/mathlib4/pull/21494#issuecomment-2639224392\">here</a>. If we think that this is acceptable, -- and in my opinion it is --, then it is not necessary to move the definition of <code>Norm</code> to a new file and it can stay in <code>Mathlib.Analysis.Normed.Group.Basic</code>.</p>",
        "id": 498701559,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1739177895
    },
    {
        "content": "<p>Looks great! Thanks, Xavier</p>",
        "id": 498701785,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1739177951
    },
    {
        "content": "<p>Note that the PR does not compile for the moment since the imports are not optimal. I'll fix that once there is a consensus that this is the way to do it.</p>",
        "id": 498710412,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1739180219
    },
    {
        "content": "<p>At this point, I think I need some guidance because I am not sure on how to proceed next. I made <a href=\"https://github.com/leanprover-community/mathlib4/pull/21730\">#21730</a> with</p>\n<ul>\n<li>All the basic results about <code>Complex.abs</code> proved directly for <code>Complex.norm</code></li>\n<li><code>Complex.abs</code> defined by</li>\n</ul>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">noncomputable</span><span class=\"w\"> </span><span class=\"n\">abbrev</span><span class=\"w\"> </span><span class=\"n\">abs</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">z</span><span class=\"bp\">‖</span>\n</code></pre></div>\n<ul>\n<li>All basic results about <code>Complex.abs</code> directly deduced from their <code>Complex.norm</code> counterparts. </li>\n</ul>\n<p>Here, by basic results, I mean all the results in <code>Data.Complex.Abs</code>. </p>\n<p>At this point, many things do not compile anymore mainly because <code>Complex.abs</code> was a <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AbsoluteValue#doc\">docs#AbsoluteValue</a> and that's not the case anymore. For example, let's have a look at <code>Data.Complex.Order</code>around <a href=\"https://github.com/leanprover-community/mathlib4/blob/14dd86b1230aa95ee31fdf5fbae1ab3e7bd1be6d/Mathlib/Data/Complex/Order.lean#L102\">L102</a>. There was:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">abs</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">apply_nonneg</span><span class=\"w\"> </span><span class=\"n\">abs</span><span class=\"w\"> </span><span class=\"n\">z</span>\n</code></pre></div>\n<p>that's easy, I can just replace it by</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">abs</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">norm_nonneg</span><span class=\"w\"> </span><span class=\"n\">z</span>\n</code></pre></div>\n<p>and everything's fine. But then, a couple lines down (L109): </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">neg_re</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">abs.map_neg</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">re_eq_abs</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>Here, <code>abs.map_neg</code> worked because <code>Complex.abs</code> was a <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AbsoluteValue#doc\">docs#AbsoluteValue</a>, but I does not work anymore. I want to replace it with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=norm_neg#doc\">docs#norm_neg</a> but that fails because, well, <code>abs z</code> is not <code>‖z‖</code>. I can get around that using a rewrite lemma that replaces<code>abs</code> by <code>‖z‖</code> but that adds extra rewrites that we'll eventually have to delete when <code>Complex.abs</code>is removed for good. So it does not feel like the right solution.</p>\n<p>Thus, I'd like to ask: is there something I'm missing? Is there a better way to proceed?</p>",
        "id": 499057503,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1739293688
    },
    {
        "content": "<p>Does <code>rw</code> not see through an <code>abbrev</code>?</p>",
        "id": 499063594,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1739295451
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Turn.20.60Complex.2Eabs.60.20into.20.60Norm.60/near/498347976\">said</a>:</p>\n<blockquote>\n<p>I am explicitly against that since I want people to think of (and prove theorems about!) <code>norm</code>, <code>nnnorm</code> and <code>enorm</code> on an equal footing. Else their APIs will drift apart beyond recognition</p>\n</blockquote>\n<p>As a more explicit example, I'm currently generalising mathlib theorems from <code>norm</code> or <code>nnnorm</code> to <code>enorm</code> when possible, as that will include ENNReal. (In the carleson project, we would like to talk about e.g. L^p-norms of a function which can be infinite; this refactor is needed to make this not too painful.) So, I'd like to place enorm theorems next to nnnorm theorems (and even investigate removing the nnnorm ones for an enorm statement).</p>",
        "id": 499091901,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1739305283
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/21670\">#21670</a> is the next open PR towards that effort, by the way.</p>",
        "id": 499092035,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1739305338
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Turn.20.60Complex.2Eabs.60.20into.20.60Norm.60/near/499063594\">said</a>:</p>\n<blockquote>\n<p>Does <code>rw</code> not see through an <code>abbrev</code>?</p>\n</blockquote>\n<p>Nope. </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">rewrite'</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">did</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">find</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">pattern</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">expression</span>\n<span class=\"w\">  </span><span class=\"bp\">‖</span><span class=\"n\">z</span><span class=\"bp\">‖</span>\n</code></pre></div>\n<p>The goal is </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"n\">z</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">re</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">z.abs</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div>",
        "id": 499093513,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1739305971
    },
    {
        "content": "<p>Ok, so I found a way to proceed which I think is correct: for any result about <code>Complex.abs</code>, prove it first for the <code>Complex.norm</code> and then use it to prove directly the corresponding <code>Complex.abs</code> result. In this way, no rewrite from <code>Complex.abs</code> to <code>Complex.norm</code> is necessary and, eventually, we will just deprecate the <code>Complex.abs</code> results to their <code>Complex.norm</code> counterparts.</p>",
        "id": 499160195,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1739343148
    },
    {
        "content": "<p>The next PR in the series is <a href=\"https://github.com/leanprover-community/mathlib4/pull/21730\">#21730</a>. It is a big one. </p>\n<p>There is however a problem with <code>MathlibTest.Bound.bound</code> where a test is unsuccessful. This is due to the fact that <code>Complex.abs</code> used to be defined as a <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AbsoluteValue#doc\">docs#AbsoluteValue</a> and thus <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AbsoluteValue.le_add#doc\">docs#AbsoluteValue.le_add</a> could be used there. Since it is now defined as equal to <code>Complex.norm</code>, the test now fails. I am not sure about what is the best way to fix that... (I did reformulate the test in terms of <code>Complex.norm</code> though).</p>",
        "id": 499295319,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1739383042
    },
    {
        "content": "<p>Pinging <span class=\"user-mention\" data-user-id=\"514145\">@Geoffrey Irving</span>  that wrote the tactic <code>bound</code></p>",
        "id": 499393558,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1739430940
    },
    {
        "content": "<p>Fixing this requires registering the analogous norm lemmas with bound. For AbsoluteValue.le_add, this is almost but not quite <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=norm_sub_norm_le#doc\">docs#norm_sub_norm_le</a>, so I think we need to add the new norm lemma.</p>",
        "id": 499423946,
        "sender_full_name": "Geoffrey Irving",
        "timestamp": 1739439497
    },
    {
        "content": "<p>Ok. I’ll do that. I thought about doing something like that but I was wondering if there was a reason why these lemmas were not already tagged with ‘bound’.</p>",
        "id": 499442183,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1739444442
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/21821\">#21821</a></p>",
        "id": 499455680,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1739448435
    },
    {
        "content": "<p>The final PR is available <a href=\"https://github.com/leanprover-community/mathlib4/pull/21995\">#21995</a> and supersede the previous one.</p>",
        "id": 500239871,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1739811257
    },
    {
        "content": "<p>Thanks a lot for doing this! I think the result looks really nice!</p>",
        "id": 501489687,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1740389667
    }
]