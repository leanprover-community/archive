[
    {
        "content": "<p>Mathlib has an unused argument linter, but do we have an unused <code>have</code> linter, i.e. a linter that fires if a have statement is made in a tactic proof but then the conclusion of that have is never used elsewhere in the proof?</p>",
        "id": 566620121,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1767732673
    },
    {
        "content": "<p>I mainly have in mind using such a linter for LLM-outputted proofs, which tend to be relatively verbose, and where something like this is more of a concern.</p>",
        "id": 566620261,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1767732734
    },
    {
        "content": "<p>Isn't that what <a href=\"https://leanprover-community.github.io/mathlib4_docs/Batteries/Tactic/Lint/Misc.html#Batteries.Tactic.Lint.unusedHavesSuffices\">Batteries.Tactic.Lint.unusedHavesSuffices</a> does?</p>",
        "id": 566620810,
        "sender_full_name": "David Loeffler",
        "timestamp": 1767732981
    },
    {
        "content": "<p>Looks like it, thanks!</p>",
        "id": 566620902,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1767733025
    },
    {
        "content": "<p>But does it work?</p>",
        "id": 566621546,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1767733314
    },
    {
        "content": "<p>What would be a nice continuation of this linter is an \"unused <code>by_cases</code>\"  linter which detects proofs of the form</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">by_cases</span><span class=\"w\"> </span><span class=\"n\">hP</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span>\n<span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"c1\">-- doesn't use `P`</span>\n<span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">bar</span>\n</code></pre></div>\n<p>which could be turned into</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">foo</span>\n</code></pre></div>",
        "id": 566621731,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1767733418
    },
    {
        "content": "<p>And also (this comes up a lot with alphaproof) proofs of the form</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">by_cases</span><span class=\"w\"> </span><span class=\"n\">hP</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span>\n<span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n<span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"c1\">-- derives a contradiction</span>\n</code></pre></div>\n<p>which could be turned into</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hP</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">by_contra</span><span class=\"w\"> </span><span class=\"n\">hP</span>\n<span class=\"w\">  </span><span class=\"n\">bar</span>\n<span class=\"n\">foo</span>\n</code></pre></div>",
        "id": 566621756,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1767733435
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/287929-mathlib4/topic/unused.20have.20linter/near/566621546\">said</a>:</p>\n<blockquote>\n<p>But does it work?</p>\n</blockquote>\n<p>Well, it looks like it isn't actively triggering on mathlib by showing warnings the way that the nonterminal simp linter does.</p>",
        "id": 566622264,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1767733674
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/287929-mathlib4/topic/unused.20have.20linter/near/566621546\">said</a>:</p>\n<blockquote>\n<p>But does it work?</p>\n</blockquote>\n<p>No, it currently doesn't do anything. <a href=\"https://github.com/leanprover-community/batteries/blob/bc7b7f567dacc39ae904b6f12f6aa7f90e48e45f/Batteries/Tactic/Lint/Misc.lean#L238\">https://github.com/leanprover-community/batteries/blob/bc7b7f567dacc39ae904b6f12f6aa7f90e48e45f/Batteries/Tactic/Lint/Misc.lean#L238</a></p>\n<p>Last discussion: <a href=\"#narrow/channel/287929-mathlib4/topic/Unused.20.60have.60s/near/536111049\">#mathlib4 &gt; Unused &#96;have&#96;s @ ðŸ’¬</a></p>\n<p>The problem is basically that the Batteries linter operates on the final elaborated expression. It doesn't distinguish between user-written <code>have</code>s and the <code>have</code> expression, and it leads to too many false positives.</p>",
        "id": 566622327,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1767733702
    },
    {
        "content": "<p>That was my impression, thanks for confirming :)</p>",
        "id": 566623380,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1767734220
    }
]