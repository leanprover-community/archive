[
    {
        "content": "<p>Hi all, here is a relatively simple result that turned out to be fairly hard to achieve due to many type conversions for complex numbers.  I'd like to know if there is an easier way to do these types of manipulations.  Whenever I tried to use simp, norm_num, aesop etc I made little progress due to some of the complexities of these expressions.  Any advice would be appreciated!</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">Mathlib.Data.Nat.Basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.Data.Real.Basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.Data.Int.Basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.Data.Complex.Basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.Data.Complex.Exponential</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.Analysis.SpecialFunctions.Trigonometric.Basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.Tactic.Basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.Tactic.Linarith</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.Tactic.LibrarySearch</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.Tactic.Rewrites</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">pow_simp</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">Complex.I</span><span class=\"bp\">+</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">ℂ</span><span class=\"o\">))</span><span class=\"bp\">^</span><span class=\"mi\">99</span> <span class=\"bp\">=-</span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℂ</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"mi\">49</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℂ</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"mi\">49</span> <span class=\"bp\">*</span> <span class=\"n\">Complex.I</span> <span class=\"o\">:=</span>\n  <span class=\"k\">calc</span>\n    <span class=\"o\">(</span><span class=\"n\">Complex.I</span><span class=\"bp\">+</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">ℂ</span><span class=\"o\">))</span><span class=\"bp\">^</span><span class=\"mi\">99</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"n\">Real.sqrt</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">Complex.exp</span> <span class=\"o\">((</span><span class=\"n\">Real.pi</span> <span class=\"bp\">/</span> <span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℂ</span><span class=\"o\">))</span> <span class=\"bp\">*</span> <span class=\"n\">Complex.I</span><span class=\"o\">))</span><span class=\"bp\">^</span><span class=\"mi\">99</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n      <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">Complex.exp_mul_I</span> <span class=\"o\">(</span><span class=\"n\">Real.pi</span> <span class=\"bp\">/</span> <span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℂ</span><span class=\"o\">)),</span> <span class=\"o\">(</span><span class=\"kd\">by</span> <span class=\"n\">simp</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℂ</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">),</span> <span class=\"bp\">←</span> <span class=\"n\">Complex.ofReal_div</span><span class=\"o\">]</span>\n      <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"bp\">←</span> <span class=\"n\">Complex.ofReal_cos</span><span class=\"o\">,</span> <span class=\"n\">Real.cos_pi_div_four</span><span class=\"o\">,</span> <span class=\"bp\">←</span> <span class=\"n\">Complex.ofReal_sin</span><span class=\"o\">,</span> <span class=\"n\">Real.sin_pi_div_four</span><span class=\"o\">]</span>\n      <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">left_distrib</span><span class=\"o\">,</span> <span class=\"n\">Complex.ofReal_div</span> <span class=\"o\">(</span><span class=\"n\">Real.sqrt</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">),</span> <span class=\"n\">mul_comm_div</span><span class=\"o\">,</span> <span class=\"bp\">←</span> <span class=\"n\">mul_div_assoc</span><span class=\"o\">]</span>\n      <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"bp\">←</span> <span class=\"n\">mul_assoc</span><span class=\"o\">,</span> <span class=\"bp\">←</span> <span class=\"n\">Complex.ofReal_mul</span> <span class=\"o\">(</span><span class=\"n\">Real.sqrt</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">Real.sqrt</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">))]</span>\n      <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">Real.mul_self_sqrt</span><span class=\"o\">,</span> <span class=\"bp\">←</span> <span class=\"n\">mul_comm_div</span><span class=\"o\">,</span> <span class=\"n\">div_self</span><span class=\"o\">,</span> <span class=\"n\">one_mul</span><span class=\"o\">,</span> <span class=\"n\">add_comm</span><span class=\"o\">]</span>\n      <span class=\"bp\">&lt;;&gt;</span> <span class=\"n\">norm_num</span>\n    <span class=\"n\">_</span> <span class=\"bp\">=</span> <span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">Real.sqrt</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">))</span><span class=\"bp\">^</span><span class=\"mi\">99</span> <span class=\"bp\">*</span> <span class=\"n\">Complex.exp</span> <span class=\"o\">(</span><span class=\"mi\">99</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">Real.pi</span> <span class=\"bp\">/</span> <span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℂ</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">Complex.I</span><span class=\"o\">))</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n      <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"bp\">←</span> <span class=\"n\">Complex.ofReal_pow</span><span class=\"o\">]</span>\n      <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">mul_pow</span> <span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">Real.sqrt</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">Complex.exp</span> <span class=\"o\">(</span><span class=\"n\">Real.pi</span> <span class=\"bp\">/</span> <span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℂ</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">Complex.I</span><span class=\"o\">))</span> <span class=\"mi\">99</span><span class=\"o\">]</span>\n      <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"bp\">←</span> <span class=\"n\">Complex.exp_nat_mul</span> <span class=\"o\">(</span><span class=\"n\">Real.pi</span> <span class=\"bp\">/</span> <span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℂ</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">Complex.I</span><span class=\"o\">)</span> <span class=\"mi\">99</span><span class=\"o\">]</span>\n    <span class=\"n\">_</span> <span class=\"bp\">=</span> <span class=\"mi\">2</span><span class=\"bp\">^</span><span class=\"mi\">49</span><span class=\"bp\">*</span><span class=\"n\">Real.sqrt</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">Real.cos</span> <span class=\"o\">(</span><span class=\"n\">Real.pi</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"n\">Real.sin</span> <span class=\"o\">(</span><span class=\"n\">Real.pi</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">Complex.I</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"mi\">3</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n      <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"mi\">99</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">Real.pi</span> <span class=\"bp\">/</span> <span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℂ</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">Complex.I</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"mi\">12</span><span class=\"o\">:</span><span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"n\">Real.pi</span> <span class=\"bp\">*</span> <span class=\"n\">Complex.I</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"o\">:</span><span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"bp\">/</span> <span class=\"o\">(</span><span class=\"mi\">4</span> <span class=\"o\">:</span> <span class=\"n\">ℂ</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">Real.pi</span> <span class=\"bp\">*</span> <span class=\"n\">Complex.I</span>  <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n        <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"bp\">←</span> <span class=\"n\">mul_assoc</span><span class=\"o\">,</span> <span class=\"bp\">←</span> <span class=\"n\">mul_comm_div</span><span class=\"o\">,</span> <span class=\"n\">mul_assoc</span> <span class=\"mi\">2</span><span class=\"o\">,</span> <span class=\"bp\">←</span> <span class=\"n\">mul_assoc</span><span class=\"o\">,</span> <span class=\"bp\">←</span> <span class=\"n\">mul_assoc</span><span class=\"o\">]</span>\n        <span class=\"n\">rw</span>  <span class=\"o\">[</span><span class=\"bp\">←</span> <span class=\"n\">right_distrib</span><span class=\"o\">,</span> <span class=\"bp\">←</span> <span class=\"n\">right_distrib</span><span class=\"o\">]</span>\n        <span class=\"n\">norm_num</span>\n      <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">this</span><span class=\"o\">,</span> <span class=\"n\">Complex.exp_add</span><span class=\"o\">]</span>\n      <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">Complex.exp_nat_mul_two_pi_mul_I</span> <span class=\"mi\">12</span><span class=\"o\">,</span> <span class=\"n\">one_mul</span><span class=\"o\">]</span>\n      <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">mul_comm_div</span><span class=\"o\">,</span> <span class=\"n\">mul_assoc</span><span class=\"o\">,</span> <span class=\"n\">Complex.exp_nat_mul</span> <span class=\"o\">(</span><span class=\"n\">Real.pi</span> <span class=\"bp\">/</span> <span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℂ</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">Complex.I</span><span class=\"o\">)</span> <span class=\"mi\">3</span><span class=\"o\">]</span>\n      <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">Complex.exp_mul_I</span> <span class=\"o\">(</span><span class=\"n\">Real.pi</span><span class=\"bp\">/</span><span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℂ</span><span class=\"o\">)),</span> <span class=\"o\">(</span><span class=\"kd\">by</span> <span class=\"n\">ring_nf</span><span class=\"o\">:</span><span class=\"mi\">99</span><span class=\"bp\">=</span><span class=\"mi\">2</span><span class=\"bp\">*</span><span class=\"mi\">49</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)]</span>\n      <span class=\"n\">rw</span> <span class=\"o\">[</span> <span class=\"n\">pow_succ</span><span class=\"o\">,</span> <span class=\"n\">pow_mul</span><span class=\"o\">,</span> <span class=\"bp\">←</span> <span class=\"n\">Complex.ofReal_pow</span><span class=\"o\">,</span> <span class=\"n\">Real.sq_sqrt</span><span class=\"o\">]</span>\n      <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">mul_comm</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"bp\">^</span><span class=\"mi\">49</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"kd\">by</span> <span class=\"n\">simp</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℂ</span><span class=\"o\">)</span><span class=\"bp\">=↑</span><span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)),</span> <span class=\"bp\">←</span> <span class=\"n\">Complex.ofReal_div</span><span class=\"o\">]</span>\n      <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"bp\">←</span> <span class=\"n\">Complex.ofReal_cos</span><span class=\"o\">,</span> <span class=\"bp\">←</span> <span class=\"n\">Complex.ofReal_sin</span><span class=\"o\">]</span>\n      <span class=\"n\">aesop</span>\n      <span class=\"n\">linarith</span>\n    <span class=\"n\">_</span> <span class=\"bp\">=</span> <span class=\"bp\">-</span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℂ</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"mi\">49</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℂ</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"mi\">49</span> <span class=\"bp\">*</span> <span class=\"n\">Complex.I</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n      <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">Real.cos_pi_div_four</span><span class=\"o\">,</span> <span class=\"n\">Real.sin_pi_div_four</span><span class=\"o\">]</span>\n      <span class=\"n\">nth_rw</span> <span class=\"mi\">1</span> <span class=\"o\">[</span><span class=\"bp\">←</span> <span class=\"n\">mul_one</span> <span class=\"o\">(</span><span class=\"n\">Real.sqrt</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">/</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">))]</span>\n      <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">Complex.ofReal_mul</span><span class=\"o\">,</span> <span class=\"bp\">←</span> <span class=\"n\">left_distrib</span><span class=\"o\">,</span> <span class=\"n\">mul_pow</span><span class=\"o\">]</span>\n      <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"o\">((</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">ℂ</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"n\">Complex.I</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"mi\">3</span> <span class=\"bp\">=</span> <span class=\"bp\">-</span><span class=\"mi\">2</span> <span class=\"bp\">+</span> <span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"n\">Complex.I</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n        <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">pow_succ</span><span class=\"o\">,</span> <span class=\"n\">pow_succ</span><span class=\"o\">,</span> <span class=\"n\">pow_one</span><span class=\"o\">]</span>\n        <span class=\"n\">ring_nf</span>\n        <span class=\"n\">rw</span> <span class=\"o\">[(</span><span class=\"kd\">by</span> <span class=\"n\">ring_nf</span><span class=\"o\">:</span> <span class=\"mi\">3</span><span class=\"bp\">=</span><span class=\"mi\">2</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">),</span> <span class=\"n\">pow_succ</span><span class=\"o\">,</span> <span class=\"n\">Complex.I_sq</span><span class=\"o\">]</span>\n        <span class=\"n\">ring_nf</span>\n      <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">this</span><span class=\"o\">]</span>\n      <span class=\"n\">nth_rw</span> <span class=\"mi\">1</span> <span class=\"o\">[(</span><span class=\"kd\">by</span> <span class=\"n\">ring_nf</span><span class=\"o\">:</span> <span class=\"mi\">3</span><span class=\"bp\">=</span><span class=\"mi\">2</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">),</span> <span class=\"bp\">←</span> <span class=\"n\">Complex.ofReal_pow</span><span class=\"o\">,</span> <span class=\"n\">pow_succ</span> <span class=\"o\">(</span><span class=\"n\">Real.sqrt</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">))</span> <span class=\"mi\">2</span><span class=\"o\">]</span>\n      <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">Real.sq_sqrt</span><span class=\"o\">,</span> <span class=\"n\">Complex.ofReal_mul</span><span class=\"o\">]</span>\n      <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">mul_div_assoc</span><span class=\"o\">,</span> <span class=\"bp\">←</span> <span class=\"n\">mul_assoc</span><span class=\"o\">,</span> <span class=\"bp\">←</span> <span class=\"n\">mul_assoc</span><span class=\"o\">,</span> <span class=\"n\">mul_assoc</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"bp\">^</span><span class=\"mi\">49</span><span class=\"o\">)]</span>\n      <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"bp\">←</span> <span class=\"n\">Complex.ofReal_mul</span><span class=\"o\">,</span> <span class=\"n\">Real.mul_self_sqrt</span><span class=\"o\">]</span>\n      <span class=\"n\">rw</span> <span class=\"o\">[(</span><span class=\"kd\">by</span> <span class=\"n\">simp</span> <span class=\"o\">:</span> <span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">=</span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℂ</span><span class=\"o\">)),</span> <span class=\"n\">mul_comm</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"bp\">^</span><span class=\"mi\">49</span><span class=\"o\">),</span> <span class=\"bp\">←</span> <span class=\"n\">pow_succ</span><span class=\"o\">]</span>\n      <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"bp\">←</span> <span class=\"n\">mul_div_assoc</span><span class=\"o\">,</span> <span class=\"n\">mul_comm</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"bp\">^</span><span class=\"o\">(</span><span class=\"mi\">49</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)),</span> <span class=\"bp\">←</span> <span class=\"n\">pow_succ</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"kd\">by</span> <span class=\"n\">ring_nf</span><span class=\"o\">:</span> <span class=\"mi\">49</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"bp\">=</span><span class=\"mi\">48</span><span class=\"bp\">+</span><span class=\"mi\">3</span><span class=\"o\">)]</span>\n      <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">pow_add</span><span class=\"o\">,</span> <span class=\"n\">mul_div_cancel</span><span class=\"o\">,</span> <span class=\"n\">left_distrib</span><span class=\"o\">,</span> <span class=\"n\">mul_neg</span><span class=\"o\">,</span> <span class=\"n\">mul_comm</span><span class=\"o\">,</span> <span class=\"bp\">←</span> <span class=\"n\">mul_assoc</span><span class=\"o\">]</span>\n      <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">mul_comm</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"bp\">^</span><span class=\"mi\">48</span><span class=\"o\">),</span> <span class=\"bp\">←</span> <span class=\"n\">pow_succ</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"kd\">by</span> <span class=\"n\">ring_nf</span><span class=\"o\">:</span><span class=\"mi\">48</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"bp\">=</span><span class=\"mi\">49</span><span class=\"o\">)]</span>\n      <span class=\"n\">aesop</span>\n      <span class=\"n\">linarith</span>\n      <span class=\"n\">linarith</span>\n</code></pre></div>",
        "id": 396352332,
        "sender_full_name": "Teddy Baker",
        "timestamp": 1697139230
    },
    {
        "content": "<p>Working in more generality is normally easier when explicit numbers are involved:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">Mathlib.Data.Nat.Basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.Data.Real.Basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.Data.Int.Basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.Data.Complex.Basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.Data.Complex.Exponential</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.Analysis.SpecialFunctions.Trigonometric.Basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.Tactic.Basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.Tactic.Linarith</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.Tactic.LibrarySearch</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.Tactic.Rewrites</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">Complex.I_pow_mod</span> <span class=\"o\">:</span> <span class=\"n\">Complex.I</span> <span class=\"bp\">^</span> <span class=\"n\">n</span> <span class=\"bp\">=</span> <span class=\"n\">Complex.I</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"bp\">%</span> <span class=\"mi\">4</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"gr\">sorry</span>\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kd\">lemma</span> <span class=\"n\">Complex.I_pow_two</span> <span class=\"o\">:</span> <span class=\"n\">Complex.I</span> <span class=\"bp\">^</span> <span class=\"mi\">2</span> <span class=\"bp\">=</span> <span class=\"bp\">-</span><span class=\"mi\">1</span> <span class=\"o\">:=</span> <span class=\"gr\">sorry</span>\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kd\">lemma</span> <span class=\"n\">Complex.I_pow_three</span> <span class=\"o\">:</span> <span class=\"n\">Complex.I</span> <span class=\"bp\">^</span> <span class=\"mi\">3</span> <span class=\"bp\">=</span> <span class=\"bp\">-</span><span class=\"n\">Complex.I</span> <span class=\"o\">:=</span> <span class=\"gr\">sorry</span>\n<span class=\"kd\">lemma</span> <span class=\"n\">pow_simp</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">Complex.I</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"o\">(</span><span class=\"mi\">4</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"n\">n</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"bp\">-</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"bp\">-</span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℂ</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"n\">n</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"bp\">-</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℂ</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"bp\">*</span><span class=\"o\">(</span> <span class=\"mi\">2</span><span class=\"bp\">*</span> <span class=\"n\">n</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"bp\">-</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">Complex.I</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"n\">induction'</span> <span class=\"n\">n</span> <span class=\"k\">with</span> <span class=\"n\">m</span> <span class=\"n\">ih</span>\n  <span class=\"bp\">·</span> <span class=\"n\">norm_num</span> <span class=\"o\">[</span><span class=\"n\">pow_succ</span><span class=\"o\">,</span> <span class=\"n\">mul_add</span><span class=\"o\">,</span> <span class=\"n\">add_mul</span><span class=\"o\">]</span>\n    <span class=\"n\">ring</span>\n  <span class=\"bp\">·</span> <span class=\"n\">simp</span> <span class=\"n\">at</span> <span class=\"n\">ih</span>\n    <span class=\"n\">norm_num</span> <span class=\"o\">[</span><span class=\"n\">Nat.mul_succ</span><span class=\"o\">]</span> <span class=\"n\">at</span> <span class=\"bp\">*</span>\n    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"k\">show</span> <span class=\"mi\">4</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"n\">m</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"mi\">11</span> <span class=\"bp\">=</span> <span class=\"mi\">4</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"n\">m</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"mi\">3</span> <span class=\"bp\">+</span> <span class=\"mi\">8</span> <span class=\"kd\">by</span> <span class=\"n\">norm_num</span><span class=\"o\">,</span> <span class=\"n\">pow_add</span><span class=\"o\">,</span> <span class=\"n\">ih</span><span class=\"o\">]</span>\n    <span class=\"n\">norm_num</span> <span class=\"o\">[</span><span class=\"n\">pow_succ</span><span class=\"o\">]</span>\n    <span class=\"n\">ring_nf</span>\n    <span class=\"n\">norm_num</span> <span class=\"o\">[</span><span class=\"n\">Complex.I_pow_mod</span><span class=\"o\">,</span> <span class=\"n\">Complex.I_pow_three</span><span class=\"o\">]</span>\n    <span class=\"n\">norm_num</span> <span class=\"o\">[</span><span class=\"n\">Complex.I_pow_three</span><span class=\"o\">]</span>\n    <span class=\"n\">ring</span>\n</code></pre></div>",
        "id": 396357391,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1697141426
    },
    {
        "content": "<p>I tried to improve your code a bit, but that wasn't too impressive either: </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">lemma</span> <span class=\"n\">pow_simp</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">Complex.I</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"mi\">99</span> <span class=\"bp\">=</span> <span class=\"bp\">-</span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℂ</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"mi\">49</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℂ</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"mi\">49</span> <span class=\"bp\">*</span> <span class=\"n\">Complex.I</span> <span class=\"o\">:=</span>\n  <span class=\"k\">calc</span>\n    <span class=\"o\">(</span><span class=\"n\">Complex.I</span><span class=\"bp\">+</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">ℂ</span><span class=\"o\">))</span><span class=\"bp\">^</span><span class=\"mi\">99</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"n\">Real.sqrt</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">Complex.exp</span> <span class=\"o\">((</span><span class=\"n\">Real.pi</span> <span class=\"bp\">/</span> <span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℂ</span><span class=\"o\">))</span> <span class=\"bp\">*</span> <span class=\"n\">Complex.I</span><span class=\"o\">))</span><span class=\"bp\">^</span><span class=\"mi\">99</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n      <span class=\"n\">congr</span>\n      <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">Complex.exp_mul_I</span><span class=\"o\">]</span>\n      <span class=\"n\">apply</span> <span class=\"n\">Complex.ext</span> <span class=\"bp\">&lt;;&gt;</span>\n      <span class=\"bp\">·</span> <span class=\"n\">simp</span>\n        <span class=\"n\">norm_cast</span>\n        <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"bp\">←</span> <span class=\"n\">mul_div_assoc</span><span class=\"o\">]</span>\n        <span class=\"n\">norm_num</span>\n</code></pre></div>",
        "id": 396358016,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1697141733
    },
    {
        "content": "<p>Thanks, these solutions are both very helpful!</p>",
        "id": 396358942,
        "sender_full_name": "Teddy Baker",
        "timestamp": 1697142193
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"648334\">Teddy Baker</span> has marked this topic as resolved.</p>",
        "id": 396358946,
        "sender_full_name": "Notification Bot",
        "timestamp": 1697142196
    }
]