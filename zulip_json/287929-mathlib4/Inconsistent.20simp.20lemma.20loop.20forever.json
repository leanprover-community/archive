[
    {
        "content": "<p>Seems that there are some simp lemma in mathlib which will loop forever:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">NumberTheory</span><span class=\"bp\">.</span><span class=\"n\">Padics</span><span class=\"bp\">.</span><span class=\"n\">RingHoms</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fact</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ZMod</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"bp\">ˣ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">∣</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span>\n<span class=\"cm\">  tactic 'simp' failed, nested error:</span>\n<span class=\"cm\">  maximum recursion depth has been reached</span>\n<span class=\"cm\">  use `set_option maxRecDepth &lt;num&gt;` to increase limit</span>\n<span class=\"cm\">  use `set_option diagnostics true` to get diagnostic information</span>\n<span class=\"cm\">  -/</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>Any ideas?</p>",
        "id": 526077353,
        "sender_full_name": "Jz Pan",
        "timestamp": 1751028837
    },
    {
        "content": "<p>you know, the error tells you exactly how to debug it</p>",
        "id": 526077536,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751028907
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/ktKihdtuWQQSpGM5PMLR4CLS/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/ktKihdtuWQQSpGM5PMLR4CLS/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"443x100\" src=\"/user_uploads/thumbnail/3121/ktKihdtuWQQSpGM5PMLR4CLS/image.png/840x560.webp\"></a></div>",
        "id": 526077589,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751028926
    },
    {
        "content": "<p>and then if you follow it, it tells you that these two lemmas are in conflict, which is weird that the simp linter didn't catch it</p>",
        "id": 526077642,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751028947
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/blob/860d21962a6ace996c34b44e9e9668eee7c61753/Mathlib/Data/ZMod/Basic.lean#L792-L801\">https://github.com/leanprover-community/mathlib4/blob/860d21962a6ace996c34b44e9e9668eee7c61753/Mathlib/Data/ZMod/Basic.lean#L792-L801</a></p>",
        "id": 526077775,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751028987
    },
    {
        "content": "<p>it's also weird that this lemma isn't just proved using the first lemma</p>",
        "id": 526077818,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751029003
    },
    {
        "content": "<p>ah i think it's because <code>Inv</code> is always defined for <code>ZMod n</code>, even when <code>n</code> is not prime (so it won't always match the condition of the first lemma which requires a <code>DivisionMonoid</code>)</p>",
        "id": 526078143,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751029130
    },
    {
        "content": "<p>now that's a tricky issue</p>",
        "id": 526078163,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751029137
    },
    {
        "content": "<p>Are there any proposed fix of it?</p>",
        "id": 526203326,
        "sender_full_name": "Jz Pan",
        "timestamp": 1751116613
    }
]