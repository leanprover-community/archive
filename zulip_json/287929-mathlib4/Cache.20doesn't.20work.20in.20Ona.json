[
    {
        "content": "<p>Since gitpod was retired yesterday, I am <em>trying</em> to use its successor, ona, to little avail so far. Many non-lean things are going wrong (I can't seem to push to other people's forks, I can't find the Make pull requests suggestions button anymore, it keeps on asking me to log into github, etc...), but there is one crucial lean thing that I can't seem to be able to do anymore: download cache.</p>",
        "id": 545337701,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1760623695
    },
    {
        "content": "<p>Here's a tentative repro:</p>\n<ol>\n<li>Go to <a href=\"https://app.gitpod.io/ai\">https://app.gitpod.io/ai</a>, create an account, verify your credit card, sell your soul, whatever...</li>\n<li>Create a repo from URL with url <a href=\"https://github.com/leanprover-community/mathlib4\">https://github.com/leanprover-community/mathlib4</a></li>\n<li>Run <code>git remote add yael https://github.com/yael/mathlib4; git fetch yael; git checkout yael/more_grw_gcongr</code> (this is the branch from <a href=\"https://github.com/leanprover-community/mathlib4/pull/30508\">#30508</a>, which I chose because it changes a lot of files, and therefore prominently displays the cache issue).</li>\n<li>Download the cache for an advanced file (eg <code>MeasureTheory.Measure.WithDensity</code>) any way you want, eg <code>lake exe cache get</code> or command palette + fetching imports for that file.</li>\n<li>Issue: No cache was downloaded</li>\n</ol>",
        "id": 545339339,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1760623940
    },
    {
        "content": "<p>doesn't ona/gitpod use devcontainers these days?</p>",
        "id": 545339773,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760623998
    },
    {
        "content": "<p>I don't recall the cache ever getting downloaded on codespaces which also uses devcontainers</p>",
        "id": 545339905,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760624015
    },
    {
        "content": "<p>I had to do that by hand</p>",
        "id": 545339949,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760624021
    },
    {
        "content": "<p>What do you mean \"by hand\"? I am also doing it \"by hand\", ie running <code>lake exe cache get</code> myself, and I would expect that to work but it doesn't.</p>",
        "id": 545340720,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1760624123
    },
    {
        "content": "<p>In fact, trying the above on another branch works just fine. Maybe the issue is with my branch <code>more_grw_gcongr</code>? Can somebody try?</p>",
        "id": 545341126,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1760624181
    },
    {
        "content": "<p>Oh okay. That's a different issue then</p>",
        "id": 545341135,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760624182
    },
    {
        "content": "<p>What's the output of <code>lake exe cache get</code>?</p>",
        "id": 545348080,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1760625230
    },
    {
        "content": "<p>I've encountered failures to create the GitHub codespace on some branches (e.g. <a href=\"https://github.com/leanprover-community/mathlib4/pull/30144\">#30144</a>) with older mathlib (a few weeks outdated), which I think may be related. On more recent master, I'm not seeing the first two <code>info</code> lines and the codespace is created successfully, so something probably changed with the devcontainer/gitpod configuration in the last few weeks. (Why does \"gitpod\" show up when creating a GitHub codespace?) It's wild it ran out of space, as the successfully created codespaces only take less than 10GB each, a lot less than the 32GB limit.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get!</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">downloading</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">releases</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">lang</span><span class=\"bp\">.</span><span class=\"n\">org</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"bp\">/</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">24</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc1</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"mf\">4.24</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc1</span><span class=\"bp\">-</span><span class=\"n\">linux</span><span class=\"bp\">.</span><span class=\"n\">tar</span><span class=\"bp\">.</span><span class=\"n\">zst</span>\n<span class=\"mf\">438.4</span><span class=\"w\"> </span><span class=\"n\">MiB</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mf\">438.4</span><span class=\"w\"> </span><span class=\"n\">MiB</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">100</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"o\">)</span><span class=\"w\">  </span><span class=\"mf\">84.0</span><span class=\"w\"> </span><span class=\"n\">MiB</span><span class=\"bp\">/</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">ETA</span><span class=\"o\">:</span><span class=\"w\">   </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">s</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">installing</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">gitpod</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.24.0-rc1</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">plausible</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"bp\">********/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">plausible</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">plausible</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">checking</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">revision</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"mi\">9</span><span class=\"n\">f492660e9837df43fd885a2ad05c520da9ff9f5'</span>\n<span class=\"bp\">...</span>\n<span class=\"n\">Current</span><span class=\"w\"> </span><span class=\"n\">branch</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">binRec_npow</span>\n<span class=\"n\">Using</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Azure</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">origin</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">********</span>\n<span class=\"n\">Attempting</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">download</span><span class=\"w\"> </span><span class=\"mi\">7271</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"w\"> </span><span class=\"n\">cache</span>\n<span class=\"n\">Downloaded</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1463</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">attempted</span><span class=\"w\"> </span><span class=\"mi\">7271</span><span class=\"bp\">/</span><span class=\"mi\">7271</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">100</span><span class=\"bp\">%</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">KB</span><span class=\"bp\">/</span><span class=\"n\">s</span><span class=\"o\">]]]</span>\n<span class=\"n\">Attempting</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">download</span><span class=\"w\"> </span><span class=\"mi\">7271</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"bp\">********</span><span class=\"w\"> </span><span class=\"n\">cache</span>\n<span class=\"n\">Downloaded</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">7271</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">attempted</span><span class=\"w\"> </span><span class=\"mi\">7271</span><span class=\"bp\">/</span><span class=\"mi\">7271</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">100</span><span class=\"bp\">%</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">356</span><span class=\"w\"> </span><span class=\"n\">KB</span><span class=\"bp\">/</span><span class=\"n\">s</span><span class=\"o\">]</span>\n<span class=\"n\">Decompressing</span><span class=\"w\"> </span><span class=\"mi\">7271</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span>\n<span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">gitpod</span><span class=\"bp\">/.</span><span class=\"n\">cache</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"mi\">0</span><span class=\"n\">b1d21d7dc7b2f02</span><span class=\"bp\">.</span><span class=\"n\">ltar</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">No</span><span class=\"w\"> </span><span class=\"n\">space</span><span class=\"w\"> </span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">device</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">os</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"mi\">28</span><span class=\"o\">)</span>\n<span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">gitpod</span><span class=\"bp\">/.</span><span class=\"n\">cache</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"n\">f55c087f3e4aa12</span><span class=\"bp\">.</span><span class=\"n\">ltar</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">No</span><span class=\"w\"> </span><span class=\"n\">space</span><span class=\"w\"> </span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">device</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">os</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"mi\">28</span><span class=\"o\">)</span>\n<span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">gitpod</span><span class=\"bp\">/.</span><span class=\"n\">cache</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"n\">aac45608b6c25da</span><span class=\"bp\">.</span><span class=\"n\">ltar</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">No</span><span class=\"w\"> </span><span class=\"n\">space</span><span class=\"w\"> </span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">device</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">os</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"mi\">28</span><span class=\"o\">)</span>\n<span class=\"bp\">...</span>\n</code></pre></div>",
        "id": 545833628,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1760884328
    },
    {
        "content": "<p>The cache seems to work now. But the ona environments seem to be generally unstable: After some time (in hours), github authentication fails in weird ways and I cannot push to my repos anymore!</p>",
        "id": 545833717,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1760884423
    }
]