[
    {
        "content": "<p>Hello. I'm now learning to use Lean 4 and mathlib4.<br>\nUnfortunately,  <code>lake exe cache get</code> fails for my environment (Windows 10 with git bash) with:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">Haruhisa</span> <span class=\"n\">Enomoto</span><span class=\"bp\">@</span><span class=\"n\">LAPTOP</span><span class=\"bp\">-</span><span class=\"n\">D6IVIEH5</span> <span class=\"n\">MINGW64</span> <span class=\"bp\">~/</span><span class=\"n\">Documents</span><span class=\"bp\">/</span><span class=\"n\">GitHub</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"bp\">-</span><span class=\"n\">test</span> <span class=\"o\">(</span><span class=\"n\">master</span><span class=\"o\">)</span>\n<span class=\"bp\">$</span> <span class=\"n\">lake</span> <span class=\"n\">exe</span> <span class=\"n\">cache</span> <span class=\"n\">get</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"bp\">/</span><span class=\"mi\">8</span><span class=\"o\">]</span> <span class=\"n\">Building</span> <span class=\"n\">Cache.IO</span>\n<span class=\"bp\">...</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"o\">[</span><span class=\"mi\">8</span><span class=\"bp\">/</span><span class=\"mi\">8</span><span class=\"o\">]</span> <span class=\"n\">Linking</span> <span class=\"n\">cache.exe</span>\n<span class=\"n\">Attempting</span> <span class=\"n\">to</span> <span class=\"n\">download</span> <span class=\"mi\">2635</span> <span class=\"n\">file</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span>\n<span class=\"n\">No</span> <span class=\"n\">cache</span> <span class=\"n\">files</span> <span class=\"n\">to</span> <span class=\"n\">decompress</span>\n</code></pre></div>\n<p>for my project which was created using  <code>lake new lean4-test math</code>.<br>\nI think the problem is that my username unfortunately contains whitespace.<br>\nActually, I found that in my <code>C:\\Users\\Haruhisa Enomoto\\.cache\\mathlib</code> directory,<br>\n<code>curl.cfg</code> is temporarily created, and its file is like:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">url</span> <span class=\"bp\">=</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">lakecache.blob.core.windows.net</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">/</span><span class=\"n\">f</span><span class=\"bp\">/</span><span class=\"mi\">11916741244862551456</span><span class=\"bp\">.</span><span class=\"n\">tar.gz</span>\n<span class=\"bp\">-</span><span class=\"n\">o</span> <span class=\"n\">C</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">Haruhisa</span> <span class=\"n\">Enomoto</span><span class=\"bp\">\\.</span><span class=\"n\">cache</span><span class=\"bp\">\\</span><span class=\"n\">mathlib</span><span class=\"bp\">\\</span><span class=\"mi\">11916741244862551456</span><span class=\"bp\">.</span><span class=\"n\">tar.gz</span>\n</code></pre></div>\n<p>And I guess the problem is that whitespace in <code>-o</code> option is not escaped.<br>\n(Actually manual running <code>curl --config curl.cfg</code> fails.)<br>\nI  found the code creating this file, <code>mathlib\\Cache\\Request.lean</code>'s <code>mkGetConfigContent</code> function, and rewrite it to deal with this problem (write <code>-o \"C:\\\\Users\\\\...\"</code> instead of <code>-o C:\\Users\\...</code>) as follows:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">def</span> <span class=\"n\">mkGetConfigContent</span> <span class=\"o\">(</span><span class=\"n\">hashMap</span> <span class=\"o\">:</span> <span class=\"n\">IO.HashMap</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">IO</span> <span class=\"n\">String</span> <span class=\"o\">:=</span> <span class=\"k\">do</span>\n  <span class=\"k\">let</span> <span class=\"n\">l</span> <span class=\"bp\">←</span> <span class=\"n\">hashMap.foldM</span> <span class=\"o\">(</span><span class=\"n\">init</span> <span class=\"o\">:=</span> <span class=\"o\">[])</span> <span class=\"k\">fun</span> <span class=\"n\">acc</span> <span class=\"n\">_</span> <span class=\"n\">hash</span> <span class=\"bp\">=&gt;</span> <span class=\"k\">do</span>\n    <span class=\"k\">let</span> <span class=\"n\">fileName</span> <span class=\"o\">:=</span> <span class=\"n\">hash.asTarGz</span>\n    <span class=\"n\">pure</span> <span class=\"bp\">$</span> <span class=\"o\">(</span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"url = {← mkFileURL fileName none}</span><span class=\"se\">\\n</span><span class=\"s2\">-o </span><span class=\"se\">\\\"</span><span class=\"s2\">{IO.CACHEDIR / fileName}</span><span class=\"se\">\\\"</span><span class=\"s2\">\"</span><span class=\"bp\">.</span><span class=\"n\">replace</span> <span class=\"s2\">\"</span><span class=\"se\">\\\\</span><span class=\"s2\">\"</span> <span class=\"s2\">\"</span><span class=\"se\">\\\\\\\\</span><span class=\"s2\">\"</span><span class=\"o\">)</span> <span class=\"o\">::</span> <span class=\"n\">acc</span>\n  <span class=\"n\">return</span> <span class=\"s2\">\"</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span><span class=\"bp\">.</span><span class=\"n\">intercalate</span> <span class=\"n\">l</span>\n</code></pre></div>\n<p>and then it works for me and <code>lake exe cache get</code> succeeded! (there may be other good solutions since I'm not familiar with Lean 4 as a programming language...)<br>\nI believe this behavior for <code>lake exe cache get</code> failure is not particular to my environment and is common with users whose usernames contain whitespce.</p>",
        "id": 360687803,
        "sender_full_name": "Haruhisa Enomoto",
        "timestamp": 1684904540
    },
    {
        "content": "<p>fixed in <a href=\"https://github.com/leanprover-community/mathlib4/pull/4289\">!4#4289</a></p>",
        "id": 360705593,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1684911796
    },
    {
        "content": "<p>Thank you very much!</p>",
        "id": 360729739,
        "sender_full_name": "Haruhisa Enomoto",
        "timestamp": 1684918987
    }
]