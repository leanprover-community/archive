[
    {
        "content": "<p>In Diophantine approximation it is very important to jump between polynomials of bounded degree and the vectors of their coefficients. I could not find anything in Mathlib so I defined </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span><span class=\"bp\">.</span><span class=\"n\">ofFinToSemiring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→+</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">support</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Finite</span><span class=\"bp\">.</span><span class=\"n\">subset</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">support</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">finite_toSet</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)))</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp_all</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">f</span><span class=\"o\">]))</span><span class=\"bp\">.</span><span class=\"n\">toFinset</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">mem_support_toFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"o\">}</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"n\">map_add'</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">m</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Pi</span><span class=\"bp\">.</span><span class=\"n\">add_apply</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">coeff_ofFinsupp</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Finsupp</span><span class=\"bp\">.</span><span class=\"n\">coe_mk</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">coeff_add</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">split</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">all_goals</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"n\">map_zero'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>An alternative would be</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span><span class=\"bp\">.</span><span class=\"n\">ofFinToSemiring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">∑</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">),</span>\n<span class=\"w\">  </span><span class=\"n\">Polynomial</span><span class=\"bp\">.</span><span class=\"n\">monomial</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>but I like the first more and moreover with the first definition the theorem </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span><span class=\"bp\">.</span><span class=\"n\">of_fin_to_semiring_def</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ofFinToSemiring</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">    </span><span class=\"bp\">∑</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span><span class=\"bp\">.</span><span class=\"n\">monomial</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>has a pretty simple proof.</p>\n<p>My question is: is the name <code>ofFinToSemiring</code> appropriate or should I choose <code>ofVector</code>? Or there are better names?<br>\nAlso, am I right in preferring the first def?<br>\nFinally, I would like to add this to Mathlib. Any reason against?</p>",
        "id": 496206079,
        "sender_full_name": "Fabrizio Barroero",
        "timestamp": 1738009564
    },
    {
        "content": "<p>Are you aware of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.toFinsupp#doc\">docs#List.toFinsupp</a> ?</p>",
        "id": 496214457,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1738013163
    },
    {
        "content": "<p>(cc its author, <span class=\"user-mention\" data-user-id=\"308899\">@Yakov Pechersky</span> )</p>",
        "id": 496214500,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1738013193
    },
    {
        "content": "<p>Also worth noting that you almost certainly want <code>∑ i : Fin n, monomial i (v i)</code> not <code>∑ i in Finset.range (n + 1), monomial i (v i)</code>, as the <code>v i</code> in the latter means <code>v (i % n)</code> which is going to be annoying.</p>",
        "id": 496214760,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1738013297
    },
    {
        "content": "<p>I had a mathlib3 PRs on using this for polynomials:<br>\n<a href=\"https://github.com/leanprover-community/mathlib3/pull/15476\">https://github.com/leanprover-community/mathlib3/pull/15476</a><br>\n<a href=\"https://github.com/leanprover-community/mathlib3/pull/15477\">https://github.com/leanprover-community/mathlib3/pull/15477</a></p>\n<p>one of which is partially ported as a mathlib4 pr<br>\n<a href=\"https://github.com/leanprover-community/mathlib4/pull/9973\">https://github.com/leanprover-community/mathlib4/pull/9973</a></p>",
        "id": 496214780,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1738013310
    },
    {
        "content": "<p>So, one can have a fully \"computable\" function from <code>Fin n -&gt; R</code> to <code>R[X]</code> using <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.ofFn#doc\">docs#List.ofFn</a> and the above.</p>",
        "id": 496215018,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1738013412
    },
    {
        "content": "<p>Well, with <code>DecidableEq R</code>, which is a bit silly; but I guess that's a different problem (solved by moving to <code>DFinsupp</code>...)</p>",
        "id": 496215149,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1738013477
    },
    {
        "content": "<p>In fact, most lemmas should be proven about the list based construction (that it has a particular support, that the degree is lt, that it is injective)</p>",
        "id": 496215188,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1738013503
    },
    {
        "content": "<p>A somewhat less strong Decidable:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">DecidablePred</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">getD</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 496215334,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1738013558
    },
    {
        "content": "<p>But yes, we always come back to the <code>DFinsupp</code> issue, the <code>D</code> stands for dream</p>",
        "id": 496215369,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1738013574
    },
    {
        "content": "<p>I think even with <code>DecidableEq R</code>, it's still worthwhile, since often one cares about polynomials with natural, integer, or rational coefficients</p>",
        "id": 496215456,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1738013614
    },
    {
        "content": "<p>and one can lift that into your <code>R</code> of choice, either via <code>aeval</code> or <code>map</code></p>",
        "id": 496215569,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1738013654
    },
    {
        "content": "<p>Thanks for the messages!<br>\nI was not aware of  <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.toFinsupp#doc\">docs#List.toFinsupp</a> nor of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.ofFn#doc\">docs#List.ofFn</a>. <br>\nI can use them to define my desired function adding <code>DecidableEq R</code> or, as done in <a href=\"https://github.com/leanprover-community/mathlib4/pull/9973\">#9973</a>, with </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">Classical</span>\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">section</span>\n</code></pre></div>\n<p>While for most applications one needs <code>R</code> to be the integers or the rationals, I can think of some where <code>R</code> is a number field or its ring of integers and I guess there we do not have <code>DecidableEq R</code>.</p>",
        "id": 496319899,
        "sender_full_name": "Fabrizio Barroero",
        "timestamp": 1738066153
    },
    {
        "content": "<p>The rule of thumb is: if the statement won't compile without the assumption, add <code>[DecidableEq R]</code> to the statement, but if a proof won't work without it then use <code>classical</code> in the proof. And yes you're right, DecidableEq won't be automatic for a random ring of integers of a random number field (I am not entirely sure about whether one could prove such an instance without any assumptions)</p>",
        "id": 496321038,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738066522
    },
    {
        "content": "<p>In <a href=\"https://github.com/leanprover-community/mathlib4/pull/23080\">#23080</a> I add <code>Polynomial.ofFn</code> and prove some APIs. It would be great if someone could have look.</p>",
        "id": 506617397,
        "sender_full_name": "Fabrizio Barroero",
        "timestamp": 1742349945
    }
]