[
    {
        "content": "<p>Formalising some analysis, I need to prove the following numeric calculation. Is there any way to make them less tedious?</p>\n<p>Firstly, the basic one: perhaps this is really fodder for an <code>approx</code> tactic.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">68</span><span class=\"bp\">/</span><span class=\"mi\">100</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">lt_log_iff_exp_lt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">norm_num</span><span class=\"o\">)]</span>\n<span class=\"w\">  </span><span class=\"c1\">-- goal is now Real.exp 68/100 &lt; 2; the LHS is about 1.97</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>However, behold the tedium for the following</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">68</span><span class=\"bp\">/</span><span class=\"mi\">100</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"c1\">-- previous sorry</span>\n<span class=\"w\">  </span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">68</span><span class=\"bp\">/</span><span class=\"mi\">100</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">norm_num</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">gcongr</span>\n</code></pre></div>\n<p>Is there a way to make this less tedious? For instance, a norm_num extension for logarithms? Can norm_num pick up facts in the local context (perhaps not)? Is there a better tactic?</p>",
        "id": 520861038,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1748429635
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"634338\">@Michael Rothgang</span> <code>linarith</code> solves the second example</p>",
        "id": 520863016,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1748430267
    },
    {
        "content": "<p>as for the first example, I'm not saying this is the desired outcome, but I'm saying that if anyone is interested to write a tactic for <code>exp</code>, here is what you would use:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">68</span><span class=\"bp\">/</span><span class=\"mi\">100</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">lt_log_iff_exp_lt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">norm_num</span><span class=\"o\">)]</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">exp_bound'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">norm_num</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">norm_num</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">norm_num</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">trans_lt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">norm_num</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 520864191,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1748430655
    },
    {
        "content": "<p>Thanks a lot! You've golfed today's proof for the Carleson project!</p>",
        "id": 520874068,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1748433609
    },
    {
        "content": "<p>An even better golf is to use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Real.log_two_gt_d9#doc\">docs#Real.log_two_gt_d9</a> :-)</p>",
        "id": 520874984,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1748433855
    },
    {
        "content": "<p>Didn't <span class=\"user-mention\" data-user-id=\"514145\">@Geoffrey Irving</span> develop a tactic that could do this kind of stuff?</p>",
        "id": 520875502,
        "sender_full_name": "Luigi Massacci",
        "timestamp": 1748434000
    },
    {
        "content": "<p>So,</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">linarith</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">log_two_gt_d9</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 520875668,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1748434046
    },
    {
        "content": "<p>There's also <a href=\"https://github.com/leanprover-community/mathlib4/pull/8949\">#8949</a> by <span class=\"user-mention\" data-user-id=\"650732\">@Sebastian Zimmer</span></p>",
        "id": 520878535,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1748434868
    },
    {
        "content": "<p>which depends on <a href=\"https://github.com/leanprover-community/mathlib4/pull/8167\">#8167</a>: that PR has been waiting for review for a long time.</p>",
        "id": 520878576,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1748434885
    },
    {
        "content": "<p>I guess the way to get such a PR in is to first establish that at least one maintainer wants it in and then to continue approaching people saying \"please review this\" until someone gives in. It doesn't look like it's going to get over the line \"organically\".</p>",
        "id": 520886622,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748437147
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/8167\">#8167</a> at least seems to have maintainer interest since two maintainers are listed as co-authors; unfortunately maybe they would have been best placed to merge...</p>",
        "id": 520889056,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1748437794
    },
    {
        "content": "<p>Calculations like this show up all the time for me, for instance all of these were needed in the ramsey project: <br>\n<a href=\"/user_uploads/3121/hVweNreVvj8r99rIhDuuveRh/image.png\">image.png</a><br>\nI'd be very happy to see a general tactics which makes these easier, since I had a couple of ad-hoc methods to make these work</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/hVweNreVvj8r99rIhDuuveRh/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1017x296\" src=\"/user_uploads/thumbnail/3121/hVweNreVvj8r99rIhDuuveRh/image.png/840x560.webp\"></a></div>",
        "id": 520906291,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1748442341
    },
    {
        "content": "<p><a href=\"https://github.com/Timeroot/ComputableReal\">ComputableReal</a> is for exactly this type of goal, if you're okay with <code>native_decide</code>!</p>",
        "id": 520969130,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1748464169
    },
    {
        "content": "<p>Unfortunately I think we want proofs that the kernel will be happy with here.</p>",
        "id": 520986807,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748472815
    },
    {
        "content": "<p>I had such a statement in my PhD whose proof ended up involving numerical bounds on logarithms (I definitely don't plan for formalize this!).</p>\n<p><a href=\"/user_uploads/3121/3Wt6nygKb_mGf-hY6TB73XmY/a.png\">a.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/3Wt6nygKb_mGf-hY6TB73XmY/a.png\" title=\"a.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"848x138\" src=\"/user_uploads/thumbnail/3121/3Wt6nygKb_mGf-hY6TB73XmY/a.png/840x560.webp\"></a></div><p>(<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>p</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">p_0</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> is defined elsewhere as the real root of a certain cubic polynomial.)</p>",
        "id": 520987931,
        "sender_full_name": "Joseph Myers",
        "timestamp": 1748473436
    },
    {
        "content": "<p>Yeah, all of these were done without <code>native_decide</code>. Looking at ComputableReal, it also doesn't support logs or real powers, both of which I worked with a ton</p>",
        "id": 521007476,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1748486264
    },
    {
        "content": "<p>Ah shoot, it does support logs - but on the dev branch, where it's not 100% done. (The specific case of <code>Real.exp 68/100 &lt; 2</code> from the original message would be done though.)</p>",
        "id": 521128636,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1748536019
    },
    {
        "content": "<p>Alex, I think this is addressed elsewhere, but I can't find it at the moment. What would it take to eliminate <code>native_decide</code> from <code>ComputableReal</code>?</p>",
        "id": 521136896,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1748539131
    },
    {
        "content": "<p>From the Lean side: allowing <code>decide</code> (or <code>decide +kernel</code>) to reduce a <code>partial</code> def would be sufficient, and \"cleanest\" in the very particular sense that it wouldn't require other modifications to that library.</p>\n<p>The other way - which would involve changes only to the library, but many of them - would be to add some kind of gas parameters to all operations (notably, <code>inv</code> and <code>Real.log</code> need this). Then the decidable instance would be something like, trying to find a witness in the first <code>gas</code> many steps of some sequence of bounds, and then otherwise \"falling back\" to <code>Classical.propDecidable</code>.</p>",
        "id": 521166498,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1748551045
    }
]