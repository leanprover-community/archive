[
    {
        "content": "<p>Since v4.15.0-rc1, we now have <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Vector#doc\">docs#Vector</a> in core Lean whose underlying data structure is an array. This contrasts with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Mathlib.Vector#doc\">docs#Mathlib.Vector</a> which contains an underlying list.</p>\n<p>Besides this breaking the namespace (having to write <code>Mathlib.Vector</code> in full), I want to ask what is in store for <code>Vector</code>. Is it meant to eventually supersede <code>Mathlib.Vector</code>? Are there ways to have the same definitions and theorems for <code>Vector</code> that are defined for <code>Mathlib.Vector</code>?</p>\n<p>More generally, it seems that Lean could benefit from a more unified API for Lists/Arrays/Vectors (one step in that direction is <a href=\"https://github.com/JamesGallicchio/LeanColls\">LeanColls</a>). Is such a refactor anywhere in the work?</p>",
        "id": 488106637,
        "sender_full_name": "Quang Dao",
        "timestamp": 1733925941
    },
    {
        "content": "<p>The two vectors have different use cases (although for proof purposes, an array is convertible to a list).</p>",
        "id": 488107222,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1733926121
    },
    {
        "content": "<p>from a usage perspective, Arrays with good capacity management essentially allow O(1) tail insertion and lists allow O(1) head insertion of data</p>",
        "id": 488107340,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1733926160
    },
    {
        "content": "<p>That being said, this core Vector used to be inside the Batteries namespace and so it was not an issue to open the Mathlib namespace. This appears to have changed now.</p>",
        "id": 488107686,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1733926260
    },
    {
        "content": "<p>My attempt to rework the API is the following:</p>\n<ul>\n<li>Define a <code>ListLike</code> type class for types that are equivalent to <code>List</code> (currently <code>List</code> and <code>Array</code>). Similarly for a <code>VectorLike</code> type class (currently <code>Vector</code>, <code>Mathlib.Vector</code>, and <code>Fin n \\to \\a</code>).</li>\n<li>For each function on Lists (say <code>List.cons</code>), define a further type class <code>ListLikeCons</code> that specifies an implementation of this function &amp; a proof that it matches <code>List.cons</code>.</li>\n<li>We now only need to state things twice. Once for the List version, and once for the ListLike typeclass version. I.e. we have <code>List.cons_nil</code> and <code>ListLikeCons.cons_nil</code>. This may be a saving once we have at least 3 instances of <code>ListLike</code>.</li>\n</ul>",
        "id": 488108269,
        "sender_full_name": "Quang Dao",
        "timestamp": 1733926433
    },
    {
        "content": "<p>One thing you should know is that the reason we don't have identical APIs for both vectors is performance. Nothing else stops us from having an identical Vector API, since for proof purposes, we can just extract the list</p>",
        "id": 488108629,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1733926528
    },
    {
        "content": "<p>And I recall that there was a conscious decision, especially for the core vector file, to not offer API that was suboptimal in performance</p>",
        "id": 488108730,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1733926560
    },
    {
        "content": "<p>If you look at the Vector file, you will notice that it is a thin layer of API on top of array where it makes sense. If you look at the array defs, a lot of them use some special translations to C code or <code>unsafe</code> lean functions for efficiency reasons</p>",
        "id": 488108956,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1733926623
    },
    {
        "content": "<p>I do think the namespacing setup is suboptimal and I hope the core devs offer a fix.</p>",
        "id": 488109366,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1733926765
    },
    {
        "content": "<p>Perhaps add <code>Core</code> or <code>Lean</code> as namespace?</p>",
        "id": 488109595,
        "sender_full_name": "Quang Dao",
        "timestamp": 1733926827
    },
    {
        "content": "<p>Given that <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Vector#doc\">docs#Vector</a> is in Init, I suspect it is part of the prelude, although I wonder if it wouldn't be better to put it inside the Std namespace like <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Std.HashMap#doc\">docs#Std.HashMap</a></p>",
        "id": 488110005,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1733926937
    },
    {
        "content": "<p>I am not the right person to ask this anyway. I just happened to write the initial version for Batteries. CC : <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span></p>",
        "id": 488110183,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1733926986
    },
    {
        "content": "<p>I suggest Mathlib simply changes the name of its <code>Vector</code> to something else. Perhaps <code>ListWithLength</code>.</p>",
        "id": 488191007,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733952166
    },
    {
        "content": "<p>We are not planning to provide typeclass based abstractions such as <code>ListLike</code>. If you would like to explore this, I suggest doing so in a separate repository, e.g. as with LeanColls.</p>",
        "id": 488191188,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733952239
    },
    {
        "content": "<p>There are many places with the List and Array APIs diverge because of the differences between cons and push, and the performance of indexed lookup.</p>",
        "id": 488191538,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733952364
    },
    {
        "content": "<p>Mathlib.Vector / ListWithLength is genuinely useful, but only in fairly niche situations where you need to care about the fact that the kernel likes List but doesn't like Array. I haven't attempted to survey where in Mathlib it should be replaced with Vector. None of the places in Mathlib that used it seemed to be actively developed recently, so this seemed less urgent than filling out the Vector lemmas. I would happily review PRs if someone is interested!</p>",
        "id": 488192080,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733952588
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/287929-mathlib4/topic/What.20is.20the.20plan.20for.20.60Mathlib.2EVector.60.3F/near/488191007\">said</a>:</p>\n<blockquote>\n<p>I suggest Mathlib simply changes the name of its <code>Vector</code> to something else. Perhaps <code>ListWithLength</code>.</p>\n</blockquote>\n<p><code>ListWithLength</code> is rather awkward. In the spirit of most languages, it seems natural that a collection data structure should be namespaced inside Std.</p>",
        "id": 488516168,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1733957194
    },
    {
        "content": "<p>Like hashmap</p>",
        "id": 488516267,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1733957248
    },
    {
        "content": "<p>Other name suggestions: <code>ListVector</code> or <code>VecList</code></p>",
        "id": 488516419,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1733957315
    },
    {
        "content": "<p>As a side note, Mathlib has <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Vector3.html#Vector3\"><code>Vector3</code></a> but not <code>Vector2</code>.</p>",
        "id": 488517211,
        "sender_full_name": "Miyahara Kō",
        "timestamp": 1733957778
    },
    {
        "content": "<p>Vector2 was deleted, I forget if it was <code>Fin n -&gt; A</code> or the indexed inductive type</p>",
        "id": 488525560,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733961447
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/287929-mathlib4/topic/What.20is.20the.20plan.20for.20.60Mathlib.2EVector.60.3F/near/488191007\">said</a>:</p>\n<blockquote>\n<p>I suggest Mathlib simply changes the name of its <code>Vector</code> to something else. Perhaps <code>ListWithLength</code>.</p>\n</blockquote>\n<p>Why not <code>List.Vector</code>?</p>",
        "id": 488525657,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733961488
    },
    {
        "content": "<p><code>Vector3</code> annoys me to no end. For the longest time I assumed it was just a length 3 vector.</p>",
        "id": 488634150,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1734010315
    },
    {
        "content": "<p>it should probably be <code>Vector\\_3</code></p>",
        "id": 488637301,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1734011296
    },
    {
        "content": "<p>or just get an actual name :P</p>",
        "id": 488637352,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1734011321
    },
    {
        "content": "<p>In the spirit of <code>Vector3</code>, I'm using <code>ArrayN</code> and <code>ListN</code> for arrays and lists of fixed size.</p>",
        "id": 488655189,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1734016350
    },
    {
        "content": "<p>Why do we even have <code>Vector3</code> and <code>Fin2</code> to begin with?</p>",
        "id": 488656100,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1734016612
    },
    {
        "content": "<p><code>Vector3</code> is only used in <code>Mathlib.NumberTheory.Dioph</code>. That file is very old, and indeed needs to be updated to use <code>MvPolynomial</code> instead of rolling it's own local version. I'm not sure if anyone if interested in doing that. <span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> wrote it back in 2017.</p>",
        "id": 488739162,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1734047546
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/287929-mathlib4/topic/What.20is.20the.20plan.20for.20.60Mathlib.2EVector.60.3F/near/488525657\">said</a>:</p>\n<blockquote>\n<p>Why not <code>List.Vector</code>?</p>\n</blockquote>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/19930\">#19930</a></p>",
        "id": 488739607,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1734047845
    },
    {
        "content": "<p><code>Fin2</code> is otherwise only used in a long-untouched corner of Mathlib:<br>\n<a href=\"/user_uploads/3121/h_3oIRPT1slqhx3EuFOOSc0T/o.png\">o.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/h_3oIRPT1slqhx3EuFOOSc0T/o.png\" title=\"o.png\"><img data-original-dimensions=\"3976x635\" src=\"/user_uploads/thumbnail/3121/h_3oIRPT1slqhx3EuFOOSc0T/o.png/840x560.webp\"></a></div>",
        "id": 488740096,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1734048108
    },
    {
        "content": "<p><code>Fin2</code> is a version of <code>Fin</code> with good definitional principles. It's usually only relevant when writing \"agda style\" code</p>",
        "id": 488813133,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1734086978
    },
    {
        "content": "<p>it comes up in QPFs because there is a lot of computation in types and it's problematic if those equalities don't hold definitionally</p>",
        "id": 488813299,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1734087035
    },
    {
        "content": "<p>in <code>Dioph</code> it is relevant because the DSL used there relies heavily on definitional reduction, but that DSL is definitely overdue for a lean 4 makeover, there are so many cool things you could do to make it easy to write diophantine equations or just recognize them</p>",
        "id": 488814228,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1734087361
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/287929-mathlib4/topic/What.20is.20the.20plan.20for.20.60Mathlib.2EVector.60.3F/near/488814228\">said</a>:</p>\n<blockquote>\n<p>in <code>Dioph</code> it is relevant because the DSL used there relies heavily on definitional reduction, but that DSL is definitely overdue for a lean 4 makeover, there are so many cool things you could do to make it easy to write diophantine equations or just recognize them</p>\n</blockquote>\n<p>Any interesting in doing this? It would be great to be able to clean up some of the \"legacy\" <code>Fin2</code> / <code>Vector3</code> code which is only used in old developments.</p>",
        "id": 493227727,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1736721072
    }
]