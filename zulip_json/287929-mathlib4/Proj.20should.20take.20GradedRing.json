[
    {
        "content": "<p>Is there a reason <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AlgebraicGeometry.Proj#doc\">docs#AlgebraicGeometry.Proj</a> takes in a <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=GradedAlgebra#doc\">docs#GradedAlgebra</a> instead of a <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=GradedRing%3F#doc\">docs#GradedRing?</a> I think this is wrong.</p>",
        "id": 543071427,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759567722
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"648495\">@Christian Merten</span></p>",
        "id": 543071595,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759567907
    },
    {
        "content": "<p>I don't think there is any technical reason why it must be <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=GradedAlgebra#doc\">docs#GradedAlgebra</a>. What cases do you want to have supported for <code>œÉ</code>?</p>",
        "id": 543294622,
        "sender_full_name": "Christian Merten",
        "timestamp": 1759752298
    },
    {
        "content": "<p>well i think the existing AddSubmonoidClass is fine because I end up having to compare across different base rings when I use Submodule</p>",
        "id": 543295076,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759752418
    },
    {
        "content": "<p>and I end up with assuming R1 and R2 are the base rings and they are algebras over a common ring R</p>",
        "id": 543295256,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759752469
    },
    {
        "content": "<p>maybe it makes sense to have R2 be an algebra over R1 instead?</p>",
        "id": 543295338,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759752492
    },
    {
        "content": "<p>I am not following, can you give some more details on what your setup is?</p>",
        "id": 543295597,
        "sender_full_name": "Christian Merten",
        "timestamp": 1759752563
    },
    {
        "content": "<p><a href=\"https://github.com/kckennylau/EllipticCurve/blob/9a891db3938c36b94e5a96d39e0703b89c272545/EllipticCurve/ProjectiveSpace/TensorProduct/Proj.lean#L428\">https://github.com/kckennylau/EllipticCurve/blob/9a891db3938c36b94e5a96d39e0703b89c272545/EllipticCurve/ProjectiveSpace/TensorProduct/Proj.lean#L428</a></p>\n<p>Here I construct map <code>Proj(S ‚äó[R] ùíú) ‚ü∂ Spec(S) √ó[Spec(R)] Proj(ùíú)</code> by using the UMP of pullback, which means I need to construct a map <code>Proj(S ‚äó[R] ùíú) ‚ü∂ Proj(ùíú)</code>, which requires a \"graded hom\" <code>ùíú ‚Üí·µç·µÉ S ‚äó ùíú</code> (a class I defined in my project as well), but the problem is that <code>ùíú n</code> is R-submodule, and <code>(S ‚äó ùíú) n := (ùíú n).baseChange S</code> is S-submodule.</p>",
        "id": 543296340,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759752769
    },
    {
        "content": "<p>btw I also had to redefine <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=HomogeneousLocalization.map#doc\">docs#HomogeneousLocalization.map</a> because the current one again assumes same base ring</p>",
        "id": 543296771,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759752873
    },
    {
        "content": "<p>Actually when I <a href=\"https://github.com/kckennylau/EllipticCurve/blob/9a891db3938c36b94e5a96d39e0703b89c272545/EllipticCurve/ProjectiveSpace/TensorProduct/ProjMap.lean#L87\">defined <code>GradedAlgHom</code> in my project</a> I just threw away the base rings</p>",
        "id": 543297327,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759753023
    },
    {
        "content": "<p>but once again let me repeat that in real applications most likely it will be R2 that is an algebra over R1, not the other way round, so I'm willing to assume that in the (future) mathlib PR</p>",
        "id": 543297539,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759753078
    },
    {
        "content": "<p>Surely it's handy to have Proj for graded algebras because then you get a map down to Spec of the base for free. Isn't it like how we don't really want group schemes because there are essentially no examples (other than GL_n and SL_n etc); we actually want group R-schemes where R is a base, and it's thus good to make everything be an R-algebra from the start.</p>",
        "id": 543305525,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1759755094
    },
    {
        "content": "<p>every graded algebra is by definition a graded ring so you don't lose on any generality</p>",
        "id": 543305722,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759755144
    },
    {
        "content": "<p>the setup is a bit confusing, GradedRing actually takes in any <code>AddSubmonoidClass</code>, and GradedAlgebra is an abbrev for GradedRing (with the <code>AddSubmonoidClass</code> specialised to Submodule over some ring)</p>",
        "id": 543305804,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759755165
    },
    {
        "content": "<p>The naming is confusing here, <code>GradedRing</code> is also a graded algebra in informal terms.</p>",
        "id": 543305823,
        "sender_full_name": "Christian Merten",
        "timestamp": 1759755168
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/blob/586e9c386274d740624bd33abe9a67f7365a92fc/Mathlib/RingTheory/GradedAlgebra/Basic.lean#L164-L167\">https://github.com/leanprover-community/mathlib4/blob/586e9c386274d740624bd33abe9a67f7365a92fc/Mathlib/RingTheory/GradedAlgebra/Basic.lean#L164-L167</a></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- A special case of `GradedRing` with `œÉ = Submodule R A`. This is useful both because it</span>\n<span class=\"sd\">can avoid typeclass search, and because it provides a more concise name. -/</span>\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">GradedAlgebra</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">GradedRing</span><span class=\"w\"> </span><span class=\"n\">ùíú</span>\n</code></pre></div>",
        "id": 543305878,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759755179
    },
    {
        "content": "<p>and any graded ring gives you a map Proj A -&gt; Spec A0</p>",
        "id": 543305972,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759755206
    },
    {
        "content": "<p>so... graded ring?</p>",
        "id": 543453440,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759819006
    },
    {
        "content": "<p>I need to change <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=HomogeneousLocalization#doc\">docs#HomogeneousLocalization</a> as well</p>",
        "id": 543487854,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759830545
    },
    {
        "content": "<p>but it should just be literally as simple as changing it to GradedRing</p>",
        "id": 543487889,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759830556
    },
    {
        "content": "<p>my only concern here is performance -- GradedAlgebra explicitly says it's there to speed up typeclass search</p>",
        "id": 543492016,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759831872
    },
    {
        "content": "<p>(but actually don't you need to synthesize the same class every time you call GradedAlgebra anyway? idk how this works; i've also heard \"premature optimisation is the root of all evil\")</p>",
        "id": 543492058,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759831895
    },
    {
        "content": "<p>The only way to know for sure is to try it and measure the effect.</p>",
        "id": 543492168,
        "sender_full_name": "Christian Merten",
        "timestamp": 1759831936
    },
    {
        "content": "<p>yeah, i'm trying</p>",
        "id": 543492187,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759831945
    },
    {
        "content": "<p>i'll bench afterwards</p>",
        "id": 543492198,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759831949
    },
    {
        "content": "<p>(i can't read the result anyway, it's all in the order of 10^9, idk what that means)</p>",
        "id": 543492248,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759831969
    },
    {
        "content": "<p>I fear that generalizing away from Submodule leads to duplication between rings and semirings</p>",
        "id": 543496714,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759833508
    },
    {
        "content": "<p>Because <code>AddSubmonoidClass</code> doesn't go very far in unifying them</p>",
        "id": 543496778,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759833526
    },
    {
        "content": "<p>sorry, I didn't understand what you meant, what sort of duplication?</p>",
        "id": 543496851,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759833549
    },
    {
        "content": "<p>I guess the question is whether you end up having to specialize to <code>AddSubmonoid</code> and <code>AddSubgroup</code> in your generalization, rather than being able to stick with <code>AddSubmonoidClass</code> throughout</p>",
        "id": 543496995,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759833601
    },
    {
        "content": "<p>what's wrong with using the AddSubmonoidClass infrastructure?</p>",
        "id": 543497079,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759833626
    },
    {
        "content": "<p>i'll however tell you one obstacle i'm facing right now:</p>",
        "id": 543497121,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759833643
    },
    {
        "content": "<p>You can't write <code>\\sup</code> or <code>map</code> with <code>AddSubmonoidClass</code></p>",
        "id": 543497134,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759833648
    },
    {
        "content": "<p>hmm...</p>",
        "id": 543497173,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759833659
    },
    {
        "content": "<p>should we extend AddSubmonoidClass?</p>",
        "id": 543497243,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759833681
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Proj.20should.20take.20GradedRing/near/543497121\">said</a>:</p>\n<blockquote>\n<p>i'll however tell you one obstacle i'm facing right now:</p>\n</blockquote>\n<p>I need a way to say that \"N has a smul on submodules that commute with inclusion\"</p>",
        "id": 543497303,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759833701
    },
    {
        "content": "<p>But it's possible that's my concern not relevant to Proj; my comment was meant as a <img alt=\":knuth:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/1acbf356.png\" title=\"knuth\"> of a problem you might run into, not an objection to you trying</p>",
        "id": 543497358,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759833722
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Proj.20should.20take.20GradedRing/near/543497303\">said</a>:</p>\n<blockquote>\n<p>I need a way to say that \"N has a smul on submodules that commute with inclusion\"</p>\n</blockquote>\n<p>This is covered by IsScalarTower if 1 exists, but if there's no 1 then it's a bit trickier to say that</p>",
        "id": 543497535,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759833778
    },
    {
        "content": "<p>and I don't think SMulMemClass works, because that class defines its own smul</p>",
        "id": 543497581,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759833794
    },
    {
        "content": "<p>What's the statement you want?</p>",
        "id": 543498171,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759833995
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"c1\">-- `œÉ` is a class of subsets of `M`</span>\n<span class=\"c1\">-- and `Œ±` acts on both</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"n\">œÉ</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SetLike</span><span class=\"w\"> </span><span class=\"n\">œÉ</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SMul</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">œÉ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">SMul</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">]</span>\n<span class=\"sd\">/-- The `Prop` that says the two actions commute -/</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">CoeSMulClass</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">coe_smul</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">œÉ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div>",
        "id": 543498702,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759834175
    },
    {
        "content": "<p>actually i didn't need any of the add stuff, modified</p>",
        "id": 543498836,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759834214
    },
    {
        "content": "<p>actually i could move <code>s</code> out as well</p>",
        "id": 543498988,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759834260
    },
    {
        "content": "<p>wait, this just says coe satisfies map_smul??</p>",
        "id": 543499109,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759834291
    },
    {
        "content": "<p>nah i don't think that helps</p>",
        "id": 543499350,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759834348
    },
    {
        "content": "<p><code>[‚àÄ s : œÉ, SMul Œ± s]</code> combined with <code>coe_smul </code> is basically saying that<code>œÉ</code> is a submodule, isn't it?</p>",
        "id": 543499587,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759834412
    },
    {
        "content": "<p>it's interesting isn't it, we set up all this infrastructure for SetLike etc to solve all the problems, and now you're kinda telling me to not use it</p>",
        "id": 543499674,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759834434
    },
    {
        "content": "<p>I'm telling you where it will stop working for you, not that you shouldn't try using it</p>",
        "id": 543499751,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759834460
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Proj.20should.20take.20GradedRing/near/543499587\">said</a>:</p>\n<blockquote>\n<p><code>[‚àÄ s : œÉ, SMul Œ± s]</code> combined with <code>coe_smul </code> is basically saying that<code>œÉ</code> is a submodule, isn't it?</p>\n</blockquote>\n<p>I think you'll understand more when I give you the example (give me 1 min)</p>",
        "id": 543499790,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759834476
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Proj.20should.20take.20GradedRing/near/543497303\">said</a>:</p>\n<blockquote>\n<p>I need a way to say that \"N has a smul on submodules that commute with inclusion\"</p>\n</blockquote>\n<p>Do you mean <code>‚Ñï</code>?</p>",
        "id": 543499895,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759834509
    },
    {
        "content": "<p>yes</p>",
        "id": 543499924,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759834519
    },
    {
        "content": "<p>coe_nsmul should be a lemma for AddSubmonoidClass, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AddSubmonoidClass.coe_nsmul#doc\">docs#AddSubmonoidClass.coe_nsmul</a></p>",
        "id": 543499996,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759834544
    },
    {
        "content": "<p>i don't want to call a lemma for each possible scalar type...</p>",
        "id": 543500099,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759834577
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Proj.20should.20take.20GradedRing/near/543499924\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Proj.20should.20take.20GradedRing/near/543499895\">said</a>:</p>\n<blockquote>\n<p>Do you mean <code>‚Ñï</code>?</p>\n</blockquote>\n<p>yes</p>\n</blockquote>\n<p>So you mean \"yes, but also every other semiring too\"?</p>",
        "id": 543500239,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759834619
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"c1\">-- `œÉ` is a class of add-subgroups of `M`</span>\n<span class=\"c1\">-- and `Œ±` acts on both</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"n\">œÉ</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span>\n\n<span class=\"kn\">section</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SetLike</span><span class=\"w\"> </span><span class=\"n\">œÉ</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SMul</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">œÉ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">SMul</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">]</span>\n\n<span class=\"sd\">/-- The `Prop` that says the two actions commute -/</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">CoeSMulClass</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">coe_smul</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">œÉ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">AddCommMonoid</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SetLike</span><span class=\"w\"> </span><span class=\"n\">œÉ</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddSubmonoidClass</span><span class=\"w\"> </span><span class=\"n\">œÉ</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CoeSMulClass</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"w\"> </span><span class=\"n\">œÉ</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">coe_smul</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">AddSubmonoidClass</span><span class=\"bp\">.</span><span class=\"n\">coe_nsmul</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">n</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">AddCommMonoid</span>\n</code></pre></div>",
        "id": 543500321,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759834643
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Proj.20should.20take.20GradedRing/near/543500239\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Proj.20should.20take.20GradedRing/near/543499924\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Proj.20should.20take.20GradedRing/near/543499895\">said</a>:</p>\n<blockquote>\n<p>Do you mean <code>‚Ñï</code>?</p>\n</blockquote>\n<p>yes</p>\n</blockquote>\n<p>So you mean \"yes, but also every other semiring too\"?</p>\n</blockquote>\n<p>and their units, and their Finsets, and their Sets, ...</p>",
        "id": 543500386,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759834664
    },
    {
        "content": "<p>ok maybe not finset/set</p>",
        "id": 543500413,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759834675
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Proj.20should.20take.20GradedRing/near/543498171\">said</a>:</p>\n<blockquote>\n<p>What's the statement you want?</p>\n</blockquote>\n<p>You seems to have given me the implementation that you think solves your problem (<a href=\"https://en.wikipedia.org/wiki/XY_problem\">#xy</a>). Without defining any new classes or generalizing, what's the concrete statement you want?</p>",
        "id": 543500579,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759834729
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">HomogeneousLocalization</span><span class=\"bp\">.</span><span class=\"n\">val_smul</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">Œπ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_2</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_3</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ùíú</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œπ</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Submodule</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Submonoid</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_4</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SMul</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SMul</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsScalarTower</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsScalarTower</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HomogeneousLocalization</span><span class=\"w\"> </span><span class=\"n\">ùíú</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">.</span><span class=\"n\">val</span>\n</code></pre></div>",
        "id": 543500899,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759834830
    },
    {
        "content": "<p>I want to define a smul on HomogeneousLocalization</p>",
        "id": 543501010,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759834865
    },
    {
        "content": "<p>now HomogeneousLocalization is a quotient of <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/RingTheory/GradedAlgebra/HomogeneousLocalization.html#HomogeneousLocalization.NumDenSameDeg\">HomogeneousLocalization.NumDenSameDeg</a></p>",
        "id": 543501087,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759834891
    },
    {
        "content": "<p>which is an expression of the form <code>(a : ùíú i) / (s : ùíú i ‚à© x)</code> (<code>x</code> is the submonoid we're localization at)</p>",
        "id": 543501202,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759834930
    },
    {
        "content": "<p>to define the action of a scalar <code>c : Œ±</code>, you define it on this expression as <code>(c ‚Ä¢ a) / s</code></p>",
        "id": 543501302,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759834968
    },
    {
        "content": "<p>to prove that it's well-defined, you embed everything to <code>Localization x</code>, where you can pull the smul out precisely because of the coe_smul lemma above</p>",
        "id": 543501430,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759835016
    },
    {
        "content": "<p>I haven't made any new generalisation because <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=HomogeneousLocalization.val_smul#doc\">docs#HomogeneousLocalization.val_smul</a> already has a general scalar type Œ±</p>",
        "id": 543501534,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759835047
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Proj.20should.20take.20GradedRing/near/543501430\">said</a>:</p>\n<blockquote>\n<p>to prove that it's well-defined, you embed everything to <code>Localization x</code>, where you can pull the smul out precisely because of the coe_smul lemma above</p>\n</blockquote>\n<p>more precisely, the proof is:</p>\n<ul>\n<li><code>Localization.mk (‚Üë(c ‚Ä¢ a)) (s)</code></li>\n<li><code>= Localization.mk (c ‚Ä¢ ‚Üëa) (s)</code></li>\n<li><code>= c ‚Ä¢ Localization.mk (‚Üëa) (s)</code></li>\n<li><code>= c ‚Ä¢ Localization.mk (‚Üëa') (s')</code></li>\n<li>= reverse the order</li>\n</ul>",
        "id": 543501867,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759835159
    },
    {
        "content": "<p>the second bullet point is coe_smul</p>",
        "id": 543501908,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759835169
    },
    {
        "content": "<p>the fact that in that file you have <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/RingTheory/GradedAlgebra/HomogeneousLocalization.html#HomogeneousLocalization.val_nsmul\">nsmul</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/RingTheory/GradedAlgebra/HomogeneousLocalization.html#HomogeneousLocalization.val_zsmul\">zsmul</a> as separate lemmas imply to me that the class hasn't been set up and the class needs to be set up</p>",
        "id": 543504284,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759835907
    },
    {
        "content": "<p>The class you're describing already exists, it's <code>SmulMemClass</code></p>",
        "id": 543504769,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759836057
    },
    {
        "content": "<p>right, except that SMulMemClass creates its own smul instance</p>",
        "id": 543504837,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759836075
    },
    {
        "content": "<p>That's the right thing to do</p>",
        "id": 543504871,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759836083
    },
    {
        "content": "<p><code>[‚àÄ s : œÉ, SMul Œ± s]</code> is not a reasonable thing to assume</p>",
        "id": 543504892,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759836092
    },
    {
        "content": "<p>no, because nsmul has a separate instance</p>",
        "id": 543504902,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759836094
    },
    {
        "content": "<p>it is reasonable because that's how it works for N</p>",
        "id": 543504929,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759836103
    },
    {
        "content": "<p>It's defeq, or should be</p>",
        "id": 543504940,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759836107
    },
    {
        "content": "<p>I don't think so</p>",
        "id": 543504974,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759836118
    },
    {
        "content": "<p>no, nsmul is always \"add this n times\"</p>",
        "id": 543505006,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759836127
    },
    {
        "content": "<p>or it should be</p>",
        "id": 543505023,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759836133
    },
    {
        "content": "<p>The whole point of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AddMonoid.nsmul#doc\">docs#AddMonoid.nsmul</a> is to allow it to _not_ be defeq to \"add this n times\", so that it can instead be defeq to a different smul</p>",
        "id": 543505108,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759836154
    },
    {
        "content": "<p>there's no reason nsmul should look at a setlike and be like \"oh wow this is a setlike i'm not gonna add it n times\"</p>",
        "id": 543505110,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759836154
    },
    {
        "content": "<p>your link doesn't work</p>",
        "id": 543505252,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759836200
    },
    {
        "content": "<p>Reason or not, <a href=\"https://github.com/leanprover-community/mathlib4/blob/c857041a03dbfe309ffcd501c72e34f6a259f013/Mathlib/Algebra/Group/Submonoid/Defs.lean#L338-L341\">that's what it does</a></p>",
        "id": 543505275,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759836207
    },
    {
        "content": "<p>hmm, lemme try again, i thought it didn't work the first time i tried smulmemclass</p>",
        "id": 543505504,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759836287
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Proj.20should.20take.20GradedRing/near/543504769\">said</a>:</p>\n<blockquote>\n<p>The class you're describing already exists, it's <code>SmulMemClass</code></p>\n</blockquote>\n<p>You can't use it because the action is an outParam, and so we can't have both <code>SmulMemClass Nat (s : Subgroup A)</code> and <code>SmulMemClass Int (s : Subgroup A)</code></p>",
        "id": 543505822,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759836381
    },
    {
        "content": "<p>right, ok, that's where the problem was</p>",
        "id": 543506570,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759836623
    },
    {
        "content": "<p>(i switched back to smulmemclass and saw where the problem was)</p>",
        "id": 543506600,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759836631
    },
    {
        "content": "<p>i'm getting the error:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>failed to synthesize\n  HSMul ‚Ñï (HomogeneousLocalization ùíú x) ?m.25\n</code></pre></div>",
        "id": 543506626,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759836642
    },
    {
        "content": "<p>does that mean i need to define nsmul separately?</p>",
        "id": 543506675,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759836661
    },
    {
        "content": "<p>like now i really see where the <a href=\"https://en.wikipedia.org/wiki/XY_problem\">#xy</a> was, i saw this error and thought \"aha i need my own smul instance\"</p>",
        "id": 543506842,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759836709
    },
    {
        "content": "<p>yep now i found that <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/GroupTheory/GroupAction/SubMulAction.html#AddSubmonoidClass.nsmulMemClass\">AddSubmonoidClass.nsmulMemClass</a> is a theorem (so \"local instance\")</p>",
        "id": 543515699,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759839269
    },
    {
        "content": "<blockquote>\n<p>does that mean i need to define nsmul separately?</p>\n</blockquote>\n<p>No, it should be provided through the AddCommMonoid instance on <code>HomogeneousLocalization </code>, assuming one exists</p>",
        "id": 543527138,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759842250
    },
    {
        "content": "<p>aha ok</p>",
        "id": 543527369,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759842305
    },
    {
        "content": "<p>The <code>?m.25</code> suggests to me you might want a type ascription in order to see the real error</p>",
        "id": 543527965,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759842454
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Proj.20should.20take.20GradedRing/near/543527965\">said</a>:</p>\n<blockquote>\n<p>The <code>?m.25</code> suggests to me you might want a type ascription in order to see the real error</p>\n</blockquote>\n<p>It's an outparam so having a type ascription won't make the metavariable go away</p>",
        "id": 543538631,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1759845294
    },
    {
        "content": "<p>Created <a href=\"https://github.com/leanprover-community/mathlib4/pull/30302\">#30302</a>. There is a strange thing happening that I need to investigate further</p>",
        "id": 543576425,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759854870
    },
    {
        "content": "<p>ah actually i misread the code and it's actually fine</p>",
        "id": 543577031,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759855026
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Proj.20should.20take.20GradedRing/near/543527138\">said</a>:</p>\n<blockquote>\n<p>No, it should be provided through the AddCommMonoid instance on <code>HomogeneousLocalization</code> , assuming one exists</p>\n</blockquote>\n<p>I agree with this in principle, but I notice that in the file the CommRIng instance is <a href=\"https://github.com/kckennylau/mathlib4/blob/ee2d543684fffdce3d5287a3fa6da272f78755f8/Mathlib/RingTheory/GradedAlgebra/HomogeneousLocalization.lean#L484\">defined</a> using the injective map to Localization, so I wonder if it's correct to actually define nsmul separately first</p>",
        "id": 543583271,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759856833
    },
    {
        "content": "<p>and I think in light of that, I think before the refactor it actually went through the same path</p>",
        "id": 543583424,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759856872
    },
    {
        "content": "<p>they just didn't have to write out the instances explicitly, but in effect before the refactor they also had a separate nsmul and zsmul instance before defining the commring structure</p>",
        "id": 543583518,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759856900
    },
    {
        "content": "<p>I think this refactor has confirmed my suspicion - we actually haven't talked about the base ring at all (and indeed i had to add those lemmas in my projective space project)</p>",
        "id": 543586875,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759857960
    }
]