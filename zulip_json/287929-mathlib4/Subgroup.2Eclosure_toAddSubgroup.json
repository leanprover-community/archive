[
    {
        "content": "<p>Somehow, I have the feeling that the proof below is not optimal. I seem to have trouble finding the best way to deal with <code>Additive</code> and <code>Multiplicative</code>. If anyone could improve on it, I would be grateful. Also, is there a way to deduce easily the proof of the <code>Additive</code> version from the <code>Multiplicative</code> version?</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib.Algebra.Group.Subgroup.Lattice</span>\n\n<span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"n\">Subgroup.closure_toAddSubgroup</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Subgroup.closure</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toAddSubgroup</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">AddSubgroup.closure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Additive.ofMul</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">OrderIso.apply_eq_iff_eq_symm_apply</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">AddSubgroup.closure</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">OrderIso.map_sInf_eq_sInf_symm_preimage</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">OrderIso.symm_symm</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Set.preimage_setOf_eq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">coe_toAddSubgroup_apply</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Set.preimage_equiv_eq_image_symm</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">Additive.toMul_symm_eq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Set.image_subset_iff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Equiv.preimage_image</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">closure</span><span class=\"o\">]</span>\n\n<span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"n\">_AddSubgroup.closure_toSubgroup</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddGroup</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">AddSubgroup.closure</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toSubgroup</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Subgroup.closure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative.ofAdd</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 506942322,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1742469161
    },
    {
        "content": "<p>This is not exactly what you are asking for, but in case it is helpful, I wrote some similar theorems a while ago:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">AddSubgroup</span><span class=\"bp\">.</span><span class=\"n\">toSubgroup_closure</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddGroup</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">AddSubgroup</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toSubgroup</span><span class=\"w\">  </span><span class=\"bp\">=</span>\n<span class=\"w\">      </span><span class=\"n\">Subgroup</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"n\">toAdd</span><span class=\"w\"> </span><span class=\"bp\">⁻¹'</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">le_antisymm</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">AddSubgroup</span><span class=\"bp\">.</span><span class=\"n\">toSubgroup</span><span class=\"bp\">.</span><span class=\"n\">to_galoisConnection</span><span class=\"bp\">.</span><span class=\"n\">l_le</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">AddSubgroup</span><span class=\"bp\">.</span><span class=\"n\">closure_le</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Subgroup</span><span class=\"bp\">.</span><span class=\"n\">subset_closure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Multiplicative</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"o\">((</span><span class=\"n\">Subgroup</span><span class=\"bp\">.</span><span class=\"n\">closure_le</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">AddSubgroup</span><span class=\"bp\">.</span><span class=\"n\">subset_closure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">))</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Subgroup</span><span class=\"bp\">.</span><span class=\"n\">toAddSubgroup_closure</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Subgroup</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toAddSubgroup</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">      </span><span class=\"n\">AddSubgroup</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Additive</span><span class=\"bp\">.</span><span class=\"n\">toMul</span><span class=\"w\"> </span><span class=\"bp\">⁻¹'</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">le_antisymm</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Subgroup</span><span class=\"bp\">.</span><span class=\"n\">toAddSubgroup</span><span class=\"bp\">.</span><span class=\"n\">le_symm_apply</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">Subgroup</span><span class=\"bp\">.</span><span class=\"n\">closure_le</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">AddSubgroup</span><span class=\"bp\">.</span><span class=\"n\">subset_closure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Additive</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)))</span>\n<span class=\"w\">    </span><span class=\"o\">((</span><span class=\"n\">AddSubgroup</span><span class=\"bp\">.</span><span class=\"n\">closure_le</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Subgroup</span><span class=\"bp\">.</span><span class=\"n\">subset_closure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)))</span>\n</code></pre></div>",
        "id": 506951119,
        "sender_full_name": "María Inés de Frutos Fernández",
        "timestamp": 1742471580
    },
    {
        "content": "<p>Thanks. It is quite close and I guess your proof is somewhat cleaner. In any case, it is interesting to see that you reproved the second version and were not able to use the first proof to deduce the second one.</p>",
        "id": 506976264,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1742478066
    },
    {
        "content": "<p>Here's the second one in terms of the first:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Subgroup</span><span class=\"bp\">.</span><span class=\"n\">toAddSubgroup_closure</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Subgroup</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toAddSubgroup</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">      </span><span class=\"n\">AddSubgroup</span><span class=\"bp\">.</span><span class=\"n\">closure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Additive</span><span class=\"bp\">.</span><span class=\"n\">toMul</span><span class=\"w\"> </span><span class=\"bp\">⁻¹'</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">AddSubgroup</span><span class=\"bp\">.</span><span class=\"n\">toSubgroup</span><span class=\"bp\">.</span><span class=\"n\">injective</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">AddSubgroup</span><span class=\"bp\">.</span><span class=\"n\">toSubgroup_closure</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n</code></pre></div>",
        "id": 506979502,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1742478805
    },
    {
        "content": "<p>Thanks. Can I use that (with due credit) in a coming PR?</p>",
        "id": 507041056,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1742493137
    },
    {
        "content": "<p>Yes, though I think you can shrink it further by using something from the Equiv API</p>",
        "id": 507062246,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1742500133
    },
    {
        "content": "<p>I have another question though. What is the best spelling for this result: </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"n\">AddSubgroup.closure_toSubgroup</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddGroup</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">AddSubgroup.closure</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toSubgroup</span><span class=\"w\">  </span><span class=\"bp\">=</span>\n<span class=\"w\">      </span><span class=\"n\">Subgroup.closure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative.ofAdd</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n</code></pre></div>\n<p>or</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"n\">AddSubgroup.closure_toSubgroup</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddGroup</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">AddSubgroup.closure</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toSubgroup</span><span class=\"w\">  </span><span class=\"bp\">=</span>\n<span class=\"w\">      </span><span class=\"n\">Subgroup.closure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative.toAdd</span><span class=\"w\"> </span><span class=\"bp\">⁻¹'</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n</code></pre></div>\n<p>That is: <code>Multiplicative.ofAdd '' S</code> or <code>Multiplicative.toAdd ⁻¹' S</code>?</p>",
        "id": 507222494,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1742547280
    },
    {
        "content": "<p>I think the preimage is preferred</p>",
        "id": 507222616,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1742547318
    },
    {
        "content": "<p>Ok. thanks</p>",
        "id": 507222651,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1742547335
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/23171\">#23171</a></p>",
        "id": 507234660,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1742551146
    },
    {
        "content": "<p>Preimage has better defeqs because there's not a random \"exists\" in the middle</p>",
        "id": 507239679,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1742552746
    }
]