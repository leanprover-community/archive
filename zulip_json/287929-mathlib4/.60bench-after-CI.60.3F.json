[
    {
        "content": "<p>I was wondering if having a <code>bench-after-CI</code> label would be useful.</p>\n<p>This would be like <code>awaiting-CI</code>, except that, once CI is done, it would comment <code>!bench</code> on the PR.</p>",
        "id": 497605530,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738657398
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/21414\">#21414</a></p>",
        "id": 497637698,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738667165
    },
    {
        "content": "<p>Should the label be called <code>bench-after-CI</code>? It's currently called <code>merge-after-CI</code>.<br>\n(Update: also removed <code>merge-after-CI</code> and copied over the description.)</p>",
        "id": 497638332,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1738667366
    },
    {
        "content": "<p>I just created and added a bench-after-CI label.</p>",
        "id": 497638628,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1738667455
    },
    {
        "content": "<p>Ah, thanks!  I got confused and added the wrong one!</p>",
        "id": 497638637,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738667458
    },
    {
        "content": "<p>Should we then remove <code>awaiting-bench</code>? I believe it becomes redundant with this setup: A PR tagged <code>awaiting-bench</code> is either waiting for a bench to happen (and then should be marked <code>bench-after-CI</code>), or has been benched already (and then <code>awaiting-bench</code> is outdated and should be removed).</p>",
        "id": 497638807,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1738667508
    },
    {
        "content": "<p>Here I am assuming <code>bench-after-CI</code> is removed once <em>the bench is done</em>, not once <em>the bench is triggered</em></p>",
        "id": 497639188,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1738667618
    },
    {
        "content": "<p>I don't see any automation associated with <code>awaiting-bench</code>...</p>",
        "id": 497639385,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738667673
    },
    {
        "content": "<p>I mean \"Should we delete the label called <code>awaiting-bench</code> from the <code>mathlib4</code> github repo?\"</p>",
        "id": 497639523,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1738667718
    },
    {
        "content": "<p>Yes, I think so then!</p>",
        "id": 497639597,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738667743
    },
    {
        "content": "<p>What the PR does is, once CI is finished (not just building master, but also finished linting), it checks if the <code>bench-after-CI</code> label is present and, if so, removes the label and comments <code>!bench</code>.  This means that, while benching is happening, the label is not there.</p>",
        "id": 497639909,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738667835
    },
    {
        "content": "<p>Oh, the automation already worked on the PR proposing the change!</p>",
        "id": 497640036,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738667872
    },
    {
        "content": "<p>So the PR is self-testing.</p>",
        "id": 497640055,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738667878
    },
    {
        "content": "<p>Or rather, it passed its self-test!</p>",
        "id": 497640161,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738667903
    },
    {
        "content": "<p>I should have labeled it <code>merge-after-self-test</code>!  <span aria-label=\"lol\" class=\"emoji emoji-1f606\" role=\"img\" title=\"lol\">:lol:</span></p>",
        "id": 497640219,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738667926
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60bench-after-CI.60.3F/near/497639523\">said</a>:</p>\n<blockquote>\n<p>I mean \"Should we delete the label called <code>awaiting-bench</code> from the <code>mathlib4</code> github repo?\"</p>\n</blockquote>\n<p>There are currently <a href=\"https://github.com/leanprover-community/mathlib4/pulls?q=is%3Aopen+is%3Apr+label%3Aawaiting-bench\">some PRs</a> that have the <code>awaiting-bench</code> label: I wonder whether they should get a different label instead, when/if removing the label?</p>",
        "id": 497641097,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738668220
    },
    {
        "content": "<p>I guess I don't understand why/when people use <code>awaiting-bench</code> <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 497641636,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1738668394
    },
    {
        "content": "<p>Maybe to signal the period between commenting <code>!bench</code> and when the results arrive?</p>",
        "id": 497643320,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738668945
    },
    {
        "content": "<p>I've used <code>awaiting-bench</code>to either remind myself \"benchmark this once CI completes\" (which the new label would do), signal \"this PR should be benchmarked before landing\" (also fine) and sometimes when the benchmarking bot is down, as a reminder (this might not be covered).</p>\n<p>If we make bors reject the <code>bench-after-CI</code> label, I think <code>awaiting-bench</code> is not needed any more.</p>",
        "id": 497657726,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1738673418
    },
    {
        "content": "<p>How can you get bors to reject something?  I cannot find code related to that...</p>",
        "id": 497752253,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738701524
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> here: <a href=\"https://github.com/leanprover-community/mathlib4/blob/master/bors.toml#L4\">https://github.com/leanprover-community/mathlib4/blob/master/bors.toml#L4</a></p>",
        "id": 497752458,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1738701605
    },
    {
        "content": "<p>I just found a promising <code>bors-toml</code>.</p>",
        "id": 497752467,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738701609
    },
    {
        "content": "<p>Ok, should the label then be a reason for bors to reject the PR and should it be the \"mathlib\" <code>bench</code>-summary bot the one who removes it?</p>",
        "id": 497752575,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738701663
    },
    {
        "content": "<p>So, once the label is applied, only if the <code>bench</code>-summary bot is working you can get it removed automatically?</p>",
        "id": 497752622,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738701686
    },
    {
        "content": "<p>(Of course, you can always remove the label manually.)</p>",
        "id": 497752647,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738701696
    },
    {
        "content": "<p>Right, I guess having the bench summary bot remove the label does make the label's presence / absence more informative.</p>",
        "id": 497753500,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1738702059
    },
    {
        "content": "<p>Ok, given that the label can be removed manually, overriding possible temporary failures, I will make the management of the label be controlled by the bench-summary bot.</p>",
        "id": 497753648,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738702121
    },
    {
        "content": "<p>I realize that the bench-summary may be broken independently of <code>!bench</code>, but this should be hopefully rare and it is easy to remove a label manually anyway.</p>",
        "id": 497753761,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738702177
    },
    {
        "content": "<p>I changed the workflow to be what was discussed: the label is removed by the <code>bench</code>-summary bot.  I am trying it out again on the same PR: I hope that <code>!bench</code> will not recompute the values, since the PR did not change the <code>lean</code> files.</p>",
        "id": 497756813,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738703315
    },
    {
        "content": "<p>I now moved the label-removal step to the <code>bench</code>-summary script.  GitHub runs the master version of this one, so I could not test again the removal, but I am fairly sure that it works.</p>",
        "id": 497763121,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738705751
    },
    {
        "content": "<p>Bryan had approved the previous workflow.  Are there any objection to merging the PR?</p>",
        "id": 497763140,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738705758
    }
]