[
    {
        "content": "<p>I found a small beautiful bikeshed which I would like to show you. It relates to indentation of items in doc-strings.</p>\n<p><strong>Question 1.</strong> In a declaration doc-string, should the second lines be indented?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- My favourite declaration</span>\n<span class=\"sd\">  has a really long doc-string. -/</span>\n</code></pre></div>\n<p>(edited to add: Let's assume that we want to write this without line breaks before/after the comment markers, because this really just has two lines. <em>That</em> aspect was discussed elsewhere.)</p>\n<p>I believe the consensus is <strong>not</strong>, and the <em>preferred style</em> is</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- My favourite declaration with a multi-line doc-string</span>\n<span class=\"sd\">has unindented second line. -/</span>\n</code></pre></div>",
        "id": 500681369,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1739979754
    },
    {
        "content": "<p><strong>Question 2.</strong> What about items in module doc-strings?<br>\nImagine the following is part of a module doc-string: is the indentation on the second line required, forbidden or optional either way?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">##</span><span class=\"w\"> </span><span class=\"n\">Main</span><span class=\"w\"> </span><span class=\"n\">results</span>\n\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"ss\">`exists_foo</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">existence</span><span class=\"w\"> </span><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"ss\">`foo`s</span><span class=\"bp\">.</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"ss\">`bar_of_foo</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">construction</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"ss\">`bar</span><span class=\"bp\">`</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">given</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"ss\">`foo</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">under</span><span class=\"w\"> </span><span class=\"n\">very</span><span class=\"w\"> </span><span class=\"n\">complicated</span>\n<span class=\"w\">  </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">intricate</span><span class=\"w\"> </span><span class=\"n\">circumstances</span><span class=\"w\"> </span><span class=\"n\">worth</span><span class=\"w\"> </span><span class=\"n\">describing</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">excruciating</span><span class=\"w\"> </span><span class=\"n\">detail</span><span class=\"bp\">.</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"ss\">`bar_eq</span><span class=\"bp\">`</span><span class=\"w\">    </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">classification</span><span class=\"w\"> </span><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"ss\">`bar`s</span><span class=\"bp\">.</span>\n</code></pre></div>\n<p>I don't remember a consensus on this question. Did I miss one? I'd prefer a decision one way or the other, but don't care which one.<br>\n(I'm happy to create a poll if this wasn't discussed yet.)</p>",
        "id": 500681501,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1739979792
    },
    {
        "content": "<p>Option 1c:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/--</span>\n<span class=\"sd\">My favourite declaration with a multi-line doc-string</span>\n<span class=\"sd\">has unindented second line.</span>\n<span class=\"sd\">-/</span>\n</code></pre></div>",
        "id": 500681813,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1739979867
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Style.20.3Abicycle.3A.20.3A.20indenting.20second.20lines.20in.20doc-strings/near/500681813\">said</a>:</p>\n<blockquote>\n<p>Option 1c:</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/--</span>\n<span class=\"sd\">My favourite declaration with a multi-line doc-string</span>\n<span class=\"sd\">has unindented second line.</span>\n<span class=\"sd\">-/</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Of course. Let me clarify that question 1 is meant to be orthogonal of the \"multiple paragraphs\" question (which IIRC was discussed and mostly concluded a while ago).</p>",
        "id": 500681978,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1739979920
    },
    {
        "content": "<p>I think the answer to question 2 is \"yes, always indent\", because while</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">This</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">long</span><span class=\"w\"> </span><span class=\"n\">sentence</span>\n<span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">badly</span><span class=\"w\"> </span><span class=\"n\">wrapped</span><span class=\"bp\">.</span>\n<span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Another</span>\n</code></pre></div>\n<p>works, </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">This</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">long</span><span class=\"w\"> </span><span class=\"n\">sentence</span>\n<span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">badly</span><span class=\"w\"> </span><span class=\"n\">wrapped</span><span class=\"bp\">.</span>\n\n<span class=\"n\">This</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">next</span><span class=\"w\"> </span><span class=\"n\">paragraph</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">sentence</span>\n<span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Another</span>\n</code></pre></div>\n<p>renders incorrectly as</p>\n<blockquote>\n<ul>\n<li>This is a long sentence<br>\nthat is badly wrapped.</li>\n</ul>\n<p>This is the next paragraph of that sentence</p>\n<ul>\n<li>Another</li>\n</ul>\n</blockquote>",
        "id": 500682936,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1739980162
    },
    {
        "content": "<p>(which is to say; this is just the way that markdown expects to be written)</p>",
        "id": 500683368,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1739980257
    },
    {
        "content": "<p><span aria-label=\"bulb\" class=\"emoji emoji-1f4a1\" role=\"img\" title=\"bulb\">:bulb:</span> I see, thanks for clarifying!</p>",
        "id": 500686551,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1739981045
    },
    {
        "content": "<p>I have created <a href=\"https://github.com/leanprover-community/leanprover-community.github.io/pull/596\">https://github.com/leanprover-community/leanprover-community.github.io/pull/596</a> to clarify both points.</p>",
        "id": 500686580,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1739981054
    },
    {
        "content": "<p>And of course, linting for both of these would be nice.<br>\n<span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> Are there any complications with writing a syntax linter for module doc-strings, or doc-strings in general? Seems like a nice quick win.</p>\n<p>(I can try that myself, though perhaps only on two weeks.)</p>",
        "id": 500687924,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1739981460
    },
    {
        "content": "<p>I got a bit nerd-sniped: here's a function to check some of the requirements. The remaining part is hooking this up to a syntax linter for the doc-strings, and fixing any violations.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- Checks whether `input` is a declaration doc-string conforming syntactically</span>\n<span class=\"sd\">to mathlib's style guidelines. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">isGoodDocstring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">input</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"n\">input</span><span class=\"bp\">.</span><span class=\"n\">startsWith</span><span class=\"w\"> </span><span class=\"s2\">\"/--\"</span><span class=\"w\"> </span><span class=\"bp\">||</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"n\">input</span><span class=\"bp\">.</span><span class=\"n\">endsWith</span><span class=\"w\"> </span><span class=\"s2\">\"-/\"</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">eprintln</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"error: {input} is not a valid doc-string\"</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">false</span>\n\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"o\">(</span><span class=\"n\">input</span><span class=\"bp\">.</span><span class=\"n\">startsWith</span><span class=\"w\"> </span><span class=\"s2\">\"/--</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span><span class=\"w\"> </span><span class=\"bp\">||</span><span class=\"w\"> </span><span class=\"n\">input</span><span class=\"bp\">.</span><span class=\"n\">startsWith</span><span class=\"w\"> </span><span class=\"s2\">\"/-- \"</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">eprintln</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"error: doc-string </span><span class=\"se\">\\\"</span><span class=\"s2\">{input}</span><span class=\"se\">\\\"</span><span class=\"s2\"> should start with a space or newline\"</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"o\">(</span><span class=\"n\">input</span><span class=\"bp\">.</span><span class=\"n\">endsWith</span><span class=\"w\"> </span><span class=\"s2\">\"</span><span class=\"se\">\\n</span><span class=\"s2\">-/\"</span><span class=\"w\"> </span><span class=\"bp\">||</span><span class=\"w\"> </span><span class=\"n\">input</span><span class=\"bp\">.</span><span class=\"n\">startsWith</span><span class=\"w\"> </span><span class=\"s2\">\" -/\"</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">eprintln</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"error: doc-string </span><span class=\"se\">\\\"</span><span class=\"s2\">{input}</span><span class=\"se\">\\\"</span><span class=\"s2\"> end start with a space or newline\"</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"w\">  </span><span class=\"c1\">-- Catch extraneous spaces.</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">input</span><span class=\"bp\">.</span><span class=\"n\">startsWith</span><span class=\"w\"> </span><span class=\"s2\">\"/--  \"</span><span class=\"w\"> </span><span class=\"bp\">||</span><span class=\"w\"> </span><span class=\"n\">input</span><span class=\"bp\">.</span><span class=\"n\">endsWith</span><span class=\"w\"> </span><span class=\"s2\">\"  -/\"</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">eprintln</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"error: doc-string </span><span class=\"se\">\\\"</span><span class=\"s2\">{input}</span><span class=\"se\">\\\"</span><span class=\"s2\"> should start resp. end with at most a single space\"</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"w\">  </span><span class=\"c1\">-- Catch misleading indentation.</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">lines</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">input</span><span class=\"bp\">.</span><span class=\"n\">split</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"bp\">'\\</span><span class=\"n\">n'</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">drop</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">lines</span><span class=\"bp\">.</span><span class=\"n\">any</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"bp\">.</span><span class=\"n\">startsWith</span><span class=\"w\"> </span><span class=\"s2\">\" \"</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">eprintln</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"error: subsequent lines in the doc-string </span><span class=\"se\">\\\"</span><span class=\"s2\">{input}</span><span class=\"se\">\\\"</span><span class=\"s2\"> should not be indented\"</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"w\">  </span><span class=\"c1\">-- This list of checks is not exhaustive, but a good start.</span>\n<span class=\"w\">  </span><span class=\"c1\">-- Future ideas: doc-strings ending with a single quote or with a comma</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">true</span>\n</code></pre></div>",
        "id": 500692409,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1739982606
    },
    {
        "content": "<p>Here's an offer: if somebody hooks this up to a syntax linter, I'll help with landing the PR - by doing (some of) fixing up violations, writing tests for the linter or reviewing.</p>",
        "id": 500694688,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1739983248
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"634338\">@Michael Rothgang</span> <a href=\"https://github.com/leanprover-community/mathlib4/pull/22095\">#22095</a> has the commands to extract the docstring from syntax.  I think, I have not tested it much.</p>",
        "id": 500706215,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1739986578
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Style.20.3Abicycle.3A.20.3A.20indenting.20second.20lines.20in.20doc-strings/near/500681369\">said</a>:</p>\n<blockquote>\n<p><strong>Question 1.</strong> In a declaration doc-string, should the second lines be indented?</p>\n</blockquote>\n<p>I have been going around saying <strong>No</strong> in reviews <span aria-label=\"innocent\" class=\"emoji emoji-1f607\" role=\"img\" title=\"innocent\">:innocent:</span></p>",
        "id": 500710522,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1739988022
    },
    {
        "content": "<p>I personally also do not like indentation for Q1.  I think that indentation should be present only when it is for markdown.</p>",
        "id": 500710897,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1739988128
    },
    {
        "content": "<p>However, I think that if there is <em>one</em> style convention that everyone agrees on, then the linter should focus on just that one and then grow gradually.</p>",
        "id": 500711122,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1739988209
    },
    {
        "content": "<p>I suspect that even finding one format to enforce may be tricky.</p>",
        "id": 500711268,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1739988249
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Style.20.3Abicycle.3A.20.3A.20indenting.20second.20lines.20in.20doc-strings/near/500706215\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"https://github.com/leanprover-community/mathlib4/pull/22095\">#22095</a> has the commands to extract the docstring from syntax.  I think, I have not tested it much.</p>\n</blockquote>\n<p>I just added a first implementation of the linter: let's see what it finds in mathlib!</p>",
        "id": 500717896,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1739990291
    },
    {
        "content": "<p>Just under 3.5k exceptions!!  <span aria-label=\"octopus\" class=\"emoji emoji-1f419\" role=\"img\" title=\"octopus\">:octopus:</span></p>",
        "id": 500732602,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1739995421
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/22117\">#22117</a> and <a href=\"https://github.com/leanprover-community/mathlib4/pull/22118\">#22118</a> fix some clear cases where doc-strings should be un-indented.</p>",
        "id": 500834972,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1740044612
    },
    {
        "content": "<p>The linter at <a href=\"https://github.com/leanprover-community/mathlib4/pull/22095\">#22095</a> should now be passing CI.  All the exceptions that it found have slowly made it into mathlib.</p>",
        "id": 502159264,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1740610353
    },
    {
        "content": "<p>The new exceptions that have been accumulated since the linter started linting are in <a href=\"https://github.com/leanprover-community/mathlib4/pull/22343\">#22343</a>.</p>",
        "id": 502159268,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1740610355
    },
    {
        "content": "<p>The linter does minimal checks: it simply verifies that the first character after <code>/--</code> and before <code>-/</code> in a doc-string is either a space or a line break and that the next/previous character is neither a space nor a line break.</p>",
        "id": 502159377,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1740610414
    },
    {
        "content": "<p>This seems pretty uncontroversial and no one objected to any of the linter exceptions that have been fixed.</p>",
        "id": 502159415,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1740610437
    },
    {
        "content": "<p>Of the two PRs mentioned above, <a href=\"https://github.com/leanprover-community/mathlib4/pull/22343\">#22343</a> is a strict subset of <a href=\"https://github.com/leanprover-community/mathlib4/pull/22095\">#22095</a> and just contains the \"straightening up\" of the new linter exceptions.</p>",
        "id": 502159565,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1740610504
    },
    {
        "content": "<p>I have one last question for this bikeshed: what about multi-line docstrings for to_additive? Say, this one</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">to_additive</span>\n<span class=\"w\">      </span><span class=\"s2\">\"An element `a : M` of an `AddMonoid` is an `AddUnit` if it has a two-sided additive inverse.</span>\n<span class=\"s2\">      The actual definition says that `a` is equal to some `u : AddUnits M`,</span>\n<span class=\"s2\">      where `AddUnits M` is a bundled version of `IsAddUnit`.\"</span><span class=\"kd\">]</span>\n</code></pre></div>",
        "id": 506201449,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1742228387
    },
    {
        "content": "<p>I vote for \"don't indent\". This way the additive and multiplicative versions of the docstring are most likely to be whitespaced the same way</p>",
        "id": 506201988,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1742228497
    },
    {
        "content": "<p>An alternative would be \"indent with \\ continuations\" - or are you talking about inconsistent line wrapping due to a reduced column width?</p>",
        "id": 506211747,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1742230911
    },
    {
        "content": "<p>Latter</p>",
        "id": 506212551,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1742231098
    },
    {
        "content": "<p>(Slight tangent, but we could also change the syntax of <code>to_additive</code> so that the docstring argument is syntactically a docstring (<code>/-- -/</code>) instead of a string literal. Then it’s a bit more natural to lint it, it’s syntax-highlighted the same way, etc.)</p>",
        "id": 506214400,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1742231553
    },
    {
        "content": "<p>Ok, eight thumbs up. I'll get on that. :)</p>",
        "id": 508865540,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1743207824
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/24166\">#24166</a> fixes the indentation in about 100 doc-strings to match <a href=\"#narrow/channel/287929-mathlib4/topic/Style.20.3Abicycle.3A.20.3A.20indenting.20second.20lines.20in.20doc-strings/near/500682936\">markdown syntax</a>. This is just the first of these PRs, but will correct a few mis-formatted doc-strings.</p>",
        "id": 513056702,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1744991874
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/24171\">#24171</a> fixes more such doc-strings --- and corrects a few actual mis-formattings</p>",
        "id": 513148150,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1745050643
    },
    {
        "content": "<p>One detail which came up in this PR: for a comment like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Under</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">following</span><span class=\"w\"> </span><span class=\"n\">assumptions</span>\n<span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">first</span><span class=\"w\"> </span><span class=\"n\">property</span>\n<span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">second</span><span class=\"w\"> </span><span class=\"n\">property</span>\n<span class=\"n\">we</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">proven</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">following</span><span class=\"w\"> </span><span class=\"n\">theorems</span><span class=\"bp\">.</span>\n</code></pre></div>\n<p>we'd like the \"we have proven the following theorems\" to be \"part of\" the same paragraph, visually.</p>\n<p>On the other hand, that syntax is hard to distinguish from</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Under</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">following</span><span class=\"w\"> </span><span class=\"n\">assumptions</span>\n<span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">first</span><span class=\"w\"> </span><span class=\"n\">property</span>\n<span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">second</span><span class=\"w\"> </span><span class=\"n\">property</span><span class=\"w\"> </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">very</span><span class=\"w\"> </span><span class=\"n\">long</span><span class=\"o\">,</span>\n<span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">therefore</span><span class=\"w\"> </span><span class=\"n\">spans</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">second</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">bad</span>\n</code></pre></div>\n<p>where conceptually, really the item should be indented.</p>",
        "id": 513150580,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1745052725
    },
    {
        "content": "<p>Imposing the the first case be always written as</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Under</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">following</span><span class=\"w\"> </span><span class=\"n\">assumptions</span>\n<span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">first</span><span class=\"w\"> </span><span class=\"n\">property</span>\n<span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">second</span><span class=\"w\"> </span><span class=\"n\">property</span>\n\n<span class=\"n\">we</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">proven</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">following</span><span class=\"w\"> </span><span class=\"n\">theorems</span><span class=\"bp\">.</span>\n</code></pre></div>\n<p>makes it clear which one is meant (and allows writing a linter for it).<br>\nAre there any downsides, is there opposition to requiring this?</p>",
        "id": 513150610,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1745052767
    },
    {
        "content": "<p>This does not change the visual rendering in doc-gen.</p>",
        "id": 513150626,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1745052785
    },
    {
        "content": "<p>Weakly in favour of requiring the empty line, based on how often the indentation really is missing</p>",
        "id": 513150842,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1745052969
    },
    {
        "content": "<p>Provided this doesn't change the visual rendering in doc-gen, so it is visually part of the same paragraph there, I have no objection.</p>",
        "id": 513151321,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1745053374
    },
    {
        "content": "<p>Point of information: within the +-550 lines diff, all added lines should be contained in <a href=\"https://github.com/leanprover-community/mathlib4/pull/24171/commits/cd009f138421f82294dd56c7bb36bfc32726655e\">this commit</a>, about 25 lines.</p>",
        "id": 513158790,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1745059949
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Style.20.3Abicycle.3A.20.3A.20indenting.20second.20lines.20in.20doc-strings/near/513150580\">said</a>:</p>\n<blockquote>\n<p>On the other hand, that syntax is hard to distinguish from</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Under</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">following</span><span class=\"w\"> </span><span class=\"n\">assumptions</span>\n<span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">first</span><span class=\"w\"> </span><span class=\"n\">property</span>\n<span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">second</span><span class=\"w\"> </span><span class=\"n\">property</span><span class=\"w\"> </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">very</span><span class=\"w\"> </span><span class=\"n\">long</span><span class=\"o\">,</span>\n<span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">therefore</span><span class=\"w\"> </span><span class=\"n\">spans</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">second</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">bad</span>\n</code></pre></div>\n<p>where conceptually, really the item should be indented.</p>\n</blockquote>\n<p>Various markdown renderers do not support this, it would be worth checking what the commonmark spec says</p>",
        "id": 513186425,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1745081263
    },
    {
        "content": "<p>(note that html does not allow lists mid-paragraph either)</p>",
        "id": 513186492,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1745081293
    }
]