[
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/30587\">#30587</a> is straightforward (and almost ready to be merged), except for one remaining question: the PR adds a lemma <code>MeromorphicAt.ofNat</code> stating that <code>ofNat(n) : ğ•œ â†’ ğ•œ</code> is meromorphic at each point. Do we want to have such lemmas in general? There seems to be none about analytic, continuous or differentiable functions.</p>",
        "id": 545222583,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1760604474
    },
    {
        "content": "<p>What does this lemma even say? I.e., what is <code>ofNat(n) : ğ•œ â†’ ğ•œ</code>?</p>",
        "id": 545225493,
        "sender_full_name": "SÃ©bastien GouÃ«zel",
        "timestamp": 1760604968
    },
    {
        "content": "<p>If it's the constant function, we should just have the fact that a constant function is meromorphic, no reason to specialize it.</p>",
        "id": 545226287,
        "sender_full_name": "SÃ©bastien GouÃ«zel",
        "timestamp": 1760605100
    },
    {
        "content": "<p>Yes, it's the constant function (and mathlib knows that fact).</p>",
        "id": 545226549,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1760605141
    },
    {
        "content": "<p>In any case, it's unclear enough that I think we should avoid this phrasing.</p>",
        "id": 545227079,
        "sender_full_name": "SÃ©bastien GouÃ«zel",
        "timestamp": 1760605219
    },
    {
        "content": "<p>(and so dump the lemma)</p>",
        "id": 545227213,
        "sender_full_name": "SÃ©bastien GouÃ«zel",
        "timestamp": 1760605238
    },
    {
        "content": "<p>But then you can't prove inline that <code>1 : ğ•œ â†’ ğ•œ</code> is meromorphic!</p>",
        "id": 545276686,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1760613656
    },
    {
        "content": "<p>I think your argument also applies to <code>Nat.cast</code>, <code>Int.cast</code>, <code>Rat.cast</code>, and all these lemmas should be there for eg <code>fun_prop</code> to correctly work</p>",
        "id": 545277025,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1760613714
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">YaÃ«l Dillies</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Do.20we.20want.20a.20lemma.20AnalyticAt.2EofNat.3F/near/545276686\">said</a>:</p>\n<blockquote>\n<p>But then you can't prove inline that <code>1 : ğ•œ â†’ ğ•œ</code> is meromorphic!</p>\n</blockquote>\n<p>Yes, and that's fine because I claim we should avoid <code>1 : ğ•œ â†’ ğ•œ</code>: it wasn't clear to me if this was the constant function one or the identity. There are many more obvious spellings that we could/should use instead.</p>",
        "id": 545283988,
        "sender_full_name": "SÃ©bastien GouÃ«zel",
        "timestamp": 1760614854
    },
    {
        "content": "<p>Dear all, YaÃ«l was quicker than me. The following file illustrates the use of the lemma (which I learned from YaÃ«l earlier on). I think that this <strong>is</strong> a valid use case, but I do not have a strong enough opinion to start a lengthy/controversial argument or pick up a fight with anyone hereâ€¦</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">Meromorphic</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">MeromorphicOn</span><span class=\"w\"> </span><span class=\"n\">Metric</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">Classical</span>\n\n<span class=\"kn\">variable</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NontriviallyNormedField</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">Î¹</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î¹</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"o\">}</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">MeromorphicAt</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">testâ‚</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MeromorphicAt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">âˆ</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"bp\">âˆ…</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">prod_empty</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"c1\">-- At this stage, we have the goal `MeromorphicAt 1 x`, where the symbol `1`</span>\n<span class=\"w\">  </span><span class=\"c1\">-- really means `One.toOfNat1 : ğ•œ â†’ ğ•œ`. Mathlib knows that constant</span>\n<span class=\"w\">  </span><span class=\"c1\">-- functions are analytic/meromorphic, but cannot match the symbol `1` with</span>\n<span class=\"w\">  </span><span class=\"c1\">-- the constant function `fun _ â†¦ 1 : ğ•œ â†’ ğ•œ`. Therefore neither `simp` nor</span>\n<span class=\"w\">  </span><span class=\"c1\">-- `fun_prop` can close the goal at this point.</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n\n<span class=\"c1\">-- This lemma is in a form that allows matching `1` with the constant function.</span>\n<span class=\"kd\">@[</span><span class=\"n\">fun_prop</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">ofNat</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MeromorphicAt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ofNat</span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">analyticAt_const</span><span class=\"bp\">.</span><span class=\"n\">meromorphicAt</span>\n\n<span class=\"c1\">-- With the lemma above in place, the following now compiles fine, both using</span>\n<span class=\"c1\">-- `simp` or `fun_prop`.</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">testâ‚‚</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MeromorphicAt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">âˆ</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"bp\">âˆ…</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">MeromorphicAt</span>\n</code></pre></div>",
        "id": 545286548,
        "sender_full_name": "Stefan Kebekus",
        "timestamp": 1760615321
    },
    {
        "content": "<p>If the thought is that we should avoid <code>ofNat(n) : x -&gt; y</code>, then I think the natural conclusion is that <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Pi.ofNat_def#doc\">docs#Pi.ofNat_def</a> should be simp</p>",
        "id": 545628366,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1760720882
    },
    {
        "content": "<p>But I agree with Yael, and think that if we did that we should surely do the same for the other casts too.</p>",
        "id": 545628838,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1760720969
    },
    {
        "content": "<p>For what it's worth I think I added quite a lot of these lemmas for deriv already, such as <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=deriv_ofNat#doc\">docs#deriv_ofNat</a></p>",
        "id": 545629250,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1760721044
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> I am unsure if I understand your suggestion. I removed the lemma <code>ofNat</code> in the file above and marked the lemma <code>Pi.ofNat_def</code> as <code>@[simp]</code>, but that did not help to prove the theorems <code>testâ‚</code> and <code>testâ‚‚</code> using <code>simp</code> or <code>fun_prop</code>. Am I making a mistake somehow?</p>",
        "id": 546434145,
        "sender_full_name": "Stefan Kebekus",
        "timestamp": 1761132987
    },
    {
        "content": "<p>My personal preference is to keep the <code>ofNat</code> lemma you have</p>",
        "id": 546434812,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1761133167
    },
    {
        "content": "<p>I think that this deserves an official decision from maintainers. Let me start a discussion in the maintainers' channel.</p>",
        "id": 546473270,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1761143358
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"214703\">@Yury G. Kudryashov</span> Thanks for taking your time to look at this,</p>",
        "id": 546488797,
        "sender_full_name": "Stefan Kebekus",
        "timestamp": 1761146928
    }
]