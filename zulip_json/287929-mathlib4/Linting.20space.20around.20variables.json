[
    {
        "content": "<p>In the context of one of the items discussed in <a class=\"stream-topic\" data-stream-id=\"113488\" href=\"/#narrow/channel/113488-general/topic/Mathlib.20community.20meetings/with/419745898\">#general &gt; Mathlib community meetings</a>, <a href=\"https://github.com/leanprover-community/mathlib4/pull/22760\">#22760</a> is an attempt to lint \"spacing\" issues, such as <code>example (a: Nat)</code>.</p>",
        "id": 504535993,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741603078
    },
    {
        "content": "<p>The linter checks that</p>\n<ul>\n<li>each command starts at the beginning of a line;</li>\n<li>the \"hypotheses segment\" of each declaration coincides with its pretty-printed version.</li>\n</ul>",
        "id": 504536051,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741603084
    },
    {
        "content": "<p>I was somewhat surprised that mathlib is already compliant and the only issues raised by the linter were in a single test file!</p>",
        "id": 504536066,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741603089
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/22766\">#22766</a> \"fixes\" the test file.</p>",
        "id": 504536073,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741603091
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Linting.20space.20around.20variables/near/504536066\">said</a>:</p>\n<blockquote>\n<p>I was somewhat surprised that mathlib is already compliant and the only issues raised by the linter were in a single test file!</p>\n</blockquote>\n<p>For those following at home: the truth is sadly more complicated; there are actually a number of violations. (But I would love for them to get fixed.)</p>",
        "id": 504582626,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1741613535
    },
    {
        "content": "<p>Yes, the reason that I thought that mathlib was complying was that I had forgotten to import the linter...  <span aria-label=\"man facepalming\" class=\"emoji emoji-1f926-200d-2642\" role=\"img\" title=\"man facepalming\">:man_facepalming:</span></p>",
        "id": 504582836,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741613576
    },
    {
        "content": "<p>It looks like a lot of issues come from the fact that the pretty-printer erases comments, so I am hoping that there will be many fewer false positives once I get the linter to erase comments from the source code as well.</p>",
        "id": 504583063,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741613628
    },
    {
        "content": "<p>What should the linter do with</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">instPartialOrder</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PartialOrder</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstance</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">instLattice</span><span class=\"w\">      </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Lattice</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\">      </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstance</span>\n</code></pre></div>\n<p>It is hard to make the linter aware of the joint formatting.</p>",
        "id": 504669886,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741634519
    },
    {
        "content": "<p>Should these be wrapped inside a <code>set_option linter.commandStart false</code> region?</p>",
        "id": 504669912,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741634523
    },
    {
        "content": "<p>Should formatting comply with the linter anyway?</p>",
        "id": 504669939,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741634525
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Linting.20space.20around.20variables/near/504669939\">said</a>:</p>\n<blockquote>\n<p>Should formatting comply with the linter anyway?</p>\n</blockquote>\n<p>Personal opinion: consistent formatting and not having to argue about style are huge benefits, so I think we should move towards this goal if we can.</p>\n<p>In case there are bikeshedding questions, we decide to make compliance optional (until the bikeshed is somewhat resolved).<br>\nIf we discover the pretty-printer is really bad in some cases, consciously deactivating the linter seems fine for me.</p>",
        "id": 504685400,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1741640052
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Linting.20space.20around.20variables/near/504669886\">said</a>:</p>\n<blockquote>\n<p>What should the linter do with</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">instPartialOrder</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PartialOrder</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstance</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">instLattice</span><span class=\"w\">      </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Lattice</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\">      </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstance</span>\n</code></pre></div>\n<p>It is hard to make the linter aware of the joint formatting.</p>\n</blockquote>\n<p>(In a text-based linter, I was thinking of checking these things: if there is a colon which lines up, treat it as conscious alignment, otherwise format normally.)</p>\n<p>I believe that \"do not align manually\" (because this tends to go stale) is the best trade-off in the long term, especially for a diverse project as ours.</p>",
        "id": 504685555,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1741640124
    },
    {
        "content": "<p>I frequently see column alignment going stale within the evolution of PR, and so the nonstale version never even makes it into mathlib</p>",
        "id": 504689247,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741641473
    },
    {
        "content": "<p>I would also prefer not allowing the alignment. Especially when you add a new line where the column would be further to the right, you either get an inconsistency or you needlessly mess up the blame for the other lines</p>",
        "id": 504697624,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1741644858
    },
    {
        "content": "<p>I am happy to \"lint all the way\"!  I personally have used \"whitespace formatting\" in my code, but I agree that it is simpler to have a \"local\" rule for formatting.</p>",
        "id": 504776192,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741683237
    },
    {
        "content": "<p>Btw, I'm also testing out a \"relative linter\", namely one that only lints the code that has been modified, using the <code>git diff</code> as a basis for what counts as \"modified\".</p>",
        "id": 504776459,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741683305
    },
    {
        "content": "<p>If that works, it could be useful to avoid the need of nolints for certain linters, since it would flag an exception during the review process (in a workflow step outside the main CI) and then be silent, if the non-lint-compliant code is accepted nevertheless.</p>",
        "id": 504776761,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741683380
    },
    {
        "content": "<p>This can be useful for this specific linter, where there isn't a full set of rules for what is applied.</p>",
        "id": 504776922,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741683431
    },
    {
        "content": "<p>So the linter could make suggestions, some of which are \"mandatory\" others are just optional/up to each contributor's style.</p>",
        "id": 504777046,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741683467
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/22838\">#22838</a> is another batch of \"fixes\", including some \"de-formatting\" of whitespace alignment.</p>",
        "id": 504887088,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741709037
    },
    {
        "content": "<p>I just maintainer merged. (That doesn't get an emoji, right? - I don't think this is necessarily wrong, but take this as a testament that the emojibot is great :-).)</p>",
        "id": 504912579,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1741715239
    },
    {
        "content": "<p>That's an interesting idea about emoji reactions for <code>maintainer merge</code>s: it would be very easy to add it to the current workflows and makes sense to me.</p>\n<p>Feel free to open a PR and/or a discussion about it!</p>",
        "id": 504934159,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741721235
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/24467\">#24467</a> fixes some more whitespace issues in mathlib</p>",
        "id": 515268439,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1746009987
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/24472\">#24472</a> fixes some more</p>",
        "id": 515294349,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1746016985
    }
]