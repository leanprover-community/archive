[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> Is there any way to get named subgoals from <code>obtain</code> or <code>rcases</code>? I assume not because I can't see any place this would be supported in the rcases pattern syntax.</p>",
        "id": 502098895,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1740589468
    },
    {
        "content": "<p>no</p>",
        "id": 502098946,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1740589482
    },
    {
        "content": "<p>the subgoals are named using the constructors</p>",
        "id": 502099005,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1740589501
    },
    {
        "content": "<p>it would be nice to filter out the single constructor case though so that you don't get those <code>inl.intro.intro.intro.intro.intro.inr</code> goal names</p>",
        "id": 502099290,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1740589583
    },
    {
        "content": "<p>I'm not sure there is a sensible way to put goal names in the syntax, you can get exponentially more subgoals than you have pattern syntax</p>",
        "id": 502099626,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1740589677
    },
    {
        "content": "<p>In fact, I wanted it for the case where there is more than one constructor. Right now, we can only use <code>Â·</code> to focus the resulting subgoals (or use the ugly auto-generated names).</p>",
        "id": 502099784,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1740589714
    },
    {
        "content": "<p>I'm not sure how you would do better than the auto-generated names though</p>",
        "id": 502099865,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1740589738
    },
    {
        "content": "<p>none of the other cases tactics allow you to name the subgoals either</p>",
        "id": 502099919,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1740589757
    },
    {
        "content": "<p>they let you refer to a subgoal by the name that has been decided for it</p>",
        "id": 502099990,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1740589778
    },
    {
        "content": "<p>but you can do that just as well using <code>case</code> after <code>rcases</code></p>",
        "id": 502100044,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1740589792
    },
    {
        "content": "<p>Fair enough.</p>",
        "id": 502100183,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1740589828
    },
    {
        "content": "<p>why are the auto-generated names ugly in your case?</p>",
        "id": 502100269,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1740589855
    },
    {
        "content": "<p>Just because of the nesting.</p>",
        "id": 502100368,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1740589887
    },
    {
        "content": "<p>but I mean isn't that exactly what you want here?</p>",
        "id": 502100424,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1740589906
    },
    {
        "content": "<p>maybe you should show more of your actual example</p>",
        "id": 502100474,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1740589917
    },
    {
        "content": "<p>This is artificial, as I don't have an actual example at hand (this occurred to me weeks ago).</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hp</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">hq</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">hr</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">hs</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"w\"> </span><span class=\"c1\">-- hp</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"w\"> </span><span class=\"c1\">-- hs</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">inr</span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"w\"> </span><span class=\"c1\">-- hq</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">inr</span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"w\"> </span><span class=\"c1\">-- hr</span>\n</code></pre></div>\n<p>I certainly didn't correctly predict which <code>case</code> corresponded to which hypothesis.</p>",
        "id": 502101872,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1740590328
    },
    {
        "content": "<p>My idea for a syntax would be something like: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@?</span><span class=\"n\">p</span><span class=\"o\">(</span><span class=\"n\">hp</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">@?</span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">hq</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">@?</span><span class=\"n\">r</span><span class=\"o\">(</span><span class=\"n\">hr</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">@?</span><span class=\"n\">s</span><span class=\"o\">(</span><span class=\"n\">hs</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"w\"> </span><span class=\"c1\">-- hp</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"w\"> </span><span class=\"c1\">-- hq</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"w\"> </span><span class=\"c1\">-- hr</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"w\"> </span><span class=\"c1\">-- hs</span>\n</code></pre></div>",
        "id": 502102200,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1740590438
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"197836\">Jireh Loreaux</span> <a href=\"#narrow/channel/287929-mathlib4/topic/named.20subgoals.20with.20.60obtain.60/near/502101872\">said</a>:</p>\n<blockquote>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hp</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">hq</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">hr</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">hs</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"w\"> </span><span class=\"c1\">-- hp</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"w\"> </span><span class=\"c1\">-- hs</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">inr</span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"w\"> </span><span class=\"c1\">-- hq</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">inr</span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"w\"> </span><span class=\"c1\">-- hr</span>\n</code></pre></div>\n<p>I certainly didn't correctly predict which <code>case</code> corresponded to which hypothesis.</p>\n</blockquote>\n<p>You can make it work</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"n\">hp</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">hq</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">hr</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">hs</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"w\"> </span><span class=\"c1\">-- hp</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">inr</span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"w\"> </span><span class=\"c1\">-- hq</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">inr</span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"w\"> </span><span class=\"c1\">-- hr</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">inr</span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"w\"> </span><span class=\"c1\">-- hs</span>\n</code></pre></div>",
        "id": 502102537,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1740590532
    },
    {
        "content": "<p>the correct case naming for the first example is</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hp</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">hq</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">hr</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">hs</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"w\"> </span><span class=\"c1\">-- hp</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">inr</span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"w\"> </span><span class=\"c1\">-- hq</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">inr</span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"w\"> </span><span class=\"c1\">-- hr</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">inr</span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"w\"> </span><span class=\"c1\">-- hs</span>\n</code></pre></div>\n<p>this is confounded by the fact that <code>case</code> lets you refer to a substring (postfix?) of the case instead of writing the whole thing</p>",
        "id": 502102650,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1740590578
    },
    {
        "content": "<p>sure, good point, I didn't pick the case names correctly. Doing that makes more sense, but it still gives ugly names</p>",
        "id": 502102652,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1740590579
    },
    {
        "content": "<p>nevertheless, it would be nice to be able to give these names.</p>",
        "id": 502102763,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1740590616
    },
    {
        "content": "<p>these are the same names you would get if you used <code>match</code> to pattern match it</p>",
        "id": 502102771,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1740590619
    },
    {
        "content": "<p>I understand. It makes sense, I'm just wishing for more freedom.</p>",
        "id": 502102898,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1740590649
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/287929-mathlib4/topic/named.20subgoals.20with.20.60obtain.60/near/502102650\">said</a>:</p>\n<blockquote>\n<p>this is confounded by the fact that <code>case</code> lets you refer to a substring (postfix?) of the case instead of writing the whole thing</p>\n</blockquote>\n<p>This is very weird. Certainly I wouldn't have confused myself above if this had just failed when I typed <code>case inr =&gt;</code></p>",
        "id": 502103042,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1740590697
    },
    {
        "content": "<p>it is very helpful when you have a bunch of random stuff at the beginning of the case name from the current goal prior to the case split</p>",
        "id": 502103220,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1740590744
    },
    {
        "content": "<p>(also solved if you can name your own cases <span aria-label=\"wink\" class=\"emoji emoji-1f609\" role=\"img\" title=\"wink\">:wink:</span>, but I understand this is simply not supported anywhere, so it's a nontrivial request.)</p>",
        "id": 502103498,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1740590825
    },
    {
        "content": "<p>You can justifiably ignore me now.</p>",
        "id": 502103576,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1740590852
    },
    {
        "content": "<p>There isn't really precedent for what the syntax could be, but for a bikeshed example let's say that <code>pat @ ?h</code>can be used as an rcases pattern, and the semantics are that it will replace the case name for that pattern unless you use it again in a nested pattern or do additional pattern matching after it (inside <code>pat</code> or in dependent patterns that come later)</p>",
        "id": 502103840,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1740590928
    },
    {
        "content": "<p>then you would be able to do</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hp</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">hp</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">hq</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">hq</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">hr</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">hr</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">hs</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">hs</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">hp</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"w\"> </span><span class=\"c1\">-- hp</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">hq</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"w\"> </span><span class=\"c1\">-- hq</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">hr</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"w\"> </span><span class=\"c1\">-- hr</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">hs</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"w\"> </span><span class=\"c1\">-- hs</span>\n</code></pre></div>",
        "id": 502103995,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1740590971
    },
    {
        "content": "<p>That would be nice.</p>",
        "id": 502104818,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1740591206
    },
    {
        "content": "<p>Perhaps a more relevant example is something like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Logic</span><span class=\"bp\">.</span><span class=\"n\">IsEmpty</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">isEmpty_or_nonempty</span><span class=\"w\"> </span><span class=\"n\">X</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span>\n<span class=\"w\">  </span><span class=\"c1\">-- proceed with the rest of the proof without a focused goal</span>\n<span class=\"w\">  </span><span class=\"c1\">-- maybe this part is long</span>\n<span class=\"w\">  </span><span class=\"n\">trivial</span>\n</code></pre></div>\n<p>It would be much nicer if the case were named <code>isEmpty</code> instead of <code>inl</code>.</p>",
        "id": 502104907,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1740591240
    },
    {
        "content": "<p>I'm sure that something like this is what made me want this feature in the first place.</p>",
        "id": 502105094,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1740591286
    },
    {
        "content": "<p>Another good example would be when using <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ENNReal.trichotomy#doc\">docs#ENNReal.trichotomy</a></p>",
        "id": 502106699,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1740591762
    },
    {
        "content": "<p>In things like <code>match</code> branches, you name the hypotheses when you select the branch. So, I'm thinking something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">rcases</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">?</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">hp</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">hq</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">hr</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">hs</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span>\n</code></pre></div>\n<p>But:</p>\n<ol>\n<li>The current syntax is <code>rcases h with pat</code> instead of <code>using pat with</code></li>\n<li>I'm not sure how this would fit into <code>obtain</code>...</li>\n</ol>",
        "id": 502108026,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1740592159
    },
    {
        "content": "<ol start=\"3\">\n<li>I'm not sure how to make this recursive.</li>\n</ol>",
        "id": 502108160,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1740592199
    },
    {
        "content": "<p><code>rcases</code> and <code>obtain</code> are almost exactly the same, the argument order is just the other way around</p>",
        "id": 502108236,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1740592208
    },
    {
        "content": "<p>I don't think this makes a whole lot of sense, the <code>?p</code> things are patterns here, they name values not goals</p>",
        "id": 502108506,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1740592304
    },
    {
        "content": "<p>what does <code>rcases e with &lt;?p, ?q&gt;</code> mean?</p>",
        "id": 502108669,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1740592350
    },
    {
        "content": "<p>I was thinking you could have <code>?h</code> as a shorthand for <code>h @ ?h</code> but it would be both a variable name and a goal name in that case</p>",
        "id": 502108786,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1740592390
    },
    {
        "content": "<p>I'm aware that my proposed syntax deviates from the established one. It's also not fleshed out at all.<br>\nI mostly wanted to see if we could somehow reuse something from <code>match</code> branches. Probably not</p>",
        "id": 502109322,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1740592560
    },
    {
        "content": "<p>I think the <code>var_name @ ?goal_name</code> syntax makes sense, because then you are re-naming the constructor. You could even apply it only on certain constructors, as is:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">isEmpty</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">isEmpty_or_nonempty</span><span class=\"w\"> </span><span class=\"n\">X</span>\n</code></pre></div>",
        "id": 502110202,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1740592816
    },
    {
        "content": "<p>I don't think the syntactic sugar <code>?h</code> for <code>h @ ?h</code> is necessary, and I think it could lead some users to create weird variable / goal names. But <span aria-label=\"shrug\" class=\"emoji emoji-1f937\" role=\"img\" title=\"shrug\">:shrug:</span></p>",
        "id": 502110741,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1740592965
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/channel/287929-mathlib4/topic/named.20subgoals.20with.20.60obtain.60/near/502109322\">said</a>:</p>\n<blockquote>\n<p>I mostly wanted to see if we could somehow reuse something from <code>match</code> branches.</p>\n</blockquote>\n<p>to be honest, I think we should intentionally keep the syntax separate since <code>match</code>ing and rcases patterns just work differently. If we start merging the syntax, I think it's likely to lead to confusion.</p>",
        "id": 502135026,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1740600579
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/287929-mathlib4/topic/named.20subgoals.20with.20.60obtain.60/near/502103220\">said</a>:</p>\n<blockquote>\n<p>it is very helpful when you have a bunch of random stuff at the beginning of the case name from the current goal prior to the case split</p>\n</blockquote>\n<p>Could we have <code>case *.inl</code> for this instead?</p>",
        "id": 502135669,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1740600796
    },
    {
        "content": "<p>The full tag matching procedure I've found to be surprising:</p>\n<ul>\n<li>It looks for the first goal with an exact match.</li>\n<li>If that fails, it looks for the first goal with a matching suffix.</li>\n<li>If that fails, it looks for the first goal with a matching prefix.</li>\n</ul>\n<p>It hasn't been clear to me if people use the last one.</p>",
        "id": 502147479,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1740605270
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/287929-mathlib4/topic/named.20subgoals.20with.20.60obtain.60/near/502099290\">said</a>:</p>\n<blockquote>\n<p>it would be nice to filter out the single constructor case though so that you don't get those <code>inl.intro.intro.intro.intro.intro.inr</code> goal names</p>\n</blockquote>\n<p>Apologies for necroposting, just wanted to mention <a href=\"https://github.com/leanprover/lean4/pull/6550\">lean4#6550</a> for this exact thing</p>",
        "id": 509779133,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1743622595
    },
    {
        "content": "<p>An idle thought I had about the display of case names: I wonder if it would be reasonable to show just the end of a case name if that's unique, and have a hover or other UI affordance to show the whole thing? At least in your example, doing <code>case inl =&gt; ...</code> works because of the way cases look for a matching suffix.</p>\n<p>(This is independent of having <code>obtain</code> create shorter case names.)</p>",
        "id": 509997809,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1743701018
    },
    {
        "content": "<p>There are a few motivations for this thought:</p>\n<ul>\n<li><a class=\"message-link\" href=\"/#narrow/channel/113488-general/topic/lean4.2Einfoview.2EshowGoalNames.20is.20false.20in.20the.20web.20editor/near/509768221\">#general &gt; lean4.infoview.showGoalNames is false in the web editor @ ðŸ’¬</a>  is about how case names are disabled in <a href=\"https://live.lean-lang.org/\">https://live.lean-lang.org/</a>, but they're necessary information if you're wanting to use <code>case</code> with a case name. Abbreviated case names might be a good compromise, and one we might want as the default everywhere.</li>\n<li><a class=\"message-link\" href=\"/#narrow/channel/270676-lean4/topic/user-facing.20metavariable.20names.20shared.20between.20goals/near/402486577\">#lean4 &gt; user-facing metavariable names shared between goals @ ðŸ’¬</a> is about how metavariable user names aren't really namespaced. I think we should have some kind of namespacing system that prevents metavariables from accidentally being used across proof branches. That would go toward making case names <em>longer</em> though, opposite of the direction of <a href=\"https://github.com/leanprover/lean4/pull/6550\">lean4#6550</a>.</li>\n<li><a class=\"message-link\" href=\"/#narrow/channel/270676-lean4/topic/.3Fn.20metavariable.20unexpectedly.20filled/near/509837274\">#lean4 &gt; ?n metavariable unexpectedly filled @ ðŸ’¬</a> is related to the previous point. The application elaborator uses the names of the arguments of the function being elaborated to create new metavariables(!). I don't think these names should be user-accessible, or at least they should be deeper in some hierarchy of namespaces so that you can't access them unless you really mean to.</li>\n</ul>",
        "id": 509999824,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1743701612
    },
    {
        "content": "<p>On your point 2, it could make case names longer, but I don't think that's in opposition to my issue. Specifically, if there is a branch in the proof, then there are genuinely two cases, and so the longer case name would be reasonable. My issue is specifically about inserting bits in the case name when there's no new branch made!</p>",
        "id": 510058147,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1743725355
    },
    {
        "content": "<p>The reason I'm saying that 2 is in opposition is that a natural solution is to extend the prefix whenever there is any sort of tactic scope being entered whatsoever, even when there isn't more than one branch.</p>\n<p>Imagine if even <code>refine</code> created a fresh metavariable naming scope</p>",
        "id": 510058654,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1743725681
    },
    {
        "content": "<p>Ah, I was imagining only extending the prefix if there is a branch...</p>",
        "id": 510059896,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1743726399
    },
    {
        "content": "<p>The thought here is that the common case for <code>refine</code> is that you want fresh metavariables, so a way it could work is that it enters a new naming scope, and when <code>?a</code> elaborates it gets this scope as a prefix. This could solve the accidental reuse problem that has shown up in <code>convert_to</code> and <code>congrm</code> as well.</p>\n<p>This doesn't solve the problem where it's not possible to distinguish between wanting to reference a preexisting metavariable and creating a new one though. You possibly might want to refer to such a metavariable in a <code>refine</code>.</p>",
        "id": 510061748,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1743727518
    }
]