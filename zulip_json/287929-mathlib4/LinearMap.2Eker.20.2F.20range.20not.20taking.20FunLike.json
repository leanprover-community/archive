[
    {
        "content": "<p>In response <a href=\"https://github.com/leanprover-community/mathlib4/pull/33107\">#33107</a>, <span class=\"user-mention\" data-user-id=\"477483\">@Monica Omar</span> suggested that LinearMap.ker and LinearMap.range should be changed to take a LinearMap itself instead of a SemilinearMapClass -- and that we should start a thread on Zulip.</p>\n<p>I seem to recall a larger conversation about avoiding the use of functions taking these bundled FunLike and FooHomClass things, but I can't find it now...?</p>",
        "id": 564844717,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1766253873
    },
    {
        "content": "<p>here’s another related recent thread I just found: <a href=\"#narrow/channel/287929-mathlib4/topic/LinearMap.2Erange.20for.20ContinuousLinearMap/with/564194232\">https://leanprover.zulipchat.com/#narrow/channel/287929-mathlib4/topic/LinearMap.2Erange.20for.20ContinuousLinearMap/with/564194232</a></p>",
        "id": 564845021,
        "sender_full_name": "Monica Omar",
        "timestamp": 1766254198
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span></p>",
        "id": 564845951,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1766255124
    },
    {
        "content": "<p><a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/Mathlib.27s.20morphism.20hierarchy/with/558812628\">#mathlib4 &gt; Mathlib's morphism hierarchy</a></p>",
        "id": 564846193,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766255427
    },
    {
        "content": "<p>Please do so!</p>",
        "id": 564847026,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1766256481
    },
    {
        "content": "<p>I wonder if Lean will <code>simp</code>lify inside <code>(LinearMap.ker (ContinuousLinearMap.toLinearMap f) : Type _)</code> to <code>{x | f x = 0}</code>.</p>",
        "id": 564848011,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1766257596
    },
    {
        "content": "<p>See also <a href=\"#narrow/channel/287929-mathlib4/topic/Coercion.20of.20SetLike.20to.20Type*\">#mathlib4 &gt; Coercion of SetLike to Type&#42;</a></p>",
        "id": 564848071,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1766257646
    },
    {
        "content": "<p>I've tried to give it a go. So far, the main inconvenience is that Lean can't automatically coerce <code>f : M →L[R] N</code> to an unknown semilinear map, so <code>p.map f</code> requires an explicit type annotation.</p>",
        "id": 565194778,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1766512797
    },
    {
        "content": "<p>Can we change <code>Coe*</code> instances somehow to make it \"just work\"?</p>",
        "id": 565194830,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1766512820
    },
    {
        "content": "<p>This is the \"functorial coercion\" business we have been talking about for a while, no?</p>",
        "id": 565195507,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1766513147
    },
    {
        "content": "<p>I think I've missed the discussions because of my day job.</p>",
        "id": 565196946,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1766513901
    },
    {
        "content": "<p>Is there any consensus about what should we do?</p>",
        "id": 565197523,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1766514193
    },
    {
        "content": "<p>Once <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/Mathlib.27s.20morphism.20hierarchy/with/558812628\">#mathlib4 &gt; Mathlib's morphism hierarchy</a> is done, you will be able to write <code>f.toLinearMap</code> without fearing for simp normal form. For coercions however, no concrete plan was ever given.</p>",
        "id": 565197693,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1766514281
    },
    {
        "content": "<p>I'm confused, is this about <code>LinearMap.ker/range</code>? or something else?</p>",
        "id": 565197808,
        "sender_full_name": "Monica Omar",
        "timestamp": 1766514352
    },
    {
        "content": "<p>More specifically, it's about <code>Submodule.map</code>. I don't want to write <code>p.map f.toLinearMap</code>. I want to write <code>p.map f</code> and let Lean find <code>*.toLinearMap</code> as a coercion.</p>",
        "id": 565198174,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1766514553
    },
    {
        "content": "<p>I've redefined <code>LinearMap.ker</code>, <code>LinearMap.range</code>, <code>Submodule.map</code>, and <code>Submodule.comap</code> to take <code>LinearMap</code>s, and I'm gettings lots of these errors.</p>",
        "id": 565198444,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1766514706
    },
    {
        "content": "<p>Let's start with <code>ker</code> and <code>range</code> for now. We can deal with <code>Submodule.co(map)</code> separately?</p>",
        "id": 565198538,
        "sender_full_name": "Monica Omar",
        "timestamp": 1766514761
    },
    {
        "content": "<p>Specifically for the range and kernel, I don't think we mind doing <code>.toLinearMap.ker/range</code> do we?</p>",
        "id": 565198613,
        "sender_full_name": "Monica Omar",
        "timestamp": 1766514816
    },
    {
        "content": "<p>it's basically the same amount of effort as <code>LinearMap.range f</code></p>",
        "id": 565198677,
        "sender_full_name": "Monica Omar",
        "timestamp": 1766514852
    },
    {
        "content": "<p>For <code>ker</code> and <code>range</code>, we can write <code>f.ker</code>.</p>",
        "id": 565198710,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1766514865
    },
    {
        "content": "<p>If we don't do <code>Submodule.map</code>/<code>comap</code> in the same PR, then we need to do <code>map_top</code> and <code>comap_bot</code> for different types.</p>",
        "id": 565198811,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1766514925
    },
    {
        "content": "<p>Ah, I see. Okay, obviously in the same PR then.</p>",
        "id": 565198992,
        "sender_full_name": "Monica Omar",
        "timestamp": 1766515030
    },
    {
        "content": "<p><del>for continuous linear maps, do you also need to do <code>p.map f.toLinearMap</code> or does <code>p.map f</code> work?</del> nvm, I just reread the first message</p>",
        "id": 565199202,
        "sender_full_name": "Monica Omar",
        "timestamp": 1766515153
    },
    {
        "content": "<p>I need <code>f.toLinearMap</code> or <code>(f : explicit_type)</code>.</p>",
        "id": 565200992,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1766516267
    },
    {
        "content": "<p><code>f.ker</code> works because Lean allows us to call methods of a parent structure from an instance of a child structure via dot notation.</p>",
        "id": 565201313,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1766516436
    },
    {
        "content": "<blockquote>\n<p>If we don't do <code>Submodule.map</code>/<code>comap</code> in the same PR, then we need to do <code>map_top</code> and <code>comap_bot</code> for different types.</p>\n</blockquote>\n<p>Can you not just use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearMapClass.linearMap%3F#doc\">docs#LinearMapClass.linearMap?</a></p>",
        "id": 565201484,
        "sender_full_name": "Monica Omar",
        "timestamp": 1766516517
    },
    {
        "content": "<p>Can you draft-PR what you got so far so we can all have a look?</p>",
        "id": 565202231,
        "sender_full_name": "Monica Omar",
        "timestamp": 1766517006
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"477483\">Monica Omar</span> <a href=\"#narrow/channel/287929-mathlib4/topic/LinearMap.2Eker.20.2F.20range.20not.20taking.20FunLike/near/565201484\">said</a>:</p>\n<blockquote>\n<p>Can you not just use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearMapClass.linearMap%3F#doc\">docs#LinearMapClass.linearMap?</a></p>\n</blockquote>\n<p>This is precisely the thing that we were converging on declaring a bad design, I think</p>",
        "id": 565202310,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1766517063
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/33241\">#33241</a></p>",
        "id": 565204469,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1766518571
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/channel/287929-mathlib4/topic/LinearMap.2Eker.20.2F.20range.20not.20taking.20FunLike/near/565200992\">said</a>:</p>\n<blockquote>\n<p>I need <code>f.toLinearMap</code> or <code>(f : explicit_type)</code>.</p>\n</blockquote>\n<p>I wonder if we can use unification hints or extra coercion instances to make this better-behaved</p>",
        "id": 565205253,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1766519059
    },
    {
        "content": "<blockquote>\n<p>This is precisely the thing that we were converging on declaring a bad design, I think</p>\n</blockquote>\n<p>The coercion from <code>LinearMapClass</code> to <code>LinearMap</code> is also bad design, right?</p>",
        "id": 565206557,
        "sender_full_name": "Monica Omar",
        "timestamp": 1766519880
    },
    {
        "content": "<p>I guess that Eric missed \"not\" in your message. At least, I did first time I've read it.</p>",
        "id": 565206631,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1766519925
    },
    {
        "content": "<p>Note that we can no longer have generic <code>span_image</code> etc lemmas.</p>",
        "id": 565206672,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1766519955
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/LinearMap.2Eker.20.2F.20range.20not.20taking.20FunLike/near/565205253\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/channel/287929-mathlib4/topic/LinearMap.2Eker.20.2F.20range.20not.20taking.20FunLike/near/565200992\">said</a>:</p>\n<blockquote>\n<p>I need <code>f.toLinearMap</code> or <code>(f : explicit_type)</code>.</p>\n</blockquote>\n<p>I wonder if we can use unification hints or extra coercion instances to make this better-behaved</p>\n</blockquote>\n<p>I'm bad at this kind of metaprogramming (at least, for now).</p>",
        "id": 565207622,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1766520568
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/LinearMap.2Eker.20.2F.20range.20not.20taking.20FunLike/near/565202310\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"477483\">Monica Omar</span> <a href=\"#narrow/channel/287929-mathlib4/topic/LinearMap.2Eker.20.2F.20range.20not.20taking.20FunLike/near/565201484\">said</a>:</p>\n<blockquote>\n<p>Can you not just use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearMapClass.linearMap%3F#doc\">docs#LinearMapClass.linearMap?</a></p>\n</blockquote>\n<p>This is precisely the thing that we were converging on declaring a bad design, I think</p>\n</blockquote>\n<p>I thought this was fine, taking the morphism class into the concrete morphism</p>",
        "id": 565209882,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766522271
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/stream/287929-mathlib4/topic/LinearMap.2Eker.20.2F.20range.20not.20taking.20FunLike/near/565206631\">said</a>:</p>\n<blockquote>\n<p>I guess that Eric missed \"not\" in your message. At least, I did first time I've read it.</p>\n</blockquote>\n<p>\"Can you not just use X?\" to me means \"let's use X it should be fine?\". <del>I guess what was meant was \"Can you just not use X at all\".</del></p>",
        "id": 565213278,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1766524516
    },
    {
        "content": "<p>It's fine to have that helper definition to use in proofs, but it isn't the preferred form and so doesn't belong in theorem statements.</p>",
        "id": 565213365,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1766524582
    },
    {
        "content": "<p>So, not only I misread this, but also failed to understand when I saw all the words <span aria-label=\"man facepalming\" class=\"emoji emoji-1f926-200d-2642\" role=\"img\" title=\"man facepalming\">:man_facepalming:</span></p>",
        "id": 565219484,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1766529000
    },
    {
        "content": "<p>cc <span class=\"user-mention\" data-user-id=\"648495\">@Christian Merten</span> who has a PR on this as well.</p>",
        "id": 565219634,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1766529150
    },
    {
        "content": "<p>That PR is about <code>RingHom</code> not <code>LinearMap</code> right?</p>",
        "id": 565219829,
        "sender_full_name": "Monica Omar",
        "timestamp": 1766529339
    },
    {
        "content": "<p>Yeah it is: <a href=\"https://github.com/leanprover-community/mathlib4/pull/25138\">#25138</a></p>",
        "id": 565219918,
        "sender_full_name": "Monica Omar",
        "timestamp": 1766529415
    },
    {
        "content": "<p>I've fixed compile issues.</p>",
        "id": 565236921,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1766546268
    }
]