[
    {
        "content": "<p><a href=\"https://github.com/YaelDillies/apap/blob/20c7303030fbbac147aad9b84fb2093c505e12cc/APAP/Prereqs/MarcinkiewiczZygmund.lean\">Adapting APAP to the module system</a>, I encountered a weird issue regarding the heterogeneous multiplication of matrices:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">module</span>\n\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">Mul</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">error: Unknown constant `Matrix.instHMulOfFintypeOfMulOfAddCommMonoid`</span>\n\n<span class=\"sd\">Note: A public declaration `Matrix.instHMulOfFintypeOfMulOfAddCommMonoid` exists but is imported privately; consider adding `public import Mathlib.Data.Matrix.Mul`.</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"n\">public</span><span class=\"w\"> </span><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 572965402,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1770709878
    },
    {
        "content": "<p>This is probably a bug in the elaborator, since replacing <code>2</code> by <code>m</code> makes it work. I haven't yet had the time to make my minimisation mathlib-free, but hopefully it's quite minimal already.</p>",
        "id": 572965641,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1770709962
    },
    {
        "content": "<p>I used <code>set_option trace.Meta.synthInstance true</code> to inspect the trace and encountered another bug: The type class pretty prints as</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">pretty</span><span class=\"w\"> </span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">expression</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">pp</span><span class=\"bp\">.</span><span class=\"n\">rawOnError</span><span class=\"w\"> </span><span class=\"n\">true'</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">raw</span><span class=\"w\"> </span><span class=\"n\">representation</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Which, when using the suggested set_option, is</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">[</span><span class=\"n\">Error</span><span class=\"w\"> </span><span class=\"n\">pretty</span><span class=\"w\"> </span><span class=\"n\">printing</span><span class=\"w\"> </span><span class=\"n\">expression</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Unknown</span><span class=\"w\"> </span><span class=\"n\">constant</span><span class=\"w\"> </span><span class=\"ss\">`termℕ</span><span class=\"bp\">`</span>\n\n<span class=\"w\">    </span><span class=\"n\">Note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">public</span><span class=\"w\"> </span><span class=\"n\">declaration</span><span class=\"w\"> </span><span class=\"ss\">`termℕ</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">exists</span><span class=\"w\"> </span><span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"n\">privately</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">consider</span><span class=\"w\"> </span><span class=\"n\">adding</span><span class=\"w\"> </span><span class=\"ss\">`public</span><span class=\"w\"> </span><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Notation</span><span class=\"bp\">`..</span><span class=\"w\"> </span><span class=\"n\">Falling</span><span class=\"w\"> </span><span class=\"n\">back</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">raw</span><span class=\"w\"> </span><span class=\"n\">printer</span><span class=\"bp\">.</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 573037351,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1770729626
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span>, perhaps this is of inteest to you, though it's not immediately clear how to minimize</p>",
        "id": 573135361,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1770752882
    }
]