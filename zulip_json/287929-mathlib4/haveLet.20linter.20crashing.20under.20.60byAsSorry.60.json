[
    {
        "content": "<p>Now that we've got the new <code>variable</code> command in, I'm trying to get Mathlib running under <code>byAsSorry</code>. Initial signs are good!</p>\n<p>However, the <code>haveLet</code> linter is crashing with a stack overflow. I can work around this for now by putting<br>\n<code>    ⟨`weak.linter.haveLet, .ofNat 0⟩,</code><br>\nin the lakefile. <span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span>, would you be able to take a look at this?</p>\n<p>If you checkout <a href=\"https://github.com/leanprover-community/mathlib4/tree/byAsSorry\">branch#byAsSorry</a>, remove that line from the lakefile, and build, you should encounter the stack overflow not too far in!</p>",
        "id": 462000217,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723516128
    },
    {
        "content": "<p>Ok, I will take a look!</p>",
        "id": 462018733,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723524860
    },
    {
        "content": "<p>I have not gotten to the overflow yet, but I remembered that I had observed an issue during development: <a href=\"https://github.com/leanprover-community/mathlib4/pull/12190#issuecomment-2061005403\">https://github.com/leanprover-community/mathlib4/pull/12190#issuecomment-2061005403</a>.  I'll try to build these files directly to see if observe the overflow!</p>",
        "id": 462021473,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723525763
    },
    {
        "content": "<p>I believe that I found a stack overflow in <code>Mathlib.Data.UInt</code>, which I also think was one of the ones that I noticed earlier.</p>",
        "id": 462023075,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723526529
    },
    {
        "content": "<p>Kim, this seems exactly an issue that I had already tried to fix and failed while developing the linter.  However, when the <code>byAsSorry</code> option is on, maybe the linter should not run anyway.</p>",
        "id": 462160981,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723567107
    },
    {
        "content": "<p>Would it make sense to silence the linter while in <code>byAsSorry</code> mode?</p>",
        "id": 462161044,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723567124
    },
    {
        "content": "<p>After all, if you are <code>byAsSorry</code>ing everything, you probably do not care about <code>have</code>s that should be <code>let</code>s!</p>",
        "id": 462161178,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723567152
    },
    {
        "content": "<p>Yes, I've turned it off on the byAsSorry branch (and in fact I will turn off all linters), just thought you might be interested in the crash. :-)</p>",
        "id": 462249697,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723605037
    },
    {
        "content": "<p>I am interested and I had already observed it in 3 commands throughout Mathlib.</p>\n<p>Eric thought that it was a consequence of his \"hack\" and they were fixed by explicitly initializing a <code>MetaM</code> context.  However, the \"hack\" handles the context better, in all cases where it does not crash!</p>",
        "id": 462250216,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723605371
    },
    {
        "content": "<p>I've just hit the overflow in the PFR project, without <code>byAsSorry</code>. You can see it in <a href=\"https://github.com/sgouezel/pfr\">https://github.com/sgouezel/pfr</a>, commit f428dbcacae0f13d0ac49cb8ec481c7b1bbd586f, in the file PFR.Matlhlib.Probability.Independence.Kernel. It starts with</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">libc</span><span class=\"bp\">++</span><span class=\"n\">abi</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">terminating</span><span class=\"w\"> </span><span class=\"n\">due</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">uncaught</span><span class=\"w\"> </span><span class=\"n\">exception</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">lean</span><span class=\"bp\">::</span><span class=\"n\">throwable</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">deep</span><span class=\"w\"> </span><span class=\"n\">recursion</span><span class=\"w\"> </span><span class=\"n\">was</span><span class=\"w\"> </span><span class=\"n\">detected</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">interpreter'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">potential</span><span class=\"w\"> </span><span class=\"n\">solution</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">increase</span><span class=\"w\"> </span><span class=\"n\">stack</span><span class=\"w\"> </span><span class=\"n\">space</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">your</span><span class=\"w\"> </span><span class=\"n\">system</span><span class=\"o\">)</span>\n<span class=\"n\">interpreter</span><span class=\"w\"> </span><span class=\"n\">stacktrace</span><span class=\"o\">:</span>\n<span class=\"bp\">#</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Linter</span><span class=\"bp\">.</span><span class=\"n\">haveLet</span><span class=\"bp\">.</span><span class=\"n\">InfoTree</span><span class=\"bp\">.</span><span class=\"n\">foldInfoM</span><span class=\"bp\">._</span><span class=\"n\">at</span><span class=\"bp\">.</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Linter</span><span class=\"bp\">.</span><span class=\"n\">haveLet</span><span class=\"bp\">.</span><span class=\"n\">nonPropHaves</span><span class=\"bp\">._</span><span class=\"n\">spec_15</span><span class=\"bp\">._</span><span class=\"n\">lambda_1</span>\n<span class=\"bp\">#</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Linter</span><span class=\"bp\">.</span><span class=\"n\">haveLet</span><span class=\"bp\">.</span><span class=\"n\">InfoTree</span><span class=\"bp\">.</span><span class=\"n\">foldInfoM</span><span class=\"bp\">._</span><span class=\"n\">at</span><span class=\"bp\">.</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Linter</span><span class=\"bp\">.</span><span class=\"n\">haveLet</span><span class=\"bp\">.</span><span class=\"n\">nonPropHaves</span><span class=\"bp\">._</span><span class=\"n\">spec_15</span><span class=\"bp\">._</span><span class=\"n\">lambda_1</span>\n</code></pre></div>\n<p>and goes on like that for a long time. I don't see any suspicious line in the proof.</p>",
        "id": 463971173,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1724226209
    },
    {
        "content": "<p>I think that Kim disabled the <code>HaveLet</code> linter with <code>byAsSorry</code>.</p>",
        "id": 463971412,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724226266
    },
    {
        "content": "<p>Since the linter is chatty when there is a sorry, it would flag everything, so I think that the linter should have a mechanism for only enabling itself when <code>byAsSorry</code> is set, but I have not looked into that yet.</p>",
        "id": 463971541,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724226315
    },
    {
        "content": "<p>Note that there is no sorry in this proof, it is a perfectly fine proof that works fine with <code>lake build</code>.</p>",
        "id": 463971765,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1724226397
    },
    {
        "content": "<p>I have not actually looked at anything with <code>byAsSorry</code>, but could it be that some version of the lemmas with <code>by</code> replaced by <code>sorry</code> are actually elaborated?</p>",
        "id": 463971889,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724226458
    },
    {
        "content": "<p>This may mean that the linter is also checking those \"invisible, sorried lemmas\" and causing trouble,</p>",
        "id": 463971994,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724226489
    },
    {
        "content": "<p>If you can point me to a more specific place in the repo, I can try to take a look.</p>",
        "id": 463972018,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724226503
    },
    {
        "content": "<p>why does <code>nonPropHaves</code> have <code>partial</code>? It doesn't seem to be recursive</p>",
        "id": 463972065,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724226517
    },
    {
        "content": "<p>I haven't been clear: there is absolutely no sorry around, it's a complete proof.</p>",
        "id": 463972083,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1724226522
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/287929-mathlib4/topic/haveLet.20linter.20crashing.20under.20.60byAsSorry.60/near/463972065\">said</a>:</p>\n<blockquote>\n<p>why does <code>nonPropHaves</code> have <code>partial</code>? It doesn't seem to be recursive</p>\n</blockquote>\n<p>It might be an indication that it was modified from a version that was really partial to the current version that no longer is.</p>",
        "id": 463972414,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724226636
    },
    {
        "content": "<p>I have fixed the problem in my case, by renaming two unused variables <code>hi</code> and <code>hj</code> to <code>_hi</code> and <code>_hj</code> (this was signalled to me by the <code>unusedVariables</code> linter when compiling on the command line). Once this is done, the stack overflow disappears. Looks like black magic...</p>",
        "id": 463972740,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1724226739
    },
    {
        "content": "<p>Ah, the warnings for the unused variables made the linter active!</p>",
        "id": 463972803,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724226767
    },
    {
        "content": "<p>If it gives you a clue for how to fix it, that's great!</p>",
        "id": 463972941,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1724226815
    },
    {
        "content": "<p>The linter is active when the command emits a warning.  Typically, this is the presence of a <code>sorry</code>, but, in fact, any warning makes the linter chatty.</p>",
        "id": 463973040,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724226843
    },
    {
        "content": "<p>I'm looking at the implementation of the linter now, and it seems to be doing unnecessary things</p>",
        "id": 463973123,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724226871
    },
    {
        "content": "<p>Maybe I should change the HaveLet linter to only be chatty when there is a <code>sorry</code>, not when any warning is present.</p>",
        "id": 463973173,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724226887
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/287929-mathlib4/topic/haveLet.20linter.20crashing.20under.20.60byAsSorry.60/near/463973123\">said</a>:</p>\n<blockquote>\n<p>I'm looking at the implementation of the linter now, and it seems to be doing unnecessary things</p>\n</blockquote>\n<p>I'm happy to learn about ways of simplifying it!  <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 463973217,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724226904
    },
    {
        "content": "<p>the implementation strategy I would suggest is:</p>\n<ul>\n<li>Find all <code>have</code> syntaxes in the command</li>\n<li>Get the <code>e</code> in <code>have ... := e</code></li>\n<li>Look for info tree data on <code>e</code>, see if the type of <code>e</code> is a proposition and lint otherwise</li>\n</ul>",
        "id": 463973369,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724226950
    },
    {
        "content": "<p>What I don't get is why it wanted to talk to me, because there is no <code>have</code> that should be a <code>let</code> in this proof, as far as I can tell!</p>",
        "id": 463973389,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1724226958
    },
    {
        "content": "<p>I think that it was trying to figure out whether it should be telling you something and got hung up somewhere.</p>",
        "id": 463973526,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724226996
    },
    {
        "content": "<p>also the linter seems to miss that there are two <code>have</code> syntaxes, it only looks for the tactic but there is also an expr</p>",
        "id": 463973992,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724227081
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/287929-mathlib4/topic/haveLet.20linter.20crashing.20under.20.60byAsSorry.60/near/463973369\">said</a>:</p>\n<blockquote>\n<p>the implementation strategy I would suggest is:</p>\n<ul>\n<li>Find all <code>have</code> syntaxes in the command</li>\n<li>Get the <code>e</code> in <code>have ... := e</code></li>\n<li>Look for info tree data on <code>e</code>, see if the type of <code>e</code> is a proposition and lint otherwise</li>\n</ul>\n</blockquote>\n<p>This makes me think that you can find the <code>have</code>s first (easy) and then look at the infotrees arising from the <code>have</code> without going through the whole infotree: how do I do that?</p>",
        "id": 463973998,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724227082
    },
    {
        "content": "<p>You have to go through the info tree, but you can limit it to one pass if you find all the syntaxes you want to spot first and look for all of them</p>",
        "id": 463974286,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724227131
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/287929-mathlib4/topic/haveLet.20linter.20crashing.20under.20.60byAsSorry.60/near/463973992\">said</a>:</p>\n<blockquote>\n<p>also the linter seems to miss that there are two <code>have</code> syntaxes, it only looks for the tactic but there is also an expr</p>\n</blockquote>\n<p>That was deliberate, since I was not comfortable with infotrees and wanted to decrease what I had to keep track of.</p>",
        "id": 463974403,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724227152
    },
    {
        "content": "<p>and of course you can early exit if the proof never uses <code>have</code> syntax</p>",
        "id": 463974406,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724227152
    },
    {
        "content": "<p>Oh, you mean that I extract the <code>have</code> syntax, then run through the whole infotree and, whenever the node is one of the syntax bits that I extracted, then dive into it?</p>",
        "id": 463974826,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724227223
    },
    {
        "content": "<p>unfortunately you can't navigate the info tree really, because the tree structure doesn't have any useful invariants</p>",
        "id": 463975201,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724227296
    },
    {
        "content": "<p>so you just have to look at everything</p>",
        "id": 463975264,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724227303
    },
    {
        "content": "<p>but you can set up a hashmap of syntax you care about and skip nodes that aren't talking about one of them</p>",
        "id": 463975426,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724227331
    },
    {
        "content": "<p>Looking at the code, why is</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">ofTacticInfo</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">info</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[]</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"n\">stx</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">original</span><span class=\"w\"> </span><span class=\"bp\">..</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"bp\">.</span><span class=\"n\">getHeadInfo</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[]</span>\n<span class=\"w\">    </span><span class=\"n\">unless</span><span class=\"w\"> </span><span class=\"n\">isHave?</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"k\">do</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[]</span>\n</code></pre></div>\n<p>not already just looking at the <code>have</code> nodes?</p>",
        "id": 463975443,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724227338
    },
    {
        "content": "<p>it is (well, it is looking at <code>have</code> tactic nodes), but the rest of the code is doing things not in my list</p>",
        "id": 463975613,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724227376
    },
    {
        "content": "<p>With my suggestion, you only have to look at expr info nodes, not tactic info nodes</p>",
        "id": 463975821,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724227420
    },
    {
        "content": "<p>because you are looking at the <code>e</code> in <code>have ... := e</code>, not the tactic itself</p>",
        "id": 463975903,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724227439
    },
    {
        "content": "<p>Ok, I think that I understand now: I should catch the stuff after the <code>:=</code> and just inspect those nodes further -- I had missed this from your initial message, don't know why.</p>",
        "id": 463976133,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724227483
    },
    {
        "content": "<p>right, the algorithm is really \"lint if any expression occurring on the RHS of a <code>have</code> term/tactic has a non-prop type\"</p>",
        "id": 463976355,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724227535
    },
    {
        "content": "<p>Ok, I think that I had given up on that at the time, since there were many syntactic possibilities for the \"stuff after <code>:=</code>\", but I know more about syntax now and I can probably do this better then.</p>",
        "id": 463976654,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724227586
    },
    {
        "content": "<p>In particular, wasn't there some form of <code>have</code> that did not have <code>:=</code>?</p>",
        "id": 463976741,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724227610
    },
    {
        "content": "<p>I suppose that's true, but you can just look at any of the match arms in that case</p>",
        "id": 463976956,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724227656
    },
    {
        "content": "<p>although it's more complicated if you actually want to make a <code>Try this</code> suggestion / autofix</p>",
        "id": 463977158,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724227692
    },
    {
        "content": "<p><code>Try this</code> suggestions are unavailable to linters, though, right?</p>",
        "id": 463977335,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724227717
    },
    {
        "content": "<p>Oh, linters could run refactor-like code, though, right?</p>",
        "id": 463977471,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724227744
    },
    {
        "content": "<p>code actions can detect linter warnings and suggest changes</p>",
        "id": 463977603,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724227770
    },
    {
        "content": "<p>Ah, ok.  I have no experience with code-actions.</p>",
        "id": 463977679,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724227789
    },
    {
        "content": "<p>Anyway, I'll try to write a faster implementation of the linter by looking at <code>e</code> in <code>have ... := e</code> and then I will worry about edge cases for <code>have</code>.  The code action will wait a bit longer still.</p>",
        "id": 463978157,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724227877
    },
    {
        "content": "<p>For me, what ends up being efficient code is not always lined up with what I <em>expect</em> to be efficient, so these suggestions are great, because they give me a better sense of what is cheap and what isn't.</p>",
        "id": 463978585,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724227973
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/stream/287929-mathlib4/topic/haveLet.20linter.20crashing.20under.20.60byAsSorry.60/near/463972803\">said</a>:</p>\n<blockquote>\n<p>Ah, the warnings for the unused variables made the linter active!</p>\n</blockquote>\n<p>FWIW, <a href=\"https://github.com/leanprover-community/mathlib4/pull/15942\">#15942</a> had the same issue - thanks for implicitly telling me how that came about!</p>",
        "id": 463979256,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1724228198
    },
    {
        "content": "<p>Oh, maybe that's also why I had to comment out huge chunks of my proof of Kneser's theorem! It timed out for no clear reason</p>",
        "id": 463979383,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1724228241
    },
    {
        "content": "<p>I think in this case the issue is actually the way <code>InfoTree.foldInfoM</code> is defined causes large stacks of closures to be constructed, meaning that any sufficiently large proof will produce a deep stack recursion (number of recursive calls equal to the number of nodes in the info tree for a command)</p>",
        "id": 463979400,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724228246
    },
    {
        "content": "<p>I will also add a todo to the linter, saying that it should only be active with <code>sorry</code>.  Or maybe, inspecting the term <code>e</code> directly, I can simply put a check there if there is a sorry and flag those.</p>",
        "id": 463979503,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724228281
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/stream/287929-mathlib4/topic/haveLet.20linter.20crashing.20under.20.60byAsSorry.60/near/463979383\">said</a>:</p>\n<blockquote>\n<p>I had to comment out huge chunks of my proof of Kneser's theorem</p>\n</blockquote>\n<p>It is roughly 400 lines long, for reference, in a single <code>theorem</code></p>",
        "id": 463979590,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1724228306
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/stream/287929-mathlib4/topic/haveLet.20linter.20crashing.20under.20.60byAsSorry.60/near/463979590\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/stream/287929-mathlib4/topic/haveLet.20linter.20crashing.20under.20.60byAsSorry.60/near/463979383\">said</a>:</p>\n<blockquote>\n<p>I had to comment out huge chunks of my proof of Kneser's theorem</p>\n</blockquote>\n<p>It is roughly 400 lines long, for reference, in a single <code>theorem</code></p>\n</blockquote>\n<p>Together with the <code>longLine</code> and <code>longFile</code> linters, it looks like we also need a <code>longProof</code> linter.</p>",
        "id": 463979692,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724228349
    },
    {
        "content": "<p>What is this <code>byAsSorry</code> thing?</p>",
        "id": 464172737,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724275263
    },
    {
        "content": "<p>I noticed this change in the SetTheory/Ordinal/Topology file. Is this really necessary? Using <code>calc</code> in place of a one line proof seems like overkill.<br>\n<a href=\"/user_uploads/3121/mCNxVbO1Cnl9Lm5OF4f37ZGm/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/mCNxVbO1Cnl9Lm5OF4f37ZGm/image.png\" title=\"image.png\"><img data-original-dimensions=\"1441x125\" src=\"/user_uploads/thumbnail/3121/mCNxVbO1Cnl9Lm5OF4f37ZGm/image.png/840x560.webp\"></a></div>",
        "id": 464172914,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724275325
    },
    {
        "content": "<p>start of <code>byAsSorry</code>:<br>\n<a href=\"#narrow/stream/287929-mathlib4/topic/Running.20Mathlib.20under.20.60set_option.20debug.2EbyAsSorry.60/near/453913575\">https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Running.20Mathlib.20under.20.60set_option.20debug.2EbyAsSorry.60/near/453913575</a></p>",
        "id": 464350560,
        "sender_full_name": "Scott Carnahan",
        "timestamp": 1724327851
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"459227\">Violeta Hernández</span> <a href=\"#narrow/stream/287929-mathlib4/topic/haveLet.20linter.20crashing.20under.20.60byAsSorry.60/near/464172914\">said</a>:</p>\n<blockquote>\n<p>Using <code>calc</code> in place of a one line proof seems like overkill.</p>\n</blockquote>\n<p>So, was this change accidental, or deliberate? Does it have anything to do with getting the linter to work?</p>",
        "id": 464520615,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724379352
    },
    {
        "content": "<p>Oh wait I get it, the issue is that <code>by</code> block at the end</p>",
        "id": 464520879,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1724379520
    },
    {
        "content": "<p>The issue is that the middle term in the calc is not knowable before entering the <code>by</code> block.</p>",
        "id": 464536477,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724385736
    },
    {
        "content": "<p>I had thought we would just be doing this <em>everywhere</em> in Mathlib, but it turns out not so much! I'm skeptical of forbidding it, but there are some nice payoffs to avoiding relying on it. (In particular, the potential for fast benchmarking builds of Mathlib, so we can do a better job of optimizing Lean for Mathlib performance.)</p>",
        "id": 464536793,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724385807
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/287929-mathlib4/topic/haveLet.20linter.20crashing.20under.20.60byAsSorry.60/near/464536477\">said</a>:</p>\n<blockquote>\n<p>The issue is that the middle term in the calc is not knowable before entering the <code>by</code> block.</p>\n</blockquote>\n<p>shouldn't it be the RHS of that TFAE expression?</p>",
        "id": 464538190,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724386138
    },
    {
        "content": "<p>One would hope. I dimly remember that there was an unspecified universe or something here, that the <code>by</code> block resolved? We'd have to look at the <code>byAsSorry</code> branch, and restore the old proof and see what goes wrong.</p>",
        "id": 464538807,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724386289
    }
]