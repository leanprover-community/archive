[
    {
        "content": "<p>Several times it has been reported that linters have a non-negligible effect on the build times for mathlib. For instance, <a href=\"#narrow/channel/287929-mathlib4/topic/.60Mathlib.2EInit.60.20is.20too.20slow\">#mathlib4 &gt; &#96;Mathlib.Init&#96; is too slow</a> is one example.</p>",
        "id": 497042883,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738340618
    },
    {
        "content": "<p>Since I have been developing quite a few of them, I feel responsible for trying to solve this issue.</p>",
        "id": 497042914,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738340628
    },
    {
        "content": "<p>Most of the linters scan the syntax looking for forbidden nodes and report.  Others do something similar scanning the infotrees, instead of the syntax.</p>",
        "id": 497042936,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738340634
    },
    {
        "content": "<p>Right now, every new linter, performs the scan independently of all the others.</p>",
        "id": 497042942,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738340638
    },
    {
        "content": "<p>With a little re-organization, it would be possible to have a \"master\" linter that performs the scan of the syntax once and each \"current\" linter simply plucks information out of that scan to do the reporting.</p>",
        "id": 497042963,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738340642
    },
    {
        "content": "<p>From my perspective, there are two main advantages:</p>\n<ol>\n<li>performance improvement;</li>\n<li>all linters that get combined in the \"master\" one can be silenced with a single <code>set_option</code> for the \"master\" (although each would also retain its individual option, so that they can be silenced granularly as well).</li>\n</ol>",
        "id": 497043011,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738340648
    },
    {
        "content": "<p>The main disadvantage that I see with this is that new linters would have to fit into this machinery.  If they do something that the machine does not currently contemplate, they would have to either be integrated (harder to code), or would again be independent (decreasing performance).</p>",
        "id": 497043024,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738340652
    },
    {
        "content": "<p>In conclusion, does trying to unify all/most linters look like a good idea?</p>",
        "id": 497043032,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738340653
    },
    {
        "content": "<p>On master I see build linting 247.738s and build task-clock 27.332Ks, so we're talking about &lt;1% build time, which would be reduced by an unclear percentage? I'm not sure that's non-negligible compared to other optimizations we could work on and are working on</p>",
        "id": 497045389,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1738341446
    },
    {
        "content": "<p>I always have a hard time understanding those numbers: build linting is about 4 minutes, building all of mathlib takes about 50 minutes in CI.  Why is that not closer to 10%?</p>",
        "id": 497046757,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738341855
    },
    {
        "content": "<p>(Note: a while ago I experimented with something like this in <a href=\"#narrow/stream/287929-mathlib4/topic/linting_rules.20.28and.20foo_rules.29\">#mathlib4&gt;linting_rules (and foo_rules)</a> for syntax node linters specifically. While I think it would be nice to make <em>declaring</em> linters easy and consistent, I canâ€™t speak to whether it would actually give us a worthwhile performance benefit.)</p>",
        "id": 497048137,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1738342320
    },
    {
        "content": "<p>Thomas, I had forgotten about your experiment: thank you for reminding me of it!</p>",
        "id": 497048566,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738342451
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Unifying.20linters/near/497046757\">said</a>:</p>\n<blockquote>\n<p>I always have a hard time understanding those numbers: build linting is about 4 minutes, building all of mathlib takes about 50 minutes in CI.  Why is that not closer to 10%?</p>\n</blockquote>\n<p>Parallelism.</p>",
        "id": 497092991,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1738359612
    },
    {
        "content": "<p>Ah, so merging the linters could make the performance worse!  I was definitely not expecting that!</p>",
        "id": 497094682,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738360396
    },
    {
        "content": "<p>Oh, I doubt that's an issue. It is the <em>build</em> that is benefitting from parallelism. Sebastian was talking about task-clock above (27Ks), while you were talking about wall-clock (50 minutes).</p>",
        "id": 497103037,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1738364223
    },
    {
        "content": "<p>I kind of feel like everyone is tellking <code>2 + 2</code> and I am failing to understand that they mean <code>4</code>.</p>",
        "id": 497182840,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738431307
    },
    {
        "content": "<p>Is the conclusion that at the moment unifying linters would be a negligible gain in performance and that it makes sense to think about other tools?</p>",
        "id": 497182841,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738431308
    }
]