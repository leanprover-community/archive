[
    {
        "content": "<p>Could anyone help me understand why</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">500</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">qs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"n\">n</span><span class=\"o\">))</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">bigMat</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">qs</span><span class=\"bp\">.</span><span class=\"n\">toFinset</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toFinset</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"w\">  </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">sz</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">card</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">qs</span><span class=\"bp\">.</span><span class=\"n\">toFinset</span><span class=\"o\">))</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">v2</span><span class=\"w\">  </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">vecMul</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">bigMat</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">vecMul</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">bigMat</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">v2</span>\n<span class=\"w\">  </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">native_decide</span>\n</code></pre></div>\n<p>takes 5 seconds to run,</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">500</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">qs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"n\">n</span><span class=\"o\">))</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">bigMat</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">qs</span><span class=\"bp\">.</span><span class=\"n\">toFinset</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toFinset</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"w\">  </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">v2</span><span class=\"w\">  </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">vecMul</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">bigMat</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">sz</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">card</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">qs</span><span class=\"bp\">.</span><span class=\"n\">toFinset</span><span class=\"o\">))</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">vecMul</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">bigMat</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">v2</span>\n<span class=\"w\">  </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">native_decide</span>\n</code></pre></div>\n<p>(definitions of <code>v2</code> and <code>sz</code> have swapped places) takes 30 seconds, and</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">500</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">qs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"n\">n</span><span class=\"o\">))</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">bigMat</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">qs</span><span class=\"bp\">.</span><span class=\"n\">toFinset</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toFinset</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"w\">  </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">vecMul</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">bigMat</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">vecMul</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">bigMat</span>\n<span class=\"w\">  </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">native_decide</span>\n</code></pre></div>\n<p>takes 5 seconds under lean v4.20-rc5 and 30 seconds using lean v4.22-rc3?</p>\n<p>The motivation behind this question is a result that takes 5 minutes to verify under lean v4.20, but doesn't finish if left overnight under lean v4.22.</p>",
        "id": 529471232,
        "sender_full_name": "Toby Cathcart Burn",
        "timestamp": 1752848007
    },
    {
        "content": "<p><code>native_decide</code> uses Lean's compiler to evaluate whether the result holds, instead of Lean's kernel (which is why people prefer not to use it). It turns out that the compiler generates different code depending on the order in which <code>v2</code> and <code>sz</code> have been defined (which I find very surprising). However, mathlib's mathematical functions like <code>Matrix.vecMul</code> are not intended to be compiled, and hence they aren't optimized to be compiled efficiently. So basically you shouldn't rely on <code>native_decide</code> being efficient.</p>\n<p>Consider proving your theorem in a different way!</p>",
        "id": 529520720,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1752869236
    },
    {
        "content": "<p>Thanks. The theorem I've proved is that the area of a shape is a specific rational number with over 100 digits in the numerator and denominator, which makes me think it's unlikely that it can be proved without a calculation comparable to matrix multiplication. I'm aware of ways I could have done it much more efficiently, but they would all take longer to write proofs for, and I've seen enough stack overflow errors that I don't trust lean's kernel to handle the task sensibly without native_decide. I have 2 follow up questions:</p>\n<ul>\n<li>Are there any resources for learning how to prove results involving large-ish data using Lean/Mathlib (e.g. what data structures are sensible for the task)?</li>\n<li>Should anyone be notified about the performance regression in the 3rd code block I posted? The runtime appears to have changed from O(k^2) to O(k^3). If this is due to a change in Mathlib, I can understand performance not being a concern, but if it's due to a change in Lean, then the developers might want to know.</li>\n</ul>",
        "id": 529531526,
        "sender_full_name": "Toby Cathcart Burn",
        "timestamp": 1752876579
    },
    {
        "content": "<p>For computations, <code>Matrix</code> has the issue that it's a function, and the operations don't memoize any results.</p>\n<p>I would probably implement some dense matrix data structure, or at least make a function that creates a dense matrix from a <code>Matrix</code> and returns a <code>Matrix</code> that simply reads values out of the dense matrix structure — that way you can slip it in after each <code>vecMul</code>/etc. operation</p>",
        "id": 529532380,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1752877240
    },
    {
        "content": "<p>Since a single vecMul is the only operation directly involving the Matrix that I'm verifying computationally, and it only needs to view each entry once, I don't think memoization would help much (except for the List.toFinset in the type). Also the matrix I'm working with is sparse, so I should be able get something that runs in a few seconds, and I'll probably implement it that way now that I've realized I just need a sort rather than a mutable Map.<br>\nDo you know anything about how I should feed the data to lean? I've been using a list of short lists I generated, but the time the parser takes to process it appears to be quadratic in the length of the list, so I've split it into 100 parts which feels a bit silly.</p>",
        "id": 529533898,
        "sender_full_name": "Toby Cathcart Burn",
        "timestamp": 1752878435
    },
    {
        "content": "<p>It's likely not the parser inducing quadratic complexity, but elaboration. There's a known problem where numeric lists can be slow to elaborate; default instances can be one problem, thought it can also be from the compilation step.</p>\n<p>Do you have a small excerpt of the list you can share?</p>",
        "id": 529534108,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1752878636
    },
    {
        "content": "<p>A few ideas for ingesting large amounts of data into Lean:</p>\n<ul>\n<li>use a String with your own custom data format and make a parser</li>\n<li>use a Nat that encodes the data, again a parser</li>\n<li>for a matrix of natural numbers, you can use <code>List Nat</code> and then for each <code>Nat</code> interpret it in some base, giving you a row of numbers (I used this trick once)</li>\n<li>a string, but you load it from a file rather than include it in the source</li>\n</ul>",
        "id": 529534473,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1752878978
    },
    {
        "content": "<p>Here's the first 3 elements (of just under 4000). The third is most representative. (a list of length &lt;112, 4 lists of length &lt;112, a rational number with large numerator and denominator). the arguments to Piece.treePiece have the types Fin 7, Fin 4 and ZMod 4.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Proof</span><span class=\"bp\">.</span><span class=\"n\">Pieces</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Proof</span><span class=\"bp\">.</span><span class=\"n\">Eqns</span>\n\n<span class=\"c1\">-- vol' e.1 =sum(vol' e.2)/4; e.3 is the coefficient of this eqn for linear_combination</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">part0</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=[</span>\n<span class=\"w\">  </span><span class=\"o\">([</span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">],</span><span class=\"w\"> </span><span class=\"o\">[[],</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">],</span><span class=\"w\"> </span><span class=\"o\">[],</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">]],</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"o\">([</span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">],</span><span class=\"w\"> </span><span class=\"o\">[[],</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">],</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">],</span><span class=\"w\"> </span><span class=\"o\">[]],</span><span class=\"w\"> </span><span class=\"mi\">21330466264694411118705366274969148868597023488809482950268001379227926734844653002742531656783041090887107469343925961194056902636554948928340001407335855138766815143504103340041316806185810931015033900383375938862019</span><span class=\"bp\">/</span><span class=\"mi\">154866390708323530670381178291540808500932175557095479800438653104944580267698405240939599604178028046983621932505732389308889591544694394643480685766119607291179630329136764331873408772421837889405020894961858799002472</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"o\">([</span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">],</span><span class=\"w\"> </span><span class=\"o\">[[</span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">fullPiece</span><span class=\"o\">],</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">trianglePiece</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">],</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">fullPiece</span><span class=\"o\">],</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">trianglePiece</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">]],</span><span class=\"w\"> </span><span class=\"mi\">4543266721356550064243107471444960050283001566395774737049476090769189190178861929218647835457199588650983572629663499168361114217338184992257720653768009396300288218933687996433023103186765454982462654090345294819007</span><span class=\"bp\">/</span><span class=\"mi\">88583575485161059543458033982761342462533204418658614445850909576028299913123487797817450973589832042874631745393278926684684846363565193736070952258220415370554748548266229197831589817825291272739671951918183233029413984</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">,</span>\n</code></pre></div>\n<p>The full file is 4MB in size and can be seen here: <a href=\"https://raw.githubusercontent.com/penteract/pythagTreeProof/refs/heads/master/Proof/Cert.lean\">https://raw.githubusercontent.com/penteract/pythagTreeProof/refs/heads/master/Proof/Cert.lean</a></p>",
        "id": 529534634,
        "sender_full_name": "Toby Cathcart Burn",
        "timestamp": 1752879130
    },
    {
        "content": "<p>Thanks for your help, those are useful ideas.</p>",
        "id": 529534702,
        "sender_full_name": "Toby Cathcart Burn",
        "timestamp": 1752879188
    },
    {
        "content": "<p>I'm not too familiar with the code, but it might be worth looking into <code>bv_decide</code>, which consumes large proof certificates from CaDiCaL.</p>\n<p>By the way, for the ingestion, you could have some elaborator where you write something like <code>eqn% \"the very large string\"</code>, and then it builds the <code>Expr</code> from the string.</p>\n<p>Instead of <code>List</code>, you likely want <code>Array</code>, which stores it all in a contiguous memory block at runtime.</p>",
        "id": 529535021,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1752879496
    },
    {
        "content": "<p>Does <code>Array</code> have as much proved about it as <code>List</code> does? I don't see an <code>Array.toFinset</code> (indexing matrices by representations of equations was quite fun and convenient, although perhaps unreasonable).</p>",
        "id": 529535567,
        "sender_full_name": "Toby Cathcart Burn",
        "timestamp": 1752879984
    },
    {
        "content": "<p>It's a fairly well-supported core type, and for theory you can always reason about <code>Array.toList</code> of it.</p>\n<p>By the way, <code>Finset</code> has a number of O(n) and O(n^2) algorithms that could be O(1) or O(n ln n) with a different type. Maybe it's not worrying about if you're working with things that only took 5s. (It's not fast, but it's not long enough to deserve a coffee break, and if you put it into its own module you can use the result without re-running it all the time.)</p>",
        "id": 529535828,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1752880258
    },
    {
        "content": "<p>(<span class=\"user-mention\" data-user-id=\"656225\">@Cameron Zwarich</span> Pinging you about a regression; not sure if we ever expected it to be fast in the first place, but maybe it's worth looking at?)</p>",
        "id": 529535912,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1752880342
    },
    {
        "content": "<p>The current version takes around 250 seconds, justifying quite a few breaks, but I've recently thought of a moderately easy way to get it down to the order of 5 seconds (like the 2 other <code>native_decide</code>s that I'm using), so I probably won't be optimizing it much further than that. I have already been taking advantage of splitting both the raw data and the proofs that need to look at the data into their own files (my proof is long enough that I'd split it up into multiple files before getting to the bit that needed serious computation).</p>",
        "id": 529536845,
        "sender_full_name": "Toby Cathcart Burn",
        "timestamp": 1752881279
    }
]