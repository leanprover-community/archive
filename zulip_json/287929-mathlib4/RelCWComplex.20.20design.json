[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"697518\">@Hannah Scholz</span> <span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span> So, I'm approaching the conclusion of a project to prove the equivalence of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Topology.RelCWComplex#doc\">docs#Topology.RelCWComplex</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=TopCat.RelativeCWComplex#doc\">docs#TopCat.RelativeCWComplex</a> . At the very last step, though, I've tripped over a bit of strange design in <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=TopCat.RelCWComplex.map#doc\">docs#TopCat.RelCWComplex.map</a> . </p>\n<p>Specifically, the sources are set to be the (open) <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Metric.ball#doc\">docs#Metric.ball</a> , but the complex in fact depends on the behavior of the maps on the boundary <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Metric.sphere#doc\">docs#Metric.sphere</a> . The fact that the maps are required to be continuous on the entirety of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Metric.closedBall#doc\">docs#Metric.closedBall</a> is sufficient to complete the definition, which is a neat topology trick, but complicates matters when trying to come up with the gluing maps; it means I can't use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=PartialEquiv.IsImage.restr#doc\">docs#PartialEquiv.IsImage.restr</a> to just instantly have the right function, for example. It's not like I <em>can't</em> just use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Set.restrict#doc\">docs#Set.restrict</a> and whatnot instead, but I thought I'd ask if you're actually getting something from that extra bit of slack.</p>",
        "id": 523684441,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1749709478
    },
    {
        "content": "<p>What alternative do you propose? AFAIK this is required for the definition. I guess you could alternatively require <code>‚àÄ x ‚àà sphere 0 1, ‚àÉ c, Tendsto (map n i) (ùìù[ball 0 1] x) (ùìù c)</code>, so that the condition only depends on the values of <code>map</code> inside the ball, but that seems strictly more inconvenient to work with.</p>",
        "id": 523714662,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1749720478
    },
    {
        "content": "<p>... Wait, really? What breaks if you just say <code>source_eq (n : ‚Ñï) (i : cell n) : (map n i).source = closedBall 0 1</code> ?</p>",
        "id": 523714980,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1749720584
    },
    {
        "content": "<p>... I mean, I can just go try it. <em>goes to check</em></p>",
        "id": 523715086,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1749720611
    },
    {
        "content": "<p>This was actually a mistaken definition we had before. The problem is that we do <em>not</em> want to require that <code>map</code> is injective on <code>sphere 0 1</code>.</p>",
        "id": 523715223,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1749720660
    },
    {
        "content": "<p>Huh, really? </p>\n<p>Nothing explicitly breaks if I make that change in my copy, at least in Mathlib/Topology/CWComplex/Classical/Basic.lean itself. But I don't know if we have enough API around it to see a subtler flaw.</p>",
        "id": 523715451,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1749720742
    },
    {
        "content": "<p>Nothing will break, but you will lose some (constructions of) CW-complexes. For example, make the <code>n</code>-sphere as a CW-complex with 1 point and 1 <code>n</code>-cell. Can you do that with your new definition?</p>",
        "id": 523715594,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1749720792
    },
    {
        "content": "<p>... I wasn't aware that was possible at all; I thought the construction of the <code>n</code>-sphere required two cells of every dimension from <code>0</code> to <code>n-1</code> ^.^;</p>",
        "id": 523715806,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1749720862
    },
    {
        "content": "<p>Oh, wait, maybe I see how to do it</p>",
        "id": 523715989,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1749720916
    },
    {
        "content": "<p>... Ah, okay. Yes, I see now.</p>",
        "id": 523716189,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1749720973
    },
    {
        "content": "<p>Note: Hannah defined the <code>n</code>-sphere with 2-cells here: <a href=\"https://github.com/scholzhannah/CWComplexes/blob/master/CWcomplexes/Examples.lean#L643-L649\">https://github.com/scholzhannah/CWComplexes/blob/master/CWcomplexes/Examples.lean#L643-L649</a>. With 2n+2 cells it's defined here: <a href=\"https://github.com/scholzhannah/CWComplexes/blob/master/CWcomplexes/Examples.lean#L1163-L1166\">https://github.com/scholzhannah/CWComplexes/blob/master/CWcomplexes/Examples.lean#L1163-L1166</a></p>",
        "id": 523716446,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1749721055
    },
    {
        "content": "<p>(both definitions need to be polished before we PR them to Mathlib)</p>",
        "id": 523716671,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1749721118
    },
    {
        "content": "<p>Mmm. Okay, yeah, I see the problem. Sorry to bother you. I guess I'll go bundle up <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Set.MapsTo#doc\">docs#Set.MapsTo</a> after all.</p>\n<p>While I have your attention, is there something similarly important underlying the choice of the sup metric for our \"spheres\"? The lemma providing the homeomorphism between <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>L</mi><mi mathvariant=\"normal\">‚àû</mi></msup></mrow><annotation encoding=\"application/x-tex\">L^\\infty</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">L</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">‚àû</span></span></span></span></span></span></span></span></span></span></span> spheres and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>L</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">L^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">L</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span> spheres takes up a solid hundred lines... though I do not claim to be an expert in either measure theory or golfing.</p>",
        "id": 523717113,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1749721257
    },
    {
        "content": "<p>It might be useful to get a def that turns a partial equivalence with the condition <code>‚àÄ x ‚àà sphere 0 1, ‚àÉ c, Tendsto (map n i) (ùìù[ball 0 1] x) (ùìù c)</code> into a partial equivalence that is required for CW-complexes (without changing the values inside the ball).</p>",
        "id": 523717460,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1749721372
    },
    {
        "content": "<p>About which norm to use, I wasn't super confident. I expected that it was easier to work with cubes than with balls when constructing explicit examples of CW-complexes, but I don't feel strongly about that part of the definition. <span class=\"user-mention\" data-user-id=\"697518\">@Hannah Scholz</span> we did talk about this before. Do you think the library is overall simpler by using cubes instead of balls?</p>",
        "id": 523717785,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1749721488
    },
    {
        "content": "<p>For all abstract work I don't think it matters at all. The only place where it is actually noticable is the examples. Since I primarily focused on spheres, I too had to pass through the homeomorphism <span class=\"user-mention\" data-user-id=\"359992\">@Robert Maxton</span> mentions. In the end, since you want the sphere to be a CW complex under all norms, you will need such a map anyways, but I do think it would probably be cleaner to work with spheres instead of cubes from the get-go. For now I have preferred our current solution since its shorter to write but that probably isn't a very good reason. Refactoring what is already in mathlib should be very easy and I can get to that soon if it is wanted.</p>",
        "id": 524012539,
        "sender_full_name": "Hannah Scholz",
        "timestamp": 1749847888
    },
    {
        "content": "<p>Ok, in that case we want to consider transferring to the standard definition using balls instead of cubes, but I don't think it's super urgent.</p>",
        "id": 524022937,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1749854948
    },
    {
        "content": "<p>I may just include it in my PR, then, if refactoring <code>Finite</code> won't be too bad?</p>",
        "id": 524023067,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1749855042
    },
    {
        "content": "<p>Sounds good to me.</p>",
        "id": 524025352,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1749856815
    }
]