[
    {
        "content": "<p>(This was originally for the undocumented informal policy thread, but after writing it I realised it makes a lot more sense as its own thread!)</p>\n<p>Here's something that's been on my mind recently: the naming convention for functions which are at least one of a) structure projections (eg <code>Functor.obj</code>) or b) dot notation: should these be prefixed or suffixed?</p>\n<p>Currently mathlib often uses suffixes in names for structure projections, eg <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CategoryTheory.Functor.comp_obj#doc\">docs#CategoryTheory.Functor.comp_obj</a>, and these are almost always spelled using dot notation. (The exception is coercions to fun/set, which are named <code>coe_</code> and written using prefixes). For example named lemmas generated by <code>simps</code> are always suffixed, unless they're special cased otherwise (which happens exactly in coercion case).  <br>\nThe Lean4 Std naming convention explicitly prescribes that structure projections should be suffixed: <a href=\"https://github.com/leanprover/lean4/blob/master/doc/std/naming.md#naming-algorithm-for-theorems-and-some-definitions\">https://github.com/leanprover/lean4/blob/master/doc/std/naming.md#naming-algorithm-for-theorems-and-some-definitions</a>, but my understanding is that this is not meant to be prescriptive for mathlib.</p>\n<p>Mathlib in practice is somewhat split between whether prefixes or suffixes should be used for dot notation, except: predicates are explicitly named in <a href=\"https://leanprover-community.github.io/contribute/naming.html\">#naming</a> as being prefixes (except for certain common examples like <code>_injective</code>). Ya√´l claims <a class=\"message-link\" href=\"/#narrow/channel/287929-mathlib4/topic/Naming.20convention/near/427216813\">#mathlib4 &gt; Naming convention @ üí¨</a> here that use of dot notation should not change the name, which didn't seem to have either pushback or general agreement. (Others also suggested that \"functions are prefixed\" in general might not even be the right rule, let alone dot notation). Before that, a similar discussion happened <a class=\"stream-topic\" data-stream-id=\"113488\" href=\"/#narrow/channel/113488-general/topic/.23naming.20and.20dot.20notation/with/246520191\">#general &gt; #naming and dot notation</a>  here, where there was general (but not complete) consensus that use of dot notation should change the name. For example Kim suggests that we encourage dot notation to be used, and so the naming should too (although this was quite a while ago, so it's very reasonable for opinions to have changed!).</p>\n<p>I would like there to be a clearer convention on when prefix or suffix should be used for these situations.</p>",
        "id": 512367009,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1744734941
    },
    {
        "content": "<p>This discussion also came up in Batteries and we went with prefix naming convention for both functions used in dot notation as well as structure projections</p>",
        "id": 512369409,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744735628
    },
    {
        "content": "<p>It's interesting (surprising?) that Std is now going the other way</p>",
        "id": 512369477,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744735659
    },
    {
        "content": "<p>The reason why <code>Std</code> has this convention is because I believed that this is the preferred in mathlib, and I guess I believed this because this is the scheme used by the <code>simps</code> attribute.</p>",
        "id": 512406773,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1744748402
    },
    {
        "content": "<p>I think it's safe to say that the standard library convention will change to match whatever mathlib decides here.</p>",
        "id": 512407928,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1744748882
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"260921\">Markus Himmel</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Naming.20convention.20for.20structure.20projections.20and.20dot.20notation/near/512406773\">said</a>:</p>\n<blockquote>\n<p>The reason why <code>Std</code> has this convention is because I believed that this is the preferred in mathlib, and I guess I believed this because this is the scheme used by the <code>simps</code> attribute.</p>\n</blockquote>\n<p>From looking through what happened at the time, it seems to me that mathlib preferred suffix for structure projections, and so <code>simps</code> was implemented to reflect this, so that it could be used out-of-the-box to generate lemmas. So that justification seems reasonable enough!</p>",
        "id": 512408180,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1744748987
    },
    {
        "content": "<p>I wanted to link a discussion on Batteries about this but my search-fu is failing. I think it was on a github issue?</p>",
        "id": 512408341,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744749048
    },
    {
        "content": "<p>aha: <a href=\"https://github.com/leanprover-community/batteries/pull/329#issuecomment-1786193983\">https://github.com/leanprover-community/batteries/pull/329#issuecomment-1786193983</a></p>",
        "id": 512408685,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744749188
    },
    {
        "content": "<p>Personally, I like the rule \"functions are prefixes (except for infix notations) and dot notation does not matter\" (which if I understand correctly is the Batteries convention). I like it because it contains very few special cases and it is easy to construct and guess names using this rule.</p>",
        "id": 512411472,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1744750327
    },
    {
        "content": "<p>Note that following this rule would require a lot of changes (and deprecations) in mathlib; especially throughout category theory!</p>",
        "id": 512413094,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1744750992
    },
    {
        "content": "<p>I recall that Kim was not happy with this choice in Batteries (well, at least they were advocating for dot notation as suffix)</p>",
        "id": 512413946,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744751352
    },
    {
        "content": "<p>I used to be an advocate for \"if a function is meant to be used with dot notation, use a suffix\". One justification I had for this is that we name theorems for other notations based on how they pretty print (e.g. <code>add</code> comes between operands' names). However, using dot notation is optional, and binary operations are basically not optional. The pretty printer is allowed to not use dot notation when it would not round trip as well.</p>\n<p>Because of these reasons, I've shifted toward being pro \"always prefix\". Somehow still <code>Functor.comp_obj</code> somehow feels more right than <code>Functor.obj_comp</code> (and a point for <code>Functor.comp_obj</code> is in discoverability; <code>comp</code> is more salient than <code>obj</code>), but I don't mind to see the <code>Functor.obj_comp</code>.</p>",
        "id": 512416759,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744752611
    },
    {
        "content": "<p>In what sense is dot notation more optional than binary operations? I can write <code>HMul.hMul a b</code> just as I could write <code>Functor.obj (F.comp G) X</code> (and in this example, avoiding dot notation for <code>Functor.obj</code> is more painful than avoiding the binary operation!)</p>",
        "id": 512419031,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1744753678
    },
    {
        "content": "<p>In the sense that no one realistically writes <code>HMul.hMul a</code>. Everyone expects <code>HMul.hMul</code> to be pretty printed using <code>*</code>.</p>",
        "id": 512419151,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744753727
    },
    {
        "content": "<p>Well, people probably do write <code>HMul.hMul a</code> sometimes, but at least <code>HMul.hMul a b</code> is unlikely.</p>",
        "id": 512419240,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744753777
    },
    {
        "content": "<p>But no one realistically writes <code>Functor.obj F X</code> either!</p>",
        "id": 512419246,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1744753782
    },
    {
        "content": "<p>Wow, it really is never. <code>Prefunctor.obj</code> appears just once in <code>Mathlib.AlgebraicGeometry.Scheme</code>.</p>",
        "id": 512419473,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744753908
    },
    {
        "content": "<p>On a quick grep through mathlib, I can find two instances (outside of meta code) of fully-applied <code>HMul.hMul a b</code>, and one of <code>Prefunctor.obj</code>, as you mention</p>",
        "id": 512419579,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1744753951
    },
    {
        "content": "<p>does that include uses of <code>obj</code> with the appropriate namespace open?</p>",
        "id": 512419832,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744754088
    },
    {
        "content": "<p>Actually, that one is to define notation: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">scoped</span><span class=\"o\">[</span><span class=\"n\">AlgebraicGeometry</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">notation3</span><span class=\"o\">:</span><span class=\"mi\">90</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">:</span><span class=\"mi\">91</span><span class=\"w\"> </span><span class=\"s2\">\" ‚Åª¬π·µÅ \"</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"o\">:</span><span class=\"mi\">90</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"bp\">@</span><span class=\"n\">Prefunctor</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Scheme</span><span class=\"bp\">.</span><span class=\"n\">Opens</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Scheme</span><span class=\"bp\">.</span><span class=\"n\">Opens</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Opens</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Scheme</span><span class=\"bp\">.</span><span class=\"n\">Hom</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">base</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toPrefunctor</span><span class=\"w\"> </span><span class=\"n\">U</span>\n</code></pre></div>",
        "id": 512419836,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1744754090
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Naming.20convention.20for.20structure.20projections.20and.20dot.20notation/near/512419832\">said</a>:</p>\n<blockquote>\n<p>does that include uses of <code>obj</code> with the appropriate namespace open?</p>\n</blockquote>\n<p>It does not (although I really doubt that happens)</p>",
        "id": 512419924,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1744754141
    },
    {
        "content": "<p>well when you have to use the namespace dot notation is clearly better but when it is open they are equally terse</p>",
        "id": 512420048,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744754193
    },
    {
        "content": "<p>Yeah, I can't find any matches for <code>open.*Prefunctor</code>, and looking through the files which <code>namespace Prefunctor</code>, none of them seem to use <code>obj</code> as a prefix</p>",
        "id": 512420067,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1744754211
    },
    {
        "content": "<p>Certainly this happens a lot for list functions</p>",
        "id": 512420071,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744754214
    },
    {
        "content": "<p>Isn't <code>obj</code> also in the <code>Functor</code> namespace?</p>",
        "id": 512420123,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744754243
    },
    {
        "content": "<p>I don't think so? It's <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Prefunctor.obj#doc\">docs#Prefunctor.obj</a></p>",
        "id": 512420137,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1744754257
    },
    {
        "content": "<p>yes, but there is extends magic</p>",
        "id": 512420165,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744754278
    },
    {
        "content": "<p>Maybe it should, but that doesn't put it into the <code>Functor</code> namespace</p>",
        "id": 512420228,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744754295
    },
    {
        "content": "<p>You can't use <code>Prefunctor.obj</code> on a <code>Functor</code> without using dot notation.</p>",
        "id": 512420249,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744754308
    },
    {
        "content": "<p>without writing <code>Prefunctor.obj (Functor.toPrefunctor f)</code></p>",
        "id": 512420293,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744754322
    },
    {
        "content": "<p>(remember the good old days of Lean 4 when it pretty printed as <code>f.toPrefunctor.obj</code>? :-))</p>",
        "id": 512420395,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744754395
    },
    {
        "content": "<p>I see, so that explains why this one in particular is always dot notation</p>",
        "id": 512420624,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744754493
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Naming.20convention.20for.20structure.20projections.20and.20dot.20notation/near/512413946\">said</a>:</p>\n<blockquote>\n<p>I recall that Kim was not happy with this choice in Batteries (well, at least they were advocating for dot notation as suffix)</p>\n</blockquote>\n<p>I think I was confused by inconsistencies, rather than unhappy with any particular choice. (At least I hope so! I recall also having the same thought Markus mentions above: thinking <code>@[simps]</code> was prescriptive.)</p>\n<p>I would prefer \"functions are prefixes, ignore dot notation, projections are not special\" if we can get there!</p>",
        "id": 512435560,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1744762506
    },
    {
        "content": "<p>I guess this means that  instead of <code>foo_apply</code> and <code>foo_symm_apply</code> we'd have <code>foo_apply</code> and <code>symm_foo_apply</code>?</p>",
        "id": 512435865,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744762695
    },
    {
        "content": "<p>Or is <code>symm</code> going to get a special case?</p>",
        "id": 512435876,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744762703
    },
    {
        "content": "<p>Thinking more about the distinction between List and functor as above, to me the difference is in how the pretty-printer shows it: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">‚•§</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"c1\">-- says List.map f a</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\">  </span><span class=\"c1\">-- says F.map f</span>\n</code></pre></div>\n<p>Drawing the line here would be a smaller change to mathlib. And for Kyle's point of the pretty printer is allowed to not use dot notation: it's still well-defined what the \"standard\" behaviour of the pretty printer is for a definition.</p>",
        "id": 512582118,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1744817297
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Naming.20convention.20for.20structure.20projections.20and.20dot.20notation/near/512435865\">said</a>:</p>\n<blockquote>\n<p>I guess this means that instead of <code>foo_apply</code> and <code>foo_symm_apply</code> we'd have <code>foo_apply</code> and <code>symm_foo_apply</code>?</p>\n</blockquote>\n<p>If I'm understanding correctly, \"projections are not special\" means that bundled maps would have the <code>apply</code> as prefixed as well, since that's a structure projection. So bare functions would be suffix but bundled functions would be prefix? Or there should be special cases for certain kinds of projections instead</p>",
        "id": 512667524,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1744832277
    },
    {
        "content": "<p>It's actually not a structure projection, but <code>DFunLike.coe</code>.</p>",
        "id": 512667955,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1744832346
    },
    {
        "content": "<p>I think that's an implementation detail, these are named from (eg) here: <a href=\"https://github.com/leanprover-community/mathlib4/blob/da9d909e9bbfda893df76c07801fe587bc030fc9/Mathlib/Algebra/Group/Hom/Defs.lean#L515\">https://github.com/leanprover-community/mathlib4/blob/da9d909e9bbfda893df76c07801fe587bc030fc9/Mathlib/Algebra/Group/Hom/Defs.lean#L515</a></p>",
        "id": 512668118,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1744832375
    },
    {
        "content": "<p>You can tell they're distinct because we have lemmas to rewrite between them (eg <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Equiv.toFun_as_coe#doc\">docs#Equiv.toFun_as_coe</a>)</p>",
        "id": 512668618,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1744832451
    },
    {
        "content": "<p>I'm not sure I understand the rule then, it's that structure projections are prefix unless someone makes them into a DFunLike?</p>",
        "id": 512669419,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1744832585
    },
    {
        "content": "<p>I think the rule for pp is that if the first explicit argument has the type with the same namespace, then it's dot notation</p>",
        "id": 512670475,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1744832759
    },
    {
        "content": "<p>Should we just mirror that?</p>",
        "id": 512670545,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1744832764
    },
    {
        "content": "<p>Perhaps, but that's inconsistent with Kim's rule from above, I'm pretty sure</p>",
        "id": 512672137,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1744833029
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Naming.20convention.20for.20structure.20projections.20and.20dot.20notation/near/512416759\">said</a>:</p>\n<blockquote>\n<p>Because of these reasons, I've shifted toward being pro \"always prefix\". Somehow still <code>Functor.comp_obj</code> somehow feels more right than <code>Functor.obj_comp</code> (and a point for <code>Functor.comp_obj</code> is in discoverability; <code>comp</code> is more salient than <code>obj</code>), but I don't mind to see the <code>Functor.obj_comp</code>.</p>\n</blockquote>\n<p>To me this salience is an important feature. The status quo somewhat prioritizes it, but not consistently. I would like new conventions to also take it into account.</p>",
        "id": 512751056,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1744872468
    }
]