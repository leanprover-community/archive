[
    {
        "content": "<p>I just tried to tag the definition of <code>leftLim</code> with <code>to_dual</code> but it doesn't work:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">to_dual</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">rightLim</span><span class=\"kd\">]</span>\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">leftLim</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LinearOrder</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">classical</span>\n<span class=\"w\">  </span><span class=\"n\">haveI</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">‚ü©</span>\n<span class=\"w\">  </span><span class=\"n\">letI</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Preorder</span><span class=\"bp\">.</span><span class=\"n\">topology</span><span class=\"w\"> </span><span class=\"n\">Œ±</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">ùìù</span><span class=\"o\">[</span><span class=\"bp\">&lt;</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">‚ä•</span><span class=\"w\"> </span><span class=\"bp\">‚à®</span><span class=\"w\"> </span><span class=\"bp\">¬¨‚àÉ</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Tendsto</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùìù</span><span class=\"o\">[</span><span class=\"bp\">&lt;</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùìù</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">limUnder</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùìù</span><span class=\"o\">[</span><span class=\"bp\">&lt;</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">f</span>\n</code></pre></div>\n<p>gives</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">to_dual</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">The</span><span class=\"w\"> </span><span class=\"n\">translated</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">correct</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">For</span><span class=\"w\"> </span><span class=\"n\">help</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">see</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">docstring</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"ss\">`to_additive</span><span class=\"bp\">`</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"ss\">`Troubleshooting</span><span class=\"bp\">`.</span><span class=\"w\"> </span><span class=\"n\">Failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"n\">declaration</span>\n<span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">rightLim</span><span class=\"o\">:</span>\n<span class=\"n\">Application</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">mismatch</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">The</span><span class=\"w\"> </span><span class=\"n\">argument</span>\n<span class=\"w\">  </span><span class=\"n\">instBot</span>\n<span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">Bot</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Filter</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span>\n<span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">Top</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Filter</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span>\n<span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">application</span>\n<span class=\"w\">  </span><span class=\"bp\">@</span><span class=\"n\">Top</span><span class=\"bp\">.</span><span class=\"n\">top</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Filter</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">instBot</span>\n</code></pre></div>\n<p>The reason is that it tries to translate the bot filter in the definition to the top filter, while it shouldn't. Is there a way to tell it not to translate this (or to declare the definition by hand and then tell <code>to_dual</code> to use it as the dualized version)?</p>",
        "id": 573246071,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1770804712
    },
    {
        "content": "<p>I'm pretty sure there is, but don't know the right incantation. Is there <code>to_dual_dont_translate</code>? CC <span class=\"user-mention\" data-user-id=\"479299\">@Jovan Gerbscheid</span></p>",
        "id": 573259455,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1770808660
    },
    {
        "content": "<p>I don't think this is supported at the moment: we want to dualize <code>Œ±</code>, but not <code>Filter Œ±</code>. There is <code>@[to_dual (dont_translate := Œ±)]</code>, but that is clearly not what you want here (and <code>dont_translate</code> only accepts names of local variables, not genereal expressions)</p>",
        "id": 573261256,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1770809261
    },
    {
        "content": "<p>I tried <code>attribute [to_dual_dont_translate] Filter</code> and it seems to have fixed the problem</p>",
        "id": 573270362,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1770812208
    },
    {
        "content": "<p>Yes, Aaron is right, you have to tag <code>Filter</code> with <code>@[to_dual_dont_translate]</code></p>",
        "id": 573274023,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1770813357
    },
    {
        "content": "<p>Indeed, it fixes the problem on translating the definition. Proving the next lemmas with <code>@[to_dual]</code> fails, though, I guess because of <code>Preorder.topology Œ±</code> and <code>OrderTopology Œ±</code> which <code>to_dual</code> doesn't know how to handle.</p>",
        "id": 573276254,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1770814049
    },
    {
        "content": "<p>Yes, unfortuately we have to to <code>to_dual</code> tagging from the bottom up, because <code>to_dual</code> needs to know what to translate.</p>",
        "id": 573276514,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1770814136
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/to_dual.20tagging/near/573270362\">said</a>:</p>\n<blockquote>\n<p>I tried <code>attribute [to_dual_dont_translate] Filter</code> and it seems to have fixed the problem</p>\n</blockquote>\n<p>Does this interfere with translating between <code>Filter.atTop</code> and <code>Filter.atBot</code>, which we surely want to do in other places?</p>",
        "id": 573277079,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1770814289
    },
    {
        "content": "<p>Oh, maybe that works correctly: we can translate particular operations on filters, we just don't want to translate anything to do with the <em>order</em> on filters.</p>",
        "id": 573277354,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1770814353
    },
    {
        "content": "<p>Indeed, the <code>to_dual_dont_translate</code> tells <code>to_dual</code> to not translate orders on that type. But when translating <code>atTop [Preorder Œ±] : Filter Œ±</code>, <code>to_dual</code> checks whether it needs to translate the order on <code>Œ±</code>, which typically willl not contain the type <code>Filter</code>.</p>",
        "id": 573277728,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1770814442
    },
    {
        "content": "<p>In the same way, we can translate <code>Set.Ioo</code>, and <code>Set</code> is tagged with <code>to_dual_dont_translate</code>.</p>",
        "id": 573277994,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1770814505
    },
    {
        "content": "<p>In fact, here's a PR that makes a start at tagging <code>Filter.atTop</code> with <code>to_dual</code>, and tags <code>Filter</code> with <code>to_dual_dont_translate</code>: <a href=\"https://github.com/leanprover-community/mathlib4/pull/35133\">#35133</a></p>",
        "id": 573297317,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1770819271
    }
]