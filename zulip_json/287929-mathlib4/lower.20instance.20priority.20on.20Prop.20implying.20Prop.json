[
    {
        "content": "<p>In <a href=\"https://github.com/leanprover-community/mathlib4/pull/18382\">#18382</a>, I provide/generalize the following instances:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- See note [lower instance priority]</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">priority</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">100</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">root_</span><span class=\"bp\">.</span><span class=\"n\">PrincipalIdealRing</span><span class=\"bp\">.</span><span class=\"n\">isNoetherianRing</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsPrincipalIdealRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">IsNoetherianRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">noetherian</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">IsPrincipalIdealRing</span><span class=\"bp\">.</span><span class=\"n\">principal</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">FG</span>\n\n<span class=\"c1\">-- See note [lower instance priority]</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">priority</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">100</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">root_</span><span class=\"bp\">.</span><span class=\"n\">IsPrincipalIdealRing</span><span class=\"bp\">.</span><span class=\"n\">of_isNoetherianRing_of_isBezout</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">IsNoetherianRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsBezout</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsPrincipalIdealRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">principal</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">IsBezout</span><span class=\"bp\">.</span><span class=\"n\">isPrincipal_of_FG</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">IsNoetherian</span><span class=\"bp\">.</span><span class=\"n\">noetherian</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>In <a href=\"https://github.com/leanprover-community/mathlib4/pull/18382#discussion_r1821497892\">a comment</a>, <span class=\"user-mention\" data-user-id=\"439483\">@Andrew Yang</span> guided me to make sure that I lower the priorities, according to our library note. Initially, I did not have lower priorities, thinking that for such \"Prop implies Prop\" instances, the lean4 TC system will resolve loops. The library note discusses forgetful instances (data carrying), which I think is like \"you get Noetherian when you have PIR\". But how about \"PIR when you have Noetherian and Bezout\"? What's the general guidance for instance priorities on such \"prop implies prop\" classes?</p>",
        "id": 479572029,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1730239114
    },
    {
        "content": "<p>I might have not made myself clear in my comment on the PR, but the point is that result type (the thing after <code>:</code>) is too generic and will trigger a (often non-necessary) extensive search and it has little to do about loops and data.</p>",
        "id": 479572402,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1730239307
    },
    {
        "content": "<p>And, if I understand correctly, since in the context of lemmas about some PIR, we're more likely to have that as an \"explicit\" instance argument, it's better to lower the priority on these so that they don't override? I'm not sure I understand the line that is drawn about what counts as \"too generic\".</p>",
        "id": 479581480,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1730244254
    },
    {
        "content": "<p>I guess one thing here that's suboptimal is that together these mean that if you're looking for <code>IsNoetherianRing R</code>, then it will look for <code>IsBezout R</code> unnecessarily. Not sure if there's anything that can be done about that.</p>",
        "id": 479584122,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1730246073
    },
    {
        "content": "<p>By too generic I meant that the result type is <code>MyClass X</code> where <code>X</code> is a variable and not some complex terms.</p>",
        "id": 479584346,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1730246251
    }
]