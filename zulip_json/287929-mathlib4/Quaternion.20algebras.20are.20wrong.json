[
    {
        "content": "<p>Mathlib has a naive definition of quaternion algebras: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- Quaternion algebra over a type with fixed coefficients $a=i^2$ and $b=j^2$.</span>\n<span class=\"sd\">Implemented as a structure with four fields: `re`, `imI`, `imJ`, and `imK`. -/</span>\n<span class=\"kd\">@[</span><span class=\"n\">ext</span><span class=\"kd\">]</span>\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">QuaternionAlgebra</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- Real part of a quaternion. -/</span>\n<span class=\"w\">  </span><span class=\"n\">re</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- First imaginary part (i) of a quaternion. -/</span>\n<span class=\"w\">  </span><span class=\"n\">imI</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- Second imaginary part (j) of a quaternion. -/</span>\n<span class=\"w\">  </span><span class=\"n\">imJ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- Third imaginary part (k) of a quaternion. -/</span>\n<span class=\"w\">  </span><span class=\"n\">imK</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span>\n</code></pre></div>\n<p>This definition is analogous to defining an elliptic curve over a field to be a pair <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>A</mi><mo separator=\"true\">,</mo><mi>B</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(A,B)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">A</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mclose\">)</span></span></span></span> representing the equation <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>y</mi><mn>2</mn></msup><mo>=</mo><msup><mi>x</mi><mn>3</mn></msup><mo>+</mo><mi>A</mi><mi>x</mi><mo>+</mo><mi>B</mi></mrow><annotation encoding=\"application/x-tex\">y^2=x^3+Ax+B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0085em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span></span> -- that equation can be singular, and it doesn't cover all cases in small characteristic. The same is true here. There is a <a href=\"https://en.wikipedia.org/wiki/Quaternion_algebra\">standard definition of a quaternion algebra over a field</a> in the literature, and mathlib's definition is wrong in \"both directions\": there are actual quaternion algebras in characteristic 2 which cannot be represented as mathlib-quaternion-algebras (because there are degree 2 extensions of fields in char 2 which aren't of the form \"adjoin a square root\"), and conversely there are mathlib-quaternion-algebras over fields which are not quaternion algebras according to the standard definition (e.g. you can set $a=b=0$ and the corresponding algebra is not a central simple algebra). </p>\n<p>As well as these issues, there is also the moral objection that we don't define a <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span>-vector space to be <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>k</mi><mi>n</mi></msup></mrow><annotation encoding=\"application/x-tex\">k^n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span></span></span></span></span></span></span>, we define it to be something which satisfies the vector space axioms, and yet (unlike in the literature) our quaternion algebras all come equipped with a canonical basis. One can apply this same moral objection to our definition of elliptic curves, which don't come with a preferred realisation as a smooth plane cubic, but here there are some good counter-arguments for preferring our plane cubic definition: firstly, many elliptic curves in arithmetic really do come presented as a plane cubic (for example the Frey curve, key to FLT, or curves which show up when solving Diophantine equations). And secondly the morally correct alternative (a smooth proper connected group scheme of genus 1 equipped with a marked point) was completely inaccessible when we made the definition of an elliptic curve, and indeed the definition still cannot be formalized in mathlib because we still don't have the concept of genus of a curve and haven't really made up our minds about how to talk about group schemes in the non-affine case. In stark contrast to this, it's easy to write down the correct definition of a quaternion algebra in mathlib, and has been for years; furthermore some students at Imperial have developed a huge theory of central simple algebras and now need to think about PRing to mathlib.</p>\n<p>I need quaternion algebras for FLT but only in characteristic 0 so I am not desperate to change the definition, but I do find it a bit weird that we've diverged from the literature. Bourbaki define quaternion algebras \"explicitly\" like we do, but use three parameters <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo separator=\"true\">,</mo><mi>b</mi><mo separator=\"true\">,</mo><mi>c</mi></mrow><annotation encoding=\"application/x-tex\">a,b,c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">c</span></span></span></span> and have equations <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>i</mi><mn>2</mn></msup><mo>=</mo><mi>a</mi><mi>i</mi><mo>+</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">i^2=ai+b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">i</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7429em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">ai</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>j</mi><mn>2</mn></msup><mo>=</mo><mi>c</mi></mrow><annotation encoding=\"application/x-tex\">j^2=c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0085em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">c</span></span></span></span>. This is at least valid in characteristic 2, but allows rings which are not quaternion algebras according to Wikipedia (which is the definition I think we should aspire to). Does anyone have any comments about what we should do here? I remember talking about this to <span class=\"user-mention\" data-user-id=\"130609\">@Antoine Chambert-Loir</span> at some point...</p>",
        "id": 484076695,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1732378791
    },
    {
        "content": "<p>Could you maybe be a bit more explicit about what the proposed alternative is here?</p>",
        "id": 484077168,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1732379200
    },
    {
        "content": "<p>as a newbie to this kind of mathematics that definition looks perfectly reasonable</p>",
        "id": 484077200,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1732379227
    },
    {
        "content": "<p>I suspect the issue is that \"quaternion algebra\" here is the wrong word. This looks like what you get if you take hamilton's quaternions and just generalize the ring without doing anything else. In particular, it's a construction not a typeclass</p>",
        "id": 484077510,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1732379510
    },
    {
        "content": "<p>There are at least two other definitions which deserve the name <code>QuaternionAlgebra</code>: the definition according to Wikipedia (which could be <code>IsQuaternionAlgebra</code>, a class predicate on algebras) and a better variant of our definition which takes in three inputs not two and allows i^2=ai+b. An additional issue is that there is a nonzeroness condition which is missing in our definition. In the elliptic curve case we have <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=WeierstrassCurve#doc\">docs#WeierstrassCurve</a> which is the equation and then <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=EllipticCurve#doc\">docs#EllipticCurve</a> which has the nonsingularity condition. Similarly here we should have a nonvanishing condition which actually makes our definition into a quaternion algebra. </p>\n<p>In short I'm uncomfortable about the fact that our definition is mathematically wrong for two reasons and morally wrong because it's not a class.</p>",
        "id": 484078591,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1732380471
    },
    {
        "content": "<p>I am certainly in favor of a refactor changing to the rank 4 central simple algebra definition. Bourbaki's definition looks like it should be named something like <code>QuaternionAlgebra.mk'</code> or <code>QuaternionAlgebra.ofBasis</code></p>",
        "id": 484080115,
        "sender_full_name": "Scott Carnahan",
        "timestamp": 1732381622
    },
    {
        "content": "<p>These are cases where I don't really know what to do. Over a field, all legit quaternion algebras should be there, and having some explicitly presented algebras is important. Of course, the simple central algebra point of view is ultimately vital. Over a ring, the situation is complicated because orders of quaternion algebras are important objects, but they are usually not Azumaya algebras — bad reduction happens.</p>",
        "id": 484083961,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1732384962
    },
    {
        "content": "<p>So if I get this right, we should only define quaternion algebra over fields as rank 4 central simple algebras?</p>",
        "id": 484172969,
        "sender_full_name": "Edison Xie",
        "timestamp": 1732475132
    },
    {
        "content": "<p>What about over rings though</p>",
        "id": 484172980,
        "sender_full_name": "Edison Xie",
        "timestamp": 1732475150
    },
    {
        "content": "<p>Over (commutative) rings the correct object is an Azumaya algebra</p>",
        "id": 484181331,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1732483659
    },
    {
        "content": "<p>But like several objects in algebraic geometry it's sometimes best to develop the theory over fields first and then generalise to rings/schemes later (because a bunch of the scheme proofs use devissage to reduce to fields)</p>",
        "id": 484181422,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1732483728
    },
    {
        "content": "<p>Hmmm do we have azumaya algebra in Mathlib yet?</p>",
        "id": 484182765,
        "sender_full_name": "Edison Xie",
        "timestamp": 1732485031
    },
    {
        "content": "<p>I don't think so, but we could easily define them. It just requires the definition of a separable (possibly noncommutative) algebra.</p>",
        "id": 484184886,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1732487201
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">IsQuaternionAlgebra</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Q</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">extends</span>\n<span class=\"w\">  </span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">IsCentral</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">IsSimpleRing</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">rank_four</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">finrank</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">4</span>\n</code></pre></div>\n<p>Does this definition looks right?</p>",
        "id": 484389376,
        "sender_full_name": "Edison Xie",
        "timestamp": 1732568700
    },
    {
        "content": "<p>No, that's the point: this works if <code>Q</code> is a field, but is \"wrong\" otherwise. Instead of <code>IsSimpleRing</code> we want something like <code>IsSeparable</code>, but currently <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/FieldTheory/Separable.html#Algebra.IsSeparable\">Algebra.IsSeparable</a> works well only over a field.</p>",
        "id": 484389862,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1732568908
    },
    {
        "content": "<p>But I think it is better to stay over a field, at least at the beginning</p>",
        "id": 484390285,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1732569120
    },
    {
        "content": "<p><code>extends IsSimpleRing</code> is not legal there, as it doesn't capture <code>F</code></p>",
        "id": 484390870,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1732569355
    },
    {
        "content": "<p>wait but I thought over a field quaternion is dim 4 central simple algebra?</p>",
        "id": 484395362,
        "sender_full_name": "Edison Xie",
        "timestamp": 1732571393
    },
    {
        "content": "<p>also why does Q have to be field</p>",
        "id": 484395423,
        "sender_full_name": "Edison Xie",
        "timestamp": 1732571407
    },
    {
        "content": "<p>didn't quite follow</p>",
        "id": 484395434,
        "sender_full_name": "Edison Xie",
        "timestamp": 1732571414
    },
    {
        "content": "<p>Sorry, I swapped <code>F</code> and <code>Q</code>. Yes, over a field the definition is mathematically OK</p>",
        "id": 484396659,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1732571977
    },
    {
        "content": "<p>For FLT we only need the theory over fields and my instinct is to develop that first (in such a way that it works for all fields).</p>",
        "id": 484405686,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1732576187
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Quaternion.20algebras.20are.20wrong/near/484390870\">said</a>:</p>\n<blockquote>\n<p><code>extends IsSimpleRing</code> is not legal there, as it doesn't capture <code>F</code></p>\n</blockquote>\n<p>Why is it not legal? I’m still a bit confused <span aria-label=\"anguish\" class=\"emoji emoji-1f62b\" role=\"img\" title=\"anguish\">:anguish:</span><span aria-label=\"anguish\" class=\"emoji emoji-1f62b\" role=\"img\" title=\"anguish\">:anguish:</span></p>",
        "id": 484417557,
        "sender_full_name": "Edison Xie",
        "timestamp": 1732583585
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"699016\">@Edison Xie</span> I agree it is confusing. Let me try to explain. (We should document this somewhere, maybe on a blogpost?)</p>\n<p>By writing <code>extends</code>, there will automatically be an instance: <code>[IsQuaternionAlgebra F Q] -&gt; [IsSimpleRing Q]</code>.<br>\nNow suppose that 3 files later, you are working on a proof, and you need to know <code>[IsSimpleRing Q]</code>. Lean will remember \"Aaah, I know that quaternion algebras are simple!\" And it will start hunting for <code>[IsQuaternionAlgebra ?F Q]</code>. Where the <code>?F</code> is unknown, because it isn't determined by <code>[IsSimpleRing Q]</code>. And so Lean goes on a wild goose chase. Conclusion: it shouldn't do that, so we shouldn't create the automatic instance.</p>",
        "id": 484434851,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732596369
    },
    {
        "content": "<p>Now you can fairly ask the question: can't <code>extends</code> recognise this on its own, and just do a \"structure extends\" without making it an instance. And I think it should be able to do that. Maybe <span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> can say more about this?</p>",
        "id": 484434924,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732596447
    },
    {
        "content": "<p>Would it make sense for <code>F</code> to be an <code>outParam</code>?</p>",
        "id": 484440809,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1732601289
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"112680\">@Johan Commelin</span> It should already give an error in this case, and I think it would be surprising if <code>extends</code> silently omitted instances. I wonder if there's room for \"non-instance parents\" as an additional feature.</p>",
        "id": 484441203,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1732601577
    },
    {
        "content": "<p>In this case, an <code>outParam</code> might actually make sense. Because an algebra <code>Q</code> can only be a quaternion algebra over 1 field (up to isom), namely its center.<br>\nThis is in contrast with <code>Module R M</code>, where <code>R</code> used to be an outParam long ago, but that caused many headaches because <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">C</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{C}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">C</span></span></span></span> is naturally a module over <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">C</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{C}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">C</span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">R</mi></mrow><annotation encoding=\"application/x-tex\">\\R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">R</span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">Q</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Q}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8556em;vertical-align:-0.1667em;\"></span><span class=\"mord mathbb\">Q</span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">Z</mi></mrow><annotation encoding=\"application/x-tex\">\\Z</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">Z</span></span></span></span>, and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">N</mi></mrow><annotation encoding=\"application/x-tex\">\\N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">N</span></span></span></span>.</p>",
        "id": 484448817,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732606189
    },
    {
        "content": "<p>Of course the \"(up to isom)\" is still hinting at potential sources of trouble. <code>outParam</code> only works if the field is in practice unique up to defeq. But I'm claiming that this might actually be the case in 99%.</p>",
        "id": 484449028,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732606295
    },
    {
        "content": "<p>Unfortunately whilst it might be the case that you're a quaternion algebra over one field, you might be an algebra over several fields. Is this a problem?</p>",
        "id": 484451111,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1732607280
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Quaternion.20algebras.20are.20wrong/near/484448817\">said</a>:</p>\n<blockquote>\n<p>In this case, an <code>outParam</code> might actually make sense. Because an algebra <code>Q</code> can only be a quaternion algebra over 1 field (up to isom), namely its center.</p>\n</blockquote>\n<p>still, then in order to not get defeq issues, do we only want the <code>IsQuaternionAlgebra (center Q) Q</code> instance? i doubt that...</p>",
        "id": 484483038,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732617908
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130609\">Antoine Chambert-Loir</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Quaternion.20algebras.20are.20wrong/near/484184886\">said</a>:</p>\n<blockquote>\n<p>I don't think so, but we could easily define them. It just requires the definition of a separable (possibly noncommutative) algebra.</p>\n</blockquote>\n<p>I think Definition 4 on Wikipedia is the most accessible, without requiring defining IsSeparable first.<br>\n<a href=\"/user_uploads/3121/t6paHy82U_GJXI2bWvRlxSsb/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/t6paHy82U_GJXI2bWvRlxSsb/image.png\" title=\"image.png\"><img data-original-dimensions=\"1349x310\" src=\"/user_uploads/thumbnail/3121/t6paHy82U_GJXI2bWvRlxSsb/image.png/840x560.webp\"></a></div>",
        "id": 484505731,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1732625344
    },
    {
        "content": "<p>That’s right and <span class=\"user-mention silent\" data-user-id=\"671216\">Jujian Zhang</span> already formalised morita equivalence so theoretically it could be easily done</p>",
        "id": 484569940,
        "sender_full_name": "Edison Xie",
        "timestamp": 1732644446
    },
    {
        "content": "<p>Opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/20489\">#20489</a> but still a work in progress if anyone interested could go take a look</p>",
        "id": 491948685,
        "sender_full_name": "Edison Xie",
        "timestamp": 1736066034
    },
    {
        "content": "<p>opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/20657\">#20657</a> about the definition of quaternion on Bourbaki's book</p>",
        "id": 493086715,
        "sender_full_name": "Edison Xie",
        "timestamp": 1736592994
    },
    {
        "content": "<p>Shouldn't we just replace the old one?</p>",
        "id": 493090679,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1736596681
    },
    {
        "content": "<p>Is the old one just a specialization of the new one?</p>",
        "id": 493092503,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736598319
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Quaternion.20algebras.20are.20wrong/near/493092503\">said</a>:</p>\n<blockquote>\n<p>Is the old one just a specialization of the new one?</p>\n</blockquote>\n<p>Yes it is but I'm thinking maybe do that in the next PR?</p>",
        "id": 493092731,
        "sender_full_name": "Edison Xie",
        "timestamp": 1736598549
    },
    {
        "content": "<p>I could do it in this one but I thought one PR should only be doing one thing?</p>",
        "id": 493092748,
        "sender_full_name": "Edison Xie",
        "timestamp": 1736598569
    },
    {
        "content": "<p>I think generalizing the existing one in place would be a smaller diff</p>",
        "id": 493092754,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736598585
    },
    {
        "content": "<p>If it's really just adding an extra <code>c</code> parameter, which you could possible even give a default value to preserve the old behavior</p>",
        "id": 493092835,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736598642
    },
    {
        "content": "<p>hmmm okay</p>",
        "id": 493092875,
        "sender_full_name": "Edison Xie",
        "timestamp": 1736598694
    },
    {
        "content": "<p>I'll just wait for more people to respond on this for now :))</p>",
        "id": 493093004,
        "sender_full_name": "Edison Xie",
        "timestamp": 1736598824
    },
    {
        "content": "<p>If that's what we all think then I'll jus replace the old one</p>",
        "id": 493093067,
        "sender_full_name": "Edison Xie",
        "timestamp": 1736598864
    },
    {
        "content": "<p>how should we name them?</p>",
        "id": 493102041,
        "sender_full_name": "Edison Xie",
        "timestamp": 1736606768
    },
    {
        "content": "<p>Maybe <code>QuaternionAlgebra</code> and <code>Quaternion</code>?</p>",
        "id": 493102059,
        "sender_full_name": "Edison Xie",
        "timestamp": 1736606785
    },
    {
        "content": "<p>I like the idea of replacing what we have already. My mental model was that this would be a huge PR because you'd have to redo the quaternion algebra file and also patch all the applications, but probably the quaternion algebra diff wouldn't be so bad and if you give the new variable a default value of 0 perhaps the patches won't be so bad either.</p>",
        "id": 493104088,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1736608668
    },
    {
        "content": "<p>If we do this then the only remaining objection I have to the name is that it would be then like defining an elliptic curve over a field to be <code>[a1,a2,a3,a4,a6]</code> rather than \"this + disc != 0\". Nowadaysin mathlib we have <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=WeierstrassCurve#doc\">docs#WeierstrassCurve</a> <code>k</code> defined to be <code>k^5</code> and then <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=WeierstrassCurve.IsElliptic#doc\">docs#WeierstrassCurve.IsElliptic</a> to be \"this + disc != 0\". With Edison's new definition we can still set everything to be 0 and get a rank 4 algebra which is not a quaternion algebra in the sense of the usual definition, because it is degenerate. I must be honest: I don't know the conditions on the coefficients which ensure that that the algebra is a quaternion algebra in the usual sense.</p>",
        "id": 493104643,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1736609136
    },
    {
        "content": "<p>I'm not sure having parametrizations which aren't actually quaternion algebras is that different to defining <code>MonoidAlgebra</code>  which accepts non -monoids and produces non-algebras</p>",
        "id": 493113416,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736616885
    },
    {
        "content": "<p>(and I think both are sensible)</p>",
        "id": 493113717,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736617181
    },
    {
        "content": "<p>done changing the files in Mathlib I could be ignoring some of the docstring errors but in general this should be what we want</p>",
        "id": 493119417,
        "sender_full_name": "Edison Xie",
        "timestamp": 1736621981
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Quaternion.20algebras.20are.20wrong/near/493113416\">said</a>:</p>\n<blockquote>\n<p>I'm not sure having parametrizations which aren't actually quaternion algebras is that different to defining <code>MonoidAlgebra</code>  which accepts non -monoids and produces non-algebras</p>\n</blockquote>\n<p>There is something of a difference here: if you give MonoidAlgebra a monoid, it will produce an algebra, i.e. it's not possible to construct something which a mathematician would say was <em>mathematically wrong</em>, just something which a mathematician would say was missing some structure. But right now <code>QuaternionAlgebra ℝ 0 0</code> produces something which is an <code>ℝ</code>-algebra but is genuniely not a quaternion algebra: it can't be the quaternions because they don't have any nonzero solutions to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>x</mi><mn>2</mn></msup><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">x^2=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>, and it can't be <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>M</mi><mn>2</mn></msub><mo stretchy=\"false\">(</mo><mi mathvariant=\"double-struck\">R</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">M_2(\\R)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathbb\">R</span><span class=\"mclose\">)</span></span></span></span> because if this ring acted faithfully on <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi mathvariant=\"double-struck\">R</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">\\R^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span> then <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>i</mi><mn>2</mn></msup><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">i^2=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">i</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span> means that one can choose a basis such that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> is represented by <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>1</mn><mo separator=\"true\">;</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>0</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(0,1;0,0)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">;</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">0</span><span class=\"mclose\">)</span></span></span></span> and then an explicit matrix calculation shows that there are no nonzero <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>j</mi></mrow><annotation encoding=\"application/x-tex\">j</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span></span></span></span> with <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mi>j</mi><mo>=</mo><mo>−</mo><mi>j</mi><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">ij=-ji</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">ij</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\"></span><span class=\"mord\">−</span><span class=\"mord mathnormal\">ji</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>j</mi><mn>2</mn></msup><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">j^2=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0085em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>, as <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mi>j</mi><mo>=</mo><mo>−</mo><mi>j</mi><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">ij=-ji</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">ij</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\"></span><span class=\"mord\">−</span><span class=\"mord mathnormal\">ji</span></span></span></span> forces <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>j</mi></mrow><annotation encoding=\"application/x-tex\">j</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span></span></span></span> to be diagonal. Maybe the condition over fields is just that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>c</mi><mn>1</mn></msub></mrow><annotation encoding=\"application/x-tex\">c_1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>c</mi><mn>2</mn></msub></mrow><annotation encoding=\"application/x-tex\">c_2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> are nonzero?</p>",
        "id": 493192989,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1736691390
    },
    {
        "content": "<p>I just checked Bourbaki (Algebra, chap 3), and they don't impose any condition on their quaternion algebras.</p>",
        "id": 493194600,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1736692743
    },
    {
        "content": "<p>By the way, their presentation, starting from quadratic algebras and Cailey algebra also furnished octonions.</p>",
        "id": 493194718,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1736692828
    },
    {
        "content": "<p>In Algebra, chap 8, §19, they go back to quaternion algebras and study their center, simplicity, and explain when they are fields.</p>",
        "id": 493194881,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1736692969
    },
    {
        "content": "<p>Do they explain when they are quaternion algebras? :-) Thanks for the reference! I think that if it's good enough for Bourbaki it's probably good enough for us.</p>",
        "id": 493194908,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1736692987
    },
    {
        "content": "<p>They are quaternion algebras, by definition, and, over a field, are central simple when <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mn>4</mn><mi>a</mi><mo>+</mo><msup><mi>b</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo><mi>c</mi><mo mathvariant=\"normal\">≠</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\"> (4a+b^2)c\\neq 0 </annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">4</span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\"><span class=\"mord vbox\"><span class=\"thinbox\"><span class=\"rlap\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"inner\"><span class=\"mord\"><span class=\"mrel\"></span></span></span><span class=\"fix\"></span></span></span></span></span><span class=\"mrel\">=</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>. This is proposition 3 of chapter 8, §19.</p>",
        "id": 493195041,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1736693105
    },
    {
        "content": "<p>I think it's the correct way to do, because you don't want to have to carry conditions whenever you wish to talk about those algebras.</p>",
        "id": 493195175,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1736693201
    },
    {
        "content": "<p>My experience with elliptic curves was similar; I defined them with the disc!=0 condition and then David Ang started using them and found that a whole bunch of results were true for Weierstrass curves more generally. The only difference was that that there were distinctions Weierstrass curve for the plane cubic and IsElliptic for disc!=0. Here you are claiming that Mathlib's quaternion algebras are quaternion algebras by definition but I dispute this claim; it might be what Bourbaki says but it's not what Wikipedia says or what the internet in general says or what I was taught. But this is not really relevant; after this discussion I'm pretty convinced that the current state of <a href=\"https://github.com/leanprover-community/mathlib4/pull/20657\">#20657</a> is the way to go and I suspect you are too.</p>",
        "id": 493196082,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1736693981
    },
    {
        "content": "<p>i love internet and Wikipedia, but don't trust them too much.</p>",
        "id": 493196206,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1736694092
    },
    {
        "content": "<p>and we were taught and teach simplified versions of what ought to be done in a Great Mathematical Library.</p>",
        "id": 493196300,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1736694151
    },
    {
        "content": "<p>I personally find that having <code>QuaternionAlgebra</code>s being the ones where you just add square roots of <em>any</em> two elements, with no extra consideration, and then central simple algebras, with all the rest of the conditions is very clear.</p>\n<p>Whenever I taught them, I restrained from using the words quaternion algebras in a situation where they were not central simple algebras and felt that I was lacking a term.  I think that sometimes I called them \"quadratic algebras\" and felt the need to add lots of disclaimers about the name.</p>",
        "id": 493198834,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736696350
    },
    {
        "content": "<p>And with elliptic curves, the whole \"elliptic curve factorisation method\" actually relies on having \"elliptic curves\" that are <em>not</em> elliptic curves!</p>",
        "id": 493198863,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736696391
    },
    {
        "content": "<p>I had an old project I was working on where I was generalising quaternon algebras to Bourbaki's definition and giving lemmas for when they are split (in both cases of char 2 and general char fields) via defining explicit isomorphisms.<br>\nIf people are interested I could work on updating my code for the second part and create a PR for them.  That being said, I am not sure if Mathlib is the place for these explicit isomorphisms, especially when it can be proved directly using other methods (e.g. Thm 5.4.4 in Voights QA book).</p>",
        "id": 500632752,
        "sender_full_name": "William Coram",
        "timestamp": 1739966505
    },
    {
        "content": "<p>You might want to liaise with <span class=\"user-mention\" data-user-id=\"699016\">@Edison Xie</span> who has also been thinking about this.</p>",
        "id": 500635676,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1739967405
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"719560\">William Coram</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Quaternion.20algebras.20are.20wrong/near/500632752\">said</a>:</p>\n<blockquote>\n<p>I had an old project I was working on where I was generalising quaternon algebras to Bourbaki's definition and giving lemmas for when they are split (in both cases of char 2 and general char fields) via defining explicit isomorphisms.<br>\nIf people are interested I could work on updating my code for the second part and create a PR for them.  That being said, I am not sure if Mathlib is the place for these explicit isomorphisms, especially when it can be proved directly using other methods (e.g. Thm 5.4.4 in Voights QA book).</p>\n</blockquote>\n<p>I have the some results about quaternions and dimension four central simple algebra but you are welcome to PR more stuff about it if later I found your results are corollaries of my theorem then I’ll make another PR to change that! :))</p>",
        "id": 500745808,
        "sender_full_name": "Edison Xie",
        "timestamp": 1740000464
    }
]