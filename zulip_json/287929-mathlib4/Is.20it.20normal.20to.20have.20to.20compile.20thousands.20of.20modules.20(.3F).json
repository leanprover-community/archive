[
    {
        "content": "<p>I tried adding mathlib4 to my project so I could use the <code>#help</code> syntax. When running it, it gets stuck building what looks like a large number of object files:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">â£»</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">6019</span><span class=\"bp\">/</span><span class=\"mi\">10030</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Running</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">CC</span><span class=\"bp\">.</span><span class=\"n\">Addition</span><span class=\"o\">:</span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"n\">more</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>At the current rates it's going to take about an hour, but I also have to stop it occasionally because it is using 100% CPU and overheating my computer. Also my project directory is now taking up 4.5GB.</p>",
        "id": 466745530,
        "sender_full_name": "Spearman",
        "timestamp": 1725216003
    },
    {
        "content": "<p>No, that's what <code>lake exe cache get</code> is for</p>",
        "id": 466745681,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1725216073
    },
    {
        "content": "<p>What do you <code>import</code>?</p>",
        "id": 466749446,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1725217636
    },
    {
        "content": "<p>I've already run <code>lake exe cache get</code>, it says it completed successfully. As soon as I <code>import Mathlib</code> in my <code>.lean</code> executable and do <code>lake exe myproject</code> it starts building again from [5010/10034].</p>",
        "id": 466749484,
        "sender_full_name": "Spearman",
        "timestamp": 1725217658
    },
    {
        "content": "<p>You should import a specific file instead.</p>",
        "id": 466749600,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1725217694
    },
    {
        "content": "<p>Which file should I import to access <code>#help</code>?</p>",
        "id": 466749654,
        "sender_full_name": "Spearman",
        "timestamp": 1725217740
    },
    {
        "content": "<p>While cache gives you <code>olean</code>s, executables need to compile files (i.e., build <code>.o</code> files).</p>",
        "id": 466749658,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1725217743
    },
    {
        "content": "<p><code>Mathlib.Tactic.HelpCmd</code></p>",
        "id": 466749669,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1725217759
    },
    {
        "content": "<p>Do you need it at runtime, or only during development?</p>",
        "id": 466749688,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1725217776
    },
    {
        "content": "<p>Never mind, it has very few dependencies.</p>",
        "id": 466749784,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1725217817
    },
    {
        "content": "<p>That 10.000 is very suspicious, it looks like you depend you two copies of Mathlib (which is 5000 files long). Could you share your lakefile.lean (or lakefile.toml)?</p>",
        "id": 466756205,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1725221226
    },
    {
        "content": "<p>It's probably olean+o, the first half of which cache has already handled</p>",
        "id": 466757107,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1725221753
    },
    {
        "content": "<p>building .o files should not take an hour</p>",
        "id": 466760159,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1725223837
    },
    {
        "content": "<p>a long time ago it was 5 minutes, so maybe it's 15 minutes now?</p>",
        "id": 466760180,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1725223857
    },
    {
        "content": "<p>The most straightforward way to not have to build .o files for a lot of mathlib is to not import that much - avoid <code>import Mathlib</code>, and instead import only the files you actually need for execution in your <code>lean_exe</code> target. You can have another <code>lean_lib</code> with proofs about your program if you need more of mathlib for that</p>",
        "id": 466760409,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1725223948
    },
    {
        "content": "<p>Generally speaking, you shouldn't need much if anything of mathlib in an executable. Most of the things that you might need are candidates for moving to batteries if they aren't already in it or in core</p>",
        "id": 466760558,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1725224013
    },
    {
        "content": "<p>Just to reiterate what Mario says, in most cases when people create a new Lean project and then add Mathlib, they actually want to delete the file <code>Main.lean</code> from the newly created Lean project and delete the part which says <code>lean_exe</code> from the <code>lakefile</code>. (depending on which arguments you used in <code>lake new</code> it may or may not have created such a stub executable for you)</p>\n<p>If you want to write mathematical proofs, you don't need <code>Main.lean</code> or the executable. You only need it if you want to write an executable like <code>lake exe my-program</code></p>",
        "id": 466765002,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1725226907
    }
]