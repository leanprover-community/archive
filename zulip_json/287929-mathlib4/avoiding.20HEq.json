[
    {
        "content": "<p>In <a href=\"https://github.com/leanprover-community/mathlib4/pull/24039\">#24039</a>, I define the equivalence of stabilizers in an orbit, refining <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MulAction.stabilizerEquivStabilizerOfOrbitRel#doc\">docs#MulAction.stabilizerEquivStabilizerOfOrbitRel</a></p>\n<p>My definition takes the form :</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">stabilizerEquivStabilizer</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hg</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stabilizer</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">≃*</span><span class=\"w\"> </span><span class=\"n\">stabilizer</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">…</span>\n</code></pre></div>\n<p>A suggestion of <span class=\"user-mention\" data-user-id=\"246273\">@Bhavik Mehta</span> was to make <code>a := g • b</code> there, but then I can't manage to  the prove the transitivity property. And since it follows from the <code>refl</code> property, it is really the latter that I can't prove.</p>\n<p>Here is a MWE. I'd like to get advices about the most practical framing.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">GroupTheory</span><span class=\"bp\">.</span><span class=\"n\">GroupAction</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">MulAction</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MulAction</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">sEs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stabilizer</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≃*</span><span class=\"w\"> </span><span class=\"n\">stabilizer</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"o\">((</span><span class=\"n\">MulAut</span><span class=\"bp\">.</span><span class=\"n\">conj</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">subgroupMap</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">stabilizer</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">trans</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">MulEquiv</span><span class=\"bp\">.</span><span class=\"n\">subgroupCongr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">stabilizer_smul_eq_stabilizer_map_conj</span><span class=\"o\">]))</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">sEs_apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stabilizer</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">sEs</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">MulAut</span><span class=\"bp\">.</span><span class=\"n\">conj</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">sEs</span><span class=\"o\">]</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">sEs_refl</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\">  </span><span class=\"c1\">-- reflexivity</span>\n<span class=\"w\">    </span><span class=\"n\">HEq</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"bp\">▸</span><span class=\"w\"> </span><span class=\"n\">sEs</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sEs</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">sEs_refl_apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stabilizer</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\">  </span><span class=\"c1\">-- reflexivity</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"bp\">▸</span><span class=\"w\"> </span><span class=\"n\">sEs</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"bp\">▸</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sEs</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">sEs_trans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\">  </span><span class=\"c1\">-- transitivity</span>\n<span class=\"w\">    </span><span class=\"n\">mul_smul</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">▸</span><span class=\"w\"> </span><span class=\"n\">sEs</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sEs</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sEs</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mul_smul</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"n\">conv_rhs</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">sEs</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">mul_assoc</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mul_assoc</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"bp\">⁻¹</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">mul_inv_rev</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">MulAut</span><span class=\"bp\">.</span><span class=\"n\">conj_apply</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">sEs_apply</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">congr</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">t</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">sEs_refl_apply</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 512266402,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744707988
    },
    {
        "content": "<p>I like your definition better than Bhavik's: it's more general. There is a bunch of <code>(v : HeightOneSpectrum A) (w : HeightOneSpectrum B) (h : v = comap w)</code> theorems in FLT for the same reason.</p>",
        "id": 512266790,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744708127
    },
    {
        "content": "<p>I agree. Also, it's closer to the idea that an action of a group on a set gives (“is” ?) a groupoid, with objects that set and arrows given by the members of the group. <br>\nIn any case, I believe there is a lesson in equality to get by proving the above MWE.</p>",
        "id": 512267206,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744708259
    },
    {
        "content": "<p>I think the lesson here is that if you do follow Bhavik's strategy, you should use a better casting function than the \"stupid triangle\"</p>",
        "id": 512269372,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744708907
    },
    {
        "content": "<p>The sorries can be proved with <code>cases H; rfl</code> I think</p>",
        "id": 512269541,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744708943
    },
    {
        "content": "<p>I tried with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=cast#doc\">docs#cast</a>, but wasn't more successful either.</p>",
        "id": 512269654,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744708974
    },
    {
        "content": "<p>I only called it the \"stupid triangle\" in Lean 3 when it was far more stupid. Now I have some respect for it!</p>",
        "id": 512269675,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744708981
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/avoiding.20HEq/near/512269541\">said</a>:</p>\n<blockquote>\n<p>The sorries can be proved with <code>cases H; rfl</code> I think</p>\n</blockquote>\n<p>That looks pretty much like the “induction on equality” that people do in HoTT.</p>",
        "id": 512269972,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744709055
    },
    {
        "content": "<p>It is literally Lean's induction on equality.</p>",
        "id": 512270067,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744709081
    },
    {
        "content": "<p>But now that both versions compile, I'm left into deciding which version is best for mathlib (and me).</p>",
        "id": 512270464,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744709182
    },
    {
        "content": "<p>My vote would be yours because yours is more general (it applies when the proof of the equality is not <code>rfl</code>). Does your version have any HEqs in? Avoiding HEq would be another reason to vote for yours.</p>",
        "id": 512271574,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744709471
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130609\">Antoine Chambert-Loir</span> <a href=\"#narrow/stream/287929-mathlib4/topic/avoiding.20HEq/near/512269654\">said</a>:</p>\n<blockquote>\n<p>I tried with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=cast#doc\">docs#cast</a>, but wasn't more successful either.</p>\n</blockquote>\n<p>I mean a dedicated \"stabilizers at equal elements are isomorphic as monoids\" def</p>",
        "id": 512273166,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744709923
    },
    {
        "content": "<p>Maybe a generic \"equal submonoids are isomorphic\" result, which I think exists, is sufficient</p>",
        "id": 512273302,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744709961
    },
    {
        "content": "<p>Do you mean other than <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MulAction.stabilizer_smul_eq_stabilizer_map_conj#doc\">docs#MulAction.stabilizer_smul_eq_stabilizer_map_conj</a> ?</p>",
        "id": 512273620,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744710053
    },
    {
        "content": "<p>I mean</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">GroupTheory</span><span class=\"bp\">.</span><span class=\"n\">GroupAction</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">MulAction</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MulAction</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">sEs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stabilizer</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≃*</span><span class=\"w\"> </span><span class=\"n\">stabilizer</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"o\">((</span><span class=\"n\">MulAut</span><span class=\"bp\">.</span><span class=\"n\">conj</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">subgroupMap</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">stabilizer</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">trans</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">MulEquiv</span><span class=\"bp\">.</span><span class=\"n\">subgroupCongr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">stabilizer_smul_eq_stabilizer_map_conj</span><span class=\"o\">]))</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">sEs_trans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">sEs</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sEs</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">sEs</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">MulEquiv</span><span class=\"bp\">.</span><span class=\"n\">subgroupCongr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mul_smul</span><span class=\"o\">]))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">sEs</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 512279502,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744711712
    },
    {
        "content": "<p>Your proposed version is just Bhavik's where you've composed with <code>MulEquiv.subgroupCongr</code> inside your definition</p>",
        "id": 512279979,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744711841
    },
    {
        "content": "<p>It's not clear to me why the <code>hg : g • b = a</code> version is better; it means the caller has to juggle the proof arguments in their theorems statements even if they don't intend to do any casting</p>",
        "id": 512280118,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744711886
    },
    {
        "content": "<p>“that” is Bhavik's proposition? It looks simpler at first hand, indeed. But  one doesn't want to have to summon Eric at any basic proof in the theory of group actions.</p>",
        "id": 512280591,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744712037
    },
    {
        "content": "<p>Edited above.</p>",
        "id": 512283842,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744713061
    },
    {
        "content": "<p>I'd argue you summoned me for the <em>statement</em>, not the proof :)</p>",
        "id": 512283893,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744713080
    },
    {
        "content": "<p>OK, so I have two experts of distinct opinions here. I'll try with the other one to see whether it is more equally practical in my applications.</p>",
        "id": 512284131,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744713145
    },
    {
        "content": "<p>What does the statement of <code>trans</code> look like with your spelling?</p>",
        "id": 512284737,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744713357
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">stabilizerEquivStabilizer_trans</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">hg</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">hh</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">stabilizerEquivStabilizer</span><span class=\"w\"> </span><span class=\"n\">hh</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">stabilizerEquivStabilizer</span><span class=\"w\"> </span><span class=\"n\">hg</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">stabilizerEquivStabilizer</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">hg</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"n\">hh</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">smul_smul</span><span class=\"o\">]))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">stabilizerEquivStabilizer_apply</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 512285507,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744713607
    },
    {
        "content": "<p>(This is <em>after</em> I removed additional hypothesis <code>hk : k • c = a</code>, for <code>k : G</code>.)</p>",
        "id": 512285745,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744713690
    },
    {
        "content": "<p>This one creates annoying side goals if you rewrite it backwards; I think both versions need a separate lemma for each direction.</p>",
        "id": 512290686,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744715295
    },
    {
        "content": "<p>For Bhavik's, that's</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">sEs_trans'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">sEs</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">sEs</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sEs</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">MulEquiv</span><span class=\"bp\">.</span><span class=\"n\">subgroupCongr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mul_smul</span><span class=\"o\">]))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">sEs</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 512290888,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744715370
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/avoiding.20HEq/near/512271574\">said</a>:</p>\n<blockquote>\n<p>My vote would be yours because yours is more general (it applies when the proof of the equality is not <code>rfl</code>). Does your version have any HEqs in? Avoiding HEq would be another reason to vote for yours.</p>\n</blockquote>\n<p>The distinction is that in mine, the basic version insists that the elements are of the same form, but combined with a <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MulEquiv.subgroupCongr#doc\">docs#MulEquiv.subgroupCongr</a>, you don't lose any generality. And then we have separation between the two ideas \"stabilising by something in the orbit is equivalent\" and \"stabilising by the same element is equivalent\", where the latter already exists in mathlib</p>",
        "id": 512297497,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1744717456
    },
    {
        "content": "<p>These definitions were made for <a href=\"https://github.com/leanprover-community/mathlib4/pull/24039\">#24039</a>, and losing the flexibility of specifying both points and the group elements leads into nightmares I prefer to avoid.</p>",
        "id": 512309784,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744720974
    },
    {
        "content": "<p>I don't follow; are you saying that in its current form, that PR <em>is</em>/causes a nightmare? Or that the <code>hk : k • c = a</code> version would be a nightmare?</p>",
        "id": 512317834,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744722993
    },
    {
        "content": "<p>Using the simple version (with an explicit <code>g • a</code> instead of <code>b</code>, and an equality) seems complicated.<br>\nThe goal is to use these group isomorphism to equivariant maps of  group actions.</p>",
        "id": 512319766,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744723454
    },
    {
        "content": "<p>Is the complication present in <a href=\"https://github.com/leanprover-community/mathlib4/pull/24039\">#24039</a> already (and if so can you point to where you think it is worst), or are you saying that downstream results become complicated?</p>",
        "id": 512320079,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744723538
    },
    {
        "content": "<p>No, everything worked well in <a href=\"https://github.com/leanprover-community/mathlib4/pull/24039\">#24039</a>. It is when trying to apply your suggestion that it became more complicated.</p>",
        "id": 512321186,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744723815
    },
    {
        "content": "<p>What is \"my suggestion\" and \"it\", if not respectively what <a href=\"https://github.com/leanprover-community/mathlib4/pull/24039\">#24039</a> already does, and the theorems within it?</p>",
        "id": 512321458,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744723885
    },
    {
        "content": "<p>\"your suggestion\" is to define <code>stabilizerEquivStabilizer</code> as</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">stabilizerEquivStabilizer</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stabilizer</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≃*</span><span class=\"w\"> </span><span class=\"n\">stabilizer</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">…</span>\n</code></pre></div>\n<p>In <a href=\"https://github.com/leanprover-community/mathlib4/pull/23962\">#23962</a><del>#24039</del>, these group morphisms are used to define equivariant maps between group actions, namely the action of <code>stabilizer G a</code> on the complement of <code>{a}</code> (a <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=SubMulAction#doc\">docs#SubMulAction</a> named <code>ofStabilizer G a</code> there) and the like for <code>g • a</code>.<br>\nThis equivariant map has to be proved bijective, which it is, trivially, and for whatever reason,<br>\nthis is more difficult to formalize with the above definition.</p>",
        "id": 512322523,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744724161
    },
    {
        "content": "<p>Are you talking about <a href=\"https://github.com/leanprover-community/mathlib4/pull/23962\">#23962</a>, which is where <code>ofStabilizer</code> is defined?</p>",
        "id": 512323189,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744724330
    },
    {
        "content": "<p>Sorry, yes.</p>",
        "id": 512323653,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744724431
    },
    {
        "content": "<blockquote>\n<p>This equivariant map has to be proved bijective,</p>\n</blockquote>\n<p>What's the theorem name of this result?</p>",
        "id": 512324128,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744724544
    },
    {
        "content": "<p><code>SubMulAction.ofStabilizer.conjMap_bijective</code></p>",
        "id": 512324380,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744724612
    }
]