[
    {
        "content": "<p>As a warm-up for the general case over number fields, I proved the product formula over <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">Q</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Q}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8556em;vertical-align:-0.1667em;\"></span><span class=\"mord mathbb\">Q</span></span></span></span>. This is the theorem</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">product_formula</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h_x_nezero</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"n\">x</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">∏ᶠ</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Primes</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">padicNorm</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n</code></pre></div>\n<p>I have reduced the statement to the naturals and then to </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">product_formula_N_range</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h_x_nezero</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">*</span>\n<span class=\"w\">    </span><span class=\"bp\">∏</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">filter</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)),</span><span class=\"w\"> </span><span class=\"n\">padicNorm</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n</code></pre></div>\n<p>in order to use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.prod_pow_prime_padicValNat#doc\">docs#Nat.prod_pow_prime_padicValNat</a>.</p>\n<p>Do you guys think it can go to Mathlib? If so, where? In <code>Mathlib.NumberTheory.Padics.PadicNorm</code>?</p>",
        "id": 473138901,
        "sender_full_name": "Fabrizio Barroero",
        "timestamp": 1727451439
    },
    {
        "content": "<p>This should definitely be in Mathlib! You could try <code>#find_home! product_formula_N_range</code> to see possible files where it could go.</p>",
        "id": 473151086,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1727453670
    },
    {
        "content": "<p>This must certainly be in Mathlib, I agree!</p>",
        "id": 473331675,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1727522097
    },
    {
        "content": "<p>I think it is a general result about number fields, so nor really related to padic numbers.</p>",
        "id": 473331725,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1727522131
    },
    {
        "content": "<p>I think that a dedicated file <code>ProductFormula</code> inside <code>Mathlib/NumberTheory/NumberFields</code> would be good. It will eventually contain the product formula for more general number fields.</p>",
        "id": 473331887,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1727522206
    },
    {
        "content": "<p>Thanks! I've been waiting for this for my <a href=\"https://github.com/leanprover-community/mathlib4/pull/15786\">heights PR</a>.</p>",
        "id": 473335971,
        "sender_full_name": "David Ang",
        "timestamp": 1727523352
    },
    {
        "content": "<p>Right now our definition of adeles of a number field <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>F</mi></mrow><annotation encoding=\"application/x-tex\">F</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span></span></span></span> is looking like it's going to be restricted product of completions. But another definition could be <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"double-struck\">A</mi><mi mathvariant=\"double-struck\">Q</mi></msub><msub><mo>⊗</mo><mi mathvariant=\"double-struck\">Q</mi></msub><mi>F</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{A}_{\\mathbb{Q}}\\otimes_{\\mathbb{Q}}F</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9556em;vertical-align:-0.2667em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">A</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3322em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathbb mtight\">Q</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2667em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\"><span class=\"mbin\">⊗</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3322em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathbb mtight\">Q</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2667em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span></span></span></span> (these are canonically isomorphic but this is a theorem). If we use this latter definition can we somehow get product formula for general number fields from the statement for <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">Q</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Q}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8556em;vertical-align:-0.1667em;\"></span><span class=\"mord mathbb\">Q</span></span></span></span>? I would have thought that the proof that the two definitions of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"double-struck\">A</mi><mi>F</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathbb{A}_F</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8389em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">A</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">F</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> coincided was almost all local and in particular won't use the product formula</p>",
        "id": 473349085,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1727531015
    },
    {
        "content": "<p>This norm is defined purely intrinsically, the adeles are a locally compact space so possess a Haar measure, and the norm of an idele x is the factor that the haar measure is scaled by when you multiply by x.</p>",
        "id": 473349569,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1727531229
    },
    {
        "content": "<p>Thanks everyone for the feedback.<br>\n<code>#find_home! product_formula</code> gives <code>Mathlib.NumberTheory.Padics.PadicNumbers, Mathlib.NumberTheory.Ostrowski</code> while<br>\n<code>#find_home! product_formula_N_range</code> gives <code>Mathlib</code>.<br>\nIn both cases I think <code>#find_home!</code> did not do a good job.<br>\nI agree that the product formula for number fields should have its own file, but I thought this one could go in the <code>PadicNorm</code> file as it is pretty elementary.<br>\nI will prepare a PR in the next few days.</p>",
        "id": 473368613,
        "sender_full_name": "Fabrizio Barroero",
        "timestamp": 1727545139
    }
]