[
    {
        "content": "<p>Would this be a desirable change? <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Stream%27#doc\">docs#Stream'</a> describes itself as an infinite list, so presumably it shoudl present <code>s[i]</code> notation to match lsits?</p>",
        "id": 538548680,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757462596
    },
    {
        "content": "<p>(I guess this is a question for <span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span>)</p>",
        "id": 538548985,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757462909
    },
    {
        "content": "<p>You mean to add <code>GetElem</code> to <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Stream/Defs.html#Stream'\">Stream'</a> or <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Seq/Defs.html#Stream'.Seq\">Stream'.Seq</a>?</p>",
        "id": 538555020,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1757468465
    },
    {
        "content": "<p>I think it's fine to offer that. I don't like it as the default because it will have bad defeqs in the latter case</p>",
        "id": 538576691,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1757486255
    },
    {
        "content": "<p>What would be bad about the defeq?</p>",
        "id": 538589952,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757491580
    },
    {
        "content": "<p>Does <a href=\"https://github.com/leanprover-community/mathlib4/pull/29484\">#29484</a> look like a viable direction?</p>",
        "id": 538954129,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757631800
    },
    {
        "content": "<p>This also switches it to a one-field structure to prevent accidentally mixing <code>s i</code> and <code>s[i]</code></p>",
        "id": 538954149,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757631815
    },
    {
        "content": "<p>Unfortunately this gets quite annoying for recursive stream definitions, since the termination checker doesn't like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Fix</span><span class=\"bp\">.</span><span class=\"n\">approx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Stream'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">âˆ€</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Part</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Î²</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">get'</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">âŠ¥</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">approx</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"c1\">-- `(approx i)` was no problem before</span>\n</code></pre></div>",
        "id": 538954362,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757631972
    },
    {
        "content": "<p>uhoh</p>",
        "id": 538954398,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757631996
    },
    {
        "content": "<p>can we rewrite that as a function <code>Nat -&gt; âˆ€ a, Part (Î² a)</code></p>",
        "id": 538954448,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757632027
    },
    {
        "content": "<p>Sure, I can write</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Fix</span><span class=\"bp\">.</span><span class=\"n\">approx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Stream'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">âˆ€</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Part</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Î²</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">get'</span>\n<span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">get'</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">âŠ¥</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">get'</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Fix</span><span class=\"bp\">.</span><span class=\"n\">get_succ_approx</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fix</span><span class=\"bp\">.</span><span class=\"n\">approx</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)[</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">Fix</span><span class=\"bp\">.</span><span class=\"n\">approx</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)[</span><span class=\"n\">n</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>but I have to write the equation lemma manually</p>",
        "id": 538954484,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757632058
    },
    {
        "content": "<p>Or a slightly more cursed spelling,</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Fix</span><span class=\"bp\">.</span><span class=\"n\">approx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Stream'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">âˆ€</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Part</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Î²</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"kn\">where</span><span class=\"w\"> </span><span class=\"n\">get'</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">get'</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">âŠ¥</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">get'</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span>\n<span class=\"c1\">-- still need the simp lemma</span>\n</code></pre></div>",
        "id": 538954522,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757632091
    },
    {
        "content": "<p>I like the cursed version</p>",
        "id": 538954580,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757632135
    },
    {
        "content": "<p>can we get <code>@[simps]</code> to do these equations for us</p>",
        "id": 538954603,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757632152
    },
    {
        "content": "<p>It would have to know to replace the inner <code>get'</code> with the high-level notation operator</p>",
        "id": 538954628,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757632170
    },
    {
        "content": "<p>I'd rather the equation compiler could do it for me</p>",
        "id": 538954637,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757632179
    },
    {
        "content": "<p>which one</p>",
        "id": 538954651,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757632191
    },
    {
        "content": "<p>the structural recursion or the well-founded recursion</p>",
        "id": 538954673,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757632203
    },
    {
        "content": "<p>Let's move this to <a class=\"message-link\" href=\"/#narrow/channel/270676-lean4/topic/Termination-checking.20of.20one.20field.20structures/near/538954813\">#lean4 &gt; Termination-checking of one field structures @ ðŸ’¬</a></p>",
        "id": 538954774,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757632287
    }
]