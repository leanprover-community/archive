[
    {
        "content": "<p>I'm working on a mathlib-level definition of immersions of smooth manifolds. The correct definition is \"f: M \\to N<code> is a </code>C^k<code> immersion if around each </code>x : M<code>, there are charts of </code>M<code> and </code>N<code> around </code>x<code> and </code>f x<code>, respectively, in which </code>f<code> looks like </code>u\\mapso (u,0)`.</p>\n<p>In finite dimensions, this is equivalent to the familiar definition \"f is an immersion iff each differential <code>mfderiv I I' f x</code> is injective. In infinite-dimensional (e.g. Banach) manifolds, mere injectivity is weaker than the property we want.</p>\n<p>So far, so good. The question I'm struggling with is \"is the composition of immersions an immersion\"?<br>\nIn finite dimensions, the answer is clearly yes (by the chain rule, the composition of injective maps is injective).<br>\nIn infinite dimensions, I feel the answer <em>should be</em> yes. (For instance, if <code>M</code> is an embedded submanifold of <code>N</code> and <code>N</code> is an embedded submanifold of <code>P</code>, we'd like <code>M</code> to be an embedded submanifold of <code>P</code> --- so embedded \"ought to be\" stable under composition, and so should immersions.) But I find this much less obvious to prove.</p>\n<p><strong>Approach 1</strong>. Follow the definition; let <code>x : M</code> be arbitrary.<br>\nSince pick charts <code>\\phi</code> near <code>x</code> and <code>\\psi</code> near <code>f x</code>, and charts <code>\\psi'</code> near <code>f x</code> and <code>\\chi</code> near <code>g (f x)</code> such that</p>\n<ul>\n<li><code>f</code> looks like the inclusion in charts <code>\\phi</code> and <code>\\psi</code>,</li>\n<li><code>g</code> looks like the inclusion in charts <code>\\psi'</code> and <code>\\chi</code>.<br>\n<strong>If</strong> <code>\\psi</code> nad <code>psi'</code> were the same chart, we'd be very happy: but a priori, nothing forces them to be.</li>\n</ul>\n<p><strong>Approach 2.</strong> Looking at other textbooks, Lang (Fundamentals of differential geometry (1999)) proves that being an immersion at <code>x</code> is equivalent to the differential <code>mfderiv I I' f x</code> being a <em>split</em> continuous linear map (i.e., being injective, having closed range and the range admitting a closed complement). (See page 27; this uses the inverse function theorem.)<br>\nThis looks like an approach which could prove composition. However, trying to formalise this in Lean gets me stuck also --- at trying to prove the sum of two closed submodules is closed. (See <a href=\"https://github.com/leanprover-community/mathlib4/pull/23186\">#23186</a>, at <a href=\"https://github.com/leanprover-community/mathlib4/blob/7abcc3bfb2e764029e18ae5edc80483e0a09343f/Mathlib/Analysis/NormedSpace/HahnBanach/Splits.lean#L128\">this sorry</a>.)</p>\n<p>Thoughts about this are very appreciated. In case \"being a submanifold\" is no longer transitive in the Banach setting, that would at least be good to know.</p>",
        "id": 507300190,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1742569637
    },
    {
        "content": "<p>Further data points: <a href=\"https://arxiv.org/pdf/2112.08114\">Schmeding</a>, Section 1.4 poses \"the composition of submersions is a submersion\" as an exercise, but makes no statement about immersions. (They work with locally convex spaces, which is a bit more general that mathlib's setting.)</p>",
        "id": 507300468,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1742569704
    },
    {
        "content": "<p>If I read you correctly, you are asking the following question (which is now a pure linear-algebra question). Let <code>A</code> and <code>B</code> be two linear maps between Banach spaces which are injective, with closed range (equivalently, <code>||A x|| ≥ c ||x||</code> for a positive constant <code>c</code>), and with complemented range. Then is the same true for the composition of <code>A</code> and <code>B</code>?</p>",
        "id": 507301381,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1742569936
    },
    {
        "content": "<p>\"Complemented range\" might mean \"closed complement\".<br>\n<del>I'm not exactly sure about that.</del> I double-checked with another source: yes, closed is required. Makes more sense also.</p>",
        "id": 507301669,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1742570012
    },
    {
        "content": "<p>In fact, with just any complement, the result is not difficult.</p>",
        "id": 507301719,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1742570025
    },
    {
        "content": "<p>I think the answer is yes. Injectivity and anti-Lipschitz compose obviously, so the question is the complemented range. Being complemented is the same as being the image of a continuous projection (or the kernel, it's equivalent). Let <code>A : E -&gt; F</code> and <code>B : F -&gt; G</code>. Let <code>p_B : G -&gt; range B</code> be a continuous projection and <code>p_A : F -&gt; range E</code>. Then <code>B o p_A o B^{-1} o p_B</code> should be a continuous projection on the range of <code>B o A</code>, if I'm not mistaken.</p>",
        "id": 507302473,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1742570194
    },
    {
        "content": "<p>You can also write this by taking <code>C_B</code> a complement of the range of <code>B</code>, and <code>C_A</code>a complement of the range of <code>A</code>. Then <code>B(C_A) + C_B</code> is a complement of the range of <code>B o A</code>, and the question is whether it's closed. In general, the sum of two closed subspaces has no reason to be closed, but here the two components live in the closed direct sum <code>range B + C_B</code>, so there is no problem.</p>",
        "id": 507303390,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1742570411
    },
    {
        "content": "<p>(Because the norm on <code>range B + C_B</code> is equivalent to the max of the norms of the components, where the inequality <code>||(x, y)|| ≤ max ||x|| ||y||</code> is obvious, and the other one comes from the continuity of the projections on <code>range B</code> and <code>C_B</code> respectively)</p>",
        "id": 507303907,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1742570536
    },
    {
        "content": "<p>Thanks! I also think, <code>B o p_A o B^{-1} o p_B</code> should be a projection, so that would work.</p>",
        "id": 507303945,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1742570550
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110050\">Sébastien Gouëzel</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Composition.20of.20immersions.20is.20an.20immersion.3A.20infinite-dimensio/near/507303390\">said</a>:</p>\n<blockquote>\n<p>You can also write this by taking <code>C_B</code> a complement of the range of <code>B</code>, and <code>C_A</code>a complement of the range of <code>A</code>. Then <code>B(C_A) + C_B</code> is a complement of the range of <code>B o A</code>, and the question is whether it's closed. In general, the sum of two closed subspaces has no reason to be closed, but here the two components live in the closed direct sum <code>range B + C_B</code>, so there is no problem.</p>\n</blockquote>\n<p>That was what I had tried, and I got stuck at \"why is the sum of the complements closed\".</p>",
        "id": 507304007,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1742570568
    },
    {
        "content": "<p>For approach 1: Can't you restrict to an open neighbourhood of <code>f x</code>  inside the intersection of the two charts around <code>f x</code>?</p>",
        "id": 507304167,
        "sender_full_name": "Christian Merten",
        "timestamp": 1742570611
    },
    {
        "content": "<p>Here is a proof by hand that <code>B(C_A) + C_B</code> is closed.</p>",
        "id": 507304346,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1742570653
    },
    {
        "content": "<p>Take a sequence <code>(u_n)</code> in <code>B(C_A) + C_B</code> which is converging. By continuity of the projections, their components <code>x_n</code> and <code>y_n</code> in <code>range B</code> and <code>C_B</code> both converge. As <code>B</code> is antilipschitz, <code>B^{-1}(x_n)</code> is also converging. As all of them belong to <code>C_A</code>, which is closed, <code>B^{-1} x_n</code> converges to a point in <code>C_A</code>. Therefore, by continuity of <code>B</code>, the sequence <code>x_n = B (B^{-1} x_n)</code> converges to a limit in <code>B(C_A)</code>. Finally, <code>u_n = x_n + y_n</code> is converging to a point which is the sum of a point in <code>B(C_A)</code> and a point in <code>C_B</code>, qed.</p>",
        "id": 507304994,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1742570827
    },
    {
        "content": "<p>Thanks a lot! I will digest this, and complete my PR accordingly.</p>",
        "id": 507305952,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1742571062
    }
]