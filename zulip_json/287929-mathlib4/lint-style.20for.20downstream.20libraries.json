[
    {
        "content": "<p>I would like to enforce mathlib style in a downstream library. I tried using <code>lake exe lint-style</code>, but it fails because it hardcodes the name of the sublibraries <code>Archive</code> and <code>Counterexamples</code>. Furthermore, it does extra stuff like checking that the files in <code>scripts</code> are documented and checks that <code>Mathlib.Init</code> is imported in all files.</p>",
        "id": 497739923,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1738697111
    },
    {
        "content": "<p>Could we</p>\n<ul>\n<li>move those two extra steps to another executable</li>\n<li>modularise <code>lint-style</code> so that it runs on a specific sublibrary?</li>\n</ul>",
        "id": 497740279,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1738697233
    },
    {
        "content": "<p>Actually, I can't see what <code>lint-style</code> does apart from those two extra steps?</p>",
        "id": 497743808,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1738698502
    },
    {
        "content": "<p><code>lint-style</code> currently does three things, which are all mentioned in <code>lintStyleCli</code>:</p>\n<ul>\n<li>run the text-based linters on all <code>.lean</code> files (that's the <code>lintModules</code>) step</li>\n<li>check that every file in <code>scripts</code> is documented</li>\n<li>check that <code>Mathlib.Init</code> is imported in all files</li>\n</ul>",
        "id": 497758759,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1738704052
    },
    {
        "content": "<p>Your request (\"give me a way to run lint-style on downstream projects\") is a very reasonable one. I agree with making the libraries configurable.</p>",
        "id": 497758875,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1738704107
    },
    {
        "content": "<p>I'm not sure about moving the extra steps to another executable. I'd prefer <em>one</em> executable <code>lake lint</code> (which could include <code>runLinter</code>, the current <code>lint-style</code> and possibly others, such as <code>shake</code>) over five different executables.</p>",
        "id": 497759090,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1738704188
    },
    {
        "content": "<p>I could, however, imagine</p>\n<ul>\n<li>moving those extra checks behind a flag (perhaps <code>lake exe lint-style --mathlib</code> enables them --- or <code>lake exe lint-style --downstream</code> disables them)</li>\n<li>actually, perhaps it's nicer to couple that to subdirectories being passed in: if a library is specified which is not mathlib, don't run these checks?</li>\n</ul>",
        "id": 497759448,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1738704323
    },
    {
        "content": "<p>What bothers me is that nothing in <code>lint-style</code> says it's coming from mathlib. In fact, I thought for a second it was a core thing</p>",
        "id": 497761547,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1738705155
    },
    {
        "content": "<p>I am of the opinion that, if a generically-named executable is doing mathlib-specific logic, this logic should be hidden behind a mathlib-named flag. Does that sound reasonable?</p>",
        "id": 497761795,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1738705251
    },
    {
        "content": "<p>(I doubt <code>lake exe cache get</code> is currently exactly following this rule, but at least it doesn't seem disastrously so from the user side)</p>",
        "id": 497761941,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1738705315
    },
    {
        "content": "<p>I had a quick moment on the TGV, and produced <a href=\"https://github.com/leanprover-community/mathlib4/pull/21476\">#21476</a>. Does that address your use-case/would you like to test on a downstream project?</p>",
        "id": 497926677,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1738770884
    },
    {
        "content": "<p>TL;DR Run <code>lake exe lint-style Mathlib</code> or <code>lake exe lint-style</code> inside mathlib for the usual operations; run <code>lake exe lint-style Carleson</code> in a project <code>Carleson</code> depending on mathlib.</p>",
        "id": 497926854,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1738770938
    },
    {
        "content": "<p>Thanks Michael for the quick ( <span aria-label=\"high speed train\" class=\"emoji emoji-1f684\" role=\"img\" title=\"high speed train\">:high_speed_train:</span>) turnaround! I will have a look tomorrow</p>",
        "id": 497991603,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1738793144
    }
]