[
    {
        "content": "<p>I just started a new project using <code>lake new my_project math</code>, and I'm getting these errors when running <code>lake exe cache get</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>error: Batteries/Data/String/Matcher.lean:48:50: Invalid field notation: Function `Substring.bsize` does not have a usable parameter of type `Substring` for which to substitute `m.pattern`\nerror: Batteries/Data/String/Matcher.lean:105:16: Invalid field `findSubstr?`: The environment does not contain `Substring.Raw.findSubstr?`\n  s.toSubstring\nhas type\n  Substring.Raw\nerror: Batteries/Data/String/Matcher.lean:109:16: Invalid field `containsSubstr`: The environment does not contain `Substring.Raw.containsSubstr`\n  s.toSubstring\nhas type\n  Substring.Raw\n</code></pre></div>\n<p><a href=\"/user_uploads/3121/eZd7VdXk-qSJon8m6TfPrGRy/PastedText.txt\">full_output.txt</a></p>\n<p>lakefile.toml:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"PubgrubLeanTest1\"</span>\n<span class=\"n\">version</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"0.1.0\"</span>\n<span class=\"n\">keywords</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"s2\">\"math\"</span><span class=\"o\">]</span>\n<span class=\"n\">defaultTargets</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"s2\">\"PubgrubLeanTest1\"</span><span class=\"o\">]</span>\n\n<span class=\"o\">[</span><span class=\"n\">leanOptions</span><span class=\"o\">]</span>\n<span class=\"n\">pp</span><span class=\"bp\">.</span><span class=\"n\">unicode</span><span class=\"bp\">.</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\">                 </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">pretty</span><span class=\"bp\">-</span><span class=\"n\">prints</span><span class=\"w\"> </span><span class=\"ss\">`fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"bp\">`</span>\n<span class=\"n\">relaxedAutoImplicit</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"n\">weak</span><span class=\"bp\">.</span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">mathlibStandardSet</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"n\">maxSynthPendingDepth</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">3</span>\n\n<span class=\"o\">[[</span><span class=\"n\">require</span><span class=\"o\">]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"mathlib\"</span>\n<span class=\"n\">scope</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"leanprover-community\"</span>\n<span class=\"n\">rev</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"v4.26.0\"</span>\n\n<span class=\"o\">[[</span><span class=\"n\">lean_lib</span><span class=\"o\">]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"PubgrubLeanTest1\"</span>\n\n<span class=\"o\">[[</span><span class=\"n\">require</span><span class=\"o\">]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"RustModel\"</span>\n<span class=\"n\">path</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"../RustModelProject\"</span>\n</code></pre></div>\n<p>lean-toolchain:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">26</span><span class=\"bp\">.</span><span class=\"m\">0</span>\n</code></pre></div>\n<p><a href=\"/user_uploads/3121/id5WnwR2OJR7-ttpSVySvq9V/PastedText.txt\">lake-manifest.json</a></p>",
        "id": 567327768,
        "sender_full_name": "J. Simon Richard",
        "timestamp": 1768059062
    },
    {
        "content": "<p>When switching to 4.25.0, I'm getting this error:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>error: Cache/Requests.lean:34:68: Invalid field `rawEndPos`: The environment does not contain `String.rawEndPos`\n  url\nhas type\n  String\nerror: Lean exited with code 1\nSome required targets logged failures:\n- Cache.Requests\nerror: build failed\n</code></pre></div>\n<p>Could this be a general problem with the cache?</p>",
        "id": 567328107,
        "sender_full_name": "J. Simon Richard",
        "timestamp": 1768059438
    },
    {
        "content": "<p>What's the toml file of <code>RustModel</code>?</p>",
        "id": 567328144,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1768059483
    },
    {
        "content": "<p>Ah, that could be part of the issue... it's this:</p>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"RustModel\"</span>\n<span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"0.1.0\"</span>\n<span class=\"n\">defaultTargets</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"rustmodel\"</span><span class=\"p\">]</span>\n\n<span class=\"k\">[[lean_lib]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"RustModel\"</span>\n\n<span class=\"k\">[[lean_exe]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"rustmodel\"</span>\n<span class=\"n\">root</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"Main\"</span>\n\n<span class=\"k\">[[require]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"mathlib\"</span>\n<span class=\"n\">git</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/leanprover-community/mathlib4\"</span>\n<span class=\"n\">rev</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"v4.25.1\"</span>\n</code></pre></div>\n<p>However, I'm still getting error with mathlib 4.25.0 after removing RustModel as a dependency and rerunning <code>cache get</code></p>",
        "id": 567328291,
        "sender_full_name": "J. Simon Richard",
        "timestamp": 1768059616
    },
    {
        "content": "<p>I would remove <code>.lake/*</code> and try again.</p>",
        "id": 567328391,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1768059725
    },
    {
        "content": "<p>I'm doing that for each run already</p>",
        "id": 567328431,
        "sender_full_name": "J. Simon Richard",
        "timestamp": 1768059746
    },
    {
        "content": "<p>What's full log for 4.25.0? Did you update <code>lean-toolchain</code>?</p>",
        "id": 567328457,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1768059777
    },
    {
        "content": "<p>I just hit my error with v4.26.0 after removing RustModel as a dependency, removing .lake, and rerunning lake exe cache get</p>",
        "id": 567328460,
        "sender_full_name": "J. Simon Richard",
        "timestamp": 1768059780
    },
    {
        "content": "<p>Did you run <code>lake update</code>?</p>",
        "id": 567328488,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1768059806
    },
    {
        "content": "<p>Lake records specific revisions to <code>lake-manifest.json</code>. If you change versions of your dependencies, then you should either run <code>lake update</code> or delete this file.</p>",
        "id": 567328538,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1768059847
    },
    {
        "content": "<p>And yeah, I've been updating a lean-toolchain... but no, I didn't run <code>lake update</code>.</p>",
        "id": 567328539,
        "sender_full_name": "J. Simon Richard",
        "timestamp": 1768059847
    },
    {
        "content": "<p>Okay, I think it's working now.  I removed lake-manifest.json and re-downloaded the cache, and that worked.  In general, do all of my mathlib-dependent projects need to be on the same mathlib version? Or will that only apply when there are particular breaking changes like the error messages at the top suggest?</p>",
        "id": 567328974,
        "sender_full_name": "J. Simon Richard",
        "timestamp": 1768060230
    },
    {
        "content": "<p>Generally, different Lean versions aren't compatible, so all packages that depend on each other must be on the same version.</p>",
        "id": 567329615,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1768060880
    },
    {
        "content": "<p>This topic was moved here from <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/Trouble.20using.20mathlib4.204.2E26.2E0.20as.20a.20dependency\">#mathlib4 &gt; Trouble using mathlib4 4.26.0 as a dependency</a> by <span class=\"user-mention silent\" data-user-id=\"876642\">J. Simon Richard</span>.</p>",
        "id": 567329672,
        "sender_full_name": "Notification Bot",
        "timestamp": 1768060937
    }
]